<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>macå®‰è£…å’Œé…ç½®maven</title>
    <url>/2021/08/25/myblog/java/MAC%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AEMaven/</url>
    <content><![CDATA[<h1 id="MACå®‰è£…å’Œé…ç½®Maven"><a href="#MACå®‰è£…å’Œé…ç½®Maven" class="headerlink" title="MACå®‰è£…å’Œé…ç½®Maven"></a>MACå®‰è£…å’Œé…ç½®Maven</h1><h2 id="1-Mavenç®€ä»‹"><a href="#1-Mavenç®€ä»‹" class="headerlink" title="1.Mavenç®€ä»‹"></a>1.Mavenç®€ä»‹</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">èƒŒæ™¯ï¼šå¼€å‘Aé¡¹ç›®ï¼ŒAé¡¹ç›®ä¸­çš„ä¸€äº›åŠŸèƒ½ä¾èµ–äºBé¡¹ç›®ä¸­çš„æŸäº›ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•ç»´ç³»è¿™ç§ä¾èµ–å…³ç³»ï¼Ÿéœ€è¦ç”¨å“ªä¸ªé¡¹ç›®ä¸­çš„å“ªäº›ç±»ï¼Œä¹Ÿå°±æ˜¯ç”¨åˆ«äººå†™å¥½äº†çš„åŠŸèƒ½ä»£ç ï¼Œå¯¼å…¥jaråŒ…å³å¯ã€‚æ‰€ä»¥è¿™é‡Œä¹Ÿå¦‚æ­¤ï¼Œå¯ä»¥å°†Bé¡¹ç›®æ‰“æˆjaråŒ…ï¼Œç„¶ååœ¨Aé¡¹ç›®çš„Libraryä¸‹å¯¼å…¥Bçš„jaræ–‡ä»¶ï¼Œè¿™æ ·ï¼ŒAé¡¹ç›®å°±å¯ä»¥è°ƒç”¨Bé¡¹ç›®ä¸­çš„æŸäº›ç±»äº†ã€‚å¦‚æœåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå‘ç°Bä¸­çš„bugï¼Œåˆ™å¿…é¡»å°†Bé¡¹ç›®ä¿®æ”¹å¥½ï¼Œå¹¶é‡æ–°å°†Bæ‰“åŒ…å¹¶å¯¹Aé¡¹ç›®è¿›è¡Œé‡ç¼–è¯‘æ“ä½œ</span><br></pre></td></tr></table></figure>

<p>Mavenæ˜¯åŸºäºé¡¹ç›®å¯¹è±¡æ¨¡å‹(POM project object model)ï¼Œå¯ä»¥é€šè¿‡ä¸€å°æ®µæè¿°ä¿¡æ¯ï¼ˆé…ç½®ï¼‰æ¥ç®¡ç†é¡¹ç›®çš„æ„å»ºï¼ŒæŠ¥å‘Šå’Œæ–‡æ¡£çš„è½¯ä»¶é¡¹ç›®ç®¡ç†å·¥å…·ã€‚</p>
<p>Mavençš„æ ¸å¿ƒåŠŸèƒ½ä¾¿æ˜¯åˆç†å™è¿°é¡¹ç›®é—´çš„ä¾èµ–å…³ç³»ï¼Œé€šä¿—ç‚¹è®²ï¼Œå°±æ˜¯é€šè¿‡pom.xmlæ–‡ä»¶çš„é…ç½®è·å–jaråŒ…ï¼Œè€Œä¸ç”¨æ‰‹åŠ¨å»æ·»åŠ jaråŒ…ã€‚</p>
<p>ç”±äºMavenä»“åº“ä¸­æ‰€æœ‰çš„JARéƒ½æœ‰å…¶è‡ªå·±çš„åæ ‡ï¼Œè¯¥åæ ‡å‘Šè¯‰Mavenå®ƒçš„ç»„IDï¼Œæ„ä»¶IDï¼Œç‰ˆæœ¬ï¼Œæ‰“åŒ…æ–¹å¼ç­‰ç­‰ï¼Œ å› æ­¤Mavené¡¹ç›®å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œä¾èµ–ç‰ˆæœ¬ç®¡ç†ã€‚</p>
<h2 id="2-å®‰è£…å’Œé…ç½®Maven"><a href="#2-å®‰è£…å’Œé…ç½®Maven" class="headerlink" title="2.å®‰è£…å’Œé…ç½®Maven"></a>2.å®‰è£…å’Œé…ç½®Maven</h2><p>ä¸‹è½½åœ°å€ï¼š <a href="https://maven.apache.org/download.cgi">https://maven.apache.org/download.cgi</a></p>
<p>![image-20210824144100726](&#x2F;Users&#x2F;liuxuan14&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210824144100726.png)</p>
<p>æˆ‘ä¸‹è½½åœ¨äº†<code>/Library/ApacheMaven</code></p>
<p><code>vim ~/.bash_profile</code>  &#x2F;&#x2F;é…ç½®ç¯å¢ƒå˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export M=&quot;/Library/ApacheMaven&quot;  //æ ¹æ®è‡ªå·±æ”¾åœ¨å“ªä¸ªç›®å½•</span><br><span class="line">export PATH=&quot;$M/bin:$PATH&quot;</span><br></pre></td></tr></table></figure>

<p><code>source ~/.bash_profile</code>     &#x2F;&#x2F;ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<p><code>mvn -v</code>   &#x2F;&#x2F;æŸ¥çœ‹ç‰ˆæœ¬</p>
<p>æˆ–è€…ï¼Œå¯ä»¥ç›´æ¥<code>brew install maven</code></p>
<h3 id="ä¸‹è½½è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°"><a href="#ä¸‹è½½è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°" class="headerlink" title="ä¸‹è½½è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°"></a>ä¸‹è½½è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°</h3><p>maven å°±åƒæ˜¯ä¸€ä¸ªå¤§ä»“åº“ï¼Œé‡Œé¢æ˜¯å¾ˆå¤šçš„jaråŒ…ï¼Œæˆ‘ä»¬éœ€è¦çš„æ—¶å€™å°±å»é‡Œé¢æ‹¿ï¼Œæ‰€ä»¥è¿™å°±æ¶‰åŠåˆ°ä¸€ä¸ª â€˜â€˜æœ¬åœ°ä»“åº“â€™â€™ï¼ˆä¸èƒ½éœ€è¦ä»€ä¹ˆå†å»ç½‘ä¸Šä¸‹è½½å§ï¼Œé€Ÿåº¦æœ‰æ—¶å€™å¾ˆæ…¢çš„ï¼‰,é‚£ä¹ˆå’±ä»¬å°±å¾—å…ˆæŠŠè¿™äº›jaråŒ…ä¸‹è½½åˆ°å’±ä»¬æœ¬åœ°æ–¹ä¾¿ä½¿ç”¨ï¼Œ<br>é»˜è®¤è¯·å†µä¸‹ï¼Œè¿™ä¸ªæœ¬åœ°ä»“åº“ä¼šåœ¨&#x2F;user&#x2F;name&#x2F;.m2ä¸‹é¢ï¼ˆname æ˜¯ä½ çš„ç”¨æˆ·åï¼‰ã€‚ä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠæœ¬åœ°ä»“åº“æ”¹åœ¨Mavenå®‰è£…ç›®å½•ä¸‹ã€‚</p>
<p>æ‰“å¼€å®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹çš„<code>settings.xml</code><br>åŠ å…¥<code>&lt;localRepository&gt;/Library/ApacheMaven/repository &lt;/localRepository&gt;</code></p>
<p>è¾“å…¥<code>mvn help:system</code></p>
<p>![image-20210824175620786](&#x2F;Users&#x2F;liuxuan14&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210824175620786.png)</p>
<p>å¤šäº†ä¸€ä¸ªrepositoryæ–‡ä»¶å¤¹ï¼Œè¿™å°±æ˜¯å’±ä»¬ä»è¿œç¨‹ä»“åº“ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“çš„æ–‡ä»¶ã€‚</p>
<h2 id="3-åˆ›å»ºMavené¡¹ç›®"><a href="#3-åˆ›å»ºMavené¡¹ç›®" class="headerlink" title="3.åˆ›å»ºMavené¡¹ç›®"></a>3.åˆ›å»ºMavené¡¹ç›®</h2><h3 id="a-ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºMavené¡¹ç›®"><a href="#a-ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºMavené¡¹ç›®" class="headerlink" title="a.ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºMavené¡¹ç›®"></a>a.ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºMavené¡¹ç›®</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId=cn.xuanliu.helloword -DartifactId=helloworld -Dpackage=cn.cxuanliu.helloword -Dversion=1.0-SNAPSHOT -DarchetypeArtifactId=maven-archetype-quickstart</span><br></pre></td></tr></table></figure>

<ul>
<li><code>mvn</code>:è¡¨ç¤ºä½¿ç”¨çš„æ˜¯mavenå‘½ä»¤ã€‚</li>
<li><code>archetype:generate</code>:è¡¨ç¤ºä½¿ç”¨generateè¿™ä¸ªæ’ä»¶ä¸ºæˆ‘ä»¬çš„mavené¡¹ç›®è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªmavenéª¨æ¶ï¼Œå³æˆ‘ä»¬é¡¹ç›®çš„å·¥ç¨‹ç»“æ„ã€‚åè¾¹è·Ÿçš„æ˜¯è¯¥æ’ä»¶ä¸ºæˆ‘ä»¬åˆ›å»ºå·¥ç¨‹ç»“æ„æ‰€éœ€è¦çš„ä¸€è¿ä¸²çš„å‚æ•°ã€‚</li>
<li><code>-DgroupId</code>:æ ‡è¯†é¡¹ç›®çš„åæ ‡å…ƒç´ ä¹‹ä¸€ï¼Œé¡¹ç›®åŒ…åï¼Œå¯ä»¥æ˜¯ï¼šåŸŸåçš„åå†™+é¡¹ç›®åã€‚</li>
<li><code>-DartifactId</code>:æ ‡è¯†é¡¹ç›®çš„åæ ‡å…ƒç´ ä¹‹ä¸€ï¼Œå®ƒçš„å€¼ä¸ºæˆ‘ä»¬çš„é¡¹ç›®åã€‚æˆ‘è¿™é‡ŒæŒ‡å®šæˆ‘è¦ç”Ÿæˆçš„é¡¹ç›®åä¸ºhellowordã€‚</li>
<li><code>-Dpackage</code>:æ ‡è¯†é¡¹ç›®çš„åæ ‡å…ƒç´ ä¹‹ä¸€,è¿™é‡Œå€¼å°±è·ŸDgroupIdçš„å€¼ä¿æŒä¸€è‡´å³å¯ã€‚æ­¤å±æ€§åœ¨å‘½ä»¤è¡Œä¸­å¯é€‰ã€‚</li>
<li><code>-Dversion</code>:æŒ‡å®šç‰ˆæœ¬å·ã€‚æ­¤å±æ€§åœ¨å‘½ä»¤è¡Œä¸­å¯é€‰</li>
<li><code>-DarchetypeArtifactId</code>:è¡¨ç¤ºæˆ‘ä»¬ç”Ÿæˆçš„å·¥ç¨‹ç»“æ„ä¸ºå“ªä¸€ç§ï¼Œè¿™é‡Œçš„å±æ€§å€¼ä¸º<code>maven-archetype-quickstart</code>è¡¨ç¤ºç”Ÿæˆå·¥ç¨‹ç›®å½•ç»“æ„ä¸ºquickstartçš„ç»“æ„ã€‚å…¶å€¼è¿˜å¯ä»¥ä¸º<code>maven-archetype-webapp</code>è¡¨ç¤ºç”Ÿæˆçš„å·¥ç¨‹ç›®å½•ç»“æ„ä¸ºwebappçš„ç»“æ„ã€‚</li>
</ul>
<p>![image-20210824155803431](&#x2F;Users&#x2F;liuxuan14&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210824155803431.png)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç›®å½•è§£è¯»ï¼šåœ¨mavené¡¹ç›®çš„å¼€å‘ä¸­ï¼Œæ‰€æœ‰çš„æºä»£ç æ”¾åœ¨æ–‡ä»¶å¤¹ /src/main/java/ä¸‹, æ‰€æœ‰çš„å•å…ƒæµ‹è¯•ä»£ç æ”¾å…¥ /src/test/java/ã€‚</span><br><span class="line">pom.xml æè¿°äº†æ•´ä¸ªé¡¹ç›®çš„ä¿¡æ¯</span><br></pre></td></tr></table></figure>

<h3 id="b-ä½¿ç”¨IDEAåˆ›å»ºMavené¡¹ç›®"><a href="#b-ä½¿ç”¨IDEAåˆ›å»ºMavené¡¹ç›®" class="headerlink" title="b.ä½¿ç”¨IDEAåˆ›å»ºMavené¡¹ç›®"></a>b.ä½¿ç”¨IDEAåˆ›å»ºMavené¡¹ç›®</h3><p><code>Create New Project</code>ï¼Œé€‰æ‹©<code>Maven</code>ï¼Œå‹¾é€‰<code>Create from archetype</code></p>
<p><img src="https://img2018.cnblogs.com/blog/1068501/201809/1068501-20180914191722384-1695467171.png" alt="img"></p>
<p>å†™<code>Maven</code>çš„åæ ‡ï¼Œâ€œgroupIdâ€ï¼Œâ€œartifactIdâ€ï¼Œä»¥åŠâ€œversionâ€ï¼Œå…¶ä¸­groupIdæ˜¯å…¬å¸åŸŸåçš„åå†™ï¼Œè€ŒartifactIdæ˜¯é¡¹ç›®åæˆ–æ¨¡å—åï¼Œversionå°±æ˜¯è¯¥é¡¹ç›®æˆ–æ¨¡å—æ‰€å¯¹åº”çš„ç‰ˆæœ¬å·ã€‚</p>
<p>![image-20210824174243856](&#x2F;Users&#x2F;liuxuan14&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210824174243856.png)</p>
<p>![image-20210824180029943](&#x2F;Users&#x2F;liuxuan14&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210824180029943.png)</p>
<p>mavenä¼šè‡ªåŠ¨ä¸‹è½½mavenä¾èµ–ï¼Œå½“æ‰€æœ‰çš„éƒ½è‡ªåŠ¨å®Œæˆåï¼Œåˆ›å»ºçš„mavené¡¹ç›®ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š </p>
<p>![image-20210824180441439](&#x2F;Users&#x2F;liuxuan14&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210824180441439.png)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒæŠŠé¡¹ç›®çš„ä¸»ä»£ç æ”¾åˆ° src/main/java ç›®å½•ä¸‹ï¼ˆéµå¾ªMavençº¦å®šï¼‰ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çš„é…ç½®ï¼ŒMavenåœ¨è¿è¡Œæ—¶å°†è‡ªåŠ¨æœå¯»è¯¥ç›®å½•ä¸‹çš„ä¸»ä»£ç ã€‚</span><br><span class="line">ï¼ˆ2ï¼‰ä¸ºäº†ä½¿é¡¹ç›®çš„ç»“æ„ä¿æŒæ¸…æ™°ï¼Œæ‰€ä»¥IDEAè‡ªåŠ¨åˆ›å»ºäº† test æ–‡ä»¶ï¼Œå°†ä¸»ä»£ç å’Œæµ‹è¯•ä»£ç åˆ†åˆ«æ”¾åˆ°äº†ç‹¬ç«‹çš„ç›®å½•ä¸­ã€‚</span><br><span class="line">ï¼ˆ3ï¼‰pom.xmlä¸ºMavençš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå®ƒçš„å…¨ç§°ä¸ºï¼ˆProject Object Modelï¼Œé¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼‰ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨Mavençš„æ—¶å€™ä¹Ÿé€šå¸¸åœ¨è¿™ä¸ªpom .xml ä¸­é…ç½®ã€‚</span><br></pre></td></tr></table></figure>

<h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml:"></a>pom.xml:</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>    <span class="comment">&lt;!-- xmlå¤´ï¼ŒæŒ‡å®šxmlæ–‡æ¡£çš„ç‰ˆæœ¬ä¿¡æ¯å’Œç¼–ç æ–¹å¼ --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;project&gt;ä¸ºæ‰€æœ‰pom.xmlçš„æ ¹å…ƒç´ ï¼Œå£°æ˜äº†ä¸€äº›POMç›¸å…³çš„å‘½åç©ºé—´åŠxsdå…ƒç´ ï¼Œ</span></span><br><span class="line"><span class="comment">  è¿™äº›å…ƒç´ ä¸æ˜¯pom.xmlä¸­å¿…é¡»æ·»åŠ çš„ï¼Œä½†æ˜¯ä½¿ç”¨è¿™äº›å±æ€§å¯ä»¥ä½¿ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œ</span></span><br><span class="line"><span class="comment">  å¦‚IDEä¸­çš„xmlç¼–è¾‘å™¨å¸®åŠ©å¼€å‘è€…å¿«é€Ÿç¼–è¾‘POMã€‚ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;modeVersion&gt; æŒ‡å®šäº†å½“å‰POMæ¨¡æ¿çš„ç‰ˆæœ¬ --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.liuxuan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    <span class="comment">&lt;!-- &lt;groupId&gt; å®šä¹‰äº†è¯¥é¡¹ç›®å±äºå“ªä¸ªé¡¹ç›®ç»„ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ideamaven<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>   <span class="comment">&lt;!-- &lt;&lt;artifactId&gt;å®šä¹‰äº†å½“å‰Mavené¡¹ç›®åœ¨é¡¹ç›®ç»„çš„å”¯ä¸€ä¸€ä¸ªID,é¡¹ç›®å --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  <span class="comment">&lt;!--&lt;version&gt;å®šä¹‰äº†Hello Mavené¡¹ç›®å½“å‰çš„ç‰ˆæœ¬å· 1.0-SNAPSHOT ä¸ºIDEAé»˜è®¤çš„åˆå§‹ç‰ˆæœ¬å· --&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ²¡æœ‰å®é™…çš„javaä»£ç æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œæ•´çš„åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®çš„pom.xmlï¼Œè¿™è¯´æ˜äº†Mavenå¯ä»¥ä½¿é¡¹ç›®å¯¹è±¡æ¨¡å‹æœ€å¤§ç¨‹åº¦çš„ä¸ä»£ç ç›¸ç‹¬ç«‹ï¼Œè¿™å……åˆ†ä½“ç°äº†è§£è€¦çš„åŸåˆ™å’Œç†å¿µï¼ä¸ºå¼€å‘è€…èŠ‚çœäº†æ—¶é—´ï¼Œå¤§å¤§ç¼©çŸ­äº†é¡¹ç›®å¼€å‘å‘¨æœŸã€‚åœ¨é¡¹ç›®å¼€å‘åˆ°ç¨³å®šæœŸæ—¶ï¼Œå‡çº§ç‰ˆæœ¬æ—¶ï¼Œå¼€å‘è€…å¯ä»¥ä¸éœ€è¦ä¿®æ”¹å®é™…çš„ java ä»£ç ï¼Œè€Œæ˜¯åªä¿®æ”¹pom.xmlï¼Œè¿™ä¸€ç‰¹ç‚¹ä½¿Mavenè¢«å¹¿æ³›çš„ä½¿ç”¨ã€‚</p>
<h2 id="4-ç¼–å†™ä¸»ä»£ç "><a href="#4-ç¼–å†™ä¸»ä»£ç " class="headerlink" title="4.ç¼–å†™ä¸»ä»£ç "></a>4.ç¼–å†™ä¸»ä»£ç </h2><p><strong>é¡¹ç›®ä¸»ä»£ç å’Œæµ‹è¯•ä»£ç ä¸åŒï¼Œä¸»ä»£ç ä¼šè¢«æ‰“åŒ…åˆ°æœ€ç»ˆçš„æ„ä»¶ä¸­ï¼Œè€Œæµ‹è¯•ä»£ç åªåœ¨è¿è¡Œæµ‹è¯•æ—¶ç”¨åˆ°ï¼Œä¸ä¼šè¢«æ‰“åŒ…ã€‚</strong></p>
<p><strong>åœ¨src&#x2F;main&#x2F;javaä¸­åˆ›å»ºæ–‡ä»¶com&#x2F;feiyu&#x2F;web&#x2F;helloworld&#x2F;helloWorld.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">hello</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello liuxuan&#x27;s Maven!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">hello</span>().sayHello());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å³é”®è¿è¡Œã€‚</p>
<p>ç›®å½•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">---pom.xmlã€€ã€€ã€€ã€€æ ¸å¿ƒé…ç½®ï¼Œé¡¹ç›®æ ¹ä¸‹</span><br><span class="line">---src</span><br><span class="line">ã€€ã€€---mainã€€ã€€ã€€ã€€ã€€ã€€</span><br><span class="line">ã€€ã€€ã€€   ---javaã€€ã€€ã€€ã€€javaæºç ç›®å½•</span><br><span class="line">ã€€ã€€     ---resourcesã€€  javaé…ç½®æ–‡ä»¶ç›®å½•</span><br><span class="line">ã€€ã€€---test</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€---javaã€€ã€€ã€€ã€€æµ‹è¯•æºç ç›®å½•</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€---resourcesã€€  æµ‹è¯•é…ç½®ç›®å½•</span><br><span class="line">---target    è¾“å‡ºç›®å½•</span><br></pre></td></tr></table></figure>

<h2 id="5-Mavenä»“åº“"><a href="#5-Mavenä»“åº“" class="headerlink" title="5.Mavenä»“åº“"></a>5.Mavenä»“åº“</h2><p>Maven ä»“åº“æ˜¯é¡¹ç›®ä¸­ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ï¼Œè¿™ä¸ªåº“æ‰€åœ¨çš„ä½ç½®å«åšä»“åº“ã€‚åœ¨ Maven ä¸­ï¼Œä»»ä½•ä¸€ä¸ªä¾èµ–ã€æ’ä»¶æˆ–è€…é¡¹ç›®æ„å»ºçš„è¾“å‡ºï¼Œéƒ½å¯ä»¥ç§°ä¹‹ä¸ºæ„ä»¶ã€‚Maven ä»“åº“èƒ½å¸®åŠ©æˆ‘ä»¬ç®¡ç†æ„ä»¶ï¼ˆä¸»è¦æ˜¯JARï¼‰ï¼Œå®ƒå°±æ˜¯æ”¾ç½®æ‰€æœ‰JARæ–‡ä»¶ï¼ˆWARï¼ŒZIPï¼ŒPOMç­‰ç­‰ï¼‰çš„åœ°æ–¹ã€‚</p>
<p>Maven ä»“åº“æœ‰ä¸‰ç§ç±»å‹ï¼š</p>
<ul>
<li>æœ¬åœ°ï¼ˆlocalï¼‰</li>
<li>ä¸­å¤®ï¼ˆcentralï¼‰</li>
<li>è¿œç¨‹ï¼ˆremoteï¼‰</li>
</ul>
<h3 id="a-æœ¬åœ°ä»“åº“"><a href="#a-æœ¬åœ°ä»“åº“" class="headerlink" title="a.æœ¬åœ°ä»“åº“"></a>a.æœ¬åœ°ä»“åº“</h3><p>ç¬¬ä¸€æ¬¡æ‰§è¡Œ maven å‘½ä»¤çš„æ—¶å€™æ‰è¢«åˆ›å»ºã€‚è¿è¡Œ Maven çš„æ—¶å€™ï¼ŒMaven æ‰€éœ€è¦çš„ä»»ä½•æ„ä»¶éƒ½æ˜¯ç›´æ¥ä»æœ¬åœ°ä»“åº“è·å–çš„ã€‚å¦‚æœæœ¬åœ°ä»“åº“æ²¡æœ‰ï¼Œå®ƒä¼šé¦–å…ˆå°è¯•ä»è¿œç¨‹ä»“åº“ä¸‹è½½æ„ä»¶è‡³æœ¬åœ°ä»“åº“ï¼Œç„¶åå†ä½¿ç”¨æœ¬åœ°ä»“åº“çš„æ„ä»¶ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ç®¡Linuxè¿˜æ˜¯ Windowsï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ç”¨æˆ·ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ªè·¯å¾„åä¸º .m2&#x2F;respository&#x2F; çš„ä»“åº“ç›®å½•ã€‚</p>
<p>å¯ä»¥ä¿®æ”¹é»˜è®¤ä½ç½®ï¼Œæ”¹å˜settings.xmlä¸­çš„é…ç½®ã€‚<br><code>&lt;localRepository&gt;C:/MyLocalRepository&lt;/localRepository&gt;</code></p>
<h3 id="b-ä¸­å¤®ä»“åº“"><a href="#b-ä¸­å¤®ä»“åº“" class="headerlink" title="b.ä¸­å¤®ä»“åº“"></a>b.ä¸­å¤®ä»“åº“</h3><p>Maven ä¸­å¤®ä»“åº“æ˜¯ç”± Maven ç¤¾åŒºæä¾›çš„ä»“åº“ï¼Œå…¶ä¸­åŒ…å«äº†å¤§é‡å¸¸ç”¨çš„åº“ã€‚</p>
<p>ä¸­å¤®ä»“åº“åŒ…å«äº†ç»å¤§å¤šæ•°æµè¡Œçš„å¼€æºJavaæ„ä»¶ï¼Œä»¥åŠæºç ã€ä½œè€…ä¿¡æ¯ã€SCMã€ä¿¡æ¯ã€è®¸å¯è¯ä¿¡æ¯ç­‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç®€å•çš„Javaé¡¹ç›®ä¾èµ–çš„æ„ä»¶éƒ½å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½åˆ°ã€‚</p>
<p>ä¸­å¤®ä»“åº“çš„å…³é”®æ¦‚å¿µï¼š</p>
<ul>
<li>è¿™ä¸ªä»“åº“ç”± Maven ç¤¾åŒºç®¡ç†ã€‚</li>
<li>ä¸éœ€è¦é…ç½®ã€‚</li>
<li>éœ€è¦é€šè¿‡ç½‘ç»œæ‰èƒ½è®¿é—®ã€‚</li>
</ul>
<p>è¦æµè§ˆä¸­å¤®ä»“åº“çš„å†…å®¹ï¼Œmaven ç¤¾åŒºæä¾›äº†ä¸€ä¸ª URLï¼š<a href="http://search.maven.org/#browse%E3%80%82%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E4%BB%93%E5%BA%93%EF%BC%8C%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E5%8F%AF%E4%BB%A5%E6%90%9C%E7%B4%A2%E6%89%80%E6%9C%89%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E7%9A%84%E4%BB%A3%E7%A0%81%E5%BA%93%E3%80%82">http://search.maven.org/#browseã€‚ä½¿ç”¨è¿™ä¸ªä»“åº“ï¼Œå¼€å‘äººå‘˜å¯ä»¥æœç´¢æ‰€æœ‰å¯ä»¥è·å–çš„ä»£ç åº“ã€‚</a></p>
<h3 id="c-è¿œç¨‹ä»“åº“"><a href="#c-è¿œç¨‹ä»“åº“" class="headerlink" title="c.è¿œç¨‹ä»“åº“"></a>c.è¿œç¨‹ä»“åº“</h3><p>ä¸­å¤®ä»“åº“æ˜¯ä¸€äº›å¸¸ç”¨çš„åº“ï¼Ÿè¿œç¨‹ä»“åº“æ˜¯å¼€å‘äººå‘˜è‡ªå·±å®šåˆ¶ä»“åº“ï¼ŒåŒ…å«äº†æ‰€éœ€è¦çš„ä»£ç åº“æˆ–è€…å…¶ä»–å·¥ç¨‹ä¸­ç”¨åˆ°çš„ jar æ–‡ä»¶ã€‚</p>
<h3 id="d-Mavenä¾èµ–æœç´¢é¡ºåº"><a href="#d-Mavenä¾èµ–æœç´¢é¡ºåº" class="headerlink" title="d.Mavenä¾èµ–æœç´¢é¡ºåº"></a>d.Mavenä¾èµ–æœç´¢é¡ºåº</h3><ul>
<li><strong>æ­¥éª¤ 1</strong> ï¼ åœ¨æœ¬åœ°ä»“åº“ä¸­æœç´¢ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œæ‰§è¡Œæ­¥éª¤ 2ï¼Œå¦‚æœæ‰¾åˆ°äº†åˆ™æ‰§è¡Œå…¶ä»–æ“ä½œã€‚</li>
<li><strong>æ­¥éª¤ 2</strong> ï¼ åœ¨ä¸­å¤®ä»“åº“ä¸­æœç´¢ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¿œç¨‹ä»“åº“å·²ç»è®¾ç½®ï¼Œåˆ™æ‰§è¡Œæ­¥éª¤ 4ï¼Œå¦‚æœæ‰¾åˆ°äº†åˆ™ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“ä¸­ä»¥å¤‡å°†æ¥å¼•ç”¨ã€‚</li>
<li><strong>æ­¥éª¤ 3</strong> ï¼ å¦‚æœè¿œç¨‹ä»“åº“æ²¡æœ‰è¢«è®¾ç½®ï¼ŒMaven å°†ç®€å•çš„åœæ»å¤„ç†å¹¶æŠ›å‡ºé”™è¯¯ï¼ˆæ— æ³•æ‰¾åˆ°ä¾èµ–çš„æ–‡ä»¶ï¼‰ã€‚</li>
<li><strong>æ­¥éª¤ 4</strong> ï¼ åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªè¿œç¨‹ä»“åº“ä¸­æœç´¢ä¾èµ–çš„æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°åˆ™ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“ä»¥å¤‡å°†æ¥å¼•ç”¨ï¼Œå¦åˆ™ Maven å°†åœæ­¢å¤„ç†å¹¶æŠ›å‡ºé”™è¯¯ï¼ˆæ— æ³•æ‰¾åˆ°ä¾èµ–çš„æ–‡ä»¶ï¼‰ã€‚</li>
</ul>
<h3 id="e-æ›´æ¢Mavené˜¿é‡Œäº‘ä»“åº“"><a href="#e-æ›´æ¢Mavené˜¿é‡Œäº‘ä»“åº“" class="headerlink" title="e.æ›´æ¢Mavené˜¿é‡Œäº‘ä»“åº“"></a>e.æ›´æ¢Mavené˜¿é‡Œäº‘ä»“åº“</h3><p>Mavenæ ¹ç›®å½•ä¸‹ï¼Œconfæ–‡ä»¶å¤¹ä¸‹setting.xmlæ–‡ä»¶ï¼ŒmirrorsèŠ‚ç‚¹ä¸Šä¿®æ”¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;mirrors&gt;</span><br><span class="line">  &lt;mirror&gt;</span><br><span class="line">    &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">    &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">    &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;</span><br><span class="line">    &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">  &lt;/mirror&gt;</span><br><span class="line">&lt;/mirrors&gt;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼špom.xmlæ–‡ä»¶é‡Œæ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;repositories&gt;  </span><br><span class="line">        &lt;repository&gt;  </span><br><span class="line">            &lt;id&gt;alimaven&lt;/id&gt;  </span><br><span class="line">            &lt;name&gt;aliyun maven&lt;/name&gt;  </span><br><span class="line">            &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;  </span><br><span class="line">            &lt;releases&gt;  </span><br><span class="line">                &lt;enabled&gt;true&lt;/enabled&gt;  </span><br><span class="line">            &lt;/releases&gt;  </span><br><span class="line">            &lt;snapshots&gt;  </span><br><span class="line">                &lt;enabled&gt;false&lt;/enabled&gt;  </span><br><span class="line">            &lt;/snapshots&gt;  </span><br><span class="line">        &lt;/repository&gt;  </span><br><span class="line">&lt;/repositories&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-Mavenå‘½ä»¤"><a href="#6-Mavenå‘½ä»¤" class="headerlink" title="6.Mavenå‘½ä»¤"></a>6.Mavenå‘½ä»¤</h2><p><code>maven -version   Mavenç‰ˆæœ¬åŠæ§åˆ¶ä¿¡æ¯</code></p>
<p><code>mvn archetype:create  -DgroupId=   DartifactId=   æ„å»ºjavaé¡¹ç›®</code>   </p>
<p><code>mvn archetype:create  -DgroupId=   DartifactId=   -DarchetypeArtifactId=maven-archetype-webapp lsåˆ›å»ºwebé¡¹ç›®</code></p>
<p><code>mvn compile     ç¼–è¯‘æºä»£ç </code>     </p>
<p><code>mvn test-compile    ç¼–è¯‘æµ‹è¯•ä»£ç </code></p>
<p><code>mvn clean   æ‰“åŒ…å‰æ¸…ç†æ‰ä¹‹å‰æœ‰è¿‡æ‰“åŒ…çš„æ–‡ä»¶å¤¹target</code></p>
<p><code>mvn package  æ‰“åŒ…ï¼ŒpackageåŒ…æ‹¬äº†ç¼–è¯‘ã€æ‰“åŒ…è¿™ä¸¤æ­¥</code>    </p>
<p>![image-20210825113016694](&#x2F;Users&#x2F;liuxuan14&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210825113016694.png)</p>
<p><code>mvn install   å°†æ‰“åŒ…å¥½çš„jaråŒ…éƒ¨ç½²åˆ°æœ¬åœ°ï¼Œæ”¾åˆ°æœ¬åœ°ä»“åº“</code> </p>
<h2 id="7-è¿è¡ŒjaråŒ…"><a href="#7-è¿è¡ŒjaråŒ…" class="headerlink" title="7.è¿è¡ŒjaråŒ…"></a>7.è¿è¡ŒjaråŒ…</h2><p><code>java -jar ideamaven-1.0-SNAPSHOT.jar</code></p>
<p>é—®é¢˜ï¼š<code>ideamaven-1.0-SNAPSHOT.jarä¸­æ²¡æœ‰ä¸»æ¸…å•å±æ€§</code></p>
<p>è§£å†³ï¼šæ‰¾ä¸åˆ°<code>main</code>æ–¹æ³•ï¼Œéœ€è¦åœ¨<code>pom.xml</code>é…ç½®<code>main</code>æ–¹æ³•çš„ä½ç½®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--  æ·»åŠ mainæ–¹æ³•   --&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.2.1&lt;/version&gt;</span><br><span class="line">  &lt;executions&gt;</span><br><span class="line">    &lt;execution&gt;</span><br><span class="line">      &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">      &lt;goals&gt;</span><br><span class="line">        &lt;goal&gt;shade&lt;/goal&gt;</span><br><span class="line">      &lt;/goals&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;transformers&gt;</span><br><span class="line">          &lt;transformer implementation=&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;&gt;</span><br><span class="line">            &lt;!-- åœ¨è¿™é‡ŒæŒ‡å®šå…¥å£ç±» --&gt;</span><br><span class="line">            &lt;mainClass&gt;com.liuxuan.hello&lt;/mainClass&gt;</span><br><span class="line">          &lt;/transformer&gt;</span><br><span class="line">        &lt;/transformers&gt;</span><br><span class="line">      &lt;/configuration&gt;</span><br><span class="line">    &lt;/execution&gt;</span><br><span class="line">  &lt;/executions&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure>

<p>mvnæ‰“åŒ…å’ŒjaråŒ…è¿è¡Œé—®é¢˜æœªè§£å†³ã€‚</p>
<p>é—®é¢˜ï¼š<code>Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.0:compile (default-compile) on project ideamaven: Compilation failure</code></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://console.cloud.baidu-int.com/devops/icode/repos/baidu/netdisk/platform-idproducter/reviews/18480257/files/base...latest/service/create_service.go">https://console.cloud.baidu-int.com/devops/icode/repos/baidu/netdisk/platform-idproducter/reviews/18480257/files/base...latest/service/create_service.go</a></p>
<p><a href="https://blog.csdn.net/wfy2695766757/article/details/81189291">https://blog.csdn.net/wfy2695766757/article/details/81189291</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>mybatiså…¥é—¨</title>
    <url>/2022/03/12/myblog/java/Mybatis%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p><strong>mybatis</strong></p>
<h3 id="â›½ï¸ç¬¬ä¸€è¯¾"><a href="#â›½ï¸ç¬¬ä¸€è¯¾" class="headerlink" title="â›½ï¸ç¬¬ä¸€è¯¾"></a>â›½ï¸ç¬¬ä¸€è¯¾</h3><p>âœ…å¼€å‘æ­¥éª¤ï¼š</p>
<p>1.æ·»åŠ Mybatisçš„åæ ‡ã€mysqlçš„é©±åŠ¨ï¼ˆpom.xmlä¸­ï¼‰</p>
<p>2.åˆ›å»ºæ•°æ®è¡¨ã€ç¼–å†™å¯¹åº”çš„å®ä½“ç±»ï¼ˆæ“ä½œå®ä½“ä»è€Œé—´æ¥æ“ä½œè¡¨ï¼ŒæŸ¥è¯¢è¡¨ä»è€Œé—´æ¥å°è£…å®ä½“ï¼‰</p>
<p>3.ç¼–å†™æ˜ å°„æ–‡ä»¶UserMapper.xml  ä¸»è¦æè¿°sqlæ–‡ä»¶ï¼ˆç¬¬ä¸€ä¸ªç‚¹ï¼šnamespaceå‘½åç©ºé—´ï¼Œç¬¬äºŒä¸ªç‚¹ï¼šidå’ŒresultTypeï¼Œé€šè¿‡å‘½åç©ºé—´.idè¿›è¡Œè°ƒç”¨ï¼ŒresultTypeç»“æœé›†ï¼Œå°è£…åˆ°æŒ‡å®šçš„ç±»å‹ä¸­ï¼‰</p>
<p>4.ç¼–å†™æ ¸å¿ƒæ–‡ä»¶sqlMapConfig.xmlï¼Œé…ç½®mybatisæ ¸å¿ƒå†…å®¹çš„ï¼Œé…ç½®æ•°æ®æºä¿¡æ¯ã€åŠ è½½æ˜ å°„æ–‡ä»¶ï¼ˆå¯èƒ½å¾ˆå¤šï¼‰ã€‚</p>
<p>5.ç¼–å†™æµ‹è¯•ç±»ï¼ˆ1.è·å–æ ¸å¿ƒé…ç½®æ–‡ä»¶ 2.è·å¾—sessionå·¥å‚å¯¹è±¡ 3.è·å¾—sessionä¼šè¯å¯¹è±¡ 4.æ‰§è¡Œæ“ä½œ 5.æ‰“å°æ•°æ® 6.é‡Šæ”¾èµ„æºï¼‰</p>
<p>mybatisæ˜ å°„æ–‡ä»¶ï¼š </p>
<p><img src="https://img-blog.csdnimg.cn/6779525e71d546109fea38a2120c0479.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAamFkZWxsbGx4eHg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="Pasted Graphic.tiff"></p>
<p>DTDçº¦æŸå¤´åœ¨å†™æ ‡ç­¾æˆ–è€…å±æ€§æ—¶èƒ½ç»™æç¤ºã€‚</p>
<p>âœ…ä»€ä¹ˆæ˜¯mybatisï¼Ÿ</p>
<p>æ˜¯apacheçš„ä¸€ä¸ªå¼€æºé¡¹ç›®iBatisï¼Œ2010å¹´è¿ç§»åˆ°google codeï¼Œæ”¹åä¸ºmybatisï¼Œ2013å¹´è¿ç§»åˆ°githubã€‚</p>
<p>Mybatisæ˜¯ä¸€ä¸ªå®ç°äº†æ•°æ®æŒä¹…åŒ–çš„å¼€æºæ¡†æ¶ï¼Œç®€å•ç†è§£å°±æ˜¯å¯¹JDBCè¿›è¡Œå°è£…ã€‚</p>
<p>ORMappingï¼šObject Relationship Mapping å¯¹è±¡å…³ç³»æ˜ å°„</p>
<p>å¯¹è±¡ï¼šé¢å‘å¯¹è±¡</p>
<p>å…³ç³»ï¼šå…³ç³»å‹æ•°æ®åº“</p>
<p>æ˜ å°„ï¼šjavaåˆ°mysqlçš„æ˜ å°„ï¼Œå¼€å‘è€…ä»¥é¢å‘å¯¹è±¡çš„æ€æƒ³æ¥ç®¡ç†æ•°æ®åº“ã€‚</p>
<p>âœ…mybatisä¼˜ç¼ºç‚¹</p>
<p>ä¼˜ç‚¹ï¼š</p>
<p>1âƒ£ï¸ä¸JDBCç›¸æ¯”ï¼Œå‡å°‘50%ä»£ç é‡</p>
<p>2âƒ£ï¸æœ€ç®€å•çš„æŒä¹…åŒ–æ¡†æ¶ï¼Œå°å·§ç®€å•</p>
<p>3âƒ£ï¸çµæ´»ï¼Œä¸ä¼šå¯¹ç¨‹åºæˆ–æ•°æ®åº“çš„ç°æœ‰è®¾è®¡å¼ºè¡ŒåŠ ä»»ä½•å½±å“ï¼Œsqlå†™åœ¨xmlä¸­ï¼Œä»ç¨‹åºä»£ç ä¸­å½»åº•åˆ†ç¦»ï¼Œè§£è€¦åˆï¼Œå¯é‡ç”¨ã€‚</p>
<p>4âƒ£ï¸æä¾›xmlæ ‡ç­¾ï¼Œæ”¯æŒç¼–å†™åŠ¨æ€sqlè¯­å¥ã€‚</p>
<p>5âƒ£ï¸æä¾›æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡çš„å±æ€§ä¸æ•°æ®åº“çš„ORMå­—æ®µå…³ç³»æ˜ å°„ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>1âƒ£ï¸åŠè‡ªåŠ¨çš„ï¼Œsqlè¯­å¥ç¼–å†™å·¥ä½œé‡å¤§</p>
<p>2âƒ£ï¸ä¾èµ–äºæ•°æ®åº“ï¼Œæ•°æ®åº“è¿ç§»æ€§å·®ã€‚</p>
<p>âœ…Mybatisæ ¸å¿ƒæ¥å£å’Œç±»</p>
<p>javaå’ŒMybatisçš„è¿æ¥è€…ï¼šsqlsession</p>
<p>SqlSessionFactoryBuilderæ¥å£ build()æ–¹æ³•ã€‚å¾—åˆ°SqlSessionFactoryï¼ˆå·¥å‚å¯¹è±¡ï¼‰ã€‚è°ƒç”¨openSession()æ–¹æ³•ï¼Œè·å¾—SqlSessionã€‚</p>
<p>âœ…Mybatisçš„å¼€å‘æ–¹å¼</p>
<p>1âƒ£ï¸ä½¿ç”¨åŸç”Ÿæ¥å£</p>
<p>2âƒ£ï¸Mapperä»£ç†å®ç°è‡ªå®šä¹‰æ¥å£</p>
<p>ä¸¤ç§æ–¹æ³•éƒ½æ˜¯é€šè¿‡sqlsessionçš„ç›¸å…³æ–¹æ³•æ¥å®Œæˆçš„ã€‚</p>
<p>âœ…åˆ›å»ºç¬¬ä¸€ä¸ªmybatisé¡¹ç›®</p>
<p>1âƒ£ï¸æ–°å»ºä¸€ä¸ªmavené¡¹ç›®</p>
<p>pom.xmlæ–‡ä»¶ï¼šå¢åŠ mybatisåæ ‡org.mybatis. mysqlé©±åŠ¨</p>
<p>â“pom.xmlä¸­åŠ å…¥ä¾èµ–æ˜¾çº¢æ€ä¹ˆåŠï¼Ÿ</p>
<p>è§£å†³ï¼šé¦–å…ˆåˆ é™¤.mæ–‡ä»¶å¤¹ä¸‹çš„repoæ–‡ä»¶å¤¹ï¼Œç„¶åå›åˆ°é¡¹ç›®å³é”®pom.xmlï¼Œé€‰mavenï¼Œé€‰reimport</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2âƒ£ï¸æ–°å»ºè¡¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> database mybatis;</span><br><span class="line"><span class="keyword">create table</span> account(</span><br><span class="line"> id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line"> username <span class="type">varchar</span>(<span class="number">11</span>),</span><br><span class="line"> password <span class="type">varchar</span>(<span class="number">11</span>),</span><br><span class="line"> age <span class="type">int</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>3âƒ£ï¸æ–°å»ºæ•°æ®è¡¨å¯¹åº”çš„å®ä½“ç±»</p>
<p>è¿™é‡Œç”¨Lombokåº“ï¼Œç”¨æ¥è‡ªåŠ¨ç”Ÿæˆæ„é€ æ–¹æ³•.ç±»çº§åˆ«çš„ @Data æ³¨é‡Šæ˜¯ç”± Lombok æä¾›çš„ï¼Œå®ƒå‘Šè¯‰ Lombok ç”Ÿæˆæ‰€æœ‰ç¼ºå°‘çš„æ–¹æ³•ï¼Œä»¥åŠæ¥å—æ‰€æœ‰finalå±æ€§ä½œä¸ºå‚æ•°çš„æ„é€ å‡½æ•°ã€‚</p>
<p>åŠ lombokä¾èµ–æ—¶ï¼Œæœ‰é”™è¯¯ï¼Œå› ä¸ºç‰ˆæœ¬å·çš„åŸå› ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String password;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>4âƒ£ï¸åˆ›å»ºmybatisé…ç½®æ–‡ä»¶ config.xml æ–‡ä»¶åå¯è‡ªå®šä¹‰ï¼Œå»ºåœ¨resourceæ–‡ä»¶å¤¹ä¸­</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">â€‹    <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- é…ç½®Mybatisè¿è¡Œç¯å¢ƒ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">â€‹    <span class="comment">&lt;!-- ä¸‹é¢å¯ä»¥å¤šä¸ªenvironmentï¼Œä½†æ˜¯ä¸Šé¢é€‰ä¸€ä¸ª --&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">â€‹      <span class="comment">&lt;!-- é…ç½®jdbcäº‹åŠ¡ç®¡ç† --&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">â€‹      <span class="comment">&lt;!--POOLEDé…ç½®JDBCæ•°æ®æºè¿æ¥æ±  --&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;xuan&quot;</span>/&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jade&quot;</span>/&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>5âƒ£ï¸ä½¿ç”¨åŸç”Ÿæ¥å£çš„æ–¹å¼å¼€å‘</p>
<p>ï¼ˆ1ï¼‰Mybatisæ¡†æ¶éœ€è¦å¼€å‘è€…è‡ªå®šä¹‰sqlè¯­å¥ï¼Œå†™åœ¨Mapper.xmlæ–‡ä»¶ä¸­ï¼Œå®é™…å¼€å‘ä¸­ï¼Œä¼šä¸ºæ¯ä¸ªå®ä½“ç±»åˆ›å»ºå¯¹åº”çš„Mapper.xmlï¼Œå®šä¹‰ç®¡ç†è¯¥å¯¹è±¡æ•°æ®çš„SQLã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">â€‹    <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- namespaceæ˜¯mybatisåŠ è½½é…ç½®æ–‡ä»¶æ—¶è¦æ‰¾çš„è·¯å¾„ï¼ˆåŒ…+æ–‡ä»¶åçš„å½¢å¼ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">  idæ˜¯ä¸€ä¼šå„¿è°ƒç”¨sqlè¯­å¥æ—¶è¦ç”¨çš„åå­—ï¼Œè‡ªå®šä¹‰çš„.</span></span><br><span class="line"><span class="comment">  parameterTypeæ˜¯è¦ä¼ å…¥çš„å‚æ•°,ä¸‹é¢è¯­å¥æ˜¯ä»å¯¹è±¡ä¸­å–å€¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.demo.mybatis.mapper.AccountMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;save&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span>&gt;</span></span><br><span class="line">â€‹    insert into account(username, password, age) values(#&#123;username&#125;, #&#123;password&#125;, #&#123;age&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰åœ¨å…¨å±€é…ç½®æ–‡ä»¶config.xmlä¸­æ³¨å†ŒAccountMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ³¨å†ŒAccountMapper.xmlï¼ŒåŠ è½½æ˜ å°„æ–‡ä»¶ï¼Œè¿™é‡Œå¸¦åç¼€ï¼Œæ‰€ä»¥ç”¨è·¯å¾„/ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/demo/mybatis/mapper/AccountMapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰è°ƒç”¨mybatisçš„åŸç”Ÿæ¥å£æ‰§è¡Œæ·»åŠ æ“ä½œï¼Œå†™æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.demo.mybatis.entity.Account;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInsert</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="comment">//åŠ è½½mybatisé…ç½®æ–‡ä»¶config.xml</span></span><br><span class="line">â€‹    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> TestInsert.class.getClassLoader().getResourceAsStream(<span class="string">&quot;config.xml&quot;</span>); <span class="comment">//å˜æˆä¸€ä¸ªæµ</span></span><br><span class="line">â€‹    <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">â€‹    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(inputStream); <span class="comment">//ä¼ å…¥æµ</span></span><br><span class="line">â€‹    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">â€‹    <span class="comment">//ç„¶åå°±å¯ä»¥è¿›è¡Œjavaå’Œmysqlçš„å…³è”ï¼Œç»“åˆnamespaceå’Œidè·å–ä½ç½®</span></span><br><span class="line">â€‹    <span class="comment">//å› ä¸ºé…ç½®æ–‡ä»¶å·²ç»åŠ è½½åˆ°ç¯å¢ƒä¸­ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä¸‹é¢æ‰¾åˆ°</span></span><br><span class="line">â€‹    <span class="type">String</span> <span class="variable">statement</span> <span class="operator">=</span> <span class="string">&quot;com.demo.mybatis.mapper.AccountMapper.save&quot;</span>;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="comment">//ä¼ å‚æ•°éœ€è¦å¯¹è±¡ï¼Œå› æ­¤éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">â€‹    <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>(<span class="number">1L</span>, <span class="string">&quot;liu&quot;</span>, <span class="string">&quot;hello&quot;</span>, <span class="number">12</span>);</span><br><span class="line">â€‹    sqlSession.insert(statement, account);</span><br><span class="line">â€‹    <span class="comment">//commitæ–¹æ³•æäº¤äº‹åŠ¡</span></span><br><span class="line">â€‹    sqlSession.commit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â“å‡ºç°é—®é¢˜ï¼Œæ˜æ˜å·²ç»æœ‰lombokï¼Œå¯æ˜¯åœ¨å¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™è¿˜æ˜¯æœ‰é—®é¢˜ã€‚</p>
<p>è§£å†³ï¼šæ·»åŠ æ’ä»¶ï¼šè®¾ç½®é‡Œæ‰¾åˆ°pluginsï¼Œæœç´¢lombok pluginï¼Œå®‰è£…ï¼Œé‡å¯ã€‚å‹¾é€‰é…ç½®ï¼šsettingâ€“&gt;build,excecution,deploymentâ€“&gt;compilerâ€“&gt;annotation processorså‹¾é€‰ä¸Š enable annotation processingã€‚å³å¯ç”Ÿæ•ˆã€‚</p>
<p>âš ï¸mavenå·¥ç¨‹ä¸­ä¸èƒ½ç›´æ¥è¯»å–resourceä»¥å¤–çš„xmlæ–‡ä»¶ï¼Œå¾—åœ¨pomé‡ŒåŠ ä¸€ä¸ªé…ç½®</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>â“java.lang.ClassNotFoundException: Cannot find class: com.mysql.cj.jdbc</p>
<p>è§£å†³ï¼š<property name="driver" value="com.mysql.cj.jdbc.Driver"/> å°‘å†™äº†Driver</p>
<p>ğŸ‰Success</p>
<h3 id="â›½ï¸ç¬¬äºŒè¯¾"><a href="#â›½ï¸ç¬¬äºŒè¯¾" class="headerlink" title="â›½ï¸ç¬¬äºŒè¯¾"></a>â›½ï¸ç¬¬äºŒè¯¾</h3><p>âœ…ä½¿ç”¨Mapperä»£ç†å®ç°è‡ªå®šä¹‰æ¥å£</p>
<p>å®é™…å¼€å‘ä¸­æ¨èç”¨è¿™ç§ã€‚</p>
<p>Mapperæ˜¯mybatiså†…éƒ¨æä¾›çš„ç»„å»ºï¼Œæ¥å£æ˜¯å¼€å‘è€…è‡ªå·±å†™ï¼Œæ¥å£çš„å®ç°ç±»æ˜¯ç”±mybatisåŠ¨æ€ç”Ÿæˆå®ç°ç±»ï¼ŒåŒæ—¶è·å–å®ç°ç±»çš„å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ç”¨ã€‚</p>
<p>1âƒ£ï¸è‡ªå®šä¹‰æ¥å£ï¼Œå®šä¹‰ç›¸å…³çš„ä¸šåŠ¡æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.mybatis.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.demo.mybatis.entity.Account;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountRepository</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">save</span><span class="params">(Account account)</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Account account)</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">  <span class="keyword">public</span> List&lt;Account&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">public</span> Account <span class="title function_">findById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2âƒ£ï¸ç¼–å†™ä¸æ¥å£ç›¸å¯¹åº”çš„Mapper.xmlï¼Œå®šä¹‰æ¥å£æ–¹æ³•å¯¹åº”çš„sqlè¯­å¥ã€‚</p>
<p>statementæ ‡ç­¾ï¼ˆå¦‚<code>&lt;insert&gt;</code>ï¼‰å¯æ ¹æ®sqlæ‰§è¡Œçš„ä¸šåŠ¡é€‰æ‹©insertã€deleteã€updateã€selectã€‚</p>
<p>Mybatisä¼šè‡ªåŠ¨æ ¹æ®è§„åˆ™è‡ªåŠ¨åˆ›å»ºæ¥å£å®ç°ç±»çš„ä»£ç†å¯¹è±¡ã€‚</p>
<p>è§„åˆ™ï¼š</p>
<ol>
<li>Mapper.xmlä¸­namespaceä¸ºæ¥å£çš„å…¨ç±»åã€‚</li>
<li>Mapper.xmlä¸­statementçš„idä¸ºæ¥å£ä¸­å¯¹åº”çš„æ–¹æ³•åã€‚</li>
<li>Mapper.xmlä¸­statementçš„parameterTypeå’Œæ¥å£ä¸­å¯¹åº”æ–¹æ³•çš„å‚æ•°ç±»å‹ä¸€è‡´ã€‚</li>
<li>Mapper.xmlä¸­statementçš„resultTypeå’Œæ¥å£ä¸­å¯¹åº”çš„æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ä¸€è‡´ã€‚</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">â€‹    <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.demo.mybatis.repository.AccountRepository&quot;</span>&gt;</span>  <span class="comment">&lt;!-- æ˜ å°„ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;save&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span>&gt;</span></span><br><span class="line">â€‹    <span class="comment">&lt;!-- æ·»åŠ  ä¿®æ”¹ åˆ é™¤ ä¸‰ä¸ªæ“ä½œåœ¨æ•°æ®åº“è¿”å›çš„ç»“æœä¸€å®šæ˜¯intï¼Œ æ‰€ä»¥è¿™é‡Œæ²¡æœ‰resultTypeå±æ€§ --&gt;</span></span><br><span class="line">â€‹    insert into account(username, password, age) values(#&#123;username&#125;, #&#123;password&#125;, #&#123;age&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span>&gt;</span></span><br><span class="line">â€‹    update account set username = #&#123;username&#125;, password = #&#123;password&#125;, age = #&#123;age&#125; where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">â€‹    delete from account where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span>&gt;</span></span><br><span class="line">â€‹    <span class="comment">&lt;!-- ä¸å†™é›†åˆç±»å‹ï¼Œè€Œå†™é›†åˆé‡Œçš„æ³›å‹ç±»å‹ --&gt;</span></span><br><span class="line">â€‹    select * from account</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;long&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span>&gt;</span></span><br><span class="line">â€‹    select * from account where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3âƒ£ï¸åœ¨config.xmlä¸­æ³¨å†ŒAccountRepository.xml</p>
<p><code>&lt;mappers&gt;</code></p>
<p>  <code>&lt;mapper resource=&quot;com/demo/mybatis/mapper/AccountMapper.xml&quot;&gt;&lt;/mapper&gt;</code></p>
<p>  <code>&lt;!-- æ³¨å†Œç¬¬äºŒè¯¾ä¸­çš„AccountRepository.xml --&gt;</code></p>
<p>  <code>&lt;mapper resource=&quot;com/demo/mybatis/repository/AccountRepository.xml&quot;&gt;&lt;/mapper&gt;</code></p>
<p><code>&lt;/mappers&gt;</code></p>
<p>4âƒ£ï¸æµ‹è¯•</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">â€‹    <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- é…ç½®Mybatisè¿è¡Œç¯å¢ƒ ,é…ç½®æ•°æ®æºä¿¡æ¯--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">â€‹    <span class="comment">&lt;!-- ä¸‹é¢å¯ä»¥å¤šä¸ªenvironmentï¼Œä½†æ˜¯ä¸Šé¢é€‰ä¸€ä¸ª --&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">â€‹      <span class="comment">&lt;!-- é…ç½®jdbcäº‹åŠ¡ç®¡ç† --&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">â€‹      <span class="comment">&lt;!--POOLEDé…ç½®JDBCæ•°æ®æºè¿æ¥æ±  --&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;xuan&quot;</span>/&gt;</span></span><br><span class="line">â€‹        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jade&quot;</span>/&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- æ³¨å†ŒAccountMapper.xmlï¼ŒåŠ è½½æ˜ å°„æ–‡ä»¶ï¼Œè¿™é‡Œå¸¦åç¼€ï¼Œæ‰€ä»¥ç”¨è·¯å¾„/ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/demo/mybatis/mapper/AccountMapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">â€‹    <span class="comment">&lt;!-- æ³¨å†Œç¬¬äºŒè¯¾ä¸­çš„AccountRepository.xml --&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/demo/mybatis/repository/AccountRepository.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ğŸ¤”æˆ‘å¯¹åŠ¨æ€ä»£ç†çš„ç†è§£ï¼š</p>
<p>è‡ªå·±åªéœ€è¦å†™ä¸€ä¸ªç±»ï¼Œæ¡†æ¶ä¸ºæˆ‘åŠ¨æ€ä»£ç†å®ç°æ¥å£çš„å®ç°ç±»ï¼Œå¹¶ä¸”è¿˜ç»™æˆ‘å®ç°ç±»çš„å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ç”¨ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ç§æ–¹æ³•ï¼Œç¡®å®æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è‡ªå·±å†™statementï¼Œä½†æ˜¯è¯´çš„è‡ªå·±å†™æ¥å£å®ç°ç±»ï¼Ÿæ²¡æœ‰å§</p>
<h3 id="â›½ï¸ç¬¬ä¸‰è¯¾"><a href="#â›½ï¸ç¬¬ä¸‰è¯¾" class="headerlink" title="â›½ï¸ç¬¬ä¸‰è¯¾"></a>â›½ï¸ç¬¬ä¸‰è¯¾</h3><p>Mapper.xmlè§£è¯»</p>
<ol>
<li><p>statementæ ‡ç­¾ï¼Œselectã€updateã€deleteã€insertåˆ†åˆ«å¯¹åº”æŸ¥è¯¢ã€ä¿®æ”¹ã€åˆ é™¤ã€æ·»åŠ </p>
</li>
<li><p>parameterTypeï¼šå‚æ•°æ•°æ®ç±»å‹</p>
<p>A. åŸºæœ¬æ•°æ®ç±»å‹ï¼Œé€šè¿‡idæŸ¥è¯¢Account,  â€œlongâ€</p>
<p>b. Stringç±»å‹ï¼Œé€šè¿‡nameæŸ¥è¯¢Accountï¼Œâ€java.lang.Stringâ€</p>
<p>C. åŒ…è£…ç±»ï¼Œé€šè¿‡idæŸ¥è¯¢Accountã€‚â€œjava.lang.longâ€</p>
</li>
</ol>
<p>â€‹     {ç”¨åŒ…è£…ç±»çš„å¥½å¤„ï¼šåŸºæœ¬æ•°æ®ç±»å‹æ¥å—ä¸äº†nullï¼Œnullä¼ è¿›æ¥æŠ¥å¼‚å¸¸ï¼Œä¸šåŠ¡ä¸­å¯èƒ½ä¼šæœ‰nullï¼Œéœ€è¦åˆ¤æ–­}</p>
<p>   D.å¤šä¸ªå‚æ•°ï¼Œé€šè¿‡usernameå’ŒageæŸ¥è¯¢account</p>
<p>â€‹     âš ï¸ï¼šå¦‚æœè¿”å›ç»“æœå¯èƒ½å¤šä¸ªï¼Œå°±å¾—Listã€‚å¥½åƒå¤šä¸ªæ“ä½œcommitä¸€æ¬¡å°±è¡Œå§ã€‚</p>
<p>   e.java bean</p>
<p>â€‹    updateæ“ä½œä¼ å…¥çš„accountå¯¹è±¡</p>
<ol>
<li><p>resultTypeç»“æœç±»å‹</p>
<p>A. åŸºæœ¬æ•°æ®ç±»å‹</p>
<p>B. åŒ…è£…ç±» java.lang.Integer</p>
<p>C. stringç±»å‹ï¼Œæ¯”å¦‚é€šè¿‡idæŸ¥è¯¢username</p>
</li>
</ol>
<p>  âš ï¸çœ‹åˆ°idæœ‰ä¸­æ–­ï¼Œè¿™æ˜¯å› ä¸ºä¹‹å‰ç¨‹åºæœ‰é”™å¼‚å¸¸äº†ï¼Œæ²¡commitæäº¤ï¼Œä½†æ˜¯idå·²ç»æ¶¨äº†ã€‚</p>
<p>   D. Java bean</p>
<p>â€‹    findAllè¿”å›çš„accountå¯¹è±¡</p>
<h3 id="â›½ï¸ç¬¬å››è¯¾"><a href="#â›½ï¸ç¬¬å››è¯¾" class="headerlink" title="â›½ï¸ç¬¬å››è¯¾"></a>â›½ï¸ç¬¬å››è¯¾</h3><p>âœ…åŠè”æŸ¥è¯¢</p>
<p>1âƒ£ï¸ä¸€å¯¹å¤šï¼Œä¸€ä¸ªç­å¯¹åº”å¤šä¸ªå­¦ç”Ÿ</p>
<p>è¦æŸ¥è¯¢id&#x3D;1çš„å­¦ç”Ÿçš„åå­—ã€ç­çº§</p>
<p>å»ºè¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create table</span> student(</span><br><span class="line"> id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">11</span>),</span><br><span class="line"> cid <span class="type">int</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create table</span> classes(</span><br><span class="line"> id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">11</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢è¯­å¥ï¼š <code>select * from student s, classes c where s.id =1 and s.cid=c.id;</code></p>
<p>ğŸ¤”é¦–å…ˆå»ºæ¥å£ï¼Œå†å†™xxxRepository.xml, å†æŠŠxmlæ–‡ä»¶åŠ è½½åˆ°configä¸­ã€‚ æµ‹è¯•ä»£ç ä¸­ï¼Œç”¨æ–¹æ³•å°±å¥½äº†ã€‚</p>
<p>ğŸmybatiså’Œjavaç±»æ€ä¹ˆåšåˆ°æ˜ å°„ï¼Œmybatisä¸å…³æ³¨è¡¨å’Œç±»çš„ç»“æ„ï¼Œå…³æ³¨çš„æ˜¯ç»“æœé›†å’Œç±»çš„æ˜ å°„ã€‚</p>
<p>ä»selectæŸ¥å‡ºæ¥çš„ç»“æœé›†ï¼Œåˆ°èµ‹ç»™resutlçš„ç»“æœçš„æ˜ å°„ã€‚ä»ç»“æœé›†é‡ŒæŒ‰é¡ºåºæ‰¾resultå¯¹çš„ä¸Šçš„å­—æ®µï¼Œèµ‹ç»™resultã€‚</p>
<p>åº”è¯¥ç»™åé¢çš„å–åˆ«åã€‚è¿™é‡Œå…³äºç­çº§çš„ä¿¡æ¯è¦èµ‹ç»™classeså¯¹è±¡ï¼Œéœ€è¦å»ºç«‹æ˜ å°„ï¼Œç”¨resultMapã€‚</p>
<p>æ³¨æ„æ˜ å°„çš„æ—¶å€™ï¼Œæ˜¯çœ‹è¿™ä¸ªæŸ¥è¯¢ç»“æœé›†ä¸Šé¢çš„å­—æ®µã€‚</p>
<p>è¿™æ ·å°±å®Œæˆäº†ï¼Œç»“æœç±» å’Œ ç»“æœé›†çš„æ˜ å°„</p>
<p>2âƒ£ï¸é€šè¿‡classesæŸ¥students</p>
<p>é€šè¿‡ç­çº§idï¼ŒæŸ¥å‡ºæ•´ä¸ªclassesç±».</p>
<p>é¦–å…ˆå†™æ¥å£ï¼Œå†å†™xmlæ–‡ä»¶ï¼Œxmlæ–‡ä»¶ä¸­å…ˆå†™sqlè¯­å¥ï¼Œå®Œæˆæ˜ å°„ï¼Œæ·»åŠ åˆ°configï¼Œæµ‹è¯•ã€‚</p>
<p>âš ï¸æ³¨æ„ç»“æœé›†è¦ç”¨resultMapï¼Œè¦è¿˜æ˜¯ç”¨resultTypeçš„è¯ï¼Œç›¸å½“äºå†™çš„æ˜ å°„æ²¡æœ‰ç”¨åˆ°ã€‚</p>
<p>3âƒ£ï¸å¤šå¯¹å¤š</p>
<p>æ¯”å¦‚è¯´ï¼Œå®¢æˆ·å’Œå•†å“ï¼Œè¿™ä¸¤ä¸ªæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚</p>
<p>customerè¡¨å’Œgoodsè¡¨ï¼Œä¸­é—´éœ€è¦å»ºä¸€ä¸ªä»è¡¨customer_goodsï¼Œé‡Œé¢cidè¡¨ç¤ºå®¢æˆ·è¡¨çš„å¤–é”®ï¼Œgidè¡¨ç¤ºå•†å“è¡¨çš„å¤–é”®ã€‚</p>
<p>customerç±»ä¸­ï¼Œæœ‰ä¸€ä¸ªgoodsé›†åˆ</p>
<p>goodsç±»ä¸­ï¼Œæœ‰ä¸€ä¸ªcustimeré›†åˆ</p>
<p>è¦åšçš„æ˜¯ï¼šæ ¹æ®customerçš„idï¼Œè¿”å›custimerç±»ã€‚</p>
<p><code>select c.id as cid, c.name as came, g.id as gid, g.name as gname from customer as c, goods as gï¼Œ customer_goods as cg where c.id=1 and cg.cid = c.id and cg.gid = g.id;</code> </p>
<p>è¿”å›id&#x3D;1çš„å®¢äººä¹°çš„å•†å“ã€‚</p>
<p>âš ï¸çŸ¥è¯†ç‚¹ï¼›ç¬›å¡å°”ç§¯ï¼Œéœ€è¦æ‰¾è¿™ä¸¤å¼ è¡¨çš„å…³è”å…³ç³»ï¼šç¬¬ä¸‰å¼ è¡¨.</p>
<p>æ ¹æ®ä¸€å¯¹å¤šæ¥å»ºç«‹å¤šå¯¹å¤šçš„æ˜ å°„å°±å¥½äº†ï¼Œä¸åŒä¹‹å¤„åœ¨å»sqlè¯­å¥ä¸­ä¸¤å¼ è¡¨å»ºç«‹å…³ç³»çš„æ–¹å¼æ˜¯é€šè¿‡ç¬¬ä¸‰å¼ è¡¨äº†ã€‚</p>
<p>ä½†æ˜¯xmlæ–‡ä»¶ä¸­æ„å»ºæ˜ å°„è¦çœ‹çš„æ˜¯sqlè¯­å¥è¿”å›ç»“æœé›†å’Œæ¥å£æ–¹æ³•è¦è¿”å›çš„è¿”å›ç±»å¯¹è±¡ã€‚</p>
<h3 id="â›½ï¸ç¬¬äº”è¯¾"><a href="#â›½ï¸ç¬¬äº”è¯¾" class="headerlink" title="â›½ï¸ç¬¬äº”è¯¾"></a>â›½ï¸ç¬¬äº”è¯¾</h3><p>âœ…é€†å‘å·¥ç¨‹</p>
<p>å¯¹ä¼ ç»Ÿå¼€å‘åå‘çš„ä¸€ä¸ªæ–¹å¼ã€‚</p>
<p>Mybatisæ¡†æ¶éœ€è¦ï¼šå®ä½“ç±»ã€è‡ªå®šä¹‰çš„Mapperæ¥å£ã€Mapper.xmlã€‚</p>
<p>ä¼ ç»Ÿçš„å¼€å‘ä¸­ï¼Œä¸Šè¿°çš„ä¸‰ä¸ªç»„ä»¶éœ€è¦å¼€å‘è€…æ‰‹åŠ¨åˆ›å»ºï¼Œé€†å‘å·¥ç¨‹å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨åˆ›å»ºè¿™ä¸‰ä¸ªç»„ä»¶ï¼Œå‡è½»å¼€å‘è€…çš„å·¥ä½œé‡ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚</p>
<p>ç¼ºç‚¹ï¼šé€†å‘å·¥ç¨‹åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œé€†å‘å·¥ç¨‹æ ¹æ®æ•°æ®è¡¨æ¥å»ºç«‹å®ä½“ç±»ç­‰ï¼Œå¦‚æœæ”¹äº†è¡¨ç»“æ„ï¼Œå°±éœ€è¦é‡æ–°æ‰§è¡Œä¸€æ¬¡é€†å‘å·¥ç¨‹ã€‚</p>
<p>å¦‚æœæ”¹äº†è¡¨ç»“æ„ï¼Œå°±éœ€è¦åˆ äº†å·²ç»å­˜åœ¨çš„ï¼Œé‡æ–°æ‰§è¡Œã€‚</p>
<p>&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p>å¦‚ä½•ä½¿ç”¨ï¼š</p>
<p>Mybatis Generatorï¼Œç®€ç§°MBGï¼Œæ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºMybatisæ¡†æ¶å¼€å‘è€…å®šåˆ¶çš„ä»£ç ç”Ÿæˆå™¨å’Œè‡ªåŠ¨ç”ŸæˆMybatisæ¡†æ¶æ‰€éœ€çš„å®ä½“ç±»ã€Mapperæ¥å£ã€Mapper.xmlï¼Œæ”¯æŒåŸºæœ¬CRUDæ“ä½œï¼Œä½†æ˜¯ä¸€äº›ç›¸å¯¹å¤æ‚çš„sqléœ€è¦å¼€å‘è€…è‡ªå·±æ¥å®Œæˆã€‚</p>
<p>1âƒ£ï¸æ–°å»ºMavenå·¥ç¨‹ï¼Œå¼•å…¥ä¾èµ–</p>
<p>æ•°æ®åº“å»ºä¸ªè¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table t_user(</span><br><span class="line"> id int primary key auto_increment,</span><br><span class="line"> name varchar(11),</span><br><span class="line"> age int</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>2âƒ£ï¸åˆ›å»ºMBGé…ç½®æ–‡ä»¶generatorConfig.xml</p>
<p> \1. jdbcConnection é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯</p>
<p> \2. javaModelGenerator é…ç½®javaBeançš„ç”Ÿæˆç­–ç•¥ï¼Œè¦æŠŠåˆ›å»ºçš„å®ä½“ç±»æ”¾åœ¨å“ªä¸ªåŒ…é‡Œ</p>
<p> \3. sqlMapGenerator é…ç½®sqlæ˜ å°„æ–‡ä»¶ç”Ÿæˆç­–ç•¥</p>
<p> \4. javaClientGenerator é…ç½®Mapperæ¥å£</p>
<p> \5. table é…ç½®ç›®æ ‡æ•°æ®è¡¨ï¼ˆtableNameï¼šè¡¨åï¼ŒdominObjectNameï¼šJavaBeanç±»åï¼‰</p>
<p>3âƒ£ï¸åˆ›å»ºGeneratoræ‰§è¡Œç±»</p>
<p>å¯åŠ¨ç±»mainï¼Œé‡Œé¢æ²¡æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œæ²¡ç†è§£åæ­£æ˜¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.MyBatisGenerator;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.xml.ConfigurationParser;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.exception.InvalidConfigurationException;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.exception.XMLParserException;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.internal.DefaultShellCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">â€‹    List&lt;String&gt;warings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">â€‹    <span class="type">boolean</span> <span class="variable">overwrite</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">â€‹    <span class="type">String</span> <span class="variable">genCig</span> <span class="operator">=</span> <span class="string">&quot;/generatorConfig.xml&quot;</span>; <span class="comment">// /å°±è¡¨ç¤ºresourceæ–‡ä»¶å¤¹</span></span><br><span class="line">â€‹    <span class="type">File</span> <span class="variable">configFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(Main.class.getResource(genCig).getFile()); <span class="comment">//è·å–è¿è¡Œæ—¶ç±»ï¼ŒgetResource(è·¯å¾„)ï¼Œè·å–é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">â€‹    <span class="type">ConfigurationParser</span> <span class="variable">configurationParser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationParser</span>(warings);</span><br><span class="line">â€‹    <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="keyword">try</span> &#123;</span><br><span class="line">â€‹      configuration = configurationParser.parseConfiguration(configFile);</span><br><span class="line">â€‹    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">â€‹      e.printStackTrace();</span><br><span class="line">â€‹    &#125; <span class="keyword">catch</span> (XMLParserException e) &#123;</span><br><span class="line">â€‹      e.printStackTrace();</span><br><span class="line">â€‹    &#125;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="type">DefaultShellCallback</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShellCallback</span>(overwrite);</span><br><span class="line">â€‹    <span class="type">MyBatisGenerator</span> <span class="variable">myBatisGenerator</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">â€‹    <span class="keyword">try</span> &#123;</span><br><span class="line">â€‹      myBatisGenerator = <span class="keyword">new</span> <span class="title class_">MyBatisGenerator</span>(configuration, callback, warings);</span><br><span class="line">â€‹    &#125; <span class="keyword">catch</span> (InvalidConfigurationException e) &#123;</span><br><span class="line">â€‹      e.printStackTrace();</span><br><span class="line">â€‹    &#125;</span><br><span class="line"></span><br><span class="line">â€‹    <span class="keyword">try</span> &#123;</span><br><span class="line">â€‹      myBatisGenerator.generate(<span class="literal">null</span>);</span><br><span class="line">â€‹    &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">â€‹      throwables.printStackTrace();</span><br><span class="line">â€‹    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">â€‹      e.printStackTrace();</span><br><span class="line">â€‹    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">â€‹      e.printStackTrace();</span><br><span class="line">â€‹    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>IDEAæŠ›å‡ºå¼‚å¸¸å¿«æ·é”®ï¼š</strong></p>
<p><strong>Mac</strong></p>
<p><strong>æ–¹å¼ä¸€ï¼ˆå…‰æ ‡ç§»åˆ°è¯¥ä»£ç è¡Œï¼Œoption+Enterï¼‰ï¼Œå¯ä»¥å¼‚å¸¸å¤–æŠ›å‡ºï¼Œä¹Ÿå¯ä»¥try-catchï¼š</strong></p>
<p><strong>æ–¹å¼äºŒï¼ˆå…‰æ ‡ç§»åˆ°è¯¥ä»£ç è¡Œï¼Œæˆ–è€…é€‰ä¸­è¯¥è¡Œä»£ç ï¼Œoption+command+Tï¼‰ï¼š[ä½¿ç”¨å…³é”®å­—æˆ–æ§åˆ¶è¯­å¥ï¼Œæ¯”å¦‚ifâ€¦else, tryâ€¦catch, for, synchronizedç­‰]</strong></p>
<p>4âƒ£ï¸<strong>ç„¶åè¿è¡Œmainæ–¹æ³•ï¼Œæ–‡ä»¶å¤¹ä¸‹ä»€ä¹ˆéƒ½æœ‰äº†ï¼Œè€Œä¸”æ ¹æ®æ•°æ®åº“çš„è¡¨å»ºç«‹äº†å®ä½“ç±»ã€‚</strong></p>
<h3 id="â›½ï¸ç¬¬å…­è¯¾"><a href="#â›½ï¸ç¬¬å…­è¯¾" class="headerlink" title="â›½ï¸ç¬¬å…­è¯¾"></a>â›½ï¸<strong>ç¬¬å…­è¯¾</strong></h3><p>âœ…<strong>å»¶è¿ŸåŠ è½½</strong></p>
<p><strong>ä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½ï¼Ÿä¹Ÿå«æ‡’åŠ è½½ã€æƒ°æ€§åŠ è½½</strong></p>
<p><strong>ä½¿ç”¨å»¶è¿ŸåŠ è½½å¯ä»¥æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œé’ˆå¯¹äºæ•°æ®çš„æŒä¹…å±‚çš„æ“ä½œã€‚åœ¨æŸäº›ç‰¹å®šçš„æƒ…å†µä¸‹å»è®¿é—®ç‰¹å®šçš„æ•°æ®åº“ï¼Œåœ¨å…¶ä»–æƒ…å†µä¸‹å¯ä»¥ä¸è®¿é—®æŸäº›è¡¨ï¼Œä»ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘äº†javaåº”ç”¨ä¸æ•°æ®åº“çš„äº¤äº’æ¬¡æ•°ã€‚</strong></p>
<p><strong>æ¯”å¦‚è¯´ä¸Šé¢åŠè”æŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢å­¦ç”Ÿå’Œç­çº§ï¼Œå­¦ç”Ÿå’Œç­çº§åœ¨ä¸¤å¼ ä¸åŒçš„è¡¨ï¼Œå¦‚æœå½“å‰çš„éœ€æ±‚åªéœ€è¦è·å–å­¦ç”Ÿçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæŸ¥è¯¢å­¦ç”Ÿå•è¡¨å³å¯ï¼Œå¦‚æœéœ€è¦é€šè¿‡å­¦ç”Ÿè·å–å¯¹åº”çš„ç­çº§ä¿¡æ¯ï¼Œåˆ™å¿…é¡»æŸ¥è¯¢ä¸¤å¼ è¡¨ã€‚</strong></p>
<p><strong>ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦æŸ¥è¯¢ä¸åŒçš„è¡¨ï¼Œæ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚æ¥åŠ¨æ€å‡å°‘æ•°æ®è¡¨æŸ¥è¯¢çš„å·¥ä½œå°±æ˜¯å»¶è¿ŸåŠ è½½ã€‚</strong></p>
<p><strong>ä¸¾ä¾‹ï¼šstudentå’Œclassesçš„ä¾‹å­é‡Œï¼Œä¸¤ä¸ªæ¥å£é‡Œéƒ½å¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œå„è‡ªé‡å†™xmlé‡Œé¢å¯¹åº”æ–°å¢æ–¹æ³•çš„sqlè¯­å¥ï¼Œselectè¯­å¥ä¸è”è¡¨æŸ¥è¯¢äº†ï¼Œå„æŸ¥å„çš„ï¼Œæµ‹è¯•æ—¶ï¼Œé¦–å…ˆå¾—åˆ°studentçš„åå­—ï¼Œå¦‚æœå¤Ÿäº†ï¼Œå°±ä¸ç”¨æŸ¥classesè¡¨äº†ï¼Œå¦‚æœä¸å¤Ÿï¼Œå†æ ¹æ®studentçš„cidè·å¾—classesç›¸å…³ä¿¡æ¯ã€‚</strong></p>
<p><strong>å› æ­¤è¦åœ¨é…ç½®æ–‡ä»¶é‡Œå®Œæˆä¸€ä¸ªè¿æ¥çš„æ“ä½œæ¥è‡ªåŠ¨è¯†åˆ«æ˜¯å¦è¿˜éœ€è¦æŸ¥å¦ä¸€å¼ è¡¨ï¼Œåœ¨</strong>associationä¸­ã€‚</p>
<p>å®è·µæ•ˆæœï¼šæ ¹æ®å­¦ç”Ÿidï¼ŒæŸ¥åˆ°å­¦ç”Ÿå®Œæˆä¿¡æ¯ï¼ŒåŒ…æ‹¬é‡Œé¢çš„Classesç±»ã€‚</p>
<p>å®é™…ä¸Šè¿›è¡Œäº†ä¸¤æ¬¡sqlæŸ¥è¯¢ï¼Œæœ¬èº«studentæ¥å£æ–¹æ³•è°ƒç”¨æŸ¥è¯¢ä¸€æ¬¡ï¼Œstudenté…ç½®æ–‡ä»¶ä¸­selectæ ‡ç­¾åˆæŸ¥ä¸€æ¬¡ã€‚</p>
<p>é€šè¿‡é…ç½®configæ–‡ä»¶ä¸­settingå¯ä»¥æ‰“å°sqlæ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<p>ä½†æ˜¯ï¼Œåªæ‹¿nameçš„è¯ï¼Œè¿˜æ˜¯æ‰§è¡Œä¸¤æ¬¡sqlã€‚å› æ­¤éœ€è¦åœ¨configä¸­å¼€å¯å»¶è¿ŸåŠ è½½ã€‚</p>
<p>å¥‡æ€ªäº†ï¼Œæˆ‘å¼€å¯äº†å»¶è¿ŸåŠ è½½ï¼Œåªè·å¾—studentçš„nameï¼Œè¿˜æ˜¯æŸ¥ä¸¤æ¬¡ã€‚</p>
<p>âš ï¸å‡ºç°é—®é¢˜ï¼ŒCannot enable lazy loading because CGLIB is not available. Add CGLIB to your classpath.</p>
<p>åº”è¯¥å¢åŠ CGLIBä¾èµ–ã€‚</p>
<p>â“ä¾èµ–é—²çº¢çš„æ—¶å€™ï¼Œå¿…é¡»è¦åˆ é™¤.m2æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ä¾èµ–ï¼Œç„¶åreimportå—ï¼Ÿ</p>
<h3 id="â›½ï¸ç¬¬ä¸ƒè¯¾"><a href="#â›½ï¸ç¬¬ä¸ƒè¯¾" class="headerlink" title="â›½ï¸ç¬¬ä¸ƒè¯¾"></a>â›½ï¸ç¬¬ä¸ƒè¯¾</h3><p>âœ…MyBatisç¼“å­˜</p>
<p>ä»€ä¹ˆäº‹mybatisç¼“å­˜ï¼Ÿä½¿ç”¨ç¼“å­˜å¯ä»¥å‡å°‘Javaåº”ç”¨ä¸æ•°æ®åº“çš„äº¤äº’æ¬¡æ•°ï¼Œä»è€Œæé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚æ¯”å¦‚æŸ¥è¯¢å‡ºid&#x3D;1çš„å¯¹è±¡ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢å‡ºä¹‹åä¼šè‡ªåŠ¨å°†è¯¥å¯¹è±¡ä¿å­˜åˆ°ç¼“å­˜ä¸­ï¼Œå½“ä¸‹ä¸€æ¬¡æŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­å–å‡ºå¯¹è±¡å³å¯ï¼Œæ— éœ€å†æ¬¡è®¿é—®æ•°æ®åº“ã€‚</p>
<p>Mybatisç¼“å­˜åˆ†ç±»ï¼š</p>
<ol>
<li><strong>ä¸€çº§ç¼“å­˜ï¼šSqlSessionçº§åˆ«ï¼Œé»˜è®¤å¼€å¯ï¼Œå¹¶ä¸”ä¸èƒ½å…³é—­ã€‚</strong></li>
</ol>
<p>  <strong>æ“ä½œæ•°æ®åº“æ—¶éœ€è¦åˆ›å»ºSqlSessionå¯¹è±¡ï¼Œåœ¨å¯¹è±¡ä¸­æœ‰ä¸€ä¸ªHashMapç”¨äºå­˜å‚¨ç¼“å­˜æ•°æ®ï¼Œä¸åŒçš„SqlSessionä¹‹é—´ç¼“å­˜æ•°æ®åŒºåŸŸæ˜¯äº’ä¸å½±å“çš„ã€‚</strong></p>
<p>  <strong>ä¸€çº§ç¼“å­˜çš„ä½œç”¨åŸŸæ˜¯SqlSessionèŒƒå›´çš„ï¼Œå½“åœ¨åŒä¸€ä¸ªSqlSessionä¸­æ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„SQLè¯­å¥æ—¶ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œæ¯•å°†ç»“æœä¿å­˜åˆ°ç¼“å­˜ä¸­ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ã€‚</strong></p>
<p>  <strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœSqlSessionæ‰§è¡Œäº†DMLæ“ä½œï¼ˆinsertã€updateã€deleteï¼‰ï¼ŒMybatiså¿…é¡»å°†ç¼“å­˜æ¸…ç©ºï¼Œæ¥ä¿è¯æ•°æ®çš„å‡†ç¡®æ€§ã€‚</strong></p>
<ol>
<li><strong>äºŒçº§ç¼“å­˜ï¼šMapperçº§åˆ«çš„ï¼Œé»˜è®¤å…³é—­ï¼Œå¯ä»¥å¼€å¯ã€‚</strong></li>
</ol>
<p>  <strong>ä½¿ç”¨äºŒçº§ç¼“å­˜æ—¶ï¼Œå¤šä¸ªSqlSessionä½¿ç”¨åŒä¸€ä¸ªMapperçš„sqlè¯­å¥æ“ä½œæ•°æ®åº“ï¼Œå¾—åˆ°çš„æ•°æ®ä¼šå­˜åœ¨äºŒçº§ç¼“å­˜ä¸­ï¼ŒåŒæ ·æ˜¯ä½¿ç”¨HashMapè¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œç›¸æ¯”è¾ƒä¸€çº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜çš„èŒƒå›´æ›´å¤§ï¼Œå¤šä¸ªsqlsessionå¯ä»¥å…±ç”¨äºŒçº§ç¼“å­˜ã€‚äºŒçº§ç¼“å­˜æ˜¯è·¨sqlsessionçš„ã€‚</strong></p>
<p>  <strong>äºŒçº§ç¼“å­˜æ˜¯å¤šä¸ªsqlsessionå…±äº«çš„ï¼Œå…¶ä½œç”¨åŸŸæ˜¯mapperçš„åŒä¸€ä¸ªnamespqceï¼Œä¸åŒçš„sqlsessionä¸¤æ¬¡æ‰§è¡Œç›¸åŒçš„namespaceä¸‹çš„sqlè¯­å¥ï¼Œå‚æ•°ä¹Ÿç›¸åŒï¼Œåˆ™ç¬¬ä¸€æ¬¡æ‰§è¡ŒæˆåŠŸä¹‹åä¼šå°†æ•°æ®ä¿å­˜åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼Œç¬¬äºŒæ¬¡å¯ç›´æ¥ä»äºŒçº§ç¼“å­˜ä¸­å–å‡ºæ•°æ®ã€‚</strong></p>
<p>âš ï¸<strong>ä¸€çº§ç¼“å­˜æ˜¯ä¸€ä¸ªsqlsessionä¸€ä¸ªç¼“å­˜ã€‚äºŒçº§ç¼“å­˜æ˜¯ä¸€ä¸ªmapperä¸€ä¸ªï¼Œå¤šä¸ªsqlsession å¯èƒ½æ˜¯ä½¿ç”¨çš„åŒä¸€mapperï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªnamespaceã€‚äºŒçº§ç¼“å­˜èŒƒå›´æ›´å¤§ã€‚</strong></p>
<p><strong>å¦‚ä½•å¼€å¯äºŒçº§ç¼“å­˜ï¼š</strong></p>
<p><strong>config.xmlä¸­</strong></p>
<p><code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</code></p>
<p><strong>ç„¶åå†å¯¹åº”çš„mapper.xmlä¸­ï¼Œæ·»åŠ é…ç½®äºŒçº§ç¼“å­˜</strong></p>
<p><code>&lt;cache&gt;&lt;/cache&gt;</code></p>
<p><strong>ç„¶åå®ä½“ç±»å®ç°åºåˆ—åŒ–æ¥å£</strong></p>
<p><code>public class Classes implements Serializable</code></p>
<ol>
<li><strong>ç¬¬ä¸‰æ–¹äºŒçº§ç¼“å­˜ã€‚éœ€è¦åœ¨pom.xmlé‡Œæ·»åŠ ç›¸å…³ä¾èµ–</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">   &lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;mybatis-ehcache&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><strong>ç„¶åæ·»åŠ é…ç½®æ–‡ä»¶ehcache.xml ä¸ç”¨è‡ªå·±å†™ï¼Œå®šä¹‰äº†ä¸€äº›äºŒçº§ç¼“å­˜çš„è®¾ç½®</strong></p>
<p><strong>ç„¶ååœ¨config.xmlä¸­å¼€å¯äºŒçº§ç¼“å­˜</strong></p>
<p><strong>ç„¶ååœ¨mapper.xmlä¸­é…ç½®äºŒçº§ç¼“å­˜</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;cache type=&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;&gt;</span><br><span class="line">  &lt;!-- ç¼“å­˜åˆ›å»ºä¹‹åï¼Œæœ€åä¸€æ¬¡è®¿é—®ç¼“å­˜çš„æ—¶é—´è‡³ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´é—´éš” --&gt;</span><br><span class="line">  &lt;property name=&quot;timeToIdleSeconds&quot; value=&quot;3600&quot;/&gt;</span><br><span class="line">  &lt;!-- ç¼“å­˜è‡ªåˆ›å»ºæ—¶é—´èµ·è‡³å¤±æ•ˆçš„æ—¶é—´é—´éš” --&gt;</span><br><span class="line">  &lt;property name=&quot;timeToLiveSeconds&quot; value=&quot;3600&quot;/&gt;</span><br><span class="line">  &lt;!-- ç¼“å­˜çš„å›æ”¶ç­–ç•¥ ,LRUç§»é™¤è¿‘æœŸä½¿ç”¨æœ€å°‘--&gt;</span><br><span class="line">  &lt;property name=&quot;memoryStoreEvictionPolicy&quot; value=&quot;LRU&quot;/&gt;</span><br><span class="line">&lt;/cache&gt;</span><br></pre></td></tr></table></figure>

<p><strong>è¿™ä¸ªç¼“å­˜é‡Œå®ä½“ç±»å†…ä¸éœ€è¦å®ç°åºåˆ—åŒ–æ¥å£</strong></p>
<h3 id="â›½ï¸ç¬¬å…«è¯¾-MybatisåŠ¨æ€sql"><a href="#â›½ï¸ç¬¬å…«è¯¾-MybatisåŠ¨æ€sql" class="headerlink" title="â›½ï¸ç¬¬å…«è¯¾ MybatisåŠ¨æ€sql"></a>â›½ï¸<strong>ç¬¬å…«è¯¾ MybatisåŠ¨æ€sql</strong></h3><p><strong>sqlè¯­å¥æ˜¯åŠ¨æ€åˆ›å»ºçš„ï¼Œåªéœ€è¦å®šä¸€ä¸ªå¤§è‡´çš„æ ·å¼ï¼Œå®ƒä¼šæ ¹æ®å…·ä½“çš„å‚æ•°ã€å…·ä½“çš„ä¸šåŠ¡å»åŠ¨æ€ç”Ÿæˆä¸åŒçš„sqlã€‚</strong></p>
<p><strong>èƒŒæ™¯ï¼šä¸šåŠ¡æ¯”è¾ƒå¤æ‚æ—¶ï¼Œå¦‚æœéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»æ‹¼æ¥sqlè¯­å¥æ¥å®Œæˆæ“ä½œï¼Œæ•ˆç‡æ¯”è¾ƒä½è€Œä¸”å®¹æ˜“å‡ºé”™ã€‚</strong></p>
<p>â“<strong>å‘ç°testç±»é‡Œï¼Œç¬¬ä¸€è¡Œçš„åŠ è½½ç±»ä¸€ç›´æ˜¯ç¬¬ä¸€æ¬¡ç”¨çš„ï¼Œè¿™åˆç†å—ï¼Ÿ</strong></p>
<p><strong>ç”¨ä¸€ä¸ªaccountå¯¹è±¡æŸ¥accountå¯¹è±¡ï¼Œæ ¹æ®å¯¹è±¡çš„å››ä¸ªå‚æ•°å¯¹åº”æ”¾åˆ°sqlè¯­å¥ä¸­ï¼Œå¦‚æœä¼ å…¥çš„accountçš„ä¸€ä¸ªå‚æ•°æ²¡è®¾ç½®ï¼Œåˆ™ä¼ åˆ°sqlè¯­å¥é‚£é‡Œï¼Œè¿™ä¸ªå­—æ®µ&#x3D;nullã€‚ä¸€èˆ¬å°±æ²¡ç»“æœã€‚</strong></p>
<p><strong>åŠ¨æ€sqlï¼šåªéœ€è¦å†™ä¸€ä¸ªæ¨¡ç‰ˆï¼Œè®©ç¨‹åºè‡ªåŠ¨æ ¹æ®å±æ€§æ˜¯å¦æœ‰å€¼ï¼Œæ¥åŠ¨æ€å†³å®šæ˜¯å¦åŠ è¿™ä¸ªæ¡ä»¶ã€‚</strong></p>
<p><strong>å…¶å®å°±æ˜¯ä¸€ä¸ªif elseçš„æµç¨‹ï¼Œåˆ¤æ–­å¦‚æœä¸ºnullï¼Œå°±å¿½ç•¥æ‰ï¼Œä½¿å¾—æœ‰ç»“æœã€‚</strong></p>
<p><strong>ä½¿ç”¨åŠ¨æ€sqlçš„ä½œç”¨ï¼šå¯ç®€åŒ–ä»£ç çš„å¼€å‘ï¼Œå‡å°‘å¼€å‘è€…çš„å·¥ä½œé‡ï¼Œç¨‹åºå¯ä»¥è‡ªåŠ¨æ ¹æ®ä¸šåŠ¡å‚æ•°æ¥å†³å®šsalçš„ç»„æˆã€‚</strong></p>
<ul>
<li><strong>ifæ ‡ç­¾</strong></li>
</ul>
<p><strong>ï½ï½ï½ï½ï½</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByAccount1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  select * from account where</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != 0&quot;</span>&gt;</span></span><br><span class="line">â€‹    id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">â€‹    and username = #&#123;username&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span></span><br><span class="line">â€‹    and password = #&#123;password&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != 0&quot;</span>&gt;</span></span><br><span class="line">â€‹    age = #&#123;age&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>ä½†æ˜¯ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸ç»™ï¼Œå°±ä¼šå‡ºé”™ï¼Œå› ä¸ºç›´æ¥andåé¢çš„ï¼Œè¯­æ³•é”™è¯¯ã€‚</strong></p>
<p><strong>å°†ifæ ‡ç­¾çš„è¯­å¥ï¼Œæ”¾åœ¨whereæ ‡ç­¾é‡Œå°±å¯ä»¥äº†ã€‚</strong></p>
<p><strong>ifæ ‡ç­¾å¯ä»¥è‡ªåŠ¨æ ¹æ®è¡¨è¾¾å¼çš„ç»“æœæ¥å†³å®šæ˜¯å¦å°†å¯¹åº”çš„è¯­å¥æ·»åŠ åˆ°sqlä¸­ï¼Œå¦‚æœæ¡ä»¶ä¸æˆç«‹åˆ™ä¸æ·»åŠ ï¼Œå¦‚æœæ¡ä»¶æˆç«‹åˆ™æ·»åŠ ã€‚</strong></p>
<p><strong>whereæ ‡ç­¾å¯ä»¥è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦è¦åˆ é™¤è¯­å¥å—ä¸­çš„andå…³é”®å­—ï¼Œå¦‚æœç›‘æµ‹åˆ°whereç›´æ¥è·Ÿandæ‹¼æ¥ï¼Œåˆ™è‡ªåŠ¨åˆ é™¤andï¼Œé€šå¸¸æƒ…å†µä¸‹ if å’Œ whereç»“åˆä½¿ç”¨ã€‚</strong></p>
<ul>
<li><strong>chooseã€whenæ ‡ç­¾</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByAccount2&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  select * from account</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span> = <span class="string">&quot;id !=0 &quot;</span>&gt;</span></span><br><span class="line">â€‹        id = #&#123;id&#125;</span><br><span class="line">â€‹      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line"></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span> = <span class="string">&quot;username !=null &quot;</span>&gt;</span></span><br><span class="line">â€‹        username = #&#123;username&#125;</span><br><span class="line">â€‹      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line"></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span> = <span class="string">&quot;password !=null &quot;</span>&gt;</span></span><br><span class="line">â€‹        password = #&#123;password&#125;</span><br><span class="line">â€‹      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line"></span><br><span class="line">â€‹      <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span> = <span class="string">&quot;age !=0 &quot;</span>&gt;</span></span><br><span class="line">â€‹        age = #&#123;age&#125;</span><br><span class="line">â€‹      <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line"></span><br><span class="line">â€‹    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p><strong>trimæ ‡ç­¾ï¼štrimæ ‡ç­¾ä¸­çš„prefixå’Œsuffixå±æ€§ä¼šè¢«ç”¨äºç”Ÿæˆå®é™…çš„sqlè¯­å¥ï¼Œä¼šå’Œæ ‡ç­¾å†…éƒ¨çš„è¯­å¥è¿›è¡Œæ‹¼æ¥ï¼Œå¦‚æœè¯­å¥å‰åå‡ºç°äº†prefixOverridesæˆ–è€…suffixOverrideså±æ€§ä¸­æŒ‡å®šçš„å€¼ï¼ŒMybatisæ¡†æ¶ä¼šè‡ªåŠ¨å°†å…¶åˆ é™¤ã€‚</strong></p>
</li>
<li><p><strong>setæ ‡ç­¾ï¼šç”¨äºupdateæ“ä½œï¼Œä¼šè‡ªåŠ¨æ ¹æ®å‚æ•°æ¥é€‰æ‹©ç”Ÿæˆsqlè¯­å¥ã€‚</strong></p>
</li>
</ul>
<p><strong>updateä¼ å…¥çš„å¯¹è±¡ï¼Œå¦‚æœsetå±æ€§åªæœ‰ä¸€ä¸ªï¼Œç›¸å½“äºå…¶ä»–å±æ€§ä¸ä¼ å€¼ï¼Œå˜ä¸ºäº†nullæˆ–è€…0.</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.demo.mybatis.entity.Account&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  update account</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != 0&quot;</span>&gt;</span></span><br><span class="line">â€‹      id = #&#123;id&#125;</span><br><span class="line">â€‹    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">â€‹      and username = #&#123;username&#125;</span><br><span class="line">â€‹    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span></span><br><span class="line">â€‹      and password = #&#123;password&#125;</span><br><span class="line">â€‹    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">â€‹    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != 0&quot;</span>&gt;</span></span><br><span class="line">â€‹      age = #&#123;age&#125;</span><br><span class="line">â€‹    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">   where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>è¿™æ˜¯sqlæ‹¼æ¥å—ï¼Ÿ</strong></p>
<ul>
<li><strong>foreachæ ‡ç­¾</strong></li>
</ul>
<p><strong>foreachæ ‡ç­¾å¯ä»¥è¿­ä»£ç”Ÿæˆä¸€ç³»åˆ—å€¼ï¼Œè¿™ä¸ªæ ‡ç­¾ä¸»è¦ç”¨äºsqlçš„inè¯­å¥ã€‚</strong></p>
<p><code>private List&lt;Long&gt; ids;</code></p>
<p><code>List&lt;Long&gt; ids = new ArrayList&lt;Long&gt;();</code></p>
<p><strong>è¿˜å¾—åœ¨å®ä½“ç±»é‡Œå»ºä¸€ä¸ªListå—ï¼Ÿæ„Ÿè§‰ä¸å¤ªä¾¿åˆ©ã€‚</strong></p>
<p><code>&lt;select id=&quot;findByIds&quot; param&gt;</code></p>
<h3 id="â›½ï¸ç¬¬ä¹è¯¾-mybatis-é€šç”¨Mapper"><a href="#â›½ï¸ç¬¬ä¹è¯¾-mybatis-é€šç”¨Mapper" class="headerlink" title="â›½ï¸ç¬¬ä¹è¯¾ mybatis é€šç”¨Mapper"></a>â›½ï¸<strong>ç¬¬ä¹è¯¾ mybatis é€šç”¨Mapper</strong></h3><p><strong>è™½ç„¶æœ‰é€†å‘å·¥ç¨‹MBGï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œä½†æ˜¯entityæ”¹å˜ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚</strong></p>
<p>1âƒ£ï¸<strong>å»ºè¡¨</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create table</span> mapperdemo(</span><br><span class="line"> id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line"> username <span class="type">varchar</span>(<span class="number">11</span>),</span><br><span class="line"> password <span class="type">varchar</span>(<span class="number">11</span>),</span><br><span class="line"> age <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> mapperdemo (username, password, age) <span class="keyword">values</span></span><br><span class="line">(<span class="string">&#x27;liuxuan&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="number">23</span>),</span><br><span class="line">(<span class="string">&#x27;jade&#x27;</span>, <span class="string">&#x27;kk&#x27;</span>, <span class="number">22</span>),</span><br><span class="line">(<span class="string">&#x27;aks&#x27;</span>, <span class="string">&#x27;aa&#x27;</span>, <span class="number">12</span>);</span><br></pre></td></tr></table></figure>



<p>2âƒ£ï¸æ–°å»ºjavaå®ä½“ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.mybatis.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">//æœ‰å‚æ„é€ </span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span>  <span class="comment">//æ— å‚æ„é€ </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mapperdemo</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String password;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>
è€ƒè™‘åˆ°åŸºæœ¬æ•°æ®ç±»å‹åœ¨Javaç±»å‹ä¸­éƒ½æœ‰é»˜è®¤å€¼ï¼Œä¼šå¯¼è‡´mybatisåœ¨æ‰§è¡Œç›¸å…³æ“ä½œæ—¶å¾ˆéš¾åˆ¤æ–­å½“å‰å­—æ®µæ˜¯å¦ä¸ºnullã€‚å› æ­¤åœ¨mybatisç¯å¢ƒä¸‹ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»å‹ã€‚(ä¸Šé¢çš„ä½œåºŸ)



âœ…mapperæ³¨è§£é‡æ¥ï¼š

å‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/jintingbo/article/details/80517053



ä»mybatis3.4.0å¼€å§‹åŠ å…¥äº†@Mapperæ³¨è§£ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†ä¸å†å†™mapperæ˜ å°„æ–‡ä»¶

ç°åœ¨æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€æ˜“çš„mavené¡¹ç›®å»äº†è§£@Mapperæ³¨è§£çš„ä½¿ç”¨æ–¹å¼ï¼š



1âƒ£ï¸å»ºè¡¨ï¼š

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create table</span> <span class="keyword">user</span>(</span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">11</span>),</span><br><span class="line"> pwd <span class="type">varchar</span>(<span class="number">11</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> <span class="keyword">user</span> (name, pwd) <span class="keyword">values</span></span><br><span class="line">(<span class="string">&#x27;liuxuan&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;jade&#x27;</span>, <span class="string">&#x27;kk&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;aks&#x27;</span>, <span class="string">&#x27;aa&#x27;</span>);</span><br></pre></td></tr></table></figure>



2âƒ£ï¸å®ä½“ç±»

æ“ä½œä¹‹å‰ï¼Œä»githubä¸Šcloneä¸‹æ¥çš„é¡¹ç›®å‡ºç°é—®é¢˜

1.æ–‡ä»¶å·¦ä¸‹è§’æœ‰ä¸ªæ©™è‰²çš„å°æ—¶é’Ÿï¼Œå‡ºç°æ©™è‰²åŸå› ï¼šæ²¡æœ‰æ·»åŠ åˆ°mavenè§£å†³åŠæ³•ï¼šæ‰¾åˆ°é¡¹ç›®çš„xml,å¦‚æœæœ€å¤–å±‚æ²¡æœ‰xml,æ‰¾åˆ°æ¨¡å—é‡Œé¢å¯¹åº”çš„xml,å³é”®é€‰æ‹©Add as Maven project. å¯¼å…¥é€šè¿‡mavenå¯¼å…¥jarã€‚å°±è§£å†³äº†äº†ã€‚

2.é¡¹ç›®ä¾èµ–æ˜¯çº¢çš„ï¼Œå»mavenä»“åº“[Maven Repository: Search/Browse/Explore](https://mvnrepository.com/)ä¸‹ä¸‹æ¥ï¼Œæ”¾åœ¨.m2æ–‡ä»¶å¤¹ä¸‹ã€‚

3.æ²¡å¼„sdkï¼Œå¼„æˆjdk1.8

4.å¥‡äº†æ€ªäº†ï¼Œè¿™ä¸ªé¡¹ç›®é‡Œå®ä½“ç±»ç”¨Lombokï¼Œä¾èµ–æ˜¾çº¢ï¼Œæ‡µé€¼äº†ã€‚

5.pç©ºé—´æ˜¾çº¢çš„è§£å†³åŠæ³•ï¼šfile--&gt;settings...--&gt;languages &amp; frameworks--&gt;schemas and DTDs --&gt; æ·»åŠ url



3âƒ£ï¸åŠ è½½é…ç½®æ–‡ä»¶æ—¶æ‰¾ä¸åˆ°bean

ä¸çŸ¥é“å•¥åŸå› äº†ï¼Œåº”è¯¥æ˜¯mybatisç»“åˆspringï¼Œè¿™ä¸€ç‚¹è¿˜æ²¡æŒæ¡ã€‚



æ€»ä¹‹ï¼Œä½¿ç”¨æ–¹é¢ï¼Œä¸éœ€è¦åœ¨mapper.xmlé‡Œå†™sqlè¯­å¥ï¼Ÿ

æµ‹è¯•ç±»é‡Œç›´æ¥è°ƒç”¨daoæ¥å£é‡Œçš„æ–¹æ³•å³å¯ï¼Ÿ

ï¼ï¼ï¼é¡¹ç›®é‡Œè¿˜æ˜¯æœ‰sqlè¯­å¥çš„ï¼Œæ¥å£é‡Œç”¨@mapper @paramæ³¨è§£ï¼Œåªæ˜¯ä¼ é€’å‚æ•°ã€‚å’Œä¹‹å‰å­¦çš„ï¼Œåªæ˜¯åœ¨æ¥å£é‡Œå¤šäº†è¿™ä¿©æ³¨è§£ã€‚
</code></pre>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>Pageåˆ†é¡µ</title>
    <url>/2022/11/05/myblog/java/Page%E5%88%86%E9%A1%B5/</url>
    <content><![CDATA[<h2 id="springæ•´åˆmybatis"><a href="#springæ•´åˆmybatis" class="headerlink" title="springæ•´åˆmybatis"></a>springæ•´åˆmybatis</h2><p>æ–°å»ºä¸€ä¸ªå­å·¥ç¨‹web-repositoryã€‚</p>
<p>mybatisä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.1.35&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>é¡¹ç›®ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--web-repository</span><br><span class="line"> --src</span><br><span class="line">  --main</span><br><span class="line">   --java</span><br><span class="line">     --config</span><br><span class="line">       --SpringConfig.java</span><br><span class="line">     --domain</span><br><span class="line">       --StudentDO.java</span><br><span class="line">     --StudentDao.java</span><br><span class="line">   --resource</span><br><span class="line">     --mapper</span><br><span class="line">  --test</span><br></pre></td></tr></table></figure>

<p>âœ…springé…ç½®ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@ComponentScan(basePackages = &#123;&quot;org.example&quot;&#125;)</span><br><span class="line">public class SpringConfig &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦å¼•å…¥springä¾èµ–ã€‚</p>
<p>springé…ç½®ï¼š<a href="https://www.cnblogs.com/fengyupinglan/p/14517267.html">https://www.cnblogs.com/fengyupinglan/p/14517267.html</a></p>
<p>âœ…springæ•´åˆmybatis</p>
<p>é¦–å…ˆï¼Œspringé…ç½®æ–‡ä»¶å¯ä»¥æ˜¯xmlæ–‡ä»¶åœ¨resourceæ–‡ä»¶å¤¹ä¸‹ï¼Œä¹Ÿå¯ä»¥æ˜¯æ³¨è§£æ–¹å¼çš„javaæ–‡ä»¶ã€‚å…ˆå†™ä¸€ä¸ªspringé…ç½®æ–‡ä»¶ï¼Œè‡ªåŠ¨è£…é…æä¸Šå»ã€‚è¿˜æœ‰mybatisçš„ä¸€äº›beanè¦é…ç½®ä¸Šå»ã€‚</p>
<h3 id="xmlæ–¹å¼"><a href="#xmlæ–¹å¼" class="headerlink" title="xmlæ–¹å¼"></a>xmlæ–¹å¼</h3><p>xmlæ–‡ä»¶æ–¹å¼ï¼Œspring-mybatis.xml<br>å¼€å¯è‡ªåŠ¨æ‰«æå’Œé…ç½®bean</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å¼€å¯ç»„ä»¶æ‰«æ,æ‰«æå¤šä¸ªåŒ…ç”¨,éš”å¼€--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.example&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯Aspectç”Ÿæˆä»£ç†å¯¹è±¡ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--åŠ è½½propertiesæ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">ignore-unresolvable</span>=<span class="string">&#x27;true&#x27;</span> <span class="attr">location</span>=<span class="string">&#x27;classpath:dbconfig.properties&#x27;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 1.é…ç½®é˜¿é‡Œdruidè¿æ¥æ±  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®æ•°æ®åº“åŸºæœ¬ä¿¡æ¯ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.driverClassName&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.maxActive&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.initialSize&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2.é…ç½®springçš„æ•°æ®æºï¼Œå£°æ˜äº‹åŠ¡ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3.é…ç½® mybatisï¼Œæ‰«æmapper.xmlæ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 3.1 é…ç½® mybatis config --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 3.2 é…ç½®æ‰«æmybatisæ˜ å°„æ–‡ä»¶è·¯å¾„ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mapper/*.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4.ç±»ä¼¼äº jdbcTemplate å¸®åŠ©ç±» --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- è‡ªåŠ¨æ‰«æäº†æ‰€æœ‰çš„*Mapper.xmlå¯¹åº”çš„mapperæ¥å£æ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸ç”¨ä¸€ä¸ªä¸€ä¸ªæ‰‹åŠ¨é…ç½®Mapperçš„æ˜ å°„äº†ï¼Œåªè¦Mapperæ¥å£ç±»å’ŒMapperæ˜ å°„æ–‡ä»¶å¯¹åº”èµ·æ¥å°±å¯ä»¥äº†ã€‚ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.example.mysql&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>druidéœ€è¦ä¾èµ–åŒ…ï¼šdruid<br>SqlSessionFactoryBean éœ€è¦ä¾èµ–åŒ…ï¼šspring-jdbc<br>è¿˜éœ€è¦ ibatis-common</p>
<p>dbconfig.properties:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.url=jdbc:mysql://localhost:3306/test?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span><br><span class="line">db.driverClassName=com.mysql.cj.jdbc.Driver</span><br><span class="line">db.password=jade</span><br><span class="line">db.username=liuxuan</span><br><span class="line">db.maxActive=5</span><br><span class="line">db.initialSize=1</span><br></pre></td></tr></table></figure>

<p>mybatisé…ç½®æ–‡ä»¶ï¼Œmybatis-config.xml<br>ä¸€äº›configuration setting</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//ybatis.org//DTD SQL Map Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">setting</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useGeneratedKeys&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">setting</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultExecutorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;REUSE&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">setting</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">setting</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>xmlæ–¹å¼springæ•´åˆmybatisï¼Œmybatisé…ç½®é¡¹çš„æ„ä¹‰ï¼š<br><a href="https://blog.csdn.net/qq_45797116/article/details/117105095">https://blog.csdn.net/qq_45797116/article/details/117105095</a></p>
<p>xmlæ–‡ä»¶ä¸­å¦‚æœæƒ³å¼•å…¥å…¶ä»–xmlæ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;import resource=&quot;.../...xml&quot;/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨è§£æ–¹å¼"><a href="#æ³¨è§£æ–¹å¼" class="headerlink" title="æ³¨è§£æ–¹å¼"></a>æ³¨è§£æ–¹å¼</h3><p>æ³¨è§£æ–¹å¼ï¼ŒSpringConfig.java</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.mysql.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.ComponentScan;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.context.annotation.ImportResource;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@ComponentScan(basePackages = &#123;&quot;org.example&quot;&#125;)</span><br><span class="line">@ImportResource(&quot;classpath:spring-mybatis.xml&quot;) //å¯¼å…¥xmlé…ç½®é¡¹</span><br><span class="line">public class SpringConfig &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œå¯ä»¥ç”¨@Importå¯¼å…¥å…¶ä»–æ³¨è§£æ–¹å¼çš„é…ç½®æ–‡ä»¶ï¼Œä»¥åŠç”¨@ImportResourceå¯¼å…¥xmlæ–¹å¼çš„é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Import(CDPlayerConfig.class)  </span><br><span class="line">@ImportResource(&quot;classpath:cons-injec.xml&quot;) //å¯¼å…¥xmlé…ç½®é¡¹</span><br></pre></td></tr></table></figure>

<p>æ³¨è§£æ–¹å¼å€’å…¥é…ç½®æ–‡ä»¶ï¼š<br><a href="https://blog.csdn.net/weixin_42107384/article/details/116475637">https://blog.csdn.net/weixin_42107384/article/details/116475637</a></p>
<p>çº¯æ³¨è§£æ–¹å¼çš„æ•´åˆspringå’Œmybatisé…ç½®ï¼š<br><a href="https://blog.csdn.net/weixin_44226181/article/details/127343597">https://blog.csdn.net/weixin_44226181/article/details/127343597</a></p>
<p>è¿˜æœ‰ä¸€ä¸ªä¸€è¡Œä»£ç çš„åŸºäºæ³¨è§£æ•´åˆçš„ï¼š<br><a href="https://www.pudn.com/news/62f1dcb95425817ffc22c172.html">https://www.pudn.com/news/62f1dcb95425817ffc22c172.html</a></p>
<h3 id="æµ‹è¯•éªŒè¯"><a href="#æµ‹è¯•éªŒè¯" class="headerlink" title="æµ‹è¯•éªŒè¯"></a>æµ‹è¯•éªŒè¯</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example;</span><br><span class="line"></span><br><span class="line">public class StudentDaoTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testSelectById() &#123;</span><br><span class="line"></span><br><span class="line">        // xmlï¼š</span><br><span class="line">        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br><span class="line">        UserMapper mapper = (UserMapper) context.getBean(&quot;userMapper&quot;);</span><br><span class="line"></span><br><span class="line">        // æ³¨è§£ï¼š</span><br><span class="line">        ApplicationContext context =new AnnotationConfigApplicationContext(SpringConfig.class);</span><br><span class="line">        StudentDao studentDao = (StudentDao) context.getBean(&quot;studentDao&quot;);</span><br><span class="line"></span><br><span class="line">        StudentDO studentDO = studentDao.selectById(1L);</span><br><span class="line">        System.out.println(studentDO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•éªŒè¯åŠxmlä¸­é…ç½®SqlSessionFactoryçš„beanå’Œæ‰«æçš„beanï¼š<br><a href="https://blog.csdn.net/qq_28082757/article/details/103488364">https://blog.csdn.net/qq_28082757/article/details/103488364</a></p>
<p>é…ç½®æ•°æ®åº“è¿æ¥æ± æœ‰å‡ ç§æ–¹æ³•ï¼Œä¸Šé¢ç”¨çš„æ˜¯aliçš„druidè¿æ¥æ± ï¼Œå…³äºDruidè¿æ¥æ± ï¼š<br><a href="https://www.cnblogs.com/chy18883701161/p/12594889.html">https://www.cnblogs.com/chy18883701161/p/12594889.html</a></p>
<p>æ³¨è§£æ–¹å¼é…ç½®JdbcConfigä¸­ PlatformTransactionManager æ˜¯äº‹åŠ¡ç®¡ç†ï¼Œåœ¨spring-jdbcåŒ…ä¸‹ã€‚<br><a href="https://www.jianshu.com/p/903c01cb2a77">https://www.jianshu.com/p/903c01cb2a77</a></p>
<p>@Mapperæ³¨è§£ï¼Œéš¾é“æ˜¯spring-bootæ‰èƒ½ç”¨çš„ï¼Ÿ<br>mybatisæ”¯æŒçš„æ˜ å°„æ–¹å¼æœ‰åŸºäºxmlçš„mapper.xmlæ–‡ä»¶ã€åŸºäºjavaçš„ä½¿ç”¨Mapperæ¥å£classã€‚<br>ä»mybatis3.4.0å¼€å§‹åŠ å…¥äº†@Mapperæ³¨è§£ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†ä¸å†å†™mapperæ˜ å°„æ–‡ä»¶ã€‚<br><a href="https://blog.csdn.net/weixin_46369022/article/details/122755858">https://blog.csdn.net/weixin_46369022/article/details/122755858</a><br>éœ€è¦ä¾èµ–åŒ…ï¼šmybatis-spring-boot-starter</p>
<h3 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h3><p>âœ… @Valueé‡Œçš„å­—æ®µæŠ¥çº¢</p>
<p>åŸå› ï¼šè‡ªåŠ¨å¯¼å…¥äº†lomboké‡Œçš„@Valueï¼Œè¦ç”¨çš„æ˜¯SpringFrameworkä¸‹çš„@Valueã€‚</p>
<p>âœ… xmlé…ç½®æ–‡ä»¶åŠ è½½ä¸åˆ°propertieså±æ€§é—®é¢˜</p>
<p>åŸå› ï¼šspringä¸­æ²¡æœ‰æˆåŠŸåŠ è½½ç›¸åº”çš„é…ç½®æ–‡ä»¶</p>
<p>è§£å†³ï¼šè¿›å…¥File-Project Strucctureï¼Œè¿›å…¥Facetsä¸­è¿›è¡Œé…ç½®ï¼Œ.åœ¨å³è¾¹çš„springç›®å½•ä¸‹ï¼Œæ‰¾åˆ°å¯¹åº”çš„çˆ†çº¢é—®é¢˜æ‰€åœ¨é…ç½®æ–‡ä»¶ï¼Œé€‰æ‹©xmlæ–‡ä»¶ï¼Œç‚¹å‡»ä¿®æ”¹ç¬¦åˆï¼ˆä¸‹å›¾ä¸­çš„å°é“…ç¬”ï¼‰ï¼Œåœ¨è·³å‡ºæ¥çš„å¼¹æ¡†ä¸­ï¼Œé€‰æ‹©æ·»åŠ ï¼ˆåŠ å·ï¼‰ï¼Œç„¶åé€‰æ‹©Additioonal properties filesã€‚ç„¶åæ‰¾åˆ°éœ€è¦åŠ è½½è¿›springä¸­çš„é…ç½®æ–‡ä»¶ï¼Œç‚¹å‡»OKï¼Œæ·»åŠ æˆåŠŸã€‚</p>
<p>æ¥è‡ªï¼š<a href="https://blog.csdn.net/zhaogot/article/details/103224088">https://blog.csdn.net/zhaogot/article/details/103224088</a></p>
<p>âœ… xmlé…ç½®æ–‡ä»¶ä¸­çš„é—®é¢˜ï¼šæ ¹å…ƒç´  â€œbeansâ€ å¿…é¡»åŒ¹é… DOCTYPE æ ¹ â€œnullâ€</p>
<p>åœ¨<code>&lt;beans&gt;</code>æ ‡ç­¾é‚£é‡ŒæŠ¥å‡ºæ¥ã€‚</p>
<p>åŸå› ï¼šmybatisåœ¨æ‰«æMapper.xmlæ–‡ä»¶æ—¶ï¼Œæ‰«æåˆ°émapperæ–‡ä»¶ã€‚æ¯”å¦‚æœ¬æ¬¡æŠ¥é”™æ‰«æåˆ°äº†è‡ªå·±ã€‚spring.xmlçš„æ ¹å…ƒç´ æ˜¯<code>&lt;beans&gt;&lt;/beans&gt;</code>å½“ç„¶ä¸ä¼šæœ‰DOCTYPEäº†ã€‚<br>æ‰€ä»¥å½“Mybatisæ‰«æåˆ°äº†Spring.xmlè¿™ä¸ªéMapper.xmlæ–‡ä»¶æ—¶ï¼Œè‡ªç„¶æ‰¾ä¸åˆ°DOCTYPEï¼Œæ‰€ä»¥ä¼šæœ‰â€œDOCTYPE æ ¹ â€œnullâ€â€è¿™ä¸ªé”™è¯¯ã€‚</p>
<p>ç²—å¿ƒï¼šåº”è¯¥æ‰«çš„æ˜¯mybatis-config.xmlæ–‡ä»¶ï¼Œç»“æ„å†™æˆäº†è‡ªå·±ã€‚</p>
<p>æ¥è‡ªï¼š<a href="https://www.codeleading.com/article/7746743165/">https://www.codeleading.com/article/7746743165/</a></p>
<p>âœ… org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)</p>
<p>åŸå› ï¼šmapperæ¥å£å’Œxmlæ–‡ä»¶æ²¡åŒ¹é…ä¸Šï¼Œæœ‰å¯èƒ½æ˜¯æ–‡ä»¶åæ–¹æ³•åæ²¡åŒ¹é…ä¸Šï¼Œè¿™é‡Œæ˜¯åœ¨é…ç½®æ–‡ä»¶é‡Œæ²¡åŠ æ‰«ææ¥å£ï¼ŒåŠ äº†å°±å¥½äº†ã€‚</p>
<p><a href="https://blog.csdn.net/weixin_43570367/article/details/103147854">https://blog.csdn.net/weixin_43570367/article/details/103147854</a></p>
<p>âœ… propertiesæ–‡ä»¶ java.lang.NumberFormatException</p>
<p>æ˜æ˜æ˜¯æ•°å­—ç±»å‹ï¼Œä½†æ˜¯è¯´æˆ‘ä»Stringè½¬ä¸ºintå‘ç”Ÿå¼‚å¸¸ã€‚</p>
<p>éœ€è¦åœ¨xmlé…ç½®æ–‡ä»¶ä¸­åŠ è½½propertiesé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--åŠ è½½propertiesæ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">ignore-unresolvable</span>=<span class="string">&#x27;true&#x27;</span> <span class="attr">location</span>=<span class="string">&#x27;classpath:dbconfig.properties&#x27;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>springåŠ è½½propertiesæ–‡ä»¶çš„å‡ ç§æ–¹å¼ï¼š<br><a href="https://blog.csdn.net/chuige2013/article/details/121759088">https://blog.csdn.net/chuige2013/article/details/121759088</a></p>
<p>âœ… java.sql.SQLException: com.mysql.cj.jdbc.Driver</p>
<p>mysqlè¿æ¥é©±åŠ¨ä¾èµ–çš„ç‰ˆæœ¬ä¸åŒ¹é…é—®é¢˜ï¼Œä¸€èˆ¬å‡ºç°åœ¨ä½¿ç”¨ä½ç‰ˆæœ¬è¿æ¥é©±åŠ¨è¿æ¥é«˜ç‰ˆæœ¬mysqlæƒ…å†µä¸‹ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨mavenä¸­å¤®ä»“åº“ä¸­ä¸‹è½½é«˜ç‰ˆæœ¬çš„mysqlè¿æ¥é©±åŠ¨.</p>
<p>mysql-connector-java æ¢8.0.21çš„åŒ…ï¼Œè‡ªåŠ¨å¼•å…¥æ²¡æˆåŠŸï¼Œæ‰‹åŠ¨ä¸‹è½½è£…åˆ°.m2çš„ã€‚</p>
<p>âœ… init datasource error, url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8</p>
<p>db.urlæ¢æˆï¼š<code>jdbc:mysql://localhost:3306/mysql?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</code></p>
<p>âœ… Table â€˜mysql.studentâ€™ doesnâ€™t exist</p>
<p>ä¸Šé¢mysqlæ¢æˆåº“åã€‚</p>
<p>ğŸ˜„ç»ˆäºæˆåŠŸäº†ï¼Œä¸å®¹æ˜“ã€‚</p>
<h2 id="com-github-pagehelper"><a href="#com-github-pagehelper" class="headerlink" title="com.github.pagehelper"></a>com.github.pagehelper</h2><p>èƒŒæ™¯ï¼šä½¿ç”¨Pigeæ—¶ï¼Œä»æ•°æ®åº“ä¸­è·å–åˆ°listä¹‹åï¼ŒremoveIfç­›é€‰ï¼Œä½†æ˜¯åˆ†é¡µå¾—åˆ°çš„æ•ˆæœä¸å¯¹ï¼Œæ¡ç›®æ€»æ•°totalæ˜¯ä»æ•°æ®åº“å¾—åˆ°çš„list sizeã€‚</p>
<p>åŸå› ï¼šPageä¸Mybatiså¼ºè€¦åˆï¼Œä¸æ˜¯å…ˆä»æ•°æ®åº“è·å–å†åˆ†é¡µï¼Œè€Œæ˜¯å…ˆè·å–æŸé¡µè¦è·å–çš„æ¡ç›®ï¼Œè€¦åˆåˆ°sqlä¸­æŸ¥è¯¢ã€‚</p>
<p>éš¾é“åªèƒ½æ˜¯spring-bootç”¨çš„ï¼Ÿ pagehelper-spring-boot-starter ä¾èµ–åŒ…ä¸­ã€‚</p>
<p>PageHelperåˆ†é¡µï¼š<a href="https://blog.csdn.net/weixin_43958747/article/details/103822761">https://blog.csdn.net/weixin_43958747/article/details/103822761</a></p>
<p>å…¶ä¸­æœ‰ä¸ªå‚æ•°ä¸ºCallBackæ¥å£ã€‚</p>
<p>âš ï¸ä½¿ç”¨ä¸­çš„ä¸€ä¸ªcaseï¼š<br>Pageedä¸­çš„listçš„å…ƒç´ å¾—å’Œæ•°æ®åº“daoè¿”å›çš„æ•°æ®ç»“æ„ä¸€æ ·ï¼Œå¾—æ˜¯DOã€‚è·å–äº†Pagedä¹‹åå†è½¬ä¸ºvoï¼Œå› ä¸ºåˆ†é¡µPageå’Œmybatisæ˜¯å¼ºè€¦åˆçš„ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>macå®‰è£…å’Œé…ç½®javaç¯å¢ƒ</title>
    <url>/2021/08/25/myblog/java/MAC%E4%B8%8B%E5%AE%89%E8%A3%85java%E7%8E%AF%E5%A2%83/</url>
    <content><![CDATA[<h1 id="MACä¸‹javaç¯å¢ƒå®‰è£…"><a href="#MACä¸‹javaç¯å¢ƒå®‰è£…" class="headerlink" title="MACä¸‹javaç¯å¢ƒå®‰è£…"></a>MACä¸‹javaç¯å¢ƒå®‰è£…</h1><h2 id="1-ä¸‹è½½jdk8å¹¶ä¸”å®‰è£…"><a href="#1-ä¸‹è½½jdk8å¹¶ä¸”å®‰è£…" class="headerlink" title="1.ä¸‹è½½jdk8å¹¶ä¸”å®‰è£…"></a>1.ä¸‹è½½jdk8å¹¶ä¸”å®‰è£…</h2><p><code>java -version</code>çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰å®‰è£…</p>
<p>è‹¥æ²¡æœ‰ï¼Œ<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p>
<h2 id="2-é…ç½®javaç¯å¢ƒ"><a href="#2-é…ç½®javaç¯å¢ƒ" class="headerlink" title="2.é…ç½®javaç¯å¢ƒ"></a>2.é…ç½®javaç¯å¢ƒ</h2><p>æˆ‘ä»¬å¦‚æœè¦åœ¨terminalç»ˆç«¯ä¸Šä½¿JAVAå‘½ä»¤ï¼Œè¿˜æœ‰è®©å…¶å®åº”ç”¨çŸ¥é“JDK1.8ç¯å¢ƒçš„å­˜åœ¨ï¼Œé‚£æˆ‘ä»¬è¿˜éœ€è¦é…ç½®ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ã€‚</p>
<p>è®¿è¾¾ä¸­ï¼Œæ‰“å¼€èµ„æºåº“ï¼Œæ‰“å¼€javaï¼Œä¸‹é¢æœ‰jdkç›®å½•ã€‚</p>
<p><code>/Library/Java/JavaVirtualMachines/jdk1.8.0_192.jdk/Contents/Home</code>  å³é”®æ‰“å¼€ç»ˆç«¯</p>
<p>ç»ˆç«¯è¿è¡Œï¼š<code>sudo vim/etc/profile</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">JAVA_HOME=&quot;/Library/Java/JavaVirtualMachines/jdk1.8.0_192.jdk/Contents/Home&quot;</span><br><span class="line">export JAVA_HOME</span><br><span class="line">CLASS_PATH=&quot;$JAVA_HOME/lib&quot;</span><br><span class="line">PATH=&quot;.$PATH:$JAVA_HOME/bin&quot;</span><br></pre></td></tr></table></figure>

<p><code>source /etc/profile  //ä½¿é…ç½®ç”Ÿæ•ˆ</code></p>
<p><code>echo $JAVA_HOME //å¾—åˆ°é…ç½®çš„è·¯å¾„ï¼Œè¯´æ˜é…ç½®æˆåŠŸ</code></p>
<h2 id="3-vimä¸€ä¸ªjavaç¨‹åº"><a href="#3-vimä¸€ä¸ªjavaç¨‹åº" class="headerlink" title="3.vimä¸€ä¸ªjavaç¨‹åº"></a>3.vimä¸€ä¸ªjavaç¨‹åº</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ–‡ä»¶åéœ€è¦è·Ÿjavaæ–‡ä»¶ä¸­çš„ç±»åä¸€è‡´ï¼</span><br><span class="line">public class helloworld &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(&quot;Hello World&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">javac helloworld.java   //ç”Ÿæˆ.classå­—èŠ‚ç æ–‡ä»¶</span><br><span class="line">java helloworld    //è¿è¡Œ</span><br></pre></td></tr></table></figure>

<h3 id="4-java-IDE"><a href="#4-java-IDE" class="headerlink" title="4.java IDE"></a>4.java IDE</h3><p>å®˜ç½‘ä¸‹è½½ï¼š<a href="https://www.jetbrains.com/">https://www.jetbrains.com/</a></p>
<p>ä¸‹è½½ç ´è§£åŒ…ï¼Œä¿å­˜åœ¨ç™¾åº¦äº‘ä¸­äº†ã€‚</p>
<p>å®‰è£…IDEAï¼Œåœ¨æ³¨å†Œé¡µé¢ï¼Œé€‰æ‹© Evaluate for freeï¼Œç‚¹å‡» Evaluate è¯•ç”¨è½¯ä»¶</p>
<p>å°†ä¸‹è½½çš„ç ´è§£æ–‡ä»¶å¤¹ä¸­çš„ jetbrains-agent.jar æ–‡ä»¶æ‹–åŠ¨åˆ°è½¯ä»¶å†…ï¼Œç„¶åç‚¹å‡» Restart é‡å¯è½¯ä»¶</p>
<p>é‡å¯å®Œæˆä¹‹åï¼Œå¦‚æœå¼¹å‡ºäº†æ¿€æ´»æ–¹å¼ï¼Œé€‰æ‹© Activation codeï¼Œæ²¡æœ‰å¼¹å‡ºåˆ™ä¸ç”¨ç®¡ï¼Œå¤åˆ¶ç ´è§£æ–‡ä»¶ä¸­çš„ Activation codeï¼Œç„¶åé€‰æ‹©æ¿€æ´»ï¼Œé‡å¯è½¯ä»¶</p>
<p>é‡å¯è½¯ä»¶ï¼Œåœ¨ Get Help ä¸­ç‚¹å‡» About ï¼Œå¯ä»¥æŸ¥çœ‹æ¿€æ´»æƒ…å†µ</p>
<p><strong>ä¸å¾—è¡Œ</strong></p>
<p>æ›´æ–°ï¼š<a href="https://www.jianshu.com/p/bbc7cd207a85">https://www.jianshu.com/p/bbc7cd207a85</a></p>
<h3 id="5-ç”¨ideaçš„ç¬¬ä¸€ä¸ªjavaç¨‹åº"><a href="#5-ç”¨ideaçš„ç¬¬ä¸€ä¸ªjavaç¨‹åº" class="headerlink" title="5.ç”¨ideaçš„ç¬¬ä¸€ä¸ªjavaç¨‹åº"></a>5.ç”¨ideaçš„ç¬¬ä¸€ä¸ªjavaç¨‹åº</h3><p>![image-20210823173916506](&#x2F;Users&#x2F;liuxuan14&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210823173916506.png)</p>
<p>å³é”®è¿è¡Œã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>javaçš„junitä¸mockæµ‹è¯•</title>
    <url>/2022/04/14/myblog/java/java%20junit%E4%B8%8Emock%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<p>å•å…ƒæµ‹è¯•(Unit test)ï¼š<br>å•å…ƒæµ‹è¯•å…³æ³¨å•ä¸€çš„ç±». å®ƒä»¬å­˜åœ¨çš„ç›®çš„æ˜¯æ£€æŸ¥è¿™ä¸ªç±»ä¸­çš„ä»£ç æ˜¯å¦æŒ‰ç…§æœŸæœ›æ­£ç¡®è¿è¡Œ.<br>ç‰¹å¾ï¼šå¿«é€Ÿã€ç‹¬ç«‹ã€å¯é‡å¤ã€è‡ªæ£€æŸ¥ï¼ˆä¸åŠ mainä¸æ‰“æ—¥å¿—ï¼‰<br>æ ¸å¿ƒä»·å€¼ï¼šç¼©çŸ­åé¦ˆå‘¨æœŸï¼Œé™ä½ç¼ºé™·ä¿®å¤æˆæœ¬ï¼Œç†è§£ä»£ç æ„å›¾</p>
<p>é›†æˆæµ‹è¯•(Integration test)<br>é¡¾åæ€ä¹‰, é›†æˆæµ‹è¯•æ˜¯æ£€æŸ¥å¼€å‘çš„æ¨¡å—å’Œå…¶ä»–æ¨¡å—æ•´åˆæ—¶æ˜¯å¦æ­£å¸¸å·¥ä½œ.<br>è™½ç„¶é›†æˆæµ‹è¯•çš„ä»£ç å½±å“èŒƒå›´æ¯”å•å…ƒæµ‹è¯•è¦å¹¿, ä½†æ˜¯é›†æˆæµ‹è¯•å’Œå•å…ƒæµ‹è¯•ä¸€æ ·, ä¹Ÿæ˜¯é’ˆå¯¹äºå¼€å‘è€…è€Œè¨€çš„.<br>é›†æˆæµ‹è¯•æ˜¯å¯¹å¤–éƒ¨ç³»ç»Ÿï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰æœ‰ä¾èµ–çš„æµ‹è¯•ã€‚</p>
<p>ç«¯åˆ°ç«¯æµ‹è¯•(End-to-End test)<br>ç«¯åˆ°ç«¯æµ‹è¯•æ˜¯å°†æ•´ä¸ªç³»ç»Ÿä½œä¸ºä¸€ä¸ªæ•´ä½“, ç„¶åä»ç”¨æˆ·çš„è§’åº¦è¿›è¡Œæµ‹è¯•çš„.<br>ç«¯åˆ°ç«¯æµ‹è¯•çš„ç›®çš„æ˜¯æµ‹è¯•ç³»ç»Ÿåœ¨å®é™…ä½¿ç”¨çš„æ˜¯å¦æ­£å¸¸çš„, å› æ­¤é€šå¸¸æ¥è¯´æ˜¯ä¸éœ€è¦æµ‹è¯•æ›¿èº«çš„(Test Double)</p>
<h2 id="1-Junitå•å…ƒæµ‹è¯•"><a href="#1-Junitå•å…ƒæµ‹è¯•" class="headerlink" title="1.Junitå•å…ƒæµ‹è¯•"></a>1.Junitå•å…ƒæµ‹è¯•</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>å•å…ƒæµ‹è¯•çš„ç›®çš„: æµ‹è¯•å½“å‰æ‰€å†™çš„ä»£ç æ˜¯å¦æ˜¯æ­£ç¡®çš„, ä¾‹å¦‚è¾“å…¥ä¸€ç»„æ•°æ®, ä¼šè¾“å‡ºæœŸæœ›çš„æ•°æ®; è¾“å…¥é”™è¯¯æ•°æ®, ä¼šäº§ç”Ÿé”™è¯¯å¼‚å¸¸ç­‰.</p>
<p>åœ¨å•å…ƒæµ‹è¯•ä¸­, æˆ‘ä»¬éœ€è¦ä¿è¯è¢«æµ‹ç³»ç»Ÿæ˜¯ç‹¬ç«‹çš„(SUT æ²¡æœ‰ä»»ä½•çš„ DOC), å³å½“è¢«æµ‹ç³»ç»Ÿé€šè¿‡æµ‹è¯•æ—¶, é‚£ä¹ˆå®ƒåœ¨ä»»ä½•ç¯å¢ƒä¸‹éƒ½æ˜¯èƒ½å¤Ÿæ­£å¸¸å·¥ä½œçš„. ç¼–å†™å•å…ƒæµ‹è¯•æ—¶, ä»…ä»…éœ€è¦å…³æ³¨å•ä¸ªç±»å°±å¯ä»¥äº†. è€Œä¸éœ€è¦å…³æ³¨ä¾‹å¦‚æ•°æ®åº“æœåŠ¡, Web æœåŠ¡ç­‰ç»„ä»¶.</p>
<p>ã€SUTã€‘è¢«æµ‹ç³»ç»Ÿ(System under test, SUT) è¢«æµ‹ç³»ç»Ÿã€‚æ ¹æ®æµ‹è¯•ç±»å‹çš„ä¸åŒ, SUT æŒ‡ä»£çš„å†…å®¹ä¹Ÿä¸åŒ, ä¾‹å¦‚ SUT å¯ä»¥æ˜¯ä¸€ä¸ªç±»ç”šè‡³æ˜¯ä¸€æ•´ä¸ªç³»ç»Ÿ.</p>
<p>ã€DOCã€‘è¢«æµ‹ç³»ç»Ÿæ‰€ä¾èµ–çš„ç»„ä»¶, ä¾‹å¦‚è¿›ç¨‹ UserService çš„å•å…ƒæµ‹è¯•æ—¶, UserService ä¼šä¾èµ– UserDao, å› æ­¤ UserDao å°±æ˜¯ DOC</p>
<p>ã€Test Doubleã€‘æµ‹è¯•æ›¿èº«<br>ä¸€ä¸ªå®é™…çš„ç³»ç»Ÿä¼šä¾èµ–å¤šä¸ªå¤–éƒ¨å¯¹è±¡, ä½†æ˜¯åœ¨è¿›è¡Œå•å…ƒæµ‹è¯•æ—¶, æˆ‘ä»¬ä¼šç”¨ä¸€äº›åŠŸèƒ½è¾ƒä¸ºç®€å•çš„å¹¶ä¸”å…¶è¡Œä¸ºå’Œå®é™…å¯¹è±¡ç±»ä¼¼çš„å‡å¯¹è±¡æ¥ä½œä¸º SUT çš„ä¾èµ–å¯¹è±¡, ä»¥æ­¤æ¥é™ä½å•å…ƒæµ‹è¯•çš„å¤æ‚æ€§å’Œå¯å®ç°æ€§. åœ¨è¿™é‡Œ, è¿™äº›å‡å¯¹è±¡å°±è¢«ç§°ä¸º æµ‹è¯•æ›¿èº«(Test Double).</p>
<p>æµ‹è¯•æ›¿èº«æœ‰ä»¥ä¸‹äº”ç§ï¼š</p>
<p>1.Test stub, ä¸º SUT æä¾›æ•°æ®çš„å‡å¯¹è±¡ã€‚stub ç±»æœ‰æ—¶å€™è¿˜ä¼šè®°å½•è°ƒç”¨çš„ä¸€äº›ä¿¡æ¯ã€‚</p>
<p>2.Fake objectï¼Œå®ç°äº†ç®€å•åŠŸèƒ½çš„ä¸€ä¸ªå‡å¯¹è±¡. Fake object å’Œ Test stub çš„ä¸»è¦åŒºåˆ«å°±æ˜¯ Test stub ä¾§é‡äºç”¨äºæä¾›æ•°æ®çš„å‡å¯¹è±¡, è€Œ Fake object æ²¡æœ‰è¿™å±‚å«ä¹‰ï¼Œä½¿ç”¨ Fake object çš„æœ€ä¸»è¦çš„åŸå› å°±æ˜¯åœ¨æµ‹è¯•æ—¶æŸäº›ç»„ä»¶ä¸å¯ç”¨æˆ–è¿è¡Œé€Ÿåº¦å¤ªæ…¢, å› è€Œä½¿ç”¨ Fake object æ¥ä»£æ›¿å®ƒä»¬.<br>è­¬å¦‚è¯´ï¼Œå®ƒå­˜åœ¨å†…å­˜ä¸­è€Œä¸æ˜¯çœŸæ­£çš„æ•°æ®åº“ä¸­ã€‚</p>
<p>3.Mock object<br>æ˜¯æŒ‡ç±»æˆ–è€…æ¥å£çš„æ¨¡æ‹Ÿå®ç°ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªå¯¹è±¡ä¸­æŸä¸ªæ–¹æ³•çš„è¾“å‡ºç»“æœã€‚<br>å®é™…ä¸Š, Mock object æ˜¯ Test stub æˆ– Fake object ä¸€ç§, ä½†æ˜¯ Mock object æœ‰ Test stub&#x2F;Fake object æ²¡æœ‰çš„ç‰¹æ€§, Mock object å¯ä»¥å¾ˆçµæ´»åœ°é…ç½®æ‰€è°ƒç”¨çš„æ–¹æ³•æ‰€äº§ç”Ÿçš„è¡Œä¸º, å¹¶ä¸”å®ƒå¯ä»¥è¿½è¸ªæ–¹æ³•è°ƒç”¨, ä¾‹å¦‚ä¸€ä¸ª Mock Object æ–¹æ³•è°ƒç”¨æ—¶ä¼ é€’äº†å“ªäº›å‚æ•°, æ–¹æ³•è°ƒç”¨äº†å‡ æ¬¡ç­‰.</p>
<p>4.Dummy object: åœ¨æµ‹è¯•ä¸­å¹¶ä¸ä½¿ç”¨çš„, ä½†æ˜¯ä¸ºäº†æµ‹è¯•ä»£ç èƒ½å¤Ÿæ­£å¸¸ç¼–è¯‘&#x2F;è¿è¡Œè€Œæ·»åŠ çš„å¯¹è±¡. ä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ª Test Double å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•, è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ é€’å‡ ä¸ªå‚æ•°, ä½†æ˜¯å…¶ä¸­æŸä¸ªå‚æ•°æ— è®ºæ˜¯ä»€ä¹ˆå€¼éƒ½ä¸ä¼šå½±å“æµ‹è¯•çš„ç»“æœ, é‚£ä¹ˆè¿™ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ª Dummy object.<br>Dummy object å¯ä»¥æ˜¯ä¸€ä¸ªç©ºå¼•ç”¨, ä¸€ä¸ªç©ºå¯¹è±¡æˆ–è€…æ˜¯ä¸€ä¸ªå¸¸é‡ç­‰.<br>ç®€å•çš„è¯´, Dummy object å°±æ˜¯é‚£äº›æ²¡æœ‰ä½¿ç”¨åˆ°çš„, ä»…ä»…æ˜¯ä¸ºäº†å¡«å……å‚æ•°åˆ—è¡¨çš„å¯¹è±¡.</p>
<p>5.Test Spy<br>å¯ä»¥åŒ…è£…ä¸€ä¸ªçœŸå®çš„ Java å¯¹è±¡, å¹¶è¿”å›ä¸€ä¸ªåŒ…è£…åçš„æ–°å¯¹è±¡. è‹¥æ²¡æœ‰ç‰¹åˆ«é…ç½®çš„è¯, å¯¹è¿™ä¸ªæ–°å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•è°ƒç”¨, éƒ½ä¼šå§”æ´¾ç»™å®é™…çš„ Java å¯¹è±¡.</p>
<p>mock å’Œ spy çš„åŒºåˆ«æ˜¯: mock æ˜¯æ— ä¸­ç”Ÿæœ‰åœ°ç”Ÿå‡ºä¸€ä¸ª<strong>å®Œå…¨è™šæ‹Ÿçš„å¯¹è±¡</strong>, å®ƒçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯è™šæ‹Ÿçš„; è€Œ spy æ˜¯åœ¨ç°æœ‰ç±»çš„åŸºç¡€ä¸ŠåŒ…è£…äº†ä¸€ä¸ªå¯¹è±¡, å³å¦‚æœæˆ‘ä»¬æ²¡æœ‰é‡å†™ spy çš„æ–¹æ³•, é‚£ä¹ˆè¿™äº›æ–¹æ³•çš„å®ç°å…¶å®éƒ½æ˜¯è°ƒç”¨çš„è¢«åŒ…è£…çš„å¯¹è±¡çš„æ–¹æ³•.</p>
<p>ã€test fixtureã€‘æµ‹è¯•çš„å…ˆå†³æ¡ä»¶ï¼Œ<br>@Before åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•è¿è¡Œå‰éƒ½ä¼šè¢«è°ƒç”¨, @After åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•è¿è¡Œåéƒ½ä¼šè¢«è°ƒç”¨.<br>å› ä¸º @Before å’Œ @After ä¼šåœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•å‰åéƒ½ä¼šè¢«è°ƒç”¨, è€Œæœ‰æ—¶æˆ‘ä»¬ä»…ä»…éœ€è¦åœ¨æµ‹è¯•å‰è¿›è¡Œä¸€æ¬¡åˆå§‹åŒ–, è¿™æ ·çš„æƒ…å†µä¸‹, å¯ä»¥ä½¿ç”¨@BeforeClass å’Œ@AfterClass æ³¨è§£.</p>
<p>ã€test caseã€‘æµ‹è¯•ç”¨ä¾‹<br>åœ¨ JUnit 3ä¸­, æµ‹è¯•æ–¹æ³•éƒ½å¿…é¡»ä»¥ test ä¸ºå‰ç¼€, ä¸”å¿…é¡»æ˜¯ public void çš„, JUnit 4ä¹‹å, å°±æ²¡æœ‰è¿™ä¸ªé™åˆ¶äº†, åªè¦åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ ‡æ³¨ @Test æ³¨è§£, æ–¹æ³•ç­¾åå¯ä»¥æ˜¯ä»»æ„çš„.</p>
<p>ã€æµ‹è¯•å¥—ä»¶ã€‘é€šè¿‡ TestSuit å¯¹è±¡å°†å¤šä¸ªæµ‹è¯•ç”¨ä¾‹ç»„è£…æˆä¸€ä¸ªæµ‹è¯•å¥—ä»¶, æµ‹è¯•å¥—ä»¶æ‰¹é‡è¿è¡Œ.<br>é€šè¿‡@RunWith å’Œ@SuteClass ä¸¤ä¸ªæ³¨è§£, æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•å¥—ä»¶. é€šè¿‡@RunWith æŒ‡å®šä¸€ä¸ªç‰¹æ®Šçš„è¿è¡Œå™¨, å¹¶é€šè¿‡@SuiteClasses æ³¨è§£, å°†éœ€è¦è¿›è¡Œæµ‹è¯•çš„ç±»åˆ—è¡¨ä½œä¸ºå‚æ•°ä¼ å…¥.</p>
<h3 id="Junit4æ³¨è§£"><a href="#Junit4æ³¨è§£" class="headerlink" title="Junit4æ³¨è§£"></a>Junit4æ³¨è§£</h3><p>@Test (expected &#x3D; Exception.class) è¡¨ç¤ºé¢„æœŸä¼šæŠ›å‡ºException.class çš„å¼‚å¸¸</p>
<p>@Ignore å«ä¹‰æ˜¯â€œæŸäº›æ–¹æ³•å°šæœªå®Œæˆï¼Œæš‚ä¸å‚ä¸æ­¤æ¬¡æµ‹è¯•â€ã€‚è¿™æ ·çš„è¯æµ‹è¯•ç»“æœå°±ä¼šæç¤ºä½ æœ‰å‡ ä¸ªæµ‹è¯•è¢«å¿½ç•¥ï¼Œè€Œä¸æ˜¯å¤±è´¥ã€‚ä¸€æ—¦ä½ å®Œæˆäº†ç›¸åº”å‡½æ•°ï¼Œåªéœ€è¦æŠŠ@Ignoreæ³¨è§£åˆ å»ï¼Œå°±å¯ä»¥è¿›è¡Œæ­£å¸¸çš„æµ‹è¯•ã€‚</p>
<p>@Test(timeout&#x3D;100) è¡¨ç¤ºé¢„æœŸæ–¹æ³•æ‰§è¡Œä¸ä¼šè¶…è¿‡ 100 æ¯«ç§’ï¼Œæ§åˆ¶æ­»å¾ªç¯</p>
<p>@Before è¡¨ç¤ºè¯¥æ–¹æ³•åœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹å‰è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ä¹‹ç±»çš„æ“ä½œ</p>
<p>@After è¡¨ç¤ºè¯¥æ–¹æ³•åœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹åè¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œé‡Šæ”¾èµ„æºï¼Œå›æ”¶å†…å­˜ä¹‹ç±»çš„æ“</p>
<p>@BeforeClass è¡¨ç¤ºè¯¥æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚ä¸€èˆ¬å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œæ•°æ®åº“è¿æ¥æ“ä½œï¼Œæ³¨æ„è¯¥æ³¨è§£è¿ç”¨åœ¨é™æ€æ–¹æ³•ã€‚</p>
<p>@AfterClass è¡¨ç¤ºè¯¥æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰æ–¹æ³•ä¹‹åæ‰§è¡Œã€‚ä¸€èˆ¬å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œæ•°æ®åº“è¿æ¥å…³é—­æ“ä½œï¼Œæ³¨æ„è¯¥æ³¨è§£è¿ç”¨åœ¨é™æ€æ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import org.junit.runner.RunWith;  </span><br><span class="line">import org.junit.runners.Suite;  </span><br><span class="line">import org.junit.runners.Suite.SuiteClasses;  </span><br><span class="line">  </span><br><span class="line">@RunWith( Suite.class )  </span><br><span class="line">@SuiteClasses( &#123; JUnitTest1.class, JUnitTest2.class &#125; )  </span><br><span class="line">public class AllTests &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰å¤šä¸ªæµ‹è¯•ç±», å¯ä»¥åˆå¹¶æˆä¸€ä¸ªæµ‹è¯•å¥—ä»¶è¿›è¡Œæµ‹è¯•, è¿è¡Œä¸€ä¸ª Test Suite, é‚£ä¹ˆå°±ä¼šè¿è¡Œåœ¨è¿™ä¸ª Test Suite ä¸­çš„æ‰€ç”¨çš„æµ‹è¯•.<br>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª Test Suite, è¿™ä¸ª Test Suite åŒ…å«äº†ä¸¤ä¸ªæµ‹è¯•ç±»: JUnitTest1 å’Œ JUnitTest2, å› æ­¤è¿è¡Œ è¿™ä¸ª Test Suite æ—¶, å°±ä¼šè‡ªåŠ¨è¿è¡Œè¿™ä¸¤ä¸ªæµ‹è¯•ç±»äº†.</p>
<p>*åœ¨ç±»åä¸ŠæŒ‰ä¸‹command+shift+tï¼Œå°±å¯ä»¥ç”Ÿæˆå¯¹åº”æµ‹è¯•ç±»ã€‚</p>
<p>æ¥æºï¼š<a href="https://segmentfault.com/a/1190000006731125">https://segmentfault.com/a/1190000006731125</a></p>
<h2 id="2-Mockitoä¸­-Mockä¸-InjectMock"><a href="#2-Mockitoä¸­-Mockä¸-InjectMock" class="headerlink" title="2.Mockitoä¸­@Mockä¸@InjectMock"></a>2.Mockitoä¸­@Mockä¸@InjectMock</h2><p>Mockito æ˜¯ä¸€ä¸ªæµè¡Œ mock æ¡†æ¶ï¼Œå¯ä»¥å’ŒJUnitç»“åˆèµ·æ¥ä½¿ç”¨ã€‚Mockito å…è®¸ä½ åˆ›å»ºå’Œé…ç½® mock å¯¹è±¡ã€‚<br>Mockitoæ˜¯javaå•å…ƒæµ‹è¯•ä¸­ï¼Œæœ€å¸¸ç”¨çš„mckå·¥å…·ä¹‹ä¸€ï¼Œæä¾›äº†è¯¸å¤šæ‰“æ¡©æ–¹æ³•å’Œæ³¨è§£ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æ³¨è§£ï¼Œ@Mockå’Œ@InjectMockï¼Œåå­—å’Œåœ¨ä»£ç ä¸­ä½¿ç”¨ çš„ä½ç½®éƒ½å¾ˆåƒã€‚ä½†æ˜¯æ˜¯åœ¨åŠŸèƒ½ä¸Šæ— ä»»ä½•å¯ç±»æ¯”æ€§çš„å®Œå…¨ä¸åŒçš„ä¸œè¥¿ã€‚<br>ç¨‹åºå‘˜é€šå¸¸åˆ›é€ æ¨¡æ‹Ÿå¯¹è±¡æ¥æµ‹è¯•å…¶ä»–å¯¹è±¡çš„è¡Œä¸ºï¼Œå¾ˆç±»ä¼¼æ±½è½¦è®¾è®¡è€…ä½¿ç”¨ç¢°æ’æµ‹è¯•å‡äººæ¥æ¨¡æ‹Ÿè½¦è¾†ç¢°æ’ä¸­äººçš„åŠ¨æ€è¡Œä¸ºã€‚</p>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨mockï¼Ÿ<br>åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œæ¨¡æ‹Ÿå¯¹è±¡å¯ä»¥æ¨¡æ‹Ÿå¤æ‚çš„ã€çœŸå®çš„ï¼ˆéæ¨¡æ‹Ÿï¼‰å¯¹è±¡çš„è¡Œä¸ºï¼Œ å¦‚æœçœŸå®çš„å¯¹è±¡æ— æ³•æ”¾å…¥å•å…ƒæµ‹è¯•ä¸­ï¼Œä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å°±å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>å•å…ƒæµ‹è¯•çš„æ€è·¯æ˜¯åœ¨ä¸æ¶‰åŠä¾èµ–å…³ç³»çš„æƒ…å†µä¸‹æµ‹è¯•ä»£ç ï¼ˆéš”ç¦»æ€§ï¼‰ï¼Œæ‰€ä»¥æµ‹è¯•ä»£ç ä¸å…¶ä»–ç±»æˆ–è€…ç³»ç»Ÿçš„å…³ç³»åº”è¯¥å°½é‡è¢«æ¶ˆé™¤ã€‚ä¸€ä¸ªå¯è¡Œçš„æ¶ˆé™¤æ–¹æ³•æ˜¯æ›¿æ¢æ‰ä¾èµ–ç±»ï¼ˆæµ‹è¯•æ›¿æ¢ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›¿èº«æ¥æ›¿æ¢æ‰çœŸæ­£çš„ä¾èµ–å¯¹è±¡ã€‚</p>
<h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><p>@Mockï¼š<br>åœ¨Mockitoä¸­ç”¨äºåˆ›å»ºmockå¯¹è±¡ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š<br><code>@Mock</code><br><code>private ClassName mockedObjectï¼›</code></p>
<p>ä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåä¸ºmockedObjectï¼Œç±»å‹ä¸ºClassNameçš„mockå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰€æœ‰çš„æ–¹æ³•è¢«ç½®ç©ºï¼Œæ ¹æ®æµ‹è¯•ä»£ç é€»è¾‘çš„éœ€è¦ä½¿ç”¨.</p>
<hr>
<p>@InjectMockï¼š<br>åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œç®€å•çš„è¯´æ˜¯è¿™ä¸ªMockå¯ä»¥è°ƒç”¨çœŸå®ä»£ç çš„æ–¹æ³•ï¼Œå…¶ä½™ç”¨@Mockï¼ˆæˆ–@Spyï¼‰æ³¨è§£åˆ›å»ºçš„mockå°†è¢«æ³¨å…¥åˆ°ç”¨è¯¥å®ä¾‹ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RunWith(MockitoJUnitRunner.class)  </span><br><span class="line">public class Test &#123;  </span><br><span class="line">  </span><br><span class="line">    @InjectMocks  </span><br><span class="line">    private SomeHandler someHandler;  </span><br><span class="line">  </span><br><span class="line">    @Mock  </span><br><span class="line">    private OneDependency oneDependency; // æ­¤mockå°†è¢«æ³¨å…¥åˆ°someHandler  </span><br><span class="line"></span><br><span class="line">    // ...   </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä¸­ï¼Œ@InjectMockä¸‹é¢å£°æ˜äº†ä¸€ä¸ªå¾…æµ‹è¯•çš„å¯¹è±¡ï¼Œ@Mockå®šä¹‰çš„mockå¯¹è±¡å°†ä¼šè¢«æ³¨å…¥åˆ°è¿™ä¸ªå¾…æµ‹è¯•çš„å¯¹è±¡ä¸­ã€‚</p>
<hr>
<p>ğŸ¤” @Mockåˆ›å»ºåˆ›å»ºmockå¯¹è±¡ä¹‹åï¼Œåœ¨å¯¹å…·ä½“çš„æ–¹æ³•æ‰“æ¡©ä¹‹å‰ï¼Œmockå¯¹è±¡çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•å…¨è¢«ç½®ç©ºï¼ˆ0æˆ–è€…nullï¼‰ï¼Œæ‰€ä»¥ï¼Œå¯¹åº”çš„æ–¹æ³•æ˜¯ä¸è¿è¡Œçš„ã€‚<br>*mockå¯¹è±¡åˆ›å»ºä¹‹åï¼Œè¢«æµ‹è¯•ç±»ä¸­çš„è¯¥å¯¹è±¡çš„æ–¹æ³•å°±éƒ½ä¸æ‰§è¡Œäº†ã€‚</p>
<p>ğŸ¤” @Spyå¯ä»¥åˆ›å»ºçš„å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šæŒ‰ç…§åŸæ–¹æ³•çš„é€»è¾‘æ‰§è¡Œï¼Œç›´åˆ°è¢«æ‰“æ¡©è¿”å›æŸä¸ªå…·ä½“çš„å€¼ã€‚</p>
<p>æ¥æºï¼š<a href="https://www.cnblogs.com/langren1992/p/9681600.html">https://www.cnblogs.com/langren1992/p/9681600.html</a></p>
<h3 id="mockä½¿ç”¨"><a href="#mockä½¿ç”¨" class="headerlink" title="mockä½¿ç”¨"></a>mockä½¿ç”¨</h3><p>mavenæ³¨å…¥ä¾èµ–ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨æ³¨è§£ï¼Œé‚£ä¹ˆå¿…é¡»è¦å®ä¾‹åŒ– mock å¯¹è±¡ã€‚Mockito åœ¨é‡åˆ°ä½¿ç”¨æ³¨è§£çš„å­—æ®µçš„æ—¶å€™å¿…é¡»ä½¿ç”¨@RunWith(MockitoJUnitRunner.class) æˆ– MockitoAnnotations.initMocks(this)è¿›è¡Œmocksçš„åˆå§‹åŒ–å’Œæ³¨å…¥ã€‚<br>(å¯ä»¥å†™ä¸€ä¸ªinitå‡½æ•°ï¼ŒåŠ @Beforeæ³¨è§£)</p>
<h4 id="é…ç½®mock"><a href="#é…ç½®mock" class="headerlink" title="é…ç½®mock"></a>é…ç½®mock</h4><p>when(â€¦â€‹.).thenReturn(â€¦â€‹.)å¯ä»¥è¢«ç”¨æ¥å®šä¹‰å½“æ¡ä»¶æ»¡è¶³æ—¶å‡½æ•°çš„è¿”å›å€¼ï¼Œå½“å¤šæ¬¡è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼ŒMockito ä¼šæ ¹æ®ä½ å®šä¹‰çš„å…ˆåé¡ºåºæ¥è¿”å›è¿”å›å€¼ï¼ˆå¤šæ¬¡è°ƒç”¨ï¼‰ã€‚Mocks è¿˜å¯ä»¥æ ¹æ®ä¼ å…¥å‚æ•°çš„ä¸åŒæ¥å®šä¹‰ä¸åŒçš„è¿”å›å€¼ã€‚è­¬å¦‚è¯´ä½ çš„å‡½æ•°å¯ä»¥å°†anyString æˆ–è€… anyIntä½œä¸ºè¾“å…¥å‚æ•°ï¼Œç„¶åå®šä¹‰å…¶ç‰¹å®šçš„æ”¾å›å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import static org.mockito.Mockito.*;</span><br><span class="line">import static org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void test1()  &#123;</span><br><span class="line">        //  åˆ›å»º mock</span><br><span class="line">        MyClass test = Mockito.mock(MyClass.class);</span><br><span class="line"></span><br><span class="line">        // è‡ªå®šä¹‰ getUniqueId() çš„è¿”å›å€¼</span><br><span class="line">        when(test.getUniqueId(Mockito.anyLong())).thenReturn(43);</span><br><span class="line"></span><br><span class="line">        // åœ¨æµ‹è¯•ä¸­ä½¿ç”¨mockå¯¹è±¡</span><br><span class="line">        assertEquals(test.getUniqueId(), 43);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¿”å›å¤šä¸ªå€¼</span><br><span class="line">@Test</span><br><span class="line">public void testMoreThanOneReturnValue()  &#123;</span><br><span class="line">        Iterator i= mock(Iterator.class);</span><br><span class="line">        when(i.next()).thenReturn(&quot;Mockito&quot;).thenReturn(&quot;rocks&quot;);</span><br><span class="line">        String result=i.next()+&quot; &quot;+i.next();</span><br><span class="line">        // æ–­è¨€</span><br><span class="line">        assertEquals(&quot;Mockito rocks&quot;, result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¦‚ä½•æ ¹æ®è¾“å…¥æ¥è¿”å›å€¼</span><br><span class="line">@Test</span><br><span class="line">public void testReturnValueDependentOnMethodParameter()  &#123;</span><br><span class="line">        Comparable c= mock(Comparable.class);</span><br><span class="line">        when(c.compareTo(&quot;Mockito&quot;)).thenReturn(1);</span><br><span class="line">        when(c.compareTo(&quot;Eclipse&quot;)).thenReturn(2);</span><br><span class="line">        // æ–­è¨€</span><br><span class="line">        assertEquals(1,c.compareTo(&quot;Mockito&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¦‚ä½•è®©è¿”å›å€¼ä¸ä¾èµ–äºè¾“å…¥</span><br><span class="line">@Test</span><br><span class="line">public void testReturnValueInDependentOnMethodParameter()  &#123;</span><br><span class="line">        Comparable c= mock(Comparable.class);</span><br><span class="line">        when(c.compareTo(anyInt())).thenReturn(-1);</span><br><span class="line">        // æ–­è¨€</span><br><span class="line">        assertEquals(-1 ,c.compareTo(9));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ ¹æ®å‚æ•°ç±»å‹æ¥è¿”å›å€¼</span><br><span class="line">@Test</span><br><span class="line">public void testReturnValueInDependentOnMethodParameter()  &#123;</span><br><span class="line">        Comparable c= mock(Comparable.class);</span><br><span class="line">        when(c.compareTo(isA(Todo.class))).thenReturn(0);</span><br><span class="line">        // æ–­è¨€</span><br><span class="line">        Todo todo = new Todo(5);</span><br><span class="line">        assertEquals(todo ,c.compareTo(new Todo(1)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="æ— è¿”å›å€¼çš„æ–¹æ³•"><a href="#æ— è¿”å›å€¼çš„æ–¹æ³•" class="headerlink" title="æ— è¿”å›å€¼çš„æ–¹æ³•"></a>æ— è¿”å›å€¼çš„æ–¹æ³•</h4><p>mokitoä¸­ï¼Œå¯¹æ— è¿”å›çš„å‡½æ•°ä»€ä¹ˆéƒ½ä¸åš<br>Mokito.doNothing().when(å¯¹è±¡).å‡½æ•°();</p>
<p>å¯¹äºæ— è¿”å›å€¼çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨doReturn(â€¦â€‹).when(â€¦â€‹).methodCallæ¥è·å¾—ç±»ä¼¼çš„æ•ˆæœã€‚ä¾‹å¦‚æˆ‘ä»¬æƒ³åœ¨è°ƒç”¨æŸäº›æ— è¿”å›å€¼å‡½æ•°çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨doThrow æ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import static org.mockito.Mockito.*;</span><br><span class="line">import static org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line">// ä¸‹é¢æµ‹è¯•ç”¨ä¾‹æè¿°äº†å¦‚ä½•ä½¿ç”¨doThrow()æ–¹æ³•</span><br><span class="line"></span><br><span class="line">@Test(expected=IOException.class)</span><br><span class="line">public void testForIOException() &#123;</span><br><span class="line">        // åˆ›å»ºå¹¶é…ç½® mock å¯¹è±¡</span><br><span class="line">        OutputStream mockStream = mock(OutputStream.class);</span><br><span class="line">        doThrow(new IOException()).when(mockStream).close();</span><br><span class="line"></span><br><span class="line">        // ä½¿ç”¨ mock</span><br><span class="line">        OutputStreamWriter streamWriter= new OutputStreamWriter(mockStream);</span><br><span class="line">        streamWriter.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="éªŒè¯æ˜¯å¦è°ƒç”¨"><a href="#éªŒè¯æ˜¯å¦è°ƒç”¨" class="headerlink" title="éªŒè¯æ˜¯å¦è°ƒç”¨"></a>éªŒè¯æ˜¯å¦è°ƒç”¨</h4><p>éªŒè¯ query æ–¹æ³•æ˜¯å¦è¢« MyDatabase çš„ mock å¯¹è±¡è°ƒç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import static org.mockito.Mockito.*;</span><br><span class="line"></span><br><span class="line">public class MockitoTest  &#123;</span><br><span class="line"></span><br><span class="line">        @Mock</span><br><span class="line">        MyDatabase databaseMock; (1)</span><br><span class="line"></span><br><span class="line">        @Rule public MockitoRule mockitoRule = MockitoJUnit.rule(); (2)</span><br><span class="line"></span><br><span class="line">        @Test</span><br><span class="line">        public void testQuery()  &#123;</span><br><span class="line">                ClassToTest t  = new ClassToTest(databaseMock); (3)</span><br><span class="line">                boolean check = t.query(&quot;* from t&quot;); (4)</span><br><span class="line">                assertTrue(check); (5)</span><br><span class="line">                verify(databaseMock).query(&quot;* from t&quot;); (6)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Mockito ä¼šè·Ÿè¸ª mock å¯¹è±¡é‡Œé¢æ‰€æœ‰çš„æ–¹æ³•å’Œå˜é‡ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨æ¥éªŒè¯å‡½æ•°åœ¨ä¼ å…¥ç‰¹å®šå‚æ•°çš„æ—¶å€™æ˜¯å¦è¢«è°ƒç”¨ã€‚è¿™ç§æ–¹å¼çš„æµ‹è¯•ç§°è¡Œä¸ºæµ‹è¯•ï¼Œè¡Œä¸ºæµ‹è¯•å¹¶ä¸ä¼šæ£€æŸ¥å‡½æ•°çš„è¿”å›å€¼ï¼Œè€Œæ˜¯æ£€æŸ¥åœ¨ä¼ å…¥æ­£ç¡®å‚æ•°æ—¶å€™å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import static org.mockito.Mockito.*;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testVerify()  &#123;</span><br><span class="line">        // åˆ›å»ºå¹¶é…ç½® mock å¯¹è±¡</span><br><span class="line">        MyClass test = Mockito.mock(MyClass.class);</span><br><span class="line">        when(test.getUniqueId()).thenReturn(43);</span><br><span class="line"></span><br><span class="line">        // è°ƒç”¨mockå¯¹è±¡é‡Œé¢çš„æ–¹æ³•å¹¶ä¼ å…¥å‚æ•°ä¸º12</span><br><span class="line">        test.testing(12);</span><br><span class="line">        test.getUniqueId();</span><br><span class="line">        test.getUniqueId();</span><br><span class="line"></span><br><span class="line">        // æŸ¥çœ‹åœ¨ä¼ å…¥å‚æ•°ä¸º12çš„æ—¶å€™æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨</span><br><span class="line">        verify(test).testing(Matchers.eq(12));</span><br><span class="line"></span><br><span class="line">        // æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ä¸¤æ¬¡</span><br><span class="line">        verify(test, times(2)).getUniqueId();</span><br><span class="line"></span><br><span class="line">        // å…¶ä»–ç”¨æ¥éªŒè¯å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨çš„æ–¹æ³•</span><br><span class="line">        verify(mock, never()).someMethod(&quot;never called&quot;);</span><br><span class="line">        verify(mock, atLeastOnce()).someMethod(&quot;called at least once&quot;);</span><br><span class="line">        verify(mock, atLeast(2)).someMethod(&quot;called at least twice&quot;);</span><br><span class="line">        verify(mock, times(5)).someMethod(&quot;called five times&quot;);</span><br><span class="line">        verify(mock, atMost(3)).someMethod(&quot;called at most 3 times&quot;);</span><br><span class="line">&#125;</span><br><span class="line">å‰é¢éƒ½åŠ ä¸ªMockito.</span><br></pre></td></tr></table></figure>

<h3 id="spyä½¿ç”¨"><a href="#spyä½¿ç”¨" class="headerlink" title="spyä½¿ç”¨"></a>spyä½¿ç”¨</h3><p>@Spyæˆ–è€…spy()æ–¹æ³•å¯ä»¥è¢«ç”¨æ¥å°è£… java å¯¹è±¡ã€‚è¢«å°è£…åï¼Œé™¤éç‰¹æ®Šå£°æ˜ï¼ˆæ‰“æ¡© stubï¼‰ï¼Œå¦åˆ™éƒ½ä¼šçœŸæ­£çš„è°ƒç”¨å¯¹è±¡é‡Œé¢çš„æ¯ä¸€ä¸ªæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import static org.mockito.Mockito.*;</span><br><span class="line"></span><br><span class="line">// Lets mock a LinkedList</span><br><span class="line">List list = new LinkedList();</span><br><span class="line">List spy = spy(list);</span><br><span class="line"></span><br><span class="line">// å¯ç”¨ doReturn() æ¥æ‰“æ¡©</span><br><span class="line">doReturn(&quot;foo&quot;).when(spy).get(0);</span><br><span class="line"></span><br><span class="line">// ä¸‹é¢ä»£ç ä¸ç”Ÿæ•ˆ</span><br><span class="line">// çœŸæ­£çš„æ–¹æ³•ä¼šè¢«è°ƒç”¨</span><br><span class="line">// å°†ä¼šæŠ›å‡º IndexOutOfBoundsException çš„å¼‚å¸¸ï¼Œå› ä¸º List ä¸ºç©º</span><br><span class="line">when(spy.get(0)).thenReturn(&quot;foo&quot;);</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/f6e3ab9719b9">https://www.jianshu.com/p/f6e3ab9719b9</a><br><a href="https://www.jianshu.com/p/7b67806b74f6">https://www.jianshu.com/p/7b67806b74f6</a></p>
<h2 id="PowerMockRunner-å’Œ-MockitoJUnitRunner"><a href="#PowerMockRunner-å’Œ-MockitoJUnitRunner" class="headerlink" title="PowerMockRunner å’Œ MockitoJUnitRunner"></a>PowerMockRunner å’Œ MockitoJUnitRunner</h2><p>å…³äºæ‰“æ¡©ï¼š<br><a href="https://blog.csdn.net/moshowgame/article/details/100983711">https://blog.csdn.net/moshowgame/article/details/100983711</a></p>
<h2 id="when-thenReturn-å’Œ-doReturn-when-åŒºåˆ«"><a href="#when-thenReturn-å’Œ-doReturn-when-åŒºåˆ«" class="headerlink" title="when().thenReturn() å’Œ doReturn().when() åŒºåˆ«"></a>when().thenReturn() å’Œ doReturn().when() åŒºåˆ«</h2><p>ä½¿ç”¨@Mockæ—¶å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä½†æ˜¯@Spyæ—¶ï¼Œå®ƒä»¬çš„è°ƒç”¨ç»“æœä¸åŒã€‚<br>1.when().thenReturn() ä¼šè°ƒç”¨çœŸå®çš„æ–¹æ³•ï¼Œå®¹æ˜“æŠ›å‡ºå¼‚å¸¸<br>2.doReturn().when() ä¸ä¼šè°ƒç”¨çœŸå®æ–¹æ³•</p>
<h2 id="PowerMockito"><a href="#PowerMockito" class="headerlink" title="PowerMockito"></a>PowerMockito</h2><p>PowerMockæ‰©å±•äº†EasyMockå’ŒMockitoæ¡†æ¶ï¼Œå¢åŠ äº†å¯¹staticå’Œfinalæ–¹æ³•mockæ”¯æŒç­‰åŠŸèƒ½.<br>PowerMockæœ‰ä¸¤ä¸ªé‡è¦çš„æ³¨è§£ï¼š<br> @RunWith(PowerMockRunner.class)<br> @prepareForTest({MyObject.class})<br> @PrepareForTestæ³¨è§£å’Œ@RunWithæ³¨è§£æ˜¯ç»“åˆä½¿ç”¨çš„ï¼Œä¸è¦å•ç‹¬ä½¿ç”¨@PrepareForTestï¼Œå¦åˆ™ä¸èµ·ä½œç”¨ã€‚å½“ä½¿ç”¨PowerMockå»mocké™æ€ï¼Œfinalæˆ–è€…ç§æœ‰æ–¹æ³•æ—¶ï¼Œéœ€è¦åŠ ä¸Šè¿™ä¸¤ä¸ªæ³¨è§£ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br><a href="https://blog.csdn.net/KeeYang108/article/details/79891588">https://blog.csdn.net/KeeYang108/article/details/79891588</a></p>
<h2 id="Mockæµ‹è¯•è¸©å‘"><a href="#Mockæµ‹è¯•è¸©å‘" class="headerlink" title="Mockæµ‹è¯•è¸©å‘"></a>Mockæµ‹è¯•è¸©å‘</h2><p>ä»Šå¤©å†™äº†ä¸€ä¸ªcontrolå±‚çš„mockå•å…ƒæµ‹è¯•ï¼Œå› ä¸ºè¦è°ƒserviceå±‚ï¼ˆå®ç°ç±»ï¼‰çš„æ–¹æ³•ï¼Œå°±æŠŠserviceæ¥å£åšäº†ä¸€ä¸ªmockï¼Œæµ‹è¯•æ—¶å€™ä¸€ç›´åŒ…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚<br>mock serviceå®ç°ç±»ä¹‹åï¼Œæ­£å¸¸ã€‚</p>
<p>æ›´æ–°ï¼šä»Šå¤©@Mockçš„æ¥å£ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¥‡æ€ªäº†ï¼š<br>mockæ¥å£å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸çš„caseï¼šæ˜¯serviceï¼ˆ.ä¹‹å‰çš„ï¼‰æ˜¯å®ç°ç±»ï¼Œ@Autowiredçš„ä¹Ÿæ˜¯å®ç°ç±»ï¼Œæ‰€ä»¥mockæ¥å£æ²¡ç”¨ï¼Ÿ<br>è€Œä»Šå¤©mockæ¥å£ï¼Œè¢«æµ‹è¯•ç±»ä¸­.ä¹‹å‰çš„æ˜¯æ¥å£ï¼Œ@Autowiredçš„ä¹Ÿæ˜¯æ¥å£ï¼Œæ‰€ä»¥æ²¡æ¯›ç—…ã€‚</p>
<p>åŠ @RunWith(PowerMockRunner.class)<br>è¦æµ‹è¯•çš„ç±»åŠ @InjectMocks</p>
<p>1.serviceå®ç°ç±»ä¸åŠ mockï¼Œåˆ°æŒ‡å®šæ–¹æ³•ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œserviceå¯¹è±¡ä¸ºç©º<br>2.å¦‚æœserviceæ–¹æ³•æ— è¿”å›ï¼Œå¯ä»¥ä¸æ‰“æ¡©ï¼Œå¦‚æœæœ‰è¿”å›ï¼Œæœ€å¥½æ‰“ä¸ªæ¡©ã€‚<br>3.æœ‰è¿”å›çš„æ‰“äº†æ¡©ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„è¾“å…¥ï¼Œè¿”å›ä¸åŒçš„ç»“æœã€‚æœ‰è¿”å›å¦‚æœä¸æ‰“æ¡©ï¼Œç›¸å½“äºè¿”å›çš„æ˜¯nullï¼Œè¿”å›å¦‚æœè¢«åé¢ç”¨åˆ°ï¼Œå®¹æ˜“æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p>
<h2 id="Mockæµ‹è¯•è¸©å‘ç©ºæŒ‡é’ˆå¼‚å¸¸"><a href="#Mockæµ‹è¯•è¸©å‘ç©ºæŒ‡é’ˆå¼‚å¸¸" class="headerlink" title="Mockæµ‹è¯•è¸©å‘ç©ºæŒ‡é’ˆå¼‚å¸¸"></a>Mockæµ‹è¯•è¸©å‘ç©ºæŒ‡é’ˆå¼‚å¸¸</h2><p>mockæµ‹è¯•çš„è¢«æµ‹è¯•ç±»ï¼ˆ@InjectMockï¼‰ä¸­çš„å±æ€§ä¸€èˆ¬ä¸ºnullï¼Œæ‰€ä»¥ä»€ä¹ˆéƒ½ä¸åŠ å°±åœ¨è¢«æµ‹è¯•ç±»ä¸­è°ƒç”¨å±æ€§å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼ŒæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå› ä¸ºå±æ€§å¯¹è±¡æ˜¯nullã€‚<br>å°†å±æ€§å¯¹è±¡åœ¨Testä¸­æ·»åŠ @Mockä¸ºmockå¯¹è±¡ï¼Œç›´æ¥å¿½ç•¥å±æ€§å¯¹è±¡æ–¹æ³•ï¼Œä¸è¿›å…¥æ‰§è¡Œã€‚<br>å°†å±æ€§å¯¹è±¡åœ¨Testä¸­æ·»åŠ @Spyä¸ºspyå¯¹è±¡ï¼Œä¼šè¿›å…¥è¯¥æ–¹æ³•ä¸­ï¼Œä½†æ˜¯åªé™äºä¸€å±‚ï¼Œå†è¿›å…¥å°±ä¸è¡Œäº†ï¼Œè¿˜æ˜¯ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p>
<hr>
<h2 id="å•å…ƒæµ‹è¯•æ¡†æ¶å’Œæ­¥éª¤"><a href="#å•å…ƒæµ‹è¯•æ¡†æ¶å’Œæ­¥éª¤" class="headerlink" title="å•å…ƒæµ‹è¯•æ¡†æ¶å’Œæ­¥éª¤"></a>å•å…ƒæµ‹è¯•æ¡†æ¶å’Œæ­¥éª¤</h2><p>Jnitï¼šä¸€ä¸ªjavaè¯­è¨€çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œç¼–å†™å’Œè¿è¡Œå¯é‡å¤çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</p>
<p>Mockitoï¼šå•å…ƒæµ‹è¯•æ¨¡æ‹Ÿæ¡†æ¶ï¼Œé‡‡ç”¨æ¨¡æ‹ŸæŠ€æœ¯ï¼Œæ¨¡æ‹Ÿåº”ç”¨ä¸­ä¾èµ–çš„å¤æ‚å¯¹è±¡ï¼ŒæŠŠæµ‹è¯•å¯¹è±¡å’Œä¾èµ–å¯¹è±¡éš”ç¦»å¼€ã€‚</p>
<p>PowerMockï¼šåœ¨Mockitoçš„åŸºç¡€ä¸Šä½œå‡ºæ‰©å±•ã€‚</p>
<p>å•å…ƒæµ‹è¯•æ­¥éª¤ï¼šå®šä¹‰å¯¹è±¡ - æ¨¡æ‹Ÿæ–¹æ³• - è°ƒç”¨æ–¹æ³• - éªŒè¯æ–¹æ³• ï¼ˆç¬¬äºŒæ­¥å’Œç¬¬å››æ­¥æ˜¯æœ‰å¤–éƒ¨ä¾èµ–æ—¶éœ€è¦mockä½¿ç”¨çš„ï¼‰</p>
<p>1ã€å®šä¹‰æµ‹è¯•å¯¹è±¡ï¼ˆnew&#x2F;Mockito.spy&#x2F;@Spy&#x2F;@InjectMocksï¼‰<br>2ã€æ¨¡æ‹Ÿä¾èµ–å¯¹è±¡ï¼ˆç›´æ¥æ„å»ºå¯¹è±¡&#x2F;Jsonååºåˆ—åŒ–å¯¹è±¡&#x2F;@Mock&#x2F;@Spyï¼‰<br>3ã€æ³¨å…¥ä¾èµ–å¯¹è±¡ï¼ˆset&#x2F;Whitebox&#x2F;@Mockï¼‰<br>4ã€æ¨¡æ‹Ÿä¾èµ–æ–¹æ³•<br>5ã€è°ƒç”¨è¢«æµ‹æ–¹æ³•ï¼ˆåˆ†ä¸ºæ„é€ æ–¹æ³•ã€æ™®é€šæ–¹æ³•ã€é™æ€æ–¹æ³•ï¼‰ï¼ˆéƒ½åˆ†ä¸ºæœ‰æƒé™å’Œæ— æƒé™ï¼‰ï¼ˆæœ‰æƒé™ç›´æ¥è°ƒç”¨ï¼Œæ— æƒé™ç”¨ï¼š<code>Whitebox.invokeMethod(userService, &quot;isUser&quot;, uid)</code>ï¼‰<br>6ã€éªŒè¯ä¾èµ–æ–¹æ³•ï¼ˆMockito.verify(â€¦)ï¼‰ï¼ˆç”¨ArgumentCaptor&#x2F;@Captoræ•è·å‚æ•°ï¼‰<br>7ã€éªŒè¯æ•°æ®å¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//éªŒè¯å¯¹è±¡ä¸ºç©º</span><br><span class="line">Assert.assertNull(&quot;å¿…é¡»ä¸ºç©ºï¼&quot;, uid);</span><br><span class="line">//éªŒè¯å¯¹è±¡éç©º</span><br><span class="line">Assert.assertNotNull(&quot;ä¸èƒ½ä¸ºç©ºï¼&quot;, uid);</span><br><span class="line">//éªŒè¯ä¸ºçœŸ</span><br><span class="line">Assert.assertTrue(&quot;è¿”å›å¿…é¡»ä¸ºçœŸ&quot;, isSuper);</span><br><span class="line">//éªŒè¯ä¸ºå‡</span><br><span class="line">Assert.assertFalse(&quot;è¿”å›å¿…é¡»ä¸ºå‡&quot;, isSuper);</span><br><span class="line">//éªŒè¯æ•°æ®å¯¹è±¡æ˜¯å¦ä¸€è‡´</span><br><span class="line">Assert.assertSame(&quot;ç”¨æˆ·å¿…é¡»ä¸€è‡´&quot;, exceptId, uid);</span><br><span class="line">//éªŒè¯æ•°æ®å¯¹è±¡æ˜¯å¦ä¸€è‡´</span><br><span class="line">Assert.assertNotSame(&quot;ç”¨æˆ·ä¸èƒ½ä¸€è‡´&quot;, exceptId, uid);</span><br><span class="line">//éªŒè¯ç®€å•æ•°æ®å¯¹è±¡</span><br><span class="line">Assert.assertNotEquals(&quot;ç”¨æˆ·åç§°ä¸ä¸€è‡´&quot;, &quot;admin&quot;, user)</span><br><span class="line">//éªŒè¯ç®€å•æ•°ç»„æˆ–é›†åˆå¯¹è±¡</span><br><span class="line">Assert.assertArrayEquals</span><br><span class="line">//å¯¹äºå¤æ‚æ•°æ®ï¼Œå¯ä»¥å…ˆåºåˆ—åŒ–ä¸ºjsonå­—ç¬¦ä¸²ï¼Œç„¶åAssert.assertEquals</span><br></pre></td></tr></table></figure>
<p>éªŒè¯è·‘å‡ºå¼‚å¸¸ï¼šå¯ä»¥ç”¨@Test(expected&#x3D;ExampleException.class)ï¼Œä½†æ˜¯ä¸€æ—¦å†…éƒ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œæ•´ä¸ªæ–¹æ³•å°±è¿”å›ï¼Œåé¢çš„éªŒè¯æ²¡æ³•æ‰§è¡Œã€‚@Ruleæ³¨è§£å®ç°ã€‚æ¨èä½¿ç”¨Assert</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ExampleException e = Assert.assertThrows(&quot;å¼‚å¸¸ç±»å‹ä¸ä¸€è‡´&quot;, ExampleException.class, ()-&gt;userService.getUser(uid));</span><br><span class="line">Assert.assertEquals(&quot;å¼‚å¸¸æ¶ˆæ¯ä¸ä¸€è‡´&quot;, exceptString, e.getMessage());</span><br></pre></td></tr></table></figure>
<p>8ã€éªŒè¯ä¾èµ–å¯¹è±¡ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼‰<br><code>Mockito.verifyNotInteractions</code></p>
<p>âœ…Mockitoçš„anyç›¸å…³çš„å‚æ•°åŒ¹é…æ–¹æ³•ä¸æ”¯æŒå¯ç©ºå‚æ•°å’Œç©ºå‚æ•°ï¼Œåº”è¯¥ç”¨nullableæ–¹æ³•ã€‚<br>âœ…é‡‡ç”¨Mockitoçš„å‚æ•°åŒ¹é…æ–¹æ³•æ—¶ï¼Œå…¶ä»–å‚æ•°ä¸èƒ½ç›´æ¥ç”¨å¸¸é‡æˆ–å˜é‡ï¼Œåº”è¯¥ç”¨Mockitoçš„eqæ–¹æ³•ã€‚</p>
<h2 id="Mocké™æ€æ–¹æ³•"><a href="#Mocké™æ€æ–¹æ³•" class="headerlink" title="Mocké™æ€æ–¹æ³•"></a>Mocké™æ€æ–¹æ³•</h2><p>é€šè¿‡PowerMockito.mockStatic() å¯¹é™æ€æ–¹æ³•è¿›è¡Œmockã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.powermock&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;powermock-api-mockito2&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.powermock&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;powermock-module-junit4&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import org.apache.commons.lang3.StringUtils;</span><br><span class="line">import org.junit.jupiter.api.Assertions;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.powermock.api.mockito.PowerMockito;</span><br><span class="line">import org.powermock.core.classloader.annotations.PowerMockIgnore;</span><br><span class="line">import org.powermock.core.classloader.annotations.PrepareForTest;</span><br><span class="line">import org.powermock.modules.junit4.PowerMockRunner;</span><br><span class="line"> </span><br><span class="line">@RunWith(PowerMockRunner.class)</span><br><span class="line">@PrepareForTest(StringUtils.class)  //å¤šä¸ªé™æ€æ–¹æ³•çš„è¯&#123;1,2&#125;</span><br><span class="line">//@PowerMockIgnore(&quot;javax.crypto.*&quot;)</span><br><span class="line">public class MyTest &#123;</span><br><span class="line"> </span><br><span class="line">    @Test</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        //æ¨¡æ‹Ÿä¾èµ–æ–¹æ³•</span><br><span class="line">        PowerMockito.mockStatic(StringUtils.class);</span><br><span class="line">        PowerMockito.when(StringUtils.isEmpty(&quot;empty&quot;)).thenReturn(true);</span><br><span class="line">        Assertions.assertTrue(StringUtils.isEmpty(&quot;empty&quot;));</span><br><span class="line">        //éªŒè¯ä¾èµ–æ–¹æ³•è¢«è°ƒç”¨</span><br><span class="line">        PowerMockito.verifyStatic(StringUtils.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/q2878948/article/details/124862699">https://blog.csdn.net/q2878948/article/details/124862699</a><br><a href="https://blog.csdn.net/qq_34497300/article/details/119774225">https://blog.csdn.net/qq_34497300/article/details/119774225</a></p>
<h2 id="Mockç§æœ‰æ–¹æ³•"><a href="#Mockç§æœ‰æ–¹æ³•" class="headerlink" title="Mockç§æœ‰æ–¹æ³•"></a>Mockç§æœ‰æ–¹æ³•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é¦–å…ˆ@RunWith(PowerMockRunner.class)</span><br><span class="line">æŠŠç§æœ‰æ–¹æ³•æ‰€åœ¨ç±»æ”¾åœ¨@PrepareForTest()ä¸­</span><br><span class="line">//æ¨¡æ‹Ÿç§æœ‰ä¾èµ–æ–¹æ³•</span><br><span class="line">PowerMockito.doReturn(true).when(MyService.class, &quot;myFunc&quot;, myParam);</span><br><span class="line">PowerMockito.when(MyService.class, &quot;myFunc&quot;, myParam).thenReturn(true);</span><br><span class="line">//éªŒè¯ç§æœ‰æ–¹æ³•è°ƒç”¨</span><br><span class="line">PowerMockito.verifyPrivate(myClass, times(1)).invoke(&quot;myfunc&quot;, any(List.class))</span><br></pre></td></tr></table></figure>

<p>âš ï¸æƒ³mockè¢«éªŒè¯ç±»(@InjectMock)çš„ç§æœ‰æ–¹æ³•æ˜¯ä¸è¡Œçš„ã€‚åªèƒ½mockæ³¨å…¥ç±»çš„ç§æœ‰æ–¹æ³•ã€‚</p>
<h2 id="Mockè¢«æµ‹è¯•ç±»çš„å…¶ä»–publicæ–¹æ³•"><a href="#Mockè¢«æµ‹è¯•ç±»çš„å…¶ä»–publicæ–¹æ³•" class="headerlink" title="Mockè¢«æµ‹è¯•ç±»çš„å…¶ä»–publicæ–¹æ³•"></a>Mockè¢«æµ‹è¯•ç±»çš„å…¶ä»–publicæ–¹æ³•</h2><p>ç›´æ¥ç”¨Mockito.whenæ˜¯ä¸è¡Œï¼Œä¼šæŠ¥ç©ºæŒ‡é’ˆã€‚</p>
<p>è¿˜æ²¡æå‡ºæ¥ã€‚</p>
<p>Javaä¸­ä½¿ç”¨PowerMockito mock staticæ–¹æ³•&#x2F;newå¯¹è±¡&#x2F;mockå¯¹è±¡çš„publicæˆ–privateæ–¹æ³•çš„ç®€å•ç¤ºä¾‹ï¼š<br><a href="https://www.cnblogs.com/epic358/p/16559549.html">https://www.cnblogs.com/epic358/p/16559549.html</a></p>
<h2 id="Mockæµ‹è¯•ä¿®æ”¹æ–¹æ³•çš„å…¥å‚"><a href="#Mockæµ‹è¯•ä¿®æ”¹æ–¹æ³•çš„å…¥å‚" class="headerlink" title="Mockæµ‹è¯•ä¿®æ”¹æ–¹æ³•çš„å…¥å‚"></a>Mockæµ‹è¯•ä¿®æ”¹æ–¹æ³•çš„å…¥å‚</h2><p>å¦‚æœæ–¹æ³•æœ‰è¿”å›å€¼ï¼Œç›´æ¥ä½¿ç”¨Mockito.when().thenReturn()çš„æ–¹å¼Mockå³å¯ï¼Œä½†æ˜¯å¯¹äºæ²¡æœ‰è¿”å›å€¼çš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨æ–¹æ³•å†…éƒ¨å´å¯¹æ–¹æ³•çš„å…¥å‚åšäº†ä¸€äº›é€»è¾‘çš„æ–¹æ³•ï¼Œå°±ä¸èƒ½å†ç”¨è¿™ç§æ–¹å¼ï¼Œåº”è¯¥ç”¨å¦å¤–ä¸€ä¸ªMockæ–¹æ³•ï¼Œå³doNothingã€‚</p>
<p>Mockçš„æ—¶å€™ï¼Œé¦–å…ˆåŒ¹é…å‚æ•°ï¼Œç„¶ååœ¨ArgumentMatcherä¸­ä¿®æ”¹å‚æ•°å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// mockæ–¹å¼ä¿®æ”¹æ–¹æ³•å…¥å‚</span><br><span class="line">doNothing().when(userService).service(any(), argThat(new ArgumentMatcher&lt;UserResponse&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean matches(UserResponse response) &#123;</span><br><span class="line">        ImportInfo importInfo = new ImportInfo();</span><br><span class="line">        importInfo.setStatus(&quot;APPROVING&quot;);</span><br><span class="line">        // ä¿®æ”¹å…¥å‚çš„å±æ€§</span><br><span class="line">        response.setImportInfo(importInfo);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br><span class="line">Request request = new Request();</span><br><span class="line">Response response = new Response();</span><br><span class="line">// è¿™ä¸ªæ˜¯æˆ‘ä»¬è¦éªŒè¯çš„ä¸»æ–¹æ³•</span><br><span class="line">handler.handle(request, response);</span><br></pre></td></tr></table></figure>

<p><a href="https://www.wxxblog.com/article/5">https://www.wxxblog.com/article/5</a></p>
<h2 id="å•å…ƒæµ‹è¯•é£æ ¼"><a href="#å•å…ƒæµ‹è¯•é£æ ¼" class="headerlink" title="å•å…ƒæµ‹è¯•é£æ ¼"></a>å•å…ƒæµ‹è¯•é£æ ¼</h2><p>å•å…ƒæµ‹è¯•çš„æ„ä¹‰åœ¨äºéªŒè¯ä¸šåŠ¡ä»£ç ï¼Œé«˜è¦†ç›–ç‡+å¯è¯»æ€§ &#x3D; é«˜ä»·å€¼ã€‚é«˜è¦†ç›–ç‡åŒ…æ‹¬å¯¹ä»£ç çš„è¦†ç›–ï¼Œä¹ŸåŒ…æ‹¬å¯¹æµ‹è¯•ç”¨ä¾‹çš„è¦†ç›–ã€‚</p>
<p>ä¸€ä¸ªæ–¹æ³•è¦æµ‹è¯•å¤šç§æµ‹è¯•åœºæ™¯çš„è¯ï¼Œå°±å†™å¤šä¸ªmockæ–¹æ³•ï¼Œä¸€ä¸ªå•ä¾§æ–¹æ³•åªé’ˆå¯¹ä¸€ä¸ªè¡Œä¸ºã€‚ä½†æ˜¯çœ‹ï¼Œæœ‰äº›å…¬å…±çš„mockæ‰“æ¡©å¯ä»¥æå–å‡ºæ¥ï¼Œå†™æˆä¸€ä¸ªå…¬å…±çš„ç§æœ‰æ–¹æ³•ï¼Œæˆ–è€…å†™ä¸€ä¸ªinitæ–¹æ³•ï¼Œç”¨@Beforeæ³¨è§£ä¿®é¥°ï¼Œåœ¨è¿è¡Œæµ‹è¯•æ–¹æ³•æ—¶å°±æå‰æ‰“æ¡©ã€‚</p>
<p>æ¨èçš„é£æ ¼ï¼š<br>1.ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ä»…è°ƒç”¨ä¸€æ¬¡è¢«æµ‹æ–¹æ³•<br>2.è‡³å°‘ä¸€ä¸ªæ­£ä¾‹çš„æµ‹è¯•ç”¨ä¾‹<br>3ï¼Œæå–å…¬å…±çš„mockæ’æ¡©<br>4.å¼‚å¸¸æµçš„æµ‹è¯•ä¸­ï¼Œåªå¼•å…¥ä¸€ç§å¼‚å¸¸çš„mocké‡å†™<br>5.åŠ æ³¨é‡Šï¼šæµ‹è¯•ä»€ä¹ˆåœºæ™¯ï¼ŒæœŸæœ›ä»€ä¹ˆç»“æœ</p>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>1ã€Mockito.anyString ä»€ä¹ˆçš„ï¼Œä¸èƒ½å’Œå®é™…çš„å‚æ•°ä¸€èµ·ä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„è¾“å…¥ã€‚<br>ä¼šæŠ¥é”™ï¼šInvalidUseOfMatchersExceptionã€‚</p>
<p>2ã€æ¥å£çš„å•å…ƒæµ‹è¯•ç±»ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªå®ç°ç±»å°±ä¸€ä¸ªå•å…ƒæµ‹è¯•ç±»ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>java webç›¸å…³</title>
    <url>/2022/09/11/myblog/java/java%20web%E7%9B%B8%E5%85%B3/</url>
    <content><![CDATA[<h2 id="ç½‘é¡µ502"><a href="#ç½‘é¡µ502" class="headerlink" title="ç½‘é¡µ502"></a>ç½‘é¡µ502</h2><p>502 Bad Gatewayæ˜¯æŒ‡é”™è¯¯ç½‘å…³ï¼Œæ— æ•ˆç½‘å…³ï¼›åœ¨äº’è”ç½‘ä¸­è¡¨ç¤ºä¸€ç§ç½‘ç»œé”™è¯¯ã€‚è¡¨ç°åœ¨WEBæµè§ˆå™¨ä¸­ç»™å‡ºçš„é¡µé¢åé¦ˆã€‚</p>
<p>æœåŠ¡ç«¯ä»£ç ä¸‹æ‰ï¼Œé‡æ–°éƒ¨ç½²çš„é—´éš™ï¼Œè®¿é—®æ¥å£ä¼š502.</p>
<h2 id="504é”™è¯¯"><a href="#504é”™è¯¯" class="headerlink" title="504é”™è¯¯"></a>504é”™è¯¯</h2><p>504é”™è¯¯ä»£è¡¨ç½‘å…³è¶…æ—¶ ï¼ˆGateway timeoutï¼‰ï¼Œæ˜¯æŒ‡æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ã€‚</p>
<p>æ¥å£504è¶…æ—¶ï¼Œæ˜¯æœåŠ¡ç«¯è¿™è¾¹è¶…æ—¶æ–­å¼€è¯·æ±‚äº†ï¼Œéœ€è¦çœ‹ä¸€ä¸‹nginxé…ç½®ã€‚å¦‚æœæ˜¯tomcatï¼Œçœ‹ä¸€ä¸‹confä¸­é…ç½®çš„è¯·æ±‚è¶…æ—¶æ—¶é—´ã€‚</p>
<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><h3 id="âœ…nginxæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#âœ…nginxæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="âœ…nginxæ˜¯ä»€ä¹ˆï¼Ÿ"></a>âœ…nginxæ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote>
<p>Nginxæ˜¯ååˆ†è½»é‡çº§çš„HTTPæœåŠ¡å™¨ã€‚Nginxï¼Œå®ƒçš„å‘éŸ³ä¸ºâ€œengine Xâ€ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªIMAP&#x2F;POP3&#x2F;SMTP ä»£ç†æœåŠ¡å™¨ã€‚</p>
<p>Ngnix æ˜¯äº’è”ç½‘ä¼ä¸šä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ä»£ç†æœåŠ¡å™¨ã€‚å®ƒå¯ä»¥ä¸ºåç«¯åˆ†å¸ƒå¼æœåŠ¡æä¾›è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å°†åç«¯å¤šä¸ªæœåŠ¡åœ°å€èšåˆä¸ºå•ä¸ªåœ°å€æ¥å¯¹å¤–æä¾›æœåŠ¡ã€‚</p>
<p>Nginxæ˜¯lgor Sysoevä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„rambler.ruç«™ç‚¹è®¾è®¡å¼€å‘çš„ã€‚ä»2004å¹´å‘å¸ƒè‡³ä»Šï¼Œå‡­å€Ÿå¼€æºçš„åŠ›é‡ï¼Œå·²ç»æ¥è¿‘æˆç†Ÿä¸å®Œå–„ã€‚<br>NginxåŠŸèƒ½ä¸°å¯Œï¼Œå¯ä½œä¸ºHTTPæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œé‚®ä»¶æœåŠ¡å™¨ã€‚æ”¯æŒFastCGIã€SSLã€Virtual Hostã€URL Rewriteã€Gzipç­‰åŠŸèƒ½ã€‚å¹¶ä¸”æ”¯æŒå¾ˆå¤šç¬¬ä¸‰æ–¹çš„æ¨¡å—æ‰©å±•ã€‚<br>Nginxçš„ç¨³å®šæ€§ã€åŠŸèƒ½é›†ã€ç¤ºä¾‹é…ç½®æ–‡ä»¶å’Œä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—è®©ä»–åæ¥å±…ä¸Šï¼Œåœ¨å…¨çƒæ´»è·ƒçš„ç½‘ç«™ä¸­æœ‰12.18%çš„ä½¿ç”¨æ¯”ç‡ï¼Œå¤§çº¦ä¸º2220ä¸‡ä¸ªç½‘ç«™ã€‚</p>
</blockquote>
<p>nginxæ˜¯æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨ï¼Œè´Ÿè½½å‡è¡¡ï¼Œåå‘ä»£ç†ï¼ŒæœåŠ¡å™¨æ¶æ„ã€‚</p>
<p>Nginxå‡­å€Ÿå…¶ç¨³å®šæ€§ã€ä½èµ„æºæ¶ˆè€—ã€ç®€å•é…ç½®å’Œä¸°å¯Œçš„åŠŸèƒ½ï¼Œä»åå¤šå¹´å‰åä¸è§ç»ä¼ çš„WebæœåŠ¡å™¨è½¯ä»¶ï¼Œå‘å±•åˆ°å¦‚ä»Šèƒ½å¤Ÿè·ŸApacheåŒ¹æ•Œçš„åœ°ä½ã€‚</p>
<p>1ã€ä½œä¸ºWebæœåŠ¡å™¨ï¼ŒNginxå¤„ç†é™æ€æ–‡ä»¶ã€ç´¢å¼•æ–‡ä»¶ï¼Œè‡ªåŠ¨ç´¢å¼•çš„æ•ˆç‡éå¸¸é«˜</p>
<p>2ã€ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼ŒNginxå¯ä»¥å®ç°æ— ç¼“å­˜çš„åå‘ä»£ç†åŠ é€Ÿï¼Œæé«˜ç½‘ç«™è¿è¡Œé€Ÿåº¦</p>
<p>3ã€ä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼ŒNginxæ—¢å¯ä»¥åœ¨å†…éƒ¨ç›´æ¥æ”¯æŒRailså’ŒPHPï¼Œä¹Ÿå¯ä»¥æ”¯æŒHTTPä»£ç†æœåŠ¡å™¨å¯¹å¤–è¿›è¡ŒæœåŠ¡ï¼ŒåŒæ—¶è¿˜æ”¯æŒç®€å•çš„å®¹é”™å’Œåˆ©ç”¨ç®—æ³•è¿›è¡Œè´Ÿè½½å‡è¡¡</p>
<p>4ã€åœ¨æ€§èƒ½æ–¹é¢ï¼ŒNginxæ˜¯ä¸“é—¨ä¸ºæ€§èƒ½ä¼˜åŒ–è€Œå¼€å‘çš„ï¼Œå®ç°ä¸Šéå¸¸æ³¨é‡æ•ˆç‡ã€‚å®ƒé‡‡ç”¨å†…æ ¸Pollæ¨¡å‹ï¼Œå¯ä»¥æ”¯æŒæ›´å¤šçš„å¹¶å‘è¿æ¥ï¼Œæœ€å¤§å¯ä»¥æ”¯æŒå¯¹5ä¸‡ä¸ªå¹¶å‘è¿æ¥æ•°çš„å“åº”ï¼Œè€Œä¸”åªå ç”¨å¾ˆä½çš„å†…å­˜èµ„æº</p>
<p>5ã€åœ¨ç¨³å®šæ€§æ–¹é¢ï¼ŒNginxé‡‡å–äº†åˆ†é˜¶æ®µèµ„æºåˆ†é…æŠ€æœ¯ï¼Œä½¿å¾—CPUä¸å†…å­˜çš„å ç”¨ç‡éå¸¸ä½ã€‚Nginxå®˜æ–¹è¡¨ç¤ºï¼ŒNginxä¿æŒ1ä¸‡ä¸ªæ²¡æœ‰æ´»åŠ¨çš„è¿æ¥ï¼Œè€Œè¿™äº›è¿æ¥åªå ç”¨2.5MBå†…å­˜ï¼Œå› æ­¤ï¼Œç±»ä¼¼DOSè¿™æ ·çš„æ”»å‡»å¯¹Nginxæ¥è¯´åŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰ä»»ä½•ä½œç”¨çš„</p>
<p>6ã€åœ¨é«˜å¯ç”¨æ€§æ–¹é¢ï¼ŒNginxæ”¯æŒçƒ­éƒ¨ç½²ï¼Œå¯åŠ¨é€Ÿåº¦ç‰¹åˆ«è¿…é€Ÿï¼Œå› æ­¤å¯ä»¥åœ¨ä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯¹è½¯ä»¶ç‰ˆæœ¬æˆ–è€…é…ç½®è¿›è¡Œå‡çº§ï¼Œå³ä½¿è¿è¡Œæ•°æœˆä¹Ÿæ— éœ€é‡æ–°å¯åŠ¨ï¼Œå‡ ä¹å¯ä»¥åšåˆ°7x24å°æ—¶ä¸é—´æ–­åœ°è¿è¡Œ<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>è§£è¯»nginxï¼š<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_60274825/article/details/122101640">https://blog.csdn.net/weixin_60274825/article/details/122101640</a></p>
<h3 id="âœ…ä»€ä¹ˆæ˜¯ä»£ç†æœåŠ¡å™¨ï¼Ÿ"><a href="#âœ…ä»€ä¹ˆæ˜¯ä»£ç†æœåŠ¡å™¨ï¼Ÿ" class="headerlink" title="âœ…ä»€ä¹ˆæ˜¯ä»£ç†æœåŠ¡å™¨ï¼Ÿ"></a>âœ…ä»€ä¹ˆæ˜¯ä»£ç†æœåŠ¡å™¨ï¼Ÿ</h3><p>ä»£ç†æœåŠ¡å™¨æ˜¯ä»‹äºå®¢æˆ·ç«¯å’ŒWebæœåŠ¡å™¨ä¹‹é—´çš„å¦ä¸€å°æœåŠ¡å™¨ï¼Œæœ‰äº†å®ƒä¹‹åï¼Œæµè§ˆå™¨ä¸æ˜¯ç›´æ¥åˆ°WebæœåŠ¡å™¨å»å–å›ç½‘é¡µï¼Œè€Œæ˜¯é€šè¿‡å‘ä»£ç†æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä¿¡å·ä¼šå…ˆé€åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œç”±ä»£ç†æœåŠ¡å™¨æ¥å–å›æµè§ˆå™¨æ‰€éœ€è¦çš„ä¿¡æ¯å¹¶ä¼ é€ç»™ä½ çš„æµè§ˆå™¨ã€‚</p>
<p><img src="/images/%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8.png"></p>
<p>ä»£ç†ä½äºWebå®¢æˆ·ç«¯å’ŒWebæœåŠ¡å™¨ä¹‹é—´ï¼Œæ‰®æ¼”â€œä¸­é—´äººâ€çš„è§’è‰²ã€‚<br>HTTPçš„ä»£ç†æœåŠ¡å™¨æ—¢æ˜¯WebæœåŠ¡å™¨åˆæ˜¯Webå®¢æˆ·ç«¯ã€‚</p>
<h3 id="âœ…ä»€ä¹ˆæ˜¯æ­£åå‘ä»£ç†"><a href="#âœ…ä»€ä¹ˆæ˜¯æ­£åå‘ä»£ç†" class="headerlink" title="âœ…ä»€ä¹ˆæ˜¯æ­£åå‘ä»£ç†"></a>âœ…ä»€ä¹ˆæ˜¯æ­£åå‘ä»£ç†</h3><p>æ­£å‘ä»£ç†æ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’ŒåŸå§‹æœåŠ¡å™¨ä¹‹é—´çš„æœåŠ¡å™¨ï¼Œä¸ºäº†ä»åŸå§‹æœåŠ¡å™¨å–çš„å†…å®¹ï¼Œå®¢æˆ·ç«¯å‘ä»£ç†å‘é€ä¸€ä¸ªè¯·æ±‚å¹¶æŒ‡å®šç›®æ ‡ï¼ˆåŸå§‹æœåŠ¡å™¨ï¼‰ï¼Œç„¶åä»£ç†å‘åŸå§‹æœåŠ¡å™¨è½¬äº¤è¯·æ±‚å¹¶å°†è·å¾—çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¿…é¡»è¦è¿›è¡Œä¸€äº›ç‰¹åˆ«çš„è®¾ç½®æ‰èƒ½ä½¿ç”¨æ­£å‘ä»£ç†ã€‚</p>
<p>æ­£å‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯ï¼Œæ­£å‘ä»£ç†ä¸­ï¼Œproxyå’ŒclientåŒå±ä¸€ä¸ªLANï¼Œå¯¹serveré€æ˜ ï¼ˆå®¢æˆ·ç«¯æœåŠ¡ç«¯å¤šå¯¹ä¸€ï¼Ÿï¼‰</p>
<p>åå‘ä»£ç†æœåŠ¡å™¨ï¼šåœ¨æœåŠ¡å™¨ç«¯æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åæŠŠè¯·æ±‚åˆ†å‘ç»™å…·ä½“çš„æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œç„¶åå†å°†æœåŠ¡å™¨çš„å“åº”ç»“æœåé¦ˆç»™å®¢æˆ·ç«¯ã€‚Nginxå°±æ˜¯å…¶ä¸­çš„ä¸€ç§åå‘ä»£ç†æœåŠ¡å™¨è½¯ä»¶ã€‚</p>
<p>åå‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯æœåŠ¡ç«¯ï¼Œåå‘ä»£ç†ä¸­ï¼Œproxyå’ŒserveråŒå±ä¸€ä¸ªLANï¼Œå¯¹clienté€æ˜  ï¼ˆå®¢æˆ·ç«¯æœåŠ¡ç«¯å¤šå¯¹å¤šï¼‰</p>
<p>æ­£å‘ä»£ç†å®¢æˆ·ç«¯å¿…é¡»è®¾ç½®æ­£å‘ä»£ç†æœåŠ¡å™¨ï¼Œå½“ç„¶å‰ææ˜¯è¦çŸ¥é“æ­£å‘ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè¿˜æœ‰ä»£ç†ç¨‹åºçš„ç«¯å£ã€‚<br>åå‘ä»£ç†æ­£å¥½ä¸æ­£å‘ä»£ç†ç›¸åï¼Œå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ä»£ç†æœåŠ¡å™¨å°±åƒæ˜¯åŸå§‹æœåŠ¡å™¨ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯ä¸éœ€è¦è¿›è¡Œä»»ä½•ç‰¹åˆ«çš„è®¾ç½®ã€‚å®¢æˆ·ç«¯å‘åå‘ä»£ç†çš„å‘½åç©ºé—´ä¸­çš„å†…å®¹å‘é€æ™®é€šè¯·æ±‚ï¼Œæ¥ç€åå‘ä»£ç†å°†åˆ¤æ–­å‘å“ªä¸ªåŸå§‹æœåŠ¡å™¨è½¬äº¤è¯·æ±‚ï¼Œå¹¶å°†è·å¾—çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>è§£è¯»nginxï¼š<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_60274825/article/details/122101640">https://blog.csdn.net/weixin_60274825/article/details/122101640</a></p>
<h3 id="âœ…nginxä¸tomcatä»€ä¹ˆå…³ç³»"><a href="#âœ…nginxä¸tomcatä»€ä¹ˆå…³ç³»" class="headerlink" title="âœ…nginxä¸tomcatä»€ä¹ˆå…³ç³»"></a>âœ…nginxä¸tomcatä»€ä¹ˆå…³ç³»</h3><p>nginxæ˜¯ä¸Šé¢åšwebä»£ç†æœåŠ¡å™¨çš„ï¼Œè€Œtomcatæ˜¯ä¸Šé¢åšçœŸæ­£webæœåŠ¡å™¨çš„ã€‚</p>
<p>nginxå¸¸ç”¨åšé™æ€å†…å®¹æœåŠ¡å’Œä»£ç†æœåŠ¡å™¨ï¼Œç›´é¢å¤–æ¥è¯·æ±‚è½¬å‘ç»™åé¢çš„åº”ç”¨æœåŠ¡ï¼ˆtomcatï¼Œdjangoä»€ä¹ˆçš„ï¼‰ï¼Œtomcatæ›´å¤šç”¨æ¥åšåšä¸€ä¸ªåº”ç”¨å®¹å™¨ï¼Œè®©java web appè·‘åœ¨é‡Œé¢çš„ä¸œè¥¿ï¼Œå¯¹åº”åŒçº§åˆ«çš„æœ‰jboss,jettyç­‰ä¸œè¥¿ã€‚</p>
<p>ä½†æ˜¯äº‹æ— ç»å¯¹ï¼Œnginxä¹Ÿå¯ä»¥é€šè¿‡æ¨¡å—å¼€å‘æ¥æä¾›åº”ç”¨åŠŸèƒ½ï¼Œtomcatä¹Ÿå¯ä»¥ç›´æ¥æä¾›httpæœåŠ¡ï¼Œé€šå¸¸ç”¨åœ¨å†…ç½‘å’Œä¸éœ€è¦æµæ§ç­‰å°å‹æœåŠ¡çš„åœºæ™¯ã€‚</p>
<p>ä¸¥æ ¼çš„æ¥è¯´ï¼ŒApache&#x2F;Nginx åº”è¯¥å«åšã€ŒHTTP Serverã€ï¼›è€Œ Tomcat åˆ™æ˜¯ä¸€ä¸ªã€ŒApplication Serverã€ï¼Œæˆ–è€…æ›´å‡†ç¡®çš„æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªã€ŒServlet&#x2F;JSPã€åº”ç”¨çš„å®¹å™¨ï¼ˆRuby&#x2F;Python ç­‰å…¶ä»–è¯­è¨€å¼€å‘çš„åº”ç”¨ä¹Ÿæ— æ³•ç›´æ¥è¿è¡Œåœ¨ Tomcat ä¸Šï¼‰ã€‚</p>
<p>ä¸€ä¸ª HTTP Server å…³å¿ƒçš„æ˜¯ HTTP åè®®å±‚é¢çš„ä¼ è¾“å’Œè®¿é—®æ§åˆ¶ï¼Œæ‰€ä»¥åœ¨ Apache&#x2F;Nginx ä¸Šä½ å¯ä»¥çœ‹åˆ°ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚å®¢æˆ·ç«¯é€šè¿‡ HTTP Server è®¿é—®æœåŠ¡å™¨ä¸Šå­˜å‚¨çš„èµ„æºï¼ˆHTML æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶ç­‰ç­‰ï¼‰ã€‚é€šè¿‡ CGI æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥å°†å¤„ç†è¿‡çš„å†…å®¹é€šè¿‡ HTTP Server åˆ†å‘ï¼Œä½†æ˜¯ä¸€ä¸ª HTTP Server å§‹ç»ˆåªæ˜¯æŠŠæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¦‚å®çš„é€šè¿‡ HTTP åè®®ä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>è€Œåº”ç”¨æœåŠ¡å™¨ï¼Œåˆ™æ˜¯ä¸€ä¸ªåº”ç”¨æ‰§è¡Œçš„å®¹å™¨ã€‚å®ƒé¦–å…ˆéœ€è¦æ”¯æŒå¼€å‘è¯­è¨€çš„ Runtimeï¼ˆå¯¹äº Tomcat æ¥è¯´ï¼Œå°±æ˜¯ Javaï¼‰ï¼Œä¿è¯åº”ç”¨èƒ½å¤Ÿåœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šæ­£å¸¸è¿è¡Œã€‚å…¶æ¬¡ï¼Œéœ€è¦æ”¯æŒåº”ç”¨ç›¸å…³çš„è§„èŒƒï¼Œä¾‹å¦‚ç±»åº“ã€å®‰å…¨æ–¹é¢çš„ç‰¹æ€§ã€‚å¯¹äº Tomcat æ¥è¯´ï¼Œå°±æ˜¯éœ€è¦æä¾› JSP&#x2F;Sevlet è¿è¡Œéœ€è¦çš„æ ‡å‡†ç±»åº“ã€Interface ç­‰ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œåº”ç”¨æœåŠ¡å™¨å¾€å¾€ä¹Ÿä¼šé›†æˆ HTTP Server çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸å¦‚ä¸“ä¸šçš„ HTTP Server é‚£ä¹ˆå¼ºå¤§ï¼Œæ‰€ä»¥åº”ç”¨æœåŠ¡å™¨å¾€å¾€æ˜¯è¿è¡Œåœ¨ HTTP Server çš„èƒŒåï¼Œæ‰§è¡Œåº”ç”¨ï¼Œå°†åŠ¨æ€çš„å†…å®¹è½¬åŒ–ä¸ºé™æ€çš„å†…å®¹ä¹‹åï¼Œé€šè¿‡ HTTP Server åˆ†å‘åˆ°å®¢æˆ·ç«¯ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_44517990/article/details/100712182">https://blog.csdn.net/weixin_44517990/article/details/100712182</a></p>
<h3 id="âœ…-springbootå†…ç½®tomcat-å’Œ-tomcat"><a href="#âœ…-springbootå†…ç½®tomcat-å’Œ-tomcat" class="headerlink" title="âœ… springbootå†…ç½®tomcat å’Œ tomcat"></a>âœ… springbootå†…ç½®tomcat å’Œ tomcat</h3><p>1.å†…ç½®çš„tomcatæ²¡æœ‰tomcatçš„ä¸»é¡µé¡µé¢<a href="http://localhost:9999/%EF%BC%8C%E8%80%8C%E6%88%91%E4%BB%AC%E5%B9%B3%E6%97%B6%E7%94%A8%E7%9A%84%E5%A4%96%E7%BD%AE%E7%9A%84tomcat%E6%98%AF%E6%9C%89%E7%9A%84">http://localhost:9999/ï¼Œè€Œæˆ‘ä»¬å¹³æ—¶ç”¨çš„å¤–ç½®çš„tomcatæ˜¯æœ‰çš„</a></p>
<p>2.å†…ç½®çš„tomcatå¯ä»¥ç”¨mainè·‘é¡¹ç›®ï¼Œè€Œå¦‚æœè¦ç”¨å¤–ç½®çš„tomcatå°±éœ€è¦æŠŠé¡¹ç›®æ‰“æˆwaråŒ…ï¼Œç„¶åæ‹·è´åˆ°webappä¸‹è¿›è¡Œè¿è¡Œ</p>
<p>Tomcatï¼š<br>Tomcatæ˜¯ä¸€ä¸ªWebåº”ç”¨æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯Servletå®¹å™¨ã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼Œè§£æå®¢æˆ·ç«¯clientå‘èµ·çš„requestï¼Œå¹¶ç»„è£…å‡ºHttpRequestã€åˆ›å»ºHttpResponseï¼Œå°†äºŒè€…äº¤äºå†…éƒ¨çš„HttpServletå¤„ç†å’Œå¡«å……</p>
<p>Tomcatæ˜ å°„å¤„ç†è¯·æ±‚çš„Servletæ˜¯é€šè¿‡web.xmlåšçš„ã€‚</p>
<p>SpringMVCä½¿ç”¨ä¸€ä¸ªDispatcherServletæ¥æ¥æ”¶æ‰€æœ‰çš„è¯·æ±‚ï¼Œå¹¶æŠŠå®ƒä»¬åˆ†å‘åˆ°ä¸åŒçš„controllerä¸­æ¥åšè¿›ä¸€æ­¥å¤„ç†ã€‚</p>
<p>SpringMVC &#x3D; Spring + Webæ¡†æ¶ï¼ŒSpringè¿™éƒ¨åˆ†ä¸»è¦æ˜¯AOP&#x2F;IOCå®¹å™¨ã€‚</p>
<p>SpringBootæ˜¯Springçš„æ‰©å±•ï¼Œç®€åŒ–äº†Springçš„é…ç½®ï¼Œé€šè¿‡starterçš„æ–¹å¼ç®€åŒ–äº†å¸¸ç”¨ç»„ä»¶ä¾èµ–çš„å¼•å…¥ï¼Œä½¿å…¶æ›´åŠ æ˜“ç”¨ã€‚</p>
<p>SpringBootå†…ç½®äº†tomcatã€‚</p>
<h3 id="âœ…tomcatå’Œspring-mvc"><a href="#âœ…tomcatå’Œspring-mvc" class="headerlink" title="âœ…tomcatå’Œspring mvc"></a>âœ…tomcatå’Œspring mvc</h3><p>tomcatæ—¢æ˜¯HttpæœåŠ¡å™¨ï¼ˆä¸ç”¨ä»£ç†çš„è¯ï¼Œå…¶å®æ˜¯åº”ç”¨æœåŠ¡å™¨ï¼‰ï¼ŒHttpæœåŠ¡å™¨ä¸Servletå®¹å™¨çš„åŠŸèƒ½ç•Œé™æ˜¯ï¼šå¯ä»¥æŠŠHTTPæœåŠ¡å™¨æƒ³è±¡æˆå‰å°çš„æ¥å¾…ï¼Œè´Ÿè´£ç½‘ç»œé€šä¿¡å’Œè§£æè¯·æ±‚ï¼ŒServletå®¹å™¨æ˜¯ä¸šåŠ¡éƒ¨é—¨ï¼Œè´Ÿè´£å¤„ç†ä¸šåŠ¡è¯·æ±‚ã€‚</p>
<p>Tomcatå’ŒServletä½œä¸ºWebæœåŠ¡å™¨å’ŒServletå®¹å™¨çš„ç»“åˆï¼Œå¯ä»¥æ¥å—ç½‘ç»œhttpè¯·æ±‚è§£æä¸ºServletè§„èŒƒçš„è¯·æ±‚å¯¹è±¡å’Œå“åº”å¯¹è±¡ã€‚æ¯”å¦‚ï¼ŒHttpServletRequestå¯¹è±¡æ˜¯Tomcatæä¾›çš„ï¼ŒServletæ˜¯è§„èŒƒï¼ŒTomcatæ˜¯å®ç°è§„èŒƒçš„Servletå®¹å™¨ã€‚tomcatç›‘å¬äº†ç«¯å£ï¼Œè¯·æ±‚è¿‡æ¥åï¼Œæ ¹æ®urlç­‰ä¿¡æ¯ï¼Œç¡®å®šè¦å°†è¯·æ±‚äº¤ç»™å“ªä¸ªservletå»å¤„ç†;ç„¶åè°ƒç”¨é‚£ä¸ªservletçš„serviceæ–¹æ³•ï¼Œserviceæ–¹æ³•è¿”å›ä¸€ä¸ªresponseå¯¹è±¡;<br>tomcatå†æŠŠè¿™ä¸ªresponseè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>SpringMVCæ˜¯å¤„ç†Servletè¯·æ±‚çš„åº”ç”¨ï¼Œå…¶ä¸­DispatcherServletå®ç°äº†Servletæ¥å£ï¼ŒTomcatè´Ÿè´£åŠ è½½å’Œè°ƒç”¨DispatcherServletã€‚åŒæ—¶ï¼ŒDispatcherServletæœ‰è‡ªå·±çš„å®¹å™¨ï¼ˆSpringMVCï¼‰å®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨è´Ÿè´£ç®¡ç†SpringMVCç›¸å…³çš„beanï¼Œæ¯”å¦‚Controlerå’ŒViewResolverç­‰ã€‚åŒæ—¶ï¼ŒSpringä¸­è¿˜æœ‰å…¶ä»–çš„Beanæ¯”å¦‚Serviceå’ŒDAOç­‰ï¼Œè¿™äº›ç”±å…¨å±€çš„Spring IOCå®¹å™¨ç®¡ç†ï¼Œå› æ­¤ï¼ŒSpringæœ‰ä¸¤ä¸ªIOCå®¹å™¨ã€‚</p>
<p>å¦‚æœåªæ˜¯ä½¿ç”¨spring(ä¸åŒ…å«springmvc)ï¼Œé‚£ä¹ˆæ˜¯tomcatå®¹å™¨è§£æxmlæ–‡ä»¶ï¼Œé€šè¿‡åå°„å®ä¾‹åŒ–å¯¹åº”çš„ç±»ï¼Œæ ¹æ®è¿™äº›servletè§„èŒƒå®ç°ç±»ï¼Œè§¦å‘å¯¹åº”çš„ä»£ç å¤„ç†é€»è¾‘ï¼Œè¿™ä¸ªæ—¶å€™tomcatè´Ÿè´£httpæŠ¥æ–‡çš„è§£æå’Œservletè°ƒåº¦çš„å·¥ä½œã€‚</p>
<p>å¦‚æœä½¿ç”¨spring mvcï¼Œé‚£ä¹ˆtomcatåªæ˜¯è§£æhttpæŠ¥æ–‡ï¼Œç„¶åå°†å…¶è½¬å‘ç»™dispatchsetvletï¼Œç„¶åç”±springmvcæ ¹æ®å…¶é…ç½®ï¼Œå®ä¾‹å¯¹åº”çš„ç±»ï¼Œæ‰§è¡Œå¯¹åº”çš„é€»è¾‘ï¼Œç„¶åè¿”å›ç»“æœç»™dispatchservletï¼Œæœ€åç”±å®ƒè½¬å‘ç»™tomcat,ç”±tomcatè´Ÿè´£æ„å»ºhttpæŠ¥æ–‡æ•°æ®ã€‚</p>
<p>DispatcherServletï¼šæ˜¯Spring MVCä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ç°äº†Servletæ¥å£ã€‚æ‰€ä»¥éƒ¨ç½²åœ¨Tomcatä¸­çš„Springé¡¹ç›®ï¼Œå¯¹Tomcatæ¥è¯´ï¼Œéƒ½æ˜¯ä¸€ä¸ªservletã€‚</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>spring mvcè¿˜éœ€è¦tomcatå—ï¼Ÿ<br>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œé»„æ³¥å·æ°´çŒ´å­ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_40277163/article/details/124730530">https://blog.csdn.net/qq_40277163/article/details/124730530</a></p>
<h3 id="âœ…nginxä¸åŸŸåè§£æDNSä»€ä¹ˆå…³ç³»"><a href="#âœ…nginxä¸åŸŸåè§£æDNSä»€ä¹ˆå…³ç³»" class="headerlink" title="âœ…nginxä¸åŸŸåè§£æDNSä»€ä¹ˆå…³ç³»"></a>âœ…nginxä¸åŸŸåè§£æDNSä»€ä¹ˆå…³ç³»</h3><p>é¦–å…ˆï¼Œnginxæ˜¯webæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚ dnsæ˜¯åŸŸåè§£ææœåŠ¡å™¨ã€‚nginxä¸å¸¦dnsã€‚</p>
<p>ä½œä¸ºå°†åŸŸåå’ŒIPåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œèƒ½å¤Ÿä½¿äººæ›´æ–¹ä¾¿åœ°è®¿é—®äº’è”ç½‘ã€‚è®¿é—®åŸŸåï¼Œdnså¸®å¿™è§£æåˆ°ipï¼Œç„¶åè®¿é—®è¿™ä¸ªåœ°å€çš„èµ„æºå‘ˆç°ç»™ä½ ã€‚hostså’Œnginxåœ¨åé¢ç”¨åˆ°ã€‚</p>
<p>hostsæ–‡ä»¶ï¼š<br>hostsæ–‡ä»¶æ˜¯ä¸ªæœ¬åœ°åŸŸåè§£ææ–‡ä»¶ï¼Œä¸ç®¡ä½ æ˜¯windwosè¿˜æ˜¯linuxï¼Œé‚£éƒ½æ˜¯æœ‰çš„ï¼Œä»–é‡Œé¢çš„æœ‰æ•ˆå†…å®¹ï¼Œå°±æ˜¯ä¸€ä¸ªä¸ªçš„ipå’ŒåŸŸåæ˜ å°„å…³ç³»ã€‚<br>windowsä¸€èˆ¬åœ¨ï¼šC:&#x2F;Windows&#x2F;System32&#x2F;drivers&#x2F;etc&#x2F;hosts<br>Linuxçš„hostsæ–‡ä»¶è·¯å¾„ä¸€èˆ¬ï¼š&#x2F;etc&#x2F;hosts<br>æ¯”å¦‚ï¼š127.0.0.1 localhost<br>è¿™ä¸ªæ–‡ä»¶å…¶å®ä¹Ÿæ˜¯é…ç½®äº†ipå’ŒåŸŸåä¹‹é—´çš„æ˜ å°„å…³ç³»çš„æ•°æ®åº“ï¼Œæœ¬åœ°è¦æ˜¯æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼˜å…ˆç”¨è¿™ä¸ªæ–‡ä»¶ä¸­çš„é…ç½®å»è§£æï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£å°±é€šè¿‡dnsè§£æã€‚<br>æ³¨æ„ï¼šhostsæ–‡ä»¶åªèƒ½é…ç½®ipå’ŒåŸŸåçš„æ˜ å°„å…³ç³»ï¼Œä½†æ˜¯ä¸èƒ½é…ç½®ç«¯å£å·ï¼Œé»˜è®¤è®¿é—®80ç«¯å£</p>
<p>å› ä¸ºè¦è§£å†³ç«¯å£é—®é¢˜ï¼Œè¿™é‡Œå°±å¾—ä½¿ç”¨åå‘ä»£ç†è½¯ä»¶nginxï¼Œnginxä¸­çš„æ¯ä¸ªserverå°±æ˜¯ä¸€ä¸ªåå‘ä»£ç†é…ç½®ï¼Œå¯ä»¥æœ‰å¤šä¸ªserverã€‚</p>
<p>ç†è§£ï¼š<em><strong>å®¢æˆ·ç«¯è¯·æ±‚ - dnsè§£æåŸŸå - è§£æåˆ°nginxæœåŠ¡å™¨çš„ip - nginxä»£ç†åˆ°tomcatæœåŠ¡å™¨+ç«¯å£ - tomcatå°†è¯·æ±‚ç»™servlet - servletçš„serviceå¤„ç†è¯·æ±‚ã€‚</strong></em></p>
<h3 id="âœ…nginxä¸CDNå†…å®¹åˆ†å‘ç½‘ç»œä»€ä¹ˆå…³ç³»"><a href="#âœ…nginxä¸CDNå†…å®¹åˆ†å‘ç½‘ç»œä»€ä¹ˆå…³ç³»" class="headerlink" title="âœ…nginxä¸CDNå†…å®¹åˆ†å‘ç½‘ç»œä»€ä¹ˆå…³ç³»"></a>âœ…nginxä¸CDNå†…å®¹åˆ†å‘ç½‘ç»œä»€ä¹ˆå…³ç³»</h3><p>cdnæ˜¯ç½‘ç»œï¼Œnginxæ˜¯æœåŠ¡å™¨ä¹Ÿæ˜¯è´Ÿè½½å‡è¡¡ã€‚</p>
<p>cdnï¼š<br>1ã€CDNçš„å…¨ç§°æ˜¯Content Delivery Networkï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œã€‚<br>2ã€å…¶åŸºæœ¬æ€è·¯æ˜¯å°½å¯èƒ½é¿å¼€äº’è”ç½‘ä¸Šæœ‰å¯èƒ½å½±å“æ•°æ®ä¼ è¾“é€Ÿåº¦å’Œç¨³å®šæ€§çš„ç“¶é¢ˆå’Œç¯èŠ‚ï¼Œä½¿å†…å®¹ä¼ è¾“çš„æ›´å¿«ã€æ›´ç¨³å®šã€‚<br>3ã€é€šè¿‡åœ¨ç½‘ç»œå„å¤„æ”¾ç½®èŠ‚ç‚¹æœåŠ¡å™¨æ‰€æ„æˆçš„åœ¨ç°æœ‰çš„äº’è”ç½‘åŸºç¡€ä¹‹ä¸Šçš„ä¸€å±‚æ™ºèƒ½è™šæ‹Ÿç½‘ç»œï¼ŒCDNç³»ç»Ÿèƒ½å¤Ÿå®æ—¶åœ°æ ¹æ®ç½‘ç»œæµé‡å’Œå„èŠ‚ç‚¹çš„è¿æ¥ã€è´Ÿè½½çŠ¶å†µä»¥åŠåˆ°ç”¨æˆ·çš„è·ç¦»å’Œå“åº”æ—¶é—´ç­‰ç»¼åˆä¿¡æ¯å°†ç”¨æˆ·çš„è¯·æ±‚é‡æ–°å¯¼å‘ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡èŠ‚ç‚¹ä¸Šã€‚<br>4ã€å…¶ç›®çš„æ˜¯ä½¿ç”¨æˆ·å¯å°±è¿‘å–å¾—æ‰€éœ€å†…å®¹ï¼Œè§£å†³ Internetç½‘ç»œæ‹¥æŒ¤çš„çŠ¶å†µï¼Œæé«˜ç”¨æˆ·è®¿é—®ç½‘ç«™çš„å“åº”é€Ÿåº¦**ã€‚<br>5ã€å†…å®¹åˆ†å‘ç½‘ç»œæ˜¯å»ºç«‹å¹¶è¦†ç›–åœ¨æ‰¿è½½ç½‘ä¹‹ä¸Šï¼Œç”±åˆ†å¸ƒåœ¨ä¸åŒåŒºåŸŸçš„è¾¹ç¼˜èŠ‚ç‚¹æœåŠ¡å™¨ç¾¤ç»„æˆçš„åˆ†å¸ƒå¼ç½‘ç»œã€‚</p>
<p>cdnçš„å·¥ä½œåŸç†ï¼š<br>CDNè¿™ä¸ªæŠ€æœ¯å…¶å®è¯´èµ·æ¥å¹¶ä¸å¤æ‚ï¼Œæœ€åˆçš„æ ¸å¿ƒç†å¿µï¼Œå°±æ˜¯å°†å†…å®¹ç¼“å­˜åœ¨ç»ˆç«¯ç”¨æˆ·é™„è¿‘ã€‚</p>
<p>å†…å®¹æºä¸æ˜¯è¿œä¹ˆï¼Ÿé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±åœ¨é è¿‘ç”¨æˆ·çš„åœ°æ–¹ï¼Œå»ºä¸€ä¸ªç¼“å­˜æœåŠ¡å™¨ï¼ŒæŠŠè¿œç«¯çš„å†…å®¹ï¼Œå¤åˆ¶ä¸€ä»½ï¼Œæ”¾åœ¨è¿™é‡Œï¼Œä¸å°±OKäº†ï¼Ÿ</p>
<p>å…·ä½“æ¥è¯´ï¼ŒCDNå°±æ˜¯é‡‡ç”¨æ›´å¤šçš„ç¼“å­˜æœåŠ¡å™¨ï¼ˆCDNè¾¹ç¼˜èŠ‚ç‚¹ï¼‰ï¼Œå¸ƒæ”¾åœ¨ç”¨æˆ·è®¿é—®ç›¸å¯¹é›†ä¸­çš„åœ°åŒºæˆ–ç½‘ç»œä¸­ã€‚å½“ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œåˆ©ç”¨å…¨å±€è´Ÿè½½æŠ€æœ¯ï¼Œå°†ç”¨æˆ·çš„è®¿é—®æŒ‡å‘è·ç¦»æœ€è¿‘çš„ç¼“å­˜æœåŠ¡å™¨ä¸Šï¼Œç”±ç¼“å­˜æœåŠ¡å™¨å“åº”ç”¨æˆ·è¯·æ±‚ã€‚ï¼ˆæœ‰ç‚¹åƒç”µå•†çš„æœ¬åœ°ä»“å§ï¼Ÿï¼‰</p>
<p>å¤§å®¶å¯èƒ½è§‰å¾—ï¼Œè¿™ä¸ªä¸å°±æ˜¯â€œé•œåƒæœåŠ¡å™¨â€å˜›ï¼Ÿå…¶å®ä¸ä¸€æ ·ã€‚é•œåƒæœåŠ¡å™¨æ˜¯æºå†…å®¹æœåŠ¡å™¨çš„å®Œæ•´å¤åˆ¶ã€‚è€ŒCDNï¼Œæ˜¯éƒ¨åˆ†å†…å®¹çš„ç¼“å­˜ï¼Œæ™ºèƒ½ç¨‹åº¦æ›´é«˜ã€‚</p>
<p><img src="/images/CDN.png"></p>
<p>å€Ÿç”¨é˜¿é‡Œäº‘å®˜ç½‘çš„ä¾‹å­ï¼Œæ¥ç®€å•ä»‹ç»CDNçš„å·¥ä½œåŸç†ã€‚</p>
<p>å‡è®¾é€šè¿‡CDNåŠ é€Ÿçš„åŸŸåä¸º <a href="http://www.a.comï¼Œæ¥å…¥CDNç½‘ç»œï¼Œå¼€å§‹ä½¿ç”¨åŠ é€ŸæœåŠ¡åï¼Œå½“ç»ˆç«¯ç”¨æˆ·ï¼ˆåŒ—äº¬ï¼‰å‘èµ·HTTPè¯·æ±‚æ—¶ï¼Œå¤„ç†æµç¨‹å¦‚ä¸‹ï¼š">www.a.comï¼Œæ¥å…¥CDNç½‘ç»œï¼Œå¼€å§‹ä½¿ç”¨åŠ é€ŸæœåŠ¡åï¼Œå½“ç»ˆç«¯ç”¨æˆ·ï¼ˆåŒ—äº¬ï¼‰å‘èµ·HTTPè¯·æ±‚æ—¶ï¼Œå¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</a></p>
<p>1ã€å½“ç»ˆç«¯ç”¨æˆ·ï¼ˆåŒ—äº¬ï¼‰å‘<a href="http://www.a.comä¸‹çš„æŒ‡å®šèµ„æºå‘èµ·è¯·æ±‚æ—¶,é¦–å…ˆå‘ldns(æœ¬åœ°dns)å‘èµ·åŸŸåè§£æè¯·æ±‚./">www.a.comä¸‹çš„æŒ‡å®šèµ„æºå‘èµ·è¯·æ±‚æ—¶ï¼Œé¦–å…ˆå‘LDNSï¼ˆæœ¬åœ°DNSï¼‰å‘èµ·åŸŸåè§£æè¯·æ±‚ã€‚</a></p>
<p>2ã€LDNSæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰<a href="http://www.a.comçš„ipåœ°å€è®°å½•.å¦‚æœæœ‰,åˆ™ç›´æ¥è¿”å›ç»™ç»ˆç«¯ç”¨æˆ·;å¦‚æœæ²¡æœ‰,åˆ™å‘æˆæƒdnsæŸ¥è¯¢./">www.a.comçš„IPåœ°å€è®°å½•ã€‚å¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥è¿”å›ç»™ç»ˆç«¯ç”¨æˆ·ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™å‘æˆæƒDNSæŸ¥è¯¢ã€‚</a></p>
<p>3ã€å½“æˆæƒDNSè§£æ<a href="http://www.a.comæ—¶,è¿”å›åŸŸåcname/">www.a.comæ—¶ï¼Œè¿”å›åŸŸåCNAME</a> <a href="http://www.a.tbcdn.comå¯¹åº”ipåœ°å€./">www.a.tbcdn.comå¯¹åº”IPåœ°å€ã€‚</a></p>
<p>4ã€åŸŸåè§£æè¯·æ±‚å‘é€è‡³é˜¿é‡Œäº‘DNSè°ƒåº¦ç³»ç»Ÿï¼Œå¹¶ä¸ºè¯·æ±‚åˆ†é…æœ€ä½³èŠ‚ç‚¹IPåœ°å€ã€‚</p>
<p>5ã€LDNSè·å–DNSè¿”å›çš„è§£æIPåœ°å€ã€‚</p>
<p>6ã€ç”¨æˆ·è·å–è§£æIPåœ°å€ã€‚</p>
<p>7ã€ç”¨æˆ·å‘è·å–çš„IPåœ°å€å‘èµ·å¯¹è¯¥èµ„æºçš„è®¿é—®è¯·æ±‚ã€‚</p>
<p>8ã€å¦‚æœè¯¥IPåœ°å€å¯¹åº”çš„èŠ‚ç‚¹å·²ç¼“å­˜è¯¥èµ„æºï¼Œåˆ™ä¼šå°†æ•°æ®ç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œä¾‹å¦‚ï¼Œå›¾ä¸­æ­¥éª¤7å’Œ8ï¼Œè¯·æ±‚ç»“æŸã€‚</p>
<p>9ã€å¦‚æœè¯¥IPåœ°å€å¯¹åº”çš„èŠ‚ç‚¹æœªç¼“å­˜è¯¥èµ„æºï¼Œåˆ™èŠ‚ç‚¹å‘æºç«™å‘èµ·å¯¹è¯¥èµ„æºçš„è¯·æ±‚ã€‚è·å–èµ„æºåï¼Œç»“åˆç”¨æˆ·è‡ªå®šä¹‰é…ç½®çš„ç¼“å­˜ç­–ç•¥ï¼Œå°†èµ„æºç¼“å­˜è‡³èŠ‚ç‚¹ï¼Œä¾‹å¦‚ï¼Œå›¾ä¸­çš„åŒ—äº¬èŠ‚ç‚¹ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·ï¼Œè¯·æ±‚ç»“æŸã€‚</p>
<p>æ‰€ä»¥ï¼š<br>ï¼ˆ1ï¼‰CDNçš„åŠ é€Ÿèµ„æºæ˜¯è·ŸåŸŸåç»‘å®šçš„ã€‚<br>ï¼ˆ2ï¼‰é€šè¿‡åŸŸåè®¿é—®èµ„æºï¼Œé¦–å…ˆæ˜¯é€šè¿‡DNSåˆ†æŸ¥æ‰¾ç¦»ç”¨æˆ·æœ€è¿‘çš„CDNèŠ‚ç‚¹ï¼ˆè¾¹ç¼˜æœåŠ¡å™¨ï¼‰çš„IP<br>ï¼ˆ3ï¼‰é€šè¿‡IPè®¿é—®å®é™…èµ„æºæ—¶ï¼Œå¦‚æœCDNä¸Šå¹¶æ²¡æœ‰ç¼“å­˜èµ„æºï¼Œåˆ™ä¼šåˆ°æºç«™è¯·æ±‚èµ„æºï¼Œå¹¶ç¼“å­˜åˆ°CDNèŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·ï¼Œç”¨æˆ·ä¸‹ä¸€æ¬¡è®¿é—®æ—¶ï¼Œè¯¥CDNèŠ‚ç‚¹å°±ä¼šæœ‰å¯¹åº”èµ„æºçš„ç¼“å­˜äº†ã€‚</p>
<hr>
<p>nginxè´Ÿè½½å‡è¡¡ï¼šè´Ÿè½½å‡è¡¡å®é™…ä¸Šå°±æ˜¯å°†å¤§é‡è¯·æ±‚è¿›è¡Œåˆ†å¸ƒå¼å¤„ç†çš„ç­–ç•¥</p>
<p>Nginx ä½œä¸ºä¸€ä¸ªåŸºäº C å®ç°çš„é«˜æ€§èƒ½ Web æœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡ç³»åˆ—ç®—æ³•è§£å†³ä¸Šè¿°çš„è´Ÿè½½å‡è¡¡é—®é¢˜ã€‚å¹¶ä¸”ç”±äºå®ƒå…·æœ‰é«˜å¹¶å‘ã€é«˜å¯é æ€§ã€é«˜æ‰©å±•æ€§ã€å¼€æºç­‰ç‰¹ç‚¹ï¼Œæˆä¸ºå¼€å‘äººå‘˜å¸¸ç”¨çš„åå‘ä»£ç†å·¥å…·</p>
<p>1ã€æ­£å‘ä»£ç†</p>
<p>æ­£å‘ä»£ç†ï¼ˆForward Proxyï¼‰æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼Œå®¢æˆ·ç«¯éå¸¸æ˜ç¡®è¦è®¿é—®çš„æœåŠ¡å™¨åœ°å€ï¼Œå®ƒä»£ç†å®¢æˆ·ç«¯ï¼Œæ›¿å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ã€‚æ¯”å¦‚ï¼šç§‘å­¦ä¸Šç½‘ã€‚</p>
<p>å‡è®¾å®¢æˆ·ç«¯æƒ³è¦è®¿é—® Googleï¼Œå®ƒæ˜ç¡®çŸ¥é“å¾…è®¿é—®çš„æœåŠ¡å™¨åœ°å€æ˜¯ <a href="https://www.google.com/%EF%BC%8C%E4%BD%86%E7%94%B1%E4%BA%8E%E6%9D%A1%E4%BB%B6%E9%99%90%E5%88%B6%EF%BC%8C%E5%AE%83%E6%89%BE%E6%9D%A5%E4%BA%86%E4%B8%80%E4%B8%AA%E8%83%BD%E5%A4%9F%E8%AE%BF%E9%97%AE%E5%88%B0">https://www.google.com/ï¼Œä½†ç”±äºæ¡ä»¶é™åˆ¶ï¼Œå®ƒæ‰¾æ¥äº†ä¸€ä¸ªèƒ½å¤Ÿè®¿é—®åˆ°</a> Google çš„â€æœ‹å‹â€ï¼šä»£ç†æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯æŠŠè¯·æ±‚å‘ç»™ä»£ç†æœåŠ¡å™¨ï¼Œç”±ä»£ç†æœåŠ¡å™¨ä»£æ›¿å®ƒè¯·æ±‚ Googleï¼Œæœ€ç»ˆå†å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¾¿æ˜¯ä¸€æ¬¡æ­£å‘ä»£ç†çš„è¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹ä¸­æœåŠ¡å™¨å¹¶ä¸çŸ¥é“çœŸæ­£å‘å‡ºè¯·æ±‚çš„æ˜¯è°ã€‚<br>ï¼ˆå®¢æˆ·ç«¯ - æ­£å‘ä»£ç† - æœåŠ¡å™¨ï¼‰</p>
<p>2ã€åå‘ä»£ç†</p>
<p>éšç€è¯·æ±‚é‡çš„çˆ†å‘å¼å¢é•¿ï¼ŒæœåŠ¡å™¨è§‰å¾—è‡ªå·±ä¸€ä¸ªäººå§‹ç»ˆæ˜¯åº”ä»˜ä¸è¿‡æ¥ï¼Œéœ€è¦å…„å¼ŸæœåŠ¡å™¨ä»¬å¸®å¿™ï¼Œäºæ˜¯å®ƒå–Šæ¥äº†è‡ªå·±çš„å…„å¼Ÿä»¥åŠä»£ç†æœåŠ¡å™¨æœ‹å‹ã€‚æ­¤æ—¶ï¼Œæ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„æ‰€æœ‰è¯·æ±‚å®é™…ä¸Šéƒ½å‘åˆ°äº†ä»£ç†æœåŠ¡å™¨å¤„ï¼Œå†ç”±ä»£ç†æœåŠ¡å™¨æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å°†è¯·æ±‚åˆ†å‘ç»™å„ä¸ªæœåŠ¡å™¨ã€‚è¿™å°±æ˜¯åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰ï¼Œåå‘ä»£ç†éšè—äº†æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œå®ƒä»£ç†çš„æ˜¯æœåŠ¡å™¨ç«¯ï¼Œä»£å…¶æ¥æ”¶è¯·æ±‚ã€‚æ¢å¥è¯è¯´ï¼Œåå‘ä»£ç†çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“å…·ä½“æ˜¯å“ªå°æœåŠ¡å™¨å¤„ç†äº†è‡ªå·±çš„è¯·æ±‚ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæ—¢æé«˜äº†è®¿é—®é€Ÿåº¦ï¼Œåˆä¸ºå®‰å…¨æ€§æä¾›äº†ä¿è¯<br>ï¼ˆä¸€å †å®¢æˆ·ç«¯ - åå‘ä»£ç† - ä¸€å †æœåŠ¡å™¨ï¼‰</p>
<p>åœ¨è¿™ä¹‹ä¸­ï¼Œåå‘ä»£ç†éœ€è¦è€ƒè™‘çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•è¿›è¡Œå‡è¡¡åˆ†å·¥ï¼Œæ§åˆ¶æµé‡ï¼Œé¿å…å‡ºç°å±€éƒ¨èŠ‚ç‚¹è´Ÿè½½è¿‡å¤§çš„é—®é¢˜ã€‚é€šä¿—çš„è®²ï¼Œå°±æ˜¯å¦‚ä½•ä¸ºæ¯å°æœåŠ¡å™¨åˆç†çš„åˆ†é…è¯·æ±‚ï¼Œä½¿å…¶æ•´ä½“å…·æœ‰æ›´é«˜çš„å·¥ä½œæ•ˆç‡å’Œèµ„æºåˆ©ç”¨ç‡ã€‚</p>
<p>3ã€è´Ÿè½½å‡è¡¡å¸¸ç”¨ç®—æ³•</p>
<p>è½®è¯¢ ï¼ˆround-robinï¼‰<br>è½®è¯¢ä¸ºè´Ÿè½½å‡è¡¡ä¸­è¾ƒä¸ºåŸºç¡€ä¹Ÿè¾ƒä¸ºç®€å•çš„ç®—æ³•ï¼Œå®ƒä¸éœ€è¦é…ç½®é¢å¤–å‚æ•°ã€‚å‡è®¾é…ç½®æ–‡ä»¶ä¸­å…±æœ‰ å°æœåŠ¡å™¨ï¼Œè¯¥ç®—æ³•éå†æœåŠ¡å™¨èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¹¶æŒ‰èŠ‚ç‚¹æ¬¡åºæ¯è½®é€‰æ‹©ä¸€å°æœåŠ¡å™¨å¤„ç†è¯·æ±‚ã€‚å½“æ‰€æœ‰èŠ‚ç‚¹å‡è¢«è°ƒç”¨è¿‡ä¸€æ¬¡åï¼Œè¯¥ç®—æ³•å°†ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹é‡æ–°ä¸€è½®éå†ã€‚ç‰¹ç‚¹ï¼šç”±äºè¯¥ç®—æ³•ä¸­æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨å¤„ç†ï¼Œå› æ­¤é€‚ç”¨äºæœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘çš„é›†ç¾¤æƒ…å†µï¼Œå…¶ä¸­æ¯ä¸ªæœåŠ¡å™¨æ‰¿è½½ç›¸åŒçš„è´Ÿè½½ã€‚ä½†å¯¹äºæœåŠ¡å™¨æ€§èƒ½ä¸åŒçš„é›†ç¾¤è€Œè¨€ï¼Œè¯¥ç®—æ³•å®¹æ˜“å¼•å‘èµ„æºåˆ†é…ä¸åˆç†ç­‰é—®é¢˜ã€‚</p>
<p>åŠ æƒè½®è¯¢<br>ä¸ºäº†é¿å…æ™®é€šè½®è¯¢å¸¦æ¥çš„å¼Šç«¯ï¼ŒåŠ æƒè½®è¯¢åº”è¿è€Œç”Ÿã€‚åœ¨åŠ æƒè½®è¯¢ä¸­ï¼Œæ¯ä¸ªæœåŠ¡å™¨ä¼šæœ‰å„è‡ªçš„ weightã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œweight çš„å€¼è¶Šå¤§æ„å‘³ç€è¯¥æœåŠ¡å™¨çš„æ€§èƒ½è¶Šå¥½ï¼Œå¯ä»¥æ‰¿è½½æ›´å¤šçš„è¯·æ±‚ã€‚è¯¥ç®—æ³•ä¸­ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚æŒ‰æƒå€¼æ¯”ä¾‹åˆ†é…ï¼Œå½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æ—¶ï¼Œä¼˜å…ˆä¸ºå…¶åˆ†é…æƒå€¼æœ€å¤§çš„æœåŠ¡å™¨ã€‚ç‰¹ç‚¹ï¼šåŠ æƒè½®è¯¢å¯ä»¥åº”ç”¨äºæœåŠ¡å™¨æ€§èƒ½ä¸ç­‰çš„é›†ç¾¤ä¸­ï¼Œä½¿èµ„æºåˆ†é…æ›´åŠ åˆç†åŒ–ã€‚</p>
<p>IP å“ˆå¸Œï¼ˆIP hashï¼‰<br>ip_hash ä¾æ®å‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯ IP çš„ hash å€¼æ¥åˆ†é…æœåŠ¡å™¨ï¼Œè¯¥ç®—æ³•å¯ä»¥ä¿è¯åŒ IP å‘å‡ºçš„è¯·æ±‚æ˜ å°„åˆ°åŒä¸€æœåŠ¡å™¨ï¼Œæˆ–è€…å…·æœ‰ç›¸åŒ hash å€¼çš„ä¸åŒ IP æ˜ å°„åˆ°åŒä¸€æœåŠ¡å™¨ã€‚ç‰¹ç‚¹ï¼šè¯¥ç®—æ³•åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†é›†ç¾¤éƒ¨ç½²ç¯å¢ƒä¸‹ Session ä¸å…±äº«çš„é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥ï¼š<br>Nginx ä½œä¸ºä¸€æ¬¾ä¼˜ç§€çš„åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„è´Ÿè½½å‡è¡¡ç®—æ³•æ¥è§£å†³è¯·æ±‚é‡è¿‡å¤§æƒ…å†µä¸‹çš„æœåŠ¡å™¨èµ„æºåˆ†é…é—®é¢˜ã€‚è¾ƒä¸ºå¸¸è§çš„è´Ÿè½½å‡è¡¡ç®—æ³•æœ‰è½®è¯¢ã€åŠ æƒè½®è¯¢ã€IP å“ˆå¸Œç­‰ç­‰ï¼Œå¯åˆ†åˆ«åº”å¯¹ä¸åŒçš„è¯·æ±‚åœºæ™¯ã€‚</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>å¥½æ–‡ç« ï¼šä»å¯¹CDNçš„ç†è§£åˆ°Nginxè´Ÿè½½å‡è¡¡<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_40409143/article/details/118330238">https://blog.csdn.net/qq_40409143/article/details/118330238</a></p>
<h3 id="âœ…nginxä¸RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#âœ…nginxä¸RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="âœ…nginxä¸RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>âœ…nginxä¸RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><p>RPCæ˜¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ˜¯ä¸€ç§è®¡ç®—æœºé€šä¿¡æ€æƒ³ã€‚</p>
<p>nginxæ˜¯ä»£ç†æœåŠ¡å™¨ã€‚å®ƒå¯ä»¥ä¸ºåç«¯åˆ†å¸ƒå¼æœåŠ¡æä¾›è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å°†åç«¯å¤šä¸ªæœåŠ¡åœ°å€èšåˆä¸ºå•ä¸ªåœ°å€æ¥å¯¹å¤–æä¾›æœåŠ¡ã€‚</p>
<p>Nginx å’Œåç«¯æœåŠ¡ä¹‹é—´çš„äº¤äº’åœ¨æœ¬è´¨ä¸Šä¹Ÿå¯ä»¥ç†è§£ä¸º RPC æ•°æ®äº¤äº’ã€‚ä¹Ÿè®¸ä½ ä¼šäº‰è¾©è¯´ Nginx å’Œåç«¯æœåŠ¡ä¹‹é—´ä½¿ç”¨çš„æ˜¯ HTTP åè®®ï¼Œèµ°çš„æ˜¯çŸ­è¿æ¥ï¼Œä¸¥æ ¼ä¸Šä¸èƒ½ç®—æ˜¯ RPC è°ƒç”¨ã€‚ Nginx å’Œåç«¯æœåŠ¡ä¹‹é—´è¿˜å¯ä»¥èµ°å…¶å®ƒçš„åè®®ï¼Œæ¯”å¦‚ uwsgi åè®®ã€fastcgi åè®®ç­‰ï¼Œè¿™ä¸¤ä¸ªåè®®éƒ½æ˜¯é‡‡ç”¨äº†æ¯” HTTP åè®®æ›´åŠ èŠ‚çœæµé‡çš„äºŒè¿›åˆ¶åè®®ã€‚</p>
<p>è®²RPCã€RPCä¸nginxã€RPCä¸HTTPé—´çš„å…³ç³»çš„å¥½æ–‡ç« ï¼š<br><a href="https://www.kancloud.cn/machh03/server/2096716">https://www.kancloud.cn/machh03/server/2096716</a></p>
<h3 id="âœ…ä¸gatewayæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#âœ…ä¸gatewayæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="âœ…ä¸gatewayæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>âœ…ä¸gatewayæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><p>ç½‘å…³(Gateway)å°±æ˜¯ä¸€ä¸ªç½‘ç»œè¿æ¥åˆ°å¦ä¸€ä¸ªç½‘ç»œçš„â€œå…³å£â€ã€‚</p>
<p><img src="/images/gateway.png"></p>
<p>1ã€nginxä¹Ÿå¯ä»¥åšç½‘å…³ï¼Œæ˜¯ç”¨æˆ·è®¿é—®çš„æ€»å…¥å£ï¼Œä¹Ÿå°±æ˜¯å‰ç«¯é¡µé¢çš„å®¹å™¨ï¼Œæµé‡ç½‘å…³ã€‚</p>
<p>æµé‡ç½‘å…³æ˜¯å®šä¹‰å…¨å±€æ€§çš„ã€è·Ÿå…·ä½“çš„åç«¯ä¸šåŠ¡åº”ç”¨å’ŒæœåŠ¡å®Œå…¨æ— å…³çš„ç­–ç•¥ç½‘å…³ã€‚<br>æµé‡ç½‘å…³é€šå¸¸åªä¸“æ³¨äºå…¨å±€çš„Apiç®¡ç†ç­–ç•¥ï¼Œæ¯”å¦‚å…¨å±€æµé‡ç›‘æ§ã€æ—¥å¿—è®°å½•ã€å…¨å±€é™æµã€é»‘ç™½åå•æ§åˆ¶ã€æ¥å…¥è¯·æ±‚åˆ°ä¸šåŠ¡ç³»ç»Ÿçš„è´Ÿè½½å‡è¡¡ç­‰ï¼Œæœ‰ç‚¹ç±»ä¼¼é˜²ç«å¢™ã€‚</p>
<p>2ã€gatewayçš„å®šä¹‰æ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªä¸šåŠ¡å¾®æœåŠ¡æ¥å¾—ï¼Œå±äºä¸šåŠ¡ç½‘å…³ã€‚æ˜¯ä»‹äºnignxä»¥åŠä¸šåŠ¡åº”ç”¨ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œä¸»è¦è´Ÿè´£å°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„å¾®æœåŠ¡ä¸­ä»¥åŠå¯¹è¯·æ±‚çš„åˆæ³•æ€§è¿›è¡Œæ ¡éªŒã€‚</p>
<p>ä¸šåŠ¡ç½‘å…³é’ˆå¯¹å…·ä½“çš„ä¸šåŠ¡éœ€è¦æä¾›ç‰¹å®šçš„æµæ§ç­–ç•¥ã€ç¼“å­˜ç­–ç•¥ã€é‰´æƒè®¤è¯ç­–ç•¥ç­‰ç­‰ã€‚<br>ä¸šåŠ¡ç½‘å…³ä¸€èˆ¬éƒ¨ç½²åœ¨æµé‡ç½‘å…³ä¹‹åã€ä¸šåŠ¡ç³»ç»Ÿä¹‹å‰ï¼Œæ¯”æµé‡ç½‘å…³æ›´é è¿‘ä¸šåŠ¡ç³»ç»Ÿã€‚é€šå¸¸APIç½‘æŒ‡çš„æ˜¯ä¸šåŠ¡ç½‘å…³ã€‚ æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿä¼šæ¨¡ç³Šæµé‡ç½‘å…³å’Œä¸šåŠ¡ç½‘å…³ï¼Œè®©ä¸€ä¸ªç½‘å…³æ‰¿æ‹…æ‰€æœ‰çš„å·¥ä½œ,æ‰€ä»¥è¿™ä¸¤è€…ä¹‹é—´å¹¶æ²¡æœ‰ä¸¥æ ¼çš„ç•Œçº¿ã€‚</p>
<hr>
<p>ç½‘å…³å¯ä»¥çœ‹åšç³»ç»Ÿä¸å¤–ç•Œè”é€šçš„å…¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç½‘å…³è¿›è¡Œå¤„ç†ä¸€äº›éä¸šåŠ¡é€»è¾‘çš„é€»è¾‘ï¼Œæ¯”å¦‚æƒé™éªŒè¯ï¼Œç›‘æ§ï¼Œç¼“å­˜ï¼Œè¯·æ±‚è·¯ç”±ç­‰ç­‰ã€‚</p>
<p>1ã€nginxæ˜¯ç”¨æˆ·åˆ° å‰ç«¯å·¥ç¨‹ çš„ç½‘å…³ï¼Œå¯¹å¤–ç½‘å…³<br>nginxæ˜¯ç”¨Cè¯­è¨€å†™çš„<br>nginxåšç½‘å…³ï¼Œæ›´å¤šçš„æ˜¯åšæ€»æµé‡å…¥å£ï¼Œåå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡ç­‰ï¼Œè¿˜å¯ä»¥ç”¨æ¥åšwebæœåŠ¡å™¨ã€‚<br>Nginxåœ¨å…¶ä¸­æ‰®æ¼”çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ<br>åå‘ä»£ç†<br>è´Ÿè½½å‡è¡¡</p>
<p>2ã€gateway æ˜¯å‰ç«¯å·¥ç¨‹ åˆ° åå°æœåŠ¡å™¨ä¹‹é—´çš„ä¸€ä¸ª å¯¹å†…ç½‘å…³<br>gatewayæ˜¯javaè¯­è¨€çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥åœ¨æ¡†æ¶ä¸Šè¿›è¡Œä»£ç çš„æ‰©å±•ä¸æ§åˆ¶ï¼Œä¾‹å¦‚ï¼šå®‰å…¨æ§åˆ¶ï¼Œç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ŒXXS,SQLæ³¨å…¥ç­‰ï¼›æƒé™æ§åˆ¶ï¼Œé»‘ç™½åå•ï¼Œæ€§èƒ½ç›‘æ§ï¼Œæ—¥å¿—æ‰“å°ç­‰<br>gatewayçš„ä¸»è¦åŠŸèƒ½æœ‰ï¼Œè·¯ç”±ï¼Œæ–­è¨€ï¼Œè¿‡æ»¤å™¨ï¼Œåˆ©ç”¨å®ƒçš„è¿™äº›ç‰¹æ€§ï¼Œå¯ä»¥åšæµæ§ã€‚<br>SpringGatewayåœ¨å…¶ä¸­æ‰®æ¼”çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ<br>ç»Ÿä¸€é‰´æƒ</p>
<p>nginxä¸gatewayï¼š<a href="https://blog.csdn.net/yangbindxj/article/details/125040773">https://blog.csdn.net/yangbindxj/article/details/125040773</a></p>
<hr>
<p>ç½‘å…³æœåŠ¡çš„ç«¯å£å·é»˜è®¤æ˜¯80æˆ–è€…443.<br>ç›¸åŒç‚¹ï¼šéƒ½æ˜¯å¯ä»¥å®ç°å¯¹apiæ¥å£çš„æ‹¦æˆªï¼Œè´Ÿè½½å‡è¡¡ã€åå‘ä»£ç†ã€è¯·æ±‚è¿‡æ»¤ç­‰ï¼Œå¯ä»¥å®ç°å’Œç½‘å…³ä¸€æ ·çš„æ•ˆæœã€‚<br>Nginxå®ç°è´Ÿè½½å‡è¡¡çš„åŸç†å±äºæœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡å™¨ã€‚<br>Gatewayå®ç°è´Ÿè½½å‡è¡¡åŸç†é‡‡ç”¨æœ¬åœ°è´Ÿè½½å‡è¡¡å™¨çš„å½¢å¼ã€‚</p>
<h3 id="âœ…nginxä¸ç»Ÿä¸€æ¥å…¥æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#âœ…nginxä¸ç»Ÿä¸€æ¥å…¥æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="âœ…nginxä¸ç»Ÿä¸€æ¥å…¥æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>âœ…nginxä¸ç»Ÿä¸€æ¥å…¥æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><p>ç»Ÿä¸€æ¥å…¥å±‚æ˜¯ï¼šæŒ‡çš„æ˜¯è®¾ç½®ä¸“å±ä¸€å±‚ï¼Œç»Ÿä¸€æ¥å…¥æ‰€æœ‰æµé‡ï¼ŒåŒ…æ‹¬ PC æµé‡ã€æ— çº¿æµé‡ã€IoT æµé‡ã€‚åœ¨åº”ç”¨å±‚ä¹‹ä¸Šçš„ä¸€å±‚ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç»Ÿä¸€æ¥å…¥å±‚ï¼Œä¹‹å‰çš„ä¸šåŠ¡æ–¹ï¼Œä¾‹å¦‚è´­ç‰©è½¦ã€å•†å“ç­‰éƒ½è¦è‡ªå·±ç»´æŠ¤ä¸€ä¸ªç½‘å…³ï¼Œè¿™å°±æ¶‰åŠåˆ°ç»´æŠ¤æˆæœ¬å’Œæœºå™¨æˆæœ¬ã€‚ä¾‹å¦‚å¸è½½ HTTPSï¼Œå¦‚æœæ‰€æœ‰ä¸šåŠ¡æ–¹éƒ½è¦ç”³è¯·è¯ä¹¦ï¼Œé‚£é€ æˆçš„åº”ç”¨æˆæœ¬æ˜¯éå¸¸é«˜çš„ã€‚å¯å¦‚æœå°†æ‰€æœ‰åŠŸèƒ½å…¨æ”¾åœ¨è¿™ä¸€å±‚è¿›è¡Œï¼Œå¥½å¤„éå¸¸æ˜æ˜¾ï¼šä¸€æ–¹é¢æ˜¯æœºå™¨é›†ä¸­ç®¡ç†èŠ‚çœæˆæœ¬ï¼›å¦å¤–ä¸€æ–¹é¢ï¼Œå¦‚æœé‡åˆ°æ–°çš„ç“¶é¢ˆå¯ä»¥åœ¨ç»Ÿä¸€æ¥å…¥å±‚é›†ä¸­ä¼˜åŒ–ï¼Œå¦‚è¯·æ±‚å“åº” Body ç»Ÿä¸€åœ¨è¿™ä¸€å±‚è¿›è¡Œå‹ç¼©å‡å°‘å¸¦å®½æ¶ˆè€—ï¼Œå‹ç¼©ä¼šæ¶ˆè€— CPUï¼Œå¯ä»¥åœ¨è¿™ä¸€å±‚é€šè¿‡ç¡¬ä»¶åŠ é€Ÿçš„æ–¹å¼é›†ä¸­ä¼˜åŒ–ç­‰ã€‚</p>
<p>é˜¿é‡Œç»Ÿä¸€æ¥å…¥å±‚ï¼š<a href="https://zhuanlan.zhihu.com/p/96510277?hmsr=toutiao.io">https://zhuanlan.zhihu.com/p/96510277?hmsr=toutiao.io</a></p>
<p>ç»Ÿä¸€æ¥å…¥å±‚æ–¹æ¡ˆï¼š<a href="https://www.cnblogs.com/Leo_wl/archive/2012/10/17/2728541.html">https://www.cnblogs.com/Leo_wl/archive/2012/10/17/2728541.html</a></p>
<p>ç»Ÿä¸€æ¥å…¥å±‚æ˜¯ç½‘å…³ä¸­æœ€å‰ç«¯çš„æœåŠ¡ï¼Œç»Ÿä¸€æ¥å…¥åˆ°é›†ç¾¤ä¸­ã€‚<br>æ‰€ä»¥ï¼Œç»Ÿä¸€æ¥å…¥å±‚åº”è¯¥æ˜¯åœ¨webä»£ç†æœåŠ¡å™¨nginxå‰çš„ã€‚</p>
<h2 id="nginxé…ç½®"><a href="#nginxé…ç½®" class="headerlink" title="nginxé…ç½®"></a>nginxé…ç½®</h2><h3 id="nginxé…ç½®æ–‡ä»¶ç»“æ„"><a href="#nginxé…ç½®æ–‡ä»¶ç»“æ„" class="headerlink" title="nginxé…ç½®æ–‡ä»¶ç»“æ„"></a>nginxé…ç½®æ–‡ä»¶ç»“æ„</h3><p>Main ä½äº nginx.conf é…ç½®æ–‡ä»¶çš„æœ€é«˜å±‚ï¼›<br>Main å±‚ä¸‹å¯ä»¥æœ‰ Eventã€HTTP å±‚ï¼›<br>Http å±‚ä¸‹é¢å…è®¸æœ‰å¤šä¸ª Server å±‚ï¼Œç”¨äºå¯¹ä¸åŒçš„ç½‘ç«™åšä¸åŒçš„é…ç½®ï¼›<br>Server å±‚ä¸‹é¢å…è®¸æœ‰å¤šä¸ª Locationï¼Œç”¨äºå¯¹ä¸åŒçš„è·¯å¾„è¿›è¡Œä¸åŒæ¨¡å—çš„é…ç½®ã€‚</p>
<p>1ã€mainï¼ˆæœ€ä¸Šé¢ï¼‰<br>å…¨å±€é…ç½®éƒ¨åˆ†ç”¨æ¥é…ç½®å¯¹æ•´ä¸ª server éƒ½æœ‰æ•ˆçš„å‚æ•°ã€‚ä¸»è¦ä¼šè®¾ç½®ä¸€äº›å½±å“ nginx æœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤ï¼Œä¸»è¦åŒ…æ‹¬é…ç½®è¿è¡Œ Nginx æœåŠ¡å™¨çš„ç”¨æˆ·ï¼ˆç»„ï¼‰ã€å…è®¸ç”Ÿæˆçš„ worker process æ•°ï¼Œè¿›ç¨‹ PID å­˜æ”¾è·¯å¾„ã€æ—¥å¿—å­˜æ”¾è·¯å¾„å’Œç±»å‹ä»¥ åŠé…ç½®æ–‡ä»¶çš„å¼•å…¥ç­‰<br>å…¨å±€Mainé…ç½®<br>user nginx;<br>worker_processes 1; #è®¾ç½®å€¼å’ŒCPUæ ¸å¿ƒæ•°ä¸€è‡´</p>
<p>error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log warn; #æ—¥å¿—ä½ç½®å’Œæ—¥å¿—çº§åˆ«<br>pid       &#x2F;var&#x2F;run&#x2F;nginx.pid;</p>
<p>2.event<br>events å—æ¶‰åŠçš„æŒ‡ä»¤ä¸»è¦å½±å“ Nginx æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼Œå¸¸ç”¨çš„è®¾ç½®åŒ…æ‹¬æ˜¯å¦å¼€å¯å¯¹å¤š worker process ä¸‹çš„ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ¯ä¸ª worker process å¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ç­‰ã€‚<br>Eventé…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ã€http<br>http å…¨å±€å—é…ç½®çš„æŒ‡ä»¤åŒ…æ‹¬æ–‡ä»¶å¼•å…¥ã€MIME-TYPE å®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€è¿æ¥è¶…æ—¶æ—¶é—´ã€å•é“¾æ¥è¯·æ±‚æ•°ä¸Šé™ç­‰ã€‚<br>httpé…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  include       /etc/nginx/mime.types;</span><br><span class="line">  default_type application/octet-stream;</span><br><span class="line">  log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                    &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                    &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">  access_log /var/log/nginx/access.log main;</span><br><span class="line">  sendfile       on;</span><br><span class="line">  #tcp_nopush     on;</span><br><span class="line">  keepalive_timeout 65;</span><br><span class="line">  #gzip on;</span><br><span class="line">  include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4ã€server<br>Server å—ä¹Ÿè¢«å«åšâ€œè™šæ‹Ÿä¸»æœºâ€éƒ¨åˆ†ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ç»„æ ¹æ®ä¸åŒ server_name æŒ‡ä»¤é€»è¾‘åˆ†å‰²çš„èµ„æºï¼Œè¿™äº›è™šæ‹ŸæœåŠ¡å™¨å“åº” HTTP è¯·æ±‚ï¼Œå› æ­¤éƒ½åŒ…å«åœ¨ http éƒ¨åˆ†ã€‚æœ€å¸¸è§çš„é…ç½®æ˜¯æœ¬è™šæ‹Ÿæœºä¸»æœºçš„ç›‘å¬é…ç½®å’Œæœ¬è™šæ‹Ÿä¸»æœºçš„åç§°æˆ– IP é…ç½®ã€‚ä¸€ä¸ª server å—å¯ä»¥é…ç½®å¤šä¸ª location å—ã€‚<br>serveré…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen       80;</span><br><span class="line">  server_name localhost;</span><br><span class="line">  location / &#123;</span><br><span class="line">      root   /usr/share/nginx/html;</span><br><span class="line">      index index.html index.htm;</span><br><span class="line">  &#125;</span><br><span class="line">  error_page   500 502 503 504 /50x.html;</span><br><span class="line">  location = /50x.html &#123;</span><br><span class="line">      root   /usr/share/nginx/html;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nginxé…ç½®ç»“æ„ï¼š<a href="https://baijiahao.baidu.com/s?id=1729793004418584302&wfr=spider&for=pc">https://baijiahao.baidu.com/s?id=1729793004418584302&amp;wfr=spider&amp;for=pc</a></p>
<p>èœé¸Ÿnginxé…ç½®ï¼š<a href="https://www.runoob.com/w3cnote/nginx-setup-intro.html">https://www.runoob.com/w3cnote/nginx-setup-intro.html</a></p>
<p>nginxé…ç½®è¯¦ç»†ä»‹ç»ï¼š<a href="https://blog.51cto.com/u_12218973/2457715">https://blog.51cto.com/u_12218973/2457715</a></p>
<h3 id="nginxè¶…æ—¶é…ç½®"><a href="#nginxè¶…æ—¶é…ç½®" class="headerlink" title="nginxè¶…æ—¶é…ç½®"></a>nginxè¶…æ—¶é…ç½®</h3><p>Nginxä¸»è¦æœ‰å››ç±»è¶…æ—¶è®¾ç½®ï¼šå®¢æˆ·ç«¯è¶…æ—¶è®¾ç½®ã€DNSè§£æè¶…æ—¶è®¾ç½®ã€ä»£ç†è¶…æ—¶è®¾ç½®ï¼Œå¦‚æœä½¿ç”¨ngx_luaï¼Œåˆ™è¿˜æœ‰luaç›¸å…³çš„è¶…æ—¶è®¾ç½®ã€‚</p>
<p>1ã€å®¢æˆ·ç«¯è¶…æ—¶</p>
<p>å®¢æˆ·ç«¯è¶…æ—¶ä¸»è¦è®¾ç½®æœ‰è¯»å–è¯·æ±‚å¤´è¶…æ—¶æ—¶é—´ã€è¯»å–è¯·æ±‚ä½“è¶…æ—¶æ—¶é—´ã€å‘é€å“åº”è¶…æ—¶æ—¶é—´ã€é•¿è¿æ¥è¶…æ—¶æ—¶é—´ã€‚é€šè¿‡å®¢æˆ·ç«¯è¶…æ—¶è®¾ç½®é¿å…å®¢æˆ·ç«¯æ¶æ„æˆ–è€…ç½‘ç»œçŠ¶å†µä¸ä½³é€ æˆè¿æ¥é•¿æœŸå ç”¨ï¼Œå½±å“æœåŠ¡ç«¯çš„å¯å¤„ç†çš„èƒ½åŠ›ã€‚</p>
<p><strong>client_header_timeout time</strong>ï¼šè®¾ç½®è¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º60sï¼Œå¦‚æœåœ¨æ­¤è¶…æ—¶æ—¶é—´å†…å®¢æˆ·ç«¯æ²¡æœ‰å‘é€å®Œè¯·æ±‚å¤´ï¼Œåˆ™å“åº”408ï¼ˆRequestTime-outï¼‰çŠ¶æ€ç ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><strong>client_body_timeout time</strong>ï¼šè®¾ç½®è¯»å–å®¢æˆ·ç«¯å†…å®¹ä½“è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º60sï¼Œæ­¤è¶…æ—¶æ—¶é—´æŒ‡çš„æ˜¯ä¸¤æ¬¡æˆåŠŸè¯»æ“ä½œé—´éš”æ—¶é—´ï¼Œè€Œä¸æ˜¯å‘é€æ•´ä¸ªè¯·æ±‚ä½“çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœåœ¨æ­¤è¶…æ—¶æ—¶é—´å†…å®¢æˆ·ç«¯æ²¡æœ‰å‘é€ä»»ä½•è¯·æ±‚ä½“ï¼Œåˆ™å“åº”408ï¼ˆRequestTime-outï¼‰çŠ¶æ€ç ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><strong>send_timeout time</strong>ï¼šè®¾ç½®å‘é€å“åº”åˆ°å®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º60sï¼Œæ­¤è¶…æ—¶æ—¶é—´æŒ‡çš„ä¹Ÿæ˜¯ä¸¤æ¬¡æˆåŠŸå†™æ“ä½œé—´éš”æ—¶é—´ï¼Œè€Œä¸æ˜¯å‘é€æ•´ä¸ªå“åº”çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨æ­¤è¶…æ—¶æ—¶é—´å†…å®¢æˆ·ç«¯æ²¡æœ‰æ¥æ”¶ä»»ä½•å“åº”ï¼Œåˆ™Nginxå…³é—­æ­¤è¿æ¥ã€‚</p>
<p><strong>keepalive_timeout timeout [header_timeout]</strong>ï¼šè®¾ç½®HTTPé•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°timeoutæ˜¯å‘Šè¯‰Nginxé•¿è¿æ¥è¶…æ—¶æ—¶é—´æ˜¯å¤šå°‘ï¼Œé»˜è®¤ä¸º75sã€‚ç¬¬äºŒä¸ªå‚æ•°header_timeoutæ˜¯ç”¨äºè®¾ç½®å“åº”å¤´â€œKeep-Alive: timeout&#x3D;timeâ€ï¼Œå³å‘ŠçŸ¥å®¢æˆ·ç«¯é•¿è¿æ¥è¶…æ—¶æ—¶é—´ã€‚å¦‚æœtimeoutè®¾ç½®ä¸º0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨é•¿è¿æ¥ã€‚</p>
<p>2ã€DNSè§£æè¶…æ—¶</p>
<p><strong>resolver_timeout 30s</strong>ï¼šè®¾ç½®DNSè§£æè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º30s</p>
<p>3ã€ä»£ç†è¶…æ—¶</p>
<p>ä¸»è¦æœ‰ä¸‰ç»„é…ç½®ï¼šç½‘ç»œè¿æ¥&#x2F;è¯»&#x2F;å†™è¶…æ—¶è®¾ç½®ã€å¤±è´¥é‡è¯•æœºåˆ¶è®¾ç½®ã€upstreamå­˜æ´»è¶…æ—¶è®¾ç½®</p>
<p><strong>proxy_connect_timeout time</strong>ï¼šä¸åç«¯&#x2F;ä¸Šæ¸¸æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º60sï¼Œæ­¤æ—¶é—´ä¸è¶…è¿‡75sã€‚</p>
<p><strong>proxy_read_timeout time</strong>ï¼šè®¾ç½®ä»åç«¯&#x2F;ä¸Šæ¸¸æœåŠ¡å™¨è¯»å–å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º60sï¼Œæ­¤è¶…æ—¶æ—¶é—´æŒ‡çš„æ˜¯ä¸¤æ¬¡æˆåŠŸè¯»æ“ä½œé—´éš”æ—¶é—´ï¼Œè€Œä¸æ˜¯è¯»å–æ•´ä¸ªå“åº”ä½“çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœåœ¨æ­¤è¶…æ—¶æ—¶é—´å†…ä¸Šæ¸¸æœåŠ¡å™¨æ²¡æœ‰å‘é€ä»»ä½•å“åº”ï¼Œåˆ™Nginxå…³é—­æ­¤è¿æ¥ã€‚</p>
<p><strong>proxy_send_timeout time</strong>ï¼šè®¾ç½®å¾€åç«¯&#x2F;ä¸Šæ¸¸æœåŠ¡å™¨å‘é€è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º60sï¼Œæ­¤è¶…æ—¶æ—¶é—´æŒ‡çš„æ˜¯ä¸¤æ¬¡æˆåŠŸå†™æ“ä½œé—´éš”æ—¶é—´ï¼Œè€Œä¸æ˜¯å‘é€æ•´ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœåœ¨æ­¤è¶…æ—¶æ—¶é—´å†…ä¸Šæ¸¸æœåŠ¡å™¨æ²¡æœ‰æ¥æ”¶ä»»ä½•å“åº”ï¼Œåˆ™Nginxå…³é—­æ­¤è¿æ¥ã€‚</p>
<p><strong>proxy_next_upstream_tries number</strong>ï¼šè®¾ç½®é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤0è¡¨ç¤ºä¸é™åˆ¶ï¼Œæ³¨æ„æ­¤é‡è¯•æ¬¡æ•°æŒ‡çš„æ˜¯æ‰€æœ‰è¯·æ±‚æ¬¡æ•°ï¼ˆåŒ…æ‹¬ç¬¬ä¸€æ¬¡å’Œä¹‹åçš„é‡è¯•æ¬¡æ•°ä¹‹å’Œï¼‰ã€‚</p>
<p><strong>proxy_next_upstream_timeout time</strong>ï¼šè®¾ç½®é‡è¯•æœ€å¤§è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤0è¡¨ç¤ºä¸é™åˆ¶ã€‚</p>
<p>Nginxè¶…æ—¶é…ç½®ï¼š<a href="https://blog.csdn.net/xiao__jia__jia/article/details/124075274">https://blog.csdn.net/xiao__jia__jia/article/details/124075274</a></p>
<h2 id="PoolingHttpClientConnectionManager"><a href="#PoolingHttpClientConnectionManager" class="headerlink" title="PoolingHttpClientConnectionManager"></a>PoolingHttpClientConnectionManager</h2><p>HttpCliené«˜å¹¶å‘è¯·æ±‚è¿æ¥æ±  - PoolingHttpClientConnectionManager</p>
<p>è¿æ¥æ± ï¼š<br>è¿æ¥æ± æŠ€æœ¯ä½œä¸ºåˆ›å»ºå’Œç®¡ç†è¿æ¥çš„ç¼“å†²æ± æŠ€æœ¯ï¼Œç›®å‰å·²å¹¿æ³›ç”¨äºè¯¸å¦‚æ•°æ®åº“è¿æ¥ç­‰é•¿è¿æ¥çš„ç»´æŠ¤å’Œç®¡ç†ä¸­ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘ç³»ç»Ÿçš„å“åº”æ—¶é—´ï¼ŒèŠ‚çœæœåŠ¡å™¨èµ„æºå¼€é”€ã€‚å…¶ä¼˜åŠ¿ä¸»è¦æœ‰ä¸¤ä¸ªï¼šå…¶ä¸€æ˜¯å‡å°‘åˆ›å»ºè¿æ¥çš„èµ„æºå¼€é”€ï¼Œå…¶äºŒæ˜¯èµ„æºçš„è®¿é—®æ§åˆ¶ã€‚è¿æ¥æ± ç®¡ç†çš„å¯¹è±¡æ˜¯é•¿è¿æ¥ã€‚</p>
<p>PoolingHttpClientConnectionManageræ˜¯é€šè¿‡ç§Ÿç”¨è¿æ¥å’Œæ”¶å›é“¾æ¥çš„æ–¹å¼æ¥å®ç°çš„ã€‚è§£å†³äº†httpè¯·æ±‚çš„å¤šçº¿ç¨‹é—®é¢˜ã€‚</p>
<p>ä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>å®ç°httpè¿æ¥æ± ï¼š<a href="https://blog.csdn.net/qq_34484062/article/details/109470135">https://blog.csdn.net/qq_34484062/article/details/109470135</a></p>
<h2 id="rpc"><a href="#rpc" class="headerlink" title="rpc"></a>rpc</h2><p>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRemote Procedure Callï¼Œç¼©å†™ä¸º RPCï¼‰å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€å°è®¡ç®—æœºçš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜æ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ã€‚ å¦‚æœæ¶‰åŠçš„è½¯ä»¶é‡‡ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œé‚£ä¹ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨äº¦å¯ç§°ä½œè¿œç¨‹è°ƒç”¨æˆ–è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚ Java RMIã€‚</p>
<p>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è®¡ç®—çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆClient&#x2F;Serverï¼‰çš„ä¾‹å­ï¼Œå®ƒç®€å•è€Œåˆå¹¿å—æ¬¢è¿ã€‚ è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ€»æ˜¯ç”±å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨å‘å‡ºä¸€ä¸ªæ‰§è¡Œè‹¥å¹²è¿‡ç¨‹è¯·æ±‚ï¼Œå¹¶ç”¨å®¢æˆ·ç«¯æä¾›çš„å‚æ•°ã€‚æ‰§è¡Œç»“æœå°†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ç”±äºå­˜åœ¨å„å¼å„æ ·çš„å˜ä½“å’Œç»†èŠ‚å·®å¼‚ï¼Œå¯¹åº”åœ°æ´¾ç”Ÿäº†å„å¼è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®ï¼Œè€Œä¸”å®ƒä»¬å¹¶ä¸äº’ç›¸å…¼å®¹ã€‚</p>
<p>ä¸ºäº†å…è®¸ä¸åŒçš„å®¢æˆ·ç«¯å‡èƒ½è®¿é—®æœåŠ¡å™¨ï¼Œè®¸å¤šæ ‡å‡†åŒ–çš„ RPC ç³»ç»Ÿåº”è¿è€Œç”Ÿäº†ã€‚å…¶ä¸­å¤§éƒ¨åˆ†é‡‡ç”¨æ¥å£æè¿°è¯­è¨€ï¼ˆInterface Description Languageï¼ŒIDLï¼‰ï¼Œæ–¹ä¾¿è·¨å¹³å°çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚<br>æœ‰äº›å®ç°æ‰©å±•äº†è¿œç¨‹è°ƒç”¨çš„æ¨¡å‹ï¼Œå®ç°äº†åŒå‘çš„æœåŠ¡è°ƒç”¨ï¼Œä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œè°ƒç”¨è¿‡ç¨‹è¿˜æ˜¯ç”±ä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·ï¼ŒæœåŠ¡å™¨ç«¯æä¾›å“åº”ï¼ŒåŸºæœ¬æ¨¡å‹æ²¡æœ‰å˜åŒ–ã€‚</p>
<p>æœåŠ¡çš„è°ƒç”¨è¿‡ç¨‹ä¸ºï¼š<br>1ã€clientè°ƒç”¨client stubï¼Œè¿™æ˜¯ä¸€æ¬¡æœ¬åœ°è¿‡ç¨‹è°ƒç”¨<br>2ã€client stubå°†å‚æ•°æ‰“åŒ…æˆä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åå‘é€è¿™ä¸ªæ¶ˆæ¯ã€‚æ‰“åŒ…è¿‡ç¨‹ä¹Ÿå«åš marshalling<br>3ã€clientæ‰€åœ¨çš„ç³»ç»Ÿå°†æ¶ˆæ¯å‘é€ç»™server<br>4ã€serverçš„çš„ç³»ç»Ÿå°†æ”¶åˆ°çš„åŒ…ä¼ ç»™server stub<br>5ã€server stubè§£åŒ…å¾—åˆ°å‚æ•°ã€‚ è§£åŒ…ä¹Ÿè¢«ç§°ä½œ unmarshalling<br>6ã€æœ€åserver stubè°ƒç”¨æœåŠ¡è¿‡ç¨‹. è¿”å›ç»“æœæŒ‰ç…§ç›¸åçš„æ­¥éª¤ä¼ ç»™client</p>
<hr>
<p>RPC (Remote Procedure Call)å³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸è§çš„ä¸€ç§é€šä¿¡æ–¹æ³•ï¼Œå·²ç»æœ‰ 40 å¤šå¹´å†å²ã€‚å½“ä¸¤ä¸ªç‰©ç†åˆ†ç¦»çš„å­ç³»ç»Ÿéœ€è¦å»ºç«‹é€»è¾‘ä¸Šçš„å…³è”æ—¶ï¼ŒRPC æ˜¯ç‰µçº¿æ­æ¡¥çš„å¸¸è§æŠ€æœ¯æ‰‹æ®µä¹‹ä¸€ã€‚é™¤ RPC ä¹‹å¤–ï¼Œå¸¸è§çš„å¤šç³»ç»Ÿæ•°æ®äº¤äº’æ–¹æ¡ˆè¿˜æœ‰åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ã€HTTP è¯·æ±‚è°ƒç”¨ã€æ•°æ®åº“å’Œåˆ†å¸ƒå¼ç¼“å­˜ã€‚</p>
<p>å…¶ä¸­ RPC å’Œ HTTP è°ƒç”¨æ˜¯æ²¡æœ‰ç»è¿‡ä¸­é—´ä»¶çš„ï¼Œå®ƒä»¬æ˜¯ç«¯åˆ°ç«¯ç³»ç»Ÿçš„ç›´æ¥æ•°æ®äº¤äº’ã€‚<strong>HTTP è°ƒç”¨å…¶å®ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„ RPCï¼Œåªä¸è¿‡ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ RPC æ˜¯æŒ‡é•¿è¿æ¥æ•°æ®äº¤äº’ï¼Œè€Œ HTTP ä¸€èˆ¬æ˜¯æŒ‡å³ç”¨å³èµ°çš„çŸ­é“¾æ¥ã€‚</strong></p>
<p>RPC åœ¨æˆ‘ä»¬ç†ŸçŸ¥çš„å„ç§ä¸­é—´ä»¶ä¸­éƒ½æœ‰å®ƒçš„èº«å½±ã€‚Nginx&#x2F;Redis&#x2F;MySQL&#x2F;Dubbo&#x2F;Hadoop&#x2F;Spark&#x2F;Tensorflow ç­‰é‡é‡çº§å¼€æºäº§å“éƒ½æ˜¯åœ¨ RPC æŠ€æœ¯çš„åŸºç¡€ä¸Šæ„å»ºå‡ºæ¥çš„ï¼Œæˆ‘ä»¬<strong>è¿™é‡Œè¯´çš„ RPC æŒ‡çš„æ˜¯å¹¿ä¹‰çš„ RPCï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„é€šä¿¡æŠ€æœ¯</strong>ã€‚RPC åœ¨æŠ€æœ¯ä¸­çš„åœ°ä½å¥½æ¯”æˆ‘ä»¬èº«è¾¹çš„ç©ºæ°”ï¼Œå®ƒæ— å¤„ä¸åœ¨ï¼Œä½†æ˜¯åˆæœ‰å¾ˆå¤šäººæ ¹æœ¬ä¸çŸ¥é“å®ƒçš„å­˜åœ¨ã€‚</p>
<p>ä¾‹å¦‚æ•°æ®åº“ï¼š<br>å­ç³»ç»Ÿå’Œæ•°æ®åº“ä¹‹é—´çš„äº¤äº’ä¹Ÿæ˜¯é€šè¿‡ RPC è¿›è¡Œçš„ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯ä¸‰ä¸ªå­ç³»ç»Ÿä¹‹é—´å¤æ‚çš„ç»„åˆæ¶ˆæ¯äº¤äº’ç½¢äº†ã€‚å¦‚æœå†æ·±å…¥è¿›å»ï¼Œä½ ä¼šå‘ç°ï¼Œè¿™é‡Œçš„æ•°æ®åº“ä¸æ˜¯é‚£ç§å•æœºæ•°æ®åº“ï¼Œè€Œæ˜¯å…·å¤‡ä¸»ä»å¤åˆ¶åŠŸèƒ½çš„æ•°æ®åº“ï¼Œæ¯”å¦‚ MySQLã€‚åœ¨äº’è”ç½‘ä¼ä¸šé‡Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨è¿™ç§ä¸»ä»è¯»å†™åˆ†ç¦»çš„æ•°æ®åº“ã€‚ä¸€ä¸ªä¸šåŠ¡å­ç³»ç»Ÿå°†æ•°æ®å†™å¾€ä¸»åº“ï¼Œä¸»åº“å†å°†æ•°æ®åŒæ­¥åˆ°ä»åº“ï¼Œç„¶åå¦ä¸€ä¸ªä¸šåŠ¡å­ç³»ç»Ÿåˆä»ä»åº“é‡Œå°†æ•°æ®å–å‡ºæ¥ã€‚è¿™æ—¶åˆå¯ä»¥è¿›ä¸€æ­¥å°†å®ƒä»¬çœ‹æˆæ˜¯å››ä¸ªå­ç³»ç»Ÿä¹‹é—´è¿›è¡Œçš„æ›´åŠ å¤æ‚çš„ RPC æ•°æ®äº¤äº’ã€‚</p>
<hr>
<p>ä¸€äº›åˆ†å¸ƒå¼åœºæ™¯ä¸­RPCçš„ä½¿ç”¨ï¼šï¼ˆå¹¿ä¹‰ä¸Šçš„RPCï¼‰</p>
<p>âœ…nginx<br>Ngnix æ˜¯äº’è”ç½‘ä¼ä¸šä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ä»£ç†æœåŠ¡å™¨ã€‚å®ƒå¯ä»¥ä¸ºåç«¯åˆ†å¸ƒå¼æœåŠ¡æä¾›è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å°†åç«¯å¤šä¸ªæœåŠ¡åœ°å€èšåˆä¸ºå•ä¸ªåœ°å€æ¥å¯¹å¤–æä¾›æœåŠ¡ã€‚Nginx å’Œåç«¯æœåŠ¡ä¹‹é—´çš„äº¤äº’åœ¨æœ¬è´¨ä¸Šä¹Ÿå¯ä»¥ç†è§£ä¸º RPC æ•°æ®äº¤äº’ã€‚ä¹Ÿè®¸ä½ ä¼šäº‰è¾©è¯´ Nginx å’Œåç«¯æœåŠ¡ä¹‹é—´ä½¿ç”¨çš„æ˜¯ HTTP åè®®ï¼Œèµ°çš„æ˜¯çŸ­è¿æ¥ï¼Œä¸¥æ ¼ä¸Šä¸èƒ½ç®—æ˜¯ RPC è°ƒç”¨ã€‚ä¸è¿‡ Nginx å’Œåç«¯æœåŠ¡ä¹‹é—´è¿˜å¯ä»¥èµ°å…¶å®ƒçš„åè®®ï¼Œæ¯”å¦‚ uwsgi åè®®ã€fastcgi åè®®ç­‰ï¼Œè¿™ä¸¤ä¸ªåè®®éƒ½æ˜¯é‡‡ç”¨äº†æ¯” HTTP åè®®æ›´åŠ èŠ‚çœæµé‡çš„äºŒè¿›åˆ¶åè®®ã€‚</p>
<p>âœ…Hadoop<br>åœ¨å¤§æ•°æ®æŠ€æœ¯é¢†åŸŸï¼ŒRPC ä¹Ÿå æ®äº†éå¸¸é‡è¦çš„åœ°ä½ã€‚å¤§æ•°æ®é¢†åŸŸå¹¿æ³›åº”ç”¨äº†éå¸¸å¤šçš„åˆ†å¸ƒå¼æŠ€æœ¯ï¼Œåˆ†å¸ƒå¼æ„å‘³ç€èŠ‚ç‚¹çš„ç‰©ç†éš”ç¦»ï¼Œéš”ç¦»æ„å‘³ç€éœ€è¦é€šä¿¡ï¼Œé€šä¿¡æ„å‘³ç€ RPC çš„å­˜åœ¨ã€‚å¤§æ•°æ®éœ€è¦é€šä¿¡çš„é‡æ¯”ä¸šåŠ¡ç³»ç»Ÿæ›´åŠ åºå¤§ï¼Œæ‰€ä»¥åœ¨æ•°æ®é€šä¿¡ä¼˜åŒ–ä¸Šåšçš„æ›´æ·±ã€‚æ¯”å¦‚æœ€å¸¸è§çš„ Hadoop æ–‡ä»¶ç³»ç»Ÿ hdfsï¼Œä¸€èˆ¬åŒ…æ‹¬ä¸€ä¸ª NameNode å’Œå¤šä¸ª DataNodeï¼ŒNameNode å’Œ DataNode ä¹‹é—´å°±æ˜¯é€šè¿‡ä¸€ç§ç§°ä¸º Hadoop RPC çš„äºŒè¿›åˆ¶åè®®è¿›è¡Œé€šè®¯ã€‚</p>
<p>âœ…TensorFlow<br>åœ¨äººå·¥æ™ºèƒ½é¢†åŸŸï¼ŒRPC ä¹Ÿå¾ˆé‡è¦ï¼Œè‘—åçš„ TensorFlow æ¡†æ¶å¦‚æœéœ€è¦å¤„ç†ä¸Šäº¿çš„æ•°æ®ï¼Œå°±éœ€è¦ä¾é åˆ†å¸ƒå¼è®¡ç®—åŠ›ï¼Œéœ€è¦é›†ç¾¤åŒ–ï¼Œå½“å¤šä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹éœ€è¦é›†ä½“æ™ºæ…§æ—¶ï¼Œå°±å¿…é¡»å¼•å…¥ RPC æŠ€æœ¯è¿›è¡Œé€šè®¯ã€‚Tensorflow Cluster çš„ RPC é€šè®¯æ¡†æ¶ä½¿ç”¨äº† Google å†…éƒ¨è‡ªç ”çš„ gRPC æ¡†æ¶ã€‚</p>
<p>è½¬è‡ªï¼š<a href="https://www.kancloud.cn/machh03/server/2096716">https://www.kancloud.cn/machh03/server/2096716</a><br>é‡Œé¢è¿˜æœ‰å®ç°rpc</p>
<h2 id="ç†è§£httpå’Œrpc"><a href="#ç†è§£httpå’Œrpc" class="headerlink" title="ç†è§£httpå’Œrpc"></a>ç†è§£httpå’Œrpc</h2><p>HTTP1.0 åè®®æ—¶ï¼ŒHTTP è°ƒç”¨è¿˜åªèƒ½æ˜¯çŸ­é“¾æ¥è°ƒç”¨ï¼Œä¸€ä¸ªè¯·æ±‚æ¥å›ä¹‹åè¿æ¥å°±ä¼šå…³é—­ã€‚HTTP1.1 åœ¨ HTTP1.0 åè®®çš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹è¿›ï¼Œå¼•å…¥äº† KeepAlive ç‰¹æ€§å¯ä»¥ä¿æŒ HTTP è¿æ¥é•¿æ—¶é—´ä¸æ–­å¼€ï¼Œä»¥ä¾¿åœ¨åŒä¸€ä¸ªè¿æ¥ä¹‹ä¸Šè¿›è¡Œå¤šæ¬¡è¿ç»­çš„è¯·æ±‚ï¼Œè¿›ä¸€æ­¥æ‹‰è¿‘äº† HTTP å’Œ RPC ä¹‹é—´çš„è·ç¦»ã€‚</p>
<p>å½“ HTTP åè®®è¿›åŒ–åˆ° 2.0 ä¹‹åï¼ŒGoogle å¼€æºäº†ä¸€ä¸ªå»ºç«‹åœ¨ HTTP2.0 åè®®ä¹‹ä¸Šçš„é€šä¿¡æ¡†æ¶ç›´æ¥å–åä¸º gRPCï¼Œä¹Ÿå°±æ˜¯ Google RPCï¼Œè¿™æ—¶ HTTP å’Œ RPC ä¹‹é—´å·²ç»æ²¡æœ‰éå¸¸æ˜æ˜¾çš„ç•Œé™äº†ã€‚</p>
<p>HTTP ä¸ RPC çš„å…³ç³»å°±å¥½æ¯”æ™®é€šè¯ä¸æ–¹è¨€çš„å…³ç³»ã€‚è¦è¿›è¡Œè·¨ä¼ä¸šæœåŠ¡è°ƒç”¨æ—¶ï¼Œå¾€å¾€éƒ½æ˜¯é€šè¿‡ HTTP APIï¼Œä¹Ÿå°±æ˜¯æ™®é€šè¯ï¼Œè™½ç„¶æ•ˆç‡ä¸é«˜ï¼Œä½†æ˜¯é€šç”¨ï¼Œæ²¡æœ‰å¤ªå¤šæ²Ÿé€šçš„å­¦ä¹ æˆæœ¬ã€‚ä½†æ˜¯åœ¨ä¼ä¸šå†…éƒ¨è¿˜æ˜¯ RPC æ›´åŠ é«˜æ•ˆï¼ŒåŒä¸€ä¸ªä¼ä¸šå…¬ç”¨ä¸€å¥—æ–¹è¨€è¿›è¡Œé«˜æ•ˆç‡çš„äº¤æµï¼Œè¦æ¯”é€šç”¨çš„ HTTP åè®®æ¥äº¤æµæ›´åŠ èŠ‚çœèµ„æºã€‚æ•´ä¸ªä¸­å›½æœ‰éå¸¸å¤šçš„æ–¹è¨€ï¼Œæ­£å¦‚æœ‰å¾ˆå¤šçš„ä¼ä¸šå†…éƒ¨æœåŠ¡å„æœ‰è‡ªå·±çš„ä¸€å¥—äº¤äº’åè®®ä¸€æ ·ã€‚å¥½æ¯”å¼€æº RPC åè®®ä¸­ Protobuf å’Œ Thrift ä¸€æ ·ï¼Œå®ƒä»¬ä¸¤åº”è¯¥æ˜¯ RPC åè®®ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸¤ä¸ªã€‚</p>
<p>rpcåŸºäºä»€ä¹ˆå®ç°ç½‘ç»œä¼ è¾“ï¼Ÿ<br>1.rpcå¯ä»¥åŸºäºtcpç›´æ¥å¼€å‘è‡ªå·±çš„åè®®ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥ä¿æŒé•¿è¿æ¥çš„ï¼Œtcpçš„ä¼ è¾“æ•ˆç‡é«˜ï¼Œå¹¶ä¸”å¯ä»¥ä¸€ç›´ç»´æŒé“¾æ¥</p>
<p>2.è‡ªå®šä¹‰åè®®å¯ä»¥ä¼˜åŒ–æ•°æ®çš„ä¼ è¾“ï¼Œä¾‹å¦‚æ›´å¤§çš„å‹ç¼©æ¯”ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éå¸¸æœ‰ç”¨ã€‚</p>
<p>3.httpåè®®1.xä¸€èˆ¬æƒ…å†µä¸‹ä¸€ä¸ªæ¥å›å°±å…³é—­è¿æ¥ï¼Œè™½ç„¶æä¾›äº†keep-aliveå¯ä»¥ä¿æŒé•¿è¿æ¥ï¼Œä½†æ˜¯ä¾ç„¶ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥å°±å‡ºç°äº†http2.0ï¼Œ http2.0åŸºæœ¬ä¸Šå¯ä»¥å½“åštcpåè®®ä½¿ç”¨äº†ã€‚æ‰€ä»¥grpcå°±ä¼šä½¿ç”¨http2.0å¼€å‘ã€‚</p>
<h2 id="restå’Œrestful"><a href="#restå’Œrestful" class="headerlink" title="restå’Œrestful"></a>restå’Œrestful</h2><p>RESTï¼Œè‹±æ–‡å…¨ç§°Representational State Transferï¼ˆè¡¨è¿°æ€§çŠ¶æ€è½¬ç§»ï¼‰ï¼Œæ˜¯ä¸€ç»„æ¶æ„çº¦æŸæ¡ä»¶å’ŒåŸåˆ™ï¼ˆæ³¨æ„ï¼ŒRESTæ˜¯è®¾è®¡é£æ ¼è€Œä¸æ˜¯æ ‡å‡†ï¼‰ã€‚æ»¡è¶³è¿™äº›çº¦æŸæ¡ä»¶å’ŒåŸåˆ™çš„åº”ç”¨ç¨‹åºæˆ–è®¾è®¡å°±æ˜¯RESTfulã€‚å¯ä»¥é™ä½å¼€å‘çš„å¤æ‚æ€§ï¼Œæé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§ã€‚ä½“ç°åœ¨Webå¼€å‘ä¸­å°±æ˜¯é€šè¿‡HTTPæ–¹æ³•ä¸­çš„POSTã€DELETEã€PUTã€GETæ¥å¯¹èµ„æºè¿›è¡Œæ“ä½œã€‚</p>
<p>ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œè®¾è®¡é£æ ¼è€Œä¸æ˜¯æ ‡å‡†ï¼Œåªæ˜¯æä¾›äº†ä¸€ç»„è®¾è®¡åŸåˆ™å’Œçº¦æŸæ¡ä»¶ã€‚å®ƒä¸»è¦ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤äº’ç±»çš„è½¯ä»¶ã€‚åŸºäºè¿™ä¸ªé£æ ¼è®¾è®¡çš„è½¯ä»¶å¯ä»¥æ›´ç®€æ´ï¼Œæ›´æœ‰å±‚æ¬¡ï¼Œæ›´æ˜“äºå®ç°ç¼“å­˜ç­‰æœºåˆ¶ã€‚</p>
<p>åœ¨ REST æ ·å¼çš„ Web æœåŠ¡ä¸­ï¼Œæ¯ä¸ªèµ„æºéƒ½æœ‰ä¸€ä¸ªåœ°å€ã€‚èµ„æºæœ¬èº«éƒ½æ˜¯æ–¹æ³•è°ƒç”¨çš„ç›®æ ‡ï¼Œæ–¹æ³•åˆ—è¡¨å¯¹æ‰€æœ‰èµ„æºéƒ½æ˜¯ä¸€æ ·çš„ã€‚è¿™äº›æ–¹æ³•éƒ½æ˜¯æ ‡å‡†æ–¹æ³•ï¼ŒåŒ…æ‹¬ HTTP GETã€POSTã€PUTã€DELETEï¼Œè¿˜å¯èƒ½åŒ…æ‹¬ HEADER å’Œ OPTIONSã€‚</p>
<p>Representationï¼ˆè¡¨ç°å±‚ï¼‰<br>èµ„æºçš„ä¿¡æ¯è½½ä½“å½¢å¼ã€‚å®ƒå¯ä»¥æ˜¯æ–‡æœ¬ã€XMLã€JSONæˆ–è€…æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å®ƒçš„è¡¨ç°å½¢å¼åº”è¯¥åœ¨HTTPè¯·æ±‚çš„å¤´ä¿¡æ¯ä¸­ç”¨Acceptå’ŒContent-Typeå­—æ®µæŒ‡å®šæè¿°ã€‚</p>
<p>State Transferï¼ˆçŠ¶æ€è½¬ç§»ï¼‰<br>äº’è”ç½‘é€šä¿¡åè®®HTTPåè®®ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ã€‚è¿™æ„å‘³ç€ï¼Œæ‰€æœ‰çš„çŠ¶æ€éƒ½ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚å› æ­¤ï¼Œå¦‚æœå®¢æˆ·ç«¯æƒ³è¦æ“ä½œæœåŠ¡å™¨ï¼Œå¿…é¡»é€šè¿‡æŸç§æ‰‹æ®µï¼Œè®©æœåŠ¡å™¨ç«¯å‘ç”Ÿâ€çŠ¶æ€è½¬ç§»â€ã€‚</p>
<p>åœ¨ HTTP ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€šè¿‡å››ç§ HTTP åŠ¨è¯æ¥å¯¹åº”èµ„æºçš„å˜åŒ–ï¼š<br>POSTï¼ˆæ–°å»ºèµ„æºï¼Œä¹Ÿå¯ç”¨äºæ›´æ–°èµ„æºï¼‰<br>DELETEï¼ˆåˆ é™¤èµ„æºï¼‰<br>PUTï¼ˆæ›´æ–°èµ„æºï¼‰<br>GETï¼ˆè·å–èµ„æºï¼‰</p>
<p>RESTæ¶æ„åŸåˆ™ï¼š<br>å¯¹ç½‘ç»œä¸Šæ‰€æœ‰èµ„æºéƒ½æœ‰ä¸€ä¸ªèµ„æºæ ‡è¯†ç¬¦<br>å¯¹èµ„æºçš„æ“ä½œä¸ä¼šæ”¹å˜æ ‡è¯†ç¬¦<br>åŒä¸€èµ„æºæœ‰å¤šç§è¡¨ç°å½¢å¼ï¼Œå¦‚XMLã€JSONâ€¦<br>æ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— çŠ¶æ€çš„ï¼ˆStatelessï¼‰</p>
<p>RESTfulï¼Œæ˜¯ä¸€ç§ç½‘ç»œåº”ç”¨ç¨‹åºçš„è®¾è®¡é£æ ¼å’Œå¼€å‘æ–¹å¼ã€‚RESTfulå¯ä»¥é€šè¿‡ä¸€å¥—ç»Ÿä¸€çš„æ¥å£ä¸ºWebï¼ŒiOSå’ŒAndroidæä¾›æœåŠ¡ã€‚æ¯”å¦‚å¾®åšå¼€æ”¾å¹³å°ï¼Œå¾®ä¿¡å¼€æ”¾å¹³å°ç­‰ï¼Œå®ƒä»¬ä¸éœ€è¦æœ‰æ˜¾å¼çš„å‰ç«¯ï¼Œåªéœ€è¦ä¸€å¥—æä¾›æœåŠ¡çš„æ¥å£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨ä½¿ç”¨RESTfulé£æ ¼ä¹‹å‰ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯è¿™æ ·æ“ä½œç”¨æˆ·æ•°æ®:</span><br><span class="line">//åˆ›å»ºç”¨æˆ·ä¿¡æ¯</span><br><span class="line">http://localhost:8080/user/createUser</span><br><span class="line">//åˆ é™¤idä¸º1çš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">http://localhost:8080/user/deleteUser/1</span><br><span class="line">//ä¿®æ”¹idä¸º2çš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">http://localhost:8080/user/updateUser/2</span><br><span class="line">//è·å–æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">http://localhost:8080/user/getUsers</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨RESTfulé£æ ¼ä¹‹å:</span><br><span class="line">//åˆ›å»ºç”¨æˆ·ä¿¡æ¯</span><br><span class="line">POST http://localhost:8080/user</span><br><span class="line">//åˆ é™¤idä¸º1çš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">DELETE http://localhost:8080/user/1</span><br><span class="line">//ä¿®æ”¹idä¸º2çš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">PUT http://localhost:8080/user/2</span><br><span class="line">//è·å–æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">GET http://localhost:8080/userè·å–æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">é€šè¿‡çº¦å®šä¸åŒçš„HTTPæ–¹æ³•æ¥å®ç°ä¸åŒçš„ä¸šåŠ¡ï¼Œæœ‰ä¸€ä¸ªæ›´åŠ ç›´è§‚çš„äº†è§£ã€‚</span><br><span class="line">1ã€çœ‹URLå°±çŸ¥é“è¦æ“ä½œä»€ä¹ˆ</span><br><span class="line">2ã€çœ‹HTTPæ–¹æ³•å°±çŸ¥é“è¦å¦‚ä½•æ“ä½œ</span><br><span class="line">3ã€çœ‹HTTPçŠ¶æ€ç å°±çŸ¥é“è¿”å›ç»“æœå¦‚ä½•</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<br>restä¸restfulï¼š<br><a href="https://blog.csdn.net/weixin_44316527/article/details/106276655">https://blog.csdn.net/weixin_44316527/article/details/106276655</a></p>
<hr>
<p>rpcä¸restfulï¼š</p>
<p>RPCï¼ˆRemote Procedure Call Protocolï¼‰å°±æ˜¯è¿œç¨‹è°ƒç”¨ã€‚æœ€ç®€å•çš„æƒ³æ³•ï¼Œåº”è¯¥å°±æ˜¯æŠŠHTTPåè®®å½“åšRPCæ¥ç”¨ã€‚æ¯”å¦‚æˆ‘ä»¬æŠŠç½‘å€ä½œä¸ºä¸€ä¸ªå€Ÿå£ï¼Œä¼ å…¥çš„å‚æ•°ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œresponseçš„æ•°æ®ä½œä¸ºè¿”å›ä¿¡æ¯ã€‚è¿™å…¶å®å°±æ˜¯ä¸€ä¸ªè°ƒç”¨ã€‚</p>
<p>RESTfulå’ŒRPCæœ€å¤§çš„åŒºåˆ«åº”è¯¥å°±æ˜¯é¢å‘å¯¹è±¡äº†ã€‚<br>ä»è®¾è®¡ä¸Šæ¥çœ‹ï¼ŒRPCï¼Œæ‰€è°“çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ ï¼Œæ˜¯é¢å‘æ–¹æ³•çš„ ï¼›<br>RESTï¼šæ‰€è°“çš„ Representational state transfer ï¼Œæ˜¯é¢å‘èµ„æºçš„ï¼›<br>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§å«åš SOAï¼Œæ‰€è°“çš„é¢å‘æœåŠ¡çš„æ¶æ„ï¼Œå®ƒæ˜¯é¢å‘æ¶ˆæ¯çš„ã€‚<br>å¾ˆå¤šäººåªçŸ¥é“GETå’ŒPOSTï¼Œå› ä¸ºç°åœ¨æœ€å¸¸ç”¨çš„å°±æ˜¯GETå’ŒPOSTäº†ã€‚è™½è¯´è¿™åº”è¯¥æ˜¯è¿èƒŒäº†HTTPè®¾è®¡çš„åˆè¡·ã€‚</p>
<p>åºåˆ—åŒ–åè®®çš„åŒºåˆ«ï¼š<br>æ¥å£è°ƒç”¨é€šå¸¸åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåºåˆ—åŒ–å’Œé€šä¿¡åè®®ã€‚<br>é€šä¿¡åè®®ï¼Œä¸Šé¢å·²ç»æåŠäº†ï¼ŒREST æ˜¯ åŸºäº HTTP åè®®ï¼Œè€Œ RPC å¯ä»¥åŸºäº TCP&#x2F;UDPï¼Œä¹Ÿå¯ä»¥åŸºäº HTTP åè®®è¿›è¡Œä¼ è¾“çš„ã€‚<br>å¸¸è§çš„åºåˆ—åŒ–åè®®ï¼Œæœ‰ï¼šjsonã€xmlã€hessionã€protobufã€thriftã€textã€bytesç­‰ï¼ŒREST é€šå¸¸ä½¿ç”¨çš„æ˜¯ JSONæˆ–è€…XMLï¼Œè€Œ RPC ä½¿ç”¨çš„æ˜¯ JSON-RPCï¼Œæˆ–è€… XML-RPCã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ<br>REST æ¥å£æ›´åŠ è§„èŒƒï¼Œé€šç”¨é€‚é…æ€§è¦æ±‚é«˜ï¼Œå»ºè®®å¯¹å¤–çš„æ¥å£éƒ½ç»Ÿä¸€æˆ RESTã€‚è€Œç»„ä»¶å†…éƒ¨çš„å„ä¸ªæ¨¡å—ï¼Œå¯ä»¥é€‰æ‹© RPCï¼Œä¸€ä¸ªæ˜¯ä¸ç”¨è€—è´¹å¤ªå¤šç²¾åŠ›å»å¼€å‘å’Œç»´æŠ¤å¤šå¥—çš„HTTPæ¥å£ï¼Œä¸€ä¸ªRPCçš„è°ƒç”¨æ€§èƒ½æ›´é«˜ã€‚ä»æ€§èƒ½è§’åº¦çœ‹ï¼Œç”±äºHTTPæœ¬èº«æä¾›äº†ä¸°å¯Œçš„çŠ¶æ€åŠŸèƒ½ä¸æ‰©å±•åŠŸèƒ½ï¼Œä½†ä¹Ÿæ­£ç”±äºHTTPæä¾›çš„åŠŸèƒ½è¿‡å¤šï¼Œå¯¼è‡´åœ¨ç½‘ç»œä¼ è¾“æ—¶ï¼Œéœ€è¦æºå¸¦çš„ä¿¡æ¯æ›´å¤šï¼Œä»æ€§èƒ½è§’åº¦ä¸Šè®²ï¼Œè¾ƒä¸ºä½æ•ˆã€‚è€ŒRPCæœåŠ¡ç½‘ç»œä¼ è¾“ä¸Šä»…ä¼ è¾“ä¸ä¸šåŠ¡å†…å®¹ç›¸å…³çš„æ•°æ®ï¼Œä¼ è¾“æ•°æ®æ›´å°ï¼Œæ€§èƒ½æ›´é«˜ã€‚</p>
<p>è½¬è‡ªï¼š<br><a href="https://developer.aliyun.com/article/53677">https://developer.aliyun.com/article/53677</a></p>
<hr>
<p>restfulå’Œhttpï¼š</p>
<p>REST æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ã€‚è¿™ç§é£æ ¼çš„å…¸å‹åº”ç”¨ï¼Œå°±æ˜¯HTTPã€‚å…¶å› ä¸ºç®€å•ã€æ‰©å±•æ€§å¼ºçš„ç‰¹ç‚¹è€Œå¹¿å—å¼€å‘è€…çš„é’çã€‚</p>
<p>æŸç§æ„ä¹‰ä¸‹ï¼Œæˆ‘ä»¬è¯´ REST å¯ä»¥å…¶å®å°±æ˜¯æŒ‡ä»£ HTTP åè®®ã€‚</p>
<hr>
<p>æ€»ç»“ï¼šrpcã€httpã€rest</p>
<p>rpcæ˜¯ä¸€ç§åè®®è¿˜æ˜¯ï¼Œè¿˜æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„æ€æƒ³ï¼Ÿæ›´æ˜¯åè€…<br>rpcåŒ…å«ï¼šæœåŠ¡å‘ç°ã€è´Ÿè½½ã€å®¹å™¨ã€ç½‘ç»œä¼ è¾“ã€åºåˆ—åŒ–ç­‰ç»„ä»¶ã€‚<br>rpcæŒ‡æ˜äº†ç¨‹åºå¦‚ä½•è¿›è¡Œç½‘ç»œä¼ è¾“å’Œåºåˆ—åŒ–ã€‚</p>
<p>å…³äºrpcå’Œhttpçš„æ¯”è¾ƒï¼š<br>rpcçš„ç½‘ç»œä¼ è¾“æ˜¯å¦‚ä½•å®ç°çš„ï¼Œrpcæ˜¯è¿æ¥ï¼Œhttpæ˜¯çŸ­è¿æ¥ã€‚<br>httpæ˜¯ä¸€ç§rpcï¼ˆå¹¿ä¹‰ä¸Šï¼‰ï¼Œè¿˜æ˜¯rpcå¯ä»¥åŸºäºhttpå®ç°ï¼Ÿ<br>RPCå¯ä»¥åŸºäºTCPåè®®ä¹Ÿå¯ä»¥åŸºäºHTTPåè®®ã€‚<br>HTTPéœ€è¦æºå¸¦çš„ä¿¡æ¯æ›´å¤šï¼Œä½æ•ˆï¼ŒRPCä»…ä¼ è¾“ä¸ä¸šåŠ¡ç›¸å…³çš„æ•°æ®ï¼Œä¼ è¾“æ•°æ®æ›´å°ï¼Œæ€§èƒ½æ›´é«˜</p>
<p>å…³äºrpcå’Œrestfulçš„æ¯”è¾ƒï¼š<br>rpcé¢å‘æ–¹æ³•ï¼Œrestfulé¢å‘èµ„æºã€‚<br>æ—¥å¸¸å†™çš„æ¥å£ï¼Œæ›´å¤šåŸºäºrpcé¢å‘æ–¹æ³•çš„ï¼Œè™½ç„¶æœ‰çš„æ˜¯rpcæ¥å£ï¼Œæœ‰çš„æ˜¯httpæ¥å£ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>javaä¹‹fastjsonåŠXStream</title>
    <url>/2022/04/30/myblog/java/java%E4%B9%8Bfastjson%E5%8F%8AXStream/</url>
    <content><![CDATA[<p>fastjsonæ˜¯é˜¿é‡Œå‡ºå“çš„å¤„ç†JSONå­—ç¬¦ä¸²çš„Javaç±»åº“ï¼Œå¯ä»¥å¯¹JSONå­—ç¬¦ä¸²ã€JSONå¯¹è±¡ã€Javaå¯¹è±¡è¿›è¡Œäº’ç›¸è½¬æ¢ã€‚éœ€è¦å¯¼å…¥fastjsonåŒ…ã€‚</p>
<h3 id="Stringã€JSONObjectã€Objectè½¬æ¢"><a href="#Stringã€JSONObjectã€Objectè½¬æ¢" class="headerlink" title="Stringã€JSONObjectã€Objectè½¬æ¢"></a>Stringã€JSONObjectã€Objectè½¬æ¢</h3><p>ä¸€ã€å­—ç¬¦ä¸²è½¬æˆJSONå¯¹è±¡&#x2F;æ•°ç»„<br>å­—ç¬¦ä¸²è½¬æˆJSONå¯¹è±¡<br>JSON.parseObject(String text)<br>JSON.parse(String text)</p>
<p>å­—ç¬¦ä¸²è½¬æˆJSONæ•°ç»„<br>JSON.parseArray(String text)<br>JSON.parse(String text)</p>
<p>äºŒã€å­—ç¬¦ä¸²è½¬æˆJavaå¯¹è±¡&#x2F;åˆ—è¡¨<br>å­—ç¬¦ä¸²è½¬æˆJavaå¯¹è±¡<br>JSON.parseObject(String text, Class<T> clazz)</p>
<p>å­—ç¬¦ä¸²è½¬æˆJavaå¯¹è±¡åˆ—è¡¨<br>JSON.parseArray(String text, Class<T> clazz)</p>
<p>ä¸‰ã€Javaå¯¹è±¡&#x2F;åˆ—è¡¨è½¬æˆJSONå¯¹è±¡&#x2F;æ•°ç»„<br>Javaå¯¹è±¡è½¬æˆJSONå¯¹è±¡<br>JSONObject.toJSON(Object javaObject)<br>JSON.toJSON(Object javaObject)</p>
<p>Javaå¯¹è±¡åˆ—è¡¨è½¬æˆJSONæ•°ç»„<br>JSONArray.toJSON(Object javaObject)<br>JSON.toJSON(Object javaObject)</p>
<p>å››ã€JSONå¯¹è±¡&#x2F;æ•°ç»„è½¬æˆJavaå¯¹è±¡&#x2F;åˆ—è¡¨<br>JSONå¯¹è±¡è½¬æˆJavaå¯¹è±¡<br>JSON.toJavaObject(JSON json, Class<T> clazz)<br>jsonObject.toJavaObject(JSON json) (éé™æ€æ–¹æ³•)</p>
<p>JSONæ•°ç»„è½¬æˆJavaå¯¹è±¡åˆ—è¡¨<br>jsonArray.toJavaList(Class<T> clazz) (éé™æ€æ–¹æ³•)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONArray;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import java.util.List;</span><br><span class="line"> </span><br><span class="line">public class FastJSONLearning &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    String jsonObjectStr = &quot;&#123;\&quot;prop\&quot;:\&quot;code\&quot;,\&quot;label\&quot;:\&quot;ä»£ç \&quot;,\&quot;required\&quot;:true,\&quot;key\&quot;:true&#125;&quot;;</span><br><span class="line">    String jsonArrayStr = &quot;[&#123;\&quot;prop\&quot;:\&quot;code\&quot;,\&quot;label\&quot;:\&quot;ä»£ç \&quot;,\&quot;required\&quot;:true,\&quot;key\&quot;:true&#125;,&#123;\&quot;prop\&quot;:\&quot;explain\&quot;,\&quot;label\&quot;:\&quot;ä¸­æ–‡é‡Šä¹‰\&quot;,\&quot;required\&quot;:true&#125;]&quot;;</span><br><span class="line"> </span><br><span class="line">    // å­—ç¬¦ä¸²è½¬æˆJSONå¯¹è±¡/æ•°ç»„</span><br><span class="line">    // å­—ç¬¦ä¸²è½¬æˆJSONå¯¹è±¡</span><br><span class="line">    // æ–¹æ³•1</span><br><span class="line">    JSONObject jsonObject1 = JSON.parseObject(jsonObjectStr);</span><br><span class="line">    System.out.println(&quot;å­—ç¬¦ä¸²è½¬æˆJSONå¯¹è±¡: &quot; + jsonObject1);</span><br><span class="line"> </span><br><span class="line">    // æ–¹æ³•2</span><br><span class="line">    JSONObject jsonObject2 = (JSONObject) JSON.parse(jsonObjectStr);</span><br><span class="line">    System.out.println(&quot;å­—ç¬¦ä¸²è½¬æˆJSONå¯¹è±¡: &quot; + jsonObject2);</span><br><span class="line"> </span><br><span class="line">    // å­—ç¬¦ä¸²è½¬æˆJSONæ•°ç»„</span><br><span class="line">    // æ–¹æ³•1</span><br><span class="line">    JSONArray jsonArray1 = JSON.parseArray(jsonArrayStr);</span><br><span class="line">    System.out.println(&quot;å­—ç¬¦ä¸²è½¬æˆJSONæ•°ç»„: &quot; + jsonArray1);</span><br><span class="line"> </span><br><span class="line">    // æ–¹æ³•2</span><br><span class="line">    JSONArray jsonArray2 = (JSONArray) JSON.parse(jsonArrayStr);</span><br><span class="line">    System.out.println(&quot;å­—ç¬¦ä¸²è½¬æˆJSONæ•°ç»„: &quot; + jsonArray2);</span><br><span class="line"> </span><br><span class="line">    // å­—ç¬¦ä¸²è½¬æˆJavaå¯¹è±¡/åˆ—è¡¨</span><br><span class="line">    // å­—ç¬¦ä¸²è½¬æˆJavaå¯¹è±¡</span><br><span class="line">    Dict dict = JSON.parseObject(jsonObjectStr, Dict.class);</span><br><span class="line">    System.out.println(&quot;å­—ç¬¦ä¸²è½¬æˆJavaå¯¹è±¡: &quot; + dict.toString());</span><br><span class="line"> </span><br><span class="line">    // å­—ç¬¦ä¸²è½¬æˆJavaå¯¹è±¡åˆ—è¡¨</span><br><span class="line">    List&lt;Dict&gt; dictList = JSON.parseArray(jsonArrayStr, Dict.class);</span><br><span class="line">    System.out.println(&quot;å­—ç¬¦ä¸²è½¬æˆJavaå¯¹è±¡åˆ—è¡¨: &quot; + dictList.toString());</span><br><span class="line"> </span><br><span class="line">    // Javaå¯¹è±¡/åˆ—è¡¨è½¬æˆJSONå¯¹è±¡/æ•°ç»„</span><br><span class="line">    // Javaå¯¹è±¡è½¬æˆJSONå¯¹è±¡</span><br><span class="line">    // æ–¹æ³•1</span><br><span class="line">    JSONObject jsonObject3 = (JSONObject) JSONObject.toJSON(dict);</span><br><span class="line">    System.out.println(&quot;Javaå¯¹è±¡è½¬æˆJSONå¯¹è±¡: &quot; + jsonObject3.toJSONString());</span><br><span class="line"> </span><br><span class="line">    // æ–¹æ³•2</span><br><span class="line">    JSONObject jsonObject4 = (JSONObject) JSON.toJSON(dict);</span><br><span class="line">    System.out.println(&quot;Javaå¯¹è±¡è½¬æˆJSONå¯¹è±¡: &quot; + jsonObject4.toJSONString());</span><br><span class="line"> </span><br><span class="line">    // Javaå¯¹è±¡åˆ—è¡¨è½¬æˆJSONæ•°ç»„</span><br><span class="line">    // æ–¹æ³•1</span><br><span class="line">    JSONArray jsonArray3 = (JSONArray) JSONArray.toJSON(dictList);</span><br><span class="line">    System.out.println(&quot;Javaå¯¹è±¡åˆ—è¡¨è½¬æˆJSONæ•°ç»„: &quot; + jsonArray3.toJSONString());</span><br><span class="line"> </span><br><span class="line">    // æ–¹æ³•2</span><br><span class="line">    JSONArray jsonArray4 = (JSONArray) JSON.toJSON(dictList);</span><br><span class="line">    System.out.println(&quot;Javaå¯¹è±¡åˆ—è¡¨è½¬æˆJSONæ•°ç»„: &quot; + jsonArray4.toJSONString());</span><br><span class="line"> </span><br><span class="line">    // JSONå¯¹è±¡/æ•°ç»„è½¬æˆJavaå¯¹è±¡/åˆ—è¡¨</span><br><span class="line">    // JSONå¯¹è±¡è½¬æˆJavaå¯¹è±¡</span><br><span class="line">    // æ–¹æ³•1</span><br><span class="line">    Dict dict1 = JSON.toJavaObject(jsonObject1, Dict.class);</span><br><span class="line">    System.out.println(&quot;JSONå¯¹è±¡è½¬æˆJavaå¯¹è±¡: &quot; + dict1);</span><br><span class="line"> </span><br><span class="line">    // JSONå¯¹è±¡è½¬æˆJavaå¯¹è±¡</span><br><span class="line">    // æ–¹æ³•2</span><br><span class="line">    Dict dict2 = jsonObject1.toJavaObject(Dict.class);</span><br><span class="line">    System.out.println(&quot;JSONå¯¹è±¡è½¬æˆJavaå¯¹è±¡: &quot; + dict2);</span><br><span class="line"> </span><br><span class="line">    // JSONæ•°ç»„è½¬æˆJavaå¯¹è±¡åˆ—è¡¨</span><br><span class="line">    List&lt;Dict&gt; dictList1 = jsonArray1.toJavaList(Dict.class);</span><br><span class="line">    System.out.println(&quot;JSONæ•°ç»„è½¬æˆJavaå¯¹è±¡åˆ—è¡¨: &quot; + dictList1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/lasdaybg/p/15144350.html">https://www.cnblogs.com/lasdaybg/p/15144350.html</a></p>
<h3 id="jsonæ–‡ä»¶ä¸­è·å–"><a href="#jsonæ–‡ä»¶ä¸­è·å–" class="headerlink" title="jsonæ–‡ä»¶ä¸­è·å–"></a>jsonæ–‡ä»¶ä¸­è·å–</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class JsonTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void TestJ()&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            File jsonFile = ResourceUtils.getFile(&quot;classpath:hello.json&quot;);</span><br><span class="line">            String s = FileUtils.readFileToString(jsonFile);</span><br><span class="line">            System.out.println(&quot;s:&quot;+s);</span><br><span class="line">        &#125; catch(Exception e) &#123;</span><br><span class="line">            System.out.println(&quot;error:&quot;+e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FileUtils éœ€è¦å¯¼åŒ…ï¼šcommons-ioã€‚<br>classpathè¡¨ç¤ºé¡¹ç›®ä¸­çš„resourceæ–‡ä»¶å¤¹ã€‚</p>
<h3 id="JSONObjectã€JSONArray"><a href="#JSONObjectã€JSONArray" class="headerlink" title="JSONObjectã€JSONArray"></a>JSONObjectã€JSONArray</h3><p>ä¹Ÿæ˜¯fastjsonä¸‹çš„</p>
<p>JSONæ˜¯äº’è”ç½‘å¼€å‘è¿‡ç¨‹ä¸­åº”ç”¨æœ€å¹¿æ³›çš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œä¸ç®¡æ˜¯åç«¯APIæ¥å£ä¸­ï¼Œè¿˜æ˜¯åœ¨å‰ç«¯éƒ½èƒ½å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚JSON å°±æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œè¢«å¹¿æ³›åº”ç”¨äº WEB åº”ç”¨ç¨‹åºå¼€å‘</p>
<p>åœ¨çº¿è§£æï¼š<a href="https://c.runoob.com/front-end/53/">https://c.runoob.com/front-end/53/</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;area&quot;: &quot;å±±ä¸œèæ³½&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;é©¬é©¬é©¬é©¬é©¬ç™¾ä¸‡&quot;,</span><br><span class="line">  &quot;age&quot;: [1,2,3]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JSONã€JSONå¯¹è±¡ã€JSONæ•°ç»„åŒºåˆ«<br>JSON å‘¢åªæ˜¯ä¸€ç§å®è§‚ä¸Šçš„å«æ³•ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°±åƒ xml ç»“æ„ä¸€æ ·ï¼Œæ˜¯ä¸€ç§è§„çº¦æ€§å†…å®¹ï¼›è€Œ JSON å¯¹è±¡åˆ™æ˜¯å¯¹ JSON çš„å…·ä½“ä½“ç°ï¼›JSON æ•°ç»„åˆ™æ˜¯å°†å¤šä¸ª JSON å¯¹è±¡è¿›è¡Œå­˜å‚¨çš„ä¸€ä¸ªé›†åˆï¼Œå¯ä»¥æƒ³è±¡æˆ Java ä¸­çš„ List å’Œ Object çš„å…³ç³»</p>
<h4 id="JSONObject"><a href="#JSONObject" class="headerlink" title="JSONObject"></a>JSONObject</h4><p>JSONObject æ˜¯æ ¹æ® JSON å½¢å¼åœ¨ Java ä¸­å­˜åœ¨çš„å¯¹è±¡æ˜ å°„<br>å„å¤§ JSON ç±»åº“çš„ JSONObject å†…éƒ¨å®ç°ä¹Ÿæ˜¯ä¸å¤ªä¸€æ ·çš„ã€‚<br>ä¾‹å¦‚fastjsonï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class JSONObject extends JSON implements Map&lt;String, Object&gt;, Cloneable, Serializable, InvocationHandler &#123;</span><br><span class="line">&#125;</span><br><span class="line">å¯¹ HashMap çš„ä¸€å±‚å°è£…ï¼Œå¹¶æä¾›äº†ä¸€äº›ä¸ªæ€§åŒ–æ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">JSONObject json = new JSONObject();</span><br><span class="line">json.put(&quot;key&quot;,&quot;value&quot;);</span><br><span class="line">json.put(&quot;key1&quot;,&quot;11&quot;);</span><br><span class="line">System.out.println(json.getInteger(&quot;key1&quot;));</span><br><span class="line">System.out.println(json.getString(&quot;key&quot;));</span><br></pre></td></tr></table></figure>

<h4 id="JSONArray"><a href="#JSONArray" class="headerlink" title="JSONArray"></a>JSONArray</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class JSONArray extends JSON implements List&lt;Object&gt;, Cloneable, RandomAccess, Serializable &#123;</span><br><span class="line">&#125;</span><br><span class="line">ä¸€ä¸ª List ä¸­ å¥—äº†ä¸ª Map ç±»ç»“æ„</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">JSONObject person = new JSONObject();</span><br><span class="line">person.put(&quot;name&quot;, &quot;é©¬é©¬é©¬é©¬é©¬ç™¾ä¸‡&quot;);</span><br><span class="line">JSONObject drug = new JSONObject();</span><br><span class="line">drug.put(&quot;drugName&quot;, &quot;ç›é…¸ä¸å¡å› æ³¨å°„æ¶²&quot;);</span><br><span class="line">JSONArray array = new JSONArray();</span><br><span class="line">array.add(person);</span><br><span class="line">array.add(drug);</span><br></pre></td></tr></table></figure>

<h4 id="å„ç§è½¬æ¢"><a href="#å„ç§è½¬æ¢" class="headerlink" title="å„ç§è½¬æ¢"></a>å„ç§è½¬æ¢</h4><p>æ™®é€šå¯¹è±¡ã€jsonå­—ç¬¦ä¸²ã€jsonObject</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å°†å¯¹è±¡è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²</span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">String jsonStr = JSON.toJSONString(person);</span><br><span class="line">å°†jsonå­—ç¬¦ä¸²è½¬æ¢ä¸ºJSONObjectå¯¹è±¡</span><br><span class="line">JSONObject jsonObject = JSON.parseObject(jsonStr);</span><br><span class="line">å°†JSONObject è½¬æ¢ä¸ºå¯¹è±¡</span><br><span class="line">JSONObject person = new JSONObject();</span><br><span class="line">person.put(&quot;name&quot;, &quot;é©¬é©¬é©¬é©¬é©¬ç™¾ä¸‡&quot;);</span><br><span class="line">person.put(&quot;age&quot;, 25);</span><br><span class="line">Student stuObj = JSON.toJavaObject(person, Student.class);</span><br></pre></td></tr></table></figure>

<h3 id="ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ä¸ªå¯¹è±¡"><a href="#ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ä¸ªå¯¹è±¡" class="headerlink" title="ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ä¸ªå¯¹è±¡"></a>ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ä¸ªå¯¹è±¡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">B = JSON.parseObject(JSON.toString(a), b.class)</span><br></pre></td></tr></table></figure>


<h3 id="getJSONObjectã€getJSONArray"><a href="#getJSONObjectã€getJSONArray" class="headerlink" title="getJSONObjectã€getJSONArray"></a>getJSONObjectã€getJSONArray</h3><p>Fastjsonä¸­getJSONObject()ä¸getJSONArray()ï¼Œç”¨äºè·å–JSONObjecté‡Œçš„JSONObjectã€JSONArray()ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;    &quot;package&quot;: &#123;</span><br><span class="line">        &quot;List1&quot;: &#123;</span><br><span class="line">            &quot;errorCode&quot;: &quot;0&quot;,</span><br><span class="line">            &quot;errorMsg&quot;: &quot;Success&quot;,</span><br><span class="line">            &quot;receiverTradeNum&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;List2&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;medicalNum&quot;: &quot;15XXXXXX&quot;,</span><br><span class="line">                &quot;queryDate&quot;: &quot;YYYYMMDD&quot;,</span><br><span class="line">                &quot;name&quot;: &quot;XXX&quot;,</span><br><span class="line">                &quot;authorizationNum&quot;: &quot;xxxxx&quot;,</span><br><span class="line">                &quot;pageNum&quot;: &quot;1&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JSONObject jsonObj = JSON.parseObject(jsonStr);</span><br><span class="line">JSONObject package = jsonObj.getJSONObject(&quot;package&quot;);     // å®šä½åˆ°package jsonå¯¹è±¡</span><br><span class="line">JSONArray list = package.getJSONArray(&quot;List2&quot;);   //é‡‡ç”¨getJSONArrayæ–¹æ³•ï¼Œ å®šä½åˆ°jsoné›†åˆ</span><br></pre></td></tr></table></figure>


<h3 id="XStream"><a href="#XStream" class="headerlink" title="XStream"></a>XStream</h3><p>XStreamæ˜¯Javaç±»åº“ï¼Œç”¨æ¥å°†å¯¹è±¡åºåˆ—åŒ–æˆXMLï¼ˆJSONï¼‰æˆ–ååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨XStreamï¼Œæˆ‘ä»¬å¯ä»¥æŠŠJavaå¯¹è±¡è½¬æ¢æˆXMLï¼Œä¹Ÿå¯ä»¥å°†XMLè½¬æ¢ä¸ºJavaå¯¹è±¡ã€‚</p>
<p>ä¾èµ–ï¼š<br>XStreamçš„å¿…å¯¼JARåŒ…ï¼š<br>æ ¸å¿ƒJARåŒ…ï¼šxstream-1.4.7.jarï¼›<br>å¿…é¡»ä¾èµ–åŒ…ï¼šxpp3_min-1.1.4c.jarï¼ˆXML Pull Parserï¼Œä¸€æ¬¾é€Ÿåº¦å¾ˆå¿«çš„XMLè§£æå™¨ï¼‰ã€‚</p>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">XStream xStream = new XStream();</span><br><span class="line">xStream.alias(&quot;china&quot;, List.class);   //æ ‡ç­¾ç±»æ¢æˆæŒ‡å®šå­—ç¬¦</span><br><span class="line">xStream.alias(&quot;province&quot;, Province.class);</span><br><span class="line">xStream.alias(&quot;city&quot;, City.class);</span><br><span class="line"></span><br><span class="line">xStream.useAttributeFor(Province.class, &quot;name&quot;); //å­å…ƒç´ ç¼–ç¨‹ç†Ÿæ‚‰</span><br><span class="line">xStream.addImplicitCollection(Province.class, &quot;cities&quot;);  //å»æ‰citiesæ ‡ç­¾</span><br><span class="line"></span><br><span class="line">String string = xStream.toXML(proList);</span><br><span class="line">System.out.println(string);</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šï¼š<a href="https://blog.csdn.net/u014565127/article/details/104419528">https://blog.csdn.net/u014565127/article/details/104419528</a></p>
<p><strong>é«˜å¹¶å‘æƒ…å†µä¸‹çš„æ€§èƒ½é—®é¢˜</strong></p>
<p>é¡¹ç›®ä¸­ä½¿ç”¨äº†XStreamè¿›è¡ŒXMLåºåˆ—åŒ–ã€ååºåˆ—åŒ–çš„æ–¹æ¡ˆï¼Œå®ŒæˆæœåŠ¡ä¹‹é—´çš„æ¥å£æŠ¥æ–‡Objectä¸Xmlgæ ¼å¼ä¹‹é—´çš„è½¬åŒ–ã€‚</p>
<p>å½“çº¿ä¸Šä¸šåŠ¡é‡å¹¶ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œä¸€åˆ‡æ­£å¸¸ï¼›ä½†æ˜¯å‘ç°å½“ä¸šåŠ¡é‡çªç„¶åŠ å¤§çš„æƒ…å†µä¸‹ï¼Œçªç„¶å‘ç°ï¼Œçº¿ä¸ŠæœåŠ¡å™¨å‡ºç°CPUå±…é«˜ä¸ä¸‹ï¼ŒæœåŠ¡æ¥å£è°ƒç”¨é€Ÿåº¦è¶Šæ¥è¶Šæ…¢ï¼Œç ”ç©¶JVMæ—¥å¿—åˆ†æï¼Œå‘ç°å‡ºç°å¾ˆå¤šçš„RUNNABLEé—®é¢˜ã€‚</p>
<p>é—®é¢˜åŸå› ï¼šXStreamåœ¨newçš„æ—¶å€™ä¼šåˆ›å»ºCompositeClassLoaderï¼ˆåˆå§‹ç±»åŠ è½½å™¨ï¼‰ï¼Œå¹¶ä¸”ä¸æ–­newä¼šä¸æ–­åˆ›å»ºï¼Œå¯¼è‡´ygcéœ€è¦æ‰«æçš„å†…å®¹è¶Šæ¥è¶Šå¤šï¼Œæœ€ç»ˆå¯¼è‡´æ¥å£è°ƒç”¨æ€§èƒ½ä¸‹é™ã€‚</p>
<p>XStreamæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸éœ€è¦é‡å¤åˆå§‹åŒ–xstreamå¯¹è±¡ï¼Œæ¯ä¸€ç§ç±»å‹å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡å³å¯ï¼Œè€Œæ­£æ˜¯ç”±äºå¼€å‘äººå‘˜é”™è¯¯åœ°åœ¨æ¯æ¬¡å¤„ç†æ—¶éƒ½å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„xstreamå¯¹è±¡ï¼Œæ‰å¯¼è‡´äº†è¯¥é—®é¢˜ã€‚</p>
<p>è§£å†³ï¼šå•åˆ—æ¨¡å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸæ¥ï¼š</span><br><span class="line">XStream xstream = XStreamInitializer.getInstance();</span><br><span class="line">xstream.processAnnotations(this.getClass());</span><br><span class="line">xstream.aliasSystemAttribute(null, &quot;class&quot;);</span><br><span class="line">return xstream.toXML(this);</span><br><span class="line"></span><br><span class="line">ç°åœ¨ï¼š</span><br><span class="line">å®ç°å•åˆ—ï¼š</span><br><span class="line">public class XmlHandler&#123;</span><br><span class="line"></span><br><span class="line">    private static final ConcurrentHashMap xStream = new ConcurrentHashMap&lt;String, XStream&gt;();</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * åˆå§‹åŒ–</span><br><span class="line">     * @param objName</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private static XStream getXStream(Class&lt;?&gt; objName) &#123;</span><br><span class="line">        String key = objName.getName();</span><br><span class="line">        if (xStream.get(key) == null)</span><br><span class="line">            xStream.put(key, new XStream());</span><br><span class="line">        return (XStream) xStream.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">åºåˆ—åŒ–ï¼š</span><br><span class="line">XStream xstream = XmlHandler.getXStream(Dog.class);</span><br><span class="line">xstream.processAnnotations(Dog.class);</span><br><span class="line">String xml = xstream.toXML(dog);</span><br><span class="line"></span><br><span class="line">ååºåˆ—åŒ–ï¼š</span><br><span class="line">XStream xStream = XmlHandler.getXStream(Dog.class);</span><br><span class="line">xStream.processAnnotations(Dog.class);</span><br><span class="line">Dog dog = (Dog) xStream.fromXML(xml);</span><br></pre></td></tr></table></figure>

<p>åŸæ–‡ï¼š<a href="https://blog.csdn.net/weixin_43767602/article/details/114824028">https://blog.csdn.net/weixin_43767602/article/details/114824028</a></p>
<h3 id="JSONä¸XMLè½¬åŒ–"><a href="#JSONä¸XMLè½¬åŒ–" class="headerlink" title="JSONä¸XMLè½¬åŒ–"></a>JSONä¸XMLè½¬åŒ–</h3><p>è¯¦è§ï¼š<a href="https://blog.csdn.net/CDWLX/article/details/119038509">https://blog.csdn.net/CDWLX/article/details/119038509</a><br><a href="https://blog.csdn.net/baidu_37366055/article/details/110468129">https://blog.csdn.net/baidu_37366055/article/details/110468129</a></p>
<p>xmlè½¬jsonï¼šç”¨ org.jdomï¼Œç”¨ dom æå–èŠ‚ç‚¹ è½¬æˆmap<br>jsonè½¬xmlï¼š com.alibaba.fastjson.JSONObject</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.jdom&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jdom&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;dom4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;dom4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.6.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;gson&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.16.graal&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.StringReader;</span><br><span class="line">import java.io.StringWriter;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Iterator;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Map.Entry;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line">import org.dom4j.io.OutputFormat;</span><br><span class="line">import org.dom4j.io.SAXReader;</span><br><span class="line">import org.dom4j.io.XMLWriter;</span><br><span class="line">import org.jdom.Document;</span><br><span class="line">import org.jdom.Element;</span><br><span class="line">import org.jdom.JDOMException;</span><br><span class="line">import org.jdom.input.SAXBuilder;</span><br><span class="line">import org.xml.sax.InputSource;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONArray;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line">public class JsonXML &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        //è¯·æ³¨æ„ä½¿ç”¨æ­£å¸¸çš„xml</span><br><span class="line">        //xml-&gt;json</span><br><span class="line">//      String jsonStr = xmlToJson(&quot;D:\\NewFile.xml&quot;, null);</span><br><span class="line">//      System.out.println(jsonStr);</span><br><span class="line"></span><br><span class="line">        //json-&gt;xml</span><br><span class="line">        String xmlstr = jsonToXml(&quot;&#123;\&quot;b_content\&quot;:&#123;\&quot;sdata\&quot;:\&quot;Ps/DPJnZZPN6QQJQodY3+hK6PWCF3/2oi3DJPnFEXgKDrXX5rHT7q/I0nQPAruuBbQRfErnenQNvPpbf/lXl690qtye0/ZEuDs0ByFdFAGffQalB+Ij3lLUMDPz=\&quot;,\&quot;userobj\&quot;:&#123;\&quot;uid\&quot;:\&quot;ma000\&quot;,\&quot;realtype\&quot;:\&quot;DC\&quot;,\&quot;cn\&quot;:\&quot;æ³•äººç”¨æˆ·2\&quot;,\&quot;tokenid\&quot;:\&quot;\&quot;,\&quot;usertype\&quot;:\&quot;2\&quot;,\&quot;link_person_name\&quot;:\&quot;è”ç³»äºº2\&quot;,\&quot;isreal\&quot;:\&quot;true\&quot;,\&quot;telephonenumber\&quot;:\&quot;13*******21\&quot;,\&quot;mail\&quot;:\&quot;ceshi@123.com\&quot;,\&quot;idcardtype\&quot;:\&quot;10\&quot;,\&quot;createtime\&quot;:\&quot;20150618191221\&quot;,\&quot;extproperties\&quot;:[\&quot;address=å¹¿ä¸œçœå¹¿å·å¸‚å¤©æ²³åŒºå¤©æ²³åŒ—è·¯XXXå·\&quot;,\&quot;legal_code=440***********033\&quot;,\&quot;ent_type=-1\&quot;,\&quot;link_person_code=350************14\&quot;,\&quot;origin=gdbs\&quot;,\&quot;card_type_two_num=-1\&quot;,\&quot;cert_ca=-1\&quot;,\&quot;accout_type=2\&quot;,\&quot;account_uid=2\&quot;,\&quot;comm_code=-1\&quot;,\&quot;unit_type=-1\&quot;,\&quot;legal_id_type=10\&quot;,\&quot;landline=-1\&quot;,\&quot;tax_code=-1\&quot;,\&quot;cert_notafter=-1\&quot;,\&quot;card_type_one_num=-1\&quot;,\&quot;local_user=-1\&quot;,\&quot;legal_person=éƒ‘**\&quot;,\&quot;link_person_type=10\&quot;,\&quot;card_type_three=-1\&quot;,\&quot;card_type_two=-1\&quot;,\&quot;card_type_three_num=-1\&quot;,\&quot;cert_data=-1\&quot;,\&quot;area=guangzhou\&quot;,\&quot;uversion=3.0\&quot;,\&quot;cert_notbefore=-1\&quot;,\&quot;card_type_one=-1\&quot;,\&quot;user_typeext=2\&quot;],\&quot;idcardnumber\&quot;:\&quot;11***************23\&quot;,\&quot;useridcode\&quot;:\&quot;38c97fa1ee2e43d4a664cffc4554cde4\&quot;,\&quot;creditable_level_of_account_way\&quot;:\&quot;L2@YSS@2088******653||L0@IDV@44088******75||L3@GW@44088******75\&quot;,\&quot;creditable_level_of_account\&quot;:\&quot;L3\&quot;&#125;,\&quot;pareobj\&quot;:&#123;\&quot;uid\&quot;:\&quot;mayintao\&quot;,\&quot;realtype\&quot;:\&quot;DC\&quot;,\&quot;cn\&quot;:\&quot;å•ä½ç”¨æˆ·2\&quot;,\&quot;tokenid\&quot;:\&quot;\&quot;,\&quot;usertype\&quot;:\&quot;2\&quot;,\&quot;link_person_name\&quot;:\&quot;è”ç³»äºº2\&quot;,\&quot;isreal\&quot;:\&quot;true\&quot;,\&quot;telephonenumber\&quot;:\&quot;13*******21\&quot;,\&quot;mail\&quot;:\&quot;ceshi@123.com\&quot;,\&quot;idcardtype\&quot;:\&quot;50\&quot;,\&quot;createtime\&quot;:\&quot;20150618191221\&quot;,\&quot;extproperties\&quot;:[\&quot;address=å¹¿ä¸œçœå¹¿å·å¸‚ä¸œå±±åŒº\&quot;,\&quot;legal_id_type=-1\&quot;,\&quot;link_person_type=-1\&quot;,\&quot;legal_code=-1\&quot;,\&quot;origin=gdbs\&quot;,\&quot;tax_code=-1\&quot;,\&quot;legal_person=-1\&quot;,\&quot;area=shenzhen\&quot;,\&quot;link_person_code=-1\&quot;,\&quot;user_typeext=2\&quot;,\&quot;uversion=1.0\&quot;],\&quot;idcardnumber\&quot;:\&quot;456787654\&quot;,\&quot;useridcode\&quot;:\&quot;75c91fagrr2e67d4a169cfmc8735ctrf\&quot;,\&quot;creditable_level_of_account_way\&quot;:\&quot;L2@YSS@2088******653||L0@IDV@44088******75||L3@GW@44088******75\&quot;,\&quot;creditable_level_of_account\&quot;:\&quot;L3\&quot;&#125;,\&quot;user_creditable_level\&quot;:&#123;\&quot;creditable_level_of_account_way\&quot;:\&quot;L2@YSS@2088******653||L0@IDV@44088******75||L3@GW@44088******75\&quot;,\&quot;creditable_level_of_account_way_list\&quot;:[&#123;\&quot;auth_time\&quot;:\&quot;2018-02-28 16:45:26\&quot;,\&quot;uniqueid\&quot;:\&quot;***86f93fb61***\&quot;,\&quot;user_name\&quot;:\&quot;éƒ­**\&quot;,\&quot;auth_identification\&quot;:\&quot;2088******653\&quot;,\&quot;identity_level\&quot;:\&quot;L2\&quot;,\&quot;credential_no\&quot;:\&quot;44088******75\&quot;,\&quot;way_code\&quot;:\&quot;YSS\&quot;&#125;,&#123;\&quot;auth_time\&quot;:null,\&quot;uniqueid\&quot;:\&quot;***764486f93fb61212***\&quot;,\&quot;user_name\&quot;:\&quot;éƒ­**\&quot;,\&quot;auth_identification\&quot;:\&quot;44088******75\&quot;,\&quot;identity_level\&quot;:\&quot;L0\&quot;,\&quot;credential_no\&quot;:\&quot;44088******75\&quot;,\&quot;way_code\&quot;:\&quot;IDV\&quot;&#125;,&#123;\&quot;auth_time\&quot;:\&quot;2018-02-13 17:12:31\&quot;,\&quot;uniqueid\&quot;:\&quot;*****764486f93fb612122*****\&quot;,\&quot;user_name\&quot;:\&quot;éƒ­**\&quot;,\&quot;auth_identification\&quot;:\&quot;44088******75\&quot;,\&quot;identity_level\&quot;:\&quot;L3\&quot;,\&quot;credential_no\&quot;:\&quot;44088******75\&quot;,\&quot;way_code\&quot;:\&quot;GW\&quot;&#125;],\&quot;creditable_level_of_account\&quot;:\&quot;L3\&quot;&#125;&#125;,\&quot;time_stamp\&quot;:\&quot;20200821\&quot;,\&quot;version \&quot;:\&quot;v1\&quot;,\&quot;sign\&quot;:\&quot;rxf0MFT7eQqYgYKWtgzNBi6mhS2tbqkPgI \&quot;&#125;&quot;);</span><br><span class="line">        System.out.println(xmlstr);</span><br><span class="line">        createXMLFile(formatXML(xmlstr), &quot;æµ‹è¯•&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * xmlè½¬jsonå­—ç¬¦ä¸² æ³¨æ„:è·¯å¾„å’Œå­—ç¬¦ä¸²äºŒä¼ ä¸€å¦å¤–ä¸€ä¸ªä¼ null&lt;br&gt;</span><br><span class="line">     * æ–¹ æ³• åï¼šxmlToJson &lt;br&gt;</span><br><span class="line">     * @param xmlPath xmlè·¯å¾„(å’Œå­—ç¬¦ä¸²äºŒä¼ ä¸€,ä¸¤æ ·éƒ½ä¼ ä¼˜å…ˆä½¿ç”¨è·¯å¾„)</span><br><span class="line">     * @param xmlStr xmlå­—ç¬¦ä¸²(å’Œè·¯å¾„äºŒä¼ ä¸€,ä¸¤æ ·éƒ½ä¼ ä¼˜å…ˆä½¿ç”¨è·¯å¾„)</span><br><span class="line">     * @return String</span><br><span class="line">     * @throws IOException</span><br><span class="line">     * @throws JDOMException</span><br><span class="line">     */</span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public static String xmlToJson(String xmlPath,String xmlStr)&#123;</span><br><span class="line">        SAXBuilder sbder = new SAXBuilder();</span><br><span class="line">        Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">        Document document;</span><br><span class="line">        try &#123;</span><br><span class="line">            if(xmlPath!=null)&#123;</span><br><span class="line">                //è·¯å¾„</span><br><span class="line">                document = sbder.build(new File(xmlPath));</span><br><span class="line">            &#125;else if(xmlStr!=null)&#123;</span><br><span class="line">                //xmlå­—ç¬¦</span><br><span class="line">                StringReader reader = new StringReader(xmlStr);</span><br><span class="line">                InputSource ins = new InputSource(reader);</span><br><span class="line">                document = sbder.build(ins);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                return &quot;&#123;&#125;&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">            //è·å–æ ¹èŠ‚ç‚¹</span><br><span class="line">            Element el =  document.getRootElement();</span><br><span class="line">            List&lt;Element&gt; eList =  el.getChildren();</span><br><span class="line">            Map&lt;String, Object&gt; rootMap = new HashMap&lt;String, Object&gt;();</span><br><span class="line">            //å¾—åˆ°é€’å½’ç»„è£…çš„map</span><br><span class="line">            rootMap = xmlToMap(eList,rootMap);</span><br><span class="line">            map.put(el.getName(), rootMap);</span><br><span class="line">            //å°†mapè½¬æ¢ä¸ºjson è¿”å›</span><br><span class="line">            return JSON.toJSONString(map);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            return &quot;&#123;&#125;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * jsonè½¬xml&lt;br&gt;</span><br><span class="line">     * æ–¹ æ³• åï¼šjsonToXml &lt;br&gt;</span><br><span class="line">     * @param json</span><br><span class="line">     * @return String</span><br><span class="line">     */</span><br><span class="line">    public static String jsonToXml(String json)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            StringBuffer buffer = new StringBuffer();</span><br><span class="line">            buffer.append(&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;);</span><br><span class="line">            buffer.append(&quot;&lt;base&gt;&quot;);</span><br><span class="line">            JSONObject jObj = JSON.parseObject(json);</span><br><span class="line">            jsonToXmlstr(jObj,buffer);</span><br><span class="line">            buffer.append(&quot;&lt;/base&gt;&quot;);</span><br><span class="line">            return buffer.toString();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return &quot;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * jsonè½¬str&lt;br&gt;</span><br><span class="line">     * æ–¹ æ³• åï¼šjsonToXmlstr &lt;br&gt;</span><br><span class="line">     * @param jObj</span><br><span class="line">     * @param buffer</span><br><span class="line">     * @return String</span><br><span class="line">     */</span><br><span class="line">    public static String jsonToXmlstr(JSONObject jObj,StringBuffer buffer )&#123;</span><br><span class="line">        Set&lt;Entry&lt;String, Object&gt;&gt;  se = jObj.entrySet();</span><br><span class="line">        for( Iterator&lt;Entry&lt;String, Object&gt;&gt;   it = se.iterator();  it.hasNext(); )</span><br><span class="line">        &#123;</span><br><span class="line">            Entry&lt;String, Object&gt; en = it.next();</span><br><span class="line">            if(en.getValue() != null &amp;&amp; en.getValue().getClass().getName().equals(&quot;com.alibaba.fastjson.JSONObject&quot;))&#123;</span><br><span class="line">                buffer.append(&quot;&lt;&quot;+en.getKey()+&quot;&gt;&quot;);</span><br><span class="line">                JSONObject jo = jObj.getJSONObject(en.getKey());</span><br><span class="line">                jsonToXmlstr(jo,buffer);</span><br><span class="line">                buffer.append(&quot;&lt;/&quot;+en.getKey()+&quot;&gt;&quot;);</span><br><span class="line">            &#125;else if(en.getValue() != null &amp;&amp; en.getValue().getClass().getName().equals(&quot;com.alibaba.fastjson.JSONArray&quot;))&#123;</span><br><span class="line">                if (en.getKey().equals(&quot;extproperties&quot;)) &#123;</span><br><span class="line">                    JSONArray ja = jObj.getJSONArray(en.getKey());</span><br><span class="line">                    Iterator&lt;Object&gt; it1 = ja.iterator();</span><br><span class="line">                    List&lt;String&gt; list=new ArrayList&lt;String&gt;();</span><br><span class="line">                    while (it1.hasNext()) &#123;</span><br><span class="line">                        String ob = (String) it1.next();</span><br><span class="line">                        System.out.println(ob);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;else &#123;</span><br><span class="line">                    JSONArray jarray = jObj.getJSONArray(en.getKey());</span><br><span class="line">                    for (int i = 0; i &lt; jarray.size(); i++) &#123;</span><br><span class="line">                        buffer.append(&quot;&lt;&quot;+en.getKey()+&quot;&gt;&quot;);</span><br><span class="line">                        JSONObject jsonobject =  jarray.getJSONObject(i);</span><br><span class="line">                        jsonToXmlstr(jsonobject,buffer);</span><br><span class="line">                        buffer.append(&quot;&lt;/&quot;+en.getKey()+&quot;&gt;&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;else if(en.getValue() != null &amp;&amp; en.getValue().getClass().getName().equals(&quot;java.lang.String&quot;))&#123;</span><br><span class="line">                buffer.append(&quot;&lt;&quot;+en.getKey()+&quot;&gt;&quot;+en.getValue());</span><br><span class="line">                buffer.append(&quot;&lt;/&quot;+en.getKey()+&quot;&gt;&quot;);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                buffer.append(&quot;&lt;&quot;+en.getKey()+&quot;&gt;&quot;+&quot;&quot;);</span><br><span class="line">                buffer.append(&quot;&lt;/&quot;+en.getKey()+&quot;&gt;&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        return buffer.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * èŠ‚ç‚¹è½¬map&lt;br&gt;</span><br><span class="line">     * æ–¹ æ³• åï¼šxmlToMap &lt;br&gt;</span><br><span class="line">     * @param eList</span><br><span class="line">     * @param map</span><br><span class="line">     * @return Map&lt;String,Object&gt;</span><br><span class="line">     */</span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public static Map&lt;String, Object&gt; xmlToMap(List&lt;Element&gt; eList,Map&lt;String, Object&gt; map)&#123;</span><br><span class="line">        for (Element e : eList) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; eMap = new HashMap&lt;String, Object&gt;();</span><br><span class="line">            List&lt;Element&gt; elementList = e.getChildren();</span><br><span class="line">            if(elementList!=null&amp;&amp;elementList.size()&gt;0)&#123;</span><br><span class="line">                eMap = xmlToMap(elementList,eMap);</span><br><span class="line">                Object obj = map.get(e.getName());</span><br><span class="line">                if(obj!=null)&#123;</span><br><span class="line">                    List&lt;Object&gt; olist = new ArrayList&lt;Object&gt;();</span><br><span class="line">                    if(obj.getClass().getName().equals(&quot;java.util.HashMap&quot;))&#123;</span><br><span class="line">                        olist.add(obj);</span><br><span class="line">                        olist.add(eMap);</span><br><span class="line"></span><br><span class="line">                    &#125;else if(obj.getClass().getName().equals(&quot;java.util.ArrayList&quot;))&#123;</span><br><span class="line">                        olist = (List&lt;Object&gt;)obj;</span><br><span class="line">                        olist.add(eMap);</span><br><span class="line">                    &#125;</span><br><span class="line">                    map.put(e.getName(), olist);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    map.put(e.getName(), eMap);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                map.put(e.getName(), e.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * å°†å·²ç»æ ¼å¼åŒ–çš„xmlå­—ç¬¦ä¸²å†™å…¥xmlæ–‡ä»¶</span><br><span class="line">     * @param xmlStr</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static boolean createXMLFile(String xmlStr,String xmlName)&#123;</span><br><span class="line">        boolean flag = false;</span><br><span class="line">        try &#123;</span><br><span class="line">            XMLWriter output = null;</span><br><span class="line">            //OutputFormat   format   =   OutputFormat.createPrettyPrint();</span><br><span class="line">            //format.setSuppressDeclaration(true);</span><br><span class="line">            // format.setEncoding(&quot;UTF-8&quot;);</span><br><span class="line"></span><br><span class="line">            //å¦‚æœä¸Šé¢è®¾ç½®çš„xmlç¼–ç ç±»å‹ä¸ºGBKï¼Œåˆ™åº”å½“ç”¨FileWriteræ¥æ„å»ºxmlæ–‡ä»¶ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸­æ–‡è¿ç é—®é¢˜</span><br><span class="line">                /*outpt = new XMLWriter(</span><br><span class="line">                        new FileWriter(</span><br><span class="line">                                new File(&quot;D:/myeclipse/Workspaces/fusionChartsDemoTest/WebRoot/xml/&quot;+xmlName+&quot;.xml&quot;)) ,</span><br><span class="line">                                    format);</span><br><span class="line">                  */</span><br><span class="line"></span><br><span class="line">            //å¦‚æœä¸Šé¢è®¾ç½®çš„xmlç¼–ç ç±»å‹ä¸ºutf-8ï¼Œåˆ™åº”å½“ç”¨FileOutputStreamæ¥æ„å»ºxmlæ–‡ä»¶ï¼Œå¦åˆ™è¿˜æ˜¯ä¼šå‡ºç°é—®é¢˜</span><br><span class="line">            output = new XMLWriter(</span><br><span class="line">                    new FileOutputStream(</span><br><span class="line">                            new File(&quot;D:/&quot;+xmlName+&quot;.xml&quot;)));</span><br><span class="line">            output.setEscapeText(false);</span><br><span class="line">            output.write( xmlStr );</span><br><span class="line">            output.close();</span><br><span class="line">            return flag = true;</span><br><span class="line"></span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return flag;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static  String formatXML(String str) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        SAXReader reader=new SAXReader();</span><br><span class="line"></span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªä¸²çš„å­—ç¬¦è¾“å…¥æµ</span><br><span class="line">        StringReader in=new StringReader(str);</span><br><span class="line">        org.dom4j.Document doc=reader.read(in);</span><br><span class="line">        // åˆ›å»ºè¾“å‡ºæ ¼å¼</span><br><span class="line">        OutputFormat formater=OutputFormat.createPrettyPrint();</span><br><span class="line">        //å»æ‰xmlæ–‡ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">        //formater.setSuppressDeclaration(true);</span><br><span class="line">        //è®¾ç½®xmlçš„è¾“å‡ºç¼–ç </span><br><span class="line">        formater.setEncoding(&quot;UTF-8&quot;);</span><br><span class="line">        //åˆ›å»ºè¾“å‡º(ç›®æ ‡)</span><br><span class="line">        StringWriter out=new StringWriter();</span><br><span class="line">        //åˆ›å»ºè¾“å‡ºæµ</span><br><span class="line">        XMLWriter writer=new XMLWriter(out,formater);</span><br><span class="line">        //è¾“å‡ºæ ¼å¼åŒ–çš„ä¸²åˆ°ç›®æ ‡ä¸­ï¼Œæ‰§è¡Œåã€‚æ ¼å¼åŒ–åçš„ä¸²ä¿å­˜åœ¨outä¸­ã€‚</span><br><span class="line">        writer.write(doc);</span><br><span class="line"></span><br><span class="line">        writer.close();</span><br><span class="line"></span><br><span class="line">        // System.out.println(out.toString());</span><br><span class="line"></span><br><span class="line">        //è¿”å›æˆ‘ä»¬æ ¼å¼åŒ–åçš„ç»“æœ</span><br><span class="line">        return out.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå¤šçº¿ç¨‹</title>
    <url>/2022/05/21/myblog/java/java%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<h3 id="çº¿ç¨‹æ± Executorã€ExecutorServiceã€Executorsä¸‰è€…å…³ç³»"><a href="#çº¿ç¨‹æ± Executorã€ExecutorServiceã€Executorsä¸‰è€…å…³ç³»" class="headerlink" title="çº¿ç¨‹æ± Executorã€ExecutorServiceã€Executorsä¸‰è€…å…³ç³»"></a>çº¿ç¨‹æ± Executorã€ExecutorServiceã€Executorsä¸‰è€…å…³ç³»</h3><p><img src="/images/Executor%E7%BB%93%E6%9E%84%E5%9B%BE.png"></p>
<p><img src="/images/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%8E%A5%E5%8F%A3%E5%85%B3%E7%B3%BB%E5%9B%BE.png"></p>
<p>å±‚æ¬¡å…³ç³»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface ExecutorService extends Executor &#123;&#125;</span><br><span class="line">public abstract class AbstractExecutorService implements ExecutorService &#123;&#125;</span><br><span class="line">public interface ScheduledExecutorService extends ExecutorService &#123;&#125;</span><br><span class="line"></span><br><span class="line">public class ThreadPoolExecutor extends AbstractExecutorService &#123;&#125;</span><br><span class="line">public class ScheduledThreadPoolExecutor extends ThreadPoolExecutor implements ScheduledExecutorService &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>åŒºåˆ«ï¼š<br>1.ExecutorService æ¥å£ç»§æ‰¿äº†Executor æ¥å£ï¼Œæ˜¯Executor çš„å­æ¥å£ã€‚</p>
<p>2.Executoræ¥å£ä¸­å®šä¹‰äº†execute()æ–¹æ³•ï¼Œç”¨æ¥æ¥æ”¶ä¸€ä¸ªRunnableæ¥å£çš„å¯¹è±¡ï¼Œè€ŒExecutorServiceæ¥å£ä¸­å®šä¹‰çš„submit()æ–¹æ³•å¯ä»¥æ¥æ”¶Runnableå’ŒCallableæ¥å£å¯¹è±¡ã€‚</p>
<p>3.Executoræ¥å£ä¸­execute()æ–¹æ³•ä¸è¿”å›ä»»ä½•ç»“æœï¼Œè€ŒExecutorServiceæ¥å£ä¸­submit()æ–¹æ³•å¯ä»¥é€šè¿‡ä¸€ä¸ª Future å¯¹è±¡è¿”å›è¿ç®—ç»“æœã€‚</p>
<p>4.Executorå’ŒExecutorServiceé™¤äº†å…è®¸å®¢æˆ·ç«¯æäº¤ä¸€ä¸ªä»»åŠ¡ï¼ŒExecutorService è¿˜æä¾›ç”¨æ¥æ§åˆ¶çº¿ç¨‹æ± çš„æ–¹æ³•ã€‚<br>æ¯”å¦‚ï¼šè°ƒç”¨ shutDown() æ–¹æ³•ç»ˆæ­¢çº¿ç¨‹æ± ã€‚</p>
<p>5.Executors æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç±»ä¼¼äº Collectionsã€‚Executors ç±»æä¾›å·¥å‚æ–¹æ³•ç”¨æ¥åˆ›å»ºä¸åŒç±»å‹çš„çº¿ç¨‹æ± ã€‚æ¯”å¦‚:<br>ã€€ã€€ Executors.newSingleThreadExecutor() åˆ›å»ºä¸€ä¸ªåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œ<br>ã€€ã€€ Executors.newFixedThreadPool(int numOfThreads)æ¥åˆ›å»ºå›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œ<br>ã€€ã€€ Executors.newCachedThreadPool()åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚<br>ã€€ã€€ Executors.newScheduledThreadPool(int corePoolSize) åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œã€‚</p>
<p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/whx20100101/p/9862392.html">https://www.cnblogs.com/whx20100101/p/9862392.html</a></p>
<p>ä½¿ç”¨Executorsè¿˜æ˜¯ExecutorServiceï¼Ÿ<br>å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å‡å¤„äºå·¥ä½œçŠ¶æ€ï¼Œå¹¶ä¸”çº¿ç¨‹æ•°å·²è¾¾çº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°æ—¶ï¼Œå°±ä¼šé‡‡å–æŒ‡å®šçš„é¥±å’Œç­–ç•¥æ¥å¤„ç†æ–°æäº¤çš„ä»»åŠ¡ã€‚æ€»å…±æœ‰å››ç§ç­–ç•¥ï¼š<br>AbortPolicy: ç›´æ¥æŠ›å¼‚å¸¸<br>CallerRunsPolicy: ç”¨è°ƒç”¨è€…çš„çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡<br>DiscardOldestPolicy: ä¸¢å¼ƒçº¿ç¨‹é˜Ÿåˆ—é‡Œæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡<br>DiscardPolicy ç›´æ¥å°†æ–°ä»»åŠ¡ä¸¢å¼ƒ</p>
<p>å¦‚æœä½¿ç”¨ Executors çš„å·¥å‚æ–¹æ³•åˆ›å»ºçš„çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆé¥±å’Œç­–ç•¥éƒ½æ˜¯é‡‡ç”¨é»˜è®¤çš„ AbortPolicyï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³å½“çº¿ç¨‹æ± å·²æ»¡çš„æƒ…å†µï¼Œä½¿ç”¨è°ƒç”¨è€…çš„çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡ï¼Œå°±è¦è‡ªå·±åˆ›å»ºçº¿ç¨‹æ± ï¼ŒæŒ‡å®šæƒ³è¦çš„é¥±å’Œç­–ç•¥ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Executors äº†ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»º ThreadPoolExecutor(ExecutorServiceæ¥å£çš„å®ç°ç±») å¯¹è±¡ï¼Œè‡ªå®šä¹‰ä¸€äº›å‚æ•°ï¼Œè€Œä¸æ˜¯è°ƒç”¨ Executors çš„å·¥å‚æ–¹æ³•åˆ›å»ºã€‚</p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_43921491/article/details/115717604">https://blog.csdn.net/weixin_43921491/article/details/115717604</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ExecutorService executor = new ThreadPoolExecutor(...);</span><br><span class="line">executor.submit(()-&gt;å•æ¡è¯­å¥);</span><br><span class="line"></span><br><span class="line">executor.submit(new Runnable()&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        dosomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="çº¿ç¨‹æ± java-util-concurrent-ThreadPoolExecutor"><a href="#çº¿ç¨‹æ± java-util-concurrent-ThreadPoolExecutor" class="headerlink" title="çº¿ç¨‹æ± java.util.concurrent.ThreadPoolExecutor"></a>çº¿ç¨‹æ± java.util.concurrent.ThreadPoolExecutor</h3><p>æ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ThreadPoolExecutor(int corePoolSize, </span><br><span class="line">int maximumPoolSize, </span><br><span class="line">long keepAliveTime, </span><br><span class="line">TimeUnit unit, </span><br><span class="line">BlockingQueue workQueue,  </span><br><span class="line">RejectedExecutionHandler handler) </span><br><span class="line"></span><br><span class="line">corePoolSizeï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å°‘æ•°é‡ </span><br><span class="line">maximumPoolSizeï¼šçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å¤§æ•°é‡ </span><br><span class="line">keepAliveTimeï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´ </span><br><span class="line">unitï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´çš„å•ä½ </span><br><span class="line">workQueueï¼š çº¿ç¨‹æ± æ‰€ä½¿ç”¨çš„ç¼“å†²é˜Ÿåˆ— </span><br><span class="line">handlerï¼š çº¿ç¨‹æ± å¯¹æ‹’ç»ä»»åŠ¡çš„å¤„ç†ç­–ç•¥ </span><br><span class="line"></span><br><span class="line">unitå¯é€‰çš„å‚æ•°ä¸ºjava.util.concurrent.TimeUnitä¸­çš„å‡ ä¸ªé™æ€å±æ€§ï¼š </span><br><span class="line">NANOSECONDSã€MICROSECONDSã€MILLISECONDSã€SECONDSã€‚ </span><br><span class="line"></span><br><span class="line">workQueueå¯ç”¨çš„é˜Ÿåˆ—ç±»æ˜¯ï¼šjava.util.concurrent.ArrayBlockingQueue </span><br><span class="line"></span><br><span class="line">handleræœ‰å››ä¸ªé€‰æ‹©ï¼š </span><br><span class="line">ï¼ˆ1ï¼‰ThreadPoolExecutor.AbortPolicy()   æŠ›å‡ºjava.util.concurrent.RejectedExecutionExceptionå¼‚å¸¸ </span><br><span class="line">ï¼ˆ2ï¼‰ThreadPoolExecutor.CallerRunsPolicy()  é‡è¯•æ·»åŠ å½“å‰çš„ä»»åŠ¡ï¼Œä»–ä¼šè‡ªåŠ¨é‡å¤è°ƒç”¨execute()æ–¹æ³• </span><br><span class="line">ï¼ˆ3ï¼‰ThreadPoolExecutor.DiscardOldestPolicy() æŠ›å¼ƒæ—§çš„ä»»åŠ¡ ï¼ˆç­‰å¾…é˜Ÿåˆ—é‡Œé¢æœ€æ—©è¿›å…¥çš„ï¼‰</span><br><span class="line">ï¼ˆ4ï¼‰ThreadPoolExecutor.DiscardPolicy()     æŠ›å¼ƒå½“å‰çš„ä»»åŠ¡ </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“ä¸€ä¸ªä»»åŠ¡ï¼ˆ Runnableç±»å‹çš„å¯¹è±¡ï¼‰é€šè¿‡execute(Runnable)æ–¹æ³•æ¬²æ·»åŠ åˆ°çº¿ç¨‹æ± æ—¶ï¼š<br>1ã€å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å°äºcorePoolSizeï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½å¤„äºç©ºé—²çŠ¶æ€ï¼Œä¹Ÿè¦åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¢«æ·»åŠ çš„ä»»åŠ¡ã€‚<br>2ã€å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ç­‰äº corePoolSizeï¼Œä½†æ˜¯ç¼“å†²é˜Ÿåˆ— workQueueæœªæ»¡ï¼Œé‚£ä¹ˆä»»åŠ¡è¢«æ”¾å…¥ç¼“å†²é˜Ÿåˆ—ã€‚<br>3ã€å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSizeï¼Œç¼“å†²é˜Ÿåˆ—workQueueæ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å°äºmaximumPoolSizeï¼Œå»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¢«æ·»åŠ çš„ä»»åŠ¡ã€‚<br>4ã€å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSizeï¼Œç¼“å†²é˜Ÿåˆ—workQueueæ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ç­‰äºmaximumPoolSizeï¼Œé‚£ä¹ˆé€šè¿‡ handleræ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†æ­¤ä»»åŠ¡ã€‚ </p>
<p>ä¹Ÿå°±æ˜¯ï¼šå¤„ç†ä»»åŠ¡çš„ä¼˜å…ˆçº§ä¸ºï¼š<br>æ ¸å¿ƒçº¿ç¨‹corePoolSizeã€ä»»åŠ¡é˜Ÿåˆ—workQueueã€æœ€å¤§çº¿ç¨‹maximumPoolSizeï¼Œå¦‚æœä¸‰è€…éƒ½æ»¡äº†ï¼Œä½¿ç”¨handlerå¤„ç†è¢«æ‹’ç»çš„ä»»åŠ¡ã€‚ </p>
<p>å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSizeæ—¶ï¼Œå¦‚æœæŸçº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeï¼Œçº¿ç¨‹å°†è¢«ç»ˆæ­¢ã€‚è¿™æ ·ï¼Œçº¿ç¨‹æ± å¯ä»¥åŠ¨æ€çš„è°ƒæ•´æ± ä¸­çš„çº¿ç¨‹æ•°ã€‚ </p>
<p>å®ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test3() throws InterruptedException &#123;</span><br><span class="line">    ExecutorService threadPool = new ThreadPoolExecutor(2, 4, 3, TimeUnit.SECONDS,</span><br><span class="line">            new ArrayBlockingQueue&lt;Runnable&gt;(3), new ThreadPoolExecutor.AbortPolicy());</span><br><span class="line"></span><br><span class="line">    class ThreadPoolTask implements Runnable, Serializable &#123;</span><br><span class="line">        private static final long serialVersionUID = 0;</span><br><span class="line">        // ä¿å­˜ä»»åŠ¡æ‰€éœ€è¦çš„æ•°æ®</span><br><span class="line">        private Object threadPoolTaskData;</span><br><span class="line"></span><br><span class="line">        ThreadPoolTask(Object tasks) &#123;</span><br><span class="line">            this.threadPoolTaskData = tasks;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void run() &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;start ..&quot; + getTask());</span><br><span class="line">            try &#123;</span><br><span class="line">                // //ä¾¿äºè§‚å¯Ÿï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´</span><br><span class="line">                Thread.sleep(2000);</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            threadPoolTaskData = null;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Object getTask() &#123;</span><br><span class="line">            return this.threadPoolTaskData;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (int i = 1; i &lt;= 8; i++) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // äº§ç”Ÿä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°çº¿ç¨‹æ± </span><br><span class="line">            String task = &quot;task@ &quot; + i;</span><br><span class="line">            System.out.println(&quot;put &quot; + task);</span><br><span class="line">            threadPool.submit(new ThreadPoolTask(task));</span><br><span class="line">            // ä¾¿äºè§‚å¯Ÿï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´</span><br><span class="line">            Thread.sleep(2);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Thread.sleep(10000);</span><br><span class="line">    // ä¹Ÿå¯ä»¥ç›´æ¥ç”¨lambdaè¡¨è¾¾å¼å¾€çº¿ç¨‹æ± é‡ŒåŠ çº¿ç¨‹</span><br><span class="line">    threadPool.submit(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + &quot;start ..&quot; + &quot;lambda&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š</span><br><span class="line">put task@ 1</span><br><span class="line">pool-1-thread-1start ..task@ 1</span><br><span class="line">put task@ 2</span><br><span class="line">pool-1-thread-2start ..task@ 2</span><br><span class="line">put task@ 3</span><br><span class="line">put task@ 4</span><br><span class="line">put task@ 5</span><br><span class="line">put task@ 6</span><br><span class="line">pool-1-thread-3start ..task@ 6</span><br><span class="line">put task@ 7</span><br><span class="line">pool-1-thread-4start ..task@ 7</span><br><span class="line">put task@ 8</span><br><span class="line">java.util.concurrent.RejectedExecutionException: Task java.util....</span><br><span class="line">pool-1-thread-1start ..task@ 3</span><br><span class="line">pool-1-thread-2start ..task@ 4</span><br><span class="line">pool-1-thread-3start ..task@ 5</span><br><span class="line"></span><br><span class="line">å› ä¸ºçº¿ç¨‹åŠ å…¥çº¿ç¨‹æ± å¾ˆå¿«ï¼Œçº¿ç¨‹éƒ½è¿˜æ²¡å¤„ç†å®Œï¼Œæ‰€ä»¥æœ€å¼€å§‹å…ˆ2ä¸ªçº¿ç¨‹ï¼Œ</span><br><span class="line">ç„¶å3ä¸ªåŠ å…¥é˜Ÿåˆ—ï¼Œç„¶åå†æ¥2ä¸ªï¼Œæ‰©å¤§çº¿ç¨‹æ± ï¼Œå†ä¸€ä¸ªå°±æŠ›å‡ºå¼‚å¸¸äº†ï¼Œ</span><br><span class="line">æ…¢æ…¢é˜Ÿåˆ—ä¸­çš„ä¸‰ä¸ªä¼šè¢«æ‰§è¡Œã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯DiscardOldestPolicyç­–ç•¥ï¼Œå°±æŠŠæœ€æ—©è¿›å…¥é˜Ÿåˆ—çš„æ€¼å‡ºå»ã€‚</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/abcwywht/article/details/54744152">https://blog.csdn.net/abcwywht/article/details/54744152</a></p>
<p>âœ…è§„èŒƒåˆ›å»ºçº¿ç¨‹æ± <br>çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨Executorså»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ThreadPoolExecutorçš„æ–¹å¼ã€‚ç›®çš„æ˜¯è§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚FixedThreadPoolå’ŒSingleThreadPoolå…è®¸è¯·æ±‚é˜Ÿåˆ—é•¿åº¦Integer.MAX_VALUEï¼Œå¯èƒ½å †ç§¯å¤§é‡è¯·æ±‚ï¼ŒOOMã€‚CachedThreadPoolå…è®¸åˆ›å»ºçº¿ç¨‹æ•°é‡Integer.MAX_VALUEï¼Œå¯èƒ½åˆ›å»ºå¤§é‡çº¿ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ThreadPoolDemo &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ExecutorService threadPool = new ThreadPoolExecutor(2, 4, 0L, TimeUnit.MILLISECONDS,</span><br><span class="line">                new LinkedBlockingDeque&lt;Runnable&gt;(6),</span><br><span class="line">                new ThreadFactory() &#123;</span><br><span class="line">                    AtomicInteger id = new AtomicInteger(0);</span><br><span class="line">                    @Override</span><br><span class="line">                    public Thread newThread(Runnable r) &#123;</span><br><span class="line">                        return new Thread(r, &quot;thread-poolName-&quot; + id.incrementAndGet());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        threadPool.submit(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        //å¯ä»¥ç›´æ¥ç”¨lambdaè¡¨è¾¾å¼ï¼š</span><br><span class="line">        threadPool.submit(() -&gt; System.out.println(Thread.currentThread().getName()));</span><br><span class="line">        threadPool.execute(() -&gt; System.out.println(Thread.currentThread().getName()));</span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡Œé¢æ²¡åŠ çº¿ç¨‹æ± åˆ°æœ€å¤§å’Œé˜Ÿåˆ—æ»¡äº†è¯¥æ€ä¹ˆåŠçš„å‚æ•°ï¼Œå¯ä»¥åŠ ã€‚</p>
<h3 id="ThreadPoolExecutorçš„executeæ–¹æ³•å’Œsubmitæ–¹æ³•"><a href="#ThreadPoolExecutorçš„executeæ–¹æ³•å’Œsubmitæ–¹æ³•" class="headerlink" title="ThreadPoolExecutorçš„executeæ–¹æ³•å’Œsubmitæ–¹æ³•"></a>ThreadPoolExecutorçš„executeæ–¹æ³•å’Œsubmitæ–¹æ³•</h3><p>1ã€executeæ˜¯Executoræ¥å£çš„æ–¹æ³•ï¼Œè€Œsubmitæ˜¯ExecutorServiceçš„æ–¹æ³•ï¼Œå¹¶ä¸”ExecutorServiceæ¥å£ç»§æ‰¿äº†Executoræ¥å£ã€‚</p>
<p>2ã€executeåªæ¥å—Runnableå‚æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼›è€Œsubmitå¯ä»¥æ¥å—Runnableå‚æ•°å’ŒCallableå‚æ•°ï¼Œå¹¶ä¸”è¿”å›äº†Futureå¯¹è±¡ï¼Œå¯ä»¥è¿›è¡Œä»»åŠ¡å–æ¶ˆã€è·å–ä»»åŠ¡ç»“æœã€åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•&#x2F;å–æ¶ˆç­‰æ“ä½œã€‚</p>
<p>3ã€submitä¼šå¯¹Runnableæˆ–Callableå…¥å‚å°è£…æˆRunnableFutureå¯¹è±¡ï¼ˆåŒæ—¶ç»§æ‰¿äº†Runnableæ¥å£å’ŒFutureæ¥å£ï¼‰ï¼Œè°ƒç”¨executeæ–¹æ³•å¹¶è¿”å›ã€‚FutureTaskæ˜¯å®ç°äº†RunnableFutureæ¥å£</p>
<p>4ã€é€šè¿‡executeæ–¹æ³•æäº¤çš„ä»»åŠ¡å¦‚æœå‡ºç°å¼‚å¸¸åˆ™ç›´æ¥æŠ›å‡ºåŸå¼‚å¸¸ï¼Œæ˜¯åœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸­ï¼›è€Œsubmitæ–¹æ³•æ˜¯æ•è·äº†å¼‚å¸¸çš„ï¼Œåªæœ‰å½“è°ƒç”¨Futureçš„getæ–¹æ³•æ—¶ï¼Œæ‰ä¼šæŠ›å‡ºExecutionExceptionå¼‚å¸¸ï¼Œä¸”æ˜¯åœ¨è°ƒç”¨getæ–¹æ³•çš„çº¿ç¨‹ã€‚ï¼ˆFutureTaskåˆ™æ˜¯å°†catchåˆ°çš„å¼‚å¸¸å­˜ä¸‹æ¥ï¼Œåœ¨getçš„æ—¶å€™å†å»åˆ¤æ–­ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ï¼Œå¦‚æœä»»åŠ¡çŠ¶æ€æ˜¯å¼‚å¸¸ï¼Œåˆ™å†æŠ›å‡ºExecutionExceptionå¼‚å¸¸ã€‚ï¼‰</p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/happyyear1/article/details/122378013">https://blog.csdn.net/happyyear1/article/details/122378013</a><br><a href="https://blog.csdn.net/Mr_Zhang____/article/details/121866974">https://blog.csdn.net/Mr_Zhang____/article/details/121866974</a></p>
<h3 id="ThreadPoolExecutorçš„submitè¿”å›å€¼Future"><a href="#ThreadPoolExecutorçš„submitè¿”å›å€¼Future" class="headerlink" title="ThreadPoolExecutorçš„submitè¿”å›å€¼Future"></a>ThreadPoolExecutorçš„submitè¿”å›å€¼Future</h3><p>âœ…Executoræ¥å£ä¸­çš„executeæ–¹æ³•ï¼š<br>è¿™ä¸ªæ–¹æ³•æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œè€Œä¸”åªæ¥å—Runnableã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface Executor &#123;</span><br><span class="line">    void execute(Runnable command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…ExecutorServiceæ¥å£ä¸­çš„submitæ–¹æ³•ï¼š<br>è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ç§å‚æ•°ï¼ŒCallableå’ŒRunnableã€‚è¿”å›å€¼æ˜¯Futureã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);</span><br><span class="line">&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result);</span><br><span class="line">Future&lt;?&gt; submit(Runnable task);</span><br></pre></td></tr></table></figure>

<p>âœ…Callableæ¥å£å’ŒRunnableæ¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface Callable&lt;V&gt; &#123;</span><br><span class="line">  V call() throws Exception;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Runnable &#123;</span><br><span class="line">  public abstract void run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒºåˆ«ï¼š<br>1ã€Callableèƒ½æ¥å—ä¸€ä¸ªæ³›å‹ï¼Œç„¶ååœ¨callæ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªè¿™ä¸ªç±»å‹çš„å€¼ã€‚è€ŒRunnableçš„runæ–¹æ³•æ²¡æœ‰è¿”å›å€¼<br>2ã€Callableçš„callæ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè€ŒRunnableçš„runæ–¹æ³•ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>âœ…Futureæ¥å£<br>é€šè¿‡ä»–å¯ä»¥è·å¾—ä»»åŠ¡æ‰§è¡Œçš„è¿”å›å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface Future&lt;V&gt; &#123;</span><br><span class="line">    boolean cancel(boolean var1);</span><br><span class="line"> </span><br><span class="line">    boolean isCancelled();</span><br><span class="line"> </span><br><span class="line">    boolean isDone();</span><br><span class="line"> </span><br><span class="line">    V get() throws InterruptedException, ExecutionException;  //è·å–è¿”å›å€¼</span><br><span class="line"> </span><br><span class="line">    V get(long var1, TimeUnit var3) throws InterruptedException, ExecutionException, TimeoutException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…submit(Callable task)å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static class Main &#123;</span><br><span class="line">    public static void main(String[] args) throws InterruptedException, ExecutionException &#123;</span><br><span class="line">        ExecutorService executor = Executors.newFixedThreadPool(2);</span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªCallableï¼Œ3ç§’åè¿”å›Stringç±»å‹</span><br><span class="line">        Callable myCallable = new Callable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public String call() throws Exception &#123;</span><br><span class="line">                Thread.sleep(3000);</span><br><span class="line">                System.out.println(&quot;calldæ–¹æ³•æ‰§è¡Œäº†&quot;);</span><br><span class="line">                return &quot;callæ–¹æ³•è¿”å›å€¼&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(&quot;æäº¤ä»»åŠ¡ä¹‹å‰ &quot;+getStringDate());</span><br><span class="line">        Future future = executor.submit(myCallable);</span><br><span class="line">        System.out.println(&quot;æäº¤ä»»åŠ¡ä¹‹åï¼Œè·å–ç»“æœä¹‹å‰ &quot;+getStringDate());</span><br><span class="line">        System.out.println(&quot;è·å–è¿”å›å€¼: &quot;+future.get());</span><br><span class="line">        System.out.println(&quot;è·å–åˆ°ç»“æœä¹‹å &quot;+getStringDate());</span><br><span class="line">    &#125;</span><br><span class="line">    public static String getStringDate() &#123;</span><br><span class="line">        Date currentTime = new Date();</span><br><span class="line">        SimpleDateFormat formatter = new SimpleDateFormat(&quot;HH:mm:ss&quot;);</span><br><span class="line">        String dateString = formatter.format(currentTime);</span><br><span class="line">        return dateString;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æäº¤ä»»åŠ¡ä¹‹å‰ 09:09:28</span><br><span class="line">æäº¤ä»»åŠ¡ä¹‹åï¼Œè·å–ç»“æœä¹‹å‰ 09:09:29</span><br><span class="line">calldæ–¹æ³•æ‰§è¡Œäº†</span><br><span class="line">è·å–è¿”å›å€¼: callæ–¹æ³•è¿”å›å€¼</span><br><span class="line">è·å–åˆ°ç»“æœä¹‹å 09:09:32</span><br></pre></td></tr></table></figure>

<p>âœ…get()æ–¹æ³•çš„é˜»å¡æ€§</p>
<p>é€šè¿‡ä¸Šé¢çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œåœ¨è°ƒç”¨submitæäº¤ä»»åŠ¡ä¹‹åï¼Œä¸»çº¿ç¨‹æœ¬æ¥æ˜¯ç»§ç»­è¿è¡Œäº†ã€‚ä½†æ˜¯è¿è¡Œåˆ°future.get()çš„æ—¶å€™å°±é˜»å¡ä½äº†ï¼Œä¸€ç›´ç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ‹¿åˆ°äº†è¿”å›çš„è¿”å›å€¼ï¼Œä¸»çº¿ç¨‹æ‰ä¼šç»§ç»­è¿è¡Œã€‚</p>
<p>è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œä»–çš„é˜»å¡æ€§æ˜¯å› ä¸ºè°ƒç”¨get()æ–¹æ³•æ—¶ï¼Œä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œæ‰€ä»¥ä¼šä¸€ç›´ç­‰åˆ°ä»»åŠ¡å®Œæˆï¼Œå½¢æˆäº†é˜»å¡ã€‚</p>
<p>ä»»åŠ¡æ˜¯åœ¨è°ƒç”¨submitæ–¹æ³•æ—¶å°±å¼€å§‹æ‰§è¡Œäº†ï¼Œå¦‚æœåœ¨è°ƒç”¨get()æ–¹æ³•æ—¶ï¼Œä»»åŠ¡å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œé‚£ä¹ˆå°±ä¸ä¼šé€ æˆé˜»å¡ã€‚</p>
<p>submitå¤šä¸ªä»»åŠ¡æ—¶ï¼Œæ€»é˜»å¡æ—¶é—´æ˜¯æœ€é•¿çš„é‚£ä¸ªã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Callable myCallable = new Callable() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String call() throws Exception &#123;</span><br><span class="line">        Thread.sleep(5000);</span><br><span class="line">        System.out.println(&quot;calldæ–¹æ³•æ‰§è¡Œäº†&quot;);</span><br><span class="line">        return &quot;callæ–¹æ³•è¿”å›å€¼&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Callable myCallable2 = new Callable() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String call() throws Exception &#123;</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        System.out.println(&quot;calld2æ–¹æ³•æ‰§è¡Œäº†&quot;);</span><br><span class="line">        return &quot;call2æ–¹æ³•è¿”å›å€¼&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">System.out.println(&quot;æäº¤ä»»åŠ¡ä¹‹å‰ &quot;+getStringDate());</span><br><span class="line">Future future = executor.submit(myCallable);</span><br><span class="line">Future future2 = executor.submit(myCallable2);</span><br><span class="line">System.out.println(&quot;æäº¤ä»»åŠ¡ä¹‹å &quot;+getStringDate());</span><br><span class="line">System.out.println(&quot;å¼€å§‹è·å–ç¬¬ä¸€ä¸ªè¿”å›å€¼ &quot;+getStringDate());</span><br><span class="line">System.out.println(&quot;è·å–è¿”å›å€¼: &quot;+future.get());</span><br><span class="line">System.out.println(&quot;è·å–ç¬¬ä¸€ä¸ªè¿”å›å€¼ç»“æŸï¼Œå¼€å§‹è·å–ç¬¬äºŒä¸ªè¿”å›å€¼ &quot;+getStringDate());</span><br><span class="line">System.out.println(&quot;è·å–è¿”å›å€¼2: &quot;+future2.get());</span><br><span class="line">System.out.println(&quot;è·å–ç¬¬äºŒä¸ªè¿”å›å€¼ç»“æŸ &quot;+getStringDate());</span><br><span class="line"></span><br><span class="line">æäº¤ä»»åŠ¡ä¹‹å‰ 14:14:47</span><br><span class="line">æäº¤ä»»åŠ¡ä¹‹å 14:14:48</span><br><span class="line">å¼€å§‹è·å–ç¬¬ä¸€ä¸ªè¿”å›å€¼ 14:14:48</span><br><span class="line">calld2æ–¹æ³•æ‰§è¡Œäº†</span><br><span class="line">calldæ–¹æ³•æ‰§è¡Œäº†</span><br><span class="line">è·å–è¿”å›å€¼: callæ–¹æ³•è¿”å›å€¼</span><br><span class="line">è·å–ç¬¬ä¸€ä¸ªè¿”å›å€¼ç»“æŸï¼Œå¼€å§‹è·å–ç¬¬äºŒä¸ªè¿”å›å€¼ 14:14:53</span><br><span class="line">è·å–è¿”å›å€¼2: call2æ–¹æ³•è¿”å›å€¼</span><br><span class="line">è·å–ç¬¬äºŒä¸ªè¿”å›å€¼ç»“æŸ 14:14:53</span><br></pre></td></tr></table></figure>

<p>âœ…submit(Runnable task, T result)å®ç°</p>
<p>è™½ç„¶submitä¼ å…¥Runnableä¸èƒ½ç›´æ¥è¿”å›å†…å®¹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡submit(Runnable task, T result)ä¼ å…¥ä¸€ä¸ªè½½ä½“ï¼Œé€šè¿‡è¿™ä¸ªè½½ä½“è·å–è¿”å›å€¼ã€‚è¿™ä¸ªå…¶å®ä¸èƒ½ç®—è¿”å›å€¼äº†ï¼Œæ˜¯äº¤ç»™çº¿ç¨‹å¤„ç†ä¸€ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1() throws ExecutionException, InterruptedException &#123;</span><br><span class="line">    ExecutorService executor = Executors.newFixedThreadPool(2); //ä¸æ¨èè¿™æ ·åˆ›å»º</span><br><span class="line">    Result res = new Result();</span><br><span class="line">    Future&lt;Result&gt; future = executor.submit(new MyThread(res), res);</span><br><span class="line">    System.out.println(&quot;è¿”å›çš„ç»“æœ  name: &quot; + future.get().getName()); //æ–°åå­—</span><br><span class="line">    System.out.println(&quot;åŸæ¥çš„Data  name: &quot; + res.getName()); //åŸæ¥çš„ä¹Ÿå˜æˆäº†æ–°åå­—</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static class MyThread implements Runnable &#123;</span><br><span class="line">    private Result result;</span><br><span class="line">    public MyThread(Result result) &#123;</span><br><span class="line">        this.result = result;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(2000);</span><br><span class="line">            System.out.println(&quot;çº¿ç¨‹  æ‰§è¡Œ:&quot;);</span><br><span class="line">            result.setName(&quot;æ–°åå­—&quot;);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public static class Result &#123;</span><br><span class="line">    String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>âš ï¸Tæ˜¯Runnableé‡Œé¢çš„å±æ€§ï¼Œåˆ›å»ºæ—¶ä¼ å…¥ï¼Œçº¿ç¨‹ä¸­èµ‹å€¼ï¼Œgetæ–¹æ³•æ‹¿åˆ°ï¼Œä¹‹å‰ä¼ å…¥çš„å˜é‡ä¹Ÿè·Ÿç€å˜åŒ–ã€‚</p>
<p>âœ…get(long var1, TimeUnit var3)<br>å‰é¢éƒ½æ˜¯ç”¨çš„get()æ–¹æ³•è·å–è¿”å›å€¼ï¼Œé‚£ä¹ˆå› ä¸ºè¿™ä¸ªæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œæœ‰æ—¶éœ€è¦ç­‰å¾ˆä¹…ã€‚æ‰€ä»¥æœ‰æ—¶å€™éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p>
<p>get(long var1, TimeUnit var3)è¿™ä¸ªæ–¹æ³•å°±æ˜¯è®¾ç½®ç­‰å¾…æ—¶é—´çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Future future1 = executor.submit(myCallable);</span><br><span class="line">System.out.println(&quot;å¼€å§‹æ‹¿ç»“æœ &quot;+getStringDate());</span><br><span class="line">try &#123;</span><br><span class="line">    System.out.println(&quot;è¿”å›çš„ç»“æœæ˜¯ï¼š &quot;+future1.get(3, TimeUnit.SECONDS)+ &quot; &quot;+getStringDate());</span><br><span class="line">&#125; catch (TimeoutException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    System.out.println(&quot;è¶…æ—¶äº† &quot;+getStringDate());</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(&quot;ç»“æŸæ‹¿ç»“æœ &quot;+getStringDate());</span><br><span class="line"></span><br><span class="line">è¿‡äº†ä¸‰ç§’å°±æŠ›å‡ºè¶…æ—¶å¼‚å¸¸äº†ï¼Œä¸»çº¿ç¨‹ç»§ç»­è¿è¡Œï¼Œä¸ä¼šå†ç»§ç»­é˜»å¡ã€‚</span><br></pre></td></tr></table></figure>


<p>âœ…executeä¸submitçš„å¼‚å¸¸å¤„ç†</p>
<p>ä½¿ç”¨submitæ–¹æ³•è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼Œä»–çš„å¼‚å¸¸å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­catchåˆ°ã€‚<br>è€Œä½¿ç”¨executeæ–¹æ³•æ‰§è¡Œä»»åŠ¡æ˜¯æ•æ‰ä¸åˆ°å¼‚å¸¸çš„ã€‚<br>ç”¨ä¸‹é¢è¿™ä¸ªRunnableæ¥è¯´,è¿™ä¸ª é‡Œé¢ä¸€å®šä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Runnable myRunnable = new Runnable() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        executor.execute(null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨executeï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">            executor.execute(myRunnable);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(&quot;æŠ“åˆ°å¼‚å¸¸ &quot;+e.getMessage());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ä¼šè¾“å‡ºæŠ“åˆ°å¼‚å¸¸é‚£è¡Œæ—¥å¿—ï¼Œè¾“å‡ºæ˜¯åœ¨çº¿ç¨‹pool-1-thread-1ä¸­ï¼Œå¹¶ä¸æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ã€‚è¯´æ˜ä¸»çº¿ç¨‹çš„catchä¸èƒ½æ•æ‰åˆ°è¿™ä¸ªå¼‚å¸¸ã€‚å¼‚å¸¸åœ¨çº¿ç¨‹ä¸­ç›´æ¥æŠ›å‡ºã€‚</p>
<p>ä½¿ç”¨submitï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">           Future future1= executor.submit(myCallable);</span><br><span class="line">            future1.get();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(&quot;æŠ“åˆ°å¼‚å¸¸ &quot;+e.getMessage());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥æŠ“åˆ°å¼‚å¸¸ã€‚å¾—æœ‰getæ–¹æ³•ã€‚</p>
<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/zdx1515888659/article/details/109537577">https://blog.csdn.net/zdx1515888659/article/details/109537577</a></p>
<p>âœ…é¡¹ç›®ä¸­çš„çº¿ç¨‹æ± ä¸­å¼‚å¸¸æ•è·<br>é¡¹ç›®ä¸­æƒ³å°†çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„å¼‚å¸¸åœ¨å¤–é¢æ•è·åˆ°ï¼Œä¼ é€’ç»™å‰ç«¯ã€‚<br>æ‰€ä»¥ç”¨submitæ–¹æ³•ï¼Œè¿”å›Future&lt;?&gt;ï¼Œåœ¨submitæ–¹æ³•åç›´æ¥getï¼Œfuture.get()ï¼Œæœ‰ä¸¤ä¸ªå¼‚å¸¸éœ€è¦å¤„ç†ï¼šExecutionExceptionã€InterruptExceptionï¼Œç›´æ¥æ–¹æ³•ä¸Šthrowså‡ºå»ã€‚è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ–¹æ³•è¦ä¸ä¹Ÿthrowsï¼ˆç»™å‰ç«¯é€å‡ºå¼‚å¸¸ï¼‰ï¼Œè¦ä¸å°±try..catch..æ‰“logï¼ˆè¿™æ ·æ— æ³•ç»™å‰ç«¯é€å‡ºå¼‚å¸¸ï¼‰ã€‚<br>âš ï¸æ³¨æ„ï¼šç”¨getæ–¹æ³•ç›¸å½“äºæ˜¯é˜»å¡äº†ï¼Œæœ¬æ¥èµ·çº¿ç¨‹ï¼ŒæŠŠè¦æ‰§è¡Œçš„åŠ¨ä½œäº¤ç»™çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹(submit)ï¼Œç„¶åä¸éœ€è¦ç®¡çº¿ç¨‹æ‰§è¡Œå®Œå°±ç›´æ¥é€€å‡ºå¹²åˆ«çš„äº†ï¼ŒåŠ äº†getçš„è¯ï¼Œå°±è¦ç­‰çº¿ç¨‹æ‰§è¡Œå®Œäº†ã€‚å¦‚æœæ˜¯å¤§é‡ä»»åŠ¡ä¸€æ¬¡äº¤ç»™çº¿ç¨‹æ± (çº¿ç¨‹æ± é‡Œçš„é˜Ÿåˆ—)ï¼Œéœ€è¦è€ƒè™‘getå¸¦æ¥çš„é˜»å¡æ€§æ˜¯å¦èƒ½æ¥å—ã€‚æœ¬æ¥æƒ³å¼‚æ­¥ï¼ŒåŠ äº†getæ•è·å¼‚å¸¸ä¹‹åï¼Œå˜æˆåŒæ­¥çš„äº†ã€‚</p>
<p>ğŸ¤”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å‡ºç°å¼‚å¸¸ï¼Œgetæ–¹æ³•è¿™é‡Œä¼šæŠ¥å¼‚å¸¸ï¼Œå¦‚æœæ˜¯throwsï¼Œå¼‚å¸¸æŠ›å‡ºåˆ°å¤–é¢ï¼Œçº¿ç¨‹æ± é‡Œçš„å…¶ä»–çº¿ç¨‹ä¸å—å½±å“ã€‚å¤–é¢çš„æ–¹æ³•å¦‚æœæ²¡æœ‰catchä¼šä¸­æ–­ã€‚</p>
<p>ğŸ¤”é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œgetè¶…æ—¶äº†çš„è¯ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿˜åœ¨ç»§ç»­åšå—ï¼Ÿ<br>é¦–å…ˆï¼ŒcountDownLatchè¶…æ—¶äº†æ˜¯ç»§ç»­åšçš„ã€‚<br>future.get(2,TimeUnit.SECOND);<br>å¦‚æœè¶…æ—¶äº†ï¼Œçº¿ç¨‹ä¸­æ–­ï¼Œä¼šæŠ¥å¼‚å¸¸TimeOutExcepTionï¼Œçœ‹æ˜¯ä¸æ˜¯è¦æ•è·äº†ã€‚<br>å³ä½¿æ•è·äº†ï¼Œçº¿ç¨‹ä¹Ÿä¸ä¼šç»§ç»­æ‰§è¡Œäº†ã€‚</p>
<h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h3><p>åœºæ™¯ï¼šåšå¤šçº¿ç¨‹å¹¶è¡Œä¼˜åŒ–ï¼Œå¤šçº¿ç¨‹å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œé¦–å…ˆè¾“å…¥æµæ˜¯å¯ä»¥å…±äº«çš„ï¼Œåªæ˜¯éœ€è¦é‡æ–°å®šä¹‰ä¸€ä¸ªåšä¼ é€’ï¼ˆä¸ç®¡æ˜¯æ™®é€šå˜é‡è¿˜æ˜¯å¼•ç”¨å˜é‡ï¼‰ï¼Œä½†æ˜¯forå¾ªç¯é‡Œé¢çº¿ç¨‹submitå®Œï¼Œç›´æ¥èµ°åˆ°ä¸»çº¿ç¨‹ä¸Šä¼ æ–‡ä»¶çš„éƒ¨åˆ†ï¼Œè¿™æ—¶çº¿ç¨‹æ± å†…çº¿ç¨‹è¿˜æ²¡å¾€æ–‡ä»¶é‡Œå†™ä¸œè¥¿ï¼Œä¸Šä¼ äº†ä¸€ä¸ªç©ºæ–‡ä»¶ã€‚</p>
<p>æƒ³è¦ï¼šåšä¸€ä¸ªåŒæ­¥ï¼ŒçŸ¥é“çº¿ç¨‹éƒ½æ‰§è¡Œå®Œäº†ï¼Œæ‰è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œèµ·åˆ°é˜»å¡çš„ä½œç”¨ã€‚</p>
<p>CountDownLatchå¯ä»¥åšåˆ°ï¼Œå½“åšä¸€ä¸ªè®¡æ•°å™¨ï¼Œè®¡ç®—å¤šå°‘ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œäº†ï¼š</p>
<p>è®©ä¸€äº›çº¿ç¨‹é˜»å¡ç›´åˆ°å¦å¤–ä¸€äº›å®Œæˆåæ‰è¢«å”¤é†’ã€‚<br>CountDownLatchä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š<br>ï¼ˆ1ï¼‰å½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•æ—¶,çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ»¡è¶³æ¡ä»¶.<br>ï¼ˆ2ï¼‰å…¶ä»–çº¿ç¨‹è°ƒç”¨countDownæ–¹æ³•è®¡æ•°å™¨å‡1(è°ƒç”¨countDownæ–¹æ³•æ—¶çº¿ç¨‹ä¸ä¼šé˜»å¡),å½“è®¡æ•°å™¨çš„å€¼å˜ä¸º0,å› è°ƒç”¨awaitæ–¹æ³•è¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’,ç»§ç»­æ‰§è¡Œã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/li1325169021/article/details/122353217">https://blog.csdn.net/li1325169021/article/details/122353217</a></p>
<p>å®ä¾‹ï¼šæ¨¡æ‹Ÿå…¬å¸æ‰€æœ‰å‘˜å·¥éƒ½ä¸‹ç­åï¼Œå€¼ç­äººå‘˜é”é—¨ç¦»å¼€å…¬å¸ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line">public class CountDownLatchDemo1 &#123;</span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        closeDoor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void closeDoor() throws InterruptedException &#123;</span><br><span class="line">        //åˆ›å»ºCountDownLatch,åˆå§‹å®¹é‡ä¸º10ï¼Œæ¨¡æ‹Ÿ10åå‘˜å·¥</span><br><span class="line">        CountDownLatch countDownLatch=new CountDownLatch(10);</span><br><span class="line">        for (int i=1;i&lt;=10;i++)&#123;</span><br><span class="line">            new Thread(()-&gt;&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + &quot;\t&quot; + &quot;å¿™å®Œå·¥ä½œï¼Œä¸‹ç­ã€‚&quot;);</span><br><span class="line">                //è®¡æ•°å™¨å‡1</span><br><span class="line">                countDownLatch.countDown();</span><br><span class="line">            &#125;,&quot;å‘˜å·¥ç¼–å·ï¼š&quot;+String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        //å½“è®¡æ•°å™¨çš„å€¼å˜ä¸º0,å› è°ƒç”¨awaitæ–¹æ³•è¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’,ç»§ç»­æ‰§è¡Œ</span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + &quot;\tå€¼ç­äººå‘˜é”é—¨ç¦»å¼€å…¬å¸&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ†ä¸‰æ­¥ï¼š</p>
<p>1ã€çº¿ç¨‹æ± å¤–å®šä¹‰åˆå§‹è®¡æ•°ï¼š<br>CountDownLatch countDownLatch&#x3D;new CountDownLatch(10);<br>2ã€çº¿ç¨‹æ± å†…executorService.submit()çš„çº¿ç¨‹new Runnable(){@Overide public void run() {}} runæ–¹æ³•å†…ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼š<br>countDownLatch.countDown();<br>3ã€æœ€åè¦è¿›è¡Œæ“ä½œå‰ï¼š<br>countDownLatch.await();</p>
<p>âœ…countDownLatchè¶…æ—¶ç»ˆæ­¢ï¼š<br><code>latch.await(10, TimeUnit.SECONDS);  //ç­‰å¾…10ç§’åï¼Œå¦‚æœçº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œï¼Œåˆ™ä¸å†ç­‰å¾…ï¼Œè¿›å…¥åç»­</code></p>
<p>è¶…æ—¶åï¼Œçº¿ç¨‹ä¾ç„¶ä¼šæ‰§è¡Œï¼Œä¸ä¼šä¸­æ–­ã€‚</p>
<h3 id="ScheduledExecutorService"><a href="#ScheduledExecutorService" class="headerlink" title="ScheduledExecutorService"></a>ScheduledExecutorService</h3><p>1ã€public interface ScheduledExecutorService extends ExecutorService å»¶è¿Ÿæˆ–å®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚ </p>
<p>2ã€schedule æ–¹æ³•ä½¿ç”¨å„ç§å»¶è¿Ÿåˆ›å»ºä»»åŠ¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯ç”¨äºå–æ¶ˆæˆ–æ£€æŸ¥æ‰§è¡Œçš„ä»»åŠ¡å¯¹è±¡</p>
<p>3ã€scheduleAtFixedRate å’Œ scheduleWithFixedDelay æ–¹æ³•åˆ›å»ºå¹¶æ‰§è¡ŒæŸäº›åœ¨å–æ¶ˆå‰ä¸€ç›´å®šæœŸè¿è¡Œçš„ä»»åŠ¡</p>
<p>4ã€æ‰€æœ‰çš„ schedule æ–¹æ³•éƒ½æ¥å—ç›¸å¯¹å»¶è¿Ÿå’Œå‘¨æœŸä½œä¸ºå‚æ•°ï¼Œè€Œä¸æ˜¯ç»å¯¹çš„æ—¶é—´æˆ–æ—¥æœŸ</p>
<p>5ã€SheduleExecutorService æ˜¯JDK 1.5å‡ºæ¥çš„ï¼Œæ¯”ä»¥å‰çš„ Timer æ€§èƒ½å¥½</p>
<p>Timerç”¨æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test4() throws InterruptedException &#123;</span><br><span class="line">    TimerTask task = new TimerTask() &#123;</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            System.out.println(&quot;Task performed on: &quot; + new Date() + &quot;n&quot; +</span><br><span class="line">                    &quot;Thread&#x27;s name: &quot; + Thread.currentThread().getName());</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(5000);</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;later: &quot; + new Date() + &quot;n&quot; +</span><br><span class="line">                    &quot;Thread&#x27;s name: &quot; + Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Timer timer = new Timer(&quot;Timer&quot;);</span><br><span class="line"></span><br><span class="line">    long delay = 100L;</span><br><span class="line">    // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯TimeTaskå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å»¶è¿Ÿï¼ˆåªæœ‰ç¬¬äºŒä¸ªå‚æ•°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å‘¨æœŸæ‰§è¡Œçš„å‘¨æœŸ</span><br><span class="line">    timer.schedule(task, delay, 4000);</span><br><span class="line">    Thread.sleep(10000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Timerä¸­ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œæ—¶é—´&gt;å‘¨æœŸï¼Œåˆ™ä¼šç­‰å¾…ä¸Šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œï¼Œç«‹é©¬æ‰§è¡Œç¬¬äºŒä¸ªã€‚</p>
<p>âœ…ç”¨ScheduledExecutorService.scheduleAtFixedRateï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test5() throws InterruptedException &#123;</span><br><span class="line">    ScheduledExecutorService executorService = Executors.newSingleThreadScheduledExecutor();</span><br><span class="line">    executorService.scheduleAtFixedRate(()-&gt;&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(2000);</span><br><span class="line">        &#125;catch (Exception ex)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+&quot; run : &quot;+ System.currentTimeMillis());</span><br><span class="line">    &#125;, 0, 1000, TimeUnit.MILLISECONDS);</span><br><span class="line">    Thread.sleep(10000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·çš„ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œæ—¶é—´&gt;å‘¨æœŸï¼Œåˆ™ä¼šç­‰ä¸Šä¸€ä¸ªæ‰§è¡Œå®Œç«‹é©¬æ‰§è¡Œä¸‹ä¸€ä¸ªã€‚</p>
<p>âœ…ç”¨ScheduledExecutorService.scheduleAtFixedRateï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test6() throws InterruptedException &#123;</span><br><span class="line">    ScheduledExecutorService executorService = Executors.newSingleThreadScheduledExecutor();</span><br><span class="line">    executorService.scheduleWithFixedDelay(()-&gt;&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(2000);</span><br><span class="line">        &#125;catch (Exception ex)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+&quot; go : &quot;+ System.currentTimeMillis());</span><br><span class="line">    &#125;, 0, 1000, TimeUnit.MILLISECONDS);</span><br><span class="line">    Thread.sleep(10000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸scheduleAtFixedRateï¼šä¸åŒçš„æ˜¯ï¼šè¿™ä¸ªæ˜¯ç­‰ä¸Šä¸€ä¸ªæ‰§è¡Œå®Œï¼Œdelayå¤šé•¿æ—¶é—´åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªã€‚</p>
<p>âœ…ScheduledExecutorServiceå¯¹è±¡çš„åˆ›å»ºæ–¹å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1ã€Executorså·¥å…·ç±»æ¥åˆ›å»º</span><br><span class="line">ScheduledExecutorService executorService1 = Executors.newScheduledThreadPool(3);</span><br><span class="line">åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œä»»åŠ¡æˆ–è€…å®šæœŸåœ°æ‰§è¡Œä»»åŠ¡ã€‚</span><br><span class="line">corePoolSize - æ± ä¸­æ‰€ä¿å­˜çš„çº¿ç¨‹æ•°ï¼Œå³ä½¿çº¿ç¨‹æ˜¯ç©ºé—²çš„ä¹ŸåŒ…æ‹¬åœ¨å†…ã€‚</span><br><span class="line">è¿è¡Œå‘ç°æœ‰å¤šä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯æ•ˆæœä¸€æ ·ã€‚</span><br><span class="line"></span><br><span class="line">å¯ä»¥ä¼ å‚ThreadFactoryï¼Œç”¨æ¥å‘½åå’Œè®¾ç½®å®ˆæŠ¤çº¿ç¨‹</span><br><span class="line">ScheduledExecutorService executorService2 = Executors.newSingleThreadScheduledExecutor(r -&gt; &#123;</span><br><span class="line">    Thread t = new Thread(r, &quot;myThread&quot;);</span><br><span class="line">    t.setDaemon(true); //è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹</span><br><span class="line">    return t;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">2ã€Executorså·¥å…·ç±»æ¥åˆ›å»º</span><br><span class="line">ScheduledExecutorService executorService = Executors.newSingleThreadScheduledExecutor();</span><br><span class="line">åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œç¨‹åºï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œä»»åŠ¡ã€‚</span><br><span class="line">å¯ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨ä»»æ„ç»™å®šçš„æ—¶é—´ä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ˜¯æ´»åŠ¨çš„ã€‚ </span><br><span class="line">åŒæ ·è¿™æ˜¯ä¸€ä¸ªæ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œå³è™½ç„¶çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯æ–°å¢çš„ä»»åŠ¡ä¼šåœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">3ã€ç”¨ScheduledExecutorService çš„å®ç°ç±» ScheduledThreadPoolExecutorï¼ˆæ¨èï¼‰</span><br><span class="line">ScheduledExecutorService executorService1 = new ScheduledThreadPoolExecutor(1);</span><br></pre></td></tr></table></figure>

<p>âœ…è§„èŒƒåˆ›å»ºï¼š<br>è¦ä½¿ç”¨å¸¦æœ‰ThreadFactoryå‚æ•°çš„ScheduledThreadPoolExecutoræ„é€ æ–¹æ³•åˆ›å»ºï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿è®¾ç½®çº¿ç¨‹åå­—ã€‚æ–¹ä¾¿å‡ºæªæ—¶å›æº¯ã€‚å¹¶ä¸”æä¾›è‡ªå®šä¹‰çš„ThreadFactoryå®ç°æˆ–ä¸‰æ–¹å®ç°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ScheduledExecutorService executorService3 = new ScheduledThreadPoolExecutor(1, new ThreadFactory() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Thread newThread(Runnable r) &#123;</span><br><span class="line">        return new Thread(r, &quot;myThread&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ScheduledExecutorService executorService4 = new ScheduledThreadPoolExecutor(1,</span><br><span class="line">    new BasicThreadFactory.Builder().namingPattern(&quot;myThread&quot;).daemon(true).build());</span><br></pre></td></tr></table></figure>


<h3 id="ThreadFactory"><a href="#ThreadFactory" class="headerlink" title="ThreadFactory"></a>ThreadFactory</h3><p>ç”¨æ¥åˆ›å»ºçº¿ç¨‹çš„ï¼Œå…¶ä¸­ä¹Ÿåªæ˜¯æœ‰ä¸€ä¸ªnewthreadæ–¹æ³•ã€‚</p>
<p>ä½œç”¨ï¼š<br>ç»™çº¿ç¨‹å‘½åï¼ŒæŸ¥çœ‹åˆ›å»ºçº¿ç¨‹æ•°<br>ç»™çº¿ç¨‹è®¾ç½®æ˜¯å¦æ˜¯åå°è¿è¡Œ<br>è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§</p>
<p>è‡ªå®šä¹‰ThreadFactoryï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.demo.factory;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.ThreadFactory;</span><br><span class="line">import java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line">public class MyThreadFactory implements ThreadFactory&#123;</span><br><span class="line"></span><br><span class="line">    private AtomicInteger atomicInteger = new AtomicInteger();</span><br><span class="line"></span><br><span class="line">    private boolean isDaemon;</span><br><span class="line"></span><br><span class="line">    public MyThreadFactory(boolean isDaemon)&#123;</span><br><span class="line">        this.isDaemon = isDaemon;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Thread newThread(Runnable r) &#123;</span><br><span class="line">        atomicInteger.incrementAndGet();</span><br><span class="line">        Thread thread =  new MyWorkThread(atomicInteger,r);</span><br><span class="line">        thread.setDaemon(isDaemon);</span><br><span class="line">        return thread;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class TestMain &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ExecutorService executorService = Executors.newCachedThreadPool(new MyThreadFactory(false));</span><br><span class="line">        for (int i=0;i&lt;1000;i++)&#123;</span><br><span class="line">            executorService.execute(new TestRunnable(String.valueOf(i)));</span><br><span class="line">        &#125;</span><br><span class="line">        executorService.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class TestRunnable implements Runnable&#123;</span><br><span class="line"></span><br><span class="line">        private String msg;</span><br><span class="line"></span><br><span class="line">        public TestRunnable(String msg)&#123;</span><br><span class="line">            this.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            System.out.println(&quot;runnable:&quot;+msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…ä¸‰ç§åˆ›å»º ThreadFactory çš„æ–¹å¼</p>
<p>ç¬¬ä¸€ç§ CustomizableThreadFactory<br>Spring æ¡†æ¶æä¾›çš„ CustomizableThreadFactoryã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ThreadFactory springThreadFactory = new CustomizableThreadFactory(&quot;springThread-pool-&quot;);</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ ThreadFactoryBuilder<br>Google guava å·¥å…·ç±» æä¾›çš„ ThreadFactoryBuilder ,ä½¿ç”¨é“¾å¼æ–¹æ³•åˆ›å»ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ThreadFactory guavaThreadFactory = new ThreadFactoryBuilder().setNameFormat(&quot;retryClient-pool-&quot;).build();</span><br><span class="line">//-pool-åé¢åŠ %d ï¼Ÿ</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ç§ BasicThreadFactory<br>Apache commons-lang3 æä¾›çš„ BasicThreadFactory.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ThreadFactory basicThreadFactory = new BasicThreadFactory.Builder().namingPattern(&quot;basicThreadFactory-&quot;).build();</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/u010648555/article/details/106137206/">https://blog.csdn.net/u010648555/article/details/106137206/</a></p>
<h3 id="çº¿ç¨‹ç›¸å…³"><a href="#çº¿ç¨‹ç›¸å…³" class="headerlink" title="çº¿ç¨‹ç›¸å…³"></a>çº¿ç¨‹ç›¸å…³</h3><p>è¿›ç¨‹ï¼šæ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ã€æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ç‹¬ç«‹å•å…ƒ<br>çº¿ç¨‹ï¼šè¿›ç¨‹ä¸­ç‹¬ç«‹è¿è¡Œçš„å­ä»»åŠ¡ï¼Œç¨‹åºæ‰§è¡Œçš„å•å…ƒã€‚<br>ä¾‹å¦‚ï¼šå¯åŠ¨jvmç›¸å½“äºèµ·äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œjvmå†…ï¼šmainæ–¹æ³•ã€åƒåœ¾å›æ”¶ç­‰ç›¸å½“äºå¤šä¸ªçº¿ç¨‹ã€‚<br>cpuæ˜¯è¿ç®—å’Œæ§åˆ¶çš„ä¸­å¿ƒï¼Œåœ¨cpuçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹ã€‚<br>å¤šçº¿ç¨‹ä¸‹ï¼Œcpuåœ¨ä¸åŒçš„çº¿ç¨‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œå¤šçº¿ç¨‹ä¸ä¸€å®šæ¯”å•çº¿ç¨‹å¿«ã€‚<br>å¤šçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œæ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Thread.sleep(1000);  //ä¼‘æ¯1sï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</span><br><span class="line"></span><br><span class="line">æ–°å»ºThreadçº¿ç¨‹ï¼š</span><br><span class="line">Thread thread = new Thread(new Runnable()&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        dosomething();</span><br><span class="line">    &#125;, &quot;name&quot;);</span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure>

<h4 id="startã€runã€joinæ–¹æ³•"><a href="#startã€runã€joinæ–¹æ³•" class="headerlink" title="startã€runã€joinæ–¹æ³•"></a>startã€runã€joinæ–¹æ³•</h4><p>startï¼š ç”¨startæ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼ŒçœŸæ­£å®ç°äº†å¤šçº¿ç¨‹è¿è¡Œï¼Œè¿™æ—¶æ— éœ€ç­‰å¾…runæ–¹æ³•ä½“ä»£ç æ‰§è¡Œå®Œæ¯•è€Œç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚é€šè¿‡è°ƒç”¨Threadç±»çš„start()æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶æ­¤çº¿ç¨‹å¤„äºå°±ç»ªï¼ˆå¯è¿è¡Œï¼‰çŠ¶æ€ï¼Œå¹¶æ²¡æœ‰è¿è¡Œï¼Œä¸€æ—¦å¾—åˆ°cpuæ—¶é—´ç‰‡ï¼Œå°±å¼€å§‹æ‰§è¡Œrun()æ–¹æ³•ï¼Œè¿™é‡Œæ–¹æ³• run()ç§°ä¸ºçº¿ç¨‹ä½“ï¼Œå®ƒåŒ…å«äº†è¦æ‰§è¡Œçš„è¿™ä¸ªçº¿ç¨‹çš„å†…å®¹ï¼ŒRunæ–¹æ³•è¿è¡Œç»“æŸï¼Œæ­¤çº¿ç¨‹éšå³ç»ˆæ­¢ã€‚ </p>
<p>runï¼š run()æ–¹æ³•åªæ˜¯ç±»çš„ä¸€ä¸ªæ™®é€šæ–¹æ³•è€Œå·²ï¼Œå¦‚æœç›´æ¥è°ƒç”¨Runæ–¹æ³•ï¼Œç¨‹åºä¸­ä¾ç„¶åªæœ‰ä¸»çº¿ç¨‹è¿™ä¸€ä¸ªçº¿ç¨‹ï¼Œå…¶ç¨‹åºæ‰§è¡Œè·¯å¾„è¿˜æ˜¯åªæœ‰ä¸€æ¡ï¼Œè¿˜æ˜¯è¦é¡ºåºæ‰§è¡Œï¼Œè¿˜æ˜¯è¦ç­‰å¾…runæ–¹æ³•ä½“æ‰§è¡Œå®Œæ¯•åæ‰å¯ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œè¿™æ ·å°±æ²¡æœ‰è¾¾åˆ°å†™çº¿ç¨‹çš„ç›®çš„ã€‚</p>
<p>æ€»ç»“ï¼šè°ƒç”¨startæ–¹æ³•æ–¹å¯å¯åŠ¨çº¿ç¨‹ï¼Œè€Œrunæ–¹æ³•åªæ˜¯threadçš„ä¸€ä¸ªæ™®é€šæ–¹æ³•è°ƒç”¨ï¼Œè¿˜æ˜¯åœ¨ä¸»çº¿ç¨‹é‡Œæ‰§è¡Œã€‚æŠŠéœ€è¦å¹¶è¡Œå¤„ç†çš„ä»£ç æ”¾åœ¨run()æ–¹æ³•ä¸­ï¼Œstart()æ–¹æ³•å¯åŠ¨çº¿ç¨‹å°†è‡ªåŠ¨è°ƒç”¨ run()æ–¹æ³•ï¼Œè¿™æ˜¯ç”±jvmçš„å†…å­˜æœºåˆ¶è§„å®šçš„ã€‚å¹¶ä¸”run()æ–¹æ³•å¿…é¡»æ˜¯publicè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç±»å‹ä¸ºvoidã€‚</p>
<p>joinæ–¹æ³•åœ¨çº¿ç¨‹å¤–ä½¿ç”¨ï¼Œè¡¨ç¤ºç­‰å¾…threadçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ç»§ç»­æ‰§è¡Œå½“å‰joinæ–¹æ³•æ‰€åœ¨çš„çº¿ç¨‹ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹ç”Ÿæˆå¹¶èµ·åŠ¨äº†å­çº¿ç¨‹ï¼Œå¦‚æœå­çº¿ç¨‹é‡Œè¦è¿›è¡Œå¤§é‡çš„è€—æ—¶çš„è¿ç®—ï¼Œä¸»çº¿ç¨‹å¾€å¾€å°†äºå­çº¿ç¨‹ä¹‹å‰ç»“æŸï¼Œä½†æ˜¯å¦‚æœä¸»çº¿ç¨‹å¤„ç†å®Œå…¶ä»–çš„äº‹åŠ¡åï¼Œéœ€è¦ç”¨åˆ°å­çº¿ç¨‹çš„å¤„ç†ç»“æœï¼Œä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åå†ç»“æŸï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°join()æ–¹æ³•äº†ã€‚</p>
<p>âœ…å¤šçº¿ç¨‹ç´¯åŠ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// çº¿ç¨‹å®‰å…¨çš„ç´¯åŠ </span><br><span class="line">@Test</span><br><span class="line">public void test1() &#123;</span><br><span class="line">/**</span><br><span class="line">    * åˆ›å»ºçº¿ç¨‹</span><br><span class="line">    */</span><br><span class="line">class CreateThread implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">    private int num = 1;</span><br><span class="line">    private final Object lock = new Object(); //ä½¿ç”¨ä¸€ä¸ªJavaå¯¹è±¡ä½œä¸ºä¸€ä¸ªé”</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        while(true) &#123;</span><br><span class="line">            synchronized (lock) &#123;</span><br><span class="line">                if (num &lt;= 100) &#123;</span><br><span class="line">                    System.out.println(&quot;çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName() + &quot;  num: &quot; + num );</span><br><span class="line">                    num++;</span><br><span class="line">                    lock.notifyAll(); //ä¸åŠ ä¹Ÿä¸€æ ·</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// å¿…é¡»å…±ç”¨ä¸€ä¸ªRunnable</span><br><span class="line">CreateThread myThread1 = new CreateThread();</span><br><span class="line">Thread thread1 = new Thread(myThread1, &quot;thread1&quot;);</span><br><span class="line">Thread thread2 = new Thread(myThread1, &quot;thread2&quot;);</span><br><span class="line">thread1.start();</span><br><span class="line">thread2.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…çº¿ç¨‹ä¼‘çœ ç­‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2() throws InterruptedException &#123;</span><br><span class="line">    // çº¿ç¨‹ç±»è¿˜å¿…é¡»æ”¾å‰é¢</span><br><span class="line">    class CreateThread1 implements Runnable &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(1000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;çº¿ç¨‹æ‰§è¡Œ&quot;);</span><br><span class="line">            Thread.yield(); //çº¿ç¨‹è®©æ­¥</span><br><span class="line">            System.out.println(&quot;ç»§ç»­æ‰§è¡Œ&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Thread thread1 = new Thread(new CreateThread1(), &quot;thread1&quot;);</span><br><span class="line">    thread1.start();</span><br><span class="line">    thread1.join();  //æ’é˜Ÿæ‰§è¡Œ</span><br><span class="line">    System.out.println(&quot;mainçº¿ç¨‹&quot;);</span><br><span class="line">    Thread.sleep(1000 * 10);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®ˆæŠ¤çº¿ç¨‹"><a href="#å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹"></a>å®ˆæŠ¤çº¿ç¨‹</h3><p>å•æµ‹æ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“å•æµ‹æ–¹æ³•ç»“æŸçš„æ—¶å€™ï¼Œé‡Œé¢çš„çº¿ç¨‹ä¹Ÿè¦ç»“æŸï¼Œä¸ç®¡æ˜¯ä¸æ˜¯æ‰§è¡Œå®Œæˆã€‚å•æµ‹æ–¹æ³•ç»“æŸçš„æ—¶å€™ä¼šæŠŠé‡Œé¢çš„èµ„æºé‡Šæ”¾æ‰ï¼Œå¯¼è‡´é‡Œé¢çš„çº¿ç¨‹æå‰ç»“æŸã€‚<br>ç»“è®ºï¼šå°½é‡ä¸è¦åœ¨testä¸­å¼€å¯çº¿ç¨‹ï¼Œå¼€å¯çš„è¯ï¼Œsleepä¸€ä¸‹ï¼Œç­‰çº¿ç¨‹æ‰§è¡Œå®Œã€‚</p>
<p>ä½†æ˜¯åœ¨mainæ–¹æ³•ä¸­ï¼Œmainæ–¹æ³•æ‰§è¡Œå®Œä»¥åå­çº¿ç¨‹å¹¶ä¸ä¼šé€€å‡ºï¼Œå› ä¸ºå­çº¿ç¨‹æ˜¯éå®ˆæŠ¤çº¿ç¨‹ã€‚</p>
<p>é¦–å…ˆï¼ŒJVMç¨‹åºåœ¨ä»€ä¹ˆæƒ…å†µä¸‹èƒ½å¤Ÿæ­£å¸¸é€€å‡º<br>The Java Virtual Machine exits when the only threads running are all daemon threads.<br>å½“JVMä¸­ä¸å­˜åœ¨ä»»ä½•ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„éå®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œåˆ™JVMè¿›ç¨‹å³ä¼šé€€å‡ºã€‚<br>mainçº¿ç¨‹æ˜¯ä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹ã€‚åªå‰©ä¸‹å®ˆæŠ¤çº¿ç¨‹ï¼Œå°±ä¼šé€€å‡ºã€‚</p>
<p>ä»€ä¹ˆæ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Ÿ<br>åœ¨Javaä¸­æœ‰ä¸¤ç±»çº¿ç¨‹ï¼š</p>
<ul>
<li>User Thread(ç”¨æˆ·çº¿ç¨‹)</li>
<li>Daemon Thread(å®ˆæŠ¤çº¿ç¨‹)</li>
</ul>
<p>JVMä¸­çš„åƒåœ¾å›æ”¶å°±æ˜¯å…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“JVMè¦é€€å‡ºæ—¶ï¼Œå¦‚æœåƒåœ¾å›æ”¶çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œå¯¼è‡´ç¨‹åºæ— æ³•é€€å‡ºã€‚è¿™å°±å¾ˆå°´å°¬äº†ã€‚å®ˆæŠ¤çº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†ç»™å…¶ä»–çš„çº¿ç¨‹æä¾›æœåŠ¡ï¼Œæ¯”å¦‚è¯´è®¡æ—¶å™¨ï¼Œæ¸…ç©ºé«˜é€Ÿç¼“å­˜ç­‰ç­‰æ“ä½œã€‚å½“è¢«å®ˆæŠ¤çº¿ç¨‹æ­»äº¡ï¼Œå®ˆæŠ¤çº¿ç¨‹å¾€å¾€ä¹Ÿä¼šæ­»äº¡ï¼Œå½“è™šæ‹Ÿæœºä¸­åªå‰©ä¸‹å®ˆæŠ¤çº¿ç¨‹æ—¶ï¼Œè™šæ‹Ÿæœºå°±ä¼šé€€å‡ºï¼Œå› ä¸ºæ­¤æ—¶ä¹Ÿæ²¡æœ‰è¿è¡Œç¨‹åºçš„å¿…è¦äº†</p>
<p>å®ˆæŠ¤çº¿ç¨‹ç»å¸¸è¢«ç”¨æ¥æ‰§è¡Œä¸€äº›åå°ä»»åŠ¡ï¼Œå¦‚æœä½ å¸Œæœ›JVMé€€å‡ºæ—¶ï¼Œçº¿ç¨‹èƒ½å¤Ÿæ­£å¸¸é€€å‡ºï¼Œå®ˆæŠ¤çº¿ç¨‹æ˜¯ä½ çš„é¦–é€‰ã€‚<br>å®ˆæŠ¤çº¿ç¨‹åº”è¯¥æ°¸è¿œä¸å»è®¿é—®å›ºæœ‰èµ„æºï¼Œæ¯”å¦‚è¯´æ–‡ä»¶æˆ–è€…æ•°æ®åº“ï¼Œå› ä¸ºå®ƒä¼šåœ¨ä»»ä½•æ—¶å€™ç”šè‡³ä¸€ä¸ªæ“ä½œçš„ä¸­é—´å‘ç”Ÿä¸­æ–­ã€‚</p>
<h3 id="SynchronizedåŒæ­¥é”"><a href="#SynchronizedåŒæ­¥é”" class="headerlink" title="SynchronizedåŒæ­¥é”"></a>SynchronizedåŒæ­¥é”</h3><p>synchronizedçš„ä½œç”¨æ˜¯ä¿è¯åœ¨åŒä¸€æ—¶åˆ»ï¼Œ è¢«ä¿®é¥°çš„ä»£ç å—æˆ–æ–¹æ³•åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä»¥è¾¾åˆ°ä¿è¯å¹¶å‘å®‰å…¨çš„æ•ˆæœã€‚</p>
<p>synchronizedæ˜¯Javaä¸­è§£å†³å¹¶å‘é—®é¢˜çš„ä¸€ç§æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ç§æ–¹æ³•ã€‚</p>
<p>åœ¨JDK1.5ä¹‹å‰synchronizedæ˜¯ä¸€ä¸ªé‡é‡çº§é”ï¼Œç›¸å¯¹äºj.u.c.Lockï¼Œå®ƒä¼šæ˜¾å¾—é‚£ä¹ˆç¬¨é‡ï¼Œéšç€Javs SE 1.6å¯¹synchronizedè¿›è¡Œçš„å„ç§ä¼˜åŒ–åï¼Œsynchronizedå¹¶ä¸ä¼šæ˜¾å¾—é‚£ä¹ˆé‡äº†ã€‚</p>
<p>synchronizedçš„ä½œç”¨ä¸»è¦æœ‰ä¸‰ä¸ªï¼š</p>
<p>åŸå­æ€§ï¼šç¡®ä¿çº¿ç¨‹äº’æ–¥åœ°è®¿é—®åŒæ­¥ä»£ç ï¼›<br>å¯è§æ€§ï¼šä¿è¯å…±äº«å˜é‡çš„ä¿®æ”¹èƒ½å¤ŸåŠæ—¶å¯è§ï¼Œå…¶å®æ˜¯é€šè¿‡Javaå†…å­˜æ¨¡å‹ä¸­çš„â€œå¯¹ä¸€ä¸ªå˜é‡unlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»è¦åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼›å¦‚æœå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œlockæ“ä½œï¼Œåˆ™å°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨æ­¤å˜é‡å‰ï¼Œéœ€è¦é‡æ–°ä»ä¸»å†…å­˜ä¸­loadæ“ä½œæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡å€¼â€ æ¥ä¿è¯çš„ï¼›<br>æœ‰åºæ€§ï¼šæœ‰æ•ˆè§£å†³é‡æ’åºé—®é¢˜ï¼Œå³ â€œä¸€ä¸ªunlockæ“ä½œå…ˆè¡Œå‘ç”Ÿ(happen-before)äºåé¢å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œâ€ï¼›<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/m0_53474063/article/details/112389756">https://blog.csdn.net/m0_53474063/article/details/112389756</a></p>
<p>âœ…waitæ–¹æ³•ã€notifyæ–¹æ³•ã€notifyAllæ–¹æ³•</p>
<p>ç­‰å¾…æ± ï¼š<br>å‡è®¾çº¿ç¨‹ A è°ƒç”¨äº†é”å¯¹è±¡çš„ wait() æ–¹æ³•ï¼Œåˆ™ Açº¿ç¨‹å°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”(å› ä¸º wait() æ–¹æ³•å¿…é¡»å‡ºç°åœ¨ synchronized ä¸­ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œ wait() æ–¹æ³•ä¹‹å‰ Açº¿ç¨‹å°±å·²ç»æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”)ï¼ŒåŒæ—¶çº¿ç¨‹ Aè¿›å…¥åˆ°äº†è¯¥å¯¹è±¡çš„ç­‰å¾…æ± ä¸­ã€‚å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹è°ƒç”¨äº†ç›¸åŒå¯¹è±¡çš„ notifyAll() æ–¹æ³•ï¼Œé‚£ä¹ˆå¤„äºè¯¥å¯¹è±¡çš„ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹å°±ä¼šå…¨éƒ¨è¿›å…¥è¯¥å¯¹è±¡çš„é”æ± ä¸­ï¼Œé‡æ–°äº‰å¤ºé”çš„æ‹¥æœ‰æƒã€‚å¦‚æœå¦å¤–çš„ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†ç›¸åŒå¯¹è±¡çš„ notify() æ–¹æ³•ï¼Œé‚£ä¹ˆä»…ä»…æœ‰ä¸€ä¸ªå¤„äºè¯¥å¯¹è±¡çš„ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹(éšæœº)ä¼šè¿›å…¥è¯¥å¯¹è±¡çš„é”æ± ã€‚</p>
<p>é”æ± ï¼š<br>å‡è®¾çº¿ç¨‹ Aå·²ç»æ‹¥æœ‰äº†é”ï¼Œè€Œå…¶å®ƒçš„çº¿ç¨‹æƒ³è¦è°ƒç”¨è¯¥å¯¹è±¡çš„ synchronized æ–¹æ³•(æˆ–è€… synchronized å—)ï¼Œå…¶ä»–æœªè·å¾—é”çš„çº¿ç¨‹åœ¨è¿›å…¥å¯¹è±¡çš„ synchronized æ–¹æ³•ä¹‹å‰éƒ½éœ€è¦å…ˆè·å¾—è¯¥å¯¹è±¡çš„é”çš„æ‹¥æœ‰æƒï¼Œä½†æ˜¯è¯¥å¯¹è±¡çš„é”ç›®å‰æ­£è¢« Açº¿ç¨‹æ‹¥æœ‰ï¼Œæ‰€ä»¥è¿™äº›çº¿ç¨‹å°±è¿›å…¥äº†è¯¥å¯¹è±¡çš„é”æ± ä¸­ã€‚</p>
<h3 id="leeco-æŒ‰åºæ‰“å°"><a href="#leeco-æŒ‰åºæ‰“å°" class="headerlink" title="leeco æŒ‰åºæ‰“å°"></a>leeco æŒ‰åºæ‰“å°</h3><p>ä¸‰ä¸ªä¸åŒçš„çº¿ç¨‹ Aã€Bã€Cï¼Œè°ƒç”¨åŒä¸€ä¸ªç±»çš„ä¸‰ä¸ªä¸åŒçš„æ–¹æ³•ï¼Œæƒ³è¦å¼‚æ­¥è°ƒç”¨ä¸‰ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å®ç°çº¿ç¨‹è°ƒç”¨ç±»ä¸­æ–¹æ³•çš„åŒæ­¥è¾“å‡ºã€‚å®ç°å¼‚æ­¥è½¬åŒæ­¥çš„æ“ä½œã€‚<br>çº¿ç¨‹å†…runæ–¹æ³•é‡Œé¢è´Ÿè´£æ‰“å°ã€‚<br>æ¯”å¦‚å…ˆè°ƒç”¨secondï¼Œå†è°ƒç”¨firstï¼Œè¾“å‡ºçš„æ˜¯first-secondã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class Foo &#123;</span><br><span class="line"></span><br><span class="line">    public Foo() &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Object lock = new Object(); //å¾—å®šä¹‰ï¼Œä¸ç„¶æ˜¯null</span><br><span class="line">    private Integer index = 1;</span><br><span class="line"></span><br><span class="line">    public void first(Runnable printFirst) throws InterruptedException &#123;</span><br><span class="line">        synchronized(lock) &#123;</span><br><span class="line">            while(index != 1) &#123;</span><br><span class="line">                lock.wait();</span><br><span class="line">            &#125;</span><br><span class="line">            printFirst.run();</span><br><span class="line">            index++;</span><br><span class="line">            lock.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void second(Runnable printSecond) throws InterruptedException &#123;</span><br><span class="line">        synchronized(lock) &#123;</span><br><span class="line">            while(index != 2) &#123;</span><br><span class="line">                lock.wait();</span><br><span class="line">            &#125;</span><br><span class="line">            printSecond.run();</span><br><span class="line">            index++;</span><br><span class="line">            lock.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void third(Runnable printThird) throws InterruptedException &#123;</span><br><span class="line">        synchronized(lock) &#123;</span><br><span class="line">            while(index != 3) &#123;</span><br><span class="line">                lock.wait();</span><br><span class="line">            &#125;</span><br><span class="line">            index++;</span><br><span class="line">            printThird.run();</span><br><span class="line">            lock.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="leeco-äº¤æ›¿æ‰“å°FooBar"><a href="#leeco-äº¤æ›¿æ‰“å°FooBar" class="headerlink" title="leeco äº¤æ›¿æ‰“å°FooBar"></a>leeco äº¤æ›¿æ‰“å°FooBar</h3><p>ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹å°†ä¼šå…±ç”¨ä¸€ä¸ª FooBarå®ä¾‹ï¼Œåˆ†åˆ«è°ƒç”¨ä¸¤ä¸ªæ‰“å°æ–¹æ³•ï¼Œä¿è¯çº¿ç¨‹æ˜¯äº¤æ›¿æ‰“å°çš„ã€‚<br>éœ€è¦åŠ å¾ªç¯ï¼Œå¾ªç¯é‡Œé¢å†æŠ¢é”ã€‚å¦‚æœä¸åŠ å¾ªç¯ï¼Œwaitä¹‹åè¿›å…¥ç­‰å¾…æ± ï¼Œå…¶ä»–çº¿ç¨‹notifyAllï¼Œåªæ˜¯å‘Šè¯‰å…¶ä»–çº¿ç¨‹å¯ä»¥æŠ¢é”ï¼Œå¹¶ä¸æ˜¯å”¤é†’å…¶ä»–çº¿ç¨‹è®©ä»–ä»¬å¼€å§‹æŠ¢é”ã€‚æŠ¢é”è¿™ä¸ªåŠ¨ä½œè¿˜æ˜¯éœ€è¦è‡ªå·±è§¦å‘çš„ã€‚<br>å¦‚æœæŠŠå¾ªç¯åŠ åœ¨synchronizedé‡Œé¢å°±ä¸å¯¹äº†ï¼Œæ²¡æœ‰ä¸»åŠ¨è§¦å‘æŠ¢é”ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class FooBar &#123;</span><br><span class="line">    private int n;</span><br><span class="line"></span><br><span class="line">    public FooBar(int n) &#123;</span><br><span class="line">        this.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Object lock = new Object();</span><br><span class="line">    private Integer index = 1;</span><br><span class="line"></span><br><span class="line">    public void foo(Runnable printFoo) throws InterruptedException &#123;</span><br><span class="line">        for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            synchronized(lock) &#123;</span><br><span class="line">                if(index != 1) &#123; //ä¸éœ€è¦whileï¼Œifå°±è¡Œ</span><br><span class="line">                //è¡¨ç¤ºçš„æ˜¯æ‹¿é”™é”äº†ï¼Œé‡Šæ”¾æ‰</span><br><span class="line">                    lock.wait();</span><br><span class="line">                    //waitè¿›å…¥é”æ± ï¼Œå†è¿›æ¥å°±æ˜¯é‡æ–°è·é”è¿›æ¥äº†</span><br><span class="line">                &#125;</span><br><span class="line">                //é”æ‹¿å¯¹äº†ï¼Œå°±è¿›è¡Œå¤„ç†</span><br><span class="line">                printFoo.run();</span><br><span class="line">                index =2;</span><br><span class="line">                lock.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void bar(Runnable printBar) throws InterruptedException &#123;</span><br><span class="line">        for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            synchronized(lock) &#123;</span><br><span class="line">                if(index != 2) &#123;</span><br><span class="line">                    lock.wait();</span><br><span class="line">                &#125;</span><br><span class="line">                printBar.run();</span><br><span class="line">                index =1;</span><br><span class="line">                lock.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="synchronizedçš„å¯¹è±¡é”å’Œç±»é”"><a href="#synchronizedçš„å¯¹è±¡é”å’Œç±»é”" class="headerlink" title="synchronizedçš„å¯¹è±¡é”å’Œç±»é”"></a>synchronizedçš„å¯¹è±¡é”å’Œç±»é”</h3><p>ä¸Šé¢çš„ä¸¤ä¸ªleecoä¾‹å­ä¸­ï¼Œå› ä¸ºæ˜¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡è¿›è¡Œè°ƒç”¨ï¼Œå¤šçº¿ç¨‹å…±äº«é‚£ä¸ªlockï¼Œæ‰€ä»¥lockä¸éœ€è¦staticï¼Œåªéœ€è¦å¯¹è±¡é”ã€‚ä½†æ˜¯å¦‚æœåˆ›å»ºå¤šä¸ªå¯¹è±¡è°ƒç”¨ï¼Œå°±éœ€è¦ç±»é”äº†ã€‚ï¼ˆæ¯”å¦‚æ¥å£çš„æ–¹æ³•è¦æ§åˆ¶å¤šä¸ªè¯·æ±‚åŒæ­¥ï¼‰</p>
<p>synchronizedå…³é”®å­—å¯ä»¥ç”¨åœ¨æ–¹æ³•å’Œä»£ç å—ä¸Šã€‚è¿™äº›æ–¹æ³•æˆ–è€…ä»£ç å—å¯ä»¥ä½¿é™æ€çš„ä¹Ÿå¯ä»¥æ˜¯éé™æ€çš„ã€‚</p>
<p>å¯¹è±¡é”-ä¸€ä¸ªå¯¹è±¡ä¸€æŠŠé”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class DemoClass &#123;</span><br><span class="line">    public synchronized void demoMethod()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">public class DemoClass &#123;</span><br><span class="line">    public void demoMethod()&#123;</span><br><span class="line">        synchronized (this) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class DemoClass &#123;</span><br><span class="line">    private final Object lock = new Object();</span><br><span class="line">    public void demoMethod()&#123;</span><br><span class="line">        synchronized (lock)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ç±»é”-ä¸€ä¸ªç±»ä¸€æŠŠé”</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class DemoClass &#123;</span><br><span class="line">    public synchronized static void demoMethod()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">public class DemoClass&#123;</span><br><span class="line">    public void demoMethod()&#123;</span><br><span class="line">        synchronized (DemoClass.class)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class DemoClass &#123;</span><br><span class="line">    private final static Object lock = new Object();</span><br><span class="line">    public void demoMethod()&#123;</span><br><span class="line">        synchronized (lock)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ç±»é”ï¼šstatic synchronized æ˜¯è¦æ§åˆ¶ç±»çš„æ‰€æœ‰å®ä¾‹çš„å¹¶å‘è®¿é—®ï¼Œstatic synchronizedæ˜¯é™åˆ¶å¤šçº¿ç¨‹ä¸­è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹åŒæ—¶è®¿é—®jvmä¸­è¯¥ç±»æ‰€å¯¹åº”çš„ä»£ç å—ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-22 23:44</span><br><span class="line"> **/</span><br><span class="line">public class SynchroObject extends Thread &#123;</span><br><span class="line">    private static volatile int n = 0;</span><br><span class="line">    private Object lock = new Object();</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            add();</span><br><span class="line">            try &#123;</span><br><span class="line">                sleep(5);</span><br><span class="line">                //æµ‹è¯•å¤šçº¿ç¨‹çš„privateå˜é‡ï¼Œå‘ç°å¤šä¸ªçº¿ç¨‹å¯¹è±¡çš„privateå˜é‡æ˜¯ä¸åŒçš„</span><br><span class="line">                System.out.println(&quot;lock hashcode:&quot; + lock.hashCode());</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å¦‚æœåŒæ­¥æ–¹æ³•æ˜¯staticçš„ï¼Œåˆ™å¤šçº¿ç¨‹æ­£ç¡®åŒæ­¥</span><br><span class="line">    //å¦‚æœåŒæ­¥æ–¹æ³•ä¸æ˜¯staticçš„ï¼Œåˆ™ä¸æ˜¯æ­£ç¡®åŒæ­¥</span><br><span class="line">    private static synchronized void add() &#123;</span><br><span class="line">        n++;</span><br><span class="line">        System.out.println(n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        Thread threads[] = new Thread[100];</span><br><span class="line">        for (int i = 0; i &lt; threads.length; i++) &#123;</span><br><span class="line">            threads[i] = new SynchroObject();</span><br><span class="line">        &#125;</span><br><span class="line">        for (Thread thread : threads) &#123;</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">        for (Thread thread : threads) &#123;</span><br><span class="line">            thread.join(); //ç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot; n= &quot; + n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„äº‹é¡¹ï¼š<br>1ã€synchronized(this){&#x2F;<em>åŒºå—</em>&#x2F;} ä½œç”¨åŸŸæ˜¯å½“å‰å¯¹è±¡ã€‚è¢«synchronizedä¿®é¥°ç¬¦ä¿®é¥°çš„å®ä¾‹æ–¹æ³•ï¼Œè·Ÿæ•´ä¸ªæ–¹æ³•ä½“è¢«ä¸€ä¸ªsynchronized(this) { â€¦ } åŒ…å›´ä½ï¼Œæ„æ€å®Œå…¨ä¸€æ ·ã€‚</p>
<p>2ã€synchronizedå…³é”®å­—æ˜¯ä¸èƒ½ç»§æ‰¿çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸºç±»çš„æ–¹æ³•synchronized f(){} åœ¨ç»§æ‰¿ç±»ä¸­å¹¶ä¸è‡ªåŠ¨æ˜¯synchronized f(){}ï¼Œè€Œæ˜¯å˜æˆäº†f(){}ã€‚ç»§æ‰¿ç±»éœ€è¦ä½ æ˜¾å¼çš„æŒ‡å®šå®ƒçš„æŸä¸ªæ–¹æ³•ä¸ºsynchronizedæ–¹æ³•ã€‚</p>
<p>3ã€æ ¹æ®javaè¯­è¨€çš„è§„å®šï¼Œä½ ä¸èƒ½åœ¨æ„é€ æ–¹æ³•ä¸Šä½¿ç”¨synchronizedå…³é”®å­—ï¼Œè¿™æ˜¯éæ³•çš„å¹¶ä¸”ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚</p>
<p>è½¬è‡ªï¼šsynchronizedçš„å¯¹è±¡é”å’Œç±»é”ï¼š<a href="https://www.cnblogs.com/ZenoLiang/p/14713160.html">https://www.cnblogs.com/ZenoLiang/p/14713160.html</a></p>
<p>âœ…å¤šçº¿ç¨‹synchronizedå˜é‡çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-06-27 09:15</span><br><span class="line"> **/</span><br><span class="line">public class ThreadDemo &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //åˆ›å»ºå¹¶å¼€å¯4ä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿå››ä¸ªå”®ç¥¨çª—å£</span><br><span class="line">        SaleThread saleThread = new SaleThread();</span><br><span class="line">        new Thread(new SaleThread(), &quot;çª—å£1&quot;).start();</span><br><span class="line">        new Thread(new SaleThread(), &quot;çª—å£2&quot;).start();</span><br><span class="line">        new Thread(new SaleThread(), &quot;çª—å£3&quot;).start();</span><br><span class="line">        new Thread(new SaleThread(), &quot;çª—å£4&quot;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SaleThread implements Runnable&#123;</span><br><span class="line">    //å¤§å‰æï¼šç¥¨å¾—æ˜¯staticçš„ï¼Œé™¤éåˆ›å»ºçº¿ç¨‹å…±ç”¨ä¸€ä¸ªSaleThreadå¯¹è±¡</span><br><span class="line">    //ä¸å…±ç”¨Runnableå¯¹è±¡çš„è¯ï¼Œä¸”ç¥¨ä¸æ˜¯staticçš„ï¼Œåˆ™æ¯ä¸ªçº¿ç¨‹å„è‡ªå–</span><br><span class="line">    private static Integer tickets = 100;  //å¤šçº¿ç¨‹å…±äº«çš„å˜é‡</span><br><span class="line">    //å®šä¹‰ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨ä½œåŒæ­¥ä»£ç å—çš„é”</span><br><span class="line">    //å¦‚æœä¸æ˜¯staticå˜é‡ï¼Œè¾¾ä¸åˆ°åŒæ­¥æ•ˆæœ</span><br><span class="line">    //å¦‚æœæ˜¯staticå˜é‡ï¼Œå¤šçº¿ç¨‹å¯¹è±¡å…±äº«è¯¥å˜é‡ã€‚æ­£ç¡®åŒæ­¥ã€‚</span><br><span class="line">    //å¦‚æœä¸Šé¢åˆ›å»ºçº¿ç¨‹ç”¨çš„æ˜¯åŒä¸€ä¸ªSaleThreadå¯¹è±¡ï¼Œåˆ™ä¸ç®¡æ˜¯ä¸æ˜¯staticçš„ï¼Œéƒ½æ˜¯æ­£ç¡®åŒæ­¥çš„ã€‚</span><br><span class="line">    private static Object lock = new Object();</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run()&#123;</span><br><span class="line">        while(true)&#123;</span><br><span class="line">            synchronized (lock)&#123;</span><br><span class="line">                if(tickets&gt;0)&#123;</span><br><span class="line">                    int i = tickets;</span><br><span class="line">                    try&#123;</span><br><span class="line">                        Thread.sleep(1);  //æ¨¡æ‹Ÿå”®ç¥¨è€—æ—¶è¿‡ç¨‹</span><br><span class="line">                    &#125;catch(InterruptedException e)&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    //å¦‚æœlockæ˜¯staticï¼Œåˆ™hashcodeä¸€æ ·ã€‚ticketsçš„hashcodeä¸€ç›´åœ¨å˜</span><br><span class="line">                    System.out.println(lock.hashCode() + &quot;  &quot; + tickets.hashCode());</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()</span><br><span class="line">                            +&quot;æ­£åœ¨å‘å”®ç¬¬&quot;+tickets--+&quot;å¼ ç¥¨&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¤šçº¿ç¨‹å…±äº«å˜é‡é—®é¢˜"><a href="#å¤šçº¿ç¨‹å…±äº«å˜é‡é—®é¢˜" class="headerlink" title="å¤šçº¿ç¨‹å…±äº«å˜é‡é—®é¢˜"></a>å¤šçº¿ç¨‹å…±äº«å˜é‡é—®é¢˜</h3><p>åœ¨å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ä¸­æ¢è®¨äº†é™æ€å˜é‡å’Œæˆå‘˜å˜é‡çš„åŒºåˆ«ã€‚<br>ç”±staticä¿®é¥°çš„å˜é‡ç§°ä¸ºé™æ€å˜é‡ï¼Œå…¶å®è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ã€‚<br>æœ¬è´¨æ˜¯è¯´é™æ€å˜é‡æ˜¯ç±»æ‰€æœ‰å¯¹è±¡å…±äº«ï¼Œæˆå‘˜å˜é‡æ˜¯å¯¹è±¡ä¸“æœ‰ã€‚</p>
<p>è¿™é‡Œæ¢è®¨ä¸€ä¸‹å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«ï¼š</p>
<p>é¦–å…ˆå„ç§å˜é‡çš„åˆ†ç±»ï¼š<br>å˜é‡åˆ†ä¸ºå…¨å±€å˜é‡ï¼ˆæˆå‘˜å˜é‡ï¼‰å’Œå±€éƒ¨å˜é‡ï¼Œå…¨å±€å˜é‡åˆåˆ†ä¸ºé™æ€å˜é‡å’Œå®ä¾‹å˜é‡ã€‚<br>æ‰€ä»¥ä¸Šè¾¹å¯¹é™æ€å˜é‡å’Œæˆå‘˜å˜é‡çš„åŒºåˆ†ï¼Œåº”è¯¥æ˜¯é™æ€å˜é‡</p>
<p>âœ…ä»€ä¹ˆæ˜¯é™æ€å˜é‡ï¼š<br>1ï¼šä¸ºæŸç‰¹å®šæ•°æ®ç±»å‹æˆ–å¯¹è±¡åˆ†é…å•ä¸€çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸åˆ›å»ºå¯¹è±¡çš„ä¸ªæ•°æ— å…³ã€‚<br>2ï¼šé™æ€å˜é‡è¢«æ‰€æœ‰çš„å¯¹è±¡æ‰€å…±äº«ï¼Œåœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œå®ƒå½“ä¸”ä»…å½“åœ¨ç±»åˆæ¬¡åŠ è½½æ—¶ä¼šè¢«åˆå§‹åŒ–ã€‚<br>3ï¼šè¢«staticä¿®é¥°åçš„å€¼å¯ä»¥ç›´æ¥ç±»å.å€¼è¿›è¡Œå¼•ç”¨ï¼Œè€Œæ— éœ€newä¸€ä¸ªå¯¹è±¡è¿›è¡Œè°ƒç”¨<br>4ï¼šåœ¨JVMä¸­ï¼Œé™æ€å˜é‡çš„åŠ è½½é¡ºåºåœ¨å¯¹è±¡ä¹‹å‰ï¼Œå› æ­¤é™æ€å˜é‡ä¸ä¾é™„äºå¯¹è±¡å­˜åœ¨ï¼Œå¯ä»¥åœ¨ä¸å®ä¾‹åŒ–ç±»çš„æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨é™æ€å˜é‡</p>
<p>âœ…å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ï¼ˆæˆå‘˜å˜é‡ï¼‰ï¼š<br>åœ¨æ–¹æ³•ä½“ä¸­å£°æ˜çš„å˜é‡å«åšï¼šå±€éƒ¨å˜é‡ã€‚<br>åœ¨æ–¹æ³•ä½“å¤–å£°æ˜çš„å˜é‡å«åšï¼šæˆå‘˜å˜é‡ã€‚æˆå‘˜å˜é‡åˆå¯ä»¥åˆ†ä¸ºï¼šå®ä¾‹å˜é‡å’Œé™æ€å˜é‡ã€‚</p>
<p>å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«:<br>1ï¼Œä½œç”¨åŸŸä¸åŒï¼šå…¨å±€å˜é‡çš„ä½œç”¨åŸŸä¸ºæ•´ä¸ªç¨‹åºï¼Œè€Œå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸä¸ºå½“å‰å‡½æ•°æˆ–å¾ªç¯ç­‰<br>2ï¼Œå†…å­˜å­˜å‚¨æ–¹å¼ä¸åŒï¼šå…¨å±€å˜é‡å­˜å‚¨åœ¨å…¨å±€æ•°æ®åŒºä¸­ï¼Œå±€éƒ¨å˜é‡å­˜å‚¨åœ¨æ ˆåŒº<br>3ï¼Œç”Ÿå‘½æœŸä¸åŒï¼šå…¨å±€å˜é‡çš„ç”Ÿå‘½æœŸå’Œä¸»ç¨‹åºä¸€æ ·ï¼Œéšç¨‹åºçš„é”€æ¯è€Œé”€æ¯ï¼Œå±€éƒ¨å˜é‡åœ¨å‡½æ•°å†…éƒ¨æˆ–å¾ªç¯å†…éƒ¨ï¼Œéšå‡½æ•°çš„é€€å‡ºæˆ–å¾ªç¯é€€å‡ºå°±ä¸å­˜åœ¨äº†<br>4ï¼Œä½¿ç”¨æ–¹å¼ä¸åŒï¼šå…¨å±€å˜é‡åœ¨å£°æ˜åç¨‹åºçš„å„ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥ç”¨åˆ°ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡åªèƒ½åœ¨å±€éƒ¨ä½¿ç”¨ã€‚å‡½æ•°å†…éƒ¨ä¼šä¼˜å…ˆä½¿ç”¨å±€éƒ¨å˜é‡å†ä½¿ç”¨å…¨å±€å˜é‡ã€‚</p>
<p>âœ…å¤šçº¿ç¨‹è®¿é—®å…¨å±€å˜é‡(æˆå‘˜å˜é‡)å’Œå±€éƒ¨å˜é‡ï¼š</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class HelloThreadTest</span><br><span class="line">&#123;</span><br><span class="line">    public static void main(String[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        HelloThread r = new HelloThread();</span><br><span class="line"></span><br><span class="line">        Thread t1 = new Thread(r);</span><br><span class="line">        Thread t2 = new Thread(r);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class HelloThread implements Runnable</span><br><span class="line">&#123;</span><br><span class="line">    int i;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run()</span><br><span class="line">    &#123;</span><br><span class="line">        //int i = 0;</span><br><span class="line">        while (true)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(&quot;Hello number: &quot; + i++);</span><br><span class="line"></span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                Thread.sleep((long) Math.random() * 1000);</span><br><span class="line">            &#125;</span><br><span class="line">            catch (InterruptedException e)</span><br><span class="line">            &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (50 == i)</span><br><span class="line">            &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œiæ˜¯æˆå‘˜å˜é‡ï¼Œåˆ™HelloThreadçš„å¯¹è±¡råªåŒ…å«è¿™ä¸€ä¸ªiï¼Œä¸¤ä¸ªThreadå¯¹è±¡å› ä¸ºç”±ræ„é€ ï¼Œæ‰€ä»¥å…±äº«äº†åŒä¸€ä¸ªiã€‚</p>
<p>å¦‚æœiæ”¹ä¸ºåœ¨runæ–¹æ³•ä¸­å®šä¹‰ï¼Œé‚£ä¹ˆå°±æ˜¯å±€éƒ¨å˜é‡ï¼Œç”±äºå±€éƒ¨å˜é‡å¯¹äºæ¯ä¸€ä¸ªçº¿ç¨‹æ¥è¯´éƒ½æœ‰è‡ªå·±çš„æ‹·è´ï¼Œæ‰€ä»¥å„ä¸ªçº¿ç¨‹ä¹‹é—´ä¸å†å…±äº«åŒä¸€ä¸ªå˜é‡ã€‚</p>
<p>æ€»ç»“ï¼š<br>å¦‚æœä¸€ä¸ªå˜é‡æ˜¯æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆå¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡è¿›è¡Œæ“ä½œæ—¶ï¼Œå®ƒä»¬å¯¹è¯¥æˆå‘˜å˜é‡æ˜¯å½¼æ­¤å½±å“çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹å¯¹æˆå‘˜å˜é‡çš„æ”¹å˜ä¼šå½±å“åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<p>å¦‚æœä¸€ä¸ªå˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªè¯¥å±€éƒ¨å˜é‡çš„æ‹·è´ï¼ˆå³ä¾¿æ˜¯åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•çš„å±€éƒ¨å˜é‡ï¼Œä¹Ÿä¼šå¯¹æ¯ä¸€ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªæ‹·è´ï¼‰ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥å±€éƒ¨å˜é‡çš„æ”¹å˜ä¸ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹ã€‚</p>
<p>è½¬è‡ªï¼š<a href="http://t.zoukankan.com/xiaowenwu-p-5077639.html">http://t.zoukankan.com/xiaowenwu-p-5077639.html</a></p>
<p>âš ï¸è¿™é‡Œæ‰€è¯´çš„å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ï¼Œè¯´çš„æ˜¯çº¿ç¨‹å¯¹è±¡å†…çš„ï¼Œä¸æ˜¯ä¼ å…¥çº¿ç¨‹çš„æ˜¯å±€éƒ¨å˜é‡è¿˜æ˜¯å…¨å±€å˜é‡ã€‚çŒœæµ‹ï¼šä¸åˆ†ä¼ å…¥çš„æ˜¯å…¨å±€å˜é‡è¿˜æ˜¯å±€éƒ¨å˜é‡ï¼Œéƒ½æ˜¯æœ‰æ‹·è´çš„ï¼Œå› ä¸ºä¼ å…¥çš„å˜é‡å¯¹çº¿ç¨‹æ¥è¯´æ˜¯æˆå‘˜å˜é‡ã€‚</p>
<p>å®éªŒï¼šä¸€ä¸ªArrayListï¼Œå¯¹ä»£ç å—å„¿æ¥è¯´æ˜¯å±€éƒ¨å˜é‡ï¼Œä¼ å…¥çº¿ç¨‹ä¸­ï¼Œåªè¯»listçš„hashcodeï¼Œä¼ å…¥çº¿ç¨‹å‰å’Œçº¿ç¨‹ä¸­çš„hashcodeä¸€æ ·ã€‚</p>
<p>å®éªŒï¼šArrayListå¢åŠ ä¸€ä¸ªå…ƒç´ ï¼ŒhashCodeä¼šå˜ï¼Œæ”¹å˜ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§ï¼ŒhashCodeä¸å˜ã€‚</p>
<h3 id="ThreadLocalå˜é‡"><a href="#ThreadLocalå˜é‡" class="headerlink" title="ThreadLocalå˜é‡"></a>ThreadLocalå˜é‡</h3><p>æˆå‘˜å˜é‡ï¼šä»ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªRunnableå¯¹è±¡åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«æˆå‘˜å˜é‡ï¼Œå¤šä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡è¿›è¡Œæ“ä½œæ˜¯å½¼æ­¤å½±å“çš„ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢åŠ äº†é”ï¼Œè¾¾åˆ°äº†çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>å±€éƒ¨å˜é‡ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰å±€éƒ¨å˜é‡çš„æ‹·è´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹å±€éƒ¨å˜é‡çš„æ“ä½œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ã€‚ï¼ˆä¸Šé¢çš„iï¼‰</p>
<p>å¤šçº¿ç¨‹ä¹‹é—´å°±æ˜¯å› ä¸ºæ•°æ®å…±äº«åœ¨å¤šä¸ªçº¿ç¨‹æ‰å¯¼è‡´äº†çº¿ç¨‹ä¸å®‰å…¨ï¼Œè¿™å°±è¦æ±‚çº¿ç¨‹é—´çš„æ•°æ®éœ€è¦éš”ç¦»ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>å› æ­¤ThreadLocalï¼šæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ï¼›ä¸€ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ï¼Œåˆ†åˆ«æœ‰ç‹¬ç«‹çš„å€¼(å‰¯æœ¬)ã€‚</p>
<p>âœ…ä¾‹å­ï¼šå¤šä¸ªçº¿ç¨‹å…±ç”¨ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œå†…éƒ¨ThreadLocalå˜é‡å’Œæ™®é€šæˆå‘˜å˜é‡åŒºåˆ«ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-23 23:28</span><br><span class="line"> **/</span><br><span class="line">public class ThreadLocalExample &#123;</span><br><span class="line"></span><br><span class="line">    public static class MyRunnable implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">        private ThreadLocal&lt;Integer&gt; threadLocal = new ThreadLocal&lt;Integer&gt;();</span><br><span class="line">        int local = 1;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            threadLocal.set((int) (Math.random() * 100D));</span><br><span class="line">            local = (int) (Math.random() * 100D);</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(100);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;threadLocal:&quot; +threadLocal.get());</span><br><span class="line">            System.out.println(&quot;local:&quot; +local);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        MyRunnable sharedRunnableInstance = new MyRunnable();</span><br><span class="line">        Thread thread1 = new Thread(sharedRunnableInstance);</span><br><span class="line">        Thread thread2 = new Thread(sharedRunnableInstance);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        try &#123;</span><br><span class="line">            thread1.join();</span><br><span class="line">            thread2.join();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š</span><br><span class="line">threadLocal:40</span><br><span class="line">threadLocal:32</span><br><span class="line">local:95</span><br><span class="line">local:95</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„ThreadLocalå˜é‡ï¼Œä½†æ˜¯å…±äº«localå˜é‡ã€‚</p>
<p>âœ…ä¾‹å­ï¼šå¤šä¸ªçº¿ç¨‹å…±åŒå¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå¯¹è±¡å†…éƒ¨ThreadLocalå˜é‡å’Œæ™®é€šæˆå‘˜å˜é‡åŒºåˆ«ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-23 23:55</span><br><span class="line"> **/</span><br><span class="line">public class ThreadLocalExample2 &#123;</span><br><span class="line">    private ThreadLocal&lt;Integer&gt; threadLocal = new ThreadLocal&lt;Integer&gt;();</span><br><span class="line">    int local = 1;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ThreadLocalExample2 demo = new ThreadLocalExample2();</span><br><span class="line">        for (int i = 0; i &lt; 2; i++) &#123;</span><br><span class="line">            Thread thread = new Thread(() -&gt; &#123;</span><br><span class="line">                demo.threadLocal.set((int) (Math.random() * 100D));</span><br><span class="line">                demo.local = (int) (Math.random() * 100D);</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(100);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(&quot;threadLocal:&quot; +demo.threadLocal.get());</span><br><span class="line">                System.out.println(&quot;local:&quot; +demo.local);</span><br><span class="line">            &#125;);</span><br><span class="line">            thread.setName(&quot;çº¿ç¨‹&quot; + i);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€æ ·çš„æ•ˆæœã€‚</p>
<p>å¤šçº¿ç¨‹å˜é‡å…±äº«å’Œéš”ç¦»ï¼ŒThreadLocalè®²è§£ï¼š<a href="https://blog.csdn.net/JokerLJG/article/details/121284966">https://blog.csdn.net/JokerLJG/article/details/121284966</a></p>
<p>çº¿ç¨‹ç§æœ‰å˜é‡çš„å¦ä¸€ä¸ªæ–¹æ³•ï¼šå¤šä¸ªå¯¹è±¡æ„é€ æ–¹æ³•ä¼ å…¥ä¸åŒçš„å€¼ï¼š<a href="https://blog.csdn.net/qq_43209615/article/details/124993090">https://blog.csdn.net/qq_43209615/article/details/124993090</a></p>
<p>SimpleDateFormatä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„è§£å†³ï¼š<a href="https://blog.csdn.net/sinat_38816924/article/details/122642680">https://blog.csdn.net/sinat_38816924/article/details/122642680</a></p>
<h3 id="Runnableå’ŒThreadçš„åŒºåˆ«"><a href="#Runnableå’ŒThreadçš„åŒºåˆ«" class="headerlink" title="Runnableå’ŒThreadçš„åŒºåˆ«"></a>Runnableå’ŒThreadçš„åŒºåˆ«</h3><p>Runnableæ˜¯æ¥å£ã€‚Threadæ˜¯å®ç°äº†Runnableæ¥å£çš„ç±»ï¼Œå¹¶è¿›è¡Œäº†æ‰©å±•ï¼Œè€ŒThreadå’ŒRunnableçš„å®è´¨æ˜¯å®ç°çš„å…³ç³»ï¼Œä¸æ˜¯åŒç±»ä¸œè¥¿ï¼Œæ‰€ä»¥Runnableæˆ–Threadæœ¬èº«æ²¡æœ‰å¯æ¯”æ€§ã€‚</p>
<p>Runnableæ›´å®¹æ˜“å¯ä»¥å®ç°å¤šä¸ªçº¿ç¨‹é—´çš„èµ„æºå…±äº«ï¼Œæäº¤ç»™ThreadåŒä¸€ä¸ªRunnableå¯¹è±¡ï¼Œå…±äº«å…¶ä¸­çš„privateå¯¹è±¡ã€‚ï¼ˆåªæ˜¯å…±äº«ï¼Œçº¿ç¨‹å®‰å…¨è¦åŠ åŒæ­¥ï¼‰ã€‚<br>è€ŒThreadä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªä¸è¿‡æ˜¯å¤šä¸ªthreadå¯¹è±¡å…±äº«staticå˜é‡ï¼Œæˆ–è€…æäº¤åŒä¸€ä¸ªThreadå¯¹è±¡ï¼Œå¹¶ä¸”staticåªæ˜¯å¯è§ï¼Œè¿˜éœ€è¦åŠ åŒæ­¥æ‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<blockquote>
<p>è¿™é‡Œåªæ¢è®¨å…±äº«å˜é‡çš„é—®é¢˜ï¼Œæƒ³å®ç°çº¿ç¨‹å®‰å…¨ï¼Œè¦ä¹ˆåŠ åŒæ­¥ï¼Œè¦ä¹ˆvolatile+åŸå­æ€§å˜é‡ã€‚</p>
</blockquote>
<p>è¿˜æ˜¯å–ç¥¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Test3  extends Thread &#123;</span><br><span class="line"></span><br><span class="line">        private int ticket = 10;</span><br><span class="line"></span><br><span class="line">        public void run()&#123;</span><br><span class="line">            for(int i =0;i&lt;10;i++)&#123;</span><br><span class="line">                synchronized (this)&#123;</span><br><span class="line">                    if(this.ticket&gt;0)&#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                            Thread.sleep(100);</span><br><span class="line">                            System.out.println(Thread.currentThread().getName()+&quot;å–ç¥¨----&gt;&quot;+(this.ticket--));</span><br><span class="line">                        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static void main(String[] arg)&#123;</span><br><span class="line">            Test3 t1 = new Test3();</span><br><span class="line">            new Thread(t1,&quot;çº¿ç¨‹1&quot;).start();</span><br><span class="line">            new Thread(t1,&quot;çº¿ç¨‹2&quot;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://blog.csdn.net/zhaojianting/article/details/97664370">https://blog.csdn.net/zhaojianting/article/details/97664370</a></p>
<h3 id="è·å–çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Ÿ"><a href="#è·å–çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Ÿ" class="headerlink" title="è·å–çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Ÿ"></a>è·å–çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Ÿ</h3><p>è²Œä¼¼æ— æ³•è·å–çº¿ç¨‹ã€‚<br>ä½†æ˜¯å¯ä»¥è·å–çº¿ç¨‹æ± ä¸­æ´»åŠ¨çš„çº¿ç¨‹æ•°ï¼š<br>ThreadPoolExecutorçš„getActiveCountæ–¹æ³•ã€‚<br><code>public class ThreadPoolExecutor extends AbstractExecutorService &#123;</code><br><code>public abstract class AbstractExecutorService implements ExecutorService &#123;</code><br><code>public interface ExecutorService extends Executor &#123;</code></p>
<p>ExecutorServiceå…ˆè½¬å‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ExecutorService executorService = Executors.newFixedThreadPool(10);</span><br><span class="line">System.out.println(((ThreadPoolExecutor)executorService).getActiveCount());  //0</span><br></pre></td></tr></table></figure>

<h3 id="ThreadPoolTaskExecutor"><a href="#ThreadPoolTaskExecutor" class="headerlink" title="ThreadPoolTaskExecutor"></a>ThreadPoolTaskExecutor</h3><p>ThreadPoolTaskExecutoræ˜¯ä¸€ä¸ªspringçš„çº¿ç¨‹æ± æŠ€æœ¯ã€‚ThreadPoolTaskExecutoræ˜¯spring coreåŒ…ä¸­çš„ï¼Œè€ŒThreadPoolExecutoræ˜¯JDKä¸­çš„JUCã€‚ThreadPoolTaskExecutoræ˜¯å¯¹ThreadPoolExecutorè¿›è¡Œäº†å°è£…å¤„ç†ã€‚</p>
<p>Springè‡ªå¸¦çš„çº¿ç¨‹æ± ThreadPoolTaskExecutorï¼š<br><a href="https://zhuanlan.zhihu.com/p/346086161">https://zhuanlan.zhihu.com/p/346086161</a></p>
<h3 id="Scheduled"><a href="#Scheduled" class="headerlink" title="@Scheduled"></a>@Scheduled</h3><p>Springå†…ç½®å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼Œä¸»è¦ç”¨äºæ§åˆ¶ä»»åŠ¡åœ¨æŸä¸ªæŒ‡å®šæ—¶é—´æ‰§è¡Œ,æˆ–è€…æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œ.æ³¨æ„é¡»è¦é…åˆ@EnableSchedulingä½¿ç”¨,é…ç½®@Scheduledä¸»è¦æœ‰ä¸‰ç§é…ç½®æ‰§è¡Œæ—¶é—´çš„æ–¹å¼,cron,fixedRate,fixedDelayã€‚</p>
<p>Springå†…ç½®å®šæ—¶ä»»åŠ¡è°ƒåº¦@Scheduledä½¿ç”¨è¯¦è§£ï¼š<br><a href="https://www.jb51.net/article/201373.htm">https://www.jb51.net/article/201373.htm</a></p>
<p>@Scheduledæ³¨è§£ï¼š<br><a href="http://www.javashuo.com/article/p-otgzzukq-hc.html">http://www.javashuo.com/article/p-otgzzukq-hc.html</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå®ç°è‡ªå®šä¹‰æ³¨è§£</title>
    <url>/2022/03/19/myblog/java/java%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/</url>
    <content><![CDATA[<h3 id="å…³äºæ³¨è§£"><a href="#å…³äºæ³¨è§£" class="headerlink" title="å…³äºæ³¨è§£"></a>å…³äºæ³¨è§£</h3><p>Annotationï¼Œæ³¨è§£æ˜¯Java SE 5.0ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„æ¦‚å¿µï¼Œå®ƒæ˜¯å¯¹javaæºä»£ç çš„è¯´æ˜ï¼Œæ˜¯ä¸€ç§å…ƒæ•°æ®ï¼ˆæè¿°æ•°æ®çš„æ•°æ®ï¼‰ã€‚</p>
<ul>
<li>æ³¨é‡Š<br>   æ³¨é‡Šæ˜¯å¯¹ä»£ç çš„è¯´æ˜ï¼Œç»™ä»£ç çš„è¯»è€…çœ‹ï¼Œä¾¿äºå¸®è¯»è€…æ¢³ç†ä¸šåŠ¡é€»è¾‘ï¼›</li>
<li>æ³¨è§£<br>  æ³¨è§£ä¹Ÿæ˜¯å¯¹ä»£ç çš„è¯´æ˜ï¼Œéœ€è¦é…åˆå·¥å…·ï¼ˆè§£æå®ƒçš„ä»£ç ï¼‰ä½¿ç”¨ï¼Œå‚ä¸ä»£ç çš„ç¼–è¯‘ï¼Œç»™åº”ç”¨ç¨‹åºçœ‹çš„ã€‚</li>
</ul>
<p>æ³¨è§£çš„æ¸Šæºï¼š</p>
<p>åœ¨é¢‘ç¹ä½¿ç”¨æ³¨è§£ä¹‹å‰ï¼Œæ˜¯ç”¨xml æ¥ä½œä¸ºå…ƒæ•°æ®ä½¿ç”¨ï¼Œåœ¨æœ€å¼€å§‹ä½¿ç”¨ssm(Spring,SpringMVC,Mybatis)æ¡†æ¶æ—¶ï¼Œbeanä¸beanä¹‹é—´çš„ä¾èµ–å…³ç³»æ˜¯é€šè¿‡xmlæ–‡ä»¶æ¥é…ç½®ï¼Œè¿™ä¸ªxmlæ–‡ä»¶å’Œæºä»£ç åˆ†æ•£ï¼Œå½“å¾®æœåŠ¡ã€åˆ†å¸ƒå¼æ³¨è§£æµè¡Œï¼Œç³»ç»Ÿè¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦è¶Šæ¥è¶Šå¤šçš„xmlæ–‡ä»¶æ¥é…ç½®ç®¡ç†ï¼Œæ–‡ä»¶é…ç½®å†—é•¿ï¼Œè€Œä¸”ç±»å‹ä¸å®‰å…¨ï¼ˆè¿è¡ŒæœŸæ‰ä¼šå‘ç°é”™è¯¯ï¼‰,æ­¤æ—¶å°±éœ€è¦ä¸€ç§æ¯”è¾ƒç®€å•ç›´è§‚è€Œä¸”ç±»å‹å®‰å…¨çš„é…ç½®æ–¹å¼ï¼Œæ³¨è§£å°±åº”è¿è€Œç”Ÿäº†ï¼ŒæŒ‰ç…§Springbootâ€œçº¦å®šå¤§äºé…ç½®â€çš„æ–¹å¼ï¼Œé€šè¿‡æ³¨è§£æ¥çº¦å®šå…¶å«ä¹‰ï¼Œæ›´æ˜¯å‡å°‘äº†xmlé…ç½®æ–‡ä»¶çš„æ•°é‡ã€‚<br>     å¯¹äºä¸€äº›ç»å¸¸å˜åŠ¨æˆ–è€…é…ç½®å¤æ‚çš„é…ç½®ï¼Œä½¿ç”¨xmlæ–‡ä»¶æ¥è¯´æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œæ‰€ä»¥ç°åœ¨ç»å¸¸æ˜¯æ³¨è§£å’Œxmlæ–¹å¼å…±å­˜ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/zt15732625878/article/details/99671586">https://blog.csdn.net/zt15732625878/article/details/99671586</a></p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<h3 id="æ³¨è§£åˆ†ç±»"><a href="#æ³¨è§£åˆ†ç±»" class="headerlink" title="æ³¨è§£åˆ†ç±»"></a>æ³¨è§£åˆ†ç±»</h3><p>æŒ‰ç…§æ¥æºåˆ’åˆ†ï¼Œå¯ä»¥åˆ†ä¸º JDKçš„æ³¨è§£ï¼Œç¬¬ä¸‰æ–¹çš„æ³¨è§£ï¼Œè‡ªå®šä¹‰æ³¨è§£ã€‚</p>
<p>JDKæ³¨è§£</p>
<p>Java å†…ç½®ä¸‰å¤§æ³¨è§£<br>@Override ï¼ˆæ ‡è®°é‡å†™æ–¹æ³•ï¼‰<br>@Deprecated ï¼ˆæ ‡è®°è¿‡æ—¶ï¼‰<br>@SuppressWarnings ï¼ˆå¿½ç•¥è­¦å‘Šï¼‰</p>
<p>å…ƒæ³¨è§£ (æ³¨è§£çš„æ³¨è§£)<br>@Target ï¼ˆæ³¨è§£çš„ä½œç”¨ç›®æ ‡ï¼‰<br>@Retention ï¼ˆæ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼‰<br>@Document ï¼ˆæ³¨è§£æ˜¯å¦è¢«åŒ…å«åœ¨JavaDocä¸­ï¼‰<br>@Inherited ï¼ˆæ˜¯å¦å…è®¸å­ç±»é›†æˆè¯¥æ³¨è§£ï¼‰</p>
<p>ç¬¬ä¸‰æ–¹æ³¨è§£ï¼ˆä¸»è¦æ¥æºäºå„ç§æ¡†æ¶ï¼‰<br>Springæ³¨è§£<br>@RequestMapping,@RestController,@Configuration,@Value,@Controller,@Service,@Repository,@Componentç­‰<br>SpringBootæ³¨è§£<br>@SpringBootApplication,@EnableAutoConfigurationç­‰<br>JPAæ³¨è§£<br>@Table,@Entity,@Column,@Idç­‰<br>â€¦â€¦</p>
<p>è‡ªå®šä¹‰æ³¨è§£<br>ä½¿ç”¨å…ƒæ³¨è§£è‡ªå·±å®šä¹‰çš„æ³¨è§£</p>
<h3 id="æ³¨è§£çš„å®šä¹‰"><a href="#æ³¨è§£çš„å®šä¹‰" class="headerlink" title="æ³¨è§£çš„å®šä¹‰"></a>æ³¨è§£çš„å®šä¹‰</h3><p>1&gt;.æ¯ä¸€ä¸ªæ–¹æ³•å®é™…ä¸Šæ˜¯å£°æ˜äº†ä¸€ä¸ªé…ç½®å‚æ•°,<br>2&gt;.æ–¹æ³•çš„åç§°å°±æ˜¯å‚æ•°çš„åç§°,<br>3&gt;.è¿”å›å€¼ç±»å‹å°±æ˜¯å‚æ•°çš„ç±»å‹,(è¿”å›å€¼ç±»å‹åªèƒ½æ˜¯åŸºæœ¬ç±»å‹ã€Classã€Stringã€enum)<br>4&gt;.å¯ä»¥é€šè¿‡defaultæ¥å£°æ˜å‚æ•°çš„é»˜è®¤å€¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ä¿®é¥°ç¬¦ <span class="meta">@interface</span> æ³¨è§£å &#123;</span><br><span class="line">    æ³¨è§£å…ƒç´ çš„å£°æ˜<span class="number">1</span> </span><br><span class="line">    æ³¨è§£å…ƒç´ çš„å£°æ˜<span class="number">2</span></span><br><span class="line">    type <span class="title function_">elementName</span><span class="params">()</span>;</span><br><span class="line">    type <span class="title function_">elementName</span><span class="params">()</span> <span class="keyword">default</span> value;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Serviceçš„å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ElementType.TYPE ä»£è¡¨åœ¨ç±»ä¸Šä½¿ç”¨</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="comment">// RetentionPolicy.RUNTIME ä»£è¡¨è¿è¡Œæ—¶ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡åå°„è·å–åˆ°</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">//åŒ…å«åœ¨JavaDocä¸­</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="comment">//å…è®¸é€šè¿‡åŒ…æ‰«æçš„æ–¹å¼è‡ªåŠ¨æ£€æµ‹</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Service &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The value may indicate a suggestion for a logical component name,</span></span><br><span class="line"><span class="comment">	 * to be turned into a Spring bean in case of an autodetected component.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the suggested component name, if any (or empty String otherwise)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor(annotation = Component.class)</span></span><br><span class="line">	String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Annotationï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Annotation</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ‰€æœ‰æ³¨è§£</strong>ï¼Œ<strong>é»˜è®¤æ˜¯ä¸€ä¸ªå®ç°äº†Annotationæ¥å£çš„æ¥å£ã€‚</strong></p>
<h3 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h3><p>æ³¨è§£æ˜¯ä¸€ç§èƒ½è¢«æ·»åŠ åˆ°javaæºä»£ç ä¸­çš„å…ƒæ•°æ®ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‡è®°ï¼Œå¯ä»¥ç”¨åœ¨æ–¹æ³•ã€ç±»ã€å‚æ•°å’ŒåŒ…ä¸Šï¼Œç¨‹åºåœ¨ç¼–è¯‘æˆ–è€…è¿è¡Œæ—¶å¯ä»¥æ£€æµ‹åˆ°è¿™äº›æ ‡è®°è€Œè¿›è¡Œä¸€äº›ç‰¹æ®Šçš„å¤„ç†ã€‚</p>
<p>æ³¨è§£çš„åŸºæœ¬å…ƒç´ ï¼š</p>
<ul>
<li>ä¿®é¥°ç¬¦<br> è®¿é—®ä¿®é¥°ç¬¦å¿…é¡»ä¸ºpublic,ä¸å†™é»˜è®¤ä¸ºpubicï¼›</li>
<li>å…³é”®å­—<br> å…³é”®å­—ä¸º@interfaceï¼›</li>
<li>æ³¨è§£åç§°<br> æ³¨è§£åç§°ä¸ºè‡ªå®šä¹‰æ³¨è§£çš„åç§°ï¼Œä½¿ç”¨æ—¶è¿˜ä¼šç”¨åˆ°ï¼›</li>
<li>æ³¨è§£ç±»å‹å…ƒç´ <br> æ³¨è§£ç±»å‹å…ƒç´ æ˜¯æ³¨è§£ä¸­å†…å®¹ï¼Œå¯ä»¥ç†è§£æˆè‡ªå®šä¹‰æ¥å£çš„å®ç°éƒ¨åˆ†ï¼›</li>
</ul>
<p>ä½¿ç”¨å…ƒæ³¨è§£ä¿®é¥°æ³¨è§£ï¼š</p>
<p>@Targetï¼Œ@Retention,@Document,@Inheritedç”¨æ¥ä¿®é¥°æ³¨è§£ã€‚</p>
<p><strong>@Target</strong><br> è¡¨æ˜è¯¥æ³¨è§£å¯ä»¥åº”ç”¨çš„javaå…ƒç´ ç±»å‹ã€‚<br>ElementType.TYPE	åº”ç”¨äºç±»ã€æ¥å£ï¼ˆåŒ…æ‹¬æ³¨è§£ç±»å‹ï¼‰ã€æšä¸¾<br>ElementType.FIELD	åº”ç”¨äºå±æ€§ï¼ˆåŒ…æ‹¬æšä¸¾ä¸­çš„å¸¸é‡ï¼‰<br>ElementType.METHOD	åº”ç”¨äºæ–¹æ³•<br>ElementType.PARAMETER	åº”ç”¨äºæ–¹æ³•çš„å½¢å‚<br>ElementType.CONSTRUCTOR	åº”ç”¨äºæ„é€ å‡½æ•°<br>ElementType.LOCAL_VARIABLE	åº”ç”¨äºå±€éƒ¨å˜é‡<br>ElementType.ANNOTATION_TYPE	åº”ç”¨äºæ³¨è§£ç±»å‹<br>ElementType.PACKAGE	åº”ç”¨äºåŒ…<br>ElementType.TYPE_PARAMETER	1.8ç‰ˆæœ¬æ–°å¢ï¼Œåº”ç”¨äºç±»å‹å˜é‡<br>ElementType.TYPE_USE	1.8ç‰ˆæœ¬æ–°å¢ï¼Œåº”ç”¨äºä»»ä½•ä½¿ç”¨ç±»å‹çš„è¯­å¥ä¸­ï¼ˆä¾‹å¦‚å£°æ˜è¯­å¥ã€æ³›å‹å’Œå¼ºåˆ¶è½¬æ¢è¯­å¥ä¸­çš„ç±»å‹ï¼‰</p>
<p>@Retention<br>  è¡¨æ˜è¯¥æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ<br>RetentionPolicy.SOURCE	ç¼–è¯‘æ—¶è¢«ä¸¢å¼ƒï¼Œä¸åŒ…å«åœ¨ç±»æ–‡ä»¶ä¸­<br>RetentionPolicy.CLASS	JVMåŠ è½½æ—¶è¢«ä¸¢å¼ƒï¼ŒåŒ…å«åœ¨ç±»æ–‡ä»¶ä¸­ï¼Œé»˜è®¤å€¼<br>RetentionPolicy.RUNTIME	ç”±JVM åŠ è½½ï¼ŒåŒ…å«åœ¨ç±»æ–‡ä»¶ä¸­ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥è¢«è·å–åˆ°</p>
<p>@Document<br>  è¡¨æ˜è¯¥æ³¨è§£æ ‡è®°çš„å…ƒç´ å¯ä»¥è¢«Javadoc æˆ–ç±»ä¼¼çš„å·¥å…·æ–‡æ¡£åŒ–</p>
<p>@Inherited<br>  è¡¨æ˜ä½¿ç”¨äº†@Inheritedæ³¨è§£çš„æ³¨è§£ï¼Œæ‰€æ ‡è®°çš„ç±»çš„å­ç±»ä¹Ÿä¼šæ‹¥æœ‰è¿™ä¸ªæ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Info &#123;</span><br><span class="line">      String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;tracy&quot;</span>;</span><br><span class="line">      <span class="type">boolean</span> <span class="title function_">isDelete</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£"><a href="#ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£"></a>ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="comment">// ä¸ºPersonç±»é…ç½®äº†åˆšåˆšå®šä¹‰çš„æ³¨è§£@Info</span></span><br><span class="line"><span class="meta">@Info(isDelete = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åå°„è§£ææ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–Personçš„Classå¯¹è±¡(ç±»)</span></span><br><span class="line">            <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> Person.builder().build();</span><br><span class="line">            <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> person.getClass();</span><br><span class="line">            <span class="comment">//åˆ¤æ–­ç±»ä¸Šæ˜¯å¦æœ‰Infoæ³¨è§£</span></span><br><span class="line">            <span class="keyword">if</span> (clazz.isAnnotationPresent(Info.class)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Personç±»ä¸Šé…ç½®äº†Infoæ³¨è§£ï¼&quot;</span>);</span><br><span class="line">                <span class="comment">//è·å–è¯¥å¯¹è±¡ä¸ŠInfoç±»å‹çš„æ³¨è§£</span></span><br><span class="line">                <span class="type">Info</span> <span class="variable">infoAnno</span> <span class="operator">=</span> (Info) clazz.getAnnotation(Info.class);</span><br><span class="line">                System.out.println(<span class="string">&quot;infoAnno.value :&quot;</span> + infoAnno.value() + <span class="string">&quot;,infoAnno.isDelete:&quot;</span> + infoAnno.isDelete());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Personç±»ä¸Šæ²¡æœ‰é…ç½®Infoæ³¨è§£ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸€ä¸ªç±»æˆ–è€…æ¥å£æ¥è¯´ï¼ŒClassç±»(java.langåŒ…ä¸‹)ä¸­æä¾›äº†ä¸€äº›æ–¹æ³•ç”¨äºåå°„æ³¨è§£ï¼Œå½“ç„¶å¯¹äºå­—æ®µã€æ–¹æ³•æ¥è¯´åå°„æ³¨è§£çš„æ–¹å¼å¾ˆç±»ä¼¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›æŒ‡å®šçš„æ³¨è§£</span></span><br><span class="line">getAnnotation</span><br><span class="line"><span class="comment">//åˆ¤æ–­å½“å‰å…ƒç´ æ˜¯å¦è¢«æŒ‡å®šæ³¨è§£ä¿®é¥°</span></span><br><span class="line">isAnnotationPresent</span><br><span class="line"><span class="comment">//è¿”å›æ‰€æœ‰çš„æ³¨è§£</span></span><br><span class="line">getAnnotations</span><br></pre></td></tr></table></figure>

<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/zt15732625878/article/details/100061528">https://blog.csdn.net/zt15732625878/article/details/100061528</a></p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<h3 id="ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ä¾‹å­2"><a href="#ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ä¾‹å­2" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ä¾‹å­2"></a>ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ä¾‹å­2</h3><p>&lt;1&gt;.ä½œç”¨åœ¨å±æ€§ä¸Šæ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> FiledAnnotation &#123;</span><br><span class="line">	 String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;GetFiledAnnotation&quot;</span>;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&lt;2&gt;.ä½œç”¨åœ¨æ–¹æ³•ä¸Šæ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MethodAnnotation &#123;</span><br><span class="line">	String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;MethodAnnotation&quot;</span>;   </span><br><span class="line">    String <span class="title function_">url</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;https://www.cnblogs.com&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&lt;3&gt;.ä½œç”¨åœ¨ç±»ä¸Šæ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TypeAnnotation &#123;</span><br><span class="line">	String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;Is-TypeAnnotation&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&lt;4&gt;.ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TypeAnnotation(value = &quot;doWork&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Worker</span> &#123;</span><br><span class="line"><span class="meta">@FiledAnnotation(value = &quot;CSDNåšå®¢&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">myfield</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@MethodAnnotation()</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDefaultInfo</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;do the getDefaultInfo method&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@MethodAnnotation(name = &quot;ç™¾åº¦&quot;, url = &quot;www.baidu.com&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDefineInfo</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;do the getDefineInfo method&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&lt;5&gt;.æµ‹è¯•è‡ªå®šä¹‰æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	</span><br><span class="line">    <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zbz.annotation.pattern3.Worker&quot;</span>);</span><br><span class="line">    Method[] method = cls.getMethods();</span><br><span class="line">    <span class="comment">/**åˆ¤æ–­Workerç±»ä¸Šæ˜¯å¦æœ‰TypeAnnotationæ³¨è§£*/</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> cls.isAnnotationPresent(TypeAnnotation.class);</span><br><span class="line">    <span class="comment">/**è·å–Workerç±»ä¸Šæ˜¯TypeAnnotationæ³¨è§£å€¼*/</span></span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    	<span class="type">TypeAnnotation</span> <span class="variable">typeAnno</span> <span class="operator">=</span> (TypeAnnotation) cls.getAnnotation(TypeAnnotation.class);</span><br><span class="line">    	System.out.println(<span class="string">&quot;@TypeAnnotationå€¼:&quot;</span> + typeAnno.value());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**æ–¹æ³•ä¸Šæ³¨è§£*/</span></span><br><span class="line">    List&lt;Method&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Method&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; method.length; i++) &#123;</span><br><span class="line">        list.add(method[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (Method m : list) &#123;</span><br><span class="line">    	<span class="type">MethodAnnotation</span> <span class="variable">methodAnno</span> <span class="operator">=</span> m.getAnnotation(MethodAnnotation.class);</span><br><span class="line">        <span class="keyword">if</span> (methodAnno == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        System.out.println( <span class="string">&quot;æ–¹æ³•åç§°:&quot;</span> + m.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•ä¸Šæ³¨è§£name = &quot;</span> + methodAnno.name());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•ä¸Šæ³¨è§£url = &quot;</span> + methodAnno.url());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**å±æ€§ä¸Šæ³¨è§£*/</span></span><br><span class="line">    List&lt;Field&gt; fieldList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Field&gt;();  <span class="comment">//Fieldè¡¨ç¤ºå±æ€§</span></span><br><span class="line">    <span class="keyword">for</span> (Field f : cls.getDeclaredFields()) &#123;<span class="comment">// è®¿é—®æ‰€æœ‰å­—æ®µ</span></span><br><span class="line">    	<span class="type">FiledAnnotation</span> <span class="variable">filedAno</span> <span class="operator">=</span> f.getAnnotation(FiledAnnotation.class);</span><br><span class="line">    	System.out.println( <span class="string">&quot;å±æ€§åç§°:&quot;</span> + f.getName());</span><br><span class="line">    	System.out.println(<span class="string">&quot;å±æ€§æ³¨è§£å€¼FiledAnnotation = &quot;</span> + filedAno.value());</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/zhangbeizhen18/article/details/87885441/">https://blog.csdn.net/zhangbeizhen18/article/details/87885441/</a></p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<h3 id="ç†è§£"><a href="#ç†è§£" class="headerlink" title="ç†è§£"></a>ç†è§£</h3><p>è‡ªå®šä¹‰æ³¨è§£åƒæ˜¯ä¸ºç±»æˆ–è€…ä»€ä¹ˆçš„æ–°å¢åŠ äº†å±æ€§ï¼Œå¯ä»¥æœ‰é»˜è®¤å€¼ï¼Œé€šè¿‡ç±»å¯ä»¥è·å¾—ç±»ä¸Šçš„è‡ªå®šä¹‰æ³¨è§£ï¼Œç„¶åé€šè¿‡æ³¨è§£è·å¾—æ³¨è§£ä¸­çš„å€¼ã€‚æ³¨è§£ä¸æ˜¯å±äºå¯¹è±¡çš„ã€‚å®šä¹‰åœ¨å±æ€§ä¸Šçš„ï¼Œå¯ä»¥ç”¨å±æ€§æ³¨è§£æ¥åŒºåˆ«è¿™äº›å±æ€§ï¼Œç›¸å½“äºå±æ€§åçš„åˆ«åã€‚</p>
<h3 id="å…¶ä»–å‚è€ƒ"><a href="#å…¶ä»–å‚è€ƒ" class="headerlink" title="å…¶ä»–å‚è€ƒ"></a>å…¶ä»–å‚è€ƒ</h3><p>è‡ªå®šä¹‰æ³¨è§£+AOPï¼š<a href="https://zhuanlan.zhihu.com/p/283936459">https://zhuanlan.zhihu.com/p/283936459</a></p>
<p>ä½¿ç”¨æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼Œå®ç°é€šè¿‡æ³¨è§£æ¥å”¤é†’ä¸€ä¸ªç±»é‡Œæ–¹æ³•çš„æ•ˆæœï¼š</p>
<p><a href="https://www.jianshu.com/p/b5b79434d3b5">https://www.jianshu.com/p/b5b79434d3b5</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå¸¸è§„æ³¨è§£</title>
    <url>/2022/04/29/myblog/java/java%E5%B8%B8%E8%A7%84%E6%B3%A8%E8%A7%A3/</url>
    <content><![CDATA[<p>ä»JDK5å¼€å§‹,Javaå¢åŠ å¯¹å…ƒæ•°æ®çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯æ³¨è§£ï¼Œæ³¨è§£ä¸æ³¨é‡Šæ˜¯æœ‰ä¸€å®šåŒºåˆ«çš„ï¼Œå¯ä»¥æŠŠæ³¨è§£ç†è§£ä¸ºä»£ç é‡Œçš„ç‰¹æ®Šæ ‡è®°ï¼Œè¿™äº›æ ‡è®°å¯ä»¥åœ¨ç¼–è¯‘ï¼Œç±»åŠ è½½ï¼Œè¿è¡Œæ—¶è¢«è¯»å–ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„å¤„ç†ã€‚é€šè¿‡æ³¨è§£å¼€å‘äººå‘˜å¯ä»¥åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç å’Œé€»è¾‘çš„æƒ…å†µä¸‹åœ¨æºä»£ç ä¸­åµŒå…¥è¡¥å……ä¿¡æ¯ã€‚</p>
<p>æ‰€æœ‰çš„æ³¨è§£æœ¬è´¨ä¸Šéƒ½æ˜¯ç»§æ‰¿è‡ª Annotation æ¥å£ã€‚ä½†æ˜¯ï¼Œæ‰‹åŠ¨å®šä¹‰ä¸€ä¸ªæ¥å£ç»§æ‰¿ Annotation æ¥å£æ— æ•ˆçš„ï¼Œéœ€è¦é€šè¿‡ @interface å£°æ˜æ³¨è§£ï¼ŒAnnotation æ¥å£æœ¬èº«ä¹Ÿä¸å®šä¹‰æ³¨è§£ç±»å‹ï¼Œåªæ˜¯ä¸€ä¸ªæ™®é€šçš„æ¥å£ã€‚</p>
<h3 id="Pattern"><a href="#Pattern" class="headerlink" title="@Pattern"></a>@Pattern</h3><p>ç”¨æ¥é™å®šstringæ ¼å¼ï¼Œç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥é™å®šã€‚<br>éœ€è¦å¯¼å…¥validation-apiåŒ…ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Getter</span><br><span class="line">    @Setter</span><br><span class="line">    public static class StudentVO&#123;</span><br><span class="line">        @Pattern(regexp = &quot;^[A-Za-z]+$&quot;, message = &quot;åªèƒ½å­—æ¯&quot;)</span><br><span class="line">        private String name;</span><br><span class="line">        private Long age;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 åŒ¹é…é¦–å°¾ç©ºæ ¼çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š(^\s*)|(\s*$)</span><br><span class="line">  2 æ•´æ•°æˆ–è€…å°æ•°ï¼š^[0-9]+\.&#123;0,1&#125;[0-9]&#123;0,2&#125;$</span><br><span class="line">  3 åªèƒ½è¾“å…¥æ•°å­—ï¼š&quot;^[0-9]*$&quot;ã€‚</span><br><span class="line">  4 åªèƒ½è¾“å…¥nä½çš„æ•°å­—ï¼š&quot;^\d&#123;n&#125;$&quot;ã€‚</span><br><span class="line">  5 åªèƒ½è¾“å…¥è‡³å°‘nä½çš„æ•°å­—ï¼š&quot;^\d&#123;n,&#125;$&quot;ã€‚</span><br><span class="line">  6 åªèƒ½è¾“å…¥m~nä½çš„æ•°å­—ï¼šã€‚&quot;^\d&#123;m,n&#125;$&quot;</span><br><span class="line">  7 åªèƒ½è¾“å…¥é›¶å’Œéé›¶å¼€å¤´çš„æ•°å­—ï¼š&quot;^(0|[1-9][0-9]*)$&quot;ã€‚</span><br><span class="line">  8 åªèƒ½è¾“å…¥æœ‰ä¸¤ä½å°æ•°çš„æ­£å®æ•°ï¼š&quot;^[0-9]+(.[0-9]&#123;2&#125;)?$&quot;ã€‚</span><br><span class="line">  9 åªèƒ½è¾“å…¥æœ‰1~3ä½å°æ•°çš„æ­£å®æ•°ï¼š&quot;^[0-9]+(.[0-9]&#123;1,3&#125;)?$&quot;ã€‚</span><br><span class="line"> 10 åªèƒ½è¾“å…¥éé›¶çš„æ­£æ•´æ•°ï¼š&quot;^\+?[1-9][0-9]*$&quot;ã€‚</span><br><span class="line"> 11 åªèƒ½è¾“å…¥éé›¶çš„è´Ÿæ•´æ•°ï¼š&quot;^\-[1-9][]0-9&quot;*$ã€‚</span><br><span class="line"> 12 åªèƒ½è¾“å…¥é•¿åº¦ä¸º3çš„å­—ç¬¦ï¼š&quot;^.&#123;3&#125;$&quot;ã€‚</span><br><span class="line"> 13 åªèƒ½è¾“å…¥ç”±26ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š&quot;^[A-Za-z]+$&quot;ã€‚</span><br><span class="line"> 14 åªèƒ½è¾“å…¥ç”±26ä¸ªå¤§å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š&quot;^[A-Z]+$&quot;ã€‚</span><br><span class="line"> 15 åªèƒ½è¾“å…¥ç”±26ä¸ªå°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š&quot;^[a-z]+$&quot;ã€‚</span><br><span class="line"> 16 åªèƒ½è¾“å…¥ç”±æ•°å­—å’Œ26ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š&quot;^[A-Za-z0-9]+$&quot;ã€‚</span><br><span class="line"> 17 åªèƒ½è¾“å…¥ç”±æ•°å­—ã€26ä¸ªè‹±æ–‡å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²ï¼š&quot;^\w+$&quot;ã€‚</span><br><span class="line"> 18 éªŒè¯ç”¨æˆ·å¯†ç ï¼š&quot;^[a-zA-Z]\w&#123;5,17&#125;$&quot;æ­£ç¡®æ ¼å¼ä¸ºï¼šä»¥å­—æ¯å¼€å¤´ï¼Œé•¿åº¦åœ¨6~18ä¹‹é—´ï¼Œåªèƒ½åŒ…å«å­—ç¬¦ã€æ•°å­—å’Œä¸‹åˆ’çº¿ã€‚</span><br><span class="line"> 19 éªŒè¯æ˜¯å¦å«æœ‰^%&amp;&#x27;,;=?$\&quot;ç­‰å­—ç¬¦ï¼š&quot;[^%&amp;&#x27;,;=?$\x22]+&quot;ã€‚</span><br><span class="line"> 20 åªèƒ½è¾“å…¥æ±‰å­—ï¼š&quot;^[\u4e00-\u9fa5]&#123;0,&#125;$&quot;</span><br><span class="line"> 21 éªŒè¯Emailåœ°å€ï¼š&quot;^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$&quot;ã€‚</span><br><span class="line"> 22 éªŒè¯InternetURLï¼š&quot;^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$&quot;ã€‚</span><br><span class="line"> 23 éªŒè¯ç”µè¯å·ç ï¼š&quot;^(\(\d&#123;3,4&#125;-)|\d&#123;3.4&#125;-)?\d&#123;7,8&#125;$&quot;æ­£ç¡®æ ¼å¼ä¸ºï¼š&quot;XXX-XXXXXXX&quot;ã€&quot;XXXX-XXXXXXXX&quot;ã€&quot;XXX-XXXXXXX&quot;ã€&quot;XXX-XXXXXXXX&quot;ã€&quot;XXXXXXX&quot;å’Œ&quot;XXXXXXXX&quot;ã€‚</span><br><span class="line"> 24 éªŒè¯èº«ä»½è¯å·ï¼ˆ15ä½æˆ–18ä½æ•°å­—ï¼‰ï¼š&quot;^\d&#123;15&#125;|\d&#123;18&#125;$&quot;ã€‚</span><br><span class="line"> 25 éªŒè¯ä¸€å¹´çš„12ä¸ªæœˆï¼š&quot;^(0?[1-9]|1[0-2])$&quot;æ­£ç¡®æ ¼å¼ä¸ºï¼š&quot;01&quot;ï½&quot;09&quot;å’Œ&quot;1&quot;ï½&quot;12&quot;ã€‚</span><br><span class="line"> 26 éªŒè¯ä¸€ä¸ªæœˆçš„31å¤©ï¼š&quot;^((0?[1-9])|((1|2)[0-9])|30|31)$&quot;æ­£ç¡®æ ¼å¼ä¸ºï¼›&quot;01&quot;ï½&quot;09&quot;å’Œ&quot;1&quot;ï½&quot;31&quot;ã€‚</span><br><span class="line"> 27 åŒ¹é…ä¸­æ–‡å­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š [\u4e00-\u9fa5]</span><br><span class="line"> 28 åŒ¹é…åŒå­—èŠ‚å­—ç¬¦(åŒ…æ‹¬æ±‰å­—åœ¨å†…)ï¼š[^\x00-\xff]</span><br><span class="line"> 29 åº”ç”¨ï¼šè®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆä¸€ä¸ªåŒå­—èŠ‚å­—ç¬¦é•¿åº¦è®¡2ï¼ŒASCIIå­—ç¬¦è®¡1ï¼‰</span><br><span class="line"> 30 String.prototype.len=function()&#123;return this.replace(/[^\x00-\xff]/g,&quot;aa&quot;).length;&#125;</span><br><span class="line"> 31 åŒ¹é…ç©ºè¡Œçš„æ­£åˆ™è¡¨è¾¾å¼ï¼š\n[\s| ]*\r</span><br><span class="line"> 32 åŒ¹é…htmlæ ‡ç­¾çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š&lt;(.*)&gt;(.*)&lt;\/(.*)&gt;|&lt;(.*)\/&gt;</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq_36927265/article/details/87864026</span><br></pre></td></tr></table></figure>

<p>åœ¨controlå±‚ï¼Œå‰ç«¯è°ƒç”¨æ¥è¿›è¡Œæ•°æ®æ ¡éªŒã€‚</p>
<p>ä¸€ã€VOå¯¹è±¡å†…ç”¨@Patterné™å®šï¼Œcontrolæ–¹æ³•ä¸­ç”¨@Validæ£€æŸ¥ã€‚<br><a href="http://www.wpf123.com/post/97.html">http://www.wpf123.com/post/97.html</a></p>
<p>äºŒã€controlç±»ç”¨@Validatedæ³¨è§£ï¼Œæ–¹æ³•å†…Stringå‚æ•°ç”¨@Pattern</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@Validated</span><br><span class="line">class Controller &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@GetMapping</span><br><span class="line">public ResponseEntity&lt;List&lt;Permission&gt;&gt; query(</span><br><span class="line">    @RequestHeader(&quot;iv-user&quot;) String userId,</span><br><span class="line">        @Pattern(regexp = &quot;^accessor$&quot;, message = &quot;è¯·æ±‚å‚æ•°ä¸åˆæ³•&quot;)</span><br><span class="line">        @RequestParam(&quot;findBy&quot;) String accessor,</span><br><span class="line">        @RequestParam(&quot;accessorId&quot;) long accessorId)&#123;</span><br><span class="line">        //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="JSONField"><a href="#JSONField" class="headerlink" title="@JSONField"></a>@JSONField</h3><p>æ¥è‡ªfastjsonï¼Œfastjsonæ˜¯é˜¿é‡Œå·´å·´å‡ºå“çš„å¿«é€Ÿè§£æjsonçš„ä¸€ä¸ªå·¥å…·,</p>
<p>ä¸€ã€nameå±æ€§ï¼šç”¨æ¥æŒ‡å®šJSONä¸²ä¸­keyçš„åç§°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@JSONField(name = &quot;AGE&quot;)</span><br><span class="line">private String age;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä½œç”¨åœ¨setterã€getteræ–¹æ³•ä¸Šã€‚</p>
<p>äºŒã€formatè§„å®šæ—¥æœŸæ ¼å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@JSONField(format=&quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br><span class="line">private Date date;</span><br></pre></td></tr></table></figure>

<p>ä¸‰ã€ordinalï¼šè§„å®šå­—æ®µçš„é¡ºåº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@JSONField(ordinal = 3)</span><br><span class="line">private int f0;</span><br><span class="line"></span><br><span class="line">@JSONField(ordinal = 2)</span><br><span class="line">private int f1;</span><br><span class="line"></span><br><span class="line">@JSONField(ordinal = 1)</span><br><span class="line">private int f2;</span><br></pre></td></tr></table></figure>

<p>å››ã€serialize&#x2F;deserializeæŒ‡å®šå­—æ®µä¸åºåˆ—åŒ–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@JSONField(serialize=false)</span><br><span class="line">public Date date;</span><br></pre></td></tr></table></figure>

<p>äº”ã€<code>@JSONField(serializeUsing=xxx.class, deserializeUsing=xxx.class)</code><br>æŒ‡å®šåºåˆ—åŒ–å’Œååºåˆ—åŒ–å­—æ®µä½¿ç”¨çš„åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨ã€‚<br>éœ€è¦å®ç°<code>ObjectSerializer</code>æ¥å£ã€‚</p>
<h3 id="ToString"><a href="#ToString" class="headerlink" title="@ToString"></a>@ToString</h3><p>LomBokä¸­çš„æ³¨è§£ï¼Œç”¨æ¥ç®€åŒ–ä»£ç ã€‚</p>
<p>1.é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†æ‰“å°æ‰€æœ‰éé™æ€å­—æ®µã€‚<br>2.å¦‚æœè¦è·³è¿‡æŸäº›å­—æ®µï¼Œå¯ä»¥ç”¨æ³¨é‡Šè¿™äº›å­—æ®µ@ToString.Excludeã€‚<br>3.å¯ä»¥ä½¿ç”¨ç²¾ç¡®æŒ‡å®šè¦è¢«toStringæ–¹æ³•åŒ…å«çš„å­—æ®µï¼Œå…ˆè®¾ç½®@ToString(onlyExplicitlyIncluded &#x3D; true)ï¼Œç„¶åä½¿ç”¨@ToString.Includeæ ‡è®°æ¯ä¸ªè¦åŒ…å«çš„å­—æ®µã€‚<br>4.å¯ä»¥æ›´æ”¹ç”¨äºæ ‡è¯†æˆå‘˜çš„åç§°@ToString.Include(name &#x3D; â€œsome other nameâ€)ï¼Œnameç›¸å½“äºç»™å­—æ®µèµ·åˆ«åã€‚<br>5.å¯ä»¥é€šè¿‡æ›´æ”¹æˆå‘˜çš„æ‰“å°é¡ºåº@ToString.Include(rank &#x3D; 1)ã€‚rank è¡¨ç¤ºè¯¥å­—æ®µçš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§æ’åœ¨è¶Šå‰é¢ï¼Œé»˜è®¤ä¸º 0ï¼Œç­‰çº§ç›¸åŒçš„æˆå‘˜ä»¥å®ƒä»¬åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰“å°ã€‚</p>
<h3 id="CrossOrigin"><a href="#CrossOrigin" class="headerlink" title="@CrossOrigin"></a>@CrossOrigin</h3><p>å‡ºäºå®‰å…¨åŸå› ï¼Œæµè§ˆå™¨ç¦æ­¢Ajaxè°ƒç”¨é©»ç•™åœ¨å½“å‰åŸç‚¹ä¹‹å¤–çš„èµ„æºã€‚</p>
<p>è·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰æ˜¯ç”±å¤§å¤šæ•°æµè§ˆå™¨å®ç°çš„W3Cè§„èŒƒï¼Œå…è®¸æ‚¨çµæ´»åœ°æŒ‡å®šä»€ä¹ˆæ ·çš„è·¨åŸŸè¯·æ±‚è¢«æˆæƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€äº›ä¸å¤ªå®‰å…¨å’Œä¸å¤ªå¼ºå¤§çš„ç­–ç•¥ï¼Œå¦‚IFRAMEæˆ–JSONPã€‚</p>
<p>å‚æ•°ï¼š<br>originsï¼š å…è®¸å¯è®¿é—®çš„åŸŸåˆ—è¡¨<br>maxAge:å‡†å¤‡å“åº”å‰çš„ç¼“å­˜æŒç»­çš„æœ€å¤§æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</p>
<p>ç”¨æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@CrossOrigin(origins = &#123;&quot;http://domain2.com&quot;,&quot;ã€‚ã€‚ã€‚&quot;&#125;, maxAge = 3600)</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/account&quot;)</span><br><span class="line">public class AccountController &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    public Account retrieve(@PathVariable Long id) &#123;</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šï¼š<a href="https://cloud.tencent.com/developer/article/188106">https://cloud.tencent.com/developer/article/188106</a></p>
<h3 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h3><p>å¼€å‘restful APIæ—¶ï¼Œä¼šç”¨åˆ°ï¼Œ@RestController æ˜¯@controllerå’Œ@ResponseBody çš„ç»“åˆã€‚</p>
<p>@Controller å°†å½“å‰ä¿®é¥°çš„ç±»æ³¨å…¥Spring IOCå®¹å™¨ï¼Œä½¿å¾—ä»è¯¥ç±»æ‰€åœ¨çš„é¡¹ç›®è·‘èµ·æ¥çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªç±»å°±è¢«å®ä¾‹åŒ–ã€‚</p>
<p>@ResponseBody å®ƒçš„ä½œç”¨æ˜¯æŒ‡è¯¥ç±»ä¸­æ‰€æœ‰çš„APIæ¥å£è¿”å›çš„æ•°æ®ï¼Œç”­ç®¡ä½ å¯¹åº”çš„æ–¹æ³•è¿”å›Mapæˆ–æ˜¯å…¶ä»–Objectï¼Œå®ƒä¼šä»¥Jsonå­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<h3 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h3><p>@RequestMapping æ˜¯ Spring Web åº”ç”¨ç¨‹åºä¸­æœ€å¸¸è¢«ç”¨åˆ°çš„æ³¨è§£ä¹‹ä¸€ã€‚åœ¨Spring MVC ä¸­ä½¿ç”¨ @RequestMapping æ¥æ˜ å°„è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å®ƒæ¥æŒ‡å®šæ§åˆ¶å™¨å¯ä»¥å¤„ç†å“ªäº›URLè¯·æ±‚ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RestController  </span><br><span class="line">@RequestMapping(&quot;/home&quot;)  </span><br><span class="line">public class IndexController &#123;  </span><br><span class="line">    @RequestMapping(&quot;/&quot;)  </span><br><span class="line">    String get() &#123;  </span><br><span class="line">        //mapped to hostname:port/home/  </span><br><span class="line">        return &quot;go to home&quot;;  </span><br><span class="line">    &#125;  </span><br><span class="line">    @RequestMapping(&quot;/index&quot;)  </span><br><span class="line">    String index() &#123;  </span><br><span class="line">        //mapped to hostname:port/home/index/  </span><br><span class="line">        return &quot;go to index&quot;;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š<br><a href="https://www.jianshu.com/p/6f5aec232c97">https://www.jianshu.com/p/6f5aec232c97</a></p>
<p>âœ…RequestMappingå‚æ•°</p>
<p>1ï¼Œvalueï¼Œmethod<br>valueï¼šæŒ‡å®šè¯·æ±‚çš„å®é™…åœ°å€ï¼ŒæŒ‡å®šçš„åœ°å€å¯ä»¥æ˜¯URI Templateæ¨¡å¼ã€‚<br>methodï¼šæŒ‡å®šè¯·æ±‚çš„methodç±»å‹ï¼ŒGETã€POSTã€PUTã€DELETEç­‰ã€‚</p>
<p>2ï¼Œconsumesï¼Œproduces<br>consumesï¼šæŒ‡å®šå¤„ç†è¯·æ±‚çš„æäº¤å†…å®¹ç±»å‹ï¼ˆcontent-typeï¼‰ï¼Œä¾‹å¦‚application&#x2F;jsonï¼Œtext&#x2F;htmlã€‚<br>producesï¼šæŒ‡å®šè¿”å›çš„å†…å®¹ç±»å‹ï¼Œä»…å½“requestè¯·æ±‚å¤´ä¸­çš„ï¼ˆAcceptï¼‰ç±»å‹ä¸­åŒ…å«è¯¥æŒ‡å®šç±»å‹æ‰è¿”å›ã€‚ä¸ä½†å¯ä»¥è®¾ç½®è¿”å›å€¼ç±»å‹è¿˜å¯ä»¥è®¾å®šè¿”å›å€¼çš„å­—ç¬¦ç¼–ç ã€‚</p>
<p>3ï¼Œparamsï¼Œheaders<br>paramsï¼šæŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›å‚æ•°å€¼æ—¶ï¼Œæ‰è®©è¯¥æ–¹æ³•å¤„ç†ã€‚<br>headersï¼šæŒ‡å®šrequestä¸­å¿…é¡»åŒ…å«æŸäº›æŒ‡å®šçš„headerå€¼ï¼Œæ‰èƒ½è®©è¯¥æ–¹æ³•å¤„ç†è¯·æ±‚ã€‚</p>
<p>å‰åç«¯æ•°æ®jsonæ•°æ®ç±»å‹</p>
<p>1ï¼Œjsonå¯¹è±¡ç±»å‹ï¼Œå³å‰ç«¯å®šä¹‰çš„Content typeä¸ºapplication&#x2F;x-www-form-urlencodedç­‰ï¼Œåç«¯åº”ä½¿ç”¨@RequestParamæ³¨è§£æ¥æ”¶æ­¤ç±»å‹çš„jsonå‚æ•°ã€‚</p>
<p>2ï¼Œjsonå­—ç¬¦ä¸²ç±»å‹ï¼Œå³å‰ç«¯å®šä¹‰çš„Content typeä¸ºapplication&#x2F;jsonï¼Œåç«¯åº”ä½¿ç”¨@RequestBodyæ³¨è§£æ¥æ”¶jsonå‚æ•°ã€‚</p>
<p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/FlyGoldfish/articles/15649305.html">https://www.cnblogs.com/FlyGoldfish/articles/15649305.html</a></p>
<p>åœ¨Spring MVC ä¸­ä½¿ç”¨ @RequestMapping æ¥æ˜ å°„è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å®ƒæ¥æŒ‡å®šæ§åˆ¶å™¨å¯ä»¥å¤„ç†å“ªäº›URLè¯·æ±‚ï¼Œç›¸å½“äºServletä¸­åœ¨web.xmlä¸­é…ç½®</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/web&quot;)</span><br><span class="line">piblic class TestController &#123;</span><br><span class="line">    // æ–¹æ³•ä»…å¤„ç†è¯·æ±‚æ–¹å¼æ˜¯GETå’Œrequest Content-Typeä¸ºâ€œapplication/jsonâ€ç±»å‹çš„è¯·æ±‚</span><br><span class="line">    //æ™®é€šå‚æ•°ç”¨@RequestParam</span><br><span class="line">    @RequestMapping(value = &quot;/test1&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;, consumes = &quot;application/json&quot;)</span><br><span class="line">    public String test2(@RequestParam(&quot;id&quot;) String id)&#123;</span><br><span class="line">        return &quot;test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //å¯¹è±¡ç±»å‹ç”¨@RequestBody</span><br><span class="line">    @RequestMapping(value = &quot;/test2&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;, consumes = MediaType.APPLICATION_JSON_VALUE)</span><br><span class="line">    public String test2(@RequestBody VO vo)&#123;</span><br><span class="line">        return &quot;test&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æŒ‡å®šè¿”å›å€¼ç±»å‹ä¸ºjson</span><br><span class="line">    @RequestMapping(value = &quot;/list&quot; , method = RequestMethod.POST,produces=&quot;application/json&quot;)</span><br><span class="line">public JSONObject list(@PathVariable String communityId) &#123;</span><br><span class="line">   JSONObject object = new JSONObject();</span><br><span class="line">   object.put(&quot;communityId&quot;,communityId);</span><br><span class="line">   return object;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">    //@responseBodyå°±æ˜¯è¿”å›å€¼æ˜¯jsonæ•°æ®ï¼Œä½¿ç”¨@responseBodyï¼Œå°±å¯ä»¥çœç•¥produceså±æ€§</span><br><span class="line">    @RequestMapping(value = &quot;/list&quot; , method = RequestMethod.POST)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public JSONObject list(@PathVariable String communityId) &#123;</span><br><span class="line">    JSONObject object = new JSONObject();</span><br><span class="line">    object.put(&quot;communityId&quot;,communityId);</span><br><span class="line">    return object;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //è¿”å›å€¼æ˜¯jsonæ•°æ®ï¼Œå­—ç¬¦ç¼–ç ä¸ºutf-8</span><br><span class="line">    @RequestMapping(value = &quot;/list&quot; , method = RequestMethod.POST,produces=&quot;application/json;charset=utf-8&quot;)</span><br><span class="line">    public JSONObject list(@PathVariable String communityId) &#123;</span><br><span class="line">    JSONObject object = new JSONObject();</span><br><span class="line">    object.put(&quot;communityId&quot;,communityId);</span><br><span class="line">    return object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šç”¨æ³•ï¼š<a href="https://blog.csdn.net/weixin_46058921/article/details/122141863">https://blog.csdn.net/weixin_46058921/article/details/122141863</a></p>
<p>âœ…MediaType<br>consumeså‚æ•°ä¸­å¯ä»¥ç”¨çš„ã€‚</p>
<p>MediaTypeåª’ä½“ç±»å‹ï¼šå†³å®šæµè§ˆå™¨å°†ä»¥ä»€ä¹ˆå½¢å¼ã€ä»€ä¹ˆç¼–ç å¯¹èµ„æºè¿›è¡Œè§£æContent-Typeï¼šä¹Ÿå±äºMediaTypeåª’ä½“ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ¨è¯·æ±‚å¤´ä¸­æŒ‡å®šèµ„æºçš„MediaType</p>
<p><a href="https://javajgs.com/archives/75280">https://javajgs.com/archives/75280</a></p>
<p>âœ…RequestMappingã€GetMappingã€PostMappingçš„åŒºåˆ«</p>
<p>@RequestMappingæ˜¯ä¸€ä¸ªæ— æ–¹æ³•çš„æ³¨è§£ã€‚@GetMappingå’Œ@PostMappingæ˜¯ç»„åˆæ³¨è§£ï¼Œåˆ†åˆ«æ˜¯@RequestMapping(method &#x3D; RequestMethod.GET)å’Œ@RequestMapping(method &#x3D; RequestMethod.POST)çš„ç¼©å†™ã€‚<br>GETã€POSTæ˜¯æ–¹æ³•çš„æ˜ å°„ï¼Œè¡¨ç¤ºä¸º<br>@RequestMapping(method &#x3D; RequestMethod.${æ–¹æ³•})</p>
<p>åœ¨ä¸€å¼€å§‹çš„æ˜ å°„æ˜¯ä½¿ç”¨@RequestMapping(method &#x3D; RequestMethod.${æ–¹æ³•})æ¥è¡¨ç¤ºã€‚åæ¥Spring4.3ä¸­å¼•è¿›äº†@GetMappingã€@PostMappingã€@PutMappingã€@DeleteMappingã€@PatchMappingæ³¨è§£æ¥å¸®åŠ©ç®€åŒ–å¸¸ç”¨çš„HTTPæ–¹æ³•çš„æ˜ å°„ã€‚</p>
<h3 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h3><p>@RequestParamï¼šå°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°ä½ æ§åˆ¶å™¨çš„æ–¹æ³•å‚æ•°ä¸Šï¼ˆæ˜¯springmvcä¸­æ¥æ”¶æ™®é€šå‚æ•°çš„æ³¨è§£ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¯­æ³•ï¼šf(@RequestParam(value=â€å‚æ•°åâ€,required=â€true/falseâ€,defaultValue=â€â€) String s</span><br><span class="line">       , å…¶ä»–å…¥å‚ï¼‰</span><br><span class="line"> </span><br><span class="line">valueï¼šå‚æ•°å</span><br><span class="line"> </span><br><span class="line">requiredï¼šæ˜¯å¦åŒ…å«è¯¥å‚æ•°ï¼Œé»˜è®¤ä¸ºtrueï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚è·¯å¾„ä¸­å¿…é¡»åŒ…å«è¯¥å‚æ•°ï¼Œå¦‚æœä¸åŒ…å«å°±æŠ¥é”™ã€‚</span><br><span class="line"> </span><br><span class="line">defaultValueï¼šé»˜è®¤å‚æ•°å€¼ï¼Œå¦‚æœè®¾ç½®äº†è¯¥å€¼ï¼Œrequired=trueå°†å¤±æ•ˆï¼Œè‡ªåŠ¨ä¸ºfalse,å¦‚æœæ²¡æœ‰ä¼ è¯¥å‚æ•°ï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼</span><br></pre></td></tr></table></figure>

<p>âœ…@RequestParamå¦‚ä½•æ¥æ”¶Listå‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RequestMapping(value = &quot;hello&quot;, method = &#123;RequestMethod.POST&#125;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public boolean hello(@RequestParam(value = &quot;userIds&quot;) List&lt;Long&gt; userIds) &#123;</span><br><span class="line">   </span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>postmanä¼ å‚ï¼šç›´æ¥åœ¨Paramsä¸­åŠ ï¼š1,2,3</p>
<p>âš ï¸ï¼š@RequestBodyä¼ çš„voï¼Œå¹¶ä¸”æŒ‡æ˜ä¼ å…¥jsonæ ¼å¼ï¼ˆcontentTypeï¼‰ï¼Œæ”¾åœ¨body-rowä¸­ã€‚<br>ç”¨çš„æ˜¯@RequestParamä¼ å‚ï¼Œæ”¾åœ¨Paramsä¸­ï¼Œæ”¾åœ¨body-rowä¸­ç”¨jsonæ ¼å¼ä¸è¡Œã€‚æ”¾åœ¨Paramsä¸­ï¼Œç›¸å½“äºæ˜¯åŠ åœ¨urlåé¢ã€‚</p>
<p>âœ…@RequestParamå¦‚ä½•æ¥æ”¶Dateå‚æ•°</p>
<p>é¦–å…ˆå¼•å…¥joda-timeåŒ…ã€‚mavençš„dependencyï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> &lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;joda-time&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;joda-time&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨Controllerä»£ç é‡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public String testMethod(@RequestParam @DateTimeFormat(pattern=&quot;yyyy-MM-dd&quot;) Date testdate)&#123;</span><br><span class="line">    System.out.println(testDate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>postmanä¼ å‚ï¼šç›´æ¥2022-09-24 00:00:00</p>
<h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h3><p>@RequestBodyä¸»è¦ç”¨æ¥æ¥æ”¶å‰ç«¯ä¼ é€’ç»™åç«¯çš„jsonå­—ç¬¦ä¸²ä¸­çš„æ•°æ®çš„(è¯·æ±‚ä½“ä¸­çš„æ•°æ®çš„)ï¼Œå› æ­¤@RequestBodyåªèƒ½ç”¨äºæ¥æ”¶POSTè¯·æ±‚çš„å‚æ•°<br>@RequestParamæ¥æ”¶çš„æ˜¯key-valueé‡Œé¢çš„å‚æ•°(URLä¸­çš„å‚æ•°)ï¼Œé€šå¸¸ç”¨äºæ¥æ”¶GETè¯·æ±‚çš„å‚æ•°ï¼ˆPOSTä¹Ÿèƒ½æ¥æ”¶åªæ¥æ”¶URLé‡Œçš„ï¼Œè¯·æ±‚ä½“çš„æ¥æ”¶ä¸åˆ°ï¼‰</p>
<p>å³ï¼š<br>å¦‚æœå‚æ•°æ˜¯æ”¾åœ¨è¯·æ±‚ä½“VOä¸­ï¼Œä¼ å…¥åå°çš„è¯ï¼Œé‚£ä¹ˆåå°è¦ç”¨@RequestBodyæ‰èƒ½æ¥æ”¶åˆ°ï¼›<br>å¦‚æœä¸æ˜¯æ”¾åœ¨è¯·æ±‚ä½“ä¸­çš„è¯ï¼Œé‚£ä¹ˆåå°æ¥æ”¶å‰å°ä¼ è¿‡æ¥çš„å‚æ•°æ—¶ï¼Œè¦ç”¨@RequestParamæ¥æ¥æ”¶ã€‚</p>
<p>æ€»ç»“ï¼š<br>@RequestParamå’Œ@RequestBodyéƒ½èƒ½æ¥æ”¶Postæ–¹å¼è¯·æ±‚ä¼ æ¥çš„æ•°æ®ï¼Œä½†æ˜¯@RequestParamä¸èƒ½æ¥æ”¶jsonå­—ç¬¦ä¸²ï¼Œè€Œ@RequestBodyèƒ½ï¼Œ@RequestBodyä¸èƒ½æ¥æ”¶form-dataç±»å‹çš„å†…å®¹ï¼Œ@RequestParamèƒ½ã€‚<br>ä¸€ä¸ªè¯·æ±‚ï¼Œåªæœ‰ä¸€ä¸ªRequestBodyï¼›ä¸€ä¸ªè¯·æ±‚ï¼Œå¯ä»¥æœ‰å¤šä¸ªRequestParamã€‚<br>@ReuestBodyæ¥å—å•ä¸ªå‚æ•°çš„æ—¶å€™åªèƒ½å…ˆä½¿ç”¨Map&lt;String,Object&gt; paramsæ¥æ”¶,ç„¶åå†ä½¿ç”¨params.get(â€œnameâ€)è·å–å‚æ•°çš„å€¼ã€‚</p>
<p>æ›´å¤šï¼š<a href="https://blog.csdn.net/justry_deng/article/details/80972817">https://blog.csdn.net/justry_deng/article/details/80972817</a></p>
<h3 id="postmanä¸Šå¦‚ä½•è¯·æ±‚"><a href="#postmanä¸Šå¦‚ä½•è¯·æ±‚" class="headerlink" title="postmanä¸Šå¦‚ä½•è¯·æ±‚"></a>postmanä¸Šå¦‚ä½•è¯·æ±‚</h3><p>âœ…postè¯·æ±‚ï¼Œä¼ å‚æ˜¯listçš„è¯ï¼Œç”¨@RequestParamçš„è¯åªèƒ½æ”¾åœ¨urlåé¢ï¼Œé•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ã€‚ç”¨@RequestBodyæ˜¯æ”¾åœ¨bodyé‡Œã€‚</p>
<p>âœ…å…³äº@RequestParamä¼ å‚å’Œ@RequestBodyä¼ å‚ï¼Œåœ¨postmanä¸­å¦‚ä½•åŠ ï¼š<br>1ã€@RequestParamçš„å‚æ•°å¯ä»¥æ”¾åœ¨postmançš„paramä¸­ï¼ˆè·Ÿåœ¨urlåé¢ï¼‰ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨bodyé‡Œçš„form-dataé‡Œï¼ˆæ”¾åœ¨bodyé‡Œçš„ï¼‰ï¼Œä½†æ˜¯ä¸èƒ½æ”¾åœ¨bodyçš„rawé‡Œã€‚èƒ½æ”¾åœ¨å“ªé‡Œéœ€è¦çœ‹consumeå‚æ•°çš„MedisTypeï¼Œæƒ³æ”¾åœ¨form-dataé‡Œéœ€è¦è®¾ç½®MedisTypeä¸ºmultipart&#x2F;form-dataï¼Œæˆ–è€…ä¸è¦é™å®šä¸ºjsonã€‚<br>2ã€@RequestBodyçš„å‚æ•°æ”¾åœ¨bodyé‡Œçš„rawé‡Œæ ¼å¼ä¸ºjsonã€‚ä¸€èˆ¬ä¼ å¯¹è±¡voã€‚</p>
<p>âœ…RequestBodyä¼ mapå‹å‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@ResponseBody</span><br><span class="line">@PostMapping(&quot;/test&quot;)</span><br><span class="line">public String testMethod(@RequestBody Map&lt;String,String&gt; map)&#123;</span><br><span class="line">    System.out.println(testDate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>postmanå¦‚ä½•è¯·æ±‚ï¼š<br>1.è®¾ç½®è¯·æ±‚æ–¹å¼ä¸ºPost<br>2.åœ¨Headersä¸­æ·»åŠ Content-Typeï¼Œå€¼ä¸ºapplication&#x2F;json<br>3.åœ¨bodyä¸­é€‰æ‹©rowï¼Œé€‰æ‹©jsonæ•°æ®æ ¼å¼ï¼Œæœ€ååœ¨ä¸‹é¢ä»¥jsonçš„æ•°æ®æ ¼å¼å¡«å†™å‚æ•°</p>
<p>âœ…@RequestParamä¼ å‚ä»€ä¹ˆæ—¶å€™æ”¾åœ¨form-dataé‡Œï¼Œä»€ä¹ˆæ—¶å€™æ”¾åœ¨paramsé‡Œ</p>
<p>é•¿çš„è¯æ”¾åœ¨form-dataé‡Œï¼Œä¸æ˜¯è·Ÿåœ¨urlåçš„ã€‚å¦‚æœæ”¾åœ¨paramsé‡Œå°±æ˜¯è·Ÿåœ¨urlåé¢çš„ã€‚</p>
<h3 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a>@ResponseBody</h3><p>@ResponseBody æ³¨è§£çš„ä½œç”¨æ˜¯å°†Controllerçš„æ–¹æ³•è¿”å›çš„å¯¹è±¡ï¼Œé€šè¿‡é€‚å½“çš„è½¬æ¢å™¨è½¬æ¢ä¸ºæŒ‡å®šçš„æ ¼å¼ä¹‹åï¼Œå†™å…¥åˆ°responseå¯¹è±¡çš„bodyåŒºï¼Œé€šå¸¸ç”¨æ¥è¿”å›JSONæ•°æ®æˆ–è€…æ˜¯XMLæ•°æ®ã€‚</p>
<p>@ResponseBodyçš„ä½œç”¨å…¶å®æ˜¯å°†javaå¯¹è±¡è½¬ä¸ºjsonæ ¼å¼çš„æ•°æ®ï¼Œç„¶åç›´æ¥å†™å…¥HTTP response çš„bodyä¸­ï¼›ä¸€èˆ¬åœ¨å¼‚æ­¥è·å–æ•°æ®æ—¶ä½¿ç”¨</p>
<p>@ResponseBody æ˜¯ä½œç”¨åœ¨æ–¹æ³•ä¸Šçš„</p>
<p>æ›´å¤šï¼š<a href="https://blog.csdn.net/weixin_47609799/article/details/124843709">https://blog.csdn.net/weixin_47609799/article/details/124843709</a></p>
<h3 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h3><p>lombokä¸­çš„æ³¨è§£ã€‚<br>Builder ä½¿ç”¨åˆ›å»ºè€…æ¨¡å¼åˆå«å»ºé€ è€…æ¨¡å¼ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸€æ­¥æ­¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯¹ç”¨æˆ·å±è”½äº†é‡Œé¢æ„å»ºçš„ç»†èŠ‚ï¼Œä½†å´å¯ä»¥ç²¾ç»†åœ°æ§åˆ¶å¯¹è±¡çš„æ„é€ è¿‡ç¨‹ã€‚</p>
<p>@Builderæ³¨è§£çš„ä½œç”¨ä¸»è¦æ˜¯ç”¨æ¥ç”Ÿæˆå¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥ä¸ºå¯¹è±¡é“¾å¼èµ‹å€¼ã€‚æ”¾åœ¨å®ä½“ç±»ä¸Šã€‚<br>â€‹@Builderâ€‹â€‹æ³¨é‡Šä¸ºä½ çš„ç±»ç”Ÿæˆç›¸å¯¹ç•¥å¾®å¤æ‚çš„æ„å»ºå™¨APIã€‚</p>
<p>ä½¿ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Student student = Student.builder()</span><br><span class="line">        .name( &quot;admin&quot; )</span><br><span class="line">        .age( 18 )</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<p>ä¸@Singularç»“åˆä½¿ç”¨<br>ä½¿ç”¨@Singularæ³¨é‡Šæ³¨é‡Šä¸€ä¸ªé›†åˆå­—æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Singular</span><br><span class="line">private List&lt;String&gt; hobbies;</span><br><span class="line"></span><br><span class="line">.hobbies( &quot;110&quot; ).hobbies( &quot;112&quot; )</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/g56467467464/article/details/105407741">https://blog.csdn.net/g56467467464/article/details/105407741</a></p>
<h3 id="TableName"><a href="#TableName" class="headerlink" title="@TableName"></a>@TableName</h3><p>baomidou.mybatisplusçš„æ³¨è§£<br>@TableNameæ˜¯mybatis-plusä¸­çš„æ³¨è§£ï¼Œä¸»è¦æ˜¯å®ç°å®ä½“ç±»å‹å’Œæ•°æ®åº“ä¸­çš„è¡¨å®ç°æ˜ å°„ã€‚<br>æ”¾åœ¨å®ä½“ç±»DOä¸Šã€‚</p>
<p>è™½ç„¶åŠŸèƒ½ç›¸åŒï¼Œä½†æ˜¯ï¼Œ@TableNameæ˜¯mybatis-plusä¸­çš„æ³¨è§£ï¼Œ@Tableæ˜¯Hibernateä¸­çš„æ³¨è§£ã€‚</p>
<h3 id="Param"><a href="#Param" class="headerlink" title="@Param"></a>@Param</h3><p>1 ã€@Paramæ³¨è§£çš„ä½œç”¨æ˜¯ç»™å‚æ•°å‘½å,å‚æ•°å‘½ååå°±èƒ½æ ¹æ®åå­—å¾—åˆ°å‚æ•°å€¼,æ­£ç¡®çš„å°†å‚æ•°ä¼ å…¥sqlè¯­å¥ä¸­ï¼ˆä¸€èˆ¬é€šè¿‡#{}çš„æ–¹å¼ï¼Œ${}ä¼šæœ‰sqlæ³¨å…¥çš„é—®é¢˜ï¼‰ã€‚<br>2ã€ä¸€èˆ¬å†™åœ¨mappeæ¥å£ï¼ˆDAOæ¥å£ï¼‰çš„å…¥å‚ï¼Œå¯¹åº”xmlä¸­#{}ä¸­çš„å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨æ–¹æ³•ï¼š</span><br><span class="line">Mapperæ¥å£æ–¹æ³•ï¼š</span><br><span class="line">public int findById(@Param(&quot;userId&quot;) int userId);</span><br><span class="line">å¯¹åº”çš„xmlæ–‡ä»¶ï¼š</span><br><span class="line"> &lt;select id=&quot;findById&quot; resultMap=&quot;baseMap&quot;&gt;</span><br><span class="line">    select &lt;include redif=&quot;all_column_list&quot;&gt; from table_name</span><br><span class="line">    where user_id = #&#123;userId&#125;</span><br><span class="line"> &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸ä½¿ç”¨@Paramæ³¨è§£æ—¶ï¼Œå‚æ•°åªèƒ½æœ‰ä¸€ä¸ªï¼Œå¹¶ä¸”æ˜¯Javabeanã€‚</p>
<p>ä½¿ç”¨äº†@Paramåï¼Œå¯ä»¥ä¸ç”¨parameterTypeï¼Ÿ å­˜ç–‘</p>
<h3 id="Mapper"><a href="#Mapper" class="headerlink" title="@Mapper"></a>@Mapper</h3><p>åœ¨ä½¿ç”¨MybatisæŒä¹…å±‚æ¡†æ¶æ¥æ“ä½œæ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Mapperæ³¨è§£å’Œ@MapperScanæ³¨è§£æ¥å°†Mapperæ¥å£ç±»äº¤ç»™Sprinigè¿›è¡Œç®¡ç†ã€‚</p>
<p>ç›®çš„å°±æ˜¯ä¸ºäº†ä¸å†å†™mapperæ˜ å°„æ–‡ä»¶ï¼ˆxmlæ–‡ä»¶ï¼‰ã€‚</p>
<p>Spring Bootçš„æ ¸å¿ƒç†å¿µæ˜¯ï¼šä¸å»ºè®®ä½¿ç”¨xmlæ–‡ä»¶é…ç½®ã€‚ä½†æ˜¯ï¼Œè¿™å¯¹MyBatisæ¥è¯´è¿›é€€ä¸¤éš¾ï¼Œå› ä¸ºMyBatisç¦»ä¸å¼€xmlï¼Œéœ€è¦xmlæ¥é…ç½®sqlè¯­å¥ã€‚ä¸ºäº†è¿åˆSpring Bootçš„å‘å±•ç†å¿µï¼ŒMyBatiså®˜æ–¹å¼€å‘äº†mybatis-spring-boot-starterï¼Œæˆ‘ä»¬è¦æƒ³æ›´å°‘çš„ä¾èµ–xmlï¼Œéœ€è¦æ·±å…¥çš„ç ”ç©¶mybatis-spring-boot-starterä¸­çš„ç”¨æ³•ï¼Œå°¤å…¶æ˜¯@MapperScanå’Œ@Mapperçš„ç”¨æ³•ã€‚</p>
<p>ä¸€ã€æ³¨è§£@Mapperï¼Œè¿™ç§æ–¹å¼è¦æ±‚æ¯ä¸€ä¸ªMapperç±»éƒ½éœ€è¦æ·»åŠ æ­¤æ³¨è§£<br>åœ¨æ¥å£ç±»ä¸Šæ·»åŠ äº†@Mapperï¼Œåœ¨ç¼–è¯‘ä¹‹åä¼šç”Ÿæˆç›¸åº”çš„æ¥å£å®ç°ç±»</p>
<p>äºŒã€@MapperScanæ³¨è§£ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä¸ç”¨ä¸ºæ¯ä¸ªMapperç±»éƒ½æ·»åŠ @Mapperæ³¨è§£ã€‚æŒ‡å®šè¦å˜æˆå®ç°ç±»çš„æ¥å£æ‰€åœ¨çš„åŒ…<br>æ·»åŠ ä½ç½®ï¼šæ˜¯åœ¨Springbootå¯åŠ¨ç±»ä¸Šé¢æ·»åŠ ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@SpringBootApplication  </span><br><span class="line">@MapperScan(&#123;&quot;cn.mybatis.mappers.class&quot;,&quot;cn.mybatis.mappers.student&quot;&#125;)  </span><br><span class="line">public class SpringbootMybatisDemoApplication&#123;  </span><br><span class="line">    public static void main(String[] args) &#123;  </span><br><span class="line">       SpringApplication.run(SpringbootMybatisDemoApplication.class, args);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆå®ç°ï¼šç›´æ¥åœ¨Mapperç±»ä¸­é‡‡ç”¨æ³¨è§£çš„å½¢å¼æ“ä½œæ•°æ®åº“ï¼Œé€šè¿‡@MapperScanæ‰«æåˆ¶å®šçš„æ˜ å°„å™¨å­˜æ”¾è·¯å¾„ï¼Œæœ€ç»ˆä¸éœ€è¦åŠ ä»»ä½•æ³¨è§£ï¼Œä¹Ÿä¸éœ€è¦å¯¹åº”çš„xmlæ–‡ä»¶æ¥é…ç½®sqlè¯­å¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ä¸éœ€è¦åŠ ä»»ä½•æ³¨è§£ï¼Œä¹Ÿä¸éœ€è¦å¯¹åº”çš„xmlæ–‡ä»¶</span><br><span class="line">public interface UserMapper&#123;</span><br><span class="line">     @Select(&quot;select * from user&quot;)</span><br><span class="line">     List&lt;User&gt; getUserList(String userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="http://www.mybatis.cn/archives/862.html">http://www.mybatis.cn/archives/862.html</a></p>
<h3 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h3><p>@PostContructæ˜¯Javaè‡ªå¸¦çš„æ³¨è§£ï¼Œåœ¨æ–¹æ³•ä¸ŠåŠ è¯¥æ³¨è§£ä¼šåœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºåœ¨springå®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œè¯¥æ–¹æ³•ã€‚å¯ä½œä¸ºä¸€äº›æ•°æ®çš„å¸¸è§„åŒ–åŠ è½½ï¼Œæ¯”å¦‚æ•°æ®å­—å…¸ä¹‹ç±»çš„ã€‚</p>
<p>ä»Java EE5è§„èŒƒå¼€å§‹ï¼ŒServletä¸­å¢åŠ äº†ä¸¤ä¸ªå½±å“Servletç”Ÿå‘½å‘¨æœŸçš„æ³¨è§£ï¼Œ@PostConstructå’Œ@PreDestroyï¼Œè¿™ä¸¤ä¸ªæ³¨è§£è¢«ç”¨æ¥ä¿®é¥°ä¸€ä¸ªéé™æ€çš„voidï¼ˆï¼‰æ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@PostConstruct</span><br><span class="line">public void someMethod()&#123;&#125;</span><br><span class="line"></span><br><span class="line">public @PostConstruct void someMethod()&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œæ—¶æœºï¼šåœ¨ä¾èµ–æ³¨å…¥å®Œæˆåè¢«è‡ªåŠ¨è°ƒç”¨ã€‚åœ¨æœåŠ¡å™¨åŠ è½½Servletçš„æ—¶å€™è¿è¡Œï¼Œå¹¶ä¸”åªä¼šè¢«æœåŠ¡å™¨æ‰§è¡Œä¸€æ¬¡ã€‚PostConstructåœ¨æ„é€ å‡½æ•°ä¹‹åæ‰§è¡Œï¼Œinitï¼ˆï¼‰æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚<br>Constructor &gt;&gt; @Autowired &gt;&gt; @PostConstruct &gt;&gt; init &gt;&gt; service &gt;&gt; destroy &gt;&gt; PreDestroy</p>
<p>è¯¥æ³¨è§£ä¸BeanPostProcessoræ¥å£æœ‰å…³ï¼Œå®ƒæœ‰ä¸ªå®ç°ç±»CommonAnnotationBeanPostProcessorï¼Œå°±æ˜¯ä¸“é—¨å¤„ç†@PostConstruct  @PreDestroyæ³¨è§£ã€‚</p>
<hr>
<p>InitialzingBeanæ¥å£çš„afterPropertiesSetå’Œé…ç½®beanæ—¶çš„init-methodï¼Œä¹Ÿæœ‰ç±»ä¼¼åŠŸèƒ½ã€‚</p>
<p>initMethodå’ŒInitializingBeanæ˜¯springæä¾›çš„ä¸¤ç§å¯¹ç±»çš„å±æ€§è¿›è¡Œè£…é…çš„æ–¹å¼ã€‚initMethodå’ŒInitializingBeanæŒ‡å®šæ–¹æ³•çš„æ‰§è¡Œé¡ºåºåœ¨æ™®é€šå±æ€§è£…é…ä¹‹åï¼ŒinitMethodæŒ‡å®šçš„æ–¹æ³•åˆåœ¨InitializingBeanæŒ‡å®šçš„æ–¹æ³•ä¹‹åæ‰§è¡Œã€‚</p>
<p>ä¸‰è€…æ‰§è¡Œé¡ºåºï¼šConstruction &gt; å¯¹è±¡å±æ€§set() æ–¹æ³•-&gt; @PostConstruct -&gt; InitializingBean -&gt; initMethod</p>
<p>æ€»ç»“ï¼šå¯ä¸å¯ä»¥ç†è§£ä¸º@PostConstructåœ¨åˆå§‹åŒ–è‡ªå·±beanæ—¶ï¼Œä¾èµ–æ³¨å…¥å…¶ä»–å±æ€§beanåæ‰§è¡Œï¼Œè€ŒInitialzingBeanæ¥å£åˆæ˜¯åœ¨å®ƒåé¢ã€‚</p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/chinawangfei/article/details/122825129">https://blog.csdn.net/chinawangfei/article/details/122825129</a></p>
<h3 id="Deprecated"><a href="#Deprecated" class="headerlink" title="@Deprecated"></a>@Deprecated</h3><p>@Deprecatedæ˜¯javaå†…ç½®æ³¨è§£ï¼Œæ­¤æ³¨è§£å¯ä»¥ç”¨åœ¨æ–¹æ³•ï¼Œå±æ€§ï¼Œç±»ä¸Šï¼Œè¡¨ç¤ºå·²åºŸå¼ƒï¼Œä¸ç»´æŠ¤ï¼Œå¯èƒ½ä¼šåˆ é™¤ã€‚<br>è¡¨ç¤ºä¸æ¨èç¨‹åºå‘˜ä½¿ç”¨ï¼Œä½†æ˜¯è¿˜å¯ä»¥ä½¿ç”¨ã€‚</p>
<h3 id="Valid"><a href="#Valid" class="headerlink" title="@Valid"></a>@Valid</h3><p>ç”¨äºå¯¹è±¡å±æ€§å­—æ®µçš„è§„åˆ™æ£€æµ‹ï¼Œä¸ºäº†é¿å…ä½¿ç”¨å†—ä½™çš„ä»£ç è¿›è¡Œifåˆ¤æ–­ï¼Œä½¿ç”¨@Validæ³¨è§£å®ç°ã€‚</p>
<p>æ˜¯Springä¸­çš„æ³¨è§£ï¼Œéœ€è¦å¼•å…¥ä¾èµ–ï¼Œå¦‚æœæ˜¯ springboot é¡¹ç›®ï¼Œé‚£ä¹ˆå¯ä»¥ä¸ç”¨å¼•å…¥äº†ï¼Œå·²ç»å¼•å…¥äº†ï¼Œå°±å­˜åœ¨äºæœ€æ ¸å¿ƒçš„ web å¼€å‘åŒ… spring-boot-starter-web é‡Œé¢ã€‚</p>
<p>å¦‚æœä¸æ˜¯ï¼Œéœ€è¦å¼•å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.validation&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;validation-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1.0.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"> </span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.hibernate&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.1.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ–¹æ³•ï¼šåœ¨è¢«æ£€éªŒçš„å®ä½“ç±»ä¸­ï¼Œä½¿ç”¨æ³¨è§£åŠ ä¸€äº›é™åˆ¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@NotBlank(message = &quot;è¯·è¾“å…¥åç§°&quot;)</span><br><span class="line">@Length(message = &quot;åç§°ä¸èƒ½è¶…è¿‡ä¸ª &#123;max&#125; å­—ç¬¦&quot;, max = 10)</span><br><span class="line">public String name;</span><br><span class="line"> </span><br><span class="line">@NotNull(message = &quot;è¯·è¾“å…¥å¹´é¾„&quot;)</span><br><span class="line">@Range(message = &quot;å¹´é¾„èŒƒå›´ä¸º &#123;min&#125; åˆ° &#123;max&#125; ä¹‹é—´&quot;, min = 1, max = 100)</span><br><span class="line">public Integer age;</span><br><span class="line"></span><br><span class="line">@Email(message = &quot;é‚®ç®±ä¸æ­£ç¡®&quot;)</span><br><span class="line">@Min(value = 1000000)</span><br><span class="line"></span><br><span class="line">@NotEmpty(message=&quot;ä¸èƒ½ä¸ºç©º&quot;)</span><br><span class="line">@Size(message=&quot;æœ€å¤š5ä¸ª&quot;, max=5)</span><br><span class="line">private List&lt;Intefer&gt; list;</span><br></pre></td></tr></table></figure>

<p>åœ¨Controllerçš„å¯¹åº”æ–¹æ³•ä¸­ï¼Œå¯¹ä¼ å…¥å‚æ•°åŠ @Validæ³¨è§£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@PostMapping(&quot;/action/register&quot;)</span><br><span class="line">public Result registerByForm(@Valid @RequestBody RegisterUser registerUser)&#123;</span><br><span class="line">    return userService.register(registerUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/weixin_43587472/article/details/110388778">https://blog.csdn.net/weixin_43587472/article/details/110388778</a></p>
<h3 id="Transactionalæ³¨è§£"><a href="#Transactionalæ³¨è§£" class="headerlink" title="@Transactionalæ³¨è§£"></a>@Transactionalæ³¨è§£</h3><p>springframeworkä¸­çš„æ³¨è§£ã€‚<br>å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œæ˜¯å»ºç«‹åœ¨AOPä¹‹ä¸Šï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹æ–¹æ³•å‰åè¿›è¡Œæ‹¦æˆªï¼Œç„¶åå†ç›®æ ‡æ–¹æ³•å¼€å§‹ä¹‹å‰åˆ›å»ºæˆ–åŠ å…¥ä¸€ä¸ªä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œå®Œç›®æ ‡æ–¹æ³•ä¹‹åï¼Œæ ¹æ®æ‰§è¡Œæƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚</p>
<p>ç®€è€Œè¨€ä¹‹ï¼š@Transactionalæ³¨è§£åœ¨ä»£ç æ‰§è¡Œå‡ºé”™æ—¶è¿›è¡Œäº‹åŠ¡çš„å›æ»šã€‚</p>
<p>javaå¼‚å¸¸æ¨¡å‹ï¼š<br>Throwableæ˜¯æœ€é¡¶å±‚çš„çˆ¶ç±»ï¼Œæœ‰Errorå’ŒExceptionä¸¤ä¸ªå­ç±»ã€‚<br>Errorè¡¨ç¤ºä¸¥é‡çš„é”™è¯¯ï¼ˆå¦‚OOMç­‰ï¼‰ï¼›<br>Exceptionå¯ä»¥åˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionåŠå…¶å­ç±»ï¼‰å’Œéè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆExceptionçš„å­ç±»ä¸­ï¼Œé™¤äº†RuntimeExceptionåŠå…¶å­ç±»ä¹‹å¤–çš„ç±»ï¼‰ã€‚</p>
<p>éè¿è¡Œæ—¶å¼‚å¸¸æ˜¯æ£€æŸ¥å¼‚å¸¸ï¼ˆchecked exceptionsï¼‰ï¼Œä¸€å®šè¦try catchï¼Œå› ä¸ºè¿™ç±»å¼‚å¸¸æ˜¯å¯é¢„æ–™çš„ï¼Œç¼–è¯‘é˜¶æ®µå°±æ£€æŸ¥çš„å‡ºæ¥ï¼›<br>Errorå’Œè¿è¡Œæ—¶å¼‚å¸¸æ˜¯éæ£€æŸ¥å¼‚å¸¸ï¼ˆunchecked exceptionsï¼‰ï¼Œä¸éœ€è¦try catchï¼Œå› ä¸ºè¿™ç±»å¼‚å¸¸æ˜¯ä¸å¯é¢„æ–™çš„ï¼Œç¼–è¾‘é˜¶æ®µä¸ä¼šæ£€æŸ¥ï¼Œæ²¡å¿…è¦æ£€æŸ¥ï¼Œä¹Ÿæ£€æŸ¥ä¸å‡ºæ¥ã€‚</p>
<p>springçš„@Transactionalæ³¨è§£å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¼€å¯äº‹åŠ¡ï¼Œä½†æ˜¯é»˜è®¤åªåœ¨é‡åˆ°è¿è¡Œæ—¶å¼‚å¸¸å’ŒErroræ—¶æ‰ä¼šå›æ»šï¼Œéè¿è¡Œæ—¶å¼‚å¸¸ä¸å›æ»šï¼Œå³Exceptionçš„å­ç±»ä¸­ï¼Œé™¤äº†RuntimeExceptionåŠå…¶å­ç±»ï¼Œå…¶ä»–çš„ç±»é»˜è®¤ä¸å›æ»šã€‚</p>
<p>è€ŒrollbackForå±æ€§å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒrollbackFor &#x3D; Exception.classè¡¨ç¤ºExceptionåŠå…¶å­ç±»çš„å¼‚å¸¸éƒ½ä¼šè§¦å‘å›æ»šï¼ŒåŒæ—¶ä¸å½±å“Errorçš„å›æ»šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ­£å¸¸å›æ»š</span><br><span class="line">@Transactional</span><br><span class="line">public void save()&#123;</span><br><span class="line">    StudentDO studentDO = new StudentDO();</span><br><span class="line">    studentDO.setName(&quot;ltm&quot;);</span><br><span class="line">    studentDO.setAge(22);</span><br><span class="line">    studentMapper.insert(studentDO);</span><br><span class="line">    throw new RuntimeException(&quot;æˆ‘æ˜¯å¼‚å¸¸&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// éè¿è¡Œæ—¶å¼‚å¸¸ï¼ŒåŠ rollbackForå±æ€§ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶å›æ»š</span><br><span class="line">@Transactional(rollbackFor = Exception.class)</span><br><span class="line">public void save() throws IOException&#123;</span><br><span class="line">    StudentDO studentDO = new StudentDO();</span><br><span class="line">    studentDO.setName(&quot;ltm&quot;);</span><br><span class="line">    studentDO.setAge(22);</span><br><span class="line">    studentMapper.insert(studentDO);</span><br><span class="line">    throw new IOException();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.jianshu.com/p/c5988db897fc">https://www.jianshu.com/p/c5988db897fc</a></p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š<br>1.éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableTransactionManagementæ³¨è§£ã€‚<br>2.å½“ä½œç”¨åœ¨ç±»ä¸Šï¼Œè¯¥ç±»æ‰€ä»¥publicæ–¹æ³•éƒ½å…·æœ‰è¯¥ç±»å‹çš„äº‹åŠ¡å±æ€§ã€‚ä¹Ÿå¯ä»¥åŠ åœ¨publicæ–¹æ³•ä¸Šã€‚</p>
<p><a href="https://blog.51cto.com/u_9177933/2978291">https://blog.51cto.com/u_9177933/2978291</a></p>
<h3 id="SneakyThrows"><a href="#SneakyThrows" class="headerlink" title="@SneakyThrows"></a>@SneakyThrows</h3><p>âœ…javaçš„å¼‚å¸¸ä½“ç³»</p>
<p><img src="/images/java%E5%BC%82%E5%B8%B8.png"></p>
<p>Erroræ˜¯ç¼–è¯‘æ—¶é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯ï¼Œç³»ç»Ÿé”™è¯¯åœ¨é™¤ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œéƒ½ä¸éœ€è¦ä½ æ¥å…³å¿ƒï¼ŒåŸºæœ¬ä¸ä¼šå‡ºç°ã€‚è€Œç¼–è¯‘æ—¶é”™è¯¯ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ç¼–è¯‘å™¨ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šæç¤ºã€‚</p>
<p>Exceptionåˆ™æ˜¯å¯ä»¥è¢«æŠ›å‡ºçš„åŸºæœ¬ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸»è¦å…³å¿ƒçš„ä¹Ÿæ˜¯è¿™ä¸ªç±»ã€‚<br>Exceptionåˆåˆ†ä¸ºRunTimeExceptionå’Œå…¶ä»–Exceptionã€‚</p>
<p>RunTimeExceptionï¼šè¿è¡Œæ—¶å¼‚å¸¸ï¼Œåˆç§°ä¸å—æ£€æŸ¥å¼‚å¸¸ï¼Œä¸å—æ£€æŸ¥ï¼Œå› ä¸ºä¸å—æ£€æŸ¥ï¼Œæ‰€ä»¥åœ¨ä»£ç ä¸­å¯èƒ½ä¼šæœ‰RunTimeExceptionæ—¶Javaç¼–è¯‘æ£€æŸ¥æ—¶ä¸ä¼šå‘Šè¯‰ä½ æœ‰è¿™ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯åœ¨å®é™…è¿è¡Œä»£ç æ—¶åˆ™ä¼šæš´éœ²å‡ºæ¥ï¼Œæ¯”å¦‚ç»å…¸çš„1&#x2F;0ï¼Œç©ºæŒ‡é’ˆç­‰ã€‚å¦‚æœä¸å¤„ç†ä¹Ÿä¼šè¢«Javaè‡ªå·±å¤„ç†ã€‚</p>
<p>å…¶ä»–Exceptionï¼Œå—æ£€æŸ¥å¼‚å¸¸ã€‚å¯ä»¥ç†è§£ä¸ºé”™è¯¯ï¼Œå¿…é¡»è¦å¼€å‘è€…è§£å†³ä»¥åæ‰èƒ½ç¼–è¯‘é€šè¿‡ï¼Œè§£å†³çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œ<br>1ï¼šthrowåˆ°ä¸Šå±‚ï¼Œ<br>2ï¼Œtry-catchå¤„ç†ã€‚</p>
<p>âœ…@SneakyThrowsçš„ä½œç”¨ï¼š<br>æ™®é€šExceptionç±»,ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å—æ£€å¼‚å¸¸æˆ–è€…Checked Exceptionä¼šå¼ºåˆ¶è¦æ±‚æŠ›å‡ºå®ƒçš„æ–¹æ³•å£°æ˜throwsï¼Œè°ƒç”¨è€…å¿…é¡»æ˜¾ç¤ºçš„å»å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†æé†’å¼€å‘è€…å¤„ç†ä¸€äº›åœºæ™¯ä¸­å¿…ç„¶å¯èƒ½å­˜åœ¨çš„å¼‚å¸¸æƒ…å†µã€‚æ¯”å¦‚ç½‘ç»œå¼‚å¸¸é€ æˆIOExceptionã€‚</p>
<p>ä½†æ˜¯ç°å®å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¸€è·¯å¾€å¤–æŠ›äº†äº‹ã€‚æ‰€ä»¥æ¸æ¸çš„javaç¨‹åºå‘˜å¤„ç†Exceptionçš„å¸¸è§æ‰‹æ®µå°±æ˜¯å¤–é¢åŒ…ä¸€å±‚RuntimeExceptionï¼Œæ¥ç€å¾€ä¸Šä¸¢.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try&#123;</span><br><span class="line">&#125;catch(Exception e)&#123;</span><br><span class="line">throw new RuntimeException(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€ŒLombokçš„@SneakyThrowså°±æ˜¯ä¸ºäº†æ¶ˆé™¤è¿™æ ·çš„æ¨¡æ¿ä»£ç ã€‚<br>ä½¿ç”¨æ³¨è§£åä¸éœ€è¦æ‹…å¿ƒExceptionçš„å¤„ç†.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"> import lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line">public class SneakyThrowsExample implements Runnable &#123;</span><br><span class="line">  @SneakyThrows(UnsupportedEncodingException.class)</span><br><span class="line">  public String utf8ToString(byte[] bytes) &#123;</span><br><span class="line">    return new String(bytes, &quot;UTF-8&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  @SneakyThrows</span><br><span class="line">  public void run() &#123;</span><br><span class="line">    throw new Throwable();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸç†ï¼šæœ€é‡è¦çš„æ˜¯throw (T)t, ä½¿ç”¨æ³›å‹,å°†ä¼ å…¥çš„Throwableå¼ºè½¬ä¸ºRuntimeExceptionå¼‚å¸¸.<br>è™½ç„¶, æˆ‘ä»¬æŠ›å‡ºçš„å¼‚å¸¸ä¸æ˜¯RuntimeException,ä½†æ˜¯å¯ä»¥éª—è¿‡javacç¼–è¯‘å™¨,æ³›å‹æœ€åå­˜å‚¨ä¸ºå­—èŠ‚ç æ–‡ä»¶æ—¶å¹¶æ²¡æœ‰æ³›å‹ä¿¡æ¯.</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_22162093/article/details/115486647">https://blog.csdn.net/qq_22162093/article/details/115486647</a></p>
<h3 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h3><p>@Dataæ³¨è§£æ˜¯lombok.jaråŒ…ä¸‹çš„æ³¨è§£ï¼Œè¯¥æ³¨è§£é€šå¸¸ç”¨åœ¨å®ä½“beanä¸Šï¼Œä¸éœ€è¦å†™å‡ºsetå’Œgetæ–¹æ³•ï¼Œä½†æ˜¯å…·å¤‡å®ä½“beanæ‰€å…·å¤‡çš„æ–¹æ³•ï¼Œç®€åŒ–ç¼–ç¨‹æé«˜å˜æˆé€Ÿåº¦ã€‚</p>
<p>@Dataç›¸å½“äº@Getter @Setter @RequiredArgsConstructor @ToString @EqualsAndHashCodeè¿™5ä¸ªæ³¨è§£çš„åˆé›†ã€‚</p>
<p>@Data ï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›ç±»çš„getã€setã€equalsã€hashCodeã€toStringç­‰æ–¹æ³•<br>@AllArgsConstructor ï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›ç±»çš„å…¨å‚æ„é€ <br>@NoArgsConstructor ï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›ç±»çš„æ— å‚æ„é€ <br>@Setter ï¼šæ³¨åœ¨å±æ€§ä¸Šï¼Œæä¾› set æ–¹æ³•<br>@Getter ï¼šæ³¨åœ¨å±æ€§ä¸Šï¼Œæä¾› get æ–¹æ³•<br>@EqualsAndHashCode ï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›å¯¹åº”çš„ equals å’Œ hashCode æ–¹æ³•<br>@Log4j&#x2F;@Slf4j ï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›å¯¹åº”çš„ Logger å¯¹è±¡ï¼Œå˜é‡åä¸º log</p>
<h3 id="RequiredArgsConstructor"><a href="#RequiredArgsConstructor" class="headerlink" title="@RequiredArgsConstructor"></a>@RequiredArgsConstructor</h3><p>lombokä¸­çš„æ³¨è§£ã€‚å¯ç”¨äºç”Ÿæˆæœ‰å‚æ„é€ å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ–¹ä¾¿åœ¨å†™controlleræˆ–è€…Serviceå±‚çš„æ—¶å€™ï¼Œéœ€è¦æ³¨å…¥å¾ˆå¤šçš„mapperæ¥å£æˆ–è€…å¦å¤–çš„serviceæ¥å£çš„æ—¶å€™å°±é¿å…ä¼šå†™å¾ˆå¤šçš„@Autowiredæ³¨è§£ã€‚</p>
<p>å®ä½“ç±»æœ‰å‚æ„é€ å‡½æ•°ï¼š<br>å¿…é¡»å£°æ˜çš„å˜é‡ä¸ºfinal</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">@ToString</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">static class Person &#123;</span><br><span class="line">    private final String name;</span><br><span class="line">    private final Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@RequiredArgsConstructor(onConstructor &#x3D;@_(@Autowired))<br>å†™åœ¨ç±»ä¸Šå¯ä»¥ä»£æ›¿@Autowiredæ³¨è§£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨æ³¨å…¥æ—¶éœ€è¦ç”¨finalå®šä¹‰ï¼Œæˆ–è€…ä½¿ç”¨@notnullæ³¨è§£.<br>å½“æˆ‘ä»¬éœ€è¦æ³¨å…¥Beançš„æ—¶å€™å¯ä»¥ç›´æ¥åœ¨ç±»åç§°ä¸Šä½¿ç”¨ã€‚ä»£æ›¿äº†Autowritedæ³¨è§£.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/v1/demo&quot;)</span><br><span class="line">@RequiredArgsConstructor(onConstructor = @__(@Autowired))</span><br><span class="line">public class DemoController &#123;</span><br><span class="line">    private final DemoService demoService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="SuppressWarnings"><a href="#SuppressWarnings" class="headerlink" title="@SuppressWarnings"></a>@SuppressWarnings</h3><p>ä½œç”¨ï¼šæŠ‘åˆ¶ç¼–è¯‘å™¨è­¦å‘Šï¼Œæœ‰æ—¶å€™å¯ä»¥çœ‹åˆ°ideaä¸­æœ‰è­¦å‘Šçš„é¢œè‰²æ ‡æ³¨ï¼Œå½“æˆ‘ä»¬ä¸å¸Œæœ›çœ‹åˆ°è¿™äº›è­¦å‘Šçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ SuppressWarningsæ³¨è§£æ¥æŠ‘åˆ¶è­¦å‘Šä¿¡æ¯ã€‚<br>åœ¨<code>&#123;&quot; &quot;&#125; </code>ä¸­ï¼Œå¯ä»¥å†™å…¥ä½ å¸Œæœ›æŠ‘åˆ¶(ä¸æ˜¾ç¤º)è­¦å‘Šä¿¡æ¯ã€‚</p>
<p>ä¾‹å¦‚ï¼š<br><code>@SuppressWarnings&#123;&quot;rawtypes&quot;, &quot;unchecked&quot;, &quot;unused&quot;&#125;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">allï¼ŒæŠ‘åˆ¶æ‰€æœ‰è­¦å‘Š</span><br><span class="line">boxingï¼ŒæŠ‘åˆ¶ä¸å°è£…/æ‹†è£…ä½œä¸šç›¸å…³çš„è­¦å‘Š</span><br><span class="line">castï¼ŒæŠ‘åˆ¶ä¸å¼ºåˆ¶è½¬å‹ä½œä¸šç›¸å…³çš„è­¦å‘Š</span><br><span class="line">dep-annï¼ŒæŠ‘åˆ¶ä¸æ·˜æ±°æ³¨é‡Šç›¸å…³çš„è­¦å‘Š</span><br><span class="line">deprecationï¼ŒæŠ‘åˆ¶ä¸æ·˜æ±°çš„ç›¸å…³è­¦å‘Š</span><br><span class="line">fallthroughï¼ŒæŠ‘åˆ¶ä¸switché™ˆè¿°å¼ä¸­é—æ¼breakç›¸å…³çš„è­¦å‘Š</span><br><span class="line">finallyï¼ŒæŠ‘åˆ¶ä¸æœªä¼ å›finallyåŒºå—ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">hidingï¼ŒæŠ‘åˆ¶ä¸éšè—å˜æ•°çš„åŒºåŸŸå˜æ•°ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">incomplete-switchï¼ŒæŠ‘åˆ¶ä¸switché™ˆè¿°å¼(enum case)ä¸­é—æ¼é¡¹ç›®ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">javadocï¼ŒæŠ‘åˆ¶ä¸javadocç›¸å…³çš„è­¦å‘Š</span><br><span class="line">nlsï¼ŒæŠ‘åˆ¶ä¸énlså­—ä¸²æ–‡å­—ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">nullï¼ŒæŠ‘åˆ¶ä¸ç©ºå€¼åˆ†æç›¸å…³çš„è­¦å‘Š</span><br><span class="line">rawtypesï¼ŒæŠ‘åˆ¶ä¸ä½¿ç”¨rawç±»å‹ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">resourceï¼ŒæŠ‘åˆ¶ä¸ä½¿ç”¨Closeableç±»å‹çš„èµ„æºç›¸å…³çš„è­¦å‘Š</span><br><span class="line">restrictionï¼ŒæŠ‘åˆ¶ä¸ä½¿ç”¨ä¸å»ºè®®æˆ–ç¦æ­¢å‚ç…§ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">serialï¼ŒæŠ‘åˆ¶ä¸å¯åºåˆ—åŒ–çš„ç±»åˆ«é—æ¼serialVersionUIDæ ä½ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">static-accessï¼ŒæŠ‘åˆ¶ä¸é™æ€å­˜å–ä¸æ­£ç¡®ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">static-methodï¼ŒæŠ‘åˆ¶ä¸å¯èƒ½å®£å‘Šä¸ºstaticçš„æ–¹æ³•ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">superï¼ŒæŠ‘åˆ¶ä¸ç½®æ¢æ–¹æ³•ç›¸å…³ä½†ä¸å«superå‘¼å«çš„è­¦å‘Š</span><br><span class="line">synthetic-accessï¼ŒæŠ‘åˆ¶ä¸å†…éƒ¨ç±»åˆ«çš„å­˜å–æœªæœ€ä½³åŒ–ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">sync-overrideï¼ŒæŠ‘åˆ¶å› ä¸ºç½®æ¢åŒæ­¥æ–¹æ³•è€Œé—æ¼åŒæ­¥åŒ–çš„è­¦å‘Š</span><br><span class="line">uncheckedï¼ŒæŠ‘åˆ¶ä¸æœªæ£€æŸ¥çš„ä½œä¸šç›¸å…³çš„è­¦å‘Š</span><br><span class="line">unqualified-field-accessï¼ŒæŠ‘åˆ¶ä¸æ ä½å­˜å–ä¸åˆæ ¼ç›¸å…³çš„è­¦å‘Š</span><br><span class="line">unusedï¼ŒæŠ‘åˆ¶ä¸æœªç”¨çš„ç¨‹å¼ç åŠåœç”¨çš„ç¨‹å¼ç ç›¸å…³çš„è­¦å‘Š</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/qq_41684621/article/details/123807986">https://blog.csdn.net/qq_41684621/article/details/123807986</a></p>
<p>âœ…<code>Raw use of parameterized class</code> å‚æ•°åŒ–ç±»å‹çš„åŸå§‹ä½¿ç”¨</p>
<p>æŒ‡å‡ºçœç•¥äº†ç±»å‹çš„å‚æ•°åŒ–ç±»çš„ä½¿ç”¨ã€‚è¿™ç§å¯¹å‚æ•°åŒ–ç±»å‹çš„åŸå§‹ä½¿ç”¨åœ¨Javaä¸­æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯ä¼šç ´åä½¿ç”¨ç±»å‹å‚æ•°çš„ç›®çš„ï¼Œå¹¶å¯èƒ½æ©ç›–é”™è¯¯ã€‚æ­¤æ£€æŸ¥åæ˜ äº†ç¼–è¯‘é˜¶æ®µå¯¹åŸå§‹ç±»å‹çš„è­¦å‘Šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List list = new ArrayList(); //ä¸æŒ‡å®šèŒƒå‹ï¼Œé»˜è®¤ä¸ºObjectç±»å‹</span><br><span class="line">list.add(&quot;123&quot;);</span><br><span class="line">list.add(1L);</span><br><span class="line">list.add(0.11d);</span><br><span class="line">// å¯ä»¥è¿™æ ·æ„é€ listï¼Œä½†æ˜¯ä¸‹é¢è½¬ç±»å‹ä¼šå‡ºé”™ï¼Œä¸èƒ½å§Stringç±»å‹è½¬ä¸ºdoubleã€‚</span><br><span class="line">//java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Double</span><br><span class="line">for (Object o : list) &#123;</span><br><span class="line">    double a = (double) o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å°±æ˜¯ç›´æ¥ä½¿ç”¨åŸç”Ÿæ€ç±»å‹çš„å®ç°ï¼Œåœ¨ç¼–è¯‘æ—¶æœŸä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦è¿è¡Œå°±ä¼šæŠ¥é”™ï¼šException in thread â€œmainâ€ java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Doubleï¼Œä»£ç è®¾è®¡åº”è¯¥ä½¿é”™è¯¯å°½æ—©è¢«å‘ç°ï¼Œè€Œè¿™å°±æ˜¯ä¸å®‰å…¨çš„è¡¨ç°äº†ï¼Œè€Œä¸”å¯è¯»æ€§è€Œè¨€ï¼Œç¼ºå°‘äº†å½¢å¼ç±»å‹å‚æ•°ï¼Œæˆ‘ä»¬å¾ˆéš¾æ˜ç™½Listå­˜å‚¨çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œè¡¨è¿°æ€§å˜å·®ã€‚</p>
<p>å¦‚æœç¡®å®šä½¿ç”¨æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šåœ¨è¿è¡Œæ—¶å€™å¯¼è‡´é”™è¯¯ï¼Œåˆ™å¯é€šè¿‡ <code>@SuppressWarnings(&quot;rawtypes&quot;)</code>æ¶ˆé™¤ä½¿ç”¨åŸç”Ÿæ€ç±»å‹è­¦å‘Šã€‚</p>
<p>å‚è€ƒï¼š<a href="https://cloud.tencent.com/developer/article/1677759">https://cloud.tencent.com/developer/article/1677759</a></p>
<p>âœ…<code>Unchecked call to ... </code> è°ƒç”¨æœªç»æ£€æŸ¥</p>
<p>æ¯”å¦‚ä¸Šé¢addçš„æ—¶å€™å°±ä¼šæç¤ºï¼Œè¡¨ç¤ºæœªæ£€æŸ¥addçš„å‚æ•°çš„ç±»å‹ï¼Œå› ä¸ºå®šä¹‰listçš„æ—¶å€™æ²¡æŒ‡å®šç±»å‹ï¼Œå¦‚æœæŒ‡å®šç±»å‹å°±ä¸æŠ¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå¸¸è§„</title>
    <url>/2022/04/30/myblog/java/java%E5%B8%B8%E8%A7%84/</url>
    <content><![CDATA[<h3 id="è§„èŒƒ"><a href="#è§„èŒƒ" class="headerlink" title="è§„èŒƒ"></a>è§„èŒƒ</h3><p>1ã€sqlï¼ˆdaoå±‚ï¼‰è¿”å›çš„ï¼Œå°½é‡ä¸è¦ç”¨VOï¼Œè€Œä½¿ç”¨DOã€‚é™¤éè”è¡¨æŸ¥è¯¢ï¼Ÿdaoå±‚æŸ¥å‡ºæ¥çš„doéœ€è¦åŠ å…¶ä»–è¡¨çš„ä¸€ä¸¤ä¸ªå­—æ®µï¼Œå¯ä»¥åœ¨åŸè¡¨doçš„åŸºç¡€ä¸Šç»§æ‰¿å°è£…ä¸€ä¸‹ï¼Œå¦‚æœè¦ä¼ å…¥ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å­ç±»ï¼Œdaoå±‚å¤„ç†æ—¶ä¼šè‡ªåŠ¨è§£æä¸ºçˆ¶ç±»ã€‚</p>
<p>2ã€serviceé‡Œé¢ä¸è¦è°ƒä¸æƒ³å¹²çš„daoå±‚æ–¹æ³•ï¼Œè€Œæ˜¯è°ƒdaoæ‰€åœ¨serviceçš„æ–¹æ³•ã€‚</p>
<p>3ã€ç»§æ‰¿è‡ªåŒä¸€æŠ½è±¡ç±»çš„ç±»æ–¹æ³•ï¼Œéœ€è¦å¯¹åŒä¸€è¿”å›å¤„ç†ï¼Œå¹¶ä¸”æ˜¯ä¸²è¡Œçš„ï¼Œå¯ä»¥è¾“å…¥ä¸­ç”¨contextã€‚</p>
<p>4ã€mainæ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼ŒåŒä¸€ä¸ªç±»å†…çš„æ–¹æ³•å¾—åŠ staticï¼Œä¸ç„¶å°±æ˜¯æˆå‘˜æ–¹æ³•ï¼Œæˆå‘˜æ–¹æ³•æ— æ³•åœ¨é™æ€æ–¹æ³•ä¸­è°ƒç”¨ã€‚</p>
<p>5ã€è¿è¡Œæ—¶å¼‚å¸¸æ¯”å¦‚NPEï¼Œåœ¨æ–¹æ³•é‡Œthrowï¼Œä¸éœ€è¦åœ¨æ–¹æ³•ä¸Šthrowäº†ï¼Œå¹¶ä¸”é‡Œé¢æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¯ä»¥åœ¨å¤–é¢æ–¹æ³•å¯ä»¥catchåˆ°ã€‚</p>
<p>6ã€å†™serviceä»€ä¹ˆæ—¶å€™å†™æˆç±»ï¼Œä»€ä¹ˆæ—¶å€™å†™æˆæ¥å£ï¼Ÿ å¦‚æœå¯¹å¤–çš„è¯å°±å†™æ¥å£ï¼Œå¦‚æœå†…éƒ¨ä»£ç ç”¨ï¼Œå°±serviceç±»å°±è¡Œã€‚</p>
<p>7ã€nullä¸èƒ½ç”¨æ¥åšæ¯”è¾ƒï¼Œä¼šæŠ¥NPEï¼Œä¾‹å¦‚ï¼š1 &#x3D;&#x3D; nullï¼Œä¸è¡Œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Integer s1 = null;</span><br><span class="line">if(s1 == 1) System.out.println(&quot;ä¸å¯¹&quot;);  //æŠ¥NPE</span><br><span class="line">Integer s1 = 3;</span><br><span class="line">if(null == s1) System.out.println(&quot;å¯¹&quot;); //å¯¹çš„</span><br><span class="line">String s1 = null;</span><br><span class="line">if(s1 == &quot;a&quot;) System.out.println(&quot;å¯¹&quot;); //Stringä¸ä¼šNPE</span><br></pre></td></tr></table></figure>

<p>8ã€å¦‚æœç±»æŠ¥çº¢ï¼Œæ²¡æœ‰å¼•ç”¨åˆ°ï¼Œå°è¯•æ›´æ–°ä¸‹ä»“åº“ï¼šç‚¹ideaå³è¾¹mavenï¼Œç‚¹å·¦ä¸Šè§’æ›´æ–°åœˆï¼Œæ›´æ–°ä¸€ä¸‹ã€‚å¦‚æœè¿˜ä¸è¡Œï¼Œçœ‹ä¸€ä¸‹mavençš„settingæ–‡ä»¶å¯¹ä¸å¯¹ã€‚</p>
<p>9ã€ifã€whileã€forå…³é”®è¯çš„åé¢å’Œæ‹¬å·ä¹‹é—´è¦æœ‰ç©ºæ ¼ï¼ŒHashMap&lt;Integer, Integer&gt;å’Œå˜é‡åä¹‹é—´è¦æœ‰ç©ºæ ¼ã€‚<br>æ–¹æ³•ååé¢åˆ°å…¥å‚çš„æ‹¬å·ä¸éœ€è¦ç©ºæ ¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for (int i = 0; i &lt; 3; i++) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public voif func(Integer i) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>10ã€ä¸è¦åœ¨ä»£ç ä¸­ï¼Œç‰¹åˆ«æ˜¯ä¸»çº¿ç¨‹ä¸­éšä¾¿Thread.sleepï¼Œè¿™æ ·ä¼šé˜»å¡ä½çº¿ç¨‹ã€‚</p>
<p>11ã€æ–¹æ³•è¿”å›å¦‚æœæ˜¯åŒ…è£…ç±»å‹Doubleç­‰ï¼Œå¦‚æœç”¨doubleæ¥ï¼Œæ˜¯æ¥ä¸ä½nullçš„ï¼Œä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p>
<p>12ã€booleanè¿™ç§ç±»å‹ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡çš„å‚æ•°ï¼Œåˆå§‹åŒ–å¯¹è±¡æ—¶ï¼Œä¼šç»™ä¸€ä¸ªé»˜è®¤å€¼falseï¼Œä½†æ˜¯å•ç‹¬åˆå§‹åŒ–booleanç±»å‹ï¼Œéœ€è¦ç»™å€¼ï¼Œä¸èƒ½boolean b;</p>
<p>13ã€é…ç½®å¯ä»¥å†™åœ¨ä¸€ä¸ªæ¥å£é‡Œ XXXInstanceï¼Œå¯ä»¥è¿™ä¹ˆå–åï¼Œç›´æ¥åŠ ç±»å‹å°±è¡Œï¼Œä¸ç”¨public staticã€‚è°ƒç”¨çš„æ—¶å€™å°± XXXInstance.SSSã€‚</p>
<h3 id="è®¿é—®æƒé™"><a href="#è®¿é—®æƒé™" class="headerlink" title="è®¿é—®æƒé™"></a>è®¿é—®æƒé™</h3><p>privateï¼šä»…é™ç±»æœ¬èº«å¯è§<br>defaultï¼šç±»å†…éƒ¨ã€åŒ…è®¿é—®æƒé™<br>protectedï¼šç±»å†…éƒ¨ã€åŒä¸€ä¸ªåŒ…ã€å­ç±»ä¸­è®¿é—®<br>publicï¼šç±»å†…éƒ¨ã€åŒä¸€ä¸ªåŒ…ã€å­ç±»ã€ä»»æ„ä½ç½®éƒ½èƒ½è®¿é—®</p>
<h3 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h3><p>âœ…java: Compilation failed:</p>
<p>æŠ¥é”™åŸå› ï¼š<br>é¡¹ç›®ä¸­Javaç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå¯ä»¥æŸ¥çœ‹é¡¹ç›®ä¸­çš„jdké…ç½®.<br>1ã€æŸ¥çœ‹é¡¹ç›®çš„jdk<br>File -&gt;Project Structure-&gt;Project Settings -&gt;Project </p>
<p>2ã€æŸ¥çœ‹å·¥ç¨‹çš„jdk<br>File -&gt;Project Structure-&gt;Project Settings -&gt; Modules -&gt; ï¼ˆéœ€è¦ä¿®æ”¹çš„å·¥ç¨‹åç§°ï¼‰ -&gt; Sources -&gt;</p>
<p>3ã€æŸ¥çœ‹ideaä¸­Javaé…ç½®<br>compile çš„ java compileä¸­ã€‚</p>
<p>âœ…ç©ºæŒ‡é’ˆNPE</p>
<p>ç©ºæŒ‡é’ˆ(Null Pointer Exceptionï¼ŒNPE)<br>ç©ºæŒ‡é’ˆå¼‚å¸¸å±äºè¿è¡Œæ—¶çš„å¼‚å¸¸ã€‚å½“Javaå°è¯•å»è°ƒç”¨çœŸå®å¯¹è±¡ä¸Šçš„ä»»ä½•æ–¹æ³•æ—¶ï¼Œå¦‚æœåœ¨è¿è¡Œæ—¶ä¸­ï¼Œè¯¥å¯¹è±¡è°ƒç”¨çš„æ˜¯ç©ºå¼•ç”¨(Null Reference)ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚<br>ç”±äºç§ç§åŸå› ï¼Œå¼€å‘äººå‘˜æ—¶å¸¸ä¼šå¿˜è®°åˆå§‹åŒ–å¯¹è±¡å’ŒéªŒè¯å¯¹è±¡ã€‚è¿™å¾€å¾€æ˜¯å¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸çš„æ ¹æºã€‚<br>ä¾‹å¦‚ï¼šå¯¹ä¸€ä¸ªä¸ºnullçš„å¯¹è±¡è°ƒç”¨get&#x2F;setæ–¹æ³•ï¼Œå°±ä¼šNPEã€‚</p>
<p>ğŸ¤”Optionalé¿å…ç©ºæŒ‡é’ˆ<br>java.util.Optional æ˜¯java8ä¸­å¼•è¿›çš„ä¸€ä¸ªæ–°çš„ç±»ï¼Œå®ƒå¯ä»¥å¯¹å¯èƒ½ç¼ºå¤±çš„å€¼è¿›è¡Œå»ºæ¨¡ï¼Œè€Œä¸æ˜¯ç›´æ¥å°†nullèµ‹å€¼ç»™å˜é‡ã€‚</p>
<p>javaå¼•å…¥ç©ºæŒ‡é’ˆçš„å±å®³ï¼š<br>1ã€å®ƒæ˜¯å¾ˆå¤šé—®é¢˜çš„é”™è¯¯ä¹‹æºï¼Œå®ƒæ˜¯ç›®å‰å¼€å‘ä¸­æœ€å…¸å‹çš„å¼‚å¸¸ã€‚<br>2ã€å®ƒä¼šä½¿ä»£ç è†¨èƒ€ï¼Œå®ƒä¼šä½¿æˆ‘ä»¬çš„ä»£ç å……æ»¡äº†æ·±åº¦åµŒå¥—çš„nullæ£€æŸ¥ï¼Œä»£ç çš„å¯è¯»æ€§ä¸‹é™ã€‚<br>3ã€å®ƒè‡ªèº«æ˜¯æ¯«æ— æ„ä¹‰çš„ï¼Œnullè‡ªèº«æ²¡æœ‰ä»»ä½•çš„è¯­ä¹‰ï¼Œå®ƒè¡¨ç¤ºä»¥ä¸€ç§é”™è¯¯çš„æ–¹å¼å¯¹ç¼ºå¤±å˜é‡çš„å€¼å»ºæ¨¡ã€‚<br>4ã€å®ƒç ´åäº†javaçš„å“²å­¦ï¼Œjavaä¸€ç›´é¿å…å¼•å…¥æŒ‡é’ˆçš„å­˜åœ¨ï¼Œè€Œå”¯ä¸€çš„ä¾‹å¤–å°±æ˜¯nullæŒ‡é’ˆã€‚<br>5ã€å®ƒç ´åäº†javaçš„ç±»å‹ï¼Œnullä¸å±äºä»»ä½•ç±»å‹ï¼Œè¿™ä¹Ÿæ„å‘³ç€å®ƒå¯ä»¥è¢«èµ‹å€¼ç»™ä»»æ„å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬å°†æ— æ³•è·å–è¿™ä¸ªnullå€¼æœ€åˆçš„ç±»å‹æ˜¯ä»€ä¹ˆã€‚<br>è€ŒOptionalçš„å‡ºç°å¯ä»¥è®©æˆ‘ä»¬æœ€å¤§ç¨‹åº¦ä¸Šè§„é¿ä¸Šè¿°é—®é¢˜ã€‚</p>
<p>Optionalçš„ä½¿ç”¨ï¼š<a href="https://blog.csdn.net/aaaPostcard/article/details/123596787">https://blog.csdn.net/aaaPostcard/article/details/123596787</a><br>ï¼ˆæ„Ÿè§‰åªèƒ½é¿å…å¯¹è‡ªå·±å®šä¹‰çš„domainäº§ç”Ÿç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæ— æ³•é¿å…ä»æ•°æ®åº“ä¸­è·å–åˆ°nullï¼Œç„¶åæ“ä½œé€ æˆNPEã€‚ï¼‰</p>
<p>âœ… IllegalStateException:Failed to load ApplicationContext</p>
<p>åŠ è½½ç±»å‡ºé—®é¢˜ï¼Œå¾€ä¸‹çœ‹æ˜¯å“ªä¸ªç±»æ²¡åŠ è½½ï¼Œè·å–beanå‡ºç°é—®é¢˜ï¼Œçœ‹æ˜¯ä¸æ˜¯å½“ä½œå¯¹è±¡è°ƒç”¨äº†ï¼Œä½†æ˜¯æ²¡åŠ @Serviceã€‚</p>
<p>âœ… forå¾ªç¯å†…é€šè¿‡newæ¥ä¿®æ”¹å¼•ç”¨å˜é‡å¯¼è‡´çš„é—®é¢˜</p>
<p>forå¾ªç¯ä¸­å£°æ˜çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼ŒListä¸­å­˜ç€å¯¹è±¡çš„å¼•ç”¨å˜é‡ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡åœ¨å †ä¸­çš„åœ°å€ã€‚forå¾ªç¯ä¸­é€šè¿‡setæ–¹æ³•æ¥æ”¹å˜å †ä¸­çš„å˜é‡ï¼Œæ²¡é—®é¢˜ï¼Œå¼•ç”¨å˜é‡å¹¶ä¸ä¼šæ”¹å˜ã€‚</p>
<p>ä½†æ˜¯ï¼Œforå¾ªç¯ä¸­é€šè¿‡newä¸€ä¸ªæ–°å¯¹è±¡æ¥èµ‹å€¼ç»™å±€éƒ¨å˜é‡ï¼Œæ–°å¯¹è±¡æ˜¯åœ¨å †ä¸­åˆ›å»ºäº†ï¼Œå¯¹è±¡åœ°å€èµ‹ç»™å±€éƒ¨å˜é‡ï¼Œä½†æ˜¯Listä¸­çš„å€¼å¹¶æ²¡æœ‰æ”¹å˜ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test10() &#123;</span><br><span class="line">    A a = new A(&quot;lll&quot;);</span><br><span class="line">    List&lt;A&gt; list1 = Lists.newArrayList(a);</span><br><span class="line">    List&lt;A&gt; list2 = Lists.newArrayList();</span><br><span class="line">    list2.addAll(list1);</span><br><span class="line">    System.out.println(list2); //[A(name=lll)]</span><br><span class="line">    a.setName(&quot;www&quot;);</span><br><span class="line">    System.out.println(list1); //[A(name=www)]</span><br><span class="line">    System.out.println(list2); //[A(name=www)]</span><br><span class="line"></span><br><span class="line">    for (A u : list2) &#123;</span><br><span class="line">        u.setName(&quot;bbb&quot;);</span><br><span class="line">        System.out.println(u.hashCode()); //1642360923</span><br><span class="line">        A u1 = new A(&quot;aaa&quot;);</span><br><span class="line">        u = u1;</span><br><span class="line">        u.setName(&quot;aaa&quot;);</span><br><span class="line">        System.out.println(u.hashCode()); //1343441044</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(list2); //[A(name=bbb)]</span><br><span class="line">    System.out.println(list2.get(0).hashCode()); //1642360923</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">@ToString</span><br><span class="line">class A &#123;</span><br><span class="line">    A(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    private String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="Void-ä¸-void-ä¸-null"><a href="#Void-ä¸-void-ä¸-null" class="headerlink" title="Void ä¸ void ä¸ null"></a>Void ä¸ void ä¸ null</h3><p>void æ˜¯ä¸€ç§åŸºæœ¬æ•°æ®ç±»å‹ã€‚è€Œ Void æ˜¯ void å°è£…ç±»å‹ã€‚<br>Void ä¹‹äº void ç±»ä¼¼äº Integer ä¹‹äº intã€‚ä½†å¹¶éå¦‚æ­¤ï¼ŒVoid æ¯”è¾ƒç‰¹åˆ«ï¼š<br>å®ƒä¸å¯å®ä¾‹åŒ–<br>å®ƒæ²¡æœ‰å†…ç½®çš„ç±»å‹å®ä¾‹ï¼Œä¹Ÿæ²¡æœ‰å¯ç”¨çš„å­—é¢å€¼ã€‚</p>
<p>å£°æ˜ä¸€ä¸ª Void å˜é‡é€šå¸¸æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ï¼Œå› ä¸ºæ²¡æœ‰å¯ä¸ºå…¶èµ‹å€¼çš„å®ä¾‹ã€‚Void å˜é‡å”¯ä¸€èƒ½æŒæœ‰çš„æ˜¯ nullã€‚Void ä¸€ä¸ªå¯ç”¨çš„åœ°æ–¹æ˜¯åå°„åˆ¤æ–­æ–¹æ³•çš„è¿”å›å€¼æ—¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(m.getReturnType().equals(Void.TYPE)) &#123;</span><br><span class="line">	// å¤„ç†è¿”å›å€¼ä¸º void çš„æ–¹æ³•</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†ä¹Ÿä¸æ˜¯å¿…éœ€ä½¿ç”¨Void.TYPEï¼Œä¹Ÿå¯ä»¥ç”¨void.classã€‚<br>æ€»ç»“æ¥è¯´ï¼Œå‡ ä¹å¾ˆå°‘ä¼šç”¨åˆ° Void ã€‚</p>
<p>nullæ˜¯æ‰€æœ‰å¼•ç”¨ç±»å‹çš„é»˜è®¤å€¼ï¼Œä½†æ˜¯è¦æ¾„æ¸…ä¸€äº›è¯¯è§£ï¼Œnullæ—¢ä¸æ˜¯å¯¹è±¡ä¹Ÿä¸æ˜¯ä¸€ç§ç±»å‹ï¼Œå®ƒä»…æ˜¯ä¸€ç§ç‰¹æ®Šçš„å€¼ï¼Œä½ å¯ä»¥å°†å…¶èµ‹äºˆä»»ä½•å¼•ç”¨ç±»å‹ï¼Œä½ ä¹Ÿå¯ä»¥å°†nullè½¬åŒ–æˆä»»ä½•ç±»å‹ã€‚</p>
<p>è®¿é—®ä¸€ä¸ªç±»é‡Œçš„æ–¹æ³•ï¼Œå¦‚æœç”¨nullèµ‹äºˆçš„å¯¹è±¡è®¿é—®æ™®é€šæ–¹æ³•ï¼Œä¼šNullPointerExceptionï¼Œè€Œè®¿é—®staticæ–¹æ³•ï¼Œæ²¡äº‹ï¼Œå› ä¸ºè®¿é—®é™æ€æ–¹æ³•ä¸éœ€è¦å®ä¾‹å¯¹è±¡ã€‚å› æ­¤ï¼Œé™æ€æ–¹æ³•çš„è®¿é—®ï¼Œä¸å»ºè®®ç”¨å®ä¾‹è°ƒç”¨ï¼Œç”¨ç±»è°ƒç”¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Main m = (Main) null;</span><br><span class="line">System.out.println(m instanceof Main); //è¿”å›false</span><br><span class="line">System.out.println(m.getClass()); //ç©ºæŒ‡é’ˆ</span><br></pre></td></tr></table></figure>

<p>voidä¸æ˜¯å‡½æ•°ï¼Œæ˜¯æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼Œvoidçš„æ„æ€æ˜¯è¯¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæ„æ€å°±æ˜¯æ–¹æ³•åªä¼šè¿è¡Œæ–¹æ³•ä¸­çš„è¯­å¥ï¼Œä½†æ˜¯ä¸è¿”å›ä»»ä½•ä¸œè¥¿ã€‚ java.lang.Voidæ˜¯ä¸€ç§ç±»å‹ã€‚ä¾‹å¦‚ç»™Voidå¼•ç”¨èµ‹å€¼nullã€‚é€šè¿‡Voidç±»çš„æºä»£ç å¯ä»¥çœ‹åˆ°ï¼ŒVoidç±»å‹ä¸å¯ä»¥ç»§æ‰¿ä¸å®ä¾‹åŒ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final class Main &#123;</span><br><span class="line"></span><br><span class="line">    public void do1() &#123;</span><br><span class="line">        return; //è¿”å›voidï¼Œreturnå¯å†™å¯ä¸å†™</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Void do2() &#123;</span><br><span class="line">        return null; //æ­¤å¤„å¿…é¡»è¿”å›null è¿”å›å…¶ä½™ç±»å‹éƒ½ä¸å¥½ä½¿</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(Void.class); //class java.lang.Void</span><br><span class="line">        System.out.println(void.class); //void</span><br><span class="line">        //ç±»ä¼¼äºä¸‹é¢çš„</span><br><span class="line">        System.out.println(Integer.class); //class java.lang.Integer</span><br><span class="line">        System.out.println(int.class); //int</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Voidæˆ‘ä»¬åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå…¶å®åœ¨æ³›å‹å‡ºç°ä¹‹å‰ï¼ŒVoidä¸€èˆ¬ç”¨äºåå°„ä¹‹ä¸­ã€‚åˆ¤æ–­æ–¹æ³•è¿”å›æ˜¯å¦ä¸ºvoidã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">  public void print(String v) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  public static void main(String args[])&#123;</span><br><span class="line">    for(Method method : Test.class.getMethods()) &#123;</span><br><span class="line">      //åˆ¤æ–­è¿”å›å€¼ç±»å‹ ç”¨åˆ°äº†Voidç±»</span><br><span class="line">      if(method.getReturnType().equals(Void.TYPE)) &#123;</span><br><span class="line">        System.out.println(method.getName());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰æœ‰çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦è¿”å›å€¼çš„æŠ½åƒæ€§è®¾è®¡ï¼Œæ¯”å¦‚ä¸‹é¢è®¾è®¡çš„åˆ†å¸ƒå¼é”ï¼šRedisLock.</p>
<p>æ›´å¤šç”¨æ³•ï¼š<a href="https://blog.csdn.net/f641385712/article/details/80409211?utm_source=blogxgwz0">https://blog.csdn.net/f641385712/article/details/80409211?utm_source=blogxgwz0</a></p>
<h3 id="Javaä¸­åŒ…è£…ç±»å‹å’ŒåŸºæœ¬ç±»å‹çš„ä½¿ç”¨åœºæ™¯"><a href="#Javaä¸­åŒ…è£…ç±»å‹å’ŒåŸºæœ¬ç±»å‹çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="Javaä¸­åŒ…è£…ç±»å‹å’ŒåŸºæœ¬ç±»å‹çš„ä½¿ç”¨åœºæ™¯"></a>Javaä¸­åŒ…è£…ç±»å‹å’ŒåŸºæœ¬ç±»å‹çš„ä½¿ç”¨åœºæ™¯</h3><p>æœ€ç®€å•çš„ç†è§£ï¼ŒåŸºæœ¬ç±»å‹æœ‰é»˜è®¤å€¼ï¼Œè€ŒåŒ…è£…ç±»å‹åˆå§‹ä¸ºnullã€‚ç„¶åå†æ ¹æ®è¿™ä¸¤ä¸ªç‰¹æ€§è¿›è¡Œåˆ†ä¸šåŠ¡ä½¿ç”¨ï¼Œåœ¨é˜¿é‡Œå·´å·´çš„è§„èŒƒé‡Œæ‰€æœ‰çš„POJOç±»å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»å‹ï¼Œè€Œåœ¨æœ¬åœ°å˜é‡æ¨èä½¿ç”¨åŸºæœ¬ç±»å‹ã€‚å®šä¹‰æ–¹æ³•çš„è¾“å…¥è¾“å‡ºå‚æ•°ç”¨åŒ…è£…ç±»å‹ã€‚Listé‡Œç”¨åŒ…è£…ç±»å‹(,å› ä¸ºListä¸­çš„æ³›å‹å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹ã€‚)ï¼Œforå¾ªç¯é‡Œç”¨åŒ…è£…ç±»å‹ã€‚</p>
<p>Javaè¯­è¨€æä¾›äº†å…«ç§åŸºæœ¬ç±»å‹ã€‚å…­ç§æ•°å­—ç±»å‹ï¼ˆå››ä¸ªæ•´æ•°å‹ï¼Œä¸¤ä¸ªæµ®ç‚¹å‹ï¼‰ï¼Œä¸€ç§å­—ç¬¦ç±»å‹ï¼Œè¿˜æœ‰ä¸€ç§å¸ƒå°”å‹ã€‚<br>1ã€æ•´æ•°ï¼šåŒ…æ‹¬intã€shortã€byteã€longåˆå§‹å€¼ä¸º0ã€‚<br>2ã€æµ®ç‚¹å‹ï¼šfloatã€doubleåˆå§‹å€¼ä¸º0.0<br>3ã€å­—ç¬¦ï¼šcharåˆå§‹å€¼ä¸ºç©ºæ ¼ï¼Œå³â€™â€™ â€œï¼Œå¦‚æœè¾“å‡ºï¼Œåœ¨Consoleä¸Šæ˜¯çœ‹ä¸åˆ°æ•ˆæœçš„ã€‚<br>4ã€å¸ƒå°”ï¼šbooleanåˆå§‹å€¼ä¸ºfalse </p>
<p>åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»<br>Integer ã€Longã€Shortã€Byteã€Characterã€Doubleã€Floatã€Booleanã€BigIntegerã€BigDecimal<br>å…¶ä¸­BigIntegerã€BigDecimalæ²¡æœ‰ç›¸å¯¹åº”çš„åŸºæœ¬ç±»å‹ï¼Œä¸»è¦åº”ç”¨äºé«˜ç²¾åº¦çš„è¿ç®—ï¼ŒBigInteger æ”¯æŒä»»æ„ç²¾åº¦çš„æ•´æ•°ï¼Œ<br>BigDecimalæ”¯æŒä»»æ„ç²¾åº¦å¸¦å°æ•°ç‚¹çš„è¿ç®—ã€‚</p>
<p>åŸºæœ¬ç±»å‹ä¸åŒ…è£…ç±»å‹çš„å¼‚åŒï¼š<br>1ã€åœ¨Javaä¸­ï¼Œä¸€åˆ‡çš†å¯¹è±¡ï¼Œä½†å…«å¤§åŸºæœ¬ç±»å‹å´ä¸æ˜¯å¯¹è±¡ã€‚<br>2ã€å£°æ˜æ–¹å¼çš„ä¸åŒï¼ŒåŸºæœ¬ç±»å‹æ— éœ€é€šè¿‡newå…³é”®å­—æ¥åˆ›å»ºï¼Œè€Œå°è£…ç±»å‹åˆ™éœ€newå…³é”®å­—ã€‚<br>3ã€å­˜å‚¨æ–¹å¼åŠä½ç½®çš„ä¸åŒï¼ŒåŸºæœ¬ç±»å‹æ˜¯ç›´æ¥å­˜å‚¨å˜é‡çš„å€¼ï¼Œä¿å­˜åœ¨å †æ ˆä¸­èƒ½é«˜æ•ˆçš„å­˜å–ï¼›å°è£…ç±»å‹éœ€è¦é€šè¿‡å¼•ç”¨æŒ‡å‘å®ä¾‹ï¼Œå…·ä½“çš„å®ä¾‹ä¿å­˜åœ¨å †ä¸­ï¼›<br>4ã€åˆå§‹å€¼çš„ä¸åŒï¼Œå°è£…ç±»å‹çš„åˆå§‹å€¼ä¸ºnullï¼ŒåŸºæœ¬ç±»å‹çš„çš„åˆå§‹å€¼è§†å…·ä½“çš„ç±»å‹è€Œå®šï¼Œæ¯”å¦‚intç±»å‹çš„åˆå§‹å€¼ä¸º0ï¼Œbooleanç±»å‹ä¸ºfalseï¼›<br>5ã€ä½¿ç”¨æ–¹å¼çš„ä¸åŒï¼Œæ¯”å¦‚ä¸é›†åˆç±»åˆä½œä½¿ç”¨æ—¶åªèƒ½ä½¿ç”¨åŒ…è£…ç±»å‹ã€‚<br>6ã€ä»€ä¹ˆæ—¶å€™è¯¥ç”¨åŒ…è£…ç±»ï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨åŸºæœ¬ç±»å‹ï¼Œçœ‹åŸºæœ¬çš„ä¸šåŠ¡æ¥å®šï¼šè¿™ä¸ªå­—æ®µå…ä¸å…è®¸nullå€¼ï¼Œå¦‚æœå…è®¸ï¼Œåˆ™å¿…ç„¶è¦ç”¨å°è£…ç±»ï¼›å¦åˆ™ï¼ŒåŸºæœ¬ç±»å‹å°±å¯ä»¥äº†ã€‚å¦‚æœç”¨åˆ°æ¯”å¦‚æ³›å‹å’Œåå°„è°ƒç”¨å‡½æ•°ï¼Œå°±éœ€è¦ç”¨åŒ…è£…ç±»ï¼ </p>
<p>è½¬è‡ª <a href="http://t.zoukankan.com/east7-p-9887722.html">http://t.zoukankan.com/east7-p-9887722.html</a></p>
<h4 id="parseDouble-å’ŒvalueOf-æ–¹æ³•ï¼Œç±»å‹è½¬æ¢"><a href="#parseDouble-å’ŒvalueOf-æ–¹æ³•ï¼Œç±»å‹è½¬æ¢" class="headerlink" title="parseDouble()å’ŒvalueOf()æ–¹æ³•ï¼Œç±»å‹è½¬æ¢"></a>parseDouble()å’ŒvalueOf()æ–¹æ³•ï¼Œç±»å‹è½¬æ¢</h4><p>âœ…Doubleç±»parseDouble()å’ŒvalueOf()æ–¹æ³•çš„åŒºåˆ«ï¼ˆStringè½¬Doubleï¼‰</p>
<p>1ã€Double.parseDouble(java.lang.String)çš„å‚æ•°åªèƒ½æ˜¯Stringã€‚Double.valueOf()çš„å‚æ•°ç±»å‹å¯ä»¥æ˜¯æµ®ç‚¹å‹æˆ–è€…æ˜¯å­—ç¬¦ä¸²å‡å¯ã€‚</p>
<p>2ã€Double.parseDouble(java.lang.String)æŠŠæ•°å­—ç±»å‹çš„å­—ç¬¦ä¸²è½¬æ¢æˆdoubleç±»å‹ï¼Œè¿”å›æ˜¯doubleç±»å‹ã€‚å…¥å‚æ˜¯Stringã€‚<br>Double.valueOf()æ–¹æŠŠæ•°å­—ç±»å‹çš„å­—ç¬¦ä¸²è½¬æ¢æˆDoubleç±»å‹ï¼Œè¿”å›æ˜¯Doubleç±»å‹ã€‚å…¥å‚æ˜¯Stringæˆ–doubleã€‚</p>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•é‡Œé¢éƒ½ä¸èƒ½æ˜¯Objectç±»å‹ï¼Œå¾—å…ˆo.toStringè½¬ä¸ºStringï¼Œå†å˜Doubleã€‚æ³¨æ„ç©ºæŒ‡é’ˆã€‚</p>
<p>âœ…Doubleè½¬String</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String s = Double.toString(1.1);  //é‡Œé¢å¯ä»¥æ˜¯doubleä¹Ÿå¯ä»¥æ˜¯Double,ä¸ºnullä¼šNPE</span><br><span class="line"></span><br><span class="line">Double d = 1.1;</span><br><span class="line">String s1 = d.toString();  //Objectçš„toStringæ–¹æ³•doubleç±»å‹ä¸èƒ½ç”¨,dä¸ºnullä¼šNPE</span><br><span class="line"></span><br><span class="line">double d1 = 1.2;</span><br><span class="line">String s1 = String.valueOf(d);  //é‡Œé¢å¯ä»¥æ˜¯doubleä¹Ÿå¯ä»¥æ˜¯Double,å¯ä»¥æ˜¯nullï¼Œnulçš„è¯è¾“å‡ºâ€œnullâ€</span><br></pre></td></tr></table></figure>

<p>âœ…å¼ºåˆ¶ç±»å‹è½¬æ¢<br>é¦–å…ˆï¼Œæ¯ä¸ªåŒ…è£…ç±»å‹éƒ½æœ‰ä¸€ä¸ªvalueOfæ–¹æ³•ï¼Œç”¨æ¥æŠŠå…¶ä»–ç±»å‹è½¬æ¢ä¸ºè‡ªå·±ç±»å‹ã€‚ä¾‹å¦‚ï¼šDouble d &#x3D; Double.valueOf(â€œ1â€);</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1() &#123;</span><br><span class="line">    System.out.println((double) 1 / 1000); //è¾“å‡º0.001</span><br><span class="line">    System.out.println((double) (1 / 1000)); //è¾“å‡º0.0</span><br><span class="line">    Integer integer = 1;</span><br><span class="line">    System.out.println((double) integer / 1000); //è¾“å‡º0.001</span><br><span class="line"></span><br><span class="line">    //å‘ä¸Šå–æ•´</span><br><span class="line">    double d = Math.ceil(2.3);</span><br><span class="line">    Integer i = (int) d;</span><br><span class="line">    System.out.println(i); //è¾“å‡º3</span><br><span class="line"></span><br><span class="line">    int x = 1, y = 2;</span><br><span class="line">    double z = x / y; //waring:&#x27;x / y&#x27;: integer division in floating-point context ï¼ˆæ„æ€æ˜¯è¯´è¿™æ˜¯æµ®ç‚¹æ•°çš„é™¤æ³•ï¼‰</span><br><span class="line">    System.out.println(z);  //0.0</span><br><span class="line">    double w = 1.0 * x / y;</span><br><span class="line">    System.out.println(w);  //0.5</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="String-valueOf-1L-å’Œ-l-toString"><a href="#String-valueOf-1L-å’Œ-l-toString" class="headerlink" title="String.valueOf(1L)å’Œ l.toString"></a>String.valueOf(1L)å’Œ l.toString</h4><p>String.valueOf å…¥å‚æ˜¯Objectã€‚<br>String.valueOf å¦‚æœä¼ å…¥nullï¼Œè¿”å›æ˜¯â€œnullâ€å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ç©ºnullã€‚<br>null.toString() ä¼šæŠ¥ç©ºæŒ‡é’ˆã€‚<br>ä¸æ˜¯åŒ…è£…ç±»å‹çš„intï¼Œ.toString()ä¹Ÿä¸è¡Œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Long l = new Long(1L);</span><br><span class="line">String s1 = String.valueOf(l);</span><br><span class="line">System.out.println(s1);</span><br><span class="line">String s2 = l.toString();</span><br><span class="line">System.out.println(s2);</span><br><span class="line"></span><br><span class="line">l = null;</span><br><span class="line">String s3 = String.valueOf(l);</span><br><span class="line">System.out.println(s3);  //null</span><br><span class="line">String s4 = l.toString(); //NullPointerException</span><br><span class="line">System.out.println(s4);</span><br></pre></td></tr></table></figure>

<h4 id="åˆ¤æ–­å°æ•°ç²¾ç¡®åº¦"><a href="#åˆ¤æ–­å°æ•°ç²¾ç¡®åº¦" class="headerlink" title="åˆ¤æ–­å°æ•°ç²¾ç¡®åº¦"></a>åˆ¤æ–­å°æ•°ç²¾ç¡®åº¦</h4><p>å®ç°æ€è·¯ï¼šç”¨Stringçš„splitæ–¹æ³•ï¼Œå¾—åˆ°å°æ•°ç‚¹åçš„Stringï¼Œå†çœ‹å¤§å°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (&quot;1231312.12&quot;.split(&quot;\\.&quot;)[1].length()==2) &#123;</span><br><span class="line">    System.out.println(&quot;æ˜¯ä¸¤ä½å°æ•°&quot;);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ¯”è¾ƒä¸¤ä¸ªdoubleçš„å¤§å°"><a href="#æ¯”è¾ƒä¸¤ä¸ªdoubleçš„å¤§å°" class="headerlink" title="æ¯”è¾ƒä¸¤ä¸ªdoubleçš„å¤§å°"></a>æ¯”è¾ƒä¸¤ä¸ªdoubleçš„å¤§å°</h4><p>1.ç”¨bigdecimalï¼Œä¼ å…¥stringç±»å‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BigDecimal bdL = new BigDecimal(&quot;1.22&quot;);</span><br><span class="line">BigDecimal bdR = new BigDecimal(&quot;1.22&quot;);</span><br><span class="line">if (bdL.compareTo(bdR) &lt; 0)</span><br><span class="line">    System.out.println(&quot;num1 &lt; num2&quot;);</span><br><span class="line">else if (bdL.compareTo(bdR) == 0)</span><br><span class="line">    System.out.println(&quot;num1 == num2&quot;);</span><br><span class="line">else</span><br><span class="line">    System.out.println(&quot;num1 &gt; num2&quot;);</span><br></pre></td></tr></table></figure>

<p>2.ä½¿ç”¨Double</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Double dL = 1.33;</span><br><span class="line">Double dR = 1.33;</span><br><span class="line">if (dL.compareTo(dR) &lt; 0)</span><br><span class="line">    System.out.println(&quot;num1 &lt; num2&quot;);</span><br><span class="line">else if (dL.compareTo(dR) == 0)</span><br><span class="line">    System.out.println(&quot;num1 == num2&quot;);</span><br><span class="line">else</span><br><span class="line">    System.out.println(&quot;num1 &gt; num2&quot;);</span><br></pre></td></tr></table></figure>

<p>3.åœ¨è¯¯å·®èŒƒå›´å†…å…è®¸ç›¸ç­‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä¸¤å®æ•°çš„å·®åœ¨å…è®¸çš„èŒƒå›´å†…è®¤ä¸ºç›¸ç­‰æ—¢å¯è®¤ä¸ºæ˜¯ç›¸ç­‰çš„</span><br><span class="line">Double num1 = 1.222;</span><br><span class="line">Double num2 = 1.222;</span><br><span class="line">if (num1 - num2 &gt; 0.000001)</span><br><span class="line">    System.out.println(&quot;num1 &gt; num2&quot;);</span><br><span class="line">else if (num1 - num2 &lt; -0.0000001)</span><br><span class="line">    System.out.println(&quot;num1 &lt; num2&quot;);</span><br><span class="line">else</span><br><span class="line">    System.out.println(&quot;num1 == num2&quot;);</span><br></pre></td></tr></table></figure>

<p>4.è½¬æ¢æˆå­—ç¬¦ä¸²</p>
<p>å¯ä»¥å°†doubleæ•°æ®è½¬æ¢æˆstringç„¶åå€ŸåŠ©stringçš„compareToæ–¹æ³•æ¥é—´æ¥å®ç°æ¯”è¾ƒä¸¤ä¸ªdoubleæ•°æ®æ˜¯å¦ç›¸ç­‰ã€‚æ³¨æ„è¿™ç§æ–¹æ³•åªé€‚ç”¨äºæ¯”è¾ƒç²¾åº¦ç›¸åŒçš„æ•°æ®ï¼Œå¹¶ä¸”æ˜¯åªèƒ½ç”¨äºæ¯”è¾ƒæ­£æ•°çš„å¤§å°ï¼Œè´Ÿæ•°æ¯”è¾ƒç»“æœå¼‚å¸¸ï¼Œä¸è¿‡å¯ä»¥ç”¨äºæ¯”è¾ƒä¸¤æ•°æ˜¯å¦ç›¸ç­‰ï¼Œæ­¤æ—¶æ­£è´Ÿæ•°å¯¹ç»“æœæ²¡æœ‰å½±å“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String strL = String.valueOf(num1);</span><br><span class="line">String strR = String.valueOf(num2);</span><br><span class="line">if (strL.compareTo(strR) &lt; 0)</span><br><span class="line">    System.out.println(&quot;num1 &lt; num2&quot;);</span><br><span class="line">else if (strL.compareTo(strR) == 0)</span><br><span class="line">    System.out.println(&quot;num1 == num2&quot;);</span><br><span class="line">else</span><br><span class="line">    System.out.println(&quot;num1 &gt; num2&quot;);</span><br></pre></td></tr></table></figure>

<p>5.ä½¿ç”¨doubleToLongBits()æ–¹æ³•</p>
<p>ä½¿ç”¨sunæä¾›çš„Double.doubleToLongBits()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥å°†doubleè½¬æ¢æˆlongå‹æ•°æ®ï¼Œä»è€Œå¯ä»¥ä½¿doubleæŒ‰ç…§longçš„æ–¹æ³•ï¼ˆ&lt;, &gt;, &#x3D;&#x3D;ï¼‰åˆ¤æ–­æ˜¯å¦å¤§å°å’Œæ˜¯å¦ç›¸ç­‰ï¼Œä½†æ˜¯ï¼Œè¿™ç§åŠæ³•è¿˜æ˜¯åªèƒ½ç”¨äºæ¯”è¾ƒæ­£æ•°ï¼Œè´Ÿæ•°ç»“æœå¼‚å¸¸ï¼Œæ¯”è¾ƒä¸¤æ•°ç›¸ç­‰ä¸å¦æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä½¿ç”¨ä½¿ç”¨sunæä¾›çš„Double.doubleToLongBits()æ–¹æ³•</span><br><span class="line">long lL = Double.doubleToRawLongBits(num1);</span><br><span class="line">long lR = Double.doubleToRawLongBits(num2);</span><br><span class="line">System.out.println(lL + &quot;:&quot; + lR);</span><br><span class="line">if (lL &lt; lR)</span><br><span class="line">    System.out.println(&quot;num1 &lt; num2&quot;);</span><br><span class="line">else if (lL == lR)</span><br><span class="line">    System.out.println(&quot;num1 == num2&quot;);</span><br><span class="line">else</span><br><span class="line">    System.out.println(&quot;num1 &gt; num2&quot;);</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/qq_49217297/article/details/124969742">https://blog.csdn.net/qq_49217297/article/details/124969742</a></p>
<h4 id="ä¿ç•™ä¸¤ä½å°æ•°"><a href="#ä¿ç•™ä¸¤ä½å°æ•°" class="headerlink" title="ä¿ç•™ä¸¤ä½å°æ•°"></a>ä¿ç•™ä¸¤ä½å°æ•°</h4><p>1ã€ä½¿ç”¨java.math.BigDecimalï¼Œå››èˆäº”å…¥çš„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Double value = 1.2355;</span><br><span class="line">BigDecimal bd = new BigDecimal(value);</span><br><span class="line">bd = bd.setScale(2, RoundingMode.HALF_UP);</span><br><span class="line">System.out.println(bd.toString());</span><br><span class="line">System.out.println(bd.doubleValue());</span><br></pre></td></tr></table></figure>

<p>2ã€ä½¿ç”¨DecimalFormat,ä¿ç•™å°æ•°ç‚¹åä¸¤ä½ï¼Œå››èˆäº”å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DecimalFormat df = new DecimalFormat(&quot;0.00&quot;);</span><br><span class="line">df.setRoundingMode(RoundingMode.HALF_UP);</span><br><span class="line">System.out.println(df.format(value));</span><br></pre></td></tr></table></figure>

<p>3ã€ä½¿ç”¨NumberFormat,ä¿ç•™å°æ•°ç‚¹åä¸¤ä½ï¼Œå››èˆäº”å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NumberFormat nf = NumberFormat.getNumberInstance();</span><br><span class="line">//å¦‚æœä¸è¿™ä¹ˆåšï¼Œé‚£ä¹ˆå½“valueçš„å€¼æ˜¯100.00çš„æ—¶å€™è¿”å›100</span><br><span class="line">nf.setMaximumFractionDigits(2);</span><br><span class="line">nf.setMinimumFractionDigits(2);</span><br><span class="line">nf.setRoundingMode(RoundingMode.HALF_UP);</span><br><span class="line">//å¦‚æœæƒ³è¾“å‡ºçš„æ ¼å¼ç”¨é€—å·éš”å¼€ï¼Œå¯ä»¥è®¾ç½®æˆtrue</span><br><span class="line">nf.setGroupingUsed(false);</span><br><span class="line">System.out.println(nf.format(value));</span><br></pre></td></tr></table></figure>

<p>4ã€ä½¿ç”¨java.util.Formatter,ä¿ç•™å°æ•°ç‚¹åä¸¤ä½ï¼Œå››èˆäº”å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String s = new Formatter().format(&quot;%.2f&quot;, value).toString();</span><br><span class="line">System.out.println(s);</span><br></pre></td></tr></table></figure>

<p>5ã€ä½¿ç”¨String.formatæ¥å®ç°ï¼Œå››èˆäº”å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">System.out.println(String.format(&quot;%.2f&quot;, value));</span><br></pre></td></tr></table></figure>

<p>å…­ã€é€šè¿‡è¿ç®—ï¼Œä¸æ˜¯å››èˆäº”å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">long l =(long)(value*100) ;</span><br><span class="line">double d = l/100D;</span><br><span class="line">System.out.println(d);</span><br></pre></td></tr></table></figure>

<p>Javaä¿ç•™ä¸¤ä½å°æ•°çš„å‡ ç§å†™æ³•æ€»ç»“ï¼š<br><a href="https://cloud.tencent.com/developer/article/2155412">https://cloud.tencent.com/developer/article/2155412</a></p>
<h4 id="intçš„æœ€å¤§æœ€å°å€¼"><a href="#intçš„æœ€å¤§æœ€å°å€¼" class="headerlink" title="intçš„æœ€å¤§æœ€å°å€¼"></a>intçš„æœ€å¤§æœ€å°å€¼</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">System.out.println(Integer.MIN_VALUE); //-2147483648</span><br><span class="line">System.out.println(Integer.MAX_VALUE); //2147483647</span><br><span class="line">System.out.println(-Integer.MIN_VALUE); //-2147483648  Numeric overflow in expression</span><br></pre></td></tr></table></figure>

<p>32 ä½çš„æœ‰ç¬¦å·æ•´æ•°çš„èŒƒå›´ [âˆ’2^31,  2^31 âˆ’ 1]</p>
<p>é—®é¢˜ï¼šä¸ºä»€ä¹ˆ-Integer.MIN_VALUEçš„ç»“æœä¼šæ˜¯-2147483648<br>å› ä¸ºå‡ºç°äº†æº¢å‡ºçš„é—®é¢˜ï¼Œæ•´æ•°ç”¨äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä¸ºï¼Œ0æ­£æ•°ï¼Œ1è´Ÿæ•°ã€‚<br>MIN_VALUEçš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼š100000â€¦.<br>è´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºè¿›è¡Œå–åå†åŠ 1ï¼Œå°±å¾—åˆ°ç»å¯¹å€¼ã€‚<br>ä»ç»å¯¹å€¼åˆ°è´Ÿæ•°äºŒè¿›åˆ¶ï¼šç»å¯¹å€¼äºŒè¿›åˆ¶ï¼Œå–åï¼Œå†åŠ 1å¾—åˆ°ã€‚</p>
<p>äºŒè¿›åˆ¶è¡¥ç çš„å‡ºç°æ˜¯ä¸ºäº†æ–¹ä¾¿è´Ÿæ•°çš„åŠ å‡è¿ç®—ã€‚å‡æ³•å¯ä»¥é€šè¿‡åŠ ä¸Šå¯¹åº”æ­£æ•°çš„è¡¥ç æ¥å®ç°ã€‚</p>
<p>Integer.MIN_VALUEå–è´Ÿçš„è¿‡ç¨‹ï¼š<br>1.MIN_VALUEçš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼š100000â€¦.æ¯ä¸€ä½å–åï¼Œå¾—åˆ°01111â€¦<br>2.ç„¶åå°†ä¸Šè¿°ç»“æœ+1ï¼Œçš„åˆ°100000â€¦ è¿˜æ˜¯è‡ªå·±</p>
<p>æ­£æ•°çš„è¡¥ç ç­‰äºå®ƒçš„åŸç ï¼›è´Ÿæ•°çš„è¡¥ç ç­‰äºåç +1ã€‚</p>
<h3 id="BigDecimal"><a href="#BigDecimal" class="headerlink" title="BigDecimal"></a>BigDecimal</h3><p>ä½¿ç”¨åœºæ™¯ï¼šæ¯”è¾ƒç²¾ç¡®çš„æ•°å­—çš„åŠ å‡æ³•ã€å°æ•°çš„å››èˆäº”å…¥</p>
<p>é¦–å…ˆï¼Œæµ®ç‚¹æ•°ä¸ºä»€ä¹ˆä¸å‡†ç¡®ï¼Ÿ<br>ç å†œåœ¨ç¨‹åºé‡Œå†™çš„10è¿›åˆ¶å°æ•°ï¼Œè®¡ç®—æœºå†…éƒ¨æ— æ³•ç”¨äºŒè¿›åˆ¶çš„å°æ•°æ¥ç²¾ç¡®çš„è¡¨è¾¾ã€‚<br>å¯¹äºäºŒè¿›åˆ¶å°æ•°ï¼Œå°æ•°ç‚¹å³è¾¹èƒ½è¡¨è¾¾çš„å€¼æ˜¯ 1&#x2F;2, 1&#x2F;4, 1&#x2F;8, 1&#x2F;16, 1&#x2F;32, 1&#x2F;64, 1&#x2F;128 â€¦ 1&#x2F;(2^nï¼‰</p>
<p>è¯•ä¸€è¯•å¦‚ä½•è¡¨è¾¾åè¿›åˆ¶çš„ 0.2 å§ã€‚</p>
<p>0.01 &#x3D; 1&#x2F;4 &#x3D; 0.25 ,å¤ªå¤§</p>
<p>0.001 &#x3D;1&#x2F;8 &#x3D; 0.125 , åˆå¤ªå°</p>
<p>0.0011 &#x3D; 1&#x2F;8 + 1&#x2F;16 &#x3D; 0.1875 , é€¼è¿‘0.2äº†</p>
<p>0.00111 &#x3D; 1&#x2F;8 + 1&#x2F;16 + 1&#x2F;32 &#x3D; 0.21875 , åˆå¤§äº†</p>
<p>0.001101 &#x3D; 1&#x2F;8+ 1&#x2F;16 + 1&#x2F;64 &#x3D; 0.203125 è¿˜æ˜¯å¤§</p>
<p>0.0011001 &#x3D; 1&#x2F;8 + 1&#x2F;16 + 1&#x2F;128 &#x3D; 0.1953125 è¿™ç»“æœä¸é”™</p>
<p>0.00110011 &#x3D; 1&#x2F;8+1&#x2F;16+1&#x2F;128+1&#x2F;256 &#x3D; 0.19921875<br>å·²ç»å¾ˆé€¼è¿‘äº†ï¼Œ å°±è¿™æ ·å§ã€‚</p>
<p>è¿™å°±æ˜¯ç”¨äºŒè¿›åˆ¶å°æ•°æ²¡æ³•ç²¾ç¡®è¡¨è¾¾10è¿›åˆ¶å°æ•°çš„å«ä¹‰ã€‚<br>æ ¹æœ¬åŸå› æ˜¯:åè¿›åˆ¶å€¼é€šå¸¸æ²¡æœ‰å®Œå…¨ç›¸åŒçš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼;åè¿›åˆ¶æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼å¯èƒ½ä¸ç²¾ç¡®ã€‚åªèƒ½æ— é™æ¥è¿‘äºé‚£ä¸ªå€¼</p>
<p>ã€ŠEffective Javaã€‹åœ¨ç¬¬48æ¡æ¨èâ€œä½¿ç”¨BigDecimalæ¥åšç²¾ç¡®è¿ç®—â€ã€‚</p>
<hr>
<p>floatå’Œdoubleç±»å‹çš„ä¸»è¦è®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†ç§‘å­¦è®¡ç®—å’Œå·¥ç¨‹è®¡ç®—ã€‚ä»–ä»¬æ‰§è¡ŒäºŒè¿›åˆ¶æµ®ç‚¹è¿ç®—ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨å¹¿åŸŸæ•°å€¼èŒƒå›´ä¸Šæä¾›è¾ƒä¸ºç²¾ç¡®çš„å¿«é€Ÿè¿‘ä¼¼è®¡ç®—è€Œç²¾å¿ƒè®¾è®¡çš„ã€‚ç„¶è€Œï¼Œå®ƒä»¬æ²¡æœ‰æä¾›å®Œå…¨ç²¾ç¡®çš„ç»“æœï¼Œæ‰€ä»¥ä¸åº”è¯¥è¢«ç”¨äºè¦æ±‚ç²¾ç¡®ç»“æœçš„åœºåˆã€‚ä½†æ˜¯ï¼Œå•†ä¸šè®¡ç®—å¾€å¾€è¦æ±‚ç»“æœç²¾ç¡®ï¼Œè¿™æ—¶å€™BigDecimalå°±æ´¾ä¸Šå¤§ç”¨åœºå•¦ã€‚</p>
<p>Javaåœ¨java.mathåŒ…ä¸­æä¾›çš„APIç±»BigDecimalï¼Œç”¨æ¥å¯¹è¶…è¿‡16ä½æœ‰æ•ˆä½çš„æ•°è¿›è¡Œç²¾ç¡®çš„è¿ç®—ã€‚åŒç²¾åº¦æµ®ç‚¹å‹å˜é‡doubleå¯ä»¥å¤„ç†16ä½æœ‰æ•ˆæ•°ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦å¯¹æ›´å¤§æˆ–è€…æ›´å°çš„æ•°è¿›è¡Œè¿ç®—å’Œå¤„ç†ã€‚floatå’Œdoubleåªèƒ½ç”¨æ¥åšç§‘å­¦è®¡ç®—æˆ–è€…æ˜¯å·¥ç¨‹è®¡ç®—ï¼Œåœ¨å•†ä¸šè®¡ç®—ä¸­è¦ç”¨java.math.BigDecimalã€‚BigDecimalæ‰€åˆ›å»ºçš„æ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ä¼ ç»Ÿçš„+ã€-ã€*ã€&#x2F;ç­‰ç®—æœ¯è¿ç®—ç¬¦ç›´æ¥å¯¹å…¶å¯¹è±¡è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œè€Œå¿…é¡»è°ƒç”¨å…¶ç›¸å¯¹åº”çš„æ–¹æ³•ã€‚</p>
<hr>
<h4 id="âœ…BigDecimalæ„é€ æ–¹æ³•ï¼š"><a href="#âœ…BigDecimalæ„é€ æ–¹æ³•ï¼š" class="headerlink" title="âœ…BigDecimalæ„é€ æ–¹æ³•ï¼š"></a>âœ…BigDecimalæ„é€ æ–¹æ³•ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public BigDecimal(double val)    å°†doubleè¡¨ç¤ºå½¢å¼è½¬æ¢ä¸ºBigDecimal *ä¸å»ºè®®ä½¿ç”¨</span><br><span class="line">public BigDecimal(int val)ã€€ã€€å°†intè¡¨ç¤ºå½¢å¼è½¬æ¢æˆBigDecimal</span><br><span class="line">public BigDecimal(long)    åˆ›å»ºä¸€ä¸ªå…·æœ‰å‚æ•°æ‰€æŒ‡å®šé•¿æ•´æ•°å€¼çš„å¯¹è±¡ã€‚ </span><br><span class="line">public BigDecimal(String val)ã€€ã€€å°†Stringè¡¨ç¤ºå½¢å¼è½¬æ¢æˆBigDecimal *æ¨èä½¿ç”¨</span><br></pre></td></tr></table></figure>
<p>âš ï¸BigDecimal ä¸åƒDoubleä¸€æ ·å¯ä»¥ç›´æ¥&#x3D;1.1ã€‚ BigDecimaléœ€è¦newä¸ªå¯¹è±¡ï¼Œæˆ–è€…ï¼šBigDecimal.ZERO è¡¨ç¤º0.0ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨Doubleå…¥å‚ï¼Ÿ<br>BigDecimal bDouble &#x3D; new BigDecimal(2.3);<br>æœ€ç»ˆè¾“å‡ºçš„æ•°æ˜¯ï¼š2.29999999â€¦.</p>
<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p>
<p>JDKçš„æè¿°ï¼š<br>1ã€å‚æ•°ç±»å‹ä¸ºdoubleçš„æ„é€ æ–¹æ³•çš„ç»“æœæœ‰ä¸€å®šçš„ä¸å¯é¢„çŸ¥æ€§ã€‚æœ‰äººå¯èƒ½è®¤ä¸ºåœ¨Javaä¸­å†™å…¥newBigDecimal(0.1)æ‰€åˆ›å»ºçš„BigDecimalæ­£å¥½ç­‰äº 0.1ï¼ˆéæ ‡åº¦å€¼ 1ï¼Œå…¶æ ‡åº¦ä¸º 1ï¼‰ï¼Œä½†æ˜¯å®ƒå®é™…ä¸Šç­‰äº0.1000000000000000055511151231257827021181583404541015625ã€‚è¿™æ˜¯å› ä¸º0.1æ— æ³•å‡†ç¡®åœ°è¡¨ç¤ºä¸º doubleï¼ˆæˆ–è€…è¯´å¯¹äºè¯¥æƒ…å†µï¼Œä¸èƒ½è¡¨ç¤ºä¸ºä»»ä½•æœ‰é™é•¿åº¦çš„äºŒè¿›åˆ¶å°æ•°ï¼‰ã€‚è¿™æ ·ï¼Œä¼ å…¥åˆ°æ„é€ æ–¹æ³•çš„å€¼ä¸ä¼šæ­£å¥½ç­‰äº 0.1ï¼ˆè™½ç„¶è¡¨é¢ä¸Šç­‰äºè¯¥å€¼ï¼‰ã€‚</p>
<p>2ã€å¦ä¸€æ–¹é¢ï¼ŒString æ„é€ æ–¹æ³•æ˜¯å®Œå…¨å¯é¢„çŸ¥çš„ï¼šå†™å…¥ newBigDecimal(â€œ0.1â€) å°†åˆ›å»ºä¸€ä¸ª BigDecimalï¼Œå®ƒæ­£å¥½ç­‰äºé¢„æœŸçš„ 0.1ã€‚å› æ­¤ï¼Œæ¯”è¾ƒè€Œè¨€ï¼Œé€šå¸¸å»ºè®®ä¼˜å…ˆä½¿ç”¨Stringæ„é€ æ–¹æ³•ã€‚</p>
<p>å½“doubleå¿…é¡»ç”¨ä½œBigDecimalçš„æºæ—¶ï¼Œè¯·ä½¿ç”¨Double.toString(double)è½¬æˆStringï¼Œç„¶åä½¿ç”¨Stringæ„é€ æ–¹æ³•ï¼Œæˆ–ä½¿ç”¨BigDecimalçš„é™æ€æ–¹æ³•valueOf</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BigDecimal bDouble1 = BigDecimal.valueOf(2.3); //æ–¹æ³•ä¸èƒ½ä¼ null</span><br><span class="line">BigDecimal bDouble2 = new BigDecimal(Double.toString(2.3));</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="âœ…BigDecimalç”¨æ³•ï¼š"><a href="#âœ…BigDecimalç”¨æ³•ï¼š" class="headerlink" title="âœ…BigDecimalç”¨æ³•ï¼š"></a>âœ…BigDecimalç”¨æ³•ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        BigDecimal a = new BigDecimal(&quot;4.5&quot;);</span><br><span class="line">        BigDecimal b = new BigDecimal(&quot;1.5&quot;);</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;a + b =&quot; + a.add(b));</span><br><span class="line">        System.out.println(&quot;a - b =&quot; + a.subtract(b));</span><br><span class="line">        System.out.println(&quot;a * b =&quot; + a.multiply(b));</span><br><span class="line">        System.out.println(&quot;a / b =&quot; + a.divide(b));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ğŸ‘‹BigDecimalé™¤æ³•å¯èƒ½å‡ºç°ä¸èƒ½æ•´é™¤çš„æƒ…å†µï¼Œæ¯”å¦‚ 4.5&#x2F;1.3ï¼Œè¿™æ—¶ä¼šæŠ¥é”™java.lang.ArithmeticException: Non-terminating decimal expansion; no exact representable decimal result.</p>
<p>å…¶å®divideæ–¹æ³•æœ‰å¯ä»¥ä¼ ä¸‰ä¸ªå‚æ•°</p>
<p><code>public BigDecimal divide(BigDecimal divisor, int scale, int roundingMode) </code><br>ç¬¬ä¸€å‚æ•°è¡¨ç¤ºé™¤æ•°ï¼Œ ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå°æ•°ç‚¹åä¿ç•™ä½æ•°ï¼Œ<br>ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºèˆå…¥æ¨¡å¼ï¼Œåªæœ‰åœ¨ä½œé™¤æ³•è¿ç®—æˆ–å››èˆäº”å…¥æ—¶æ‰ç”¨åˆ°èˆå…¥æ¨¡å¼ï¼Œæœ‰ä¸‹é¢è¿™å‡ ç§:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ROUND_CEILING    //å‘æ­£æ— ç©·æ–¹å‘èˆå…¥</span><br><span class="line">ROUND_DOWN    //å‘é›¶æ–¹å‘èˆå…¥</span><br><span class="line">ROUND_FLOOR    //å‘è´Ÿæ— ç©·æ–¹å‘èˆå…¥</span><br><span class="line">ROUND_HALF_DOWN    //å‘ï¼ˆè·ç¦»ï¼‰æœ€è¿‘çš„ä¸€è¾¹èˆå…¥ï¼Œé™¤éä¸¤è¾¹ï¼ˆçš„è·ç¦»ï¼‰æ˜¯ç›¸ç­‰,å¦‚æœæ˜¯è¿™æ ·ï¼Œå‘ä¸‹èˆå…¥, ä¾‹å¦‚1.55 ä¿ç•™ä¸€ä½å°æ•°ç»“æœä¸º1.5</span><br><span class="line">ROUND_HALF_EVEN    //å‘ï¼ˆè·ç¦»ï¼‰æœ€è¿‘çš„ä¸€è¾¹èˆå…¥ï¼Œé™¤éä¸¤è¾¹ï¼ˆçš„è·ç¦»ï¼‰æ˜¯ç›¸ç­‰,å¦‚æœæ˜¯è¿™æ ·ï¼Œå¦‚æœä¿ç•™ä½æ•°æ˜¯å¥‡æ•°ï¼Œä½¿ç”¨ROUND_HALF_UPï¼Œå¦‚æœæ˜¯å¶æ•°ï¼Œä½¿ç”¨ROUND_HALF_DOWN</span><br><span class="line">ROUND_HALF_UP    //å‘ï¼ˆè·ç¦»ï¼‰æœ€è¿‘çš„ä¸€è¾¹èˆå…¥ï¼Œé™¤éä¸¤è¾¹ï¼ˆçš„è·ç¦»ï¼‰æ˜¯ç›¸ç­‰,å¦‚æœæ˜¯è¿™æ ·ï¼Œå‘ä¸Šèˆå…¥, 1.55ä¿ç•™ä¸€ä½å°æ•°ç»“æœä¸º1.6</span><br><span class="line">ROUND_UNNECESSARY    //è®¡ç®—ç»“æœæ˜¯ç²¾ç¡®çš„ï¼Œä¸éœ€è¦èˆå…¥æ¨¡å¼</span><br><span class="line">ROUND_UP    //å‘è¿œç¦»0çš„æ–¹å‘èˆå…¥</span><br><span class="line"></span><br><span class="line">å››èˆäº”å…¥é‡‡ç”¨ ROUND_HALF_UP</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BigDecimal b1 = new BigDecimal(&quot;1000&quot;);  </span><br><span class="line">BigDecimal b2 = new BigDecimal(&quot;100&quot;);  </span><br><span class="line">System.out.println(b1.divide(b2, 2, BigDecimal.ROUND_HALF_UP).toString());</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">10.00,ç»“æœè¿”å›ä¸€ä¸ªBigDecimal</span><br></pre></td></tr></table></figure>


<p>å¯¹BigDecimalè¿›è¡Œæˆªæ–­å’Œå››èˆäº”å…¥å¯ç”¨setScaleæ–¹æ³•:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        BigDecimal a = new BigDecimal(&quot;4.5635&quot;);</span><br><span class="line"></span><br><span class="line">        a = a.setScale(3, RoundingMode.HALF_UP);    //ä¿ç•™3ä½å°æ•°ï¼Œä¸”å››èˆäº”å…¥</span><br><span class="line">        a = a.setScale(3, BigDecimal.ROUND_HALF_UP);    //è¿™ä¸ªä¹Ÿè¡Œ</span><br><span class="line">        System.out.println(a);</span><br><span class="line"></span><br><span class="line">        Double d = a.doubleValue();  //è½¬ä¸ºdouble/Doubleç±»å‹</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>BigDecimaléƒ½æ˜¯ä¸ä¸»åŠ¨å˜çš„ï¼ˆimmutableï¼‰çš„ï¼Œåœ¨è¿›è¡Œæ¯ä¸€æ­¥è¿ç®—æ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨åšåŠ å‡ä¹˜é™¤è¿ç®—æ—¶åƒä¸‡è¦ä¿å­˜æ“ä½œåçš„å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        BigDecimal a = new BigDecimal(&quot;4.5&quot;);</span><br><span class="line">        BigDecimal b = new BigDecimal(&quot;1.5&quot;);</span><br><span class="line">        a.add(b);</span><br><span class="line"></span><br><span class="line">        System.out.println(a);  //è¾“å‡º4.5. åŠ å‡ä¹˜é™¤æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„BigDecimalå¯¹è±¡ï¼ŒåŸæ¥çš„aä¸å˜</span><br><span class="line">        a = a.add(b);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/YangJavaer/p/6056394.html">https://www.cnblogs.com/YangJavaer/p/6056394.html</a></p>
<hr>
<h4 id="âœ…BigDecimalæ¯”è¾ƒ"><a href="#âœ…BigDecimalæ¯”è¾ƒ" class="headerlink" title="âœ…BigDecimalæ¯”è¾ƒ"></a>âœ…BigDecimalæ¯”è¾ƒ</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int flag = bigdemical.compareTo(bigdemical1)ã€‚</span><br><span class="line"></span><br><span class="line">flag = -1ï¼Œè¡¨ç¤ºbigdemicalå°äºbigdemical1ã€‚</span><br><span class="line"></span><br><span class="line">flag =0ï¼Œè¡¨ç¤ºbigdemicalç­‰äºbigdemical1ã€‚</span><br><span class="line"></span><br><span class="line">flag =1ï¼Œè¡¨ç¤ºbigdemicalå¤§äºbigdemical1ã€‚</span><br><span class="line"></span><br><span class="line">å®é™…ä¸­ç›´æ¥è·Ÿ0æ¯”è¾ƒå°±å¯ä»¥äº†ï¼Œåˆ«è·Ÿ-1æˆ–è€…1æ¯”è¾ƒã€‚</span><br></pre></td></tr></table></figure>

<p>BigDecimalçš„equalsæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BigDecimal a=BigDecimal.valueOf(1.0);</span><br><span class="line">BigDecimal b=BigDecimal.valueOf(1.000);</span><br><span class="line">System.out.println(a.equals(b));  //true</span><br><span class="line"></span><br><span class="line">BigDecimal c = new BigDecimal(&quot;10.00&quot;);</span><br><span class="line">BigDecimal d = new BigDecimal(&quot;10&quot;);</span><br><span class="line">BigDecimal e = new BigDecimal(10.00);</span><br><span class="line">System.out.println(c.equals(d));  //false</span><br><span class="line">System.out.println(c.equals(e));  //false</span><br><span class="line">// equalsæ˜¯æ¯”è¾ƒå†…å®¹ï¼Œâ€œ1.0â€å’Œâ€œ1.000â€ä¸ä¸€æ ·.</span><br><span class="line"></span><br><span class="line">//toPlainStringå†equals</span><br><span class="line">System.out.println(c.toPlainString().equals(d.toPlainString())); //false</span><br><span class="line">System.out.println(c.toPlainString().equals(e.toPlainString())); //false</span><br><span class="line"></span><br><span class="line">//longValueæ–¹å¼</span><br><span class="line">System.out.println(c.longValue() == d.longValue()); //true</span><br><span class="line">System.out.println(c.longValue() == e.longValue()); //true</span><br><span class="line"></span><br><span class="line">//compareTo</span><br><span class="line">System.out.println(c.compareTo(d) == 0); //true</span><br><span class="line">System.out.println(c.compareTo(e) == 0); //true</span><br><span class="line"></span><br><span class="line">BigDecimal f = new BigDecimal(&quot;10.100001&quot;);</span><br><span class="line">BigDecimal g = new BigDecimal(10.100001);</span><br><span class="line">System.out.println(f.compareTo(g) == 0); //false</span><br><span class="line">// è¿™æ˜¯å› ä¸ºæœ¬èº«Doubleä¼ å‚çš„æ„é€ å°±ä¸å‡†ï¼Œçœ‹ä¸Šé¢</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š<a href="https://www.iteye.com/blog/bijian1013-2366549">https://www.iteye.com/blog/bijian1013-2366549</a></p>
<hr>
<h4 id="âœ…mysqlçš„decimal"><a href="#âœ…mysqlçš„decimal" class="headerlink" title="âœ…mysqlçš„decimal"></a>âœ…mysqlçš„decimal</h4><p>decimal:æ•°å­—å‹ï¼Œä¸å­˜åœ¨ç²¾åº¦æŸå¤±ï¼Œå¸¸ç”¨äºé“¶è¡Œå¸ç›®è®¡ç®—</p>
<p><code>distance decimal(10,1) not null default 0.0 comment &#39;è·ç¦»&#39;</code></p>
<p>decimal(P,m)<br>Pçš„å–å€¼èŒƒå›´æ˜¯1â€“65ï¼Œè¡¨ç¤ºæ•´æ•°ä½æ•°<br>Mçš„å–å€¼æ˜¯0â€“30.è¡¨ç¤ºå°æ•°ä½<br>ç²¾åº¦Mæœ€å¤§ä¸º30ï¼Œè¡¨ç¤ºæœ‰30ä½å°æ•°ã€‚<br>decimalæ•´æ•°å’Œå°æ•°ä½å‡ä¸å†™ é»˜è®¤ä¸ºdecimal(10,0)<br>è‹¥å°æ•°ä½ä¸å†™é»˜è®¤çš„å°æ•°ä½ä¸º0ã€‚</p>
<p>decimal(22,6ï¼‰è¡¨ç¤ºæ•´æ•°ä½16ä¸ªå°æ•°ä½6ä¸ªã€‚</p>
<p>decimal è¿˜å¯ä»¥å­˜å‚¨è¶…è¿‡bigintçš„æ•´æ•°ä½ï¼Œæœ€å¤§å­˜å‚¨65ä½çš„æ•´æ•°ç±»å‹ã€‚<br>è¿˜å¯ä»¥å­˜å‚¨å¯¹åº”ä½æ•°çš„è´Ÿæ•°</p>
<p>ä¾‹ï¼šdecimal(2,1)ï¼Œæ­¤æ—¶ï¼Œæ’å…¥æ•°æ®â€œ12.3â€ã€â€œ12â€ç­‰ä¼šå‡ºç°â€œæ•°æ®æº¢å‡ºé”™è¯¯â€çš„å¼‚å¸¸ï¼›æ’å…¥â€œ1.23â€æˆ–â€œ1.2345â€¦â€ä¼šè‡ªåŠ¨å››èˆäº”å…¥æˆâ€œ1.2â€ï¼›æ’å…¥â€œ2â€ä¼šè‡ªåŠ¨è¡¥æˆâ€œ2.0â€ï¼Œä»¥ç¡®ä¿2ä½çš„æœ‰æ•ˆé•¿åº¦ï¼Œå…¶ä¸­åŒ…å«1ä½å°æ•°ã€‚<br>å½“ç”¨ intç±»å‹ä¼šæœ‰æº¢å‡ºæ—¶ï¼Œå¯ä»¥ç”¨ decimal ç±»å‹è¿›è¡Œå¤„ç†ï¼ŒæŠŠç»“æœå¯ä»¥ç”¨ convert æˆ–æ˜¯ cast è¿›è¡Œè½¬æ¢ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/chenpp666/article/details/124372731">https://blog.csdn.net/chenpp666/article/details/124372731</a></p>
<h3 id="javaä½è¿ç®—"><a href="#javaä½è¿ç®—" class="headerlink" title="javaä½è¿ç®—"></a>javaä½è¿ç®—</h3><p>1ã€å·¦ç§»( &lt;&lt; )  å‘å·¦ç§»åŠ¨ï¼Œä½ä½è¡¥0<br>2ã€å³ç§»( &gt;&gt; )  å‘å³ç§»åŠ¨ï¼Œé«˜ä½è¡¥0<br>3ã€æ— ç¬¦å·å³ç§»( &gt;&gt;&gt; )   æ­£æ•°å³ç§»ï¼Œé«˜ä½è¡¥0ï¼Œè´Ÿæ•°å³ç§»ï¼Œé«˜ä½è¡¥1ï¼Œå½“è´Ÿæ•°ä½¿ç”¨æ— ç¬¦å·å³ç§»æ—¶ï¼Œç”¨0è¿›è¡Œè¡¥ä½(è‡ªç„¶è€Œç„¶çš„ï¼Œå°±ç”±è´Ÿæ•°å˜æˆäº†æ­£æ•°äº†)<br>4ã€ä¸( &amp; )  éƒ½ä¸º1ï¼Œç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0<br>5ã€æˆ–( | )  ä¸€ä¸ªæ˜¯1ï¼Œç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0<br>6ã€å¼‚æˆ–( ^ )  ä¸¤ä¸ªç›¸åï¼Œç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0<br>7ã€é( ~ ) ä¸€å…ƒæ“ä½œç¬¦   å–ç›¸åã€‚</p>
<h3 id="Autowiredæ¥å£è¿˜æ˜¯ç°å®ç±»ï¼Ÿ"><a href="#Autowiredæ¥å£è¿˜æ˜¯ç°å®ç±»ï¼Ÿ" class="headerlink" title="Autowiredæ¥å£è¿˜æ˜¯ç°å®ç±»ï¼Ÿ"></a>Autowiredæ¥å£è¿˜æ˜¯ç°å®ç±»ï¼Ÿ</h3><p>ç­”æ¡ˆï¼šæ¥å£å¥½</p>
<p>å½“å®ç°ç±»å”¯ä¸€æ—¶ï¼Œè¡¨é¢ä¸Šæ³¨å…¥æ¥å£ï¼Œå…¶å®æ³¨å…¥å®ç°ç±»<br>å½“å®ç°ç±»å¤šä¸ªæ—¶ï¼Œé€šè¿‡@Service(â€œmenuService1â€)æŒ‡å®šå®ç°ç±»</p>
<p>è§£æï¼š<br>è¿™ä¸ªå…¶å®æ˜¯åˆ›å»ºäº†å®ç°ç±»çš„å¯¹è±¡ä½†å¼•ç”¨äº†æ¥å£ç±»å‹ï¼Œ<br>å³ â€œInjectionDao injectionDao &#x3D; new InjectionDaoImpl ()â€, æ˜¯ Java å¤šæ€æ€§ï¼ˆå‘ä¸Šè½¬å‹ï¼‰çš„ä¸€ç§åº”ç”¨ã€‚<br>åœ¨å®ç°ç±»å¤„åŠ  @Repository æ³¨è§£ï¼Œæ„æ€å°±æ˜¯ new InjectionDaoImpl (),</p>
<p>è€Œåœ¨ InjectionServiceImpl ä¸­å®šä¹‰å±æ€§ InjectionDAO injectionDAO å°±æ˜¯å°† new å‡ºæ¥çš„è¿™ä¸ª InjectionDaoImpl å¯¹è±¡å‘ä¸Šè½¬å‹ä¸º InjectionDao ç±»å‹ã€‚</p>
<p>æ³¨æ„ï¼š<br>è‹¥ä¸€ä¸ªæ¥å£è¢«å¤šä¸ªå®ç°ç±»ï¼Œå®ç°çš„æ—¶å€™ï¼Œ@Autowiredï¼ŒSpring ä¼šæŒ‰ byType çš„æ–¹å¼å¯»æ‰¾æ¥å£çš„å®ç°ç±»ï¼Œå°†å…¶æ³¨å…¥ã€‚å­˜åœ¨å¤šä¸ªå®ç°ç±»ï¼Œåº”è¯¥æŒ‡å®šåå­—ï¼Œå¯ä»¥é€šè¿‡ byName æ³¨å…¥çš„æ–¹å¼ã€‚å¯ä»¥ä½¿ç”¨ @Resource æˆ– @Qualifier æ³¨è§£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å®ç°ç±»1</span><br><span class="line">@Service(&quot;menuService1&quot;)</span><br><span class="line">public class MenuServiceImpl implements IMenuService</span><br><span class="line"> </span><br><span class="line">//å®ç°ç±»2</span><br><span class="line">@Service(&quot;menuService2&quot;)</span><br><span class="line">public class MenuServiceImpl implements IMenuService</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//æ³¨å…¥æ¥å£ï¼Œç›¸å½“äºnewä¸€ä¸ªå®ç°ç±»ï¼ŒæŒ‡å®šåç§°menuService1å®ç°ç±»</span><br><span class="line">@Autowired</span><br><span class="line">@Qualifier(&quot;menuService1&quot;)</span><br><span class="line">private IMenuService menuService;</span><br><span class="line"></span><br><span class="line">//æ³¨å…¥æ¥å£ï¼Œç›¸å½“äºnewä¸€ä¸ªå®ç°ç±»ï¼ŒæŒ‡å®šåç§°menuService2å®ç°ç±»  </span><br><span class="line">@Autowired</span><br><span class="line">@Qualifier(&quot;menuService2&quot;)</span><br><span class="line">private IMenuService menuService;</span><br></pre></td></tr></table></figure>

<p>é“¾æ¥ï¼š<a href="https://blog.csdn.net/huangkechen/article/details/122475824">https://blog.csdn.net/huangkechen/article/details/122475824</a></p>
<p>æ€»ç»“ï¼šå°±æ˜¯Java å¤šæ€æ€§ï¼ˆå‘ä¸Šè½¬å‹ï¼‰çš„ä¸€ç§åº”ç”¨ï¼Œä½†æ˜¯è¿™æ ·åšçš„å¥½å¤„å¹¶æ²¡æœ‰è¯´ã€‚<br>è§„çŸ©ï¼šæ³¨å…¥å®ç°ç±»æ—¶ç”¨@Resourceï¼ˆ@Autowiredåº”è¯¥ä¹Ÿå¯ä»¥ï¼‰ï¼Œæ¥å£å•ä¸ªå®ç°ç±»ç”¨@Autowiredï¼ˆ@Resourceåº”è¯¥ä¹Ÿå¯ä»¥ï¼‰ï¼Œæ¥å£å¤šä¸ªå®ç°ç±»ç”¨@Autowired + @Qualifier(value&#x3D;â€â€) æˆ– @Resource(name&#x3D;â€â€)ã€‚</p>
<h3 id="Collectionã€Collectionsã€CollectionUtils"><a href="#Collectionã€Collectionsã€CollectionUtils" class="headerlink" title="Collectionã€Collectionsã€CollectionUtils"></a>Collectionã€Collectionsã€CollectionUtils</h3><p>Collection æ˜¯ä¸€ä¸ªé›†åˆæ¥å£ã€‚å®ƒæä¾›äº†å¯¹é›†åˆå¯¹è±¡è¿›è¡ŒåŸºæœ¬æ“ä½œçš„é€šç”¨æ¥å£æ–¹æ³•ã€‚Collectionæ¥å£åœ¨Java ç±»åº“ä¸­æœ‰å¾ˆå¤šå…·ä½“çš„å®ç°ã€‚Collectionæ¥å£çš„æ„ä¹‰æ˜¯ä¸ºå„ç§å…·ä½“çš„é›†åˆæä¾›äº†æœ€å¤§åŒ–çš„ç»Ÿä¸€æ“ä½œæ–¹å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Collectionï¼ˆå•ä¾‹é›†åˆ  ï¼‰ </span><br><span class="line">â”œ-Listï¼ˆæœ‰åºï¼Œå¯é‡å¤ ï¼‰  </span><br><span class="line">â”‚  â”œ-LinkedListï¼ˆæŸ¥è¯¢é€Ÿåº¦æ…¢ï¼Œå¢åˆ å¿«ï¼‰   </span><br><span class="line">â”‚  â”œ-ArrayListï¼ˆæŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œå¢åˆ æ…¢ï¼‰  </span><br><span class="line">â”‚  â””-Vectorï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼Œæ“ä½œæ•ˆç‡ä½ ï¼‰  </span><br><span class="line">â”‚ã€€    â””-Stack   </span><br><span class="line">â””-Setï¼ˆæ— åºï¼Œä¸å¯é‡å¤ï¼‰ </span><br><span class="line">      â”œ-HashSetï¼ˆä½¿ç”¨äº†å“ˆå¸Œè¡¨å­˜å–ï¼‰</span><br><span class="line">      â”‚    â””-LinkedHashSet</span><br><span class="line">      â””-SortedSet</span><br><span class="line">               â””-TreeSetï¼ˆæœ‰åºï¼‰</span><br><span class="line">Mapï¼ˆé”®å€¼å¯¹ï¼‰  </span><br><span class="line">â”œ-Hashtable   </span><br><span class="line">â”œ-HashMap   </span><br><span class="line">â””-WeakHashMap</span><br></pre></td></tr></table></figure>
<p>setæ˜¯åœ¨HashMapçš„åŸºç¡€ä¸Šå®ç°çš„ï¼ŒHashSetçš„å­˜å‚¨æ–¹å¼æ˜¯æŠŠHashMapä¸­çš„Keyä½œä¸ºSetçš„å¯¹åº”å­˜å‚¨é¡¹ã€‚HashMapæ˜¯éåŒæ­¥çš„ï¼Œçº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒHashtableè™½ç„¶æ˜¯åŒæ­¥çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å·²ç»è¿‡æœŸäº†ã€‚ ç°åœ¨ä½¿ç”¨ConcurrentHashMapï¼Œè¿™ä¸ªæ˜¯çº¿ç¨‹å®‰å…¨åŒæ­¥çš„ã€‚</p>
<p>Collections æ˜¯ä¸€ä¸ªåŒ…è£…ç±»ã€‚å®ƒåŒ…å«æœ‰å„ç§æœ‰å…³é›†åˆæ“ä½œçš„é™æ€å¤šæ€æ–¹æ³•ã€‚æ­¤ç±»ä¸èƒ½å®ä¾‹åŒ–ï¼Œå°±åƒä¸€ä¸ªå·¥å…·ç±»ï¼ŒæœåŠ¡äºJavaçš„Collectionæ¡†æ¶ã€‚</p>
<p>ä¾‹å¦‚ï¼šæ’åº(Sort)ã€å€’åº(reverse)ã€æœ€å¤§(max)ã€æœ€å°(min)ã€æ›¿æ¢(fill)</p>
<p>ä½¿ç”¨sortæ–¹æ³•å¯ä»¥æ ¹æ®å…ƒç´ çš„è‡ªç„¶é¡ºåºå¯¹æŒ‡å®šåˆ—è¡¨æŒ‰å‡åºè¿›è¡Œæ’åˆ—ã€‚åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ éƒ½å¿…é¡»å®ç°Comparableæ¥å£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Collections.sort(list);//æ’åº</span><br><span class="line">System.out.println(list);</span><br><span class="line">Collections.reverse(list);//å€’åº</span><br><span class="line">System.out.println(list);</span><br><span class="line">int max = Collections.max(list);//æœ€å¤§</span><br><span class="line">System.out.println(max);</span><br><span class="line">int min = Collections.min(list);//æœ€å°</span><br><span class="line"></span><br><span class="line">Collections.emptyList()  //ç©ºlist</span><br></pre></td></tr></table></figure>

<p>CollectionUtilsæ˜¯å¯¹Collectioné›†åˆæ“ä½œçš„ç±»æ–¹æ³•ï¼Œè¿™ä¸ªç±»ä¸æ˜¯javaè‡ªå¸¦çš„ç±»æ–¹æ³•ï¼Œéœ€è¦å¦å¤–å¯¼å…¥ä¸€ä¸ªcommons-collections.jaråŒ…æ‰å¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»ä¸­æ–¹æ³•ã€‚</p>
<p>ä¾‹å¦‚ï¼šCollectionUtils.isEmpty(list)<br>å®ƒå¯ä»¥å¤„ç†nullï¼Œä½†æ˜¯list.isEmptyé‡Œé¢ä¸ºnullï¼Œä¼šNPEã€‚</p>
<p>æ›´å¤šç”¨æ³•ï¼š<a href="https://blog.csdn.net/chaoge321/article/details/83788667">https://blog.csdn.net/chaoge321/article/details/83788667</a></p>
<h3 id="listçš„ä¸€äº›æ“ä½œ"><a href="#listçš„ä¸€äº›æ“ä½œ" class="headerlink" title="listçš„ä¸€äº›æ“ä½œ"></a>listçš„ä¸€äº›æ“ä½œ</h3><h4 id="ä¸€ã€Lists-newArrayList-å’Œ-new-ArrayList-ï¼š"><a href="#ä¸€ã€Lists-newArrayList-å’Œ-new-ArrayList-ï¼š" class="headerlink" title="ä¸€ã€Lists.newArrayList() å’Œ new ArrayList() ï¼š"></a>ä¸€ã€Lists.newArrayList() å’Œ new ArrayList() ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();</span><br><span class="line">List&lt;Integer&gt; list = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">Listså’ŒMapsæ˜¯è°·æ­Œçš„ä¸¤ä¸ªå·¥å…·ç±»,</span><br><span class="line"></span><br><span class="line">Lists.newArrayList()å…¶å®å’Œnew ArrayList()å‡ ä¹ä¸€æ¨¡ä¸€æ ·,</span><br><span class="line"></span><br><span class="line">å”¯ä¸€å®ƒå¸®ä½ åšçš„(å…¶å®æ˜¯javacå¸®ä½ åšçš„),å°±æ˜¯è‡ªåŠ¨æ¨å¯¼å°–æ‹¬å·é‡Œçš„æ•°æ®ç±»å‹.</span><br><span class="line"></span><br><span class="line">åœ¨ Java 7 ä¹‹åï¼Œéƒ½å…è®¸ç±»å‹æ¨æ–­ - åœ¨è¿è¡Œæ—¶æ²¡æœ‰åŒºåˆ«ã€‚</span><br><span class="line"></span><br><span class="line">java8 çš„new ArrayList&lt;&gt;()çš„&lt;&gt;é‡Œé¢å¯ä»¥ä¸å†™ç±»å‹ï¼Œjavaå›å¸®ä½ è‡ªåŠ¨æ¨å¯¼ç±»å‹</span><br><span class="line"></span><br><span class="line">List&lt;Integer&gt; list = new ArrayList&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œè¿˜æœ‰Setsï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set&lt;String&gt; sets = Sets.newHashSet(&quot;ww&quot;); //å¯ç›´æ¥å®šä¹‰</span><br><span class="line">Set&lt;String&gt; sets = new HashSet&lt;&gt;(Lists.newArrayList(&quot;11&quot;,&quot;22&quot;));</span><br><span class="line">//è¿˜å¾—ç”¨listè½¬æ¢</span><br><span class="line"></span><br><span class="line">setæ²¡æœ‰get(i)æ–¹æ³•ï¼Œéå†å¾—ç”¨è¿­ä»£å™¨ã€‚è¦ä¹ˆå…ˆè½¬æ¢æˆlistã€‚</span><br><span class="line">setè½¬æ¢ä¸ºlistï¼š</span><br><span class="line">ArrayList&lt;Long&gt; list = new ArrayList(set);</span><br></pre></td></tr></table></figure>

<p>æ–°å»ºListï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//List&lt;String&gt; list1 = new ArrayList&lt;String&gt;(&quot;1&quot;, &quot;2&quot;); ä¸è¡Œ</span><br><span class="line">List&lt;String&gt; list2 = Lists.newArrayList(&quot;1&quot;, &quot;2&quot;);</span><br><span class="line">list2.add(&quot;3&quot;);  //å’©é—®é¢˜</span><br><span class="line">System.out.println(list2);</span><br><span class="line">List&lt;String&gt; list3 = Arrays.asList(&quot;1&quot;, &quot;2&quot;);</span><br><span class="line">list3.set(1, &quot;3&quot;); //è®¾ç½®é™¤äº†0ã€1ä¼šæŠ¥é”™</span><br><span class="line">System.out.println(list3);</span><br><span class="line">list3.add(&quot;3&quot;);  //æŠ¥é”™ï¼šjava.lang.UnsupportedOperationException</span><br><span class="line">System.out.println(list3);</span><br><span class="line">List&lt;String&gt; list4 = Collections.singletonList(&quot;1&quot;);</span><br><span class="line">list4.add(&quot;2&quot;); //æŠ¥é”™ï¼šjava.lang.UnsupportedOperationException</span><br><span class="line"></span><br><span class="line">String a[] = new String[] &#123; &quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot; &#125;;</span><br><span class="line">List&lt;String&gt; list5 = Arrays.asList(a);</span><br></pre></td></tr></table></figure>

<p>âœ…Array.asListåˆ›å»ºæ–¹å¼ï¼š<br>java.util.Arrays ç±»çš„ asList() æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªç”±æŒ‡å®šæ•°ç»„æ”¯æŒçš„å›ºå®šå¤§å°çš„åˆ—è¡¨ã€‚<br>Arrays.asList æœ€å¤§ç‰¹ç‚¹æ˜¯æ•´ä¸ªé›†åˆå…è®¸æœ‰å¤šä¸ªå…ƒç´ å­˜å…¥æ•°ç»„ï¼Œä¸€æ—¦åˆå§‹åŒ–åï¼Œè¿™ä¸ªæ•°ç»„çš„é•¿åº¦å°±æ˜¯å›ºå®šçš„ï¼Œä½†æ•°ç»„çš„å…ƒç´ å¯ä»¥ä¿®æ”¹ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆ add å’Œ remove æ–¹æ³•æŠ¥é”™çš„åŸå› ã€‚å¦‚æœåœ¨å¼€å‘ä¸­ç¢°åˆ°é•¿åº¦å¯ä»¥ç¡®å®šçš„é›†åˆï¼Œå¹¶ä¸”åœ¨åˆå§‹åŒ–æ—¶å·²ç»ç¡®å®šäº†å‚¨å­˜å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨ã€‚<br>Arrays.asList ä¸­ä¼ å…¥çš„æ•°ç»„å‚æ•°ä¸­å…è®¸å­˜åœ¨ nullï¼Œä½†ä¸å…è®¸åªæœ‰ä¸€ä¸ª null</p>
<p>âœ…Collections.singletonList()åˆ›å»ºæ–¹å¼ï¼š<br>Collection.singletonList é•¿åº¦ä¸º 1ï¼Œåˆå§‹å®Œåä¸å¯ä¿®æ”¹ã€‚æ ¹æ®è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨å¼€å‘çš„æ—¶å€™é‡åˆ°åªè¦å‚¨å­˜ä¸€ä¸ªå…ƒç´ çš„é›†åˆï¼Œå¹¶ä¸”æ•´ä¸ªè¿‡ç¨‹å­˜å‚¨æˆ–è€…ä¼ é€’ä¸ºä¸»ï¼Œä¸ä¼šè¿›è¡Œä¿®æ”¹æˆ–è°ƒæ•´çš„æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨ã€‚<br>Collections.singletonList ä¸­ä¿å­˜å…ƒç´ çš„æ˜¯ä¸€ä¸ªå¯¹è±¡</p>
<p>âœ…Arrays.asList() å’Œ Collections.singletonList()åŒºåˆ« ï¼š<br>1ã€Arrays.asList()å¾—åˆ°çš„Listä¸­å…ƒç´ æ˜¯å¯å˜çš„ï¼Œå¤§å°ä¸å¯å˜ã€‚<br>è€ŒCollections.singletonListæ˜¯ä¸å¯å˜çš„ï¼Œä¸€æ—¦ä¿®æ”¹å°±ä¼šå¯¼è‡´UnsupportedOperationExceptionå¼‚å¸¸æŠ›å‡º<br>2ã€Collections.singletonList()å¾—åˆ°çš„Listå…ƒç´ åªèƒ½æœ‰1ä¸ª<br>3ã€Arrays.asList(strArray)ä¸å…·æœ‰addæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡setæ–¹æ³•è¿›è¡Œæ”¹å˜å€¼ã€‚Collections.singletonList()è¿”å›çš„æ˜¯ä¸å¯å˜çš„é›†åˆï¼Œä½†æ˜¯è¿™ä¸ªé•¿åº¦çš„é›†åˆåªæœ‰1ã€‚</p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_41606477/article/details/108449415">https://blog.csdn.net/weixin_41606477/article/details/108449415</a></p>
<p>æ–°å»ºSetï¼Œé™¤äº†ä¸Šé¢çš„ï¼Œè¿˜æœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set&lt;String&gt; list4 = Collections.singleton(&quot;1&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="äºŒã€å¯¹listæ’åºï¼šComparator-javaå·¥å…·ç±»"><a href="#äºŒã€å¯¹listæ’åºï¼šComparator-javaå·¥å…·ç±»" class="headerlink" title="äºŒã€å¯¹listæ’åºï¼šComparator-javaå·¥å…·ç±»"></a>äºŒã€å¯¹listæ’åºï¼šComparator-javaå·¥å…·ç±»</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list.sort(Comparator.comparing(A::getB));</span><br><span class="line"></span><br><span class="line">List&lt;ç±»&gt; list; ä»£è¡¨æŸé›†åˆ</span><br><span class="line"> </span><br><span class="line">//è¿”å› å¯¹è±¡é›†åˆä»¥ç±»å±æ€§ä¸€å‡åºæ’åº</span><br><span class="line">list.stream().sorted(Comparator.comparing(ç±»::å±æ€§ä¸€));</span><br><span class="line"> </span><br><span class="line">//è¿”å› å¯¹è±¡é›†åˆä»¥ç±»å±æ€§ä¸€é™åºæ’åº æ³¨æ„ä¸¤ç§å†™æ³•</span><br><span class="line">list.stream().sorted(Comparator.comparing(ç±»::å±æ€§ä¸€).reversed());//å…ˆä»¥å±æ€§ä¸€å‡åº,ç»“æœè¿›è¡Œå±æ€§ä¸€é™åº</span><br><span class="line">list.stream().sorted(Comparator.comparing(ç±»::å±æ€§ä¸€,Comparator.reverseOrder()));//ä»¥å±æ€§ä¸€é™åº</span><br><span class="line"> </span><br><span class="line">//è¿”å› å¯¹è±¡é›†åˆä»¥ç±»å±æ€§ä¸€å‡åº å±æ€§äºŒå‡åº</span><br><span class="line">list.stream().sorted(Comparator.comparing(ç±»::å±æ€§ä¸€).thenComparing(ç±»::å±æ€§äºŒ));</span><br><span class="line"> </span><br><span class="line">//è¿”å› å¯¹è±¡é›†åˆä»¥ç±»å±æ€§ä¸€é™åº å±æ€§äºŒå‡åº æ³¨æ„ä¸¤ç§å†™æ³•</span><br><span class="line">list.stream().sorted(Comparator.comparing(ç±»::å±æ€§ä¸€).reversed().thenComparing(ç±»::å±æ€§äºŒ));//å…ˆä»¥å±æ€§ä¸€å‡åº,å‡åºç»“æœè¿›è¡Œå±æ€§ä¸€é™åº,å†è¿›è¡Œå±æ€§äºŒå‡åº</span><br><span class="line">list.stream().sorted(Comparator.comparing(ç±»::å±æ€§ä¸€,Comparator.reverseOrder()).thenComparing(ç±»::å±æ€§äºŒ));//å…ˆä»¥å±æ€§ä¸€é™åº,å†è¿›è¡Œå±æ€§äºŒå‡åº</span><br><span class="line"></span><br><span class="line">//å«Nullæ•°æ®æ’åº,nullsLastç©ºçš„æ”¾åé¢ï¼Œè·ç¦»Dateç±»å‹å±æ€§</span><br><span class="line">list.stream().sorted(Comparator.comparing(item -&gt; item.å±æ€§, Comparator.nullsLast(Date::compareTo))).collect(Collectors.toList());</span><br><span class="line">// nullLastæˆ–nullFirsté‡Œé¢å¸¦ç±»å‹ï¼Œå¯ä»¥ç”¨Comparator.nullsLast(Comparator.naturalOrder()))</span><br><span class="line"></span><br><span class="line">//ç©º/Nullæ•°æ®åˆ†ç»„</span><br><span class="line">Map&lt;String, List&lt;ç±»&gt;&gt; map = list.stream().collect(Collectors.groupingBy(item -&gt; &#123;</span><br><span class="line">  if (item.å±æ€§ä¸€ == null || item.å±æ€§ä¸€.equals(&quot;&quot;)) &#123;</span><br><span class="line">  ã€€ã€€return &quot;&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  return DateFormat.getDateInstance().format(item.å±æ€§ä¸€);</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<p>listå¯ä»¥ç›´æ¥ä½¿ç”¨sortã€‚<br>ç”¨sortedå°±éœ€è¦å…ˆ.stream()ï¼Œå†.collect(Collectors.toList())<br>::éƒ½å¾—æ˜¯getå±æ€§</p>
<p>è‡ªå®šä¹‰æ’åºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Collections.sort(list, new Comparator&lt;listä¸­å…ƒç´ &gt;()&#123;</span><br><span class="line">  @Override</span><br><span class="line">  public int compare(å…ƒç´  o1, å…ƒç´  o2) &#123;</span><br><span class="line">    if(..)  return 1;  //è¡¨ç¤ºo1åœ¨å‰</span><br><span class="line">    if(..)  return 0;  //è¡¨ç¤ºä¸€æ ·</span><br><span class="line">    return -1ï¼›  //è¡¨ç¤ºo2åœ¨å‰</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="ä¸‰ã€listç§»é™¤ï¼š-removeIf"><a href="#ä¸‰ã€listç§»é™¤ï¼š-removeIf" class="headerlink" title="ä¸‰ã€listç§»é™¤ï¼š removeIf"></a>ä¸‰ã€listç§»é™¤ï¼š removeIf</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">removeIf() æ–¹æ³•ç”¨äºåˆ é™¤æ‰€æœ‰æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ•°ç»„å…ƒç´ ã€‚</span><br><span class="line">ArrayList&lt;String&gt; sites = new ArrayList&lt;&gt;();</span><br><span class="line">sites.add(&quot;Taobao&quot;);</span><br><span class="line">sites.removeIf(e -&gt; e.contains(&quot;Tao&quot;));</span><br><span class="line">ç”¨äº†Stringçš„containsæ–¹æ³•</span><br></pre></td></tr></table></figure>
<p>listå…ƒç´ å¯ä»¥å…ˆè®¾ç½®ï¼Œå†æ›´æ”¹ã€‚</p>
<p>ä¸èƒ½åœ¨å¾ªç¯ä¸­ç”¨æ­£åºç´¢å¼•è¿›è¡Œç§»é™¤ï¼Œå› ä¸ºç§»é™¤çš„è¿‡ç¨‹ä¸­ç´¢å¼•ä¼šå˜ã€‚<br>å¯ä»¥ç”¨å€’åºç´¢å¼•ã€‚<br>å¦‚æœéå¾—ç”¨å¾ªç¯ç§»é™¤ï¼Œç”¨è¿­ä»£å™¨ã€‚</p>
<p>forçš„ä¸‹æ ‡å€’åºéå†:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for (int i = list.size() - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">    if (&quot;b&quot;.equals(list.get(i))) &#123;</span><br><span class="line">        list.remove(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨list.stream().filter().collect()ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; newList = list.stream()</span><br><span class="line">        .filter(e -&gt; !&quot;b&quot;.equals(e))</span><br><span class="line">        .collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<p>ç”¨è¿­ä»£å™¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Iterator&lt;String&gt; it = list.iterator();</span><br><span class="line">while (it.hasNext()) &#123;</span><br><span class="line">    String s = it.next();</span><br><span class="line">    if (&quot;b&quot;.equals(s)) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ğŸ¤”æ€»ç»“ä¸€ä¸‹listç§»é™¤æ–¹æ³•ï¼š<br>1ã€removeIf<br>2ã€å€’å™forå¾ªç¯<br>3ã€stream filter<br>4ã€è¿­ä»£å™¨</p>
<p>âš ï¸è¿­ä»£å™¨ä¸­ï¼Œåˆç§»é™¤ï¼Œåˆå¯¹listå¢åŠ å…ƒç´ æ˜¯ä¸è¡Œçš„ï¼Œä¼šå¼•å‘å¹¶å‘é”™è¯¯ã€‚<br>mapä¹Ÿæ˜¯ä¸€æ ·ï¼Œç”¨Entryéå†æ—¶ï¼Œä¸èƒ½åˆremoveåˆputï¼Œè€Œä¸”å†å¾ªç¯é‡Œä¸èƒ½putæ–°çš„ï¼Œåªèƒ½putå·²æœ‰çš„ï¼Œä¸ç„¶ä¼šå¹¶å‘é”™è¯¯ã€‚ä¹Ÿä¸èƒ½removeã€‚ç”¨è¿­ä»£å™¨ç§»é™¤å…ƒç´ ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ›¿æ¢Listä¸­çš„å…ƒç´ ï¼Œç”¨setæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Long&gt; list = Lists.newArrayList(1L, 2L, 3L);</span><br><span class="line">list.set(1, 4L);  //[1, 4, 3]</span><br></pre></td></tr></table></figure>

<p>ã€JAVAã€‘Listå¸¸ç”¨ç§»é™¤ã€è¿‡æ»¤ã€å»é‡ã€flatMapã€peekç­‰æ“ä½œï¼š<br><a href="https://blog.csdn.net/qq_38397501/article/details/116494227">https://blog.csdn.net/qq_38397501/article/details/116494227</a></p>
<h4 id="å››ã€åˆ¤æ–­listä¸ºç©º"><a href="#å››ã€åˆ¤æ–­listä¸ºç©º" class="headerlink" title="å››ã€åˆ¤æ–­listä¸ºç©º"></a>å››ã€åˆ¤æ–­listä¸ºç©º</h4><p>if(CollectionUtils.isEmpty(list)){}</p>
<h4 id="äº”ã€indexOfæ–¹æ³•"><a href="#äº”ã€indexOfæ–¹æ³•" class="headerlink" title="äº”ã€indexOfæ–¹æ³•"></a>äº”ã€indexOfæ–¹æ³•</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">indexOf() æ–¹æ³•è¿”å›åŠ¨æ€æ•°ç»„ä¸­å…ƒç´ çš„ç´¢å¼•å€¼ã€‚</span><br><span class="line">int i = arraylist.indexOf(Object obj)</span><br></pre></td></tr></table></figure>

<h4 id="å…­ã€listã€setã€Stringè½¬æ¢"><a href="#å…­ã€listã€setã€Stringè½¬æ¢" class="headerlink" title="å…­ã€listã€setã€Stringè½¬æ¢"></a>å…­ã€listã€setã€Stringè½¬æ¢</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//listç›´æ¥å˜setï¼š</span><br><span class="line">Set&lt;Long&gt; set2 = new HashSet&lt;&gt;(list);</span><br><span class="line">Set&lt;Long&gt; set1 = Sets.newHashSet(list);</span><br><span class="line">//setå˜listï¼š</span><br><span class="line">List&lt;Long&gt; list2 = new ArrayList&lt;&gt;(set1);</span><br><span class="line">List&lt;Long&gt; list3 = Lists.newArrayList(set1);</span><br></pre></td></tr></table></figure>

<p>,åˆ†å‰²çš„Stringè½¬æ¢ä¸ºListï¼Œçœ‹ä¸‹é¢Splitterã€‚</p>
<p>Listè½¬æ¢ä¸º,åˆ†å‰²å­—ç¬¦ä¸²ï¼Œçœ‹ä¸‹é¢Joinerè¿æ¥å­—ç¬¦ä¸²ã€‚</p>
<h4 id="ä¸ƒã€foreach"><a href="#ä¸ƒã€foreach" class="headerlink" title="ä¸ƒã€foreach"></a>ä¸ƒã€foreach</h4><p>forEach() æ–¹æ³•ç”¨äºéå†åŠ¨æ€æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ å¹¶æ‰§è¡Œç‰¹å®šæ“ä½œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testArray()&#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; numbers = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    // å¾€æ•°ç»„ä¸­æ·»åŠ å…ƒç´ </span><br><span class="line">    numbers.add(1);</span><br><span class="line">    numbers.add(2);</span><br><span class="line">    numbers.add(3);</span><br><span class="line">    numbers.add(4);</span><br><span class="line">    System.out.println(&quot;ArrayList: &quot; + numbers);</span><br><span class="line"></span><br><span class="line">    // å°† lambda è¡¨è¾¾å¼ä¼ é€’ç»™ forEach</span><br><span class="line">    numbers.forEach((e) -&gt; &#123;</span><br><span class="line">        System.out.print(e + &quot; &quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forEach å¢å¼ºforå¾ªç¯ï¼Œç”¨äºéå†åŠ¨æ€æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ å¹¶æ‰§è¡Œç‰¹å®šæ“ä½œã€‚</p>
<p>Listçš„forEachæ˜¯åœ¨Iterableç±»ä¸­ï¼Œ<code>Collection&lt;E&gt; extends Iterable&lt;E&gt;</code>ï¼Œstreamçš„forEachåœ¨Streamä¸­ã€‚</p>
<p>Iterableä¸­çš„æ–¹æ³•åŸå‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">default void forEach(Consumer&lt;? super T&gt; action) &#123;</span><br><span class="line">    Objects.requireNonNull(action);</span><br><span class="line">    for (T t : this) &#123;</span><br><span class="line">        action.accept(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âš ï¸ä½¿ç”¨ä¸­å‡ºç°ï¼šæç¤ºVariable used in lambda expression should be final or effectively final</p>
<p>è¿™å¥è¯çš„æ„æ€æ˜¯ï¼šlambdaè¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„å˜é‡åº”è¯¥æ˜¯finalæˆ–è€…æœ‰æ•ˆçš„finalã€‚</p>
<p>å…¶å®åœ¨ Java 8 ä¹‹å‰ï¼š<br>åŒ¿åç±»ä¸­å¦‚æœè¦è®¿é—®å±€éƒ¨å˜é‡çš„è¯ï¼Œé‚£ä¸ªå±€éƒ¨å˜é‡å¿…é¡»æ˜¾å¼çš„å£°æ˜ä¸ºfinalã€‚<br>lambdaè¡¨è¾¾å¼æ˜¯ç”±åŒ¿åå†…éƒ¨ç±»æ¼”å˜è¿‡æ¥çš„ï¼Œä»–ä»¬çš„ä½œç”¨éƒ½æ˜¯å®ç°æ¥å£æ–¹æ³•ï¼Œäºæ˜¯ç±»æ¯”åŒ¿åå†…éƒ¨ç±»ï¼Œlambdaè¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„å˜é‡ä¹Ÿéœ€è¦æ˜¯finalç±»å‹ã€‚</p>
<p>æ‰€ä»¥ï¼šéœ€è¦èµ‹å€¼åˆ°å¦ä¸€ä¸ªå˜é‡ä¸­ä½¿ç”¨ã€‚å¹¶ä¸”ä¸ºfinalç±»å‹ï¼Œä¸æ˜¯finalç±»å‹ä¹Ÿå¯ä»¥ï¼Œå˜é‡åä¸­åŠ finalã€‚<br>å› ä¸ºï¼šJava 8 ä¹‹åï¼Œåœ¨åŒ¿åç±»æˆ– Lambda è¡¨è¾¾å¼ä¸­è®¿é—®çš„å±€éƒ¨å˜é‡ï¼Œå¦‚æœä¸æ˜¯ final ç±»å‹çš„è¯ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨åŠ ä¸Š final ä¿®é¥°ç¬¦ã€‚</p>
<p>ä¸ºä»€ä¹ˆ lambda è¡¨è¾¾å¼æˆ–è€…åŒ¿åå†…éƒ¨ç±»ä¸èƒ½è®¿é—®é final çš„å±€éƒ¨å˜é‡ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å…¶å®è¿™å°±è¦è¯´åˆ°Jvmå†…å­˜æ¨¡å‹å’Œçº¿ç¨‹äº†ï¼Œå› ä¸ºå®ä¾‹å˜é‡å­˜åœ¨å †ä¸­ï¼Œè€Œå±€éƒ¨å˜é‡æ˜¯åœ¨æ ˆä¸Šåˆ†é…ï¼Œ<strong>lambda è¡¨è¾¾(åŒ¿åå†…éƒ¨ç±») ä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ</strong>ã€‚å¦‚æœåœ¨çº¿ç¨‹ä¸­è¦ç›´æ¥è®¿é—®ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå¯èƒ½çº¿ç¨‹æ‰§è¡Œæ—¶è¯¥å±€éƒ¨å˜é‡å·²ç»è¢«é”€æ¯äº†ï¼Œè€Œ final ç±»å‹çš„å±€éƒ¨å˜é‡åœ¨ Lambda è¡¨è¾¾å¼(åŒ¿åç±») ä¸­å…¶å®æ˜¯å±€éƒ¨å˜é‡çš„ä¸€ä¸ªæ‹·è´ã€‚</p>
<p>è½¬è‡ªï¼š<a href="https://www.liangzl.com/get-article-detail-213550.html">https://www.liangzl.com/get-article-detail-213550.html</a></p>
<p>æ‰€ä»¥è¿™ä¸ªé—®é¢˜çš„åŸå› ä¸åœ¨forEachï¼Œè€Œæ˜¯åœ¨lambdaè¡¨è¾¾å¼ã€‚<br>javaçš„lambdaè¡¨è¾¾å¼é‡Œä¸èƒ½å‡ºç°å˜é‡ï¼Œå¿…é¡»æ˜¯finalä¿®é¥°çš„ï¼Œä½†æ˜¯å¯ä»¥è®©å˜é‡åœ¨å®šä¹‰æ—¶å€™å°±å†™å…¥ï¼Œè¿™æ ·å°±ä¸ç®—å˜é‡äº†ã€‚å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Œä¸å†æŠ¥é”™ã€‚ï¼ˆåªå®šä¹‰ä¸€æ¬¡ä¸å†æ”¹ï¼Œå¦‚æœæ˜¯éœ€è¦å¤šæ­¥æ‰èƒ½å®šä¹‰å‡ºå˜é‡ï¼Œé‚£å°±å†™ä¸ªæ–¹æ³•å‡ºç»“æœä¹Ÿå¯ä»¥ï¼‰</p>
<p>ä¸è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">boolean ebola = false;</span><br><span class="line">ebola = list.size()&gt;10;//èµ‹å€¼</span><br><span class="line">taskExecutor.execute(() -&gt; &#123;</span><br><span class="line">  if(ebola)&#123;</span><br><span class="line">       //ä¸šåŠ¡ä»£ç </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">boolean ebola = checkEbola(list);//ç›¸å½“äºå®šä¹‰æ—¶ç›´æ¥èµ‹å€¼</span><br><span class="line">taskExecutor.execute(() -&gt; &#123;</span><br><span class="line">  if(ebola)&#123;</span><br><span class="line">       //ä¸šåŠ¡ä»£ç </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">private boolean checkEbola(ArrayList&lt;Object&gt; list)&#123;</span><br><span class="line">  return list.size()&gt;10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="å…«ã€Listæˆªå–"><a href="#å…«ã€Listæˆªå–" class="headerlink" title="å…«ã€Listæˆªå–"></a>å…«ã€Listæˆªå–</h4><p>Listè‡ªå·±çš„suubListæ–¹æ³•ï¼Œä¼ å‚æ•°èµ·å§‹ç´¢å¼•å’Œç»ˆç‚¹ç´¢å¼•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2() &#123;</span><br><span class="line">    List&lt;Long&gt; list = Lists.newArrayList(1L, 2L, 3L);</span><br><span class="line">    System.out.println(list.subList(1, list.size()));</span><br><span class="line">    // 2,3</span><br><span class="line"></span><br><span class="line">    // æ–°å»ºå›ºå®šå¤§å°çš„List</span><br><span class="line">    List&lt;Long&gt; list1 = Lists.newArrayListWithExpectedSize(3);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¹ã€æ•°ç»„è½¬æ¢ä¸ºList"><a href="#ä¹ã€æ•°ç»„è½¬æ¢ä¸ºList" class="headerlink" title="ä¹ã€æ•°ç»„è½¬æ¢ä¸ºList"></a>ä¹ã€æ•°ç»„è½¬æ¢ä¸ºList</h4><p>åŸæ–‡ï¼š<a href="https://www.jb51.net/article/221887.htm">https://www.jb51.net/article/221887.htm</a></p>
<p>1ã€ä½¿ç”¨ArrayList.asList(strArray)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String[] str = &#123;&quot;fgx&quot;, &quot;lzy&quot;&#125;;</span><br><span class="line">//æ³¨æ„è¿™ä¸ªListä¸æ˜¯CollectionsåŒ…å†…çš„List,è€Œæ˜¯utilåŒ…é‡Œé¢çš„Listæ¥å£</span><br><span class="line">List&lt;String&gt; ints = Arrays.asList(str);</span><br><span class="line">//è¿™é‡Œä¼šæŠ¥é”™</span><br><span class="line">ints.add(&quot;laopo&quot;);</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨Arrayså·¥å…·ç±»Arrays.asList(strArray)æ–¹å¼,è½¬æ¢å®Œæˆå,åªèƒ½å¯¹Listæ•°ç»„è¿›è¡ŒæŸ¥æ”¹,ä¸èƒ½å¢åˆ ,å¢åˆ å°±ä¼šæŠ›å‡ºUnsupportedOperationException å¼‚å¸¸ã€‚<br>æŠ¥é”™åŸå› :Arrays.asList(str)è¿”å›å€¼æ˜¯java.util.Arraysç±»ä¸­ä¸€ä¸ªç§æœ‰é™æ€å†…éƒ¨ç±» java.utiil.Arrays.Arraylist,å¹¶ä¸æ˜¯æˆ‘ä»¬å¹³æ—¶ç”¨çš„java.util.ArrayList();</p>
<p>âš ï¸ï¼šä½¿ç”¨çš„asList()æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªfinalçš„,å›ºå®šé•¿åº¦çš„ArrayListç±»ï¼Œå¹¶ä¸æ˜¯java.util.ArrayListï¼Œç›´æ¥è¿™æ ·åˆ©ç”¨å®ƒè¿›è¡Œadd()æˆ–remove()æ˜¯æ— æ•ˆçš„ã€‚</p>
<p>2ã€ä½¿ç”¨new ArrayList(Arrays.asList(strArray))</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//æ³¨æ„è¿™ä¸ªListä¸æ˜¯CollectionsåŒ…å†…çš„List,è€Œæ˜¯utilåŒ…é‡Œé¢çš„Listæ¥å£</span><br><span class="line">java.util.ArrayList&lt;String&gt; strings = new ArrayList&lt;&gt;(Arrays.asList(str));</span><br><span class="line">strings.add(&quot;aop&quot;);</span><br><span class="line">strings.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ArrayListçš„æ„é€ å™¨,å°†Arrays.asList(strArray)çš„è¿”å›å€¼ç”±java.utilArrays.ArrayListè½¬ä¸ºjava.util.ArrayList.</p>
<p>3ã€é›†åˆå·¥å…·ç±»Collections.addAll()æ–¹æ³•ï¼ˆç”¨è¿™ä¸ªï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String[] str = &#123;&quot;fgx&quot;, &quot;lzy&quot;&#125;;</span><br><span class="line">java.util.ArrayList&lt;String&gt; stringList = new ArrayList&lt;&gt;(str.length);</span><br><span class="line">Collections.addAll(stringList,str);</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡Collections.addAll(arrayList, strArray)æ–¹å¼è½¬æ¢ï¼Œæ ¹æ®æ•°ç»„çš„é•¿åº¦åˆ›å»ºä¸€ä¸ªé•¿åº¦ç›¸åŒçš„Listï¼Œç„¶åé€šè¿‡Collections.addAll()æ–¹æ³•ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ è½¬ä¸ºäºŒè¿›åˆ¶ï¼Œç„¶åæ·»åŠ åˆ°Listä¸­ï¼Œè¿™æ˜¯æœ€é«˜æ•ˆçš„æ–¹æ³•ã€‚</p>
<p>4ã€JDK8çš„Streamæµå°†3æ€»åŸºæœ¬ç±»å‹æ•°ç»„è½¬ä¸ºList</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">long[] longs = &#123;1, 2, 3&#125;;</span><br><span class="line">double[] doubles = &#123;1, 2, 3&#125;;</span><br><span class="line">Arrays.stream(ints).boxed().collect(Collectors.toList());</span><br><span class="line">Arrays.stream(longs).boxed().collect(Collectors.toList());</span><br><span class="line">Arrays.stream(doubles).boxed().collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<p>å¦‚æœJDKç‰ˆæœ¬åœ¨1.8ä»¥ä¸Š,ä½¿ç”¨æµstreamæ¥å°†ä¸‹åˆ—3ç§æ•°ç»„å¿«é€Ÿè½¬ä¸ºList,åˆ†åˆ«æ˜¯int[],long[],double[],ä¸æ”¯æŒshort[ ],byte[ ],char[]åœ¨JDK1.8ä¸­æš‚ä¸æ”¯æŒ.</p>
<p>âš ï¸ ä¸èƒ½æŠŠåŸºæœ¬æ•°æ®ç±»å‹è½¬åŒ–ä¸ºåˆ—è¡¨<br>asListæ¥å—çš„å‚æ•°æ˜¯ä¸€ä¸ªæ³›å‹çš„å˜é•¿å‚æ•°ï¼Œè€ŒåŸºæœ¬æ•°æ®ç±»å‹æ˜¯æ— æ³•æ³›å‹åŒ–çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int [] intarray = &#123; 1 ,  2 ,  3 ,  4 ,  5 &#125;;</span><br><span class="line">//List&lt;Integer&gt; list = Arrays.asList(intarray); ç¼–è¯‘é€šä¸è¿‡</span><br><span class="line">List&lt; int []&gt; list = Arrays.asList(intarray);  //è¾“å‡ºä¸€ä¸ªint[]å…ƒç´ çš„list</span><br></pre></td></tr></table></figure>

<p>è¦æƒ³æŠŠåŸºæœ¬æ•°æ®ç±»å‹çš„æ•°ç»„è½¬åŒ–ä¸ºå…¶åŒ…è£…ç±»å‹çš„listï¼Œå¯ä»¥ä½¿ç”¨guavaç±»åº“çš„å·¥å…·æ–¹æ³•â€œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int [] intArray = &#123; 1 ,  2 ,  3 ,  4 &#125;;</span><br><span class="line">List&lt;Integer&gt; list = Ints.asList(intArray);</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆint[]ä¸èƒ½ç›´æ¥è½¬ä¸ºList,è€ŒInteger[]å¯ä»¥è½¬ä¸ºList,è€ŒInteger[]å°±å¯ä»¥è½¬ä¸ºListäº†,å› ä¸ºListä¸­çš„æ³›å‹å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹ã€‚ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>âš ï¸asListæ–¹æ³•è¿”å›çš„æ˜¯æ•°ç»„çš„ä¸€ä¸ªè§†å›¾</p>
<p>è§†å›¾æ„å‘³ç€ï¼Œå¯¹è¿™ä¸ªlistçš„æ“ä½œéƒ½ä¼šåæ˜ åœ¨åŸæ•°ç»„ä¸Šï¼Œè€Œä¸”è¿™ä¸ªlistæ˜¯å®šé•¿çš„ï¼Œä¸æ”¯æŒaddã€removeç­‰æ”¹å˜é•¿åº¦çš„æ–¹æ³•ã€‚</p>
<h4 id="åã€Listè½¬ä¸ºæ•°ç»„"><a href="#åã€Listè½¬ä¸ºæ•°ç»„" class="headerlink" title="åã€Listè½¬ä¸ºæ•°ç»„"></a>åã€Listè½¬ä¸ºæ•°ç»„</h4><p>ä¸€èˆ¬æ•°ç»„æ˜¯ä¸èƒ½æ·»åŠ å…ƒç´ çš„ï¼Œå› ä¸ºä»–ä»¬åœ¨åˆå§‹åŒ–æ—¶å°±å·²å®šå¥½é•¿åº¦äº†ï¼Œä¸èƒ½æ”¹å˜é•¿åº¦ã€‚</p>
<p>1ã€ list.toArray();</p>
<p>ç›´æ¥å°† list è½¬æ¢æˆ Object[] ç±»å‹çš„ æ•°ç»„ï¼›<br>Object ï¼š å¯¹è±¡ç±»ï¼Œæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»</p>
<p><code>Object[]  ans1 = list.toArray();</code></p>
<p>2ã€list.toArray(T[] a);</p>
<p>è¾“å‡ºæŒ‡å®šç±»å‹çš„æ•°ç»„ï¼Œè¾“å‡ºçš„æ•°ç»„ç±»å‹ä¸æ‹¬å·ä¸­å‚æ•°ç±»å‹ä¸€è‡´ï¼›<br>å¿…é¡»æ˜¯åŒ…è£…ç±»ï¼ˆStringã€Integerã€Characterç­‰ï¼‰ï¼Œä¸èƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹äº†ï¼ˆstringã€intã€charï¼‰ï¼›<br>&#x2F;&#x2F; åˆ›å»ºæ•°ç»„æ—¶ï¼š int [ ] arr &#x3D; new int [ ] {}; ä½¿ç”¨çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹</p>
<p><code>Integer[] ans2 = list.toArray(new Integer[list.size()]);</code><br>æ³¨æ„ï¼šideaæç¤ºç”¨ç©ºçš„ï¼š<br><code>Integer[] ans2 = list.toArray(new Integer[0]);</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åˆ›å»ºä¸€ä¸ªlistï¼Œå¹¶ä¸”å¯¹listèµ‹å€¼        </span><br><span class="line">List&lt;Integer&gt;  list = new ArrayList&lt;&gt;();       </span><br><span class="line">for (int i = 1; i &lt; 11; i++) &#123;</span><br><span class="line">        list.add(i);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">//æ–¹æ³•ä¸€ï¼š</span><br><span class="line">Object[]  ans1 = list.toArray();</span><br><span class="line">System.out.println(&quot;1:&quot; + Arrays.toString(ans1));</span><br><span class="line"> </span><br><span class="line">// æ–¹æ³•äºŒï¼š</span><br><span class="line">Integer[] ans2 = list.toArray(new Integer[list.size()]);</span><br><span class="line">System.out.println(&quot;2:&quot; + Arrays.toString(ans2));</span><br><span class="line"> </span><br><span class="line">1:[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span><br><span class="line">2:[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span><br></pre></td></tr></table></figure>


<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/Gc_680/article/details/122568085">https://blog.csdn.net/Gc_680/article/details/122568085</a></p>
<h4 id="åã€åˆ†å‰²list"><a href="#åã€åˆ†å‰²list" class="headerlink" title="åã€åˆ†å‰²list"></a>åã€åˆ†å‰²list</h4><p>Listsçš„æ–¹æ³•ï¼Œcom.google.guavaä¸­ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ï¼šlisté›†åˆä¸­æ•°æ®é‡è¿‡å¤§ï¼Œå¯æ ¹æ®éœ€è¦è¿›è¡Œæ‹†åˆ†ï¼Œè¿›è€Œé€šè¿‡å¾ªç¯æˆ–è€…å¤šçº¿ç¨‹æ¥å¤„ç†æ•°æ®ã€‚<br>æˆ–è€…æ˜¯listæ‹†åˆ†åï¼Œåˆ†æ‰¹æ’å…¥æ•°æ®åº“ã€‚<br>Lists.partitionæ–¹æ³•ï¼Œæ ¹æ®ä¼ å…¥çš„sizeï¼Œå¯¹listè¿›è¡Œæ‹†åˆ†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å°†é›†åˆlistæŒ‰ç…§ 2 ä¸ªå…ƒç´ ä¸€ä»½è¿›è¡Œåˆ’åˆ†</span><br><span class="line">List&lt;List&lt;String&gt;&gt; partition = Lists.partition(list, 2);</span><br></pre></td></tr></table></figure>

<h4 id="åä¸€ã€listæ ¹æ®å¯¹è±¡ä¸­æŸä¸€å…ƒç´ å»é‡"><a href="#åä¸€ã€listæ ¹æ®å¯¹è±¡ä¸­æŸä¸€å…ƒç´ å»é‡" class="headerlink" title="åä¸€ã€listæ ¹æ®å¯¹è±¡ä¸­æŸä¸€å…ƒç´ å»é‡"></a>åä¸€ã€listæ ¹æ®å¯¹è±¡ä¸­æŸä¸€å…ƒç´ å»é‡</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import lombok.Getter;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.Setter;</span><br><span class="line">import lombok.ToString;</span><br><span class="line"></span><br><span class="line">import java.util.*;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-09-11 22:25</span><br><span class="line"> **/</span><br><span class="line">public class TestRemoveDup &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *     TreeSetçš„æœ¬è´¨æ˜¯ä¸€ä¸ª&quot;æœ‰åºçš„ï¼Œå¹¶ä¸”æ²¡æœ‰é‡å¤å…ƒç´ &quot;çš„é›†åˆï¼Œå®ƒæ˜¯é€šè¿‡TreeMapå®ç°çš„ã€‚</span><br><span class="line">     *     TreeSetæ³¨æ„äº‹é¡¹ï¼š</span><br><span class="line">     *     å¦‚æœå‘TreeSeté›†åˆä¸­æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå…ƒç´ æœ¬èº«æ²¡æœ‰å…·å¤‡è‡ªç„¶é¡ºåºçš„ç‰¹æ€§ï¼Œå¹¶ä¸”å…ƒç´ æ‰€å±çš„ç±»ä¹Ÿæ²¡æœ‰</span><br><span class="line">     *     å®ç°Comparableæ¥å£ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨åˆ›å»ºTreeSetå¯¹è±¡çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼›</span><br><span class="line">     */</span><br><span class="line">    //æ ¹æ®åå­—è¿›è¡Œæ¯”è¾ƒï¼Œç›¸ç­‰æ—¶TreeSetä¼šå°†è¯¥å…ƒç´ è§†ä¸ºé‡å¤å…ƒç´ ï¼Œä¸å…è®¸æ·»åŠ ï¼›</span><br><span class="line">    private List&lt;Person&gt; removeDupByName(List&lt;Person&gt; people) &#123;</span><br><span class="line">        Set&lt;Person&gt; personSet = new TreeSet&lt;&gt;(Comparator.comparing(Person::getName));</span><br><span class="line">        personSet.addAll(people);</span><br><span class="line">        return new ArrayList&lt;&gt;(personSet);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private List&lt;Person&gt; removeDupByName2(List&lt;Person&gt; people) &#123;</span><br><span class="line">        List&lt;Person&gt; unique = people.stream().collect(</span><br><span class="line">                Collectors.collectingAndThen(</span><br><span class="line">                        Collectors.toCollection(() -&gt; new TreeSet&lt;&gt;(Comparator.comparing(Person::getName))), ArrayList::new)</span><br><span class="line">        );</span><br><span class="line">        return unique;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //filterçš„ä½¿ç”¨æ–¹å¼ä¸ºï¼š filter(item -&gt; itemçš„é€»è¾‘åˆ¤æ–­ ) ï¼Œå…¶ä¸­filterä¼šä¿ç•™åˆ¤æ–­æ¡ä»¶ä¸ºtrueçš„è®°å½•</span><br><span class="line">    private List&lt;Person&gt; removeDupByName3(List&lt;Person&gt; people) &#123;</span><br><span class="line">        //ç”¨ä¸€ä¸ªnameçš„listå»é‡ï¼Œæ²¡ç”¨TreeSet</span><br><span class="line">        List&lt;String&gt; names = new ArrayList&lt;&gt;();//ç”¨æ¥ä¸´æ—¶å­˜å‚¨personçš„id</span><br><span class="line"></span><br><span class="line">        List&lt;Person&gt; personList = people.stream().filter(// è¿‡æ»¤å»é‡</span><br><span class="line">                v -&gt; &#123;</span><br><span class="line">                    boolean flag = !names.contains(v.getName());</span><br><span class="line">                    names.add(v.getName());</span><br><span class="line">                    return flag;</span><br><span class="line">                &#125;</span><br><span class="line">        ).collect(Collectors.toList());</span><br><span class="line">        return personList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;Person&gt; people = new ArrayList&lt;&gt;();</span><br><span class="line">        Person p1 = new Person(&quot;Liu&quot;,30);</span><br><span class="line">        people.add(p1);</span><br><span class="line">        Person p2 = new Person(&quot;Mi&quot;,36);</span><br><span class="line">        people.add(p2);</span><br><span class="line">        Person p3 = new Person(&quot;Liu&quot;,31);</span><br><span class="line">        people.add(p3);</span><br><span class="line">        TestRemoveDup testRemoveDup = new TestRemoveDup();</span><br><span class="line"></span><br><span class="line">        List&lt;Person&gt; people1 = testRemoveDup.removeDupByName(people);</span><br><span class="line">        List&lt;Person&gt; people2 = testRemoveDup.removeDupByName2(people);</span><br><span class="line">        List&lt;Person&gt; people3 = testRemoveDup.removeDupByName3(people);</span><br><span class="line">        System.out.println(people1);</span><br><span class="line">        System.out.println(people2);</span><br><span class="line">        System.out.println(people3);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Getter</span><br><span class="line">    @Setter</span><br><span class="line">    @ToString</span><br><span class="line">    @RequiredArgsConstructor</span><br><span class="line">    static class Person &#123;</span><br><span class="line">        private final String name;</span><br><span class="line">        private final Integer age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ç¬¬ä¸‰ç§ï¼Œç”¨filteræ–¹æ³•ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¼˜é›…ä¸€ç‚¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">unique = books.stream().filter(distinctByKey(o -&gt; o.getId())).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">private static &lt;T&gt; Predicate&lt;T&gt; distinctByKey(Function&lt;? super T, ?&gt; keyExtractor) &#123;</span><br><span class="line">    Map&lt;Object, Boolean&gt; seen = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line">    return t -&gt; seen.putIfAbsent(keyExtractor.apply(t), Boolean.TRUE) == null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filteræ ¹æ®Predicateè¿”å›çš„å¸ƒå°”å€¼æ¥åˆ¤æ–­æ˜¯å¦è¦è¿‡æ»¤æ‰ï¼Œ</span><br><span class="line">ä¼šè¿‡æ»¤æ‰è¿”å›å€¼ä¸ºfalseçš„æ•°æ®ã€‚</span><br><span class="line">è€Œæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„distinctByKeyè¿”å›å€¼å°±æ˜¯Predicateï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸ºå‚æ•°ä¼ å…¥filterã€‚</span><br><span class="line"></span><br><span class="line">distinctByKeyä¹Ÿéœ€è¦ä¸€ä¸ªFunctionçš„å‚æ•°ã€‚</span><br><span class="line">distinctByKeyå…ˆæ˜¯å®šä¹‰äº†ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Map(ç›¸æ¯”äºHashtableä»¥åŠCollections.synchronizedMap()ï¼Œ</span><br><span class="line">ConcurrentHashMapåœ¨çº¿ç¨‹å®‰å…¨çš„åŸºç¡€ä¸Šæä¾›äº†æ›´å¥½çš„å†™å¹¶å‘èƒ½åŠ›ï¼Œ</span><br><span class="line">ä½†åŒæ—¶é™ä½äº†å¯¹è¯»ä¸€è‡´æ€§çš„è¦æ±‚)ï¼Œå› ä¸ºåœ¨æµè®¡ç®—ä¸­æ˜¯å¤šçº¿ç¨‹å¤„ç†çš„ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨ã€‚</span><br><span class="line"></span><br><span class="line">ç„¶åå°†å€¼ä½œä¸ºkey,TRUEä½œä¸ºvalue putåˆ°mapä¸­ã€‚</span><br><span class="line">è¿™é‡Œçš„putæ–¹æ³•ä½¿ç”¨çš„æ˜¯putIfAbsent()ã€‚</span><br><span class="line">putIfAbsent()æ–¹æ³•æ˜¯å¦‚æœkeyä¸å­˜åœ¨åˆ™putå¦‚mapä¸­ï¼Œå¹¶è¿”å›nullã€‚è‹¥keyå­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›keyæ‰€å¯¹åº”çš„valueå€¼ã€‚</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/zwh0910/p/15877284.html</span><br></pre></td></tr></table></figure>


<h4 id="åäºŒã€list-addå’ŒaddAllçš„ä¸€ä¸ªNPEé—®é¢˜"><a href="#åäºŒã€list-addå’ŒaddAllçš„ä¸€ä¸ªNPEé—®é¢˜" class="headerlink" title="åäºŒã€list.addå’ŒaddAllçš„ä¸€ä¸ªNPEé—®é¢˜"></a>åäºŒã€list.addå’ŒaddAllçš„ä¸€ä¸ªNPEé—®é¢˜</h4><p>èƒŒæ™¯ï¼šaddAllé‡åˆ°çš„ä¸€ä¸ªç©ºæŒ‡é’ˆé—®é¢˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test7() &#123;</span><br><span class="line">    Map&lt;Long, Long&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">    map.put(1L, 1L);</span><br><span class="line">    List&lt;Long&gt; list = Lists.newArrayList();</span><br><span class="line">    System.out.println(map.get(2L)); //null</span><br><span class="line">    list.add(null); //æ²¡é—®é¢˜</span><br><span class="line">    //list.addAll(null); //ä¼šæŠ¥ç©ºæŒ‡é’ˆ</span><br><span class="line">    //list.addAll(1L);  //addAllåªèƒ½ä¼ Collection</span><br><span class="line"></span><br><span class="line">    list.add(1L);</span><br><span class="line">    list.add(3L);</span><br><span class="line">    list.add(1, 2L);</span><br><span class="line">    System.out.println(list);  //[null, 2, 1, 3]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>addæ–¹æ³•æ˜¯å°†å…ƒç´ å¯ä»¥æ’åœ¨æŒ‡å®šçš„ä½ç½®ï¼Œå¦‚æœå‚æ•°åªæœ‰ä¸€ä¸ªçš„è¯å°±é»˜è®¤æ’åœ¨é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œè€Œå¯¹äºaddAllæ–¹æ³•ï¼Œå¯ä»¥çœ‹å…¶å®ä½œç”¨å·®ä¸å¤šï¼Œä½†æ˜¯å‚æ•°å¿…é¡»ä¸ºCollection é›†åˆã€‚</p>
<p>addæ–¹æ³•å‚æ•°ä¸ºæ³›å‹Eï¼Œæ‰€ä»¥ä»–æ˜¯æ”¯æŒä»»æ„ç±»å‹çš„ï¼Œä½†æ˜¯è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨addæ–¹æ³•å¹¶ä¸”ä¼ çš„å‚æ•°ä¸ºé›†åˆï¼Œé‚£ä¹ˆå…¶å® listé›†åˆä¼šæŠŠè¿™ä¸ªå‚æ•°ä¸­çš„é›†åˆå½“åšä¸€ä¸ªæ•´ä½“ï¼Œæ·»åŠ åˆ°åŸæœ¬çš„é›†åˆä¸­ã€‚<br>è€ŒaddAllæ–¹æ³•ï¼Œåˆ™ä¼šæŠŠå‚æ•°é‡Œé¢çš„é›†åˆç»™åˆ†åˆ«æ”¾è¿›åŸæœ¬çš„é›†åˆä¸­ã€‚<br>(é€šè¿‡ä¸€ä¸ªforEach å¾ªç¯éå†åå¾—åˆ°å‚æ•°é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œåœ¨å¾ªç¯é‡Œé¢å†åˆ†åˆ«è°ƒç”¨addæ–¹æ³•æ¥å®ç°è¿™ä¸ªåŠŸèƒ½)</p>
<p>âš ï¸addAllä¹‹åä¿®æ”¹ä¹‹å‰çš„listçš„å…ƒç´ ï¼š<br>ä¿®æ”¹æ˜¯å¯¹æ–°çš„listæœ‰æ•ˆçš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">A a = new A();</span><br><span class="line">a.setName(&quot;lll&quot;);</span><br><span class="line">List&lt;A&gt; list1 = Lists.newArrayList(a);</span><br><span class="line">List&lt;A&gt; list2 = Lists.newArrayList();</span><br><span class="line">list2.addAll(list1);</span><br><span class="line">System.out.println(list2); //[A(name=lll)]</span><br><span class="line">a.setName(&quot;www&quot;);</span><br><span class="line">System.out.println(list1); //[A(name=www)]</span><br><span class="line">System.out.println(list2); //[A(name=www)]</span><br></pre></td></tr></table></figure>

<h4 id="åä¸‰ã€liståè½¬"><a href="#åä¸‰ã€liståè½¬" class="headerlink" title="åä¸‰ã€liståè½¬"></a>åä¸‰ã€liståè½¬</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.ä½¿ç”¨streamçš„sorted (è¿™ç§æ–¹æ³•åªèƒ½ç”¨äºæ™®é€šç±»å‹)</span><br><span class="line">List&lt;Long&gt; li = Lists.newArrayList(1L, 2L);</span><br><span class="line">li = li.stream().sorted(Comparator.reverseOrder()).collect(Collectors.toList());</span><br><span class="line">System.out.println(li);</span><br><span class="line"></span><br><span class="line">2.ä½¿ç”¨Collections.reverseæ–¹æ³•</span><br><span class="line">A a1 = new A(&quot;lll&quot;);</span><br><span class="line">A a2 = new A(&quot;hhh&quot;);</span><br><span class="line">List&lt;A&gt; list = Lists.newArrayList(a1, a2);</span><br><span class="line">Collections.reverse(list);</span><br><span class="line">System.out.println(list);</span><br><span class="line"></span><br><span class="line">3.ä¿ç•™åŸListè¿›è¡Œåè½¬</span><br><span class="line">List&lt;Integer&gt; listData = new ArrayList&lt;&gt;();</span><br><span class="line">listData.add(1);</span><br><span class="line">listData.add(2);</span><br><span class="line">List&lt;Integer&gt; tempData = Arrays.asList(new Integer[listData.size()]);</span><br><span class="line">Collections.copy(tempData, listData);</span><br><span class="line">Collections.reverse(listData);</span><br><span class="line">System.out.println(&quot;åè½¬ååŸæ¥:&quot; + tempData);</span><br><span class="line">System.out.println(&quot;åè½¬åç°åœ¨:&quot; + listData);</span><br></pre></td></tr></table></figure>

<h4 id="åå››ã€listå¤åˆ¶"><a href="#åå››ã€listå¤åˆ¶" class="headerlink" title="åå››ã€listå¤åˆ¶"></a>åå››ã€listå¤åˆ¶</h4><p>é¦–å…ˆçœ‹ä¸€ä¸‹åˆå§‹åŒ–æŒ‡å®šé•¿åº¦Listçš„æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(new Integer[10]);</span><br><span class="line">System.out.println(list.size());  //10</span><br><span class="line">System.out.println(list);  //éƒ½æ˜¯null</span><br><span class="line"></span><br><span class="line">List&lt;Integer&gt; list1 = new ArrayList&lt;&gt;(10);</span><br><span class="line">System.out.println(list1.size());  //0</span><br><span class="line">System.out.println(list1);  //ç©º[]</span><br></pre></td></tr></table></figure>

<p>listå¤åˆ¶çš„å‡ ä¸ªæ–¹æ³•ï¼š</p>
<p>1ã€copyä¸€ä¸ªListæœ€ç®€å•æ–¹å¼å°±æ˜¯ä½¿ç”¨æ„é€ å™¨ï¼Œè¿™ä¸ªæ„é€ å™¨èƒ½æ¥æ”¶ä¸€ä¸ªé›†åˆå‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Lists.newArrayList(1, 2, 3);</span><br><span class="line">List&lt;Integer&gt; copy = new ArrayList&lt;&gt;(list);</span><br><span class="line">System.out.println(copy);  //1 2 3</span><br><span class="line">list.add(4);</span><br><span class="line">System.out.println(copy);  //1 2 3</span><br><span class="line">list.set(0, 5);</span><br><span class="line">System.out.println(copy);  //1 2 3</span><br></pre></td></tr></table></figure>
<p>å¯¹åŸæ¥çš„listè¿›è¡Œaddï¼Œæˆ–è€…setä¿®æ”¹æŸå…ƒç´ ï¼Œä¸ä¼šå½±å“åˆ°å¤åˆ¶çš„ã€‚</p>
<p>ä½†æ˜¯ç”±äºä½¿ç”¨è¿™ç§æ–¹å¼çš„å†…éƒ¨æœºåˆ¶æ˜¯ï¼šå¤åˆ¶å¯¹è±¡çš„å¼•ç”¨è€Œä¸æ˜¯cloneå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹å¯¹è±¡çš„æ¯ä¸€ä¸ªä¿®æ”¹éƒ½å°†åŒæ—¶å½±å“ä¸¤ä¸ªlistã€‚</p>
<p>æ­£å¼ç”±äºä¸Šè¿°çš„åŸå› ï¼Œä½¿ç”¨æ„é€ å™¨è¿™ç§æ–¹æ³•æ¯”è¾ƒé€‚ç”¨äºé‚£äº›ä¸å¯æ”¹å˜å¯¹è±¡åœ¨listé—´çš„å¤åˆ¶ã€‚æ¯”å¦‚Integerã€Stringâ€¦</p>
<p>2ã€addAllæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; copy = new ArrayList&lt;&gt;();</span><br><span class="line">copy.addAll(list);</span><br></pre></td></tr></table></figure>
<p>å’Œä½¿ç”¨æ„é€ å™¨ä¸€æ ·ï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä¸¤ä¸ªlistä¸­çš„å†…å®¹éƒ½å°†å¼•ç”¨çš„æ˜¯ç›¸åŒå¯¹è±¡ã€‚</p>
<p>3ã€Collections.copy</p>
<p>Collectionsç±»æä¾›äº†ä¸€äº›ä¸“é—¨ç”¨äºæ“ä½œé›†åˆçš„é™æ€æ–¹æ³•ã€‚å…¶ä¸­ä¸€ä¸ªå°±æ˜¯copyã€‚Collections.copy(dest,source),è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯source list å’Œä¸€ä¸ªdest listï¼ˆdest listçš„é•¿åº¦åº”å¤§äºsource listï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼šIndexOutOfBoundsExceptionï¼‰ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•çš„ç‰¹ç‚¹æ˜¯ï¼š å®ƒå°†ä¿æŒæ¯ä¸€ä¸ªè¢«copyå…ƒç´ åœ¨ç›®æ ‡é›†åˆä¸­çš„ä¸‹æ ‡å’Œå®ƒä»¬åœ¨æºé›†åˆä¸­çš„ä¸‹æ ‡ä¸€æ ·ã€‚  å³ï¼š æºé›†åˆä¸­ä¸‹æ ‡ä¸º1çš„å…ƒç´ ä¼šè¢«å¤åˆ¶åˆ°ç›®æ ‡é›†åˆçš„ä¸‹æ ‡ä¸º1çš„ä½ç½®ä¸Šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; source = Arrays.asList(1,2,3);</span><br><span class="line">List&lt;Integer&gt; dest = Arrays.asList(4,5,6);</span><br><span class="line">Collections.copy(dest, source);</span><br><span class="line">System.out.println(dest);  //1 2 3</span><br><span class="line"></span><br><span class="line">A a1 = new A(&quot;111&quot;);</span><br><span class="line">A a2 = new A(&quot;222&quot;);</span><br><span class="line">List&lt;A&gt; list2 = Lists.newArrayList(a1, a2);</span><br><span class="line">// List&lt;A&gt; list3 = new ArrayList&lt;&gt;(2); //è¿™ç§åˆå§‹åŒ–å¤§å°ä¸è¡Œ</span><br><span class="line">List&lt;A&gt; list3 = Lists.newArrayList(new A[2]);</span><br><span class="line">System.out.println(list3);  //[null, null]</span><br><span class="line">Collections.copy(list3, list2);</span><br><span class="line">System.out.println(list3);  //[ListTest.A(name=111), ListTest.A(name=222)]</span><br><span class="line">list2.get(0).setName(&quot;333&quot;);</span><br><span class="line">System.out.println(list3);  //ä¼šåŒæ—¶æ”¹å˜å¤åˆ¶çš„List</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šè¿™ç§å¤åˆ¶æ–¹æ³•ä¹Ÿæ˜¯ç›´æ¥å¤åˆ¶å¼•ç”¨ï¼Œè€Œä¸æ˜¯æ·±æ‹·è´å¯¹è±¡ï¼Œæ”¹å˜åŸæ¥Listçš„å¯¹è±¡ä¼šå½±å“å¤åˆ¶çš„Listã€‚</p>
<p>4ã€ä½¿ç”¨Java8 stream</p>
<p>åœ¨Java8ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨streamæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;A&gt; list4 = list2.stream().collect(Collectors.toList());</span><br><span class="line">list2.get(0).setName(&quot;444&quot;);</span><br><span class="line">System.out.println(list4);  //ä¼šåŒæ—¶æ”¹å˜å¤åˆ¶çš„List</span><br></pre></td></tr></table></figure>

<p>å¥½å¤„æ˜¯å¯ä»¥ç”¨streamè¿›è¡Œå…¶ä»–æ“ä½œï¼Œä½†æ˜¯è¿˜æ˜¯æµ…æ‹·è´ã€‚</p>
<p>5ã€å¯¹è±¡æ·±æ‹·è´</p>
<p>é¦–å…ˆï¼Œçœ‹ä¸‹å¯¹è±¡æ€ä¹ˆæ·±æ‹·è´ï¼Œé‡å†™Objectçš„cloneæ–¹æ³•ï¼Œå¹¶ä¸”éœ€è¦å®ç°Cloneableæ¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">@ToString</span><br><span class="line">static</span><br><span class="line">class A implements Cloneable &#123;</span><br><span class="line">    A(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected A clone() throws CloneNotSupportedException &#123;</span><br><span class="line">        return (A)super.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸æƒ³è¦å¼‚å¸¸ï¼Œå°±åœ¨cloneæ–¹æ³•é‡Œè‡ªå·±å†™setæ–¹æ³•ï¼Œæ–°å»ºå¯¹è±¡è¿”å›ã€‚</p>
<p>å¯¹è±¡çš„æ‹·è´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">A a1 = new A(&quot;11&quot;);</span><br><span class="line">A a2 = a1;  //æµ…æ‹·è´</span><br><span class="line">System.out.println(a2);</span><br><span class="line">System.out.println(a1 == a2);  //true</span><br><span class="line">A a3 = a1.clone();</span><br><span class="line">System.out.println(a1 == a3);  //false</span><br></pre></td></tr></table></figure>

<hr>
<p>Apache Commons Langåºåˆ—åŒ– å®ç°å¯¹è±¡æ·±æ‹·è´</p>
<p>ç¬¬ä¸€æ­¥ã€å¯¼å…¥commons-lang3åŒ…</p>
<p>ç¬¬äºŒæ­¥ã€å®ä½“ç±»å®ç°Serializableæ¥å£</p>
<p>ç¬¬ä¸‰æ­¥ã€è°ƒç”¨SerializationUtilså·¥å…·ç±»ï¼Œå®ç°æ·±æ‹·è´ï¼ˆæ³¨æ„ï¼šSerializationUtilsä¸èƒ½ç›´æ¥æ‹·è´Listç±»å‹ï¼‰<br><code>User user2 = SerializationUtils.clone(user1);</code></p>
<p>å¦‚æœæƒ³æ‹·è´Listï¼Œéœ€è¦æ–°å»ºä¸€ä¸ªå®ä½“ç±»implements Serializableï¼Œç„¶åå°†listå˜ä¸ºå…¶ä¸­å±æ€§ï¼Œå†ç”¨ä¸Šé¢çš„æ“ä½œæ·±æ‹·è´æ–°å»ºå¯¹è±¡ï¼Œå†å–å…¶ä¸­çš„listã€‚</p>
<p>æˆ–è€…ç”¨å¾ªç¯addæ·±æ‹·è´åçš„å¯¹è±¡çš„æ–¹å¼å®ç°listçš„æ·±æ‹·è´ã€‚</p>
<p>Javaå¯¹è±¡æ·±æ‹·è´è¯¦è§£ï¼ˆListæ·±æ‹·è´ï¼‰:<br><a href="https://blog.csdn.net/weixin_42675423/article/details/128260074">https://blog.csdn.net/weixin_42675423/article/details/128260074</a></p>
<hr>
<p>6ã€jsonåºåˆ—åŒ–å®ç°listæ·±æ‹·è´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">A a4 = new A(&quot;111&quot;);</span><br><span class="line">A a5 = new A(&quot;222&quot;);</span><br><span class="line">List&lt;A&gt; list1 = Lists.newArrayList(a4, a5);</span><br><span class="line">List&lt;A&gt; list2 = JSONObject.parseArray(JSONObject.toJSONString(list1), A.class); //æ·±æ‹·è´</span><br><span class="line">System.out.println(list2);</span><br></pre></td></tr></table></figure>

<h4 id="åäº”ã€listäº¤é›†å¹¶é›†"><a href="#åäº”ã€listäº¤é›†å¹¶é›†" class="headerlink" title="åäº”ã€listäº¤é›†å¹¶é›†"></a>åäº”ã€listäº¤é›†å¹¶é›†</h4><p>æ±‚ä¸¤ä¸ªlistçš„äº¤é›†</p>
<p>éœ€è¦å¯¼å…¥apacheçš„åŒ…ï¼šcommons-collections</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list1 = Lists.newArrayList(&quot;11&quot;, &quot;22&quot;, &quot;33&quot;);</span><br><span class="line">List&lt;String&gt; list2 = Lists.newArrayList(&quot;44&quot;, &quot;22&quot;, &quot;33&quot;);</span><br><span class="line">Collection&lt;String&gt; list3 = CollectionUtils.intersection(list1, list2);</span><br></pre></td></tr></table></figure>

<hr>
<p>ä»list1ä¸­ç§»é™¤å­˜åœ¨list2ä¸­çš„å…ƒç´ ï¼ˆå·®é›†ï¼‰ï¼š<code>list1.removeAll(list2)</code></p>
<p>è°ƒç”¨æµç¨‹ï¼šremoveAll-&gt;contains-&gt;equalsæ–¹æ³•ï¼Œå¯¹äºå¼•ç”¨ç±»å‹ï¼Œè¦ä½¿ç”¨removeAllï¼Œéœ€è¦é‡å†™equalsæ–¹æ³•ã€‚<br>containsæ–¹æ³•ä¸­ï¼Œå½“å¯¹è±¡oä¸ä¸ºç©ºæ—¶ï¼Œè¿­ä»£åˆ¤æ–­ç”¨åˆ°äº†Objectçš„equalsæ–¹æ³•ï¼Œè€ŒObjectçš„equalsæ–¹æ³•æŒ‡çš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœæˆ‘ä»¬è¦åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹ç›¸ç­‰ï¼Œè¿™é‡Œå°±éœ€è¦é‡å†™equalsæ–¹æ³•ã€‚</p>
<p>ä¸¤ä¸ªlistçš„å¹¶é›†ï¼š<code>a.addAll(b);</code></p>
<p>ä¸¤ä¸ªlistçš„äº¤é›†ï¼š<code>a.retainAll(b);</code></p>
<p>è¦å»é‡çš„ï¼š<code>List newList = b.stream().distinct().collect(Collectors.toList());</code></p>
<hr>
<p>lambdaè¡¨è¾¾å¼å–äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;String&gt; list1 = new ArrayList&lt;String&gt;();</span><br><span class="line">    list1.add(&quot;1&quot;);</span><br><span class="line">    list1.add(&quot;2&quot;);</span><br><span class="line">    list1.add(&quot;3&quot;);</span><br><span class="line">    list1.add(&quot;5&quot;);</span><br><span class="line">    list1.add(&quot;6&quot;);</span><br><span class="line"> </span><br><span class="line">    List&lt;String&gt; list2 = new ArrayList&lt;String&gt;();</span><br><span class="line">    list2.add(&quot;2&quot;);</span><br><span class="line">    list2.add(&quot;3&quot;);</span><br><span class="line">    list2.add(&quot;7&quot;);</span><br><span class="line">    list2.add(&quot;8&quot;);</span><br><span class="line"> </span><br><span class="line">    // äº¤é›†</span><br><span class="line">    List&lt;String&gt; intersection = list1.stream().filter(item -&gt; list2.contains(item)).collect(toList());</span><br><span class="line">    System.out.println(&quot;---äº¤é›† intersection---&quot;);</span><br><span class="line">    intersection.parallelStream().forEach(System.out :: println);</span><br><span class="line"> </span><br><span class="line">    // å·®é›† (list1 - list2)</span><br><span class="line">    List&lt;String&gt; reduce1 = list1.stream().filter(item -&gt; !list2.contains(item)).collect(toList());</span><br><span class="line">    System.out.println(&quot;---å·®é›† reduce1 (list1 - list2)---&quot;);</span><br><span class="line">    reduce1.parallelStream().forEach(System.out :: println);</span><br><span class="line"></span><br><span class="line">    // å¹¶é›†</span><br><span class="line">    List&lt;String&gt; listAll = list1.parallelStream().collect(toList());</span><br><span class="line">    List&lt;String&gt; listAll2 = list2.parallelStream().collect(toList());</span><br><span class="line">    listAll.addAll(listAll2);</span><br><span class="line">    System.out.println(&quot;---å¹¶é›† listAll---&quot;);</span><br><span class="line">    listAll.parallelStream().forEachOrdered(System.out :: println);</span><br><span class="line"> </span><br><span class="line">    // å»é‡å¹¶é›†</span><br><span class="line">    List&lt;String&gt; listAllDistinct = listAll.stream().distinct().collect(toList());</span><br><span class="line">    System.out.println(&quot;---å¾—åˆ°å»é‡å¹¶é›† listAllDistinct---&quot;);</span><br><span class="line">    listAllDistinct.parallelStream().forEachOrdered(System.out :: println);</span><br><span class="line"> </span><br><span class="line">    System.out.println(&quot;---åŸæ¥çš„List1---&quot;);</span><br><span class="line">    list1.parallelStream().forEachOrdered(System.out :: println);</span><br><span class="line">    System.out.println(&quot;---åŸæ¥çš„List2---&quot;);</span><br><span class="line">    list2.parallelStream().forEachOrdered(System.out :: println);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åå…­ã€è·å–Listä¸­æœ€å°çš„begin"><a href="#åå…­ã€è·å–Listä¸­æœ€å°çš„begin" class="headerlink" title="åå…­ã€è·å–List&lt;DO&gt;ä¸­æœ€å°çš„begin"></a>åå…­ã€è·å–<code>List&lt;DO&gt;</code>ä¸­æœ€å°çš„begin</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DO do = list.stream().min(Comparator.comparing(DO::getBegin)).orElse(null);</span><br><span class="line">if (do != null) &#123;</span><br><span class="line">    Date min = do.getBegin();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢Streamé‡Œçš„minï¼Œç»“åˆOptionalã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Optional&lt;Long&gt; minBegin = list.stream()</span><br><span class="line">    .map(DO::getBegin)</span><br><span class="line">    .min(Long::compareTo);</span><br><span class="line">if(minBegin.isPresent())&#123;</span><br><span class="line">    minBegin.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h3><p>LinkedListæ˜¯ä¸€ç§å¯ä»¥åœ¨ä»»ä½•ä½ç½®è¿›è¡Œé«˜æ•ˆåœ°æ’å…¥å’Œç§»é™¤æ“ä½œçš„æœ‰åºåºåˆ—ï¼Œå®ƒæ˜¯åŸºäºåŒå‘é“¾è¡¨å®ç°çš„ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå…è®¸å…ƒç´ ä¸ºnullçš„åŒå‘é“¾è¡¨ã€‚</p>
<p><a href="https://zhuanlan.zhihu.com/p/162980143">https://zhuanlan.zhihu.com/p/162980143</a></p>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><h4 id="âœ…ç§»é™¤"><a href="#âœ…ç§»é™¤" class="headerlink" title="âœ…ç§»é™¤"></a>âœ…ç§»é™¤</h4><p>ç§»é™¤Seté›†åˆä¸­çš„æŒ‡å®šå¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Set&lt;String&gt; set = Sets.newHashSet();</span><br><span class="line">set.add(&quot;111&quot;);</span><br><span class="line">set.add(&quot;222&quot;);</span><br><span class="line">set.remove(&quot;111&quot;);</span><br><span class="line">System.out.println(set);</span><br></pre></td></tr></table></figure>

<h4 id="è·å–ä¸Šä¸€ä¸ªä¸‹ä¸€ä¸ªå…ƒç´ "><a href="#è·å–ä¸Šä¸€ä¸ªä¸‹ä¸€ä¸ªå…ƒç´ " class="headerlink" title="è·å–ä¸Šä¸€ä¸ªä¸‹ä¸€ä¸ªå…ƒç´ "></a>è·å–ä¸Šä¸€ä¸ªä¸‹ä¸€ä¸ªå…ƒç´ </h4><p>ç”¨è¿­ä»£å™¨çš„<code>previous()</code>æ–¹æ³•å’Œ<code>next()</code>æ–¹æ³•</p>
<h3 id="Comparableã€Comparator"><a href="#Comparableã€Comparator" class="headerlink" title="Comparableã€Comparator"></a>Comparableã€Comparator</h3><p>è¦è®²è¿™ä¸ªï¼Œå°±è¦è®²listçš„æ’åºï¼Œçœ‹ä¸Šé¢ï¼Œæœ‰å‡ ç§åŠæ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.list.sort(Comparator.comparing(A::getB))</span><br><span class="line">2.list.stream.sorted(Comparator.comparing(A::getB)).collect(Collectors.toList())</span><br><span class="line">3.list.stream.sorted((a1,a2)-&gt;a1.compareTo(a2))</span><br><span class="line">4.ç›´æ¥Collections.sort(list)  </span><br><span class="line">//è¿™ä¸ªéœ€è¦listçš„å…ƒç´ å®ç°Comparableæ¥å£ï¼Œé‡å†™compareToæ–¹æ³•ï¼Œæ¯”å¦‚Stringå°±å®ç°äº†</span><br><span class="line">5.Collections.sort(list, new Comparator&lt;A&gt;()&#123;</span><br><span class="line">  @Oerride</span><br><span class="line">  public int compare(A a1, A a2)&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä»–ä»¬éƒ½æ˜¯javaçš„æ¥å£, å¹¶ä¸”æ˜¯ç”¨æ¥å¯¹è‡ªå®šä¹‰çš„å®ä½“ç±»æ¯”è¾ƒå¤§å°çš„.</p>
<p>Comparableæ¥å£éœ€è¦è¿›è¡Œæ¯”è¾ƒçš„å®ä½“ç±»åœ¨å®šä¹‰æ—¶å®ç°å®ƒï¼Œé‡å†™compareToæ–¹æ³•ã€‚<br>Comparatoræ¥å£æ˜¯åœ¨é›†åˆå¤–éƒ¨å®ç°çš„æ’åºï¼Œé‡å†™compareæ–¹æ³•ã€‚Comparatoræ¥å£æ¯”Comparableæ¥å£è¦çµæ´»ã€‚</p>
<p>âœ… compareTo()æ–¹æ³•<br>Javaæä¾›äº†ä¸€ä¸ªComparableæ¥å£ï¼Œè¯¥æ¥å£é‡Œå®šä¹‰äº†ä¸€ä¸ªcompareTo(Object obj)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ•´æ•°å€¼ï¼Œå®ç°è¯¥æ¥å£çš„ç±»å¿…é¡»å®ç°è¯¥æ–¹æ³•ï¼Œå®ç°äº†è¯¥æ¥å£çš„ç±»çš„å¯¹è±¡å°±å¯ä»¥æ¯”è¾ƒå¤§å°ã€‚å½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨è¯¥æ–¹æ³•ä¸å¦ä¸€ä¸ªå¯¹è±¡è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œä¾‹å¦‚obj1.compareTo(obj2)ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›0ï¼Œåˆ™è¡¨ç¤ºä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ­£æ•´æ•°ï¼Œåˆ™è¡¨æ˜obj1å¤§äºobj2ï¼›å¦‚æœè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªè´Ÿæ•´æ•°ï¼Œåˆ™è¡¨æ˜obj1å°äºobj2ã€‚</p>
<p>ä¸€äº›å·²ç»å®ç°äº†Comparableæ¥å£çš„å¸¸ç”¨ç±»ï¼š<br>Characterï¼šæŒ‰ç…§å­—ç¬¦çš„UNICODEå€¼è¿›è¡Œæ¯”è¾ƒ<br>Stringï¼šæŒ‰ç…§å­—ç¬¦çš„UNICODEå€¼è¿›è¡Œæ¯”è¾ƒ<br>Date\Timeï¼šå¤–é¢æ¯”é‡Œé¢æ–°ï¼Œè¿”å›1<br>Longï¼ša.compareTo(b)ï¼Œaæ¯”bå¤§è¿”å›1</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ä»¥ç‰¹å®šæ ¼å¼è¿”å›æ—¥æœŸæ ¼å¼åŒ–ç¨‹åº</span><br><span class="line">DateFormat dateFormat = DateFormat.getDateInstance();</span><br><span class="line">Date oldTime = dateFormat.parse(&quot;2019-04-07 19:50:11&quot;);</span><br><span class="line">Date newTime = new Date();</span><br><span class="line">int result = oldTime.compareTo(newTime);</span><br><span class="line">System.out.println(result);</span><br><span class="line"></span><br><span class="line">// æ—¥æœŸå˜ä¸ºå­—ç¬¦ä¸²</span><br><span class="line">String str = dateFormat.format(new Date());</span><br></pre></td></tr></table></figure>

<h3 id="streamæµ-parallelStreamæµ"><a href="#streamæµ-parallelStreamæµ" class="headerlink" title="streamæµ parallelStreamæµ"></a>streamæµ parallelStreamæµ</h3><p>stream(): æ˜¯ä¸²è¡Œæ‰§è¡Œï¼ŒæŒ‰ç…§é¡ºåºæ‰§è¡Œ</p>
<p>parallelStream()ï¼šæ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œå¼‚æ­¥æ‰§è¡Œï¼Œå¤šçº¿ç¨‹ï¼Œå¹¶ä¸”ä½¿ç”¨çš„çº¿ç¨‹æ± æ˜¯ForkJoinPool.commonï¼Œå¯èƒ½å­˜åœ¨å…±äº«èµ„æºã€çº¿ç¨‹å®‰å…¨ç­‰é—®é¢˜</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿‡æ»¤ï¼š</span><br><span class="line">List&lt;Integer&gt; integerList = Arrays.asList(1, 2, 3, 4, 5, 6);</span><br><span class="line">Stream&lt;Integer&gt; stream = integerList.stream().filter(i -&gt; i &gt; 3);   //filteré‡Œé¢çš„æ¡ä»¶æ˜¯ç•™ä¸‹æ¥çš„æ¡ä»¶</span><br><span class="line">integerList = stream.collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">æ’åºï¼š</span><br><span class="line">.stream().sorted((e1,e2)-&gt;e1.compareTo(e2)).</span><br><span class="line"></span><br><span class="line">å»é‡ï¼š</span><br><span class="line">.stream().distinct().</span><br><span class="line"></span><br><span class="line">æŒ‰ç…§å¯¹è±¡ä¸­æŸä¸€å…ƒç´ å»é‡ï¼š[tolook]</span><br><span class="line">.stream().filter(...)</span><br><span class="line"></span><br><span class="line">è¿”å›æŒ‡å®šæµä¸ªæ•°ï¼š</span><br><span class="line">.limit(5)</span><br><span class="line"></span><br><span class="line">è·³è¿‡æµä¸­å…ƒç´ ï¼š</span><br><span class="line">.skip(2)</span><br><span class="line"></span><br><span class="line">mapæµæ˜ å°„ï¼šå°†æ¥æ”¶çš„å…ƒç´ æ˜ å°„æˆå¦å¤–ä¸€ä¸ªå…ƒç´ ï¼š</span><br><span class="line">.map(ç±»::getå±æ€§).collect...</span><br><span class="line">.map(å¯¹è±¡-&gt;&#123;</span><br><span class="line">  æ„é€ å¦ä¸€ç§å¯¹è±¡;</span><br><span class="line">  return å¦ä¸€å¯¹è±¡;</span><br><span class="line">&#125;).</span><br><span class="line">.map(string-&gt;Long.valueOf(string)).  //Stringå˜ä¸ºLong</span><br><span class="line"></span><br><span class="line">å¯¹è±¡listæ ¹æ®æŸä¸€ä¸ªå…ƒç´ å˜ä¸ºmapï¼š(å˜æˆ å…ƒç´ -å¯¹è±¡listçš„map)</span><br><span class="line">list.stream().collect(Collectors.groupingBy(ç±»::getå±æ€§))</span><br><span class="line"></span><br><span class="line">//æµçš„è¿‡ç¨‹ä¸­å¯¹å…ƒç´ è¿›è¡Œæ“ä½œ</span><br><span class="line">List&lt;Long&gt; list = Lists.newArrayList();</span><br><span class="line">list2.stream().forEach(s -&gt; list.add(Long.valueOf(s)));</span><br><span class="line"></span><br><span class="line">anyMatchåˆ¤æ–­</span><br><span class="line">æƒ³æ¯”è¾ƒlist1ä¸­æ˜¯å¦å­˜åœ¨list2ä¸­çš„ä»»ä½•å¯¹è±¡</span><br><span class="line">å¯ä»¥éå†ä¸¤ä¸ªåˆ—è¡¨å¹¶ä½¿ç”¨.contains()æ¯”è¾ƒæ‰€æœ‰å…ƒç´ </span><br><span class="line">ä½†æ˜¯æ›´é«˜æ•ˆçš„æ–¹æ³•æ˜¯anyMatchï¼š</span><br><span class="line">List&lt;Item&gt; list1;</span><br><span class="line">List&lt;Item&gt; list2;</span><br><span class="line">boolean anyMatch = list1.stream().anyMatch(x -&gt; x.equals(list2.stream()));</span><br><span class="line">System.out.println(anyMatch);</span><br><span class="line">å¾ˆå®¹æ˜“ç†è§£ï¼Œå³æ˜¯æœ‰ä¸€ä¸ªæˆ–ä¸€ä¸ªä»¥ä¸Šçš„å…ƒç´ æ»¡è¶³å‡½æ•°å‚æ•°è®¡ç®—ç»“æœä¸ºtrueé‚£æ•´ä¸ªæ–¹æ³•è¿”å›å€¼ä¸ºtrueã€‚</span><br></pre></td></tr></table></figure>

<h4 id="âœ…list-stream-mapToDouble"><a href="#âœ…list-stream-mapToDouble" class="headerlink" title="âœ…list.stream().mapToDouble"></a>âœ…list.stream().mapToDouble</h4><p>æ±‚æœ€å¤§æœ€å°ï¼Œæ±‚å’Œæ±‚å¹³å‡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list.stream().mapToDouble(User::getAge).sum()//å’Œ</span><br><span class="line">list.stream().mapToDouble(User::getAge).max()//æœ€å¤§</span><br><span class="line">list.stream().mapToDouble(User::getAge).min()//æœ€å°</span><br><span class="line">list.stream().mapToDouble(User::getAge).average()//å¹³å‡å€¼</span><br><span class="line"></span><br><span class="line">double sum = list.stream().mapToDouble(Integer::doubleValue).sum();</span><br></pre></td></tr></table></figure>

<h4 id="âœ…listå˜map"><a href="#âœ…listå˜map" class="headerlink" title="âœ…listå˜map"></a>âœ…listå˜map</h4><p>ç¬¬ä¸€ç§ï¼šä¼šå‡ºç°é”®é‡å¤å¼‚å¸¸</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ä»¥idä¸ºä¸»é”®è½¬ä¸ºmap</span><br><span class="line">Map&lt;Long, User&gt; map = list.stream().collect(Collectors.toMap(User::getId,Function.identity()));</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ï¼šä¸ä¼šå‡ºç°é‡å¤é”®å¼‚å¸¸</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ç»™å‡ºkeyé‡å¤æ—¶ï¼Œä½¿ç”¨å“ªä¸ªkeyä½œä¸ºä¸»é”®ï¼Œä»¥ä¸‹ä»£ç ä¸­çš„(key1, key2) -&gt; key2)ä»£è¡¨key1å’Œkey2é”®é‡å¤æ—¶è¿”å›key2åšä¸»é”®</span><br><span class="line">Map&lt;Long, User&gt; map = list.stream().collect(Collectors.toMap(User::getId, Function.identity(), (key1, key2) -&gt; key2));</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ç§ï¼šå¯¹è±¡å˜ä¸ºå±æ€§-å±æ€§map</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä¸æƒ³è¿”å›å¯¹è±¡ï¼Œåªè¿”å›å¯¹è±¡é‡ŒæŸä¸ªå±æ€§æ—¶ é‡‡ç”¨è¿™ç§æ–¹å¼</span><br><span class="line">Map&lt;Long, String&gt; map = list.stream().collect(Collectors.toMap(User::getId, User::getAge, (key1, key2) -&gt; key2));</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››ç§ï¼šä»¥æŸä¸€å±æ€§åˆ†ç»„ï¼Œå˜ä¸ºå±æ€§-å¯¹è±¡list map</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Map&lt;Integer, List&gt; map = list.stream().collect(Collectors.groupingBy(User::getId));</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/lizaiismy/article/details/121352640">https://blog.csdn.net/lizaiismy/article/details/121352640</a></p>
<p>psï¼š<code>Function.identity()</code><br>Functionæ˜¯ä¸€ä¸ªæ¥å£ï¼ŒJava 8å…è®¸åœ¨æ¥å£ä¸­åŠ å…¥å…·ä½“æ–¹æ³•ã€‚æ¥å£ä¸­çš„å…·ä½“æ–¹æ³•æœ‰ä¸¤ç§ï¼Œdefaultæ–¹æ³•å’Œstaticæ–¹æ³•ï¼Œidentity()å°±æ˜¯Functionæ¥å£çš„ä¸€ä¸ªé™æ€æ–¹æ³•ã€‚<br><code>Function.identity()</code>è¿”å›ä¸€ä¸ªè¾“å‡ºè·Ÿè¾“å…¥ä¸€æ ·çš„Lambdaè¡¨è¾¾å¼å¯¹è±¡ï¼Œç­‰ä»·äºå½¢å¦‚t -&gt; tå½¢å¼çš„Lambdaè¡¨è¾¾å¼ã€‚</p>
<p>æºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">static  Function identity() &#123;</span><br><span class="line">    return t -&gt; t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œ<code>Function.identity()</code>æ˜¯ä¸€ä¸ªç”¨æ¥è¿”å›è‡ªå·±çš„lambdaè¡¨è¾¾å¼</p>
<h4 id="âœ…streamæµçš„max-minæ–¹æ³•"><a href="#âœ…streamæµçš„max-minæ–¹æ³•" class="headerlink" title="âœ…streamæµçš„max,minæ–¹æ³•"></a>âœ…streamæµçš„max,minæ–¹æ³•</h4><p>max : è·å–æœ€å¤§å€¼<br>min : è·å–æœ€å°å€¼</p>
<p><code>Optional&lt;T&gt; max(Comparator&lt;? super T&gt; comparator)</code></p>
<p>maxã€min æ–¹æ³•å‚æ•°ç±»å‹ä¸º Comparator æ¥å£,åˆ©ç”¨æ¯”è¾ƒå™¨è‡ªå®šä¹‰æ’åºã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class StreamDemo &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;Person&gt; personList = Arrays.asList(</span><br><span class="line">                new Person(1, &quot;å¤§æ¯›&quot;, 30, 175),</span><br><span class="line">                new Person(2, &quot;äºŒæ¯›&quot;, 35, 170),</span><br><span class="line">                new Person(3, &quot;ä¸‰æ¯›&quot;, 26, 173),</span><br><span class="line">                new Person(4, &quot;å°æ¯›&quot;, 30, 175));</span><br><span class="line"> </span><br><span class="line">        // è·å– person ç±»å‹æµ</span><br><span class="line">        Stream&lt;Person&gt; personStream = personList.stream();</span><br><span class="line">        // æŒ‰ç…§å¹´é¾„å‡åºæ’åº,ç„¶åè·å–æ’åºåçš„æœ€å¤§å€¼ o1-o2 ä»£è¡¨å‡åºæ’åº;o2-o1 ä»£è¡¨é™åºæ’åº</span><br><span class="line">        Optional&lt;Person&gt; max = personStream.max(((o1, o2) -&gt; o1.getAge() - o2.getAge()));</span><br><span class="line">        System.out.println(max.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…æœ‰ä¸€ä¸ªListæƒ³æ ¹æ®å­—æ®µç»Ÿè®¡æ•°é‡"><a href="#âœ…æœ‰ä¸€ä¸ªListæƒ³æ ¹æ®å­—æ®µç»Ÿè®¡æ•°é‡" class="headerlink" title="âœ…æœ‰ä¸€ä¸ªList&lt;Map&gt;æƒ³æ ¹æ®å­—æ®µç»Ÿè®¡æ•°é‡"></a>âœ…æœ‰ä¸€ä¸ª<code>List&lt;Map&gt;</code>æƒ³æ ¹æ®å­—æ®µç»Ÿè®¡æ•°é‡</h4><p>ä½¿ç”¨Collectors.groupingBy</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Map&lt;String, Object&gt;&gt;list = </span><br><span class="line">Map&lt;String, Long&gt; res = list.stream()</span><br><span class="line">    .collect(Collectors.groupingBy(map -&gt; (String)map.get(&quot;city&quot;), Collectors.counting()));</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³ç»Ÿè®¡å»é‡åçš„æ•°é‡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Map&lt;String, Object&gt;&gt;list = </span><br><span class="line">Map&lt;String, Long&gt; res = list.stream()</span><br><span class="line">    .collect(Collectors.groupingBy(map -&gt; (String)map.get(&quot;city&quot;), </span><br><span class="line">    Collectors.maping(map -&gt; map.get(&quot;task_id&quot;), Collectors.toSet())))</span><br><span class="line">    .entrySet()</span><br><span class="line">    .stream()</span><br><span class="line">    .collect(Collectors.toMap(Map.Entry :: getKey, e -&gt; (long)e.getValue().size())));</span><br></pre></td></tr></table></figure>


<h3 id="Dateç›¸å…³"><a href="#Dateç›¸å…³" class="headerlink" title="Dateç›¸å…³"></a>Dateç›¸å…³</h3><h4 id="âœ…now-after"><a href="#âœ…now-after" class="headerlink" title="âœ…now.after()"></a>âœ…now.after()</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DateFormat dateformat = DateFormat.getDateInstance();</span><br><span class="line">Date old = dateformat.parse(&quot;2022-04-07 19:50:11&quot;);</span><br><span class="line">Date now = new Date();</span><br><span class="line">if(now.after(oldTime))&#123;</span><br><span class="line">    System.out.println(&quot;nowæ¯”afteræ–°&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…DateFormatç±»"><a href="#âœ…DateFormatç±»" class="headerlink" title="âœ…DateFormatç±»"></a>âœ…DateFormatç±»</h4><p>DateFormat æ˜¯æ—¥æœŸ&#x2F;æ—¶é—´æ ¼å¼åŒ–å­ç±»çš„æŠ½è±¡ç±»ï¼Œå®ƒä»¥ä¸è¯­è¨€æ— å…³çš„æ–¹å¼æ ¼å¼åŒ–å¹¶è§£ææ—¥æœŸæˆ–æ—¶é—´ã€‚æ—¥æœŸ&#x2F;æ—¶é—´æ ¼å¼åŒ–å­ç±»ï¼ˆå¦‚ SimpleDateFormatï¼‰å…è®¸è¿›è¡Œæ ¼å¼åŒ–ï¼ˆä¹Ÿå°±æ˜¯æ—¥æœŸâ†’æ–‡æœ¬ï¼‰ã€è§£æï¼ˆæ–‡æœ¬â†’æ—¥æœŸï¼‰å’Œæ ‡å‡†åŒ–æ—¥æœŸã€‚</p>
<p>åœ¨åˆ›å»º DateFormat å¯¹è±¡æ—¶ä¸èƒ½ä½¿ç”¨ new å…³é”®å­—ï¼Œè€Œåº”è¯¥ä½¿ç”¨ DateFormat ç±»ä¸­çš„é™æ€æ–¹æ³• getDateInstance()ï¼š<br><code>DateFormat df = DateFormat.getDatelnstance();</code><br>åœ¨åˆ›å»ºäº†ä¸€ä¸ª DateFormat å¯¹è±¡åï¼Œå¯ä»¥è°ƒç”¨è¯¥å¯¹è±¡ä¸­çš„æ–¹æ³•æ¥å¯¹æ—¥æœŸ&#x2F;æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å®šä¹‰å¯¹è±¡ï¼Œæ—¥æœŸã€æ—¶é—´ï¼Œä¹Ÿæœ‰getDateTimeInstance</span><br><span class="line">SHORTï¼š18-10-15 ä¸Šåˆ9:30</span><br><span class="line">FULLï¼š2018å¹´10æœˆ15æ—¥ æ˜ŸæœŸä¸€ ä¸Šåˆ09æ—¶30åˆ†43ç§’ CST</span><br><span class="line">MEDIUMï¼š2018-10-15 9:30:43</span><br><span class="line">LONGï¼š2018å¹´10æœˆ15æ—¥ ä¸Šåˆ09æ—¶30åˆ†43ç§’</span><br><span class="line"></span><br><span class="line">DateFormat df1 = DateFormat.getDateInstance(DateFormat.SHORT, Locale.CHINA);</span><br><span class="line">DateFormat df5 = DateFormat.getTimeInstance(DateFormat.SHORT, Locale.CHINA);</span><br><span class="line"></span><br><span class="line">//å­—ç¬¦ä¸²åˆ°Date</span><br><span class="line">Date old = dateformat.parse(&quot;2022-04-07 19:50:11&quot;);</span><br><span class="line"></span><br><span class="line">//Dateåˆ°å­—ç¬¦ä¸²</span><br><span class="line">String str = dateFormat.format(new Date());</span><br><span class="line"></span><br><span class="line">Date newTime = new Date();</span><br><span class="line">int result = oldTime.compareTo(newTime);</span><br><span class="line">System.out.println(result);</span><br><span class="line"></span><br><span class="line">DateFormat dateformat = DateFormat.getDateInstance();</span><br><span class="line">Date old = dateformat.parse(&quot;2022-04-07 19:50:11&quot;);</span><br><span class="line">Date now = new Date();</span><br><span class="line">if(now.after(old))&#123;</span><br><span class="line">    System.out.println(&quot;nowæ¯”oldæ–°&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…SimpleDateFormat"><a href="#âœ…SimpleDateFormat" class="headerlink" title="âœ…SimpleDateFormat"></a>âœ…SimpleDateFormat</h4><p>DateFormatå¯ä»¥è¿›è¡Œæ—¥æœŸå’Œå­—ç¬¦ä¸²çš„æ ¼å¼åŒ–å’Œè§£æï¼Œä½†æ˜¯ç”±äºæ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥ä½¿ç”¨å…·ä½“å­ç±»SimpleDateFormat</p>
<p>SimpleDateFormat ä½¿å¾—å¯ä»¥é€‰æ‹©ä»»ä½•ç”¨æˆ·å®šä¹‰çš„æ—¥æœŸ&#x2F;æ—¶é—´æ ¼å¼çš„æ¨¡å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Date now = new Date(); // åˆ›å»ºä¸€ä¸ªDateå¯¹è±¡ï¼Œè·å–å½“å‰æ—¶é—´</span><br><span class="line">// æŒ‡å®šæ ¼å¼åŒ–æ ¼å¼</span><br><span class="line">SimpleDateFormat f = new SimpleDateFormat(&quot;ä»Šå¤©æ˜¯ &quot; + &quot;yyyy å¹´ MM æœˆ dd æ—¥ E HH ç‚¹ mm åˆ† ss ç§’&quot;);</span><br><span class="line">// Dateè½¬ä¸ºString</span><br><span class="line">System.out.println(f.format(now)); // å°†å½“å‰æ—¶é—´è¢¼å¼åŒ–ä¸ºæŒ‡å®šçš„æ ¼å¼</span><br><span class="line">// Stringè½¬ä¸ºDate</span><br><span class="line">String str=&quot;2008-08-08 12:12:12&quot;;</span><br><span class="line">SimpleDateFormat sdf2=new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">Date dd=sdf2.parse(str);</span><br><span class="line">System.out.println(dd);</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="http://c.biancheng.net/view/878.html">http://c.biancheng.net/view/878.html</a></p>
<h4 id="âœ…FastDataFormat"><a href="#âœ…FastDataFormat" class="headerlink" title="âœ…FastDataFormat"></a>âœ…FastDataFormat</h4><p>Apache commons-langä¸­çš„FastDateFormatã€‚ä¹Ÿå¯ä»¥åšæ—¶é—´çš„æ ¼å¼åŒ–ã€‚<br>FastDateFormatæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸å¿…è€ƒè™‘å¤šçº¿ç¨‹çš„æƒ…å†µ<br>JDKé‡Œè‡ªå¸¦çš„SimpleDateFormatå­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ã€‚<br>SimpleDateFormatåœ¨å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–çš„æ–¹æ³•formatä¸­ï¼Œä¼šå…ˆå¯¹calendarå¯¹è±¡è¿›è¡ŒsetTimeçš„èµ‹å€¼ï¼Œè‹¥æ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªSimpleDateFormatå®ä¾‹çš„è¯ï¼Œå°±ä¼šå¯¹calendarçš„èµ‹å€¼è¿›è¡Œè¦†ç›–ï¼Œè¿›è€Œäº§ç”Ÿé—®é¢˜ã€‚</p>
<p>FastDateFormatç”¨æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FastDateFormat f = FastDateFormat.getInstance(&quot;yyyy-MM-dd HH:mm:ss&quot;);  </span><br><span class="line">String s = f.format(new Date());</span><br><span class="line">System.out.println(s);</span><br><span class="line"></span><br><span class="line">Date dd=f.parse(s);</span><br></pre></td></tr></table></figure>


<h4 id="âœ…å½“å‰æ—¶é—´çš„åå‡ ç§’ï¼š"><a href="#âœ…å½“å‰æ—¶é—´çš„åå‡ ç§’ï¼š" class="headerlink" title="âœ…å½“å‰æ—¶é—´çš„åå‡ ç§’ï¼š"></a>âœ…å½“å‰æ—¶é—´çš„åå‡ ç§’ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å½“å‰æ—¶é—´çš„åå‡ ç§’</span><br><span class="line">Date data = new Date(System.currentTimeMillis() + 10 * 1000);</span><br><span class="line">System.out.println(data);</span><br><span class="line">åŠ çš„æ˜¯æ¯«ç§’</span><br></pre></td></tr></table></figure>

<p>è·å–å½“å‰æ—¶é—´çš„æœˆä»½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int mon = LocalDate.now().getMonthValue();</span><br></pre></td></tr></table></figure>

<h4 id="âœ…LocalDateã€LocalTimeã€LocalDateTimeã€java8æ–°æä¾›çš„ç±»ã€‘"><a href="#âœ…LocalDateã€LocalTimeã€LocalDateTimeã€java8æ–°æä¾›çš„ç±»ã€‘" class="headerlink" title="âœ…LocalDateã€LocalTimeã€LocalDateTimeã€java8æ–°æä¾›çš„ç±»ã€‘"></a>âœ…LocalDateã€LocalTimeã€LocalDateTimeã€java8æ–°æä¾›çš„ç±»ã€‘</h4><p>ä¸ºä»€ä¹ˆéœ€è¦LocalDateã€LocalTimeã€LocalDateTime</p>
<p>1.Dateå¦‚æœä¸æ ¼å¼åŒ–ï¼Œæ‰“å°å‡ºçš„æ—¥æœŸå¯è¯»æ€§å·®<br>Tue Sep 10 09:34:04 CST 2019<br>Dateå¯¹æ—¶é—´å¤„ç†æ¯”è¾ƒéº»çƒ¦ã€‚<br>getYearã€getMonthè¿™äº›æ–¹æ³•å—ï¼Œè·å–å¹´æœˆæ—¥å¾ˆEasyï¼Œä½†éƒ½è¢«å¼ƒç”¨äº†ã€‚</p>
<p>2.ä½¿ç”¨SimpleDateFormatå¯¹æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–ï¼Œä½†SimpleDateFormatæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚SimpleDateFormatçš„formatæ–¹æ³•ä¸­çš„calendaræ˜¯å…±äº«å˜é‡ï¼Œå¹¶ä¸”è¿™ä¸ªå…±äº«å˜é‡æ²¡æœ‰åšçº¿ç¨‹å®‰å…¨æ§åˆ¶ã€‚å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨ç›¸åŒçš„SimpleDateFormatå¯¹è±¡ã€å¦‚ç”¨staticä¿®é¥°çš„SimpleDateFormatã€‘è°ƒç”¨formatæ–¹æ³•æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šåŒæ—¶è°ƒç”¨calendar.setTimeæ–¹æ³•ï¼Œå¯èƒ½ä¸€ä¸ªçº¿ç¨‹åˆšè®¾ç½®å¥½timeå€¼ã€‚å¦å¤–çš„ä¸€ä¸ªçº¿ç¨‹é©¬ä¸ŠæŠŠè®¾ç½®çš„timeå€¼ç»™ä¿®æ”¹äº†å¯¼è‡´è¿”å›çš„æ ¼å¼åŒ–æ—¶é—´å¯èƒ½æ˜¯é”™è¯¯çš„ã€‚åœ¨å¤šå¹¶å‘æƒ…å†µä¸‹ä½¿ç”¨SimpleDateFormatéœ€æ ¼å¤–æ³¨æ„ SimpleDateFormaté™¤äº†formatæ˜¯çº¿ç¨‹ä¸å®‰å…¨ä»¥å¤–ï¼Œparseæ–¹æ³•ä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p>
<p>å¤šçº¿ç¨‹å¹¶å‘å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ - é¿å…çº¿ç¨‹ä¹‹é—´å…±äº«ä¸€ä¸ªSimpleDateFormatå¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹ä½¿ç”¨æ—¶éƒ½åˆ›å»ºä¸€æ¬¡SimpleDateFormatå¯¹è±¡ &#x3D;&gt; åˆ›å»ºå’Œé”€æ¯å¯¹è±¡çš„å¼€é”€å¤§ - å¯¹ä½¿ç”¨formatå’Œparseæ–¹æ³•çš„åœ°æ–¹è¿›è¡ŒåŠ é” &#x3D;&gt; çº¿ç¨‹é˜»å¡æ€§èƒ½å·® - ä½¿ç”¨ThreadLocalä¿è¯æ¯ä¸ªçº¿ç¨‹æœ€å¤šåªåˆ›å»ºä¸€æ¬¡SimpleDateFormatå¯¹è±¡ &#x3D;&gt; è¾ƒå¥½çš„æ–¹æ³•ã€‚</p>
<p>LocalDateç”¨æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åªä¼šè·å–å¹´æœˆæ—¥</span><br><span class="line">//è·å–å½“å‰å¹´æœˆæ—¥</span><br><span class="line">LocalDate localDate = LocalDate.now();</span><br><span class="line"></span><br><span class="line">//æ„é€ æŒ‡å®šçš„å¹´æœˆæ—¥</span><br><span class="line">LocalDate localDate1 = LocalDate.of(2019, 9, 10);</span><br><span class="line"></span><br><span class="line">è·å–å¹´ã€æœˆã€æ—¥ã€æ˜ŸæœŸå‡ </span><br><span class="line">int year = localDate.getYear();  //2022</span><br><span class="line">int year1 = localDate.get(ChronoField.YEAR); //2022</span><br><span class="line">Month month = localDate.getMonth();  //JUNE</span><br><span class="line">int month1 = localDate.get(ChronoField.MONTH_OF_YEAR);  //6</span><br><span class="line"></span><br><span class="line">//è·å–å½“å‰æ—¥æœŸæ˜¯æ‰€åœ¨å¹´çš„ç¬¬å‡ å¤©ã€æœˆçš„ç¬¬å‡ å¤©ã€å½“å‰æ˜ŸæœŸ</span><br><span class="line">int day = localDate.getDayOfMonth();  //26</span><br><span class="line">int day1 = localDate.get(ChronoField.DAY_OF_MONTH);  //26</span><br><span class="line">DayOfWeek dayOfWeek = localDate.getDayOfWeek(); //SUNDAY</span><br><span class="line">int dayOfWeek1 = localDate.get(ChronoField.DAY_OF_WEEK); //7</span><br><span class="line">LocalDate now = LocalDate.now();</span><br><span class="line">int year = now.getDayOfYear();  //ä¸€å¹´çš„ç¬¬å‡ å¤©</span><br><span class="line">int month = now.getDayOfMonth();  //æœˆçš„ç¬¬å‡ å¤©</span><br><span class="line"></span><br><span class="line">System.out.println(LocalDate.MAX);  //+999999999-12-31</span><br><span class="line">System.out.println(LocalDate.MIN);  //-999999999-01-01</span><br><span class="line"></span><br><span class="line">//è·å–å½“å‰æœˆï¼Œå½“å‰æœˆå¤©æ•°</span><br><span class="line">Month month = now.getMonth();  //JANUARY</span><br><span class="line">int monthValue = now.getMonthValue();</span><br><span class="line">int i = now.lengthOfMonth();</span><br><span class="line"></span><br><span class="line">//withæŒ‡å®šå¹´æœˆæ—¥</span><br><span class="line">LocalDate localDate = now.withDayOfMonth(1);  //å½“æœˆçš„æŒ‡å®šæ—¥</span><br><span class="line">LocalDate localDate1 = now.withDayOfYear(21);  //è·å–ä»Šå¹´ç¬¬ç¬¬å‡ å¤©</span><br><span class="line">LocalDate localDate2 = now.withMonth(3);  //ä»Šå¹´æŒ‡å®šæœˆä»½ï¼Œæ—¥ä¸ºå½“å¤©çš„æ—¥æœŸ</span><br><span class="line">LocalDate localDate3 = now.withYear(2004);  //æŒ‡å®šå¹´ä»½çš„ä»Šå¤©</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>LocalTimeç”¨æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åªä¼šè·å–å‡ ç‚¹å‡ åˆ†å‡ ç§’</span><br><span class="line">åˆ›å»ºLocalTime</span><br><span class="line">LocalTime localTime = LocalTime.of(13, 51, 10);</span><br><span class="line">LocalTime localTime1 = LocalTime.now();</span><br><span class="line">è·å–æ—¶åˆ†ç§’</span><br><span class="line">//è·å–å°æ—¶</span><br><span class="line">int hour = localTime.getHour();</span><br><span class="line">int hour1 = localTime.get(ChronoField.HOUR_OF_DAY);</span><br><span class="line">//è·å–åˆ†</span><br><span class="line">int minute = localTime.getMinute();</span><br><span class="line">int minute1 = localTime.get(ChronoField.MINUTE_OF_HOUR);</span><br><span class="line">//è·å–ç§’</span><br><span class="line">int second = localTime.getSecond();</span><br><span class="line">int second1 = localTime.get(ChronoField.SECOND_OF_MINUTE);</span><br></pre></td></tr></table></figure>

<p>LocalDateTime:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è·å–å¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼Œç­‰äºLocalDate+LocalTime</span><br><span class="line">åˆ›å»ºLocalDateTime</span><br><span class="line">LocalDateTime localDateTime = LocalDateTime.now();</span><br><span class="line">LocalDateTime localDateTime1 = LocalDateTime.of(2019, Month.SEPTEMBER, 10, 14, 46, 56);</span><br><span class="line">LocalDateTime localDateTime1 = LocalDateTime.of(2019, 6, 26, 10, 14, 46, 56);</span><br><span class="line">LocalDateTime localDateTime2 = LocalDateTime.of(localDate, localTime);</span><br><span class="line">LocalDateTime localDateTime3 = localDate.atTime(localTime);</span><br><span class="line">LocalDateTime localDateTime4 = localTime.atDate(localDate);</span><br><span class="line">è·å–LocalDate</span><br><span class="line">LocalDate localDate2 = localDateTime.toLocalDate();</span><br><span class="line">è·å–LocalTime</span><br><span class="line">LocalTime localTime2 = localDateTime.toLocalTime();</span><br></pre></td></tr></table></figure>

<p>Instant: å¯ä»¥ç²¾ç¡®åˆ°çº³ç§’çš„æ—¶é—´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è·å–ç§’æ•°</span><br><span class="line">åˆ›å»ºInstantå¯¹è±¡</span><br><span class="line">Instant instant = Instant.now();  //æå‰åŒ—äº¬æ—¶é—´8å°æ—¶</span><br><span class="line"></span><br><span class="line">//æ ¹æ®æ—¶æœŸæ·»åŠ åç§»é‡</span><br><span class="line">OffsetDateTime offsetDateTime1 = instance.atOffset(ZoneOffset.ofHours(8));</span><br><span class="line">System.out.println(&quot;å¤„ç†åæ—¶é—´ä¸ºï¼š&quot;+offsetDateTime1);</span><br><span class="line"></span><br><span class="line">è·å–ç§’æ•°</span><br><span class="line">long currentSecond = instant.getEpochSecond();</span><br><span class="line">è·å–æ¯«ç§’æ•°</span><br><span class="line">long currentMilli = instant.toEpochMilli();</span><br><span class="line">å¦‚æœåªæ˜¯ä¸ºäº†è·å–ç§’æ•°æˆ–è€…æ¯«ç§’æ•°ï¼Œä½¿ç”¨System.currentTimeMillis()æ¥å¾—æ›´ä¸ºæ–¹ä¾¿</span><br></pre></td></tr></table></figure>

<p>æ—¶é—´å˜åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LocalDateã€LocalTimeã€LocalDateTimeã€Instantä¸ºä¸å¯å˜å¯¹è±¡ï¼Œä¿®æ”¹è¿™äº›å¯¹è±¡å¯¹è±¡ä¼šè¿”å›ä¸€ä¸ªå‰¯æœ¬</span><br><span class="line">å¢åŠ ã€å‡å°‘å¹´æ•°ã€æœˆæ•°ã€å¤©æ•°ç­‰ ä»¥LocalDateTimeä¸ºä¾‹</span><br><span class="line">LocalDateTime localDateTime = LocalDateTime.of(2019, Month.SEPTEMBER, 10,</span><br><span class="line">14, 46, 56);</span><br><span class="line">//å¢åŠ ä¸€å¹´</span><br><span class="line">localDateTime = localDateTime.plusYears(1);</span><br><span class="line">localDateTime = localDateTime.plus(1, ChronoUnit.YEARS);</span><br><span class="line">//å‡å°‘ä¸€ä¸ªæœˆ</span><br><span class="line">localDateTime = localDateTime.minusMonths(1);</span><br><span class="line">localDateTime = localDateTime.minus(1, ChronoUnit.MONTHS);</span><br><span class="line">é€šè¿‡withä¿®æ”¹æŸäº›å€¼</span><br><span class="line">//ä¿®æ”¹å¹´ä¸º2019</span><br><span class="line">localDateTime = localDateTime.withYear(2020);</span><br><span class="line">//ä¿®æ”¹ä¸º2022</span><br><span class="line">localDateTime = localDateTime.with(ChronoField.YEAR, 2022);</span><br><span class="line">è¿˜å¯ä»¥ä¿®æ”¹æœˆã€æ—¥</span><br></pre></td></tr></table></figure>

<p>æ—¶é—´è®¡ç®—:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ¯”å¦‚æœ‰äº›æ—¶å€™æƒ³çŸ¥é“è¿™ä¸ªæœˆçš„æœ€åä¸€å¤©æ˜¯å‡ å·ã€ä¸‹ä¸ªå‘¨æœ«æ˜¯å‡ å·ï¼Œé€šè¿‡æä¾›çš„æ—¶é—´å’Œæ—¥æœŸAPIå¯ä»¥å¾ˆå¿«å¾—åˆ°ç­”æ¡ˆ</span><br><span class="line">LocalDate localDate = LocalDate.now();</span><br><span class="line">//å¾—åˆ°ä»Šå¹´ç¬¬ä¸€å¤©</span><br><span class="line">LocalDate localDate1 = localDate.with(firstDayOfYear());</span><br><span class="line">æ¯”å¦‚é€šè¿‡firstDayOfYear()è¿”å›äº†å½“å‰æ—¥æœŸçš„ç¬¬ä¸€å¤©æ—¥æœŸï¼Œè¿˜æœ‰å¾ˆå¤šæ–¹æ³•è¿™é‡Œä¸åœ¨ä¸¾ä¾‹è¯´æ˜</span><br></pre></td></tr></table></figure>

<p>æ ¼å¼åŒ–æ—¶é—´:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LocalDate localDate = LocalDate.of(2019, 9, 10);</span><br><span class="line">String s1 = localDate.format(DateTimeFormatter.BASIC_ISO_DATE);</span><br><span class="line">String s2 = localDate.format(DateTimeFormatter.ISO_LOCAL_DATE);</span><br><span class="line">//è‡ªå®šä¹‰æ ¼å¼åŒ–</span><br><span class="line">DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);</span><br><span class="line">String s3 = localDate.format(dateTimeFormatter);</span><br><span class="line">DateTimeFormatteré»˜è®¤æä¾›äº†å¤šç§æ ¼å¼åŒ–æ–¹å¼ï¼Œå¦‚æœé»˜è®¤æä¾›çš„ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œå¯ä»¥é€šè¿‡DateTimeFormatterçš„ofPatternæ–¹æ³•åˆ›å»ºè‡ªå®šä¹‰æ ¼å¼åŒ–æ–¹å¼</span><br><span class="line"></span><br><span class="line">//å˜ä¸ºå­—ç¬¦ä¸²ï¼š</span><br><span class="line">String currentTime = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(LocalDateTime.now());</span><br><span class="line">System.out.println(currentTime);</span><br><span class="line">String currentTime1 = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;));</span><br><span class="line">System.out.println(currentTime1</span><br></pre></td></tr></table></figure>

<p>è§£ææ—¶é—´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LocalDate localDate1 = LocalDate.parse(&quot;20190910&quot;, DateTimeFormatter.BASIC_ISO_DATE);</span><br><span class="line">LocalDate localDate2 = LocalDate.parse(&quot;2019-09-10&quot;, DateTimeFormatter.ISO_LOCAL_DATE);</span><br><span class="line">å’ŒSimpleDateFormatç›¸æ¯”ï¼ŒDateTimeFormatteræ˜¯çº¿ç¨‹å®‰å…¨çš„</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://baijiahao.baidu.com/s?id=1685414035437236647&wfr=spider&for=pc">https://baijiahao.baidu.com/s?id=1685414035437236647&amp;wfr=spider&amp;for=pc</a></p>
<p>æ›´å¤šç”¨æ³•ï¼š<a href="https://zhuanlan.zhihu.com/p/158786867">https://zhuanlan.zhihu.com/p/158786867</a></p>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class DateUtilsTest &#123;</span><br><span class="line">    public static final String DATE_PATTERN = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test1() &#123;</span><br><span class="line">        // è·å–æŒ‡å®šæ ¼å¼æ—¶é—´å­—ç¬¦ä¸²</span><br><span class="line">        String date = LocalDateTime.now().format(DateTimeFormatter.ofPattern(DATE_PATTERN));</span><br><span class="line">        System.out.println(date);</span><br><span class="line">        // è·å–å½“å‰æœˆä»½</span><br><span class="line">        Integer month = LocalDateTime.now().getMonth().getValue();</span><br><span class="line">        System.out.println(month);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test2() &#123;</span><br><span class="line">        // æ—¶é—´æˆ³</span><br><span class="line">        long timeStamp = System.currentTimeMillis();</span><br><span class="line">        System.out.println(&quot;æ—¶é—´æˆ³ï¼š&quot; + timeStamp);</span><br><span class="line">        // æ—¶é—´æˆ³å­—ç¬¦ä¸²åˆ°æ—¶é—´æˆ³åˆ°LocalDateTime</span><br><span class="line">        LocalDateTime time = new Timestamp(timeStamp).toLocalDateTime();</span><br><span class="line">        System.out.println(&quot;LocatDateTimeï¼š&quot; + time);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼šè·å–æŒ‡å®šå¤©åçš„æ—¥æœŸå­—ç¬¦ä¸²</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LocalDateTime.now().plusDays(1).format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;))</span><br></pre></td></tr></table></figure>

<h4 id="âœ…Calendarã€Dateã€LocalDate-LocalTimeå…³ç³»"><a href="#âœ…Calendarã€Dateã€LocalDate-LocalTimeå…³ç³»" class="headerlink" title="âœ…Calendarã€Dateã€LocalDate&#x2F;LocalTimeå…³ç³»"></a>âœ…Calendarã€Dateã€LocalDate&#x2F;LocalTimeå…³ç³»</h4><p>1ã€Date ç±»å¦‚ä»Šå¾ˆå¤šæ–¹æ³•å·²ç»æ²¡æœ‰ä»€ä¹ˆç”¨å¤„äº†ï¼Œå¦‚ä»Šæ—¶é—´çš„å¤„ç†å¹¶ä¸ç›´æ¥åœ¨Date ç±»ä¸­è¿›è¡Œï¼Œè€Œæ˜¯é€šè¿‡Calendarï¼Œæˆ–è€…LocalDate æ¥è¿›è¡Œï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œæ›´å¤šçš„æ˜¯è¦æ¥åšä¸€ä¸ªè®°å½•æ—¥æœŸçš„å®ä¾‹ã€‚</p>
<p>2ã€Dateç”¨äºè®°å½•æŸä¸€ä¸ªå«æ—¥æœŸçš„ã€ç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´ã€‚é‡ç‚¹åœ¨ä»£è¡¨ä¸€åˆ¹é‚£çš„æ—¶é—´æœ¬èº«ã€‚Calendarç”¨äºå°†æŸä¸€æ—¥æœŸæ”¾åˆ°å†æ³•ä¸­çš„äº’åŠ¨â€”â€”æ—¶é—´å’Œå¹´ã€æœˆã€æ—¥ã€æ˜ŸæœŸã€ä¸Šåˆã€ä¸‹åˆã€å¤ä»¤æ—¶ç­‰è¿™äº›å†æ³•è§„å®šäº’ç›¸ä½œç”¨å…³ç³»å’Œäº’åŠ¨ã€‚Calendaræœ¬èº«ä»£è¡¨å…¬å†çš„ä¸€ä¸ªç®€åŒ–ç¼©æ°´ç‰ˆï¼Œå§‘ä¸”å«â€œè®¡ç®—æœºå†â€ã€‚</p>
<p>3ã€Java 8æ–°å¢äº†LocalDateå’ŒLocalTimeæ¥å£ï¼Œä¸ºä»€ä¹ˆè¦æä¸€å¥—å…¨æ–°çš„å¤„ç†æ—¥æœŸå’Œæ—¶é—´çš„APIï¼Ÿå› ä¸ºæ—§çš„java.util.Dateå®åœ¨æ˜¯å¤ªéš¾ç”¨äº†ã€‚<br>java.util.Dateæœˆä»½ä»0å¼€å§‹ï¼Œä¸€æœˆæ˜¯0ï¼ŒåäºŒæœˆæ˜¯11ï¼Œå˜æ€å§ï¼java.time.LocalDateæœˆä»½å’Œæ˜ŸæœŸéƒ½æ”¹æˆäº†enumï¼Œå°±ä¸å¯èƒ½å†ç”¨é”™äº†ã€‚<br>java.util.Dateå’ŒSimpleDateFormatteréƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒLocalDateå’ŒLocalTimeå’Œæœ€åŸºæœ¬çš„Stringä¸€æ ·ï¼Œæ˜¯ä¸å˜ç±»å‹ï¼Œä¸ä½†çº¿ç¨‹å®‰å…¨ï¼Œè€Œä¸”ä¸èƒ½ä¿®æ”¹ã€‚</p>
<p>æ¥è‡ªï¼š<a href="https://www.cnblogs.com/jaycekon/p/6179700.html">https://www.cnblogs.com/jaycekon/p/6179700.html</a></p>
<h4 id="âœ…Calender"><a href="#âœ…Calender" class="headerlink" title="âœ…Calender"></a>âœ…Calender</h4><p>Calendar æ˜¯ä¸€ä¸ªæŠ½è±¡ç±», æ— æ³•é€šè¿‡ç›´æ¥å®ä¾‹åŒ–å¾—åˆ°å¯¹è±¡. å› æ­¤, Calendar æä¾›äº†ä¸€ä¸ªæ–¹æ³• getInstanceï¼ˆå·¥å‚æ–¹æ³•ï¼‰,æ¥è·å¾—ä¸€ä¸ªCalendarçš„å­ç±»å¯¹è±¡, å¾—åˆ°çš„ Calendar ç”±å½“å‰æ—¶é—´åˆå§‹åŒ–.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class CalenderTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Calendar cal = Calendar.getInstance();</span><br><span class="line">        cal.set (2013, 5, 4, 13, 44, 51);//å¹´æœˆæ—¥æ—¶åˆ†ç§’ (æœˆä»½0ä»£è¡¨1æœˆ)</span><br><span class="line">        cal.set (Calendar.YEAR, 2014); //å¹´</span><br><span class="line">        cal.set (Calendar.MONTH, 7); //æœˆ (æœˆä»½0ä»£è¡¨1æœˆ)</span><br><span class="line">        cal.set (Calendar.DATE, 11); //æ—¥</span><br><span class="line">        cal.set (Calendar.HOUR_OF_DAY, 15); //æ—¶</span><br><span class="line">        cal.set (Calendar.MINUTE, 33); //åˆ†</span><br><span class="line">        cal.set (Calendar.SECOND, 32); //ç§’</span><br><span class="line"></span><br><span class="line">        //åŒæ—¶è¿˜æœ‰getã€addæ–¹æ³•ï¼Œä½¿ç”¨ç±»ä¼¼</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Calendaræ˜¯çˆ¶ç±»ï¼ŒGregorianCalendaræ˜¯å­ç±»ã€‚<br>GregorianCalendarï¼ˆå…¬å†ï¼‰æ˜¯Calendarçš„ä¸€ä¸ªå…·ä½“å­ç±»ï¼Œæä¾›äº†ä¸–ç•Œä¸Šå¤§å¤šæ•°å›½å®¶&#x2F;åœ°åŒºä½¿ç”¨çš„æ ‡å‡†æ—¥å†ç³»ç»Ÿã€‚å¯ä»¥ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå®ä¾‹ã€‚</p>
<p>ä¾‹å­ï¼šè¿”å›å½“å‰æ—¶é—´åŠ 10åˆ†é’Ÿåçš„æ—¥æœŸæ—¶é—´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Calendar calendar = new GregorianCalendar();</span><br><span class="line">Date date = new Date();</span><br><span class="line">calendar.setTime(date);</span><br><span class="line">calendar.add(GregorianCalendar.MINUTE, 10);</span><br><span class="line">Date after = calendar.getTime();</span><br><span class="line">System.out.println(after);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//1.åˆ›å»ºCalendarå¯¹è±¡</span><br><span class="line">Calendar calendar =Calendar.getInstance();</span><br><span class="line">System.out.println(calendar.getTime());//Calenderå˜Date</span><br><span class="line">System.out.println(calendar.getTimeInMillis());//Calenderå˜æ—¶é—´æˆ³</span><br><span class="line">Calendar calendar1 = new GregorianCalendar();</span><br><span class="line">System.out.println(calendar1.getTime()); //è¾“å‡ºä¸€æ ·</span><br><span class="line"></span><br><span class="line">//2.è·å–æ—¶é—´ä¿¡æ¯</span><br><span class="line">//è·å–å¹´</span><br><span class="line">int year = calendar.get(Calendar.YEAR);</span><br><span class="line">//æœˆ</span><br><span class="line">int month = calendar.get(Calendar.MONTH);</span><br><span class="line">//æ—¥</span><br><span class="line">int day = calendar.get(Calendar.DAY_OF_MONTH);//DATE</span><br><span class="line">//å°æ—¶</span><br><span class="line">int hour = calendar.get(Calendar.HOUR_OF_DAY);</span><br><span class="line">//åˆ†é’Ÿ</span><br><span class="line">int minute = calendar.get(Calendar.MINUTE);</span><br><span class="line">//ç§’</span><br><span class="line">int second = calendar.get(Calendar.SECOND);</span><br><span class="line">System.out.println(year+&quot;å¹´&quot;+month+&quot;æœˆ&quot;+day+&quot;æ—¥&quot;+&quot;  &quot;+hour+&quot;æ—¶&quot;+minute+&quot;åˆ†&quot;+second+&quot;ç§’&quot;);</span><br><span class="line"></span><br><span class="line">//ä¿®æ”¹æ—¶é—´</span><br><span class="line">Calendar calendar2 =Calendar.getInstance();</span><br><span class="line">calendar2.set(Calendar.DAY_OF_MONTH,5);</span><br><span class="line">System.out.println(calendar2.getTime().toLocaleString());</span><br><span class="line"></span><br><span class="line">//addæ–¹æ³•ä¿®æ”¹æ—¶é—´</span><br><span class="line">calendar2.add(Calendar.HOUR,-1);</span><br><span class="line">System.out.println(calendar2.getTime().toLocaleString());</span><br><span class="line"></span><br><span class="line">//è·å–å½“æœˆå¤šå°‘å¤©</span><br><span class="line">int max = calendar2.getActualMaximum(Calendar.DAY_OF_MONTH); //30</span><br><span class="line">int min = calendar2.getActualMinimum(Calendar.DAY_OF_MONTH); //1</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/a1439775520/article/details/98442556">https://blog.csdn.net/a1439775520/article/details/98442556</a> </p>
<p>ğŸç”¨Calenderè®¡ç®—é‡æ—¥æœŸç›¸å·®å¤©æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private static int differentDays(Date date1,Date date2) &#123;</span><br><span class="line">    Calendar cal1 = Calendar.getInstance();</span><br><span class="line">    cal1.setTime(date1);</span><br><span class="line"></span><br><span class="line">    Calendar cal2 = Calendar.getInstance();</span><br><span class="line">    cal2.setTime(date2);</span><br><span class="line">    int day1= cal1.get(Calendar.DAY_OF_YEAR);</span><br><span class="line">    int day2 = cal2.get(Calendar.DAY_OF_YEAR);</span><br><span class="line"></span><br><span class="line">    int year1 = cal1.get(Calendar.YEAR);</span><br><span class="line">    int year2 = cal2.get(Calendar.YEAR);</span><br><span class="line">    if(year1 != year2) &#123;//ä¸åŒå¹´</span><br><span class="line">        int timeDistance = 0 ;</span><br><span class="line">        for(int i = year1 ; i &lt; year2 ; i ++)</span><br><span class="line">        &#123;</span><br><span class="line">            if(i%4==0 &amp;&amp; i%100!=0 || i%400==0)    //é—°å¹´</span><br><span class="line">            &#123;</span><br><span class="line">                timeDistance += 366;</span><br><span class="line">            &#125;</span><br><span class="line">            else    //ä¸æ˜¯é—°å¹´</span><br><span class="line">            &#123;</span><br><span class="line">                timeDistance += 365;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return timeDistance + (day2-day1) ;</span><br><span class="line">    &#125; else &#123;// åŒå¹´</span><br><span class="line">        System.out.println(&quot;åˆ¤æ–­day2 - day1 : &quot; + (day2-day1));</span><br><span class="line">        return day2-day1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static int differentDaysByMillisecond(Date date1,Date date2)&#123;</span><br><span class="line">    int days = (int) ((date2.getTime() - date1.getTime()) / (1000*3600*24));</span><br><span class="line">    return days;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…æ—¶é—´æˆ³"><a href="#âœ…æ—¶é—´æˆ³" class="headerlink" title="âœ…æ—¶é—´æˆ³"></a>âœ…æ—¶é—´æˆ³</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void timeStampTest() &#123;</span><br><span class="line">  // å½“å‰æ—¶é—´æ—¶é—´æˆ³</span><br><span class="line">  long nowStamp = System.currentTimeMillis();</span><br><span class="line">  System.out.println(&quot;æ¯«ç§’æ—¶é—´æˆ³ï¼š&quot; + nowStamp);</span><br><span class="line">  long nowhaomiao = System.currentTimeMillis() * 1000;</span><br><span class="line">  System.out.println(&quot;å¾®å¦™æ—¶é—´æˆ³&quot; + nowhaomiao);</span><br><span class="line">  long nowhaomiao1 = System.nanoTime() / 1000;</span><br><span class="line">  System.out.println(&quot;å¾®å¦™æ—¶é—´æˆ³1&quot; + nowhaomiao1); //ä¸è¡Œ</span><br><span class="line"></span><br><span class="line">  // æ˜¨å¤©è¿™ä¸ªæ—¶é—´æ—¶é—´æˆ³</span><br><span class="line">  Calendar calendar = Calendar.getInstance();</span><br><span class="line">  calendar.add(Calendar.DAY_OF_YEAR, -1);</span><br><span class="line">  //calender.getTimeå˜Dateï¼Œå†getTimeå˜æ—¶é—´æˆ³ï¼ˆlongå‹çš„ï¼‰</span><br><span class="line">  System.out.println(&quot;æ˜¨å¤©æ­¤æ—¶ï¼š&quot; + calendar.getTime().getTime());</span><br><span class="line"></span><br><span class="line">  // æ˜¨å¤©æŸæ—¶é—´çš„æ—¶é—´æˆ³</span><br><span class="line">  Calendar calendar1 = Calendar.getInstance();</span><br><span class="line">  calendar.set(calendar1.get(Calendar.YEAR), calendar1.get(Calendar.MONTH), calendar1.get(Calendar.DAY_OF_MONTH) - 1, 23, 59, 59);</span><br><span class="line">  System.out.println(calendar.getTime().getTime());</span><br><span class="line"></span><br><span class="line">  // æ—¶é—´æˆ³è½¬æ¢ä¸ºDate</span><br><span class="line">  Date now = new Date(nowStamp);  //longå‹</span><br><span class="line">  //å¦‚æœæ˜¯æ—¶é—´æˆ³å­—ç¬¦ä¸²ï¼Œç”¨ä¸‹é¢</span><br><span class="line">  //Date now1 = new Date(Long.parseLong(nowStamp));</span><br><span class="line">  System.out.println(&quot;now: &quot; + now);</span><br><span class="line">  // å†è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><br><span class="line">  String format = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span><br><span class="line">  SimpleDateFormat sdf = new SimpleDateFormat(format);</span><br><span class="line">  System.out.println(&quot;now: &quot; + sdf.format(now));</span><br><span class="line"></span><br><span class="line">  // æ—¥æœŸæ ¼å¼å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ—¶é—´æˆ³</span><br><span class="line">  String s = &quot;2022-06-25 12:12:12&quot;;</span><br><span class="line">  try &#123;</span><br><span class="line">      // String-Date-longå‹æ—¶é—´æˆ³</span><br><span class="line">      System.out.println(&quot;æ—¶é—´æˆ³ï¼š&quot; + String.valueOf(sdf.parse(s).getTime()));</span><br><span class="line">  &#125; catch (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…DateUtilså·¥å…·ç±»"><a href="#âœ…DateUtilså·¥å…·ç±»" class="headerlink" title="âœ…DateUtilså·¥å…·ç±»"></a>âœ…DateUtilså·¥å…·ç±»</h4><p>apache.commons.lang3åŒ…ä¸‹çš„å·¥å…·ç±»</p>
<p>1ã€è·å–æŒ‡å®šæ—¥æœŸçš„å¼€å§‹æ—¶é—´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testDateUtils() throws ParseException &#123;</span><br><span class="line">    // è·å–æŒ‡å®šæ—¥æœŸçš„å¼€å§‹æ—¶é—´</span><br><span class="line">    DateFormat df = DateFormat.getDateInstance();</span><br><span class="line">    Date date = df.parse(&quot;2022-06-24 14:01:01&quot;);</span><br><span class="line">    Date begin = org.apache.commons.lang3.time.DateUtils.truncate(date, Calendar.DATE);</span><br><span class="line">    System.out.println(&quot;åˆå§‹æ—¶é—´ï¼š&quot; + begin);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…è®¡ç®—ä¸¤ä¸ªæ—¶é—´æ®µä¹‹é—´çš„æ‰€æœ‰å¤©"><a href="#âœ…è®¡ç®—ä¸¤ä¸ªæ—¶é—´æ®µä¹‹é—´çš„æ‰€æœ‰å¤©" class="headerlink" title="âœ…è®¡ç®—ä¸¤ä¸ªæ—¶é—´æ®µä¹‹é—´çš„æ‰€æœ‰å¤©"></a>âœ…è®¡ç®—ä¸¤ä¸ªæ—¶é—´æ®µä¹‹é—´çš„æ‰€æœ‰å¤©</h4><p>è¾“å…¥ï¼šbegin:â€˜2022-08-01â€™ end:â€˜2022-08-05â€™<br>è¾“å‡ºï¼šâ€2021-08-01â€,â€2021-08-02â€,â€2021-08-03â€,â€2021-08-04â€,â€2021-08-05â€</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static List&lt;String&gt; findDates(String beginTime, String endTime)</span><br><span class="line">        throws ParseException &#123;</span><br><span class="line">    List&lt;String&gt; allDate = new ArrayList();</span><br><span class="line">    SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br><span class="line"></span><br><span class="line">    Date dBegin = sdf.parse(beginTime);</span><br><span class="line">    Date dEnd = sdf.parse(endTime);</span><br><span class="line">    allDate.add(sdf.format(dBegin));</span><br><span class="line">    Calendar calBegin = Calendar.getInstance();</span><br><span class="line">    // ä½¿ç”¨ç»™å®šçš„ Date è®¾ç½®æ­¤ Calendar çš„æ—¶é—´</span><br><span class="line">    calBegin.setTime(dBegin);</span><br><span class="line">    Calendar calEnd = Calendar.getInstance();</span><br><span class="line">    // ä½¿ç”¨ç»™å®šçš„ Date è®¾ç½®æ­¤ Calendar çš„æ—¶é—´</span><br><span class="line">    calEnd.setTime(dEnd);</span><br><span class="line">    // æµ‹è¯•æ­¤æ—¥æœŸæ˜¯å¦åœ¨æŒ‡å®šæ—¥æœŸä¹‹å</span><br><span class="line">    while (dEnd.after(calBegin.getTime())) &#123;</span><br><span class="line">        // æ ¹æ®æ—¥å†çš„è§„åˆ™ï¼Œä¸ºç»™å®šçš„æ—¥å†å­—æ®µæ·»åŠ æˆ–å‡å»æŒ‡å®šçš„æ—¶é—´é‡</span><br><span class="line">        calBegin.add(Calendar.DAY_OF_MONTH, 1);</span><br><span class="line">        allDate.add(sdf.format(calBegin.getTime()));</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;æ—¶é—´==&quot; + allDate);</span><br><span class="line">    return allDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…åˆ¤æ–­æ˜¯å¦åŒä¸€å¤©"><a href="#âœ…åˆ¤æ–­æ˜¯å¦åŒä¸€å¤©" class="headerlink" title="âœ…åˆ¤æ–­æ˜¯å¦åŒä¸€å¤©"></a>âœ…åˆ¤æ–­æ˜¯å¦åŒä¸€å¤©</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static boolean isSameDay(Date date1, Date date2) &#123;</span><br><span class="line">    LocalDate localDate1 = date1.toInstant()</span><br><span class="line">            .atZone(ZoneId.systemDefault())</span><br><span class="line">            .toLocalDate();</span><br><span class="line">    LocalDate localDate2 = date2.toInstant()</span><br><span class="line">            .atZone(ZoneId.systemDefault())</span><br><span class="line">            .toLocalDate();</span><br><span class="line">    return localDate1.isEqual(localDate2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static boolean isSameDay(Date date1, Date date2) &#123;</span><br><span class="line">    SimpleDateFormat fmt = new SimpleDateFormat(&quot;yyyyMMdd&quot;);</span><br><span class="line">    return fmt.format(date1).equals(fmt.format(date2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥è‡ªï¼š<a href="https://blog.csdn.net/nandao158/article/details/121905050">https://blog.csdn.net/nandao158/article/details/121905050</a></p>
<h4 id="âœ…è·å–ä»Šå¤©æ˜ŸæœŸå‡ "><a href="#âœ…è·å–ä»Šå¤©æ˜ŸæœŸå‡ " class="headerlink" title="âœ…è·å–ä»Šå¤©æ˜ŸæœŸå‡ "></a>âœ…è·å–ä»Šå¤©æ˜ŸæœŸå‡ </h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Calendar calendar = Calendar.getInstance();</span><br><span class="line">Date date = new Date();</span><br><span class="line">calendar.setTime(date);</span><br><span class="line">System.out.println(calendar.get(Calendar.DAY_OF_WEEK));</span><br></pre></td></tr></table></figure>

<p>è·å–åˆ°çš„æ•°å­—ï¼Œæ˜ŸæœŸä¸€åˆ°æ˜ŸæœŸä¸ƒå¯¹åº”æ•°å­—{2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6, 7ï¼Œ0}ï¼Œæ‰€ä»¥éœ€è¦å‡ä¸€ï¼Œå‡ä¸€ä¹‹ååˆ¤æ–­æ˜¯ä¸æ˜¯ç­‰äº0ï¼Œç­‰äº0å°±å˜æˆ7.</p>
<h3 id="Stringç›¸å…³"><a href="#Stringç›¸å…³" class="headerlink" title="Stringç›¸å…³"></a>Stringç›¸å…³</h3><h4 id="intå˜String-Stringå˜int"><a href="#intå˜String-Stringå˜int" class="headerlink" title="intå˜String,Stringå˜int"></a>intå˜String,Stringå˜int</h4><p>ç¬¬ä¸€ç§æ–¹å¼ï¼šä½¿ç”¨intçš„å°è£…ç±»Integerï¼Œåœ¨Integeré‡Œé¢ç”¨ä»–çš„toStringæ–¹æ³•ã€‚ï¼ˆæ€§èƒ½æœ€å¥½ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int i=3ï¼›</span><br><span class="line">String s=Integer.toString(i);</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§æ–¹å¼ï¼šStringçš„valueOfæ–¹æ³•ï¼Œä¼ å‚æ˜¯Objectï¼ˆæ€§èƒ½ç¬¬äºŒï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int i=1;</span><br><span class="line">String s=String.valueOf(i);</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ç§æ–¹å¼ï¼Œç›´æ¥åœ¨intåé¢åŠ ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºåœ¨javaé‡Œé¢ï¼Œé»˜è®¤ä»»åŠ¡intç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹ç›¸åŠ ï¼Œä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚ï¼ˆæ€§èƒ½æœ€å·®ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int i=2ï¼›</span><br><span class="line">String s=i+&quot;&quot;;</span><br></pre></td></tr></table></figure>

<p>stringå˜int&#x2F;Longï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Integer i1 = Integer.parseInt(s);</span><br><span class="line">Integer i = Integer.valueOf(s);</span><br><span class="line">Long l = Long.valueOf(s);</span><br><span class="line">Long l1 = Long.parseLong(s);</span><br></pre></td></tr></table></figure>

<p><code>Integer.parseInt</code> æ–¹æ³•ï¼š<br>parseInt(String s, int radix)ï¼š sè¡¨ç¤ºå­—ç¬¦ä¸²  radixè¡¨ç¤ºå­—ç¬¦ä¸²æ•°å€¼çš„è¿›åˆ¶ï¼Œä¾‹å¦‚ï¼šparseInt(â€œ100â€, 16) &#x3D; 256<br>parseInt(String s)ï¼šç›¸å½“äºé»˜è®¤æ˜¯10è¿›åˆ¶</p>
<h4 id="String-format"><a href="#String-format" class="headerlink" title="String.format"></a>String.format</h4><p>String.format(String format, Objectâ€¦ args)<br>å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•ï¼Œsoutä¹Ÿè¿™ä¹ˆç”¨ã€‚</p>
<p><code>String str=String.format(&quot;Hi,%s %s %s&quot;, &quot;å°è¶…&quot;,&quot;æ˜¯ä¸ª&quot;,&quot;å¤§å¸…å“¥&quot;);  </code></p>
<p>%s	å­—ç¬¦ä¸²ç±»å‹	â€œhelloâ€<br>%c	å­—ç¬¦ç±»å‹	â€˜mâ€™<br>%b	å¸ƒå°”ç±»å‹	true<br>%d	æ•´æ•°ç±»å‹ï¼ˆåè¿›åˆ¶ï¼‰	88<br>%x	æ•´æ•°ç±»å‹ï¼ˆåå…­è¿›åˆ¶ï¼‰	FF<br>%o	æ•´æ•°ç±»å‹ï¼ˆå…«è¿›åˆ¶ï¼‰	77<br>%f	æµ®ç‚¹ç±»å‹	8.888<br>%a	åå…­è¿›åˆ¶æµ®ç‚¹ç±»å‹	FF.35AE<br>%e	æŒ‡æ•°ç±»å‹	9.38e+5<br>%g	é€šç”¨æµ®ç‚¹ç±»å‹ï¼ˆfå’Œeç±»å‹ä¸­è¾ƒçŸ­çš„ï¼‰	ä¸ä¸¾ä¾‹(åŸºæœ¬ç”¨ä¸åˆ°)<br>%h	æ•£åˆ—ç 	ä¸ä¸¾ä¾‹(åŸºæœ¬ç”¨ä¸åˆ°)<br>%%	ç™¾åˆ†æ¯”ç±»å‹	ï¼…(%ç‰¹æ®Šå­—ç¬¦%%æ‰èƒ½æ˜¾ç¤º%)<br>%n	æ¢è¡Œç¬¦	ä¸ä¸¾ä¾‹(åŸºæœ¬ç”¨ä¸åˆ°)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    String str=null;  </span><br><span class="line">    str=String.format(&quot;Hi,%s&quot;, &quot;å°è¶…&quot;);  </span><br><span class="line">    System.out.println(str);  </span><br><span class="line">    str=String.format(&quot;Hi,%s %s %s&quot;, &quot;å°è¶…&quot;,&quot;æ˜¯ä¸ª&quot;,&quot;å¤§å¸…å“¥&quot;);            </span><br><span class="line">    System.out.println(str);                           </span><br><span class="line">    System.out.printf(&quot;å­—æ¯cçš„å¤§å†™æ˜¯ï¼š%c %n&quot;, &#x27;C&#x27;);  </span><br><span class="line">    System.out.printf(&quot;å¸ƒå°”ç»“æœæ˜¯ï¼š%b %n&quot;, &quot;å°è¶…&quot;.equal(&quot;å¸…å“¥&quot;));  </span><br><span class="line">    System.out.printf(&quot;100çš„ä¸€åŠæ˜¯ï¼š%d %n&quot;, 100/2);  </span><br><span class="line">    System.out.printf(&quot;100çš„16è¿›åˆ¶æ•°æ˜¯ï¼š%x %n&quot;, 100);  </span><br><span class="line">    System.out.printf(&quot;100çš„8è¿›åˆ¶æ•°æ˜¯ï¼š%o %n&quot;, 100);  </span><br><span class="line">    System.out.printf(&quot;50å…ƒçš„ä¹¦æ‰“8.5æŠ˜æ‰£æ˜¯ï¼š%f å…ƒ%n&quot;, 50*0.85);  </span><br><span class="line">    System.out.printf(&quot;ä¸Šé¢ä»·æ ¼çš„16è¿›åˆ¶æ•°æ˜¯ï¼š%a %n&quot;, 50*0.85);  </span><br><span class="line">    System.out.printf(&quot;ä¸Šé¢ä»·æ ¼çš„æŒ‡æ•°è¡¨ç¤ºï¼š%e %n&quot;, 50*0.85);  </span><br><span class="line">    System.out.printf(&quot;ä¸Šé¢ä»·æ ¼çš„æŒ‡æ•°å’Œæµ®ç‚¹æ•°ç»“æœçš„é•¿åº¦è¾ƒçŸ­çš„æ˜¯ï¼š%g %n&quot;, 50*0.85);  </span><br><span class="line">    System.out.printf(&quot;ä¸Šé¢çš„æŠ˜æ‰£æ˜¯%d%% %n&quot;, 85);  </span><br><span class="line">    System.out.printf(&quot;å­—æ¯Açš„æ•£åˆ—ç æ˜¯ï¼š%h %n&quot;, &#x27;A&#x27;);  </span><br><span class="line"></span><br><span class="line">æ—¥æœŸæ ¼å¼ï¼š%tx xä»£è¡¨æ—¥æœŸè½¬æ¢ç¬¦</span><br><span class="line">c	åŒ…æ‹¬å…¨éƒ¨æ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯	æ˜ŸæœŸå…­ åæœˆ 27 14:21:20 CST 2007</span><br><span class="line">F	â€œå¹´-æœˆ-æ—¥â€æ ¼å¼	2007-10-27</span><br><span class="line">D	â€œæœˆ/æ—¥/å¹´â€æ ¼å¼	10/27/07</span><br><span class="line">r	â€œHH:MM:SS PMâ€æ ¼å¼ï¼ˆ12æ—¶åˆ¶ï¼‰	02:25:51 ä¸‹åˆ</span><br><span class="line">T	â€œHH:MM:SSâ€æ ¼å¼ï¼ˆ24æ—¶åˆ¶ï¼‰	14:28:16</span><br><span class="line">R	â€œHH:MMâ€æ ¼å¼ï¼ˆ24æ—¶åˆ¶ï¼‰	14:28</span><br><span class="line"></span><br><span class="line">Date date=new Date();                                  </span><br><span class="line">//cçš„ä½¿ç”¨  </span><br><span class="line">System.out.printf(&quot;å…¨éƒ¨æ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯ï¼š%tc%n&quot;,date);          </span><br><span class="line">//fçš„ä½¿ç”¨  </span><br><span class="line">System.out.printf(&quot;å¹´-æœˆ-æ—¥æ ¼å¼ï¼š%tF%n&quot;,date);  </span><br><span class="line">//dçš„ä½¿ç”¨  </span><br><span class="line">System.out.printf(&quot;æœˆ/æ—¥/å¹´æ ¼å¼ï¼š%tD%n&quot;,date);  </span><br><span class="line">//rçš„ä½¿ç”¨  </span><br><span class="line">System.out.printf(&quot;HH:MM:SS PMæ ¼å¼ï¼ˆ12æ—¶åˆ¶ï¼‰ï¼š%tr%n&quot;,date);  </span><br><span class="line">//tçš„ä½¿ç”¨  </span><br><span class="line">System.out.printf(&quot;HH:MM:SSæ ¼å¼ï¼ˆ24æ—¶åˆ¶ï¼‰ï¼š%tT%n&quot;,date);  </span><br><span class="line">//Rçš„ä½¿ç”¨  </span><br><span class="line">System.out.printf(&quot;HH:MMæ ¼å¼ï¼ˆ24æ—¶åˆ¶ï¼‰ï¼š%tR&quot;,date);  </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">System.out.printf(&quot;%f&quot;, d);// &quot;f&quot;è¡¨ç¤ºæ ¼å¼åŒ–è¾“å‡ºæµ®ç‚¹æ•°ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;%9.2f&quot;, d);// &quot;9.2&quot;ä¸­çš„9è¡¨ç¤ºè¾“å‡ºçš„é•¿åº¦ï¼Œ2è¡¨ç¤ºå°æ•°ç‚¹åçš„ä½æ•°ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;%+9.2f&quot;, d);// &quot;+&quot;è¡¨ç¤ºè¾“å‡ºçš„æ•°å¸¦æ­£è´Ÿå·ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;%-9.4f&quot;, d);// &quot;-&quot;è¡¨ç¤ºè¾“å‡ºçš„æ•°å·¦å¯¹é½ï¼ˆé»˜è®¤ä¸ºå³å¯¹é½ï¼‰ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;%+-9.3f&quot;, d);// &quot;+-&quot;è¡¨ç¤ºè¾“å‡ºçš„æ•°å¸¦æ­£è´Ÿå·ä¸”å·¦å¯¹é½ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;%d&quot;, i);// &quot;d&quot;è¡¨ç¤ºè¾“å‡ºåè¿›åˆ¶æ•´æ•°ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;%o&quot;, i);// &quot;o&quot;è¡¨ç¤ºè¾“å‡ºå…«è¿›åˆ¶æ•´æ•°ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;%x&quot;, i);// &quot;d&quot;è¡¨ç¤ºè¾“å‡ºåå…­è¿›åˆ¶æ•´æ•°ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;%#x&quot;, i);// &quot;d&quot;è¡¨ç¤ºè¾“å‡ºå¸¦æœ‰åå…­è¿›åˆ¶æ ‡å¿—çš„æ•´æ•°ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;%s&quot;, s);// &quot;d&quot;è¡¨ç¤ºè¾“å‡ºå­—ç¬¦ä¸²ã€‚  </span><br><span class="line">System.out.println();  </span><br><span class="line">System.out.printf(&quot;è¾“å‡ºä¸€ä¸ªæµ®ç‚¹æ•°ï¼š%fï¼Œä¸€ä¸ªæ•´æ•°ï¼š%dï¼Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼š%s&quot;, d, i, s);  </span><br><span class="line">// å¯ä»¥è¾“å‡ºå¤šä¸ªå˜é‡ï¼Œæ³¨æ„é¡ºåºã€‚  </span><br><span class="line">System.out.println();  </span><br></pre></td></tr></table></figure>

<h4 id="Strings-nullToEmpty"><a href="#Strings-nullToEmpty" class="headerlink" title="Strings.nullToEmpty"></a>Strings.nullToEmpty</h4><p>Stringsã€Listsã€Maps éƒ½æ˜¯googleæä¾›çš„å·¥å…·ç±»ã€‚<br>ä½¿ç”¨ä¹‹å‰å¯¼å…¥åŒ…guavaã€‚</p>
<p>vo.setS(String.nullToEmpty(s));  ä¸€èˆ¬ç”¨äºç»™å¯¹è±¡å±æ€§èµ‹å€¼ï¼Œå¦‚æœä¸ºnullï¼Œå°±è®¾ç©ºã€‚</p>
<p>å…¶ä»–guavaå·¥å…·ç±»ä½¿ç”¨ï¼š<a href="https://www.w3cschool.cn/article/17770773.html">https://www.w3cschool.cn/article/17770773.html</a></p>
<h4 id="StringUtilså·¥å…·ç±»"><a href="#StringUtilså·¥å…·ç±»" class="headerlink" title="StringUtilså·¥å…·ç±»"></a>StringUtilså·¥å…·ç±»</h4><p>StringUtilså·¥å…·ç±»æ˜¯org.apache.commons.lang3åŒ…ä¸‹çš„å·¥å…·ç±»ï¼Œå¯¹Stringç±»å‹çš„æ“ä½œä½œäº†å°è£…ï¼Œæ˜¯å¯¹Javaè‡ªå¸¦çš„APIçš„æœ‰æ•ˆè¡¥å……ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´é«˜æ•ˆå¿«é€Ÿåœ°å¤„ç†å­—ç¬¦ä¸²ã€‚</p>
<p>å¯¼å…¥commons-lang3åŒ…ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String substringAfter(String str,String separator)ï¼š</span><br><span class="line">åœ¨ç¬¬ä¸€æ¬¡å‡ºç°åˆ†éš”ç¬¦åè·å–å­å­—ç¬¦ä¸²ã€‚</span><br><span class="line"></span><br><span class="line">String substringAfterLast(String str,String separator)ï¼š</span><br><span class="line">åœ¨æœ€åä¸€æ¬¡å‡ºç°åˆ†éš”ç¬¦ä¹‹åè·å–å­å­—ç¬¦ä¸²ã€‚</span><br><span class="line"></span><br><span class="line">String substringBefore(String str,String separator)ï¼š</span><br><span class="line">ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å‡ºç°ä¹‹å‰çš„</span><br><span class="line">StringUtils.substringBefore(&quot;www.baidu.com&quot;, &quot;.)  www</span><br></pre></td></tr></table></figure>

<p>å·¥å…·ç±»ï¼šä¸€èˆ¬æ˜¯ç›´æ¥ç”¨å®ƒçš„é™æ€æ–¹æ³•ï¼Œç›´æ¥ç”¨ç±»æ¥è°ƒç”¨ï¼Œä¾‹å¦‚ï¼šCollectionsã€Arraysç­‰jaaè‡ªå¸¦çš„å·¥å…·ç±»ï¼›Listsã€Mapsç­‰googleå·¥å…·ç±»ï¼›CollectionUtilsã€StringUtilsç­‰apacheå·¥å…·ç±»ã€‚</p>
<p>æ›´å¤šï¼š<a href="https://cloud.tencent.com/developer/article/1662921">https://cloud.tencent.com/developer/article/1662921</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">StringUtils.EMPTY = &quot;&quot;</span><br><span class="line"></span><br><span class="line">// åªæ›¿æ¢ä¸€æ¬¡--&gt;ç»“æœæ˜¯ï¼šphhhss</span><br><span class="line">StringUtils.replaceOnce(&quot;sshhhss&quot;, &quot;ss&quot;, &quot;p&quot;);</span><br><span class="line">// å…¨éƒ¨æ›¿æ¢</span><br><span class="line">StringUtils.replace(&quot;sshhhs&quot;, &quot;ss&quot;, &quot;p&quot;);</span><br><span class="line">// å®šä¹‰æ›¿æ¢æ¬¡æ•°</span><br><span class="line">StringUtils.replace(&quot;sshhhsshss&quot;, &quot;ss&quot;, &quot;7777&quot;,2);</span><br><span class="line">// æ£€éªŒå­—ç¬¦ä¸²æ˜¯å¦ä¸ä¸ºnullä¸”ä¸ä¸ºâ€œâ€</span><br><span class="line">if(!StringUtils.isEmpty(s))</span><br><span class="line"></span><br><span class="line">//å¿½ç•¥å¤§å°å†™çš„æ¯”è¾ƒï¼š</span><br><span class="line">System.out.println(StringUtils.equalsIgnoreCase(&quot;abc&quot;, &quot;aBC&quot;));</span><br></pre></td></tr></table></figure>

<p><code>ObjectUtils.allNotNull(o1, o2)</code> æ˜¯commons-lang3åŒ…ä¸‹çš„ï¼Œè¿”å›booleanï¼Œè¡¨ç¤ºæ˜¯å¦æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¸ä¸ºnullï¼Œfalseè¡¨ç¤ºæœ‰nullã€‚</p>
<h4 id="stringè‡ªå·±çš„æ–¹æ³•"><a href="#stringè‡ªå·±çš„æ–¹æ³•" class="headerlink" title="stringè‡ªå·±çš„æ–¹æ³•"></a>stringè‡ªå·±çš„æ–¹æ³•</h4><p>âœ…str.trim()  ç”¨äºåˆ é™¤å­—ç¬¦ä¸²çš„å¤´å°¾ç©ºç™½ç¬¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String str = new String(&quot;   hello   &quot;);</span><br><span class="line">System.out.println( str.trim() );</span><br></pre></td></tr></table></figure>

<p>âœ…str.replaceAll(æ­£åˆ™è¡¨è¾¾å¼, æ›¿æ¢å­—ç¬¦ä¸²)<br>ä½¿ç”¨ç»™å®šçš„å‚æ•° replacement æ›¿æ¢å­—ç¬¦ä¸²æ‰€æœ‰åŒ¹é…ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼çš„å­å­—ç¬¦ä¸²</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String Str = new String(&quot;www.hello.com&quot;);</span><br><span class="line">System.out.println(Str.replaceAll(&quot;(.*)hello(.*)&quot;, &quot;hi&quot; ));</span><br></pre></td></tr></table></figure>

<p>âœ…str.replace(åŸå­—ç¬¦&#x2F;å­—ç¬¦ä¸², æ›¿æ¢æˆçš„æ–°å­—ç¬¦&#x2F;å­—ç¬¦ä¸²)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String replace(char oldChar, char newChar)</span><br><span class="line">ç”¨æ–°å­—ç¬¦newChar æ›¿æ¢æ‰€æœ‰çš„ æ—§å­—ç¬¦oldChar ã€‚</span><br><span class="line"></span><br><span class="line">String replace(CharSequence target, CharSequence replacement)</span><br><span class="line">ç”¨æ–°å­—ç¬¦ä¸²replacementæ›¿æ¢æ‰€æœ‰çš„ æ—§å­—ç¬¦ä¸²targetã€‚</span><br><span class="line"></span><br><span class="line">String replaceAll(String regex, String replacement)</span><br><span class="line">ç”¨æ–°å­—ç¬¦ä¸²replacement æ›¿æ¢æ‰€æœ‰çš„ æ­£åˆ™æ¨¡å¼åŒ¹é…çš„ä¸²ã€‚â€”â€”ï¼ˆæ›¿æ¢çš„æ˜¯æ¨¡ç³Šå­—ä¸²ï¼‰</span><br><span class="line"></span><br><span class="line">String replaceFirst(String regex, String replacement)</span><br><span class="line">ç”¨æ–°å­—ç¬¦ä¸²replacement æ›¿æ¢ç¬¬ä¸€ä¸ª æ­£åˆ™æ¨¡å¼åŒ¹é…çš„ä¸²ã€‚â€”â€”ï¼ˆæ›¿æ¢çš„æ˜¯æ¨¡ç³Šå­—ä¸²ï¼‰</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">å¦å¤–ï¼ŒStringBuilderä¸­ä¹Ÿæœ‰è¯¥æ–¹æ³•ï¼š</span><br><span class="line">replace(int startï¼Œint endï¼ŒString str)</span><br><span class="line">ç”¨str æ›¿æ¢ startâ€“endçš„å­ä¸²ã€‚//ä¸åŒ…æ‹¬end</span><br></pre></td></tr></table></figure>

<p>âœ…str.indexof() ç”¨äºè¿”å›å­—ç¬¦ä¸²ä¸­æŸéƒ¨åˆ†çš„ç´¢å¼•<br>1ã€ indexOf(String str): è¿”å›æŒ‡å®šå­—ç¬¦stråœ¨å­—ç¬¦ä¸²ä¸­ï¼ˆæ–¹æ³•è°ƒç”¨è€…ï¼‰ç¬¬ä¸€æ¬¡å‡ºç°å¤„çš„èµ·å§‹ç´¢å¼•ï¼Œå¦‚æœæ­¤å­—ç¬¦ä¸²ä¸­æ²¡æœ‰è¿™æ ·çš„å­—ç¬¦ï¼Œåˆ™è¿”å› -1ã€‚<br>2ã€indexOf(String str, int index): è¿”å›ä» index ä½ç½®å¼€å§‹æŸ¥æ‰¾æŒ‡å®šå­—ç¬¦stråœ¨å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°å¤„çš„èµ·å§‹ç´¢å¼•ï¼Œå¦‚æœæ­¤å­—ç¬¦ä¸²ä¸­æ²¡æœ‰è¿™æ ·çš„å­—ç¬¦ï¼Œåˆ™è¿”å› -1ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String str = &quot;01234567890123456789&quot;;</span><br><span class="line">System.out.println(str.indexOf(&quot;123&quot;));  //return 1</span><br><span class="line">System.out.println(str.indexOf(&quot;123&quot;,5));  //return 11</span><br></pre></td></tr></table></figure>

<p>str.lastIndexOf(â€œ&#x2F;&#x2F;â€œ)  è¿”å›æœ€åä¸€æ¬¡å‡ºç°å­—ç¬¦&#x2F;å­—ç¬¦ä¸²çš„ä½ç½®ã€‚</p>
<p>âœ…String.join()é™æ€æ–¹æ³•<br>ç”¨äºå°†list&#x2F;setå˜ä¸ºString</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;Long&gt; list = Lists.newArrayList(1L, 2L, 2L);</span><br><span class="line">// å…ƒç´ ä¸­ç±»å‹å˜æ¢</span><br><span class="line">List&lt;String&gt; ls = list.stream().distinct().map(String::valueOf).collect(Collectors.toList());</span><br><span class="line">// é‡Œé¢çš„lsä¸èƒ½ä¸ºç©ºï¼Œå¿…é¡»æ˜¯Stringå…ƒç´ ç±»å‹</span><br><span class="line">String s = String.join(&quot;,&quot;, ls);</span><br><span class="line">System.out.println(s);</span><br><span class="line"></span><br><span class="line">//ç”¨setä¹Ÿå¯ä»¥</span><br><span class="line">Set&lt;Long&gt; set = Sets.newHashSet(1L, 2L);</span><br><span class="line">Set&lt;String&gt; ss = set.stream().map(i-&gt;String.valueOf(i)).collect(Collectors.toSet());</span><br><span class="line">s = String.join(&quot;,&quot;, ss);</span><br><span class="line">System.out.println(s);</span><br></pre></td></tr></table></figure>

<p>âœ…è·å–æŸä¸ªä½ç½®çš„å­—ç¬¦<br><code>char c = s.charAt(index);</code></p>
<h4 id="Splitterå·¥å…·ç±»ï¼ˆStringæ‹†åˆ†æˆlistï¼‰"><a href="#Splitterå·¥å…·ç±»ï¼ˆStringæ‹†åˆ†æˆlistï¼‰" class="headerlink" title="Splitterå·¥å…·ç±»ï¼ˆStringæ‹†åˆ†æˆlistï¼‰"></a>Splitterå·¥å…·ç±»ï¼ˆStringæ‹†åˆ†æˆlistï¼‰</h4><p>æ˜¯googleå‡ºå“çš„ï¼ŒguavaåŒ…ä¸‹çš„å·¥å…·ç±»ï¼Œç”¨äºå¯¹å­—ç¬¦ä¸²åˆ†å‰²å¤„ç†ã€‚</p>
<p>é¦–å…ˆï¼Œå·²æœ‰çš„å¯¹å­—ç¬¦ä¸²è¿›è¡Œåˆ†å‰²çš„æ–¹æ³•ï¼š</p>
<p>1.Stringè‡ªå¸¦çš„split()æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String s = &quot;1,2,3&quot;;</span><br><span class="line">String[] split = s.split(&quot;,&quot;);</span><br></pre></td></tr></table></figure>
<p>ä¸è¶³ä¹‹å¤„ï¼šå¦‚æœ,åæœ‰ç©ºæ ¼çš„è¯ï¼Œè¿˜éœ€è¦åšè¿›ä¸€æ­¥å¤„ç†ï¼Œ<br>å¹¶ä¸”åˆ†å‰²åä»¥æ•°ç»„æ¥æ”¶ï¼Œå¦‚æœæ•°æ®è¿‡å¤šï¼Œè¿˜éœ€è¦å†è½¬ä¸ºé›†åˆã€‚</p>
<p>2.ä½¿ç”¨Patterç±»çš„splité™æ€æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String input = &quot;This!!unusual use!!hh!!points&quot;;</span><br><span class="line">System.out.println(Arrays.toString(Pattern.compile(&quot;!!&quot;).split(input)));</span><br></pre></td></tr></table></figure>

<p>3.Splitteræ¥åˆ†å‰²å­—ç¬¦ä¸²</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SplitterTest &#123;</span><br><span class="line"></span><br><span class="line">    //å®šä¹‰ä¸€ä¸ªæ‹†åˆ†å™¨ï¼Œâ€œ,â€åˆ†éš”ï¼Œå»ç©ºæ ¼</span><br><span class="line">    private static final Splitter splitter = Splitter.on(&quot;,&quot;).trimResults().omitEmptyStrings();</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        String s = &quot;1,2, 3&quot;;</span><br><span class="line">        List&lt;String&gt; list = splitter.splitToList(s);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        List&lt;Long&gt; list1 = list.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">        System.out.println(list1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Joinerè¿æ¥å­—ç¬¦ä¸²"><a href="#Joinerè¿æ¥å­—ç¬¦ä¸²" class="headerlink" title="Joinerè¿æ¥å­—ç¬¦ä¸²"></a>Joinerè¿æ¥å­—ç¬¦ä¸²</h4><p>google guavaæä¾›çš„ç”¨æ¥è¿æ¥å­—ç¬¦ä¸²çš„ç±»ã€‚éœ€è¦å¯¼åŒ…ï¼šguavaã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// è¿æ¥å­—ç¬¦ä¸²list</span><br><span class="line">List&lt;String&gt; list = Arrays.asList(&quot;AA&quot;, &quot;BB&quot;, &quot;CC&quot;);</span><br><span class="line">String str = Joiner.on(&quot;:&quot;).join(list);</span><br><span class="line">System.out.println(str);</span><br><span class="line">// è¾“å‡ºï¼šAA:BB:CC</span><br><span class="line"></span><br><span class="line">//è¿‡æ»¤å…¶ä¸­çš„null</span><br><span class="line">List&lt;String&gt; list = Arrays.asList(&quot;AA&quot;, &quot;BB&quot;, null);</span><br><span class="line">String str = Joiner.on(&quot;:&quot;).skipNulls().join(list);</span><br><span class="line">System.out.println(str);</span><br><span class="line">// è¾“å‡ºï¼šAA:BB</span><br><span class="line"></span><br><span class="line">// å¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªJoinå¯¹è±¡</span><br><span class="line">private static Joiner MY_JOINER = Joiner.on(&quot;/&quot;).skipNulls();</span><br><span class="line">String s = MY_JOINER.join(..);  é‡Œé¢çš„å‚æ•°æ˜¯Objectç±»å‹ï¼Œå¯ä»¥å¤šä¸ªã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ›´å¤šç”¨æ³•ï¼š<a href="https://blog.csdn.net/qq_44143796/article/details/122998799">https://blog.csdn.net/qq_44143796/article/details/122998799</a></p>
<h4 id="Stringæ“ä½œ"><a href="#Stringæ“ä½œ" class="headerlink" title="Stringæ“ä½œ"></a>Stringæ“ä½œ</h4><p>âœ…æˆªå–å­—ç¬¦ä¸²</p>
<p>1ã€stringè‡ªå·±çš„substringæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String s = &quot;hello&quot;;</span><br><span class="line">System.out.println(s.substring(2)); //llo</span><br><span class="line">System.out.println(s.substring(2, 4)); //ll å·¦é—­å³å¼€</span><br></pre></td></tr></table></figure>

<p>2ã€StringUtilsæä¾›çš„æ–¹æ³•ï¼ˆapacheï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">StringUtils.substring(&quot;hello world&quot;, 4);   // è¿”å›å€¼ï¼Œä»ç¬¬4ä½æˆªå–åˆ°å­—ç¬¦ä¸²æœ«å°¾ : o wrold</span><br><span class="line">StringUtils.substring(&quot;hello world&quot;, 4, 10); // è¿”å›å€¼ï¼Œä»ç¬¬4ä½æˆªå–åˆ°ç¬¬9ä½ :   o wrol</span><br><span class="line"></span><br><span class="line">//æˆªå–æŸä¸ªå­—ç¬¦ä¸²ä¹‹å‰çš„å­—ç¬¦</span><br><span class="line">StringUtils.substringBefore(&quot;hello world&quot;, &quot;l&quot;); </span><br><span class="line">//ç»“æœæ˜¯ï¼šhe          è¿™é‡Œæ˜¯ä»¥ç¬¬ä¸€ä¸ªâ€lâ€ï¼Œä¸ºæ ‡å‡†ã€‚</span><br><span class="line">StringUtils.substringBeforeLast(&quot;hello world&quot;, &quot;l&quot;);</span><br><span class="line">//ç»“æœä¸ºï¼šhello wor   è¿™é‡Œä»¥æœ€åä¸€ä¸ªâ€œlâ€ä¸ºå‡†ã€‚</span><br><span class="line"></span><br><span class="line">//æˆªå–æŸä¸ªå­—ç¬¦ä¸²ä¹‹åçš„å­—ç¬¦</span><br><span class="line">StringUtils.substringAfter(&quot;hello world&quot;, &quot;l&quot;);</span><br><span class="line">//ç»“æœæ˜¯ï¼šlo world   è¿™é‡Œæ˜¯ä»¥ç¬¬ä¸€ä¸ªâ€lâ€ï¼Œä¸ºæ ‡å‡†ã€‚</span><br><span class="line">StringUtils.substringAfterLast(&quot;hello world&quot;, &quot;l&quot;);</span><br><span class="line">//ç»“æœä¸ºï¼šd          è¿™é‡Œä»¥æœ€åä¸€ä¸ªâ€œlâ€ä¸ºå‡†ã€‚</span><br><span class="line"></span><br><span class="line">//æˆªå–ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´éš”çš„å­—ç¬¦</span><br><span class="line">StringUtils.substringBetween(&quot;hello world&quot;, &quot;o&quot;);    </span><br><span class="line">//ç»“æœæ˜¯ï¼š w   ä¸¤ä¸ªoä¹‹é—´çš„å­—ç¬¦ä¸²ã€‚   </span><br><span class="line">StringUtils.substringBetween(&quot;hello world&quot;, &quot;l&quot;, &quot;r&quot;); </span><br><span class="line">//ç»“æœæ˜¯ï¼š lo wo   ç¬¬ä¸€ä¸ªå­—ç¬¦â€œlâ€ä¸ç¬¬ä¸€ä¸ªå­—ç¬¦â€œrâ€ä¹‹é—´çš„å­—ç¬¦ä¸²   </span><br><span class="line">StringUtils.substringsBetween(&quot;hello world&quot;, &quot;l&quot;, &quot;r&quot;);</span><br><span class="line">//ç»“æœæ˜¯ï¼šæ•°ç»„ [lo wo]   ç¬¬ä¸€ä¸ªå­—ç¬¦â€œlâ€ä¸ç¬¬ä¸€ä¸ªå­—ç¬¦â€œrâ€ä¹‹é—´çš„å­—ç¬¦ä¸²ï¼Œä»¥æ•°ç»„å½¢å¼è¿”å›ã€‚   </span><br></pre></td></tr></table></figure>

<p>3ã€stringè‡ªå·±çš„splitæ–¹æ³•<br>å°†å­—ç¬¦ä¸²æŒ‰ç…§åˆ†å‰²ç¬¦æˆªå–ï¼Œä»¥æ•°ç»„å½¢å¼è¿”å›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String str = &quot;hello, world, ni,  hao&quot;;</span><br><span class="line">String[]  strs=str.split(&quot;,&quot;);</span><br><span class="line">for(int i=0,len=strs.length;i&lt;len;i++)&#123;</span><br><span class="line">    System.out.println(strs[i]);</span><br><span class="line">&#125;</span><br><span class="line">//ç©ºæ ¼ä¹Ÿç®—äº†</span><br><span class="line">hello</span><br><span class="line"> world</span><br><span class="line"> ni</span><br><span class="line">  hao</span><br></pre></td></tr></table></figure>

<p><code>split(String regex)</code> å‚æ•°regexç§°ä¸ºåˆ†å‰²ç¬¦,å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¡¨ç¤ºã€‚<br>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String str= &quot;a33b444c555d&quot;;</span><br><span class="line">//æ­£åˆ™è¡¨è¾¾å¼ä¸­\d+è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—,javaä¸­\\è¡¨ç¤ºä¸€ä¸ªæ™®é€š\</span><br><span class="line">//String[] split = str.split(Pattern.compile(&quot;\\d+&quot;).toString());</span><br><span class="line">//ä¸¤ç§å†™æ³•éƒ½æ˜¯ä¸€æ ·çš„,ä¸‹é¢å†™æ³•ç®€æ´</span><br><span class="line">String[] split = str.split(&quot;\\d+&quot;);</span><br><span class="line"></span><br><span class="line">String str= &quot;aaa|bbb|ccc&quot;;</span><br><span class="line">//ä½¿ç”¨|ä½œä¸ºåˆ†éš”ç¬¦,å…¶ä½™ç‰¹æ®Šå­—ç¬¦åŒç†</span><br><span class="line">//ä¸¤ä¸ª\è¡¨ç¤ºä¸€ä¸ª\,åŠ äº†\åè¡¨ç¤ºä»…åŒ¹é…å­—ç¬¦æœ¬èº«</span><br><span class="line">String[] split = str.split(&quot;\\|&quot;);</span><br><span class="line"></span><br><span class="line">String str= &quot;aaa,bbb#ccc&quot;;</span><br><span class="line">//ä½¿ç”¨,æˆ–#åˆ†å‰²å­—ç¬¦ä¸²</span><br><span class="line">String[] split = str.split(&quot;,|#&quot;);</span><br></pre></td></tr></table></figure>

<p><code>split(String regex,int limit)</code> limitæ§åˆ¶åˆ†å‰²çš„æ¬¡æ•°ï¼Œåªå¡«ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„è¯,limité»˜è®¤æ˜¯0ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰limit &gt; 0,(ä»å·¦åˆ°å³)æœ€å¤šåˆ†å‰² n - 1 æ¬¡,æ•°ç»„çš„é•¿åº¦å°†ä¸ä¼šå¤§äº n,ç»“å°¾çš„ç©ºå­—ç¬¦ä¸²ä¸ä¼šä¸¢å¼ƒ</span><br><span class="line">//limit=3,åˆ‡å‰²2æ¬¡,æœ«å°¾ä¼šåˆ†å‰²å‡ºä¸€ä¸ª&quot;&quot;ç©ºå­—ç¬¦ä¸²</span><br><span class="line">String[] split = &quot;abcb&quot;.split(&quot;b&quot;,3);</span><br><span class="line">//split:&#123;&quot;a&quot;,&quot;c&quot;,&quot;&quot;&#125;</span><br><span class="line"></span><br><span class="line">ï¼ˆ2ï¼‰limit &lt; 0,åŒ¹é…åˆ°å¤šå°‘æ¬¡å°±åˆ†å‰²å¤šå°‘æ¬¡,è€Œä¸”æ•°ç»„å¯ä»¥æ˜¯ä»»ä½•é•¿åº¦ã€‚ç»“å°¾çš„ç©ºå­—ç¬¦ä¸²ä¸ä¼šä¸¢å¼ƒ</span><br><span class="line"></span><br><span class="line">ï¼ˆ3ï¼‰limit=0ä¸é™åˆ¶åˆ†å‰²æ¬¡æ•°ï¼Œè¦æ³¨æ„ç»“å°¾çš„ç©ºå­—ç¬¦ä¸²å°†ä¼šä¸¢å¼ƒ</span><br></pre></td></tr></table></figure>

<p>splitæ–¹æ³•å®Œæ•´ç”¨æ³•ï¼š<a href="https://blog.csdn.net/qq_41740883/article/details/111696866">https://blog.csdn.net/qq_41740883/article/details/111696866</a></p>
<p>âœ…å­—ç¬¦ä¸²æ‹¼æ¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test3() &#123;</span><br><span class="line">    // 1.ç›´æ¥ç”¨+ï¼Œå†…éƒ¨ä¼šæ›¿æ¢æˆStringBuilderçš„appendæ–¹æ³•</span><br><span class="line">    // ä¸å»ºè®®åœ¨ for å¾ªç¯ä¸­ä½¿ç”¨ â€œ+â€ è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¼šåˆ›å»ºå¤šä¸ªStringBuilder å¯¹è±¡</span><br><span class="line">    String s1 = &quot;hel&quot;;</span><br><span class="line">    String s2 = null;</span><br><span class="line">    System.out.println(s1 + s2); //helnull  å¦‚æœæ˜¯nullï¼Œå½“ä½œå­—ç¬¦ä¸²nullæ¥å¤„ç†</span><br><span class="line">    </span><br><span class="line">    // 2.StringBuilderçš„appendæ–¹æ³• ï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰</span><br><span class="line">    StringBuilder s3 = new StringBuilder(&quot;hel&quot;);</span><br><span class="line">    System.out.println(s3.append(&quot;lo&quot;));</span><br><span class="line">    </span><br><span class="line">    // 3.StringBufferçš„appendæ–¹æ³• ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</span><br><span class="line">    StringBuffer s4 = new StringBuffer(&quot;hel&quot;);</span><br><span class="line">    System.out.println(s4.append(&quot;lo&quot;));</span><br><span class="line">    </span><br><span class="line">    // 4.Stringç±»çš„concatæ–¹æ³•</span><br><span class="line">    System.out.println(s1.concat(&quot;lo&quot;));</span><br><span class="line">    //System.out.println(s1.concat(null)); //NPE</span><br><span class="line">    </span><br><span class="line">    // 5.Stringç±»çš„é™æ€joinæ–¹æ³• JDK 1.8 æä¾›ï¼Œå¯ä»¥åˆ†éš”ç¬¦ï¼Œä¹Ÿå¯ä»¥å¤šä¸ªå­—ç¬¦ä¸²(çœ‹ä¸Šé¢ï¼Œä¹Ÿå¯ä»¥æ˜¯list/set)</span><br><span class="line">    System.out.println(String.join(&quot;&quot;, &quot;hel&quot;, &quot;lo&quot;)); //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²è¿æ¥ç¬¦ï¼Œåé¢å¯ä»¥æ˜¯å¾ˆå¤šä¸ªå­—ç¬¦ä¸²è¿æ¥</span><br><span class="line">    </span><br><span class="line">    // 6.org.apache.commons.lang3.StringUtilçš„joinæ–¹æ³•ï¼ˆä¸ºä»€ä¹ˆä½¿ç”¨è¿™ä¸ªä¼šæ…¢ï¼Ÿï¼Ÿï¼Ÿï¼‰</span><br><span class="line">    // ä¸ç”¨æ‹…å¿ƒ NullPointerException,å†…éƒ¨ä½¿ç”¨çš„ä»ç„¶æ˜¯ StringBuilder</span><br><span class="line">    System.out.println(StringUtils.join(&quot;hel&quot;, &quot;lo&quot;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/ChineseSoftware/article/details/122956817">https://blog.csdn.net/ChineseSoftware/article/details/122956817</a></p>
<p>concatä¸+çš„åŒºåˆ«ï¼š<br>â‘ å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²æ˜¯ nullï¼Œconcat æ—¶å€™å°±ä¼šæŠ›å‡º NullPointerExceptionï¼Œâ€œ+â€ æ“ä½œç¬¦ä¼šå½“åšæ˜¯ â€œnullâ€ å­—ç¬¦ä¸²æ¥å¤„ç†ã€‚<br>â‘¡å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²(â€œâ€)ï¼Œé‚£ä¹ˆ concat çš„æ•ˆç‡è¦æ›´é«˜ä¸€ç‚¹ã€‚æ¯•ç«Ÿä¸éœ€è¦ new StringBuilder å¯¹è±¡ã€‚<br>â‘¢å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²éå¸¸å¤šï¼Œconcat çš„æ•ˆç‡å°±ä¼šä¸‹é™ï¼Œå› ä¸ºç”¨åˆ°å­—ç¬¦æ•°ç»„ï¼Œå¼€é”€å°±å¤§ã€‚</p>
<p>âœ…å­—ç¬¦ä¸²ç¿»è½¬</p>
<p>1ã€ç”¨stringBufferæˆ–è€…stringBuilderè‡ªå¸¦çš„reverseæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String newS = new StringBuilder(old).reverse().toString();</span><br></pre></td></tr></table></figure>

<p>2ã€å°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºcharæ•°ç»„ï¼Œç„¶åäº¤æ¢</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">char[] charArray = s.toCharArray();</span><br><span class="line">int start = 0, end = charArray.length - 1;</span><br><span class="line">for (; start &lt; end; start++, end--) &#123;</span><br><span class="line">    charArray[start] ^= charArray[end];//é‡‡ç”¨å¼‚æˆ–</span><br><span class="line">    charArray[end] ^= charArray[start];</span><br><span class="line">    charArray[start] ^= charArray[end];</span><br><span class="line">&#125;</span><br><span class="line">String newS = new String(charArray);</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">while (start &lt; end) &#123;</span><br><span class="line">    //äº¤æ¢é¦–å°¾charå€¼</span><br><span class="line">    char c = charArray[end];</span><br><span class="line">    charArray[end] = charArray[start];</span><br><span class="line">    charArray[start] = c;</span><br><span class="line">    start++;</span><br><span class="line">    end--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ã€stringBufferå€’åºæ‹¼æ¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">StringBuffer sb = new StringBuffer();</span><br><span class="line">for (int i = s.length() - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">    sb.append(s.charAt(i));</span><br><span class="line">&#125;</span><br><span class="line">String newS = sb.toString();</span><br></pre></td></tr></table></figure>

<p>4ã€åˆ©ç”¨æ ˆçš„å…ˆè¿›åå‡º</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">StringBuffer sb = new StringBuffer();</span><br><span class="line">Stack stack = new Stack();</span><br><span class="line">for (int i = 0; i &lt; s.length(); i++) &#123;</span><br><span class="line">    stack.push(s.charAt(i));</span><br><span class="line">&#125;</span><br><span class="line">while (!stack.isEmpty()) &#123;</span><br><span class="line">    //stackä¼šè¿”å›æ ˆé¡¶å€¼ï¼Œå¹¶ä¸”ä¼šæŠŠè¯¥å€¼åˆ é™¤</span><br><span class="line">    sb.append(stack.pop());</span><br><span class="line">&#125;</span><br><span class="line">String newS = sb.toString();</span><br></pre></td></tr></table></figure>

<p>5ã€åˆ‡å‰²é€’å½’åè½¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static String reverse(String s) &#123;</span><br><span class="line">    if (s.length() &lt;= 1) &#123;</span><br><span class="line">        return s;</span><br><span class="line">    &#125;</span><br><span class="line">    //æ¯æ¬¡æŠŠç¬¬ä¸€ä¸ªæ”¾åœ¨åé¢</span><br><span class="line">    return reverse(s.substring(1)) + s.substring(0, 1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6ã€äºŒåˆ†é€’å½’åè½¬</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static String reverse(String s) &#123;</span><br><span class="line">    int length = s.length();</span><br><span class="line">    if (length &lt;= 1) return s;</span><br><span class="line">    String left = s.substring(0, length / 2);</span><br><span class="line">    String right = s.substring(length / 2, length);</span><br><span class="line">    return reverse(right) + reverse(left);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://www.jb51.net/article/237801.htm">https://www.jb51.net/article/237801.htm</a></p>
<p>âœ…åˆ é™¤å­—ç¬¦ä¸²æœ€åä¸€ä¸ªå­—ç¬¦</p>
<p>1ã€Stringçš„substringæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String s = &quot;abcd&quot;;</span><br><span class="line">System.out.println(s.substring(0, s.length() - 1));</span><br></pre></td></tr></table></figure>

<p>2ã€replaceFirstæ–¹æ³• æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String str = &quot;abcd&quot;;</span><br><span class="line">str = str.replaceFirst(&quot;.$&quot;, &quot;&quot;);</span><br><span class="line">//åŒ¹é…é™¤â€œ\nâ€å’Œ&quot;\r&quot;ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦</span><br><span class="line">//åŒ¹é…è¾“å…¥è¡Œå°¾ã€‚</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_35764295/article/details/126106534">https://blog.csdn.net/qq_35764295/article/details/126106534</a></p>
<h4 id="StringBuilderæ“ä½œ"><a href="#StringBuilderæ“ä½œ" class="headerlink" title="StringBuilderæ“ä½œ"></a>StringBuilderæ“ä½œ</h4><p>âœ…åˆ é™¤æœ€åä¸€ä¸ªå­—ç¬¦</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">StringBuilder sb = new StringBuilder();</span><br><span class="line">sb.append(&#x27;a&#x27;).append(&#x27;b&#x27;).append(&#x27;c&#x27;);</span><br><span class="line">sb.deleteCharAt(sb.length()-1);</span><br><span class="line">System.out.println(sb); //ab</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">sb.delete(sb.length()-1, sb.length());</span><br></pre></td></tr></table></figure>

<h3 id="mapç›¸å…³"><a href="#mapç›¸å…³" class="headerlink" title="mapç›¸å…³"></a>mapç›¸å…³</h3><h4 id="mapå‡ ç§éå†æ–¹å¼"><a href="#mapå‡ ç§éå†æ–¹å¼" class="headerlink" title="mapå‡ ç§éå†æ–¹å¼"></a>mapå‡ ç§éå†æ–¹å¼</h4><p>ä¸€ã€Map.Entryéå†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for (Map.Entry&lt;String, String&gt; entry : map.entrySet()) &#123;  </span><br><span class="line">  System.out.println(&quot;key= &quot; + entry.getKey());</span><br><span class="line">  System.out.println(&quot;value= &quot; + entry.getValue());</span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>
<p>äºŒã€é€šè¿‡Iteratorè¿­ä»£å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**é€šè¿‡entrySet()æ–¹æ³•å°†keyå’Œvalueå­˜æ”¾åˆ°Seté›†åˆä¸­ï¼ŒSeté›†åˆä¸­æœ‰è¿­ä»£å™¨**/</span><br><span class="line">Set&lt;Entry&lt;String,String&gt;&gt; entry = map.entrySet();</span><br><span class="line">Iterator&lt;Entry&lt;String,String&gt;&gt; iterators = entry.iterator();</span><br><span class="line">while(iterators.hasNext())&#123;</span><br><span class="line">  Entry&lt;String,String&gt; entrys  = iterators.next();</span><br><span class="line">  System.out.println(&quot;key=&quot;+entrys.getKey()+&quot;&amp;&amp;value=&quot;+entrys.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‰ã€é€šè¿‡keySet()éå†<br>keySet()ï¼šå°†Mapä¸­æ‰€æœ‰çš„keyå­˜æ”¾åˆ°Seté›†åˆä¸­ã€‚å› ä¸ºSeté›†åˆæœ‰è¿­ä»£å™¨ï¼Œå¯ä»¥é€šè¿‡è¿­ä»£å™¨å¾ªç¯keyï¼Œå†é€šè¿‡get()æ–¹æ³•ï¼Œå¾—åˆ°æ¯ä¸ªkeyæ‰€å¯¹åº”çš„valueï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**é€šè¿‡keySet()æ–¹æ³•å°†æ‰€æœ‰çš„keyå€¼å­˜æ”¾åˆ°Seté›†åˆä¸­,Seté›†åˆä¸­æœ‰è¿­ä»£å™¨**/</span><br><span class="line">Iterator&lt;String&gt; iterator = map.keySet().iterator();</span><br><span class="line">while(iterator.hasNext())&#123;</span><br><span class="line">  String key = iterator.next();</span><br><span class="line">  System.out.println(&quot;key=&quot;+key+&quot;  &quot;+map.get(key));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¯ä»¥ä¸ç”¨è¿­ä»£å™¨ï¼Œç›´æ¥forå¾ªç¯</span><br><span class="line">for (String key: map.keySet()) &#123;</span><br><span class="line">  System.out.println(&quot;key:&quot; + map.get(key));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å››ã€values()éå†<br>values()è·å–é›†åˆä¸­çš„æ‰€æœ‰çš„valueå€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Collection&lt;String&gt; collection = map.values();</span><br><span class="line">å†foréå†å¾—åˆ°valueï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ç”¨è¿­ä»£å™¨</span><br><span class="line">Iterator var3 = values.iterator();</span><br><span class="line">while(var3.hasNext()) &#123;</span><br><span class="line">  String value = (String)var3.next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äº”ã€ç›´æ¥foreach map</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">map.forEach((key, value) -&gt; &#123;</span><br><span class="line">  System.out.println(&quot;ç¬¬äº”ç§:&quot; + key + &quot; ï¼š&quot; + value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="MapUtilså·¥å…·ç±»"><a href="#MapUtilså·¥å…·ç±»" class="headerlink" title="MapUtilså·¥å…·ç±»"></a>MapUtilså·¥å…·ç±»</h4><p>MapUtilsæ˜¯ org.apache.commons.collections å·¥å…·åŒ…ä¸­å¸¸ç”¨çš„å·¥å…·ç±»<br>éœ€è¦å¯¼å…¥åŒ…ï¼šcommons-collections4</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int value = MapUtils.getInteger(map, key, 0)</span><br><span class="line">//å°†ç»“æœè½¬æ¢ä¸ºIntegerï¼Œå¦‚æœè½¬æ¢å¤±è´¥åˆ™ä½¿ç”¨é»˜è®¤å€¼</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šç”¨æ³•ï¼š<a href="https://blog.csdn.net/u012894692/article/details/82557843">https://blog.csdn.net/u012894692/article/details/82557843</a></p>
<h4 id="mapçš„ä¸€äº›æ“ä½œ"><a href="#mapçš„ä¸€äº›æ“ä½œ" class="headerlink" title="mapçš„ä¸€äº›æ“ä½œ"></a>mapçš„ä¸€äº›æ“ä½œ</h4><p>âœ…mapçš„size</p>
<p>map.size() è¿”å› hashMap ä¸­é”®&#x2F;å€¼å¯¹çš„æ•°é‡ã€‚</p>
<p>âœ…mapçš„putå’ŒputIfAbsent<br>1.ä½¿ç”¨ put æ–¹æ³•æ·»åŠ é”®å€¼å¯¹ï¼Œå¦‚æœ map é›†åˆä¸­æ²¡æœ‰è¯¥ key å¯¹åº”çš„å€¼ï¼Œåˆ™ç›´æ¥æ·»åŠ ï¼Œå¹¶è¿”å› nullï¼›å¦‚æœå·²ç»å­˜åœ¨å¯¹åº”çš„å€¼ï¼Œåˆ™ä¼š<strong>è¦†ç›–æ—§å€¼</strong>ï¼Œvalue ä¸ºæ–°çš„å€¼ï¼Œè¿”å›å€¼ä¸ºæ—§çš„valueã€‚<br><code>map.put(key, value)</code></p>
<p>2.ä½¿ç”¨ putIfAbsent æ–¹æ³•æ·»åŠ é”®å€¼å¯¹ï¼Œä¸å­˜åœ¨æ‰åŠ å…¥ï¼Œå¦‚æœ map é›†åˆä¸­æ²¡æœ‰è¯¥ key å¯¹åº”çš„å€¼ï¼Œåˆ™ç›´æ¥æ·»åŠ ï¼Œå¹¶è¿”å› nullï¼Œå¦‚æœå·²ç»å­˜åœ¨å¯¹åº”çš„å€¼ï¼Œåˆ™ä¾æ—§ä¸ºåŸæ¥çš„å€¼ï¼Œè¿”å›å€¼ä¸º valueï¼ˆæ—§çš„å€¼ï¼‰ã€‚<br><code>map.putIfAbsent(key, value)</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1() &#123;</span><br><span class="line">    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">    map.put(&quot;11&quot;, &quot;11&quot;);</span><br><span class="line">    System.out.println(map.put(&quot;11&quot;, &quot;22&quot;));  //è¾“å‡º11</span><br><span class="line">    System.out.println(map.put(&quot;22&quot;, &quot;22&quot;));  //è¾“å‡ºnull</span><br><span class="line">    System.out.println(map.putIfAbsent(&quot;11&quot;, &quot;33&quot;));  //è¾“å‡º22</span><br><span class="line">    System.out.println(map.putIfAbsent(&quot;33&quot;, &quot;44&quot;));  //è¾“å‡º33</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>âœ…map.getOrDefault(key, defaultvalue)<br>ç”¨äºmapè·å–valueï¼Œä¸.get(key)ä¸åŒçš„æ˜¯ï¼Œå¦‚æœå¾—åˆ°çš„valueæ˜¯nullçš„è¯ï¼Œå¯ä»¥ç»™ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;StudentGrade&gt; gradeList = Lists.newArrayList();</span><br><span class="line">//æŠŠå­¦ç”Ÿæˆç»©listå˜ä¸ºmapï¼šå­¦ç”Ÿ-æˆç»©list</span><br><span class="line">Map&lt;String, List&lt;String&gt;&gt; gradeMap = Maps.newHashMap();</span><br><span class="line">for(StudentGrade studentGrade : gradeList) &#123;</span><br><span class="line">  List&lt;String&gt; grades = gradeMap.getOrDefault(studentGrade.getName(), Lists.newArrayList());</span><br><span class="line">  grades.add(studentGrade.getGrade());</span><br><span class="line">  gradeMap.put(studentGrade.getName(), grades); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…å¯¹mapçš„æŸä¸ªvalueåŠ ä¸€</p>
<p>ç”¨<code>map.get(i)++;</code> ä¸è¡Œã€‚å¾—å…ˆï¼š<code>int v = map.get(i) + 1;</code> ç„¶åï¼š<code>map.put(i, v);</code></p>
<p>âœ…æŸkeyæ˜¯å¦å­˜åœ¨<br><code>map.containsKey(key)</code></p>
<p>âœ…jsonå­—ç¬¦ä¸²è½¬æ¢ä¸ºmap</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Map&lt;Long, String&gt; map = JSON.parseObject(jsonString, Map.class);</span><br></pre></td></tr></table></figure>

<p>âœ…ceilingEntry()</p>
<p>java.util.TreeMap.ceilingEntry() è¿”å›å…·æœ‰æœ€å°é”®å€¼ï¼ˆå¤§äºæˆ–ç­‰äºæŒ‡å®šé”®ï¼‰çš„é”®å€¼å¯¹ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„é”®ï¼Œåˆ™è¿”å›nullã€‚(å–æ¯”è¾“å…¥å€¼å¤§çš„)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TreeMap&lt;Integer, String&gt; map = new TreeMap&lt;&gt;();</span><br><span class="line">map.put(1, &quot;1&quot;);</span><br><span class="line">map.put(3, &quot;3&quot;);</span><br><span class="line">Map.Entry&lt;Integer, String&gt; entry = map.ceilingEntry(2);</span><br><span class="line">System.out.println(entry.getValue()); //3</span><br></pre></td></tr></table></figure>

<h3 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h3><p>å®šä¹‰æšä¸¾ç±»ï¼Œå®šä¹‰åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œå’Œimplã€serviceã€voåŒ…å¹³çº§ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public enum SexEnum:int &#123;</span><br><span class="line">    male,female;</span><br><span class="line">&#125;</span><br><span class="line">å¤šä¸ªæšä¸¾æˆå‘˜ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ï¼Œ</span><br><span class="line">å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°å£°æ˜åŸºç¡€ç±»å‹çš„æšä¸¾ï¼Œé‚£ä¹ˆæ„å‘³ç€å®ƒæ‰€å¯¹åº”çš„åŸºç¡€ç±»å‹æ˜¯ intã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Getter</span><br><span class="line">public enum DemoEnum &#123;</span><br><span class="line">  LIU(&quot;liu&quot;, 1),</span><br><span class="line">  WANG(&quot;wang&quot;, 2);</span><br><span class="line">  UN_KNOW(&quot;unknow&quot;, 99)</span><br><span class="line"></span><br><span class="line">  private final String name;</span><br><span class="line">  private final int age;</span><br><span class="line"></span><br><span class="line">  //æ„é€ å‡½æ•°</span><br><span class="line">  private DemoEnum(String name, int age)&#123; </span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //å¯ä»¥å­˜ä¸€ä¸ªmapä¾›å¤–éƒ¨ä½¿ç”¨ï¼Œé‡Œé¢æ˜¯ç›´æ¥çš„enumç±»</span><br><span class="line">  static Map&lt;String, DemoEnum&gt; map = new TreeMap&lt;&gt;();</span><br><span class="line">  static &#123;</span><br><span class="line">    for (DemoEnum enum : DemoEnum.values()) &#123;</span><br><span class="line">      map.put(enum.getName(), enum)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public static DemoEnum getEnumByName(String name) &#123;</span><br><span class="line">    return map.get(name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //æ ¹æ®å±æ€§è·å¾—enumï¼Œå†è·å¾—å¦ä¸€å±æ€§</span><br><span class="line">  //å¯ä»¥ä½¿ç”¨ä¸Šé¢æ„é€ ä¸ªmapï¼Œå†ä»mapè·å–çš„æ–¹æ³•</span><br><span class="line">  //ä¹Ÿå¯ä»¥åŠ ä¸ªæ–¹æ³•ï¼Œéå†è·å–ï¼Œæ ¹æ®å±æ€§è·å–enum</span><br><span class="line">  public static DemoEnum nameOf(String name) &#123;</span><br><span class="line">    for (DemoEnum e : DemoEnum.values()) &#123;</span><br><span class="line">      if (e.name = name) &#123;</span><br><span class="line">        return e;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return UN_KNOW;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æšä¸¾ç±»çš„values()æ–¹æ³•ï¼Œè·å–å®šä¹‰çš„æˆå‘˜æ•°ç»„ï¼š<br><code>DemoEnum[] values = DemoEnum.values();</code></p>
<p>Enum valueOfæ–¹æ³•ï¼š<br>é€šè¿‡å­—ç¬¦ä¸²æ¥è·å–æšä¸¾enumï¼š<br><code>DemoEnum e = DemoEnum.valueOf(&quot;LIU&quot;)</code></p>
<h3 id="Fileç›¸å…³"><a href="#Fileç›¸å…³" class="headerlink" title="Fileç›¸å…³"></a>Fileç›¸å…³</h3><h4 id="File"><a href="#File" class="headerlink" title="File"></a>File</h4><p>Javaæ–‡ä»¶ç±»ä»¥æŠ½è±¡çš„æ–¹å¼ä»£è¡¨æ–‡ä»¶åå’Œç›®å½•è·¯å¾„åã€‚è¯¥ç±»ä¸»è¦ç”¨äºæ–‡ä»¶å’Œç›®å½•çš„åˆ›å»ºã€æ–‡ä»¶çš„æŸ¥æ‰¾å’Œæ–‡ä»¶çš„åˆ é™¤ç­‰ã€‚<br>Fileå¯¹è±¡ä»£è¡¨ç£ç›˜ä¸­å®é™…å­˜åœ¨çš„æ–‡ä»¶å’Œç›®å½•ã€‚<br>è‡ªæˆ‘ç†è§£ï¼šFileå¯¹è±¡å°±æ˜¯æ–‡ä»¶è·¯å¾„åœ¨javaé‡Œçš„ä¸€ä¸ªæŠ½è±¡ï¼Œå¹¶ä¸ä»£è¡¨çœŸå®æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ–°å»ºæ–‡ä»¶ï¼š</span><br><span class="line">String dirname = &quot;/java&quot;;</span><br><span class="line">File f1 = new File(dirname);</span><br><span class="line"></span><br><span class="line">// åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ä¸€ä¸ªç›®å½•</span><br><span class="line">if (f1.isDirectory()) &#123; &#125;</span><br><span class="line">f1.isFile() æ˜¯å¦æ˜¯æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">// è¿”å›ç”±æ­¤æŠ½è±¡è·¯å¾„åæ‰€è¡¨ç¤ºçš„ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„åç§°æ‰€ç»„æˆå­—ç¬¦ä¸²æ•°ç»„ã€‚</span><br><span class="line">String s[] = f1.list();</span><br><span class="line">for (int i = 0; i &lt; s.length; i++) &#123;</span><br><span class="line">  File f = new File(dirname + &quot;/&quot; + s[i]);</span><br><span class="line">  if (f.isDirectory()) &#123;</span><br><span class="line">    System.out.println(s[i] + &quot; is a directory&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">    System.out.println(s[i] + &quot; is a file&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public String getName()  è¿”å›æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•çš„åç§°ã€‚ï¼ˆæ–‡ä»¶åï¼‰</span><br><span class="line"></span><br><span class="line">public String getPath()  å°†æ­¤æŠ½è±¡è·¯å¾„åè½¬æ¢ä¸ºä¸€ä¸ªè·¯å¾„åå­—ç¬¦ä¸²ã€‚ï¼ˆè·¯å¾„åï¼‰</span><br><span class="line"></span><br><span class="line">public String getParent()  è¿”å›æ­¤æŠ½è±¡è·¯å¾„åçš„çˆ¶è·¯å¾„åçš„è·¯å¾„åå­—ç¬¦ä¸²ï¼ˆè·¯å¾„åï¼‰</span><br><span class="line"></span><br><span class="line">public File getParentFile()  è¿”å›çˆ¶æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">public boolean exists()  æµ‹è¯•æ­¤æŠ½è±¡è·¯å¾„åè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼š</span><br><span class="line">File file = new File(&quot;/Users/liuxuan/MyProject/hi.md&quot;);</span><br><span class="line">File dirFile = file.getParentFile();</span><br><span class="line">if(dirFile != null &amp;&amp; !dirFile.exists())&#123;</span><br><span class="line">  dirFile.mkdirs();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šæ–¹æ³•ï¼š<a href="https://www.runoob.com/java/java-file.html">https://www.runoob.com/java/java-file.html</a></p>
<p>âœ…æ–‡ä»¶è¯»å†™çš„æ“ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1() throws IOException &#123;</span><br><span class="line">    // 1. æ–°å»ºæ–‡ä»¶å¤¹</span><br><span class="line">    String filePath = &quot;/Users/liuxuan/MyProject/JavaProject/SingleFile/hello.java&quot;;</span><br><span class="line">    File file = new File(filePath);</span><br><span class="line">    File file1 = new File(filePath);</span><br><span class="line">    boolean isSame = file.equals(file1);  //true é‡å†™äº†ï¼Œå˜å€¼æ¯”è¾ƒ</span><br><span class="line">    boolean isSame1 = file == file1;  //false åœ°å€æ¯”è¾ƒ</span><br><span class="line">    System.out.println(isSame);  //true</span><br><span class="line">    if(!file.getParentFile().exists()) &#123;</span><br><span class="line">        File dirFile = file.getParentFile();</span><br><span class="line">        dirFile.mkdirs();  //å»ºç«‹çˆ¶æ–‡ä»¶å¤¹</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 2.å­—èŠ‚æ•°ç»„ç›´æ¥å†™æ–‡ä»¶ï¼Œä¸‹é¢æœ‰åŠ ä¸€æ­¥è¾“å‡ºæµçš„æ–¹å¼</span><br><span class="line">    String filePath1 = &quot;/Users/liuxuan/MyProject/JavaProject/SingleFile/hi.java&quot;;</span><br><span class="line">    File file2 = new File(filePath1);</span><br><span class="line">    if(file2.exists()) &#123;</span><br><span class="line">        boolean res = file2.delete();</span><br><span class="line">        System.out.println(&quot;delete:&quot; + res);</span><br><span class="line">    &#125;</span><br><span class="line">    byte[] data = &quot;hi&quot;.getBytes();</span><br><span class="line">    byte[] data1 = &quot;System.out.println(\&quot;hi\&quot;)&quot;.getBytes();  //Stringå˜å­—èŠ‚æ•°ç»„</span><br><span class="line">    try &#123;</span><br><span class="line">        FileUtils.writeByteArrayToFile(file2, data);</span><br><span class="line">        FileUtils.writeByteArrayToFile(file2, data1);  //è¦†å†™çš„æ–¹å¼</span><br><span class="line">    &#125; catch(Exception e) &#123;</span><br><span class="line">        System.out.println(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 3.è¯»å–æ–‡ä»¶ï¼šç”¨è¾“å…¥æµ æ–‡ä»¶-&gt;è¾“å…¥æµ-&gt;å­—èŠ‚æ•°ç»„</span><br><span class="line">    FileInputStream in = new FileInputStream(file2);  //ä¹Ÿæœ‰ä¼ å…¥è·¯å¾„å­—ç¬¦ä¸²çš„æ„é€ å‡½æ•°</span><br><span class="line">    // è¾“å…¥æµå˜å­—èŠ‚æ•°ç»„</span><br><span class="line">    byte[] data2 = IOUtils.toByteArray(in);</span><br><span class="line">    //String content = data2.toString();  //å­—èŠ‚æ•°ç»„å˜Stringï¼Œç”¨è¿™ä¸ªä¸å¯¹</span><br><span class="line">    String content = new String(data2);  //å¾—ç”¨å®ƒ</span><br><span class="line">    System.out.println(&quot;è¾“å…¥æµå†…å®¹ï¼š&quot; + content);</span><br><span class="line">    String content4 = Arrays.toString(data2);</span><br><span class="line">    System.out.println(&quot;è¾“å…¥æµå†…å®¹ï¼š&quot; + content4); //è¿™æ ·è¾“å‡ºçš„æ˜¯æ•°å­—</span><br><span class="line"></span><br><span class="line">    // 3.è¯»å–æ–‡ä»¶ï¼šç”¨è¾“å…¥æµ æ–‡ä»¶-&gt;è¾“å…¥æµ-&gt;å­—èŠ‚æ•°ç»„ï¼Œå¦ç§æ–¹æ³•</span><br><span class="line">    FileInputStream in1 = new FileInputStream(file2);</span><br><span class="line">    byte[] data3 = new byte[20];</span><br><span class="line">    String content3 = CharStreams.toString(new InputStreamReader(in1, Charsets.UTF_8)); //è¿™é‡Œä¹Ÿæ¶ˆè€—è¾“å…¥æµ</span><br><span class="line">    System.out.println(&quot;å‰é¢è·å–è¾“å…¥æµå†…å®¹ï¼š&quot; + content3);</span><br><span class="line">    int num = in1.read(data3);  //è¾“å…¥æµæ¶ˆè€—20ä¸ªå­—èŠ‚</span><br><span class="line">    System.out.println(&quot;å‡ ä¸ªå­—èŠ‚ï¼š&quot; + num);</span><br><span class="line">    String content1 = IOUtils.toString(in1, String.valueOf(StandardCharsets.UTF_8));</span><br><span class="line">    System.out.println(&quot;è¾“å…¥æµå†…å®¹ï¼š&quot; + content1);   //è¿™é‡Œåªå‰©å‡ ä¸ªå¯ä»¥å±•ç¤º</span><br><span class="line">    String content2 = IOUtils.toString(in1, String.valueOf(StandardCharsets.UTF_8));</span><br><span class="line">    System.out.println(&quot;è¾“å…¥æµå†…å®¹2ï¼š&quot; + content2);  //è¿™é‡Œå·²ç»æ²¡æœ‰äº†</span><br><span class="line"></span><br><span class="line">    // 4.å†™æ–‡ä»¶ï¼šç”¨è¾“å‡ºæµ å­—èŠ‚æ•°ç»„-&gt;è¾“å‡ºæµ-&gt;æ–‡ä»¶</span><br><span class="line">    String filePath2 = &quot;/Users/liuxuan/MyProject/JavaProject/SingleFile/hi2.java&quot;;  //è¦å†™çš„æ–‡ä»¶ï¼Œå¯ä»¥æ²¡å»ºç«‹</span><br><span class="line">    File file3 = new File(filePath2);</span><br><span class="line">    FileOutputStream out = new FileOutputStream(filePath2);</span><br><span class="line">    byte[] data4 = &quot;System.out.println(\&quot;hi2\&quot;)&quot;.getBytes();</span><br><span class="line">    out.write(data4);  //å¦‚æœæ–‡ä»¶å­˜åœ¨å†…å®¹ï¼Œåˆ™æ˜¯è¦†ç›–çš„æ–¹å¼</span><br><span class="line">    if(file3.exists()) System.out.println(&quot;å†™å…¥æˆåŠŸ&quot;);</span><br><span class="line">    //å…³é—­æµ</span><br><span class="line">    IOUtils.closeQuietly(in);</span><br><span class="line">    IOUtils.closeQuietly(out);</span><br><span class="line"></span><br><span class="line">    // 5.copyæ–‡ä»¶ï¼šæ–‡ä»¶-è¾“å…¥æµ-å­—èŠ‚æ•°ç»„-è¾“å‡ºæµ-æ–‡ä»¶ï¼Œç”¨IOUtils.copy()ä¸€æ­¥åˆ°ä½</span><br><span class="line">    String filePath3 = &quot;/Users/liuxuan/MyProject/JavaProject/SingleFile/hi3.java&quot;;  //è¦å†™çš„æ–‡ä»¶ï¼Œå¯ä»¥æ²¡å»ºç«‹</span><br><span class="line">    File file4 = new File(filePath3);</span><br><span class="line">    FileInputStream in3 = new FileInputStream(file3);</span><br><span class="line">    FileOutputStream out2 = new FileOutputStream(file4);</span><br><span class="line">    IOUtils.copy(in3, out2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…è·å–æ–‡ä»¶å¤§å°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2() throws IOException &#123;</span><br><span class="line">    // 1.æ–¹æ³•ä¸€ï¼šä½¿ç”¨java io</span><br><span class="line">    String filePath = &quot;/Users/liuxuan/MyProject/JavaProject/SingleFile/hello.java&quot;;</span><br><span class="line">    File file = new File(filePath);</span><br><span class="line">    long size = file.length();</span><br><span class="line">    System.out.println(&quot;æ–‡ä»¶å¤§å°ï¼š&quot; + size + &quot;B&quot;);</span><br><span class="line"></span><br><span class="line">    // 2.æ–¹æ³•äºŒï¼šä½¿ç”¨java nio</span><br><span class="line">    Path filePath1 = Paths.get(&quot;/Users/liuxuan/MyProject/JavaProject/SingleFile/hello.java&quot;);  //ç»å¯¹è·¯å¾„</span><br><span class="line">    FileChannel fileChannel = FileChannel.open(filePath1);</span><br><span class="line">    long size1 = fileChannel.size();</span><br><span class="line">    System.out.println(&quot;æ–‡ä»¶å¤§å°ï¼š&quot; + size1 + &quot;B&quot;);</span><br><span class="line">    Path filePath2 = Paths.get(&quot;src/test/resources/hi.md&quot;);  //é¡¹ç›®ä¸‹è·¯å¾„</span><br><span class="line">    FileChannel fileChannel2 = FileChannel.open(filePath2);</span><br><span class="line">    long size2 = fileChannel2.size();</span><br><span class="line">    System.out.println(&quot;æ–‡ä»¶å¤§å°ï¼š&quot; + size2 + &quot;B&quot;);</span><br><span class="line"></span><br><span class="line">    // 3.æ–¹æ³•ä¸‰ï¼šä½¿ç”¨  apache commons io (åªèƒ½è¯»æ–‡ä»¶å¤¹çš„å¤§å°)</span><br><span class="line">    String dir = &quot;/Users/liuxuan/MyProject/JavaProject/SingleFile&quot;;</span><br><span class="line">    File file1 = new File(dir);</span><br><span class="line">    long size3 = FileUtils.sizeOfDirectory(file1);</span><br><span class="line">    System.out.println(&quot;æ–‡ä»¶å¤¹å¤§å°ï¼š&quot; + size3 + &quot;B&quot;);</span><br><span class="line"></span><br><span class="line">    // ç”¨æˆ·å¯è¯»è§†è§’ï¼Ÿ</span><br><span class="line">    String display = FileUtils.byteCountToDisplaySize(size);</span><br><span class="line">    System.out.println(display);  //117 bytes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Fileæµ"><a href="#Fileæµ" class="headerlink" title="Fileæµ"></a>Fileæµ</h4><p>JAVAä¸­é’ˆå¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œè®¾ç½®äº†ä¸€ç³»åˆ—çš„æµï¼Œå…¶ä¸­ä¸»è¦æœ‰FileInputStream,FileOutputStream,FileReader,FileWriterå››ç§æœ€ä¸ºå¸¸ç”¨çš„æµ</p>
<p>ä¸€ã€FileInputStreamæµ</p>
<p>è¢«ç§°ä¸ºæ–‡ä»¶å­—èŠ‚è¾“å…¥æµï¼Œæ„æ€æŒ‡å¯¹æ–‡ä»¶æ•°æ®ä»¥å­—èŠ‚çš„å½¢å¼è¿›è¡Œè¯»å–æ“ä½œå¦‚è¯»å–å›¾ç‰‡è§†é¢‘ç­‰</p>
<p>è‹¥Fileç±»å¯¹è±¡çš„æ‰€ä»£è¡¨çš„æ–‡ä»¶ä¸å­˜åœ¨;ä¸æ˜¯æ–‡ä»¶æ˜¯ç›®å½•;æˆ–è€…å…¶ä»–åŸå› ä¸èƒ½æ‰“å¼€çš„è¯ï¼Œåˆ™ä¼šæŠ›å‡ºFileNotFoundExceptionã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">  File file=new File(&quot;xxxxxxxx&quot;); </span><br><span class="line">  //æ ¹æ®è·¯å¾„åˆ›å»ºFileç±»å¯¹è±¡--è¿™é‡Œè·¯å¾„å³ä½¿é”™è¯¯ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºåªæ˜¯äº§ç”ŸFileå¯¹è±¡ï¼Œè¿˜å¹¶æœªä¸è®¡ç®—æœºæ–‡ä»¶è¯»å†™æœ‰å…³è”</span><br><span class="line">        </span><br><span class="line">  try&#123;</span><br><span class="line">    FileInputStream fileInputStream=new FileInputStream(file);</span><br><span class="line">    //ä¸æ ¹æ®Fileç±»å¯¹è±¡çš„æ‰€ä»£è¡¨çš„å®é™…æ–‡ä»¶å»ºç«‹é“¾æ¥åˆ›å»ºfileInputStreamå¯¹è±¡</span><br><span class="line">      &#125;catch (FileNotFoundException e)&#123;</span><br><span class="line">          System.out.println(&quot;æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…æ–‡ä»¶ä¸å¯è¯»æˆ–è€…æ–‡ä»¶æ˜¯ç›®å½•&quot;);</span><br><span class="line">      &#125; </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">// ä¹Ÿå¯ä»¥æ ¹æ®æ–‡ä»¶è·¯å¾„åå­—ç¬¦ä¸²è¿›è¡Œå»ºç«‹</span><br><span class="line">FileInputStream fileInputStream=new FileInputStream(filepath);</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šï¼š<a href="https://blog.csdn.net/ai_bao_zi/article/details/81097898">https://blog.csdn.net/ai_bao_zi/article/details/81097898</a></p>
<p>IOæµçš„å…³ç³»ï¼š<a href="https://www.cnblogs.com/lianshan/p/11911773.html">https://www.cnblogs.com/lianshan/p/11911773.html</a><br><a href="https://blog.csdn.net/q306507291/article/details/118825930">https://blog.csdn.net/q306507291/article/details/118825930</a></p>
<h4 id="FileUtils-å·¥å…·ç±»"><a href="#FileUtils-å·¥å…·ç±»" class="headerlink" title="FileUtils å·¥å…·ç±»"></a>FileUtils å·¥å…·ç±»</h4><p>apache çš„commons-ioåŒ…ä¸‹çš„FileUtilsï¼Œå¯¼åŒ…ï¼šcommons-io</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">File file = new File(&quot;E:\\java\\file04\\abcé›ª.jpg&quot;);</span><br><span class="line">//åˆ é™¤æŒ‡å®šæ–‡ä»¶ï¼Œä»ä¸å¼•å‘å¼‚å¸¸ã€‚</span><br><span class="line">FileUtils.deleteQuietly(file);</span><br><span class="line"></span><br><span class="line">//å°†byteæ•°ç»„å†™ä¸ºFile</span><br><span class="line">byte[] bytes = IOUtils.toByteArray(inputStream);</span><br><span class="line">FileUtils.writeByteArrayToFile(new File(path), bytes)</span><br><span class="line"></span><br><span class="line">//åˆ é™¤æ‰æŒ‡å®šç›®å½•çš„æ–‡ä»¶</span><br><span class="line">FileUtils.deleteExistFile(new File(localpath));</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šæ–¹æ³•ï¼š<a href="https://blog.csdn.net/qq_42402854/article/details/83374559">https://blog.csdn.net/qq_42402854/article/details/83374559</a></p>
<h4 id="IOUtilså·¥å…·ç±»"><a href="#IOUtilså·¥å…·ç±»" class="headerlink" title="IOUtilså·¥å…·ç±»"></a>IOUtilså·¥å…·ç±»</h4><p>å®ƒæ˜¯ Apache Commons IO çš„ä¸€éƒ¨åˆ† ã€‚è¯¥ç±»çš„æ‰€æœ‰æˆå‘˜å‡½æ•°éƒ½è¢«ç”¨æ¥å¤„ç†è¾“å…¥ - è¾“å‡ºæµã€‚è¿™äº›æ–¹æ³•åŸºäº InputStream,  OutputStream,  Reader å’Œ Writerå·¥ä½œã€‚</p>
<p>æ‰€æœ‰æˆå‘˜å­—æ®µå’Œæ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œä¸éœ€è¦åˆ›å»ºå¯¹è±¡ï¼Œç›´æ¥ç”¨ç±»åè°ƒç”¨ã€‚</p>
<p>âœ…è¾“å…¥æµè½¬ä¸ºå­—èŠ‚æ•°ç»„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å°†è¾“å…¥æµè½¬æ¢æˆå­—ç¬¦æ•°ç»„:</span><br><span class="line">byte[] bytes = IOUtils.toByteArray(inputStream);</span><br></pre></td></tr></table></figure>

<p>âœ…å…³é—­æµ<br>ä¹‹å‰å…³é—­æµï¼Œå¾€å¾€åœ¨finallyä¸­ï¼Œå› ä¸ºä¼šæŠ›å‡ºIOExceptionï¼Œæ‰€ä»¥finallyä¸­éœ€è¦try catchï¼Œå¹¶ä¸”closeä¹‹å‰éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºnullã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">finally &#123;</span><br><span class="line">  if (in != null) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      in.close();</span><br><span class="line">      &#125; catch (IOException e) &#123;</span><br><span class="line">          LOGGER.warn(&quot;Fail to close stream : &quot;, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ IOUtils.closeQuietly æ¥ç²¾ç®€ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">byte[] data = new byte[1024];</span><br><span class="line">InputStream in = null;</span><br><span class="line">OutputStream out = null;</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">      in = new FileInputStream(&quot;foo.txt&quot;);</span><br><span class="line">      in.read(data);</span><br><span class="line"></span><br><span class="line">      out = new FileOutputStream(&quot;foo.txt&quot;);</span><br><span class="line">      data = &quot;Hello, World&quot;.getBytes();</span><br><span class="line">      out.write(data);</span><br><span class="line"></span><br><span class="line">      IOUtils.copy(in, out);</span><br><span class="line"></span><br><span class="line">      in.close(); //close errors are handled</span><br><span class="line">      out.close();</span><br><span class="line">&#125; catch (IOException e) &#123; </span><br><span class="line">      // error handling</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">      IOUtils.closeQuietly(in);</span><br><span class="line">      IOUtils.closeQuietly(out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šæ–¹æ³•ï¼š<a href="https://blog.csdn.net/sulia1234567890/article/details/120569718">https://blog.csdn.net/sulia1234567890/article/details/120569718</a></p>
<p>âœ…å†™æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test4() throws IOException &#123;</span><br><span class="line">    String filePath = &quot;/Users/liuxuan/MyProject/JavaProject/SingleFile/hello.java&quot;;</span><br><span class="line">    File file = new File(filePath);</span><br><span class="line">    OutputStream out = new FileOutputStream(file, true);</span><br><span class="line">    IOUtils.write(&quot;hello&quot;, out);</span><br><span class="line">    IOUtils.write(&quot;\n&quot;, out);</span><br><span class="line">    IOUtils.write(&quot;hi&quot;, out);</span><br><span class="line">    //ä¹Ÿå¯ä»¥ä¼ å­—èŠ‚æ•°ç»„ã€å­—ç¬¦æ•°ç»„</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âš ï¸new FileOutputStream(â€œb.txtâ€,true);</p>
<p>é»˜è®¤ç¬¬äºŒä¸ªå‚æ•°æ˜¯falseï¼Œè¡¨ç¤ºä¸è¿½åŠ ï¼Œæ¯æ¬¡newå¯¹è±¡éƒ½ä¼šæ¸…ç©ºä¹‹å‰çš„å†…å®¹åˆ›å»ºæ–°çš„å†…å®¹ï¼Œtureè¡¨ç¤ºåœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šè¿½åŠ å†…å®¹</p>
<p>âœ…å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºString</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">byte[] data = &quot;hello world&quot;.getBytes();</span><br><span class="line">//apacheé‡Œioçš„IOUtilséœ€è¦commons-ioåŒ…</span><br><span class="line">String s1 = IOUtils.toString(data, &quot;utf-8&quot;);</span><br><span class="line">String s2 = new String(data);</span><br><span class="line">System.out.println(s1);</span><br><span class="line">System.out.println(s2);</span><br></pre></td></tr></table></figure>

<h4 id="MultipartFile"><a href="#MultipartFile" class="headerlink" title="MultipartFile"></a>MultipartFile</h4><p>éœ€è¦ä¾èµ–ï¼šspring-web</p>
<p>é¦–å…ˆï¼Œâ€œæµâ€æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå®ƒæ˜¯å¯¹è¾“å…¥è¾“å‡ºè®¾å¤‡çš„ä¸€ç§æŠ½è±¡ç†è§£ï¼Œåœ¨javaä¸­ï¼Œå¯¹æ•°æ®çš„è¾“å…¥è¾“å‡ºæ“ä½œéƒ½æ˜¯ä»¥â€œæµâ€çš„æ–¹å¼è¿›è¡Œçš„ã€‚â€œæµâ€å…·æœ‰æ–¹å‘æ€§ï¼Œè¾“å…¥æµã€è¾“å‡ºæµæ˜¯ç›¸å¯¹çš„ã€‚å½“ç¨‹åºéœ€è¦ä»æ•°æ®æºä¸­è¯»å…¥æ•°æ®çš„æ—¶å€™å°±ä¼šå¼€å¯ä¸€ä¸ªè¾“å…¥æµï¼Œç›¸åï¼Œå†™å‡ºæ•°æ®åˆ°æŸä¸ªæ•°æ®æºç›®çš„åœ°çš„æ—¶å€™ä¹Ÿä¼šå¼€å¯ä¸€ä¸ªè¾“å‡ºæµã€‚</p>
<p>MultipartFileæ˜¯SpringMVCæä¾›ç®€åŒ–ä¸Šä¼ æ“ä½œçš„å·¥å…·ç±»ã€‚å®ç°æ–‡ä»¶çš„å¿«é€Ÿä¸Šä¼ ï¼Œä¸éœ€è¦å…ˆå°†Fileè½¬æ¢æˆoutputæµ å†ä¼ è¾“è¿‡å» æ¥æ”¶ç«¯æ¥æ”¶æµå†ç”Ÿæˆæ–‡ä»¶ã€‚</p>
<p>åœ¨ä¸ä½¿ç”¨æ¡†æ¶ä¹‹å‰ï¼Œéƒ½æ˜¯ä½¿ç”¨åŸç”Ÿçš„HttpServletRequestæ¥æ¥æ”¶ä¸Šä¼ çš„æ•°æ®ï¼Œæ–‡ä»¶æ˜¯ä»¥äºŒè¿›åˆ¶æµä¼ é€’åˆ°åç«¯çš„ï¼Œç„¶åéœ€è¦æˆ‘ä»¬è‡ªå·±è½¬æ¢ä¸ºFileç±»ã€‚ä½¿ç”¨äº†MultipartFileå·¥å…·ç±»ä¹‹åï¼Œæˆ‘ä»¬å¯¹æ–‡ä»¶ä¸Šä¼ çš„æ“ä½œå°±ç®€ä¾¿è®¸å¤šäº†ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_45393094/article/details/112056436">https://blog.csdn.net/weixin_45393094/article/details/112056436</a></p>
<p>âœ…å†…éƒ¨æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface MultipartFile extends InputStreamSource &#123;</span><br><span class="line">    //getName() è¿”å›å‚æ•°çš„åç§°</span><br><span class="line">    String getName();</span><br><span class="line">    //è·å–æºæ–‡ä»¶çš„æ˜µç§°</span><br><span class="line">    @Nullable</span><br><span class="line">    String getOriginalFilename();</span><br><span class="line">    //getContentType() è¿”å›æ–‡ä»¶çš„å†…å®¹ç±»å‹</span><br><span class="line">    @Nullable</span><br><span class="line">    String getContentType();</span><br><span class="line">    //isEmpty() åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œæˆ–è€…ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦æœ‰å†…å®¹</span><br><span class="line">    boolean isEmpty();</span><br><span class="line">    //getSize() è¿”å›æ–‡ä»¶å¤§å° ä»¥å­—èŠ‚ä¸ºå•ä½</span><br><span class="line">    long getSize();</span><br><span class="line">    //getBytes() å°†æ–‡ä»¶å†…å®¹è½¬åŒ–æˆä¸€ä¸ªbyte[] è¿”å›</span><br><span class="line">    byte[] getBytes() throws IOException;</span><br><span class="line">    //getInputStream() è¿”å›InputStreamè¯»å–æ–‡ä»¶çš„å†…å®¹</span><br><span class="line">    InputStream getInputStream() throws IOException;</span><br><span class="line"></span><br><span class="line">    default Resource getResource() &#123;</span><br><span class="line">        return new MultipartFileResource(this);</span><br><span class="line">    &#125;</span><br><span class="line">    //transferTo(File dest) ç”¨æ¥æŠŠ MultipartFile è½¬æ¢æ¢æˆ File</span><br><span class="line">    void transferTo(File var1) throws IOException, IllegalStateException;</span><br><span class="line"></span><br><span class="line">    default void transferTo(Path dest) throws IOException, IllegalStateException &#123;</span><br><span class="line">        FileCopyUtils.copy(this.getInputStream(), Files.newOutputStream(dest));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…MockMultipartFile</p>
<p>å¯ä»¥ç”¨MockMultipartFileåˆ›å»ºMultipartFileã€‚éœ€è¦å¯¼å…¥spring-test.jar</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MockMultipartFile(String name, @Nullable String originalFilename, @Nullable String contentType, InputStream contentStream)</span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°ï¼šä¼ è¾“åçš„æ–‡ä»¶å </span><br><span class="line">ç¬¬äºŒä¸ªï¼šæ—§æ–‡ä»¶åå­—ï¼ˆå¯ä¸ºç©ºï¼‰ </span><br><span class="line">ç¬¬ä¸‰ï¼šç±»å‹</span><br><span class="line">ç¬¬å››ï¼šè¾“å…¥æµ</span><br></pre></td></tr></table></figure>

<p>âœ…MultipartFileä¸Fileçš„ç›¸äº’è½¬æ¢</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test3() throws IOException &#123;</span><br><span class="line">    // 1.Fileè½¬ä¸ºMultipartFileï¼šfile-InputStream-MultipartFile</span><br><span class="line">    String filePath = &quot;/Users/liuxuan/MyProject/JavaProject/SingleFile/hello.java&quot;;</span><br><span class="line">    File file = new File(filePath);</span><br><span class="line">    System.out.println(file.getName());  //hello.java</span><br><span class="line">    System.out.println(FilenameUtils.getExtension(file.getName()));  //åç¼€java</span><br><span class="line">    FileInputStream in = new FileInputStream(file);</span><br><span class="line">    MultipartFile mf = new MockMultipartFile(file.getName(), file.getName(), &quot;text/plain&quot;, in);</span><br><span class="line">    System.out.println(mf.getName()); //hello.java</span><br><span class="line">    System.out.println(mf.getOriginalFilename());  //hello.java</span><br><span class="line"></span><br><span class="line">    // 2.MultipartFileè½¬ä¸ºFile</span><br><span class="line">    try &#123;</span><br><span class="line">        String uuid = UUID.randomUUID().toString();</span><br><span class="line">        //å¾—åˆ°æ–‡ä»¶åç¼€</span><br><span class="line">        String originalName = mf.getOriginalFilename();</span><br><span class="line">        String ext = &quot;.&quot; + FilenameUtils.getExtension(originalName);</span><br><span class="line">        String fileName = uuid + ext;</span><br><span class="line">        File targetFile = new File(&quot;/Users/liuxuan/MyProject/JavaProject/SingleFile/&quot;, fileName);</span><br><span class="line">        //ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ–‡ä»¶å¤¹  ç¬¬äºŒä¸ªå‚æ•°ï¼šæ–‡ä»¶å</span><br><span class="line">        // æ–¹æ³•ä¸€ï¼šMultipartFile - å­—èŠ‚æ•°ç»„ - Fileæœ¬åœ°</span><br><span class="line">        FileUtils.writeByteArrayToFile(targetFile, mf.getBytes());</span><br><span class="line">        // æ–¹æ³•äºŒï¼šMultipartFile - å­—èŠ‚æ•°ç»„ - è¾“å‡ºæµ - Fileæœ¬åœ°</span><br><span class="line">        byte[] data = mf.getBytes();</span><br><span class="line">        FileOutputStream out = new FileOutputStream(targetFile);</span><br><span class="line">        out.write(data);</span><br><span class="line">        IOUtils.closeQuietly(out);</span><br><span class="line">        // æ–¹æ³•ä¸‰ï¼šç›´æ¥ç”¨MultipartFileå†…éƒ¨æ–¹æ³•</span><br><span class="line">        mf.transferTo(targetFile);</span><br><span class="line">    &#125; catch (IOException e) &#123;</span><br><span class="line">        System.out.println(&quot;å¤±è´¥&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…ä½¿ç”¨MultipartFileå®ç°æ–‡ä»¶ä¸Šä¼ çš„ä¸€ä¸ªcase</p>
<p>èƒŒæ™¯ï¼šæ–‡ä»¶ä¸Šä¼ å¤‡ä»½å¸Œæœ›å®ƒæ˜¯å’Œä¸»ä¸šåŠ¡çº¿ç¨‹å¤„äºå¼‚æ­¥æƒ…å†µä¸‹çš„ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«çš„å“åº”ç»™ç”¨æˆ·åé¦ˆï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ã€‚<br>MultipartFileå¼‚æ­¥ä¿å­˜æ–‡ä»¶transferto æŠ¥é”™java.io.FileNotFoundException: XXX.tmp (No such file or directory)</p>
<p>åŸå› ï¼šç”±äºSpringBootä¸Šä¼ æ–‡ä»¶åä¼šå½¢æˆMultiPartFileçš„å®ä¾‹ï¼Œåœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶ä¸”æ­¤å®ä¾‹æ‰§è¡Œæ­¤ä¸´æ—¶æ–‡ä»¶ã€‚å½“ä¸»çº¿ç¨‹æ‰§è¡Œç»“æŸåï¼Œ<br>SpringMVCä¼šæ¸…é™¤æ‰æ­¤ä¸´æ—¶æ–‡ä»¶ï¼Œå¯¼è‡´å­çº¿ç¨‹åœ¨å¤„ç†æ­¤å®ä¾‹çš„æ—¶å€™æ‰¾ä¸åˆ°æ­¤å®ä¾‹æŒ‡å‘çš„ä¸´æ—¶æ–‡ä»¶ï¼ŒMultipartFileå¯¹è±¡å°±å˜æˆäº†null,ä»è€ŒæŠ¥FileNotFoundExceptionï¼</p>
<p>è§£å†³ï¼šå…ˆè·å–ä¼ InputStremï¼Œä¼ ä¼ InputStremã€‚</p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_42408648/article/details/126272849">https://blog.csdn.net/weixin_42408648/article/details/126272849</a></p>
<p>âœ…MultipartFile å¯¹ä¸Šä¼ çš„æ–‡ä»¶å¤§å°è¿›è¡Œé™åˆ¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class MultipartFileUtil &#123;</span><br><span class="line"></span><br><span class="line">private final static Integer FILE_SIZE = 5;//æ–‡ä»¶ä¸Šä¼ é™åˆ¶å¤§å°</span><br><span class="line">private final static String FILE_UNIT = &quot;M&quot;;//æ–‡ä»¶ä¸Šä¼ é™åˆ¶å•ä½ï¼ˆB,K,M,Gï¼‰</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param len  æ–‡ä»¶é•¿åº¦</span><br><span class="line">     * @param size é™åˆ¶å¤§å°</span><br><span class="line">     * @param unit é™åˆ¶å•ä½ï¼ˆB,K,M,Gï¼‰</span><br><span class="line">     * @æè¿° åˆ¤æ–­æ–‡ä»¶å¤§å°</span><br><span class="line">     */</span><br><span class="line">    public static boolean checkFileSize(Long len, int size, String unit) &#123;</span><br><span class="line">        double fileSize = 0;</span><br><span class="line">        if (&quot;B&quot;.equalsIgnoreCase(unit)) &#123;</span><br><span class="line">            fileSize = (double) len;</span><br><span class="line">        &#125; else if (&quot;K&quot;.equalsIgnoreCase(unit)) &#123;</span><br><span class="line">            fileSize = (double) len / 1024;</span><br><span class="line">        &#125; else if (&quot;M&quot;.equalsIgnoreCase(unit)) &#123;</span><br><span class="line">            fileSize = (double) len / 1048576;</span><br><span class="line">        &#125; else if (&quot;G&quot;.equalsIgnoreCase(unit)) &#123;</span><br><span class="line">            fileSize = (double) len / 1073741824;</span><br><span class="line">        &#125;</span><br><span class="line">        return !(fileSize &gt; size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æ–‡ä»¶ä¸Šä¼ è°ƒç”¨</span><br><span class="line">    public static String upload(MultipartFile file) &#123;</span><br><span class="line">        boolean flag = checkFileSize(file.getSize(), FILE_SIZE, FILE_UNIT);</span><br><span class="line">        if (!flag) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;ä¸Šä¼ æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/w_shimmer/article/details/124341265">https://blog.csdn.net/w_shimmer/article/details/124341265</a></p>
<h4 id="java-nio-file-æ–‡ä»¶æ“ä½œ"><a href="#java-nio-file-æ–‡ä»¶æ“ä½œ" class="headerlink" title="java.nio.file æ–‡ä»¶æ“ä½œ"></a>java.nio.file æ–‡ä»¶æ“ä½œ</h4><p>è‡ª Java7 å¼€å§‹ï¼ŒJava ç»ˆäºç®€åŒ–äº†æ–‡ä»¶è¯»å†™çš„åŸºæœ¬æ“ä½œï¼Œæ–°å¢äº† java.nio.file åº“ï¼Œé€šè¿‡ä¸ Java8 æ–°å¢çš„ stream ç»“åˆå¯ä»¥ä½¿å¾—æ–‡ä»¶æ“ä½œå˜å¾—æ›´åŠ ä¼˜é›…ã€‚</p>
<p>1ï¸âƒ£æ–‡ä»¶å’Œç›®å½•è·¯å¾„Path</p>
<p>java.nio.file.Paths ç±»åŒ…å«ä¸€ä¸ªé™æ€æ–¹æ³• <code>static.get()</code>ï¼Œå¯ä»¥æ¥å—ä¸€ç³»åˆ— String å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ URI ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”è½¬æ¢è¿”å›ä¸€ä¸ª <code>Path</code> å¯¹è±¡ã€‚</p>
<p>ä¸€ä¸ª Path å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•çš„è·¯å¾„ï¼Œæ˜¯ä¸€ä¸ªè·¨æ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿçš„æŠ½è±¡ï¼Œç›®çš„æ˜¯åœ¨æ„é€ è·¯å¾„æ—¶å¯ä»¥ä¸å¿…å…³æ³¨åº•å±‚æ“ä½œç³»ç»Ÿã€‚å¦‚æœ Path ä»…ç”±ä¸€ä¸ªç©ºçš„åç§°å…ƒç´ ç»„æˆï¼Œåˆ™è®¤ä¸ºæ˜¯ç©ºçš„è·¯å¾„ã€‚ä½¿ç”¨ç©ºè·¯å¾„è®¿é—®æ–‡ä»¶ç­‰åŒäºè®¿é—®æ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤ç›®å½•ã€‚Path æ¥å£çš„å®ç°æ˜¯ä¸å¯å˜ä¸”å®‰å…¨çš„ï¼Œå¯ä¾›å¤šä¸ªå¹¶è¡Œçº¿ç¨‹ä½¿ç”¨.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Path path1 = Paths.get(&quot;C:&quot;, &quot;path&quot;, &quot;to&quot;, &quot;nowhere&quot;, &quot;NoFile.txt&quot;);</span><br><span class="line">System.out.println(path1); //C:/path/to/nowhere/NoFile.txt</span><br><span class="line">Path path2 = Paths.get(&quot;C:/path/to/nowhere/NoFile.txt&quot;);</span><br><span class="line">System.out.println(path2); //C:/path/to/nowhere/NoFile.txt</span><br><span class="line">URI uri = path2.toUri();  //è½¬æ¢ä¸ºURIå¯¹è±¡ï¼Œå¯ä»¥ç”¨äºæ„å»ºwebèµ„æºçš„ç»å¯¹uri</span><br><span class="line">System.out.println(uri); //file:///Users/liuxuan/MyProject/mypro/spring-boot-demo/spring-boot-study/C:/path/to/nowhere/NoFile.txt</span><br><span class="line">Path path3 = Paths.get(uri);</span><br><span class="line">System.out.println(path3);</span><br><span class="line"></span><br><span class="line">// è¿”å›è¡¨ç¤ºæ­¤è·¯å¾„çš„ç»å¯¹è·¯å¾„çš„Pathå¯¹è±¡</span><br><span class="line">Path p = Paths.get(&quot;FileTest.java&quot;).toAbsolutePath();  //ç›¸å¯¹äºå½“å‰é¡¹ç›®ç›®å½•</span><br><span class="line">System.out.println(p); ///Users/liuxuan/MyProject/mypro/spring-boot-demo/spring-boot-study/FileTest.java</span><br><span class="line">// è¿”å›è¡¨ç¤ºæ­¤è·¯å¾„çš„çœŸå®è·¯å¾„çš„Pathå¯¹è±¡ï¼Œä¹Ÿå³æ˜¯å¸¦ä¸Šç›˜ç¬¦ï¼ˆæ ¹è·¯å¾„ï¼‰</span><br><span class="line">Path p2 = Paths.get(&quot;/Users/liuxuan/Downloads/test&quot;).toRealPath();</span><br><span class="line">// getNameCount() è¿”å›è·¯å¾„ä¸­çš„åç§°å…ƒç´ çš„æ•°é‡</span><br><span class="line">for(int i = 0; i &lt; p.getNameCount(); i++) &#123;</span><br><span class="line">    // è¿”å›æ­¤è·¯å¾„çš„åç§°å…ƒç´ ä½œä¸º Pathå¯¹è±¡</span><br><span class="line">    System.out.println(p.getName(i));</span><br><span class="line">&#125;</span><br><span class="line">// æµ‹è¯•è·¯å¾„æ˜¯å¦ä»¥ç»™å®šçš„è·¯å¾„ç»“æŸï¼Œè¿™é‡Œä¼šè¾“å‡º end with &#x27;.java&#x27;:false</span><br><span class="line">System.out.println(&quot;ends with &#x27;.java&#x27;: &quot; + p.endsWith(&quot;.java&quot;));</span><br><span class="line">// Path ä¹Ÿå®ç°äº† iterable æ¥å£ï¼Œä¼šå¯¹è·¯å¾„ä¸­çš„åç§°å…ƒç´ è¿›è¡Œéå†</span><br><span class="line">for(Path pp : p) &#123;</span><br><span class="line">    System.out.println(pp);</span><br><span class="line">&#125;</span><br><span class="line">// getRoot() è¿”å›æ­¤è·¯å¾„çš„æ ¹è·¯å¾„ä½œä¸ºPathå¯¹è±¡ï¼Œä¸ºnullåˆ™è¯¥è·¯å¾„ä¸å…·æœ‰æ ¹</span><br><span class="line">// startsWith() æ•ˆæœå’Œ endsWith() ç›¸ä¼¼</span><br><span class="line">// è¿™é‡Œä¼šè¾“å‡º Starts with C:\ true</span><br><span class="line">System.out.println(&quot;Starts with &quot; + p.getRoot() + &quot; &quot; + p.startsWith(p.getRoot()));</span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶æˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡å¯¹ Path å¯¹è±¡å¢åŠ æˆ–ä¿®æ”¹ä¸€éƒ¨åˆ†æ¥æ„é€ ä¸€ä¸ªæ–°çš„ path å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ relativize() ç§»é™¤ Path çš„æ ¹è·¯å¾„ï¼Œæˆ–è€…ä½¿ç”¨ resolve() æ·»åŠ  Path çš„å°¾è·¯å¾„ï¼Œæ³¨æ„æ·»åŠ çš„è·¯å¾„å¯ä»¥ä¸æ˜¯çœŸå®å­˜åœ¨çš„.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä½¿ç”¨..å¯ä»¥è·³è½¬åˆ°ä¸Šä¸€çº§è·¯å¾„ï¼Œä½†å¿…é¡»ä½¿ç”¨normalize()æ–¹æ³•</span><br><span class="line">// å‡è®¾å½“å‰è·¯å¾„ä¸º/Users/liuxuan/MyProject/mypro/spring-boot-demo/spring-boot-study/FileTest.java</span><br><span class="line">Path base = Paths.get(&quot;..&quot;, &quot;..&quot;, &quot;..&quot;).toAbsolutePath().normalize();</span><br><span class="line">System.out.println(base); ///Users/liuxuan/MyProject</span><br><span class="line">// æ„é€ æ­¤è·¯å¾„å’Œç»™å®šè·¯å¾„ä¹‹é—´çš„ç›¸å¯¹è·¯å¾„</span><br><span class="line">Path p4 = base.relativize(p);</span><br><span class="line">System.out.println(p4);</span><br><span class="line">// ä½¿ç”¨resolveæ„é€ è·¯å¾„</span><br><span class="line">// æ­¤æ—¶è·¯å¾„ä¸ºC:\Users\Bruce\Documents\GitHub\string</span><br><span class="line">Path convoluted = p.getParent().resolve(&quot;string&quot;);</span><br><span class="line">System.out.println(convoluted);</span><br></pre></td></tr></table></figure>

<p>2ï¸âƒ£Fileså·¥å…·ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è·å–æ–‡ä»¶çš„å­—èŠ‚æ•°ç»„ï¼š</span><br><span class="line">byte[] fileBytes = Files.readAllBytes(Paths.get(&quot;/Users/liuxuan/Downloads/test/cal.sh&quot;));</span><br><span class="line">System.out.println(new String(fileBytes));</span><br></pre></td></tr></table></figure>

<p>è·å–æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶å¤¹æ•°é‡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String path = &quot;/Users/liuxuan/Downloads/&quot;;</span><br><span class="line">File fileDir = new File(path);</span><br><span class="line">if (!fileDir.exists() || !fileDir.isDirectory()) &#123;</span><br><span class="line">    throw new RuntimeException(&quot;ä¸æ˜¯æ–‡ä»¶å¤¹&quot;);</span><br><span class="line">&#125;</span><br><span class="line">String[] fileList = fileDir.list();</span><br><span class="line">int count = 0;</span><br><span class="line">for (String file : fileList) &#123;</span><br><span class="line">    if (new File(path + file).isDirectory()) &#123;</span><br><span class="line">        count ++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(count);</span><br><span class="line">File[] files = fileDir.listFiles();</span><br><span class="line">for (File file : files) &#123;</span><br><span class="line">    System.out.println(file.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨Fileså®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Path path1 = Paths.get(&quot;/Users/liuxuan/Downloads/&quot;);</span><br><span class="line">if (!Files.exists(path1) || !Files.isDirectory(path1)) &#123;</span><br><span class="line">    throw new RuntimeException(&quot;ä¸æ˜¯æ–‡ä»¶å¤¹&quot;);</span><br><span class="line">&#125;</span><br><span class="line">long dirCount = Files.list(path1).filter(Files :: isDirectory).count();</span><br><span class="line">System.out.println(dirCount);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>Files.list(path)</code>éœ€è¦æ³¨æ„ï¼Œå®ƒè¿”å›çš„æ˜¯<code>Stream&lt;Path&gt;</code>ï¼Œå¦‚æœæ²¡æœ‰å…³é—­ï¼Œå¹¶ä¸”ä»£ç é¢‘ç¹ä½¿ç”¨ï¼Œå°†å¯¼è‡´æ‰“å¼€çš„æ–‡ä»¶è¿‡å¤šè€ŒæŠ¥é”™ï¼ˆæ¯ä¸ªè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jps -mlVv | grep javaTest</span><br><span class="line">lsof -p è¿›ç¨‹id | wc -l</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¦å…³é—­æµï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.æ‰‹åŠ¨å…³é—­</span><br><span class="line">Stream&lt;Path&gt; paths = Files.list(path);</span><br><span class="line">paths.close();</span><br><span class="line"></span><br><span class="line">2.try resourceè‡ªåŠ¨å…³é—­æµ</span><br><span class="line">try(Stream&lt;Path&gt; paths = Files.list(path)) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šè¯¥åŒ…ä¸‹çš„ç”¨æ³•ï¼š<br><a href="https://blog.csdn.net/CSDN_handsome/article/details/109743637">https://blog.csdn.net/CSDN_handsome/article/details/109743637</a></p>
<h3 id="lambdaè¡¨è¾¾å¼"><a href="#lambdaè¡¨è¾¾å¼" class="headerlink" title="lambdaè¡¨è¾¾å¼"></a>lambdaè¡¨è¾¾å¼</h3><p>çœ‹ã€ŠjavaåŸºç¡€ã€‹<br>é’ˆå¯¹æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£å®ç°ï¼Œä»¥ç®€æ´çš„è¡¨è¾¾å¼å½¢å¼å®ç°æ¥å£åŠŸèƒ½æ¥ä½œä¸ºæ–¹æ³•å‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set.stream().map(i-&gt;String.valueOf(i)).</span><br><span class="line">æ‹¬å·å†…çš„iï¼Œè¡¨ç¤ºæµå¤„ç†ä¸­çš„å…ƒç´ ï¼Œä¹Ÿæ˜¯lambdaè¡¨è¾¾å¼çš„è¾“å…¥</span><br><span class="line">åªæœ‰ä¸€å¥è¯­å¥ï¼Œçœå»äº†&#123;&#125;ï¼Œçœå»äº†return</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ç°æœ‰çš„æ–¹æ³•ï¼Œæ¯”å¦‚ä¸Šé¢çš„ï¼Œå¯ä»¥å˜æˆlambdaè¡¨è¾¾å¼çš„å¼•ç”¨å½¢å¼::</span><br><span class="line">.map(String::valueOf).</span><br><span class="line"></span><br><span class="line">ä¸Šé¢çš„æ–¹æ³•ä¾‹å¦‚map()ï¼Œå†…éƒ¨çš„ä¼ å‚æ˜¯åªæœ‰ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œ</span><br><span class="line">æœ‰çš„æ–¹æ³•ç©¿å‚ï¼Œé™¤äº†ä¸€ä¸ªå‡½æ•°å¼æ¥å£è¿˜æœ‰å…¶ä»–ï¼Œæ‰€ä»¥ä¼šæœ‰å…¶ä»–å‚æ•°ã€‚</span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">æ–¹æ³•ï¼šshowSum(int x, int y, Calculate cu)</span><br><span class="line">ä½¿ç”¨ï¼šshowSum(10, 20, (x,y)-&gt;x+y);</span><br></pre></td></tr></table></figure>



<h3 id="spring-expression-Spelè¡¨è¾¾å¼-javaè¯­è¨€è§£æ"><a href="#spring-expression-Spelè¡¨è¾¾å¼-javaè¯­è¨€è§£æ" class="headerlink" title="spring-expression Spelè¡¨è¾¾å¼ javaè¯­è¨€è§£æ"></a>spring-expression Spelè¡¨è¾¾å¼ javaè¯­è¨€è§£æ</h3><p>ExpressionParseæ¥å£æ˜¯springframeworkåŒ…ä¸‹çš„ã€‚<br>å¯¹è¡¨è¾¾å¼è¿›è¡Œè§£æï¼Œé€šè¿‡å­—ç¬¦ä¸²ä¼ å…¥è§£æå™¨ï¼Œè¿›è¡Œè§£æã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    //å°†ä¸€æ•´ä¸ªè¯­å¥ç›´æ¥å®šä¹‰äº†å­—ç¬¦ä¸² ,å…¶ä¸­å¯¹å­—ç¬¦ä¸²çš„å¼€å§‹ç´¢å¼•ä¸ç»“æŸç´¢å¼•ä½¿ç”¨æ›¿ä»£å˜é‡</span><br><span class="line">    //å˜é‡å‰éœ€è¦åŠ #</span><br><span class="line">    String str = &quot;#var + 2&quot;;</span><br><span class="line">    //1å®šä¹‰ä¸€ä¸ªä¸“å±çš„è¡¨è¾¾å¼è§£æå·¥å…·</span><br><span class="line">    ExpressionParser parser = new SpelExpressionParser() ;</span><br><span class="line">    //2å®šä¹‰ä¸€ä¸ªè¡¨è¾¾å¼å¤„ç†ç±»</span><br><span class="line">    Expression exp = parser.parseExpression(str);</span><br><span class="line">    //3è¿›è¡Œæœ€ç»ˆçš„è¡¨è¾¾å¼è®¡ç®—ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡ç”¨æ¥ä¼ å‚</span><br><span class="line">    EvaluationContext context = new StandardEvaluationContext() ;</span><br><span class="line">    context.setVariable(&quot;var&quot;, 5);</span><br><span class="line">    //4é€šè¿‡è¡¨è¾¾å¼è¿›è¡Œç»“æœè®¡ç®—</span><br><span class="line">    System.out.println(exp.getValue(context, Integer.class));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h3><p>AtomicIntegerç±»æ˜¯ç³»ç»Ÿåº•å±‚ä¿æŠ¤çš„intç±»å‹ï¼Œé€šè¿‡æä¾›æ‰§è¡Œæ–¹æ³•çš„æ§åˆ¶è¿›è¡Œå€¼çš„åŸå­æ“ä½œã€‚AtomicIntegerå®ƒä¸èƒ½å½“ä½œIntegeræ¥ä½¿ç”¨ã€‚</p>
<p>ä»JAVA 1.5å¼€å§‹ï¼ŒAtomicInteger å±äºjava.util.concurrent.atomic åŒ…ä¸‹çš„ä¸€ä¸ªç±»ã€‚</p>
<p>AtomicIntegeré€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°å¯ä»¥ç›´æ¥åˆ›å»ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//åˆå§‹å€¼æ˜¯ 0</span><br><span class="line">AtomicInteger atomicInteger = new AtomicInteger(); </span><br><span class="line"> </span><br><span class="line">//åˆå§‹å€¼æ˜¯ 100</span><br><span class="line">AtomicInteger atomicInteger = new AtomicInteger(100);</span><br><span class="line"> </span><br><span class="line">int currentValue = atomicInteger.get();         //100</span><br><span class="line"> </span><br><span class="line">atomicInteger.set(1234);                        //å½“å‰å€¼1234</span><br></pre></td></tr></table></figure>

<p>ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ<br>1ã€ä½œä¸ºå¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨çš„åŸå­è®¡æ•°å™¨ã€‚<br>2ã€åœ¨æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œä¸­å®ç°éé˜»å¡ç®—æ³•ã€‚</p>
<p>åŸå­è®¡æ•°å™¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸€äº›ä»¥åŸå­æ–¹å¼æ‰§è¡ŒåŠ æ³•å’Œå‡æ³•æ“ä½œçš„æ–¹æ³•:</span><br><span class="line">addAndGet()- ä»¥åŸå­æ–¹å¼å°†ç»™å®šå€¼æ·»åŠ åˆ°å½“å‰å€¼ï¼Œå¹¶åœ¨æ·»åŠ åè¿”å›æ–°å€¼ã€‚</span><br><span class="line">getAndAdd() - ä»¥åŸå­æ–¹å¼å°†ç»™å®šå€¼æ·»åŠ åˆ°å½“å‰å€¼å¹¶è¿”å›æ—§å€¼ã€‚</span><br><span class="line">incrementAndGet()- ä»¥åŸå­æ–¹å¼å°†å½“å‰å€¼é€’å¢1å¹¶åœ¨é€’å¢åè¿”å›æ–°å€¼ã€‚å®ƒç›¸å½“äºi ++æ“ä½œã€‚</span><br><span class="line">getAndIncrement() - ä»¥åŸå­æ–¹å¼é€’å¢å½“å‰å€¼å¹¶è¿”å›æ—§å€¼ã€‚å®ƒç›¸å½“äº++ iæ“ä½œã€‚</span><br><span class="line">decrementAndGet()- åŸå­åœ°å°†å½“å‰å€¼å‡1å¹¶åœ¨å‡é‡åè¿”å›æ–°å€¼ã€‚å®ƒç­‰åŒäºi-æ“ä½œã€‚</span><br><span class="line">getAndDecrement() - ä»¥åŸå­æ–¹å¼é€’å‡å½“å‰å€¼å¹¶è¿”å›æ—§å€¼ã€‚å®ƒç›¸å½“äº-iæ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">public class Main&#123;</span><br><span class="line">    public static void main(String[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        AtomicInteger atomicInteger = new AtomicInteger(100);</span><br><span class="line">         </span><br><span class="line">        System.out.println(atomicInteger.addAndGet(2));         //102</span><br><span class="line">        System.out.println(atomicInteger);                      //102</span><br><span class="line">         </span><br><span class="line">        System.out.println(atomicInteger.getAndAdd(2));         //102</span><br><span class="line">        System.out.println(atomicInteger);                      //104</span><br><span class="line">         </span><br><span class="line">        System.out.println(atomicInteger.incrementAndGet());    //105  </span><br><span class="line">        System.out.println(atomicInteger);                      //105  </span><br><span class="line">                 </span><br><span class="line">        System.out.println(atomicInteger.getAndIncrement());    //105</span><br><span class="line">        System.out.println(atomicInteger);                      //106</span><br><span class="line">         </span><br><span class="line">        System.out.println(atomicInteger.decrementAndGet());    //105</span><br><span class="line">        System.out.println(atomicInteger);                      //105</span><br><span class="line">         </span><br><span class="line">        System.out.println(atomicInteger.getAndDecrement());    //105</span><br><span class="line">        System.out.println(atomicInteger);                      //104</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒå’Œäº¤æ¢ï¼š<br>1ã€æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œå°†å†…å­˜ä½ç½®çš„å†…å®¹ä¸ç»™å®šå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä¸”åªæœ‰å®ƒä»¬ç›¸åŒæ—¶ï¼Œæ‰å°†è¯¥å†…å­˜ä½ç½®çš„å†…å®¹ä¿®æ”¹ä¸ºç»™å®šçš„æ–°å€¼ã€‚è¿™æ˜¯ä½œä¸ºå•ä¸ªåŸå­æ“ä½œå®Œæˆçš„ã€‚<br>2ã€åŸå­æ€§ä¿è¯äº†æ–°å€¼æ˜¯æ ¹æ®æœ€æ–°ä¿¡æ¯è®¡ç®—å‡ºæ¥çš„; å¦‚æœåœ¨æ­¤æœŸé—´è¯¥å€¼å·²è¢«å¦ä¸€ä¸ªçº¿ç¨‹æ›´æ–°ï¼Œåˆ™å†™å…¥å°†å¤±è´¥ã€‚<br><code>boolean compareAndSet(int expect, int update)</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">        //1ã€é»˜è®¤åˆå§‹å€¼</span><br><span class="line">        AtomicInteger atomicInteger = new AtomicInteger(100);</span><br><span class="line">        //2ã€é»˜è®¤åˆå§‹å€¼å’Œç»™å®šå€¼ï¼Œéƒ½æ˜¯100ï¼Œæ‰€ä»¥ä¼šæ›´æ”¹æˆåŠŸ</span><br><span class="line">        boolean isSuccess = atomicInteger.compareAndSet(100,110);   //current value 100</span><br><span class="line">        //3ã€è¿”å›true</span><br><span class="line">        System.out.println(isSuccess);      //true</span><br><span class="line">        System.out.println(atomicInteger);  //110</span><br><span class="line">        //4ã€é»˜è®¤åˆå§‹å€¼æ˜¯110,ç»™å®šå€¼æ˜¯100ï¼Œæ‰€ä»¥ä¼šæ›´æ”¹å¤±è´¥</span><br><span class="line">        isSuccess = atomicInteger.compareAndSet(100,120);       //current value 110</span><br><span class="line">        //5ã€è¿”å›false</span><br><span class="line">        System.out.println(isSuccess);      //false</span><br><span class="line">        System.out.println(atomicInteger);  //110</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://www.jianshu.com/p/073096a729f6">https://www.jianshu.com/p/073096a729f6</a></p>
<h3 id="getClass"><a href="#getClass" class="headerlink" title="getClass()"></a>getClass()</h3><p>è¿”å›Classç±»å‹çš„å¯¹è±¡ã€‚åªæ˜¯getClass()ï¼Œè¿”å›å½“å‰è¿è¡Œæ—¶ç±»ã€‚object.getClass()å‰é¢å¸¦å¯¹è±¡.getClass()è¿”å›å¯¹è±¡çš„ç±»ã€‚</p>
<p>Classå¸¸ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test1() throws IllegalAccessException, InstantiationException, IOException &#123;</span><br><span class="line">  Class cl = getClass();</span><br><span class="line">  System.out.println(cl); //class org.example.javaer.ClassTest</span><br><span class="line">  String name = cl.getName(); // org.example.javaer.ClassTest</span><br><span class="line">  System.out.println(name);</span><br><span class="line">  Object classTest = cl.newInstance(); //åˆ›å»ºå®ä¾‹</span><br><span class="line">  String packName = cl.getPackage().getName();</span><br><span class="line">  System.out.println(packName); //org.example.javaer</span><br><span class="line">  ClassLoader classLoader = cl.getClassLoader(); //è·å–ç±»åŠ è½½å™¨</span><br><span class="line">  System.out.println(classLoader);</span><br><span class="line"></span><br><span class="line">  //getResourceAsStreamä»é¡¹ç›®ä¸‹æ–‡ä»¶ä¸­è·å–è¾“å…¥æµ</span><br><span class="line">  //è¯»å–æ–‡ä»¶å†…å®¹ä¸ºString</span><br><span class="line">  InputStream in = cl.getResourceAsStream(&quot;/hi.md&quot;); //åŠ &quot;/&quot;ï¼Œ/è¡¨ç¤ºsrc/test/resourcesä¸‹ï¼ˆClassPathæ ¹ç›®å½•ï¼‰</span><br><span class="line">  System.out.println(IOUtils.toString(in, String.valueOf(StandardCharsets.UTF_8)));</span><br><span class="line"></span><br><span class="line">  //è¯»å–ä¸ºå­—èŠ‚æ•°ç»„</span><br><span class="line">  byte[] bytes = IOUtils.toByteArray(in);</span><br><span class="line">  System.out.println(bytes);</span><br><span class="line"></span><br><span class="line">  InputStream in1 = cl.getResourceAsStream(&quot;src/test/resources/hi.md&quot;); //ä¸è¡Œï¼ŒNPE</span><br><span class="line">  System.out.println(IOUtils.toString(in1, String.valueOf(StandardCharsets.UTF_8)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…è·å–å„ç§è·¯å¾„"><a href="#âœ…è·å–å„ç§è·¯å¾„" class="headerlink" title="âœ…è·å–å„ç§è·¯å¾„"></a>âœ…è·å–å„ç§è·¯å¾„</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2() throws IOException &#123;</span><br><span class="line">    // 1.è·å–ClassPathæ ¹è·¯å¾„ï¼ˆç±»åŠ è½½æ ¹è·¯å¾„ï¼‰ï¼Œåˆ°src/test/resourcesï¼Œä¸¤ç§æ–¹æ³•</span><br><span class="line">    String path1 = getClass().getResource(&quot;/&quot;).toString(); //file:/Users/liuxuan/MyProject/JavaProject/java/web/target/test-classes/</span><br><span class="line">    System.out.println(&quot;ClassPathæ ¹è·¯å¾„ï¼š&quot; + path1);</span><br><span class="line">    System.out.println(&quot;é¡¹ç›®è·¯å¾„ï¼š&quot; + getClass().getClassLoader().getResource(&quot;&quot;)); //å’Œä¸Šé¢ä¸€æ ·</span><br><span class="line"></span><br><span class="line">    // 2.è·å–ç»å¯¹è·¯å¾„</span><br><span class="line">    String path2 = getClass().getResource(&quot;&quot;).toString(); //file:/Users/liuxuan/MyProject/JavaProject/java/web/target/classes/org/example/javaer/</span><br><span class="line">    System.out.println(&quot;ç»å¯¹è·¯å¾„ï¼š&quot; + path2);</span><br><span class="line"></span><br><span class="line">    // 3.è·å–é¡¹ç›®è·¯å¾„ ä¸¤ç§æ–¹æ³•</span><br><span class="line">    File dir = new File(&quot;&quot;); //å‚æ•°ä¸ºç©º</span><br><span class="line">    String path3 = dir.getCanonicalPath(); ///Users/liuxuan/MyProject/JavaProject/java/web</span><br><span class="line">    System.out.println(&quot;é¡¹ç›®è·¯å¾„ï¼š&quot; + path3);</span><br><span class="line">    String path4 = System.getProperty(&quot;user.dir&quot;); ///Users/liuxuan/MyProject/JavaProject/java/web</span><br><span class="line">    System.out.println(&quot;é¡¹ç›®è·¯å¾„ï¼š&quot; + path4);</span><br><span class="line">    String allPath = System.getProperty(&quot;java.class.path&quot;); //æ‰€æœ‰jaråŒ…çš„è·¯å¾„</span><br><span class="line">    System.out.println(&quot;javaç±»è·¯å¾„ï¼š&quot; + allPath);</span><br><span class="line"></span><br><span class="line">    // å†çœ‹çœ‹</span><br><span class="line">    String path5 = getClass().getResource(&quot;/&quot;).getPath(); //è¿™æ ·è·å¾—çš„å‰é¢æ²¡æœ‰file</span><br><span class="line">    System.out.println(&quot;ClassPathæ ¹è·¯å¾„ï¼š&quot; + path5);</span><br><span class="line">    URL url = getClass().getClassLoader().getResource(&quot;&quot;); //file:/Users/liuxuan/MyProject/JavaProject/java/web/target/test-classes/</span><br><span class="line">    System.out.println(url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š<a href="https://blog.51cto.com/u_15057811/4080631">https://blog.51cto.com/u_15057811/4080631</a></p>
<h4 id="âœ…System-getProperty-æ–¹æ³•"><a href="#âœ…System-getProperty-æ–¹æ³•" class="headerlink" title="âœ…System.getProperty()æ–¹æ³•"></a>âœ…System.getProperty()æ–¹æ³•</h4><p>è·å–å½“å‰ç³»ç»Ÿçš„ç‰ˆæœ¬ç­‰ä¸€äº›ä¿¡æ¯ã€‚<br>å†…éƒ¨keyï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String path4 = System.getProperty(&quot;user.dir&quot;); ///Users/liuxuan/MyProject/JavaProject/java/web</span><br><span class="line">System.out.println(&quot;é¡¹ç›®è·¯å¾„ï¼š&quot; + path4);</span><br><span class="line">String allPath = System.getProperty(&quot;java.class.path&quot;);</span><br><span class="line">System.out.println(&quot;javaç±»è·¯å¾„ï¼š&quot; + allPath);</span><br><span class="line"></span><br><span class="line">Java.version</span><br><span class="line">Java è¿è¡Œæ—¶ç¯å¢ƒç‰ˆæœ¬</span><br><span class="line">java.vendor</span><br><span class="line">Java è¿è¡Œæ—¶ç¯å¢ƒä¾›åº”å•†</span><br><span class="line">java.vendor.url</span><br><span class="line">Java ä¾›åº”å•†çš„ URL</span><br><span class="line">java.home</span><br><span class="line">Java å®‰è£…ç›®å½•</span><br><span class="line">java.vm.specification.version</span><br><span class="line">Java è™šæ‹Ÿæœºè§„èŒƒç‰ˆæœ¬</span><br><span class="line">java.vm.specification.vendor</span><br><span class="line">Java è™šæ‹Ÿæœºè§„èŒƒä¾›åº”å•†</span><br><span class="line">java.vm.specification.name</span><br><span class="line">Java è™šæ‹Ÿæœºè§„èŒƒåç§°</span><br><span class="line">java.vm.version</span><br><span class="line">Java è™šæ‹Ÿæœºå®ç°ç‰ˆæœ¬</span><br><span class="line">java.vm.vendor</span><br><span class="line">Java è™šæ‹Ÿæœºå®ç°ä¾›åº”å•†</span><br><span class="line">java.vm.name</span><br><span class="line">Java è™šæ‹Ÿæœºå®ç°åç§°</span><br><span class="line">java.specification.version</span><br><span class="line">Java è¿è¡Œæ—¶ç¯å¢ƒè§„èŒƒç‰ˆæœ¬</span><br><span class="line">java.specification.vendor</span><br><span class="line">Java è¿è¡Œæ—¶ç¯å¢ƒè§„èŒƒä¾›åº”å•†</span><br><span class="line">java.specification.name</span><br><span class="line">Java è¿è¡Œæ—¶ç¯å¢ƒè§„èŒƒåç§°</span><br><span class="line">java.class.version</span><br><span class="line">Java ç±»æ ¼å¼ç‰ˆæœ¬å·</span><br><span class="line">java.class.path</span><br><span class="line">Java ç±»è·¯å¾„</span><br><span class="line">java.library.path</span><br><span class="line">åŠ è½½åº“æ—¶æœç´¢çš„è·¯å¾„åˆ—è¡¨</span><br><span class="line">java.io.tmpdir</span><br><span class="line">é»˜è®¤çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br><span class="line">java.compiler</span><br><span class="line">è¦ä½¿ç”¨çš„ JIT ç¼–è¯‘å™¨çš„åç§°</span><br><span class="line">java.ext.dirs</span><br><span class="line">ä¸€ä¸ªæˆ–å¤šä¸ªæ‰©å±•ç›®å½•çš„è·¯å¾„</span><br><span class="line">os.name</span><br><span class="line">æ“ä½œç³»ç»Ÿçš„åç§°</span><br><span class="line">os.arch</span><br><span class="line">æ“ä½œç³»ç»Ÿçš„æ¶æ„</span><br><span class="line">os.version</span><br><span class="line">æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬</span><br><span class="line">file.separator</span><br><span class="line">æ–‡ä»¶åˆ†éš”ç¬¦ï¼ˆåœ¨ UNIX ç³»ç»Ÿä¸­æ˜¯â€œ/â€ï¼‰</span><br><span class="line">path.separator</span><br><span class="line">è·¯å¾„åˆ†éš”ç¬¦ï¼ˆåœ¨ UNIX ç³»ç»Ÿä¸­æ˜¯â€œ:â€ï¼‰</span><br><span class="line">line.separator</span><br><span class="line">è¡Œåˆ†éš”ç¬¦ï¼ˆåœ¨ UNIX ç³»ç»Ÿä¸­æ˜¯â€œ/nâ€ï¼‰</span><br><span class="line">user.name</span><br><span class="line">ç”¨æˆ·çš„è´¦æˆ·åç§°</span><br><span class="line">user.home</span><br><span class="line">ç”¨æˆ·çš„ä¸»ç›®å½•</span><br><span class="line">user.dir</span><br><span class="line">ç”¨æˆ·çš„å½“å‰å·¥ä½œç›®å½•</span><br></pre></td></tr></table></figure>

<h4 id="âœ…ç±»åŠ è½½å™¨"><a href="#âœ…ç±»åŠ è½½å™¨" class="headerlink" title="âœ…ç±»åŠ è½½å™¨"></a>âœ…ç±»åŠ è½½å™¨</h4><p>ç”¨æ¥æŠŠç±»è£…è½½è¿›å†…å­˜çš„ã€‚</p>
<p>éå¸¸ä¸é”™çš„è¯¦è§£ï¼š<a href="https://blog.csdn.net/m0_68064743/article/details/123957150">https://blog.csdn.net/m0_68064743/article/details/123957150</a></p>
<h4 id="âœ…getSimpleName"><a href="#âœ…getSimpleName" class="headerlink" title="âœ…getSimpleName"></a>âœ…getSimpleName</h4><p>Class.getSimpleName()æ–¹æ³•è¿”å›æ­¤Classå¯¹è±¡è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„ç®€å•åç§°ï¼Œä½œä¸ºå­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String className1 = SomeTest.class.getName();</span><br><span class="line">System.out.println(className1); //com.liuxuan.study.SomeTest</span><br><span class="line">String className2 = SomeTest.class.getSimpleName();</span><br><span class="line">System.out.println(className2); //SomeTest</span><br></pre></td></tr></table></figure>

<h3 id="Class-forNameæ–¹æ³•"><a href="#Class-forNameæ–¹æ³•" class="headerlink" title="Class.forNameæ–¹æ³•"></a>Class.forNameæ–¹æ³•</h3><p>Classç±»çš„é™æ€æ–¹æ³•forName()<br>å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œéƒ½æ˜¯è¿”å›Classç±»å‹çš„å¯¹è±¡ï¼ŒåŒºåˆ«åœ¨äºobject.getClass()ç”¨äºæ ¹æ®å¯¹è±¡è·å–Classå¯¹è±¡ï¼›Class.forName(className)ç”¨äºæ ¹æ®ç±»åè·å–Classå¯¹è±¡ã€‚</p>
<h4 id="âœ…-é¦–å…ˆè®²è¿°Classæ˜¯ä¸ªä»€ä¹ˆæ ·çš„å¯¹è±¡"><a href="#âœ…-é¦–å…ˆè®²è¿°Classæ˜¯ä¸ªä»€ä¹ˆæ ·çš„å¯¹è±¡" class="headerlink" title="âœ… é¦–å…ˆè®²è¿°Classæ˜¯ä¸ªä»€ä¹ˆæ ·çš„å¯¹è±¡"></a>âœ… é¦–å…ˆè®²è¿°Classæ˜¯ä¸ªä»€ä¹ˆæ ·çš„å¯¹è±¡</h4><p>1ã€ Classç±»å°è£…äº†ç±»æˆ–æ¥å£çš„è¿è¡Œæ—¶çŠ¶æ€</p>
<p>Javaç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¸€ç›´å¯¹æ‰€æœ‰çš„å¯¹è±¡è¿›è¡Œæ‰€è°“çš„è¿è¡Œæ—¶ç±»å‹æ ‡è¯†ï¼Œè¿™äº›æ ‡ç¤ºçºªå½•äº†æ¯ä¸ªå¯¹è±¡æ‰€å±çš„ç±»ã€‚<br>è™šæ‹Ÿæœºé€šå¸¸ä½¿ç”¨è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯é€‰æ‹©æ­£ç¡®æ–¹æ³•å»æ‰§è¡Œï¼Œç”¨æ¥ä¿å­˜è¿™äº›ç±»å‹ä¿¡æ¯çš„ç±»æ˜¯Classç±»ã€‚</p>
<p>2ã€Classç±»å‹çš„å¯¹è±¡ï¼Œæ˜¯åŠ è½½ç±»æ—¶è‡ªåŠ¨åˆ›å»ºçš„</p>
<p>Class æ²¡æœ‰å…¬å…±æ„é€ æ–¹æ³•ã€‚Class å¯¹è±¡æ˜¯åœ¨åŠ è½½ç±»æ—¶ï¼Œç”±Java è™šæ‹Ÿæœºä»¥åŠé€šè¿‡è°ƒç”¨ç±»åŠ è½½å™¨ä¸­çš„ defineClass æ–¹æ³•è‡ªåŠ¨æ„é€ çš„ï¼Œå› æ­¤ä¸èƒ½æ˜¾å¼åœ°å£°æ˜ä¸€ä¸ªClasså¯¹è±¡ã€‚</p>
<p>3ã€è™šæ‹Ÿæœºä¸ºæ¯ç§ç±»å‹ç®¡ç†ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„Classå¯¹è±¡</p>
<p>æ¯ä¸ªç±»ï¼ˆå‹ï¼‰éƒ½æœ‰ä¸€ä¸ªClasså¯¹è±¡ã€‚<br>è¿è¡Œç¨‹åºæ—¶ï¼ŒJavaè™šæ‹Ÿæœº(JVM)é¦–å…ˆæ£€æŸ¥æ‰€è¦åŠ è½½çš„ç±»å¯¹åº”çš„Classå¯¹è±¡æ˜¯å¦å·²ç»åŠ è½½ã€‚å¦‚æœæ²¡æœ‰åŠ è½½ï¼ŒJVMå°±ä¼šæ ¹æ®ç±»åæŸ¥æ‰¾.classæ–‡ä»¶ï¼Œå¹¶å°†å…¶Classå¯¹è±¡è½½å…¥ã€‚</p>
<p>4ã€åŸºæœ¬çš„ Java ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€longã€float å’Œ doubleï¼‰å’Œå…³é”®å­— void ä¹Ÿéƒ½å¯¹åº”ä¸€ä¸ª Class å¯¹è±¡ã€‚</p>
<p>5ã€æ¯ä¸ªæ•°ç»„å±äºè¢«æ˜ å°„ä¸º Class å¯¹è±¡çš„ä¸€ä¸ªç±»ï¼Œæ‰€æœ‰å…·æœ‰ç›¸åŒå…ƒç´ ç±»å‹å’Œç»´æ•°çš„æ•°ç»„éƒ½å…±äº«è¯¥ Class å¯¹è±¡ã€‚</p>
<p>6ã€ä¸€èˆ¬æŸä¸ªç±»çš„Classå¯¹è±¡è¢«è½½å…¥å†…å­˜ï¼Œå®ƒå°±ç”¨æ¥åˆ›å»ºè¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ã€‚</p>
<h4 id="âœ…-ç»“åˆåå°„ä½¿ç”¨ä¸¾ä¾‹"><a href="#âœ…-ç»“åˆåå°„ä½¿ç”¨ä¸¾ä¾‹" class="headerlink" title="âœ… ç»“åˆåå°„ä½¿ç”¨ä¸¾ä¾‹"></a>âœ… ç»“åˆåå°„ä½¿ç”¨ä¸¾ä¾‹</h4><p>å¯¹äºä»»ä½•ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½çŸ¥é“è¿™ä¸ªç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºJavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚</p>
<p>getMethod()è¿”å›æŸä¸ªç±»çš„æ‰€æœ‰å…¬ç”¨ï¼ˆpublicï¼‰æ–¹æ³•åŒ…æ‹¬å…¶ç»§æ‰¿ç±»çš„å…¬ç”¨æ–¹æ³•ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å®ƒæ‰€å®ç°æ¥å£çš„æ–¹æ³•ã€‚</p>
<p>getDeclaredMethod()å¯¹è±¡è¡¨ç¤ºçš„ç±»æˆ–æ¥å£å£°æ˜çš„æ‰€æœ‰æ–¹æ³•,åŒ…æ‹¬å…¬å…±ã€ä¿æŠ¤ã€é»˜è®¤ï¼ˆåŒ…ï¼‰è®¿é—®å’Œç§æœ‰æ–¹æ³•ï¼Œä½†ä¸åŒ…æ‹¬ç»§æ‰¿çš„æ–¹æ³•ã€‚å½“ç„¶ä¹ŸåŒ…æ‹¬å®ƒæ‰€å®ç°æ¥å£çš„æ–¹æ³•ã€‚</p>
<p>ä¸€ä¸ªå®ä½“ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.junit.demo;</span><br><span class="line"></span><br><span class="line">public class Book &#123;</span><br><span class="line">    private static final String defName = &quot;ã€Šç¨‹åºçŒ¿æ¤å‘ã€‹&quot;;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        System.out.println(&quot;æˆ‘æ˜¯é™æ€ä»£ç å—ï¼Œè¾“å‡º: &quot; + defName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æ‰“å°ç”Ÿäº§æ—¥æœŸï¼š</span><br><span class="line">    public static String printProduceDate(String name) &#123;</span><br><span class="line">        return &quot;æˆ‘æ˜¯é™æ€æ–¹æ³•printProduceDateï¼Œè¾“å‡º: &quot; + name + &quot;, produce is:&quot; + System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    public Book() &#123;</span><br><span class="line">        System.out.println(&quot;æˆ‘æ˜¯Bookå£°æ˜çš„æ„é€ æ–¹æ³•ï¼&quot;);</span><br><span class="line">        name = defName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String toString(String msg) &#123;</span><br><span class="line">        return name + msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException, InstantiationException &#123;</span><br><span class="line"></span><br><span class="line">    //1-å°†æŒ‡å®šç±»åŠ è½½åˆ°JVMä¸­ï¼ˆClassNotFoundExceptionï¼‰</span><br><span class="line">    Class aClass = Class.forName(&quot;com.junit.demo.Book&quot;); //åŠ è½½è¿‡ç¨‹ä¼šæ‰§è¡Œstaticé™æ€ä»£ç å— outï¼šæˆ‘æ˜¯é™æ€ä»£ç å—ï¼Œè¾“å‡º: ã€Šç¨‹åºçŒ¿æ¤å‘ã€‹</span><br><span class="line">    System.out.println(aClass);  //out:class com.junit.demo.Book</span><br><span class="line"></span><br><span class="line">    //2.1-è®¿é—®é™æ€æ–¹æ³•ï¼šNoSuchMethodExceptionï¼ŒInvocationTargetException</span><br><span class="line">    Method method = aClass.getMethod(&quot;printProduceDate&quot;, String.class);</span><br><span class="line">    String result = (String) method.invoke(aClass, &quot;ã€Šç¨‹åºçŒ¿çš„é¢ˆæ¤è‡ªä¼ ã€‹&quot;);  </span><br><span class="line">    //åå°„é™æ€æ–¹æ³• ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Classå¯¹è±¡(ä¹Ÿå¯ä»¥ä¼ å…¥nullï¼Ÿ) ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¾“å…¥</span><br><span class="line">    System.out.println(result); //outï¼šæˆ‘æ˜¯é™æ€æ–¹æ³•printProduceDateï¼Œè¾“å‡º: ã€Šç¨‹åºçŒ¿çš„é¢ˆæ¤è‡ªä¼ ã€‹, produce is:1626682894095</span><br><span class="line">    System.out.println(&quot;---------------------------\n&quot;);</span><br><span class="line"></span><br><span class="line">    //2.2-åˆå§‹åŒ–å¯¹è±¡ï¼š</span><br><span class="line">    Book obj = (Book) aClass.newInstance();  //out:æˆ‘æ˜¯Bookå£°æ˜çš„æ„é€ æ–¹æ³•ï¼</span><br><span class="line">    System.out.println(&quot;å¾—åˆ°å¯¹è±¡åè®¿é—®getæ–¹æ³•ï¼š&quot; + obj.toString(&quot;&quot;));  //out:å¾—åˆ°å¯¹è±¡åè®¿é—®getæ–¹æ³•ï¼šã€Šç¨‹åºçŒ¿æ¤å‘ã€‹</span><br><span class="line">    System.out.println(&quot;---------------------------\n&quot;);</span><br><span class="line"></span><br><span class="line">    //2.3-åˆå§‹åŒ–å¯¹è±¡åè®¿é—®æ–¹æ³•ï¼š</span><br><span class="line">    Method method3 = aClass.getMethod(&quot;toString&quot;, String.class);</span><br><span class="line">    String result3 = (String) method3.invoke(aClass.newInstance()/*obj*/, &quot;è¿™æœ¬ä¹¦æ˜¯æˆ‘çš„ä¼™ä¼´ï¼&quot;); </span><br><span class="line">    //åå°„éé™æ€æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯è¾“å…¥ã€‚</span><br><span class="line">    System.out.println(result3); //outï¼šã€Šç¨‹åºçŒ¿æ¤å‘ã€‹è¿™æœ¬ä¹¦æ˜¯æˆ‘çš„ä¼™ä¼´ï¼</span><br><span class="line">    System.out.println(&quot;---------------------------\n&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(Book.class.getName()); //com.junit.demo.Book</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â˜ï¸é€šè¿‡åå°„æ–¹å¼è®¿é—®é™æ€æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç”±Classè·å–æ–¹æ³•ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–¹æ³•åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ–¹æ³•çš„å‚æ•°ç±»å‹ã€‚</span><br><span class="line">Method method = aClass.getMethod(&quot;printProduceDate&quot;, String.class);</span><br><span class="line">// å¼•ç”¨æ–¹æ³•ï¼š(å¼•ç”¨å®ä¾‹/è°ƒç”¨é™æ€æ–¹æ³•å¯ä¸ºnullï¼Œå‚æ•°å€¼/æœ‰å¤šä¸ªç”¨é€—å·éš”å¼€)ï¼Œå‚æ•°å€¼è¦å’Œå‚æ•°ç±»å‹çš„æ•°é‡åŒ¹é…ï¼</span><br><span class="line">String result = (String) method.invoke(aClass, &quot;ã€Šç¨‹åºçŒ¿çš„é¢ˆæ¤è‡ªä¼ ã€‹&quot;);</span><br><span class="line"></span><br><span class="line">ç®€å†™ï¼š</span><br><span class="line">aClass.getMethod(&quot;printProduceDate&quot;, String.class).invoke(null, &quot;ã€Šç¨‹åºçŒ¿çš„é¢ˆæ¤è‡ªä¼ ã€‹&quot;);</span><br></pre></td></tr></table></figure>

<p>âœŒï¸é€šè¿‡åå°„æ–¹å¼è®¿é—®å®ä¾‹æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//æ–¹æ³•ä¸€ï¼šç›´æ¥è½¬åŒ–å®ä¾‹åŒ–åçš„å¯¹è±¡ï¼Œç›´æ¥è°ƒç”¨æ–¹æ³•</span><br><span class="line">Book book= (Book) aClass.newInstance();</span><br><span class="line">// book.setName(&#x27;xxx&#x27;); or book.getName(); or more...</span><br><span class="line"></span><br><span class="line">//æ–¹æ³•äºŒï¼šä½¿ç”¨invokeè°ƒç”¨æŒ‡å®šå®ä¾‹açš„æŒ‡å®šæ–¹æ³•b</span><br><span class="line">Method method3 = aClass.getMethod(&quot;toString&quot;, String.class);</span><br><span class="line">//è¿™é‡Œçš„bookå¯ä»¥æ˜¯å·²å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œæˆ–è€…ä½¿ç”¨ aClass.newInstance() ä¼ å…¥ï¼Œè¯¦è§ç®€å†™ï¼š</span><br><span class="line">String result3 = (String) method3.invoke(book, &quot;è¿™æœ¬ä¹¦æ˜¯æˆ‘çš„ä¼™ä¼´ï¼&quot;);</span><br><span class="line"></span><br><span class="line">ç®€å†™ï¼š</span><br><span class="line">aClass.getMethod(&quot;toString&quot;, String.class).invoke(aClass.newInstance(), &quot;xxx&quot;);</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯ç±»ä¼¼äºå·¥å…·ç±»å¯ç”¨äºå…¨éƒ¨ç±»è®¿é—®çš„ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½newInstanceã€‚</p>
<p>å¦å¤–ï¼Œæ–¹æ³•ä¸€é€‚ç”¨äºéœ€è¦æ˜ å°„çš„ç±»æ˜¯å·²çŸ¥æˆ–å°‘æ•°æ—¶ï¼Œåä¹‹éœ€è¦ç»Ÿä¸€æŒ‰æŒ‡å®šå­—ç¬¦ä¸²åå°„è°ƒç”¨æ–¹æ³•çš„è¯ï¼Œéœ€ä½¿ç”¨æ–¹æ³•äºŒã€‚</p>
<p>â˜ï¸é€šè¿‡åå°„æ–¹å¼è®¿é—®ç§æœ‰æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.junit.demo;</span><br><span class="line"></span><br><span class="line">public class Netbar &#123;</span><br><span class="line">    private Double random = Math.random();</span><br><span class="line"></span><br><span class="line">    public Double getRandom() &#123;</span><br><span class="line">        return random;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Netbar createNew() &#123;</span><br><span class="line">        return new Netbar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static Netbar getInstance() &#123;</span><br><span class="line">        return new Netbar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Netbar netbar = new Netbar();</span><br><span class="line">        System.out.println(&quot;Random:: &quot; + netbar.getRandom());</span><br><span class="line">        Netbar netbar2 = netbar.createNew();</span><br><span class="line">        System.out.println(&quot;Random2:: &quot; + netbar2.getRandom());</span><br><span class="line">        Netbar netbar3 = Netbar.getInstance();</span><br><span class="line">        System.out.println(&quot;Random3:: &quot; + netbar3.getRandom());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åå°„æ–¹å¼è®¿é—®ç§æœ‰éé™æ€æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">    Class aClass = Class.forName(&quot;com.junit.demo.Netbar&quot;);</span><br><span class="line">    Method method = aClass.getDeclaredMethod(&quot;createNew&quot;);//è¿™é‡Œå¯ä»¥å¸¦å‚æ•°</span><br><span class="line">    method.setAccessible(true);//å¯¹æ‰€æœ‰å±æ€§è®¾ç½®è®¿é—®æƒé™  å½“ç±»ä¸­çš„æˆå‘˜å˜é‡ä¸ºprivateæ—¶ å¿…é¡»è®¾ç½®æ­¤é¡¹</span><br><span class="line">    Netbar netbar = (Netbar) method.invoke(aClass.newInstance()); //ä¼ å…¥å¯¹è±¡</span><br><span class="line">    System.out.println(&quot;Random2:: &quot; + netbar.getRandom());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åå°„æ–¹å¼è®¿é—®ç§æœ‰é™æ€æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">    Class aClass = Class.forName(&quot;com.junit.demo.Netbar&quot;);</span><br><span class="line">    Method method = aClass.getDeclaredMethod(&quot;getInstance&quot;);//è¿™é‡Œå¯ä»¥å¸¦å‚æ•°</span><br><span class="line">    method.setAccessible(true);//å¯¹æ‰€æœ‰å±æ€§è®¾ç½®è®¿é—®æƒé™  å½“ç±»ä¸­çš„æˆå‘˜å˜é‡ä¸ºprivateæ—¶ å¿…é¡»è®¾ç½®æ­¤é¡¹</span><br><span class="line">    Netbar netbar = (Netbar) method.invoke(null);  //é™æ€æ–¹æ³•å¯ä»¥ä¼ å…¥null</span><br><span class="line">    System.out.println(&quot;Random2:: &quot; + netbar.getRandom());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼šJavaä¹‹Class.forNameæ–¹æ³•è¯¦è§£ï¼š<br><a href="https://blog.csdn.net/qq_26599807/article/details/118900090">https://blog.csdn.net/qq_26599807/article/details/118900090</a></p>
<h3 id="å¯¹è±¡æ‹·è´"><a href="#å¯¹è±¡æ‹·è´" class="headerlink" title="å¯¹è±¡æ‹·è´"></a>å¯¹è±¡æ‹·è´</h3><p>é¦–å…ˆï¼Œæµ…æ‹·è´å’Œæ·±æ‹·è´éƒ½æ˜¯é’ˆå¯¹ä¸€ä¸ªå·²æœ‰å¯¹è±¡çš„æ“ä½œã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œé™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå…ƒç±»å‹ï¼‰ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨ ç±»çš„å®ä¾‹å¯¹è±¡ï¼ˆå¼•ç”¨æ•°æ®ç±»å‹ï¼‰ã€‚è€Œä¸€èˆ¬ä½¿ç”¨ ã€ &#x3D; ã€å·åšèµ‹å€¼æ“ä½œçš„æ—¶å€™ã€‚å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå®é™…ä¸Šæ˜¯æ‹·è´çš„å®ƒçš„å€¼ï¼Œä½†æ˜¯å¯¹äºå¯¹è±¡è€Œè¨€ï¼Œå…¶å®èµ‹å€¼çš„åªæ˜¯è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå°†åŸå¯¹è±¡çš„å¼•ç”¨ä¼ é€’è¿‡å»ï¼Œä»–ä»¬å®é™…ä¸Šè¿˜æ˜¯æŒ‡å‘çš„åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test3() &#123;</span><br><span class="line">    // 1.ç›´æ¥</span><br><span class="line">    Student stu1 = new Student();</span><br><span class="line">    stu1.setNumber(12345);</span><br><span class="line">    Student stu2 = stu1;</span><br><span class="line">    stu2.setNumber(54321);</span><br><span class="line">    System.out.println(&quot;å­¦ç”Ÿ1:&quot; + stu1.getNumber());</span><br><span class="line">    System.out.println(&quot;å­¦ç”Ÿ2:&quot; + stu2.getNumber());  //æ”¹2ï¼Œ1è·Ÿç€ä¹Ÿæ”¹äº†</span><br><span class="line">    //åŸå› å‡ºåœ¨(stu2 = stu1) è¿™ä¸€å¥ã€‚</span><br><span class="line">    //è¯¥è¯­å¥çš„ä½œç”¨æ˜¯å°†stu1çš„å¼•ç”¨èµ‹å€¼ç»™stu2ã€‚å…¶å®ï¼Œstu1å’Œstu2åœ¨å †å†…å­˜ä¸­æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span><br><span class="line"></span><br><span class="line">    // 2.æ–°å»ºä¸€ä¸ªï¼Œå†set</span><br><span class="line">    Student stu3 = new Student();</span><br><span class="line">    stu3.setNumber(stu1.getNumber());</span><br><span class="line">    stu3.setNumber(111);</span><br><span class="line">    System.out.println(&quot;å­¦ç”Ÿ1:&quot; + stu1.getNumber());</span><br><span class="line">    System.out.println(&quot;å­¦ç”Ÿ3:&quot; + stu3.getNumber());  //æ”¹2ï¼Œ1ä¸ä¼šè·Ÿç€ä¹Ÿæ”¹äº†</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œæµ…æ‹·è´å’Œæ·±æ‹·è´å°±æ˜¯åœ¨è¿™ä¸ªåŸºç¡€ä¹‹ä¸Šåšçš„åŒºåˆ†ï¼Œå¦‚æœåœ¨æ‹·è´è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåªå¯¹åŸºæœ¬æ•°æ®ç±»å‹è¿›è¡Œäº†æ‹·è´ï¼Œè€Œå¯¹å¼•ç”¨æ•°æ®ç±»å‹åªæ˜¯è¿›è¡Œäº†å¼•ç”¨çš„ä¼ é€’ï¼Œè€Œæ²¡æœ‰çœŸå®çš„åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œåˆ™è®¤ä¸ºæ˜¯æµ…æ‹·è´ã€‚åä¹‹ï¼Œåœ¨å¯¹å¼•ç”¨æ•°æ®ç±»å‹è¿›è¡Œæ‹·è´çš„æ—¶å€™ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¤åˆ¶å…¶å†…çš„æˆå‘˜å˜é‡ï¼Œåˆ™è®¤ä¸ºæ˜¯æ·±æ‹·è´ã€‚</p>
<p>æ‰€è°“çš„æµ…æ‹·è´å’Œæ·±æ‹·è´ï¼Œåªæ˜¯åœ¨æ‹·è´å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹ ç±»çš„å®ä¾‹å¯¹è±¡ è¿™ç§å¼•ç”¨æ•°æ®ç±»å‹çš„ä¸åŒæ“ä½œè€Œå·²ã€‚</p>
<p>æ€»ç»“æ¥è¯´ï¼š</p>
<p>1ã€æµ…æ‹·è´ï¼šå¯¹åŸºæœ¬æ•°æ®ç±»å‹è¿›è¡Œå€¼ä¼ é€’ï¼Œå¯¹å¼•ç”¨æ•°æ®ç±»å‹è¿›è¡Œå¼•ç”¨ä¼ é€’èˆ¬çš„æ‹·è´ï¼Œæ­¤ä¸ºæµ…æ‹·è´ã€‚</p>
<p>2ã€æ·±æ‹·è´ï¼šå¯¹åŸºæœ¬æ•°æ®ç±»å‹è¿›è¡Œå€¼ä¼ é€’ï¼Œå¯¹å¼•ç”¨æ•°æ®ç±»å‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å¤åˆ¶å…¶å†…å®¹ï¼Œæ­¤ä¸ºæ·±æ‹·è´ã€‚</p>
<p>Object ä¸Šçš„ clone() æ–¹æ³•<br>åœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„ Class éƒ½ç»§æ‰¿è‡ª Object ï¼Œè€Œåœ¨ Object ä¸Šï¼Œå­˜åœ¨ä¸€ä¸ª clone() æ–¹æ³•ï¼Œå®ƒè¢«å£°æ˜ä¸ºäº† protected ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å…¶å­ç±»ä¸­ï¼Œä½¿ç”¨å®ƒã€‚<br>è€Œæ— è®ºæ˜¯æµ…æ‹·è´è¿˜æ˜¯æ·±æ‹·è´ï¼Œéƒ½éœ€è¦å®ç° clone() æ–¹æ³•ï¼Œæ¥å®Œæˆæ“ä½œã€‚</p>
<p>è¢«å¤åˆ¶çš„ç±»éœ€è¦å®ç°Clonenableæ¥å£ï¼ˆä¸å®ç°çš„è¯åœ¨è°ƒç”¨cloneæ–¹æ³•ä¼šæŠ›å‡ºCloneNotSupportedExceptionå¼‚å¸¸) è¯¥æ¥å£ä¸ºæ ‡è®°æ¥å£(ä¸å«ä»»ä½•æ–¹æ³•)<br>è¦†ç›–clone()æ–¹æ³•ï¼Œè®¿é—®ä¿®é¥°ç¬¦è®¾ä¸ºpublicã€‚æ–¹æ³•ä¸­è°ƒç”¨super.clone()æ–¹æ³•å¾—åˆ°éœ€è¦çš„å¤åˆ¶å¯¹è±¡ï¼ˆnativeä¸ºæœ¬åœ°æ–¹æ³•)</p>
<hr>
<p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/hongshi/p/16189920.html">https://www.cnblogs.com/hongshi/p/16189920.html</a></p>
<h4 id="âœ…æµ…æ‹·è´"><a href="#âœ…æµ…æ‹·è´" class="headerlink" title="âœ…æµ…æ‹·è´"></a>âœ…æµ…æ‹·è´</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test4() &#123;</span><br><span class="line">    // 1.æµ…æ‹·è´</span><br><span class="line">    Student stu1 = new Student();</span><br><span class="line">    stu1.setNumber(1);</span><br><span class="line">    stu1.setName(&quot;ll&quot;);</span><br><span class="line">    stu1.setTeacher(new Teacher(23));</span><br><span class="line">    Student stu2 = (Student)stu1.clone();</span><br><span class="line">    stu2.setNumber(2);</span><br><span class="line">    stu2.setName(&quot;oo&quot;);</span><br><span class="line">    //stu2.setTeacher(new Teacher(24)); //æ–°å»ºä¸å¯¹</span><br><span class="line">    stu2.getTeacher().setAge(24);</span><br><span class="line">    System.out.println(&quot;å­¦ç”Ÿ1:&quot; + stu1 + &quot; hashCode:&quot; + stu1.hashCode());</span><br><span class="line">    //ClassTest.Student(number=1, name=ll, teacher=ClassTest.Teacher(age=24)) hashCode:1407343478</span><br><span class="line">    System.out.println(&quot;å­¦ç”Ÿ2:&quot; + stu2 + &quot; hashCode:&quot; + stu2.hashCode());</span><br><span class="line">    //ClassTest.Student(number=2, name=oo, teacher=ClassTest.Teacher(age=24)) hashCode:1940447180</span><br><span class="line">    System.out.println(&quot;teacherçš„hashCodeï¼š&quot; + stu1.getTeacher().hashCode() + &quot; &quot; + stu2.getTeacher().hashCode());</span><br><span class="line">    //teacherçš„hashCodeï¼š83 83</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@ToString</span><br><span class="line">static class Student implements Cloneable &#123;</span><br><span class="line">    private int number;</span><br><span class="line">    private String name;</span><br><span class="line">    private Teacher teacher;</span><br><span class="line">    public int getNumber() &#123;</span><br><span class="line">        return number;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setNumber(int number) &#123;</span><br><span class="line">        this.number = number;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setTeacher(Teacher teacher) &#123;</span><br><span class="line">        this.teacher = teacher;</span><br><span class="line">    &#125;</span><br><span class="line">    public Teacher getTeacher() &#123;return teacher;&#125;</span><br><span class="line">    //æµ…æ‹·è´</span><br><span class="line">    @Override</span><br><span class="line">    public Object clone() &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            return super.clone();</span><br><span class="line">        &#125;catch(CloneNotSupportedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">class Teacher &#123;</span><br><span class="line">    private Integer age;</span><br><span class="line">    Teacher(Integer age) &#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°é‡Œé¢çš„Teacherå¯¹è±¡ï¼Œå®é™…ä¸Šè¿˜æ˜¯æŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œåªå¯¹å¯¹å®ƒçš„å¼•ç”¨è¿›è¡Œäº†ä¼ é€’ã€‚</p>
<p>æ³¨æ„âš ï¸ï¼šStringä½œä¸ºä¸å¯æ›´æ”¹çš„ç±»ï¼ˆimmutable classï¼‰ï¼Œåœ¨newèµ‹å€¼çš„æ—¶å€™ï¼Œå°±å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼›è¡¨ç°å‡ºæ¥çš„æ˜¯æ·±æ‹·è´ï¼ˆå’ŒåŸºæœ¬æ•°æ®ç±»å‹ä¸€æ ·ï¼‰ã€‚</p>
<h4 id="âœ…æ·±æ‹·è´"><a href="#âœ…æ·±æ‹·è´" class="headerlink" title="âœ…æ·±æ‹·è´"></a>âœ…æ·±æ‹·è´</h4><p>ä¸¤ç§æ–¹æ³•ï¼š<br>1ã€åºåˆ—åŒ–ï¼ˆserializationï¼‰è¿™ä¸ªå¯¹è±¡ï¼Œå†ååºåˆ—åŒ–å›æ¥ï¼Œå°±å¯ä»¥å¾—åˆ°è¿™ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ— éå°±æ˜¯åºåˆ—åŒ–çš„è§„åˆ™éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥å†™ã€‚<br>2ã€ç»§ç»­åˆ©ç”¨ clone() æ–¹æ³•ï¼Œæ—¢ç„¶ clone() æ–¹æ³•ï¼Œæ˜¯æˆ‘ä»¬æ¥é‡å†™çš„ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å¯¹å…¶å†…çš„å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œå†è¿›è¡Œä¸€æ¬¡ clone()ã€‚ä¹Ÿå°±æ˜¯è®©Teacherç±»ä¹Ÿå®ç°Cloneableæ¥å£ï¼Œé‡å†™cloneæ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test4() &#123;</span><br><span class="line">    // 1.æµ…æ‹·è´</span><br><span class="line">    Student stu1 = new Student();</span><br><span class="line">    stu1.setNumber(1);</span><br><span class="line">    stu1.setName(&quot;ll&quot;);</span><br><span class="line">    stu1.setTeacher(new Teacher(23));</span><br><span class="line">    Student stu2 = (Student)stu1.clone();</span><br><span class="line">    stu2.setNumber(2);</span><br><span class="line">    stu2.setName(&quot;oo&quot;);</span><br><span class="line">    //stu2.setTeacher(new Teacher(24)); //æ–°å»ºä¸å¯¹</span><br><span class="line">    stu2.getTeacher().setAge(24);</span><br><span class="line">    System.out.println(&quot;å­¦ç”Ÿ1:&quot; + stu1 + &quot; hashCode:&quot; + stu1.hashCode());</span><br><span class="line">    System.out.println(&quot;å­¦ç”Ÿ2:&quot; + stu2 + &quot; hashCode:&quot; + stu2.hashCode());</span><br><span class="line">    System.out.println(&quot;teacherçš„hashCodeï¼š&quot; + stu1.getTeacher().hashCode() + &quot; &quot; + stu2.getTeacher().hashCode());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@ToString</span><br><span class="line">static class Student implements Cloneable &#123;</span><br><span class="line">    private int number;</span><br><span class="line">    private String name;</span><br><span class="line">    private Teacher teacher;</span><br><span class="line">    public int getNumber() &#123;</span><br><span class="line">        return number;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setNumber(int number) &#123;</span><br><span class="line">        this.number = number;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setTeacher(Teacher teacher) &#123;</span><br><span class="line">        this.teacher = teacher;</span><br><span class="line">    &#125;</span><br><span class="line">    public Teacher getTeacher() &#123;return teacher;&#125;</span><br><span class="line">//        //æµ…æ‹·è´</span><br><span class="line">//        @Override</span><br><span class="line">//        public Object clone() &#123;</span><br><span class="line">//            try&#123;</span><br><span class="line">//                return super.clone();</span><br><span class="line">//            &#125;catch(CloneNotSupportedException e) &#123;</span><br><span class="line">//                e.printStackTrace();</span><br><span class="line">//            &#125;</span><br><span class="line">//            return null;</span><br><span class="line">//        &#125;</span><br><span class="line">    //æ·±æ‹·è´</span><br><span class="line">    @Override</span><br><span class="line">    public Object clone() &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            Student stu = (Student)super.clone();</span><br><span class="line">            stu.setTeacher((Teacher)this.teacher.clone());</span><br><span class="line">            return stu;</span><br><span class="line"></span><br><span class="line">        &#125; catch (CloneNotSupportedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">class Teacher implements Cloneable&#123;</span><br><span class="line">    private Integer age;</span><br><span class="line">    Teacher(Integer age) &#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Object clone() &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            return super.clone();</span><br><span class="line">        &#125;catch(CloneNotSupportedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BeanUtils-copyProperties"><a href="#BeanUtils-copyProperties" class="headerlink" title="BeanUtils.copyProperties"></a>BeanUtils.copyProperties</h4><p><code>BeanUtils.copyPropertiesï¼ˆsource,targetï¼‰</code>æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç”¨äºå°†äº‹ä»¶æºçš„æ•°æ®æ‹·è´åˆ°ç›®æ ‡æºä¸­ã€‚BeanUtilsæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯springçš„ï¼Œä¸€ä¸ªæ˜¯apacheçš„commonsä¸‹çš„ã€‚ç”¨æ³•ä¸€æ ·ï¼Œä½†æ˜¯ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼šä¸€ä¸ªæ˜¯å°†å‰è€…æ‹·è´ç»™åè€…ï¼Œå¦ä¸€ä¸ªæ˜¯å°†åè€…æ‹·è´ç»™å‰é¢çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Student studentOne  = new StudentOne(&quot;å¼ ä¸‰&quot;);</span><br><span class="line">Student studentTwo  = new StudentOne();  //å…ˆæ–°å»ºä¸€ä¸ªè¦æ‹·è´å‡ºæ¥çš„å¯¹è±¡</span><br><span class="line">//BeanUtils.copyPropertiesæ˜¯å°†studentOneçš„æ•°æ®æ‹·è´ç»™studentTwo</span><br><span class="line">BeanUtils.copyProperties(studentOne, studentTwo);</span><br><span class="line">//springçš„ç¬¬ä¸€ä¸ªæ˜¯è¾“å…¥ï¼Œç¬¬äºŒä¸ªè°è¾“å‡º</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸¤ä¸ªç±»ä¸ä¸€æ ·æ—¶ï¼Œåªä¼šæ‹·è´å±æ€§ä¸€æ ·çš„å†…å®¹ã€‚<br>ä½¿ç”¨åœºæ™¯ï¼šå¼€å‘ä¸­ç»å¸¸é‡åˆ°ï¼ŒæŠŠçˆ¶ç±»çš„å±æ€§æ‹·è´åˆ°å­ç±»ä¸­ã€‚<br>BeanUtilsæ˜¯æµ…æ‹·è´ã€‚æµ…æ‹·è´ï¼šå¼•ç”¨çš„ä¸€ä¸ªå†…å­˜åœ°å€)ã€‚</p>
<p>é€šå¸¸ç”¨äºè½¬æ¢å™¨Convertorï¼Œç”¨æ¥è½¬æ¢ä¸€ä¸ªç±»çš„å¯¹è±¡ä¸ºå¦ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œé‡å†™é‡Œé¢çš„convertæ–¹æ³•æ¥ç”¨ã€‚</p>
<h3 id="hashcode"><a href="#hashcode" class="headerlink" title="hashcode"></a>hashcode</h3><h4 id="hashcode-1"><a href="#hashcode-1" class="headerlink" title="hashcode"></a>hashcode</h4><p>1ã€hashå’Œhashè¡¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>hashæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸­çš„å®ç°å°±æ˜¯ä¸€ç§ç®—æ³•ï¼Œå°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ç®—æ³•æ¥å¾—åˆ°ä¸€ä¸ªhashå€¼ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦çŸ¥é“å¦ä¸€ä¸ªä¸œè¥¿ï¼Œhashè¡¨ï¼Œé€šè¿‡hashç®—æ³•å¾—åˆ°çš„hashå€¼å°±åœ¨è¿™å¼ hashè¡¨ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œhashè¡¨å°±æ˜¯æ‰€æœ‰çš„hashå€¼ç»„æˆçš„ï¼Œæœ‰å¾ˆå¤šç§hashå‡½æ•°ï¼Œä¹Ÿå°±ä»£è¡¨ç€æœ‰å¾ˆå¤šç§ç®—æ³•å¾—åˆ°hashå€¼ã€‚</p>
</blockquote>
<p>2ã€hashcodeã€€</p>
<blockquote>
<p>hashcodeå°±æ˜¯é€šè¿‡hashå‡½æ•°å¾—æ¥çš„ï¼Œé€šä¿—çš„è¯´ï¼Œå°±æ˜¯é€šè¿‡æŸä¸€ç§ç®—æ³•å¾—åˆ°çš„ï¼Œhashcodeå°±æ˜¯åœ¨hashè¡¨ä¸­æœ‰å¯¹åº”çš„ä½ç½®ã€‚<br>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰hashcodeï¼Œå¯¹è±¡çš„hashcodeæ€ä¹ˆå¾—æ¥çš„å‘¢ï¼Ÿ<br>é¦–å…ˆä¸€ä¸ªå¯¹è±¡è‚¯å®šæœ‰ç‰©ç†åœ°å€ï¼Œåœ¨åˆ«çš„åšæ–‡ä¸­ä¼šhashcodeè¯´æˆæ˜¯ä»£è¡¨å¯¹è±¡çš„åœ°å€ï¼Œè¿™é‡Œè‚¯å®šä¼šè®©è¯»è€…å½¢æˆè¯¯åŒºï¼Œå¯¹è±¡çš„ç‰©ç†åœ°å€è·Ÿè¿™ä¸ªhashcodeåœ°å€ä¸ä¸€æ ·ï¼Œhashcodeä»£è¡¨å¯¹è±¡çš„åœ°å€è¯´çš„æ˜¯å¯¹è±¡åœ¨hashè¡¨ä¸­çš„ä½ç½®ï¼Œç‰©ç†åœ°å€è¯´çš„å¯¹è±¡å­˜æ”¾åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œé‚£ä¹ˆå¯¹è±¡å¦‚ä½•å¾—åˆ°hashcodeå‘¢ï¼Ÿ<br>é€šè¿‡å¯¹è±¡çš„å†…éƒ¨åœ°å€(ä¹Ÿå°±æ˜¯ç‰©ç†åœ°å€)è½¬æ¢æˆä¸€ä¸ªæ•´æ•°ï¼Œç„¶åè¯¥æ•´æ•°é€šè¿‡hashå‡½æ•°çš„ç®—æ³•å°±å¾—åˆ°äº†hashcodeã€‚æ‰€ä»¥ï¼Œhashcodeæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯åœ¨hashè¡¨ä¸­å¯¹åº”çš„ä½ç½®ã€‚</p>
</blockquote>
<blockquote>
<p>è¿™é‡Œå¦‚æœè¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šçš„è¯ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œhashè¡¨ä¸­æœ‰ hashcodeä¸º1ã€hashcodeä¸º2ã€(â€¦)3ã€4ã€5ã€6ã€7ã€8è¿™æ ·å…«ä¸ªä½ç½®ï¼Œæœ‰ä¸€ä¸ªå¯¹è±¡Aï¼ŒAçš„ç‰©ç†åœ°å€è½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°17(è¿™æ˜¯å‡å¦‚)ï¼Œå°±é€šè¿‡ç›´æ¥å–ä½™ç®—æ³•ï¼Œ17%8&#x3D;1ï¼Œé‚£ä¹ˆAçš„hashcodeå°±ä¸º1ï¼Œä¸”Aå°±åœ¨hashè¡¨ä¸­1çš„ä½ç½®ã€‚</p>
</blockquote>
<p>3ã€hashcodeæœ‰ä»€ä¹ˆä½œç”¨</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆhashcodeä¸ç›´æ¥å†™ç‰©ç†åœ°å€å‘¢ï¼Œè¿˜è¦å¦å¤–ç”¨ä¸€å¼ hashè¡¨æ¥ä»£è¡¨å¯¹è±¡çš„åœ°å€ï¼Ÿ<br>HashCodeçš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†æŸ¥æ‰¾çš„å¿«æ·æ€§ï¼ŒHashCodeæ˜¯ç”¨æ¥åœ¨æ•£åˆ—å­˜å‚¨ç»“æ„ä¸­ç¡®å®šå¯¹è±¡çš„å­˜å‚¨åœ°å€çš„(ååŠå¥è¯´çš„ç”¨hashcodeæ¥ä»£è¡¨å¯¹è±¡å°±æ˜¯åœ¨hashè¡¨ä¸­çš„ä½ç½®)<br>ä¸ºä»€ä¹ˆhashcodeå°±æŸ¥æ‰¾çš„æ›´å¿«ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªèƒ½å­˜æ”¾1000ä¸ªæ•°è¿™æ ·å¤§çš„å†…å­˜ä¸­ï¼Œåœ¨å…¶ä¸­è¦å­˜æ”¾1000ä¸ªä¸ä¸€æ ·çš„æ•°å­—ï¼Œç”¨æœ€ç¬¨çš„æ–¹æ³•ï¼Œå°±æ˜¯å­˜ä¸€ä¸ªæ•°å­—ï¼Œå°±éå†ä¸€éï¼Œçœ‹æœ‰æ²¡æœ‰ç›¸åŒå¾—æ•°ï¼Œå½“å­˜äº†900ä¸ªæ•°å­—ï¼Œå¼€å§‹å­˜901ä¸ªæ•°å­—çš„æ—¶å€™ï¼Œå°±éœ€è¦è·Ÿ900ä¸ªæ•°å­—è¿›è¡Œå¯¹æ¯”ï¼Œè¿™æ ·å°±å¾ˆéº»çƒ¦ï¼Œå¾ˆæ˜¯æ¶ˆè€—æ—¶é—´ï¼Œç”¨hashcodeæ¥è®°å½•å¯¹è±¡çš„ä½ç½®ï¼Œæ¥çœ‹ä¸€ä¸‹ã€‚<br>hashè¡¨ä¸­æœ‰1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ä¸ªä½ç½®ï¼Œå­˜ç¬¬ä¸€ä¸ªæ•°ï¼Œhashcodeä¸º1ï¼Œè¯¥æ•°å°±æ”¾åœ¨hashè¡¨ä¸­1çš„ä½ç½®ï¼Œå­˜åˆ°100ä¸ªæ•°å­—ï¼Œhashè¡¨ä¸­8ä¸ªä½ç½®ä¼šæœ‰å¾ˆå¤šæ•°å­—äº†ï¼Œ1ä¸­å¯èƒ½æœ‰20ä¸ªæ•°å­—ï¼Œå­˜101ä¸ªæ•°å­—æ—¶ï¼Œä»–å…ˆæŸ¥hashcodeå€¼å¯¹åº”çš„ä½ç½®ï¼Œå‡è®¾ä¸º1ï¼Œé‚£ä¹ˆå°±æœ‰20ä¸ªæ•°å­—å’Œä»–çš„hashcodeç›¸åŒï¼Œä»–åªéœ€è¦è·Ÿè¿™20ä¸ªæ•°å­—ç›¸æ¯”è¾ƒ(equals)ï¼Œå¦‚æœæ²¡ä¸€ä¸ªç›¸åŒï¼Œé‚£ä¹ˆå°±æ”¾åœ¨1è¿™ä¸ªä½ç½®ï¼Œè¿™æ ·æ¯”è¾ƒçš„æ¬¡æ•°å°±å°‘äº†å¾ˆå¤šï¼Œå®é™…ä¸Šhashè¡¨ä¸­æœ‰å¾ˆå¤šä½ç½®ï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¾‹åªæœ‰8ä¸ªï¼Œæ‰€ä»¥æ¯”è¾ƒçš„æ¬¡æ•°ä¼šè®©ä½ è§‰å¾—ä¹ŸæŒºå¤šçš„ï¼Œå®é™…ä¸Šï¼Œå¦‚æœhashè¡¨å¾ˆå¤§ï¼Œé‚£ä¹ˆæ¯”è¾ƒçš„æ¬¡æ•°å°±å¾ˆå°‘å¾ˆå°‘äº†ã€‚<br>é€šè¿‡å¯¹åŸå§‹æ–¹æ³•å’Œä½¿ç”¨hashcodeæ–¹æ³•è¿›è¡Œå¯¹æ¯”ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†hashcodeçš„ä½œç”¨ï¼Œå¹¶ä¸”ä¸ºä»€ä¹ˆè¦ä½¿ç”¨hashcodeäº†</p>
</blockquote>
<p>4ã€equalsæ–¹æ³•å’Œhashcodeçš„å…³ç³»</p>
<blockquote>
<p>é€šè¿‡å‰é¢è¿™ä¸ªä¾‹å­ï¼Œå¤§æ¦‚å¯ä»¥çŸ¥é“ï¼Œå…ˆé€šè¿‡hashcodeæ¥æ¯”è¾ƒï¼Œå¦‚æœhashcodeç›¸ç­‰ï¼Œé‚£ä¹ˆå°±ç”¨equalsæ–¹æ³•æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚</p>
</blockquote>
<blockquote>
<p>ç”¨ä¸ªä¾‹å­è¯´æ˜ï¼šä¸Šé¢è¯´çš„hashè¡¨ä¸­çš„8ä¸ªä½ç½®ï¼Œå°±å¥½æ¯”8ä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶é‡Œèƒ½è£…å¾ˆå¤šçš„å¯¹è±¡ï¼Œå¯¹è±¡Aé€šè¿‡hashå‡½æ•°ç®—æ³•å¾—åˆ°å°†å®ƒæ”¾åˆ°1å·æ¡¶ä¸­ï¼Œå½“ç„¶è‚¯å®šæœ‰åˆ«çš„å¯¹è±¡ä¹Ÿä¼šæ”¾åˆ°1å·æ¡¶ä¸­ï¼Œå¦‚æœå¯¹è±¡Bä¹Ÿé€šè¿‡ç®—æ³•åˆ†åˆ°äº†1å·æ¡¶ï¼Œé‚£ä¹ˆå®ƒå¦‚ä½•è¯†åˆ«æ¡¶ä¸­å…¶ä»–å¯¹è±¡æ˜¯å¦å’Œå®ƒä¸€æ ·å‘¢ï¼Œè¿™æ—¶å€™å°±éœ€è¦equalsæ–¹æ³•æ¥è¿›è¡Œç­›é€‰äº†ã€‚</p>
</blockquote>
<blockquote>
<p>1ã€å¦‚æœä¸¤ä¸ªå¯¹è±¡equalsç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡çš„HashCodeä¸€å®šä¹Ÿç›¸åŒ<br>2ã€å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„HashCodeç›¸åŒï¼Œä¸ä»£è¡¨ä¸¤ä¸ªå¯¹è±¡å°±ç›¸åŒï¼Œåªèƒ½è¯´æ˜è¿™ä¸¤ä¸ªå¯¹è±¡åœ¨æ•£åˆ—å­˜å‚¨ç»“æ„ä¸­ï¼Œå­˜æ”¾äºåŒä¸€ä¸ªä½ç½®</p>
</blockquote>
<p>5ã€ä¸ºä»€ä¹ˆequalsæ–¹æ³•é‡å†™çš„è¯ï¼Œå»ºè®®ä¹Ÿä¸€èµ·é‡å†™hashcodeæ–¹æ³•</p>
<blockquote>
<p>æ¯”å¦‚ï¼šæœ‰ä¸ªAç±»é‡å†™äº†equalsæ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰é‡å†™hashCodeæ–¹æ³•ï¼Œçœ‹è¾“å‡ºç»“æœï¼Œå¯¹è±¡a1å’Œå¯¹è±¡a2ä½¿ç”¨equalsæ–¹æ³•ç›¸ç­‰ï¼ŒæŒ‰ç…§ä¸Šé¢çš„hashcodeçš„ç”¨æ³•ï¼Œé‚£ä¹ˆä»–ä»¬ä¸¤ä¸ªçš„hashcodeè‚¯å®šç›¸ç­‰ï¼Œä½†æ˜¯è¿™é‡Œç”±äºæ²¡é‡å†™hashcodeæ–¹æ³•ï¼Œä»–ä»¬ä¸¤ä¸ªhashcodeå¹¶ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨é‡å†™äº†equalsæ–¹æ³•åï¼Œå°½é‡ä¹Ÿé‡å†™äº†hashcodeæ–¹æ³•ï¼Œé€šè¿‡ä¸€å®šçš„ç®—æ³•ï¼Œä½¿ä»–ä»¬åœ¨equalsç›¸ç­‰æ—¶ï¼Œä¹Ÿä¼šæœ‰ç›¸åŒçš„hashcodeå€¼ã€‚</p>
</blockquote>
<p>Integerçš„é‡å†™æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public boolean equals(Object obj) &#123;</span><br><span class="line">    if (obj instanceof Integer) &#123;</span><br><span class="line">        return value == ((Integer)obj).intValue();</span><br><span class="line">    &#125;  // å˜æˆæ¯”è¾ƒIntegerå†…éƒ¨çš„final intå¸¸é‡çš„å€¼æ˜¯å¦ç›¸ç­‰</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//hashCodeæ–¹æ³•ä¹Ÿæ˜¯ç”¨çš„å€¼</span><br><span class="line">@Override</span><br><span class="line">public int hashCode() &#123;</span><br><span class="line">    return Integer.hashCode(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static int hashCode(int value) &#123;</span><br><span class="line">    return value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hashCodeæ˜¯ç”¨äºæŸ¥æ‰¾ä½¿ç”¨çš„ï¼Œè€Œ equalsæ˜¯ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„æ˜¯å¦ç›¸ç­‰çš„ã€‚hashCodeçš„å­˜åœ¨ä¸»è¦æ˜¯ç”¨äºæŸ¥æ‰¾çš„å¿«æ·æ€§ï¼Œå¦‚Hashtableï¼ŒHashMapç­‰ï¼ŒhashCodeæ˜¯ç”¨æ¥åœ¨æ•£åˆ—å­˜å‚¨ç»“æ„ä¸­ç¡®å®šå¯¹è±¡çš„å­˜å‚¨åœ°å€çš„.</p>
<p>å¦‚æœå¯¹è±¡çš„equalsæ–¹æ³•è¢«é‡å†™ï¼Œé‚£ä¹ˆå¯¹è±¡çš„hashCodeä¹Ÿå°½é‡é‡å†™ï¼Œå¹¶ä¸”äº§ç”ŸhashCodeä½¿ç”¨çš„å¯¹è±¡ï¼Œä¸€å®šè¦å’Œequalsæ–¹æ³•ä¸­ä½¿ç”¨çš„ä¸€è‡´.</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_44364444/article/details/120054230">https://blog.csdn.net/weixin_44364444/article/details/120054230</a></p>
<h4 id="javaå˜é‡åœ°å€"><a href="#javaå˜é‡åœ°å€" class="headerlink" title="javaå˜é‡åœ°å€"></a>javaå˜é‡åœ°å€</h4><p>javaçš„å˜é‡ä¸èƒ½ç›´æ¥è·å–çœŸå®çš„åœ°å€ï¼Œåªèƒ½ä½¿ç”¨<code>System.out.println(obj.hashcode())</code>è¾“å‡ºçš„æ—¶å¯¹è±¡çš„å“ˆå¸Œç ï¼Œè€Œéå†…å­˜åœ°å€ã€‚</p>
<p>åœ¨Javaä¸­æ˜¯ä¸å¯èƒ½å¾—åˆ°å¯¹è±¡çœŸæ­£çš„å†…å­˜åœ°å€çš„ï¼Œå› ä¸ºJavaä¸­å †æ˜¯ç”±JVMç®¡ç†çš„ä¸èƒ½ç›´æ¥æ“ä½œã€‚åªèƒ½è¯´æ­¤æ—¶æ‰“å°å‡ºçš„Hashç è¡¨ç¤ºäº†è¯¥å¯¹è±¡åœ¨JAVAè™šæ‹Ÿæœºä¸­çš„å†…å­˜ä½ç½®ï¼ŒJavaè™šæ‹Ÿæœºä¼šæ ¹æ®è¯¥hashç æœ€ç»ˆåœ¨çœŸæ­£çš„çš„å †ç©ºé—´ä¸­ç»™è¯¥å¯¹è±¡åˆ†é…ä¸€ä¸ªåœ°å€.</p>
<p>è¦æƒ³å¾—åˆ°å˜é‡åœ¨ç‰©ç†å†…å­˜ä¸­çš„çœŸå®åœ°å­˜ï¼Œé‚£åªæœ‰ç”¨JNIæŠ€æœ¯è°ƒç”¨c&#x2F;c++å»å®ç°ï¼Œå¦åˆ™æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºjavaè¶…ä¸å‡ºJVMï¼Œè€ŒJVMå¯¹ç‰©ç†å†…å­˜åœ°å€æ˜¯â€œä¸å¯è§â€çš„ï¼Œå¦åˆ™javaä¸­ä¸å°±æœ‰äº†æŒ‡é’ˆï¼Œè€Œå»ç›´æ¥æ“ä½œå†…å­˜äº†ï¼Œå½“ç„¶è¿™æ˜¯ä¸javaè¯­è¨€ç›¸è¿èƒŒçš„ã€‚</p>
<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/feng3702592/article/details/126722686">https://blog.csdn.net/feng3702592/article/details/126722686</a></p>
<h4 id="ã€equalsã€hashCode"><a href="#ã€equalsã€hashCode" class="headerlink" title="&#x3D;&#x3D;ã€equalsã€hashCode"></a>&#x3D;&#x3D;ã€equalsã€hashCode</h4><p>1ã€&#x3D;&#x3D;å¯¹äºæ™®é€šå˜é‡æ˜¯å€¼æ¯”è¾ƒï¼Œå¯¹äºåŒ…è£…ç±»å‹å˜é‡ï¼Œæ˜¯å†…å­˜åœ°å€æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯æ¯”è¾ƒæ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p>2ã€åŒ…è£…ç±»å‹é‡å†™äº†equalsæ–¹æ³•ï¼Œå˜æˆäº†å€¼æ¯”è¾ƒã€‚</p>
<p>3ã€hashCodeè¡¨ç¤ºåœ¨hashè¡¨ä¸­çš„ä½ç½®ã€‚equalsä¸€æ ·ï¼Œé‚£ä¹ˆhashCodeä¸€å®šä¸€æ ·ã€‚ï¼ˆåªè¦å€¼æ˜¯ä¸€æ ·çš„ï¼ŒhashCodeå°±ä¼šæ˜¯ç›¸åŒçš„ã€‚ï¼‰<br>åŸå› ï¼šå°½ç®¡ä¸åŒçš„æ•°å€¼ç±»å‹çš„åŒ…è£…ç±»ï¼Œè®¡ç®—hashCodeçš„ç®—æ³•ä¸ä¸€æ ·ï¼Œä½†æ˜¯åº•å±‚éƒ½æ˜¯æ‹¿å¯¹åº”çš„åŸå§‹æ•°æ®ç±»å‹çš„å€¼å»è¿›è¡ŒhashCodeè®¡ç®—ã€‚<br>åè¿‡æ¥ï¼š</p>
<p>4ã€åŒä¸€ä¸ªå¯¹è±¡çš„ï¼ŒhashCodeå€¼ä¸€å®šç›¸åŒï¼Œä½†æ˜¯ hashCodeç›¸åŒï¼Œä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿä¸ä¸€å®šequalsä¸ºtrueã€‚</p>
<p>å…³ç³»ï¼šåŒä¸€ä¸ªå¯¹è±¡ï¼ˆ&#x3D;&#x3D;ï¼‰æœ€å°çš„åœˆï¼Œequalsä¸ºtrueä¸­é—´åœˆï¼ŒhashCodeä¸€æ ·æœ€å¤§åœˆã€‚<code>ï¼ˆequalsè¦çœ‹é‡å†™äº†æ²¡æœ‰ï¼Œä¸é‡å†™å°±æ˜¯==ï¼‰</code></p>
<p>æµ‹è¯•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-24 00:45</span><br><span class="line"> **/</span><br><span class="line">/**</span><br><span class="line"> *hashCodeç›¸åŒï¼Œä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªå¯¹è±¡</span><br><span class="line"> *åŒä¸€ä¸ªå¯¹è±¡çš„ï¼ŒhashCodeå€¼ä¸€å®šç›¸åŒ</span><br><span class="line"> *</span><br><span class="line"> *-------------------------------------------------------------------------------</span><br><span class="line"> *æ™®é€šå¯¹è±¡çš„HashCodeå€¼æºç è§£é‡Šï¼š</span><br><span class="line"> * equalsç›¸åŒåˆ™hashCodeä¸€å®šä¸€æ ·</span><br><span class="line"> *If two objects are equal according to the equals(Object) method, then calling</span><br><span class="line"> *the hashCode method on each of the two objects must produce the same integer result.</span><br><span class="line"> *-------------------------------------------------------------------------------</span><br><span class="line"> *equalsä¸ä¸€æ ·ï¼ŒhashCodeä¸ä¸€å®šä¸ä¸€æ ·</span><br><span class="line"> * It is not required that if two objects are unequal according to the</span><br><span class="line"> *java.lang.Object.equals(java.lang.Object) method, then calling the hashCode</span><br><span class="line"> *method on each of the two objects must produce distinct integer results.</span><br><span class="line"> *-------------------------------------------------------------------------------</span><br><span class="line"> *However, the programmer should be aware that producing distinct integer results</span><br><span class="line"> *for unequal objects may improve the performance of hash tables.</span><br><span class="line"> *-------------------------------------------------------------------------------</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class HashCodeTest &#123;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public HashCodeTest() &#123;</span><br><span class="line">        super();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public HashCodeTest(String name) &#123;</span><br><span class="line">        super();</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(&quot;--------------------æ™®é€šå¯¹è±¡-----------------------&quot;);</span><br><span class="line">        HashCodeTest test3=new HashCodeTest();</span><br><span class="line">        HashCodeTest test4=new HashCodeTest();</span><br><span class="line">        System.out.println(test3.equals(test4));//false(å› ä¸ºæ²¡é‡å†™è¿˜æ˜¯==)</span><br><span class="line">        System.out.println(test3.hashCode() == test4.hashCode());//false</span><br><span class="line"></span><br><span class="line">        HashCodeTest test1=new HashCodeTest(&quot;æˆ‘&quot;);</span><br><span class="line">        HashCodeTest test2=new HashCodeTest(&quot;æˆ‘&quot;);</span><br><span class="line">        System.out.println(test1.equals(test2));//false(å› ä¸ºæ²¡é‡å†™è¿˜æ˜¯==)</span><br><span class="line">        System.out.println(test1.hashCode() == test2.hashCode());//false</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;--------------------String-----------------------&quot;);</span><br><span class="line">        String s1=&quot;abc&quot;;</span><br><span class="line">        String s2=&quot;abc&quot;;</span><br><span class="line">        System.out.println(s1.equals(s2));//true(å› ä¸ºé‡å†™å˜å€¼æ¯”è¾ƒ)</span><br><span class="line">        System.out.println(s1.hashCode() == s2.hashCode());//true</span><br><span class="line">        System.out.println(s1==s2); //true(æ˜¯ä¸€ä¸ªå¯¹è±¡)</span><br><span class="line"></span><br><span class="line">        String s5=new String(&quot;abc&quot;);</span><br><span class="line">        String s6=new String(&quot;abc&quot;);</span><br><span class="line">        System.out.println(s5.equals(s6));//true(å› ä¸ºé‡å†™å˜å€¼æ¯”è¾ƒ)</span><br><span class="line">        System.out.println(s5.hashCode() == s6.hashCode());//true</span><br><span class="line">        System.out.println(s5==s6); //false(ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String s3=new String();</span><br><span class="line">        String s4=new String();</span><br><span class="line">        System.out.println(s3.hashCode());//0</span><br><span class="line">        System.out.println(s4.hashCode());//0</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * æ•°å€¼å‹åŸå§‹ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»(Byte,Short,Integer,Float,Double)ï¼ŒhashCodeç®—æ³•éƒ½æ˜¯åŸºäº</span><br><span class="line">         * å¯¹åº”çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥åªè¦åŒ…è£…ç±»çš„æ•°å€¼ç›¸åŒï¼Œé‚£ä¹ˆhashCodeå¿…ç„¶ç›¸åŒ</span><br><span class="line">         *</span><br><span class="line">         * Doubleç±»å…³äºhashCodeæºç è¯´æ˜ï¼š</span><br><span class="line">         * Doubleç±»çš„hashCodeæ˜¯æ ¹æ®å¯¹åº”çš„doubleå€¼è®¡ç®—è·å¾—çš„ã€‚</span><br><span class="line">         *</span><br><span class="line">         * Returns a hash code for a &#123;@code double&#125; value; compatible with</span><br><span class="line">         * &#123;@code Double.hashCode()&#125;.</span><br><span class="line">         *</span><br><span class="line">         * @param value the value to hash</span><br><span class="line">         * @return a hash code value for a &#123;@code double&#125; value.</span><br><span class="line">         * @since 1.8</span><br><span class="line">         */</span><br><span class="line">        /*Doubleç±»å…³äºhashCodeæºç ï¼š</span><br><span class="line">         * public static int hashCode(double value) &#123;</span><br><span class="line">            long bits = doubleToLongBits(value);</span><br><span class="line">            return (int)(bits ^ (bits &gt;&gt;&gt; 32));</span><br><span class="line">        &#125;*/</span><br><span class="line">        System.out.println(&quot;--------------------åŸå§‹ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»-----------------------&quot;);</span><br><span class="line">        Double d1=5.0;</span><br><span class="line">        Double d2=5.0;</span><br><span class="line">        System.out.println(d1.equals(d2));//true(å› ä¸ºé‡å†™å˜å€¼æ¯”è¾ƒ)</span><br><span class="line">        System.out.println(d1.hashCode() == d2.hashCode());//true</span><br><span class="line">        System.out.println(d1==d2);//false (ï¼Ÿï¼Ÿï¼Ÿä¸ºå•¥æ˜¯falseï¼Œå’ŒStringä¸ä¸€æ ·)</span><br><span class="line"></span><br><span class="line">        Double d3=new Double(5.0);</span><br><span class="line">        Double d4=new Double(5.0);</span><br><span class="line">        System.out.println(d3.equals(d4));//true(å› ä¸ºé‡å†™å˜å€¼æ¯”è¾ƒ)</span><br><span class="line">        System.out.println(d3.hashCode() == d4.hashCode());//true</span><br><span class="line">        System.out.println(d3==d4);//false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœªè§£ï¼š<code>Double d1=5.0; Double d2=5.0</code> ä¸æ˜¯å…±ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚ä½†æ˜¯<code>String s1=&quot;1&quot;; String s2=&quot;1&quot;</code>æ˜¯å…±ç”¨ã€‚</p>
<h3 id="javaå¼‚å¸¸"><a href="#javaå¼‚å¸¸" class="headerlink" title="javaå¼‚å¸¸"></a>javaå¼‚å¸¸</h3><p>èƒŒæ™¯ï¼šä»£ç ä¸­éœ€è¦æ•è·åˆ°ä¸“é—¨çš„å¼‚å¸¸è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸å½±å“ä¸»æµç¨‹ï¼Œè¯¥ç”¨tryâ€¦catchï¼Œæ˜¯åœ¨è°ƒç”¨çš„æ—¶å€™catchï¼Œè¿˜æ˜¯åœ¨è°ƒç”¨æ–¹æ³•é‡Œcatchï¼Ÿ<br>ğŸ¤”å¦‚æœæ˜¯åªæƒ³åœ¨è¿™æ¬¡è°ƒç”¨æ—¶è¡¥è´§å¼‚å¸¸å°±åœ¨è°ƒç”¨å¤„ä½¿ç”¨ï¼Œå¦‚æœæ˜¯æƒ³æŠŠæ–¹æ³•åŒ…è£…å¥½éšæ„è°ƒç”¨ä¸å‘ç”Ÿå¼‚å¸¸å°±åœ¨æ–¹æ³•é‡Œæ•è·ã€‚ä½œç”¨æ˜¯ï¼šå‘ç”Ÿå¼‚å¸¸äº†ä¸ä¸­æ–­æµç¨‹ï¼Œåªæ˜¯æ‰“ä¸ªerror logä¹‹ç±»çš„ã€‚å¦‚æœä¸åŠ ï¼Œå°±æ˜¯è‡ªåŠ¨æŠ›å‡ºthrowså¼‚å¸¸äº†ã€‚</p>
<p>èƒŒæ™¯ï¼šé‡Œé¢æ–¹æ³•çš„å¼‚å¸¸ï¼Œå¤–é¢æ–¹æ³•èƒ½ä¸èƒ½catchåˆ°ï¼Ÿé‡Œé¢æ–¹æ³•ä¹Ÿcatchäº†ï¼Œå¤–é¢æ–¹æ³•è¿˜èƒ½ä¸èƒ½catchåˆ°ï¼Ÿ<br>ğŸ¤”é‡Œé¢æ–¹æ³•æ²¡æœ‰catchå¼‚å¸¸çš„è¯ï¼Œå¤–é¢æ–¹æ³•æ˜¯èƒ½æ•è·åˆ°çš„ï¼Œå¹¶ä¸”è¿è¡Œæ—¶å¼‚å¸¸ä¸ç”¨åœ¨é‡Œé¢çš„æ–¹æ³•ä¸ŠåŠ throwsï¼Œå¤–é¢æ–¹æ³•å°±èƒ½æ•è·åˆ°ã€‚ç¼–è¯‘æ—¶å¼‚å¸¸å¿…é¡»åšï¼šcatchä½å¤„ç†æˆ–è€…throw + throwsï¼Œæˆ–è€…ç›´æ¥throwså‡ºå»ï¼Œè¿™æ ·æ‰èƒ½åœ¨å¤–é¢æ–¹æ³•æ•è·åˆ°ã€‚å¦‚æœé‡Œé¢æ–¹æ³•æ•è·äº†å¼‚å¸¸ï¼Œä½†æ˜¯æ²¡throwå‡ºå»ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸throwäº†ä¸éœ€è¦throwsï¼Œç¼–è¯‘æ—¶å¼‚å¸¸throwäº†è¿˜éœ€è¦throwsï¼‰ï¼Œå¤–é¢æ–¹æ³•å°±æ•è·ä¸åˆ°è¿™ä¸ªå¼‚å¸¸ã€‚</p>
<p>èƒŒæ™¯ï¼šä»€ä¹ˆæ—¶å€™éœ€è¦åœ¨æ–¹æ³•ä¸Šthrowså¼‚å¸¸ï¼Œä¸€å®šè¦throwså—ï¼Ÿ<br>ğŸ¤”è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå¯ä»¥ä¸åœ¨æ–¹æ³•ä¸Šthrowsï¼Œè™šæ‹Ÿæœºä¼šè‡ªåŠ¨æ•è·æŠ›å‡ºå»ã€‚ç¼–è¯‘æ—¶å¼‚å¸¸é€šå¸¸åœ¨ç¼–è¯‘æ—¶å°±è¦æ±‚throwså‡ºå»å¼‚å¸¸ï¼Œæˆ–è€…ç”¨tryâ€¦catchè¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ˆæ‰“logä¹‹ç±»ï¼‰ã€‚</p>
<p>èƒŒæ™¯ï¼šä»€ä¹ˆæ—¶å€™éœ€è¦try..catch..throw..throws<br>ğŸ¤”é¦–å…ˆè¿è¡Œæ—¶å¼‚å¸¸å¯ä»¥ä¸throwsï¼Œå¦‚æœæ²¡æœ‰try..catchï¼Œä¼šè‡ªåŠ¨throwså‡ºå»ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯try..catch..å¯¹ç‰¹æ®Šå¼‚å¸¸æ•è·ï¼Œæ²¡å¿…è¦try..catch..throwsã€‚ç¼–è¯‘å‹å¼‚å¸¸å¦‚æœæ˜¯try..catch..æ‰“logäº†ï¼Œå°±ä¸ç”¨throwsäº†ã€‚å¦‚æœæƒ³æŠ›å‡ºå»ï¼Œå°±ç›´æ¥throwså°±è¡Œã€‚æ‰€ä»¥ä¸éœ€è¦try..catch..throw..throwsã€‚å¦‚æœå³æƒ³ç”¨try..catch..finally..è¿˜æƒ³throwså‡ºå»ï¼Œå°±ç”¨ã€‚</p>
<h4 id="âœ…javaçš„å¼‚å¸¸ä½“ç³»"><a href="#âœ…javaçš„å¼‚å¸¸ä½“ç³»" class="headerlink" title="âœ…javaçš„å¼‚å¸¸ä½“ç³»"></a>âœ…javaçš„å¼‚å¸¸ä½“ç³»</h4><p>é¦–å…ˆExceptionå’ŒErroréƒ½æ˜¯ç»§æ‰¿äºThrowable ç±»ï¼Œåœ¨ Java ä¸­åªæœ‰ Throwable ç±»å‹çš„å®ä¾‹æ‰å¯ä»¥è¢«æŠ›å‡ºï¼ˆthrowï¼‰æˆ–è€…æ•è·ï¼ˆcatchï¼‰ï¼Œå®ƒæ˜¯å¼‚å¸¸å¤„ç†æœºåˆ¶çš„åŸºæœ¬ç»„æˆç±»å‹ã€‚</p>
<p><img src="/images/java%E5%BC%82%E5%B8%B8.png"></p>
<p>Erroræ˜¯ç¼–è¯‘æ—¶é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯ï¼Œç³»ç»Ÿé”™è¯¯åœ¨é™¤ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œéƒ½ä¸éœ€è¦ä½ æ¥å…³å¿ƒï¼ŒåŸºæœ¬ä¸ä¼šå‡ºç°ã€‚è€Œç¼–è¯‘æ—¶é”™è¯¯ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ç¼–è¯‘å™¨ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šæç¤ºã€‚</p>
<p>Exceptionåˆ™æ˜¯å¯ä»¥è¢«æŠ›å‡ºçš„åŸºæœ¬ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸»è¦å…³å¿ƒçš„ä¹Ÿæ˜¯è¿™ä¸ªç±»ã€‚<br>Exceptionåˆåˆ†ä¸ºRunTimeExceptionå’Œå…¶ä»–Exceptionã€‚</p>
<p>RunTimeExceptionï¼šè¿è¡Œæ—¶å¼‚å¸¸ï¼Œåˆç§°ä¸å—æ£€æŸ¥å¼‚å¸¸ï¼Œä¸å—æ£€æŸ¥ï¼Œå› ä¸ºä¸å—æ£€æŸ¥ï¼Œæ‰€ä»¥åœ¨ä»£ç ä¸­å¯èƒ½ä¼šæœ‰RunTimeExceptionæ—¶Javaç¼–è¯‘æ£€æŸ¥æ—¶ä¸ä¼šå‘Šè¯‰ä½ æœ‰è¿™ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯åœ¨å®é™…è¿è¡Œä»£ç æ—¶åˆ™ä¼šæš´éœ²å‡ºæ¥ï¼Œæ¯”å¦‚ç»å…¸çš„1&#x2F;0ï¼Œç©ºæŒ‡é’ˆç­‰ã€‚å¦‚æœä¸å¤„ç†ä¹Ÿä¼šè¢«Javaè‡ªå·±å¤„ç†ã€‚</p>
<p>å…¶ä»–Exceptionï¼Œå—æ£€æŸ¥å¼‚å¸¸ï¼Œç¼–è¯‘æ—¶å¼‚å¸¸ã€‚å¯ä»¥ç†è§£ä¸ºé”™è¯¯ï¼Œå¿…é¡»è¦å¼€å‘è€…è§£å†³ä»¥åæ‰èƒ½ç¼–è¯‘é€šè¿‡ï¼Œè§£å†³çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œ<br>1ï¼šthrowåˆ°ä¸Šå±‚ï¼Œ<br>2ï¼Œtry-catchå¤„ç†ã€‚</p>
<hr>
<p>Erroræ˜¯javaç¨‹åºè¿è¡Œä¸­ä¸å¯é¢„æ–™çš„å¼‚å¸¸æƒ…å†µï¼ˆæ­£å¸¸æƒ…å†µä¸‹ä¸å¤§å¯èƒ½å‡ºç°çš„æƒ…å†µï¼‰ï¼Œè¿™ç§å¼‚å¸¸å‘ç”Ÿä»¥åï¼Œä¼šç›´æ¥å¯¼è‡´JVMä¸å¯å¤„ç†æˆ–è€…ä¸å¯æ¢å¤çš„æƒ…å†µã€‚æ‰€ä»¥è¿™ç§å¼‚å¸¸ä¸å¯èƒ½æŠ“å–åˆ°ï¼Œæ¯”å¦‚OutOfMemoryErrorã€NoClassDefFoundErrorç­‰ã€‚ã€è¡¨ç¤ºç”±JVMæ‰€ä¾¦æµ‹åˆ°çš„æ— æ³•é¢„æœŸçš„é”™è¯¯ï¼Œç”±äºè¿™æ˜¯å±äºJVMå±‚æ¬¡çš„ä¸¥é‡é”™è¯¯ ï¼Œå¯¼è‡´JVMæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤ï¼Œè¿™æ˜¯ä¸å¯æ•æ‰åˆ°çš„ï¼Œæ— æ³•é‡‡å–ä»»ä½•æ¢å¤çš„æ“ä½œï¼Œé¡¶å¤šåªèƒ½æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚ Errorç±»ä½“ç³»æè¿°äº†Javaè¿è¡Œç³»ç»Ÿä¸­çš„å†…éƒ¨é”™è¯¯ä»¥åŠèµ„æºè€—å°½çš„æƒ…å½¢.åº”ç”¨ç¨‹åºä¸åº”è¯¥æŠ›å‡ºè¿™ç§ç±»å‹çš„å¯¹è±¡(ä¸€èˆ¬æ˜¯ç”±è™šæ‹ŸæœºæŠ›å‡º).å‡å¦‚å‡ºç°è¿™ç§é”™è¯¯,é™¤äº†å°½åŠ›ä½¿ç¨‹åºå®‰å…¨é€€å‡ºå¤–,åœ¨å…¶ä»–æ–¹é¢æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚ã€‘</p>
<p>Exceptionï¼š<br>1ï¼å¯ä»¥æ˜¯å¯è¢«æ§åˆ¶(checked) æˆ–ä¸å¯æ§åˆ¶çš„(unchecked)ã€‚<br>2ï¼è¡¨ç¤ºä¸€ä¸ªç”±ç¨‹åºå‘˜å¯¼è‡´çš„é”™è¯¯ã€‚<br>3ï¼åº”è¯¥åœ¨åº”ç”¨ç¨‹åºçº§è¢«å¤„ç†ã€‚<br>Errorï¼š<br>1ï¼æ€»æ˜¯ä¸å¯æ§åˆ¶çš„(unchecked)ã€‚<br>2ï¼ç»å¸¸ç”¨æ¥ç”¨äºè¡¨ç¤ºç³»ç»Ÿé”™è¯¯æˆ–ä½å±‚èµ„æºçš„é”™è¯¯ã€‚<br>3ï¼å¦‚ä½•å¯èƒ½çš„è¯ï¼Œåº”è¯¥åœ¨ç³»ç»Ÿçº§è¢«æ•æ‰ã€‚</p>
<hr>
<h4 id="âœ…å¸¸è§çš„-Error-å’Œ-Exceptionï¼š"><a href="#âœ…å¸¸è§çš„-Error-å’Œ-Exceptionï¼š" class="headerlink" title="âœ…å¸¸è§çš„ Error å’Œ Exceptionï¼š"></a>âœ…å¸¸è§çš„ Error å’Œ Exceptionï¼š</h4><p>1ï¼‰è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰ä¹Ÿç§° ã€éæ£€æŸ¥å‹å¼‚å¸¸ UncheckedExceptionã€‘ï¼š</p>
<p>Nullpointer Exceptionï¼šç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›<br>ClassCastExceptionï¼šç±»å‹å¼ºåˆ¶è½¬æ¢å¼‚å¸¸<br>IllegalArgumentExceptionï¼šä¼ é€’éæ³•å‚æ•°å¼‚å¸¸<br>IndexOutOfBoundsExceptionï¼šä¸‹æ ‡è¶Šç•Œå¼‚å¸¸<br>NumberFormatExceptionï¼šæ•°å­—æ ¼å¼å¼‚å¸¸<br>ArrayIndexOutOfBoundsException: æ•°ç»„è¶Šç•Œå¼‚å¸¸<br>ArrayStoreException: æ•°æ®å­˜å‚¨å¼‚å¸¸ï¼Œæ“ä½œæ•°ç»„æ—¶ç±»å‹ä¸ä¸€è‡´<br>ArithmeticExceptionï¼š (ç®—æœ¯å¼‚å¸¸)<br>BufferOverflowExceptionï¼š (ç¼“å†²åŒºæº¢å‡ºå¼‚å¸¸)</p>
<p>2ï¼‰éè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆCheckedExceptionï¼‰ä¹Ÿç§° ã€æ£€æŸ¥å‹å¼‚å¸¸ã€‘ï¼š</p>
<p>ClassNotFoundExceptionï¼šæ‰¾ä¸åˆ°æŒ‡å®š class çš„å¼‚å¸¸<br>IOExceptionï¼šIO æ“ä½œå¼‚å¸¸<br>FileNotFoundExceptionï¼šæ–‡ä»¶ä¸å­˜åœ¨å¼‚å¸¸<br>SQLExceptionï¼šSQLè¯­å¥å¼‚å¸¸<br>InterruptedExceptionï¼š (ä¸­æ–­å¼‚å¸¸-è°ƒç”¨çº¿ç¨‹ç¡çœ æ—¶å€™)</p>
<p>3ï¼‰é”™è¯¯ï¼ˆErrorï¼‰ï¼š</p>
<p>NoClassDefFoundErrorï¼šæ‰¾ä¸åˆ° class å®šä¹‰å¼‚å¸¸<br>StackOverflowErrorï¼šæ·±é€’å½’å¯¼è‡´æ ˆè¢«è€—å°½è€ŒæŠ›å‡ºçš„å¼‚å¸¸<br>OutOfMemoryErrorï¼šå†…å­˜æº¢å‡ºå¼‚å¸¸</p>
<h4 id="âœ…é‡åˆ°çš„å¼‚å¸¸è®°å½•"><a href="#âœ…é‡åˆ°çš„å¼‚å¸¸è®°å½•" class="headerlink" title="âœ…é‡åˆ°çš„å¼‚å¸¸è®°å½•"></a>âœ…é‡åˆ°çš„å¼‚å¸¸è®°å½•</h4><h4 id="ExecutionException"><a href="#ExecutionException" class="headerlink" title="ExecutionException"></a>ExecutionException</h4><p>future.get()æŠ›å‡ºçš„ï¼ŒExecutionExceptionåŒ…è£…æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸ã€‚æ²¡æ˜ç™½ï¼Œåº”è¯¥æ˜¯ä¸ªæ£€æŸ¥å‹å¼‚å¸¸ã€‚æ˜¯å¿…é¡»è¦ç¨‹åºå‘˜å¤„ç†çš„ã€‚</p>
<p><a href="https://www.orcode.com/question/618888_kb0916.html">https://www.orcode.com/question/618888_kb0916.html</a><br><a href="https://www.mianshigee.com/question/91669mas/">https://www.mianshigee.com/question/91669mas/</a></p>
<h4 id="InterruptException"><a href="#InterruptException" class="headerlink" title="InterruptException"></a>InterruptException</h4><p>future.get()ä¼šæŠ›å‡ºï¼ŒThread.sleepä¹Ÿä¼šæŠ›å‡ºã€‚<br>å½“çº¿ç¨‹æ­£åœ¨ç­‰å¾…ã€ä¼‘çœ æˆ–ä»¥å…¶ä»–æ–¹å¼è¢«å ç”¨ï¼Œå¹¶ä¸”çº¿ç¨‹åœ¨æ´»åŠ¨ä¹‹å‰æˆ–æ´»åŠ¨æœŸé—´è¢«ä¸­æ–­æ—¶æŠ›å‡ºã€‚ æœ‰æ—¶ï¼Œæ–¹æ³•å¯èƒ½å¸Œæœ›æµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç«‹å³æŠ›å‡ºæ­¤å¼‚å¸¸ã€‚<br>æ´»åŠ¨çº¿ç¨‹çš„æ‰§è¡Œä¸­æ–­è¡Œä¸ºï¼Œå¯ä»¥æŠ›å‡ºè¿™æ ·çš„å¼‚å¸¸ã€‚<br><a href="https://blog.csdn.net/kevinmeanscool/article/details/123566970">https://blog.csdn.net/kevinmeanscool/article/details/123566970</a></p>
<h4 id="java-lang-NoClassDefFoundError"><a href="#java-lang-NoClassDefFoundError" class="headerlink" title="java.lang.NoClassDefFoundError"></a>java.lang.NoClassDefFoundError</h4><p>NoClassDefFoundErrorå¯èƒ½å‡ºç°çš„æƒ…å†µ<br>ç›®å‰æœ‰å‘ç°å‡ ç§æƒ…å†µ<br>1.ä¸€ç§æƒ…å†µå°±æ˜¯å› ä¸ºé™æ€å˜é‡åŠ è½½ä¸åˆ°åŸå› <br>2.å·¥ç¨‹é‡Œæ²¡æœ‰å°†jaræ·»åŠ åˆ°classpathï¼Œmavené¡¹ç›®çš„ï¼Œéœ€è¦æ ¹æ®é¡¹ç›®æƒ…å†µæ’æŸ¥</p>
<p>å®é™…åŸå› ï¼šåœ¨æŠ¥é”™çš„testç±»æ‰€åœ¨çš„åŒ…é‡Œï¼Œæ²¡æœ‰å¼•æŸä¸ªåŒ…ï¼Œå¯¼è‡´æ‰¾ä¸åˆ°æŸç±»ã€‚<br>é¦–å…ˆç”¨ï¼š<code>mvn dependency:tree</code>ï¼ŒæŸ¥çœ‹ä¾èµ–jarçš„å…³ç³»ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªç±»çš„åŒ…æ˜¯å“ªä¸ªï¼Œå¼•ç”¨äº†æ²¡ã€‚<br>å‘ç°åœ¨çˆ¶pomé‡Œæœ‰è¿™ä¸ªåŒ…ï¼Œä½†æ˜¯åœ¨æŠ¥é”™çš„åŒ…é‡Œæ²¡æœ‰ç”¨çˆ¶pomï¼Œä¹Ÿæ²¡å¼•é‚£ä¸ªåŒ…ã€‚<br>æ‰€ä»¥ï¼Œåœ¨æŠ¥é”™çš„åŒ…çš„pomé‡Œï¼Œå¼•ç”¨é‚£ä¸ªåŒ…å°±è§£å†³ã€‚</p>
<h4 id="NoUniqueBeanDefinitionException"><a href="#NoUniqueBeanDefinitionException" class="headerlink" title="NoUniqueBeanDefinitionException"></a>NoUniqueBeanDefinitionException</h4><p>ä¸å”¯ä¸€çš„beanå®šä¹‰å¼‚å¸¸<br>æ²¡æœ‰ä¸€ä¸ªåˆé€‚çš„beanç±»å‹ï¼ˆcn.cy.bean.Toolï¼‰å¯ç”¨ï¼Œé¢„æœŸæœ‰ä¸€ä¸ªå•ç‹¬çš„åŒ¹é…çš„beanï¼Œä½†æ˜¯æ‰¾åˆ°äº†å¤šä¸ªã€‚</p>
<p>çœ‹çœ‹æ˜¯ä¸æ˜¯ä¸€ä¸ªæ¥å£æœ‰å¤šä¸ªå®ç°ç±»ï¼Œç„¶ååœ¨æŸç±»ä¸­æ³¨å…¥è¯¥æ¥å£ä¸­æ²¡æœ‰æŒ‡å®šæ³¨å…¥å“ªä¸ªã€‚</p>
<blockquote>
<p>é€šå¸¸å¦‚æœä¸€ä¸ªæ¥å£å¤šä¸ªå®ç°ç±»ï¼Œä¼šæ ¹æ®æ¡ä»¶Enumé€‰æ‹©å“ªä¸ªç±»æ‰§è¡Œçš„è¯ï¼ŒåŠ ä¸€ä¸ªServiceFacadeç±»æ¥æ ¹æ®æ¡ä»¶é€‰æ‹©ï¼Œè¿™ä¸ªç±»å®ç°Serviceæ¥å£å’ŒInitializingBeanæ¥å£ï¼Œé‡Œé¢å®šä¹‰ä¸€ä¸ªmap&lt;Enum, æ¥å£Service&gt;ï¼Œåœ¨ä½¿ç”¨åˆ°å®ç°ç±»çš„æ–¹æ³•ä¸­ï¼Œæ³¨å…¥ServiceFacadeå°±è¡Œã€‚</p>
</blockquote>
<p>è§£å†³æ–¹æ³•ï¼š<br>1ã€æ³¨å…¥æ¥å£çš„åœ°æ–¹ <code>@Autowired + @Qualifer(&quot;whichImpl&quot;)</code><br>2ã€æ³¨å…¥æ¥å£çš„åœ°æ–¹ <code>@Resource(name=&quot;whichImpl&quot;)</code></p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_46030002/article/details/125661107">https://blog.csdn.net/weixin_46030002/article/details/125661107</a></p>
<h4 id="BeanCreationException"><a href="#BeanCreationException" class="headerlink" title="BeanCreationException"></a>BeanCreationException</h4><p>Beanåˆ›å»ºè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ã€‚å…·ä½“æœ‰ä»¥ä¸‹å‡ ç§å¸¸è§å¼‚å¸¸ï¼ŒåŒ…æ‹¬ä¸Šé¢çš„NoUniqueBeanDefinitionException ä¹Ÿæ˜¯ä¸€ç§ã€‚</p>
<p>1.org.springframework.beans.factory.NoSuchBeanDefinitionException</p>
<p>ä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨æ­¤Beanï¼Œä¸€èˆ¬åŸå› åœ¨æ²¡æœ‰å£°æ˜Beanï¼ŒBeanAå°è¯•æ³¨å…¥BeanBï¼Œä½†æ˜¯springä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨BeanBã€‚æ£€æŸ¥æ˜¯å¦ç”¨@Component @Service @Controller @Repository æ³¨å…¥äº†beanã€‚</p>
<p>2.org.springframework.beans.factory.NoUniqueBeanDefinitionException</p>
<p>å½“ä¸€ä¸ªBeanæœ‰å¤šä¸ªå®ç°ï¼Œä¾‹å¦‚BeanB1 å’ŒBeanB2éƒ½å®ç°äº†åŒä¸€ä¸ªæ¥å£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class BeanB1 implements IBeanB &#123; ... &#125;</span><br><span class="line">@Component</span><br><span class="line">public class BeanB2 implements IBeanB &#123; ... &#125;</span><br><span class="line"> </span><br><span class="line">@Component</span><br><span class="line">public class BeanA &#123;</span><br><span class="line"> </span><br><span class="line">    @Autowired</span><br><span class="line">    private IBeanB dependency;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.org.springframework.beans.BeanInstantiationException</p>
<p>Bean å®ä¾‹åŒ–è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œå…·ä½“åŸå› éœ€è¦æŸ¥çœ‹nested exceptionåé¢æŠ¥é”™</p>
<p>3.1 Custom Exception<br>ä¸šåŠ¡è‡ªå®šä¹‰æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚ä¸‹æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸</p>
<p>3.2 java.lang.InstantiationException<br>åœ¨xmlé…ç½®ä¸­ä½¿ç”¨æŠ½è±¡ç±»å®šä¹‰bean</p>
<p>3.3 java.lang.NoSuchMethodException<br>å¦‚æœä¸€ä¸ªbeanç±»æ²¡æœ‰é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œspringåœ¨åˆ›å»ºbeanå®ä¾‹æ—¶.</p>
<p>4.org.springframework.beans.factory.CannotLoadBeanClassException</p>
<p>å½“springåŠ è½½ä¸åˆ°beanå¯¹åº”çš„ç±»æ–‡ä»¶æ—¶ï¼Œè¿™ç§å¼‚å¸¸å°†ä¼šè¢«æŠ›å‡ºã€‚è¿™ç§æƒ…å†µå¾ˆæœ‰å¯èƒ½å‘ç”Ÿåœ¨å½“é…ç½®æ–‡ä»¶ä¸­çš„ç±»è·¯å¾„å…¨ç§°æ‰¾ä¸åˆ°å¯¹åº”æ–‡ä»¶æ—¶ã€‚</p>
<p>æ›´å¤šï¼š<a href="https://blog.csdn.net/m0_37578675/article/details/117075030">https://blog.csdn.net/m0_37578675/article/details/117075030</a></p>
<hr>
<h4 id="âœ…NoClassDefFoundError-å’Œ-ClassNotFoundException-çš„åŒºåˆ«ï¼š"><a href="#âœ…NoClassDefFoundError-å’Œ-ClassNotFoundException-çš„åŒºåˆ«ï¼š" class="headerlink" title="âœ…NoClassDefFoundError å’Œ ClassNotFoundException çš„åŒºåˆ«ï¼š"></a>âœ…NoClassDefFoundError å’Œ ClassNotFoundException çš„åŒºåˆ«ï¼š</h4><p>åŒºåˆ«ä¸€ï¼š<br>NoClassDefFoundErrorå®ƒæ˜¯Errorï¼Œ<br>ClassNotFoundExceptionæ˜¯Exceptionã€‚</p>
<p>åŒºåˆ«äºŒï¼š<br>NoClassDefFoundErroræ˜¯JVMè¿è¡Œæ—¶é€šè¿‡classpathåŠ è½½ç±»æ—¶ï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„ç±»è€ŒæŠ›å‡ºçš„é”™è¯¯ã€‚<br>ClassNotFoundExceptionæ˜¯ç¼–è¯‘æ—¶å¼‚å¸¸ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å¿…é¡»å°†ClassNotFoundExceptionå¼‚å¸¸æŠ›å‡ºï¼</p>
<p>NoClassDefFoundErrorå‘ç”Ÿåœºæ™¯å¦‚ä¸‹ï¼š<br>1ã€ç±»ä¾èµ–çš„classæˆ–è€…jarä¸å­˜åœ¨ ï¼ˆç®€å•è¯´å°±æ˜¯mavenç”Ÿæˆè¿è¡ŒåŒ…åè¢«ç¯¡æ”¹ï¼‰<br>2ã€ç±»æ–‡ä»¶å­˜åœ¨ï¼Œä½†æ˜¯å­˜åœ¨ä¸åŒçš„åŸŸä¸­ ï¼ˆç®€å•è¯´å°±æ˜¯å¼•å…¥çš„ç±»ä¸åœ¨å¯¹åº”çš„åŒ…ä¸‹)<br>3ã€å¤§å°å†™é—®é¢˜ï¼Œjavacç¼–è¯‘çš„æ—¶å€™æ˜¯æ— è§†å¤§å°çš„ï¼Œå¾ˆæœ‰å¯èƒ½ä½ ç¼–è¯‘å‡ºæ¥çš„classæ–‡ä»¶å°±ä¸æƒ³è¦çš„ä¸ä¸€æ ·ï¼è¿™ä¸ªæ²¡æœ‰åšéªŒè¯ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>ClassNotFoundExceptionå‘ç”Ÿåœºæ™¯å¦‚ä¸‹ï¼š<br>1ã€è°ƒç”¨classçš„forNameæ–¹æ³•æ—¶ï¼Œæ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»<br>2ã€ClassLoader ä¸­çš„ findSystemClass() æ–¹æ³•æ—¶ï¼Œæ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»<br>ä¸¾ä¾‹è¯´æ˜å¦‚ä¸‹:<br>Class.forName(â€œabcâ€); æ¯”å¦‚abcè¿™ä¸ªç±»ä¸å­˜é¡¹ç›®ä¸­ï¼Œä»£ç ç¼–å†™æ—¶ï¼Œå°±ä¼šæç¤ºæ­¤å¼‚å¸¸æ˜¯æ£€æŸ¥æ€§å¼‚å¸¸ï¼Œæ¯”å¦‚å°†æ­¤å¼‚å¸¸æŠ›å‡ºã€‚</p>
<hr>
<h4 id="âœ…è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime-exception-ä¸æ£€æŸ¥å‹å¼‚å¸¸ï¼ˆchecked-exceptionï¼‰çš„åŒºåˆ«ï¼š"><a href="#âœ…è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime-exception-ä¸æ£€æŸ¥å‹å¼‚å¸¸ï¼ˆchecked-exceptionï¼‰çš„åŒºåˆ«ï¼š" class="headerlink" title="âœ…è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime exception)ä¸æ£€æŸ¥å‹å¼‚å¸¸ï¼ˆchecked exceptionï¼‰çš„åŒºåˆ«ï¼š"></a>âœ…è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime exception)ä¸æ£€æŸ¥å‹å¼‚å¸¸ï¼ˆchecked exceptionï¼‰çš„åŒºåˆ«ï¼š</h4><p>1:checked ï¼ˆæ£€æŸ¥å‹å¼‚å¸¸ï¼‰ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸é‡åˆ°çš„IOå¼‚å¸¸ï¼Œä»¥åŠSQLå¼‚å¸¸éƒ½æ˜¯è¿™ç§å¼‚å¸¸ã€‚ç¼–è¯‘å™¨è¦æ£€æŸ¥è¿™ç±»å¼‚å¸¸ï¼Œæ£€æŸ¥çš„ç›®çš„ä¸€æ–¹é¢æ˜¯å› ä¸ºè¯¥ç±»å¼‚å¸¸çš„å‘ç”Ÿéš¾ä»¥é¿å…ï¼Œ<br>å¦ä¸€æ–¹é¢å°±æ˜¯è®©å¼€å‘è€…å»è§£å†³æ‰è¿™ç±»å¼‚å¸¸ï¼Œæ‰€ä»¥ç§°ä¸ºå¿…é¡»å¤„ç†ï¼ˆtry â€¦catchï¼‰çš„å¼‚å¸¸ã€‚å¦‚æœä¸å¤„ç†è¿™ç±»å¼‚å¸¸ï¼Œé›†æˆå¼€å‘ç¯å¢ƒä¸­çš„ç¼–è¯‘å™¨ä¸€èˆ¬ä¼šç»™å‡ºé”™è¯¯æç¤ºã€‚</p>
<p>å¦‚æœä¸€ä¸ªæ–¹æ³•æ²¡æœ‰æ•è·ä¸€ä¸ªæ£€æŸ¥æ€§å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å¿…é¡»ä½¿ç”¨ throws å…³é”®å­—æ¥å£°æ˜ã€‚throws å…³é”®å­—æ”¾åœ¨æ–¹æ³•åçš„åè¾¹ï¼Œeg:  æ–¹æ³•åï¼ˆï¼‰ throws  IOExecptionã€‚</p>
<p>ç†è§£ï¼šæ£€æŸ¥å‹å¼‚å¸¸ï¼Œè¦ä¹ˆï¼štryâ€¦ catch.. æ‰“logï¼Œè¦ä¹ˆï¼štry..catch..throw..throwsï¼ˆå¤šæ­¤ä¸€ä¸¾ï¼Œæ²¡å¿…è¦ï¼‰ï¼Œè¦ä¹ˆåªæ˜¯throwsã€‚</p>
<p>2:runtime exceptionï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰ï¼Œç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥è¿™ç±»å¼‚å¸¸ï¼Œä¸æ£€æŸ¥çš„åˆ™å¼€å‘è€…åœ¨ä»£ç çš„ç¼–è¾‘ç¼–è¯‘é˜¶æ®µå°±ä¸æ˜¯å¿…é¡»å¤„ç†ï¼Œè¿™ç±»å¼‚å¸¸ä¸€èˆ¬å¯ä»¥é¿å…ï¼Œå› æ­¤æ— éœ€å¤„ç†ï¼ˆtry â€¦catchï¼‰,ä¼šç›´æ¥throwså‡ºå»ï¼Œå¦‚æœä¸æƒ³throwså‡ºå»ï¼Œå°±try catch æ‰“logã€‚<br>å¦‚æœä¸å¤„ç†è¿™ç±»å¼‚å¸¸ï¼Œé›†æˆå¼€å‘ç¯å¢ƒä¸­çš„ç¼–è¯‘å™¨ä¹Ÿä¸ä¼šç»™å‡ºé”™è¯¯æç¤ºã€‚  å½“å‡ºç°è¿™æ ·çš„å¼‚å¸¸æ—¶ï¼Œæ€»æ˜¯ç”±è™šæ‹Ÿæœºæ¥ç®¡ã€‚</p>
<p>åŸæ–‡ï¼š<a href="https://www.cnblogs.com/liangbaolong/p/12884224.html">https://www.cnblogs.com/liangbaolong/p/12884224.html</a></p>
<hr>
<h4 id="âœ…å¤šå¼‚å¸¸æ•è·ï¼š"><a href="#âœ…å¤šå¼‚å¸¸æ•è·ï¼š" class="headerlink" title="âœ…å¤šå¼‚å¸¸æ•è·ï¼š"></a>âœ…å¤šå¼‚å¸¸æ•è·ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try &#123;</span><br><span class="line"></span><br><span class="line">&#125; catch(NullPointerException | IOException e) &#123;</span><br><span class="line">    //log.error(e);</span><br><span class="line"></span><br><span class="line">&#125; catch(Exception e) &#123;</span><br><span class="line">    //log.error(e);</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>| ç¬¦åˆ å¯ä»¥ å†™å¤šä¸ªï¼Œç¬¦åˆå…¶ä¸­ä¹‹ä¸€ã€‚<br>æ³¨æ„è¦æŠŠå¼‚å¸¸èŒƒå›´å°çš„æ”¾åœ¨å‰é¢ï¼ŒèŒƒå›´å¤§çš„æ”¾åœ¨åé¢ã€‚<br>âš ï¸æ³¨æ„åœ¨tryå†…returnæˆ–è€…breakäº†ï¼Œfinallyä¹Ÿä¼šæ‰§è¡Œçš„ã€‚</p>
<h4 id="catch-Exeception-e-å’Œcatch-Throwable-e"><a href="#catch-Exeception-e-å’Œcatch-Throwable-e" class="headerlink" title="catch(Exeception e)å’Œcatch(Throwable e)"></a>catch(Exeception e)å’Œcatch(Throwable e)</h4><p>Throwableå¯ä»¥æ•è·Errorå’ŒExceptionä¸¤å¤§ç±»çš„å¼‚å¸¸ï¼Œå…¶ä¸­Erroræ˜¯æ¯”è¾ƒä¸¥é‡ä¸å¯æ§çš„å¼‚å¸¸ã€‚è€ŒExceptionæ˜¯å¯ä»¥è¢«ç¼–ç¨‹å¤„ç†çš„å¼‚å¸¸ã€‚<br>Exceptionåªèƒ½æ•è·RuntimeExceptionå’ŒIOExceptionã€‚</p>
<p>å›é¡¾ä¸€ä¸‹javaçš„å¼‚å¸¸ä½“ç³»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Throwable: Javaä¸­æ‰€æœ‰å¼‚å¸¸å’Œé”™è¯¯ç±»çš„çˆ¶ç±»ã€‚åªæœ‰è¿™ä¸ªç±»çš„å®ä¾‹ï¼ˆæˆ–è€…å­ç±»çš„å®ä¾‹ï¼‰å¯ä»¥è¢«è™šæ‹ŸæœºæŠ›å‡ºæˆ–è€…è¢«javaçš„throwå…³é”®å­—æŠ›å‡ºã€‚åŒæ ·ï¼Œåªæœ‰å…¶æˆ–å…¶å­ç±»å¯ä»¥å‡ºç°åœ¨catchå­å¥é‡Œé¢ã€‚</span><br><span class="line">Error: Throwableçš„å­ç±»ï¼Œè¡¨ç¤ºä¸¥é‡çš„é—®é¢˜å‘ç”Ÿäº†ï¼Œè€Œä¸”è¿™ç§é”™è¯¯æ˜¯ä¸å¯æ¢å¤çš„ã€‚</span><br><span class="line">Exception: Throwableçš„å­ç±»ï¼Œåº”ç”¨ç¨‹åºåº”è¯¥è¦æ•è·å…¶æˆ–å…¶å­ç±»ï¼ˆRuntimeExceptionä¾‹å¤–ï¼‰ï¼Œç§°ä¸ºchecked exceptionã€‚æ¯”å¦‚ï¼šIOException, NoSuchMethodException...</span><br><span class="line">RuntimeException: Exceptionçš„å­ç±»ï¼Œè¿è¡Œæ—¶å¼‚å¸¸ï¼Œç¨‹åºå¯ä»¥ä¸æ•è·ï¼Œç§°ä¸ºunchecked exceptionã€‚æ¯”å¦‚ï¼šNullPointException.</span><br></pre></td></tr></table></figure>

<p>â“åº”è¯¥catch (Throwable th) è¿˜æ˜¯ catch (Exception)?</p>
<p>è¿™ä¸¤ç§å¤„ç†çš„åŒºåˆ«åœ¨äºï¼Œcatch throwableä¼šæŠŠErrorå’Œå…¶ä»–ç»§æ‰¿Throwableçš„ç±»æ•æ‰åˆ°ã€‚è€Œcatch Exceptionåªä¼šæ•æ‰Exceptionæå…¶å­ç±»ï¼Œæ•æ‰çš„èŒƒå›´æ›´å°ã€‚ç¬¬ä¸€ç§catchç›¸å½“äºæ¯”ç¬¬äºŒç§catchå¤šæ•æ‰äº†æŠŠErrorå’Œå…¶å­ç±»ã€‚</p>
<p>â“Erroræ˜¯å¦éœ€è¦æ•æ‰?</p>
<p>JDKä¸­Errorç±»çš„çš„æ³¨é‡Šé‡Œæåˆ°è¿‡ï¼ŒErroræ˜¯ä¸€ç§ä¸¥é‡çš„é—®é¢˜ï¼Œåº”ç”¨ç¨‹åºä¸åº”è¯¥æ•æ‰å®ƒã€‚<br>Errorç»§æ‰¿è‡ªThrowableè€Œä¸æ˜¯ç»§æ‰¿è‡ªExceptionï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿ç¨‹åºå¯ä»¥ä½¿ç”¨ â€œcatch (Exception)â€æ¥æ•æ‰å¼‚å¸¸è€Œä¸ä¼šæŠŠErrorä¹Ÿæ•æ‰åœ¨å†…ï¼Œå› ä¸ºExceptionå‘ç”Ÿåå¯ä»¥è¿›è¡Œä¸€äº›æ¢å¤å·¥ä½œçš„ï¼Œä½†æ˜¯Errorå‘ç”Ÿåä¸€èˆ¬æ˜¯ä¸å¯æ¢å¤çš„ã€‚</p>
<p>â“Errorå¯ä»¥catchå—ï¼Ÿ å¯ä»¥catchäº†ååšäº›å…¶ä»–å¤„ç†å—ï¼Ÿ</p>
<p>Erroræ˜¯å¯ä»¥catchçš„ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥å‘å¸¸è§„Exceptionä¸€æ ·è¢«å¤„ç†ï¼Œè€Œä¸”å°±ç®—ä¸æ•æ‰çš„è¯ä¹Ÿåªæ˜¯å¯¼è‡´å½“å‰çº¿ç¨‹æŒ‚æ‰ï¼Œå…¶ä»–çº¿ç¨‹è¿˜æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯æ•æ‰Errorä¹‹åä¹Ÿå¯ä»¥åšäº›å…¶ä»–å¤„ç†ã€‚ä½†æ˜¯Erroræ˜¯ä¸€ç§ç³»ç»Ÿå†…éƒ¨çš„é”™è¯¯ï¼Œè¿™ç§é”™è¯¯ä¸åƒExceptionä¸€æ ·æ˜¯å¯èƒ½æ˜¯ç¨‹åºå’Œä¸šåŠ¡ä¸Šçš„é”™è¯¯æ˜¯å¯ä»¥æ¢å¤çš„ã€‚</p>
<p>å‡è®¾è¿›è¡Œç½‘ç»œè¿æ¥æ“ä½œçš„æ—¶å€™ï¼ŒIOException å‘ç”Ÿäº†ï¼Œå¯èƒ½æ˜¯ç½‘ç»œä¸­æ–­ï¼Œæˆ‘å¯ä»¥å†å°è¯•å‡ æ¬¡ã€‚</p>
<p>å‡è®¾OutOfMemoryErrorå‘ç”Ÿäº†ï¼Œå°±ç®—è¢«æ•æ‰äº†ï¼Œå¯ä»¥æœ‰ä»€ä¹ˆæ‰‹æ®µè®©ç¨‹åºæ­£å¸¸è¿è¡Œä¸‹å»å—ï¼Ÿ å‡è®¾ExceptionInInitializerErrorå‘ç”Ÿäº†ï¼Œç±»æ— æ³•è¢«æ­£å¸¸åˆå§‹åŒ–ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥é€šè¿‡æ•æ‰æ¥æ¢å¤çš„å—ï¼Ÿ</p>
<p>ğŸ‘Œç»“è®ºï¼šJavaæœ¬èº«è®¾è®¡æ€è·¯å°±æ˜¯å¸Œæœ›å¤§å®¶catch Exceptionå°±è¶³å¤Ÿäº†ï¼Œå¦‚æœæœ‰Errorå‘ç”Ÿï¼Œcatchäº†ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆä½œç”¨</p>
<p>è½¬è‡ªï¼šå¦‚ä½•å¤„ç†å¼‚å¸¸? catch Exception OR catch Throwable<br><a href="https://www.cnblogs.com/smile361/p/5521278.html">https://www.cnblogs.com/smile361/p/5521278.html</a></p>
<p>ä¸¾ä¸€ä¸ªç”¨<code>catch (Throwable e)</code>çš„ä¾‹å­ï¼š<br>ç›®çš„æ˜¯ç¡®ä¿å¼‚å¸¸è¢«æ‰“å°ï¼Œä¸€ä¸ªæ— çº¿é€’å½’ï¼Œå¯¼è‡´çš„StackOverflowError</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Throwable_demo &#123;</span><br><span class="line">    static void generate_throwable() &#123;</span><br><span class="line">        generate_throwable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        //æ­¤ç§æƒ…å½¢ä¸‹æˆ‘ä»¬è¦catch Throwable, ä»¥ç¡®ä¿å¼‚å¸¸è¢«æ‰“å°...</span><br><span class="line">        try &#123;</span><br><span class="line">            final int[] times = &#123; 0 &#125;;</span><br><span class="line">            Thread thread1 = new Thread(new Runnable() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void run() &#123;</span><br><span class="line">                    while (true) &#123;</span><br><span class="line">                        ++times[0];</span><br><span class="line">                        System.out.println(times[0]);</span><br><span class="line">                        try &#123;</span><br><span class="line">                            Thread.sleep(10);</span><br><span class="line">                        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            thread1.start();</span><br><span class="line">            generate_throwable();</span><br><span class="line">        &#125; catch (Throwable e) &#123;</span><br><span class="line">            //è‹¥catchçš„æ˜¯Exceptionï¼š</span><br><span class="line">            //å› finallyä¸­çš„exitæŒ‡ä»¤ï¼Œåœ¨æ‰“å°å¼‚å¸¸å‰ç¨‹åºå°±ä¼šç»ˆæ­¢ã€‚</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            System.out.println(&quot;end.&quot;);</span><br><span class="line">            //å¦‚æœä¸exit: å›  thread1 æœªåœæ­¢ï¼Œç¨‹åºä¸ä¼šç»ˆæ­¢ã€‚</span><br><span class="line">            System.exit(0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…é¡¹ç›®ä¸­çš„è‡ªå®šä¹‰å¼‚å¸¸"><a href="#âœ…é¡¹ç›®ä¸­çš„è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="âœ…é¡¹ç›®ä¸­çš„è‡ªå®šä¹‰å¼‚å¸¸"></a>âœ…é¡¹ç›®ä¸­çš„è‡ªå®šä¹‰å¼‚å¸¸</h4><p>ç»§æ‰¿RuntimeExceptionæ‰©å±•ä¸€ä¸ªæ–°çš„å¼‚å¸¸ä½œä¸ºæ•´ä¸ªç±»åº“çš„å¼‚å¸¸åŸºç±»ã€‚<br>é‡Œé¢å®šä¹‰å¼‚å¸¸ç¼–ç å•¥çš„ã€‚</p>
<p>å¦‚æœéœ€è¦æ ¹æ®å¼‚å¸¸è¿›è¡Œä¸åŒçš„å¤„ç†ï¼Œå»ºè®®ç»™è‡ªå®šä¹‰å¼‚å¸¸å¢åŠ ä¸€ä¸ªERROR_CODEå­—æ®µï¼Œè¿™æ ·æ— è®ºåœ¨æœåŠ¡å™¨è¿˜æ˜¯å®¢æˆ·ç«¯éƒ½å¯ä»¥æ ¹æ®ä¸åŒçš„ERROR_CODEè¿›è¡Œå¯¹åº”çš„å¤„ç†ã€‚ä½†æ˜¯å‡ºç°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œåº”è¯¥éœ€è¦è€ƒè™‘ä¸€ä¸‹è®¾è®¡æ€è·¯äº†ï¼Œä¸€èˆ¬æ¥è®²æ ¹æ®å¼‚å¸¸æ¥å†³å®šä¸šåŠ¡æµç¨‹ä¸æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡æ–¹æ¡ˆã€‚</p>
<h4 id="âœ…e-getMeasage-å’Œe-toString"><a href="#âœ…e-getMeasage-å’Œe-toString" class="headerlink" title="âœ…e.getMeasage()å’Œe.toString()"></a>âœ…e.getMeasage()å’Œe.toString()</h4><p>e.getMeasage()è¿”å›å¼‚å¸¸çš„ç®€çŸ­æè¿°ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚<br>e.toString()è¿”å›å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¼‚å¸¸ç±»å‹å’Œå¼‚å¸¸æ¶ˆæ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç©ºæŒ‡é’ˆï¼š</span><br><span class="line">message:null</span><br><span class="line">toString:java.lang.NullPointerException</span><br></pre></td></tr></table></figure>

<h3 id="ArrayListçº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#ArrayListçº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="ArrayListçº¿ç¨‹å®‰å…¨é—®é¢˜"></a>ArrayListçº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>ArrayList æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆç±»ï¼Œå½“å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¹¶å‘å¯¹åŒä¸€ä¸ªArrayListæ‰§è¡Œaddï¼Œå¯èƒ½ä¼šä¸¢æ•°æ®ã€‚å¦‚æœå¤šçº¿ç¨‹åˆæ˜¯addï¼Œåˆæ˜¯è¾“å‡ºlistï¼Œä¼šå‘ç”Ÿå¹¶å‘é”™è¯¯ã€‚</p>
<p>âš ï¸ä¸ºä»€ä¹ˆè¯´å¯èƒ½å‘¢ï¼Œå› ä¸ºæœ‰æ—¶å€™addå¾—å¤ªå¿«ï¼Œå°±æ²¡å‡ºé—®é¢˜ã€‚</p>
<blockquote>
<p>ConcurrentModificationException: å¹¶å‘ä¿®æ”¹å¼‚å¸¸<br>ä½¿ç”¨è¿­ä»£å™¨å¾ªç¯ï¼Œåœ¨å¾ªç¯ä¸­ç”¨ArrayListçš„add&#x2F;removeæ–¹æ³•ä¼šå‡ºç°è¯¥å¼‚å¸¸ã€‚åŸå› åŠè§£å†³æ–¹æ³•ï¼š<a href="https://blog.csdn.net/u013168615/article/details/116570591">https://blog.csdn.net/u013168615/article/details/116570591</a></p>
</blockquote>
<hr>
<p>å¤šçº¿ç¨‹å¯¹Listè¿›è¡Œaddåˆéå†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test4() throws InterruptedException &#123;</span><br><span class="line">    List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">    for (int i = 1; i &lt;= 30; i++)&#123;</span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            list.add(UUID.randomUUID().toString().substring(0, 8));</span><br><span class="line">            System.out.println(list);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;;</span><br><span class="line">    Thread.sleep(60 * 1000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼‚å¸¸ï¼šException in thread â€œThread-0â€ java.util.ConcurrentModificationException</p>
<h4 id="âœ…ArrayListä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨"><a href="#âœ…ArrayListä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨" class="headerlink" title="âœ…ArrayListä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨"></a>âœ…ArrayListä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨</h4><p>å¤šçº¿ç¨‹å¯¹ArrayListè¿›è¡Œaddæœ‰å¯èƒ½ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚ä¹Ÿæœ‰å¯èƒ½ä¼šé€ æˆæ•°ç»„è¶Šç•Œã€‚</p>
<blockquote>
<p>çº¿ç¨‹å®‰å…¨ï¼šæŒ‡å½“å¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œé‡‡ç”¨äº†åŠ é”çš„æœºåˆ¶ï¼›å³å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥ç±»çš„æŸä¸ªæ•°æ®æ—¶ï¼Œä¼šå¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œä¿æŠ¤ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½å¯¹å…¶è®¿é—®ï¼Œç›´åˆ°è¯¥çº¿ç¨‹è¯»å–å®Œä¹‹åï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä»¥ä½¿ç”¨ã€‚é˜²æ­¢å‡ºç°æ•°æ®ä¸ä¸€è‡´æˆ–è€…æ•°æ®è¢«æ±¡æŸ“ç­‰æ„å¤–æƒ…å†µã€‚</p>
<p>çº¿ç¨‹ä¸å®‰å…¨ï¼šå°±æ˜¯ä¸æä¾›æ•°æ®è®¿é—®æ—¶çš„æ•°æ®ä¿æŠ¤ï¼Œå¤šä¸ªçº¿ç¨‹èƒ½å¤ŸåŒæ—¶æ“ä½œæŸä¸ªæ•°æ®ï¼Œä»è€Œå‡ºç°æ•°æ®ä¸ä¸€è‡´æˆ–è€…æ•°æ®æ±¡æŸ“ç­‰æ„å¤–æƒ…å†µã€‚</p>
</blockquote>
<p>æºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;</span><br><span class="line"> implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable &#123;</span><br><span class="line">    /**</span><br><span class="line">    * åˆ—è¡¨å…ƒç´ é›†åˆæ•°ç»„å¦‚æœæ–°å»ºArrayListå¯¹è±¡æ—¶æ²¡æœ‰æŒ‡å®šå¤§å°ï¼Œé‚£ä¹ˆä¼šå°† </span><br><span class="line">    * EMPTY_ELEMENTDATAèµ‹å€¼ç»™elementDataï¼Œ</span><br><span class="line">    * å¹¶åœ¨ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶ï¼Œå°†åˆ—è¡¨å®¹é‡è®¾ç½®ä¸ºDEFAULT_CAPACITY </span><br><span class="line">    */</span><br><span class="line">    transient Object[] elementData; </span><br><span class="line">    // åˆ—è¡¨å¤§å°ï¼ŒelementDataä¸­å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°</span><br><span class="line">    private int size;</span><br><span class="line"></span><br><span class="line">    public boolean add(E e) &#123;</span><br><span class="line">    ensureCapacityInternal(size + 1); // Increments modCount!!</span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ArrayList çš„å®ç°ä¸»è¦å°±æ˜¯ï¼š<br>1ï¸âƒ£ç”¨äº†ä¸€ä¸ª Object çš„æ•°ç»„ï¼Œç”¨æ¥ä¿å­˜æ‰€æœ‰çš„å…ƒç´ ï¼›<br>2ï¸âƒ£ä¸€ä¸ª size å˜é‡ç”¨æ¥ä¿å­˜å½“å‰æ•°ç»„ä¸­å·²ç»æ·»åŠ äº†å¤šå°‘å…ƒç´ ã€‚</p>
<p>ensureCapacityInternal() çš„ä½œç”¨å°±æ˜¯å¦‚æœå°†å½“å‰çš„æ–°å…ƒç´ åŠ åˆ°åˆ—è¡¨åé¢ï¼Œåˆ¤æ–­åˆ—è¡¨çš„ elementData æ•°ç»„çš„å¤§å°æ˜¯å¦æ»¡è¶³ã€‚å¦‚æœ size + 1 çš„è¿™ä¸ªéœ€æ±‚é•¿åº¦å¤§äº elementData è¿™ä¸ªæ•°ç»„çš„é•¿åº¦ï¼Œé‚£ä¹ˆå°±è¦å¯¹è¿™ä¸ªæ•°ç»„è¿›è¡Œæ‰©å®¹ã€‚ç”±æ­¤çœ‹åˆ° add å…ƒç´ æ—¶ï¼Œå®é™…æœ‰ä¸¤ä¸ªå¤§çš„æ­¥éª¤ï¼š<br>1ï¸âƒ£åˆ¤æ–­ elementData æ•°ç»„ capacity å®¹é‡æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Œæ˜¯å¦éœ€è¦æ‰©å®¹ã€‚<br>2ï¸âƒ£åœ¨ elementData å¯¹åº”ä½ç½®ä¸Šè®¾ç½®å€¼ã€‚<br><code>è¿™æ ·å°±å‡ºç°äº†ç¬¬ä¸€ä¸ªå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨çš„éšæ‚£ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹è¿›è¡Œ add æ“ä½œæ—¶å¯èƒ½ä¼šå¯¼è‡´ elementData æ•°ç»„è¶Šç•Œã€‚</code></p>
<hr>
<p>ä¸ºä»€ä¹ˆä¼šæ•°ç»„è¶Šç•ŒArrayIndexOutOfBoundsExceptionï¼Ÿ</p>
<p>ArrayList é»˜è®¤æ•°ç»„å¤§å°ä¸º 10ã€‚å‡è®¾ç°åœ¨å·²ç»æ·»åŠ è¿›å» 9 ä¸ªå…ƒç´ äº†ï¼Œsize &#x3D; 9ã€‚</p>
<p>1ã€çº¿ç¨‹ A æ‰§è¡Œå®Œ add æ–¹æ³•ä¸­çš„ ensureCapacityInternal(size+1) æŒ‚èµ·äº†ã€‚<br>2ã€çº¿ç¨‹ B å¼€å§‹æ‰§è¡Œï¼Œæ ¡éªŒæ•°ç»„å®¹é‡å‘ç°ä¸éœ€è¦æ‰©å®¹ã€‚äºæ˜¯æŠŠ â€œbâ€ æ”¾åœ¨äº†ä¸‹æ ‡ä¸º 9 çš„ä½ç½®ï¼Œä¸” size è‡ªå¢ 1ã€‚æ­¤æ—¶ size &#x3D; 10ã€‚<br>3ã€çº¿ç¨‹ A æ¥ç€æ‰§è¡Œï¼Œå°è¯•æŠŠ â€œaâ€ æ”¾åœ¨ä¸‹æ ‡ä¸º 10 çš„ä½ç½®ï¼Œå› ä¸º size &#x3D; 10ã€‚ä½†å› ä¸ºæ•°ç»„è¿˜æ²¡æœ‰æ‰©å®¹ï¼Œæœ€å¤§çš„ä¸‹æ ‡æ‰ä¸º 9ï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºæ•°ç»„è¶Šç•Œå¼‚å¸¸ArrayIndexOutOfBoundsExceptionã€‚</p>
<hr>
<p>ä¸ºä»€ä¹ˆä¼šæ•°æ®ä¸¢å¤±ï¼Ÿ</p>
<p>ArrayListçº¿ç¨‹ä¸å®‰å…¨ï¼Œå½“ä¸€æ¡çº¿ç¨‹æ‰§è¡Œlist.add()çš„æ—¶å€™ä¼šå‡ºç°è¢«å¦ä¸€æ¡çº¿ç¨‹çš„å€¼è¦†ç›–ï¼Œæ¯”å¦‚çº¿ç¨‹Aå¯¹listè¿›è¡Œaddï¼Œæºå¸¦çš„sizeæ˜¯nï¼ŒåŒæ—¶çº¿ç¨‹Bä¹Ÿè¿›è¡Œaddæ“ä½œï¼Œæºå¸¦çš„sizeä¹Ÿæ˜¯nï¼Œæ‰€ä»¥ArrayListæ²¡æœ‰è¾¾åˆ°æ‰©å®¹çš„æ¡ä»¶ï¼ŒAçš„å€¼åº”è¯¥æ”¾åœ¨ArrayListçš„ç¬¬nä½ï¼Œä½†æ˜¯Bçš„å€¼ä¹Ÿå°†æ”¾åœ¨ç¬¬nä½ï¼Œè¦†ç›–äº†Açš„å€¼ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p>
<p>æºç ï¼š<br>ç¬¬äºŒæ­¥ elementData[size++] &#x3D; e è®¾ç½®å€¼çš„æ“ä½œåŒæ ·ä¼šå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œè¿™æ­¥æ“ä½œä¹Ÿä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒç”±å¦‚ä¸‹ä¸¤æ­¥æ“ä½œæ„æˆï¼š<br>elementData[size] &#x3D; e;<br>size &#x3D; size + 1;</p>
<p>ArrayList ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼š<br><a href="https://blog.csdn.net/ChineseSoftware/article/details/117047757">https://blog.csdn.net/ChineseSoftware/article/details/117047757</a></p>
<hr>
<p>ArrayListçš„æ‰€æœ‰æ–¹æ³•éƒ½æ²¡æœ‰åŠ Lockï¼Œä¹Ÿæ²¡æœ‰åŠ synchronizedï¼Œå› æ­¤åœ¨å¹¶å‘æ“ä½œä¸‹ï¼Œæ‰©å®¹å‡½æ•°grow()ä¼šå­˜åœ¨é—®é¢˜ã€‚</p>
<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š<br>elementDataæ•°ç»„åˆšåˆšæ·»åŠ äº†æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åˆšå¥½æ»¡å‘˜äº†<br>è¿™æ—¶2ä¸ªçº¿ç¨‹åŒæ—¶åˆè°ƒç”¨äº†addï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦æ‰§è¡Œgrowè¿›è¡Œæ‰©å®¹<br>ç¬¬1ä¸ªçº¿ç¨‹è°ƒç”¨å®Œgrow()ï¼Œç„¶åä¹Ÿè°ƒç”¨äº†elementData[size++] &#x3D; eï¼ŒæŠŠæ–°å…ƒç´ æ·»åŠ ä¸Šå»<br>ç¬¬2ä¸ªçº¿ç¨‹åˆè°ƒç”¨ä¸€æ¬¡grow()ï¼Œæ•´ä¸ªelementDataæ•°ç»„å°±ä¹±æ‰äº†ã€‚</p>
<h4 id="âœ…å¤šçº¿ç¨‹æƒ…å†µä¸‹è¯¥ç”¨ä»€ä¹ˆï¼š"><a href="#âœ…å¤šçº¿ç¨‹æƒ…å†µä¸‹è¯¥ç”¨ä»€ä¹ˆï¼š" class="headerlink" title="âœ…å¤šçº¿ç¨‹æƒ…å†µä¸‹è¯¥ç”¨ä»€ä¹ˆï¼š"></a>âœ…å¤šçº¿ç¨‹æƒ…å†µä¸‹è¯¥ç”¨ä»€ä¹ˆï¼š</h4><p>1ã€ä½¿ç”¨ Vector åˆå§‹åŒ– list å¯¹è±¡ï¼Œæ•ˆç‡ä½<br><code>List&lt;String&gt; list = new Vector&lt;&gt;();</code><br>Vector.addä½¿ç”¨äº†synchronizedåŠ é”<br>è½¬æ¢æˆArrayListï¼š<br><code>List&lt;String&gt; newList = new ArrayList&lt;String&gt;(vector);</code></p>
<p>2ã€ä½¿ç”¨ Collections.synchronizedList<br><code>List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</code><br><code>List&lt;String&gt; list = Collections.synchronizedList(Lists.newArrayList());</code><br>addæ–¹æ³•åŒæ ·åŠ äº† synchronized é”ã€‚</p>
<p>3ã€ä½¿ç”¨ CopyOnWriteArrayList<br><code>List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;();</code></p>
<p>å†™æ—¶å¤åˆ¶ï¼Œå³å‘ä¸€ä¸ªå®¹å™¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¸ç›´æ¥å‘å½“å‰å®¹å™¨æ·»åŠ ï¼Œè€Œæ˜¯å°†å½“å‰å®¹å™¨è¿›è¡Œå¤åˆ¶ï¼Œç„¶åå‘æ–°å®¹å™¨è¿›è¡Œæ·»åŠ æ“ä½œï¼Œæœ€åå°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨ã€‚</p>
<p>è¿™æ ·çš„å¥½å¤„æ˜¯å…è®¸å¹¶å‘çš„è¯»è€Œä¸éœ€è¦åŠ é”ï¼ˆå› ä¸ºå®¹å™¨å†…å…ƒç´ æœªå‘ç”Ÿå˜åŒ–ï¼‰ï¼Œæå‡æ•ˆç‡ï¼Œä»…å†™æ—¶ä¸Šé”ï¼Œè¯»å’Œå†™å†ä¸åŒçš„å®¹å™¨ä¸­ï¼Œä½“ç°äº†è¯»å†™åˆ†ç¦»çš„æ€æƒ³ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public boolean add(E e) &#123;</span><br><span class="line">    final ReentrantLock lock = this.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    try &#123;</span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        int len = elements.length;</span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + 1);</span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        setArray(newElements);</span><br><span class="line">        return true;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸæ–‡ï¼š<a href="https://www.cnblogs.com/fhblikesky/p/13692641.html">https://www.cnblogs.com/fhblikesky/p/13692641.html</a></p>
<h4 id="âœ…listçš„ConcurrentModificationExceptioné—®é¢˜"><a href="#âœ…listçš„ConcurrentModificationExceptioné—®é¢˜" class="headerlink" title="âœ…listçš„ConcurrentModificationExceptioné—®é¢˜"></a>âœ…listçš„ConcurrentModificationExceptioné—®é¢˜</h4><p>é™¤äº†å¤šçº¿ç¨‹ä¿®æ”¹ArrayListçš„æ“ä½œä¼šé€ æˆè¯¥é—®é¢˜ä¹‹å¤–ï¼Œåœ¨è¿­ä»£å™¨ä¸­ç”¨list.addæˆ–list.removeå»æ·»åŠ åˆ é™¤listå…ƒç´ ï¼Œä¹Ÿä¼šé€ æˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Iterator it = myList.iterator();</span><br><span class="line">while (it.hasNext()) &#123;</span><br><span class="line">    String value = it.next();</span><br><span class="line">        if (value.equals( &quot;3&quot;)) &#123;</span><br><span class="line">            myList.remove(value);  // error</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for (Iterator it = myList.iterator(); it.hasNext();) &#123;</span><br><span class="line">    String value = it.next();</span><br><span class="line">        if (value.equals( &quot;3&quot;)) &#123;</span><br><span class="line">            myList.remove(value);  // error</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for (String value : myList) &#123;</span><br><span class="line">    System. out.println( &quot;List Value:&quot; + value);</span><br><span class="line">        if (value.equals( &quot;3&quot;)) &#123;</span><br><span class="line">            myList.remove(value);  // error</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p>åŸå› çœ‹æºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private class Itr implements Iterator&lt;E&gt; &#123;</span><br><span class="line">    int cursor;       // index of next element to return</span><br><span class="line">    int lastRet = -1; // index of last element returned; -1 if no such</span><br><span class="line">    int expectedModCount = modCount;</span><br><span class="line">    </span><br><span class="line">    public boolean hasNext() &#123;</span><br><span class="line">        return cursor != size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public E next() &#123;</span><br><span class="line">        checkForComodification();</span><br><span class="line">        int i = cursor;</span><br><span class="line">        if (i &gt;= size)</span><br><span class="line">            throw new NoSuchElementException();</span><br><span class="line">        Object[] elementData = ArrayList.this.elementData;</span><br><span class="line">        if (i &gt;= elementData.length)</span><br><span class="line">            throw new ConcurrentModificationException();</span><br><span class="line">        cursor = i + 1;</span><br><span class="line">        return (E) elementData[lastRet = i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void remove() &#123;</span><br><span class="line">        if (lastRet &lt; 0)</span><br><span class="line">            throw new IllegalStateException();</span><br><span class="line">        checkForComodification();</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            ArrayList.this.remove(lastRet);</span><br><span class="line">            cursor = lastRet;</span><br><span class="line">            lastRet = -1;</span><br><span class="line">            expectedModCount = modCount;</span><br><span class="line">        &#125; catch (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">            throw new ConcurrentModificationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    final void checkForComodification() &#123;</span><br><span class="line">        if (modCount != expectedModCount)</span><br><span class="line">            throw new ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>cursorï¼šè¡¨ç¤ºä¸‹ä¸€ä¸ªè¦è®¿é—®çš„å…ƒç´ çš„ç´¢å¼•ï¼Œä»next()æ–¹æ³•çš„å…·ä½“å®ç°å°±å¯çœ‹å‡º</li>
<li>lastRetï¼šè¡¨ç¤ºä¸Šä¸€ä¸ªè®¿é—®çš„å…ƒç´ çš„ç´¢å¼•</li>
<li>expectedModCountï¼šè¡¨ç¤ºå¯¹ArrayListä¿®æ”¹æ¬¡æ•°çš„æœŸæœ›å€¼ï¼Œå®ƒçš„åˆå§‹å€¼ä¸ºmodCountã€‚</li>
<li>modCount: æ˜¯åœ¨ ArrayList ä¸­èµ‹å€¼çš„ï¼Œå¹¶ä¸”åˆå§‹å€¼ä¸º 0ï¼Œåœ¨ add å’Œ remove çš„æ—¶å€™ï¼ˆä¿®æ”¹å…ƒç´ çš„æ—¶å€™ï¼‰ä¼šå¢åŠ  1.</li>
</ul>
<p>hasNextæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public boolean hasNext() &#123;</span><br><span class="line">    return cursor != size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>hasNext æ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­çš„ size æ˜¯ ArrayList ä¸­çš„å˜é‡ï¼Œè¿™ä¸ª ConcurrentModificationException å¼‚å¸¸å­˜åœ¨çš„åŸå› ä¹‹ä¸€å°±åœ¨è¿™ä¸ªæ–¹æ³•ä½“ç°å‡ºæ¥äº†ï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨è¿­ä»£å™¨éå†æ—¶ï¼ŒArrayListæ•°ç»„å…ƒç´ å˜å°‘å¯¼è‡´ cursor &gt; sizeï¼Œç„¶åæ•°ç»„è¶Šç•Œã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹å½“ cursor &#x3D;&#x3D; sizeä»£è¡¨å·²ç»åˆ°æ•°ç»„å°½å¤´äº†.</p>
<p>next æ–¹æ³•:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public E next() &#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    int i = cursor;</span><br><span class="line">    if (i &gt;= size)</span><br><span class="line">        throw new NoSuchElementException();</span><br><span class="line">    Object[] elementData = ArrayList.this.elementData;</span><br><span class="line">    if (i &gt;= elementData.length)</span><br><span class="line">        throw new ConcurrentModificationException();</span><br><span class="line">    cursor = i + 1;</span><br><span class="line">    return (E) elementData[lastRet = i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>next æ–¹æ³•ä¸­å…ˆæ˜¯åˆ¤æ–­äº† modCount æ˜¯å¦ç­‰äº expectedModCountï¼Œä¸ç›¸ç­‰åˆ™æŠ›å‡º å¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼Œå¦åˆ™å–åˆ°æ¸¸æ ‡ï¼Œç„¶ååˆ¤æ–­æ¸¸æ ‡æ˜¯å¦å¤§äºæ•°ç»„é•¿åº¦æˆ–è€…å…ƒç´ ä¸ªæ•°ã€‚æœ€åæ¸¸æ ‡åŠ ä¸€ï¼Œç„¶åè¿”å›æ•°çš„åŒæ—¶ä½¿ lastRet ç­‰äº iã€‚</p>
<p>removeæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void remove() &#123;</span><br><span class="line">    if (lastRet &lt; 0)</span><br><span class="line">        throw new IllegalStateException();</span><br><span class="line">    checkForComodification();</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        ArrayList.this.remove(lastRet);</span><br><span class="line">        cursor = lastRet;</span><br><span class="line">        lastRet = -1;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">    &#125; catch (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">        throw new ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ remove æ‰å…ƒç´ çš„æ—¶å€™æ›´æ–°ä¸‹è‡ªå·±çš„ expectedModCountã€‚æ³¨æ„çš„æ˜¯removeå lastRet ä¼šå˜æˆ -1ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è¿ç»­ remove ä¸¤æ¬¡ï¼Œå› ä¸ºåœ¨ next ä¸­æ£€æŸ¥äº† lastRet çš„å€¼ä¸èƒ½å°äº 0ã€‚</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">final void checkForComodification() &#123;</span><br><span class="line">if (modCount != expectedModCount)</span><br><span class="line">throw new ConcurrentModificationException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“modCount !&#x3D; expectedModCountæ—¶ï¼Œæ‰§è¡Œnext()å°±ä¼šæŠ›å‡ºConcurrentModificationException<br>è€Œä»€ä¹ˆæ—¶å€™ä¼šé€ æˆmodCount !&#x3D; expectedModCountå‘¢ï¼Ÿ<br>ArrayList.add()å’Œremove()æ–¹æ³•ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡éƒ½ä¼šmodCount++ï¼Œä½†ä¸æ”¹å˜expectedModCountçš„å€¼ã€‚expectedModCountçš„å€¼æ˜¯åœ¨æ„å»ºè¿­ä»£çš„æ—¶å€™åˆå§‹ä¸ºexpectedModCount&#x3D;modCountçš„ã€‚<br>åœ¨æ„å»ºè¿­ä»£å™¨ä¹‹åï¼Œå†ä½¿ç”¨ArrayList.add()æ–¹æ³•å°±é€ æˆäº†modCount !&#x3D; expectedModCount<br>æ„å»ºè¿­ä»£å™¨åï¼Œç”¨è¿­ä»£å™¨æ¥addå’Œremoveå°±æ²¡æœ‰é—®é¢˜ã€‚å› ä¸ºå®ƒä¼šåœ¨æ”¹å˜modCountçš„å€¼ä¹‹åï¼ŒåˆæŠŠå€¼èµ‹ç»™äº†expectedModCountï¼Œä»è€Œä¿è¯modCount&#x3D;expectedModCount</p>
<hr>
<p>è§£å†³æ–¹æ³•ï¼šç”¨è¿­ä»£å™¨çš„removeæ–¹æ³•<br>å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œiteratoræ˜¯çº¿ç¨‹ç§æœ‰ï¼Œä¹Ÿå³æ˜¯è¯´expectedModCountæ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰ã€‚ä½¿ç”¨Vectorä¹Ÿä¸è¡Œã€‚<br>æ‰€ä»¥ï¼š<br>åœ¨ä½¿ç”¨iteratorè¿­ä»£çš„æ—¶å€™ä½¿ç”¨synchronizedæˆ–è€…Lockè¿›è¡ŒåŒæ­¥ã€‚ä¸æ¨èï¼Œå› ä¸ºå¢åˆ é€ æˆçš„åŒæ­¥é”å¯èƒ½ä¼šé˜»å¡éå†æ“ä½œã€‚<br>ä½¿ç”¨å¹¶å‘å®¹å™¨CopyOnWriteArrayListæˆ–è€…ConcurrentHashMapä»£æ›¿ArrayListå’ŒVectorã€‚CopyOnWriteArrayListä¸èƒ½ä½¿ç”¨Iterator.remove()è¿›è¡Œåˆ </p>
<p>ConcurrentModificationExceptionå¼‚å¸¸åŸå› å’Œè§£å†³æ–¹æ³•ï¼š<br><a href="https://blog.csdn.net/qq_44613591/article/details/114108920">https://blog.csdn.net/qq_44613591/article/details/114108920</a></p>
<p>Java éå†List ConcurrentModificationException å¼‚å¸¸è§£æï¼š<br><a href="https://blog.csdn.net/qq_30051139/article/details/54019515">https://blog.csdn.net/qq_30051139/article/details/54019515</a></p>
<h4 id="æ€»ç»“å¤šçº¿ç¨‹ä¸‹ArrayListçš„å‡ ä¸ªé—®é¢˜"><a href="#æ€»ç»“å¤šçº¿ç¨‹ä¸‹ArrayListçš„å‡ ä¸ªé—®é¢˜" class="headerlink" title="æ€»ç»“å¤šçº¿ç¨‹ä¸‹ArrayListçš„å‡ ä¸ªé—®é¢˜"></a>æ€»ç»“å¤šçº¿ç¨‹ä¸‹ArrayListçš„å‡ ä¸ªé—®é¢˜</h4><p>1.å¤šçº¿ç¨‹addå¯èƒ½ä¼šä¸¢æ•°æ®ï¼Œä¹Ÿå¯èƒ½æ•°ç»„è¶Šç•Œï¼Œä½†ä¸ä¼šå¹¶å‘é”™è¯¯<br>2.å¤šçº¿ç¨‹addåˆæ‰“å°ArrayListï¼Œä¼šå¹¶å‘é”™è¯¯ï¼Œåº”ä¸ºSystem.outæ–¹æ³•é‡Œç”¨äº†è¿­ä»£å™¨ã€‚<br>3.ç”¨è¿­ä»£å™¨éå†ä¸­åˆç”¨ArrayListçš„addå’Œremoveæ–¹æ³•ï¼Œä¼šå¹¶å‘é”™è¯¯ã€‚</p>
<p>å®éªŒï¼šå¯¹partitionåçš„æŸä¸ªsubListè¿›è¡Œaddçš„è¯ï¼Œä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œå› ä¸ºæ¯ä¸ªsubListæ˜¯å¤šå¤§å·²ç»è§„å®šå¥½ï¼Œå¯¹å‰é¢çš„subListè¿›è¡Œaddï¼Œaddçš„å…ƒç´ ä¼šè·‘åˆ°ä¸‹ä¸€ä¸ªsubListï¼Œä»¥æ­¤ç±»æ¨ã€‚åŸæ¥çš„listä¹Ÿä¼šæ”¹å˜ã€‚</p>
<p>å®éªŒï¼šå¯¹ArrayListåˆ†partitionï¼š<code>List&lt;List&lt;A&gt;&gt; partion = Lists.partition(list, 2);</code>ï¼Œå¾ªç¯å°†å„ä¸ªsubListä¼ å…¥ä¸åŒçš„çº¿ç¨‹ï¼Œå¹¶ä¸”åœ¨çº¿ç¨‹ä¸­å¯¹subListè¿›è¡Œaddï¼Œä¼šå¹¶å‘é”™è¯¯ã€‚<br>ğŸ¤”ä¸ºä»€ä¹ˆå•çº¯ArrayListå¤šçº¿ç¨‹addä¸ä¼šå¹¶å‘é”™è¯¯ï¼Œè¿™é‡Œå°±ä¼šã€‚<br>è¿™é‡Œä½¿ç”¨çš„æ˜¯AbstractListçš„addæ–¹æ³•ï¼Œå…¶ä¸­ç”¨åˆ°ArrayListçš„sizeæ–¹æ³•ä¼šæ£€æŸ¥modCountã€‚ä½†æ˜¯ArrayListçš„addæ–¹æ³•ç”¨çš„æ˜¯ArrayListçš„addæ–¹æ³•ã€‚</p>
<p>å®éªŒï¼šå¯¹ArrayListåˆ†partitionï¼š<code>List&lt;List&lt;A&gt;&gt; partion = Lists.partition(list, 2);</code>ï¼Œå¾ªç¯å°†å„ä¸ªsubListä¼ å…¥ä¸åŒçš„çº¿ç¨‹ï¼Œå¹¶ä¸”åœ¨çº¿ç¨‹ä¸­å¯¹subListåªæ˜¯æ‰“å°ï¼Œåœ¨ä¸»çº¿ç¨‹é‡Œå†addï¼Œä¼šå¹¶å‘é”™è¯¯ã€‚åŸå› ï¼šæ‰“å°Listä¹Ÿä¼šç”¨åˆ°è¿­ä»£å™¨ã€‚<br>å¦‚æœæ˜¯åœ¨çº¿ç¨‹é‡Œå¾ªç¯éå†æ‰“å°å•ä¸ªå…ƒç´ ï¼Œä¸ä¼šæœ‰é”™è¯¯ã€‚å¹¶ä¸”ä¼šå®æ—¶åæ˜ å¢åŠ çš„å…ƒç´ ã€‚</p>
<h3 id="javaæ³›å‹"><a href="#javaæ³›å‹" class="headerlink" title="javaæ³›å‹"></a>javaæ³›å‹</h3><p>1ã€æ³›å‹ä¸Objectçš„åŒºåˆ«</p>
<p>æ–¹æ³•çš„å£°æ˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public Object doSomething(Object obj) &#123;....&#125;</span><br><span class="line">â€‹</span><br><span class="line">public &lt;T&gt; T doSomething(T t) &#123;....&#125;</span><br></pre></td></tr></table></figure>

<p>æ— è®ºæ˜¯Tè¿˜æ˜¯ objï¼Œä½ éƒ½åªèƒ½è°ƒç”¨Objectç±»å‹çš„å‚æ•°å’Œè¿”å›å€¼ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ˜¯ä½¿ç”¨äº†æ³›å‹çš„ç±»ï¼Œå’Œæ™®é€šçš„è°ƒç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyClass&lt;Foo&gt; my = new MyClass&lt;Foo&gt;();</span><br><span class="line">Foo foo = new Foo();</span><br><span class="line"></span><br><span class="line">æ³›å‹ï¼š</span><br><span class="line">Foo newFoo = my.doSomething(foo);</span><br><span class="line"></span><br><span class="line">Object:</span><br><span class="line">Foo newFoo = (Foo) my.doSomething(foo);</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œä½¿ç”¨æ³›å‹çš„å¥½å¤„ï¼š</p>
<p>1.ä¸éœ€è¦åšå¼ºåˆ¶ç±»å‹è½¬æ¢</p>
<p>2.ç¼–è¯‘æ—¶æ›´å®‰å…¨ã€‚å¦‚æœä½¿ç”¨Objectç±»çš„è¯ï¼Œä½ æ²¡æ³•ä¿è¯è¿”å›çš„ç±»å‹ä¸€å®šæ˜¯Fooï¼Œä¹Ÿè®¸æ˜¯å…¶å®ƒç±»å‹ã€‚è¿™æ—¶ä½ å°±ä¼šåœ¨è¿è¡Œæ—¶å¾—åˆ°ä¸€ä¸ªç±»å‹è½¬æ¢å¼‚å¸¸ï¼ˆClassCastExceptionï¼‰</p>
<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/SDDDDDSA/article/details/120733398">https://blog.csdn.net/SDDDDDSA/article/details/120733398</a></p>
<p>2ã€æ³›å‹<code>&lt;T&gt; T</code> ä¸ T çš„åŒºåˆ«</p>
<p>æ–¹æ³•è¿”å›å‰çš„<code>&lt;T&gt; </code>æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå½“å‰æ–¹æ³•çš„å€¼ä¼ å…¥ç±»å‹å¯ä»¥å’Œç±»åˆå§‹åŒ–çš„æ³›å‹ç±»å‹ä¸åŒï¼Œä¹Ÿæ˜¯å°±æ˜¯è¯¥æ–¹æ³•çš„æ³›å‹ç±»å¯ä»¥è‡ªå®šä¹‰ï¼Œä¸éœ€è¦è·Ÿç±»åˆå§‹åŒ–çš„æ³›å‹ç±»ç›¸åŒ.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.jt.test;</span><br><span class="line"> </span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line"> * @Description</span><br><span class="line"> * æœ‰çš„æ–¹æ³•è¿”å›å€¼ä¸º &lt;T&gt; T ï¼Œæœ‰çš„æ–¹æ³•è¿”å›å€¼ä¸º T ,åŒºåˆ«åœ¨é‚£é‡Œ ï¼Ÿ</span><br><span class="line"> **/</span><br><span class="line">public class Request&lt;E&gt; &#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    public &lt;T&gt; T getObject(Class&lt;T&gt; tClass) throws IllegalAccessException, InstantiationException &#123;</span><br><span class="line">        T t = tClass.newInstance();</span><br><span class="line">        return t;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * æ–¹æ³•è¿”å›å‰çš„ &lt;T&gt; æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå½“å‰æ–¹æ³•çš„å€¼ä¼ å…¥ç±»å‹å¯ä»¥å’Œç±»åˆå§‹åŒ–çš„æ³›å‹ç±»å‹ä¸åŒï¼Œ</span><br><span class="line">     * ä¹Ÿæ˜¯å°±æ˜¯è¯¥æ–¹æ³•çš„æ³›å‹ç±»å¯ä»¥è‡ªå®šä¹‰ï¼Œä¸éœ€è¦è·Ÿç±»åˆå§‹åŒ–çš„æ³›å‹ç±»ç›¸åŒ</span><br><span class="line">     *</span><br><span class="line">     * å‚æ•° T</span><br><span class="line">     *  ç¬¬ä¸€ä¸ª è¡¨ç¤ºæ˜¯æ³›å‹</span><br><span class="line">     *  ç¬¬äºŒä¸ª è¡¨ç¤ºæ˜¯è¿”å›æ˜¯Tç±»å‹çš„æ•°æ®</span><br><span class="line">     *  ç¬¬ä¸‰ä¸ª è¡¨ç¤ºé™åˆ¶å‚æ•°ç±»å‹ä¸ºT</span><br><span class="line">     * @param data</span><br><span class="line">     * @param &lt;T&gt;</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private &lt;T&gt; T getListFirst(List&lt;T&gt; data) &#123;</span><br><span class="line">        if (data == null || data.size() == 0) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        return data.get(0);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    /**</span><br><span class="line">     * è¿™ä¸ªåªèƒ½ä¼ Tç±»å‹çš„æ•°æ®</span><br><span class="line">     * @param data</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private E getListFirst2(List&lt;E&gt; data) &#123;</span><br><span class="line">        if (data == null || data.size() == 0) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        return data.get(0);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;Integer&gt; data = new ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; data2 = new ArrayList&lt;&gt;();</span><br><span class="line">        // å…¥å‚ç”±List&lt;T&gt;çš„T å†³å®šï¼Œå› ä¸ºè¿”å›å€¼ä¸º&lt;T&gt; T ,æ‰€ä»¥å…¥å‚ä¸å— Request&lt;T&gt; å½±å“</span><br><span class="line">        Integer a = new Request&lt;String&gt;().getListFirst(data);</span><br><span class="line"> </span><br><span class="line">        // ç¼–è¯‘å‡ºé”™ï¼Œå…¥å‚ç”±Request&lt;T&gt; Tçš„å†³å®šï¼Œå—Request&lt;T&gt;å½±å“</span><br><span class="line">        //new Request&lt;String&gt;().getListFirst2(data);</span><br><span class="line"> </span><br><span class="line">        // æ²¡ä»€ä¹ˆåŒºåˆ«</span><br><span class="line">        String aa = new Request&lt;String&gt;().getListFirst(data2);</span><br><span class="line">        String bb = new Request&lt;String&gt;().getListFirst2(data2);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/qianzhitu/article/details/107962657">https://blog.csdn.net/qianzhitu/article/details/107962657</a></p>
<p>3ã€æ³›å‹é€šé…ç¬¦</p>
<p>æ³›å‹çš„æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ã€‚</p>
<p>å¸¸ç”¨çš„ Tï¼ŒEï¼ŒKï¼ŒVï¼Œï¼Ÿ</p>
<p>æœ¬è´¨ä¸Šè¿™äº›ä¸ªéƒ½æ˜¯é€šé…ç¬¦ï¼Œæ²¡å•¥åŒºåˆ«ï¼Œåªä¸è¿‡æ˜¯ç¼–ç æ—¶çš„ä¸€ç§çº¦å®šä¿—æˆçš„ä¸œè¥¿ã€‚æ¯”å¦‚ä¸Šè¿°ä»£ç ä¸­çš„ T ï¼Œæˆ‘ä»¬å¯ä»¥æ¢æˆ A-Z ä¹‹é—´çš„ä»»ä½•ä¸€ä¸ª å­—æ¯éƒ½å¯ä»¥ï¼Œå¹¶ä¸ä¼šå½±å“ç¨‹åºçš„æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯å¦‚æœæ¢æˆå…¶ä»–çš„å­—æ¯ä»£æ›¿ T ï¼Œåœ¨å¯è¯»æ€§ä¸Šå¯èƒ½ä¼šå¼±ä¸€äº›ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒTï¼ŒEï¼ŒKï¼ŒVï¼Œï¼Ÿæ˜¯è¿™æ ·çº¦å®šçš„ï¼š</p>
<p>ï¼Ÿè¡¨ç¤ºä¸ç¡®å®šçš„ java ç±»å‹<br>T (type) è¡¨ç¤ºå…·ä½“çš„ä¸€ä¸ªjavaç±»å‹<br>K V (key value) åˆ†åˆ«ä»£è¡¨javaé”®å€¼ä¸­çš„Key Value<br>E (element) ä»£è¡¨Element</p>
<p>æ›´å¤šï¼š<a href="https://blog.csdn.net/minkeyto/article/details/116205607">https://blog.csdn.net/minkeyto/article/details/116205607</a></p>
<p>å­¦é•¿æ•™å­¦å¦¹javaæ³›å‹ï¼š<a href="https://blog.csdn.net/m0_67401499/article/details/125401501">https://blog.csdn.net/m0_67401499/article/details/125401501</a></p>
<h3 id="javaå¯å˜å‚æ•°"><a href="#javaå¯å˜å‚æ•°" class="headerlink" title="javaå¯å˜å‚æ•°"></a>javaå¯å˜å‚æ•°</h3><p>javaå¯å˜å‚æ•°æ˜¯æŒ‡åœ¨è°ƒç”¨æ–¹æ³•æ—¶ä¼ å…¥ä¸å®šé•¿åº¦çš„å‚æ•°ï¼Œæœ¬è´¨ä¸Šæ˜¯åŸºäºæ•°ç»„å®ç°çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å‚æ•°ä¸ºå¯å˜å‚æ•°</span><br><span class="line">//åœ¨å®šä¹‰æ–¹æ³•æ—¶ï¼Œåœ¨æœ€åä¸€ä¸ªå½¢å‚ä¸ŠåŠ &quot;â€¦&quot;å°±è¡¨ç¤ºè¯¥å½¢å‚å¯ä»¥æ¥å—å¤šä¸ªå‚æ•°å€¼ï¼Œå¤šä¸ªå‚æ•°å€¼è¢«å½“åšæ•°ç»„ä¼ å…¥ã€‚</span><br><span class="line">public static void element(Integer... args)&#123; &#125;</span><br><span class="line">//å‚æ•°ä¸ºæ•°ç»„</span><br><span class="line">public static void element(Integer[] args)&#123; &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å‚æ•°ä¸ºå¯å˜å‚æ•°</span><br><span class="line">public static void element(Integer... args) &#123;</span><br><span class="line">    for (int arg : args) &#123;</span><br><span class="line">        System.out.print(arg + &quot;  &quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    //éƒ½å¯ä»¥</span><br><span class="line">    element(1,2,3);</span><br><span class="line">    int[] array=&#123;1,2,3&#125;;</span><br><span class="line">    element(array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âš ï¸å¯å˜å‚æ•°åªèƒ½åšä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œå‰é¢æœ‰æ²¡æœ‰å…¶ä»–å‚æ•°éƒ½å¯ä»¥ï¼Œä¸€ä¸ªå‡½æ•°æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå¯å˜å‚æ•°ã€‚</p>
<p>å¯å˜å‚æ•°åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç åï¼Œåœ¨æ–¹æ³•ç­¾åä¸­æ˜¯ä»¥æ•°ç»„å½¢æ€å‡ºç°çš„ï¼Œå¦‚æœä¸¤ä¸ªæ–¹æ³•ç­¾åç¼–è¯‘åçš„æ˜¯ä¸€è‡´çš„è¯ï¼Œæ˜¯ä¸èƒ½ç¼–è¯‘é€šè¿‡çš„ï¼Œä¸å¯ä»¥ä½œä¸ºæ–¹æ³•çš„é‡è½½ã€‚</p>
<p>å¯å˜å‚æ•°ä½œä¸ºå‚æ•°çš„æ–¹æ³•å¯ä»¥ä¼ å…¥æ•°ç»„ç±»å‹çš„æ•°æ®æˆ–è€…ç›´æ¥ä¼ å…¥å¤šä¸ªæ•°æ®ï¼Œä½†æ˜¯æ•°ç»„ä½œä¸ºå‚æ•°çš„æ–¹æ³•åªèƒ½ä¼ å…¥æ•°ç»„ç±»å‹çš„æ•°æ®ã€‚</p>
<p>åå°„æ—¶ï¼Œå¯å˜å‚æ•°çš„æ³¨æ„äº‹é¡¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Demo5 &#123;</span><br><span class="line"></span><br><span class="line">    public static void element(Integer... args)&#123;</span><br><span class="line">        System.out.println(args.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Integer[] arrry=&#123;1,2,3&#125;;</span><br><span class="line">        try &#123;</span><br><span class="line">            //åå°„æ˜¯è¿è¡Œæ—¶è·å–çš„ï¼Œåœ¨è¿è¡Œæ—¶çœ‹æ¥ï¼Œå¯å˜å‚æ•°å’Œæ•°ç»„ä¸Šæ˜¯ä¸€è‡´çš„ã€‚å› è€Œæ–¹æ³•çš„ç­¾åä¸º([java/lang/Integer;)V</span><br><span class="line">            //Methodå¯¹è±¡çš„æ–¹æ³•å£°æ˜ä¸ºObject invoke (Object obj,Object.. args)</span><br><span class="line">            //argsè™½ç„¶æ˜¯ä¸€ä¸ªå¯å˜é•¿åº¦çš„å‚æ•°ï¼Œä½†æ˜¯argsçš„é•¿åº¦å—é™äºè¯¥æ–¹æ³•å¯¹è±¡ä»£è¡¨çš„çœŸå®æ–¹æ³•çš„å‚æ•°åˆ—è¡¨é•¿åº¦,</span><br><span class="line">            //ä»è¿è¡Œæ—¶ç­¾åæ¥çœ‹ï¼Œ([java/lang/Integer;)Vå®é™…ä¸Šæ˜¯ä¸€ä¸ªå½¢å‚ï¼Œå³Integer[] args,å› æ­¤invoke (Object obj,Object.. args)ä¸­å¯å˜å‚æ•°argsçš„å®é™…å‚æ•°é•¿åº¦åªèƒ½ä¸º1ã€‚</span><br><span class="line">            Method method = Demo5.class.getMethod(&quot;element&quot;, Integer[].class);</span><br><span class="line">            //arrayçš„é•¿åº¦ä¸º3ï¼Œä¸ç¬¦åˆ</span><br><span class="line">            method.invoke(null,arrry);</span><br><span class="line">            //å°†Integer[]è½¬ä¸ºObject[]ï¼Œé•¿åº¦è¿˜æ˜¯ä¸º3ï¼Œä¸ç¬¦åˆ</span><br><span class="line">            method.invoke(null,(Object[])arrry);</span><br><span class="line">            //å°†æ•´ä¸ªInteger[]è½¬ä¸ºä¸€ä¸ªObjectï¼Œé•¿åº¦ä¸º1ï¼Œç¬¦åˆ</span><br><span class="line">            method.invoke(null,(Object)arrry);</span><br><span class="line">            //Object[]çš„é•¿åº¦ä¸º1ï¼Œç¬¦åˆï¼Œå’Œä¸Šé¢ç›¸åŒ</span><br><span class="line">            method.invoke(null,new Object[]&#123;arrry&#125;);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/weixin_43413307/article/details/125485292">https://blog.csdn.net/weixin_43413307/article/details/125485292</a></p>
<h3 id="ç±»ä¸­çš„å¸ƒå°”ç±»å‹getæ–¹æ³•æ³¨æ„"><a href="#ç±»ä¸­çš„å¸ƒå°”ç±»å‹getæ–¹æ³•æ³¨æ„" class="headerlink" title="ç±»ä¸­çš„å¸ƒå°”ç±»å‹getæ–¹æ³•æ³¨æ„"></a>ç±»ä¸­çš„å¸ƒå°”ç±»å‹getæ–¹æ³•æ³¨æ„</h3><p>@Getterè‡ªåŠ¨ç”Ÿæˆgetteræ–¹æ³•ï¼Œä½†æ˜¯ï¼š<br>1.Booleanç±»å‹,ç”Ÿæˆçš„getæ–¹æ³•æ˜¯getå¼€å¤´çš„(å»ºè®®ä½¿ç”¨è¿™ä¸ª).<br>2.booleanç±»å‹,ç”Ÿæˆçš„getæ–¹æ³•æ˜¯iså¼€å¤´çš„(ç”¨è¿™ä¸ªæœ€å¥½é‡å†™getXxx()æ ¼å¼çš„æ–¹æ³•).</p>
<p>ç”¨åˆ°å¸ƒå°”å€¼çš„å±æ€§æ—¶,æœ€å¥½ç»Ÿä¸€ä½¿ç”¨å¤§å†™çš„åŒ…è£…ç±»Boolean.<br>å¦‚æœç”¨å°å†™çš„booeanåŸºæœ¬ç±»å‹,æœ€å¥½é‡å†™getæ–¹æ³•,ä¿è¯æ˜¯getXxxxçš„æ ¼å¼å³å¯.<br>*å¦‚æœè¿™ä¸ªå¯¹è±¡æ¶‰åŠåˆ°åå°„,åå°„ä¸€èˆ¬ä¼šé»˜è®¤è°ƒå–å¯¹è±¡çš„getæ–¹æ³•,å¯¹äºè¿™ä¸ªisçš„æƒ…å†µ,æ˜¯èµ°ä¸é€šçš„.</p>
<h3 id="javaçš„nativeæ–¹æ³•"><a href="#javaçš„nativeæ–¹æ³•" class="headerlink" title="javaçš„nativeæ–¹æ³•"></a>javaçš„nativeæ–¹æ³•</h3><p>ä»€ä¹ˆæ˜¯nativeæ–¹æ³•ï¼Ÿ<br>ä¸€ä¸ªNative Methodæ˜¯ä¸€ä¸ªjavaè°ƒç”¨éjavaä»£ç çš„æ¥å£ã€‚Native Methodçš„å®ç°ç”±éjavaè¯­è¨€å®ç°ï¼Œæ¯”å¦‚Cã€‚è¿™ä¸ªç‰¹å¾å¹¶éjavaæ‰€ç‰¹æœ‰ï¼Œå¾ˆå¤šå…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¿™ä¸€æœºåˆ¶ï¼Œæ¯”å¦‚åœ¨Cï¼‹ï¼‹ä¸­ï¼Œä½ å¯ä»¥ç”¨extern â€œCâ€å‘ŠçŸ¥Cï¼‹ï¼‹ç¼–è¯‘å™¨å»è°ƒç”¨ä¸€ä¸ªCçš„å‡½æ•°ã€‚</p>
<p>ä½¿ç”¨nativeå…³é”®å­—è¯´æ˜è¿™ä¸ªæ–¹æ³•æ˜¯åŸç”Ÿå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨C&#x2F;C++è¯­è¨€å®ç°çš„ï¼Œå¹¶ä¸”è¢«ç¼–è¯‘æˆäº†DLLï¼Œç”±javaå»è°ƒç”¨ã€‚ è¿™äº›å‡½æ•°çš„å®ç°ä½“åœ¨DLLä¸­ï¼ŒJDKçš„æºä»£ç ä¸­å¹¶ä¸åŒ…å«ï¼Œä½ åº”è¯¥æ˜¯çœ‹ä¸åˆ°çš„ã€‚å¯¹äºä¸åŒçš„å¹³å°å®ƒä»¬ä¹Ÿæ˜¯ä¸åŒçš„ã€‚è¿™ä¹Ÿæ˜¯javaçš„åº•å±‚æœºåˆ¶ï¼Œå®é™…ä¸Šjavaå°±æ˜¯åœ¨ä¸åŒçš„å¹³å°ä¸Šè°ƒç”¨ä¸åŒçš„nativeæ–¹æ³•å®ç°å¯¹æ“ä½œç³»ç»Ÿçš„è®¿é—®çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼š<br>Thread.sleep(1000); è¿˜æœ‰ Thread.start0() éƒ½æ˜¯nativeæ–¹æ³•ã€‚<br>åœ¨JDK æºç  Object.class ç±»ä¸­çš„ getClass() æ–¹æ³•ã€hashCode()æ–¹æ³•ã€clone() æ–¹æ³•</p>
<p>nativeçš„æ„æ€å°±æ˜¯é€šçŸ¥æ“ä½œç³»ç»Ÿï¼Œ è¿™ä¸ªå‡½æ•°ä½ å¿…é¡»ç»™æˆ‘å®ç°ï¼Œå› ä¸ºæˆ‘è¦ä½¿ç”¨ã€‚ æ‰€ä»¥nativeå…³é”®å­—çš„å‡½æ•°éƒ½æ˜¯æ“ä½œç³»ç»Ÿå®ç°çš„ï¼Œ javaåªèƒ½è°ƒç”¨ã€‚<br>javaæ˜¯è·¨å¹³å°çš„è¯­è¨€ï¼Œæ—¢ç„¶æ˜¯è·¨äº†å¹³å°ï¼Œæ‰€ä»˜å‡ºçš„ä»£ä»·å°±æ˜¯ç‰ºç‰²ä¸€äº›å¯¹åº•å±‚çš„æ§åˆ¶ï¼Œè€Œjavaè¦å®ç°å¯¹åº•å±‚çš„æ§åˆ¶ï¼Œå°±éœ€è¦ä¸€äº›å…¶ä»–è¯­è¨€çš„å¸®åŠ©ï¼Œè¿™ä¸ªå°±æ˜¯nativeçš„ä½œç”¨äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.nativeæ–¹æ³•æ˜¯javaä¸å…¶ä»–è¯­è¨€åä½œçš„æ—¶å€™ä½¿ç”¨çš„ï¼Œåº•å±‚å®ç°ä¸æ˜¯java(c,c++)</span><br><span class="line">2.nativeå¹¶ä¸æ˜¯javaå®ç°çš„ï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨å°±å¥½ï¼Œä¸éœ€è¦ç®¡ä»–åº•å±‚å®ç°</span><br><span class="line">3.nativeæ–¹æ³•å®é™…ä¸Šæ˜¯javaç”¨äºè°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿçš„æ–¹æ³•,javaåªèƒ½è°ƒç”¨ï¼Œä¸èƒ½æŸ¥çœ‹å’Œä¿®æ”¹</span><br><span class="line">4.javaæ˜¯è·¨å¹³å°è¯­è¨€ï¼Œè‡ªç„¶è€Œç„¶ä¼šå¤±å»å¯¹åº•å±‚çš„æ§åˆ¶ï¼Œäºæ˜¯æƒ³è¦è°ƒç”¨åº•å±‚æ–¹æ³•ï¼Œå°±å¿…é¡»ä½¿ç”¨nativeæ–¹æ³•é—´æ¥è°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿçš„æ–¹æ³•(c,c++å®ç°)</span><br><span class="line">5.éšç€javaçš„ä¸æ–­å‘å±•ï¼Œnativeæ–¹æ³•è¶Šæ¥è¶Šå°‘</span><br><span class="line">6.nativeæ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œå…¶ä¿®é¥°çš„æ–¹æ³•åªè¯´æ˜ä¸å®ç°</span><br><span class="line">7.nativeæ–¹æ³•åŠ è½½åˆ° æœ¬åœ°æ ˆä¸­</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/TheWayForDream/article/details/122202601</span><br></pre></td></tr></table></figure>

<p>JNIï¼šJava Native Interfaceï¼š<a href="https://www.zhihu.com/question/28001771/answer/2049534464">https://www.zhihu.com/question/28001771/answer/2049534464</a><br>nativeç”¨æ³•ï¼š<a href="https://www.jb51.net/article/195760.html">https://www.jb51.net/article/195760.html</a></p>
<h3 id="printStackTrace-æ–¹æ³•"><a href="#printStackTrace-æ–¹æ³•" class="headerlink" title="printStackTrace()æ–¹æ³•"></a>printStackTrace()æ–¹æ³•</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try&#123;</span><br><span class="line">â€¦ &#125; catch(Exception e) &#123;</span><br><span class="line">e.printStackTrace() ; &#125;</span><br></pre></td></tr></table></figure>

<p>tryè¯­å¥ä¸­å‡ºç°å¼‚å¸¸æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†catchæ‹¬å·ä¸­çš„Exception e åˆå§‹åŒ–ã€‚</p>
<p>printStackTrace()ï¼šåœ¨å‘½ä»¤è¡Œæ‰“å°å¼‚å¸¸ä¿¡æ¯åœ¨ç¨‹åºä¸­å‡ºé”™çš„ä½ç½®åŠåŸå› ã€‚<br>System.out.println(e)ï¼šæ‰“å°å¼‚å¸¸</p>
<p>ä¸å»ºè®®ä½¿ç”¨printStackTrace()çš„åŸå› ï¼š<br>e.printStackTrace() è¯­å¥è¦äº§ç”Ÿçš„å­—ç¬¦ä¸²è®°å½•çš„æ˜¯å †æ ˆä¿¡æ¯ï¼Œå¤ªé•¿å¤ªå¤šï¼Œå†…å­˜ä¼šè¢«å¡«æ»¡ã€‚</p>
<p>çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚è®¿é—®æ­¤æ¥å£ -&gt; ä»£ç æœ¬èº«æœ‰é—®é¢˜ï¼Œå¾ˆå¤šæƒ…å†µä¸‹æŠ›å¼‚å¸¸  -&gt; e.printStackTrace() æ¥æ‰“å°å¼‚å¸¸åˆ°æ§åˆ¶å° -&gt; äº§ç”Ÿé”™è¯¯å †æ ˆå­—ç¬¦ä¸²åˆ°å­—ç¬¦ä¸²æ± å†…å­˜ç©ºé—´ -&gt; æ­¤å†…å­˜ç©ºé—´ä¸€ä¸‹å­è¢«å æ»¡äº† -&gt; å¼€å§‹åœ¨æ­¤å†…å­˜ç©ºé—´äº§å‡ºå­—ç¬¦ä¸²çš„çº¿ç¨‹æœªå®Œæˆï¼Œå°±æ²¡ç©ºé—´äº† -&gt;  å¤§é‡çº¿ç¨‹äº§å‡ºå­—ç¬¦ä¸²äº§å‡ºåˆ°ä¸€åŠï¼Œç­‰åœ¨è¿™å„¿ï¼ˆç­‰æœ‰å†…å­˜äº†ç»§ç»­æï¼‰-&gt; ç›¸äº’ç­‰å¾…ï¼Œç­‰å†…å­˜ï¼Œé”æ­»äº†ï¼Œæ•´ä¸ªåº”ç”¨æŒ‚æ‰äº†ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸å»ºè®®printStackTraceï¼š<a href="https://blog.csdn.net/kzadmxz/article/details/89914896">https://blog.csdn.net/kzadmxz/article/details/89914896</a></p>
<p>å»ºè®®ï¼šlogger.error(â€œ***â€,  e);</p>
<h3 id="ç”Ÿæˆéšæœºæ•°"><a href="#ç”Ÿæˆéšæœºæ•°" class="headerlink" title="ç”Ÿæˆéšæœºæ•°"></a>ç”Ÿæˆéšæœºæ•°</h3><p>âœ…1.ä½¿ç”¨Mathæ–¹æ³•</p>
<p>javaæœ¬èº«çš„ï¼Œä¸éœ€è¦å¯¼å…¥åŒ…ï¼ŒMath.random()éšæœºç”Ÿæˆä¸€ä¸ªdoubleç±»å‹[0ï¼Œ1)ï¼Œå¦‚æœæƒ³ç”Ÿæˆ1~100çš„éšæœºæ•°:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int num = (int)(Math.random()*100)+1;</span><br><span class="line">System.out.println(num);</span><br><span class="line">System.out.println((int)0.01); //0</span><br></pre></td></tr></table></figure>

<p>âœ…2.ä½¿ç”¨Randomæ–¹æ³•ç”Ÿæˆéšæœºæ•°</p>
<p>Randomç±»æ˜¯java.untilä¸‹çš„ä¸€ä¸ªæ ¹æ®éšæœºç®—æ³•çš„èµ·æºæ•°å­—è¿›è¡Œä¸€äº›å˜åŒ–ï¼Œä»è€Œå¾—åˆ°éšæœºæ•°å­—çš„æ–¹æ³•ã€‚</p>
<p>éšæœºç®—æ³•çš„èµ·æºæ•°å­—è¢«æˆä¸ºç§å­æ•°ï¼ˆseedï¼‰ã€‚</p>
<p>è™½ç„¶Randomç±»äº§ç”Ÿçš„æ•°å­—æ˜¯éšæœºçš„ï¼Œä½†åœ¨ç›¸åŒç§å­æ•°ï¼ˆseedï¼‰ä¸‹çš„ç›¸åŒæ¬¡æ•°äº§ç”Ÿçš„éšæœºæ•°æ˜¯ç›¸åŒçš„ï¼ˆä¼ªéšæœºï¼‰ã€‚</p>
<p>Randomä¸­å…±æœ‰ä¸¤ç§æ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1ã€public Randomï¼ˆï¼‰</span><br><span class="line">æ­¤æ„é€ æ–¹æ³•æ˜¯ä»¥ç³»ç»Ÿè‡ªèº«çš„æ—¶é—´ä¸ºç§å­æ•°æ¥æ„é€ Randomå¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">2ã€public Randomï¼ˆlong seedï¼‰</span><br><span class="line">æ­¤æ„é€ æ–¹æ³•å¯ä»¥è‡ªå·±æ¥é€‰å®šå…·ä½“çš„ç§å­æ¥æ„é€ Randomå¯¹è±¡ã€‚</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨æ–¹æ³•ï¼šéƒ½å¯ä»¥åŠ å‚æ•°è¡¨ç¤ºèŒƒå›´ï¼ŒèŒƒå›´æ˜¯å·¦é—­å³å¼€</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">random.nextInt()	è¿”å›å€¼ä¸ºæ•´æ•°,èŒƒå›´æ˜¯intç±»å‹èŒƒå›´</span><br><span class="line">random.nextLong()	è¿”å›å€¼ä¸ºé•¿æ•´å‹ï¼ŒèŒƒå›´æ˜¯longç±»å‹çš„èŒƒå›´</span><br><span class="line">random.nextFloat()	è¿”å›å€¼ä¸ºå°æ•°ï¼ŒèŒƒå›´æ˜¯[0,0.1]</span><br><span class="line">random.nextDouble()	è¿”å›å€¼ä¸ºå°æ•°ï¼ŒèŒƒå›´æ˜¯[0,0.1]</span><br><span class="line">random.nextBooleanï¼ˆï¼‰	è¿”å›å€¼ä¸ºbooleanå€¼ï¼Œtrueå’Œfalseæ¦‚ç‡ç›¸åŒ</span><br><span class="line">radom.nextGaussian()	è¿”å›å€¼ä¸ºå‘ˆé«˜æ–¯ï¼ˆâ€œæ­£æ€â€ï¼‰åˆ†å¸ƒçš„ double å€¼ï¼Œå…¶å¹³å‡å€¼æ˜¯ 0.0ï¼Œæ ‡å‡†å·®æ˜¯ 1.0</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Random r = new Random();//ä»¥ç³»ç»Ÿè‡ªèº«æ—¶é—´ä¸ºç§å­æ•°</span><br><span class="line">int i = r.nextInt();</span><br><span class="line">System.out.println(&quot;i&quot;+i);</span><br><span class="line">Scanner sc  =new Scanner(System.in);</span><br><span class="line">int j = sc.nextInt();</span><br><span class="line">Random r2 = new Random(j);//è‡ªå®šä¹‰ç§å­æ•°</span><br><span class="line">Random r3 = new Random(j);//è¿™é‡Œæ˜¯ä¸ºäº†éªŒè¯ä¸Šæ–¹çš„æ³¨æ„äº‹é¡¹ï¼šRandomç±»æ˜¯ä¼ªéšæœºï¼Œç›¸åŒç§å­æ•°ç›¸åŒæ¬¡æ•°äº§ç”Ÿçš„éšæœºæ•°ç›¸åŒ</span><br><span class="line">int num  = r2.nextInt(1000);</span><br><span class="line">int num2 = r3.nextInt(1000);</span><br><span class="line">System.out.println(&quot;num&quot;+num);</span><br><span class="line">System.out.println(&quot;num2&quot;+num2);</span><br></pre></td></tr></table></figure>

<p>âœ…3.ä½¿ç”¨SecureRandomç”Ÿæˆéšæœºæ•°</p>
<p>java.util.Randomçš„å®ä¾‹ä¸æ˜¯åŠ å¯†å®‰å…¨çš„ï¼Œè¦æ˜¯çŸ¥é“setSeedå€¼(å³æ—¶é—´æˆ³)ï¼Œå¾ˆæ˜æ˜¾èƒ½æŠŠéšæœºæ•°ç»™çŒœå‡ºæ¥ã€‚æ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨Randomã€‚SecureRandomæ¥è·å–åŠ å¯†å®‰å…¨çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œä»¥ä¾›å¯¹å®‰å…¨æ•æ„Ÿçš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚</p>
<p>åœ¨å®‰å…¨åº”ç”¨åœºæ™¯ï¼Œéšæœºæ•°åº”è¯¥ä½¿ç”¨å®‰å…¨çš„éšæœºæ•°ã€‚å¯†ç å­¦æ„ä¹‰ä¸Šçš„å®‰å…¨éšæœºæ•°ï¼Œè¦æ±‚å¿…é¡»ä¿è¯å…¶ä¸å¯é¢„æµ‹æ€§ã€‚</p>
<p>å¯†ç å­¦å®‰å…¨çš„ä¼ªéšæœºæ•°äº§ç”Ÿå™¨ï¼šJDKçš„java.security.SecureRandom</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SecureRandom random = new SecureRandom();</span><br><span class="line">String returnValue = &quot;&quot;;</span><br><span class="line">int randomInt = 0;</span><br><span class="line">int range = 9;</span><br><span class="line">for(int i=0; i&lt;5; i++ )&#123;</span><br><span class="line">    randomInt = random.nextInt(range+1);</span><br><span class="line">    returnValue = returnValue + randomInt;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(returnValue);</span><br><span class="line"></span><br><span class="line">secureRandom.setSeed(System.currentTimeMillis()); //ä½¿ç”¨ç³»ç»Ÿæ—¶é—´ä½œä¸ºç§å­</span><br><span class="line">å¦‚æœåŒä¸€æ¯«ç§’è¿ç»­è°ƒç”¨ï¼Œåˆ™å¾—åˆ°çš„éšæœºæ•°åˆ™æ˜¯ç›¸åŒçš„ã€‚</span><br><span class="line">ä¸è¦è‡ªå·±æŒ‡å®šç§å­ã€‚åº”å½“ä½¿ç”¨ç³»ç»Ÿéšæœºæºã€‚é‡‡ç”¨æ— å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSecureRandom() throws NoSuchAlgorithmException &#123;</span><br><span class="line">    //æŒ‡å®šç®—æ³•åç§°</span><br><span class="line">    SecureRandom secureRandom = SecureRandom.getInstance(&quot;SHA1PRNG&quot;);</span><br><span class="line">    secureRandom.setSeed(10000L);</span><br><span class="line">    for(int i = 0 ; i &lt; 10 ; i ++) &#123;</span><br><span class="line">        System.out.println(secureRandom.nextInt(1000));</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;-------------------&quot;);</span><br><span class="line">    secureRandom = new SecureRandom();</span><br><span class="line">    secureRandom.setSeed(10000L);</span><br><span class="line">    for(int i = 0; i &lt; 10 ; i ++) &#123;</span><br><span class="line">        System.out.println(secureRandom.nextInt(1000));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="getInstanceæ–¹æ³•"><a href="#getInstanceæ–¹æ³•" class="headerlink" title="getInstanceæ–¹æ³•"></a>getInstanceæ–¹æ³•</h3><p>ä¸¤ä¸ªä½¿ç”¨åœºæ™¯ï¼š</p>
<p>âœ…1.æŠ½è±¡ç±»</p>
<p>æŠ½è±¡ç±»æ˜¯æ— æ³•ç›´æ¥newå‡ºæ¥çš„ï¼Œæ‰€ä»¥æƒ³è¦é€šè¿‡å®ä¾‹åŒ–çš„è¯åªèƒ½é€šè¿‡getInstance()æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class GetInstanceTest &#123;</span><br><span class="line">    public static void main(String args[])</span><br><span class="line">    &#123;</span><br><span class="line">        Person p = Person.getInstance(&quot;Limbo&quot;);</span><br><span class="line">        p.eat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class Person &#123;</span><br><span class="line">    private String title;</span><br><span class="line">    public Person(String title) &#123;</span><br><span class="line">        this.title = title;</span><br><span class="line">    &#125;</span><br><span class="line">    abstract public void eat();</span><br><span class="line">    public static  PersonImpl getInstance(String title) &#123;</span><br><span class="line">        return new PersonImpl(title);</span><br><span class="line">    &#125;</span><br><span class="line">    //å¿…é¡»staticï¼š</span><br><span class="line">    static class PersonImpl extends Person</span><br><span class="line">    &#123;</span><br><span class="line">        public PersonImpl(String title) &#123;</span><br><span class="line">            super(title);</span><br><span class="line">        &#125;</span><br><span class="line">        @Override</span><br><span class="line">        public void eat()</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(&quot;Eat!!!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…2.å•ä¾‹è®¾è®¡æ¨¡å¼</p>
<p>ä¸€èˆ¬åœ¨å•ä¾‹æ¨¡å¼ä¸‹ä½¿ç”¨.getInstance()åˆ›å»ºå¯¹è±¡.<br>å•ä¾‹æ¨¡å¼ï¼šä¸€ä¸ªç±»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SingleTest &#123;</span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line">        Singleton s = Singleton.getInstance();</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Singleton &#123;</span><br><span class="line">    private String title;</span><br><span class="line">    private String content;</span><br><span class="line">    //åœ¨è‡ªå·±å†…éƒ¨å®šä¹‰è‡ªå·±çš„ä¸€ä¸ªå®ä¾‹</span><br><span class="line">    private static Singleton SINGLETON = null;</span><br><span class="line">    //private åªèƒ½åœ¨è‡ªå·±å†…éƒ¨ä¾›è‡ªå·±å»è®¿é—®</span><br><span class="line">    private Singleton(String title, String content) &#123;</span><br><span class="line">        this.title = title;</span><br><span class="line">        this.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">    //æ­¤é™æ€æ–¹æ³•ä¾›å¤–éƒ¨ç›´æ¥è®¿é—®</span><br><span class="line">    public static Singleton getInstance() &#123;</span><br><span class="line">        if (SINGLETON == null)</span><br><span class="line">            SINGLETON = new Singleton(&quot;Kobe&quot;, &quot;MVP&quot;);</span><br><span class="line">        return SINGLETON;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return this.title + &quot; - &quot; + this.content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>getInsance()t:åœ¨ä¸»å‡½æ•°å¼€å§‹æ—¶è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œæ­¤å¯¹è±¡æ˜¯staticçš„ï¼Œåœ¨å†…å­˜ä¸­ä¿ç•™ç€å®ƒçš„å¼•ç”¨ï¼Œå³å†…å­˜ä¸­æœ‰ä¸€å—åŒºåŸŸä¸“é—¨ç”¨æ¥å­˜æ”¾é™æ€æ–¹æ³•å’Œå˜é‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè°ƒç”¨å¤šæ¬¡è¿”å›åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p>(1)å¯¹è±¡ä½¿ç”¨ä¹‹å‰é€šè¿‡getinstanceå¾—åˆ°ï¼Œè€Œä¸éœ€è¦è‡ªå·±å®šä¹‰ï¼Œç”¨å®Œä¹‹åä¸éœ€è¦deleteï¼›</p>
<p>(2)new ä¸€å®šè¦ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ï¼Œåˆ†é…å†…å­˜ï¼›getInstance() åˆ™ä¸ä¸€å®šè¦å†æ¬¡åˆ›å»ºï¼Œå®ƒå¯ä»¥æŠŠä¸€ä¸ªå·²å­˜åœ¨çš„å¼•ç”¨ç»™ä½ ä½¿ç”¨ï¼Œè¿™åœ¨æ•ˆèƒ½ä¸Šä¼˜äºnewï¼›</p>
<p>(3) newåˆ›å»ºååªèƒ½å½“æ¬¡ä½¿ç”¨ï¼Œè€ŒgetInstance()å¯ä»¥è·¨æ ˆåŒºåŸŸä½¿ç”¨ï¼Œæˆ–è€…è¿œç¨‹è·¨åŒºåŸŸä½¿ç”¨ã€‚æ‰€ä»¥getInstance()é€šå¸¸æ˜¯staticé™æ€å®ä¾‹æ–¹æ³•ã€‚</p>
<p>æ‘˜è‡ªï¼š<a href="https://www.cnblogs.com/baxianhua/p/9341953.html">https://www.cnblogs.com/baxianhua/p/9341953.html</a></p>
<h3 id="lang3ä¸‹çš„Pair"><a href="#lang3ä¸‹çš„Pair" class="headerlink" title="lang3ä¸‹çš„Pair"></a>lang3ä¸‹çš„Pair</h3><p>org.apache.commons.lang3.tuple.Pair</p>
<p>Pair ç”¨äºå­˜å‚¨å·¦å³å…ƒç´ å¯¹ï¼ŒPair&lt;Left, Right&gt;ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªå­ç±»ï¼ŒImmutablePair å’Œ MutablePairã€‚</p>
<p>Pair å®ç°äº† java.util.Map.Entryï¼Œå› æ­¤ left å’Œ right ä¹Ÿå¯ä»¥è§†ä½œ key-valueã€‚ä¸åŒäºMapï¼ŒPairåªèƒ½å­˜ä¸€ç»„é”®å€¼å¯¹ã€‚</p>
<p>of æ–¹æ³• ä»¥ static è°ƒç”¨çš„å½¢å¼åˆ›å»ºä¸€ä¸ª Pair å®ä¾‹. é»˜è®¤åˆ›å»ºçš„æ˜¯ ImmutablePairã€‚left, rightå€¼final ä¿®é¥°ï¼Œ å€¼ç¬¬ä¸€æ¬¡è¢«è®¾ç½®åä¸å¯å˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Pair&lt;Integer, String&gt; pair = Pair.of(1, &quot;1&quot;);</span><br><span class="line">System.out.println(pair.getLeft());</span><br><span class="line">System.out.println(pair.getKey());</span><br><span class="line">System.out.println(pair.getRight());</span><br><span class="line">System.out.println(pair.getValue());</span><br><span class="line">pair.setValue(&quot;2&quot;); //java.lang.UnsupportedOperationException</span><br></pre></td></tr></table></figure>

<p>org.apache.commons.lang3.tuple.MutablePair<br>ç»§æ‰¿äº† Pairï¼Œleft å’Œ right å€¼å¯å˜ã€‚</p>
<p>Pairä¸Mapï¼š<br>1.å…±é€šç‚¹: Pair å’Œ Map éƒ½æ˜¯ä»¥ key, value è¿›è¡Œå­˜å‚¨ã€‚<br>2.ä¸åŒç‚¹:<br>Pair é€šè¿‡ getKey(), getValue() è·å– key å’Œ valueï¼Œæ²¡æœ‰å¢åŠ é”®å€¼å¯¹çš„æ“ä½œã€‚<br>Map æ˜¯é€šè¿‡ get(key) è·å– key å¯¹åº”çš„ valueï¼Œé€šè¿‡ values() è·å–æ‰€æœ‰çš„valueï¼Œè€Œä¸”è¿˜å¯ä»¥é€šè¿‡ put å¢åŠ é”®å€¼å¯¹ã€‚<br>Pair ä¿å­˜çš„æ˜¯ä¸€å¯¹ key-valueï¼Œè€Œ Map å¯ä»¥ä¿å­˜å¤šå¯¹ key-valueã€‚</p>
<p>âš ï¸Pairçš„ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼šVOä¸­ç”¨åˆ°çš„å°æ•°æ®ç»“æ„ï¼Œä¸æƒ³å†æ„é€ ä¸€ä¸ªpojoäº†ï¼Œæœ‰ä¸¤ç»„é”®å€¼å¯¹çš„æ•°æ®ï¼Œæ¯”å¦‚Pointï¼Œåªæœ‰xå’Œyã€‚å°±å¯ä»¥ç”¨<code>List&lt;Pair&lt;String, Double&gt;&gt;</code> è¡¨ç¤ºã€‚<br>âš ï¸ä½†æ˜¯Pairä¸èƒ½è¢«jsonè§£æã€‚</p>
<h3 id="å‡ ç§æ’åºç®—æ³•"><a href="#å‡ ç§æ’åºç®—æ³•" class="headerlink" title="å‡ ç§æ’åºç®—æ³•"></a>å‡ ç§æ’åºç®—æ³•</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-äº¤æ¢æ’åº</span><br><span class="line"> -å†’æ³¡æ’åº</span><br><span class="line"> -å¿«é€Ÿæ’åº</span><br><span class="line">-æ’å…¥æ’åº</span><br><span class="line"> -ç›´æ¥æ’å…¥æ’åº</span><br><span class="line"> -å¸Œå°”æ’åº</span><br><span class="line">-é€‰æ‹©æ’åº</span><br><span class="line"> -ç®€å•é€‰æ‹©æ’åº</span><br><span class="line"> -å †æ’åº</span><br><span class="line">-å½’å¹¶æ’åº</span><br><span class="line">-åŸºæ•°æ’åº</span><br></pre></td></tr></table></figure>

<h4 id="âœ…å†’æ³¡æ’åº"><a href="#âœ…å†’æ³¡æ’åº" class="headerlink" title="âœ…å†’æ³¡æ’åº"></a>âœ…å†’æ³¡æ’åº</h4><p>1.ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œåˆ™è¿›è¡Œäº¤æ¢,æ­¤æ—¶æœ€åçš„å…ƒç´ åº”æ˜¯æœ€å¤§çš„æ•°ã€‚<br>2.å¯¹å‰©ä½™å…ƒç´ é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹å…ƒç´ éœ€è¦æ¯”è¾ƒä¸ºæ­¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void bubbleSortOpt(int[] arr) &#123;</span><br><span class="line">    if(arr == null) &#123;</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line">    &#125;</span><br><span class="line">    if(arr.length &lt; 2) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    int temp = 0;</span><br><span class="line">    for(int i = 0; i &lt; arr.length - 1; i++) &#123;</span><br><span class="line">        for(int j = 0; j &lt; arr.length - i - 1; j++) &#123;</span><br><span class="line">            if(arr[j] &gt; arr[j + 1]) &#123;</span><br><span class="line">                temp = arr[j];</span><br><span class="line">                arr[j] = arr[j + 1];</span><br><span class="line">                arr[j + 1] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†’æ³¡æ’åºä¼˜åŒ–ï¼š<br>å‡å¦‚å¾…æ’åºæ•°ç»„æ˜¯ 2ã€1ã€3ã€4ã€5 è¿™æ ·çš„æƒ…å†µï¼ŒæŒ‰ç…§ä¸Šè¿°ä»£ç å®ç°ï¼Œç¬¬ä¸€æ¬¡å¾ªç¯å³å¯å¾—å‡ºæ­£ç¡®ç»“æœã€‚ä½†å¾ªç¯å¹¶ä¸ä¼šåœæ­¢ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°ç»“æŸä¸ºæ­¢ã€‚æ˜¾ç„¶ï¼Œä¹‹åçš„å¾ªç¯éå†æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½ï¼Œç”¨æ¥è¡¨ç¤ºå½“å‰æ¬¡å¾ªç¯æ˜¯å¦æœ‰äº¤æ¢ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¯´æ˜å½“å‰æ•°ç»„å·²ç»å®Œå…¨æ’åºï¼Œç›´æ¥è¿”å›ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static int bubbleSortOpt2(int[] arr) &#123;</span><br><span class="line">    if (arr == null) &#123;</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line">    &#125; else if (arr.length &lt; 2) &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int temp;</span><br><span class="line">    int count = 0;</span><br><span class="line">    for (int i = 0; i &lt; arr.length - 1; i++) &#123;</span><br><span class="line">        int flag = 1;</span><br><span class="line">        for (int j = 0; j &lt; arr.length - 1 - i; j++) &#123;</span><br><span class="line">            if (arr[j] &gt; arr[j + 1]) &#123;</span><br><span class="line">                temp = arr[j];</span><br><span class="line">                arr[j] = arr[j + 1];</span><br><span class="line">                arr[j + 1] = temp;</span><br><span class="line">                flag = 0;</span><br><span class="line">            &#125;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        // æ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼Œæ’åºå·²ç»å®Œæˆ</span><br><span class="line">        if (flag == 1) &#123;</span><br><span class="line">            return count;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†’æ³¡æ’åºå†ä¼˜åŒ–ï¼š<br>æ¯”å¦‚ 3ã€4ã€2ã€1ã€6ã€7ã€8 è¿™ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€æ¬¡å¾ªç¯åï¼Œå˜ä¸º 3ã€2ã€1ã€4ã€6ã€7ã€8 çš„é¡ºåºï¼Œæˆ‘ä»¬å‘ç°ï¼Œ1 ä¹‹åçš„ 4 ã€6ã€7ã€8 å·²ç»æœ‰åºäº†ï¼Œç¬¬äºŒæ¬¡å¾ªç¯å°±æ²¡å¿…è¦å¯¹åé¢è¿™æ®µå†éå†æ¯”è¾ƒã€‚<br>è®°å½•æœ€åå‘ç”Ÿäº¤æ¢çš„åœ°ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„åˆ†ç•Œç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static int bubbleSortOpt3(int[] arr) &#123;</span><br><span class="line"></span><br><span class="line">    if (arr == null) &#123;</span><br><span class="line">        throw new RuntimeException();</span><br><span class="line">    &#125; else if (arr.length &lt; 2) &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int temp;</span><br><span class="line">    int count = 0;</span><br><span class="line">    int len = arr.length - 1;</span><br><span class="line">    for (int i = 0; i &lt; len; i++) &#123;</span><br><span class="line">        // è®°å½•æœ€åä¸€æ¬¡äº¤æ¢ä½ç½®</span><br><span class="line">        int lastChange = 0;</span><br><span class="line">        for (int j = 0; j &lt; len; j++) &#123;</span><br><span class="line">            if (arr[j] &gt; arr[j + 1]) &#123;</span><br><span class="line">                temp = arr[j];</span><br><span class="line">                arr[j] = arr[j + 1];</span><br><span class="line">                arr[j + 1] = temp;</span><br><span class="line">                // æ¯äº¤æ¢ä¸€æ¬¡æ›´æ–°ä¸€æ¬¡</span><br><span class="line">                lastChange = j;</span><br><span class="line">            &#125;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        // æ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼Œæ’åºå·²ç»å®Œæˆ</span><br><span class="line">        if (lastChange == 0) &#123;</span><br><span class="line">            return count;</span><br><span class="line">        &#125;</span><br><span class="line">        len = lastChange;</span><br><span class="line">    &#125;</span><br><span class="line">    return count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…å¿«é€Ÿæ’åº"><a href="#âœ…å¿«é€Ÿæ’åº" class="headerlink" title="âœ…å¿«é€Ÿæ’åº"></a>âœ…å¿«é€Ÿæ’åº</h4><p>å¿«é€Ÿæ’åºçš„æ€æƒ³å¾ˆç®€å•ï¼Œå…ˆæ‰¾ä¸€ä¸ªåŸºå‡†æ•°ï¼Œå…ˆæŠŠå¾…æ’åºçš„æ•°ç»„æ ¹æ®åŸºå‡†æ•°æ‹†æˆå·¦å³ä¸¤ä¸ªåŒºé—´ï¼Œå·¦è¾¹éƒ½æ¯”ä¸­é—´çš„åŸºå‡†æ•°å°ï¼Œå³è¾¹éƒ½æ¯”åŸºå‡†æ•°å¤§ã€‚æ¥ç€å·¦å³ä¸¤è¾¹å„è‡ªå†åšåŒæ ·çš„æ“ä½œï¼Œå®Œæˆåå†æ‹†åˆ†å†ç»§ç»­ï¼Œä¸€ç›´åˆ°å„åŒºé—´åªæœ‰ä¸€ä¸ªæ•°ä¸ºæ­¢ã€‚<br>ç®—æ³•çš„å®ç°éœ€è¦ç”¨åˆ°é€’å½’ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void quickSort(int[] arr, int start, int end) &#123;</span><br><span class="line"></span><br><span class="line">    if(start &lt; end) &#123;</span><br><span class="line">        // æŠŠæ•°ç»„ä¸­çš„é¦–ä½æ•°å­—ä½œä¸ºåŸºå‡†æ•°</span><br><span class="line">        int pivot = arr[start];</span><br><span class="line">        // è®°å½•éœ€è¦æ’åºçš„ä¸‹æ ‡</span><br><span class="line">        int low = start;</span><br><span class="line">        int high = end;</span><br><span class="line">        // å¾ªç¯æ‰¾åˆ°æ¯”åŸºå‡†æ•°å¤§çš„æ•°å’Œæ¯”åŸºå‡†æ•°å°çš„æ•°</span><br><span class="line">        while(low &lt; high) &#123;</span><br><span class="line">            // å³è¾¹çš„æ•°å­—æ¯”åŸºå‡†æ•°å¤§</span><br><span class="line">            while(low &lt; high &amp;&amp; arr[high] &gt;= pivot) &#123;</span><br><span class="line">                high--;</span><br><span class="line">            &#125;</span><br><span class="line">            // ä½¿ç”¨å³è¾¹çš„æ•°æ›¿æ¢å·¦è¾¹çš„æ•°</span><br><span class="line">            arr[low] = arr[high];</span><br><span class="line">            // å·¦è¾¹çš„æ•°å­—æ¯”åŸºå‡†æ•°å°</span><br><span class="line">            while(low &lt; high &amp;&amp; arr[low] &lt;= pivot) &#123;</span><br><span class="line">                low++;</span><br><span class="line">            &#125;</span><br><span class="line">            // ä½¿ç”¨å·¦è¾¹çš„æ•°æ›¿æ¢å³è¾¹çš„æ•°</span><br><span class="line">            arr[high] = arr[low];</span><br><span class="line">        &#125;</span><br><span class="line">        // æŠŠæ ‡å‡†å€¼èµ‹ç»™ä¸‹æ ‡é‡åˆçš„ä½ç½®</span><br><span class="line">        arr[low] = pivot;</span><br><span class="line">        // å¤„ç†æ‰€æœ‰å°çš„æ•°å­—</span><br><span class="line">        quickSort(arr, start, low);</span><br><span class="line">        // å¤„ç†æ‰€æœ‰å¤§çš„æ•°å­—</span><br><span class="line">        quickSort(arr, low + 1, end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨ Java å®ç°çš„å…«ç§å¸¸ç”¨æ’åºç®—æ³•:<br><a href="https://blog.csdn.net/CSDN_handsome/article/details/109055036">https://blog.csdn.net/CSDN_handsome/article/details/109055036</a></p>
<p>æƒ³å®ç°ä¸€ä¸ªæ ¹æ®å¯¹è±¡æŸå±æ€§é¦–å°¾ç›¸æ¥çš„æ’åºï¼Œç”¨Comparatorè‡ªå®šä¹‰æ’åºæ²¡è¡Œå¾—é€šï¼Œæ‰€ä»¥ï¼šå…ˆå¼„ä¸€ä¸ªendçš„Setï¼Œç„¶åä¾¿åˆ©startï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åé€ ä¸€ä¸ªstart-å¯¹è±¡çš„Mapï¼Œç„¶åç”¨endæ‰¾å¯¹è±¡ï¼Œä¸€ä¸ªä¸€ä¸ªæ‰¾åˆ°ã€‚</p>
<h3 id="javaé“¾å¼ç¼–ç¨‹"><a href="#javaé“¾å¼ç¼–ç¨‹" class="headerlink" title="javaé“¾å¼ç¼–ç¨‹"></a>javaé“¾å¼ç¼–ç¨‹</h3><p>é“¾å¼ç¼–ç¨‹çš„åŸç†æ˜¯è¿”å›ä¸€ä¸ªthiså¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¿”å›å¯¹è±¡æœ¬èº«ï¼Œä»è€Œè¾¾åˆ°é“¾å¼æ•ˆæœã€‚</p>
<p>é“¾å¼ç¼–ç¨‹ï¼Œä¸­é—´æ“ä½œçš„è¿”å›å€¼éƒ½æ˜¯è‡ªå·±ï¼Œæ¯ä¸ªæ“ä½œçš„è¾“å‡ºæ˜¯ä½“ç°åœ¨è‡ªå·±å¯¹è±¡çš„æ”¹å˜ä¸­çš„ï¼Œç±»ä¼¼äº<code>Stream&lt;T&gt;</code></p>
<p>é“¾å¼ç¼–ç¨‹çš„æ¡ˆä¾‹ï¼š</p>
<p>1ã€StringBuilder å’Œ StringBufferä¸­çš„append()æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">StringBuilder buffer = new StringBuilder();</span><br><span class="line">buffer.append(&quot;ä½ &quot;).append(&quot;å¥½&quot;).append(&quot;!&quot;);</span><br><span class="line"></span><br><span class="line">æºç ï¼š</span><br><span class="line">@Override</span><br><span class="line">public StringBuilder append(String str) &#123;</span><br><span class="line">    super.append(str);</span><br><span class="line">    return this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ã€String è¿›è¡Œå­—ç¬¦ä¸²æ“ä½œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String string = String.valueOf(&quot;123&quot;).concat(&quot;,4567890&quot;).replace(&#x27;,&#x27;, &#x27;!&#x27;).substring(2, 8);</span><br><span class="line"></span><br><span class="line">æºç ï¼š</span><br><span class="line">è¿”å›çš„æ˜¯å¯¹è±¡æœ¬èº«ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨é“¾å¼ç¼–ç¨‹</span><br><span class="line">public static String valueOf(Object obj) &#123;</span><br><span class="line">    return (obj == null) ? &quot;null&quot; : obj.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public String concat(String str) &#123;</span><br><span class="line">     // çœç•¥...</span><br><span class="line">    return new String(buf, true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ã€ Stream æµå¼è®¡ç®—</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list.stream()</span><br><span class="line">    // ç›¸åŒå…ƒç´ å»é‡</span><br><span class="line">    .distinct()</span><br><span class="line">    // å‡åºæ’åº</span><br><span class="line">    .sorted((c1, c2) -&gt; c1.compareTo(c2))</span><br><span class="line">    // éå†</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">æºç ï¼š</span><br><span class="line">æ–¹æ³•è¿”å›çš„æ˜¯å¯¹è±¡æœ¬èº«ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨é“¾å¼ç¼–ç¨‹</span><br><span class="line">Stream&lt;T&gt; distinct();</span><br><span class="line">Stream&lt;T&gt; sorted(Comparator&lt;? super T&gt; comparator);</span><br></pre></td></tr></table></figure>

<p>è‡ªå·±åšä¸€ä¸ªé“¾å¼ç¼–ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class StreamTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Person person = new Person();</span><br><span class="line">        person.setAge(10).setName(&quot;11&quot;);</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ToString</span><br><span class="line">    static class Person &#123;</span><br><span class="line">        private String name;</span><br><span class="line">        private Integer age;</span><br><span class="line"></span><br><span class="line">        public Person setName(String name) &#123;</span><br><span class="line">            this.name = name;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">        public Person setAge(Integer age) &#123;</span><br><span class="line">            this.age = age;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="javaæ•°ç»„ã€å­—ç¬¦ä¸²ã€listçš„æœ€å¤§é•¿åº¦"><a href="#javaæ•°ç»„ã€å­—ç¬¦ä¸²ã€listçš„æœ€å¤§é•¿åº¦" class="headerlink" title="javaæ•°ç»„ã€å­—ç¬¦ä¸²ã€listçš„æœ€å¤§é•¿åº¦"></a>javaæ•°ç»„ã€å­—ç¬¦ä¸²ã€listçš„æœ€å¤§é•¿åº¦</h3><p>âœ…æ•°ç»„çš„æœ€å¤§é•¿åº¦ï¼š<br>æ•°ç»„çš„lengthå±æ€§æ˜¯intç±»å‹ï¼Œå 4ä¸ªå­—èŠ‚ï¼Œæœ€å¤§å€¼ä¸ºInteger.MAX_VALUE&#x3D; 2^31-1ã€21äº¿å¤šã€‘<br>æ³¨æ„ï¼šè¿™æ˜¯ç†è®ºä¸Šçš„æœ€å¤§é•¿åº¦ï¼Œå †å†…å­˜ä¸ä¸€å®šèƒ½å¼€è¾Ÿé‚£ä¹ˆå¤§çš„å­˜å‚¨ç©ºé—´æ¥å­˜å‚¨è¯¥æ•°ç»„ã€‚</p>
<p>âœ…å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ï¼š<br>è¿è¡Œæ—¶ï¼š<br>Stringã€StringBuilderã€StringBufferåº•å±‚éƒ½æ˜¯åŸºäºå­—ç¬¦æ•°ç»„char[ ]çš„ï¼Œè¯¥æ•°ç»„çš„æœ€å¤§é•¿åº¦ä¹Ÿä¸ºInteger.MAX_VALUEï¼Œæ‰€ä»¥ä¸€ä¸ªå­—ç¬¦ä¸²æœ€å¤§21äº¿å¤šä¸ªå­—ç¬¦ã€æ¯ä¸ªå­—ç¬¦åœ¨java8ä¸­å 1ä¸ªå­—èŠ‚ã€‘ï¼Œå³å 2^32-2ä¸ªå­—èŠ‚ï¼Œå³å·®2ä¸ªå­—èŠ‚è¾¾åˆ°4GBã€‚<br>2^10å­—èŠ‚&#x3D;1KBï¼Œ2^20&#x3D;1MBï¼Œ2^30&#x3D;1GB</p>
<p>ç¼–è¯‘æ—¶ï¼š<br>javaæºç é€šè¿‡javacç¼–è¯‘åç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œé™æ€å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¸¸é‡çš„é•¿åº¦æœ€å¤šä¸º65535ï¼Œå› ä¸ºJVMä¸ºäº†è§£å†³å†å²ä¸Šçš„ä¸€ä¸ªBUGï¼Œæ‰€ä»¥å¼ºåˆ¶è¦æ±‚ç¼–è¯‘æ—¶å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ä¸º65534ã€‚</p>
<p>âœ…ArrayListå’ŒLinkedListçš„æœ€å¤§é•¿åº¦<br>ArrayListåº•å±‚æ˜¯æ•°ç»„ï¼Œæœ€å¤§å€¼ä¸ºInteger.MAX_VALUE&#x3D; 231-1ã€21äº¿å¤šã€‘<br>LinkedListåº•å±‚æ˜¯é“¾è¡¨ï¼Œç†è®ºæ˜¯æ— ä¸Šé™é•¿åº¦ã€‚</p>
<h3 id="Javaå…ƒç»„Tuple"><a href="#Javaå…ƒç»„Tuple" class="headerlink" title="Javaå…ƒç»„Tuple"></a>Javaå…ƒç»„Tuple</h3><p>Javaä¸­çš„Tupleæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯å­˜æ”¾å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„æ•°æ®ç±»å‹å¯ä¸åŒã€‚Tupleä¸Listé›†åˆç±»ä¼¼ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼ŒListé›†åˆåªèƒ½å­˜å‚¨ä¸€ç§æ•°æ®ç±»å‹ï¼Œè€ŒTupleå¯å­˜å‚¨å¤šç§æ•°æ®ç±»å‹ã€‚<br>å¯èƒ½ä½ ä¼šè¯´ï¼ŒObjectç±»å‹çš„Listå®é™…ä¹Ÿæ˜¯å¯ä»¥å­˜å‚¨å¤šç§ç±»å‹çš„å•Šï¼Ÿä½†æ˜¯åœ¨åˆ›å»ºListçš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šå…ƒç´ æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ˜¯åªèƒ½æŒ‡å®šä¸ºObjectç±»å‹ï¼Œè·å–çš„å…ƒç´ ç±»å‹å°±æ˜¯Objectï¼Œå¦‚æœ‰éœ€è¦åˆ™è¦è¿›è¡Œå¼ºè½¬ã€‚è€ŒTupleåœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œåˆ™å¯ä»¥ç›´æ¥æŒ‡å®šå¤šä¸ªå…ƒç´ æ•°æ®ç±»å‹ã€‚</p>
<p>å…ƒç»„ï¼ˆtupleï¼‰æ˜¯å…³ç³»æ•°æ®åº“ä¸­çš„åŸºæœ¬æ¦‚å¿µï¼Œå…³ç³»æ˜¯ä¸€å¼ è¡¨ï¼Œè¡¨ä¸­çš„æ¯è¡Œï¼ˆå³æ•°æ®åº“ä¸­çš„æ¯æ¡è®°å½•ï¼‰å°±æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œæ¯åˆ—å°±æ˜¯ä¸€ä¸ªå±æ€§ã€‚ åœ¨äºŒç»´è¡¨é‡Œï¼Œå…ƒç»„ä¹Ÿç§°ä¸ºè¡Œã€‚å…³ç³»æ•°æ®åº“ä¸­çš„ ä¸€æ¡è®°å½•å°±æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œ ä¸€ä¸ªè¡¨å°±æ˜¯ä¸€ä¸ªå…³ç³»ï¼Œ çºªå½•ç»„æˆè¡¨ï¼Œ å…ƒç»„ç”Ÿæˆå…³ç³»ï¼Œ è¿™å°±æ˜¯å…³ç³»æ•°æ®åº“çš„æ ¸å¿ƒç†å¿µã€‚</p>
<p>å…ƒç»„çš„ä½¿ç”¨å°±æ˜¯é€šè¿‡æ³›å‹å®šä¹‰ä¸€ä¸ªç±»ï¼Œç„¶åå»ä¿å­˜å¤šä¸ªç±»å‹å±æ€§ã€‚æ‰€ä»¥å¯ä»¥è®¤ä¸ºå…ƒç»„å®Œå…¨æ˜¯åŸºäºæ³›å‹çš„ã€‚è¿”å›çš„æ‰€æœ‰ç±»å‹å±æ€§å¤–åŒ…ä¸€å±‚å¯¹è±¡ç„¶åè¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œå…¶å®å°±æ˜¯ä½œä¸ºå…ƒç»„çš„å®ç°å®šä¹‰ã€‚</p>
<p>å…ƒç»„ä¸åŒäºListï¼ŒListå­˜å‚¨ç›¸åŒçš„æ•°æ®ç±»å‹ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥å­˜å‚¨ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œé‚£å°±ä¸ç¬¦åˆæ³›å‹äº†ã€‚</p>
<p>å…ƒç»„ä¸åŒäºæ•°ç»„ï¼Œæ•°ç»„ç§å­˜å‚¨çš„ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚</p>
<p>å…ƒç»„ä¸åŒäºmapï¼Œmapç±»å‹æ˜¯é”®å€¼å¯¹å­˜åœ¨çš„ï¼Œè€Œå…ƒç»„ä¸­çš„å€¼ï¼Œå€¼ä¹‹é—´æ²¡æœ‰å…³ç³»ã€‚</p>
<p>å…ƒç»„çš„å€¼å¯ä»¥æ˜¯ä¸åŒæ•°æ®ç±»å‹ï¼Œå€¼ä¸å€¼ä¹‹é—´æ²¡æœ‰å…³ç³»ã€‚</p>
<p>ç†è§£ï¼šå…ƒç¥–ç›¸å½“äºå®šä¹‰ä¸€ä¸ªVOï¼Œé‡Œé¢æœ‰ä¸åŒçš„å±æ€§ç±»å‹ï¼Œå¯ä»¥åŒ…è£…ä¸åŒç±»å‹ã€‚å’ŒliståŒºåˆ«æ˜¯ï¼Œåå…ƒç¥–å°±å¯ä»¥æ”¾10ä¸ªä¸åŒç±»å‹çš„æ•°æ®ã€‚å…ƒç¥–çš„ä¼˜ç‚¹å…¶å®è¿˜æ˜¯å¯ä»¥é˜²æ­¢ä»£ç çš„å†—ä½™ï¼Œä¸ç”¨å†™æ›´å¤šçš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªè¿”å›å¤šä¸ªæˆ‘æƒ³è¦çš„ç±»å‹å±æ€§ã€‚ä¸Šé¢çš„Pairå°±æ˜¯å®ç°è¿™ä¹ˆä¸€ä¸ªåŠŸèƒ½ï¼Œä¹Ÿæ˜¯å…ƒç¥–ã€‚</p>
<hr>
<p>ä¾èµ–JaråŒ…ï¼šjavatuples</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.javatuples&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javatuples&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>jaråŒ…ä¸­çš„ç»“æ„å¾ˆç®€å•ï¼Œå…¶ä¸­çš„ç±»ä¸»è¦æ˜¯tupleåŸºç¡€ç±»ã€æ‰©å±•çš„ä¸€å…ƒç»„ã€äºŒå…ƒç»„â€¦åå…ƒç»„ï¼Œä»¥åŠé”®å€¼å¯¹å…ƒç»„ï¼›æ¥å£çš„ä½œç”¨æ˜¯æä¾›ã€è·å–åˆ›å»ºå„å…ƒç»„æ—¶ä¼ å…¥å‚æ•°å€¼ã€‘çš„æ–¹æ³•ã€‚</p>
<p>å…¶ä¸­ä¸‰å…ƒç¥–çš„æºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.javatuples;</span><br><span class="line"></span><br><span class="line">import java.util.Collection;</span><br><span class="line">import java.util.Iterator;</span><br><span class="line"></span><br><span class="line">import org.javatuples.valueintf.IValue0;</span><br><span class="line">import org.javatuples.valueintf.IValue1;</span><br><span class="line">import org.javatuples.valueintf.IValue2;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * A tuple of three elements.</span><br><span class="line"> * &lt;/p&gt; </span><br><span class="line"> * </span><br><span class="line"> * @since 1.0</span><br><span class="line"> * </span><br><span class="line"> * @author Daniel Fern&amp;aacute;ndez</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public final class Triplet&lt;A,B,C&gt; </span><br><span class="line">        extends Tuple</span><br><span class="line">        implements IValue0&lt;A&gt;,</span><br><span class="line">                    IValue1&lt;B&gt;,</span><br><span class="line">                    IValue2&lt;C&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = -1877265551599483740L;</span><br><span class="line"></span><br><span class="line">    private static final int SIZE = 3;</span><br><span class="line"></span><br><span class="line">    private final A val0;</span><br><span class="line">    private final B val1;</span><br><span class="line">    private final C val2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static &lt;A,B,C&gt; Triplet&lt;A,B,C&gt; with(final A value0, final B value1, final C value2) &#123;</span><br><span class="line">        return new Triplet&lt;A,B,C&gt;(value0,value1,value2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬è°ƒç”¨é™æ€æ–¹æ³•withï¼Œä¼ å…¥å…ƒç»„æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªå…ƒç»„ã€‚å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå·¥å…·ç±»ï¼Œæä¾›å…¬å…±æ–¹æ³•ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°ä¸ªæ•°ï¼Œè¿”å›ä¸åŒçš„å…ƒç»„å¯¹è±¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.liuxuan.study;</span><br><span class="line"></span><br><span class="line">import com.liuxuan.repository.domain.Student;</span><br><span class="line">import org.javatuples.Pair;</span><br><span class="line">import org.javatuples.Triplet;</span><br><span class="line">import org.javatuples.Unit;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2023-02-06 22:32</span><br><span class="line"> **/</span><br><span class="line">public class TupleUtils&#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * å•å…ƒç´ å…ƒç¥–</span><br><span class="line">     */</span><br><span class="line">    public static &lt;A&gt; Unit&lt;A&gt; with(final A value0) &#123;</span><br><span class="line">        return Unit.with(value0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * åŒå…ƒç´ å…ƒç¥–</span><br><span class="line">     */</span><br><span class="line">    public static &lt;A, B&gt; Pair&lt;A, B&gt; with(final A value0, final B value1) &#123;</span><br><span class="line">        return Pair.with(value0, value1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * ä¸‰å…ƒç´ å…ƒç¥–</span><br><span class="line">     */</span><br><span class="line">    public static &lt;A, B, C&gt; Triplet&lt;A, B, C&gt; with(final A value0, final B value1, final C value2) &#123;</span><br><span class="line">        return Triplet.with(value0, value1, value2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;Triplet&lt;Integer, String, String&gt;&gt; roleList = new ArrayList&lt;Triplet&lt;Integer, String, String&gt;&gt;();</span><br><span class="line"></span><br><span class="line">        Triplet&lt;Integer, String, String&gt; studentTriplet = TupleUtils.with(11, &quot;sid&quot;, &quot;graduate&quot;);</span><br><span class="line">        Triplet&lt;Integer, String, String&gt; teacherTriplet = TupleUtils.with(22, &quot;tid&quot;, &quot;graduate&quot;);</span><br><span class="line">        Triplet&lt;Integer, String, String&gt; programmerTriplet = TupleUtils.with(33, &quot;id&quot;, &quot;graduate&quot;);</span><br><span class="line"></span><br><span class="line">        roleList.add(studentTriplet);</span><br><span class="line">        roleList.add(teacherTriplet);</span><br><span class="line">        roleList.add(programmerTriplet);</span><br><span class="line"></span><br><span class="line">        for (Triplet&lt;Integer, String, String&gt; triplet : roleList) &#123;</span><br><span class="line">            System.out.println(triplet);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TupleUtilsä¸­æä¾›äº†withçš„é‡è½½æ–¹æ³•ï¼Œè°ƒç”¨æ—¶æ ¹æ®ä¼ å…¥çš„å‚æ•°å€¼ä¸ªæ•°ï¼Œè¿”å›å¯¹åº”çš„å…ƒç»„å¯¹è±¡ã€‚</p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_35006663/article/details/100301416">https://blog.csdn.net/qq_35006663/article/details/100301416</a></p>
<hr>
<p>org.apache.commons.lang3.tuple ä¸­çš„å…ƒç¥–</p>
<p>ç”¨äºå¤„ç†ä¸€å¯¹é”®å€¼çš„å¯¹è±¡pairç±»ä¼¼äºMap.entryï¼Œcommons lang3å¢åŠ äº†å¯ä»¥å¤„ç†3ä¸ªå€¼çš„TripleåŸºç±»ï¼Œæ­¤åŒ…ä¸‹å®šä¹‰äº†<code>Pair&lt;L,R&gt;</code>æŠ½è±¡åŸºç±»ï¼ŒåŠMutablePair,MutableTriple,ImmutablePair,ImmutableTripleå­ç±»ã€‚ä¸€ä¸ªçº¿ç¨‹éå®‰å…¨ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å®‰å…¨ã€‚</p>
<p>æ¥å£ï¼š<br>1.<code>Pair</code>ï¼šå°è£…ä¸€å¯¹é”®å€¼å¯¹ã€‚<br>å®ç°ç±»ï¼šå¯å˜ï¼š<code>MutablePair&lt;L,R&gt;</code>ï¼Œä¸å¯å˜ï¼š<code>ImmutablePair</code><br>2.<code>Triple</code>ï¼šå°è£…3ä¸ªå€¼çš„ç±»<br>å®ç°ç±»ï¼š<code>ImmutableTriple</code>; <code>MuttableTriple&lt;L,M,R&gt;</code></p>
<h3 id="Preconditions-checkArgumentæ ¡éªŒå­—æ®µ"><a href="#Preconditions-checkArgumentæ ¡éªŒå­—æ®µ" class="headerlink" title="Preconditions.checkArgumentæ ¡éªŒå­—æ®µ"></a>Preconditions.checkArgumentæ ¡éªŒå­—æ®µ</h3><p>guavaä¸­çš„é™æ€æ–¹æ³•ï¼Œç”¨æ¥ç¡®è®¤å‚æ•°æ˜¯ä¸æ˜¯ç¬¦åˆè¦æ±‚ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.google.guava&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;guava&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;31.0.1-jre&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>ç”¨æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String param = &quot;&quot;;</span><br><span class="line">//æ—§å¼å†™æ³•</span><br><span class="line">if (StringUtils.isEmpty(param)) &#123;</span><br><span class="line">    throw new IllegalArgumentException(&quot;paramå­—æ®µä¸èƒ½ä¸ºç©º&quot;);</span><br><span class="line">&#125;</span><br><span class="line">//æ–°å¼å†™æ³•ï¼šæœŸæœ›è¿™ä¸ªå­—æ®µä¸èƒ½ä¸ºç©º</span><br><span class="line">Preconditions.checkArgument(StringUtils.isNotEmpty(param), &quot;paramå­—æ®µä¸èƒ½ä¸ºç©º&quot;);</span><br></pre></td></tr></table></figure>

<p>æ–°å¼çš„æ ¡éªŒæ˜¯ï¼šè¦æ±‚æˆ‘ä»¬å¯¹æŸä¸ªå­—æ®µçš„è¦æ±‚æ˜¯ä»€ä¹ˆï¼Œå½“é€»è¾‘æœªå‘½ä¸­è¦æ±‚æ—¶ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h3 id="é˜»å¡é˜Ÿåˆ—"><a href="#é˜»å¡é˜Ÿåˆ—" class="headerlink" title="é˜»å¡é˜Ÿåˆ—"></a>é˜»å¡é˜Ÿåˆ—</h3><p>drainTo()æ–¹æ³•ï¼š<br>ArrayBlockingQueueæ˜¯æœ‰ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—å†…éƒ¨ä½¿ç”¨æ•°ç»„æ”¯æŒçš„å…ƒç´ å­˜å‚¨ã€‚<br>drainTo()æ–¹æ³•ç”¨äºå°†æ‰€æœ‰å…ƒç´ ä¼ è¾“åˆ°é›†åˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int capacity = 10;</span><br><span class="line">ArrayBlockingQueue queue = new ArrayBlockingQueue(capacity);</span><br><span class="line">queue.add(11);</span><br><span class="line">queue.add(22);</span><br><span class="line">queue.add(33);</span><br><span class="line">System.out.println(&quot;queue = &quot; + queue); //[11, 22, 33]</span><br><span class="line">ArrayList list = new ArrayList();</span><br><span class="line">queue.drainTo(list);</span><br><span class="line">System.out.println(&quot;queue = &quot; + queue); //[]</span><br><span class="line">System.out.println(&quot;collection = &quot; + list); //[11, 22, 33]</span><br></pre></td></tr></table></figure>

<h3 id="javaè·å–æœ¬åœ°ip"><a href="#javaè·å–æœ¬åœ°ip" class="headerlink" title="javaè·å–æœ¬åœ°ip"></a>javaè·å–æœ¬åœ°ip</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String localIP = InetAddress.getLocalHost().getHostAddress();</span><br><span class="line">System.out.println(localIP);</span><br></pre></td></tr></table></figure>

<h3 id="guavaä¸­çš„ImmutableList"><a href="#guavaä¸­çš„ImmutableList" class="headerlink" title="guavaä¸­çš„ImmutableList"></a>guavaä¸­çš„ImmutableList</h3><p>ImmutableListæ˜¯ä¸€ä¸ªä¸å¯å˜ã€çº¿ç¨‹å®‰å…¨çš„åˆ—è¡¨é›†åˆï¼Œå®ƒåªä¼šè·å–ä¼ å…¥å¯¹è±¡çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“åˆ°åŸæ¥çš„å˜é‡æˆ–è€…å¯¹è±¡ã€‚</p>
<p>ImmutableListåˆ›å»ºä¸å¯å˜å¯¹è±¡æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨é™æ€ofæ–¹æ³•ï¼Œå¦å¤–ä¸€ç§æ˜¯ä½¿ç”¨é™æ€å†…éƒ¨ç±»Builderã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é™æ€å†…éƒ¨ç±»æ„å»ºæ–¹æ³• :</span><br><span class="line">ImmutableList&lt;Integer&gt; list = ImmutableList .&lt;Integer&gt;builder()</span><br><span class="line">                        .add(12)</span><br><span class="line">                        .add(23)</span><br><span class="line">                        .add(34)</span><br><span class="line">                        .build();</span><br><span class="line"></span><br><span class="line">é™æ€æ–¹æ³•æä¾›äº†å¤šä¸ªå‚æ•°çš„ofé™æ€æ–¹æ³•:</span><br><span class="line">ImmutableList&lt;String&gt; list3 = ImmutableList .&lt;String&gt;of(&quot;12&quot;,&quot;23&quot;);</span><br><span class="line"></span><br><span class="line">å¤åˆ¶æ•°ç»„ä¸­çš„å…ƒç´ åˆ°ImmutableListä¸­:</span><br><span class="line"> List&lt;String&gt; list4 = new ArrayList&lt;String&gt;();</span><br><span class="line">list4.add(&quot;1&quot;);</span><br><span class="line">list4.add(&quot;2&quot;);</span><br><span class="line">list4.add(&quot;3&quot;);</span><br><span class="line">//copyæ•°ç»„list4çš„ä¸€ä¸ªå‰¯æœ¬</span><br><span class="line">List&lt;String&gt; list5 = ImmutableList .&lt;String&gt;copyOf(list4);</span><br></pre></td></tr></table></figure>

<h3 id="System-getProperty"><a href="#System-getProperty" class="headerlink" title="System.getProperty()"></a>System.getProperty()</h3><p>è·å–ç³»ç»Ÿå±æ€§ï¼Œå³åœ¨javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶å®šä¹‰çš„ç¯å¢ƒå˜é‡çš„å€¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å±æ€§åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å±æ€§çš„é»˜è®¤å€¼ã€‚</p>
<p><code>String s = System.getProperty(&quot;line.separator&quot;)</code> è·å–ç³»ç»Ÿç©ºæ ¼ã€‚</p>
<p>System.getProperty() æ˜¯è·å–ç³»ç»Ÿçš„ç›¸å…³å±æ€§ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç¼–ç ã€æ“ä½œç³»ç»Ÿåç§°ã€åŒºåŸŸã€ç”¨æˆ·åç­‰ï¼Œæ­¤å±æ€§ä¸€èˆ¬æ˜¯ç”± JVM è‡ªåŠ¨è·å–ï¼Œä¸èƒ½è®¾ç½®ã€‚è¿™ä¸ªå¿…é¡»æ¥æ”¶ä¸€ä¸ª String ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ª String ç±»å‹çš„å€¼ã€‚å¦‚æœæƒ³è¦è·å–æ‰€æœ‰çš„ç³»ç»Ÿçš„ç›¸å…³å±æ€§å€¼å¯ä»¥ä½¿ç”¨ System.getProperties() æ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java.runtime.name-------Java(TM) SE Runtime Environment</span><br><span class="line">sun.boot.library.path-------C:\Program Files\Java\jdk1.8.0_60\jre\bin</span><br><span class="line">java.vm.version-------25.60-b23</span><br><span class="line">java.vm.vendor-------Oracle Corporation</span><br><span class="line">java.vendor.url-------http://java.oracle.com/</span><br><span class="line">path.separator-------;</span><br><span class="line">java.vm.name-------Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line">file.encoding.pkg-------sun.io</span><br><span class="line">user.country-------CN</span><br><span class="line">user.script-------</span><br><span class="line">sun.java.launcher-------SUN_STANDARD</span><br><span class="line">sun.os.patch.level-------</span><br><span class="line">java.vm.specification.name-------Java Virtual Machine Specification</span><br><span class="line">user.dir-------F:\siwei\dayunmotor-tbox\dayunmotor-forward-hbase</span><br><span class="line">java.runtime.version-------1.8.0_60-b27</span><br><span class="line">java.awt.graphicsenv-------sun.awt.Win32GraphicsEnvironment</span><br><span class="line">java.endorsed.dirs-------C:\Program Files\Java\jdk1.8.0_60\jre\lib\endorsed</span><br><span class="line">os.arch-------amd64</span><br><span class="line">java.io.tmpdir-------C:\Users\yesway\AppData\Local\Temp\</span><br><span class="line">line.separator-------</span><br><span class="line"></span><br><span class="line">java.vm.specification.vendor-------Oracle Corporation</span><br><span class="line">user.variant-------</span><br><span class="line">os.name-------Windows 10</span><br><span class="line">sun.jnu.encoding-------GBK</span><br><span class="line">java.library.path-------C:\Program Files\Java\jdk1.8.0_60\bin;C:\WINDOWS\Sun\Java\bin;C:\WINDOWS\system32;C:\WINDOWS;C:\ProgramData\Oracle\Java\javapath;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\WindowsPowerShell\v1.0\;C:\WINDOWS\System32\OpenSSH\;D:\Program Files\Git\cmd;C:\Users\yesway\AppData\Local\Microsoft\WindowsApps;;.</span><br><span class="line">java.specification.name-------Java Platform API Specification</span><br><span class="line">java.class.version-------52.0</span><br><span class="line">sun.management.compiler-------HotSpot 64-Bit Tiered Compilers</span><br><span class="line">os.version-------10.0</span><br><span class="line">user.home-------C:\Users\yesway</span><br><span class="line">user.timezone-------</span><br><span class="line">java.awt.printerjob-------sun.awt.windows.WPrinterJob</span><br><span class="line">file.encoding-------UTF-8</span><br><span class="line">java.specification.version-------1.8</span><br><span class="line">java.class.path-------C:\Program Files\Java\jdk1.8.0_60\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\rt.jar;F:\siwei\dayunmotor-tbox\dayunmotor-forward-hbase\target\classes;D:\dayunMaven\org\springframework\boot\spring-boot-starter\2.4.0\spring-boot-starter-2.4.0.jar;D:\dayunMaven\org\springframework\boot\spring-boot\2.4.0\spring-boot-2.4.0.jar;D:\dayunMaven\org\springframework\spring-context\5.3.1\spring-context-5.3.1.jar;D:\dayunMaven\org\springframework\boot\spring-boot-autoconfigure\2.4.0\spring-boot-autoconfigure-2.4.0.jar;D:\dayunMaven\jakarta\annotation\jakarta.annotation-api\1.3.5\jakarta.annotation-api-1.3.5.jar;D:\dayunMaven\org\springframework\spring-core\5.3.1\spring-core-5.3.1.jar;D:\dayunMaven\org\springframework\spring-jcl\5.3.1\spring-jcl-5.3.1.jar;D:\dayunMaven\org\yaml\snakeyaml\1.27\snakeyaml-1.27.jar;D:\dayunMaven\org\springframework\boot\spring-boot-starter-aop\2.4.0\spring-boot-starter-aop-2.4.0.jar;D:\dayunMaven\org\springframework\spring-aop\5.3.1\spring-aop-5.3.1.jar;D:\dayunMaven\org\springframework\spring-beans\5.3.1\spring-beans-5.3.1.jar;D:\dayunMaven\org\aspectj\aspectjweaver\1.9.6\aspectjweaver-1.9.6.jar;D:\dayunMaven\org\springframework\boot\spring-boot-starter-amqp\2.4.0\spring-boot-starter-amqp-2.4.0.jar;D:\dayunMaven\org\springframework\spring-messaging\5.3.1\spring-messaging-5.3.1.jar;D:\dayunMaven\org\springframework\amqp\spring-rabbit\2.3.1\spring-rabbit-2.3.1.jar;D:\dayunMaven\org\springframework\amqp\spring-amqp\2.3.1\spring-amqp-2.3.1.jar;D:\dayunMaven\org\springframework\retry\spring-retry\1.3.0\spring-retry-1.3.0.jar;D:\dayunMaven\javax\annotation\javax.annotation-api\1.3.2\javax.annotation-api-1.3.2.jar;D:\dayunMaven\com\rabbitmq\amqp-client\5.9.0\amqp-client-5.9.0.jar;D:\dayunMaven\org\springframework\spring-tx\5.3.1\spring-tx-5.3.1.jar;D:\dayunMaven\org\springframework\boot\spring-boot-starter-log4j2\2.4.0\spring-boot-starter-log4j2-2.4.0.jar;D:\dayunMaven\org\apache\logging\log4j\log4j-slf4j-impl\2.13.3\log4j-slf4j-impl-2.13.3.jar;D:\dayunMaven\org\apache\logging\log4j\log4j-jul\2.13.3\log4j-jul-2.13.3.jar;D:\dayunMaven\org\slf4j\jul-to-slf4j\1.7.30\jul-to-slf4j-1.7.30.jar;D:\dayunMaven\org\springframework\boot\spring-boot-starter-web\2.4.0\spring-boot-starter-web-2.4.0.jar;D:\dayunMaven\org\springframework\boot\spring-boot-starter-json\2.4.0\spring-boot-starter-json-2.4.0.jar;D:\dayunMaven\com\fasterxml\jackson\datatype\jackson-datatype-jdk8\2.11.3\jackson-datatype-jdk8-2.11.3.jar;D:\dayunMaven\com\fasterxml\jackson\module\jackson-module-parameter-names\2.11.3\jackson-module-parameter-names-2.11.3.jar;D:\dayunMaven\org\springframework\boot\spring-boot-starter-tomcat\2.4.0\spring-boot-starter-tomcat-2.4.0.jar;D:\dayunMaven\org\apache\tomcat\embed\tomcat-embed-core\9.0.39\tomcat-embed-core-9.0.39.jar;D:\dayunMaven\org\glassfish\jakarta.el\3.0.3\jakarta.el-3.0.3.jar;D:\dayunMaven\org\apache\tomcat\embed\tomcat-embed-websocket\9.0.39\tomcat-embed-websocket-9.0.39.jar;D:\dayunMaven\org\springframework\spring-web\5.3.1\spring-web-5.3.1.jar;D:\dayunMaven\org\springframework\spring-webmvc\5.3.1\spring-webmvc-5.3.1.jar;D:\dayunMaven\org\springframework\spring-expression\5.3.1\spring-expression-5.3.1.jar;D:\dayunMaven\net\minidev\json-smart\2.3\json-smart-2.3.jar;D:\dayunMaven\net\minidev\accessors-smart\1.2\accessors-smart-1.2.jar;D:\dayunMaven\org\ow2\asm\asm\5.0.4\asm-5.0.4.jar;D:\dayunMaven\org\springframework\boot\spring-boot-starter-data-redis\2.4.0\spring-boot-starter-data-redis-2.4.0.jar;D:\dayunMaven\org\springframework\data\spring-data-redis\2.4.1\spring-data-redis-2.4.1.jar;D:\dayunMaven\org\springframework\data\spring-data-keyvalue\2.4.1\spring-data-keyvalue-2.4.1.jar;D:\dayunMaven\org\springframework\data\spring-data-commons\2.4.1\spring-data-commons-2.4.1.jar;D:\dayunMaven\org\springframework\spring-oxm\5.3.1\spring-oxm-5.3.1.jar;D:\dayunMaven\org\springframework\spring-context-support\5.3.1\spring-context-support-5.3.1.jar;D:\dayunMaven\io\lettuce\lettuce-core\6.0.1.RELEASE\lettuce-core-6.0.1.RELEASE.jar;D:\dayunMaven\io\netty\netty-common\4.1.53.Final\netty-common-4.1.53.Final.jar;D:\dayunMaven\io\netty\netty-handler\4.1.53.Final\netty-handler-4.1.53.Final.jar;D:\dayunMaven\io\netty\netty-resolver\4.1.53.Final\netty-resolver-4.1.53.Final.jar;D:\dayunMaven\io\netty\netty-buffer\4.1.53.Final\netty-buffer-4.1.53.Final.jar;D:\dayunMaven\io\netty\netty-codec\4.1.53.Final\netty-codec-4.1.53.Final.jar;D:\dayunMaven\io\netty\netty-transport\4.1.53.Final\netty-transport-4.1.53.Final.jar;D:\dayunMaven\io\projectreactor\reactor-core\3.3.11.RELEASE\reactor-core-3.3.11.RELEASE.jar;D:\dayunMaven\org\reactivestreams\reactive-streams\1.0.3\reactive-streams-1.0.3.jar;D:\dayunMaven\commons-lang\commons-lang\2.6\commons-lang-2.6.jar;D:\dayunMaven\org\apache\commons\commons-pool2\2.8.0\commons-pool2-2.8.0.jar;D:\dayunMaven\org\projectlombok\lombok\1.18.8\lombok-1.18.8.jar;D:\dayunMaven\org\apache\logging\log4j\log4j-core\2.11.2\log4j-core-2.11.2.jar;D:\dayunMaven\org\apache\logging\log4j\log4j-api\2.11.2\log4j-api-2.11.2.jar;D:\dayunMaven\org\slf4j\slf4j-api\1.7.5\slf4j-api-1.7.5.jar;D:\dayunMaven\com\fasterxml\jackson\core\jackson-annotations\2.9.0\jackson-annotations-2.9.0.jar;D:\dayunMaven\com\alibaba\fastjson\1.2.47\fastjson-1.2.47.jar;D:\dayunMaven\org\apache\hadoop\hadoop-client\3.0.0\hadoop-client-3.0.0.jar;D:\dayunMaven\org\apache\hadoop\hadoop-hdfs-client\3.0.0\hadoop-hdfs-client-3.0.0.jar;D:\dayunMaven\com\squareup\okhttp\okhttp\2.4.0\okhttp-2.4.0.jar;D:\dayunMaven\com\squareup\okio\okio\1.4.0\okio-1.4.0.jar;D:\dayunMaven\org\apache\hadoop\hadoop-yarn-api\3.0.0\hadoop-yarn-api-3.0.0.jar;D:\dayunMaven\javax\xml\bind\jaxb-api\2.2.11\jaxb-api-2.2.11.jar;D:\dayunMaven\org\apache\hadoop\hadoop-yarn-client\3.0.0\hadoop-yarn-client-3.0.0.jar;D:\dayunMaven\org\apache\hadoop\hadoop-mapreduce-client-core\3.0.0\hadoop-mapreduce-client-core-3.0.0.jar;D:\dayunMaven\org\apache\hadoop\hadoop-yarn-common\3.0.0\hadoop-yarn-common-3.0.0.jar;D:\dayunMaven\org\eclipse\jetty\jetty-util\9.3.19.v20170502\jetty-util-9.3.19.v20170502.jar;D:\dayunMaven\com\sun\jersey\jersey-client\1.19\jersey-client-1.19.jar;D:\dayunMaven\com\fasterxml\jackson\module\jackson-module-jaxb-annotations\2.7.8\jackson-module-jaxb-annotations-2.7.8.jar;D:\dayunMaven\com\fasterxml\jackson\jaxrs\jackson-jaxrs-json-provider\2.7.8\jackson-jaxrs-json-provider-2.7.8.jar;D:\dayunMaven\com\fasterxml\jackson\jaxrs\jackson-jaxrs-base\2.7.8\jackson-jaxrs-base-2.7.8.jar;D:\dayunMaven\org\apache\hadoop\hadoop-mapreduce-client-jobclient\3.0.0\hadoop-mapreduce-client-jobclient-3.0.0.jar;D:\dayunMaven\org\apache\hadoop\hadoop-mapreduce-client-common\3.0.0\hadoop-mapreduce-client-common-3.0.0.jar;D:\dayunMaven\org\apache\hadoop\hadoop-annotations\3.0.0\hadoop-annotations-3.0.0.jar;D:\dayunMaven\org\apache\hbase\hbase-shaded-client\2.1.0\hbase-shaded-client-2.1.0.jar;D:\dayunMaven\com\github\stephenc\findbugs\findbugs-annotations\1.3.9-1\findbugs-annotations-1.3.9-1.jar;D:\dayunMaven\org\apache\htrace\htrace-core4\4.2.0-incubating\htrace-core4-4.2.0-incubating.jar;D:\dayunMaven\commons-logging\commons-logging\1.2\commons-logging-1.2.jar;D:\dayunMaven\org\apache\htrace\htrace-core\3.1.0-incubating\htrace-core-3.1.0-incubating.jar;D:\dayunMaven\log4j\log4j\1.2.17\log4j-1.2.17.jar;D:\dayunMaven\org\apache\yetus\audience-annotations\0.5.0\audience-annotations-0.5.0.jar;D:\dayunMaven\junit\junit\4.12\junit-4.12.jar;D:\dayunMaven\org\hamcrest\hamcrest-core\1.3\hamcrest-core-1.3.jar;D:\dayunMaven\org\apache\hadoop\hadoop-common\3.0.0\hadoop-common-3.0.0.jar;D:\dayunMaven\com\google\guava\guava\11.0.2\guava-11.0.2.jar;D:\dayunMaven\commons-cli\commons-cli\1.2\commons-cli-1.2.jar;D:\dayunMaven\org\apache\commons\commons-math3\3.1.1\commons-math3-3.1.1.jar;D:\dayunMaven\org\apache\httpcomponents\httpclient\4.5.2\httpclient-4.5.2.jar;D:\dayunMaven\org\apache\httpcomponents\httpcore\4.4.4\httpcore-4.4.4.jar;D:\dayunMaven\commons-codec\commons-codec\1.4\commons-codec-1.4.jar;D:\dayunMaven\commons-io\commons-io\2.4\commons-io-2.4.jar;D:\dayunMaven\commons-net\commons-net\3.1\commons-net-3.1.jar;D:\dayunMaven\commons-collections\commons-collections\3.2.2\commons-collections-3.2.2.jar;D:\dayunMaven\javax\servlet\javax.servlet-api\3.1.0\javax.servlet-api-3.1.0.jar;D:\dayunMaven\javax\servlet\jsp\jsp-api\2.1\jsp-api-2.1.jar;D:\dayunMaven\com\sun\jersey\jersey-core\1.19\jersey-core-1.19.jar;D:\dayunMaven\javax\ws\rs\jsr311-api\1.1.1\jsr311-api-1.1.1.jar;D:\dayunMaven\com\sun\jersey\jersey-servlet\1.19\jersey-servlet-1.19.jar;D:\dayunMaven\com\sun\jersey\jersey-json\1.19\jersey-json-1.19.jar;D:\dayunMaven\org\codehaus\jettison\jettison\1.1\jettison-1.1.jar;D:\dayunMaven\com\sun\xml\bind\jaxb-impl\2.2.3-1\jaxb-impl-2.2.3-1.jar;D:\dayunMaven\org\codehaus\jackson\jackson-core-asl\1.9.2\jackson-core-asl-1.9.2.jar;D:\dayunMaven\org\codehaus\jackson\jackson-mapper-asl\1.9.2\jackson-mapper-asl-1.9.2.jar;D:\dayunMaven\org\codehaus\jackson\jackson-jaxrs\1.9.2\jackson-jaxrs-1.9.2.jar;D:\dayunMaven\org\codehaus\jackson\jackson-xc\1.9.2\jackson-xc-1.9.2.jar;D:\dayunMaven\com\sun\jersey\jersey-server\1.19\jersey-server-1.19.jar;D:\dayunMaven\commons-beanutils\commons-beanutils\1.9.3\commons-beanutils-1.9.3.jar;D:\dayunMaven\org\apache\commons\commons-configuration2\2.1.1\commons-configuration2-2.1.1.jar;D:\dayunMaven\org\apache\commons\commons-lang3\3.4\commons-lang3-3.4.jar;D:\dayunMaven\org\slf4j\slf4j-log4j12\1.7.25\slf4j-log4j12-1.7.25.jar;D:\dayunMaven\org\apache\avro\avro\1.7.7\avro-1.7.7.jar;D:\dayunMaven\com\thoughtworks\paranamer\paranamer\2.3\paranamer-2.3.jar;D:\dayunMaven\org\xerial\snappy\snappy-java\1.0.5\snappy-java-1.0.5.jar;D:\dayunMaven\com\google\re2j\re2j\1.1\re2j-1.1.jar;D:\dayunMaven\com\google\protobuf\protobuf-java\2.5.0\protobuf-java-2.5.0.jar;D:\dayunMaven\org\apache\hadoop\hadoop-auth\3.0.0\hadoop-auth-3.0.0.jar;D:\dayunMaven\com\nimbusds\nimbus-jose-jwt\4.41.1\nimbus-jose-jwt-4.41.1.jar;D:\dayunMaven\com\github\stephenc\jcip\jcip-annotations\1.0-1\jcip-annotations-1.0-1.jar;D:\dayunMaven\org\apache\curator\curator-framework\2.12.0\curator-framework-2.12.0.jar;D:\dayunMaven\com\jcraft\jsch\0.1.54\jsch-0.1.54.jar;D:\dayunMaven\org\apache\curator\curator-client\2.12.0\curator-client-2.12.0.jar;D:\dayunMaven\org\apache\curator\curator-recipes\2.12.0\curator-recipes-2.12.0.jar;D:\dayunMaven\com\google\code\findbugs\jsr305\3.0.0\jsr305-3.0.0.jar;D:\dayunMaven\org\apache\zookeeper\zookeeper\3.4.9\zookeeper-3.4.9.jar;D:\dayunMaven\jline\jline\0.9.94\jline-0.9.94.jar;D:\dayunMaven\io\netty\netty\3.10.5.Final\netty-3.10.5.Final.jar;D:\dayunMaven\org\apache\commons\commons-compress\1.4.1\commons-compress-1.4.1.jar;D:\dayunMaven\org\tukaani\xz\1.0\xz-1.0.jar;D:\dayunMaven\org\apache\kerby\kerb-simplekdc\1.0.1\kerb-simplekdc-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerb-client\1.0.1\kerb-client-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerby-config\1.0.1\kerby-config-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerb-core\1.0.1\kerb-core-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerby-pkix\1.0.1\kerby-pkix-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerby-asn1\1.0.1\kerby-asn1-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerby-util\1.0.1\kerby-util-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerb-common\1.0.1\kerb-common-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerb-crypto\1.0.1\kerb-crypto-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerb-util\1.0.1\kerb-util-1.0.1.jar;D:\dayunMaven\org\apache\kerby\token-provider\1.0.1\token-provider-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerb-admin\1.0.1\kerb-admin-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerb-server\1.0.1\kerb-server-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerb-identity\1.0.1\kerb-identity-1.0.1.jar;D:\dayunMaven\org\apache\kerby\kerby-xdr\1.0.1\kerby-xdr-1.0.1.jar;D:\dayunMaven\org\codehaus\woodstox\stax2-api\3.1.4\stax2-api-3.1.4.jar;D:\dayunMaven\com\fasterxml\woodstox\woodstox-core\5.0.3\woodstox-core-5.0.3.jar;D:\dayunMaven\com\fasterxml\jackson\core\jackson-databind\2.9.6\jackson-databind-2.9.6.jar;D:\dayunMaven\com\fasterxml\jackson\core\jackson-core\2.9.6\jackson-core-2.9.6.jar;D:\dayunMaven\com\fasterxml\jackson\datatype\jackson-datatype-jsr310\2.9.6\jackson-datatype-jsr310-2.9.6.jar;D:\dayunMaven\com\google\code\gson\gson\2.6.2\gson-2.6.2.jar;D:\Program Files\JetBrains\IntelliJ IDEA 2020.2.4\lib\idea_rt.jar</span><br><span class="line">user.name-------yesway</span><br><span class="line">java.vm.specification.version-------1.8</span><br><span class="line">sun.java.command-------com.dayunmotor.forward.hbase.ForwardHbaseApplication</span><br><span class="line">java.home-------C:\Program Files\Java\jdk1.8.0_60\jre</span><br><span class="line">sun.arch.data.model-------64</span><br><span class="line">user.language-------zh</span><br><span class="line">java.specification.vendor-------Oracle Corporation</span><br><span class="line">awt.toolkit-------sun.awt.windows.WToolkit</span><br><span class="line">java.vm.info-------mixed mode</span><br><span class="line">java.version-------1.8.0_60</span><br><span class="line">java.ext.dirs-------C:\Program Files\Java\jdk1.8.0_60\jre\lib\ext;C:\WINDOWS\Sun\Java\lib\ext</span><br><span class="line">sun.boot.class.path-------C:\Program Files\Java\jdk1.8.0_60\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\rt.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\sunrsasign.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_60\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_60\jre\classes</span><br><span class="line">java.vendor-------Oracle Corporation</span><br><span class="line">file.separator-------\</span><br><span class="line">java.vendor.url.bug-------http://bugreport.sun.com/bugreport/</span><br><span class="line">sun.io.unicode.encoding-------UnicodeLittle</span><br><span class="line">sun.cpu.endian-------little</span><br><span class="line">sun.desktop-------windows</span><br><span class="line">sun.cpu.isalist-------amd64</span><br></pre></td></tr></table></figure>


<h3 id="ç”¨åå°„è·å–Javaå¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§åç§°å’Œå±æ€§å€¼"><a href="#ç”¨åå°„è·å–Javaå¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§åç§°å’Œå±æ€§å€¼" class="headerlink" title="ç”¨åå°„è·å–Javaå¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§åç§°å’Œå±æ€§å€¼"></a>ç”¨åå°„è·å–Javaå¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§åç§°å’Œå±æ€§å€¼</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ReflectTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws NoSuchMethodException &#123;</span><br><span class="line">        Person person = new Person(&quot;zhangsan&quot;, 30, &quot;ç”·&quot;);</span><br><span class="line">        StringBuilder sbName = new StringBuilder();</span><br><span class="line">        StringBuilder sbValue = new StringBuilder();</span><br><span class="line">        String[] fieldNames = getFiledName(person);</span><br><span class="line"></span><br><span class="line">        for(int j=0 ; j&lt;fieldNames.length ; j++)&#123; //éå†æ‰€æœ‰å±æ€§</span><br><span class="line">            String name = fieldNames[j]; //è·å–å±æ€§çš„åå­—</span><br><span class="line">            Object value = getFieldValueByName(name, person);</span><br><span class="line">            sbName.append(name);</span><br><span class="line">            sbValue.append(value);</span><br><span class="line">            if(j != fieldNames.length - 1) &#123;</span><br><span class="line">                sbName.append(&quot;/&quot;);</span><br><span class="line">                sbValue.append(&quot;/&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;attribute name:&quot;+sbName.toString());</span><br><span class="line">        System.out.println(&quot;attribute value:&quot;+sbValue.toString());</span><br><span class="line">        // æ ¹æ®Methodè·å–ç±»å</span><br><span class="line">        Method method = person.getClass().getMethod(&quot;printName&quot;, new Class[] &#123;&#125;);</span><br><span class="line">        String className = method.getDeclaringClass().getName(); //ç±»å</span><br><span class="line">        String methodName = method.getName();</span><br><span class="line">        System.out.println(&quot;full name:&quot; + className + &quot;.&quot; + methodName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * è·å–å±æ€§åæ•°ç»„</span><br><span class="line">     * */</span><br><span class="line">    private static String[] getFiledName(Object o)&#123;</span><br><span class="line">        Field[] fields=o.getClass().getDeclaredFields();</span><br><span class="line">        String[] fieldNames=new String[fields.length];</span><br><span class="line">        for(int i=0;i&lt;fields.length;i++)&#123;</span><br><span class="line">            // System.out.println(fields[i].getType());</span><br><span class="line">            fieldNames[i]=fields[i].getName();</span><br><span class="line">        &#125;</span><br><span class="line">        return fieldNames;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ ¹æ®å±æ€§åè·å–å±æ€§å€¼</span><br><span class="line">     **/</span><br><span class="line">    private static Object getFieldValueByName(String fieldName, Object o) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            String firstLetter = fieldName.substring(0, 1).toUpperCase();</span><br><span class="line">            String getter = &quot;get&quot; + firstLetter + fieldName.substring(1);</span><br><span class="line">            Method method = o.getClass().getMethod(getter, new Class[] &#123;&#125;);</span><br><span class="line">            Object value = method.invoke(o, new Object[] &#123;&#125;);</span><br><span class="line">            return value;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Person &#123;</span><br><span class="line">        private String name;</span><br><span class="line">        private int age;</span><br><span class="line">        private String gender;</span><br><span class="line"></span><br><span class="line">        public Person(String n,int a,String g) &#123;</span><br><span class="line">            name = n;</span><br><span class="line">            age = a;</span><br><span class="line">            gender = g;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getName() &#123;</span><br><span class="line">            return name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int getAge() &#123;</span><br><span class="line">            return age;</span><br><span class="line">        &#125;</span><br><span class="line">        public String getGender() &#123;</span><br><span class="line">            return gender;</span><br><span class="line">        &#125;</span><br><span class="line">        public void printName() &#123;</span><br><span class="line">            System.out.println(&quot;name is &quot; + name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/xiadongqing/p/16298207.html">https://www.cnblogs.com/xiadongqing/p/16298207.html</a></p>
<p>å…³äºåå°„çš„æ¦‚å¿µï¼š<br>Javaä¸­çš„åå°„æ˜¯é€šè¿‡åå°„APIæ¥å®ç°çš„ã€‚Javaåå°„APIä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„ç±»å’Œæ¥å£ï¼š<br>1ã€Class ç±»ï¼šè¡¨ç¤ºä¸€ä¸ªç±»æˆ–æ¥å£ï¼Œåœ¨è¿è¡Œæ—¶JVMä¸­æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„Classå¯¹è±¡ã€‚<br>2ã€Constructorç±»ï¼šè¡¨ç¤ºä¸€ä¸ªç±»çš„æ„é€ æ–¹æ³•ã€‚<br>3ã€Method ç±»ï¼šè¡¨ç¤ºä¸€ä¸ªç±»çš„æ–¹æ³•ã€‚<br>4ã€Field ç±»ï¼šè¡¨ç¤ºä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡ï¼ˆå­—æ®µï¼‰ã€‚</p>
<p>åå°„å®ç°çš„æ ¸å¿ƒæ˜¯ Class ç±»ï¼Œä¸€ä¸ªç±»åœ¨ç¼–è¯‘åä¼šç”Ÿæˆå¯¹åº”çš„ classæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº†ç±»çš„ç»“æ„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­—æ®µã€æ–¹æ³•ã€æ„é€ å‡½æ•°ç­‰ä¿¡æ¯ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒJVMä¼šè¯»å–è¿™ä¸ª æ–‡ä»¶å¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å½“éœ€è¦ä½¿ç”¨ä¸€ä¸ªç±»æ—¶ï¼ŒJVMä¼šé€šè¿‡ç±»çš„å…¨é™å®šåæ¥æ‰¾åˆ°å¯¹åº”çš„ class æ–‡ä»¶ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚åœ¨åŠ è½½åï¼ŒJVM ä¼šä¸ºæ¯ä¸ªç±»åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ Classå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†ç±»çš„æ‰€æœ‰ç»“æ„ä¿¡æ¯ã€‚</p>
<p>é€šè¿‡ Class å¯¹è±¡å¯ä»¥è·å–ç±»çš„æ‰€æœ‰ç»“æ„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°ã€æ–¹æ³•ã€å­—æ®µç­‰ã€‚å¯ä»¥é€šè¿‡ Constructorã€Method å’ŒField ç­‰ç±»æ¥è¡¨ç¤ºç±»çš„æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå­—æ®µï¼Œé€šè¿‡è¿™äº›ç±»å¯ä»¥è·å–å’Œè°ƒç”¨ç±»çš„æ„é€ å‡½æ•°æ•°ã€æ–¹æ³•å’Œå­—æ®µã€‚</p>
<p>åå°„çš„å®ç°ä¸»è¦ä¾é JVM ä¸­çš„ç±»åŠ è½½æœºåˆ¶å’Œ Classå¯¹è±¡ï¼Œé€šè¿‡ class å¯¹è±¡å¯ä»¥è·å–ç±»çš„æ‰€æœ‰ç»“æ„ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯å¯ä»¥å®ç°å¯¹ç±»çš„åŠ¨æ€æ“ä½œã€‚åœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡åå°„å¯ä»¥åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ã€è®¿é—®å­—æ®µç­‰ï¼Œä»è€Œå®ç°äº†æ¯”è¾ƒçµæ´»çš„ç¼–ç¨‹æ–¹å¼ã€‚</p>
<p>åå°„æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€è·å–å¯¹è±¡ä¿¡æ¯çš„èƒ½åŠ›ã€‚å®ƒå¯ä»¥è®©ç¨‹åºåœ¨è¿è¡Œæ—¶é€šè¿‡å¯¹è±¡çš„å¼•ç”¨æ¥è·å–å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€å±æ€§ã€æ–¹æ³•ç­‰ï¼Œè€Œä¸éœ€è¦åœ¨ç¼–è¯‘æ—¶è¿›è¡Œç¡¬ç¼–ç ã€‚å…·ä½“å®ç°åå°„çš„æ–¹å¼æ˜¯é€šè¿‡åå°„APlæ¥è·å–å¯¹è±¡çš„ç±»ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åã€çˆ¶ç±»ã€æ¥å£ã€æ–¹æ³•ã€å±æ€§ç­‰ï¼Œç„¶åé€šè¿‡åå°„APIæä¾›çš„æ–¹æ³•æ¥æ“ä½œè¿™äº›ä¿¡æ¯ã€‚åœ¨Javaä¸­ï¼Œåå°„APIä¸»è¦åŒ…æ‹¬ Class ç±»ã€Constructorç±»ã€Fieldç±»å’ŒMethodç±»ç­‰ã€‚é€šè¿‡è¿™äº›ç±»ï¼Œå¯ä»¥å®ç°åŠ¨æ€åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ã€è·å–å±æ€§ç­‰æ“ä½œã€‚</p>
<p>åå°„æ˜¯ä¸€ç§å¼ºå¤§çš„ç¼–ç¨‹æŠ€æœ¯ï¼Œä½†ä¹Ÿéœ€è¦è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä¼šå¢åŠ ä»£ç çš„å¤æ‚åº¦å’Œè¿è¡Œæ—¶å¼€é”€ã€‚</p>
<h3 id="javaä¸­çš„StopWatch"><a href="#javaä¸­çš„StopWatch" class="headerlink" title="javaä¸­çš„StopWatch"></a>javaä¸­çš„StopWatch</h3><p>StopWatchä¸åœ¨javaæ ‡å‡†åŒ…ä¸­çš„ï¼Œå¯ä»¥åœ¨ä»¥ä¸‹ä¸¤ä¸ªç¨‹åºåŒ…ä¸­æ‰¾åˆ°StopWatchå·¥å…·ç±»</p>
<p>org.apache.commons.lang3.time<br>Apache Commons Langæä¾›äº†ä¸€äº›Javaæ ‡å‡†åº“ä¸­æ²¡æœ‰æä¾›çš„ç±»ä¸æ–¹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨Stringæ“ä½œæ–¹æ³•ï¼ŒåŸºç¡€æ•°å€¼æ–¹æ³•ï¼Œå¯¹è±¡å¼•ç”¨ï¼Œå¹¶å‘è¡Œï¼Œåˆ›å»ºåŠåºåˆ—åŒ–ï¼Œç³»ç»Ÿå±æ€§ç­‰æ–¹é¢æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½</p>
<p>org.springframework.util<br>springæ¡†æ¶ä¸ºç°ä»£javaä¼ä¸šçº§åº”ç”¨æä¾›äº†ä¸€ä¸ªç®€æ´å¹¶ä¸”å¯Œæœ‰è¡¨è¾¾èƒ½åŠ›çš„å¯ä»¥è¿è¡Œåœ¨ä»»ä½•éƒ¨ç½²å¹³å°çš„ç¼–ç¨‹ä¸è®¾ç½®æ¨¡å‹</p>
<p>çœ‹ä¸€ä¸‹springä¸­çš„æ€ä¹ˆç”¨ï¼Œå¯ä»¥ä¼˜é›…åœ°æ‰“å°å‡ºå¤šä¸ªä»»åŠ¡çš„è¯¦ç»†è€—æ—¶æƒ…å†µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class StopWatchTest &#123;</span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        StopWatch sw = new StopWatch(&quot;æ¨¡æ¿æµ‹è¯•&quot;);</span><br><span class="line"></span><br><span class="line">        sw.start(&quot;ä»»åŠ¡1&quot;);</span><br><span class="line">        Thread.sleep(1000 * 1);</span><br><span class="line">        sw.stop();</span><br><span class="line"></span><br><span class="line">        sw.start(&quot;ä»»åŠ¡2&quot;);</span><br><span class="line">        Thread.sleep(1000 * 2);</span><br><span class="line">        sw.stop();</span><br><span class="line"></span><br><span class="line">        sw.start(&quot;ä»»åŠ¡3&quot;);</span><br><span class="line">        Thread.sleep(1000 * 3);</span><br><span class="line">        sw.stop();</span><br><span class="line"></span><br><span class="line">        //æ‰“å°å„å­ä»»åŠ¡è€—æ—¶æ¯”ä¾‹</span><br><span class="line">        System.out.println(sw.prettyPrint());</span><br><span class="line">        System.out.println(&quot;æ‰€æœ‰ä»»åŠ¡æ€»è€—æ—¶ï¼š&quot; + sw.getTotalTimeMillis() + &quot;ms&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šï¼š<a href="https://blog.csdn.net/qfzhaohan/article/details/121379893">https://blog.csdn.net/qfzhaohan/article/details/121379893</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå¸¸è§„æ¥å£ã€ç±»</title>
    <url>/2022/04/30/myblog/java/java%E6%8E%A5%E5%8F%A3&amp;%E7%B1%BB/</url>
    <content><![CDATA[<h3 id="Serializableæ¥å£"><a href="#Serializableæ¥å£" class="headerlink" title="Serializableæ¥å£"></a>Serializableæ¥å£</h3><p>ä½äºjava.io.SerializableåŒ…ä¸­ï¼Œä¸€èˆ¬åœ¨åˆ›å»ºå®ä½“ç±»çš„æ—¶å€™ä¼šå»å®ç°è¿™ä¸ªæ¥å£ï¼Œç›®çš„æ˜¯ä¸ºäº†åºåˆ—åŒ–ã€‚</p>
<p>åºåˆ—åŒ–æŒ‡çš„æ˜¯æŠŠå¯¹è±¡è½¬åŒ–æˆå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ï¼Œå°±æ˜¯æŠŠå†…å­˜ä¸­çš„å¯¹è±¡è½¬æ¢æˆä¸€è¿ä¸²çš„å­—èŠ‚bytesæè¿°çš„è¿‡ç¨‹ã€‚<br>ååºåˆ—åŒ–å°±æ˜¯å°†å­—èŠ‚bytesæ•°æ®æ¢å¤ä¸ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚</p>
<p>éœ€è¦å°†å†…å­˜ä¸­å¯¹è±¡çŠ¶æ€æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­æ—¶ï¼Œéœ€è¦è¿›è¡Œåºåˆ—åŒ–ã€‚è¿™ä¸ªæ¯”è¾ƒç›´è§‚çš„å°±æ˜¯é€šè¿‡ObjectOutputStreamå’ŒFileOutputStreamå‘æ–‡ä»¶ä¸­ä¿å­˜å¯¹è±¡æ—¶ï¼Œå®ç°äº†Serializableæ¥å£çš„å¯¹è±¡ä¼šä»¥äºŒè¿›åˆ¶æ•°æ®çš„å½¢å¼ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œè€Œæœªå®ç°Serializableæ¥å£çš„å¯¹è±¡åˆ™ä¼šç›´æ¥æŠ¥é”™ï¼Œæ— æ³•ä¿å­˜ã€‚</p>
<p>serialVersionUIDï¼š<br>å¦‚æœåœ¨è¿›è¡Œååºåˆ—åŒ–å‰ï¼Œå°†æŸä¸ªå®ä½“ç±»åŸæœ‰çš„serialVersionUIDæ”¹å˜ï¼Œåœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶å°±ä¼šæŠ¥InvalidClassExceptionå¼‚å¸¸ã€‚<br>å¦‚æœæ²¡æœ‰æŒ‡å®šserialVersionUIDï¼Œåœ¨è¿›è¡Œåºåˆ—åŒ–æ—¶ï¼ŒJVMä¼šé€šè¿‡è®¡ç®—ç»™è¯¥ç±»ä¸€ä¸ªé»˜è®¤çš„serialVersionUIDå€¼ã€‚<br>ä½†æ˜¯ä¸å»ºè®®ä¸æŒ‡å®šserialVersionUIDï¼Œé«˜åº¦ä¾èµ–äºJVMé»˜è®¤ç”ŸæˆserialVersionUIDï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä¸ç¼–è¯‘å™¨çš„å®ç°ç»†èŠ‚è€¦åˆï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å‘ç”Ÿæ„å¤–çš„InvalidClassExceptionå¼‚å¸¸ã€‚ä¸ªäººè®¤ä¸ºåº”è¯¥æ˜¯æŒ‡ä¸åŒç¼–è¯‘å™¨ç¼–è¯‘çš„ä¸åŒç±»å¯èƒ½äº§ç”Ÿä¸€ä¸ªç›¸åŒçš„é»˜è®¤serialVersionUIDã€‚<br>å¦å¤–å°½é‡ç”¨privateæ¥ä¿®é¥°serialVersionUIDã€‚</p>
<hr>
<p>Serializableå…¶å®æ˜¯ä¸ªç©ºæ¥å£ï¼Œç”¨æ¥æ ‡è¯†å½“å‰ç±»å¯ä»¥è¢«åºåˆ—åŒ–ã€‚<br>å‘Šè¯‰jvmï¼Œè®©jvmå¸®å¿™åšåºåˆ—åŒ–ã€‚</p>
<p>å®ç°äº†Serializableæ¥å£çš„ç±»å¯ä»¥è¢«ObjectOutputStreamè½¬æ¢ä¸ºå­—èŠ‚æµï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ObjectInputStreamå†å°†å…¶è§£æä¸ºå¯¹è±¡ã€‚</p>
<p>âœ…ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Ÿ</p>
<p>åºåˆ—åŒ–ï¼ˆserializeï¼‰ - åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµã€‚<br>ååºåˆ—åŒ–ï¼ˆdeserializeï¼‰ - ååºåˆ—åŒ–æ˜¯å°†å­—èŠ‚æµè½¬æ¢ä¸ºå¯¹è±¡ã€‚</p>
<p>ä½œç”¨ï¼š<br>åºåˆ—åŒ–å¯ä»¥å°†å¯¹è±¡çš„å­—èŠ‚åºåˆ—æŒä¹…åŒ–â€”â€”ä¿å­˜åœ¨å†…å­˜ã€æ–‡ä»¶ã€æ•°æ®åº“ä¸­ã€‚<br>åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„å­—èŠ‚åºåˆ—ã€‚<br>RMI(è¿œç¨‹æ–¹æ³•è°ƒç”¨)</p>
<p>ä»€ä¹ˆæ—¶å€™ç”¨ï¼š<br>1ã€æƒ³æŠŠå†…å­˜ä¸­çš„å¯¹è±¡çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­æˆ–è€…æ•°æ®åº“ä¸­æ—¶<br>2ã€æƒ³æŠŠå¯¹è±¡é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“æ—¶</p>
<p>âœ…å¦‚ä½•ä½¿ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Genderç±»ï¼Œè¡¨ç¤ºæ€§åˆ«</span><br><span class="line">// æ¯ä¸ªæšä¸¾ç±»å‹éƒ½ä¼šé»˜è®¤ç»§æ‰¿ç±»java.lang.Enumï¼Œè€ŒEnumç±»å®ç°äº†Serializableæ¥å£ï¼Œæ‰€ä»¥æšä¸¾ç±»å‹å¯¹è±¡éƒ½æ˜¯é»˜è®¤å¯ä»¥è¢«åºåˆ—åŒ–çš„ã€‚</span><br><span class="line">public enum Gender &#123;  </span><br><span class="line">    MALE, FEMALE  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">// Person ç±»å®ç°äº† Serializable æ¥å£ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªå­—æ®µã€‚å¦å¤–ï¼Œå®ƒè¿˜é‡å†™äº†è¯¥ç±»çš„ toString() æ–¹æ³•ï¼Œä»¥æ–¹ä¾¿æ‰“å° Person å®ä¾‹ä¸­çš„å†…å®¹ã€‚</span><br><span class="line">public class Person implements Serializable &#123;  </span><br><span class="line">    private String name = null;  </span><br><span class="line">    private Integer age = null;  </span><br><span class="line">    private Gender gender = null;  </span><br><span class="line"></span><br><span class="line">    public Person() &#123;  </span><br><span class="line">        System.out.println(&quot;none-arg constructor&quot;);  </span><br><span class="line">    &#125;  </span><br><span class="line"> </span><br><span class="line">    public Person(String name, Integer age, Gender gender) &#123;  </span><br><span class="line">        System.out.println(&quot;arg constructor&quot;);  </span><br><span class="line">        this.name = name;  </span><br><span class="line">        this.age = age;  </span><br><span class="line">        this.gender = gender;  </span><br><span class="line">    &#125;  </span><br><span class="line"> </span><br><span class="line">    // çœç•¥ set get æ–¹æ³•</span><br><span class="line">    @Override </span><br><span class="line">    public String toString() &#123;  </span><br><span class="line">        return &quot;[&quot; + name + &quot;, &quot; + age + &quot;, &quot; + gender + &quot;]&quot;;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">// SimpleSerialç±»ï¼Œæ˜¯ä¸€ä¸ªç®€å•çš„åºåˆ—åŒ–ç¨‹åºï¼Œå®ƒå…ˆå°†Personå¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶person.outä¸­ï¼Œç„¶åå†ä»è¯¥æ–‡ä»¶ä¸­è¯»å‡ºè¢«å­˜å‚¨çš„Personå¯¹è±¡ï¼Œå¹¶æ‰“å°è¯¥å¯¹è±¡ã€‚</span><br><span class="line">public class SimpleSerial &#123;  </span><br><span class="line">    public static void main(String[] args) throws Exception &#123;  </span><br><span class="line">        File file = new File(&quot;person.out&quot;);  </span><br><span class="line">        ObjectOutputStream oout = new ObjectOutputStream(new FileOutputStream(file)); // æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ ObjectOutputStream å¯¹è±¡è¾“å‡ºæµå°è£…å…¶ä»–çš„è¾“å‡ºæµ</span><br><span class="line">        Person person = new Person(&quot;John&quot;, 101, Gender.MALE);  </span><br><span class="line">        oout.writeObject(person);  </span><br><span class="line">        oout.close();  </span><br><span class="line"> </span><br><span class="line">        ObjectInputStream oin = new ObjectInputStream(new FileInputStream(file));  // ä½¿ç”¨å¯¹è±¡è¾“å…¥æµè¯»å–åºåˆ—åŒ–çš„å¯¹è±¡</span><br><span class="line">        Object newPerson = oin.readObject(); // æ²¡æœ‰å¼ºåˆ¶è½¬æ¢åˆ°Personç±»å‹  </span><br><span class="line">        oin.close();  </span><br><span class="line">        System.out.println(newPerson);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">// ä¸Šè¿°ç¨‹åºçš„è¾“å‡ºçš„ç»“æœä¸ºï¼š</span><br><span class="line">arg constructor  </span><br><span class="line">[John, 31, MALE]</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼šç®€ä¹¦<br><a href="https://www.jianshu.com/p/8e4a9cac727f">https://www.jianshu.com/p/8e4a9cac727f</a></p>
<p>csdnï¼š<a href="https://blog.csdn.net/u011568312/article/details/57611440">https://blog.csdn.net/u011568312/article/details/57611440</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">âœ…Serializableæ˜¯javaä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œä¸»è¦ç”¨äºå®ç°å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</span><br><span class="line">åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬æ¢æˆå­—èŠ‚æµçš„è¿‡ç¨‹ï¼Œé€šå¸¸ç”¨äºå°†å¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶ä¸­æˆ–ç½‘ç»œä¸­ã€‚</span><br><span class="line">ååºåˆ—åŒ–æ˜¯å°†å­—èŠ‚æµè½¬æ¢å›å¯¹è±¡çš„è¿‡ç¨‹ï¼Œé€šå¸¸ç”¨äºè¯»å–æ–‡ä»¶æˆ–ç½‘ç»œä¸­çš„å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">å®ç°Serializableæ¥å£åï¼Œå°±å¯ä»¥ä½¿ç”¨javaæä¾›çš„ObjectOutputStreamå’ŒObjectInputStreamå°†å¯¹è±¡åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</span><br><span class="line"></span><br><span class="line">å°†ä¸€ä¸ªPersonå¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼š</span><br><span class="line">Person person = new Person(&quot;name&quot;);</span><br><span class="line">FileOutputStream fos = new FileOutputStream(&quot;person.txt&quot;);</span><br><span class="line">ObjectOutputStream oos = new ObjectOutputStream(fos);</span><br><span class="line">oos.writeObject(person);</span><br><span class="line"></span><br><span class="line">ä»æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªPersonå¯¹è±¡å¹¶ååºåˆ—åŒ–ï¼š</span><br><span class="line">FileInputStream fis = new FileInputStream(&quot;person.txt&quot;);</span><br><span class="line">ObjectInputStream ois = new ObjectInputStream(fis);</span><br><span class="line">Person person = (Person)ois.readObject();</span><br><span class="line"></span><br><span class="line">ååºåˆ—åŒ–å’Œåºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¿è¯å¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œ</span><br><span class="line">å¦‚æœæŸä¸ªå±æ€§ä¸å¯åºåˆ—åŒ–ï¼Œå¯ä»¥ä½¿ç”¨transientå…³é”®å­—ä¿®é¥°ï¼Œè¡¨ç¤ºè¯¥å±æ€§ä¸å‚ä¸åºåˆ—åŒ–ã€‚</span><br><span class="line">private transient int age;</span><br><span class="line"></span><br><span class="line">âœ…Serializableå’ŒJSONåºåˆ—åŒ–çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">Serializableå’ŒJSONåºåˆ—åŒ–éƒ½æ˜¯javaä¸­ä¸¤ç§ä¸åŒçš„åºåˆ—åŒ–æ–¹å¼ï¼Œå®ƒä»¬å„è‡ªæœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œç‰¹ç‚¹ã€‚</span><br><span class="line"></span><br><span class="line">Serializable æ˜¯Java ä¸­çš„ä¸€ç§é»˜è®¤çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå®ƒæ˜¯å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œ</span><br><span class="line">å¯ä»¥å°†Java å¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶æˆ–ç½‘ç»œä¸­ã€‚serializable åºåˆ—åŒ–æ–¹å¼å¯ä»¥æ”¯æŒ Java ä¸­çš„æ‰€æœ‰ç±»å’Œå¯¹è±¡ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç±»å’Œç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»ï¼Œä½†æ˜¯åºåˆ—åŒ–åçš„æ•°æ®é€šå¸¸æ¯”è¾ƒéš¾ä»¥é˜…è¯»å’Œå¤„ç†ã€‚</span><br><span class="line">JSON åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ ¼å¼ï¼Œå¯ä»¥å°†Java å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²æˆ–å­—èŠ‚æ•°ç»„ï¼Œ</span><br><span class="line">é€šå¸¸ç”¨äº Web åº”ç”¨ä¸­çš„æ•°æ®ä¼ è¾“ã€APIæ¥å£çš„å¼€å‘ç­‰åœºæ™¯ã€‚</span><br><span class="line">ä¸Serializable åºåˆ—åŒ–æ–¹å¼ä¸åŒï¼ŒJSON åºåˆ—åŒ–å¯ä»¥è·¨è¯­è¨€ä½¿ç”¨ï¼Œå› ä¸º JSON æ ¼å¼æ˜¯ä¸€ç§é€šç”¨çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå¯ä»¥è¢«å‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€è§£æå’Œå¤„ç†ã€‚</span><br><span class="line">åœ¨Java ä¸­ï¼Œä½¿ç”¨JSON åºåˆ—åŒ–å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ Jacksonã€Gson ç­‰ç­‰ã€‚è¿™äº›åº“æä¾›äº†ä¸°å¯Œçš„ API å’Œé…ç½®é€‰é¡¹ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºJSON æ ¼å¼ï¼Œå¹¶ä¸”æ”¯æŒååºåˆ—åŒ–ï¼Œå°†JSON æ ¼å¼çš„å®‡ç¬¦ä¸²æˆ–å­—èŠ‚æ•°ç»„è½¬æ¢å› Java å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">âœ…è¢«@RequestBodyä¿®é¥°çš„è‡ªå®šä¹‰å˜é‡éœ€è¦å®ç°Serializableå—ï¼Ÿ</span><br><span class="line">åœ¨ Spring MVC ä¸­ï¼Œ@ReauestBodyæ³¨è§£ç”¨äºæ¥æ”¶ HTTP è¯·æ±‚ä¸­çš„JSONXMLæ ¼å¼çš„æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º Java å¯¹è±¡ã€‚</span><br><span class="line">è¢« @RequestBody ä¿®é¥°çš„è‡ªå®šä¹‰å˜é‡åœ¨æ¥æ”¶è¯·æ±‚æ•°æ®å¹¶è¿›è¡Œè½¬æ¢æ—¶ï¼Œå¹¶ä¸éœ€è¦å®ç° Serializable æ¥å£ã€‚</span><br><span class="line">Serializable æ¥å£ä¸»è¦ç”¨äº Java å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå³å°† Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œæˆ–å°†å­—èŠ‚æµè½¬æ¢ä¸º Java å¯¹è±¡ã€‚</span><br><span class="line">è€Œ @RequestBody æ³¨è§£æ¥æ”¶çš„è¯·æ±‚æ•°æ®æ˜¯ JSON/XMLæ ¼å¼çš„å®‡ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯Java å¯¹è±¡çš„å­—èŠ‚æµï¼Œå› æ­¤ä¸éœ€è¦å®ç° Serializable æ¥å£ã€‚</span><br><span class="line"></span><br><span class="line">âœ…ä»€ä¹ˆæƒ…å†µä¸‹çš„ç½‘ç»œä¼ è¾“éœ€è¦è‡ªå®šä¹‰å˜é‡å®ç° Serializableï¼Ÿ</span><br><span class="line">åœ¨Java ä¸­ï¼Œå¦‚æœéœ€è¦å°†å¯¹è±¡é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“ï¼Œéœ€è¦å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œç„¶åå†è¿›è¡Œä¼ è¾“ã€‚</span><br><span class="line">æ­¤æ—¶ï¼Œè¢«ä¼ è¾“çš„å¯¹è±¡éœ€è¦å®ç° Serializable æ¥å£ï¼Œç¡®ä¿å¯¹è±¡çš„å±æ€§å¯ä»¥è¢«æ­£ç¡®åœ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</span><br><span class="line">å®ç° Serializable æ¥å£çš„å¯¹è±¡å¯ä»¥è¢«åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œç„¶åé€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“ã€‚åœ¨ç½‘ç»œä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼ŒJVM ä¼šå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œç„¶åå‘é€åˆ°å…¶ä»–è®¡ç®—æœºä¸Šï¼Œæ¥æ”¶æ–¹å†å°†å­—èŠ‚æµè½¬æ¢ä¸ºå¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">1è¿œç¨‹æ–¹æ³•è°ƒç”¨ (Remote Method lInvocationï¼Œç®€ç§° RMI)ï¼šRMIå…è®¸Java ç¨‹åºåœ¨åˆ†å¸ƒå¼ç½‘ç»œç¯å¢ƒä¸­è¿›è¡Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œå…¶ä¸­éœ€è¦å°†æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ Serializable åºåˆ—åŒ–ä¼ è¾“çš„å¯¹è±¡ã€‚</span><br><span class="line">2.Java åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¡†æ¶ï¼šä¾‹å¦‚ Spring Bootã€Apache Dubbã€‚ ç­‰æ¡†æ¶ï¼Œå®ƒä»¬å¯ä»¥å°†Java å¯¹è±¡åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œå¹¶è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œä»¥å®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼€å‘å’Œéƒ¨ç½²ã€‚</span><br><span class="line">3. Web åº”ç”¨ä¸­çš„æ•°æ®ä¼ è¾“ï¼šä¾‹å¦‚ä½¿ç”¨ Ajax å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ é€’JSON æˆ– xMLæ ¼å¼çš„æ•°æ®ç­‰åœºæ™¯ã€‚</span><br><span class="line"></span><br><span class="line">@JSONField(serialize = false)ä»€ä¹ˆæ„æ€ï¼Ÿ</span><br><span class="line">@JSONField(serialize = false) æ˜¯é˜¿é‡Œå·´å·´ FastJSON åº“æ‘„ä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œ</span><br><span class="line">ç”¨äºåœ¨å°† Java å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²æ—¶ï¼Œå¿½ç•¥å½“å‰å±æ€§çš„å€¼ã€‚</span><br><span class="line">è¯¥æ³¨è§£å¯ä»¥ç”¨åœ¨ Javaç±»çš„å±æ€§ä¸Šï¼Œè¡¨ç¤ºåœ¨åºåˆ—åŒ–æ—¶ä¸å°†è¯¥å±æ€§çš„å€¼åºåˆ—åŒ–åˆ° JSON å®‡ç¬¦ä¸²ä¸­ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="MultipartFileæ¥å£"><a href="#MultipartFileæ¥å£" class="headerlink" title="MultipartFileæ¥å£"></a>MultipartFileæ¥å£</h3><p>ç”¨äºhttpä¸­è·å–å‰å°ä¼ æ¥çš„æ–‡ä»¶</p>
<p>ä½äºï¼špackage org.springframework.web.multipart;åŒ…ä¸‹<br>ä¸­æ–‡åï¼šå¤šç»„ä»¶æ–‡æ¡£<br>ç»§æ‰¿è‡ªï¼šInputStreamSource,å¹¶å°è£…äº†getInputStream()æ–¹æ³•<br>æ­¤æ–¹æ³•ç”¨æ³•ï¼š<code>@RequesParam(&quot;file&quot;)MultipartFile file</code><br><code>InputStream is  = file.getInputStream();</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String getName():å¾—åˆ°çš„æ˜¯@RequesParam(value = &quot;file&quot;)ä¸­çš„valueå€¼ï¼Œä¸ä¼šä¸ºç©ºã€‚</span><br><span class="line">String getOriginalFilename():è·å–çš„æ˜¯æ–‡ä»¶çš„å®Œæ•´åç§°ï¼ŒåŒ…æ‹¬æ–‡ä»¶åç§°+æ–‡ä»¶æ‹“å±•åã€‚</span><br><span class="line">String getContentType()ï¼šè¿”å›æ–‡ä»¶å†…å®¹ç±»å‹ï¼Œä¸æ˜¯æ–‡ä»¶æ‰©å±•åï¼ˆä¾‹å¦‚ï¼šjpegå›¾ç‰‡ï¼šimage/jpegï¼‰</span><br><span class="line">boolean isEmpty()ï¼šè¿”å›ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦ä¸ºç©ºï¼Œå³multipartå½¢å¼ä¸­æ²¡æœ‰é€‰æ‹©ä»»ä½•æ–‡ä»¶æˆ–è€…é€‰æ‹©çš„æ–‡ä»¶æ²¡æœ‰å†…å®¹</span><br><span class="line">long getSize()ï¼šä»¥å­—èŠ‚ä¸ºå•ä½è¿”å›æ–‡ä»¶å¤§å°</span><br><span class="line">byte[] getBytes()ï¼šä»¥å­—èŠ‚æ•°ç»„çš„å½¢å¼è¿”å›æ–‡ä»¶å†…å®¹</span><br><span class="line">InputStream getInputStream()ï¼šè¿”å›ä¸€ä¸ªå­—èŠ‚æµ</span><br><span class="line">void transferTo()ï¼šç”¨æ¥å°†æ¥æ”¶æ–‡ä»¶ä¼ è¾“åˆ°ç»™å®šç›®æ ‡è·¯å¾„ï¼Œä¼šæŠ›å‡ºIOExceptionã€IllegalStateExceptionå¼‚å¸¸ã€‚è¯¥æ–¹æ³•åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ä½¿ç”¨è¾ƒå°‘ã€‚</span><br></pre></td></tr></table></figure>





<h3 id="Patternç±»-Matcherç±»"><a href="#Patternç±»-Matcherç±»" class="headerlink" title="Patternç±»&amp;Matcherç±»"></a>Patternç±»&amp;Matcherç±»</h3><p>Patternç±»æ˜¯java.util.regexåŒ…ä¸­çš„finalç±»ã€‚æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ç¼–è¯‘è¡¨ç¤ºå½¢å¼ï¼Œæ­¤ç±»çš„å®ä¾‹æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä¾›å¤šä¸ªå¹¶å‘çº¿ç¨‹å®‰å…¨ä½¿ç”¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å®šä¹‰</span><br><span class="line">public final class Pattern extends Object implements Serializable</span><br><span class="line"></span><br><span class="line">//Patternè°ƒç”¨é™æ€æ–¹æ³•compileè¿”å›Patternå®ä¾‹ã€‚</span><br><span class="line">// å°†ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘å¹¶èµ‹äºˆç»™Patternç±»</span><br><span class="line">Pattern pattern = Pattern.compile(paternStr);</span><br><span class="line"></span><br><span class="line">// å¢åŠ flagå‚æ•°çš„æŒ‡å®šï¼Œå¯é€‰çš„flagå‚æ•°åŒ…æ‹¬ï¼šCASE INSENSITIVE,MULTILINE,DOTALL,UNICODE CASEï¼Œ CANON EQ </span><br><span class="line">static Pattern compile(String regex, int flags) </span><br><span class="line">//å…ˆä¸æ˜ç™½</span><br><span class="line"></span><br><span class="line">//Pattern.split()ï¼ˆé™æ€æ–¹æ³•ï¼‰å’Œstring.split()ç”¨é€”ä¸€æ ·ï¼Œ</span><br><span class="line">//æ˜¯å°†å­—ç¬¦ä¸²ä»æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„åœ°æ–¹åˆ†å¼€</span><br><span class="line">String input = &quot;This!!unusual use!!hh!!points&quot;;</span><br><span class="line">System.out.println(Arrays.toString(Pattern.compile(&quot;!!&quot;).split(input)));</span><br><span class="line">System.out.println(Arrays.toString(Pattern.compile(&quot;!!&quot;).split(input, 3)));</span><br><span class="line">// ç¬¬äºŒç§ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨æ¥é™åˆ¶å°†è¾“å…¥åˆ†å‰²æˆå­—ç¬¦ä¸²çš„æ•°é‡</span><br></pre></td></tr></table></figure>

<p>æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\\d è¡¨ç¤ºæ•°å­—ï¼Œå‰é¢å¤šäº†ç¬¬ä¸€ä¸ª\ï¼Œæ˜¯è½¬ä¹‰çš„æ„æ€ã€‚</span><br><span class="line">+è¡¨ç¤ºé‡å¤å‰é¢çš„</span><br><span class="line">\\d+ è¡¨ç¤ºå¤šä¸ªæ•°å­—</span><br></pre></td></tr></table></figure>

<p>Matcherå¯¹è±¡æ˜¯ä¸€ä¸ªçŠ¶æ€æœºå™¨ï¼Œå®ƒä¾æ®Patternå¯¹è±¡åšä¸ºåŒ¹é…æ¨¡å¼å¯¹å­—ç¬¦ä¸²å±•å¼€åŒ¹é…æ£€æŸ¥ï¼Œæ­¤ç±»çš„å®ä¾‹ç”¨äºå¤šä¸ªå¹¶å‘çº¿ç¨‹æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Pattern.matcher é™æ€æ–¹æ³•ï¼š</span><br><span class="line">Pattern.matcher(String regex,CharSequence input)</span><br><span class="line">é™æ€æ–¹æ³•,ç”¨äºå¿«é€ŸåŒ¹é…å­—ç¬¦ä¸²,åŒ¹é…å…¨éƒ¨å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">pattern.matcher(CharSequence input):</span><br><span class="line">è¿”å›ä¸€ä¸ªMatcherå¯¹è±¡ã€‚</span><br><span class="line">Matcherç±»çš„æ„é€ æ–¹æ³•ä¹Ÿæ˜¯ç§æœ‰çš„,ä¸èƒ½éšæ„åˆ›å»º,</span><br><span class="line">åªèƒ½é€šè¿‡pattern.matcher(CharSequence input)æ–¹æ³•å¾—åˆ°è¯¥ç±»çš„å®ä¾‹</span><br><span class="line"></span><br><span class="line">Pattern p=Pattern.compile(&quot;\\d+&quot;); </span><br><span class="line">Matcher m=p.matcher(&quot;22bb23&quot;); </span><br><span class="line">m.pattern();//è¿”å›p ä¹Ÿå°±æ˜¯è¿”å›è¯¥Matcherå¯¹è±¡æ˜¯ç”±å“ªä¸ªPatternå¯¹è±¡çš„åˆ›å»ºçš„</span><br></pre></td></tr></table></figure>

<p>ç”¨Patternä»¥åŠMatcheråŒ¹é…ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String str = &quot;aa11bb&quot;;</span><br><span class="line">String paternStr = &quot;\\d+&quot;;</span><br><span class="line">Pattern pattern = Pattern.compile(paternStr);</span><br><span class="line">Matcher matcher = pattern.matcher(str);</span><br><span class="line">if (matcher.find()) &#123;   //æœ‰åŒ¹é…å°±è¡Œ</span><br><span class="line">    System.out.println(matcher.group(0));  //è¾“å‡º11</span><br><span class="line">&#125;</span><br><span class="line">if (matcher.matches()) &#123;  //éœ€è¦å®Œå…¨åŒ¹é…</span><br><span class="line">    System.out.println(matcher.group(0));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šæ–¹æ³•ï¼š<br><a href="https://blog.csdn.net/woniu317/article/details/52186694">https://blog.csdn.net/woniu317/article/details/52186694</a><br><a href="http://www.51gjie.com/java/759.html">http://www.51gjie.com/java/759.html</a></p>
<h3 id="Functionæ¥å£"><a href="#Functionæ¥å£" class="headerlink" title="Functionæ¥å£"></a>Functionæ¥å£</h3><p>JDKæä¾›äº†å¤§é‡å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£ä»¥ä¸°å¯ŒLambdaçš„å…¸å‹ä½¿ç”¨åœºæ™¯ï¼Œå®ƒä»¬ä¸»è¦åœ¨ java.util.function åŒ…ä¸­è¢«æä¾›ã€‚ </p>
<p>java.util.function.Function&lt;T,R&gt; æ¥å£ç”¨æ¥æ ¹æ®ä¸€ä¸ªç±»å‹çš„æ•°æ®å¾—åˆ°å¦ä¸€ä¸ªç±»å‹çš„æ•°æ®ï¼Œå‰è€…ç§°ä¸ºå‰ç½®æ¡ä»¶ï¼Œåè€…ç§°ä¸ºåç½®æ¡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">public interface Function&lt;T, R&gt; &#123;</span><br><span class="line">    R apply(T t);</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼šèµ·åˆ°äº†è½¬æ¢ç±»å‹çš„ä½œç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class FunctionTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        method(s -&gt; Integer.parseInt(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void method(Function&lt;String, Integer&gt; function) &#123;</span><br><span class="line">        int num = function.apply(&quot;10&quot;);</span><br><span class="line">        System.out.println(num + 20);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–æ–¹æ³•ï¼šå¦‚andThenæ–¹æ³•<br><a href="http://t.zoukankan.com/liyihua-p-12286100.html">http://t.zoukankan.com/liyihua-p-12286100.html</a></p>
<p>å’Œ@FunctionalInterfaceä½œç”¨ä¸€æ ·ï¼Ÿ</p>
<h3 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h3><p>å‡½æ•°å¼æ¥å£å°±æ˜¯åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚</p>
<p>å‡½æ•°å¼æ¥å£ï¼Œå³é€‚ç”¨äºå‡½æ•°å¼ç¼–ç¨‹åœºæ™¯çš„æ¥å£ã€‚è€ŒJavaä¸­çš„å‡½æ•°å¼ç¼–ç¨‹ä½“ç°å°±æ˜¯Lambdaï¼Œæ‰€ä»¥å‡½æ•°å¼æ¥å£å°±æ˜¯å¯ä»¥é€‚ç”¨äºLambdaä½¿ç”¨çš„æ¥å£ã€‚åªæœ‰ç¡®ä¿æ¥å£ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒJavaä¸­çš„Lambdaæ‰èƒ½é¡ºåˆ©åœ°è¿›è¡Œæ¨å¯¼ã€‚å¯ä»¥æœ‰å¤šä¸ªdefaultæ–¹æ³•ã€‚</p>
<p>ä¸ºäº†é¿å…åˆ«äººåœ¨è¿™ä¸ªæ¥å£ä¸­å¢åŠ æ¥å£å‡½æ•°å¯¼è‡´å…¶æœ‰å¤šä¸ªæ¥å£å‡½æ•°éœ€è¦è¢«å®ç°ï¼Œå˜æˆâ€éå‡½æ•°æ¥å£â€ï¼Œå¯ä»¥åœ¨æ¥å£ä¸ŠåŠ ä¸Šä¸€ä¸ªæ³¨è§£<code>@FunctionalInterface</code>, è¿™æ ·åˆ«äººå°±æ— æ³•åœ¨é‡Œé¢æ·»åŠ æ–°çš„æ¥å£å‡½æ•°äº†ã€‚</p>
<p><code>@FunctionalInterface public interface Function&lt;T, R&gt; &#123;   &#125;</code></p>
<p>åœ¨java.util.functionåŒ…ä¸‹ï¼š</p>
<h4 id="âœ…Functionæ¥å£"><a href="#âœ…Functionæ¥å£" class="headerlink" title="âœ…Functionæ¥å£"></a>âœ…Functionæ¥å£</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">public interface Function&lt;T, R&gt; &#123;</span><br><span class="line">    R apply(T t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å‹æ¥å£ï¼š<code>Function&lt;T, R&gt;</code>ï¼Œæœ‰å‚æœ‰è¿”å›å€¼ï¼Œæ¥å—ä¸€ä¸ªTç±»å‹çš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªRç±»å‹çš„è¿”å›å€¼ã€‚</p>
<p>å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼š<code>R apply(T t);</code></p>
<p>Tæ˜¯è¾“å…¥ï¼ŒRæ˜¯è¾“å‡ºï¼Œè¡¨ç¤ºä¸€ä¸ªç±»å‹è½¬æ¢ï¼Œlambdaè¡¨è¾¾å¼å®ç°applyæ–¹æ³•ã€‚<br>streamçš„mapæ–¹æ³•ï¼Œä¼ å‚å°±æ˜¯Functionï¼Œè¡¨ç¤ºæ˜ å°„ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class FunctionTest &#123;</span><br><span class="line">    Function&lt;String, String&gt; function = (str) -&gt; &#123;</span><br><span class="line">        return &quot;hello,&quot; + str;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    String funDemo(String str2, Function&lt;String, String&gt; function) &#123;</span><br><span class="line">        return function.apply(str2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFunDemo() &#123;</span><br><span class="line">        System.out.println(funDemo(&quot;å°æ˜&quot;, function));</span><br><span class="line">        System.out.println(funDemo(&quot;å°ç¾&quot;, str -&gt; &quot;hello&quot;+str));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…Predicateæ¥å£"><a href="#âœ…Predicateæ¥å£" class="headerlink" title="âœ…Predicateæ¥å£"></a>âœ…Predicateæ¥å£</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">public interface Predicate&lt;T&gt; &#123;</span><br><span class="line">    boolean test(T t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–­è¨€å‹æ¥å£ï¼š<code>Predicate&lt;T&gt;</code> æœ‰å‚æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼æ˜¯booleanç±»å‹ï¼Œç”¨æ¥åˆ¤æ–­æŸé¡¹æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚ç»å¸¸ç”¨æ¥è¿›è¡Œç­›æ»¤æ“ä½œã€‚</p>
<p>å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼š<code>boolean test(T t);</code></p>
<p>Tæ˜¯è¾“å…¥ï¼Œè¾“å‡ºbooleanç±»å‹ï¼Œè¡¨ç¤ºä¸€ç§æ¡ä»¶è¿‡æ»¤ã€‚<br>streamçš„filteræ–¹æ³•ç©¿å‚æ˜¯Predicateã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class PredicateTest &#123;</span><br><span class="line">    Predicate&lt;Integer&gt; predicate = (i) -&gt; &#123;</span><br><span class="line">        return i &gt; 10;</span><br><span class="line">    &#125;;</span><br><span class="line">    boolean preDemo(Integer i, Predicate&lt;Integer&gt; predicate) &#123;</span><br><span class="line">        return predicate.test(i);</span><br><span class="line">    &#125;</span><br><span class="line">    @Test</span><br><span class="line">    public void testPreDemo() &#123;</span><br><span class="line">        System.out.println(preDemo(12, predicate));//æ‰“å°ç»“æœï¼štrue</span><br><span class="line">        System.out.println(preDemo(12, i -&gt; i &gt; 13));//æ‰“å°ç»“æœï¼šfalse</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…Consumeræ¥å£"><a href="#âœ…Consumeræ¥å£" class="headerlink" title="âœ…Consumeræ¥å£"></a>âœ…Consumeræ¥å£</h4><p>æ¶ˆè´¹å‹æ¥å£ï¼šConsumer æœ‰å‚æ— è¿”å›å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">public interface Consumer&lt;T&gt; &#123;</span><br><span class="line">    void accept(T t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ConsumerTest &#123;</span><br><span class="line">    Consumer&lt;String&gt; consumer = (str) -&gt; &#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;;</span><br><span class="line">    public void conDemo(String str, Consumer&lt;String&gt; consumer) &#123;</span><br><span class="line">        consumer.accept(str);</span><br><span class="line">    &#125;</span><br><span class="line">    @Test</span><br><span class="line">    public void testConDemo() &#123;</span><br><span class="line">        conDemo(&quot;hello&quot;, consumer);//æ‰“å°ç»“æœï¼šhello</span><br><span class="line">        conDemo(&quot;hello&quot;, s -&gt; System.out.println(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>æ›´å¤šå‡½æ•°å¼æ¥å£ï¼š<br><a href="https://blog.csdn.net/weixin_45580378/article/details/124853396">https://blog.csdn.net/weixin_45580378/article/details/124853396</a></p>
<p>è¿·æƒ‘ï¼š<br>1.å‡½æ•°å¼æ¥å£ä¸­çš„defaultæ–¹æ³•æ˜¯å¹²å˜›çš„<br>2.æ³›å‹ã€‚<code>Function&lt;T, R&gt;</code>ä»£è¡¨ä¸¤ä¸ªæ³›å‹ï¼›<code>Function&lt;? super T, ? extends R&gt; mapper</code>ä»£è¡¨é™åˆ¶æ³›å‹ç±»å‹ï¼Ÿ</p>
<h4 id="âœ…Supplieræ¥å£"><a href="#âœ…Supplieræ¥å£" class="headerlink" title="âœ…Supplieræ¥å£"></a>âœ…Supplieræ¥å£</h4><p>ä¾›ç»™å‹æ¥å£ï¼šSupplier æ— å‚æœ‰è¿”å›å€¼ï¼Œç”¨äºæä¾›æ•°æ®æºçš„ã€‚</p>
<p>è¯¥æ¥å£é€šå¸¸ç”¨äºå»¶è¿Ÿè®¡ç®—ï¼Œåªæœ‰åœ¨éœ€è¦ç»“æœçš„æ—¶å€™æ‰è¿›è¡Œè®¡ç®—ï¼Œå¯ä»¥è¢«ç”¨ä½œä¸€ç§å·¥å‚æ¨¡å¼ï¼Œç”Ÿäº§ä¸åŒçš„å¯¹è±¡ï¼Œå…·ä½“å®ç°å¯ä»¥ç”±Lambdaè¡¨è¾¾å¼ä¼ å…¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Supplier&lt;String&gt; supplier = () -&gt; &quot;hello&quot;;</span><br><span class="line">String res = supplier.get();</span><br><span class="line">System.out.println(res);</span><br></pre></td></tr></table></figure>

<h3 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h3><p>Java 8 æä¾›çš„ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«æœ‰å¯é€‰å€¼çš„åŒ…è£…ç±»ï¼Œè¿™æ„å‘³ç€ Optional ç±»æ—¢å¯ä»¥å«æœ‰å¯¹è±¡ä¹Ÿå¯ä»¥ä¸ºç©ºã€‚</p>
<p>Optionalï¼Œå¯ä»¥é¿å…æ²¡æœ‰å¿…è¦çš„ null å€¼æ£€æŸ¥.</p>
<p><code>public final class Optional&lt;T&gt; &#123;&#125;</code></p>
<p>Optional æ˜¯ Java å®ç°å‡½æ•°å¼ç¼–ç¨‹çš„å¼ºåŠ²ä¸€æ­¥ï¼Œå¹¶ä¸”å¸®åŠ©åœ¨èŒƒå¼ä¸­å®ç°ã€‚<br>åœ¨ Java 8 ä¹‹å‰ï¼Œä»»ä½•è®¿é—®å¯¹è±¡æ–¹æ³•æˆ–å±æ€§çš„è°ƒç”¨éƒ½å¯èƒ½å¯¼è‡´NullPointerException.</p>
<p>âœ…åˆ›å»ºOptionalå¯¹è±¡</p>
<p>1ï¼‰å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³• empty() åˆ›å»ºä¸€ä¸ªç©ºçš„ Optional å¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; empty = Optional.empty();</span><br><span class="line">System.out.println(empty); // è¾“å‡ºï¼šOptional.empty</span><br><span class="line"></span><br><span class="line">@Test(expected = NoSuchElementException.class)</span><br><span class="line">public void whenCreateEmptyOptional_thenNull() &#123;</span><br><span class="line">    Optional&lt;Person&gt; emptyOpt = Optional.empty();</span><br><span class="line">    System.out.println(emptyOpt);</span><br><span class="line">    emptyOpt.get(); //NoSuchElementException</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ï¼‰å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³• of() åˆ›å»ºä¸€ä¸ªéç©ºçš„ Optional å¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; opt = Optional.of(&quot;11&quot;);</span><br><span class="line">System.out.println(opt); // è¾“å‡ºï¼šOptional[11]</span><br></pre></td></tr></table></figure>

<p>ä¼ é€’ç»™ of() æ–¹æ³•çš„å‚æ•°å¿…é¡»æ˜¯éç©ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä¸º nullï¼Œå¦åˆ™ä»ç„¶ä¼šæŠ›å‡º NullPointerExceptionã€‚</p>
<p>3ï¼‰å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³• ofNullable() åˆ›å»ºä¸€ä¸ªå³å¯ç©ºåˆå¯éç©ºçš„ Optional å¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String name = null;</span><br><span class="line">Optional&lt;String&gt; optOrNull = Optional.ofNullable(name);</span><br><span class="line">System.out.println(optOrNull); // è¾“å‡ºï¼šOptional.empty</span><br></pre></td></tr></table></figure>

<p>âœ…ifPresentæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public boolean isPresent() &#123;</span><br><span class="line">    return value != null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void ifPresent(Consumer&lt;? super T&gt; consumer) &#123;</span><br><span class="line">    if (value != null)</span><br><span class="line">        consumer.accept(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡æ–¹æ³• isPresent() åˆ¤æ–­ä¸€ä¸ª Optional å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•è¿”å› trueï¼Œå¦åˆ™è¿”å› falseâ€”â€”å–ä»£äº† obj !&#x3D; null çš„åˆ¤æ–­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; opt = Optional.of(&quot;11&quot;);</span><br><span class="line">System.out.println(opt.isPresent()); // è¾“å‡ºï¼šfalse</span><br><span class="line"></span><br><span class="line">Optional&lt;String&gt; optOrNull = Optional.ofNullable(null);</span><br><span class="line">System.out.println(opt.isPresent()); // è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure>

<p>ifPresent(Consumer&lt;? super T&gt; consumer) æ˜¯å¦‚æœä¸ä¸ºnullçš„è¯ï¼Œå¯¹å¯¹è±¡åšä»€ä¹ˆæ“ä½œã€‚</p>
<p>javaä¸­çš„Optionalï¼š<br><a href="https://www.jb51.net/article/214824.htm">https://www.jb51.net/article/214824.htm</a><br>ä¸€æ–‡å½»åº•ææ‡‚ Java çš„ Optionalï¼š<br><a href="https://blog.csdn.net/qing_gee/article/details/104767082">https://blog.csdn.net/qing_gee/article/details/104767082</a></p>
<h3 id="GenericConverteræ¥å£"><a href="#GenericConverteræ¥å£" class="headerlink" title="GenericConverteræ¥å£"></a>GenericConverteræ¥å£</h3><p>æ˜¯springæ¡†æ¶ä¸­ç”¨äºè¿›è¡Œç±»å‹è½¬æ¢çš„æ¥å£ï¼Œå¯ä»¥å°†ä¸€ç§ç±»å‹çš„å¯¹è±¡è½¬æ¢æˆå¦ä¸€ç§ç±»å‹çš„å¯¹è±¡ã€‚</p>
<p>GenericConverteræ˜¯converteræ¥å£çš„ä¸€ä¸ªæ¯”è¾ƒç²¾è‡´çš„å®ç°ï¼Œå®ƒæ”¯æŒå¤šä¸ªsourceå’Œç›®æ ‡ç±»å‹çš„è½¬åŒ–ï¼ŒåŒæ—¶è¿˜æä¾›äº†sourceå’Œç›®æ ‡ç±»å‹çš„ä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡èƒ½è®©ä½ å®ç°åŸºäºå±æ€§ä¸Šçš„æ³¨è§£æˆ–ä¿¡æ¯æ¥è¿›è¡Œç±»å‹è½¬æ¢ã€‚</p>
<p>getConvertibleTypesè¿”å›ä¸€ä¸ªsource-&gt;targetçš„é”®å€¼å¯¹ï¼Œç„¶åé€šè¿‡å®ç°convertæ¥å£æ¥å®ç°ä½ çš„è½¬æ¢é€»è¾‘ã€‚sourceTypeDescrptorèƒ½è®©ä½ è·å–åˆ°å­˜æ”¾ç€å³å°†è¢«è½¬æ¢çš„å€¼çš„fieldï¼Œè€ŒtargetTypeDescriptorèƒ½è®©ä½ è·å¾—è¢«è½¬æ¢åçš„å€¼å°†è¢«å­˜æ”¾çš„fieldã€‚</p>
<p>GenericConverterçš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­å°±æ˜¯èƒ½å°†arrayè½¬collectionçš„ArrayToCollectionConverterã€‚</p>
<p>ä¾‹å­ï¼š<br>1ã€é¦–å…ˆéœ€è¦å†™ä¸€ä¸ªé…ç½®ç±»ï¼Œå®ƒä½œä¸ºconverterä»¬çš„æ³¨å†Œä¸­å¿ƒï¼Œç„¶åå°†è‡ªå·±é‡å†™çš„GenericConverteræ³¨å†Œè¿›æ¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public ConvertService getConvertService() &#123;</span><br><span class="line">    ConversionServiceFactoryBean bean = new ConversionServiceFactoryBean();</span><br><span class="line">    Set&lt;?&gt; sets = Sets.newHashSet(new MyGenericConverter());</span><br><span class="line">    bean.setConverters(sets);</span><br><span class="line">    bean.afterPropertiesSet();</span><br><span class="line">    return bean.getObject();    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class MyGenericConverter implements GenericConverter &#123;</span><br><span class="line">    /**</span><br><span class="line">        * å‘Šè¯‰è½¬æ¢å™¨æ€»éƒ¨ï¼Œæˆ‘è¿™ä¸ªè½¬æ¢å™¨æ”¯æŒä»€ä¹ˆæ ·çš„è½¬æ¢ï¼Œå¯ä»¥æ”¯æŒå¤šä¸ªè½¬æ¢</span><br><span class="line">        * æ­¤å¤„æ”¯æŒ string -&gt; list å’Œ string -&gt; map</span><br><span class="line">        */</span><br><span class="line">    @Override</span><br><span class="line">    public Set&lt;ConvertiblePair&gt; getConvertibleTypes() &#123;</span><br><span class="line">        Set&lt;ConvertiblePair&gt; convertiblePairs = Collections.newSetFromMap(new ConcurrentHashMap&lt;&gt;());</span><br><span class="line">        ConvertiblePair stringToArray = new ConvertiblePair(String.class, Array.class);</span><br><span class="line">        ConvertiblePair stringToMap = new ConvertiblePair(String.class, Map.class);</span><br><span class="line">        convertiblePairs.add(stringToArray);</span><br><span class="line">        convertiblePairs.add(stringToMap);</span><br><span class="line">        return convertiblePairs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">        * @param source     è¢«è½¬æ¢çš„ä¸œè¥¿</span><br><span class="line">        * @param sourceType è¢«è½¬æ¢çš„ä¸œè¥¿çš„ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥ç”¨äºè®¾ç½®æ¡ä»¶ï¼Œå…·ä½“å’‹ç©çœ‹typeDescriptorï¼Œæ¯”å¦‚å¯ä»¥ç”¨æ¥åˆ¤æ–­è½¬æ¢æºæ˜¯å¦æ‹¥æœ‰æŸäº›æ³¨è§£</span><br><span class="line">        *                   @see TypeDescriptor</span><br><span class="line">        * @param targetType è½¬æ¢ç›®æ ‡ç±»å‹çš„ä¸Šä¸‹æ–‡</span><br><span class="line">        * @return</span><br><span class="line">        * æ¡ˆä¾‹åœºæ™¯ï¼šå¦‚æœè½¬æ¢æºè¢«@Resourceæ ‡è¯†ï¼Œå¹¶ä¸”ç›®æ ‡ç±»å‹ä¸ºListï¼Œåˆ™è½¬æ¢list</span><br><span class="line">        *                                         ç›®æ ‡ç±»å‹ä¸ºmapï¼Œåˆ™è½¬æ¢ä¸ºmap</span><br><span class="line">        */</span><br><span class="line">    @Override</span><br><span class="line">    public Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType) &#123;</span><br><span class="line">        Resource annotation = sourceType.getAnnotation(Resource.class);</span><br><span class="line">        if (annotation!= null)&#123;</span><br><span class="line">            if (targetType.getType() == List.class)&#123;</span><br><span class="line">                return Arrays.asList(source.toString().split(&quot;:&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">            if (targetType.getType() == Map.class)&#123;</span><br><span class="line">                Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">                map.put(&quot;a&quot;,source.toString().split(&quot;:&quot;)[0]);</span><br><span class="line">                map.put(&quot;b&quot;,source.toString().split(&quot;:&quot;)[1]);</span><br><span class="line">                return map;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws NoSuchFieldException &#123;</span><br><span class="line">        DefaultConversionService defaultConversionService = new DefaultConversionService();</span><br><span class="line">        defaultConversionService.addConverter(new MyGenericConverter());</span><br><span class="line"></span><br><span class="line">        Apple apple = new Apple();</span><br><span class="line">        apple.setName(&quot;1:2&quot;);</span><br><span class="line"></span><br><span class="line">        List convert = (List) defaultConversionService.convert(apple.getName(),</span><br><span class="line">                new TypeDescriptor(Apple.class.getDeclaredField(&quot;name&quot;)),</span><br><span class="line">                new TypeDescriptor(ResolvableType.forRawClass(List.class),null,null));</span><br><span class="line">        System.out.println(convert.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ã€getConvertibleTypes ç”¨äºå‘Šè¯‰æ³¨å†Œä¸­å¿ƒï¼Œä½ é‡å†™çš„converterèƒ½å¤Ÿæ”¯æŒä»€ä¹ˆæ ·çš„è½¬æ¢ï¼Œæ¯”å¦‚æˆ‘çš„å°±æ”¯æŒstringåˆ°listï¼Œstringåˆ°mapçš„è½¬æ¢</p>
<p>å‚è€ƒï¼šGenericConverterçš„ç”¨æ³•éšç¬”<br><a href="https://blog.csdn.net/qq_26950567/article/details/103685810">https://blog.csdn.net/qq_26950567/article/details/103685810</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šjavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ç¬”è®°</title>
    <url>/2022/08/25/myblog/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF/</url>
    <content><![CDATA[<h2 id="ç¬¬ä¸€ç« -å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜"><a href="#ç¬¬ä¸€ç« -å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜" class="headerlink" title="ç¬¬ä¸€ç«  å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜"></a>ç¬¬ä¸€ç«  å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜</h2><h3 id="1-ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#1-ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="1.ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>1.ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>CPUé€šè¿‡ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…CPUæ—¶é—´ç‰‡æ¥å®ç°å¤šçº¿ç¨‹ï¼Œæ—¶é—´ç‰‡ä¸€èˆ¬å‡ åæ¯«ç§’ã€‚</p>
<p>ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æŒ‡åˆ‡æ¢å‰éœ€è¦ä¿å­˜ä¸Šä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚</p>
<p>ç”±äºçº¿ç¨‹æœ‰åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œå¹¶å‘æ‰§è¡Œçš„é€Ÿåº¦ä¸ä¸€å®šæ¯”ä¸²è¡Œå¿«ã€‚</p>
<p>ä¸Šä¸‹æ–‡æ¯1såˆ‡æ¢1000å¤šæ¬¡ã€‚</p>
<p>å¦‚ä½•å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ<br>1ã€æ— é”å¹¶å‘ç¼–ç¨‹ï¼Œå¤šçº¿ç¨‹ç«äº‰é”æ—¶ä¼šå¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯ä»¥å°†æ•°æ®idæ ¹æ®hashç®—æ³•å–æ¨¡åˆ†æ®µï¼Œä¸åŒçº¿ç¨‹å¤„ç†ä¸åŒæ®µçš„æ•°æ®ã€‚<br>2ã€CASç®—æ³•ï¼ŒAtomicåŒ…ä¸‹ï¼Œä¸éœ€è¦åŠ é”ã€‚<br>3ã€é¿å…åˆ›å»ºä¸éœ€è¦çš„çº¿ç¨‹ã€‚æ¯æ¬¡ä»waitingåˆ°runnableéƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚<br>4ã€åç¨‹ï¼šåœ¨å•çº¿ç¨‹ä¸­å®ç°å¤šä»»åŠ¡è°ƒåº¦ï¼Œç»´æŒå¤šä¸ªä»»åŠ¡é—´çš„åˆ‡æ¢ã€‚</p>
<h3 id="2-æ­»é”"><a href="#2-æ­»é”" class="headerlink" title="2.æ­»é”"></a>2.æ­»é”</h3><p>çº¿ç¨‹aå’Œçº¿ç¨‹bäº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ã€‚</p>
<p>ä¸€æ—¦å‡ºç°æ­»é”ï¼Œä¸šåŠ¡å¯æ„ŸçŸ¥ï¼Œä½¿ç”¨jstackå‘½ä»¤dumpçº¿ç¨‹ã€‚</p>
<p>é¿å…æ­»é”çš„å‡ ä¸ªæ–¹æ³•ï¼š<br>1ã€é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶è·å–å¤šä¸ªé”ã€‚<br>2ã€é¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨é”å†…åŒæ—¶å ç”¨å¤šä¸ªèµ„æºã€‚<br>3ã€å°è¯•ä½¿ç”¨å®šæ—¶é”ï¼Œä½¿ç”¨lock.tryLock(timeout)æ¥æ›¿ä»£å†…éƒ¨é”æœºåˆ¶<br>4ã€å¯¹äºæ•°æ®åº“é”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥ä¸­ï¼Œå¦åˆ™ä¼šå‡ºç°è§£é”å¤±è´¥ã€‚</p>
<h3 id="3-èµ„æºé™åˆ¶"><a href="#3-èµ„æºé™åˆ¶" class="headerlink" title="3.èµ„æºé™åˆ¶"></a>3.èµ„æºé™åˆ¶</h3><p>å¹¶å‘ç¼–ç¨‹æ—¶çš„èµ„æºé™åˆ¶ï¼š<br>ç¡¬ä»¶é™åˆ¶ï¼šå¸¦å®½çš„ä¸Šä¼ &#x2F;ä¸‹è½½é€Ÿåº¦ï¼ˆ2Mb&#x2F;sï¼‰ã€ç¡¬ç›˜è¯»å†™é€Ÿåº¦ã€CPUå¤„ç†é€Ÿåº¦<br>è½¯ä»¶é™åˆ¶ï¼šæ•°æ®åº“è¿æ¥æ•°ã€socketè¿æ¥æ•°<br>ä¾‹å¦‚ï¼šçº¿ç¨‹æ•°æ¯”æ•°æ®åº“è¿æ¥æ•°å¤§å¾ˆå¤šï¼Œåˆ™æŸäº›çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç­‰å¾…æ•°æ®åº“è¿æ¥ã€‚</p>
<p>ä½¿ç”¨ç­‰å¾…è¶…æ—¶æ¨¡å¼æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥æ± ï¼š<br><a href="https://blog.csdn.net/m0_52043808/article/details/125759727">https://blog.csdn.net/m0_52043808/article/details/125759727</a></p>
<p>å—åˆ°èµ„æºé™åˆ¶æ—¶ï¼Œå¹¶å‘æ‰§è¡Œå¯èƒ½ä¼šç¼–ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œä½†æ˜¯å¢åŠ äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œèµ„æºè°ƒåº¦çš„æ—¶é—´ï¼Œæ¯”ä¸²è¡Œè¿˜æ…¢ã€‚</p>
<p>å¦‚ä½•è§£å†³ï¼Ÿ<br>1ã€å¯¹äºç¡¬ä»¶çº¦æŸï¼Œè€ƒè™‘ä½¿ç”¨é›†ç¾¤å¹¶è¡Œæ‰§è¡Œç¨‹åºï¼Œä¸åŒæœºå™¨å¤„ç†ä¸åŒæ•°æ®ã€‚<br>2ã€å¯¹äºè½¯ä»¶é™åˆ¶ï¼Œè€ƒè™‘ä½¿ç”¨èµ„æºæ± å°†èµ„æºå¤ç”¨ã€‚</p>
<h3 id="4-jstackå‘½ä»¤dumpçº¿ç¨‹"><a href="#4-jstackå‘½ä»¤dumpçº¿ç¨‹" class="headerlink" title="4.jstackå‘½ä»¤dumpçº¿ç¨‹"></a>4.jstackå‘½ä»¤dumpçº¿ç¨‹</h3><h4 id="âœ…ä»€ä¹ˆæ˜¯jstackï¼Ÿ"><a href="#âœ…ä»€ä¹ˆæ˜¯jstackï¼Ÿ" class="headerlink" title="âœ…ä»€ä¹ˆæ˜¯jstackï¼Ÿ"></a>âœ…ä»€ä¹ˆæ˜¯jstackï¼Ÿ</h4><p>å¦‚æœæœ‰ä¸€å¤©ï¼Œä½ çš„Javaç¨‹åºé•¿æ—¶é—´åœé¡¿ï¼Œä¹Ÿè®¸æ˜¯å®ƒç—…äº†ï¼Œéœ€è¦ç”¨jstackæ‹ä¸ªç‰‡å­åˆ†æåˆ†æï¼Œæ‰èƒ½è¯Šæ–­å…·ä½“ä»€ä¹ˆç—…ç—‡ï¼Œæ˜¯æ­»é”ç»¼åˆå¾ï¼Œè¿˜æ˜¯æ­»å¾ªç¯ç­‰å…¶ä»–ç—…ç—‡ã€‚</p>
<p>jstackæ˜¯JVMè‡ªå¸¦çš„Javaå †æ ˆè·Ÿè¸ªå·¥å…·ï¼Œå®ƒç”¨äºæ‰“å°å‡ºç»™å®šçš„javaè¿›ç¨‹IDã€core fileã€è¿œç¨‹è°ƒè¯•æœåŠ¡çš„Javaå †æ ˆä¿¡æ¯.</p>
<pre><code>1ã€jstackå‘½ä»¤ç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚
2ã€çº¿ç¨‹å¿«ç…§æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œ å¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰é—®é¢˜ã€‚
3ã€çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ä»€ä¹ˆèµ„æºã€‚
4ã€å¦‚æœjavaç¨‹åºå´©æºƒç”Ÿæˆcoreæ–‡ä»¶ï¼Œjstackå·¥å…·å¯ä»¥ç”¨æ¥è·å¾—coreæ–‡ä»¶çš„java stackå’Œnative stackçš„ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°çŸ¥é“javaç¨‹åºæ˜¯å¦‚ä½•å´©æºƒå’Œåœ¨ç¨‹åºä½•å¤„å‘ç”Ÿé—®é¢˜ã€‚
5ã€å¦å¤–ï¼Œjstackå·¥å…·è¿˜å¯ä»¥é™„å±åˆ°æ­£åœ¨è¿è¡Œçš„javaç¨‹åºä¸­ï¼Œçœ‹åˆ°å½“æ—¶è¿è¡Œçš„javaç¨‹åºçš„java stackå’Œnative stackçš„ä¿¡æ¯, å¦‚æœç°åœ¨è¿è¡Œçš„javaç¨‹åºå‘ˆç°hungçš„çŠ¶æ€ï¼Œjstackæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚
</code></pre>
<h4 id="âœ…æ€ä¹ˆç”¨ï¼š"><a href="#âœ…æ€ä¹ˆç”¨ï¼š" class="headerlink" title="âœ…æ€ä¹ˆç”¨ï¼š"></a>âœ…æ€ä¹ˆç”¨ï¼š</h4><p>é¦–å…ˆä½¿ç”¨ jpså‘½ä»¤æŸ¥çœ‹éœ€è¦æ‰“å°çº¿ç¨‹æ ˆçš„javaè¿›ç¨‹å·pidã€‚<br>ç„¶å jstack pidã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-F	å½“æ­£å¸¸è¾“å‡ºçš„è¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ</span><br><span class="line">-m	å¦‚æœè°ƒç”¨åˆ°æœ¬åœ°æ–¹æ³•çš„è¯ï¼Œå¯ä»¥æ˜¾ç¤ºC/C++çš„å †æ ˆ</span><br><span class="line">-l	é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯ï¼Œåœ¨å‘ç”Ÿæ­»é”æ—¶å¯ä»¥ç”¨jstack -l pidæ¥è§‚å¯Ÿé”æŒæœ‰æƒ…å†µ</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºè§£è¯»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;jstack 9348</span><br><span class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.281-b09 mixed mode):</span><br><span class="line"></span><br><span class="line">&quot;DestroyJavaVM&quot; #13 prio=5 os_prio=0 tid=0x0000018da5881000 nid=0x34c8 waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">[é€šè¿‡ jstackæŸ¥çœ‹çº¿ç¨‹æ ˆä¿¡æ¯æ—¶é€šå¸¸çœ‹åˆ°çš„æœ€å¤šçš„æ˜¯RUNNABLE,BLOCKED,WAITINGå’ŒTIMED_WAITINGè¿™å‡ ç§çŠ¶æ€ï¼Œ</span><br><span class="line">æˆ‘ä»¬ä¸€èˆ¬çœ‹ä¸åˆ°çº¿ç¨‹çš„NEWå’ŒTERMINATEDçŠ¶æ€ï¼Œæ˜¯å› ä¸ºåœ¨ä»£ç çš„è¿è¡Œè¿‡ç¨‹ä¸­è¿™ä¸¤ç§çŠ¶æ€åªå å¾ˆå°ä¸€éƒ¨åˆ†ï¼Œ</span><br><span class="line">æˆ‘ä»¬æ•æ‰åˆ°è¿™ä¸¤ç§çŠ¶æ€å‰è¿™ä¸¤ç§çŠ¶æ€å·²ç»ä¸€é—ªè€Œè¿‡äº†ã€‚</span><br><span class="line"></span><br><span class="line">&quot;main&quot; #1 prio=5 os_prio=0 tid=0x0000000002e7e800 nid=0x2a1c in Object.wait() [0x0000000002f7f000]</span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line"></span><br><span class="line">å…¶ä¸­å¼€å¤´æ˜¯çº¿ç¨‹åç§°ï¼Œåé¢çš„ä¸ºçº¿ç¨‹ä¿¡æ¯ï¼š</span><br><span class="line"> #1 è¡¨ç¤ºå½“å‰çº¿ç¨‹IDï¼Œä» mainçº¿ç¨‹å¼€å§‹ï¼ŒJVM æ ¹æ®çº¿ç¨‹åˆ›å»ºçš„é¡ºåºä¸ºçº¿ç¨‹ç¼–å·.</span><br><span class="line">prio æ˜¯priorityä¼˜å…ˆçº§çš„ç¼©å†™ï¼Œè¡¨åäº†å½“å‰çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå–å€¼èŒƒå›´ä¸º[1-10]ï¼Œé»˜è®¤ä¸º 5ã€‚åœ¨è™šæ‹Ÿæœºè¿›è¡Œçº¿ç¨‹è°ƒåº¦çš„æ—¶å€™ä¼šå‚è€ƒè¯¥ä¼˜å…ˆçº§ä¸ºçº¿ç¨‹åˆ†é…è®¡ç®—èµ„æºï¼Œè¿™ä¸ªæ•°å€¼è¶Šä½è¶Šæœ‰ä¼˜å…ˆè·å–åˆ°è®¡ç®—èµ„æºï¼Œä¸€èˆ¬ä¸è®¾ç½®ç›´æ¥ä½¿ç”¨é»˜è®¤çš„ä¼˜å…ˆçº§ã€‚</span><br><span class="line">os_prioä¸ºçº¿ç¨‹å¯¹åº”ç³»ç»Ÿçš„ä¼˜å…ˆçº§ã€‚</span><br><span class="line">nid æœ¬åœ°çº¿ç¨‹ç¼–å·NativeIDçš„ç¼©å†™,å¯¹åº”JVM è™šæ‹Ÿæœºä¸­çº¿ç¨‹æ˜ å°„åœ¨æ“ä½œç³»ç»Ÿä¸­çš„çº¿ç¨‹ç¼–å·ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ top æŸ¥çœ‹è¿›ç¨‹å¯¹åº”çš„çº¿ç¨‹æƒ…å†µè¿›è¡Œç›¸å…³æ˜ å°„ã€‚</span><br></pre></td></tr></table></figure>

<p>nidè¡¨ç¤ºçš„æ˜¯çº¿ç¨‹å¯¹åº”çš„ç³»ç»Ÿæœ¬åœ°çš„çº¿ç¨‹ç¼–å·.</p>
<h4 id="âœ…æ¡ˆä¾‹ï¼šjstack-åˆ†ææ­»é”é—®é¢˜"><a href="#âœ…æ¡ˆä¾‹ï¼šjstack-åˆ†ææ­»é”é—®é¢˜" class="headerlink" title="âœ…æ¡ˆä¾‹ï¼šjstack åˆ†ææ­»é”é—®é¢˜"></a>âœ…æ¡ˆä¾‹ï¼šjstack åˆ†ææ­»é”é—®é¢˜</h4><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•è¿›è¡Œä¸‹å»</p>
<p>æ­»é”demoï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Java æ­»é”demo</span><br><span class="line"> */</span><br><span class="line">public class DeathLockTest &#123;</span><br><span class="line">    private static Lock lock1 = new ReentrantLock();</span><br><span class="line">    private static Lock lock2 = new ReentrantLock();</span><br><span class="line"> </span><br><span class="line">    public static void deathLock() &#123;</span><br><span class="line">        Thread t1 = new Thread() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    lock1.lock();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + &quot; get the lock1&quot;);</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                    lock2.lock();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + &quot; get the lock2&quot;);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Thread t2 = new Thread() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    lock2.lock();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + &quot; get the lock2&quot;);</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                    lock1.lock();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + &quot; get the lock1&quot;);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        //è®¾ç½®çº¿ç¨‹åå­—ï¼Œæ–¹ä¾¿åˆ†æå †æ ˆä¿¡æ¯</span><br><span class="line">        t1.setName(&quot;mythread-jay&quot;);</span><br><span class="line">        t2.setName(&quot;mythread-tianluo&quot;);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        deathLock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ’æŸ¥æ­¥éª¤ï¼š<br>1ã€åœ¨ç»ˆç«¯ä¸­è¾“å…¥jspæŸ¥çœ‹å½“å‰è¿è¡Œçš„javaç¨‹åº<br>2ã€ä½¿ç”¨ jstack -l pid æŸ¥çœ‹çº¿ç¨‹å †æ ˆä¿¡æ¯<br>3ã€åˆ†æå †æ ˆä¿¡æ¯</p>
<p>ä¼šå‡ºç°ï¼šFound one Java-level deadlock: ä¿¡æ¯ã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹å æœ‰ä¸€ä¸ªé”çš„æ—¶å€™ï¼Œçº¿ç¨‹å †æ ˆä¼šæ‰“å°ä¸€ä¸ªï¼locked&lt;0x22bffb60&gt;<br>å½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰åœ¨å…¶ä»–çº¿ç¨‹é‡Šæ”¾è¯¥é”ï¼Œçº¿ç¨‹å †æ ˆä¼šæ‰“å°ä¸€ä¸ªï¼waiting to lock&lt;0x22bffb60&gt;<br>å½“ä¸€ä¸ªçº¿ç¨‹å æœ‰ä¸€ä¸ªé”ï¼Œä½†åˆæ‰§è¡Œåœ¨è¯¥é”çš„waitä¸Šï¼Œçº¿ç¨‹å †æ ˆä¸­é¦–å…ˆæ‰“å°blocked,ç„¶åæ‰“å°ï¼waiting on &lt;0x22c03c60&gt;</p>
<h4 id="âœ…æ¡ˆä¾‹ï¼šåˆ†æCPUè¿‡é«˜"><a href="#âœ…æ¡ˆä¾‹ï¼šåˆ†æCPUè¿‡é«˜" class="headerlink" title="âœ…æ¡ˆä¾‹ï¼šåˆ†æCPUè¿‡é«˜"></a>âœ…æ¡ˆä¾‹ï¼šåˆ†æCPUè¿‡é«˜</h4><p>å¯¼è‡´CPUè¿‡é«˜çš„demoç¨‹åºï¼Œä¸€ä¸ªæ­»å¾ªç¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æœ‰ä¸ªå¯¼è‡´CPUè¿‡é«˜ç¨‹åºçš„demoï¼Œæ­»å¾ªç¯</span><br><span class="line"> */</span><br><span class="line">public class JstackCase &#123;</span><br><span class="line"> </span><br><span class="line">     private static ExecutorService executorService = Executors.newFixedThreadPool(5);</span><br><span class="line"> </span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"> </span><br><span class="line">        Task task1 = new Task();</span><br><span class="line">        Task task2 = new Task();</span><br><span class="line">        executorService.execute(task1);</span><br><span class="line">        executorService.execute(task2);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public static Object lock = new Object();</span><br><span class="line"> </span><br><span class="line">    static class Task implements Runnable&#123;</span><br><span class="line"> </span><br><span class="line">        public void run() &#123;</span><br><span class="line">            synchronized (lock)&#123;</span><br><span class="line">                long sum = 0L;</span><br><span class="line">                while (true)&#123;</span><br><span class="line">                    sum += 1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ’æŸ¥æ­¥éª¤ï¼š<br>1ã€jps å‘½ä»¤è·å–ç›®æ ‡ java è¿›ç¨‹å·<br>2ã€åœ¨æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡topå‘½ä»¤æŸ¥çœ‹å„ä¸ªè¿›ç¨‹çš„cpuä½¿ç”¨æƒ…å†µï¼Œå®ƒé»˜è®¤æ˜¯æŒ‰cpuä½¿ç”¨ç‡ç”±é«˜åˆ°ä½æ’åºçš„ï¼Œæ‹¿åˆ°pid<br>top -Hp pid ã€å¥‡æ€ªï¼Œä¸èƒ½ç”¨ï¼Œåªèƒ½top -p pidã€‘<br>é€šè¿‡top -Hp pidå¯ä»¥æŸ¥çœ‹è¯¥è¿›ç¨‹ä¸‹ï¼Œå„ä¸ªçº¿ç¨‹çš„cpuä½¿ç”¨æƒ…å†µ<br>3ã€æŠŠçº¿ç¨‹pidæ¢æˆnid<br>å°†è¯¥çº¿ç¨‹å¥½æ‰“å°æˆ 16è¿›åˆ¶çš„<br><code>printf &quot;%x\n&quot; 19343</code><br>4ã€jstack -l [PID] &gt;&#x2F;tmp&#x2F;log.txt<br>ä¸€èˆ¬åœ¨ç”Ÿæˆç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å †æ ˆä¿¡æ¯æ‰“åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå†å›å¤´ä»”ç»†åˆ†æ<br>jstack è¿›ç¨‹pid | grep -10 çº¿ç¨‹<br>nid<br>å¯ä»¥çœ‹åˆ°ç›®æ ‡çº¿ç¨‹çš„çº¿ç¨‹å †æ ˆä¿¡æ¯äº†</p>
<p>è½¬è‡ªï¼š<br><a href="https://blog.csdn.net/weixin_44588186/article/details/124680586">https://blog.csdn.net/weixin_44588186/article/details/124680586</a><br>ã€jstackæ¡ˆä¾‹ã€‘<br><a href="https://blog.csdn.net/qq_19922839/article/details/115379649">https://blog.csdn.net/qq_19922839/article/details/115379649</a><br>ã€é‡Œé¢è¿˜æœ‰pstree æŸ¥çœ‹è¿›ç¨‹æ ‘ï¼Œjvm ç›‘æ§å·¥å…·Liberica Mission Controlã€‘</p>
<h4 id="âœ…dumpçº¿ç¨‹"><a href="#âœ…dumpçº¿ç¨‹" class="headerlink" title="âœ…dumpçº¿ç¨‹"></a>âœ…dumpçº¿ç¨‹</h4><p>çº¿ç¨‹dumpçš„ç›®çš„æ˜¯è½¬å­˜çº¿ç¨‹å¿«ç…§ã€‚å¿«ç…§ä¸­æ˜¯å½“å‰JVMæ‰€æœ‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œæ–¹æ³•çš„å †æ ˆä¿¡æ¯ã€‚</p>
<p>é€šè¿‡çº¿ç¨‹dumpæ¥åˆ†æå®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹æ­»é”ã€çº¿ç¨‹æ­»å¾ªç¯ã€çº¿ç¨‹è¯·æ±‚å¤–éƒ¨èµ„æºé•¿æ—¶é—´ç­‰å¾…ç­‰ã€‚</p>
<p>å¯ä»¥ç”¨arthasè·å–dumpæ–‡ä»¶ï¼Œdumpæ–‡ä»¶å¾ˆå¤§ï¼Œå‡ ä¸ªGï¼Œå¯ä»¥ç”¨IDEAæ‰“å¼€ï¼Œæˆ–è€…ç”¨å…¶ä»–åˆ†æå·¥å…·ã€‚arthasä¹Ÿå¯ä»¥è¾“å‡ºæ‰€æœ‰çº¿ç¨‹ã€‚</p>
<p>çº¿ç¨‹dumpï¼š<a href="https://blog.csdn.net/HaierFiller/article/details/117367228">https://blog.csdn.net/HaierFiller/article/details/117367228</a></p>
<h2 id="ç¬¬äºŒç« -javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†"><a href="#ç¬¬äºŒç« -javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†" class="headerlink" title="ç¬¬äºŒç«  javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†"></a>ç¬¬äºŒç«  javaå¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç†</h2><p>.javaä»£ç  -ç¼–è¯‘ä¸º- .classå­—èŠ‚ç æ–‡ä»¶ -åŠ è½½åˆ°- jvm -æ‰§è¡Œå­—èŠ‚ç - è½¬åŒ–ä¸ºæ±‡ç¼–è¯­è¨€åœ¨cpuæ‰§è¡Œã€‚</p>
<p>javaçš„å¹¶å‘æœºåˆ¶ä¾èµ–äºjvmçš„å®ç°å’Œcpuçš„æ‰§è¡Œã€‚</p>
<h3 id="1-volatile"><a href="#1-volatile" class="headerlink" title="1.volatile"></a>1.volatile</h3><h4 id="âœ…volatileåº•å±‚"><a href="#âœ…volatileåº•å±‚" class="headerlink" title="âœ…volatileåº•å±‚"></a>âœ…volatileåº•å±‚</h4><p>volatileæ˜¯è½»é‡çº§çš„synchronizedï¼Œåœ¨å¤šå¤„ç†å™¨å¼€å‘ä¸­ä¿è¯äº†å…±äº«å˜é‡çš„å¯è§æ€§ï¼ˆæ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„è¿™ä¸ªå˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ï¼‰ã€‚æ¯”synchronizedæ‰§è¡Œæˆæœ¬ä½ï¼Œä¸ä¼šå¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œè°ƒåº¦ã€‚</p>
<p>é¦–å…ˆï¼Œäº†è§£ä¸€ä¸‹cpuå¤„ç†é€»è¾‘ï¼š<br>ä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦ï¼Œcpuä¸ç›´æ¥ä¸å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œè€Œæ˜¯å…ˆå°†å†…å­˜çš„æ•°æ®è¯»åˆ°è‡ªå·±çš„å†…å­˜ç¼“å­˜ï¼ˆä»¥ç¼“å­˜è¡Œä¸ºå•ä½ï¼‰ä¸­ã€‚</p>
<p>å¤„ç†å™¨ - é«˜é€Ÿç¼“å­˜ - ç¼“å­˜   \<br>å¤„ç†å™¨ - é«˜é€Ÿç¼“å­˜ - ä¸€è‡´æ€§  - æ€»çº¿ - ä¸»å†…å­˜<br>å¤„ç†å™¨ - é«˜é€Ÿç¼“å­˜ - åè®®   &#x2F;</p>
<p>å­˜å‚¨å¤§ä½“ä¸Šåˆ†ä¸¤ç§, ä¸»å­˜æ˜¯å †å†…å­˜, å·¥ä½œå†…å­˜æ˜¯æ ˆå†…å­˜, å±äºçº¿ç¨‹ç§æœ‰ã€‚<br>å¯¹å­—æ®µæ“ä½œéƒ½éœ€è¦å…ˆä»ä¸»å­˜è¯»å–æ•°æ®åŠ è½½è¿›å·¥ä½œå†…å­˜, å·¥ä½œå†…å­˜å¯¹è¿™ä¸ªå‰¯æœ¬æ•°æ®è¿›è¡Œæ“ä½œ<br>volatileä¿®é¥°çš„å˜é‡, ç­‰äºåœ¨å †ä¸­è¿™ä¸ªå˜é‡çš„å†…å­˜åŒºåŸŸä¸Šæ‰“äº†ä¸ªæ ‡, æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»ä»ä¸»å­˜ä¸­è¯»å–, ç”±MESI&lt;ç¼“å­˜ä¸€è‡´æ€§åè®®&gt;å®ç°</p>
<p>å¯¹volatileå£°æ˜çš„å˜é‡è¿›è¡Œå†™æ“ä½œä¼šå‘ç”Ÿä»€ä¹ˆï¼š<br>1ã€jvmå‘å¤„ç†å™¨å‘é€ä¸€æ¡lockå‰ç¼€çš„æŒ‡ä»¤ï¼Œå°†è¿™ä¸ªå˜é‡æ‰€åœ¨ç¼“å­˜è¡Œçš„æ•°æ®å†™å›ç³»ç»Ÿå†…å­˜ã€‚lockæŒ‡ä»¤æ‰§è¡ŒæœŸé—´ä¼šé”ä½æ€»çº¿&#x2F;ç¼“å­˜ï¼Œä¿è¯ä¸ä¼šåŒæ—¶å¤šä¸ªcpuä¿®æ”¹å…±äº«å˜é‡ã€‚<br>2ã€å¤šå¤„ç†ä¸‹ï¼Œå®ç°ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œæ¯ä¸ªå¤„ç†å™¨ä½¿ç”¨å—…æ¢æŠ€æœ¯ï¼Œä¿è¯å®ƒçš„å†…éƒ¨ç¼“å­˜å’Œç³»ç»Ÿå†…å­˜çš„æ•°æ®åœ¨æ€»çº¿ä¸Šä¿æŒä¸€è‡´ï¼ˆå‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹ï¼Œé¦–å…ˆå°†ç¼“å­˜è¡Œç½®ä¸ºæ— æ•ˆï¼Œé‡æ–°ä»ç³»ç»Ÿå†…å­˜ä¸­å°†æ•°æ®è¯»åˆ°ç¼“å­˜ï¼‰ã€‚</p>
<p>volitaleçš„ä½¿ç”¨ä¼˜åŒ–ï¼š<br>jdk7ä¸­çš„LinkedTransferQueueï¼Œä½¿ç”¨volitaleæ—¶ï¼Œé‡‡ç”¨è¿½åŠ å­—èŠ‚çš„æ–¹å¼ä¼˜åŒ–å‡ºé˜Ÿå…¥é˜Ÿæ•ˆç‡ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿ<br>å› ä¸ºå¤„ç†å™¨çš„é«˜é€Ÿç¼“å­˜è¡Œæ˜¯64ä¸ªå­—èŠ‚å®½ï¼Œä¸æ”¯æŒéƒ¨åˆ†å¡«å……ç¼“å­˜è¡Œã€‚è¿™æ ·å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹åœ¨ä¸€ä¸ªé«˜é€Ÿç¼“å­˜è¡Œä¸­ï¼Œå¤šå¤„ç†å™¨ä¸‹ï¼Œä¸€ä¸ªå¤„ç†å™¨ä¿®æ”¹å¤´èŠ‚ç‚¹ï¼Œä¼šå°†æ•´ä¸ªç¼“å­˜è¡Œé”å®šï¼Œåœ¨ç¼“å­˜ä¸€è‡´æ€§çš„ä½œç”¨ä¸‹ï¼Œå¯¼è‡´å…¶ä»–å¤„ç†å™¨ä¸èƒ½è®¿é—®è‡ªå·±é«˜é€Ÿç¼“å­˜è¡Œä¸­çš„å°¾èŠ‚ç‚¹ã€‚<br>èŠ‚ç‚¹è¿½åŠ åˆ°64å­—èŠ‚ï¼Œå¯ä»¥é¿å…å¤´å°¾èŠ‚ç‚¹åŠ è½½åˆ°åŒä¸€ä¸ªç¼“å­˜è¡Œä¸­ï¼Œä¿®æ”¹æ—¶ä¸ä¼šç›¸äº’é”å®šã€‚</p>
<p>æ³¨æ„ï¼šç¼“å­˜è¡Œé64å­—èŠ‚çš„åˆ«è¿™ä¹ˆåšï¼Œå…±äº«å˜é‡ä¸ä¼šè¢«é¢‘ç¹å†™çš„è¯åˆ«è¿™ä¹ˆåšã€‚</p>
<h4 id="âœ…volatileä½¿ç”¨"><a href="#âœ…volatileä½¿ç”¨" class="headerlink" title="âœ…volatileä½¿ç”¨"></a>âœ…volatileä½¿ç”¨</h4><p>âš ï¸æ³¨æ„ï¼švolatileèƒ½ä¿è¯å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯åŸå­æ€§ã€‚<br>åœ¨ volatile å­—æ®µä¸Šè¿›è¡Œäº†éåŸå­ç±»æ“ä½œï¼Œä¼šideaæç¤ºï¼š<code>Non-atomic operations on volatile fields</code><br>æ¯”å¦‚ï¼šcount++ å°±æ˜¯éåŸå­æ“ä½œï¼Œåˆ†ä¸‰æ­¥ï¼š<br>1ã€ä»ä¸»å­˜è¯»å– i<br>2ã€åœ¨å¯„å­˜å™¨ä¸­è¿›è¡ŒåŠ ä¸€è¿ç®—, è‡ªå¢æ“ä½œ, æ­¤æ—¶å·²ç»ä¿®æ”¹å·¥ä½œå†…å­˜ä¸­çš„å€¼<br>3ã€å°†è®¡ç®—åçš„å€¼èµ‹ç»™ i, ä¹Ÿå°±æ˜¯åˆ·å›ä¸»å­˜</p>
<p><strong>å¯è§æ€§</strong></p>
<p>volatileå’Œstaticçš„å¯è§æ€§ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//private boolean tag = false;  //ä¸ä¼šè¿è¡Œtag is true,exit</span><br><span class="line">//private static boolean tag = false;  //ä¸ä¼šè¿è¡Œtag is true,exit</span><br><span class="line">private volatile  boolean tag = false; //ä¼šè¿è¡Œtag is true,exit</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void visibleTest() throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">    Thread t1 = new Thread(new Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            //å½“tagæ ‡å¿—å˜ä¸ºtrueæ—¶ç»“æŸå¾ªç¯å¹¶æ‰“å°é€€å‡ºä¿¡æ¯</span><br><span class="line">            while(!tag)&#123;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;tag is true,exit......&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Thread t2 = new Thread(new Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            tag = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    t1.start();</span><br><span class="line">    Thread.sleep(100);</span><br><span class="line">    t2.start();</span><br><span class="line">    Thread.sleep(2000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼š<br>volatileçš„å¯è§æ€§ï¼šæ˜¯å¤šä¸ªçº¿ç¨‹é—´çš„å…±äº«å˜é‡ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹æ—¶ï¼Œå…¶ä»–çš„çº¿ç¨‹èƒ½å¤ŸçŸ¥é“è¿™ä¸ªä¿®æ”¹ã€‚<br>staticä¸èƒ½çŸ¥é“å˜åŒ–ï¼Œå®ƒçš„å¯è§æ€§ï¼šå¯è®¿é—®ã€‚</p>
<p>volatileä¿®é¥°çš„å…±äº«å˜é‡å¯¹å…¶ä»–çº¿ç¨‹å…·æœ‰å¯è§æ€§ï¼Œå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<br>staticä¿®é¥°çš„å˜é‡ä¸ºå…¨å±€å˜é‡, å¯¹æ‰€æœ‰çº¿ç¨‹å¯è®¿é—®, å¯ç”¨äºçº¿ç¨‹é—´çš„é€šä¿¡ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>staticçº¿ç¨‹å®‰å…¨æµ‹è¯•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class VolatileDemo &#123;</span><br><span class="line"></span><br><span class="line">    private static int count = 0;</span><br><span class="line"></span><br><span class="line">    private static void count() &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line"></span><br><span class="line">        ExecutorService es = Executors.newCachedThreadPool();</span><br><span class="line">        long start = System.nanoTime();</span><br><span class="line">        for (int i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">            es.execute(VolatileDemo::count);</span><br><span class="line">        &#125;</span><br><span class="line">        es.shutdown();</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            if (es.isTerminated()) &#123;</span><br><span class="line">                System.out.println(&quot;end...&quot;);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            try &#123;</span><br><span class="line">                TimeUnit.MILLISECONDS.sleep(2);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        long end = System.nanoTime();</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;count:&quot; + count);</span><br><span class="line">        System.out.println(&quot;cost:&quot; + (end - start));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ä¸€ä¸ªç¼“å­˜çº¿ç¨‹æ± è¿›è¡Œå¯¹staticå­—æ®µè¿›è¡Œè‡ªå¢ï¼Œç»“æœä¸æ˜¯100.<br>t1çº¿ç¨‹ä¸ t2çº¿ç¨‹è¯»å– count å€¼, ç„¶ååŒæ­¥ä¿®æ”¹ä¸º 1, å†å†™å›å†…å­˜, å†™äº†ä¸¤é 1ã€‚</p>
<p>å› æ­¤ï¼Œstaticä¿®é¥°çš„å˜é‡ç¡®å®å¯ä»¥åœ¨çº¿ç¨‹é—´é€šä¿¡, å¯¹å„ä¸ªçº¿ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚ä½†æ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>é‚£ä¹ˆç”¨volatileï¼Œç›¸å½“äºæ¯æ¬¡ä¿®æ”¹volatileå˜é‡éƒ½éœ€è¦é‡æ–°è¯»å–æ•°æ®ã€‚<br>ä½†æ˜¯ç»“æœä¾ç„¶ä¸æ˜¯100.</p>
<p>volatileçš„å¯è§æ€§æµ‹è¯•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//private boolean tag = false;  //ä¸ä¼šè¿è¡Œtag is true,exit</span><br><span class="line">//private static boolean tag = false;  //ä¸ä¼šè¿è¡Œtag is true,exit</span><br><span class="line">private volatile  boolean tag = false; //ä¼šè¿è¡Œtag is true,exit</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void visibleTest() throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">    Thread t1 = new Thread(new Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            //å½“tagæ ‡å¿—å˜ä¸ºtrueæ—¶ç»“æŸå¾ªç¯å¹¶æ‰“å°é€€å‡ºä¿¡æ¯</span><br><span class="line">            while(!tag)&#123;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;tag is true,exit......&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Thread t2 = new Thread(new Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            tag = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    t1.start();</span><br><span class="line">    Thread.sleep(100);</span><br><span class="line">    t2.start();</span><br><span class="line">    Thread.sleep(2000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>éåŸå­æ€§</strong></p>
<p>t1çº¿ç¨‹ä¸t2çº¿ç¨‹åŒæ—¶ä»ä¸»å­˜ä¸­è¯»å–äº†count &#x3D; 1,è‡ªå¢, è¿™æ—¶å€™ä¸¤ä¸ªçº¿ç¨‹çš„å¯„å­˜å™¨ä¸­å­˜çš„è®¡ç®—åçš„å€¼éƒ½æ˜¯ 2, ç„¶åè¦å†™å›countçš„ä¸»å­˜, å‡è®¾è¿™æ—¶ t1æˆåŠŸäº†, é‚£ä¹ˆä¸»å­˜ä¸­çš„countå°±æ˜¯2, ç„¶åæ ¹æ®MESIåè®®, t2éœ€è¦é‡æ–°ä»ä¸»å­˜è¯»å–countå€¼, å¾—åˆ°çš„æ˜¯2, å†å°†å¯„å­˜å™¨ä¸­çš„è®¡ç®—ç»“æœ2 èµ‹å€¼ç»™count, åˆ·å›ä¸»å­˜, æ­¤æ—¶ä¸»å­˜ä¸­çš„countå€¼è¿˜æ˜¯2, è€Œä¸æ˜¯æœŸæœ›ä¸­çš„3ã€‚</p>
<p>æ€ä¹ˆè§£å†³ï¼Ÿ<br>synchronizedå…³é”®å­—ï¼Œæˆ–è€… atomicåŸå­ç±» + volatile</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private volatile static AtomicInteger count = new AtomicInteger(0);</span><br><span class="line"></span><br><span class="line">private static void count() &#123;</span><br><span class="line">    count.incrementAndGet();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import lombok.SneakyThrows;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-09-12 20:14</span><br><span class="line"> **/</span><br><span class="line">public class VolatileDemo &#123;</span><br><span class="line"></span><br><span class="line">    private volatile AtomicInteger count = new AtomicInteger(0);</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testVolatile() throws InterruptedException &#123;</span><br><span class="line">        Thread thread1 = new Thread(new Runnable() &#123;</span><br><span class="line">            @SneakyThrows</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                for(int i = 0; i &lt; 50; i++) &#123;</span><br><span class="line">                    count.incrementAndGet();</span><br><span class="line">                    System.out.println(Thread.currentThread() + &quot; count:&quot; + count);</span><br><span class="line">                    Thread.sleep(100);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        Thread thread2 = new Thread(new Runnable() &#123;</span><br><span class="line">            @SneakyThrows</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                for(int i = 0; i &lt; 50; i++) &#123;</span><br><span class="line">                    count.incrementAndGet();</span><br><span class="line">                    System.out.println(Thread.currentThread() + &quot; count:&quot; + count);</span><br><span class="line">                    Thread.sleep(100);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread1.join();</span><br><span class="line">        thread2.join();</span><br><span class="line">        System.out.println(&quot;count:&quot; + count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼š<br>1ã€staticä¿®é¥°çš„å˜é‡æ˜¯é™æ€å˜é‡, è¡¨ç¤ºä¸ç®¡å¯¹è±¡æœ‰å¤šå°‘å®ä¾‹, åªæœ‰è¿™ä¸€ä¸ªå˜é‡, å¼ºè°ƒå˜é‡çš„å”¯ä¸€æ€§<br>2ã€volatileæ˜¯åŸºäºJMMä¸MESIæå‡ºçš„ä¸€ç§å†…å­˜ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ, å¼ºè°ƒçš„æ˜¯å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹æ˜¯å¯è§çš„, å˜é‡å€¼æ˜¯å”¯ä¸€çš„<br>3ã€volatile å¯ä»¥ä¿è¯å¯¹å…¶æ‰€ä¿®é¥°çš„å…±äº«å˜é‡çš„åŸå­æ€§æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
<p>è½¬è‡ªï¼š<br>volatileçš„å¯è§æ€§å’ŒéåŸå­æ€§ï¼š<a href="https://www.codenong.com/js5a773b9fb9cb/">https://www.codenong.com/js5a773b9fb9cb/</a></p>
<h3 id="2-synchronized"><a href="#2-synchronized" class="headerlink" title="2.synchronized"></a>2.synchronized</h3><p>synchronizedä¹‹å‰è¢«ç§°ä¸ºé‡é‡çº§é”ï¼Œä½†æ˜¯java se 1.6 å¯¹synchronizedè¿›è¡Œä¼˜åŒ–ï¼šå‡å°‘è·å–é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—è€Œå¼•å…¥åå‘é”ã€è½»é‡çº§é”ã€‚</p>
<h4 id="âœ…synchronizedé”ä¸‰ç§å½¢å¼"><a href="#âœ…synchronizedé”ä¸‰ç§å½¢å¼" class="headerlink" title="âœ…synchronizedé”ä¸‰ç§å½¢å¼"></a>âœ…synchronizedé”ä¸‰ç§å½¢å¼</h4><p>1.å¯¹äºæ™®é€šåŒæ­¥â½…æ³•ï¼šé”çš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ï¼Œé€šå¸¸æŒ‡thisï¼Œæ‰€æœ‰çš„æ™®é€šåŒæ­¥â½…æ³•â½¤çš„éƒ½æ˜¯åŒâ¼€æŠŠé”ï¼Œå³å®ä¾‹å¯¹è±¡æœ¬èº«ã€‚</p>
<p>2.å¯¹äºé™æ€åŒæ­¥â½…æ³•ï¼šé”çš„æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ã€‚</p>
<p>3.å¯¹äºåŒæ­¥â½…æ³•å—ï¼šé”çš„æ˜¯synchronized æ‹¬å·å†…çš„å¯¹è±¡ã€‚</p>
<p>âš ï¸å‡ ä¸ªé”çš„åŒºåˆ«ï¼š<br>1.é™æ€æ–¹æ³•åŒæ­¥å’Œé™æ€ä»£ç å—åŒæ­¥ï¼šæ‰€æœ‰çš„é™æ€åŒæ­¥â½…æ³•â½¤çš„ä¹Ÿæ˜¯åŒâ¼€æŠŠé”â€”â€”ç±»å¯¹è±¡æœ¬èº«ï¼Œâ¼€æ—¦â¼€ä¸ªé™æ€åŒæ­¥â½…æ³•è·å–é”åï¼Œå…¶ä»–çš„é™æ€åŒæ­¥â½…æ³•éƒ½å¿…é¡»ç­‰å¾…è¯¥â½…æ³•é‡Šæ”¾é”åæ‰èƒ½è·å–é”ã€‚ï¼ˆå’Œå®ä¾‹æ²¡å…³ç³»ï¼‰</p>
<p>2.é™æ€åŒæ­¥å’Œæ™®é€šåŒæ­¥ï¼šå…·ä½“å®ä¾‹å¯¹è±¡thiså’Œå”¯â¼€æ¨¡æ¿Classï¼Œè¿™ä¸¤æŠŠé”æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥é™æ€åŒæ­¥â½…æ³•ä¸æ™®é€šåŒæ­¥â½…æ³•ä¹‹é—´æ˜¯ä¸ä¼šæœ‰ç«æ€æ¡ä»¶çš„</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-09-17 14:11</span><br><span class="line"> **/</span><br><span class="line">//èµ„æºç±»</span><br><span class="line">class Phone&#123;</span><br><span class="line">    //1.é™æ€æ–¹æ³•ï¼ˆåŠ é”ï¼‰</span><br><span class="line">    public static synchronized void sendEmail() &#123;</span><br><span class="line">        //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span><br><span class="line">        try &#123; TimeUnit.SECONDS.sleep(3); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">        System.out.println(System.currentTimeMillis() + &quot;,&quot; + Thread.currentThread() + &quot;-------sendEmail&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //2.æ™®é€šæ–¹æ³•ï¼ˆåŠ é”ï¼‰</span><br><span class="line">    public synchronized void sendSMS() &#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis() + &quot;,&quot; + Thread.currentThread() + &quot;-------sendSMS&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //3. æ™®é€šæ–¹æ³•ä¸åŠ é”</span><br><span class="line">    public void hello() &#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis() + &quot;,&quot; + Thread.currentThread() + &quot;-------hello&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ä¸»æ–¹æ³•</span><br><span class="line">public class SynchronizedDemo&#123;</span><br><span class="line">    //ä¸€åˆ‡ç¨‹åºçš„å…¥å£ï¼Œä¸»çº¿ç¨‹</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        Phone phone = new Phone();//èµ„æºç±»1</span><br><span class="line">        Phone phone2 = new Phone();//èµ„æºç±»2</span><br><span class="line"></span><br><span class="line">        Thread t1 = new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                //phone.sendSMS(); //1ã€2</span><br><span class="line">                //phone.hello();</span><br><span class="line">                phone.sendEmail();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Thread t2 = new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                //phone.sendSMS(); //1ã€2</span><br><span class="line">                //phone.hello();</span><br><span class="line">                phone2.sendEmail();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        try &#123; TimeUnit.MILLISECONDS.sleep(300); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">        t2.start();</span><br><span class="line">        try &#123; TimeUnit.MILLISECONDS.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…synchronizedé”çš„å®ç°åŸç†"><a href="#âœ…synchronizedé”çš„å®ç°åŸç†" class="headerlink" title="âœ…synchronizedé”çš„å®ç°åŸç†"></a>âœ…synchronizedé”çš„å®ç°åŸç†</h4><p>åç¼–è¯‘å‘½ä»¤ï¼š<code>javap -v -p *.class &gt; ç±».txt </code>ï¼ˆå°†è¿›â¾è¾“å‡ºåˆ°txtä¸­ï¼‰</p>
<p>synchronizedåœ¨jvmä¸­çš„å®ç°åŸç†ï¼šjvmåŸºäºè¿›å…¥å’Œé€€å‡ºMonitorå¯¹è±¡æ¥å®ç°æ–¹æ³•åŒæ­¥å’Œä»£ç å—åŒæ­¥ï¼Œmonitoræ˜¯ä¸€ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨ã€‚</p>
<p><strong>åŒæ­¥ä»£ç å—ï¼š</strong></p>
<p>åŒæ­¥ä»£ç å—æ˜¯é€šè¿‡monitorenterå’ŒmonitorexitæŒ‡ä»¤å®ç°çš„ã€‚</p>
<p>monitorenterï¼šåœ¨ç¼–è¯‘åæ’å…¥åˆ°åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œä¼šå°è¯•è·å–å¯¹è±¡æ‰€å¯¹åº”çš„monitorçš„æ‰€æœ‰æƒï¼Œå³å°è¯•è·å–å¯¹è±¡çš„é”ã€‚</p>
<p>monitorexitï¼šä»£è¡¨æ‰§è¡Œå®Œsynchronizedä»£ç å—ä¹‹åï¼Œè¦ä»å¯¹è±¡ç›‘è§†å™¨ä¸­é€€å‡ºï¼Œä¹Ÿå°±æ˜¯é‡Šæ”¾é”ã€‚</p>
<p><strong>åŒæ­¥æ™®é€šâ½…æ³•ï¼š</strong></p>
<p>1.åŒæ­¥æ™®é€šâ½…æ³•åç¼–è¯‘åçš„ç»“æ„ï¼šå¯ä»¥çœ‹åˆ°åœ¨synchronizedä¿®é¥°å®ä¾‹æ–¹æ³•ä¸­ï¼Œä¸ä¼šå†æœ‰monitorenterå’ŒmonitorexitæŒ‡ä»¤ï¼Œè€Œæ˜¯åœ¨è¿™ä¸ªæ–¹æ³•ä¸Šå¤šäº†ä¸€ä¸ªACC_SYNCHRONIZEDçš„flagã€‚</p>
<p>2.è°ƒç”¨æ™®é€šæ–¹æ³•çš„æµç¨‹ï¼šå½“ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œè°ƒç”¨method()æ–¹æ³•æ—¶ï¼Œä¼šæ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦æœ‰ACC_SYNCHRONIZEDè®¿é—®æ ‡è¯†ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¡¨æ˜è¯¥æ–¹æ³•æ˜¯åŒæ­¥æ–¹æ³•ï¼Œè¿™æ—¶å€™è¯¥çº¿ç¨‹ä¼šå…ˆå°è¯•å»è·å–è¯¥æ–¹æ³•å¯¹åº”çš„ç›‘è§†å™¨ï¼ˆmonitorï¼‰å¯¹è±¡ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™ç»§ç»­æ‰§è¡Œè¯¥method()æ–¹æ³•ã€‚</p>
<p>3.åœ¨æ‰§è¡ŒæœŸé—´ï¼Œä»»ä½•å…¶ä»–çº¿ç¨‹éƒ½ä¸èƒ½å†è·å–è¯¥æ–¹æ³•ç›‘è§†å™¨çš„ä½¿ç”¨æƒï¼Œç›´åˆ°è¯¥æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰ä¼šé‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥é‡æ–°è·å¾—è¯¥ç›‘è§†å™¨ã€‚</p>
<p><strong>åŒæ­¥é™æ€æ–¹æ³•ï¼š</strong></p>
<p>synchronizedä¿®é¥°é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•æ²¡æœ‰åŒºåˆ«ï¼Œéƒ½æ˜¯å¢åŠ ä¸€ä¸ªACC_SYNCHRONIZEDçš„flagï¼Œé™æ€æ–¹æ³•åªæ˜¯æ¯”å®ä¾‹æ–¹æ³•å¤šä¸€ä¸ªACC_STATICæ ‡è¯†ä»£è¡¨è¿™ä¸ªæ–¹æ³•æ˜¯é™æ€çš„ã€‚</p>
<p><strong>é˜¿é‡Œå¼€å‘æ‰‹å†Œè¯´æ˜ï¼š</strong></p>
<p>â¾¼å¹¶å‘æ—¶ï¼ŒåŒæ­¥è°ƒâ½¤åº”è¯¥å»è€ƒé‡é”çš„æ€§èƒ½æŸè€—ã€‚<br>1.èƒ½â½¤â½†é”æ•°æ®ç»“æ„ï¼Œå°±ä¸è¦â½¤æœ‰é”ï¼›<br>2.èƒ½é”åŒºå—ï¼Œå°±ä¸è¦é”æ•´ä¸ªâ½…æ³•ä½“ï¼›<br>3.èƒ½â½¤å¯¹è±¡é”ï¼Œå°±ä¸è¦â½¤ç±»é”ï¼›</p>
<p>å‚è€ƒï¼š<br>synchronizedä¸‰ç§åŠ é”æ–¹å¼ï¼š<a href="https://blog.csdn.net/weixin_38963649/article/details/126139304">https://blog.csdn.net/weixin_38963649/article/details/126139304</a></p>
<h4 id="âœ…javaå¯¹è±¡å¤´"><a href="#âœ…javaå¯¹è±¡å¤´" class="headerlink" title="âœ…javaå¯¹è±¡å¤´"></a>âœ…javaå¯¹è±¡å¤´</h4><p>HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸ºä¸‰å—åŒºåŸŸï¼šå¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰ã€‚</p>
<p>HotSpotè™šæ‹Ÿæœºçš„å¯¹è±¡å¤´åŒ…æ‹¬ä¸‰éƒ¨åˆ†ä¿¡æ¯ï¼š<br>1ã€mark word 2ã€å…ƒç±»æŒ‡é’ˆ 3ã€æ•°ç»„é•¿åº¦<br>æ™®é€šå¯¹è±¡å¤´æœ‰ä¸¤ä¸ªåŒºåŸŸï¼ˆ1ï¼Œ2ï¼‰ã€æ•°ç»„å¯¹è±¡å¤´æœ‰ä¸‰ä¸ªåŒºåŸŸï¼ˆ1,2,3ï¼‰</p>
<p><strong>Mark Word</strong></p>
<p>è¿™éƒ¨åˆ†ä¸»è¦å­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ•°æ®ï¼Œå¦‚Hashcodeã€gcåˆ†ä»£å¹´é¾„ã€å¯¹è±¡é”ï¼Œé”çŠ¶æ€æ ‡å¿—ï¼Œåå‘é”ï¼ˆçº¿ç¨‹ï¼‰IDï¼Œåå‘æ—¶é—´ç­‰ç­‰ã€‚mark wordçš„ä½é•¿åº¦ä¸ºJVMçš„ä¸€ä¸ªWordå¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´32ä½JVMçš„Mark wordä¸º32ä½ã€‚</p>
<p>Javaå¯¹è±¡å¤´ä¸€èˆ¬å æœ‰2ä¸ªæœºå™¨ç ï¼ˆ64ä½è™šæ‹Ÿæœºä¸­ï¼Œ1ä¸ªæœºå™¨ç æ˜¯8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯64bitï¼‰ï¼Œä½†æ˜¯ å¦‚æœå¯¹è±¡æ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™éœ€è¦3ä¸ªæœºå™¨ç ï¼Œå› ä¸ºJVMè™šæ‹Ÿæœºå¯ä»¥é€šè¿‡Javaå¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ç¡®å®šJavaå¯¹è±¡çš„å¤§å°ï¼Œä½†æ˜¯æ— æ³•ä»æ•°ç»„çš„å…ƒæ•°æ®æ¥ç¡®è®¤æ•°ç»„çš„å¤§å°ï¼Œæ‰€ä»¥ç”¨ä¸€å—æ¥è®°å½•æ•°ç»„é•¿åº¦ã€‚</p>
<p><strong>æŒ‡å‘ç±»çš„æŒ‡é’ˆ</strong></p>
<p>è¯¥æŒ‡é’ˆåœ¨32ä½JVMçš„é•¿åº¦æ˜¯32Bitï¼Œ64æ˜¯64bit<br>å®ƒä¸»è¦æŒ‡å‘ç±»çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘æ–¹æ³•åŒºä¸­çš„ä½ç½®ã€‚</p>
<p><strong>æ•°ç»„é•¿åº¦</strong></p>
<p>åªæœ‰æ•°ç»„å¯¹è±¡ä¿å­˜äº†è¿™éƒ¨åˆ†æ•°æ®<br>è¯¥æ•°æ®åœ¨32ä½å’Œ64ä½JVMéƒ½æ˜¯32bit</p>
<p>å‚è€ƒï¼š<br>javaå¯¹è±¡å¤´ä»¥åŠæ‰“å°å¯¹è±¡å¤´ï¼š<a href="https://blog.csdn.net/sumengnan/article/details/125035218">https://blog.csdn.net/sumengnan/article/details/125035218</a><br>javaå¯¹è±¡å¤´ä»¥åŠé”å‡çº§è¿‡ç¨‹ï¼š<a href="https://www.cnblogs.com/Alei777/p/16308553.html">https://www.cnblogs.com/Alei777/p/16308553.html</a></p>
<h4 id="âœ…é”çš„å‡çº§ä¸å¯¹æ¯”"><a href="#âœ…é”çš„å‡çº§ä¸å¯¹æ¯”" class="headerlink" title="âœ…é”çš„å‡çº§ä¸å¯¹æ¯”"></a>âœ…é”çš„å‡çº§ä¸å¯¹æ¯”</h4><p>Java SE 1.6ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ã€‚<br>åœ¨ Java SE 1.6ä¸­ï¼Œé”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶ æ€å’Œé‡é‡çº§é”çŠ¶æ€ï¼Œè¿™å‡ ä¸ªçŠ¶æ€ä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚<br>é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§ï¼Œæ„å‘³ç€åå‘é”å‡çº§æˆè½»é‡çº§é”åä¸èƒ½é™çº§æˆåå‘é”ã€‚è¿™ç§é”å‡çº§å´ä¸èƒ½é™çº§çš„ç­–ç•¥ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚</p>
<p><strong>åå‘é”</strong></p>
<p>èƒŒæ™¯ï¼š<br>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒ ä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½è€Œå¼•å…¥äº†åå‘é”ã€‚</p>
<p>åå‘é”åŸç†ï¼š<br>å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨<strong>å¯¹è±¡å¤´</strong>å’Œ<strong>æ ˆå¸§</strong>ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡ŒCASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€ç®€å•åœ°æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ã€‚å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™éœ€è¦å†æµ‹è¯•ä¸€ä¸‹Mark Wordä¸­åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®æˆ1ï¼ˆè¡¨ç¤ºå½“å‰æ˜¯åå‘é”ï¼‰ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨CASç«äº‰é”ï¼›å¦‚æœè®¾ç½®äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´çš„åå‘é”æŒ‡å‘å½“å‰çº¿ç¨‹ã€‚</p>
<p>åå‘é”é‡Šæ”¾å’Œå‡çº§ï¼š<br>åå‘é”ä½¿ç”¨äº†ä¸€ç§ç­‰åˆ°ç«äº‰å‡ºç°æ‰é‡Šæ”¾é”çš„æœºåˆ¶ï¼Œæ‰€ä»¥å½“å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ã€‚<br>åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰æ­£ åœ¨æ‰§è¡Œçš„å­—èŠ‚ç ï¼‰ã€‚<br>1ã€é¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹<br>2ã€ç„¶åæ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦æ´»ç€ï¼Œå¦‚æœçº¿ç¨‹ä¸å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€ï¼›<br>3ã€å¦‚æœçº¿ç¨‹ä»ç„¶æ´»ç€ï¼Œæ‹¥æœ‰åå‘é”çš„æ ˆä¼šè¢«æ‰§è¡Œï¼Œéå†åå‘å¯¹è±¡çš„é”è®°å½•ï¼Œæ ˆä¸­çš„é”è®°å½•å’Œå¯¹è±¡å¤´çš„Mark Wordè¦ä¹ˆé‡æ–°åå‘äºå…¶ä»–çº¿ç¨‹ï¼Œè¦ä¹ˆæ¢å¤åˆ°æ— é”æˆ–è€…æ ‡è®°å¯¹è±¡ä¸é€‚åˆä½œä¸ºåå‘é”ï¼ˆå‡çº§ä¸ºè½»é‡çº§é”ï¼‰ï¼Œæœ€åå”¤é†’æš‚åœçš„çº¿ç¨‹ã€‚</p>
<p>å…³é—­åå‘é”<br>åå‘é”åœ¨Java 6å’ŒJava 7é‡Œæ˜¯é»˜è®¤å¯ç”¨ï¼Œå¦‚æœä½ ç¡®å®šåº”ç”¨ç¨‹åºé‡Œæ‰€æœ‰çš„é”é€šå¸¸æƒ…å†µä¸‹å¤„äºç«äº‰çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š<br><code>-XX:-UseBiasedLocking=false</code></p>
<p><strong>è½»é‡çº§é”</strong></p>
<p>å‡çº§ä¸ºè½»é‡çº§é”åï¼Œçº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVMä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆæ¡¢ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ï¼Œå®˜æ–¹ç§°ä¸ºDisplaced Mark Wordã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´ä¸­çš„Mark Wordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨<strong>è‡ªæ—‹</strong>æ¥è·å–é”ã€‚è‡ªæ—‹é”é‡è¯•ä¹‹åå¦‚æœæŠ¢é”ä¾ç„¶å¤±è´¥ï¼ŒåŒæ­¥é”ä¼šå‡çº§è‡³é‡é‡çº§é”ã€‚</p>
<p><strong>é‡é‡çº§é”</strong></p>
<p>è½»é‡çº§é” -&gt; é‡é‡çº§é” çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<p>1 è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹å°†é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°æ—¶ï¼Œè½»é‡çº§é”ä¾¿ä¼šå‡çº§ä¸ºé‡é‡çº§é”ï¼ˆé”è†¨èƒ€ï¼‰ã€‚</p>
<p>2 å¦å¤–ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å·²æŒæœ‰é”ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨è‡ªæ—‹ï¼Œè€Œæ­¤æ—¶åˆæœ‰ç¬¬ä¸‰ä¸ªçº¿ç¨‹æ¥è®¿æ—¶ï¼Œè½»é‡çº§é”ä¹Ÿä¼šå‡çº§ä¸ºé‡é‡çº§é”ï¼ˆé”è†¨èƒ€ï¼‰ã€‚</p>
<p>è‡ªæ—‹ä¼šæ¶ˆè€—CPUï¼Œä¸€æ—¦é‡é‡çº§é”ï¼Œå°±ä¸ä¼šæ¢å¤ä¸ºè½»é‡çº§é”ã€‚å½“é”å¤„äºè¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œå…¶ä»–çº¿ç¨‹è¯•å›¾è·å–é”æ—¶ï¼Œ éƒ½ä¼šè¢«é˜»å¡ä½ï¼Œå½“æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åä¼šå”¤é†’è¿™äº›çº¿ç¨‹ï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å°±ä¼šè¿›è¡Œæ–°ä¸€è½®çš„å¤ºé”ä¹‹äº‰ã€‚</p>
<p><strong>å‡ ç§é”çš„å¯¹æ¯”</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é”	ä¼˜ç‚¹	ç¼ºç‚¹	ä½¿ç”¨åœºæ™¯</span><br><span class="line">åå‘é”	åŠ é”å’Œè§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€—,å’Œæ‰§è¡ŒéåŒæ­¥æ–¹æ³•ç›¸æ¯”ä»…å­˜åœ¨çº³ç§’çº§çš„å·®è·	å¦‚æœçº¿ç¨‹é—´å­˜åœ¨é”ç«äº‰ï¼Œä¼šå¸¦æ¥é¢å¤–çš„æ’¤é”€æ¶ˆè€—	é€‚ç”¨äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—åœºæ™¯</span><br><span class="line">è½»é‡çº§é”	ç«äº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œæé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦	å¦‚æœå§‹ç»ˆå¾—ä¸åˆ°é”ç«äº‰çš„çº¿ç¨‹ï¼Œä¼šè‡ªæ—‹æ¶ˆè€—CPU	è¿½æ±‚å“åº”æ—¶é—´ã€åŒæ­¥å—æ‰§è¡Œéå¸¸å¿«</span><br><span class="line">é‡é‡çº§é”	çº¿ç¨‹ä¸ä½¿ç”¨è‡ªæ—‹ï¼Œä¸ä¼šæ¶ˆè€—CPU	çº¿ç¨‹é˜»å¡ï¼Œå“åº”æ—¶é—´ç¼“æ…¢	è¿½æ±‚ååé‡ã€åŒæ­¥å—æ‰§è¡Œé€Ÿåº¦è¾ƒå¿«</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<br>ã€Šä¹¦ä¸­å†…å®¹ã€‹ï¼š<a href="https://blog.csdn.net/Hello_mengkebao/article/details/119874999">https://blog.csdn.net/Hello_mengkebao/article/details/119874999</a></p>
<p><strong>æ€»ç»“ï¼šé”çš„å‡çº§è¿‡ç¨‹</strong></p>
<p>JVMä¸€èˆ¬æ˜¯è¿™æ ·ä½¿ç”¨é”å’ŒMark Wordçš„ï¼š</p>
<p>1ï¼Œå½“æ²¡æœ‰è¢«å½“æˆé”æ—¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼ŒMark Wordè®°å½•å¯¹è±¡çš„HashCodeï¼Œé”æ ‡å¿—ä½æ˜¯01ï¼Œæ˜¯å¦åå‘é”é‚£ä¸€ä½æ˜¯0ã€‚</p>
<p>2ï¼Œå½“å¯¹è±¡è¢«å½“åšåŒæ­¥é”å¹¶æœ‰ä¸€ä¸ªçº¿ç¨‹AæŠ¢åˆ°äº†é”æ—¶ï¼Œé”æ ‡å¿—ä½è¿˜æ˜¯01ï¼Œä½†æ˜¯å¦åå‘é”é‚£ä¸€ä½æ”¹æˆ1ï¼Œå‰23bitè®°å½•æŠ¢åˆ°é”çš„çº¿ç¨‹idï¼Œè¡¨ç¤ºè¿›å…¥åå‘é”çŠ¶æ€ã€‚</p>
<p>3ï¼Œå½“çº¿ç¨‹Aå†æ¬¡è¯•å›¾æ¥è·å¾—é”æ—¶ï¼ŒJVMå‘ç°åŒæ­¥é”å¯¹è±¡çš„æ ‡å¿—ä½æ˜¯01ï¼Œæ˜¯å¦åå‘é”æ˜¯1ï¼Œä¹Ÿå°±æ˜¯åå‘çŠ¶æ€ï¼ŒMark Wordä¸­è®°å½•çš„çº¿ç¨‹idå°±æ˜¯çº¿ç¨‹Aè‡ªå·±çš„idï¼Œè¡¨ç¤ºçº¿ç¨‹Aå·²ç»è·å¾—äº†è¿™ä¸ªåå‘é”ï¼Œå¯ä»¥æ‰§è¡ŒåŒæ­¥é”çš„ä»£ç ã€‚</p>
<p>4ï¼Œå½“çº¿ç¨‹Bè¯•å›¾è·å¾—è¿™ä¸ªé”æ—¶ï¼ŒJVMå‘ç°åŒæ­¥é”å¤„äºåå‘çŠ¶æ€ï¼Œä½†æ˜¯Mark Wordä¸­çš„çº¿ç¨‹idè®°å½•çš„ä¸æ˜¯Bï¼Œé‚£ä¹ˆçº¿ç¨‹Bä¼šå…ˆç”¨CASæ“ä½œè¯•å›¾è·å¾—é”ï¼Œè¿™é‡Œçš„è·å¾—é”æ“ä½œæ˜¯æœ‰å¯èƒ½æˆåŠŸçš„ï¼Œå› ä¸ºçº¿ç¨‹Aä¸€èˆ¬ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾åå‘é”ã€‚å¦‚æœæŠ¢é”æˆåŠŸï¼Œå°±æŠŠMark Wordé‡Œçš„çº¿ç¨‹idæ”¹ä¸ºçº¿ç¨‹Bçš„idï¼Œä»£è¡¨çº¿ç¨‹Bè·å¾—äº†è¿™ä¸ªåå‘é”ï¼Œå¯ä»¥æ‰§è¡ŒåŒæ­¥é”ä»£ç ã€‚å¦‚æœæŠ¢é”å¤±è´¥ï¼Œåˆ™ç»§ç»­æ‰§è¡Œæ­¥éª¤5ã€‚</p>
<p>5ï¼Œåå‘é”çŠ¶æ€æŠ¢é”å¤±è´¥ï¼Œä»£è¡¨å½“å‰é”æœ‰ä¸€å®šçš„ç«äº‰ï¼Œåå‘é”å°†å‡çº§ä¸ºè½»é‡çº§é”ã€‚JVMä¼šåœ¨å½“å‰çº¿ç¨‹çš„çº¿ç¨‹æ ˆä¸­å¼€è¾Ÿä¸€å—å•ç‹¬çš„ç©ºé—´ï¼Œé‡Œé¢ä¿å­˜æŒ‡å‘å¯¹è±¡é”Mark Wordçš„æŒ‡é’ˆï¼ŒåŒæ—¶åœ¨å¯¹è±¡é”Mark Wordä¸­ä¿å­˜æŒ‡å‘è¿™ç‰‡ç©ºé—´çš„æŒ‡é’ˆã€‚ä¸Šè¿°ä¸¤ä¸ªä¿å­˜æ“ä½œéƒ½æ˜¯CASæ“ä½œï¼Œå¦‚æœä¿å­˜æˆåŠŸï¼Œä»£è¡¨çº¿ç¨‹æŠ¢åˆ°äº†åŒæ­¥é”ï¼Œå°±æŠŠMark Wordä¸­çš„é”æ ‡å¿—ä½æ”¹æˆ00ï¼Œå¯ä»¥æ‰§è¡ŒåŒæ­¥é”ä»£ç ã€‚å¦‚æœä¿å­˜å¤±è´¥ï¼Œè¡¨ç¤ºæŠ¢é”å¤±è´¥ï¼Œç«äº‰å¤ªæ¿€çƒˆï¼Œç»§ç»­æ‰§è¡Œæ­¥éª¤6ã€‚</p>
<p>6ï¼Œè½»é‡çº§é”æŠ¢é”å¤±è´¥ï¼ŒJVMä¼šä½¿ç”¨è‡ªæ—‹é”ï¼Œè‡ªæ—‹é”ä¸æ˜¯ä¸€ä¸ªé”çŠ¶æ€ï¼Œåªæ˜¯ä»£è¡¨ä¸æ–­çš„é‡è¯•ï¼Œå°è¯•æŠ¢é”ã€‚ä»JDK1.7å¼€å§‹ï¼Œè‡ªæ—‹é”é»˜è®¤å¯ç”¨ï¼Œè‡ªæ—‹æ¬¡æ•°ç”±JVMå†³å®šã€‚å¦‚æœæŠ¢é”æˆåŠŸåˆ™æ‰§è¡ŒåŒæ­¥é”ä»£ç ï¼Œå¦‚æœå¤±è´¥åˆ™ç»§ç»­æ‰§è¡Œæ­¥éª¤7ã€‚</p>
<p>7ï¼Œè‡ªæ—‹é”é‡è¯•ä¹‹åå¦‚æœæŠ¢é”ä¾ç„¶å¤±è´¥ï¼ŒåŒæ­¥é”ä¼šå‡çº§è‡³é‡é‡çº§é”ï¼Œé”æ ‡å¿—ä½æ”¹ä¸º10ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒæœªæŠ¢åˆ°é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚</p>
<h3 id="3-AtomicåŸå­æ“ä½œ"><a href="#3-AtomicåŸå­æ“ä½œ" class="headerlink" title="3.AtomicåŸå­æ“ä½œ"></a>3.AtomicåŸå­æ“ä½œ</h3><p>åŸå­æ“ä½œï¼ˆatomic operationï¼‰æ„ä¸ºâ€œä¸å¯è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œâ€ã€‚</p>
<h4 id="âœ…å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œ"><a href="#âœ…å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œ" class="headerlink" title="âœ…å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œ"></a>âœ…å¤„ç†å™¨å¦‚ä½•å®ç°åŸå­æ“ä½œ</h4><p>é¦–å…ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨ä¿è¯<strong>åŸºæœ¬çš„å†…å­˜æ“ä½œçš„åŸå­æ€§</strong>ã€‚å¤„ç†å™¨ä¿è¯ä»ç³»ç»Ÿå†…å­˜ä¸­è¯»å–æˆ–è€…å†™å…¥ä¸€ä¸ªå­—èŠ‚æ˜¯åŸå­çš„ï¼Œæ„æ€æ˜¯å½“ä¸€ä¸ªå¤„ç†å™¨è¯»å–ä¸€ä¸ªå­—èŠ‚æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½è®¿é—®è¿™ä¸ªå­—èŠ‚çš„å†…å­˜åœ°å€ã€‚Pentium 6å’Œæœ€æ–°çš„å¤„ç†å™¨èƒ½è‡ªåŠ¨ä¿è¯å•å¤„ç†å™¨å¯¹åŒä¸€ä¸ªç¼“å­˜è¡Œé‡Œè¿›è¡Œ16&#x2F;32&#x2F;64ä½çš„æ“ä½œæ˜¯åŸå­çš„ã€‚</p>
<p>ä½†æ˜¯<strong>å¤æ‚çš„å†…å­˜æ“ä½œå¤„ç†å™¨æ˜¯ä¸èƒ½è‡ªåŠ¨ä¿è¯å…¶åŸå­æ€§çš„</strong>ï¼Œæ¯”å¦‚è·¨æ€»çº¿å®½åº¦ã€è·¨å¤šä¸ªç¼“å­˜è¡Œå’Œè·¨é¡µè¡¨çš„è®¿é—®ã€‚ä½†æ˜¯ï¼Œå¤„ç†å™¨æä¾›<strong>æ€»çº¿é”å®š</strong>å’Œ<strong>ç¼“å­˜é”å®š</strong>ä¸¤ä¸ªæœºåˆ¶æ¥ä¿è¯å¤æ‚å†…å­˜æ“ä½œçš„åŸå­æ€§ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ç‚¹ï¼ša++æ˜¯ä¸‰æ­¥æ“ä½œï¼ˆå–æ•°ï¼ŒåŠ ä¸€ï¼Œèµ‹å€¼ï¼‰ï¼Œè€Œè®¡ç®—æœºå’ŒJavaéƒ½åªä¿è¯ä¸€æ­¥æ“ä½œçš„åŸå­æ€§ï¼Œå¤šæ­¥æ“ä½œæ˜¯ä¸ä¿è¯åŸå­æ€§çš„ã€‚æ‰€ä»¥a++ä¸æ˜¯åŸå­æ€§çš„ã€‚æƒ³è¦ä¿è¯è¯»æ”¹å†™å…±äº«å˜é‡çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œå°±å¿…é¡»ä¿è¯CPU1è¯»æ”¹å†™å…±äº«å˜é‡çš„æ—¶å€™ï¼ŒCPU2ä¸èƒ½æ“ä½œç¼“å­˜äº†è¯¥å…±äº«å˜é‡å†…å­˜åœ°å€çš„ç¼“å­˜ã€‚</p>
<p>âš ï¸volitaleä¿è¯å¯è§æ€§ä¸ºä»€ä¹ˆä¸èƒ½å®ç°i++çš„çº¿ç¨‹å®‰å…¨ï¼Ÿ</p>
<blockquote>
<p>å¯è§æ€§æ˜¯æŒ‡ç¬æ—¶å¯è§æ€§ï¼Œæ˜¯æŒ‡é‚£ä¸€æ—¶åˆ»çš„å¯è§æ€§ã€‚æ”¾åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå°±æ˜¯æŒ‡å½“çº¿ç¨‹1æŠŠï¼ˆa&#x3D;0ï¼Œa++ï¼‰çš„ç»“æœa&#x3D;1åˆ·å›åˆ°ä¸»å­˜ä¸­æ—¶ï¼Œæ‰€æœ‰ç›®å‰æœ‰aè¿™ä¸ªå˜é‡çš„ç¼“å­˜æ­¤æ—¶éƒ½åº”è¯¥å˜ä¸ºa&#x3D;1ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åŸæ¥çš„å€¼ã€‚æ‰€ä»¥ï¼Œçº¿ç¨‹2ä¹Ÿæ‰§è¡ŒåŠ ä¸€åï¼Œè¿˜æ²¡æœ‰å†™å›åˆ°ç¼“å­˜ä¸­ï¼Œä¿å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œçº¿ç¨‹2ç¼“å­˜é‡Œé¢çš„a&#x3D;0è¢«ç½®ä¸ºæ— æ•ˆï¼Œæ‰€ä»¥çº¿ç¨‹2åˆä»ä¸»å­˜ä¸­å–å¾—a&#x3D;1æ›¿æ¢æ‰äº†è‡ªå·±ç¼“å­˜ä¸­çš„a&#x3D;0ï¼Œç„¶åçº¿ç¨‹2å°†a&#x3D;1å†™å…¥è‡ªå·±çš„ç¼“å­˜ä¸­ï¼Œéšåa&#x3D;1åˆä¸€æ¬¡è¢«ç«‹åˆ»åˆ·å›åˆ°ä¸»å­˜ä¸­ã€‚æœ€åä¸»å­˜ä¸­çš„å€¼è¿˜æ˜¯a&#x3D;1ã€‚</p>
</blockquote>
<p><strong>æ€»çº¿é”</strong></p>
<p>æ€»çº¿é”å°±æ˜¯ä½¿ç”¨å¤„ç†å™¨æä¾›çš„ä¸€ä¸ªLOCKï¼ƒä¿¡å·ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨åœ¨æ€»çº¿ä¸Šè¾“å‡ºæ­¤ä¿¡å·æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨çš„è¯·æ±‚å°†è¢«é˜»å¡ä½ï¼Œé‚£ä¹ˆè¯¥å¤„ç†å™¨å¯ä»¥ç‹¬å å…±äº«å†…å­˜ã€‚</p>
<p><strong>ç¼“å­˜é”</strong></p>
<p>æ€»çº¿é”å®šæŠŠCPUå’Œå†…å­˜ä¹‹é—´çš„é€šä¿¡é”ä½äº†ï¼Œè¿™ä½¿å¾—é”å®šæœŸé—´ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½æ“ä½œå…¶ä»–å†…å­˜åœ°å€çš„æ•°æ®ï¼Œæ‰€ä»¥æ€»çº¿é”å®šçš„å¼€é”€æ¯”è¾ƒå¤§ã€‚</p>
<p>é¢‘ç¹ä½¿ç”¨çš„å†…å­˜ä¼šç¼“å­˜åœ¨å¤„ç†å™¨çš„L1ã€L2å’ŒL3é«˜é€Ÿç¼“å­˜é‡Œï¼Œé‚£ä¹ˆåŸå­æ“ä½œå°±å¯ä»¥ç›´æ¥åœ¨å¤„ç†å™¨å†…éƒ¨ç¼“å­˜ä¸­è¿›è¡Œï¼Œå¹¶ä¸éœ€è¦å£°æ˜æ€»çº¿é”ï¼Œåœ¨Pentium 6å’Œç›®å‰çš„å¤„ç†å™¨ä¸­å¯ä»¥ä½¿ç”¨â€œç¼“å­˜é”å®šâ€çš„æ–¹å¼æ¥å®ç°å¤æ‚çš„åŸå­æ€§ã€‚</p>
<p>â€œç¼“å­˜é”å®šâ€æ˜¯æŒ‡å†…å­˜åŒºåŸŸå¦‚æœè¢«ç¼“å­˜åœ¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œä¸­ï¼Œå¹¶ä¸”åœ¨Lockæ“ä½œæœŸé—´è¢«é”å®šï¼Œé‚£ä¹ˆå½“å®ƒæ‰§è¡Œé”æ“ä½œå›å†™åˆ°å†…å­˜æ—¶ï¼Œå¤„ç†å™¨ä¸åœ¨æ€»çº¿ä¸Šå£°è¨€LOCKï¼ƒä¿¡å·ï¼Œè€Œæ˜¯ä¿®æ”¹å†…éƒ¨çš„å†…å­˜åœ°å€ï¼Œå¹¶å…è®¸å®ƒçš„ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œå› ä¸º<strong>ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”±ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®</strong>ï¼Œå½“å…¶ä»–å¤„ç†å™¨å›å†™å·²è¢«é”å®šçš„ç¼“å­˜è¡Œçš„æ•°æ®æ—¶ï¼Œä¼šä½¿ç¼“å­˜è¡Œæ— æ•ˆã€‚</p>
<p>ä¸èƒ½ä½¿ç”¨ç¼“å­˜é”çš„æƒ…å†µï¼š<br>1ã€ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼šå½“æ“ä½œçš„æ•°æ®ä¸èƒ½è¢«ç¼“å­˜åœ¨å¤„ç†å™¨å†…éƒ¨ï¼Œæˆ–æ“ä½œçš„æ•°æ®è·¨å¤šä¸ªç¼“å­˜è¡Œã€‚<br>2ã€æœ‰äº›å¤„ç†å™¨ä¸æ”¯æŒç¼“å­˜é”å®š</p>
<h4 id="âœ…javaå¦‚ä½•å®ç°åŸå­æ“ä½œ"><a href="#âœ…javaå¦‚ä½•å®ç°åŸå­æ“ä½œ" class="headerlink" title="âœ…javaå¦‚ä½•å®ç°åŸå­æ“ä½œ"></a>âœ…javaå¦‚ä½•å®ç°åŸå­æ“ä½œ</h4><p><strong>å¾ªç¯CAS</strong></p>
<p>CAS å…¨ç§°æ˜¯ compare and swapï¼Œæ˜¯ä¸€ç§ç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®ç°åŒæ­¥åŠŸèƒ½çš„æœºåˆ¶ã€‚CAS æ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•° â€“ å†…å­˜ä½ç½®ã€é¢„æœŸæ•°å€¼å’Œæ–°å€¼ã€‚CAS çš„å®ç°é€»è¾‘æ˜¯å°†å†…å­˜ä½ç½®å¤„çš„æ•°å€¼ä¸é¢„æœŸæ•°å€¼ç›¸æ¯”è¾ƒï¼Œè‹¥ç›¸ç­‰ï¼Œåˆ™å°†å†…å­˜ä½ç½®å¤„çš„å€¼æ›¿æ¢ä¸ºæ–°å€¼ã€‚è‹¥ä¸ç›¸ç­‰ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œã€‚ï¼ˆåƒæ”¹å¯†ç éœ€è¦å…ˆéªŒè¯æ—§å¯†ç ä¸€æ ·ï¼‰</p>
<p>JVMä¸­çš„CASæ“ä½œæ­£æ˜¯åˆ©ç”¨äº†å¤„ç†å™¨æä¾›çš„CMPXCHGæŒ‡ä»¤å®ç°çš„ã€‚è‡ªæ—‹CASå®ç°çš„åŸºæœ¬æ€è·¯å°±æ˜¯å¾ªç¯è¿›è¡ŒCASæ“ä½œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p>
<p>ä»Java 1.5å¼€å§‹ï¼ŒJDKçš„å¹¶å‘åŒ…é‡Œæä¾›äº†ä¸€äº›ç±»æ¥æ”¯æŒåŸå­æ“ä½œï¼Œå¦‚AtomicBooleanï¼ˆç”¨åŸå­æ–¹å¼æ›´æ–°çš„booleanå€¼ï¼‰ã€AtomicIntegerï¼ˆç”¨åŸå­æ–¹å¼æ›´æ–°çš„intå€¼ï¼‰å’ŒAtomicLongï¼ˆç”¨åŸå­æ–¹å¼æ›´æ–°çš„longå€¼ï¼‰ã€‚è¿™äº›åŸå­åŒ…è£…ç±»è¿˜æä¾›äº†æœ‰ç”¨çš„å·¥å…·æ–¹æ³•ï¼Œæ¯”å¦‚ä»¥åŸå­çš„æ–¹å¼å°†å½“å‰å€¼è‡ªå¢1å’Œè‡ªå‡1ã€‚</p>
<p>CASä»ç„¶å­˜åœ¨<strong>ä¸‰å¤§é—®é¢˜</strong>ã€‚ABAé—®é¢˜ï¼Œå¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ï¼Œä»¥åŠåªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œã€‚</p>
<p>1ã€ABAé—®é¢˜<br>CASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™ï¼Œæ£€æŸ¥å€¼æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–åˆ™æ›´æ–°ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå€¼åŸæ¥æ˜¯Aï¼Œå˜æˆäº†Bï¼Œåˆå˜æˆäº†Aï¼Œé‚£ä¹ˆä½¿ç”¨CASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å®ƒçš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šå´å˜åŒ–äº†ã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·ã€‚åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Šç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™æŠŠç‰ˆæœ¬å·åŠ 1ï¼Œé‚£ä¹ˆAâ†’Bâ†’Aå°±ä¼šå˜æˆ1Aâ†’2Bâ†’3Aã€‚</p>
<p>ä»Java 1.5å¼€å§‹ï¼ŒJDKçš„AtomicåŒ…é‡Œæä¾›äº†ä¸€ä¸ªç±»AtomicStampedReferenceæ¥è§£å†³ABAé—®é¢˜ã€‚è¿™ä¸ªç±»çš„compareAndSetæ–¹æ³•çš„ä½œç”¨æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœå…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å¼•ç”¨å’Œè¯¥æ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚</p>
<p>2ã€å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§<br>è‡ªæ—‹CASå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</p>
<p>3ã€åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ<br>å½“å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªç¯CASçš„æ–¹å¼æ¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯CASå°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨é”ã€‚è¿˜æœ‰ä¸€ä¸ªå–å·§çš„åŠæ³•ï¼Œå°±æ˜¯æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚æ¯”å¦‚ï¼Œæœ‰ä¸¤ä¸ªå…±äº«å˜é‡iï¼2ï¼Œj&#x3D;aï¼Œåˆå¹¶ä¸€ä¸‹ij&#x3D;2aï¼Œç„¶åç”¨CASæ¥æ“ä½œijã€‚ä»Java 1.5å¼€å§‹ï¼ŒJDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯<strong>å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§</strong>ï¼Œå°±å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private AtomicInteger count = new AtomicInteger(0);</span><br><span class="line">count.incrementAndGet(); //åŸå­è‡ªå¢</span><br><span class="line">int i = count.get();</span><br><span class="line">boolean suc = count.compareAndSet(i, ++i); //cas</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨é”å®ç°åŸå­æ“ä½œ</strong></p>
<p>ä½¿ç”¨é”æœºåˆ¶å®ç°åŸå­æ“ä½œé”æœºåˆ¶ä¿è¯äº†åªæœ‰è·å¾—é”çš„çº¿ç¨‹æ‰èƒ½å¤Ÿæ“ä½œé”å®šçš„å†…å­˜åŒºåŸŸã€‚JVMå†…éƒ¨å®ç°äº†å¾ˆå¤šç§é”æœºåˆ¶ï¼Œæœ‰åå‘é”ã€è½»é‡çº§é”å’Œäº’æ–¥é”ã€‚æœ‰æ„æ€çš„æ˜¯é™¤äº†åå‘é”ï¼ŒJVMå®ç°é”çš„æ–¹å¼éƒ½ç”¨äº†å¾ªç¯CASï¼Œå³å½“ä¸€ä¸ªçº¿ç¨‹æƒ³è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ä½¿ç”¨å¾ªç¯CASçš„æ–¹å¼æ¥è·å–é”ï¼Œå½“å®ƒé€€å‡ºåŒæ­¥å—çš„æ—¶å€™ä½¿ç”¨å¾ªç¯CASé‡Šæ”¾é”ã€‚</p>
<p>å‚è€ƒï¼š<br>ä¹¦çš„ç¬”è®°ï¼š<a href="https://zhuanlan.zhihu.com/p/412363896">https://zhuanlan.zhihu.com/p/412363896</a><br>jdkä¸­çš„åŸå­æ“ä½œç±»ï¼š<a href="https://www.jianshu.com/p/a47285790467">https://www.jianshu.com/p/a47285790467</a><br>casåŸç†ã€synchronizedæ‚²è§‚é”å’Œcasä¹è§‚é”ï¼š<a href="https://www.cnblogs.com/huansky/p/15746624.html">https://www.cnblogs.com/huansky/p/15746624.html</a></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å‡ ä¸ªjavaå®ç°å¤šçº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼š<br>1ã€synchronizedåŠ é”<br>2ã€Volatileå…³é”®å­—<br>3ã€CAS</p>
<h2 id="ç¬¬ä¸‰ç« -Javaå†…å­˜æ¨¡å‹"><a href="#ç¬¬ä¸‰ç« -Javaå†…å­˜æ¨¡å‹" class="headerlink" title="ç¬¬ä¸‰ç«  Javaå†…å­˜æ¨¡å‹"></a>ç¬¬ä¸‰ç«  Javaå†…å­˜æ¨¡å‹</h2><h3 id="1-javaå†…å­˜æ¨¡å‹çš„åŸºç¡€"><a href="#1-javaå†…å­˜æ¨¡å‹çš„åŸºç¡€" class="headerlink" title="1.javaå†…å­˜æ¨¡å‹çš„åŸºç¡€"></a>1.javaå†…å­˜æ¨¡å‹çš„åŸºç¡€</h3><h4 id="âœ…å¹¶å‘ç¼–ç¨‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜"><a href="#âœ…å¹¶å‘ç¼–ç¨‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜" class="headerlink" title="âœ…å¹¶å‘ç¼–ç¨‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜"></a>âœ…å¹¶å‘ç¼–ç¨‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜</h4><p>1ã€çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼š<br>é€šä¿¡æ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´ä»¥ä½•ç§æœºåˆ¶æ¥äº¤æ¢ä¿¡æ¯<br>é€šä¿¡æœºåˆ¶æœ‰ä¸¤ç§ï¼šå…±äº«å†…å­˜å’Œæ¶ˆæ¯ä¼ é€’</p>
<p>2ã€çº¿ç¨‹ä¹‹é—´å¦‚ä½•åŒæ­¥ï¼š<br>åŒæ­¥ï¼šæŒ‡ç¨‹åºä¸­ç”¨äºæ§åˆ¶ä¸åŒçº¿ç¨‹é—´æ“ä½œå‘ç”Ÿç›¸å¯¹é¡ºåºçš„æœºåˆ¶</p>
<p>javaçš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹ï¼Œjavaçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ€»æ˜¯éšå¼è¿›è¡Œï¼Œæ•´ä¸ªè¿‡ç¨‹å¯¹ç¨‹åºå‘˜å®Œå…¨é€æ˜ã€‚</p>
<h4 id="âœ…javaå†…å­˜æ¨¡å‹"><a href="#âœ…javaå†…å­˜æ¨¡å‹" class="headerlink" title="âœ…javaå†…å­˜æ¨¡å‹"></a>âœ…javaå†…å­˜æ¨¡å‹</h4><p>å †å†…å­˜ï¼šå®ä¾‹åŸŸã€é™æ€åŸŸã€æ•°ç»„å…ƒç´ ï¼›åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚<br>æ ˆå†…å­˜ï¼šå±€éƒ¨å˜é‡ã€æ–¹æ³•å®šä¹‰å‚æ•°ã€å¼‚å¸¸å¤„ç†å™¨å‚æ•°ï¼›ä¸åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œæ²¡æœ‰å†…å­˜å¯è§æ€§é—®é¢˜ã€‚</p>
<p>Javaçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ç”±Javaå†…å­˜æ¨¡å‹(JMM)æ§åˆ¶ï¼ŒJMMå†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§</p>
<p>çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜(æŠ½è±¡æ¦‚å¿µ)ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯»&#x2F;å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚</p>
<p>JMMé€šè¿‡æ§åˆ¶ä¸»å†…å­˜ä¸æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¹‹é—´çš„äº¤äº’ï¼Œæ¥ä¸ºJavaç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯<br>ä¸¤ä¸ªçº¿ç¨‹è¦é€šä¿¡ï¼Œè¦ç»å†ä¸‹é¢2ä¸ªæ­¥éª¤ï¼š<br>çº¿ç¨‹AæŠŠæœ¬åœ°å†…å­˜Aä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­å»ã€‚<br>çº¿ç¨‹Båˆ°ä¸»å†…å­˜ä¸­å»è¯»å–çº¿ç¨‹Aä¹‹å‰å·²æ›´æ–°è¿‡çš„å…±äº«å˜é‡</p>
<h4 id="âœ…ä»æºä»£ç åˆ°æŒ‡ä»¤åºåˆ—çš„é‡æ’åº"><a href="#âœ…ä»æºä»£ç åˆ°æŒ‡ä»¤åºåˆ—çš„é‡æ’åº" class="headerlink" title="âœ…ä»æºä»£ç åˆ°æŒ‡ä»¤åºåˆ—çš„é‡æ’åº"></a>âœ…ä»æºä»£ç åˆ°æŒ‡ä»¤åºåˆ—çš„é‡æ’åº</h4><p>åœ¨æ‰§è¡Œç¨‹åºæ—¶ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’åº</p>
<p>é‡æ’åºåˆ†3ç§ç±»å‹ï¼Œç¬¬ä¸€ç§å±äºç¼–è¯‘å™¨é‡æ’ï¼Œåä¸¤ç§å±äºå¤„ç†å™¨é‡æ’ï¼š<br>ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åº<br>æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åº<br>å†…å­˜ç³»ç»Ÿçš„é‡æ’åº</p>
<p>JMMé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼ˆæ’å…¥ç‰¹å®šç±»å‹çš„å†…å­˜å±éšœï¼‰ï¼Œæä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p>
<p>å¤„ç†å™¨åˆ©ç”¨å†™ç¼“å†²åŒºæ¥ä¸´æ—¶ä¿å­˜å‘å†…å­˜å†™å…¥çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œç”±äºå†™ç¼“å†²åŒºä»…å¯¹è‡ªå·±çš„å¤„ç†å™¨å¯è§ï¼Œå®ƒä¼šå¯¼è‡´å¤„ç†å™¨æ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºå¯èƒ½ä¼šä¸å†…å­˜å®é™…çš„æ“ä½œæ‰§è¡Œé¡ºåºä¸ä¸€è‡´ã€‚ä¾‹å¦‚a&#x3D;1ï¼Œå…ˆå†™åœ¨ç¼“å†²åŒºï¼Œç„¶åä¸‹ä¸€ä¸ªè¯­å¥ç”¨äº†aï¼Œç„¶åç¼“å†²åŒºæ‰å°†a&#x3D;1å†™å…¥ä¸»å†…å­˜ã€‚è¿™å°±ç®—é‡æ’åºäº†ã€‚</p>
<h4 id="âœ…happens-before"><a href="#âœ…happens-before" class="headerlink" title="âœ…happens-before"></a>âœ…happens-before</h4><p>JMMä¸­ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»è¦å­˜åœ¨happens-beforeå…³ç³»ï¼ˆä¸€ç§é˜è¿°å†…å­˜å¯è§æ€§çš„æ¦‚å¿µï¼‰ã€‚å°±æ˜¯è¦æ±‚å‰ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå¯¹åä¸€ä¸ªæ“ä½œå¯è§ã€‚å¹¶ä¸æ„å‘³ç€æ“ä½œAå°±ä¸€å®šåœ¨æ“ä½œBä¹‹å‰æ‰§è¡Œã€‚</p>
<p>ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œã€‚<br>ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”ï¼Œhappens-beforeäºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚<br>volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™ï¼Œhappens-beforeäºä»»æ„åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»</p>
<h3 id="2-é‡æ’åº"><a href="#2-é‡æ’åº" class="headerlink" title="2.é‡æ’åº"></a>2.é‡æ’åº</h3><p>é‡æ’åºæ˜¯æŒ‡ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œå¯¹æŒ‡ä»¤åºåˆ—è¿›è¡Œé‡æ–°æ’åºçš„ä¸€ç§æ‰‹æ®µ</p>
<h4 id="âœ…æ•°æ®ä¾èµ–æ€§"><a href="#âœ…æ•°æ®ä¾èµ–æ€§" class="headerlink" title="âœ…æ•°æ®ä¾èµ–æ€§"></a>âœ…æ•°æ®ä¾èµ–æ€§</h4><p>å¦‚æœä¸¤ä¸ªæ“ä½œè®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œä¸”è¿™ä¸¤ä¸ªæ“ä½œä¸­æœ‰ä¸€ä¸ªä¸ºå†™æ“ä½œï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å°±å­˜åœ¨æ•°æ®ä¾èµ–æ€§ã€‚<br>æ•°æ®ä¾èµ–å¯åˆ†ä¸ºï¼šè¯»åå†™ã€å†™åè¯»ã€å†™åå†™ã€‚</p>
<p>ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šæ”¹å˜å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚</p>
<p>æ•°æ®ä¾èµ–æ€§ä»…é’ˆå¯¹å•ä¸ªå¤„ç†å™¨ä¸­æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—å’Œå•ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œï¼Œä¸åŒå¤„ç†å™¨ä¹‹é—´å’Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ä¸è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨è€ƒè™‘</p>
<h4 id="âœ…as-if-serialè¯­ä¹‰"><a href="#âœ…as-if-serialè¯­ä¹‰" class="headerlink" title="âœ…as-if-serialè¯­ä¹‰"></a>âœ…as-if-serialè¯­ä¹‰</h4><p>ä¸€ä¸ªæ¦‚å¿µï¼Œæ„æ€æ˜¯ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼Œå•çº¿ç¨‹çš„ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜</p>
<p>ä¸ºäº†éµå®ˆas-if-serialè¯­ä¹‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºã€‚</p>
<p>æ„æ€å°±æ˜¯ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å•çº¿ç¨‹çš„å¹¶è¡Œåº¦ï¼Œä¼šå¯¹æ²¡æœ‰ä¾èµ–å…³ç³»çš„æ“ä½œé‡æ’åºï¼Œä½†æ˜¯ä¸å½±å“ç»“æœå’Œå¯è§æ€§ã€‚</p>
<h4 id="âœ…é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“"><a href="#âœ…é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“" class="headerlink" title="âœ…é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“"></a>âœ…é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class ReorderExample &#123;</span><br><span class="line">    int a = 0;</span><br><span class="line">    boolean flag = false;</span><br><span class="line">    public void writer() &#123;</span><br><span class="line">        a = 1; // 1</span><br><span class="line">        flag = true; // 2</span><br><span class="line">    &#125;</span><br><span class="line">    Public void reader() &#123;</span><br><span class="line">        if (flag) &#123; // 3</span><br><span class="line">        int i = a * a; // 4</span><br><span class="line">    â€¦â€¦</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸¤ä¸ªçº¿ç¨‹Aå’ŒBï¼ŒAé¦–å…ˆæ‰§è¡Œwriter()æ–¹æ³•ï¼ŒéšåBçº¿ç¨‹æ¥ç€æ‰§è¡Œreader()æ–¹æ³•.</p>
<p>æ“ä½œ1å’Œæ“ä½œ2æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œä¸”æ“ä½œ3å’Œæ“ä½œ4æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¹Ÿå¯ä»¥å¯¹è¿™ä¸¤å¯¹æ“ä½œé‡æ’åº.</p>
<p>å¯¹çº¿ç¨‹Açš„ä¸¤ä¸ªæ“ä½œè¿›è¡Œé‡æ’åºï¼š<br>1ã€çº¿ç¨‹Aé¦–å…ˆå†™æ ‡è®°å˜é‡flag<br>2ã€éšåçº¿ç¨‹Bè¯»è¿™ä¸ªå˜é‡ã€‚ç”±äºæ¡ä»¶åˆ¤æ–­ä¸ºçœŸï¼Œçº¿ç¨‹Bå°†è¯»å–å˜é‡a<br>3ã€æ­¤æ—¶ï¼Œå˜é‡aè¿˜æ²¡æœ‰è¢«çº¿ç¨‹Aå†™å…¥ï¼Œå¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰è¢«é‡æ’åºç ´å</p>
<p>å¯¹çº¿ç¨‹Bçš„ä¸¤ä¸ªæ“ä½œè¿›è¡Œé‡æ’åºï¼š<br>1ã€ç”±äºæ“ä½œ3å’Œæ“ä½œ4å­˜åœ¨æ§åˆ¶ä¾èµ–å…³ç³»ï¼Œæ‰§è¡Œçº¿ç¨‹Bçš„å¤„ç†å™¨å¯æå‰è¯»å–å¹¶è®¡ç®—a*a<br>2ã€ç„¶åæŠŠè®¡ç®—ç»“æœä¸´æ—¶ä¿å­˜åˆ°ä¸€ä¸ªåä¸ºé‡æ’åºç¼“å†²(Reorder Bufferï¼ŒROB)çš„ç¡¬ä»¶ç¼“å­˜ä¸­<br>3ã€å½“æ“ä½œ3çš„æ¡ä»¶åˆ¤æ–­ä¸ºçœŸæ—¶ï¼Œå°±æŠŠè¯¥è®¡ç®—ç»“æœå†™å…¥å˜é‡iä¸­ï¼Œå¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰è¢«é‡æ’åºç ´å</p>
<h3 id="3-é¡ºåºä¸€è‡´æ€§"><a href="#3-é¡ºåºä¸€è‡´æ€§" class="headerlink" title="3.é¡ºåºä¸€è‡´æ€§"></a>3.é¡ºåºä¸€è‡´æ€§</h3><p>æ•°æ®ç«äº‰çš„å®šä¹‰ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å†™ä¸€ä¸ªå˜é‡ï¼Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¯»åŒä¸€ä¸ªå˜é‡ï¼Œè€Œä¸”å†™å’Œè¯»æ²¡æœ‰é€šè¿‡åŒæ­¥æ¥æ’åº</p>
<p>é¡ºåºä¸€è‡´æ€§ï¼šå¦‚æœç¨‹åºæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼Œç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§(å³ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒ)ã€æ˜¯ä¸€ä¸ªç†æƒ³åŒ–çš„æ¦‚å¿µã€‘</p>
<h4 id="âœ…é¡ºåºä¸€è‡´æ€§æ¨¡å‹"><a href="#âœ…é¡ºåºä¸€è‡´æ€§æ¨¡å‹" class="headerlink" title="âœ…é¡ºåºä¸€è‡´æ€§æ¨¡å‹"></a>âœ…é¡ºåºä¸€è‡´æ€§æ¨¡å‹</h4><p>åœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ï¼ˆç†è®ºå‚è€ƒæ¨¡å‹ï¼‰ä¸­ï¼ˆä¸ç®¡æœ‰æ²¡æœ‰åŒæ­¥ï¼‰ï¼š<br>ä»»æ„æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿æ¥åˆ°å†…å­˜ã€‚<br>ä¸€ä¸ªçº¿ç¨‹çš„æ‰€æœ‰æ“ä½œæŒ‰ç¨‹åºçš„é¡ºåºä¸²è¡Œæ‰§è¡Œã€‚<br>æ¯ä¸ªæ“ä½œå¿…é¡»ç«‹å³å¯¹ä»»æ„çº¿ç¨‹å¯è§ã€‚<br>æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªä¸€è‡´çš„æ•´ä½“æ‰§è¡Œé¡ºåºã€‚</p>
<blockquote>
<p>JMMä¸­æ²¡æœ‰ä¸Šè¿°ä¿è¯ã€‚æœªåŒæ­¥ç¨‹åºåœ¨JMMä¸­ä¸ä½†æ•´ä½“çš„æ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ï¼Œè€Œä¸”æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œæ‰§è¡Œé¡ºåºä¹Ÿå¯èƒ½ä¸ä¸€è‡´</p>
</blockquote>
<h4 id="âœ…åŒæ­¥ç¨‹åºçš„æ‰§è¡Œæ•ˆæœ"><a href="#âœ…åŒæ­¥ç¨‹åºçš„æ‰§è¡Œæ•ˆæœ" class="headerlink" title="âœ…åŒæ­¥ç¨‹åºçš„æ‰§è¡Œæ•ˆæœ"></a>âœ…åŒæ­¥ç¨‹åºçš„æ‰§è¡Œæ•ˆæœ</h4><p>åœ¨JMMä¸­ï¼Œä¸´ç•ŒåŒºï¼ˆä¸€ä¸ªåŒæ­¥å—å„¿ï¼‰å†…çš„ä»£ç å¯ä»¥é‡æ’åº(å› ä¸ºJMMç›®çš„æ˜¯åœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½ä¼˜åŒ–ç¼–è¯‘å™¨å’Œå¤„ç†å™¨)ã€‚</p>
<p>ç»“æœæ˜¯ï¼šé‡æ’åºæé«˜äº†æ‰§è¡Œæ•ˆç‡ï¼Œè€Œä¸”æ²¡æœ‰æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚</p>
<h4 id="âœ…æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œæ•ˆæœ"><a href="#âœ…æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œæ•ˆæœ" class="headerlink" title="âœ…æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œæ•ˆæœ"></a>âœ…æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œæ•ˆæœ</h4><p>JMMä¸ä¿è¯æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœä¸€è‡´ï¼ˆä¸€è‡´ä¹Ÿæ²¡æ„ä¹‰ï¼‰ã€‚å› ä¸ºå¦‚æœæƒ³è¦ä¿è¯æ‰§è¡Œç»“æœä¸€è‡´ï¼ŒJMMéœ€è¦ç¦æ­¢å¤§é‡çš„å¤„ç†å™¨å’Œç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œè¿™å¯¹ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ä¼šäº§ç”Ÿå¾ˆå¤§çš„å½±å“ã€‚</p>
<p>JMMä¸ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºé¡ºåºæ‰§è¡Œã€‚æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œé¡ºåºå¯èƒ½ä¸ä¸€è‡´ã€‚æ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯ï¼š2-3-4-1ï¼Œè¯­ä¹‰è¢«ç ´åã€‚å¯èƒ½æ˜¯4çš„å³è¾¹-1-2-3-4çš„å·¦è¾¹ï¼Œè¯­ä¹‰è¢«ç ´åã€‚</p>
<h4 id="âœ…å¤„ç†å™¨æ€»çº¿äº‹åŠ¡"><a href="#âœ…å¤„ç†å™¨æ€»çº¿äº‹åŠ¡" class="headerlink" title="âœ…å¤„ç†å™¨æ€»çº¿äº‹åŠ¡"></a>âœ…å¤„ç†å™¨æ€»çº¿äº‹åŠ¡</h4><p>æ€»çº¿äº‹åŠ¡åŒ…æ‹¬è¯»äº‹åŠ¡ï¼ˆå†…å­˜-å¤„ç†å™¨ï¼‰å’Œå†™äº‹åŠ¡ï¼ˆå¤„ç†å™¨-å†…å­˜ï¼‰ï¼Œä¸­é—´éƒ½è¦é€šè¿‡æ€»çº¿ï¼Œæ€»çº¿ä¼šåŒæ­¥è¯•å›¾å¹¶å‘ä½¿ç”¨æ€»çº¿çš„äº‹åŠ¡ï¼Œä¸€æ¬¡åªæœ‰ä¸€ä¸ªäº‹åŠ¡å¯ä»¥æ“ä½œæ€»çº¿è®¿é—®å†…å­˜ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸€æ¬¡æœ€å¤šåªæœ‰ä¸€ä¸ªå¤„ç†å™¨å¯ä»¥è®¿é—®å†…å­˜ï¼Œè¿™ä¿è¯äº†å•ä¸ªæ€»çº¿äº‹åŠ¡ä¹‹ä¸­çš„å†…å­˜è¯»å†™ï¼ˆè¯»è·Ÿå†™ï¼Œä¸æ˜¯i++ï¼‰å…·æœ‰åŸå­æ€§ã€‚</p>
<p>ä½†æ˜¯ï¼š32ä½çš„å¤„ç†å™¨ä¸Šï¼Œå¯¹longå‹å’Œdoubleå‹è¿™ä¿©64ä½çš„æ•°æ®çš„å†™æ“ä½œæ‹†åˆ†æˆäº†ä¸¤ä¸ªå†™äº‹åŠ¡ï¼Œä¼šåˆ†é…åœ¨ä¸åŒçš„æ€»çº¿äº‹åŠ¡ä¸­æ‰§è¡Œã€‚æ‰€ä»¥ä¸å…·æœ‰åŸå­æ€§ã€‚</p>
<h3 id="4-volatileçš„å†…å­˜è¯­ä¹‰"><a href="#4-volatileçš„å†…å­˜è¯­ä¹‰" class="headerlink" title="4.volatileçš„å†…å­˜è¯­ä¹‰"></a>4.volatileçš„å†…å­˜è¯­ä¹‰</h3><h4 id="âœ…volatileçš„ç‰¹æ€§ï¼š"><a href="#âœ…volatileçš„ç‰¹æ€§ï¼š" class="headerlink" title="âœ…volatileçš„ç‰¹æ€§ï¼š"></a>âœ…volatileçš„ç‰¹æ€§ï¼š</h4><p>1ã€å¯è§æ€§ï¼šå¯¹volatileå˜é‡çš„å•ä¸ªè¯»å†™ï¼Œç›¸å½“äºæ˜¯ç”¨åŒä¸€ä¸ªé”å¯¹å•ä¸ªè¯»å†™æ–¹æ³•åšäº†åŒæ­¥ã€‚å¯¹volatileå˜é‡çš„è¯»ï¼Œæ€»èƒ½çœ‹åˆ°æœ€åçš„å†™å…¥ã€‚è¢«volatileä¿®é¥°çš„å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹æ€»æ˜¯ç«‹å³å¯è§çš„ï¼Œå¯¹volatileå˜é‡çš„æ‰€æœ‰å†™æ“ä½œæ€»æ˜¯èƒ½ç«‹åˆ»ååº”åˆ°å…¶ä»–çº¿ç¨‹ä¸­ã€‚</p>
<p>2ã€åŸå­æ€§ï¼šå¯¹å•ä¸ªvolatileå˜é‡çš„è¯»å†™ï¼ˆ64ä½çš„longå’Œdoubleç±»å‹ä¹Ÿæ˜¯ï¼‰å…·æœ‰åŸå­æ€§ï¼Œvolatile++çš„å¤åˆæ“ä½œä¸å…·æœ‰åŸå­æ€§ã€‚</p>
<h4 id="âœ…volatileå˜é‡è¯»å†™å®ç°çº¿ç¨‹ä¹‹é—´é€šä¿¡"><a href="#âœ…volatileå˜é‡è¯»å†™å®ç°çº¿ç¨‹ä¹‹é—´é€šä¿¡" class="headerlink" title="âœ…volatileå˜é‡è¯»å†™å®ç°çº¿ç¨‹ä¹‹é—´é€šä¿¡"></a>âœ…volatileå˜é‡è¯»å†™å®ç°çº¿ç¨‹ä¹‹é—´é€šä¿¡</h4><p>volatileå˜é‡çš„å†™ã€è¯»ï¼Œä¸é”çš„é‡Šæ”¾ã€è·å–æœ‰ç›¸åŒçš„å†…å­˜æ•ˆæœã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int a = 0;</span><br><span class="line">volatile boolean flag = false;</span><br><span class="line"></span><br><span class="line">public void writer() &#123;</span><br><span class="line">    a = 1;//1</span><br><span class="line">    flag = true;//2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void reader() &#123;</span><br><span class="line">    if (flag) &#123;  //3</span><br><span class="line">        int i = a; //4</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1 happens-before 2  (æ‰§è¡Œé¡ºåºå¯èƒ½åœ¨ä¸€ä¸ªä¸´ç•ŒåŒºå†…é‡æ’åº)<br>3 happens-before 4<br>2 happens-before 3 ï¼ˆvolatileå¸¦æ¥çš„ï¼‰<br>so: 1 happens-before 4</p>
<p>ç–‘é—®ï¼š1.2æ²¡æœ‰æ•°æ®ä¾èµ–ï¼Œå¯èƒ½è¢«é‡æ’åºã€‚<br>æŒ‡ä»¤é‡æ’ä½¿å¾—æ‰§è¡Œé¡ºåºä¸ä¼šå˜æˆï¼š2-3-4-1 å—ï¼Ÿ ä¸‹é¢ç»™ç­”æ¡ˆã€‚</p>
<h4 id="âœ…volatileå†™è¯»çš„å†…å­˜è¯­ä¹‰"><a href="#âœ…volatileå†™è¯»çš„å†…å­˜è¯­ä¹‰" class="headerlink" title="âœ…volatileå†™è¯»çš„å†…å­˜è¯­ä¹‰"></a>âœ…volatileå†™è¯»çš„å†…å­˜è¯­ä¹‰</h4><p>çº¿ç¨‹ - æœ¬åœ°å†…å­˜ - ä¸»å†…å­˜</p>
<p>1ã€å½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠçº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡ï¼ˆé‚£ä¸ªaï¼‰å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ï¼ˆå®è´¨å°±æ˜¯Aå‘æ¥ä¸‹æ¥è¦è¯»è¿™ä¸ªvolatileå˜é‡çš„æŸä¸ªçº¿ç¨‹å‘å‡ºäº†æ¶ˆæ¯ï¼ˆæˆ‘å¯¹å…±äº«å˜é‡åšå‡ºçš„ä¿®æ”¹ï¼‰ï¼‰</p>
<p>2ã€å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚çº¿ç¨‹æ¥ä¸‹æ¥å°†ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚ï¼ˆå®è´¨å°±æ˜¯æ¥å—äº†ä¹‹å‰æŸä¸ªçº¿ç¨‹å‘å‡ºçš„æ¶ˆæ¯ï¼‰</p>
<p>3ã€Aå†™ï¼ŒBè¯»ï¼Œå®è´¨å°±æ˜¯Aé€šè¿‡ä¸»å†…å­˜å‘Bå‘é€æ¶ˆæ¯ï¼Œå®ç°çº¿ç¨‹ä¹‹é—´é€šä¿¡</p>
<h4 id="âœ…volatileå†…å­˜è¯­ä¹‰çš„å®ç°-ç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚"><a href="#âœ…volatileå†…å­˜è¯­ä¹‰çš„å®ç°-ç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚" class="headerlink" title="âœ…volatileå†…å­˜è¯­ä¹‰çš„å®ç°-ç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚"></a>âœ…volatileå†…å­˜è¯­ä¹‰çš„å®ç°-ç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚</h4><p>èƒŒæ™¯ï¼šä¸Šé¢å®ç°çº¿ç¨‹é—´é€šä¿¡é‚£ä¸€å°èŠ‚ï¼Œç–‘æƒ‘çš„æ˜¯1.2æ˜¯ä¸æ˜¯èƒ½é‡æ’åºï¼Œ3.4æ˜¯ä¸æ˜¯èƒ½é‡æ’åºã€‚åœ¨è¿™é‡Œç»™å‡ºç­”æ¡ˆï¼Œ</p>
<p>ä¸ºäº†å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼ŒJMMä¼šé™åˆ¶é‡æ’åºç±»å‹ã€‚</p>
<p>1ã€å½“ç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileå†™æ—¶ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿volatileå†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ°å†™ä¹‹åã€‚</p>
<p>2ã€å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileè¯»æ—¶ï¼Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿volatileè¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ°è¯»ä¹‹å‰ã€‚</p>
<p>3ã€å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileå†™æ—¶ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileè¯»æ—¶ï¼Œä¸èƒ½é‡æ’åºã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•å®ç°é™åˆ¶æŒ‡ä»¤é‡æ’ï¼Ÿ<br>ä¸ºäº†å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚<br>å°½ç®¡å†…å­˜å±éšœä¼šé™ä½æ•ˆç‡ï¼Œä½†æ˜¯JMM åœ¨å®ç°ä¸Šçš„ä¸€ä¸ªç‰¹ç‚¹ï¼šé¦–å…ˆç¡®ä¿æ­£ç¡®æ€§ï¼Œç„¶åå†å»è¿½æ±‚æ‰§è¡Œæ•ˆç‡ã€‚</p>
<h4 id="âœ…JSR-133å¢å¼ºvolatileçš„å†…å­˜è¯­ä¹‰"><a href="#âœ…JSR-133å¢å¼ºvolatileçš„å†…å­˜è¯­ä¹‰" class="headerlink" title="âœ…JSR-133å¢å¼ºvolatileçš„å†…å­˜è¯­ä¹‰"></a>âœ…JSR-133å¢å¼ºvolatileçš„å†…å­˜è¯­ä¹‰</h4><p>Javaå†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªé›„å¿ƒå‹ƒå‹ƒçš„è®¡åˆ’ï¼Œå®ƒæ˜¯ç¼–ç¨‹è¯­è¨€è§„èŒƒç¬¬ä¸€æ¬¡å°è¯•åˆå¹¶ä¸€ä¸ªèƒ½å¤Ÿåœ¨å„ç§å¤„ç†å™¨æ¶æ„ä¸­ä¸ºå¹¶å‘æä¾›ä¸€è‡´è¯­ä¹‰çš„å†…å­˜æ¨¡å‹ã€‚ä¸è¿‡ï¼Œå®šä¹‰ä¸€ä¸ªæ—¢ä¸€è‡´åˆç›´è§‚çš„å†…å­˜æ¨¡å‹è¿œæ¯”æƒ³è±¡è¦æ›´éš¾ã€‚JSR133ä¸ºJavaè¯­è¨€å®šä¹‰äº†ä¸€ä¸ªæ–°çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒä¿®å¤äº†æ—©æœŸå†…å­˜æ¨¡å‹ä¸­çš„ç¼ºé™·ã€‚ä¸ºäº†å®ç°JSR133ï¼Œfinalå’Œvolatileçš„è¯­ä¹‰éœ€è¦é‡æ–°å®šä¹‰ã€‚</p>
<p>æ—§çš„å†…å­˜æ¨¡å‹ä¸­ï¼Œvolatileçš„å†™è¯»æ²¡æœ‰é”çš„é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰ï¼Œä¹Ÿå°±æ˜¯å®ç°çº¿ç¨‹ä¹‹é—´é€šä¿¡é‚£ä¸€å°èŠ‚é‡Œï¼Œä¼šæŒ‡ä»¤é‡æ’ã€‚</p>
<p>JSR-133ï¼Œä¸¥æ ¼é™åˆ¶ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹volatileå˜é‡ä¸æ™®é€šå˜é‡çš„é‡æ’åºï¼Œç¡®ä¿äº†volatileçš„å†™è¯»æœ‰é”çš„é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰ã€‚</p>
<p>volatileä¸é”å¯¹æ¯”ï¼š<br>é”åœ¨åŠŸèƒ½ä¸Šæ¯”volatileæ›´å¼ºå¤§ï¼Œå¯ä»¥ç¡®ä¿æ•´ä¸ªä¸´ç•ŒåŒºä»£ç å…·æœ‰åŸå­æ€§ã€‚volatileåªèƒ½å¯¹å•ä¸ªvolatileå˜é‡è¯»å†™å…·æœ‰åŸå­æ€§ã€‚ï¼ˆæ‰€ä»¥ä¸èƒ½å•çº¯ç”¨volatileå®ç°è®¡æ•°å™¨ï¼‰<br>åœ¨å¯ä¼¸ç¼©æ€§å’Œæ‰§è¡Œæ€§èƒ½ä¸Šï¼Œvolatileæ›´å…·æœ‰ä¼˜åŠ¿ã€‚</p>
<h3 id="5-é”çš„å†…å­˜è¯­ä¹‰"><a href="#5-é”çš„å†…å­˜è¯­ä¹‰" class="headerlink" title="5.é”çš„å†…å­˜è¯­ä¹‰"></a>5.é”çš„å†…å­˜è¯­ä¹‰</h3><p>è¾¾åˆ°æ•ˆæœï¼šçº¿ç¨‹Aåœ¨é‡Šæ”¾é”ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨çº¿ç¨‹Bè·å–åŒä¸€ä¸ªé”ä¹‹åï¼Œå°†ç«‹å³å˜å¾—å¯¹Bçº¿ç¨‹å¯è§ã€‚</p>
<h4 id="âœ…é”é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰"><a href="#âœ…é”é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰" class="headerlink" title="âœ…é”é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰"></a>âœ…é”é‡Šæ”¾å’Œè·å–çš„å†…å­˜è¯­ä¹‰</h4><p>1ã€å½“çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ï¼ˆå®è´¨ä¸Šæ˜¯çº¿ç¨‹Aå‘æ¥ä¸‹æ¥è¦è·å–è¿™ä¸ªé”çš„æŸä¸ªçº¿ç¨‹å‘å‡ºäº†ï¼ˆçº¿ç¨‹Aå¯¹å…±äº«å˜é‡æ‰€åšä¿®æ”¹çš„ï¼‰æ¶ˆæ¯ã€‚ï¼‰</p>
<p>2ã€å½“çº¿ç¨‹è·å–é”æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚ä»è€Œä½¿å¾—è¢«ç›‘è§†å™¨é”ä¿æŠ¤çš„ä¸´ç•ŒåŒºä»£ç å¿…é¡»ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚ï¼ˆå®è´¨ä¸Šæ˜¯çº¿ç¨‹Bæ¥å—äº†ä¹‹å‰æŸä¸ªçº¿ç¨‹å‘å‡ºçš„ï¼ˆåœ¨é‡Šæ”¾è¿™ä¸ªé”å¯¹å…±äº«å˜é‡é”åšçš„ä¿®æ”¹çš„ï¼‰æ¶ˆæ¯ã€‚ï¼‰</p>
<p>3ã€çº¿ç¨‹Aé‡Šæ”¾é”ï¼Œéšåçº¿ç¨‹Bè·å–è¿™ä¸ªé”ï¼Œè¿™ä¸ªè¿‡ç¨‹å®è´¨ä¸Šæ˜¯çº¿ç¨‹Aé€šè¿‡ä¸»å†…å­˜å‘çº¿ç¨‹Bå‘é€æ¶ˆæ¯ã€‚</p>
<h4 id="âœ…é”å†…å­˜è¯­ä¹‰çš„å®ç°"><a href="#âœ…é”å†…å­˜è¯­ä¹‰çš„å®ç°" class="headerlink" title="âœ…é”å†…å­˜è¯­ä¹‰çš„å®ç°"></a>âœ…é”å†…å­˜è¯­ä¹‰çš„å®ç°</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ReentrantLock lock = new ReentrantLock();</span><br><span class="line">lock.lock();                 // è·å–é”</span><br><span class="line">try &#123;</span><br><span class="line">    a++;</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    lock.unlock();          // é‡Šæ”¾é”</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ReentrantLockçš„å®ç°ä¾èµ–äºJavaåŒæ­¥å™¨æ¡†æ¶AbstractQueuedSynchronized(AQS) ã€‚AQSä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„volatileå˜é‡ï¼ˆstateï¼‰æ¥ç»´æŠ¤åŒæ­¥çŠ¶æ€ï¼Œè¿™ä¸ªvolatileå˜é‡æ˜¯ReentrantLockå†…å­˜è¯­ä¹‰å®ç°çš„å…³é”®ã€‚</p>
<p><strong>å…¬å¹³é”ï¼š</strong></p>
<p>åŠ é”æ–¹æ³•é¦–å…ˆè¯»å–volatileå˜é‡stateã€‚<br>é‡Šæ”¾é”çš„æœ€åå†™volatileå˜é‡stateã€‚</p>
<p>æ•ˆæœï¼šé‡Šæ”¾é”çš„çº¿ç¨‹åœ¨å†™volatileå˜é‡ä¹‹å‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨è·å–é”çš„çº¿ç¨‹è¯»å–åˆ°åŒä¸€ä¸ªvolatileå˜é‡åå°†ç«‹å³å˜å¾—å¯¹è·å–é”çš„çº¿ç¨‹å¯è§ã€‚</p>
<p><strong>éå…¬å¹³é”ï¼š</strong></p>
<p>éå…¬å¹³é”çš„é‡Šæ”¾å’Œå…¬å¹³é”çš„é‡Šæ”¾å®Œå…¨ä¸€è‡´ã€‚</p>
<p>åŠ é”ï¼šç”¨äº†ï¼š<code>unsafe.compareAndSwapInt(this, stateOffset, expect, update);</code></p>
<p>è¯¥æ–¹æ³•ä»¥åŸå­æ“ä½œçš„æ–¹å¼æ›´æ–°stateå˜é‡ï¼Œä¹Ÿå°±æ˜¯compareAndSet() (CAS)æ“ä½œã€‚JDKæ–‡æ¡£å¯¹è¯¥æ–¹æ³•è¯´æ˜å¦‚ä¸‹ï¼šå¦‚æœå½“å‰çŠ¶æ€å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼åŒæ­¥çŠ¶æ€è®¾ç½®ä¸ºç»™å®šæ›´æ–°çš„å€¼ã€‚æ­¤æ“ä½œå…·æœ‰volatileè¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰ã€‚<br>ï¼ˆç¼–è¯‘å™¨ä¸èƒ½å¯¹CASä¸CASå‰é¢å’Œåé¢ä»»æ„å†…å­˜æ“ä½œé‡æ’åºã€‚ï¼‰</p>
<p>CASå…·æœ‰volatileè¯»å†™å†…å­˜è¯­ä¹‰çš„å®ç°æ–¹å¼ï¼šlockå‰ç¼€<br>intelæ‰‹å†Œå¯¹lockå‰ç¼€çš„è¯´æ˜ï¼š<br>å¯¹å†…å­˜çš„è¯»-æ”¹-å†™æ“ä½œåŸå­æ‰§è¡Œã€‚ï¼ˆæ€»çº¿é”å®š&#x2F;ç¼“å­˜é”å®šï¼‰<br>ç¦æ­¢è¯¥æŒ‡ä»¤ï¼Œä¸ä¹‹å‰çš„è¯»å’Œå†™æŒ‡ä»¤é‡æ’åº<br>æŠŠå†™ç¼“å†²åŒºçš„æ‰€æœ‰æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­<br>ä¸Šé¢çš„2ã€3ä¸¤ç‚¹æ‰€å…·æœ‰çš„å†…å­˜å±éšœçš„æ•ˆæœï¼Œè¶³ä»¥åŒæ—¶å®ç°volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰ã€‚æ‰€ä»¥JDKæ–‡æ¡£è¯´CAS å…·æœ‰volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰å¯¹äºå¤„ç†å™¨ä¹Ÿæ˜¯ç¬¦åˆçš„ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong><br>é‡Šæ”¾é”-è·å–é”çš„å†…å­˜è¯­ä¹‰çš„å®ç°æ–¹å¼æ€»ç»“ ï¼š<br>åˆ©ç”¨volatileå˜é‡çš„å†™-è¯»æ‰€å…·æœ‰çš„å†…å­˜è¯­ä¹‰<br>åˆ©ç”¨CASæ‰€é™„å¸¦çš„volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰</p>
<h4 id="âœ…concurrentåŒ…çš„å®ç°"><a href="#âœ…concurrentåŒ…çš„å®ç°" class="headerlink" title="âœ…concurrentåŒ…çš„å®ç°"></a>âœ…concurrentåŒ…çš„å®ç°</h4><p>Javaçš„CASä¼šä½¿ç”¨ç°ä»£å¤„ç†å™¨ä¸Šæä¾›çš„é«˜æ•ˆæœºå™¨çº§åˆ«çš„åŸå­æŒ‡ä»¤ï¼Œè¿™äº›åŸå­æŒ‡ä»¤ä»¥åŸå­æ–¹å¼å¯¹å†…å­˜æ‰§è¡Œè¯»-æ”¹-å†™æ“ä½œï¼Œè¿™æ˜¯åœ¨å¤šå¤„ç†å™¨å®ç°åŒæ­¥çš„å…³é”®ã€‚åŒæ—¶volatileå˜é‡çš„è¯»&#x2F;å†™å’ŒCASå¯ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚è¿™äº›ç‰¹æ€§å°±æ˜¯Javaæ•´ä¸ªconcurrentåŒ…çš„åŸºçŸ³ã€‚</p>
<p>concurrentåŒ…çš„é€šç”¨åŒ–å®ç°æ¨¡å¼ï¼š<br>1ã€å£°æ˜å…±äº«å˜é‡volatile<br>2ã€ä½¿ç”¨CASçš„åŸå­æ¡ä»¶æ›´æ–°æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥<br>3ã€é…åˆvolatileçš„è¯»&#x2F;å†™å’ŒCASå…·æœ‰çš„volatileè¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</p>
<p>AQSï¼ˆjava.util.concurrent.locks.AbstractQueuedSynchronizerï¼‰ã€éé˜»å¡æ•°æ®ç»“æ„å’ŒåŸå­å˜é‡ç±»ï¼ˆjava.util.concurrent.atomicåŒ…ä¸­çš„ç±»ï¼‰ï¼Œè¿™äº›concurrentåŒ…ä¸­åŸºç¡€ç±»éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªæ¨¡å¼æ¥å®ç°çš„ï¼Œè€ŒconcurrentåŒ…ä¸­çš„é«˜å±‚ç±»åˆæ˜¯ä¾èµ–äºè¿™äº›åŸºç¡€ç±»ã€‚</p>
<p>å›¾ç¤ºconcurrentåŒ…çš„å®ç°ç¤ºæ„å›¾ï¼š</p>
<p><img src="/images/concurrent%E5%8C%85.png"></p>
<h3 id="6-finalåŸŸçš„å†…å­˜è¯­ä¹‰"><a href="#6-finalåŸŸçš„å†…å­˜è¯­ä¹‰" class="headerlink" title="6.finalåŸŸçš„å†…å­˜è¯­ä¹‰"></a>6.finalåŸŸçš„å†…å­˜è¯­ä¹‰</h3><p>æ–‡ä¸­æ¢è®¨çš„å˜é‡å¯¹çº¿ç¨‹å¯è§ï¼Œæ˜¯ä¿è¯çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼Œå¦‚æœä¸å¯è§ï¼Œé‚£å°±è¦åŒæ­¥åŠ é”ï¼Œåè¨€ä¹‹ï¼ŒåŠ é”ä¹Ÿæ˜¯ä¸ºäº†å˜é‡å¯¹çº¿ç¨‹å¯è§ã€‚</p>
<h4 id="âœ…finalåŸŸçš„é‡æ’åºè§„åˆ™"><a href="#âœ…finalåŸŸçš„é‡æ’åºè§„åˆ™" class="headerlink" title="âœ…finalåŸŸçš„é‡æ’åºè§„åˆ™"></a>âœ…finalåŸŸçš„é‡æ’åºè§„åˆ™</h4><p>å¯¹äºfinalåŸŸï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨è¦éµå®ˆä¸¤ä¸ªé‡æ’åºè§„åˆ™ã€‚</p>
<p>1ï¼‰åœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ªfinalåŸŸçš„å†™å…¥ï¼Œä¸éšåæŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚</p>
<blockquote>
<p>å†™finalåŸŸçš„é‡æ’åºè§„åˆ™ç¦æ­¢æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚</p>
<p>å†™æ™®é€šåŸŸçš„æ“ä½œå¯èƒ½è¢«ç¼–è¯‘å™¨é‡æ’åºåˆ°äº†æ„é€ å‡½æ•°ä¹‹å¤–ï¼Œè¯»çº¿ç¨‹Bé”™è¯¯åœ°è¯»å–äº†æ™®é€šå˜é‡iåˆå§‹åŒ–ä¹‹å‰çš„å€¼ï¼Œå¾ˆå¯èƒ½objå¯¹è±¡è¿˜æ²¡æœ‰æ„é€ å®Œæˆï¼Œåˆå§‹å€¼1è¿˜æ²¡æœ‰å†™å…¥æ™®é€šåŸŸiã€‚è€Œå†™finalåŸŸçš„æ“ä½œï¼Œè¢«å†™finalåŸŸçš„é‡æ’åºè§„åˆ™â€œé™å®šâ€åœ¨äº†æ„é€ å‡½æ•°ä¹‹å†…ï¼Œè¯»çº¿ç¨‹Bæ­£ç¡®åœ°è¯»å–äº†finalå˜é‡åˆå§‹åŒ–ä¹‹åçš„å€¼ã€‚</p>
</blockquote>
<blockquote>
<p>å†™finalåŸŸçš„é‡æ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨å¯¹è±¡å¼•ç”¨ä¸ºä»»æ„çº¿ç¨‹å¯è§ä¹‹å‰ï¼Œå¯¹è±¡çš„finalåŸŸå·²ç»è¢«æ­£ç¡®åˆå§‹åŒ–è¿‡äº†ï¼Œè€Œæ™®é€šåŸŸä¸å…·æœ‰è¿™ä¸ªä¿éšœã€‚</p>
</blockquote>
<p>2ï¼‰åˆæ¬¡è¯»ä¸€ä¸ªåŒ…å«finalåŸŸçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸éšååˆæ¬¡è¯»è¿™ä¸ªfinalåŸŸï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚</p>
<blockquote>
<p>ç¼–è¯‘å™¨éµå®ˆé—´æ¥ä¾èµ–å…³ç³»ï¼Œå› æ­¤ç¼–è¯‘å™¨ä¸ä¼šé‡æ’åºè¿™ä¸¤ä¸ªæ“ä½œã€‚å¤§å¤šæ•°å¤„ç†å™¨ä¹Ÿä¼šéµå®ˆé—´æ¥ä¾èµ–ï¼Œä¹Ÿä¸ä¼šé‡æ’åºè¿™ä¸¤ä¸ªæ“ä½œã€‚ä½†æœ‰å°‘æ•°å¤„ç†å™¨å…è®¸å¯¹å­˜åœ¨é—´æ¥ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºï¼ˆæ¯”å¦‚alphaå¤„ç†å™¨ï¼‰ï¼Œè¿™ä¸ªè§„åˆ™å°±æ˜¯ä¸“é—¨ç”¨æ¥é’ˆå¯¹è¿™ç§å¤„ç†å™¨çš„ã€‚</p>
</blockquote>
<blockquote>
<p>è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨è¯»ä¸€ä¸ªå¯¹è±¡çš„finalåŸŸä¹‹å‰ï¼Œä¸€å®šä¼šå…ˆè¯»åŒ…å«è¿™ä¸ªfinalåŸŸçš„å¯¹è±¡çš„å¼•ç”¨ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class FinalExample &#123;</span><br><span class="line">    int i;  //æ™®é€šå˜é‡</span><br><span class="line">    final int j;  //finalå˜é‡</span><br><span class="line">    static FinalExample obj;</span><br><span class="line">    public FinalExample() &#123; //æ„é€ å‡½æ•°</span><br><span class="line">        i = 1; //å†™æ™®é€šåŸŸ</span><br><span class="line">        j = 2; //å†™finalåŸŸ</span><br><span class="line">    &#125;</span><br><span class="line">    public static void writer() &#123; //å†™çº¿ç¨‹Aæ‰§è¡Œ</span><br><span class="line">        obj = new FinalExample();</span><br><span class="line">    &#125;</span><br><span class="line">    public static void reader() &#123; //è¯»çº¿ç¨‹Bæ‰§è¡Œ</span><br><span class="line">        FinalExample object = obj; //è¯»å¯¹è±¡å¼•ç”¨</span><br><span class="line">        int a = object.i; //è¯»æ™®é€šåŸŸ</span><br><span class="line">        int b = object.j; //è¯»finalåŸŸ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…finalåŸŸä¸ºå¼•ç”¨ç±»å‹"><a href="#âœ…finalåŸŸä¸ºå¼•ç”¨ç±»å‹" class="headerlink" title="âœ…finalåŸŸä¸ºå¼•ç”¨ç±»å‹"></a>âœ…finalåŸŸä¸ºå¼•ç”¨ç±»å‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class FinalReferenceExample &#123;</span><br><span class="line">    final int[] intArray; //finalæ˜¯å¼•ç”¨ç±»å‹</span><br><span class="line">    static FinalReferenceExample obj;</span><br><span class="line">    public FinalReferenceExample() &#123; //æ„é€ å‡½æ•°</span><br><span class="line">        intArray = new int[1]; //1</span><br><span class="line">        intArray[0] = 1; //2</span><br><span class="line">    &#125;</span><br><span class="line">    public static void writerOne() &#123; //å†™çº¿ç¨‹Aæ‰§è¡Œ</span><br><span class="line">        obj = new FinalReferenceExample(); //3</span><br><span class="line">    &#125;</span><br><span class="line">    public static void writerTwo() &#123; //å†™çº¿ç¨‹Bæ‰§è¡Œ</span><br><span class="line">        obj.intArray[0] = 2; //4</span><br><span class="line">    &#125;</span><br><span class="line">    public static void reader() &#123; //è¯»çº¿ç¨‹Cæ‰§è¡Œ</span><br><span class="line">        if (obj != null) &#123; //5</span><br><span class="line">            int temp1 = obj.intArray[0]; //6</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ¬ä¾‹finalåŸŸä¸ºä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œå®ƒå¼•ç”¨ä¸€ä¸ªintå‹çš„æ•°ç»„å¯¹è±¡ã€‚å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå†™finalåŸŸçš„é‡æ’åºè§„åˆ™å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¢åŠ äº†å¦‚ä¸‹çº¦æŸï¼šåœ¨<strong>æ„é€ å‡½æ•°å†…</strong>å¯¹ä¸€ä¸ªfinalå¼•ç”¨çš„å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥(2)ï¼Œä¸éšååœ¨æ„é€ å‡½æ•°å¤–æŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡(3)ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚</p>
<p>1æ˜¯å¯¹finalåŸŸçš„å†™å…¥ï¼Œ2æ˜¯å¯¹è¿™ä¸ªfinalåŸŸå¼•ç”¨çš„å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ï¼Œ3æ˜¯æŠŠè¢«æ„é€ çš„å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™æŸä¸ªå¼•ç”¨å˜é‡ã€‚è¿™é‡Œé™¤äº†å‰é¢æåˆ°çš„1ä¸èƒ½å’Œ3é‡æ’åºå¤–ï¼Œ2å’Œ3ä¹Ÿä¸èƒ½é‡æ’åºã€‚</p>
<p>å†™çº¿ç¨‹Bå¯¹æ•°ç»„å…ƒç´ çš„å†™å…¥ï¼Œè¯»çº¿ç¨‹Cå¯èƒ½çœ‹å¾—åˆ°ï¼Œä¹Ÿå¯èƒ½çœ‹ä¸åˆ°ã€‚JMMä¸ä¿è¯çº¿ç¨‹Bçš„å†™å…¥å¯¹è¯»çº¿ç¨‹Cå¯è§ï¼Œå› ä¸ºå†™çº¿ç¨‹Bå’Œè¯»çº¿ç¨‹Cä¹‹é—´å­˜åœ¨æ•°æ®ç«äº‰ï¼Œæ­¤æ—¶çš„æ‰§è¡Œç»“æœä¸å¯é¢„çŸ¥ã€‚</p>
<p>å¦‚æœæƒ³è¦ç¡®ä¿è¯»çº¿ç¨‹Cçœ‹åˆ°å†™çº¿ç¨‹Bå¯¹æ•°ç»„å…ƒç´ çš„å†™å…¥ï¼Œå†™çº¿ç¨‹Bå’Œè¯»çº¿ç¨‹Cä¹‹é—´éœ€è¦ä½¿ç”¨åŒæ­¥åŸè¯­ï¼ˆlockæˆ–volatileï¼‰æ¥ç¡®ä¿å†…å­˜å¯è§æ€§ã€‚</p>
<h4 id="âœ…ä¸ºä»€ä¹ˆå«finalçš„å¯¹è±¡å¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…â€œæº¢å‡ºâ€"><a href="#âœ…ä¸ºä»€ä¹ˆå«finalçš„å¯¹è±¡å¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…â€œæº¢å‡ºâ€" class="headerlink" title="âœ…ä¸ºä»€ä¹ˆå«finalçš„å¯¹è±¡å¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…â€œæº¢å‡ºâ€"></a>âœ…ä¸ºä»€ä¹ˆå«finalçš„å¯¹è±¡å¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…â€œæº¢å‡ºâ€</h4><p>å†™finalåŸŸçš„é‡æ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨å¼•ç”¨å˜é‡ä¸ºä»»æ„çº¿ç¨‹å¯è§ä¹‹å‰ï¼Œè¯¥å¼•ç”¨å˜é‡æŒ‡å‘çš„å¯¹è±¡çš„finalåŸŸå·²ç»åœ¨æ„é€ å‡½æ•°ä¸­è¢«æ­£ç¡®åˆå§‹åŒ–è¿‡äº†ã€‚å…¶å®ï¼Œè¦å¾—åˆ°è¿™ä¸ªæ•ˆæœï¼Œè¿˜éœ€è¦ä¸€ä¸ªä¿è¯ï¼šåœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼Œä¸èƒ½è®©è¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨ä¸ºå…¶ä»–çº¿ç¨‹æ‰€è§ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å¼•ç”¨ä¸èƒ½åœ¨æ„é€ å‡½æ•°ä¸­â€œé€¸å‡ºâ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class FinalReferenceEscapeExample &#123;</span><br><span class="line">    final int                          i;</span><br><span class="line">    static FinalReferenceEscapeExample obj;</span><br><span class="line">    public FinalReferenceEscapeExample() &#123;</span><br><span class="line">        i = 1; //1å†™finalåŸŸ</span><br><span class="line">        obj = this; //2 thiså¼•ç”¨åœ¨æ­¤â€œé€¸å‡ºâ€</span><br><span class="line">    &#125;</span><br><span class="line">    public static void writer() &#123;</span><br><span class="line">        new FinalReferenceEscapeExample();</span><br><span class="line">    &#125;</span><br><span class="line">    public static void reader() &#123;  //çº¿ç¨‹B</span><br><span class="line">        if (obj != null) &#123; //3</span><br><span class="line">            int temp = obj.i; //4</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ“ä½œ2ä½¿å¾—å¯¹è±¡è¿˜æœªå®Œæˆæ„é€ å‰å°±ä¸ºçº¿ç¨‹Bå¯è§ã€‚è¿™é‡Œçš„æ“ä½œ1å’Œæ“ä½œ2ä¹‹é—´å¯èƒ½è¢«é‡æ’åºã€‚çº¿ç¨‹Bçœ‹åˆ°äº†æ­¤æ—¶çš„finalåŸŸå¯èƒ½è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚</p>
<p>finalä¸åŒäºæ™®é€šå˜é‡è¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼šåœ¨æ„é€ å‡½æ•°è¿”å›åï¼Œä»»æ„çº¿ç¨‹éƒ½å°†ä¿è¯èƒ½çœ‹åˆ°finalåŸŸæ­£ç¡®åˆå§‹åŒ–ä¹‹åçš„å€¼ã€‚</p>
<h4 id="âœ…å¤„ç†å™¨ä¸­å¦‚ä½•å®ç°finalè¯­ä¹‰"><a href="#âœ…å¤„ç†å™¨ä¸­å¦‚ä½•å®ç°finalè¯­ä¹‰" class="headerlink" title="âœ…å¤„ç†å™¨ä¸­å¦‚ä½•å®ç°finalè¯­ä¹‰"></a>âœ…å¤„ç†å™¨ä¸­å¦‚ä½•å®ç°finalè¯­ä¹‰</h4><p>æœ¬æ¥åº”è¯¥è¦æ’å…¥å†…å­˜å±éšœçš„ã€‚<br>X86å¤„ç†å™¨ä¸ä¼šå¯¹å†™-å†™æ“ä½œåšé‡æ’åºï¼ŒX86å¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨é—´æ¥ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨X86å¤„ç†å™¨ä¸­ï¼ŒfinalåŸŸçš„è¯»&#x2F;å†™ä¸ä¼šæ’å…¥ä»»ä½•å†…å­˜å±éšœï¼ï¼ˆæ™®é€šå˜é‡ä¹Ÿæœ‰ä¾èµ–å…³ç³»å§ï¼Œä¹Ÿæœ‰finalè¯­ä¹‰ï¼Ÿï¼‰</p>
<h4 id="âœ…JSR-133ä¸ºä»€ä¹ˆè¦å¢å¼ºfinalçš„è¯­ä¹‰"><a href="#âœ…JSR-133ä¸ºä»€ä¹ˆè¦å¢å¼ºfinalçš„è¯­ä¹‰" class="headerlink" title="âœ…JSR-133ä¸ºä»€ä¹ˆè¦å¢å¼ºfinalçš„è¯­ä¹‰"></a>âœ…JSR-133ä¸ºä»€ä¹ˆè¦å¢å¼ºfinalçš„è¯­ä¹‰</h4><p>åœ¨æ—§çš„Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªæœ€ä¸¥é‡çš„ç¼ºé™·å°±æ˜¯çº¿ç¨‹å¯èƒ½çœ‹åˆ°finalåŸŸçš„å€¼ä¼šæ”¹å˜ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹å½“å‰çœ‹åˆ°ä¸€ä¸ªæ•´å‹finalåŸŸçš„å€¼ä¸º0ï¼ˆè¿˜æœªåˆå§‹åŒ–ä¹‹å‰çš„é»˜è®¤å€¼ï¼‰ï¼Œè¿‡ä¸€æ®µæ—¶é—´ä¹‹åè¿™ä¸ªçº¿ç¨‹å†å»è¯»è¿™ä¸ªfinalåŸŸçš„å€¼æ—¶ï¼Œå´å‘ç°å€¼å˜ä¸º1ï¼ˆè¢«æŸä¸ªçº¿ç¨‹åˆå§‹åŒ–ä¹‹åçš„å€¼ï¼‰ã€‚</p>
<p>ä¸ºäº†ä¿®è¡¥è¿™ä¸ªæ¼æ´ï¼ŒJSR-133ä¸“å®¶ç»„å¢å¼ºäº†finalçš„è¯­ä¹‰ã€‚é€šè¿‡ä¸ºfinalåŸŸå¢åŠ å†™å’Œè¯»é‡æ’åºè§„åˆ™ï¼Œå¯ä»¥ä¸ºJavaç¨‹åºå‘˜æä¾›åˆå§‹åŒ–å®‰å…¨ä¿è¯ï¼šåªè¦å¯¹è±¡æ˜¯æ­£ç¡®æ„é€ çš„ï¼ˆè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨åœ¨æ„é€ å‡½æ•°ä¸­æ²¡æœ‰â€œé€¸å‡ºâ€ï¼‰ï¼Œé‚£ä¹ˆä¸éœ€è¦ä½¿ç”¨åŒæ­¥ï¼ˆæŒ‡lockå’Œvolatileçš„ä½¿ç”¨ï¼‰å°±å¯ä»¥ä¿è¯ä»»æ„çº¿ç¨‹éƒ½èƒ½çœ‹åˆ°è¿™ä¸ªfinalåŸŸåœ¨æ„é€ å‡½æ•°ä¸­è¢«åˆå§‹åŒ–ä¹‹åçš„å€¼ã€‚</p>
<h3 id="7-happens-before"><a href="#7-happens-before" class="headerlink" title="7.happens-before"></a>7.happens-before</h3><h4 id="âœ…è®¾è®¡åˆè¡·"><a href="#âœ…è®¾è®¡åˆè¡·" class="headerlink" title="âœ…è®¾è®¡åˆè¡·"></a>âœ…è®¾è®¡åˆè¡·</h4><p>è®¾è®¡å†…å­˜æ¨¡å‹JMMçš„åˆè¡·ï¼šè®©ç¨‹åºå‘˜æ˜“äºç†è§£ï¼Œæ˜“äºç¼–ç¨‹ï¼Œæä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„æŸç¼šè¶Šå°‘è¶Šå¥½ï¼Œæ–¹ä¾¿å®ƒä»¬ä¼˜åŒ–æ¥æé«˜æ€§èƒ½ã€‚</p>
<p>JMM å¯¹äºè¿™ä¸¤ç§ç±»å‹çš„é‡æ’åºåšäº†ä¸åŒçš„å¤„ç†ï¼š<br>å¯¹äºæœ‰æ•°æ®ä¾èµ–çš„é‡æ’åºï¼ŒJMM è¦æ±‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ç¦æ­¢è¿™ç§é‡æ’åº<br>å¯¹äºæ²¡æœ‰æ•°æ®ä¾èµ–çš„é‡æ’åºï¼ŒJMM è¦æ±‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸åšå¤„ç†</p>
<p>JMM çš„ happens - before å‘ç¨‹åºå‘˜æä¾›äº†è¶³å¤Ÿå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ï¼Œä½†æ˜¯å…¶ä¸­æœ‰äº›å†…å­˜å¯è§æ€§ä¿è¯å…¶å®ä¸ä¸€å®šå­˜åœ¨ï¼Œã€æ¯”å¦‚ int a&#x3D;1; int b&#x3D;2; è¿™ä¸ªå°±åªæ˜¯å¯è§ï¼Œä¸ä¿è¯æ‰§è¡Œé¡ºåºï¼Œä½†ä¹Ÿæ˜¯happens-beforeã€‘ã€‚</p>
<p>JMM å¯¹äºç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„ä¼˜åŒ–å·²ç»å°½å¯èƒ½å°‘äº†ã€‚JMM å…¶å®åœ¨éµå¾ªä¸€ä¸ªè§„åˆ™ï¼šå•çº¿ç¨‹ä¸‹æˆ–è€…å·²ç»åŒæ­¥çš„å¤šçº¿ç¨‹ä¸‹ï¼ˆsynchronizedï¼Œvolatileç­‰ï¼‰ï¼Œåªè¦ä¸æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨æƒ³è¦æ€ä¹ˆä¼˜åŒ–éƒ½å¯ä»¥ã€‚ã€æ¯”å¦‚ å¯¹äºvolatile å˜é‡ï¼Œå¦‚æœç¼–è¯‘å™¨åˆ†æåè®¤å®šè¿™ä¸ªå˜é‡åªä¼šè¢«å•çº¿ç¨‹è®¿é—®ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹çš„å¯è§æ€§é—®é¢˜ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šæŠŠ volatile å˜é‡å½“ä½œæ™®é€šå˜é‡è¿›è¡Œå¤„ç†ã€‘ã€‚</p>
<h4 id="âœ…happens-beforeçš„å®šä¹‰"><a href="#âœ…happens-beforeçš„å®šä¹‰" class="headerlink" title="âœ…happens-beforeçš„å®šä¹‰"></a>âœ…happens-beforeçš„å®šä¹‰</h4><p>JSR - 133ä¸­æå‡ºï¼ŒJSR - 133 ä½¿ç”¨ happens - before å…³ç³»æ¥å‘ç¨‹åºå‘˜æä¾›è·¨çº¿ç¨‹çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p>
<p>1ã€å¦‚æœä¸€ä¸ªæ“ä½œ happens - before å¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§ã€‚</p>
<p>2ã€ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨ happens - before å…³ç³»ï¼Œå¹¶ä¸æ„å‘³è¿™ Java å¹³å°å¿…é¡»è¦æŒ‰ç…§ happens - before è§„å®šçš„é¡ºåºæ¥æ‰§è¡Œã€‚åªè¦é‡æ’åºä¹‹åçš„ç»“æœæ˜¯ä¸æ”¹å˜çš„ï¼Œé‚£ä¹ˆ JMM æ˜¯é»˜è®¤ä¸å¯¹è¿™ç§é‡æ’åºå¤„ç†çš„</p>
<p>æ ¸å¿ƒåŸåˆ™æ˜¯ï¼šåªè¦ä¸æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœï¼ˆ<strong>å•çº¿ç¨‹å’Œæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹</strong>ï¼‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ€ä¹ˆä¼˜åŒ–éƒ½è¡Œã€‚ç¨‹åºå‘˜å¯¹äºè¿™ä¸¤ä¸ªæ“ä½œæ˜¯å¦çœŸçš„è¢«é‡æ’åºå¹¶ä¸å…³å¿ƒï¼Œç¨‹åºå‘˜åªéœ€è¦å…³ç³»çš„æ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„è¯­ä¹‰ä¸èƒ½è¢«æ”¹å˜ï¼ˆå°±æ˜¯æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ï¼‰ã€‚</p>
<p>happens - before ç»™ç¼–å†™æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„ç¨‹åºå‘˜ä¸€ä¸ªå¹»è§‰ï¼šæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ç…§ happens - before æŒ‡å®šçš„é¡ºåºæ¥æ‰§è¡Œçš„ã€‚å®é™…ä¸Šä¸æ˜¯ï¼Œä½†æ˜¯è¯­ä¹‰å’ŒæŒ‰é¡ºåºæ‰§è¡Œæ˜¯ä¸€æ ·çš„ã€‚<br>ï¼ˆå®é™…ä¸Šæ˜¯å¯è§æ€§ï¼Œä½†ä¹Ÿæ˜¯ä¸€ç§å‡çš„é¡ºåºï¼‰</p>
<h4 id="âœ…happens-beforeè§„åˆ™"><a href="#âœ…happens-beforeè§„åˆ™" class="headerlink" title="âœ…happens-beforeè§„åˆ™"></a>âœ…happens-beforeè§„åˆ™</h4><p>1ã€ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens - before äºè¯¥ç¨‹åºçš„ä»»æ„åç»­æ“ä½œã€‚</p>
<p>2ã€ç›‘è§†å™¨è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”ï¼Œhappens - before äºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚</p>
<p>3ã€volatile å˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ª volatile åŸŸçš„å†™ï¼Œhappens - before äºä»»æ„åç»­å¯¹è¿™ä¸ª volatile åŸŸçš„è¯»ã€‚</p>
<p>4ã€ä¼ é€’æ€§ï¼Œå¦‚æœ A happens - before Bï¼Œ B happens - before Cï¼Œé‚£ä¹ˆ A happens - before C</p>
<p>5ã€start() è§„åˆ™ï¼šå¦‚æœçº¿ç¨‹ A æ‰§è¡Œæ“ä½œ ThreadB.start()ï¼ˆå¯åŠ¨çº¿ç¨‹Bï¼‰ï¼Œé‚£ä¹ˆçº¿ç¨‹ A çš„ ThreadB.start() æ“ä½œ happens - before çº¿ç¨‹ B ä¸­çš„ä»»æ„æ“ä½œã€‚</p>
<p>6ã€join() è§„åˆ™ï¼šå¦‚æœçº¿ç¨‹ A æ‰§è¡Œæ“ä½œ ThreadB.join() å¹¶æˆåŠŸè¿”å›ï¼Œé‚£ä¹ˆçº¿ç¨‹ B ä¸­çš„ä»»æ„æ“ä½œ happens- before äºçº¿ç¨‹ A ä» Thread.join() æ“ä½œæˆåŠŸè¿”å›ã€‚</p>
<p>âš ï¸åƒvolitaleå˜é‡ä¸€æ ·ï¼Œçº¿ç¨‹aå†™volatileå˜é‡å‰è¿˜å†™ä¸€ä¸ªå…±äº«å˜é‡ï¼Œçº¿ç¨‹bè¯»é‚£ä¸ªvolatileå˜é‡åè¿˜è¯»é‚£ä¸ªå…±äº«å˜é‡ï¼Œå¦‚ä½•ä¿è¯å…±äº«å˜é‡çš„å®‰å…¨æ€§ï¼Œå› ä¸ºçº¿ç¨‹aé‡Œçš„æ“ä½œå¯èƒ½é‡æ’åºï¼Œæ˜¯ç”±volitileçš„å†…å­˜å±éšœæ’å…¥ç­–ç•¥å’Œvolatileçš„ç¦æ­¢ç¼–è¯‘å™¨é‡æ’åºè§„åˆ™æ¥ä¿è¯çš„ï¼Œå…¶ä»–startæ–¹æ³•å’Œjoinæ–¹æ³•ä¹Ÿä¸€æ ·ã€‚å› ä¸ºé‡æ’åºäº†çš„è¯ï¼Œæ‰§è¡Œç»“æœä¼šä¸ä¸€æ ·ã€‚</p>
<p>åŸä¹¦ç¬”è®°ï¼š<a href="https://blog.csdn.net/laohuangaa/article/details/122773633">https://blog.csdn.net/laohuangaa/article/details/122773633</a></p>
<h3 id="8-åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–"><a href="#8-åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–" class="headerlink" title="8.åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–"></a>8.åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–</h3><p>åœ¨Javaå¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œæœ‰æ—¶å€™éœ€è¦é‡‡ç”¨å»¶è¿Ÿåˆå§‹åŒ–æ¥é™ä½åˆå§‹åŒ–ç±»å’Œåˆ›å»ºå¯¹è±¡çš„å¼€é”€ã€‚åŒé‡æ£€æŸ¥é”å®šæ˜¯å¸¸è§çš„å»¶è¿Ÿåˆå§‹åŒ–æŠ€æœ¯ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªé”™è¯¯çš„ç”¨æ³•ã€‚</p>
<p>ä¸‹é¢ä¼šè®²è¿°åŒé‡æ£€æŸ¥é”å®šä¸ºä»€ä¹ˆé”™è¯¯ï¼Œä»¥åŠä¸¤ç§çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–æ–¹æ¡ˆã€‚</p>
<h4 id="âœ…åŒé‡æ£€æŸ¥é”å®šçš„ç”±æ¥"><a href="#âœ…åŒé‡æ£€æŸ¥é”å®šçš„ç”±æ¥" class="headerlink" title="âœ…åŒé‡æ£€æŸ¥é”å®šçš„ç”±æ¥"></a>âœ…åŒé‡æ£€æŸ¥é”å®šçš„ç”±æ¥</h4><p>åœ¨Javaç¨‹åºä¸­ï¼Œæœ‰æ—¶å€™å¯èƒ½éœ€è¦æ¨è¿Ÿä¸€äº›é«˜å¼€é”€çš„å¯¹è±¡åˆå§‹åŒ–æ“ä½œï¼Œå¹¶ä¸”åªæœ‰åœ¨ä½¿ç”¨è¿™äº›å¯¹è±¡æ—¶æ‰è¿›è¡Œåˆå§‹åŒ–ã€‚æ­¤æ—¶ï¼Œç¨‹åºå‘˜å¯èƒ½ä¼šé‡‡ç”¨å»¶è¿Ÿåˆå§‹åŒ–ã€‚</p>
<p>å› ä¸ºåˆå§‹åŒ–å¯èƒ½åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå®ƒä»¬å…±ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯éœ€è¦ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå°±å¥½äº†ã€‚éçº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–å¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class UnsafeLazyInitialization &#123;</span><br><span class="line">    private static Instance instance;</span><br><span class="line">    public static Instance getInstance() &#123;</span><br><span class="line">        if (instance == null) //1ï¼šAçº¿ç¨‹æ‰§è¡Œ</span><br><span class="line">            instance = new Instance(); //2ï¼šBçº¿ç¨‹æ‰§è¡Œ</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line">    static class Instance &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Açº¿ç¨‹æ‰§è¡Œä»£ç 1çš„åŒæ—¶ï¼ŒBçº¿ç¨‹æ‰§è¡Œä»£ç 2ã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹Aå¯èƒ½ä¼šçœ‹åˆ°instanceå¼•ç”¨çš„å¯¹è±¡è¿˜æ²¡æœ‰å®Œæˆåˆå§‹åŒ–. å¯¼è‡´ABçº¿ç¨‹éƒ½åˆå§‹åŒ–å¯¹è±¡ã€‚</p>
<p>åŒæ­¥å¤„ç†æ¥å®ç°çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SafeLazyInitialization &#123;</span><br><span class="line">    private static Instance instance;</span><br><span class="line">    public synchronized static Instance getInstance() &#123;</span><br><span class="line">        if (instance == null)</span><br><span class="line">            instance = new Instance();</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line">    static class Instance &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼ºç‚¹ï¼šsynchronizedå°†å¯¼è‡´æ€§èƒ½å¼€é”€ã€‚å¦‚æœgetInstance()æ–¹æ³•è¢«å¤šä¸ªçº¿ç¨‹é¢‘ç¹çš„è°ƒç”¨ï¼Œå°†ä¼šå¯¼è‡´ç¨‹åºæ‰§è¡Œæ€§èƒ½çš„ä¸‹é™ã€‚</p>
<p>å› æ­¤ï¼ŒåŒé‡æ£€æŸ¥é”å®šæ¥å®ç°å»¶è¿Ÿåˆå§‹åŒ–è¯ç”Ÿï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class DoubleCheckedLocking &#123; //1</span><br><span class="line">    private static Instance instance; //2</span><br><span class="line">    public static Instance getInstance() &#123; //3</span><br><span class="line">        if (instance == null) &#123; //4:ç¬¬ä¸€æ¬¡æ£€æŸ¥</span><br><span class="line">            synchronized (DoubleCheckedLocking.class) &#123; //5:åŠ é”</span><br><span class="line">                if (instance == null) //6:ç¬¬äºŒæ¬¡æ£€æŸ¥</span><br><span class="line">                    instance = new Instance(); //7:é—®é¢˜çš„æ ¹æºå‡ºåœ¨è¿™é‡Œ</span><br><span class="line">            &#125; //8</span><br><span class="line">        &#125; //9</span><br><span class="line">        return instance; //10</span><br><span class="line">    &#125; //11</span><br><span class="line">    static class Instance &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒæ€æƒ³ï¼šä¸ä¼šæ¯ä¸ªçº¿ç¨‹éƒ½åŠ é”ï¼Œæ£€æŸ¥instanceä¸ä¸ºnullï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æ‰§è¡Œä¸‹é¢çš„åŠ é”å’Œåˆå§‹åŒ–æ“ä½œã€‚è·å–é”ä¹‹åï¼Œå†æ£€æŸ¥ä¸€æ¬¡æ˜¯ä¸æ˜¯ä¸ºnullï¼Œå› ä¸ºåœ¨ç¬¬ä¸€æ¬¡åˆ¤æ–­æ˜¯å¦ä¸ºnullæ—¶ï¼Œå¯èƒ½å¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨åˆå§‹åŒ–ã€‚<br>ï¼ˆè·å–é”ä¹‹å‰æ£€æŸ¥ä¸€æ¬¡ï¼Œè·å–é”ä¹‹åæ£€æŸ¥ä¸€æ¬¡ï¼‰</p>
<p>ä½†æ˜¯æ˜¯é”™è¯¯çš„ï¼šåœ¨çº¿ç¨‹æ‰§è¡Œåˆ°ç¬¬4è¡Œï¼Œä»£ç è¯»å–åˆ°instanceä¸ä¸ºnullæ—¶ï¼Œinstanceå¼•ç”¨çš„å¯¹è±¡æœ‰å¯èƒ½è¿˜æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ã€‚</p>
<h4 id="âœ…åŒé‡æ£€æŸ¥é”å®šçš„é—®é¢˜"><a href="#âœ…åŒé‡æ£€æŸ¥é”å®šçš„é—®é¢˜" class="headerlink" title="âœ…åŒé‡æ£€æŸ¥é”å®šçš„é—®é¢˜"></a>âœ…åŒé‡æ£€æŸ¥é”å®šçš„é—®é¢˜</h4><p>ç¬¬7è¡Œï¼ˆinstance&#x3D;new Singleton();ï¼‰åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸€è¡Œä»£ç å¯ä»¥åˆ†è§£ä¸ºå¦‚ä¸‹çš„3è¡Œä¼ªä»£ç ã€‚</p>
<p>memory &#x3D; allocate();ã€€ã€€&#x2F;&#x2F; 1**ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼ˆå¼•ç”¨å˜é‡ï¼‰<br>ctorInstance(memory);ã€€ &#x2F;&#x2F; 2**ï¼šåˆå§‹åŒ–å¯¹è±¡<br>instance &#x3D; memory;ã€€ã€€ &#x2F;&#x2F; 3**ï¼šè®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ï¼ˆèµ‹å€¼å¼•ç”¨å˜é‡ï¼‰ï¼ˆè¿™ä¸ªæ—¶å€™å°±ä¸ä¸ºnulläº†ï¼‰</p>
<p>ä¸Šé¢3è¡Œä¼ªä»£ç ä¸­çš„2å’Œ3ä¹‹é—´ï¼Œå¯èƒ½ä¼šè¢«é‡æ’åºï¼Œå› ä¸ºè¿™ä¸ªé‡æ’åºåœ¨æ²¡æœ‰æ”¹å˜å•çº¿ç¨‹ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå¯ä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚</p>
<p>å¦‚æœå‘ç”Ÿé‡æ’åºï¼Œå¦ä¸€ä¸ªå¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹Bå°±æœ‰å¯èƒ½åœ¨ç¬¬4è¡Œåˆ¤æ–­instanceä¸ä¸ºnullã€‚çº¿ç¨‹Bæ¥ä¸‹æ¥å°†è®¿é—®instanceæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œä½†æ­¤æ—¶è¿™ä¸ªå¯¹è±¡å¯èƒ½è¿˜æ²¡æœ‰è¢«Açº¿ç¨‹åˆå§‹åŒ–ã€‚<strong>çº¿ç¨‹Bå°†ä¼šè®¿é—®åˆ°ä¸€ä¸ªè¿˜æœªåˆå§‹åŒ–çš„å¯¹è±¡</strong>ã€‚</p>
<p>å¦‚ä½•è§£å†³ï¼Œæ¥å®ç°çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼š<br>1ï¼‰ ä¸å…è®¸2å’Œ3é‡æ’åºã€‚<br>2ï¼‰å…è®¸2å’Œ3é‡æ’åºï¼Œä½†ä¸å…è®¸å…¶ä»–çº¿ç¨‹â€œçœ‹åˆ°â€è¿™ä¸ªé‡æ’åºã€‚</p>
<h4 id="âœ…åŸºäºvolatileçš„è§£å†³æ–¹æ¡ˆ"><a href="#âœ…åŸºäºvolatileçš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="âœ…åŸºäºvolatileçš„è§£å†³æ–¹æ¡ˆ"></a>âœ…åŸºäºvolatileçš„è§£å†³æ–¹æ¡ˆ</h4><p>æŠŠinstanceå£°æ˜ä¸ºvolatileå‹ï¼Œå°±å¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SafeDoubleCheckedLocking &#123;</span><br><span class="line">    private volatile static Instance instance;</span><br><span class="line">    public static Instance getInstance() &#123;</span><br><span class="line">        if (instance == null) &#123;</span><br><span class="line">            synchronized (SafeDoubleCheckedLocking.class) &#123;</span><br><span class="line">                if (instance == null)</span><br><span class="line">                    instance = new Instance();//instanceä¸ºvolatileï¼Œç°åœ¨æ²¡é—®é¢˜äº†</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line">    static class Instance &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦JDK 5æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆå› ä¸ºä»JDK 5å¼€å§‹ä½¿ç”¨æ–°çš„JSR-133å†…å­˜æ¨¡å‹è§„èŒƒ).</p>
<p>åŸç†ï¼šä½¿ç”¨äº†volatileä¿®é¥°åï¼Œ2ã€3å°†ä¸ä¼šé‡æ’åºã€‚</p>
<h4 id="âœ…åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ"><a href="#âœ…åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="âœ…åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ"></a>âœ…åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ</h4><p>JVMåœ¨ç±»çš„åˆå§‹åŒ–é˜¶æ®µï¼ˆå³åœ¨Classè¢«åŠ è½½åï¼Œä¸”è¢«çº¿ç¨‹ä½¿ç”¨ä¹‹å‰ï¼‰ï¼Œä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–ã€‚åœ¨æ‰§è¡Œç±»çš„åˆå§‹åŒ–æœŸé—´ï¼ŒJVMä¼šå»è·å–ä¸€ä¸ªé”ã€‚è¿™ä¸ªé”å¯ä»¥åŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªç±»çš„åˆå§‹åŒ–ã€‚</p>
<p>ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class InstanceFactory &#123;</span><br><span class="line">    private static class InstanceHolder &#123;</span><br><span class="line">        public static Instance instance = new Instance();</span><br><span class="line">    &#125;</span><br><span class="line">    public static Instance getInstance() &#123;</span><br><span class="line">        return InstanceHolder.instance; //è¿™é‡Œå°†å¯¼è‡´InstanceHolderç±»è¢«åˆå§‹åŒ–</span><br><span class="line">    &#125;</span><br><span class="line">    static class Instance &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡è®¾ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡ŒgetInstance()æ–¹æ³•ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–classå¯¹è±¡çš„åˆå§‹åŒ–é”ï¼Œç„¶åæ‰§è¡Œå¯¹è±¡åˆå§‹åŒ–ã€‚</p>
<p>ğŸ’¡åˆå§‹åŒ–ç±»çš„æ—¶æœºå’ŒåŸç†ï¼š</p>
<p>åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼ŒåŒ…æ‹¬<strong>æ‰§è¡Œè¿™ä¸ªç±»çš„é™æ€åˆå§‹åŒ–å’Œåˆå§‹åŒ–åœ¨è¿™ä¸ªç±»ä¸­å£°æ˜çš„é™æ€å­—æ®µ</strong>ã€‚æ ¹æ®Javaè¯­è¨€è§„èŒƒï¼Œåœ¨é¦–æ¬¡å‘ç”Ÿä¸‹åˆ—ä»»æ„ä¸€ç§æƒ…å†µæ—¶ï¼Œä¸€ä¸ªç±»æˆ–æ¥å£ç±»å‹Tå°†è¢«ç«‹å³åˆå§‹åŒ–ï¼š<br>1ï¼‰Tæ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”ä¸€ä¸ªTç±»å‹çš„å®ä¾‹è¢«åˆ›å»ºã€‚<br>2ï¼‰Tæ˜¯ä¸€ä¸ªç±»ï¼Œä¸”Tä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€æ–¹æ³•è¢«è°ƒç”¨ã€‚<br>3ï¼‰Tä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€å­—æ®µè¢«èµ‹å€¼ã€‚<br>4ï¼‰Tä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€å­—æ®µè¢«ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ªå­—æ®µä¸æ˜¯ä¸€ä¸ªå¸¸é‡å­—æ®µã€‚<br>5ï¼‰Tæ˜¯ä¸€ä¸ªé¡¶çº§ç±»ï¼ˆTop Level Classï¼‰ï¼Œè€Œä¸”ä¸€ä¸ªæ–­è¨€è¯­å¥åµŒå¥—åœ¨Tå†…éƒ¨è¢«æ‰§è¡Œã€‚</p>
<p>åœ¨InstanceFactoryç¤ºä¾‹ä»£ç ä¸­ï¼Œé¦–æ¬¡æ‰§è¡ŒgetInstance()æ–¹æ³•çš„çº¿ç¨‹å°†å¯¼è‡´InstanceHolderç±»è¢«åˆå§‹åŒ–ï¼Œæ˜¯æƒ…å†µ4.<br>ï¼ˆç›¸å½“äºæ˜¯ç”¨ä¸€ä¸ªå·¥å‚ç±»æ¥åˆå§‹åŒ–å¦ä¸€ä¸ªç±»ï¼Ÿï¼‰</p>
<p>Javaè¯­è¨€æ˜¯å¤šçº¿ç¨‹çš„ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½åœ¨åŒä¸€æ—¶é—´å°è¯•å»åˆå§‹åŒ–åŒä¸€ä¸ªç±»æˆ–æ¥å£ï¼ˆæ¯”å¦‚è¿™é‡Œå¤šä¸ªçº¿ç¨‹å¯èƒ½åœ¨åŒä¸€æ—¶åˆ»è°ƒç”¨getInstance()æ–¹æ³•æ¥åˆå§‹åŒ–InstanceHolderç±»ï¼‰ã€‚å› æ­¤ï¼Œåœ¨Javaä¸­åˆå§‹åŒ–ä¸€ä¸ªç±»æˆ–è€…æ¥å£æ—¶ï¼Œéœ€è¦åšç»†è‡´çš„åŒæ­¥å¤„ç†ã€‚</p>
<p>Javaè¯­è¨€è§„èŒƒè§„å®šï¼Œå¯¹äºæ¯ä¸€ä¸ªç±»æˆ–æ¥å£Cï¼Œéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åˆå§‹åŒ–é”LCä¸ä¹‹å¯¹åº”ã€‚ä»Cåˆ°LCçš„æ˜ å°„ï¼Œç”±JVMçš„å…·ä½“å®ç°å»è‡ªç”±å®ç°ã€‚JVMåœ¨ç±»åˆå§‹åŒ–æœŸé—´ä¼šè·å–è¿™ä¸ªåˆå§‹åŒ–é”ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹è‡³å°‘è·å–ä¸€æ¬¡é”æ¥ç¡®ä¿è¿™ä¸ªç±»å·²ç»è¢«åˆå§‹åŒ–è¿‡äº†ã€‚</p>
<p>ï¼ˆ<strong>å¤šä¸ªçº¿ç¨‹åˆå§‹åŒ–ç±»ä¸æ˜¯åˆ›å»ºä¸åŒçš„å¯¹è±¡å—ï¼Ÿéš¾é“åˆå§‹åŒ–ç±»å’Œåˆ›å»ºå¯¹è±¡ä¸ä¸€æ ·ï¼Ÿ</strong> æ˜¯çš„ï¼Œå…ˆåˆå§‹åŒ–ç±»å†åˆ›å»ºå¯¹è±¡ï¼‰</p>
<p>å¯¹äºç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ï¼ŒJavaè¯­è¨€è§„èŒƒåˆ¶å®šäº†ç²¾å·§è€Œå¤æ‚çš„ç±»åˆå§‹åŒ–å¤„ç†è¿‡ç¨‹ã€‚Javaåˆå§‹åŒ–ä¸€ä¸ªç±»æˆ–æ¥å£çš„å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p>ç¬¬1é˜¶æ®µï¼šé€šè¿‡åœ¨Classå¯¹è±¡ä¸ŠåŒæ­¥ï¼ˆå³è·å–Classå¯¹è±¡çš„åˆå§‹åŒ–é”ï¼‰ï¼Œæ¥æ§åˆ¶ç±»æˆ–æ¥å£çš„åˆå§‹åŒ–ï¼Œè·å–é”ä¹‹åï¼Œåˆå§‹åŒ–ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€ï¼Œè®¾ç½®state&#x3D;initialingï¼Œç„¶åé‡Šæ”¾é”ã€‚è·å–ä¸åˆ°çš„è¯ï¼Œè¿™ä¸ªè·å–é”çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°è¿™ä¸ªåˆå§‹åŒ–é”ã€‚</p>
<p>ç¬¬2é˜¶æ®µï¼šçº¿ç¨‹Aæ‰§è¡Œç±»çš„åˆå§‹åŒ–ï¼ˆä¸Šé¢çš„ä¸‰æ­¥ï¼‰ï¼ŒåŒæ—¶çº¿ç¨‹Bè·å–åˆ°åˆå§‹åŒ–é”ï¼Œå‘ç°çŠ¶æ€æ˜¯initialingï¼Œç„¶åé‡Šæ”¾é”ã€‚ååœ¨åˆå§‹åŒ–é”å¯¹åº”çš„conditionä¸Šç­‰å¾…ã€‚</p>
<p>ç¬¬3é˜¶æ®µï¼šçº¿ç¨‹Aè·å–åˆå§‹åŒ–é”ï¼Œè®¾ç½®state&#x3D;initializedåï¼Œå”¤é†’åœ¨conditionä¸­ç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œé‡Šæ”¾é”ã€‚</p>
<p>ç¬¬4é˜¶æ®µï¼šçº¿ç¨‹Bè·å–é”ï¼Œå‘ç°çŠ¶æ€æ˜¯initialedï¼Œé‡Šæ”¾é”ï¼Œç»“æŸç±»çš„åˆå§‹åŒ–å¤„ç†ã€‚</p>
<p>æ‰€ä»¥ï¼Œçº¿ç¨‹Aæ‰§è¡Œç±»çš„åˆå§‹åŒ–æ—¶çš„å†™å…¥æ“ä½œï¼ˆæ‰§è¡Œç±»çš„é™æ€åˆå§‹åŒ–å’Œåˆå§‹åŒ–ç±»ä¸­å£°æ˜çš„é™æ€å­—æ®µï¼‰ï¼Œçº¿ç¨‹Bä¸€å®šèƒ½çœ‹åˆ°ã€‚</p>
<p>æ³¨æ„ï¼šè¿™é‡Œçš„conditionå’Œstateæ ‡è®°æ˜¯æœ¬æ–‡è™šæ„å‡ºæ¥çš„ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>åŸºäºç±»åˆå§‹åŒ–çš„æ–¹æ¡ˆçš„å®ç°ä»£ç æ›´ç®€æ´ï¼Œä½†åªèƒ½å¯¹é™æ€å­—æ®µä½¿ç”¨ã€‚ä½†åŸºäºvolatileçš„åŒé‡æ£€æŸ¥é”å®šçš„æ–¹æ¡ˆæœ‰ä¸€ä¸ªé¢å¤–çš„ä¼˜åŠ¿ï¼šé™¤äº†å¯ä»¥å¯¹é™æ€å­—æ®µå®ç°å»¶è¿Ÿåˆå§‹åŒ–å¤–ï¼Œè¿˜å¯ä»¥å¯¹å®ä¾‹å­—æ®µå®ç°å»¶è¿Ÿåˆå§‹åŒ–ã€‚</p>
<p>å­—æ®µå»¶è¿Ÿåˆå§‹åŒ–é™ä½äº†åˆå§‹åŒ–ç±»æˆ–åˆ›å»ºå®ä¾‹çš„å¼€é”€ï¼Œä½†å¢åŠ äº†è®¿é—®è¢«å»¶è¿Ÿåˆå§‹åŒ–çš„å­—æ®µçš„å¼€é”€ã€‚</p>
<p>åŸä¹¦ç¬”è®°ï¼š<a href="https://dandelioncloud.cn/article/details/1462953051467345921/">https://dandelioncloud.cn/article/details/1462953051467345921/</a></p>
<h3 id="9-javaå†…å­˜æ¨¡å‹ç»¼è¿°"><a href="#9-javaå†…å­˜æ¨¡å‹ç»¼è¿°" class="headerlink" title="9.javaå†…å­˜æ¨¡å‹ç»¼è¿°"></a>9.javaå†…å­˜æ¨¡å‹ç»¼è¿°</h3><h4 id="âœ…å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹"><a href="#âœ…å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹" class="headerlink" title="âœ…å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹"></a>âœ…å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹</h4><p>JMMï¼šç›¸å½“äºæ˜¯javaç¼–è¯‘å™¨çš„å†…å­˜æ¨¡å‹</p>
<p>é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªç†è®ºå‚è€ƒæ¨¡å‹ï¼ŒJMMå’Œå¤„ç†å™¨å†…å­˜æ¨¡å‹åœ¨è®¾è®¡æ—¶é€šå¸¸ä¼šä»¥é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸ºå‚ç…§ã€‚åœ¨è®¾è®¡æ—¶ï¼ŒJMMå’Œå¤„ç†å™¨å†…å­˜æ¨¡å‹ä¼šå¯¹é¡ºåºä¸€è‡´æ€§æ¨¡å‹åšä¸€äº›æ”¾æ¾ï¼Œå› ä¸ºå¦‚æœå®Œå…¨æŒ‰ç…§é¡ºåºä¸€è‡´æ€§æ¨¡å‹æ¥å®ç°å¤„ç†å™¨å’ŒJMMï¼Œé‚£ä¹ˆå¾ˆå¤šçš„å¤„ç†å™¨å’Œç¼–è¯‘å™¨ä¼˜åŒ–éƒ½è¦è¢«ç¦æ­¢ï¼Œè¿™å¯¹æ‰§è¡Œæ€§èƒ½å°†ä¼šæœ‰å¾ˆå¤§çš„å½±å“ã€‚å†…å­˜æ¨¡å‹çš„æŸç¼šè¶Šå°‘ï¼Œå¤„ç†å™¨æ€§èƒ½è¶Šå¥½ã€‚</p>
<p>æ ¹æ®å¯¹ä¸åŒç±»å‹çš„è¯»&#x2F;å†™æ“ä½œç»„åˆçš„æ‰§è¡Œé¡ºåºçš„æ”¾æ¾ï¼Œå¯ä»¥æŠŠå¸¸è§å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹åˆ’åˆ†ä¸ºå¦‚ä¸‹å‡ ç§ç±»å‹ï¼š<br>1ã€æ”¾æ¾ç¨‹åºä¸­å†™-è¯»æ“ä½œçš„é¡ºåºï¼Œç”±æ­¤äº§ç”Ÿäº†Total Store Orderingå†…å­˜æ¨¡å‹ï¼ˆç®€ç§°ä¸ºTSOï¼‰<br>2ã€åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œç»§ç»­æ”¾æ¾ç¨‹åºä¸­å†™-å†™æ“ä½œçš„é¡ºåºï¼Œç”±æ­¤äº§ç”Ÿäº†Partial Store Orderå†…å­˜æ¨¡å‹ï¼ˆç®€ç§°ä¸ºPSOï¼‰ã€‚<br>3ã€åœ¨å‰é¢ä¸¤æ¡çš„åŸºç¡€ä¸Šï¼Œç»§ç»­æ”¾æ¾ç¨‹åºä¸­è¯»-å†™å’Œè¯»-è¯»æ“ä½œçš„é¡ºåºï¼Œç”±æ­¤äº§ç”Ÿäº†Relaxed Memory Orderå†…å­˜æ¨¡å‹ï¼ˆç®€ç§°ä¸ºRMOï¼‰å’ŒPowerPCå†…å­˜æ¨¡å‹ã€‚</p>
<p>è¿™é‡Œå¤„ç†å™¨å¯¹è¯»&#x2F;å†™æ“ä½œçš„æ”¾æ¾ï¼Œæ˜¯ä»¥ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ä¸ºå‰æçš„ï¼ˆå› ä¸ºå¤„ç†å™¨è¦éµå®ˆas-if-serialè¯­ä¹‰ï¼Œ<strong>å¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–æ€§çš„ä¸¤ä¸ªå†…å­˜æ“ä½œåšé‡æ’åº</strong>ï¼‰ã€‚</p>
<p>æ‰€æœ‰å¤„ç†å™¨å†…å­˜æ¨¡å‹éƒ½å…è®¸å†™-è¯»é‡æ’åºï¼ŒåŸå› æ˜¯ï¼šä½¿ç”¨äº†å†™ç¼“å­˜åŒºã€‚å†™ç¼“å­˜åŒºå¯èƒ½å¯¼è‡´å†™-è¯»æ“ä½œé‡æ’åºã€‚éƒ½å…è®¸æ›´æ—©è¯»åˆ°å½“å‰å¤„ç†å™¨çš„å†™ï¼ŒåŸå› åŒæ ·æ˜¯å› ä¸ºå†™ç¼“å­˜åŒºã€‚ç”±äºå†™ç¼“å­˜åŒºä»…å¯¹å½“å‰å¤„ç†å™¨å¯è§ï¼Œè¿™ä¸ªç‰¹æ€§å¯¼è‡´å½“å‰å¤„ç†å™¨å¯ä»¥æ¯”å…¶ä»–å¤„ç†å™¨å…ˆçœ‹åˆ°ä¸´æ—¶ä¿å­˜åœ¨è‡ªå·±å†™ç¼“å­˜åŒºä¸­çš„å†™ã€‚</p>
<p><strong>è™šæ‹Ÿæœºå¯¹ä¸åŒæ“ä½œç³»ç»Ÿåæ˜ çš„ä¸€è‡´æ€§ï¼š</strong></p>
<p>ç”±äºå¸¸è§çš„å¤„ç†å™¨å†…å­˜æ¨¡å‹æ¯”JMMè¦å¼±ï¼ŒJavaç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æ‰§è¡ŒæŒ‡ä»¤åºåˆ—çš„é€‚å½“ä½ç½®æ’å…¥å†…å­˜å±éšœæ¥é™åˆ¶å¤„ç†å™¨çš„é‡æ’åºã€‚åŒæ—¶ï¼Œç”±äºå„ç§å¤„ç†å™¨å†…å­˜æ¨¡å‹çš„å¼ºå¼±ä¸åŒï¼Œä¸ºäº†åœ¨ä¸åŒçš„å¤„ç†å™¨å¹³å°å‘ç¨‹åºå‘˜å±•ç¤ºä¸€ä¸ªä¸€è‡´çš„å†…å­˜æ¨¡å‹ï¼ŒJMMåœ¨ä¸åŒçš„å¤„ç†å™¨ä¸­éœ€è¦æ’å…¥çš„å†…å­˜å±éšœçš„æ•°é‡å’Œç§ç±»ä¹Ÿä¸ç›¸åŒã€‚JMMå±è”½äº†ä¸åŒå¤„ç†å™¨å†…å­˜æ¨¡å‹çš„å·®å¼‚ï¼Œå®ƒåœ¨ä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šä¸ºJavaç¨‹åºå‘˜å‘ˆç°äº†ä¸€ä¸ªä¸€è‡´çš„å†…å­˜æ¨¡å‹ã€‚</p>
<h4 id="âœ…å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»"><a href="#âœ…å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»" class="headerlink" title="âœ…å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»"></a>âœ…å„ç§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³»</h4><p>JMMæ˜¯ä¸€ä¸ªè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡å‹æ˜¯ç¡¬ä»¶çº§çš„å†…å­˜æ¨¡å‹ï¼Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªç†è®ºå‚è€ƒæ¨¡å‹ã€‚</p>
<p>å¤„ç†å™¨å†…å­˜æ¨¡å‹å’Œè¯­è¨€å†…å­˜æ¨¡å‹éƒ½æ¯”é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹è¦å¼±ã€‚åŒå¤„ç†å™¨å†…å­˜æ¨¡å‹ä¸€æ ·ï¼Œè¶Šæ˜¯è¿½æ±‚æ‰§è¡Œæ€§èƒ½çš„è¯­è¨€ï¼Œå†…å­˜æ¨¡å‹è®¾è®¡å¾—ä¼šè¶Šå¼±ã€‚</p>
<p>æ‰§è¡Œæ€§èƒ½è¶Šå¥½ï¼Œæ˜“ç¼–ç¨‹æ€§è¶Šå·®ã€‚</p>
<h4 id="âœ…JMMçš„å†…å­˜å¯è§æ€§ä¿è¯"><a href="#âœ…JMMçš„å†…å­˜å¯è§æ€§ä¿è¯" class="headerlink" title="âœ…JMMçš„å†…å­˜å¯è§æ€§ä¿è¯"></a>âœ…JMMçš„å†…å­˜å¯è§æ€§ä¿è¯</h4><p>1ã€å•çº¿ç¨‹ç¨‹åºã€‚å•çº¿ç¨‹ç¨‹åºä¸ä¼šå‡ºç°å†…å­˜å¯è§æ€§é—®é¢˜ã€‚ç¼–è¯‘å™¨ã€runtimeå’Œå¤„ç†å™¨ä¼šå…±åŒç¡®ä¿å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒã€‚</p>
<p>2ã€æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§ï¼ˆç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒï¼‰ã€‚è¿™æ˜¯JMMå…³æ³¨çš„é‡ç‚¹ï¼ŒJMMé€šè¿‡é™åˆ¶ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é‡æ’åºæ¥ä¸ºç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p>
<p>3ã€æœªåŒæ­¥&#x2F;æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚JMMä¸ºå®ƒä»¬æä¾›äº†æœ€å°å®‰å…¨æ€§ä¿éšœï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼ˆ0ã€nullã€falseï¼‰ã€‚</p>
<p>æœ€å°å®‰å…¨æ€§â€œå‘ç”Ÿâ€åœ¨å¯¹è±¡è¢«ä»»æ„çº¿ç¨‹ä½¿ç”¨ä¹‹å‰ã€‚64ä½æ•°æ®çš„éåŸå­æ€§å†™â€œå‘ç”Ÿâ€åœ¨å¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼ˆå†™å…±äº«å˜é‡ï¼‰ã€‚å¦‚æœæ˜¯å†™äº†ä¸€åŠçš„ï¼Œé‚£å°±æ˜¯çº¿ç¨‹Bå†™äº†ä¸€åŠçš„ï¼Œå¹¶ä¸æ˜¯nullã€‚<br>æœ€å°å®‰å…¨æ€§ä¿è¯çº¿ç¨‹è¯»å–åˆ°çš„å€¼ä¸ä¼šæ— ä¸­ç”Ÿæœ‰çš„å†’å‡ºæ¥ï¼Œä½†å¹¶ä¸ä¿è¯çº¿ç¨‹è¯»å–åˆ°çš„å€¼ä¸€å®šæ˜¯æ­£ç¡®çš„ã€‚</p>
<p>åªè¦å¤šçº¿ç¨‹ç¨‹åºæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼ŒJMMä¿è¯è¯¥ç¨‹åºåœ¨ä»»æ„çš„å¤„ç†å™¨å¹³å°ä¸Šçš„æ‰§è¡Œç»“æœï¼Œä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœä¸€è‡´ã€‚</p>
<h4 id="âœ…JSR-133å¯¹æ—§å†…å­˜æ¨¡å‹çš„ä¿®è¡¥"><a href="#âœ…JSR-133å¯¹æ—§å†…å­˜æ¨¡å‹çš„ä¿®è¡¥" class="headerlink" title="âœ…JSR-133å¯¹æ—§å†…å­˜æ¨¡å‹çš„ä¿®è¡¥"></a>âœ…JSR-133å¯¹æ—§å†…å­˜æ¨¡å‹çš„ä¿®è¡¥</h4><p>JSR-133å¯¹JDK 5ä¹‹å‰çš„æ—§å†…å­˜æ¨¡å‹çš„ä¿®è¡¥ä¸»è¦æœ‰ä¸¤ä¸ªã€‚</p>
<p>Â· å¢å¼ºvolatileçš„å†…å­˜è¯­ä¹‰ã€‚æ—§å†…å­˜æ¨¡å‹å…è®¸volatileå˜é‡ä¸æ™®é€šå˜é‡é‡æ’åºã€‚JSR-133ä¸¥æ ¼é™åˆ¶volatileå˜é‡ä¸æ™®é€šå˜é‡çš„é‡æ’åºï¼Œä½¿volatileçš„å†™-è¯»å’Œé”çš„é‡Šæ”¾-è·å–å…·æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚</p>
<p>Â· å¢å¼ºfinalçš„å†…å­˜è¯­ä¹‰ã€‚åœ¨æ—§å†…å­˜æ¨¡å‹ä¸­ï¼Œå¤šæ¬¡è¯»å–åŒä¸€ä¸ªfinalå˜é‡çš„å€¼å¯èƒ½ä¼šä¸ç›¸åŒã€‚ä¸ºæ­¤ï¼ŒJSR-133ä¸ºfinalå¢åŠ äº†ä¸¤ä¸ªé‡æ’åºè§„åˆ™ã€‚åœ¨ä¿è¯finalå¼•ç”¨ä¸ä¼šä»æ„é€ å‡½æ•°å†…é€¸å‡ºçš„æƒ…å†µä¸‹ï¼Œfinalå…·æœ‰äº†åˆå§‹åŒ–å®‰å…¨æ€§ã€‚</p>
<h2 id="ç¬¬å››ç« -javaå¹¶å‘ç¼–ç¨‹"><a href="#ç¬¬å››ç« -javaå¹¶å‘ç¼–ç¨‹" class="headerlink" title="ç¬¬å››ç«  javaå¹¶å‘ç¼–ç¨‹"></a>ç¬¬å››ç«  javaå¹¶å‘ç¼–ç¨‹</h2><p>Javaä»è¯ç”Ÿå¼€å§‹å°±æ˜æ™ºåœ°é€‰æ‹©äº†å†…ç½®å¯¹å¤šçº¿ç¨‹çš„æ”¯æŒï¼Œè¿™ä½¿å¾—Javaè¯­è¨€ç›¸æ¯”åŒä¸€æ—¶æœŸçš„å…¶ä»–è¯­è¨€å…·æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚</p>
<p>çº¿ç¨‹ä½œä¸ºæ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•å…ƒï¼Œå¤šä¸ªçº¿ç¨‹èƒ½å¤ŸåŒæ—¶æ‰§è¡Œï¼ˆå¤šæ ¸åŒæ—¶ï¼Œå•æ ¸å¹¶å‘ï¼‰ï¼Œè¿™å°†æ˜¾è‘—æå‡ç¨‹åºæ€§èƒ½ï¼Œåœ¨å¤šæ ¸ç¯å¢ƒä¸­è¡¨ç°å¾—æ›´åŠ æ˜æ˜¾ã€‚ä½†æ˜¯ï¼Œè¿‡å¤šåœ°åˆ›å»ºçº¿ç¨‹å’Œå¯¹çº¿ç¨‹çš„ä¸å½“ç®¡ç†ä¹Ÿå®¹æ˜“é€ æˆé—®é¢˜ã€‚</p>
<h3 id="1-çº¿ç¨‹ç®€ä»‹"><a href="#1-çº¿ç¨‹ç®€ä»‹" class="headerlink" title="1.çº¿ç¨‹ç®€ä»‹"></a>1.çº¿ç¨‹ç®€ä»‹</h3><h4 id="âœ…ä»€ä¹ˆæ˜¯çº¿ç¨‹"><a href="#âœ…ä»€ä¹ˆæ˜¯çº¿ç¨‹" class="headerlink" title="âœ…ä»€ä¹ˆæ˜¯çº¿ç¨‹"></a>âœ…ä»€ä¹ˆæ˜¯çº¿ç¨‹</h4><p>ç°ä»£æ“ä½œç³»ç»Ÿåœ¨è¿è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼Œä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ã€‚æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•å…ƒæ˜¯çº¿ç¨‹ï¼Œä¹Ÿå«è½»é‡çº§è¿›ç¨‹ï¼ˆLight Weight Processï¼‰ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œå¯ä»¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹éƒ½æ‹¥æœ‰å„è‡ªçš„è®¡æ•°å™¨ã€å †æ ˆå’Œå±€éƒ¨å˜é‡ç­‰å±æ€§ï¼Œå¹¶ä¸”èƒ½å¤Ÿè®¿é—®å…±äº«çš„å†…å­˜å˜é‡ã€‚</p>
<p>å¤„ç†å™¨åœ¨è¿™äº›çº¿ç¨‹ä¸Šé«˜é€Ÿåˆ‡æ¢ï¼Œè®©ä½¿ç”¨è€…æ„Ÿè§‰åˆ°è¿™äº›çº¿ç¨‹åœ¨åŒæ—¶æ‰§è¡Œã€‚</p>
<p>Javaç¨‹åºå¤©ç”Ÿå°±æ˜¯å¤šçº¿ç¨‹ç¨‹åºï¼Œä½¿ç”¨JMXæ¥æŸ¥çœ‹ä¸€ä¸ªæ™®é€šçš„Javaç¨‹åºåŒ…å«å“ªäº›çº¿ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class MultiThread&#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // è·å–Javaçº¿ç¨‹ç®¡ç† MXBean</span><br><span class="line">        ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();</span><br><span class="line">        // ä¸éœ€è¦è·å–åŒæ­¥çš„ monitor å’Œ synchronizer ä¿¡æ¯ï¼Œä»…è·å–çº¿ç¨‹å’Œçº¿ç¨‹å †æ ˆä¿¡æ¯</span><br><span class="line">        ThreadInfo[] threadInfos = threadMXBean.dumpAllThreads(false, false);</span><br><span class="line">        // éå†çº¿ç¨‹ä¿¡æ¯ï¼Œä»…æ‰“å°çº¿ç¨‹ ID å’Œ çº¿ç¨‹åç§°ä¿¡æ¯</span><br><span class="line">        for (ThreadInfo threadInfo : threadInfos) &#123;</span><br><span class="line">            System.out.println(&quot;[&quot; + threadInfo.getThreadId() + &quot;] &quot; + threadInfo.getThreadName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="âœ…ä¸ºä»€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹"><a href="#âœ…ä¸ºä»€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹" class="headerlink" title="âœ…ä¸ºä»€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹"></a>âœ…ä¸ºä»€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹</h4><p>1ã€æ›´å¤šçš„å¤„ç†å™¨æ ¸å¿ƒ<br>å¦‚æœè¯¥ç¨‹åºä½¿ç”¨å¤šçº¿ç¨‹æŠ€æœ¯ï¼Œå°†è®¡ç®—é€»è¾‘åˆ†é…åˆ°å¤šä¸ªå¤„ç†å™¨æ ¸å¿ƒä¸Šï¼Œå°±ä¼šæ˜¾è‘—å‡å°‘ç¨‹åºçš„å¤„ç†æ—¶é—´ï¼Œå¹¶ä¸”éšç€æ›´å¤šå¤„ç†å™¨æ ¸å¿ƒçš„åŠ å…¥è€Œå˜å¾—æ›´æœ‰æ•ˆç‡ã€‚</p>
<p>2ã€æ›´å¿«çš„å“åº”æ—¶é—´<br>ä½¿ç”¨å¤šçº¿ç¨‹æŠ€æœ¯ï¼Œå°†æ•°æ®ä¸€è‡´æ€§ä¸å¼ºçš„æ“ä½œæ´¾å‘ç»™ä¸åŒçº¿ç¨‹å¤„ç†ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿå¯ä»¥åšåˆ°ï¼‰ï¼Œå“åº”ç”¨æˆ·è¯·æ±‚çš„çº¿ç¨‹èƒ½å¤Ÿå°½å¯èƒ½å¿«åœ°å¤„ç†å®Œæˆï¼Œç¼©çŸ­äº†å“åº”æ—¶é—´ï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒã€‚</p>
<p>3ã€æ›´å¥½çš„ç¼–ç¨‹æ¨¡å¼<br>Javaä¸ºå¤šçº¿ç¨‹ç¼–ç¨‹æä¾›äº†è‰¯å¥½ã€è€ƒç©¶å¹¶ä¸”ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´åŠ ä¸“æ³¨äºé—®é¢˜çš„è§£å†³</p>
<h4 id="âœ…çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#âœ…çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="âœ…çº¿ç¨‹ä¼˜å…ˆçº§"></a>âœ…çº¿ç¨‹ä¼˜å…ˆçº§</h4><p>ç°ä»£æ“ä½œç³»ç»ŸåŸºæœ¬é‡‡ç”¨æ—¶åˆ†çš„å½¢å¼è°ƒåº¦è¿è¡Œçš„çº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ†å‡ºä¸€ä¸ªä¸ªæ—¶é—´ç‰‡ï¼Œçº¿ç¨‹ä¼šåˆ†é…åˆ°è‹¥å¹²æ—¶é—´ç‰‡ï¼Œå½“çº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œäº†å°±ä¼šå‘ç”Ÿçº¿ç¨‹è°ƒåº¦ï¼Œå¹¶ç­‰å¾…ç€ä¸‹æ¬¡åˆ†é…ã€‚</p>
<p>æ—¶é—´ç‰‡å°±æ˜¯åˆ†é…ç»™çº¿ç¨‹çš„å¤„ç†å™¨èµ„æºï¼Œåœ¨Javaçº¿ç¨‹ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªæ•´å‹æˆå‘˜å˜é‡priorityæ¥æ§åˆ¶ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§çš„èŒƒå›´ä»1~10ï¼Œåœ¨çº¿ç¨‹æ„å»ºçš„æ—¶å€™å¯ä»¥é€šè¿‡setPriority(int)æ–¹æ³•æ¥ä¿®æ”¹ä¼˜å…ˆçº§ï¼Œé»˜è®¤ä¼˜å…ˆçº§æ˜¯5ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡çš„æ•°é‡è¦å¤šäºä¼˜å…ˆçº§ä½çš„çº¿ç¨‹ã€‚</p>
<p>è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§æ—¶ï¼Œé’ˆå¯¹é¢‘ç¹é˜»å¡ï¼ˆä¼‘çœ æˆ–è€…I&#x2F;Oæ“ä½œï¼‰çš„çº¿ç¨‹éœ€è¦è®¾ç½®è¾ƒé«˜ä¼˜å…ˆçº§ï¼Œè€Œåé‡è®¡ç®—ï¼ˆéœ€è¦è¾ƒå¤šCPUæ—¶é—´æˆ–è€…åè¿ç®—ï¼‰çš„çº¿ç¨‹åˆ™è®¾ç½®è¾ƒä½çš„ä¼˜å…ˆçº§ï¼Œç¡®ä¿å¤„ç†å™¨ä¸ä¼šè¢«ç‹¬å ã€‚</p>
<p>ä¸€ä¸ªè®¡æ•°çº¿ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">static class Job implements Runnable &#123;</span><br><span class="line">            private int priority;</span><br><span class="line">            private long jobCount;</span><br><span class="line">            public Job(int priority) &#123;</span><br><span class="line">                    this.priority = priority;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public void run() &#123;</span><br><span class="line">                while (notStart) &#123;</span><br><span class="line">                    Thread.yield();</span><br><span class="line">                &#125;</span><br><span class="line">                while (notEnd) &#123;</span><br><span class="line">                    Thread.yield();</span><br><span class="line">                    jobCount++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹10så¤šä¸ªä¸åŒä¼˜å…ˆçº§çš„è®¡æ•°ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå¿½ç•¥å¯¹çº¿ç¨‹ä¼˜å…ˆçº§çš„è®¾å®šã€‚</p>
<h4 id="âœ…çº¿ç¨‹çš„çŠ¶æ€"><a href="#âœ…çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="âœ…çº¿ç¨‹çš„çŠ¶æ€"></a>âœ…çº¿ç¨‹çš„çŠ¶æ€</h4><p>çº¿ç¨‹åˆ›å»ºä¹‹åï¼Œè°ƒç”¨start()æ–¹æ³•å¼€å§‹è¿è¡Œã€‚å½“çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆé‡Šæ”¾é”ï¼‰ã€‚</p>
<p>è¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹éœ€è¦ä¾é å…¶ä»–çº¿ç¨‹çš„é€šçŸ¥æ‰èƒ½å¤Ÿè¿”å›åˆ°è¿è¡ŒçŠ¶æ€ï¼Œè€Œè¶…æ—¶ç­‰å¾…çŠ¶æ€ç›¸å½“äºåœ¨ç­‰å¾…çŠ¶æ€çš„åŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¶…æ—¶æ—¶é—´åˆ°è¾¾æ—¶å°†ä¼šè¿”å›åˆ°è¿è¡ŒçŠ¶æ€ã€‚</p>
<p>å½“çº¿ç¨‹è°ƒç”¨åŒæ­¥æ–¹æ³•æ—¶ï¼Œåœ¨æ²¡æœ‰è·å–åˆ°é”çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å°†ä¼šè¿›å…¥åˆ°é˜»å¡çŠ¶æ€ã€‚çº¿ç¨‹åœ¨æ‰§è¡ŒRunnableçš„run()æ–¹æ³•ä¹‹åå°†ä¼šè¿›å…¥åˆ°ç»ˆæ­¢çŠ¶æ€ã€‚</p>
<p>ç­‰å¾…å’Œè¶…æ—¶ç­‰å¾…çš„åŒºåˆ«ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//è¯¥çº¿ç¨‹åœ¨waiting.classå®ä¾‹ä¸Šç­‰å¾…</span><br><span class="line">static class Waiting implements Runnable &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            synchronized (Waiting.class) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Waiting.class.wait();</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//è¯¥çº¿ç¨‹ä¸æ–­è¿›è¡Œç¡çœ ï¼Œè¶…æ—¶ç­‰å¾…</span><br><span class="line">static class TimeWaiting implements Runnable &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            SleepUtils.second(100);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Javaå°†æ“ä½œç³»ç»Ÿä¸­çš„è¿è¡Œå’Œå°±ç»ªä¸¤ä¸ªçŠ¶æ€åˆå¹¶ç§°ä¸ºè¿è¡ŒçŠ¶æ€ã€‚<br>é˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹é˜»å¡åœ¨è¿›å…¥synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—ï¼ˆè·å–é”ï¼‰æ—¶çš„çŠ¶æ€ï¼Œä½†æ˜¯é˜»å¡åœ¨java.concurrentåŒ…ä¸­Lockæ¥å£çš„çº¿ç¨‹çŠ¶æ€å´æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œå› ä¸ºjava.concurrentåŒ…ä¸­Lockæ¥å£å¯¹äºé˜»å¡çš„å®ç°å‡ä½¿ç”¨äº†LockSupportç±»ä¸­çš„ç›¸å…³æ–¹æ³•ã€‚</p>
</blockquote>
<h4 id="âœ…Daemonçº¿ç¨‹"><a href="#âœ…Daemonçº¿ç¨‹" class="headerlink" title="âœ…Daemonçº¿ç¨‹"></a>âœ…Daemonçº¿ç¨‹</h4><p>å®ˆæŠ¤çº¿ç¨‹ã€‚</p>
<p>Daemonçº¿ç¨‹æ˜¯ä¸€ç§æ”¯æŒå‹çº¿ç¨‹ï¼Œå› ä¸ºå®ƒä¸»è¦è¢«ç”¨ä½œç¨‹åºä¸­åå°è°ƒåº¦ä»¥åŠæ”¯æŒæ€§å·¥ä½œã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ªJavaè™šæ‹Ÿæœºä¸­ä¸å­˜åœ¨éDaemonçº¿ç¨‹çš„æ—¶å€™ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šé€€å‡ºï¼Œæ‰€æœ‰Daemonçº¿ç¨‹éƒ½éœ€è¦ç«‹å³ç»ˆæ­¢ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨Thread.setDaemon(true)å°†çº¿ç¨‹è®¾ç½®ä¸ºDaemonçº¿ç¨‹ã€‚</p>
<p>Daemonå±æ€§éœ€è¦åœ¨å¯åŠ¨çº¿ç¨‹ä¹‹å‰è®¾ç½®ï¼Œä¸èƒ½åœ¨å¯åŠ¨çº¿ç¨‹ä¹‹åè®¾ç½®ã€‚Daemonçº¿ç¨‹è¢«ç”¨ä½œå®Œæˆæ”¯æŒæ€§å·¥ä½œï¼Œä½†æ˜¯åœ¨Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶Daemonçº¿ç¨‹ä¸­çš„finallyå—å¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œã€‚å› æ­¤ï¼Œä¸èƒ½ä¾é finallyå—ä¸­çš„å†…å®¹æ¥ç¡®ä¿æ‰§è¡Œå…³é—­æˆ–æ¸…ç†èµ„æºçš„é€»è¾‘ã€‚</p>
<h3 id="2-å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹"><a href="#2-å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹" class="headerlink" title="2.å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹"></a>2.å¯åŠ¨å’Œç»ˆæ­¢çº¿ç¨‹</h3><p>è°ƒç”¨startæ–¹æ³•è¿›è¡Œå¯åŠ¨çº¿ç¨‹ï¼Œéšç€runæ–¹æ³•çš„æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹éšä¹‹ç»ˆæ­¢ã€‚</p>
<h4 id="âœ…æ„é€ çº¿ç¨‹"><a href="#âœ…æ„é€ çº¿ç¨‹" class="headerlink" title="âœ…æ„é€ çº¿ç¨‹"></a>âœ…æ„é€ çº¿ç¨‹</h4><p>åœ¨è¿è¡Œçº¿ç¨‹ä¹‹å‰é¦–å…ˆè¦æ„é€ ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œçº¿ç¨‹å¯¹è±¡åœ¨æ„é€ çš„æ—¶å€™éœ€è¦æä¾›çº¿ç¨‹æ‰€éœ€è¦çš„å±æ€§ï¼Œå¦‚çº¿ç¨‹æ‰€å±çš„çº¿ç¨‹ç»„ã€çº¿ç¨‹ä¼˜å…ˆçº§ã€æ˜¯å¦æ˜¯Daemonçº¿ç¨‹ç­‰ä¿¡æ¯ã€‚</p>
<p>ä¸ªæ–°æ„é€ çš„çº¿ç¨‹å¯¹è±¡æ˜¯ç”±å…¶parentçº¿ç¨‹æ¥è¿›è¡Œç©ºé—´åˆ†é…çš„ï¼Œè€Œchildçº¿ç¨‹ç»§æ‰¿äº†parentæ˜¯å¦ä¸ºDaemonã€ä¼˜å…ˆçº§å’ŒåŠ è½½èµ„æºçš„contextClassLoaderä»¥åŠå¯ç»§æ‰¿çš„ThreadLocalï¼ŒåŒæ—¶è¿˜ä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDæ¥æ ‡è¯†è¿™ä¸ªchildçº¿ç¨‹ã€‚</p>
<p>ä¸€ä¸ªèƒ½å¤Ÿè¿è¡Œçš„çº¿ç¨‹å¯¹è±¡å°±åˆå§‹åŒ–å¥½äº†ï¼Œåœ¨å †å†…å­˜ä¸­ç­‰å¾…ç€è¿è¡Œã€‚</p>
<h4 id="âœ…å¯åŠ¨çº¿ç¨‹"><a href="#âœ…å¯åŠ¨çº¿ç¨‹" class="headerlink" title="âœ…å¯åŠ¨çº¿ç¨‹"></a>âœ…å¯åŠ¨çº¿ç¨‹</h4><p>çº¿ç¨‹å¯¹è±¡åœ¨åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œè°ƒç”¨start()æ–¹æ³•å°±å¯ä»¥å¯åŠ¨è¿™ä¸ªçº¿ç¨‹ã€‚</p>
<p>çº¿ç¨‹start()æ–¹æ³•çš„å«ä¹‰æ˜¯ï¼šå½“å‰çº¿ç¨‹ï¼ˆå³parentçº¿ç¨‹ï¼‰åŒæ­¥å‘ŠçŸ¥Javaè™šæ‹Ÿæœºï¼Œåªè¦çº¿ç¨‹è§„åˆ’å™¨ç©ºé—²ï¼Œåº”ç«‹å³å¯åŠ¨è°ƒç”¨start()æ–¹æ³•çš„çº¿ç¨‹ã€‚</p>
<h4 id="âœ…ä¸­æ–­çº¿ç¨‹"><a href="#âœ…ä¸­æ–­çº¿ç¨‹" class="headerlink" title="âœ…ä¸­æ–­çº¿ç¨‹"></a>âœ…ä¸­æ–­çº¿ç¨‹</h4><p>ä¸­æ–­ï¼Œæ•ˆæœæ˜¯ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºçº¿ç¨‹çš„ä¸€ä¸ªæ ‡è¯†ä½å±æ€§ ï¼ˆå¹¶ä¸èƒ½ç›´æ¥ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªè¿è¡Œä¸­çš„çº¿ç¨‹æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹è¿›è¡Œäº†ä¸­æ–­æ“ä½œã€‚</p>
<p>ä¸­æ–­å¥½æ¯”å…¶ä»–çº¿ç¨‹å¯¹è¯¥çº¿ç¨‹æ‰“äº†ä¸ªæ‹›å‘¼ï¼Œå…¶ä»–çº¿ç¨‹é€šè¿‡è°ƒç”¨è¯¥çº¿ç¨‹çš„ interrupt() æ–¹æ³•å¯¹å…¶è¿›è¡Œä¸­æ–­æ“ä½œã€‚çº¿ç¨‹é€šè¿‡æ£€æŸ¥è‡ªèº«æ˜¯å¦è¢«ä¸­æ–­æ¥è¿›è¡Œå“åº”ï¼Œçº¿ç¨‹é€šè¿‡æ–¹æ³• isInterrupted() æ¥è¿›è¡Œåˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­ã€‚</p>
<p>ä»Javaçš„APIä¸­å¯ä»¥çœ‹åˆ°ï¼Œè®¸å¤šå£°æ˜æŠ›å‡ºInterruptedExceptionçš„æ–¹æ³•ï¼ˆä¾‹å¦‚Thread.sleep ï¼ˆlong millisï¼‰æ–¹æ³•ï¼‰è¿™äº›æ–¹æ³•åœ¨æŠ›å‡ºInterruptedExceptionä¹‹å‰ï¼ŒJavaè™šæ‹Ÿæœºä¼šå…ˆå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡è¯†ä½æ¸…é™¤ï¼Œç„¶åæŠ›å‡ºInterruptedExceptionï¼Œæ­¤æ—¶è°ƒç”¨isInterrupted()æ–¹æ³•å°†ä¼šè¿”å›falseã€‚</p>
<p>å¦‚ä¸‹æ‰€ç¤ºçš„ä¾‹å­ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ï¼ŒSleepThreadå’ŒBusyThreadï¼Œå‰è€…ä¸åœåœ°ç¡çœ ï¼Œåè€…ä¸€ç›´è¿è¡Œï¼Œç„¶åå¯¹è¿™ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è¿›è¡Œä¸­æ–­æ“ä½œï¼Œè§‚å¯ŸäºŒè€…çš„ä¸­æ–­æ ‡è¯†ä½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">public class Interrupted &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        // sleepThreadä¸åœçš„å°è¯•ç¡çœ </span><br><span class="line">        Thread sleepThread = new Thread(new SleepRunner(), &quot;SleepThread&quot;);</span><br><span class="line">        sleepThread.setDaemon(true);</span><br><span class="line">        // busyThreadä¸åœçš„è¿è¡Œ</span><br><span class="line">        Thread busyThread = new Thread(new BusyRunner(), &quot;BusyThread&quot;);</span><br><span class="line">        busyThread.setDaemon(true);</span><br><span class="line">        sleepThread.start();</span><br><span class="line">        busyThread.start();</span><br><span class="line">        // ä¼‘çœ 5ç§’ï¼Œè®©sleepThreadå’ŒbusyThreadå……åˆ†è¿è¡Œ</span><br><span class="line">        TimeUnit.SECONDS.sleep(5);</span><br><span class="line">        sleepThread.interrupt();</span><br><span class="line">        busyThread.interrupt();</span><br><span class="line">        System.out.println(&quot;SleepThread interrupted is &quot; + sleepThread.isInterrupted());</span><br><span class="line">        System.out.println(&quot;BusyThread interrupted is &quot; + busyThread.isInterrupted());</span><br><span class="line">        // é˜²æ­¢sleepThreadå’ŒbusyThreadç«‹åˆ»é€€å‡º</span><br><span class="line">        Thread.sleep(2000);</span><br><span class="line">    &#125;</span><br><span class="line">    static class SleepRunner implements Runnable &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(10000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    // å¯¹äºSleepï¼Œå¦‚æœå‘ç”Ÿäº†ä¸­æ–­ï¼Œå°±ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ã€‚æŠ›å‡ºåï¼Œinterruptçš„è¡¨ç¤ºä½ä¼šè¢«é‡ç½®ã€‚</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    static class BusyRunner implements Runnable &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while (true) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒæŠ›å‡ºInterruptedExceptionçš„çº¿ç¨‹SleepThreadï¼Œå…¶ä¸­æ–­æ ‡è¯†ä½è¢«æ¸…é™¤äº†ï¼Œè¿”å›falseã€‚è€Œä¸€ç›´å¿™ç¢Œè¿ä½œçš„çº¿ç¨‹BusyThreadï¼Œä¸­æ–­æ ‡è¯†ä½æ²¡æœ‰è¢«æ¸…é™¤ï¼Œè¿”å›trueã€‚</p>
<h4 id="âœ…è¿‡æœŸçš„suspend-ã€resume-å’Œstop"><a href="#âœ…è¿‡æœŸçš„suspend-ã€resume-å’Œstop" class="headerlink" title="âœ…è¿‡æœŸçš„suspend()ã€resume()å’Œstop()"></a>âœ…è¿‡æœŸçš„suspend()ã€resume()å’Œstop()</h4><p>suspend()ã€resume()å’Œstop()æ–¹æ³•å®Œæˆäº†çº¿ç¨‹çš„æš‚åœã€æ¢å¤å’Œç»ˆæ­¢å·¥ä½œï¼Œè€Œä¸”éå¸¸â€œäººæ€§åŒ–â€ã€‚ä½†æ˜¯è¿™äº›APIæ˜¯è¿‡æœŸçš„ï¼Œä¹Ÿå°±æ˜¯ä¸å»ºè®®ä½¿ç”¨çš„ã€‚</p>
<p>ä¸å»ºè®®ä½¿ç”¨çš„åŸå› ä¸»è¦æ˜¯ï¼š</p>
<p>ä»¥suspend()æ–¹æ³•ä¸ºä¾‹ï¼Œåœ¨è°ƒç”¨åï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å·²ç»å æœ‰çš„èµ„æºï¼ˆæ¯”å¦‚é”ï¼‰ï¼Œè€Œæ˜¯å æœ‰ç€èµ„æºè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œè¿™æ ·å®¹æ˜“å¼•å‘æ­»é”é—®é¢˜ã€‚<br>åŒæ ·ï¼Œstop()æ–¹æ³•åœ¨ç»ˆç»“ä¸€ä¸ªçº¿ç¨‹æ—¶ä¸ä¼šä¿è¯çº¿ç¨‹çš„èµ„æºæ­£å¸¸é‡Šæ”¾ï¼Œé€šå¸¸æ˜¯æ²¡æœ‰ç»™äºˆçº¿ç¨‹å®Œæˆèµ„æºé‡Šæ”¾å·¥ä½œçš„æœºä¼šï¼Œå› æ­¤ä¼šå¯¼è‡´ç¨‹åºå¯èƒ½å·¥ä½œåœ¨ä¸ç¡®å®šçŠ¶æ€ä¸‹ã€‚</p>
<p>æš‚åœå’Œæ¢å¤æ“ä½œå¯ä»¥ç”¨åé¢æåˆ°çš„ç­‰å¾…&#x2F;é€šçŸ¥æœºåˆ¶æ¥æ›¿ä»£ã€‚</p>
<h4 id="âœ…å®‰å…¨åœ°ç»ˆæ­¢çº¿ç¨‹"><a href="#âœ…å®‰å…¨åœ°ç»ˆæ­¢çº¿ç¨‹" class="headerlink" title="âœ…å®‰å…¨åœ°ç»ˆæ­¢çº¿ç¨‹"></a>âœ…å®‰å…¨åœ°ç»ˆæ­¢çº¿ç¨‹</h4><p>ä¸­æ–­çŠ¶æ€æ˜¯çº¿ç¨‹çš„ä¸€ä¸ªæ ‡è¯†ä½ï¼Œè€Œä¸­æ–­æ“ä½œæ˜¯ä¸€ç§ç®€ä¾¿çš„çº¿ç¨‹é—´äº¤äº’æ–¹å¼ï¼Œè€Œè¿™ç§äº¤äº’æ–¹å¼æœ€é€‚åˆç”¨æ¥å–æ¶ˆæˆ–åœæ­¢ä»»åŠ¡ã€‚</p>
<p>é™¤äº†ä¸­æ–­ä»¥å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ä¸€ä¸ªbooleanå˜é‡æ¥æ§åˆ¶æ˜¯å¦éœ€è¦åœæ­¢ä»»åŠ¡å¹¶ç»ˆæ­¢è¯¥çº¿ç¨‹ã€‚</p>
<p>æ–¹æ³•1ï¼šä½¿ç”¨ä¸­æ–­interruptæ–¹æ³•è¿›è¡Œä¸­æ–­ã€‚æŒ‰è¯´æ˜¯ç›´æ¥ä¸­æ–­çº¿ç¨‹äº†ï¼Œæ²¡åŠ ä»£ç ä¸­çš„åˆ¤æ–­ä¹Ÿåº”è¯¥ä¸­æ–­çš„ã€‚â“<br>æ–¹æ³•2ï¼šä½¿ç”¨ä¸€ä¸ªvolatileçš„booleanç±»å‹å˜é‡æ¥æ§åˆ¶ï¼Œå®é™…ä¸Šæ˜¯ä¸­æ–­whileæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œå®Œrunæ–¹æ³•ï¼Œç»ˆæ­¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Shutdown &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        Runner one = new Runner();</span><br><span class="line">        Thread countThread = new Thread(one, &quot;CountThread&quot;);</span><br><span class="line">        countThread.start();</span><br><span class="line">        // ç¡çœ 1ç§’ï¼Œmainçº¿ç¨‹å¯¹CountThreadè¿›è¡Œä¸­æ–­ï¼Œä½¿CountThreadèƒ½å¤Ÿæ„ŸçŸ¥ä¸­æ–­è€Œç»“æŸ</span><br><span class="line">        TimeUnit.SECONDS.sleep(1);</span><br><span class="line">        countThread.interrupt();</span><br><span class="line">        Runner two = new Runner();</span><br><span class="line">        countThread = new Thread(two, &quot;CountThread&quot;);</span><br><span class="line">        countThread.start();</span><br><span class="line">        // ç¡çœ 1ç§’ï¼Œmainçº¿ç¨‹å¯¹Runner twoè¿›è¡Œå–æ¶ˆï¼Œä½¿CountThreadèƒ½å¤Ÿæ„ŸçŸ¥onä¸ºfalseè€Œç»“æŸ</span><br><span class="line">        TimeUnit.SECONDS.sleep(1);</span><br><span class="line">        two.cancel();</span><br><span class="line">    &#125;</span><br><span class="line">    private static class Runner implements Runnable &#123;</span><br><span class="line">        private long i;</span><br><span class="line">            private volatile boolean on = true;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">            while (on &amp;&amp; !Thread.currentThread().isInterrupted())&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;Count i = &quot; + i);</span><br><span class="line">        &#125;</span><br><span class="line">        public void cancel() &#123;</span><br><span class="line">            on = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œmainçº¿ç¨‹é€šè¿‡ä¸­æ–­æ“ä½œå’Œcancel()æ–¹æ³•å‡å¯ä½¿CountThreadå¾—ä»¥ç»ˆæ­¢ã€‚</p>
<p>è¿™ç§é€šè¿‡æ ‡è¯†ä½æˆ–è€…ä¸­æ–­æ“ä½œçš„æ–¹å¼èƒ½å¤Ÿä½¿çº¿ç¨‹åœ¨ç»ˆæ­¢æ—¶æœ‰æœºä¼šå»æ¸…ç†èµ„æºï¼Œè€Œä¸æ˜¯æ­¦æ–­åœ°å°†çº¿ç¨‹åœæ­¢ï¼Œå› æ­¤è¿™ç§ç»ˆæ­¢çº¿ç¨‹çš„åšæ³•æ˜¾å¾—æ›´åŠ å®‰å…¨å’Œä¼˜é›…ã€‚</p>
<h3 id="3-çº¿ç¨‹é—´é€šä¿¡"><a href="#3-çº¿ç¨‹é—´é€šä¿¡" class="headerlink" title="3.çº¿ç¨‹é—´é€šä¿¡"></a>3.çº¿ç¨‹é—´é€šä¿¡</h3><p>çº¿ç¨‹å¼€å§‹è¿è¡Œï¼Œæ‹¥æœ‰è‡ªå·±çš„æ ˆç©ºé—´ï¼Œå°±å¦‚åŒä¸€ä¸ªè„šæœ¬ä¸€æ ·ï¼ŒæŒ‰ç…§æ—¢å®šçš„ä»£ç ä¸€æ­¥ä¸€æ­¥åœ°æ‰§è¡Œï¼Œç›´åˆ°ç»ˆæ­¢ã€‚å¤šä¸ªçº¿ç¨‹é…åˆå·¥ä½œï¼Œæ‰æ›´æœ‰ä»·å€¼ã€‚</p>
<h4 id="âœ…volatileå’Œsynchronizedå…³é”®å­—"><a href="#âœ…volatileå’Œsynchronizedå…³é”®å­—" class="headerlink" title="âœ…volatileå’Œsynchronizedå…³é”®å­—"></a>âœ…volatileå’Œsynchronizedå…³é”®å­—</h4><p>èƒŒæ™¯ï¼š<br>Javaæ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå¯¹è±¡æˆ–è€…å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œç”±äºæ¯ä¸ªçº¿ç¨‹å¯ä»¥æ‹¥æœ‰è¿™ä¸ªå˜é‡çš„æ‹·è´ï¼ˆè™½ç„¶å¯¹è±¡ä»¥åŠæˆå‘˜å˜é‡åˆ†é…çš„å†…å­˜æ˜¯åœ¨å…±äº«å†…å­˜ä¸­çš„ï¼Œä½†æ˜¯æ¯ä¸ªæ‰§è¡Œçš„çº¿ç¨‹è¿˜å¯ä»¥æ‹¥æœ‰ä¸€ä»½æ‹·è´ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯åŠ é€Ÿç¨‹åºçš„æ‰§è¡Œï¼Œè¿™æ˜¯ç°ä»£å¤šæ ¸å¤„ç†å™¨çš„ä¸€ä¸ªæ˜¾è‘—ç‰¹æ€§ï¼‰ï¼ˆå°±æ˜¯çº¿ç¨‹çš„æœ¬åœ°å†…å­˜ï¼‰ï¼Œæ‰€ä»¥ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹çœ‹åˆ°çš„å˜é‡å¹¶ä¸ä¸€å®šæ˜¯æœ€æ–°çš„ã€‚</p>
<p>volatileæ€ä¹ˆè§£å†³ï¼š<br>å…³é”®å­—volatileå¯ä»¥ç”¨æ¥ä¿®é¥°å­—æ®µï¼ˆæˆå‘˜å˜é‡ï¼‰ï¼Œå°±æ˜¯å‘ŠçŸ¥ç¨‹åºä»»ä½•å¯¹è¯¥å˜é‡çš„è®¿é—®å‡éœ€è¦ä»å…±äº«å†…å­˜ä¸­è·å–ï¼Œè€Œå¯¹å®ƒçš„æ”¹å˜å¿…é¡»åŒæ­¥åˆ·æ–°å›å…±äº«å†…å­˜ï¼Œå®ƒèƒ½ä¿è¯æ‰€æœ‰çº¿ç¨‹å¯¹å˜é‡è®¿é—®çš„å¯è§æ€§ã€‚</p>
<p>sychronizedæ€ä¹ˆè§£å†³ï¼š<br>å…³é”®å­—synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•æˆ–è€…ä»¥åŒæ­¥å—çš„å½¢å¼æ¥è¿›è¡Œä½¿ç”¨ï¼Œå®ƒä¸»è¦ç¡®ä¿å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¤„äºæ–¹æ³•æˆ–è€…åŒæ­¥å—ä¸­ï¼Œå®ƒä¿è¯äº†çº¿ç¨‹å¯¹å˜é‡è®¿é—®çš„å¯è§æ€§å’Œæ’ä»–æ€§ã€‚</p>
<p>ä¸€ç‚¹sychronizedçš„å®ç°åŸç†ï¼š</p>
<p>çœ‹å­—èŠ‚ç æ–‡ä»¶ï¼Œmonitorenterå’ŒmonitorexitæŒ‡ä»¤ï¼Œæ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨çš„è·å–ï¼Œè¿™ä¸ªè·å–è¿‡ç¨‹æ˜¯æ’ä»–çš„ï¼Œä¸€ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°ç”±sychronizedä¿æŠ¤çš„å¯¹è±¡çš„ç›‘è§†å™¨ã€‚</p>
<p>ä»»æ„ä¸€ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰è‡ªå·±çš„ç›‘è§†å™¨ï¼Œå½“è¿™ä¸ªå¯¹è±¡ç”±åŒæ­¥å—æˆ–è€…è¿™ä¸ªå¯¹è±¡çš„åŒæ­¥æ–¹æ³•è°ƒç”¨æ—¶ï¼Œæ‰§è¡Œæ–¹æ³•çš„çº¿ç¨‹å¿…é¡»å…ˆè·å–åˆ°è¯¥å¯¹è±¡çš„ç›‘è§†å™¨æ‰èƒ½è¿›å…¥åŒæ­¥å—æˆ–è€…åŒæ­¥æ–¹æ³•ï¼Œè€Œæ²¡æœ‰è·å–åˆ°ç›‘è§†å™¨ï¼ˆæ‰§è¡Œè¯¥æ–¹æ³•ï¼‰çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡åœ¨åŒæ­¥å—å’ŒåŒæ­¥æ–¹æ³•çš„å…¥å£å¤„ï¼ˆè¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼‰ï¼Œè¿›å…¥BLOCKEDçŠ¶æ€ã€‚å½“è·é”çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œè¯¥é‡Šæ”¾æ“ä½œå”¤é†’é˜»å¡åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œé‡æ–°å°è¯•å¯¹ç›‘è§†å™¨çš„è·å–ã€‚</p>
<h4 id="âœ…ç­‰å¾…-é€šçŸ¥æœºåˆ¶"><a href="#âœ…ç­‰å¾…-é€šçŸ¥æœºåˆ¶" class="headerlink" title="âœ…ç­‰å¾…&#x2F;é€šçŸ¥æœºåˆ¶"></a>âœ…ç­‰å¾…&#x2F;é€šçŸ¥æœºåˆ¶</h4><p>èƒŒæ™¯ï¼šç”Ÿäº§è€…çº¿ç¨‹ä¿®æ”¹æŸä¸ªå˜é‡çš„å€¼ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹èƒ½å¤Ÿæ„ŸçŸ¥åˆ°ã€‚ç®€å•çš„åŠæ³•æ˜¯è®©æ¶ˆè´¹è€…çº¿ç¨‹ä¸æ–­åœ°å¾ªç¯æ£€æŸ¥å˜é‡æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ä½†æ˜¯å¼€é”€å¤§ã€‚</p>
<p>Javaé€šè¿‡å†…ç½®çš„ç­‰å¾…&#x2F;é€šçŸ¥æœºåˆ¶èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³è¿™ä¸ªçŸ›ç›¾å¹¶å®ç°æ‰€éœ€çš„åŠŸèƒ½ã€‚<br>ç­‰å¾…&#x2F;é€šçŸ¥çš„ç›¸å…³æ–¹æ³•æ˜¯ä»»æ„Javaå¯¹è±¡éƒ½å…·å¤‡çš„ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•è¢«å®šä¹‰åœ¨æ‰€æœ‰å¯¹è±¡çš„è¶…ç±»java.lang.Objectä¸Šã€‚ï¼ˆç›‘è§†å™¨æ–¹æ³•ï¼‰</p>
<p>ç­‰å¾…&#x2F;é€šçŸ¥æœºåˆ¶ï¼Œæ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨äº†å¯¹è±¡Oçš„wait()æ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹Bè°ƒç”¨äº†å¯¹è±¡Oçš„notify()æˆ–è€…notifyAll()æ–¹æ³•ï¼Œçº¿ç¨‹Aæ”¶åˆ°é€šçŸ¥åä»å¯¹è±¡Oçš„wait()æ–¹æ³•è¿”å›ï¼Œè¿›è€Œæ‰§è¡Œåç»­æ“ä½œã€‚<br>ä¸Šè¿°ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡å¯¹è±¡Oæ¥å®Œæˆäº¤äº’ï¼Œè€Œå¯¹è±¡ä¸Šçš„wait()å’Œnotify&#x2F;notifyAll()çš„å…³ç³»å°±å¦‚åŒå¼€å…³ä¿¡å·ä¸€æ ·ï¼Œç”¨æ¥å®Œæˆç­‰å¾…æ–¹å’Œé€šçŸ¥æ–¹ä¹‹é—´çš„äº¤äº’å·¥ä½œã€‚ï¼ˆä¸¤ä¸ªnotifyéƒ½æ˜¯é€šçŸ¥ç­‰å¾…é˜Ÿåˆ—é‡Œçš„ï¼Œä¸æ˜¯é˜»å¡çŠ¶æ€çš„åŒæ­¥é˜Ÿåˆ—ï¼Œnotifyé€šçŸ¥ä¸€ä¸ªï¼ŒnotifyAllé€šçŸ¥æ‰€æœ‰ï¼‰ã€‚</p>
<p>ä¾‹å­ï¼šåˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹â€”â€”WaitThreadå’ŒNotifyThreadï¼Œå‰è€…æ£€æŸ¥flagå€¼æ˜¯å¦ä¸ºfalseï¼Œå¦‚æœç¬¦åˆè¦æ±‚ï¼Œè¿›è¡Œåç»­æ“ä½œï¼Œå¦åˆ™åœ¨lockä¸Šç­‰å¾…ï¼Œåè€…åœ¨ç¡çœ äº†ä¸€æ®µæ—¶é—´åå¯¹lockè¿›è¡Œé€šçŸ¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class WaitNotify &#123;</span><br><span class="line">    static boolean flag = true;</span><br><span class="line">    static Object lock = new Object();</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        Thread waitThread = new Thread(new Wait(), &quot;WaitThread&quot;);</span><br><span class="line">        waitThread.start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(1);</span><br><span class="line">        Thread notifyThread = new Thread(new Notify(), &quot;NotifyThread&quot;);</span><br><span class="line">        notifyThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">    static class Wait implements Runnable &#123;</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            // åŠ é”ï¼Œæ‹¥æœ‰lockçš„Monitor</span><br><span class="line">            synchronized (lock) &#123;</span><br><span class="line">                // å½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œç»§ç»­waitï¼ŒåŒæ—¶é‡Šæ”¾äº†lockçš„é”</span><br><span class="line">                while (flag) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        System.out.println(Thread.currentThread() + &quot; flag is true. wait@ &quot; + new SimpleDateFormat(&quot;HH:mm:ss&quot;).format(new Date()));</span><br><span class="line">                        lock.wait();</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                // æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå®Œæˆå·¥ä½œ</span><br><span class="line">                System.out.println(Thread.currentThread() + &quot; flag is false. running@ &quot; + new SimpleDateFormat(&quot;HH:mm:ss&quot;).format(new Date()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    static class Notify implements Runnable &#123;</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            // åŠ é”ï¼Œæ‹¥æœ‰lockçš„Monitor</span><br><span class="line">            synchronized (lock) &#123;</span><br><span class="line">                // è·å–lockçš„é”ï¼Œç„¶åè¿›è¡Œé€šçŸ¥ï¼Œé€šçŸ¥æ—¶ä¸ä¼šé‡Šæ”¾lockçš„é”ï¼Œ</span><br><span class="line">                // ç›´åˆ°å½“å‰çº¿ç¨‹é‡Šæ”¾äº†lockåï¼ŒWaitThreadæ‰èƒ½ä»waitæ–¹æ³•ä¸­è¿”å›</span><br><span class="line">                System.out.println(Thread.currentThread() + &quot; hold lock. notify @ &quot; +</span><br><span class="line">                        new SimpleDateFormat(&quot;HH:mm:ss&quot;).format(new Date()));</span><br><span class="line">                lock.notifyAll();</span><br><span class="line">                flag = false;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(5000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    throw new RuntimeException(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            // å†æ¬¡åŠ é”</span><br><span class="line">            synchronized (lock) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread() + &quot; hold lock again. sleep@ &quot; + new SimpleDateFormat(&quot;HH:mm:ss&quot;).format(new Date()));</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(5000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    throw new RuntimeException(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨wait()ã€notify()ä»¥åŠnotifyAll()æ—¶éœ€è¦æ³¨æ„çš„ç»†èŠ‚:</p>
<p>1ã€ä½¿ç”¨wait()ã€notify()å’ŒnotifyAll()æ—¶éœ€è¦å…ˆå¯¹è°ƒç”¨å¯¹è±¡åŠ é”ã€‚</p>
<p>2ã€è°ƒç”¨wait()æ–¹æ³•åï¼Œçº¿ç¨‹çŠ¶æ€ç”±RUNNINGå˜ä¸ºWAITINGï¼Œå¹¶å°†å½“å‰çº¿ç¨‹æ”¾ç½®åˆ°å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶é‡Šæ”¾é”ã€‚</p>
<p>3ã€notify()æˆ–notifyAll()æ–¹æ³•è°ƒç”¨åï¼Œç­‰å¾…çº¿ç¨‹ä¾æ—§ä¸ä¼šä»wait()è¿”å›ï¼Œéœ€è¦è°ƒç”¨notify()æˆ–notifAll()çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œç­‰å¾…çº¿ç¨‹æ‰æœ‰æœºä¼šä»wait()è¿”å›ã€‚</p>
<p>4ã€notify()æ–¹æ³•å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè€ŒnotifyAll()æ–¹æ³•åˆ™æ˜¯å°†ç­‰å¾…é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„çº¿ç¨‹å…¨éƒ¨ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œè¢«ç§»åŠ¨çš„çº¿ç¨‹çŠ¶æ€ç”±WAITINGå˜ä¸ºBLOCKEDã€‚</p>
<p>5ã€ä»wait()æ–¹æ³•è¿”å›çš„å‰ææ˜¯è·å¾—äº†è°ƒç”¨å¯¹è±¡çš„é”ã€‚<strong>ç­‰å¾…&#x2F;é€šçŸ¥æœºåˆ¶ä¾æ‰˜äºåŒæ­¥æœºåˆ¶</strong>ï¼Œå…¶ç›®çš„å°±æ˜¯ç¡®ä¿ç­‰å¾…çº¿ç¨‹ä»wait()æ–¹æ³•è¿”å›æ—¶èƒ½å¤Ÿæ„ŸçŸ¥åˆ°é€šçŸ¥çº¿ç¨‹å¯¹å˜é‡åšå‡ºçš„ä¿®æ”¹ï¼ˆä¹Ÿå°±æ˜¯flagå˜é‡ï¼‰ã€‚</p>
<p>æ¢³ç†ä¸€ä¸‹ç­‰å¾…çº¿ç¨‹çš„çŠ¶æ€å˜åŒ–ï¼š<br>1ã€waitçº¿ç¨‹é¦–å…ˆè·å–é”ï¼Œè°ƒç”¨lockçš„waitæ–¹æ³•ï¼Œæ”¾å¼ƒäº†é”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…çŠ¶æ€ã€‚ï¼ˆå¯ä»¥æœ‰å¾ˆå¤šä¸ªwaitçº¿ç¨‹ï¼‰<br>2ã€notifyçº¿ç¨‹è·å–äº†é”ï¼Œè°ƒç”¨lockçš„notifyæ–¹æ³•ï¼Œå°†waitçº¿ç¨‹ä»ç­‰å¾…é˜Ÿåˆ—ç§»åŠ¨åˆ°äº†åŒæ­¥é˜Ÿåˆ—ï¼Œæ˜¯é˜»å¡çŠ¶æ€ã€‚ï¼ˆnotifyåªèƒ½å”¤é†’ä¸€ä¸ªï¼‰<br>3ã€notifyçº¿ç¨‹è¿è¡Œå®Œäº†ï¼Œé‡Šæ”¾é”ï¼Œwaitçº¿ç¨‹è·å–åˆ°é”ï¼Œä»waitæ–¹æ³•è¿”å›å¹¶ç»§ç»­æ‰§è¡Œã€‚</p>
<p>sleepä¸ä¼šé‡Šæ”¾é”<br>waitä¼šé‡Šæ”¾é”</p>
<h4 id="âœ…ç­‰å¾…-é€šçŸ¥çš„ç»å…¸èŒƒå¼"><a href="#âœ…ç­‰å¾…-é€šçŸ¥çš„ç»å…¸èŒƒå¼" class="headerlink" title="âœ…ç­‰å¾…&#x2F;é€šçŸ¥çš„ç»å…¸èŒƒå¼"></a>âœ…ç­‰å¾…&#x2F;é€šçŸ¥çš„ç»å…¸èŒƒå¼</h4><p>èŒƒå¼åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«é’ˆå¯¹ç­‰å¾…æ–¹ï¼ˆæ¶ˆè´¹è€…ï¼‰å’Œé€šçŸ¥æ–¹ï¼ˆç”Ÿäº§è€…ï¼‰</p>
<p>ç­‰å¾…æ–¹éµå¾ªå¦‚ä¸‹åŸåˆ™ï¼š<br>1ã€è·å–å¯¹è±¡çš„é”ã€‚<br>2ã€å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼ˆflagå˜é‡ï¼‰ï¼Œé‚£ä¹ˆè°ƒç”¨å¯¹è±¡çš„wait()æ–¹æ³•ï¼Œè¢«é€šçŸ¥åä»è¦æ£€æŸ¥æ¡ä»¶ã€‚<br>3ã€æ¡ä»¶æ»¡è¶³åˆ™æ‰§è¡Œå¯¹åº”çš„é€»è¾‘ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">synchronized(å¯¹è±¡) &#123;</span><br><span class="line">	while(æ¡ä»¶ä¸æ»¡è¶³) &#123;</span><br><span class="line">		å¯¹è±¡.wait();</span><br><span class="line">	&#125;</span><br><span class="line">	å¯¹åº”çš„å¤„ç†é€»è¾‘</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šçŸ¥æ–¹éµå¾ªå¦‚ä¸‹åŸåˆ™ï¼š<br>1ã€è·å¾—å¯¹è±¡çš„é”ã€‚<br>2ã€æ”¹å˜æ¡ä»¶ã€‚<br>3ã€é€šçŸ¥æ‰€æœ‰ç­‰å¾…åœ¨å¯¹è±¡ä¸Šçš„çº¿ç¨‹ã€‚ï¼ˆå…ˆæ”¹å˜æ¡ä»¶è¿˜æ˜¯å…ˆé€šçŸ¥éƒ½è¡Œï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">synchronized(å¯¹è±¡) &#123;</span><br><span class="line">	æ”¹å˜æ¡ä»¶(flag)</span><br><span class="line">	å¯¹è±¡.notifyAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼š<br>1ã€flagçš„ç›®çš„ï¼šç›¸å½“äºæ˜¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå€¼ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹èƒ½æ„ŸçŸ¥åˆ°ï¼Œèµ·åˆ°ä¸€ä¸ªå¤šçº¿ç¨‹é€šä¿¡è¾¾åˆ°ä»€ä¹ˆæ¡ä»¶åšä»€ä¹ˆäº‹çš„æ•ˆæœã€‚<br>2ã€åŒæ­¥çš„ç›®çš„ï¼šè·å–äº†é”æ‰èƒ½waitå’Œnotifyï¼ŒåŒæ­¥çš„ç›®çš„æ˜¯æŠŠä¿®æ”¹å˜é‡å’ŒnotifyåŒ…åœ¨ä¸€èµ·ï¼Œè®©waitå‡ºæ¥çš„æ—¶å€™èƒ½æ„ŸçŸ¥åˆ°å˜é‡çš„å˜åŒ–ã€‚<br>3ã€å…¶å®è¿™ä¸ªæ¨¡å¼å·²ç»æ˜¯ååº•å±‚äº†ã€‚<br>4ã€flagå’Œlockå¯ä»¥ç”¨ä¸€ä¸ªï¼Œç›´æ¥ç”¨flagæ¥å½“é”ï¼ˆå°±åƒåé¢çš„æ‰‹å†™çº¿ç¨‹æ± ï¼‰</p>
<h4 id="âœ…ç®¡é“è¾“å…¥-è¾“å‡ºæµ"><a href="#âœ…ç®¡é“è¾“å…¥-è¾“å‡ºæµ" class="headerlink" title="âœ…ç®¡é“è¾“å…¥&#x2F;è¾“å‡ºæµ"></a>âœ…ç®¡é“è¾“å…¥&#x2F;è¾“å‡ºæµ</h4><p>ç®¡é“è¾“å…¥&#x2F;è¾“å‡ºæµå’Œæ™®é€šçš„æ–‡ä»¶è¾“å…¥&#x2F;è¾“å‡ºæµæˆ–è€…ç½‘ç»œè¾“å…¥&#x2F;è¾“å‡ºæµä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¸»è¦ç”¨äºçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œè€Œä¼ è¾“çš„åª’ä»‹ä¸ºå†…å­˜ã€‚</p>
<p>ç®¡é“è¾“å…¥&#x2F;è¾“å‡ºæµä¸»è¦åŒ…æ‹¬äº†å¦‚ä¸‹4ç§å…·ä½“å®ç°ï¼šPipedOutputStreamã€PipedInputStreamã€PipedReaderå’ŒPipedWriterï¼Œå‰ä¸¤ç§é¢å‘å­—èŠ‚ï¼Œè€Œåä¸¤ç§é¢å‘å­—ç¬¦ã€‚</p>
<p>ä¾‹å­ï¼šprintThreadçº¿ç¨‹æ¥å—mainçº¿ç¨‹çš„è¾“å…¥ï¼Œä»»ä½•mainçº¿ç¨‹çš„è¾“å…¥å‡é€šè¿‡PipedWriterå†™å…¥ï¼Œè€ŒprintThreadåœ¨å¦ä¸€ç«¯é€šè¿‡PipedReaderå°†å†…å®¹è¯»å‡ºå¹¶æ‰“å°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Piped &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        PipedWriter out = new PipedWriter();</span><br><span class="line">        PipedReader in = new PipedReader();</span><br><span class="line">        // å°†è¾“å‡ºæµå’Œè¾“å…¥æµè¿›è¡Œè¿æ¥ï¼Œå¦åˆ™åœ¨ä½¿ç”¨æ—¶ä¼šæŠ›å‡ºIOException</span><br><span class="line">        out.connect(in);</span><br><span class="line">        Thread printThread = new Thread(new Print(in), &quot;PrintThread&quot;);</span><br><span class="line">        printThread.start();</span><br><span class="line">        int receive = 0;</span><br><span class="line">        try &#123;</span><br><span class="line">            while ((receive = System.in.read()) != -1) &#123;</span><br><span class="line">                out.write(receive);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            out.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Print implements Runnable &#123;</span><br><span class="line">        private PipedReader in;</span><br><span class="line"></span><br><span class="line">        public Print(PipedReader in) &#123;</span><br><span class="line">            this.in = in;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void run() &#123;</span><br><span class="line">            int receive = 0;</span><br><span class="line">            try &#123;</span><br><span class="line">                while ((receive = in.read()) != -1) &#123;</span><br><span class="line">                    System.out.print((char) receive);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (IOException ex) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âš ï¸å¯¹äºPipedç±»å‹çš„æµï¼Œå¿…é¡»å…ˆè¦è¿›è¡Œç»‘å®šï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨connect()æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å°†è¾“å…¥&#x2F;è¾“å‡ºæµç»‘å®šèµ·æ¥ï¼Œå¯¹äºè¯¥æµçš„è®¿é—®å°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h4 id="âœ…Thread-join-çš„ä½¿ç”¨"><a href="#âœ…Thread-join-çš„ä½¿ç”¨" class="headerlink" title="âœ…Thread.join()çš„ä½¿ç”¨"></a>âœ…Thread.join()çš„ä½¿ç”¨</h4><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹Aæ‰§è¡Œäº†thread.join()è¯­å¥ï¼Œå…¶å«ä¹‰æ˜¯ï¼š<br>å½“å‰çº¿ç¨‹Aç­‰å¾…threadçº¿ç¨‹ç»ˆæ­¢ä¹‹åæ‰ä»thread.join()è¿”å›ï¼Œè¿˜æä¾›äº†join(long millis)å’Œjoin(long millis,int nanos)ä¸¤ä¸ªå…·å¤‡è¶…æ—¶ç‰¹æ€§çš„æ–¹æ³•ã€‚</p>
<p>ä¾‹å­ï¼šåˆ›å»ºäº†10ä¸ªçº¿ç¨‹ï¼Œç¼–å·0~9ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨å‰ä¸€ä¸ªçº¿ç¨‹çš„join()æ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">public class Join &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        Thread previous = Thread.currentThread();</span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">			// æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰å‰ä¸€ä¸ªçº¿ç¨‹çš„å¼•ç”¨ï¼Œéœ€è¦ç­‰å¾…å‰ä¸€ä¸ªçº¿ç¨‹ç»ˆæ­¢ï¼Œæ‰èƒ½ä»ç­‰å¾…ä¸­è¿”å›</span><br><span class="line">            Thread thread = new Thread(new Domino(previous), String.valueOf(i));</span><br><span class="line">            thread.start();</span><br><span class="line">            previous = thread;</span><br><span class="line">        &#125;</span><br><span class="line">        TimeUnit.SECONDS.sleep(5);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + &quot; terminate.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Domino implements Runnable &#123;</span><br><span class="line">        private Thread thread;</span><br><span class="line"></span><br><span class="line">        public Domino(Thread thread) &#123;</span><br><span class="line">            this.thread = thread;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void run() &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                thread.join();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot; terminate.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸç†ï¼šç­‰å¾…&#x2F;é€šçŸ¥æœºåˆ¶ï¼ˆç­‰å¾…å‰é©±çº¿ç¨‹ç»“æŸï¼Œæ¥æ”¶å‰é©±çº¿ç¨‹ç»“æŸé€šçŸ¥ï¼‰ã€‚åŠ é”ã€å¾ªç¯å’Œå¤„ç†é€»è¾‘3ä¸ªæ­¥éª¤ã€‚</p>
<p>1ã€çº¿ç¨‹aæ‰§è¡Œçº¿ç¨‹bçš„joinæ–¹æ³•ï¼Œç›¸å½“äºç”¨çº¿ç¨‹bå¯¹è±¡åšåŒæ­¥ï¼Œå†…éƒ¨æœ¬çº¿ç¨‹waitè¿›å…¥ç­‰å¾…ï¼Œå¹¶ç”¨ä¸€ä¸ªå˜é‡flagè¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚<br>2ã€çº¿ç¨‹bç»ˆæ­¢æ—¶ï¼Œä¼šè°ƒç”¨çº¿ç¨‹è‡ªèº«çš„notifyAll()æ–¹æ³•ï¼Œä¼šé€šçŸ¥æ‰€æœ‰ç­‰å¾…åœ¨è¯¥çº¿ç¨‹å¯¹è±¡ä¸Šçš„çº¿ç¨‹ã€‚</p>
<h4 id="âœ…ThreadLocalçš„ä½¿ç”¨"><a href="#âœ…ThreadLocalçš„ä½¿ç”¨" class="headerlink" title="âœ…ThreadLocalçš„ä½¿ç”¨"></a>âœ…ThreadLocalçš„ä½¿ç”¨</h4><p>ThreadLocalï¼Œå³çº¿ç¨‹å˜é‡ï¼Œæ˜¯ä¸€ä¸ªä»¥ThreadLocalå¯¹è±¡ä¸ºé”®ã€ä»»æ„å¯¹è±¡ä¸ºå€¼çš„å­˜å‚¨ç»“æ„ã€‚å®ƒä¸æ˜¯çº¿ç¨‹å…±æœ‰çš„ï¼Œè€Œæ˜¯ç§æœ‰çš„ã€‚å³ä¿®æ”¹ä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ã€‚ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ ¹æ®ä¸€ä¸ªThreadLocalå¯¹è±¡æŸ¥è¯¢åˆ°ç»‘å®šåœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šçš„å€¼ã€‚set()æ–¹æ³•è®¾ç½®ï¼Œget()æ–¹æ³•è·å–è®¾ç½®çš„å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Thread t = Thread.currentThread();</span><br><span class="line">ThreadLocalMap map = getMap(t);</span><br><span class="line">å–å‡ºåï¼Œ(T)valueå¼ºè½¬å³å¯</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼šä¸€ä¸ªProfileç±»ï¼Œå…·æœ‰begin()å’Œend()ä¸¤ä¸ªæ–¹æ³•ï¼Œè€Œend()æ–¹æ³•è¿”å›ä»begin()æ–¹æ³•è°ƒç”¨å¼€å§‹åˆ°end()æ–¹æ³•è¢«è°ƒç”¨æ—¶çš„æ—¶é—´å·®ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Profiler &#123;</span><br><span class="line">    // ç¬¬ä¸€æ¬¡get()æ–¹æ³•è°ƒç”¨æ—¶ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼ˆå¦‚æœsetæ–¹æ³•æ²¡æœ‰è°ƒç”¨ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šè°ƒç”¨ä¸€æ¬¡</span><br><span class="line">    private static final ThreadLocal&lt;Long&gt; TIME_THREADLOCAL = new ThreadLocal&lt;Long&gt;() &#123;</span><br><span class="line">        protected Long initialValue() &#123;</span><br><span class="line">            return System.currentTimeMillis();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    public static final void begin() &#123;</span><br><span class="line">        TIME_THREADLOCAL.set(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static final long end() &#123;</span><br><span class="line">        return System.currentTimeMillis() - TIME_THREADLOCAL.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        Profiler.begin();</span><br><span class="line">        TimeUnit.SECONDS.sleep(1);</span><br><span class="line">        System.out.println(&quot;Cost: &quot; + Profiler.end() + &quot; mills&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨é€”ï¼šProfilerå¯ä»¥è¢«å¤ç”¨åœ¨æ–¹æ³•è°ƒç”¨è€—æ—¶ç»Ÿè®¡çš„åŠŸèƒ½ä¸Šï¼Œåœ¨æ–¹æ³•çš„å…¥å£å‰æ‰§è¡Œbegin()æ–¹æ³•ï¼Œåœ¨æ–¹æ³•è°ƒç”¨åæ‰§è¡Œend()æ–¹æ³•ã€‚å¥½å¤„æ˜¯ä¸¤ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¸ç”¨åœ¨ä¸€ä¸ªæ–¹æ³•æˆ–è€…ç±»ä¸­ã€‚</p>
<h3 id="4-çº¿ç¨‹åº”ç”¨æ¡ˆä¾‹"><a href="#4-çº¿ç¨‹åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="4.çº¿ç¨‹åº”ç”¨æ¡ˆä¾‹"></a>4.çº¿ç¨‹åº”ç”¨æ¡ˆä¾‹</h3><h4 id="âœ…ç­‰å¾…è¶…æ—¶æ¨¡å¼"><a href="#âœ…ç­‰å¾…è¶…æ—¶æ¨¡å¼" class="headerlink" title="âœ…ç­‰å¾…è¶…æ—¶æ¨¡å¼"></a>âœ…ç­‰å¾…è¶…æ—¶æ¨¡å¼</h4><p>åœ¨å‰é¢ç­‰å¾…&#x2F;é€šçŸ¥æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œå¦‚æœè¯¥æ–¹æ³•èƒ½å¤Ÿåœ¨ç»™å®šçš„æ—¶é—´æ®µä¹‹å†…å¾—åˆ°ç»“æœï¼Œé‚£ä¹ˆå°†ç»“æœç«‹åˆ»è¿”å›ï¼Œåä¹‹ï¼Œè¶…æ—¶è¿”å›é»˜è®¤ç»“æœã€‚</p>
<p>èŒƒå¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å¯¹å½“å‰å¯¹è±¡åŠ é”</span><br><span class="line">public synchronized Object get(long mills) throws InterruptedException &#123;</span><br><span class="line">	long future = System.currentTimeMillis() + mills;</span><br><span class="line">	long remaining = mills;</span><br><span class="line">	// å½“è¶…æ—¶å¤§äº0å¹¶ä¸”resultè¿”å›å€¼ä¸æ»¡è¶³è¦æ±‚</span><br><span class="line">	while ((result == null) &amp;&amp; remaining &gt; 0) &#123;</span><br><span class="line">		wait(remaining);</span><br><span class="line">		remaining = future - System.currentTimeMillis();</span><br><span class="line">	&#125;</span><br><span class="line">	return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­‰å¾…è¶…æ—¶æ¨¡å¼å°±æ˜¯åœ¨ç­‰å¾…&#x2F;é€šçŸ¥èŒƒå¼åŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶æ§åˆ¶ï¼Œè¿™ä½¿å¾—è¯¥æ¨¡å¼ç›¸æ¯”åŸæœ‰èŒƒå¼æ›´å…·æœ‰çµæ´»æ€§ï¼Œå› ä¸ºå³ä½¿æ–¹æ³•æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œä¹Ÿä¸ä¼šâ€œæ°¸ä¹…â€é˜»å¡è°ƒç”¨è€…ï¼Œè€Œæ˜¯ä¼šæŒ‰ç…§è°ƒç”¨è€…çš„è¦æ±‚â€œæŒ‰æ—¶â€è¿”å›ã€‚</p>
<p>å¹¶ä¸”ï¼Œä¸æ˜¯åªwaitå›ºå®šçš„æ—¶é—´å°±å®Œäº‹ï¼Œè€Œæ˜¯å¾ªç¯æ£€æŸ¥æ˜¯ä¸æ˜¯waitå¤Ÿäº†ï¼Œå¤Ÿäº†å°±ç›´æ¥è¿”å›ä¸waitäº†ã€‚</p>
<h4 id="âœ…ä¸€ä¸ªç®€å•çš„æ•°æ®åº“è¿æ¥æ± ç¤ºä¾‹"><a href="#âœ…ä¸€ä¸ªç®€å•çš„æ•°æ®åº“è¿æ¥æ± ç¤ºä¾‹" class="headerlink" title="âœ…ä¸€ä¸ªç®€å•çš„æ•°æ®åº“è¿æ¥æ± ç¤ºä¾‹"></a>âœ…ä¸€ä¸ªç®€å•çš„æ•°æ®åº“è¿æ¥æ± ç¤ºä¾‹</h4><p>ä½¿ç”¨ç­‰å¾…è¶…æ—¶æ¨¡å¼æ¥æ„é€ ä¸€ä¸ªç®€å•çš„æ•°æ®åº“è¿æ¥æ± ï¼Œåœ¨ç¤ºä¾‹ä¸­æ¨¡æ‹Ÿä»è¿æ¥æ± ä¸­è·å–ã€ä½¿ç”¨å’Œé‡Šæ”¾è¿æ¥çš„è¿‡ç¨‹ï¼Œè€Œå®¢æˆ·ç«¯è·å–è¿æ¥çš„è¿‡ç¨‹è¢«è®¾å®šä¸ºç­‰å¾…è¶…æ—¶çš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨1000æ¯«ç§’å†…å¦‚æœæ— æ³•è·å–åˆ°å¯ç”¨è¿æ¥ï¼Œå°†ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªnullã€‚</p>
<p>è®¾å®šè¿æ¥æ± çš„å¤§å°ä¸º10ä¸ªï¼Œç„¶åé€šè¿‡è°ƒèŠ‚å®¢æˆ·ç«¯çš„çº¿ç¨‹æ•°æ¥æ¨¡æ‹Ÿæ— æ³•è·å–è¿æ¥çš„åœºæ™¯ã€‚</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹è¿æ¥æ± çš„å®šä¹‰ã€‚å®ƒé€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–è¿æ¥çš„æœ€å¤§ä¸Šé™ï¼Œé€šè¿‡ä¸€ä¸ªåŒå‘é˜Ÿåˆ—æ¥ç»´æŠ¤è¿æ¥ï¼Œè°ƒç”¨æ–¹éœ€è¦å…ˆè°ƒç”¨fetchConnection(long)æ–¹æ³•æ¥æŒ‡å®šåœ¨å¤šå°‘æ¯«ç§’å†…è¶…æ—¶è·å–è¿æ¥ï¼Œå½“è¿æ¥ä½¿ç”¨å®Œæˆåï¼Œéœ€è¦è°ƒç”¨releaseConnection(Connection)æ–¹æ³•å°†è¿æ¥æ”¾å›çº¿ç¨‹æ± ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ConnectionPool &#123;</span><br><span class="line">	//è¿æ¥æ± </span><br><span class="line">    private LinkedList&lt;Connection&gt; pool = new LinkedList&lt;Connection&gt;();</span><br><span class="line"></span><br><span class="line">    //æ„é€ </span><br><span class="line">    public ConnectionPool(int initialSize) &#123;</span><br><span class="line">        if (initialSize &gt; 0) &#123;</span><br><span class="line">        	//åˆ›å»ºæ•°æ®åº“è¿æ¥</span><br><span class="line">            for (int i = 0; i &lt; initialSize; i++) &#123;</span><br><span class="line">                pool.addLast(ConnectionDriver.createConnection());//è¯¥ç±»åœ¨åé¢å®ç°ï¼Œç”¨äºåˆå§‹åŒ–çº¿ç¨‹æ± </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void releaseConnection(Connection connection) &#123;</span><br><span class="line">        if (connection != null) &#123;</span><br><span class="line">            synchronized (pool) &#123;</span><br><span class="line">                // è¿æ¥é‡Šæ”¾åéœ€è¦è¿›è¡Œé€šçŸ¥ï¼Œè¿™æ ·å…¶ä»–æ¶ˆè´¹è€…èƒ½å¤Ÿæ„ŸçŸ¥åˆ°è¿æ¥æ± ä¸­å·²ç»å½’è¿˜äº†ä¸€ä¸ªè¿æ¥</span><br><span class="line">                pool.addLast(connection);</span><br><span class="line">                // å”¤é†’æ‰€æœ‰ç­‰å¾…ï¼Œè®©ä»–ä»¬å»ç«äº‰é”</span><br><span class="line">                pool.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åœ¨millså†…æ— æ³•è·å–åˆ°è¿æ¥ï¼Œå°†ä¼šè¿”å›null</span><br><span class="line">    //è·å–è¿æ¥</span><br><span class="line">    public Connection fetchConnection(long mills) throws InterruptedException &#123;</span><br><span class="line">        synchronized (pool) &#123;</span><br><span class="line">        	// è¯¥éƒ¨åˆ†ä»£ç é€»è¾‘ä¸º</span><br><span class="line">        	// å½“å®Œå…¨è¶…æ—¶æ—¶ï¼Œå¿…ç„¶ä¼šè·å¾—ä¸€ä¸ªè¿æ¥æ± å¯¹è±¡,ä¹Ÿå³æ˜¯æ— çº¿ç­‰å¾…æ—¶é—´ã€‚å½“ä¼ å…¥mills &gt; 0æ—¶ï¼Œä¸ä¼šèµ°å…¥è¯¥åˆ†æ”¯ã€‚å› ä¸ºelseåˆ†æ”¯ä¼šå¤„ç†å…¶ä¸­è¶…æ—¶æƒ…å†µ</span><br><span class="line">        	// éå®Œå…¨è¶…æ—¶æ—¶ï¼Œè·å¾—å°±è¿”å›ä¸€ä¸ªè¿æ¥æ± å¯¹è±¡ï¼Œä¸ç„¶å°±è¿”å›ç©º</span><br><span class="line">        	</span><br><span class="line">            // å®Œå…¨è¶…æ—¶</span><br><span class="line">            if (mills &lt;= 0) &#123;</span><br><span class="line">            	// è¿æ¥æ± ä¸ºç©º</span><br><span class="line">                while (pool.isEmpty()) &#123;</span><br><span class="line">                    //ä»¥è¿æ¥æ± ä¸ºé€šçŸ¥å¯¹è±¡ï¼Œç­‰å¾…ç›´åˆ°è¢«å”¤é†’ï¼Œä¸åœ¨ä¸»åŠ¨é†’æ¥</span><br><span class="line">                    pool.wait();</span><br><span class="line">                &#125;</span><br><span class="line">                // æ‹¿å‡ºè¿æ¥æ± ä¸­ç¬¬ä¸€ä¸ªè¿æ¥ï¼Œå¹¶è¿”å›ç»™å½“å‰è¯·æ±‚è€…</span><br><span class="line">                return pool.removeFirst();</span><br><span class="line">            &#125;</span><br><span class="line">            //æœªè¶…æ—¶ </span><br><span class="line">            else &#123;</span><br><span class="line">                long future = System.currentTimeMillis() + mills;</span><br><span class="line">                long remaining = mills;</span><br><span class="line">                //è¿æ¥æ± ä¸ºç©ºä¸”æœªè¶…æ—¶</span><br><span class="line">                while (pool.isEmpty() &amp;&amp; remaining &gt; 0) &#123;</span><br><span class="line">                	//ä»¥è¿æ¥æ± ä¸ºé€šçŸ¥å¯¹è±¡ï¼Œç­‰å¾…remainingæ¯«ç§’,æˆ–è€…è¢«å”¤é†’</span><br><span class="line">                    pool.wait(remaining);</span><br><span class="line">                    // è·å–å‰©ä½™æ—¶é—´ï¼Œé€šè¿‡å®ƒæ¥åˆ¤æ–­æ˜¯ä¸»åŠ¨é†’æ¥ï¼ˆè¶…æ—¶ï¼‰ï¼Œè¿˜æ˜¯è¢«åŠ¨å”¤é†’ï¼ˆnotifyï¼‰</span><br><span class="line">                    // æ— è®ºæ˜¯è¢«åŠ¨è¿˜æ˜¯ä¸»åŠ¨é†’æ¥ï¼Œéƒ½å°è¯•è·å–è¿æ¥æ± è¿™ä¸ªå¯¹è±¡é”</span><br><span class="line">                    remaining = future - System.currentTimeMillis();</span><br><span class="line">                    // è·å¾—é”ä»¥ååˆ¤æ–­è¿æ¥æ± æ˜¯ä¸æ˜¯ç©ºçš„ï¼Œç©ºçš„çš„è¯å†åˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼Œè¶…æ—¶å°±ç¦»å¼€å¾ªç¯</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Connection result = null;</span><br><span class="line">                //æŠ¢åˆ°è¿æ¥æ± è¿™ä¸ªå¯¹è±¡é”åï¼Œè‹¥æ­¤æ—¶è¿æ¥æ± ä¸ä¸ºç©º</span><br><span class="line">                if (!pool.isEmpty()) &#123;</span><br><span class="line">                	// æ‹¿å‡ºè¿æ¥æ± ä¸­ç¬¬ä¸€ä¸ªè¿æ¥ï¼Œå¹¶è¿”å›ç»™å½“å‰è¯·æ±‚è€…</span><br><span class="line">                    result = pool.removeFirst();</span><br><span class="line">                &#125;</span><br><span class="line">                // å¦åˆ™æ­¤æ—¶ä¸ºç©º</span><br><span class="line">                return result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äºjava.sql.Connectionæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ€ç»ˆçš„å®ç°æ˜¯ç”±æ•°æ®åº“é©±åŠ¨æä¾›æ–¹æ¥å®ç°çš„ï¼Œè€ƒè™‘åˆ°åªæ˜¯ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬é€šè¿‡<strong>åŠ¨æ€ä»£ç†</strong>æ„é€ äº†ä¸€ä¸ªConnectionï¼Œè¯¥Connectionçš„ä»£ç†å®ç°ä»…ä»…æ˜¯åœ¨commit()æ–¹æ³•ï¼ˆæäº¤sqlï¼‰è°ƒç”¨æ—¶ä¼‘çœ 100æ¯«ç§’ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ConnectionDriver &#123;</span><br><span class="line"></span><br><span class="line">    static class ConnectionHandler implements InvocationHandler &#123;</span><br><span class="line">        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable&#123;</span><br><span class="line">         // åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰</span><br><span class="line">        // å½“æ–¹æ³•æ˜¯æäº¤æ—¶ï¼Œæˆ‘ä»¬ç¡çœ 100æ¯«ç§’</span><br><span class="line">        if (method.getName().equals(&quot;commit&quot;))&#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(100);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // æ‰§è¡ŒåŸæœ¬æ–¹æ³•ï¼Œæ­¤å¤„å°±ä¸æ‰§è¡Œäº†</span><br><span class="line">       	// Object invoke = method.invoke(vehical, args);</span><br><span class="line">       	</span><br><span class="line">		// æ‰§è¡Œæ–¹æ³•ä¹‹åï¼Œæ­¤å¤„ä¹Ÿä¸å¤„ç†ï¼Œç›´æ¥æ”¾å›null</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    // åˆ›å»ºä¸€ä¸ªConnectionçš„ä»£ç†ï¼Œåœ¨commitæ—¶ä¼‘çœ 100æ¯«ç§’</span><br><span class="line">    public static final Connection createConnection() &#123;</span><br><span class="line">    	// åˆ›å»ºä¸€ä¸ªä»£ç†å®ä¾‹</span><br><span class="line">    	// ç±»åŠ è½½å™¨(ç”¨å“ªä¸ªç±»åŠ è½½å™¨å»åŠ è½½ä»£ç†å¯¹è±¡) + ä»£ç†çš„ç±»(æ¥å£ï¼Œåˆ‡å…¥ç‚¹) + ä»£ç†æ–¹æ³•</span><br><span class="line">    	// å¯ä»¥ç†è§£æˆ‘ä»¬ä¸ºConnectionçš„&quot;commit&quot;æ–¹æ³•ï¼Œé€šè¿‡JDKçš„æ–¹å¼ä»£ç†äº†ä¸€å±‚(AOP)</span><br><span class="line">    	// è¿”å›çš„å°±æ˜¯æˆ‘ä»¬Springä¸­å­¦ä¹ çš„ ä»£ç†é¢å¤–å¢åŠ çš„å±‚ + åŸæœ¬çš„ç±»å¯¹è±¡</span><br><span class="line">        return (Connection) Proxy.newProxyInstance(ConnectionDriver.class.getClassLoader(),new Class &lt;?&gt;[]&#123;</span><br><span class="line">            Connection.class</span><br><span class="line">        &#125;,new ConnectionHandler());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æµ‹è¯•ç®€æ˜“æ•°æ®åº“è¿æ¥æ± çš„å·¥ä½œæƒ…å†µï¼Œæ¨¡æ‹Ÿå®¢æˆ·ç«¯ConnectionRunnerè·å–ã€ä½¿ç”¨ã€æœ€åé‡Šæ”¾è¿æ¥çš„è¿‡ç¨‹ï¼Œå½“å®ƒä½¿ç”¨æ—¶è¿æ¥å°†ä¼šå¢åŠ è·å–åˆ°è¿æ¥çš„æ•°é‡ï¼Œåä¹‹ï¼Œå°†ä¼šå¢åŠ æœªè·å–åˆ°è¿æ¥çš„æ•°é‡ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ConnectionPoolTest &#123;</span><br><span class="line">    static ConnectionPool pool = new ConnectionPool(10);</span><br><span class="line">    // ä¿è¯æ‰€æœ‰ConnectionRunnerèƒ½å¤ŸåŒæ—¶å¼€å§‹</span><br><span class="line">    static CountDownLatch start = new CountDownLatch(1);</span><br><span class="line">    // mainçº¿ç¨‹å°†ä¼šç­‰å¾…æ‰€æœ‰ConnectionRunnerç»“æŸåæ‰èƒ½ç»§ç»­æ‰§è¡Œ</span><br><span class="line">    static CountDownLatch end;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        // çº¿ç¨‹æ•°é‡ï¼Œå¯ä»¥ä¿®æ”¹çº¿ç¨‹æ•°é‡è¿›è¡Œè§‚å¯Ÿ</span><br><span class="line">        int threadCount = 10;</span><br><span class="line">        end = new CountDownLatch(threadCount);</span><br><span class="line">        int count = 20;</span><br><span class="line">        // ç”¨åŸå­è®°å½• è·å–åˆ°çš„ä¸æ²¡æœ‰è·å–åˆ°çš„</span><br><span class="line">        AtomicInteger got = new AtomicInteger();</span><br><span class="line">        AtomicInteger notGot = new AtomicInteger();</span><br><span class="line">        </span><br><span class="line">        for (int i = 0; i &lt; threadCount; i++) &#123;</span><br><span class="line">        	// è¿è¡Œçº¿ç¨‹</span><br><span class="line">            Thread thread = new Thread(new ConnetionRunner(count, got, notGot),</span><br><span class="line">                    &quot;ConnectionRunnerThread&quot;);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">        //è¿è¡Œåˆ°è¿™é‡Œstartå€¼-1ï¼Œæ­¤æ—¶ä¸º0ï¼Œå› æ­¤æ‰€æœ‰çº¿ç¨‹ä¸å†ä¼šè¢«é˜»å¡ï¼Œå¼€å§‹æ‰§è¡Œ</span><br><span class="line">        start.countDown();</span><br><span class="line">        //ä¸»çº¿ç¨‹é˜»å¡åœ¨è¿™é‡Œï¼Œç­‰å¾…endä¸º0ï¼Œå³ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ</span><br><span class="line">        end.await();   //ç­‰10ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œå®Œ</span><br><span class="line">        System.out.println(&quot;total invoke: &quot; + (threadCount * count));</span><br><span class="line">        System.out.println(&quot;got connection: &quot; + got);</span><br><span class="line">        System.out.println(&quot;not got connection &quot; + notGot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class ConnetionRunner implements Runnable &#123;</span><br><span class="line">        int count;</span><br><span class="line">        AtomicInteger got;</span><br><span class="line">        AtomicInteger notGot;</span><br><span class="line"></span><br><span class="line">		// gotã€noteGotå› ä¸ºæ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥æœ¬è´¨è¿˜æ˜¯åŸæ¥çš„é‚£ä¸ª</span><br><span class="line">        public ConnetionRunner(int count, AtomicInteger got, AtomicInteger notGot) &#123;</span><br><span class="line">            this.count = count;</span><br><span class="line">            this.got = got;</span><br><span class="line">            this.notGot = notGot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void run() &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">            	// é˜»å¡åœ¨è¿™é‡Œï¼Œç­‰å¾…startä¸º0</span><br><span class="line">                start.await();  //ç­‰10ä¸ªçº¿ç¨‹éƒ½åˆ›å»ºå¥½åä¸€èµ·æ‰§è¡Œ</span><br><span class="line">            &#125; catch (Exception ex) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            // å½“count &gt; 0 æ—¶ï¼Œå†æ¬¡æ‰§è¡Œ</span><br><span class="line">            while (count &gt; 0) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    // ä»çº¿ç¨‹æ± ä¸­è·å–è¿æ¥ï¼Œå¦‚æœ1000mså†…æ— æ³•è·å–åˆ°ï¼Œå°†ä¼šè¿”å›null</span><br><span class="line">                    // åˆ†åˆ«ç»Ÿè®¡è¿æ¥è·å–çš„æ•°é‡gotå’Œæœªè·å–åˆ°çš„æ•°é‡notGot</span><br><span class="line">                    Connection connection = pool.fetchConnection(1000);</span><br><span class="line">                    // å¦‚æœè·å–åˆ°äº†</span><br><span class="line">                    if (connection != null) &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                        	// åˆ›å»ºSQLè¯­å¥</span><br><span class="line">                            connection.createStatement();</span><br><span class="line">                            // æ‰§è¡Œæäº¤</span><br><span class="line">                            connection.commit();</span><br><span class="line">                        &#125; finally &#123;</span><br><span class="line">                        	// é‡Šæ”¾</span><br><span class="line">                            pool.releaseConnection(connection);</span><br><span class="line">                            // è·å–åˆ°got + 1</span><br><span class="line">                            got.incrementAndGet();</span><br><span class="line">                        &#125;</span><br><span class="line">                     // æ²¡æœ‰è·å–åˆ°</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                    	// æ²¡æœ‰è·å–åˆ°notGot + 1</span><br><span class="line">                        notGot.incrementAndGet();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Exception ex) &#123;</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                </span><br><span class="line">                    count--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            // çº¿ç¨‹ç»“æŸ end - 1</span><br><span class="line">            end.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ç¤ºä¾‹ä¸­ä½¿ç”¨äº†CountDownLatchæ¥ç¡®ä¿ConnectionRunnerThreadèƒ½å¤ŸåŒæ—¶å¼€å§‹æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨å…¨éƒ¨ç»“æŸä¹‹åï¼Œæ‰ä½¿mainçº¿ç¨‹ä»ç­‰å¾…çŠ¶æ€ä¸­è¿”å›ã€‚</p>
<p>åœ¨èµ„æºä¸€å®šçš„æƒ…å†µä¸‹ï¼ˆè¿æ¥æ± ä¸­çš„10ä¸ªè¿æ¥ï¼‰ï¼Œéšç€å®¢æˆ·ç«¯çº¿ç¨‹çš„é€æ­¥å¢åŠ ï¼Œå®¢æˆ·ç«¯å‡ºç°è¶…æ—¶æ— æ³•è·å–è¿æ¥çš„æ¯”ç‡ä¸æ–­å‡é«˜ã€‚</p>
<h4 id="âœ…çº¿ç¨‹æ± æŠ€æœ¯åŠå…¶ç¤ºä¾‹"><a href="#âœ…çº¿ç¨‹æ± æŠ€æœ¯åŠå…¶ç¤ºä¾‹" class="headerlink" title="âœ…çº¿ç¨‹æ± æŠ€æœ¯åŠå…¶ç¤ºä¾‹"></a>âœ…çº¿ç¨‹æ± æŠ€æœ¯åŠå…¶ç¤ºä¾‹</h4><p>å¦‚æœæœåŠ¡ç«¯æ¯æ¬¡æ¥å—åˆ°ä¸€ä¸ªä»»åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åè¿›è¡Œæ‰§è¡Œï¼Œè¿™ä¼šä½¿æ“ä½œç³»ç»Ÿé¢‘ç¹çš„è¿›è¡Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ— æ•…å¢åŠ ç³»ç»Ÿçš„è´Ÿè½½ï¼Œè€Œçº¿ç¨‹çš„åˆ›å»ºå’Œæ¶ˆäº¡éƒ½æ˜¯éœ€è¦è€—è´¹ç³»ç»Ÿèµ„æºçš„ï¼Œä¹Ÿæ— ç–‘æµªè´¹äº†ç³»ç»Ÿèµ„æºã€‚</p>
<p>çº¿ç¨‹æ± æŠ€æœ¯èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒé¢„å…ˆåˆ›å»ºäº†è‹¥å¹²æ•°é‡çš„çº¿ç¨‹ï¼Œå¹¶ä¸”ä¸èƒ½ç”±ç”¨æˆ·ç›´æ¥å¯¹çº¿ç¨‹çš„åˆ›å»ºè¿›è¡Œæ§åˆ¶ï¼Œåœ¨è¿™ä¸ªå‰æä¸‹é‡å¤ä½¿ç”¨å›ºå®šæˆ–è¾ƒä¸ºå›ºå®šæ•°ç›®çš„çº¿ç¨‹æ¥å®Œæˆä»»åŠ¡çš„æ‰§è¡Œã€‚</p>
<p>çº¿ç¨‹æ± çš„å¥½å¤„ï¼š<br>1ã€æ¶ˆé™¤äº†é¢‘ç¹åˆ›å»ºå’Œæ¶ˆäº¡çº¿ç¨‹çš„ç³»ç»Ÿèµ„æºå¼€é”€<br>2ã€é¢å¯¹è¿‡é‡ä»»åŠ¡çš„æäº¤èƒ½å¤Ÿå¹³ç¼“çš„åŠ£åŒ–ã€‚</p>
<p>çº¿ç¨‹æ± æ¥å£å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface ThreadPool&lt;Job extends Runnable&gt; &#123;</span><br><span class="line">    // æ‰§è¡Œä¸€ä¸ªJobï¼Œè¿™ä¸ªJobéœ€è¦å®ç°Runnable</span><br><span class="line">    void execute(Job job);</span><br><span class="line"></span><br><span class="line">    // å…³é—­çº¿ç¨‹æ± </span><br><span class="line">    void shutdown();</span><br><span class="line"></span><br><span class="line">    // å¢åŠ å·¥ä½œè€…çº¿ç¨‹</span><br><span class="line">    void addWorkers(int num);</span><br><span class="line"></span><br><span class="line">    // å‡å°‘å·¥ä½œè€…çº¿ç¨‹</span><br><span class="line">    void removeWorker(int num);</span><br><span class="line"></span><br><span class="line">    // å¾—åˆ°æ­£åœ¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡</span><br><span class="line">    int getJobSize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡execute(Job)æ–¹æ³•å°†Jobæäº¤å…¥çº¿ç¨‹æ± æ‰§è¡Œï¼Œè€Œå®¢æˆ·ç«¯è‡ªèº«ä¸ç”¨ç­‰å¾…Jobçš„æ‰§è¡Œå®Œæˆã€‚<br>é™¤äº†execute(Job)æ–¹æ³•ä»¥å¤–ï¼Œçº¿ç¨‹æ± æ¥å£æä¾›äº†å¢å¤§&#x2F;å‡å°‘å·¥ä½œè€…çº¿ç¨‹ä»¥åŠå…³é—­çº¿ç¨‹æ± çš„æ–¹æ³•ã€‚<br>è¿™é‡Œå·¥ä½œè€…çº¿ç¨‹ä»£è¡¨ç€ä¸€ä¸ªé‡å¤æ‰§è¡ŒJobçš„çº¿ç¨‹ï¼Œè€Œæ¯ä¸ªç”±å®¢æˆ·ç«¯æäº¤çš„Jobéƒ½å°†è¿›å…¥åˆ°ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ä¸­ç­‰å¾…å·¥ä½œè€…çº¿ç¨‹çš„å¤„ç†ã€‚</p>
<p>æ‰‹å†™ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œä¸ç”¨Executoråˆ›å»ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class DefaultThreadPool&lt;Job extends Runnable&gt; implements ThreadPool&lt;Job&gt; &#123;</span><br><span class="line">    // çº¿ç¨‹æ± æœ€å¤§é™åˆ¶æ•°</span><br><span class="line">    private static final int MAX_WORKER_NUMBERS = 10;</span><br><span class="line">    // çº¿ç¨‹æ± é»˜è®¤çš„æ•°é‡</span><br><span class="line">    private static final int DEFAULT_WORKER_NUMBERS = 5;</span><br><span class="line">    // çº¿ç¨‹æ± æœ€å°çš„æ•°é‡</span><br><span class="line">    private static final int MIN_WORKER_NUMBERS = 1;</span><br><span class="line">    // è¿™æ˜¯ä¸€ä¸ªå·¥ä½œåˆ—è¡¨ï¼Œå°†ä¼šå‘é‡Œé¢æ’å…¥å·¥ä½œ</span><br><span class="line">    private final LinkedList&lt;Job&gt; jobs = new LinkedList&lt;Job&gt;();</span><br><span class="line">    // å·¥ä½œè€…åˆ—è¡¨</span><br><span class="line">    private final List&lt;Worker&gt; workers = Collections.synchronizedList(new ArrayList&lt;Worker&gt;());</span><br><span class="line">    // å·¥ä½œè€…çº¿ç¨‹çš„æ•°é‡</span><br><span class="line">    private int workerNum = DEFAULT_WORKER_NUMBERS;</span><br><span class="line">    // çº¿ç¨‹ç¼–å·ç”Ÿæˆ</span><br><span class="line">    private AtomicLong threadNum = new AtomicLong();</span><br><span class="line">	</span><br><span class="line">    //æ„é€ å‡½æ•°</span><br><span class="line">    public DefaultThreadPool() &#123;</span><br><span class="line">        initializeWokers(DEFAULT_WORKER_NUMBERS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public DefaultThreadPool(int num) &#123;</span><br><span class="line">    	// num &gt; max ï¼Œ å– maxï¼Œnum &lt; min å– minã€‚å…¶ä»–å– num</span><br><span class="line">        workerNum = num &gt; MAX_WORKER_NUMBERS ? MAX_WORKER_NUMBERS:(num &lt; MIN_WORKER_NUMBERS ? MIN_WORKER_NUMBERS : num);</span><br><span class="line">        initializeWokers(workerNum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void execute(Job job) &#123;</span><br><span class="line">        if (job != null) &#123;</span><br><span class="line">            // æ·»åŠ ä¸€ä¸ªå·¥ä½œï¼Œç„¶åè¿›è¡Œé€šçŸ¥</span><br><span class="line">            synchronized (jobs) &#123;</span><br><span class="line">                jobs.addLast(job);</span><br><span class="line">                jobs.notify();   //é€šçŸ¥ï¼ˆè¿™é‡Œjobsæ—¢æ˜¯flagåˆæ˜¯lockï¼‰</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void shutdown() &#123;</span><br><span class="line">        for (Worker worker : workers) &#123;</span><br><span class="line">            worker.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void addWorkers(int num) &#123;</span><br><span class="line">        synchronized (jobs) &#123;</span><br><span class="line">            // é™åˆ¶æ–°å¢çš„Workeræ•°é‡ä¸èƒ½è¶…è¿‡æœ€å¤§å€¼</span><br><span class="line">            if (num + this.workerNum &gt; MAX_WORKER_NUMBERS) &#123;</span><br><span class="line">                num = MAX_WORKER_NUMBERS - this.workerNum;</span><br><span class="line">            &#125;</span><br><span class="line">            initializeWokers(num);</span><br><span class="line">            this.workerNum += num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void removeWorker(int num) &#123;</span><br><span class="line">        synchronized (jobs) &#123;</span><br><span class="line">            if (num &gt;= this.workerNum) &#123;</span><br><span class="line">                throw new IllegalArgumentException(&quot;beyond workNum&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            // æŒ‰ç…§ç»™å®šçš„æ•°é‡åœæ­¢Worker</span><br><span class="line">            int count = 0;</span><br><span class="line">            while (count &lt; num) &#123;</span><br><span class="line">                Worker worker = workers.get(count);</span><br><span class="line">                if (workers.remove(worker)) &#123;</span><br><span class="line">                    worker.shutdown();</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            this.workerNum -= count;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getJobSize() &#123;</span><br><span class="line">        return jobs.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åˆå§‹åŒ–çº¿ç¨‹å·¥ä½œè€…</span><br><span class="line">    private void initializeWokers(int num) &#123;</span><br><span class="line">        for (int i = 0; i &lt; num; i++) &#123;</span><br><span class="line">            Worker worker = new Worker();</span><br><span class="line">            workers.add(worker);</span><br><span class="line">            Thread thread = new Thread(worker, &quot;ThreadPool-Worker-&quot; + threadNum.inrementAndGet());</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å·¥ä½œè€…ï¼Œè´Ÿè´£æ¶ˆè´¹ä»»åŠ¡</span><br><span class="line">    class Worker implements Runnable &#123;</span><br><span class="line">        // æ˜¯å¦å·¥ä½œ</span><br><span class="line">        private volatile boolean running = true;</span><br><span class="line"></span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while (running) &#123;</span><br><span class="line">                Job job = null;</span><br><span class="line">                synchronized (jobs) &#123;</span><br><span class="line">                    // å¦‚æœå·¥ä½œè€…åˆ—è¡¨æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå°±wait</span><br><span class="line">                    while (jobs.isEmpty()) &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                            jobs.wait();  //ç­‰å¾…</span><br><span class="line">                        &#125; catch (InterruptedException ex) &#123;</span><br><span class="line">                            // æ„ŸçŸ¥åˆ°å¤–éƒ¨å¯¹WorkerThreadçš„ä¸­æ–­æ“ä½œï¼Œè¿”å›</span><br><span class="line">                            Thread.currentThread().interrupt();</span><br><span class="line">                            return;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    // å–å‡ºä¸€ä¸ªJob</span><br><span class="line">                    job = jobs.removeFirst();</span><br><span class="line">                &#125;</span><br><span class="line">                if (job != null) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        job.run();</span><br><span class="line">                    &#125; catch (Exception ex) &#123;</span><br><span class="line">                        // å¿½ç•¥Jobæ‰§è¡Œä¸­çš„Exception</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void shutdown() &#123;</span><br><span class="line">            running = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒJobæ˜¯è¦æ”¾å…¥çº¿ç¨‹æ± çš„çº¿ç¨‹ï¼ŒWorkeræ˜¯çº¿ç¨‹æ± å†…æ‰§è¡ŒJobçº¿ç¨‹çš„å·¥ä½œçº¿ç¨‹ã€‚é‡Œé¢ç”¨äº†ç­‰å¾…é€šçŸ¥æ¨¡å¼ï¼Œæ”¾å…¥ä¸€ä¸ªjobä¼šé€šçŸ¥ä¸€ä¸‹ï¼Œjobsä¸ºç©ºäº†å°±ä¼šç­‰å¾…ã€‚</p>
<p>å½“å®¢æˆ·ç«¯è°ƒç”¨execute(Job)æ–¹æ³•æ—¶ï¼Œä¼šä¸æ–­åœ°å‘ä»»åŠ¡åˆ—è¡¨jobsä¸­æ·»åŠ Jobï¼Œè€Œæ¯ä¸ªå·¥ä½œè€…çº¿ç¨‹ä¼šä¸æ–­åœ°ä»jobsä¸Šå–å‡ºä¸€ä¸ªJobè¿›è¡Œæ‰§è¡Œï¼Œå½“jobsä¸ºç©ºæ—¶ï¼Œå·¥ä½œè€…çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p>
<p>æ·»åŠ ä¸€ä¸ªJobåï¼Œå¯¹å·¥ä½œé˜Ÿåˆ—jobsè°ƒç”¨äº†å…¶notify()æ–¹æ³•ï¼Œè€Œä¸æ˜¯notifyAll()æ–¹æ³•ï¼Œå› ä¸ºèƒ½å¤Ÿç¡®å®šæœ‰å·¥ä½œè€…çº¿ç¨‹è¢«å”¤é†’ï¼Œè¿™æ—¶ä½¿ç”¨notify()æ–¹æ³•å°†ä¼šæ¯”notifyAll()æ–¹æ³•è·å¾—æ›´å°çš„å¼€é”€ï¼ˆé¿å…å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…¨éƒ¨ç§»åŠ¨åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼‰ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œçº¿ç¨‹æ± çš„æœ¬è´¨å°±æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å·¥ä½œé˜Ÿåˆ—è¿æ¥å·¥ä½œè€…çº¿ç¨‹å’Œå®¢æˆ·ç«¯çº¿ç¨‹ï¼Œå®¢æˆ·ç«¯çº¿ç¨‹å°†ä»»åŠ¡æ”¾å…¥å·¥ä½œé˜Ÿåˆ—åä¾¿è¿”å›ï¼Œè€Œå·¥ä½œè€…çº¿ç¨‹åˆ™ä¸æ–­åœ°ä»å·¥ä½œé˜Ÿåˆ—ä¸Šå–å‡ºå·¥ä½œå¹¶æ‰§è¡Œã€‚å½“å·¥ä½œé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œæ‰€æœ‰çš„å·¥ä½œè€…çº¿ç¨‹å‡ç­‰å¾…åœ¨å·¥ä½œé˜Ÿåˆ—ä¸Šï¼Œå½“æœ‰å®¢æˆ·ç«¯æäº¤äº†ä¸€ä¸ªä»»åŠ¡ä¹‹åä¼šé€šçŸ¥ä»»æ„ä¸€ä¸ªå·¥ä½œè€…çº¿ç¨‹ï¼Œéšç€å¤§é‡çš„ä»»åŠ¡è¢«æäº¤ï¼Œæ›´å¤šçš„å·¥ä½œè€…çº¿ç¨‹ä¼šè¢«å”¤é†’ã€‚</p>
<h4 id="âœ…ä¸€ä¸ªåŸºäºçº¿ç¨‹æ± æŠ€æœ¯çš„ç®€å•WebæœåŠ¡å™¨"><a href="#âœ…ä¸€ä¸ªåŸºäºçº¿ç¨‹æ± æŠ€æœ¯çš„ç®€å•WebæœåŠ¡å™¨" class="headerlink" title="âœ…ä¸€ä¸ªåŸºäºçº¿ç¨‹æ± æŠ€æœ¯çš„ç®€å•WebæœåŠ¡å™¨"></a>âœ…ä¸€ä¸ªåŸºäºçº¿ç¨‹æ± æŠ€æœ¯çš„ç®€å•WebæœåŠ¡å™¨</h4><p>ç›®å‰çš„æµè§ˆå™¨éƒ½æ”¯æŒå¤šçº¿ç¨‹è®¿é—®ï¼Œæ¯”å¦‚è¯´åœ¨è¯·æ±‚ä¸€ä¸ªHTMLé¡µé¢çš„æ—¶å€™ï¼Œé¡µé¢ä¸­åŒ…å«çš„å›¾ç‰‡èµ„æºã€æ ·å¼èµ„æºä¼šè¢«æµè§ˆå™¨å‘èµ·å¹¶å‘çš„è·å–ã€‚</p>
<p>å¤§éƒ¨åˆ†WebæœåŠ¡å™¨ä¹Ÿéƒ½æ˜¯æ”¯æŒå¹¶å‘è®¿é—®çš„ã€‚å¸¸ç”¨çš„Java WebæœåŠ¡å™¨ï¼Œå¦‚Tomcatã€Jettyï¼Œåœ¨å…¶å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­éƒ½ä½¿ç”¨åˆ°äº†çº¿ç¨‹æ± æŠ€æœ¯ã€‚</p>
<p>ä½¿ç”¨å‰ä¸€èŠ‚ä¸­çš„çº¿ç¨‹æ± æ¥æ„é€ ä¸€ä¸ªç®€å•çš„WebæœåŠ¡å™¨ï¼Œè¿™ä¸ªWebæœåŠ¡å™¨ç”¨æ¥å¤„ç†HTTPè¯·æ±‚ï¼Œç›®å‰åªèƒ½å¤„ç†ç®€å•çš„æ–‡æœ¬å’ŒJPGå›¾ç‰‡å†…å®¹ã€‚è¿™ä¸ªWebæœåŠ¡å™¨ä½¿ç”¨mainçº¿ç¨‹ä¸æ–­åœ°æ¥å—å®¢æˆ·ç«¯Socketçš„è¿æ¥ï¼Œå°†è¿æ¥ä»¥åŠè¯·æ±‚æäº¤ç»™çº¿ç¨‹æ± å¤„ç†ï¼Œè¿™æ ·ä½¿å¾—WebæœåŠ¡å™¨èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SimpleHttpServer &#123;</span><br><span class="line">    // å¤„ç†HttpRequestçš„çº¿ç¨‹æ± </span><br><span class="line">    static ThreadPool&lt;HttpRequestHandler&gt; threadPool = new DefaultThreadPool&lt;HttpRequestHandler&gt;(1);</span><br><span class="line">    // SimpleHttpServerçš„æ ¹è·¯å¾„</span><br><span class="line">    static String basePath;</span><br><span class="line">    static ServerSocket serverSocket;</span><br><span class="line">    // æœåŠ¡ç›‘å¬ç«¯å£</span><br><span class="line">    static int port = 8080;</span><br><span class="line"></span><br><span class="line">    public static void setPort(int port) &#123;</span><br><span class="line">        if (port &gt; 0) &#123;</span><br><span class="line">            SimpleHttpServer.port = port;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void setBasePath(String basePath) &#123;</span><br><span class="line">         if (basePath != null &amp;&amp; new File(basePath).exists() &amp;&amp; new File(basePath).isDirectory()) &#123;</span><br><span class="line">            SimpleHttpServer.basePath = basePath;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å¯åŠ¨SimpleHttpServerï¼Œä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚</span><br><span class="line">    public static void start() throws Exception &#123;</span><br><span class="line">        serverSocket = new ServerSocket(port);</span><br><span class="line">        Socket socket = null;</span><br><span class="line">        //accept():3æ¬¡æ¡æ‰‹ç»“æŸï¼Œæ¥å—è¿æ¥</span><br><span class="line">        while ((socket = serverSocket.accept()) != null) &#123;</span><br><span class="line">            // æ¥æ”¶ä¸€ä¸ªå®¢æˆ·ç«¯Socketï¼Œç”Ÿæˆä¸€ä¸ªHttpRequestHandlerï¼Œæ”¾å…¥çº¿ç¨‹æ± æ‰§è¡Œ</span><br><span class="line">            threadPool.execute(new HttpRequestHandler(socket));</span><br><span class="line">        &#125;</span><br><span class="line">        serverSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class HttpRequestHandler implements Runnable &#123;</span><br><span class="line">        private Socket socket;</span><br><span class="line"></span><br><span class="line">        public HttpRequestHandler(Socket socket) &#123;</span><br><span class="line">            this.socket = socket;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            String line = null;</span><br><span class="line">            BufferedReader br = null;</span><br><span class="line">            BufferedReader reader = null;</span><br><span class="line">            PrintWriter out = null;</span><br><span class="line">            InputStream in = null;</span><br><span class="line">            try &#123;</span><br><span class="line">                reader = new BufferedReader(new InputStreamReader(socket.getInputStream()));</span><br><span class="line">                String header = reader.readLine();</span><br><span class="line">                // ç”±ç›¸å¯¹è·¯å¾„è®¡ç®—å‡ºç»å¯¹è·¯å¾„</span><br><span class="line">                String filePath = basePath + header.split(&quot; &quot;)[1];</span><br><span class="line">                out = new PrintWriter(socket.getOutputStream());</span><br><span class="line">                 // å¦‚æœè¯·æ±‚èµ„æºçš„åç¼€ä¸ºjpgæˆ–è€…icoï¼Œåˆ™è¯»å–èµ„æºå¹¶è¾“å‡º</span><br><span class="line">                if (filePath.endsWith(&quot;jpg&quot;) || filePath.endsWith(&quot;ico&quot;)) &#123;</span><br><span class="line">                    in = new FileInputStream(filePath);</span><br><span class="line">                    ByteArrayOutputStream baos = new ByteArrayOutputStream();</span><br><span class="line">                    int i = 0;</span><br><span class="line">                    while ((i = in.read()) != -1) &#123;</span><br><span class="line">                        baos.write(i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    byte[] array = baos.toByteArray();</span><br><span class="line">                    out.println(&quot;HTTP/1.1 200 OK&quot;);</span><br><span class="line">                    out.println(&quot;Server: yjx23332&quot;);</span><br><span class="line">                    out.println(&quot;Content-Type: image/jpeg&quot;);</span><br><span class="line">                    out.println(&quot;Content-Length: &quot; + array.length);</span><br><span class="line">                    out.println(&quot;&quot;);</span><br><span class="line">                    System.out.println(&quot;ä¼ å›ï¼&quot;);</span><br><span class="line">                    socket.getOutputStream().write(array, 0, array.length);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    br = new BufferedReader(new InputStreamReader(new</span><br><span class="line">                            FileInputStream(filePath)));</span><br><span class="line">                    out = new PrintWriter(socket.getOutputStream());</span><br><span class="line">                    out.println(&quot;HTTP/1.1 200 OK&quot;);</span><br><span class="line">                    out.println(&quot;Server: yjx23332&quot;);</span><br><span class="line">                    out.println(&quot;Content-Type: text/html; charset=UTF-8&quot;);</span><br><span class="line">                    out.println(&quot;&quot;);</span><br><span class="line">                    while ((line = br.readLine()) != null) &#123;</span><br><span class="line">                        out.println(line);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                out.flush();</span><br><span class="line">            &#125; catch (Exception ex) &#123;</span><br><span class="line">                out.println(&quot;HTTP/1.1 500&quot;);</span><br><span class="line">                out.println(&quot;&quot;);</span><br><span class="line">                out.flush();</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                close(br, in, reader, out, socket);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å…³é—­æµæˆ–è€…Socket</span><br><span class="line">    private static void close(Closeable... closeables) &#123;</span><br><span class="line">        if (closeables != null) &#123;</span><br><span class="line">            for (Closeable closeable : closeables) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    closeable.close();</span><br><span class="line">                &#125; catch (Exception ex) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SimpleHttpServeræä¾›è®¾ç½®ç«¯å£å’Œè·Ÿè·¯å¾„çš„æ–¹æ³•ï¼ŒSimpleHttpServeråœ¨å»ºç«‹äº†ä¸å®¢æˆ·ç«¯çš„è¿æ¥ä¹‹åï¼Œå¹¶ä¸ä¼šå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè€Œæ˜¯å°†å…¶åŒ…è£…æˆHttpRequestHandlerå¹¶äº¤ç”±çº¿ç¨‹æ± å¤„ç†ã€‚</p>
<p>åœ¨çº¿ç¨‹æ± ä¸­çš„Workerå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„åŒæ—¶ï¼ŒSimpleHttpServerèƒ½å¤Ÿç»§ç»­å®Œæˆåç»­å®¢æˆ·ç«¯è¿æ¥çš„å»ºç«‹ï¼Œä¸ä¼šé˜»å¡åç»­å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚Workerå¤„ç†è¯·æ±‚èµ„æºç”Ÿæˆå“åº”å†…å®¹åï¼Œå¼‚æ­¥è¾“å‡ºå†…å®¹åˆ°å®¢æˆ·ç«¯ã€‚</p>
<p>htmlé¡µé¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">		&lt;title&gt;æµ‹è¯•é¡µé¢&lt;/title&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">&lt;body &gt;</span><br><span class="line">	&lt;h1&gt;ç¬¬ä¸€å¼ å›¾ç‰‡&lt;/h1&gt;</span><br><span class="line">	&lt;img src=&quot;1.jpg&quot; /&gt;</span><br><span class="line">	&lt;h1&gt;ç¬¬äºŒå¼ å›¾ç‰‡&lt;/h1&gt;</span><br><span class="line">	&lt;img src=&quot;2.jpg&quot; /&gt;</span><br><span class="line">	&lt;h1&gt;ç¬¬ä¸‰å¼ å›¾ç‰‡&lt;/h1&gt;</span><br><span class="line">	&lt;img src=&quot;3.jpg&quot; /&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>å°†SimpleHttpServerçš„æ ¹ç›®å½•è®¾å®šåˆ°è¯¥HTMLé¡µé¢æ‰€åœ¨ç›®å½•ï¼Œå¹¶å¯åŠ¨SimpleHttpServerã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">    SimpleHttpServer.setBasePath(&quot;C:\Users\Administrator\Desktop\server&quot;);</span><br><span class="line">    SimpleHttpServer.setPort(8080);</span><br><span class="line">    SimpleHttpServer.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âš ï¸çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼š<br>çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå…·ä½“çš„æ•°é‡éœ€è¦è¯„ä¼°æ¯ä¸ªä»»åŠ¡çš„å¤„ç†æ—¶é—´ï¼Œä»¥åŠå½“å‰è®¡ç®—æœºçš„å¤„ç†å™¨èƒ½åŠ›å’Œæ•°é‡ã€‚ä½¿ç”¨çš„çº¿ç¨‹è¿‡å°‘ï¼Œæ— æ³•å‘æŒ¥å¤„ç†å™¨çš„æ€§èƒ½ï¼›ä½¿ç”¨çš„çº¿ç¨‹è¿‡å¤šï¼Œå°†ä¼šå¢åŠ ç³»ç»Ÿçš„æ— æ•…å¼€é”€ï¼Œèµ·åˆ°ç›¸åçš„ä½œç”¨ã€‚</p>
<p>åŸä¹¦ç¬”è®°ï¼š<a href="https://blog.csdn.net/weixin_46949627/article/details/127009251">https://blog.csdn.net/weixin_46949627/article/details/127009251</a></p>
<h2 id="ç¬¬äº”ç« -javaä¸­çš„é”"><a href="#ç¬¬äº”ç« -javaä¸­çš„é”" class="headerlink" title="ç¬¬äº”ç«  javaä¸­çš„é”"></a>ç¬¬äº”ç«  javaä¸­çš„é”</h2><p>ä»‹ç»javaå¹¶å‘åŒ…ä¸­ä¸é”ç›¸å…³çš„APIå’Œç»„ä»¶ï¼Œä»¥åŠè¿™äº›APIå’Œç»„ä»¶çš„ä½¿ç”¨æ–¹å¼å’Œå®ç°ç»†èŠ‚ã€‚</p>
<h3 id="1-Lockæ¥å£"><a href="#1-Lockæ¥å£" class="headerlink" title="1.Lockæ¥å£"></a>1.Lockæ¥å£</h3><p>é”æ˜¯ç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºçš„æ–¹å¼ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªé”èƒ½å¤Ÿé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºï¼ˆä½†æ˜¯æœ‰äº›é”å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹å¹¶å‘çš„è®¿é—®å…±äº«èµ„æºï¼Œæ¯”å¦‚è¯»å†™é”ï¼‰ã€‚</p>
<h4 id="âœ…Lockæ¥å£å’Œsynchronizedå…³é”®å­—çš„å¯¹æ¯”"><a href="#âœ…Lockæ¥å£å’Œsynchronizedå…³é”®å­—çš„å¯¹æ¯”" class="headerlink" title="âœ…Lockæ¥å£å’Œsynchronizedå…³é”®å­—çš„å¯¹æ¯”"></a>âœ…Lockæ¥å£å’Œsynchronizedå…³é”®å­—çš„å¯¹æ¯”</h4><p>åœ¨Lockæ¥å£å‡ºç°ä¹‹å‰ï¼ŒJavaç¨‹åºæ˜¯é synchronizedå…³é”®å­—å®ç°é”åŠŸèƒ½çš„ï¼Œè€ŒJava SE 5ä¹‹åï¼Œå¹¶å‘åŒ…ä¸­æ–°å¢äº†Lockæ¥å£ï¼ˆä»¥åŠç›¸å…³å®ç°ç±»ï¼‰ç”¨æ¥å®ç°é”åŠŸèƒ½ï¼Œå®ƒæä¾›äº†ä¸synchronizedå…³é”®å­—ç±»ä¼¼çš„åŒæ­¥åŠŸèƒ½ï¼Œåªæ˜¯åœ¨ä½¿ç”¨æ—¶éœ€è¦æ˜¾å¼åœ°è·å–å’Œé‡Šæ”¾é”ã€‚</p>
<p>è™½ç„¶å®ƒç¼ºå°‘äº†ï¼ˆé€šè¿‡synchronizedå—æˆ–è€…æ–¹æ³•æ‰€æä¾›çš„ï¼‰éšå¼è·å–é‡Šæ”¾é”çš„ä¾¿æ·æ€§ï¼Œä½†æ˜¯å´æ‹¥æœ‰äº†é”è·å–ä¸é‡Šæ”¾çš„å¯æ“ä½œæ€§ã€å¯ä¸­æ–­çš„è·å–é”ä»¥åŠè¶…æ—¶è·å–é”ç­‰å¤šç§synchronizedå…³é”®å­—æ‰€ä¸å…·å¤‡çš„åŒæ­¥ç‰¹æ€§ã€‚</p>
<p>ä½¿ç”¨synchronizedå…³é”®å­—å°†ä¼šéšå¼åœ°è·å–é”ï¼Œä½†æ˜¯å®ƒå°†é”çš„è·å–å’Œé‡Šæ”¾å›ºåŒ–äº†ï¼Œä¹Ÿå°±æ˜¯å…ˆè·å–å†é‡Šæ”¾ã€‚å½“ç„¶ï¼Œè¿™ç§æ–¹å¼ç®€åŒ–äº†åŒæ­¥çš„ç®¡ç†ï¼Œå¯æ˜¯æ‰©å±•æ€§æ²¡æœ‰æ˜¾ç¤ºçš„é”è·å–å’Œé‡Šæ”¾æ¥çš„å¥½ã€‚ä¾‹å¦‚ï¼šå…ˆè·å¾—é”Aï¼Œç„¶åå†è·å–é”Bã€‚</p>
<p>Lockçš„ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Lock lock = new ReentrantLock();</span><br><span class="line">lock.lock();</span><br><span class="line">try &#123;</span><br><span class="line"></span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨finallyå—ä¸­é‡Šæ”¾é”ï¼Œç›®çš„æ˜¯ä¿è¯åœ¨è·å–åˆ°é”ä¹‹åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¢«é‡Šæ”¾ã€‚ä¸è¦å°†è·å–é”çš„è¿‡ç¨‹å†™åœ¨tryå—ä¸­ï¼Œå› ä¸ºå¦‚æœåœ¨è·å–é”ï¼ˆè‡ªå®šä¹‰é”çš„å®ç°ï¼‰æ—¶å‘ç”Ÿäº†å¼‚å¸¸ï¼Œå¼‚å¸¸æŠ›å‡ºçš„åŒæ—¶ï¼Œä¹Ÿä¼šå¯¼è‡´é”æ— æ•…é‡Šæ”¾ã€‚</p>
<p>Lockå…·å¤‡çš„sychronizedå…³é”®å­—ä¸å…·å¤‡çš„ç‰¹ç‚¹ï¼š<br>1ã€éé˜»å¡åœ°è·å–é”<br>2ã€èƒ½è¢«ä¸­æ–­åœ°è·å–é”ï¼ˆè·å–åˆ°é”çš„çº¿ç¨‹èƒ½å“åº”ä¸­æ–­ï¼Œä¸­æ–­å¼‚å¸¸è¢«æŠ›å‡ºï¼ŒåŒæ—¶é”é‡Šæ”¾ï¼‰<br>3ã€è¶…æ—¶è·å–é”ï¼ˆæˆªæ­¢æ—¶é—´æ— æ³•è·å–é”ï¼Œåˆ™è¿”å›ï¼‰</p>
<h4 id="âœ…Lockæ¥å£ä¸­çš„API"><a href="#âœ…Lockæ¥å£ä¸­çš„API" class="headerlink" title="âœ…Lockæ¥å£ä¸­çš„API"></a>âœ…Lockæ¥å£ä¸­çš„API</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void lock()</span><br><span class="line">è·å–é”ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å½“å‰çº¿ç¨‹å°†ä¼šè·å–é”ï¼Œå½“é”è·å¾—åï¼Œä»è¯¥æ–¹æ³•è¿”å›</span><br><span class="line"></span><br><span class="line">void lockInterruptibly() throws InterruptedException	</span><br><span class="line">å¯ä¸­æ–­åœ°è·å–é”ï¼Œå’Œ lock()æ–¹æ³•çš„ä¸åŒä¹‹å¤„åœ¨äºè¯¥æ–¹æ³•ä¼šå“åº”ä¸­æ–­ï¼Œå³åœ¨é”çš„è·å–ä¸­å¯ä»¥ä¸­æ–­å½“å‰çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">boolean tryLock()	</span><br><span class="line">å°è¯•éé˜»å¡çš„è·å–é”ï¼Œè°ƒç”¨è¯¥æ–¹æ³•åç«‹åˆ»è¿”å›ï¼Œå¦‚æœèƒ½å¤Ÿè·å–åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false</span><br><span class="line"></span><br><span class="line">boolean tryLock(1ong time,TimeUnit unit) throws InterruptedException	</span><br><span class="line">è¶…æ—¶çš„è·å–é”ï¼Œå½“å‰çº¿ç¨‹åœ¨ä»¥ä¸‹3ç§æƒ…å†µä¸‹ä¼šè¿”å›ï¼šâ‘ å½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…è·å¾—äº†é” â‘¡å½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…è¢«ä¸­æ–­ â‘¢è¶…æ—¶æ—¶é—´ç»“æŸï¼Œè¿”å›false</span><br><span class="line"></span><br><span class="line">void unlock() </span><br><span class="line">é‡Šæ”¾é”</span><br><span class="line"></span><br><span class="line">Condition newCondition()	</span><br><span class="line">è·å–ç­‰å¾…é€šçŸ¥ç»„ä»¶ï¼Œè¯¥ç»„ä»¶å’Œå½“å‰çš„é”ç»‘å®šï¼Œå½“å‰çº¿ç¨‹åªæœ‰è·å¾—äº†é”ï¼Œæ‰èƒ½è°ƒç”¨è¯¥ç»„ä»¶çš„ wait()æ–¹æ³•ï¼Œè€Œè°ƒç”¨åï¼Œå½“å‰çº¿ç¨‹å°†é‡Šæ”¾é”</span><br></pre></td></tr></table></figure>

<p>éšåä¼šè¯¦ç»†ä»‹ç»åŒæ­¥å™¨AbstractQueuedSynchronizerä»¥åŠå¸¸ç”¨Lockæ¥å£çš„å®ç°ReentrantLockã€‚Lockæ¥å£çš„å®ç°åŸºæœ¬éƒ½æ˜¯é€šè¿‡èšåˆäº†ä¸€ä¸ªåŒæ­¥å™¨çš„å­ç±»æ¥å®Œæˆçº¿ç¨‹è®¿é—®æ§åˆ¶çš„ã€‚</p>
<h3 id="2-é˜Ÿåˆ—åŒæ­¥å™¨"><a href="#2-é˜Ÿåˆ—åŒæ­¥å™¨" class="headerlink" title="2.é˜Ÿåˆ—åŒæ­¥å™¨"></a>2.é˜Ÿåˆ—åŒæ­¥å™¨</h3><p>é˜Ÿåˆ—åŒæ­¥å™¨ AbstractQueuedSynchronizerï¼ˆAQSï¼Œä»¥ä¸‹ç®€ç§°åŒæ­¥å™¨ï¼‰ï¼Œæ˜¯ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªintæˆå‘˜å˜é‡è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚</p>
<p>åŒæ­¥å™¨æä¾›çš„3ä¸ªæ–¹æ³•æ¥å¯¹åŒæ­¥çŠ¶æ€è¿›è¡Œæ›´æ”¹ï¼Œå®ƒä»¬èƒ½å¤Ÿä¿è¯çŠ¶æ€çš„æ”¹å˜æ˜¯å®‰å…¨çš„:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">getState()  è·å–å½“å‰åŒæ­¥çŠ¶æ€ã€‚</span><br><span class="line">setState(int newState)  è®¾ç½®å½“å‰åŒæ­¥çŠ¶æ€ã€‚</span><br><span class="line">compareAndSetState(int expect,int update)ï¼‰ ä½¿ç”¨CASè®¾ç½®å½“å‰çŠ¶æ€ï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿä¿è¯çŠ¶æ€</span><br></pre></td></tr></table></figure>

<p>å­ç±»é€šè¿‡ç»§æ‰¿åŒæ­¥å™¨å¹¶å®ç°å®ƒçš„æŠ½è±¡æ–¹æ³•æ¥ç®¡ç†åŒæ­¥çŠ¶æ€ï¼Œå­ç±»æ¨èè¢«å®šä¹‰ä¸ºè‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„é™æ€å†…éƒ¨ç±»ã€‚åŒæ­¥å™¨è‡ªèº«æ²¡æœ‰å®ç°ä»»ä½•åŒæ­¥æ¥å£ï¼Œå®ƒä»…ä»…æ˜¯å®šä¹‰äº†ä¸Šé¢åŒæ­¥çŠ¶æ€è·å–å’Œé‡Šæ”¾çš„æ–¹æ³•æ¥ä¾›è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶ä½¿ç”¨ï¼ŒåŒæ­¥å™¨æ—¢å¯ä»¥æ”¯æŒç‹¬å å¼åœ°è·å–åŒæ­¥çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥æ”¯æŒå…±äº«å¼åœ°è·å–åŒæ­¥çŠ¶æ€ï¼Œè¿™æ ·å°±å¯ä»¥æ–¹ä¾¿å®ç°ä¸åŒç±»å‹çš„åŒæ­¥ç»„ä»¶ï¼š<br>ReentrantLock<br>ReentrantReadWriteLock<br>CountDownLatch</p>
<p>é˜Ÿåˆ—åŒæ­¥å™¨ä¸é”çš„å…³ç³»ï¼š</p>
<p>åŒæ­¥å™¨æ˜¯å®ç°é”ï¼ˆä¹Ÿå¯ä»¥æ˜¯ä»»æ„åŒæ­¥ç»„ä»¶ï¼‰çš„å…³é”®ï¼Œåœ¨é”çš„å®ç°ä¸­èšåˆåŒæ­¥å™¨ï¼Œåˆ©ç”¨åŒæ­¥å™¨å®ç°é”çš„è¯­ä¹‰ã€‚</p>
<p>1ã€é”æ˜¯é¢å‘ä½¿ç”¨è€…çš„ï¼Œå®ƒå®šä¹‰äº†ä½¿ç”¨è€…ä¸é”äº¤äº’çš„æ¥å£ï¼ˆæ¯”å¦‚å¯ä»¥å…è®¸ä¸¤ä¸ªçº¿ç¨‹å¹¶è¡Œè®¿é—®ï¼‰ï¼Œéšè—äº†å®ç°ç»†èŠ‚<br>2ã€åŒæ­¥å™¨é¢å‘çš„æ˜¯é”çš„å®ç°è€…ï¼Œå®ƒç®€åŒ–äº†é”çš„å®ç°æ–¹å¼ï¼Œå±è”½äº†åŒæ­¥çŠ¶æ€ç®¡ç†ã€çº¿ç¨‹çš„æ’é˜Ÿã€ç­‰å¾…ä¸å”¤é†’ç­‰åº•å±‚æ“ä½œã€‚é”å’ŒåŒæ­¥å™¨å¾ˆå¥½åœ°éš”ç¦»äº†ä½¿ç”¨è€…å’Œå®ç°è€…æ‰€éœ€å…³æ³¨çš„é¢†åŸŸã€‚</p>
<h4 id="âœ…é˜Ÿåˆ—åŒæ­¥å™¨çš„æ¥å£ä¸ç¤ºä¾‹"><a href="#âœ…é˜Ÿåˆ—åŒæ­¥å™¨çš„æ¥å£ä¸ç¤ºä¾‹" class="headerlink" title="âœ…é˜Ÿåˆ—åŒæ­¥å™¨çš„æ¥å£ä¸ç¤ºä¾‹"></a>âœ…é˜Ÿåˆ—åŒæ­¥å™¨çš„æ¥å£ä¸ç¤ºä¾‹</h4><p>åŒæ­¥å™¨çš„è®¾è®¡æ˜¯åŸºäºæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨è€…éœ€è¦ç»§æ‰¿åŒæ­¥å™¨å¹¶é‡å†™æŒ‡å®šçš„æ–¹æ³•ï¼Œéšåå°†åŒæ­¥å™¨ä½œä¸ºé™æ€å†…éƒ¨ç±»ç»„åˆåœ¨è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„å®ç°ä¸­ï¼Œå¹¶è°ƒç”¨åŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•ã€‚</p>
<p><strong>åŒæ­¥å™¨å¯é‡å†™çš„æ–¹æ³•</strong>ï¼ŒåŒ…å«ä¸¤ç§ï¼Œä¸€ç§æ˜¯è·å–ç‹¬å é”ï¼Œä¸€ç§æ˜¯è·å–å…±äº«é”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œå®ç°è¯¥æ–¹æ³•éœ€è¦æŸ¥è¯¢å½“å‰çŠ¶æ€ï¼Œå¹¶åˆ¤æ–­åŒæ­¥çŠ¶æ€æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œç„¶åé€šè¿‡CASè®¾ç½®åŒæ­¥çŠ¶æ€ï¼ˆéé˜»å¡çš„ï¼Ÿï¼‰</span><br><span class="line"> */</span><br><span class="line">protected boolean tryAcquire(int arg) &#123;</span><br><span class="line">    throw new UnsupportedOperationException();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œæ­¤æ—¶ç­‰å¾…è·å–åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹å°†æœ‰æœºä¼šè·å–åŒæ­¥çŠ¶æ€</span><br><span class="line"> */</span><br><span class="line">protected boolean tryRelease(int arg) &#123;</span><br><span class="line">    throw new UnsupportedOperationException();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œè¿”å›ç»“æœå¤§äºç­‰äº0ï¼Œè¡¨ç¤ºè·å–æˆåŠŸï¼Œå¦åˆ™è·å–å¤±è´¥</span><br><span class="line"> */</span><br><span class="line">protected int tryAcquireShared(int arg) &#123;</span><br><span class="line">    throw new UnsupportedOperationException();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å…±äº«å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€</span><br><span class="line"> */</span><br><span class="line">protected boolean tryReleaseShared(int arg) &#123;</span><br><span class="line">    throw new UnsupportedOperationException();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ˜¯å¦è¢«å½“å‰çº¿ç¨‹æ‰€ç‹¬å </span><br><span class="line"> */</span><br><span class="line">protected boolean isHeldExclusively() &#123;</span><br><span class="line">    throw new UnsupportedOperationException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ç°è‡ªå®šä¹‰çš„åŒæ­¥å™¨ç»„ä»¶æ—¶ï¼Œå°†ä¼šè°ƒç”¨<strong>åŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•</strong>ï¼ŒåŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•åˆ†ä¸ºä¸‰ç±»ï¼šä¸€æ˜¯ç‹¬å å¼è·å–ä¸é‡Šæ”¾åŒæ­¥çŠ¶æ€ã€äºŒæ˜¯å…±äº«å¼è·å–ä¸é‡Šæ”¾åŒæ­¥çŠ¶æ€ã€ä¸‰æ˜¯æŸ¥è¯¢åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…çº¿ç¨‹çš„æƒ…å†µã€‚è‡ªå®šä¹‰çš„åŒæ­¥å™¨å°†ä½¿ç”¨è¿™äº›æä¾›çš„æ¨¡æ¿æ–¹æ³•æ¥å®ç°è‡ªå·±çš„åŒæ­¥è¯­ä¹‰ã€‚åŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€</span><br><span class="line"> * å¦‚æœå½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œåˆ™è¯¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå¦åˆ™ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¿›å…¥</span><br><span class="line"> * åŒæ­¥é˜Ÿåˆ—ç­‰å¾…ï¼Œè¯¥æ–¹æ³•å°†ä¼šè°ƒç”¨é‡å†™çš„tryAcquireæ–¹æ³•ï¼ˆåŒºåˆ«ï¼šä¸€ä¸ªæœ‰è¿”å›ï¼Œä¸€ä¸ªæ²¡æœ‰ï¼Œè¾“å…¥æ²¡ä»€ä¹ˆç”¨ï¼Ÿï¼‰</span><br><span class="line"> */</span><br><span class="line">public final void acquire(int arg) &#123;</span><br><span class="line">    if (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">        selfInterrupt();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€</span><br><span class="line"> * ä¸acquire ç›¸åŒï¼Œä½†æ˜¯è¯¥æ–¹æ³•å“åº”ä¸­æ–­ï¼Œå½“å‰çº¿ç¨‹æœªè·å–åˆ°åŒæ­¥çŠ¶æ€åˆ™è¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼›å¦‚æœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­ï¼Œåˆ™è¯¥æ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸å¹¶è¿”å›</span><br><span class="line"> */</span><br><span class="line">public final void acquireInterruptibly(int arg)</span><br><span class="line">        throws InterruptedException &#123;</span><br><span class="line">    if (Thread.interrupted())</span><br><span class="line">        throw new InterruptedException();</span><br><span class="line">    if (!tryAcquire(arg))</span><br><span class="line">        doAcquireInterruptibly(arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€</span><br><span class="line"> * è¯¥æ–¹æ³•åœ¨ acquireInterruptibly(int arg) åŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶é™åˆ¶ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰è·å–åŒæ­¥çŠ¶æ€ï¼Œé‚£ä¹ˆå°†è¿”å›falseï¼Œå¦åˆ™è¿”å›true</span><br><span class="line"> */</span><br><span class="line">public final boolean tryAcquireNanos(int arg, long nanosTimeout)</span><br><span class="line">        throws InterruptedException &#123;</span><br><span class="line">    if (Thread.interrupted())</span><br><span class="line">        throw new InterruptedException();</span><br><span class="line">    return tryAcquire(arg) ||</span><br><span class="line">        doAcquireNanos(arg, nanosTimeout);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€</span><br><span class="line"> * è¯¥æ–¹æ³•ä¼šåœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€åï¼Œå°†åŒæ­¥é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„çº¿ç¨‹å”¤é†’</span><br><span class="line"> */</span><br><span class="line">public final boolean release(int arg) &#123;</span><br><span class="line">    if (tryRelease(arg)) &#123;</span><br><span class="line">        Node h = head;</span><br><span class="line">        if (h != null &amp;&amp; h.waitStatus != 0)</span><br><span class="line">            unparkSuccessor(h);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€</span><br><span class="line"> * ä¸ç‹¬å å¼çš„åŒºåˆ«åœ¨äºï¼ŒåŒä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹è·å¾—åŒæ­¥çŠ¶æ€</span><br><span class="line"> */</span><br><span class="line">public final void acquireShared(int arg) &#123;</span><br><span class="line">    if (tryAcquireShared(arg) &lt; 0)</span><br><span class="line">        doAcquireShared(arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€</span><br><span class="line"> * ä¸æ–¹æ³•acquireShared(int arg) ä¸€æ ·ï¼Œåªæ˜¯è¯¥æ–¹æ³•å“åº”ä¸­æ–­</span><br><span class="line"> */</span><br><span class="line">public final void acquireSharedInterruptibly(int arg)</span><br><span class="line">        throws InterruptedException &#123;</span><br><span class="line">    if (Thread.interrupted())</span><br><span class="line">        throw new InterruptedException();</span><br><span class="line">    if (tryAcquireShared(arg) &lt; 0)</span><br><span class="line">        doAcquireSharedInterruptibly(arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€</span><br><span class="line"> * åœ¨æ–¹æ³• acquireSharedInterruptibly(int arg) åŸºç¡€ä¸Šï¼Œå¢åŠ äº†è¶…æ—¶é™åˆ¶</span><br><span class="line"> */</span><br><span class="line">public final boolean tryAcquireSharedNanos(int arg, long nanosTimeout)</span><br><span class="line">        throws InterruptedException &#123;</span><br><span class="line">    if (Thread.interrupted())</span><br><span class="line">        throw new InterruptedException();</span><br><span class="line">    return tryAcquireShared(arg) &gt;= 0 ||</span><br><span class="line">        doAcquireSharedNanos(arg, nanosTimeout);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å…±äº«å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€</span><br><span class="line"> */</span><br><span class="line">public final boolean releaseShared(int arg) &#123;</span><br><span class="line">    if (tryReleaseShared(arg)) &#123;</span><br><span class="line">        doReleaseShared();</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è·å–åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šç­‰å¾…çš„çº¿ç¨‹çš„é›†åˆ</span><br><span class="line"> */</span><br><span class="line">public final Collection&lt;Thread&gt; getQueuedThreads() &#123;</span><br><span class="line">    ArrayList&lt;Thread&gt; list = new ArrayList&lt;Thread&gt;();</span><br><span class="line">    for (Node p = tail; p != null; p = p.prev) &#123;</span><br><span class="line">        Thread t = p.thread;</span><br><span class="line">        if (t != null)</span><br><span class="line">            list.add(t);</span><br><span class="line">    &#125;</span><br><span class="line">    return list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¾è€Œæ˜“è§ï¼Œç‹¬å é”æ˜¯åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ï¼Œè€Œå…¶ä»–è·å–é”çš„çº¿ç¨‹åªèƒ½åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œåªæœ‰æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾äº†ï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½è·å¾—é”ã€‚<strong>ç‹¬å é”çš„ç¤ºä¾‹</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Mutex implements Lock &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * é™æ€å†…éƒ¨ç±»è‡ªå®šä¹‰åŒæ­¥å™¨</span><br><span class="line">     */</span><br><span class="line">    private static class Sync extends AbstractQueuedSynchronizer &#123;</span><br><span class="line">        /**</span><br><span class="line">         * æ˜¯å¦å¤„äºç‹¬å çŠ¶æ€</span><br><span class="line">         */</span><br><span class="line">        @Override</span><br><span class="line">        protected boolean isHeldExclusively() &#123;</span><br><span class="line">            return getState() == 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * ç‹¬å å¼è·å–é”ï¼ŒçŠ¶æ€ä¸º0æ—¶è·å–é”</span><br><span class="line">         * å¦‚æœç»è¿‡CASè®¾ç½®æˆåŠŸï¼ˆåŒæ­¥çŠ¶æ€è®¾ç½®ä¸º1ï¼‰</span><br><span class="line">         */</span><br><span class="line">        @Override</span><br><span class="line">        public boolean tryAcquire(int acquires) &#123;</span><br><span class="line">            if (compareAndSetState(0, 1)) &#123;  //0æ˜¯æœŸæœ›ï¼Œ1æ˜¯æ›´æ–°</span><br><span class="line">                setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * ç‹¬å å¼é‡Šæ”¾é”ï¼Œåªæ˜¯å°†çŠ¶æ€ç½®ä¸º0</span><br><span class="line">         */</span><br><span class="line">        @Override</span><br><span class="line">        protected boolean tryRelease(int releases) &#123;</span><br><span class="line">            if (getState() == 0) &#123;</span><br><span class="line">                throw new IllegalMonitorStateException();</span><br><span class="line">            &#125;</span><br><span class="line">            setExclusiveOwnerThread(null);</span><br><span class="line">            setState(0);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * å®ä¾‹åŒ–ä¸€ä¸ª Conditionï¼Œæ¯ä¸ª Condition éƒ½åŒ…å«ä¸€ä¸ªé˜Ÿåˆ—</span><br><span class="line">         */</span><br><span class="line">        Condition newCondition() &#123;</span><br><span class="line">            return new ConditionObject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static final Sync sync = new Sync();</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void lock() &#123;</span><br><span class="line">        sync.acquire(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean tryLock() &#123;</span><br><span class="line">        return sync.tryAcquire(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void unlock() &#123;</span><br><span class="line">        sync.release(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Condition newCondition() &#123;</span><br><span class="line">        return sync.newCondition();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isLocked() &#123;</span><br><span class="line">        return sync.isHeldExclusively();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean hasQueuedThreads() &#123;</span><br><span class="line">        return sync.hasQueuedThreads();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void lockInterruptibly() throws InterruptedException &#123;</span><br><span class="line">        sync.acquireInterruptibly(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean tryLock(long timeout, TimeUnit unit) throws InterruptedException &#123;</span><br><span class="line">        return sync.tryAcquireNanos(1, unit.toNanos(timeout));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¥éª¤ï¼š<br>1ã€è‡ªå®šä¹‰å®šä¹‰ç‹¬å é”å®ç°Lockï¼Œæ‰€ä»¥éœ€è¦å®ç°Lockæ¥å£ä¸­çš„API<br>2ã€è‡ªå®šä¹‰åŒæ­¥å™¨ä½œä¸ºé™æ€å†…éƒ¨ç±»ç»§æ‰¿è‡ªåŒæ­¥å™¨ï¼Œé‡å†™åŒæ­¥å™¨æ–¹æ³•ï¼Œå®ç°ç‹¬å å¼è·å–å’Œé‡Šæ”¾åŒæ­¥çŠ¶æ€<br>3ã€Lockçš„APIä¸­ä½¿ç”¨åŒæ­¥å™¨çš„é‡å†™æ–¹æ³•&#x2F;æ¨¡ç‰ˆæ–¹æ³•</p>
<p>åœ¨ä½¿ç”¨è‡ªå®šä¹‰åŒæ­¥å™¨Mutex æ—¶ï¼Œä¸ä¼šç›´æ¥ä¸å†…éƒ¨åŒæ­¥å™¨äº¤äº’ï¼Œè€Œæ˜¯é€šè¿‡Mutex æä¾›çš„æ–¹æ³•ã€‚</p>
<p>lockå’ŒtryLockçš„åŒºåˆ«ï¼š<br>lockæ˜¯éé˜»å¡çš„ï¼Œä¼šä¸€ç›´å°è¯•æˆ–é”ï¼Œç”¨acquireæ–¹æ³•ï¼ˆå†…éƒ¨ç”¨tryAcquireæ–¹æ³•ï¼‰çº¿ç¨‹è°ƒç”¨è¯¥æ–¹æ³•è·å–åŒæ­¥çŠ¶æ€å¤±è´¥åä¼šè¢«åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼›tryLockæ˜¯é˜»å¡çš„ï¼Œè·å–ä¸€æ¬¡ï¼Œæ‰€ä»¥ç›´æ¥ç”¨tryAcquireæ–¹æ³•ã€‚</p>
<p>Conditionæ˜¯ä»€ä¹ˆï¼Ÿ<br>ConditionObject æ˜¯AQSçš„å†…éƒ¨ç±»ï¼Œç”¨æ¥ç»´æŠ¤ç­‰å¾…é˜Ÿåˆ—<br>AQSå†…éƒ¨å®é™…ä¸Šæœ‰ä¸¤ä¸ªé˜Ÿåˆ—<br>åŒæ­¥é˜Ÿåˆ—ï¼šå…¬å¹³&#x2F;éå…¬å¹³ï¼Œå…±äº«&#x2F;éå…±äº«<br>ç­‰å¾…é˜Ÿåˆ—ï¼šæ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯Condition<br>ç­‰å¾…é˜Ÿåˆ—ä¸­å°±æ˜¯ç”¨awaitæ–¹æ³•æ—¶ä»»åŠ¡è¿›å…¥çš„é˜Ÿåˆ—ï¼ˆç±»ä¼¼ä¹‹å‰ä½¿ç”¨çš„waitï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡åªæœ‰å”¤é†’æ‰ä¼šå°è¯•è·å–é”ï¼Œä»¥æ­¤å‡å°‘CPUé¢‘ç¹çš„è·å–é”ï¼‰ï¼Œé€šè¿‡signalå”¤é†’ã€‚</p>
<h4 id="âœ…é˜Ÿåˆ—åŒæ­¥å™¨çš„å®ç°åˆ†æ"><a href="#âœ…é˜Ÿåˆ—åŒæ­¥å™¨çš„å®ç°åˆ†æ" class="headerlink" title="âœ…é˜Ÿåˆ—åŒæ­¥å™¨çš„å®ç°åˆ†æ"></a>âœ…é˜Ÿåˆ—åŒæ­¥å™¨çš„å®ç°åˆ†æ</h4><p>æ¥ä¸‹æ¥å°†ä»å®ç°è§’åº¦åˆ†æåŒæ­¥å™¨æ˜¯å¦‚ä½•å®Œæˆçº¿ç¨‹åŒæ­¥çš„ã€‚<br>ä¸»è¦åŒ…æ‹¬ï¼šåŒæ­¥é˜Ÿåˆ—ã€ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾ã€å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾ä»¥åŠè¶…æ—¶è·å–åŒæ­¥çŠ¶æ€ç­‰åŒæ­¥å™¨çš„æ ¸å¿ƒæ•°æ®ç»“æ„ä¸æ¨¡æ¿æ–¹æ³•ã€‚</p>
<h5 id="ä¸€ã€åŒæ­¥é˜Ÿåˆ—"><a href="#ä¸€ã€åŒæ­¥é˜Ÿåˆ—" class="headerlink" title="ä¸€ã€åŒæ­¥é˜Ÿåˆ—"></a>ä¸€ã€åŒæ­¥é˜Ÿåˆ—</h5><p>åŒæ­¥å™¨ä¾èµ–å†…éƒ¨çš„åŒæ­¥é˜Ÿåˆ—ï¼ˆä¸€ä¸ªFIFOåŒå‘é˜Ÿåˆ—,FIFOå…ˆè¿›å…ˆå‡ºï¼‰æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†ã€‚</p>
<p>å½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ï¼ŒåŒæ­¥å™¨ä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„é€ æˆä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼Œå®ƒä¹Ÿæ˜¯AQSçš„å†…éƒ¨ç±»ï¼‰å¹¶å°†å…¶åŠ å…¥åŒæ­¥é˜Ÿåˆ—çš„å°¾éƒ¨ï¼ŒåŒæ—¶ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œå½“åŒæ­¥çŠ¶æ€é‡Šæ”¾æ—¶ï¼Œä¼šæŠŠé¦–èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹å”¤é†’ï¼Œä½¿å…¶å†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚åŒæ­¥é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹ï¼ˆNodeï¼‰ç”¨æ¥ä¿å­˜è·å–åŒæ­¥çŠ¶æ€å¤±è´¥çš„çº¿ç¨‹å¼•ç”¨ã€ç­‰å¾…çŠ¶æ€ä»¥åŠå‰é©±å’Œåç»§èŠ‚ç‚¹ã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹æˆåŠŸåœ°è·å–äº†åŒæ­¥çŠ¶æ€ï¼ˆæˆ–è€…é”ï¼‰ï¼Œå…¶ä»–çº¿ç¨‹å°†æ— æ³•è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œè½¬è€Œè¢«æ„é€ æˆä¸ºèŠ‚ç‚¹å¹¶åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè€Œè¿™ä¸ªåŠ å…¥é˜Ÿåˆ—çš„è¿‡ç¨‹å¿…é¡»è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå› æ­¤åŒæ­¥å™¨æä¾›äº†ä¸€ä¸ªåŸºäºCASçš„è®¾ç½®å°¾èŠ‚ç‚¹çš„æ–¹æ³•ï¼š<code>compareAndSetTail(Node expect,Node update)</code>ï¼Œå®ƒéœ€è¦ä¼ é€’å½“å‰çº¿ç¨‹â€œè®¤ä¸ºâ€çš„å°¾èŠ‚ç‚¹å’Œå½“å‰èŠ‚ç‚¹ï¼Œåªæœ‰è®¾ç½®æˆåŠŸåï¼Œå½“å‰èŠ‚ç‚¹æ‰æ­£å¼ä¸ä¹‹å‰çš„å°¾èŠ‚ç‚¹å»ºç«‹å…³è”ã€‚</p>
<p>åŒæ­¥é˜Ÿåˆ—éµå¾ªFIFOï¼Œé¦–èŠ‚ç‚¹æ˜¯è·å–åŒæ­¥çŠ¶æ€æˆåŠŸçš„èŠ‚ç‚¹ï¼Œé¦–èŠ‚ç‚¹çš„çº¿ç¨‹åœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€æ—¶ï¼Œå°†ä¼šå”¤é†’åç»§èŠ‚ç‚¹ï¼Œè€Œåç»§èŠ‚ç‚¹å°†ä¼šåœ¨è·å–åŒæ­¥çŠ¶æ€æˆåŠŸæ—¶å°†è‡ªå·±è®¾ç½®ä¸ºé¦–èŠ‚ç‚¹ã€‚ï¼ˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œæ‰€ä»¥è®¾ç½®å¤´èŠ‚ç‚¹çš„æ–¹æ³•å¹¶ä¸éœ€è¦ä½¿ç”¨CASæ¥ä¿è¯ï¼Œå®ƒåªéœ€è¦å°†é¦–èŠ‚ç‚¹è®¾ç½®æˆä¸ºåŸé¦–èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹å¹¶æ–­å¼€åŸé¦–èŠ‚ç‚¹çš„nextå¼•ç”¨å³å¯ã€‚ï¼‰</p>
<h5 id="äºŒã€ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–å’Œé‡Šæ”¾"><a href="#äºŒã€ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–å’Œé‡Šæ”¾" class="headerlink" title="äºŒã€ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–å’Œé‡Šæ”¾"></a>äºŒã€ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–å’Œé‡Šæ”¾</h5><p>åŒæ­¥å™¨çš„ <code>acquire(int arg)</code> æ–¹æ³•å¯ä»¥è·å–åŒæ­¥çŠ¶æ€ï¼ˆé˜»å¡å‹çš„ï¼Œç›¸å½“äºæ˜¯è·é”ï¼‰ï¼Œè¯¥æ–¹æ³•å¯¹ä¸­æ–­ä¸æ•æ„Ÿï¼Œä¹Ÿå°±æ˜¯ç”±äºçº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥åè¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œåç»­å¯¹çº¿ç¨‹è¿›è¡Œä¸­æ–­æ“ä½œæ—¶ï¼Œ<strong>çº¿ç¨‹ä¸ä¼šä»åŒæ­¥é˜Ÿåˆ—ä¸­ç§»å‡º</strong>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final void acquire(int arg) &#123;</span><br><span class="line">	if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">		selfInterrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å®Œæˆäº†åŒæ­¥çŠ¶æ€è·å–ã€èŠ‚ç‚¹æ„é€ ã€åŠ å…¥åŒæ­¥é˜Ÿåˆ—ä»¥åŠåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è‡ªæ—‹ç­‰å¾…çš„ç›¸å…³å·¥ä½œã€‚é¦–å…ˆtryAcquireéé˜»å¡å‹åœ°è·å–ï¼Œå¦‚æœè·å–åˆ°ç›´æ¥è¿”å›äº†ï¼Œè·å–ä¸åˆ°ï¼Œå°±æ„é€ èŠ‚ç‚¹åŠ å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ä¼šä¸€ç›´è‡ªæ—‹å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚</p>
<p>æ­¥éª¤ï¼š<br>1ã€è°ƒç”¨è‡ªå®šä¹‰åŒæ­¥å™¨å®ç°çš„ tryAcquire(int arg) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¿è¯çº¿ç¨‹å®‰å…¨çš„è·å–åŒæ­¥çŠ¶æ€</p>
<p>2ã€å¦‚æœåŒæ­¥çŠ¶æ€è·å–å¤±è´¥ï¼Œåˆ™æ„é€ åŒæ­¥èŠ‚ç‚¹ï¼ˆç‹¬å å¼Node.EXCLUSIVEï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æˆåŠŸè·å–åŒæ­¥çŠ¶æ€ï¼‰å¹¶é€šè¿‡ addWaiter(Node node) æ–¹æ³•å°†è¯¥èŠ‚ç‚¹åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚</p>
<blockquote>
<p>enq(final Node node) æ–¹æ³•ä¸­ï¼ŒåŒæ­¥å™¨é€šè¿‡ â€œæ­»å¾ªç¯â€ æ¥ä¿è¯èŠ‚ç‚¹çš„æ­£ç¡®æ·»åŠ ï¼Œåœ¨ â€œæ­»å¾ªç¯â€ ä¸­åªæœ‰é€šè¿‡CASå°†èŠ‚ç‚¹è®¾ç½®æˆä¸ºå°¾èŠ‚ç‚¹ä¹‹åï¼Œå½“å‰çº¿ç¨‹æ‰èƒ½ä»è¯¥æ–¹æ³•è¿”å›ï¼Œå¦åˆ™ï¼Œå½“å‰çº¿ç¨‹ä¸æ–­åœ°å°è¯•è®¾ç½®ã€‚<br>å¯ä»¥çœ‹å‡ºï¼Œenq(final Node node) æ–¹æ³•å°†å¹¶å‘æ·»åŠ èŠ‚ç‚¹çš„è¯·æ±‚é€šè¿‡CASå˜å¾— â€œä¸²è¡ŒåŒ–â€ äº†ã€‚</p>
</blockquote>
<p>3ã€èŠ‚ç‚¹è¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¹‹åï¼Œå°±è¿›å…¥äº†ä¸€ä¸ªè‡ªæ—‹çš„è¿‡ç¨‹ï¼ˆacquireQueued(Node node,int arg) æ–¹æ³•ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹ï¼ˆæˆ–è€…è¯´æ¯ä¸ªçº¿ç¨‹ï¼‰éƒ½åœ¨è‡ªçœåœ°è§‚å¯Ÿï¼Œå½“æ¡ä»¶æ»¡è¶³ï¼Œè·å–åˆ°äº†åŒæ­¥çŠ¶æ€ï¼Œå°±å¯ä»¥ä»è¿™ä¸ªè‡ªæ—‹è¿‡ç¨‹ä¸­é€€å‡ºï¼Œä»£è¡¨è·å–äº†é”ï¼Œå¦åˆ™ä¾æ—§ç•™åœ¨è¿™ä¸ªè‡ªæ—‹è¿‡ç¨‹ä¸­ï¼ˆå¹¶ä¼šé˜»å¡èŠ‚ç‚¹çš„çº¿ç¨‹ï¼Œé˜»å¡çº¿ç¨‹ä¹Ÿå°±æ˜¯è¿›å…¥ç­‰å¾…ï¼Œè‡ªæ—‹ä¸åœï¼Ÿï¼‰</p>
<blockquote>
<p>è™½ç„¶åŒæ­¥é˜Ÿåˆ—ä¸­æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šè‡ªæ—‹ï¼Œä½†æ˜¯åªæœ‰å‰é©±èŠ‚ç‚¹æ˜¯å¤´èŠ‚ç‚¹æ‰èƒ½å¤Ÿå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼š<br>å¤´èŠ‚ç‚¹æ˜¯æˆåŠŸè·å–åˆ°åŒæ­¥çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œè€Œå¤´èŠ‚ç‚¹çš„çº¿ç¨‹é‡Šæ”¾äº†åŒæ­¥çŠ¶æ€ä¹‹åï¼Œå°†ä¼šå”¤é†’å…¶åç»§èŠ‚ç‚¹ï¼Œåç»§èŠ‚ç‚¹çš„çº¿ç¨‹è¢«å”¤é†’åéœ€è¦æ£€æŸ¥è‡ªå·±çš„å‰é©±èŠ‚ç‚¹æ˜¯å¦æ˜¯å¤´èŠ‚ç‚¹ã€‚<br>ç»´æŠ¤åŒæ­¥é˜Ÿåˆ—çš„FIFOåŸåˆ™ã€‚</p>
</blockquote>
<p>4ã€å¦‚æœè·å–ä¸åˆ°åˆ™é˜»å¡èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹ï¼Œè€Œ<strong>è¢«é˜»å¡çº¿ç¨‹çš„å”¤é†’ä¸»è¦ä¾é å‰é©±èŠ‚ç‚¹çš„å‡ºé˜Ÿæˆ–é˜»å¡çº¿ç¨‹è¢«ä¸­æ–­æ¥å®ç°</strong>ã€‚</p>
<blockquote>
<p>èŠ‚ç‚¹è‡ªæ—‹ï¼Œå‘ç°å‰é©±ä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œå°±è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œåªæœ‰çº¿ç¨‹è¢«ä¸­æ–­æˆ–å‰é©±èŠ‚ç‚¹è¢«é‡Šæ”¾æ‰ä¼šå†åˆ¤æ–­æ˜¯ä¸æ˜¯å‰é©±æ˜¯å¤´èŠ‚ç‚¹ã€‚å‰é©±æ˜¯å¤´èŠ‚ç‚¹åï¼Œè·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œåˆ™è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ï¼ˆå‡ ä¸ªç­‰å¾…çŠ¶æ€åº”è¯¥ä¸ä¸€æ ·ï¼Ÿï¼‰</p>
</blockquote>
<p>ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–æµç¨‹ï¼Œè§P128</p>
<p>5ã€çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¹¶æ‰§è¡Œäº†ç›¸åº”é€»è¾‘ä¹‹åï¼Œå°±éœ€è¦é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œä½¿å¾—åç»­èŠ‚ç‚¹èƒ½å¤Ÿç»§ç»­è·å–åŒæ­¥çŠ¶æ€ã€‚è°ƒç”¨åŒæ­¥å™¨çš„ release(int arg) æ¨¡ç‰ˆæ–¹æ³•ï¼ˆå†…éƒ¨ç”¨tryReleaseé‡å†™æ–¹æ³•ï¼‰å¯ä»¥é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œè¯¥æ–¹æ³•åœ¨é‡Šæ”¾äº†åŒæ­¥çŠ¶æ€ä¹‹åï¼Œä¼šå”¤é†’å…¶åç»§èŠ‚ç‚¹ï¼ˆè¿›è€Œä½¿åç»§èŠ‚ç‚¹é‡æ–°å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final boolean release(int arg) &#123;</span><br><span class="line">    // å°è¯•é‡Šæ”¾é”</span><br><span class="line">    if (tryRelease(arg)) &#123;</span><br><span class="line">        Node h = head;</span><br><span class="line">        //å¤´èŠ‚ç‚¹ä¸ä¸ºç©ºæˆ–è€…çŠ¶æ€ä¸æ˜¯0</span><br><span class="line">        if (h != null &amp;&amp; h.waitStatus != 0)</span><br><span class="line">            // å”¤é†’åç»§èŠ‚ç‚¹</span><br><span class="line">            unparkSuccessor(h);  //ç”¨æ¥å”¤é†’å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç‹¬å å¼åŒæ­¥çŠ¶æ€è·å–å’Œé‡Šæ”¾è¿‡ç¨‹æ€»ç»“ï¼š<br>1ã€åœ¨è·å–åŒæ­¥çŠ¶æ€æ—¶ï¼ŒåŒæ­¥å™¨ç»´æŠ¤ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œè·å–çŠ¶æ€å¤±è´¥çš„çº¿ç¨‹éƒ½ä¼šè¢«è‡ªæ—‹åœ°åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å¹¶åœ¨é˜Ÿåˆ—ä¸­è¿›è¡Œè‡ªæ—‹<br>2ã€ç§»å‡ºé˜Ÿåˆ—ï¼ˆæˆ–åœæ­¢è‡ªæ—‹ï¼‰çš„æ¡ä»¶æ˜¯å‰é©±èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹ä¸”æˆåŠŸè·å–äº†åŒæ­¥çŠ¶æ€ã€‚åœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€æ—¶ï¼ŒåŒæ­¥å™¨è°ƒç”¨tryRelease(int arg)æ–¹æ³•é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œç„¶åå”¤é†’å¤´èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚<br>3ã€å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­ï¼Œåªæ˜¯ä¼šå”¤é†’è¢«é˜»å¡çº¿ç¨‹ï¼Œæ˜¯ä¸ä¼šç«‹åˆ»è¢«ç§»å‡ºé˜Ÿåˆ—çš„ï¼Œè€Œæ˜¯FIFOåˆ°è¯¥èŠ‚ç‚¹æ‰ç§»å‡ºã€‚<br>4ã€ä¸ç®¡æ˜¯è·å–è¿˜æ˜¯é‡Šæ”¾ï¼Œéƒ½æ˜¯æ¨¡ç‰ˆæ–¹æ³•é‡Œè°ƒç”¨äº†é‡å†™çš„tryæ–¹æ³•ã€‚acquireæ˜¯é˜»å¡çš„ï¼ŒtryAcquireæ˜¯éé˜»å¡çš„ï¼Œè¯•ä¸€æ¬¡ï¼Œä¼šè¿”å›æ˜¯å¦æˆåŠŸã€‚</p>
<p>ç–‘é—®â“ï¼š<br>åŒæ­¥é˜Ÿåˆ—ä¸­èŠ‚ç‚¹çš„è‡ªæ—‹å’Œçº¿ç¨‹è¢«é˜»å¡çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿè‡ªæ—‹å‘ç°å‰é©±èŠ‚ç‚¹ä¸æ˜¯å¤´èŠ‚ç‚¹æˆ–è€…è·å–ä¸åˆ°åŒæ­¥çŠ¶æ€çš„è¯ï¼Œä¼šé˜»å¡çº¿ç¨‹ï¼Œé˜»å¡åæ˜¯ä¾é å‰é©±èŠ‚ç‚¹é‡Šæ”¾åŒæ­¥çŠ¶æ€åå”¤é†’æˆ–æ˜¯ä¸­æ–­å”¤é†’è¿˜æ˜¯ä¸€ç›´è‡ªæ—‹ï¼Ÿ</p>
<h5 id="ä¸‰ã€å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾"><a href="#ä¸‰ã€å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾" class="headerlink" title="ä¸‰ã€å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾"></a>ä¸‰ã€å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾</h5><p>å…±äº«å¼è·å–ä¸ç‹¬å å¼è·å–æœ€ä¸»è¦çš„åŒºåˆ«åœ¨äºåŒä¸€æ—¶åˆ»èƒ½å¦æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–åˆ°åŒæ­¥çŠ¶æ€ã€‚ä»¥æ–‡ä»¶çš„è¯»å†™ä¸ºä¾‹ï¼Œè¯»å¯ä»¥æ˜¯å…±äº«é”ï¼Œå¯ä»¥åŒæ—¶è¯»ï¼Œå†™æ˜¯ç‹¬å é”ï¼Œä¸€ä¸ªåœ¨å†™ï¼Œå…¶ä»–æ—¢ä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™ã€‚</p>
<p>åœ¨ acquireShared(int arg) æ–¹æ³•ä¸­ï¼ŒåŒæ­¥å™¨è°ƒç”¨ tryAcquireShared(int arg) æ–¹æ³•å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼ŒtryAcquireShared(int arg)æ–¹æ³•è¿”å›å€¼ä¸ºintç±»å‹ï¼Œå½“è¿”å›å€¼å¤§äºç­‰äº0æ—¶ï¼Œè¡¨ç¤ºèƒ½å¤Ÿè·å–åˆ°åŒæ­¥çŠ¶æ€ã€‚åœ¨doAcquireShared(int arg)æ–¹æ³•çš„è‡ªæ—‹è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹çš„å‰é©±ä¸ºå¤´èŠ‚ç‚¹æ—¶ï¼Œå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè¿”å›å€¼å¤§äºç­‰äº0ï¼Œè¡¨ç¤ºè¯¥æ¬¡è·å–åŒæ­¥çŠ¶æ€æˆåŠŸå¹¶ä»è‡ªæ—‹è¿‡ç¨‹ä¸­é€€å‡ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final void acquireShared(int arg) &#123;</span><br><span class="line">    // å°äºé›¶è·å–é”å¤±è´¥</span><br><span class="line">    if (tryAcquireShared(arg) &lt; 0)</span><br><span class="line">        doAcquireShared(arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void doAcquireShared(int arg) &#123;</span><br><span class="line">    // å…±äº«æ¨¡å¼åŠ å…¥åŒæ­¥é˜Ÿåˆ—</span><br><span class="line">    final Node node = addWaiter(Node.SHARED);</span><br><span class="line">    boolean failed = true;</span><br><span class="line">    try &#123;</span><br><span class="line">        boolean interrupted = false;</span><br><span class="line">        for (; ; ) &#123;</span><br><span class="line">            final Node p = node.predecessor();</span><br><span class="line">            // å¦‚æœå‰ä¸€ä¸ªçº¿ç¨‹ä¸ºå¤´ç»“ç‚¹</span><br><span class="line">            if (p == head) &#123;</span><br><span class="line">                // å°è¯•è·å–é”</span><br><span class="line">                int r = tryAcquireShared(arg);</span><br><span class="line">                // æˆåŠŸ</span><br><span class="line">                if (r &gt;= 0) &#123;</span><br><span class="line">                    // å°†è‡ªå·±è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹åŒæ—¶ï¼Œä¼ æ’­çŠ¶æ€ï¼Œrå°±æ˜¯ä¹‹å‰è¿”å›çš„å€¼</span><br><span class="line">                    setHeadAndPropagate(node, r);</span><br><span class="line">                    p.next = null;</span><br><span class="line">                    // å¦‚æœè¿‡è¢«å½“å‰çº¿ç¨‹çŠ¶æ€ä¸ºtrueï¼Œå°±è®¾ç½®å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€</span><br><span class="line">                    if (interrupted)</span><br><span class="line">                        selfInterrupt();</span><br><span class="line">                    failed = false;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            // é€»è¾‘åŒå‰</span><br><span class="line">            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                    parkAndCheckInterrupt())</span><br><span class="line">                interrupted = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        // é€»è¾‘åŒå‰</span><br><span class="line">        if (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨releaseShared(int arg)æ–¹æ³•å¯ä»¥é‡Šæ”¾åŒæ­¥çŠ¶æ€:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final boolean releaseShared(int arg) &#123;</span><br><span class="line">    // å°è¯•é‡Šæ”¾é”</span><br><span class="line">    if (tryReleaseShared(arg)) &#123;</span><br><span class="line">        // æˆåŠŸå°±ä¿®æ”¹è‡ªå·±èŠ‚ç‚¹çŠ¶æ€</span><br><span class="line">        doReleaseShared();</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•åœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€ä¹‹åï¼Œå°†ä¼šå”¤é†’åç»­å¤„äºç­‰å¾…çŠ¶æ€çš„èŠ‚ç‚¹ã€‚å› ä¸ºå¯èƒ½å¤šä¸ªçº¿ç¨‹è·å–é”ï¼Œæ‰€ä»¥ï¼Œå®ƒå’Œç‹¬å å¼ä¸»è¦åŒºåˆ«åœ¨äºtryReleaseShared(int arg)æ–¹æ³•å¿…é¡»ç¡®ä¿åŒæ­¥çŠ¶æ€ï¼ˆæˆ–è€…èµ„æºæ•°ï¼‰çº¿ç¨‹å®‰å…¨é‡Šæ”¾ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡å¾ªç¯å’ŒCASæ¥ä¿è¯çš„ï¼Œå› ä¸ºé‡Šæ”¾åŒæ­¥çŠ¶æ€çš„æ“ä½œä¼šåŒæ—¶æ¥è‡ªå¤šä¸ªçº¿ç¨‹ã€‚</p>
<h5 id="å››ã€ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€"><a href="#å››ã€ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€" class="headerlink" title="å››ã€ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€"></a>å››ã€ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€</h5><p>é€šè¿‡è°ƒç”¨åŒæ­¥å™¨çš„ doAcquireNanos(int arg,long nanosTimeout) ã€æ¨¡ç‰ˆæ–¹æ³•ã€‘æ–¹æ³•å¯ä»¥è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€ï¼Œå³åœ¨æŒ‡å®šçš„æ—¶é—´æ®µå†…è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åˆ°åŒæ­¥çŠ¶æ€åˆ™è¿”å›trueï¼Œå¦åˆ™ï¼Œè¿”å›falseã€‚è¯¥æ–¹æ³•æä¾›äº†ä¼ ç»ŸJavaåŒæ­¥æ“ä½œï¼ˆæ¯”å¦‚synchronizedå…³é”®å­—ï¼‰æ‰€ä¸å…·å¤‡çš„ç‰¹æ€§ã€‚</p>
<p>åœ¨Java 5ä¹‹å‰ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–ä¸åˆ°é”è€Œè¢«é˜»å¡åœ¨synchronizedä¹‹å¤–æ—¶ï¼Œå¯¹è¯¥çº¿ç¨‹è¿›è¡Œä¸­æ–­æ“ä½œï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ä¼šè¢«ä¿®æ”¹ï¼Œä½†çº¿ç¨‹ä¾æ—§ä¼šé˜»å¡åœ¨synchronizedä¸Šï¼Œç­‰å¾…ç€è·å–é”ã€‚</p>
<p>åœ¨Java 5ä¸­ï¼ŒåŒæ­¥å™¨æä¾›äº†acquireInterruptibly(int arg)æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ç­‰å¾…è·å–åŒæ­¥çŠ¶æ€æ—¶ï¼Œå¦‚æœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­ï¼Œä¼šç«‹åˆ»è¿”å›ï¼Œå¹¶æŠ›å‡ºInterruptedExceptionã€‚</p>
<p>è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€è¿‡ç¨‹å¯ä»¥è¢«è§†ä½œå“åº”ä¸­æ–­è·å–åŒæ­¥çŠ¶æ€è¿‡ç¨‹çš„â€œå¢å¼ºç‰ˆâ€ï¼ŒdoAcquireNanos(int arg,long nanosTimeout)æ–¹æ³•åœ¨æ”¯æŒå“åº”ä¸­æ–­çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†è¶…æ—¶è·å–çš„ç‰¹æ€§ã€‚</p>
<p>è¯¥æ–¹æ³•åœ¨è‡ªæ—‹è¿‡ç¨‹ä¸­ï¼Œå½“èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹æ—¶å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–æˆåŠŸåˆ™ä»è¯¥æ–¹æ³•è¿”å›ï¼Œè¿™ä¸ªè¿‡ç¨‹å’Œç‹¬å å¼åŒæ­¥è·å–çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨åŒæ­¥çŠ¶æ€è·å–å¤±è´¥çš„å¤„ç†ä¸Šæœ‰æ‰€ä¸åŒã€‚</p>
<p>å¦‚æœå½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼ˆnanosTimeoutå°äºç­‰äº0è¡¨ç¤ºå·²ç»è¶…æ—¶ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è¶…æ—¶ï¼Œé‡æ–°è®¡ç®—è¶…æ—¶é—´éš”nanosTimeoutï¼Œç„¶åä½¿å½“å‰çº¿ç¨‹ç­‰å¾… nanosTimeout çº³ç§’ï¼ˆå½“å·²åˆ°è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œè¯¥çº¿ç¨‹ä¼šä»LockSupport.parkNanos(Object<br>blocker,long nanos)æ–¹æ³•è¿”å›ï¼‰ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong><br>ç‹¬å å¼è¶…æ—¶è·å–åŒæ­¥çŠ¶æ€doAcquireNanos(int arg,long nanosTimeout)å’Œç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€acquire(int args)åœ¨æµç¨‹ä¸Šéå¸¸ç›¸ä¼¼ï¼Œå…¶ä¸»è¦åŒºåˆ«åœ¨äºæœªè·å–åˆ°åŒæ­¥çŠ¶æ€æ—¶çš„å¤„ç†é€»è¾‘ï¼š<br>1ã€acquire(int args)åœ¨æœªè·å–åˆ°åŒæ­¥çŠ¶æ€æ—¶ï¼Œå°†ä¼šä½¿å½“å‰çº¿ç¨‹ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€<br>2ã€doAcquireNanos(int arg,long nanosTimeout)ä¼šä½¿å½“å‰çº¿ç¨‹ç­‰å¾…nanosTimeoutçº³ç§’ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨nanosTimeoutçº³ç§’å†…æ²¡æœ‰è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œå°†ä¼šä»ç­‰å¾…é€»è¾‘ä¸­è‡ªåŠ¨è¿”å›ã€‚</p>
<h5 id="äº”ã€è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶â€”â€”TwinsLock"><a href="#äº”ã€è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶â€”â€”TwinsLock" class="headerlink" title="äº”ã€è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶â€”â€”TwinsLock"></a>äº”ã€è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶â€”â€”TwinsLock</h5><p>è®¾è®¡ä¸€ä¸ªåŒæ­¥å·¥å…·ï¼šè¯¥å·¥å…·åœ¨åŒä¸€æ—¶åˆ»ï¼Œåªå…è®¸è‡³å¤šä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œè¶…è¿‡ä¸¤ä¸ªçº¿ç¨‹çš„è®¿é—®å°†è¢«é˜»å¡ã€‚</p>
<p>TwinsLockåœ¨åŒä¸€æ—¶åˆ»å…è®¸è‡³å¤šä¸¤ä¸ªçº¿ç¨‹çš„åŒæ—¶è®¿é—®ï¼Œè¡¨æ˜åŒæ­¥èµ„æºæ•°ä¸º2ï¼Œè¿™æ ·å¯ä»¥è®¾ç½®åˆå§‹çŠ¶æ€statusä¸º2ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè·å–ï¼Œstatuså‡1ï¼Œè¯¥çº¿ç¨‹é‡Šæ”¾ï¼Œåˆ™statusåŠ 1ï¼ŒçŠ¶æ€çš„åˆæ³•èŒƒå›´ä¸º0ã€1å’Œ2ï¼Œå…¶ä¸­0è¡¨ç¤ºå½“å‰å·²ç»æœ‰ä¸¤ä¸ªçº¿ç¨‹è·å–äº†åŒæ­¥èµ„æºï¼Œæ­¤æ—¶å†æœ‰å…¶ä»–çº¿ç¨‹å¯¹åŒæ­¥çŠ¶æ€è¿›è¡Œè·å–ï¼Œè¯¥çº¿ç¨‹åªèƒ½è¢«é˜»å¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class TwinsLock implements Lock &#123;</span><br><span class="line">    private final Sync sync = new Sync(2);</span><br><span class="line"></span><br><span class="line">    private static final class Sync extends AbstractQueuedSynchronizer &#123;</span><br><span class="line">        Sync(int count) &#123;</span><br><span class="line">            if (count &lt;= 0) &#123;</span><br><span class="line">                throw new IllegalArgumentException(&quot;count must large than zero.&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            // åœ¨æœ¬æ–¹æ³•ä¸­ï¼Œç”¨çŠ¶æ€å»ä»£æŒ‡èµ„æºæ•°ç›®</span><br><span class="line">            setState(count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int tryAcquireShared(int reduceCount) &#123;</span><br><span class="line">            for (; ; ) &#123;</span><br><span class="line">                int current = getState();</span><br><span class="line">                int newCount = current - reduceCount;</span><br><span class="line">                if (newCount &lt; 0 || compareAndSetState(current,newCount)) &#123;</span><br><span class="line">                	// è¿”å›å½“å‰å‰©ä½™èµ„æº</span><br><span class="line">                    return newCount;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean tryReleaseShared(int returnCount) &#123;</span><br><span class="line">            for (; ; ) &#123;</span><br><span class="line">                int current = getState();</span><br><span class="line">                // å½“å‰æ•°ç›® + é‡Šæ”¾æ•°ç›®</span><br><span class="line">                int newCount = current + returnCount;</span><br><span class="line">                if (compareAndSetState(current, newCount)) &#123;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void lock() &#123;</span><br><span class="line">    	// è·å–å…±äº«é”ï¼Œstate + 1</span><br><span class="line">    	// ä½¿ç”¨çš„æ˜¯nodeèŠ‚ç‚¹çš„æ–¹æ³•</span><br><span class="line">        sync.acquireShared(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	// é‡Šæ”¾å…±äº«é” -1</span><br><span class="line">    public void unlock() &#123;</span><br><span class="line">        sync.releaseShared(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // å…¶ä»–æ¥å£æ–¹æ³•ç•¥</span><br><span class="line">    @Override</span><br><span class="line">    public void lockInterruptibly() throws InterruptedException &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean tryLock() &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean tryLock(long time, @NotNull TimeUnit unit) throws InterruptedException &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    @NotNull</span><br><span class="line">    @Override</span><br><span class="line">    public Condition newCondition() &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¥éª¤ï¼š<br>1ã€TwinsLockå®ç°Lockæ¥å£ï¼Œæä¾›é¢å‘ä½¿ç”¨è€…çš„æ¥å£ï¼Œä½¿ç”¨è€…è°ƒç”¨lock()<br>æ–¹æ³•è·å–é”ï¼Œéšåè°ƒç”¨unlock()æ–¹æ³•é‡Šæ”¾é”ï¼Œè€ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è·å–åˆ°é”ã€‚<br>2ã€è‡ªå®šä¹‰åŒæ­¥å™¨Syncä½œä¸ºé™æ€å†…éƒ¨ç±»ï¼Œè¯¥åŒæ­¥å™¨é¢å‘çº¿ç¨‹è®¿é—®å’ŒåŒæ­¥çŠ¶æ€æ§åˆ¶ã€‚å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ã€‚<br>3ã€é‡å†™tryAcquireShared(int reduceCount)ç­‰æ–¹æ³•ï¼Œå†…éƒ¨ç”¨è¿‡CASç¡®ä¿çŠ¶æ€çš„æ­£ç¡®è®¾ç½®ã€‚acquireSharedæ–¹æ³•é‡Œæ˜¯åˆ¤æ–­tryAcquireSharedæ–¹æ³•è¿”å›å€¼å¤§äºç­‰äº0æ—¶ï¼Œå½“å‰çº¿ç¨‹æ‰è·å–åŒæ­¥çŠ¶æ€ã€‚</p>
<p>æ€»ç»“ï¼š<br>1ã€acquireSharedæ–¹æ³•é‡Œè¾“å…¥çš„intï¼Œéƒ½æ˜¯1å‘¢ã€‚å•¥æ„æ€ï¼Ÿ<br>2ã€åŒæ­¥å™¨ä½œä¸ºä¸€ä¸ªæ¡¥æ¢ï¼Œè¿æ¥çº¿ç¨‹è®¿é—®ä»¥åŠåŒæ­¥çŠ¶æ€æ§åˆ¶ç­‰åº•å±‚æŠ€æœ¯ä¸ä¸åŒå¹¶å‘ç»„ä»¶ï¼ˆæ¯”å¦‚Lockã€CountDownLatchç­‰ï¼‰çš„æ¥å£è¯­ä¹‰ã€‚</p>
<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.test;</span><br><span class="line"></span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import java.util.concurrent.locks.Lock;</span><br><span class="line"></span><br><span class="line">public class TwinsLockTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void test() throws InterruptedException &#123;</span><br><span class="line">        final Lock lock = new TwinsLock();</span><br><span class="line">        class Worker extends Thread &#123;</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                while (true) &#123;</span><br><span class="line">                    lock.lock();</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Thread.sleep(1000);</span><br><span class="line">                        System.out.println(Thread.currentThread().getName());</span><br><span class="line">                        Thread.sleep(1000);</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        throw new RuntimeException(e);</span><br><span class="line">                    &#125; finally &#123;</span><br><span class="line">                        lock.unlock();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // å¯åŠ¨10ä¸ªçº¿ç¨‹</span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            Worker w = new Worker();</span><br><span class="line">            w.setDaemon(true);</span><br><span class="line">            w.start();</span><br><span class="line">        &#125;</span><br><span class="line">        // æ¯éš”1ç§’æ¢è¡Œ</span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            Thread.sleep(1000);</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çº¿ç¨‹åç§°æˆå¯¹è¾“å‡ºï¼Œåœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸¤ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°é”ã€‚</p>
<p>åŸä¹¦ç¬”è®°ï¼š<a href="https://blog.csdn.net/weixin_46949627/article/details/127078972">https://blog.csdn.net/weixin_46949627/article/details/127078972</a><br><a href="http://t.zoukankan.com/liukaifeng-p-10052596.html">http://t.zoukankan.com/liukaifeng-p-10052596.html</a><br>Lockå’ŒsychronizedåŒºåˆ«ï¼š<a href="https://blog.csdn.net/weixin_41010294/article/details/123528508">https://blog.csdn.net/weixin_41010294/article/details/123528508</a></p>
<h3 id="3-é‡å…¥é”"><a href="#3-é‡å…¥é”" class="headerlink" title="3.é‡å…¥é”"></a>3.é‡å…¥é”</h3><p>é‡å…¥é”ReentrantLockï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ”¯æŒé‡è¿›å…¥çš„é”ï¼Œå®ƒè¡¨ç¤ºè¯¥é”èƒ½å¤Ÿæ”¯æŒä¸€ä¸ªçº¿ç¨‹å¯¹èµ„æºçš„é‡å¤åŠ é”ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥é”çš„è¿˜æ”¯æŒè·å–é”æ—¶çš„å…¬å¹³å’Œéå…¬å¹³æ€§é€‰æ‹©ã€‚</p>
<p>ä¸Šä¸€èŠ‚çš„ç‹¬å é”ç¤ºä¾‹ä¸­ï¼Œè°ƒç”¨Mutexçš„lock()æ–¹æ³•è·å–é”ä¹‹åï¼Œå¦‚æœå†æ¬¡è°ƒç”¨lock()æ–¹æ³•ï¼Œåˆ™è¯¥çº¿ç¨‹å°†ä¼šè¢«è‡ªå·±æ‰€é˜»å¡ï¼ŒåŸå› æ˜¯Mutexåœ¨å®ç°tryAcquire(int acquires)æ–¹æ³•æ—¶æ²¡æœ‰è€ƒè™‘å æœ‰é”çš„çº¿ç¨‹å†æ¬¡è·å–é”çš„åœºæ™¯ï¼Œè€Œåœ¨è°ƒç”¨tryAcquire(int acquires)æ–¹æ³•æ—¶è¿”å›äº†falseï¼Œå¯¼è‡´è¯¥çº¿ç¨‹è¢«é˜»å¡ã€‚</p>
<p>æ‰€ä»¥è¯´ï¼ŒMutexæ˜¯ä¸€ä¸ªä¸æ”¯æŒé‡è¿›å…¥çš„é”ã€‚è€Œsynchronizedå…³é”®å­—éšå¼çš„æ”¯æŒé‡è¿›å…¥ï¼Œæ¯”å¦‚ä¸€ä¸ªsynchronizedä¿®é¥°çš„é€’å½’æ–¹æ³•ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œæ‰§è¡Œçº¿ç¨‹åœ¨è·å–äº†é”ä¹‹åä»èƒ½è¿ç»­å¤šæ¬¡åœ°è·å¾—è¯¥é”ï¼Œè€Œä¸åƒMutexç”±äºè·å–äº†é”ï¼Œè€Œåœ¨ä¸‹ä¸€æ¬¡è·å–é”æ—¶å‡ºç°é˜»å¡è‡ªå·±çš„æƒ…å†µã€‚</p>
<p>é‡å…¥é”ï¼šåœ¨è°ƒç”¨lock()æ–¹æ³•æ—¶ï¼Œå·²ç»è·å–åˆ°é”çš„çº¿ç¨‹ï¼Œèƒ½å¤Ÿå†æ¬¡è°ƒç”¨lock()æ–¹æ³•è·å–é”è€Œä¸è¢«é˜»å¡ã€‚</p>
<p>å…¬å¹³çš„è·å–é”ï¼Œä¹Ÿå°±æ˜¯ç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹æœ€ä¼˜å…ˆè·å–é”ï¼Œä¹Ÿå¯ä»¥è¯´é”è·å–æ˜¯é¡ºåºçš„ã€‚ReentrantLockæä¾›äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œèƒ½å¤Ÿæ§åˆ¶é”æ˜¯å¦æ˜¯å…¬å¹³çš„ã€‚</p>
<h4 id="âœ…å®ç°é‡è¿›å…¥"><a href="#âœ…å®ç°é‡è¿›å…¥" class="headerlink" title="âœ…å®ç°é‡è¿›å…¥"></a>âœ…å®ç°é‡è¿›å…¥</h4><p>é‡è¿›å…¥æ˜¯æŒ‡ä»»æ„çº¿ç¨‹åœ¨è·å–åˆ°é”ä¹‹åèƒ½å¤Ÿå†æ¬¡è·å–è¯¥é”è€Œä¸ä¼šè¢«é”æ‰€é˜»å¡ï¼Œè¯¥ç‰¹æ€§çš„å®ç°éœ€è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ã€‚</p>
<p>1ã€çº¿ç¨‹å†æ¬¡è·å–é”ã€‚é”éœ€è¦å»è¯†åˆ«è·å–é”çš„çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰å æ®é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å†æ¬¡æˆåŠŸè·å–ã€‚</p>
<p>2ã€é”çš„æœ€ç»ˆé‡Šæ”¾ã€‚çº¿ç¨‹é‡å¤næ¬¡è·å–äº†é”ï¼Œéšååœ¨ç¬¬næ¬¡é‡Šæ”¾è¯¥é”åï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°è¯¥é”ã€‚é”çš„æœ€ç»ˆé‡Šæ”¾è¦æ±‚é”å¯¹äºè·å–è¿›è¡Œè®¡æ•°è‡ªå¢ï¼Œè®¡æ•°è¡¨ç¤ºå½“å‰é”è¢«é‡å¤è·å–çš„æ¬¡æ•°ï¼Œè€Œé”è¢«é‡Šæ”¾æ—¶ï¼Œè®¡æ•°è‡ªå‡ï¼Œå½“è®¡æ•°ç­‰äº0æ—¶è¡¨ç¤ºé”å·²ç»æˆåŠŸé‡Šæ”¾ã€‚</p>
<p>éå…¬å¹³é”è·å–çš„å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// éå…¬å¹³é”è·å–</span><br><span class="line">final boolean nonfairTryAcquire(int acquires) &#123;</span><br><span class="line">    // å½“å‰çº¿ç¨‹</span><br><span class="line">    final Thread current = Thread.currentThread();</span><br><span class="line">    // è·å–é”çŠ¶æ€</span><br><span class="line">    int c = getState();</span><br><span class="line">    // 0 ä»£è¡¨æ— é”</span><br><span class="line">    if (c == 0) &#123;</span><br><span class="line">        // è®¾ç½®çŠ¶æ€</span><br><span class="line">        if (compareAndSetState(0, acquires)) &#123;</span><br><span class="line">            // è®¾ç½®ç‹¬äº«é”çš„æ‹¥æœ‰è€…</span><br><span class="line">            setExclusiveOwnerThread(current);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">    // å¦‚æœå½“å‰çº¿ç¨‹æ˜¯ç‹¬æœ‰çº¿ç¨‹çš„çº¿ç¨‹ID</span><br><span class="line">    &#125; else if (current == getExclusiveOwnerThread()) &#123;</span><br><span class="line">        // æ˜¯åˆ™å¢åŠ æ¬¡æ•°</span><br><span class="line">        int nextc = c + acquires;</span><br><span class="line">        if (nextc &lt; 0)</span><br><span class="line">            throw new Error(&quot;Maximum lock count exceeded&quot;);</span><br><span class="line">        //è®¾ç½®</span><br><span class="line">        setState(nextc);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºè·å–é”çš„çº¿ç¨‹æ¥å†³å®šè·å–æ“ä½œæ˜¯å¦æˆåŠŸï¼Œå¦‚æœæ˜¯è·å–é”çš„çº¿ç¨‹å†æ¬¡è¯·æ±‚ï¼Œåˆ™å°†åŒæ­¥çŠ¶æ€å€¼è¿›è¡Œå¢åŠ å¹¶è¿”å›trueï¼Œè¡¨ç¤ºè·å–åŒæ­¥çŠ¶æ€æˆåŠŸã€‚æˆåŠŸè·å–é”çš„çº¿ç¨‹å†æ¬¡è·å–é”ï¼Œåªæ˜¯å¢åŠ äº†åŒæ­¥çŠ¶æ€å€¼.</p>
<p>éå…¬å¹³é”é‡Šæ”¾çš„å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">protected final boolean tryRelease(int releases) &#123;</span><br><span class="line">    // å‡å»é‡Šæ”¾çš„å€¼</span><br><span class="line">    int c = getState() - releases;</span><br><span class="line">    // å¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯æ‹¥æœ‰è€…</span><br><span class="line">    if (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">        throw new IllegalMonitorStateException();</span><br><span class="line">    // æ˜¯å¦å®Œå…¨é‡Šæ”¾</span><br><span class="line">    boolean free = false;</span><br><span class="line">    // å¦‚æœæ˜¯ 0 åˆ™å®Œå…¨é‡Šæ”¾</span><br><span class="line">    if (c == 0) &#123;</span><br><span class="line">        free = true;</span><br><span class="line">        // æŠ¹å»æ‹¥æœ‰è€…</span><br><span class="line">        setExclusiveOwnerThread(null);</span><br><span class="line">    &#125;</span><br><span class="line">    setState(c);</span><br><span class="line">    return free;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¯¥é”è¢«è·å–äº†næ¬¡ï¼Œé‚£ä¹ˆå‰(n-1)æ¬¡tryRelease(int releases)æ–¹æ³•å¿…é¡»è¿”å›falseï¼Œè€Œåªæœ‰åŒæ­¥çŠ¶æ€å®Œå…¨é‡Šæ”¾äº†ï¼Œæ‰èƒ½è¿”å›trueã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ–¹æ³•å°†åŒæ­¥çŠ¶æ€æ˜¯å¦ä¸º0ä½œä¸ºæœ€ç»ˆé‡Šæ”¾çš„æ¡ä»¶ï¼Œå½“åŒæ­¥çŠ¶æ€ä¸º0æ—¶ï¼Œå°†å æœ‰çº¿ç¨‹è®¾ç½®ä¸ºnullï¼Œå¹¶è¿”å›trueï¼Œè¡¨ç¤ºé‡Šæ”¾æˆåŠŸã€‚</p>
<h4 id="âœ…å…¬å¹³ä¸éå…¬å¹³è·å–é”çš„åŒºåˆ«"><a href="#âœ…å…¬å¹³ä¸éå…¬å¹³è·å–é”çš„åŒºåˆ«" class="headerlink" title="âœ…å…¬å¹³ä¸éå…¬å¹³è·å–é”çš„åŒºåˆ«"></a>âœ…å…¬å¹³ä¸éå…¬å¹³è·å–é”çš„åŒºåˆ«</h4><p>å…¬å¹³æ€§ä¸å¦æ˜¯é’ˆå¯¹è·å–é”è€Œè¨€çš„ï¼Œå¦‚æœä¸€ä¸ªé”æ˜¯å…¬å¹³çš„ï¼Œé‚£ä¹ˆé”çš„è·å–é¡ºåºå°±åº”è¯¥ç¬¦åˆè¯·æ±‚çš„ç»å¯¹æ—¶é—´é¡ºåºï¼Œä¹Ÿå°±æ˜¯FIFOã€‚</p>
<p>å¯¹äºéå…¬å¹³é”ï¼Œåªè¦CASè®¾ç½®åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œåˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–äº†é”ï¼Œè€Œå…¬å¹³é”åˆ™ä¸åŒã€‚åˆ¤æ–­æ¡ä»¶å¤šäº†hasQueuedPredecessors()æ–¹æ³•ï¼Œå³åŠ å…¥äº†åŒæ­¥é˜Ÿåˆ—ä¸­å½“å‰èŠ‚ç‚¹æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›trueï¼Œåˆ™è¡¨ç¤ºæœ‰çº¿ç¨‹æ¯”å½“å‰çº¿ç¨‹æ›´æ—©åœ°è¯·æ±‚è·å–é”ï¼Œå› æ­¤éœ€è¦ç­‰å¾…å‰é©±çº¿ç¨‹è·å–å¹¶é‡Šæ”¾é”ä¹‹åæ‰èƒ½ç»§ç»­è·å–é”ã€‚<br>ã€å› æ­¤ï¼Œä¸Šé¢çš„ç‹¬å é”å’Œå…±äº«é”ä¹Ÿéƒ½æ˜¯å…¬å¹³çš„ã€‘</p>
<p>æµ‹è¯•å…¬å¹³å’Œéå…¬å¹³é”åœ¨è·å–é”æ—¶çš„åŒºåˆ«ï¼Œäº”ä¸ªçº¿ç¨‹å¾ªç¯è·å–é”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Collection;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.concurrent.locks.Lock;</span><br><span class="line">import java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line">public class FairAndUnfairTest &#123;</span><br><span class="line">    private static Lock fairLock = new ReentrantLock2(true);</span><br><span class="line">    private static Lock unfairLock = new ReentrantLock2(false);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void fair() &#123;</span><br><span class="line">        testLock(fairLock);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void unfair() &#123;</span><br><span class="line">        testLock(unfairLock);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void testLock(Lock lock)&#123;</span><br><span class="line">        // å¯åŠ¨5ä¸ªJob</span><br><span class="line">        for(int i = 0; i &lt; 5;i++)&#123;</span><br><span class="line">            new Job(lock).start();</span><br><span class="line">        &#125;</span><br><span class="line">        while (true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static class Job extends Thread &#123;</span><br><span class="line">        private Lock lock;</span><br><span class="line"></span><br><span class="line">        public Job(Lock lock) &#123;</span><br><span class="line">            this.lock = lock;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                // è¿ç»­2æ¬¡æ‰“å°å½“å‰çš„Threadå’Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„Thread</span><br><span class="line">                lock.lock();</span><br><span class="line">                ReentrantLock2 reentrantLock2 = (ReentrantLock2) lock;</span><br><span class="line">                System.out.println(&quot;Fair:&quot; + reentrantLock2.isFair() + &quot;,Lock By ã€&quot; + Thread.currentThread().getName() + &quot;ã€‘ï¼Œwaitting by  &quot; + reentrantLock2.getQueuedThreads().toString());</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    throw new RuntimeException(e);</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    lock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static class ReentrantLock2 extends ReentrantLock &#123;</span><br><span class="line">        public ReentrantLock2(boolean fair) &#123;</span><br><span class="line">            super(fair);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Collection&lt;Thread&gt; getQueuedThreads() &#123;</span><br><span class="line">            List&lt;Thread&gt; arrayList = new ArrayList&lt;Thread&gt;(super.getQueuedThreads());</span><br><span class="line">            Collections.reverse(arrayList);</span><br><span class="line">            return arrayList;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1ã€å…¬å¹³æ€§é”æ¯æ¬¡éƒ½æ˜¯ä»åŒæ­¥é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è·å–åˆ°é”ï¼Œè€Œéå…¬å¹³æ€§é”å‡ºç°äº†ä¸€ä¸ªçº¿ç¨‹è¿ç»­è·å–é”çš„æƒ…å†µã€‚ï¼ˆåˆšé‡Šæ”¾é”çš„çº¿ç¨‹å†æ¬¡è·å–åŒæ­¥çŠ¶æ€çš„å‡ ç‡ä¼šéå¸¸å¤§ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹åªèƒ½åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚ï¼‰</p>
<p>2ã€å…¬å¹³æ€§é”ä¿è¯äº†é”çš„è·å–æŒ‰ç…§FIFOåŸåˆ™ï¼Œè€Œä»£ä»·æ˜¯è¿›è¡Œå¤§é‡çš„çº¿ç¨‹åˆ‡æ¢ã€‚éå…¬å¹³é”è™½ç„¶å¯èƒ½é€ æˆçº¿ç¨‹é¥¥é¥¿ï¼Œä½†æ˜¯æå°‘çš„çº¿ç¨‹åˆ‡æ¢ï¼Œä¿è¯äº†å…¶æ›´å¤§çš„ååé‡ã€‚</p>
<h3 id="4-è¯»å†™é”"><a href="#4-è¯»å†™é”" class="headerlink" title="4.è¯»å†™é”"></a>4.è¯»å†™é”</h3><p>ä¹‹å‰æåˆ°é”ï¼ˆå¦‚Mutexå’ŒReentrantLockï¼‰åŸºæœ¬éƒ½æ˜¯æ’ä»–é”ï¼Œè¿™äº›é”åœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè®¿é—®ï¼Œè€Œè¯»å†™é”åœ¨åŒä¸€æ—¶åˆ»å¯ä»¥å…è®¸å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯åœ¨å†™çº¿ç¨‹è®¿é—®æ—¶ï¼Œæ‰€æœ‰çš„è¯»çº¿ç¨‹å’Œå…¶ä»–å†™çº¿ç¨‹å‡è¢«é˜»å¡ã€‚è¯»å†™é”ç»´æŠ¤äº†ä¸€å¯¹é”ï¼Œä¸€ä¸ªè¯»é”å’Œä¸€ä¸ªå†™é”ï¼Œé€šè¿‡åˆ†ç¦»è¯»é”å’Œå†™é”ï¼Œä½¿å¾—å¹¶å‘æ€§ç›¸æ¯”ä¸€èˆ¬çš„æ’ä»–é”æœ‰äº†å¾ˆå¤§æå‡ï¼Œæä¾›å†™æ“ä½œå¯¹è¯»æ“ä½œçš„å¯è§æ€§ä»¥åŠå¹¶å‘æ€§çš„æå‡ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šåœ¨ç¨‹åºä¸­å®šä¹‰ä¸€ä¸ªå…±äº«çš„ç”¨ä½œç¼“å­˜æ•°æ®ç»“æ„ï¼Œå®ƒå¤§éƒ¨åˆ†æ—¶é—´æä¾›è¯»æœåŠ¡ï¼ˆä¾‹å¦‚æŸ¥è¯¢å’Œæœç´¢ï¼‰ï¼Œè€Œå†™æ“ä½œå æœ‰çš„æ—¶é—´å¾ˆå°‘ï¼Œä½†æ˜¯å†™æ“ä½œå®Œæˆä¹‹åçš„æ›´æ–°éœ€è¦å¯¹åç»­çš„è¯»æœåŠ¡å¯è§ã€‚</p>
<p>åœ¨æ²¡æœ‰è¯»å†™é”æ”¯æŒçš„ï¼ˆJava 5ä¹‹å‰ï¼‰æ—¶å€™ï¼Œå¦‚æœéœ€è¦å®Œæˆä¸Šè¿°å·¥ä½œå°±è¦ä½¿ç”¨Javaçš„ç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼Œå°±æ˜¯å½“å†™æ“ä½œå¼€å§‹æ—¶ï¼Œæ‰€æœ‰æ™šäºå†™æ“ä½œçš„è¯»æ“ä½œå‡ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œåªæœ‰å†™æ“ä½œå®Œæˆå¹¶è¿›è¡Œé€šçŸ¥ä¹‹åï¼Œæ‰€æœ‰ç­‰å¾…çš„è¯»æ“ä½œæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼ˆå†™æ“ä½œä¹‹é—´ä¾é synchronizedå…³é”®è¿›è¡ŒåŒæ­¥ï¼‰ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä½¿è¯»æ“ä½œèƒ½è¯»å–åˆ°æ­£ç¡®çš„æ•°æ®ï¼Œä¸ä¼šå‡ºç°è„è¯»ã€‚</p>
<h4 id="âœ…è¯»å†™é”çš„æ¥å£å’Œç¤ºä¾‹"><a href="#âœ…è¯»å†™é”çš„æ¥å£å’Œç¤ºä¾‹" class="headerlink" title="âœ…è¯»å†™é”çš„æ¥å£å’Œç¤ºä¾‹"></a>âœ…è¯»å†™é”çš„æ¥å£å’Œç¤ºä¾‹</h4><p>ReadWriteLockä»…å®šä¹‰äº†è·å–è¯»é”å’Œå†™é”çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå³readLock()æ–¹æ³•å’ŒwriteLock()æ–¹æ³•ï¼Œè€Œå…¶å®ç°â€”â€”ReentrantReadWriteLockï¼Œé™¤äº†æ¥å£æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æä¾›äº†ä¸€äº›ä¾¿äºå¤–ç•Œç›‘æ§å…¶å†…éƒ¨å·¥ä½œçŠ¶æ€çš„æ–¹æ³•ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Cache &#123;</span><br><span class="line">    static Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">    static ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();</span><br><span class="line">    static Lock r = rwl.readLock();</span><br><span class="line">    static Lock w = rwl.writeLock();</span><br><span class="line"></span><br><span class="line">    // è·å–ä¸€ä¸ªkeyå¯¹åº”çš„value</span><br><span class="line">    public static final Object get(String key) &#123;</span><br><span class="line">        r.lock();</span><br><span class="line">        try &#123;</span><br><span class="line">            return map.get(key);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            r.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è®¾ç½®keyå¯¹åº”çš„valueï¼Œå¹¶è¿”å›æ—§çš„value</span><br><span class="line">    public static final Object put(String key, Object value) &#123;</span><br><span class="line">        w.lock();</span><br><span class="line">        try &#123;</span><br><span class="line">            return map.put(key, value);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            w.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ¸…ç©ºæ‰€æœ‰çš„å†…å®¹</span><br><span class="line">    public static final void clear() &#123;</span><br><span class="line">        w.lock();</span><br><span class="line">        try &#123;</span><br><span class="line">            map.clear();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            w.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªéçº¿ç¨‹å®‰å…¨çš„HashMapä½œä¸ºç¼“å­˜,ä½¿ç”¨è¯»å†™é”çš„è¯»é”å’Œå†™é”æ¥ä¿è¯Cacheæ˜¯çº¿ç¨‹å®‰å…¨çš„.Cacheä½¿ç”¨è¯»å†™é”æå‡è¯»æ“ä½œçš„å¹¶å‘æ€§ï¼Œä¹Ÿä¿è¯æ¯æ¬¡å†™æ“ä½œå¯¹æ‰€æœ‰çš„è¯»å†™æ“ä½œçš„å¯è§æ€§ï¼ŒåŒæ—¶ç®€åŒ–äº†ç¼–ç¨‹æ–¹å¼ã€‚</p>
<h4 id="âœ…è¯»å†™é”çš„å®ç°åˆ†æ"><a href="#âœ…è¯»å†™é”çš„å®ç°åˆ†æ" class="headerlink" title="âœ…è¯»å†™é”çš„å®ç°åˆ†æ"></a>âœ…è¯»å†™é”çš„å®ç°åˆ†æ</h4><h5 id="ä¸€ã€è¯»å†™çŠ¶æ€çš„è®¾è®¡"><a href="#ä¸€ã€è¯»å†™çŠ¶æ€çš„è®¾è®¡" class="headerlink" title="ä¸€ã€è¯»å†™çŠ¶æ€çš„è®¾è®¡"></a>ä¸€ã€è¯»å†™çŠ¶æ€çš„è®¾è®¡</h5><p>è¯»å†™é”åŒæ ·ä¾èµ–è‡ªå®šä¹‰åŒæ­¥å™¨æ¥å®ç°åŒæ­¥åŠŸèƒ½ï¼Œè€Œè¯»å†™çŠ¶æ€å°±æ˜¯å…¶åŒæ­¥å™¨çš„åŒæ­¥çŠ¶æ€ã€‚</p>
<p>å›æƒ³ReentrantLockä¸­è‡ªå®šä¹‰åŒæ­¥å™¨çš„å®ç°ï¼ŒåŒæ­¥çŠ¶æ€è¡¨ç¤ºé”è¢«ä¸€ä¸ªçº¿ç¨‹é‡å¤è·å–çš„æ¬¡æ•°ï¼Œè€Œè¯»å†™é”çš„è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦åœ¨åŒæ­¥çŠ¶æ€ï¼ˆä¸€ä¸ªæ•´å‹å˜é‡ï¼‰ä¸Šç»´æŠ¤å¤šä¸ªè¯»çº¿ç¨‹å’Œä¸€ä¸ªå†™çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¦‚æœåœ¨ä¸€ä¸ªæ•´å‹å˜é‡ä¸Šç»´æŠ¤å¤šç§çŠ¶æ€ï¼Œå°±ä¸€å®šéœ€è¦ â€œæŒ‰ä½åˆ‡å‰²ä½¿ç”¨â€ è¿™ä¸ªå˜é‡ï¼Œè¯»å†™é”å°†å˜é‡åˆ‡åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œé«˜16ä½è¡¨ç¤ºè¯»ï¼Œä½16ä½è¡¨ç¤ºå†™ã€‚</p>
<p>é€šè¿‡ä½è¿ç®—å¯ä»¥è¿…é€Ÿç¡®å®šè¯»å’Œå†™å„è‡ªçš„çŠ¶æ€ï¼Œå‡è®¾å½“å‰åŒæ­¥çŠ¶æ€å€¼ä¸º S ï¼Œå†™çŠ¶æ€ç­‰äº S&amp;0x0000FFFF ï¼ˆå°†é«˜16ä½å…¨éƒ¨æŠ¹å»ï¼‰ï¼Œè¯»çŠ¶æ€ç­‰äºS&gt;&gt;&gt;16ï¼ˆæ— ç¬¦å·è¡¥0å³ç§»16ä½ï¼‰ã€‚å½“å†™çŠ¶æ€å¢åŠ 1æ—¶ï¼Œç­‰äºS+1ï¼Œå½“è¯»çŠ¶æ€å¢åŠ 1æ—¶ï¼Œç­‰äºS+(1&lt;&lt;16)ï¼Œä¹Ÿå°±æ˜¯S+0x00010000ã€‚</p>
<h5 id="äºŒã€å†™é”çš„è·å–ä¸é‡Šæ”¾"><a href="#äºŒã€å†™é”çš„è·å–ä¸é‡Šæ”¾" class="headerlink" title="äºŒã€å†™é”çš„è·å–ä¸é‡Šæ”¾"></a>äºŒã€å†™é”çš„è·å–ä¸é‡Šæ”¾</h5><p>å†™é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡è¿›å…¥çš„æ’å®ƒé”ã€‚å¦‚æœå½“å‰çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å¢åŠ å†™çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹åœ¨è·å–å†™é”æ—¶ï¼Œè¯»é”å·²ç»è¢«è·å–ï¼ˆè¯»çŠ¶æ€ä¸ä¸º0ï¼‰æˆ–è€…è¯¥çº¿ç¨‹ä¸æ˜¯å·²ç»è·å–å†™é”çš„çº¿ç¨‹ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">protected final boolean tryAcquire(int acquires) &#123;</span><br><span class="line">    Thread current = Thread.currentThread();</span><br><span class="line">    // é”çŠ¶æ€</span><br><span class="line">    int c = getState();</span><br><span class="line">    // é€šè¿‡çŠ¶æ€è®¡ç®—å†™é”æ•°é‡</span><br><span class="line">    int w = exclusiveCount(c);</span><br><span class="line">    // é”ä¸ä¸º0ï¼Œè¯´æ˜æœ‰è¯»æˆ–è€…å†™</span><br><span class="line">    if (c != 0) &#123;</span><br><span class="line">        // å†™é”ä¸å­˜åœ¨ï¼ˆè¯´æ˜ç°åœ¨æ˜¯è¯»é”ï¼‰æˆ–è€…å½“å‰è·å–çº¿ç¨‹ä¸æ˜¯å·²ç»è·å–å†™é”çš„çº¿ç¨‹</span><br><span class="line">        if (w == 0 || current != getExclusiveOwnerThread())</span><br><span class="line">            return false;</span><br><span class="line">        // å¦‚æœé‡å…¥æ¬¡æ•°å¤§äºæœ€å¤§å†²å…¥æ•°ç›®</span><br><span class="line">        if (w + exclusiveCount(acquires) &gt; MAX_COUNT)</span><br><span class="line">            throw new Error(&quot;Maximum lock count exceeded&quot;);</span><br><span class="line">        setState(c + acquires);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    // å°è¯•è·å–å†™é”</span><br><span class="line">    // writerShouldBlockï¼šå…¬å¹³é”ä¼šè°ƒç”¨ hasQueuedPredecessorsåˆ¤æ–­è½®å¾—åˆ°è‡ªå·±å—ï¼Œéå…¬å¹³ç›´æ¥è¿”å›falseå»ç«äº‰é”</span><br><span class="line">    //  compareAndSetState å¤±è´¥å°±ä¼šè¿”å›false</span><br><span class="line">    if (writerShouldBlock() || !compareAndSetState(c, c + acquires)) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    // è®¾ç½®å½“å‰çº¿ç¨‹æ‹¥æœ‰é”</span><br><span class="line">    setExclusiveOwnerThread(current);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•é™¤äº†é‡å…¥æ¡ä»¶ï¼ˆå½“å‰çº¿ç¨‹ä¸ºè·å–äº†å†™é”çš„çº¿ç¨‹ï¼‰ä¹‹å¤–ï¼Œå¢åŠ äº†ä¸€ä¸ªè¯»é”æ˜¯å¦å­˜åœ¨çš„åˆ¤æ–­ã€‚</p>
<p>å¦‚æœå­˜åœ¨è¯»é”ï¼Œåˆ™å†™é”ä¸èƒ½è¢«è·å–ï¼ŒåŸå› åœ¨äºï¼šè¯»å†™é”è¦ç¡®ä¿å†™é”çš„æ“ä½œå¯¹è¯»é”å¯è§ï¼Œå¦‚æœå…è®¸è¯»é”åœ¨å·²è¢«è·å–çš„æƒ…å†µä¸‹å¯¹å†™é”çš„è·å–ï¼Œé‚£ä¹ˆæ­£åœ¨è¿è¡Œçš„å…¶ä»–è¯»çº¿ç¨‹å°±æ— æ³•æ„ŸçŸ¥åˆ°å½“å‰å†™çº¿ç¨‹çš„æ“ä½œã€‚</p>
<p>å†™é”çš„é‡Šæ”¾ä¸ReentrantLockçš„é‡Šæ”¾è¿‡ç¨‹åŸºæœ¬ç±»ä¼¼ï¼Œæ¯æ¬¡é‡Šæ”¾å‡å‡å°‘å†™çŠ¶æ€ï¼Œå½“å†™çŠ¶æ€ä¸º0æ—¶è¡¨ç¤ºå†™é”å·²è¢«é‡Šæ”¾ï¼Œä»è€Œç­‰å¾…çš„è¯»å†™çº¿ç¨‹èƒ½å¤Ÿç»§ç»­è®¿é—®è¯»å†™é”ï¼ŒåŒæ—¶å‰æ¬¡å†™çº¿ç¨‹çš„ä¿®æ”¹å¯¹åç»­è¯»å†™çº¿ç¨‹å¯è§ã€‚</p>
<h5 id="ä¸‰ã€è¯»é”çš„è·å–ä¸é‡Šæ”¾"><a href="#ä¸‰ã€è¯»é”çš„è·å–ä¸é‡Šæ”¾" class="headerlink" title="ä¸‰ã€è¯»é”çš„è·å–ä¸é‡Šæ”¾"></a>ä¸‰ã€è¯»é”çš„è·å–ä¸é‡Šæ”¾</h5><p>è¯»é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡è¿›å…¥çš„å…±äº«é”ï¼Œå®ƒèƒ½å¤Ÿè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–ï¼Œåœ¨ æ²¡æœ‰å…¶ä»–å†™çº¿ç¨‹è®¿é—®ï¼ˆæˆ–è€…å†™çŠ¶æ€ä¸º0ï¼‰ æ—¶ï¼Œè¯»é”æ€»ä¼šè¢«æˆåŠŸåœ°è·å–ï¼Œè€Œæ‰€åšçš„ä¹Ÿåªæ˜¯ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰å¢åŠ è¯»çŠ¶æ€ã€‚</p>
<p>è·å–è¯»é”çš„å®ç°ä»Java 5åˆ°Java 6å˜å¾—å¤æ‚è®¸å¤šï¼Œä¸»è¦åŸå› æ˜¯æ–°å¢äº†ä¸€äº›åŠŸèƒ½ï¼Œä¾‹å¦‚getReadHoldCount() æ–¹æ³•ï¼Œä½œç”¨æ˜¯è¿”å›å½“å‰çº¿ç¨‹è·å–è¯»é”çš„æ¬¡æ•°ã€‚ç”±äºè¯»çŠ¶æ€æ˜¯ æ‰€æœ‰çº¿ç¨‹è·å–è¯»é”æ¬¡æ•°çš„æ€»å’Œ ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹ å„è‡ªè·å–è¯»é”çš„æ¬¡æ•°åªèƒ½é€‰æ‹©ä¿å­˜åœ¨ThreadLocalä¸­ ï¼Œç”±çº¿ç¨‹è‡ªèº«ç»´æŠ¤ï¼Œäºæ˜¯ä½¿è·å–è¯»é”çš„å®ç°å˜å¾—å¤æ‚ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">protected final int tryAcquireShared(int unused) &#123;</span><br><span class="line">    for (; ; ) &#123;</span><br><span class="line">        // è·å–é”çŠ¶æ€</span><br><span class="line">        int c = getState();</span><br><span class="line">        // è¯»æ•°ç›®+1</span><br><span class="line">        int nextc = c + (1 &lt;&lt; 16);</span><br><span class="line">        // æº¢å‡º</span><br><span class="line">        if (nextc &lt; c)</span><br><span class="line">            throw new Error(&quot;Maximum lock count exceeded&quot;);</span><br><span class="line">        // ç°åœ¨æ˜¯å†™çŠ¶æ€ ä¸” æ‹¥æœ‰è€…ä¸æ˜¯è‡ªå·±</span><br><span class="line">        if (exclusiveCount(c) != 0 &amp;&amp; owner != Thread.currentThread())</span><br><span class="line">            return -1;</span><br><span class="line">        // ä¿®æ”¹çŠ¶æ€</span><br><span class="line">        if (compareAndSetState(c, nextc))</span><br><span class="line">            return 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨tryAcquireShared(int unused)æ–¹æ³•ä¸­ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹è·å–äº†å†™é”æˆ–è€…å†™é”æœªè¢«è·å–ï¼Œåˆ™å½“å‰çº¿ç¨‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œä¾é CASä¿è¯ï¼‰å¢åŠ è¯»çŠ¶æ€ï¼ŒæˆåŠŸè·å–è¯»é”ã€‚</p>
<p>è¯»é”çš„æ¯æ¬¡é‡Šæ”¾ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½æœ‰å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶é‡Šæ”¾è¯»é”ï¼‰å‡å‡å°‘è¯»çŠ¶æ€ï¼Œå‡å°‘çš„å€¼æ˜¯ï¼ˆ1&lt;&lt;16ï¼‰ã€‚</p>
<h5 id="å››ã€é”é™çº§"><a href="#å››ã€é”é™çº§" class="headerlink" title="å››ã€é”é™çº§"></a>å››ã€é”é™çº§</h5><p>é”é™çº§æŒ‡çš„æ˜¯å†™é”é™çº§æˆä¸ºè¯»é”ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ‹¥æœ‰å†™é”ï¼Œç„¶åå°†å…¶é‡Šæ”¾ï¼Œæœ€åå†è·å–è¯»é”ï¼Œè¿™ç§åˆ†æ®µå®Œæˆçš„è¿‡ç¨‹ä¸èƒ½ç§°ä¹‹ä¸ºé”é™çº§ã€‚é”é™çº§æ˜¯æŒ‡æŠŠæŒä½ï¼ˆå½“å‰æ‹¥æœ‰çš„ï¼‰å†™é”ï¼Œå†è·å–åˆ°è¯»é”ï¼Œéšåé‡Šæ”¾ï¼ˆå…ˆå‰æ‹¥æœ‰çš„ï¼‰å†™é”çš„è¿‡ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void processData() &#123;</span><br><span class="line">		//é”ä½è¯»é”</span><br><span class="line">        readLock.lock();</span><br><span class="line">        // æ•°æ®åœ¨æ›´æ–°å—</span><br><span class="line">        if (!update) &#123;</span><br><span class="line">			// å¿…é¡»å…ˆé‡Šæ”¾è¯»é”</span><br><span class="line">            readLock.unlock();</span><br><span class="line">			// é”é™çº§ä»å†™é”è·å–åˆ°å¼€å§‹</span><br><span class="line">            writeLock.lock();</span><br><span class="line">            try &#123;</span><br><span class="line">                if (!update) &#123;</span><br><span class="line">					// å‡†å¤‡æ•°æ®çš„æµç¨‹ï¼ˆç•¥ï¼‰</span><br><span class="line">                    update = true;</span><br><span class="line">                &#125;</span><br><span class="line">                //å¼€å§‹é™çº§</span><br><span class="line">                readLock.lock();</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">            	// é”é™çº§å®Œæˆï¼Œå†™é”é™çº§ä¸ºè¯»é”</span><br><span class="line">                writeLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">			// ä½¿ç”¨æ•°æ®çš„æµç¨‹ï¼ˆç•¥ï¼‰</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            readLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>é”é™çº§ï¼šå…ˆè·å–å†™é”ï¼Œå˜æ›´æ•°æ®ï¼Œå†è·å–è¯»é”ï¼Œå†é‡Šæ”¾å†™é”ã€‚æ­¤æ—¶è¿˜æœ‰è¯»é”ï¼Œè¿˜å¯ä»¥è¯»æ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿå¯ä»¥è·å–è¯»é”è¯»æ•°æ®ã€‚<br>è¿™æ ·å˜æ›´å®Œæ•°æ®ä¹‹åï¼Œå¯ä»¥å¤šä¸ªè¯»çº¿ç¨‹ä¸€èµ·è¯»å–æ•°æ®ã€‚</p>
<p>ä¸æ”¯æŒé”å‡çº§ï¼šæœ‰çº¿ç¨‹è·å–è¯»é”çš„æ—¶å€™ï¼Œä¸èƒ½è·å–å†™é”ï¼Œæ•°æ®æ›´æ–°å¯¹å…¶ä»–çº¿ç¨‹çš„å¯è§æ€§ã€‚</p>
<h3 id="5-LockSupportå·¥å…·"><a href="#5-LockSupportå·¥å…·" class="headerlink" title="5.LockSupportå·¥å…·"></a>5.LockSupportå·¥å…·</h3><p>é˜Ÿåˆ—åŒæ­¥å™¨ä¸­ï¼Œå½“éœ€è¦é˜»å¡æˆ–å”¤é†’ä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œéƒ½ä¼šä½¿ç”¨LockSupportå·¥å…·ç±»æ¥å®Œæˆç›¸åº”å·¥ä½œã€‚LockSupportå®šä¹‰äº†ä¸€ç»„çš„å…¬å…±é™æ€æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æä¾›äº†æœ€åŸºæœ¬çš„çº¿ç¨‹é˜»å¡å’Œå”¤é†’åŠŸèƒ½ï¼Œè€ŒLockSupportä¹Ÿæˆä¸ºæ„å»ºåŒæ­¥ç»„ä»¶çš„åŸºç¡€å·¥å…·ã€‚LockSupportå®šä¹‰äº†ä¸€ç»„ä»¥parkå¼€å¤´çš„æ–¹æ³•ç”¨æ¥é˜»å¡å½“å‰çº¿ç¨‹ï¼Œä»¥åŠunpark(Thread thread)æ–¹æ³•æ¥å”¤é†’ä¸€ä¸ªè¢«é˜»å¡çš„çº¿ç¨‹ã€‚</p>
<p>åœ¨Java 6ä¸­ï¼ŒLockSupportå¢åŠ äº†park(Object blocker)ã€parkNanos(Object blocker,long nanos)å’ŒparkUntil(Object blocker,long deadline)3ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­å‚æ•°blockeræ˜¯ç”¨æ¥æ ‡è¯†å½“å‰çº¿ç¨‹åœ¨ç­‰å¾…çš„å¯¹è±¡ï¼ˆä»¥ä¸‹ç§°ä¸ºé˜»å¡å¯¹è±¡ï¼‰ï¼Œè¯¥å¯¹è±¡ä¸»è¦ç”¨äºé—®é¢˜æ’æŸ¥å’Œç³»ç»Ÿç›‘æ§ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œçº¿ç¨‹dumpç»“æœç»“æœä¸­ï¼Œæœ‰é˜»å¡å¯¹è±¡çš„parkNanosæ–¹æ³•èƒ½å¤Ÿä¼ é€’ç»™å¼€å‘äººå‘˜é˜»å¡å¯¹è±¡çš„ä¿¡æ¯ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦åŠ é˜»å¡å¯¹è±¡ä¿¡æ¯ï¼Ÿ<br>ç”±äºåœ¨Java 5ä¹‹å‰ï¼Œå½“çº¿ç¨‹é˜»å¡ï¼ˆä½¿ç”¨synchronizedå…³é”®å­—ï¼‰åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šæ—¶ï¼Œé€šè¿‡çº¿ç¨‹dumpèƒ½å¤ŸæŸ¥çœ‹åˆ°è¯¥çº¿ç¨‹çš„é˜»å¡å¯¹è±¡ï¼Œæ–¹ä¾¿é—®é¢˜å®šä½ï¼Œè€ŒJava 5æ¨å‡ºçš„Lockç­‰å¹¶å‘å·¥å…·æ—¶å´é—æ¼äº†è¿™ä¸€ç‚¹ï¼Œè‡´ä½¿åœ¨çº¿ç¨‹dumpæ—¶æ— æ³•æä¾›é˜»å¡å¯¹è±¡çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œåœ¨Java 6ä¸­ï¼ŒLockSupportæ–°å¢äº†ä¸Šè¿°3ä¸ªå«æœ‰é˜»å¡å¯¹è±¡çš„parkæ–¹æ³•ï¼Œç”¨ä»¥æ›¿ä»£åŸæœ‰çš„parkæ–¹æ³•ã€‚</p>
<h3 id="6-Conditionæ¥å£"><a href="#6-Conditionæ¥å£" class="headerlink" title="6.Conditionæ¥å£"></a>6.Conditionæ¥å£</h3><p>ä»»æ„ä¸€ä¸ªJavaå¯¹è±¡ï¼Œéƒ½æ‹¥æœ‰ä¸€ç»„ç›‘è§†å™¨æ–¹æ³•ï¼ˆå®šä¹‰åœ¨java.lang.Objectä¸Šï¼‰ï¼Œä¸»è¦åŒ…æ‹¬wait()ã€wait(long timeout)ã€notify()ä»¥åŠnotifyAll()æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸synchronizedåŒæ­¥å…³é”®å­—é…åˆï¼Œå¯ä»¥å®ç°ç­‰å¾…&#x2F;é€šçŸ¥æ¨¡å¼ã€‚</p>
<p>Conditionæ¥å£ä¹Ÿæä¾›äº†ç±»ä¼¼Objectçš„ç›‘è§†å™¨æ–¹æ³•ï¼Œä¸Locké…åˆå¯ä»¥å®ç°ç­‰å¾…&#x2F;é€šçŸ¥æ¨¡å¼ï¼Œä½†æ˜¯è¿™ä¸¤è€…åœ¨ä½¿ç”¨æ–¹å¼ä»¥åŠåŠŸèƒ½ç‰¹æ€§ä¸Šè¿˜æ˜¯æœ‰å·®åˆ«çš„ï¼š<br>1ã€å‰ç½®æ¡ä»¶ä¸ä½†è¦è·å–é”ï¼Œè¿˜è¦è°ƒç”¨<code>Lock.newCondition()</code>è·å–Conditionå¯¹è±¡<br>2ã€ç­‰å¾…é˜Ÿåˆ—æ”¯æŒå¤šä¸ª<br>3ã€æ”¯æŒè¶…æ—¶ç­‰å¾…çŠ¶æ€<br>4ã€æ”¯æŒåœ¨ç­‰å¾…çŠ¶æ€ä¸­ä¸å“åº”ä¸­æ–­ï¼ˆå¯ä»¥å¯¹ä¸­æ–­ä¸æ•æ„Ÿï¼‰</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼š<br>synchronized + Objectç›‘è§†å™¨æ–¹æ³• - å®ç°ç­‰å¾…é€šçŸ¥ - æ¡ˆä¾‹çº¿ç¨‹æ± <br>Lock(é˜Ÿåˆ—åŒæ­¥å™¨) + Conditionæ¥å£ - å®ç°ç­‰å¾…é€šçŸ¥ - æ¡ˆä¾‹æœ‰ç•Œé˜Ÿåˆ—<br>å¯ä»¥ç›´æ¥ä½¿ç”¨synchronizedå®ç°åŒæ­¥<br>å¯ä»¥ç›´æ¥ä½¿ç”¨Lockå®ç°é”ï¼Œåªä¸è¿‡åªæœ‰åŒæ­¥é˜Ÿåˆ—ï¼Œé‡Œé¢çº¿ç¨‹æ˜¯é˜»å¡çŠ¶æ€ï¼Œæ²¡æœ‰ç­‰å¾…é˜Ÿåˆ—</p>
<h4 id="âœ…Conditionæ¥å£ä¸ç¤ºä¾‹"><a href="#âœ…Conditionæ¥å£ä¸ç¤ºä¾‹" class="headerlink" title="âœ…Conditionæ¥å£ä¸ç¤ºä¾‹"></a>âœ…Conditionæ¥å£ä¸ç¤ºä¾‹</h4><p>Conditionå®šä¹‰äº†ç­‰å¾…&#x2F;é€šçŸ¥ä¸¤ç§ç±»å‹çš„æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è°ƒç”¨è¿™äº›æ–¹æ³•æ—¶ï¼Œéœ€è¦æå‰è·å–åˆ°Conditionå¯¹è±¡å…³è”çš„é”ã€‚</p>
<p>Conditionå¯¹è±¡æ˜¯ç”±Lockå¯¹è±¡ï¼ˆè°ƒç”¨Lockå¯¹è±¡çš„newCondition()æ–¹æ³•ï¼‰åˆ›å»ºå‡ºæ¥çš„ï¼Œæ¢å¥è¯è¯´ï¼ŒConditionæ˜¯ä¾èµ–Lockå¯¹è±¡çš„ã€‚</p>
<p>ç­‰å¾…é€šçŸ¥æ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Lock lock = new ReentrantLock();</span><br><span class="line">Condition condition = lock.newCondition();</span><br><span class="line"></span><br><span class="line">public void conditionWait() throws InterruptedException &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    try &#123;</span><br><span class="line">        condition.await();</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void conditionSignal() throws InterruptedException &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    try &#123;</span><br><span class="line">        condition.signal();</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†Conditionå¯¹è±¡ä½œä¸ºæˆå‘˜å˜é‡ã€‚é€šè¿‡Lockçš„newCondition()æ–¹æ³•</p>
<p>å½“è°ƒç”¨await()æ–¹æ³•åï¼Œå½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾é”å¹¶åœ¨æ­¤ç­‰å¾…ï¼Œè€Œå…¶ä»–çº¿ç¨‹è°ƒç”¨Conditionå¯¹è±¡çš„signal()æ–¹æ³•ï¼Œé€šçŸ¥å½“å‰çº¿ç¨‹åï¼Œå½“å‰çº¿ç¨‹æ‰ä»await()æ–¹æ³•è¿”å›ï¼Œå¹¶ä¸”åœ¨è¿”å›å‰å·²ç»è·å–äº†é”ã€‚</p>
<p>Conditionæ¥å£æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">await() ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·æˆ–è¢«ä¸­æ–­ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¯¹ä¸­æ–­æ•æ„Ÿã€‚</span><br><span class="line">await(long time, TimeUnit unit) ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ã€è¢«ä¸­æ–­æˆ–åˆ°è¾¾æŒ‡å®šç­‰å¾…æ—¶é—´ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚</span><br><span class="line">awaitNanos(long nanosTimeout) ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ã€è¢«ä¸­æ–­æˆ–åˆ°è¾¾æŒ‡å®šç­‰å¾…æ—¶é—´ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚è¿”å›å€¼è¡¨ç¤ºå‰©ä½™æ—¶é—´ï¼Œå¦‚æœåœ¨nanosTimesoutä¹‹å‰å”¤é†’ï¼Œé‚£ä¹ˆè¿”å›å€¼ = nanosTimeout - æ¶ˆè€—æ—¶é—´ï¼Œå¦‚æœè¿”å›å€¼ &lt;= 0 ,åˆ™å¯ä»¥è®¤å®šå®ƒå·²ç»è¶…æ—¶äº†ã€‚</span><br><span class="line">awaitUninterruptibly() ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚ã€æ³¨æ„ï¼šè¯¥æ–¹æ³•å¯¹ä¸­æ–­ä¸æ•æ„Ÿã€‘ã€‚</span><br><span class="line">awaitUntil(Date deadline) ï¼šé€ æˆå½“å‰çº¿ç¨‹åœ¨æ¥åˆ°ä¿¡å·ã€è¢«ä¸­æ–­æˆ–åˆ°è¾¾æŒ‡å®šæœ€åæœŸé™ä¹‹å‰ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰åˆ°æŒ‡å®šæ—¶é—´å°±è¢«é€šçŸ¥ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¡¨ç¤ºåˆ°äº†æŒ‡å®šæ—¶é—´ï¼Œè¿”å›è¿”å›falseã€‚</span><br><span class="line">signal() ï¼šå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚è¯¥çº¿ç¨‹ä»ç­‰å¾…æ–¹æ³•è¿”å›å‰å¿…é¡»è·å¾—ä¸Conditionç›¸å…³çš„é”ã€‚</span><br><span class="line">signalAll() ï¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚èƒ½å¤Ÿä»ç­‰å¾…æ–¹æ³•è¿”å›çš„çº¿ç¨‹å¿…é¡»è·å¾—ä¸Conditionç›¸å…³çš„é”ã€‚</span><br></pre></td></tr></table></figure>

<p>æœ‰ç•Œé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œé˜Ÿåˆ—çš„è·å–æ“ä½œå°†ä¼šé˜»å¡è·å–çº¿ç¨‹ï¼ˆè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼‰ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰æ–°å¢å…ƒç´ ï¼Œå½“é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œé˜Ÿåˆ—çš„æ’å…¥æ“ä½œå°†ä¼šé˜»å¡æ’å…¥çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—å‡ºç°â€œç©ºä½â€ã€‚æœ‰ç‚¹åƒçº¿ç¨‹æ± ã€‚</p>
<p>çº¿ç¨‹æ± ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class BoundedQueue&lt;T&gt; &#123;</span><br><span class="line">    private Object[] items;</span><br><span class="line">    // æ·»åŠ çš„ä¸‹æ ‡ï¼Œåˆ é™¤çš„ä¸‹æ ‡å’Œæ•°ç»„å½“å‰æ•°é‡</span><br><span class="line">    private int addIndex, removeIndex, count;</span><br><span class="line">    private Lock lock = new ReentrantLock();</span><br><span class="line">    private Condition notEmpty = lock.newCondition();</span><br><span class="line">    private Condition notFull = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    public BoundedQueue(int size) &#123;</span><br><span class="line">        items = new Object[size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ•°ç»„æ»¡ï¼Œåˆ™æ·»åŠ çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœ‰&quot;ç©ºä½&quot;</span><br><span class="line">    public void add(T t) throws InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        try &#123;</span><br><span class="line">            while (count == items.length)</span><br><span class="line">                notFull.await();</span><br><span class="line">            items[addIndex] = t;</span><br><span class="line">            if (++addIndex == items.length)</span><br><span class="line">                addIndex = 0;</span><br><span class="line">            ++count;</span><br><span class="line">            notEmpty.signal();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ç”±å¤´éƒ¨åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ•°ç»„ç©ºï¼Œåˆ™åˆ é™¤çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°æ·»åŠ å…ƒç´ </span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public T remove() throws InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        try &#123;</span><br><span class="line">            while (count == 0)</span><br><span class="line">                notEmpty.await();</span><br><span class="line">            Object x = items[removeIndex];</span><br><span class="line">            if (++removeIndex == items.length)</span><br><span class="line">                removeIndex = 0;</span><br><span class="line">            --count;</span><br><span class="line">            notFull.signal();</span><br><span class="line">            return (T) x;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥æ·»åŠ æ–¹æ³•ä¸ºä¾‹ï¼šé¦–å…ˆéœ€è¦è·å¾—é”ï¼Œç›®çš„æ˜¯ç¡®ä¿æ•°ç»„ä¿®æ”¹çš„å¯è§æ€§å’Œæ’ä»–æ€§ã€‚å½“æ•°ç»„æ•°é‡ç­‰äºæ•°ç»„é•¿åº¦æ—¶ï¼Œè¡¨ç¤ºæ•°ç»„å·²æ»¡ï¼Œåˆ™è°ƒç”¨notFull.await()ï¼Œå½“å‰çº¿ç¨‹éšä¹‹é‡Šæ”¾é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å¦‚æœæ•°ç»„æ•°é‡ä¸ç­‰äºæ•°ç»„é•¿åº¦ï¼Œè¡¨ç¤ºæ•°ç»„æœªæ»¡ï¼Œåˆ™æ·»åŠ å…ƒç´ åˆ°æ•°ç»„ä¸­ï¼ŒåŒæ—¶é€šçŸ¥ç­‰å¾…åœ¨notEmptyä¸Šçš„çº¿ç¨‹ï¼Œæ•°ç»„ä¸­å·²ç»æœ‰æ–°å…ƒç´ å¯ä»¥è·å–ã€‚</p>
<p>åœ¨æ·»åŠ å’Œåˆ é™¤æ–¹æ³•ä¸­ä½¿ç”¨whileå¾ªç¯è€Œéifåˆ¤æ–­ï¼Œç›®çš„æ˜¯é˜²æ­¢è¿‡æ—©æˆ–æ„å¤–çš„é€šçŸ¥ï¼Œåªæœ‰æ¡ä»¶ç¬¦åˆæ‰èƒ½å¤Ÿé€€å‡ºå¾ªç¯ã€‚å›æƒ³ä¹‹å‰æåˆ°çš„ç­‰å¾…&#x2F;é€šçŸ¥çš„ç»å…¸èŒƒå¼ï¼ŒäºŒè€…æ˜¯éå¸¸ç±»ä¼¼çš„ã€‚</p>
<p>âš ï¸çº¿ç¨‹çš„é˜»å¡ã€ç­‰å¾…çš„åŒºåˆ«ï¼š<br>åœ¨javaä¸­ï¼Œçº¿ç¨‹é˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹æœ¬èº«ä¸å¯è®¡åˆ’çš„ï¼Œè€Œçº¿ç¨‹ç­‰å¾…çŠ¶æ€æ˜¯çº¿ç¨‹æœ¬èº«è®¡åˆ’ä¹‹å†…çš„ã€‚<br>ç›¸åŒç‚¹ï¼š<br>ï¼ˆ1ï¼‰éƒ½ä¼šæš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚<br>åŒºåˆ«ç‚¹ï¼š<br>ï¼ˆ1ï¼‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€æ˜¯è¢«åŠ¨çš„, è€Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€æ˜¯ä¸»åŠ¨çš„ã€‚<br>é˜»å¡çŠ¶æ€çš„è¢«åŠ¨ï¼šçº¿ç¨‹åœ¨åŒæ­¥ä»£ç å¤–ï¼Œè·å–å¯¹è±¡é”å¤±è´¥æ—¶ï¼Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼›ä½•æ—¶è·å–å¯¹è±¡é”å¤±è´¥ä¸å¯çŸ¥ï¼Œå³çº¿ç¨‹é˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹æœ¬èº«ä¸å¯è®¡åˆ’çš„ã€‚<br>ç­‰å¾…çŠ¶æ€çš„ä¸»åŠ¨ï¼šçº¿ç¨‹åœ¨åŒæ­¥ä»£ç å†…awaitï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å”¤é†’æ—¶ï¼Œçº¿ç¨‹æ¥å…¥ç­‰å¾…çŠ¶æ€ï¼›ä½•æ—¶ç­‰å¾…å…¶ä»–çº¿ç¨‹æ“ä½œå¯çŸ¥ï¼Œå³çº¿ç¨‹ç­‰å¾…çŠ¶æ€æ˜¯çº¿ç¨‹æœ¬èº«è®¡åˆ’ä¹‹å†…çš„ã€‚</p>
<h4 id="âœ…Conditionçš„å®ç°åˆ†æ"><a href="#âœ…Conditionçš„å®ç°åˆ†æ" class="headerlink" title="âœ…Conditionçš„å®ç°åˆ†æ"></a>âœ…Conditionçš„å®ç°åˆ†æ</h4><p>ConditionObjectæ˜¯åŒæ­¥å™¨AbstractQueuedSynchronizerçš„å†…éƒ¨ç±»ï¼Œå› ä¸ºConditionçš„æ“ä½œéœ€è¦è·å–ç›¸å…³è”çš„é”ï¼Œæ‰€ä»¥ä½œä¸ºåŒæ­¥å™¨çš„å†…éƒ¨ç±»ä¹Ÿè¾ƒä¸ºåˆç†ã€‚</p>
<p>æ¯ä¸ªConditionå¯¹è±¡éƒ½åŒ…å«ç€ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆä»¥ä¸‹ç§°ä¸ºç­‰å¾…é˜Ÿåˆ—ï¼‰ï¼Œè¯¥é˜Ÿåˆ—æ˜¯Conditionå¯¹è±¡å®ç°ç­‰å¾…&#x2F;é€šçŸ¥åŠŸèƒ½çš„å…³é”®ã€‚</p>
<h5 id="ä¸€ã€ç­‰å¾…é˜Ÿåˆ—"><a href="#ä¸€ã€ç­‰å¾…é˜Ÿåˆ—" class="headerlink" title="ä¸€ã€ç­‰å¾…é˜Ÿåˆ—"></a>ä¸€ã€ç­‰å¾…é˜Ÿåˆ—</h5><p>ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸€ä¸ªçº¿ç¨‹å¼•ç”¨ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯åœ¨Conditionå¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†Condition.await()æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°†ä¼šé‡Šæ”¾é”ã€æ„é€ æˆèŠ‚ç‚¹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚èŠ‚ç‚¹çš„å®šä¹‰å¤ç”¨äº†åŒæ­¥å™¨ä¸­èŠ‚ç‚¹çš„å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ä¸­èŠ‚ç‚¹ç±»å‹éƒ½æ˜¯åŒæ­¥å™¨çš„é™æ€å†…éƒ¨ç±»AbstractQueuedSynchronizer.Nodeã€‚</p>
<p>ç­‰å¾…é˜Ÿåˆ—ï¼šå½“å‰çº¿ç¨‹è°ƒç”¨Condition.await()æ–¹æ³•ï¼Œå°†ä¼šä»¥å½“å‰çº¿ç¨‹æ„é€ èŠ‚ç‚¹ï¼Œå¹¶å°†èŠ‚ç‚¹ä»å°¾éƒ¨åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚èŠ‚ç‚¹å¼•ç”¨æ›´æ–°çš„è¿‡ç¨‹å¹¶æ²¡æœ‰ä½¿ç”¨CASä¿è¯ï¼ŒåŸå› åœ¨äºè°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹å¿…å®šæ˜¯è·å–äº†é”çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥è¿‡ç¨‹æ˜¯ç”±é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>åœ¨Objectçš„ç›‘è§†å™¨æ¨¡å‹ä¸Šï¼Œä¸€ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œå¹¶å‘åŒ…ä¸­çš„Lockï¼ˆæ›´ç¡®åˆ‡åœ°è¯´æ˜¯åŒæ­¥å™¨ï¼‰æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œå¤šä¸ªç­‰å¾…é˜Ÿåˆ—ï¼ˆæ¯ä¸ªConditionå¯¹è±¡ä¸€ä¸ªï¼‰ã€‚</p>
<h5 id="äºŒã€ç­‰å¾…"><a href="#äºŒã€ç­‰å¾…" class="headerlink" title="äºŒã€ç­‰å¾…"></a>äºŒã€ç­‰å¾…</h5><p>è°ƒç”¨Conditionçš„await()æ–¹æ³•ï¼ˆæˆ–è€…ä»¥awaitå¼€å¤´çš„æ–¹æ³•ï¼‰ï¼Œä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—å¹¶é‡Šæ”¾é”ï¼ŒåŒæ—¶çº¿ç¨‹çŠ¶æ€å˜ä¸ºç­‰å¾…çŠ¶æ€ã€‚å½“ä»await()æ–¹æ³•è¿”å›æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¸€å®šè·å–äº†Conditionç›¸å…³è”çš„é”ã€‚</p>
<p>å¦‚æœä»é˜Ÿåˆ—ï¼ˆåŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—ï¼‰çš„è§’åº¦çœ‹await()æ–¹æ³•ï¼Œå½“è°ƒç”¨await()æ–¹æ³•æ—¶ï¼Œç›¸å½“äºåŒæ­¥é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ï¼ˆè·å–äº†é”çš„èŠ‚ç‚¹ï¼‰ç§»åŠ¨åˆ°Conditionçš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p>
<p>ConditionObjectçš„awaitæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final void await() throws InterruptedException &#123;</span><br><span class="line">    if (Thread.interrupted())</span><br><span class="line">        throw new InterruptedException();</span><br><span class="line">    // å½“å‰çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</span><br><span class="line">    Node node = addConditionWaiter();</span><br><span class="line">    // é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯é‡Šæ”¾é”</span><br><span class="line">    int savedState = fullyRelease(node);</span><br><span class="line">    int interruptMode = 0;</span><br><span class="line">    // èŠ‚ç‚¹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­</span><br><span class="line">    // Returns true if a node, always one that was initially placed on a condition queue, is now waiting to reacquire on sync queue.</span><br><span class="line">    // å¦‚æœèŠ‚ç‚¹åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œç°åœ¨ç­‰å¾…é‡æ–°å»è·å–é”ï¼Œè¿”å›true</span><br><span class="line">    // ä¸€èˆ¬æ€»æ˜¯åœ¨æ¡ä»¶é˜Ÿåˆ—</span><br><span class="line">    while (!isOnSyncQueue(node)) &#123;</span><br><span class="line">        // æš‚åœè‡ªå·±ï¼Œç­‰å¾…è¢«å”¤é†’æˆ–è€…è¢«ä¸­æ–­</span><br><span class="line">        LockSupport.park(this);</span><br><span class="line">        // æ˜¯å¦è¢«ä¸­æ–­äº†</span><br><span class="line">        if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    // è·å–é”æˆåŠŸä¸”å¼‚å¸¸æ¨¡å¼ä¸ä¸ºTHROW_IEï¼Œå°±ä¿®æ”¹interruptMode</span><br><span class="line">    if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)</span><br><span class="line">        interruptMode = REINTERRUPT;</span><br><span class="line">    // è¯¥æ–¹æ³•æ˜¯å†…éƒ¨ç±»Conditionä¸­çš„ï¼Œè®¾ç½®ä¸‹ä¸€ä¸ªåœ¨é¦–ä½çš„ç­‰å¾…è€…</span><br><span class="line">    if (node.nextWaiter != null)</span><br><span class="line">        unlinkCancelledWaiters();</span><br><span class="line">    // å¦‚æœinterruptMode ä¸æ˜¯0ï¼Œå”¤é†’åæŠ¥å‘Šä¸­æ–­</span><br><span class="line">    if (interruptMode != 0)</span><br><span class="line">        reportInterruptAfterWait(interruptMode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ1ï¼‰è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹æˆåŠŸè·å–äº†é”çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯åŒæ­¥é˜Ÿåˆ—ä¸­çš„é¦–èŠ‚ç‚¹ï¼Œè¯¥æ–¹æ³•ä¼šå°†å½“å‰çº¿ç¨‹æ„é€ æˆèŠ‚ç‚¹å¹¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç„¶åé‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„åç»§èŠ‚ç‚¹ï¼Œç„¶åå½“å‰çº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ï¼ˆåŒæ­¥é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹å¹¶ä¸ä¼šç›´æ¥åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œæ˜¯é€šè¿‡addConditionWaiter()æ–¹æ³•æŠŠå½“å‰çº¿ç¨‹æ„é€ æˆä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å¹¶å°†å…¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ï¼‰</p>
<p>ï¼ˆ2ï¼‰å½“ç­‰å¾…é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹è¢«å”¤é†’ï¼Œåˆ™å”¤é†’èŠ‚ç‚¹çš„çº¿ç¨‹è¿›å…¥åŒæ­¥é˜Ÿåˆ—ï¼Œå¼€å§‹å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚å¦‚æœä¸æ˜¯é€šè¿‡å…¶ä»–çº¿ç¨‹è°ƒç”¨Condition.signal()æ–¹æ³•å”¤é†’ï¼Œè€Œæ˜¯å¯¹ç­‰å¾…çº¿ç¨‹è¿›è¡Œä¸­æ–­ï¼Œåˆ™ä¼šæŠ›å‡ºInterruptedExceptionã€‚</p>
<h5 id="ä¸‰ã€é€šçŸ¥"><a href="#ä¸‰ã€é€šçŸ¥" class="headerlink" title="ä¸‰ã€é€šçŸ¥"></a>ä¸‰ã€é€šçŸ¥</h5><p>è°ƒç”¨Conditionçš„signal()æ–¹æ³•çš„å‰ç½®æ¡ä»¶æ˜¯å½“å‰çº¿ç¨‹å¿…é¡»è·å–äº†é”ï¼Œå°†åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„èŠ‚ç‚¹ï¼ˆé¦–èŠ‚ç‚¹ï¼‰ï¼Œçº¿ç¨‹å®‰å…¨åœ°ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œå¹¶ä½¿ç”¨LockSupportå”¤é†’èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹ï¼Œç„¶åå°±ç«äº‰é”ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final void signal() &#123;</span><br><span class="line">    // é”æ˜¯å¦å¤„äºå ç”¨çŠ¶æ€</span><br><span class="line">    if (!isHeldExclusively())</span><br><span class="line">        throw new IllegalMonitorStateException();</span><br><span class="line">    // è·å–ç¬¬ä¸€ä¸ªçº¿ç¨‹</span><br><span class="line">    Node first = firstWaiter;</span><br><span class="line">    if (first != null)</span><br><span class="line">        // å”¤é†’</span><br><span class="line">        doSignal(first);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¢«å”¤é†’åçš„çº¿ç¨‹ï¼Œå°†ä»await()æ–¹æ³•ä¸­çš„whileå¾ªç¯ä¸­é€€å‡ºï¼ˆisOnSyncQueue(Node node)æ–¹æ³•è¿”å›trueï¼ŒèŠ‚ç‚¹å·²ç»åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼‰ï¼Œè¿›è€Œè°ƒç”¨åŒæ­¥å™¨çš„acquireQueued()æ–¹æ³•åŠ å…¥åˆ°è·å–åŒæ­¥çŠ¶æ€çš„ç«äº‰ä¸­ã€‚</p>
<p>æˆåŠŸè·å–åŒæ­¥çŠ¶æ€ï¼ˆæˆ–è€…è¯´é”ï¼‰ä¹‹åï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å°†ä»å…ˆå‰è°ƒç”¨çš„await()æ–¹æ³•è¿”å›ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹å·²ç»æˆåŠŸåœ°è·å–äº†é”ã€‚å¦‚æœæœªè·å–åˆ°é”ï¼Œå°†åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­é˜»å¡ã€‚</p>
<p>Conditionçš„signalAll()æ–¹æ³•ï¼Œç›¸å½“äºå¯¹ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å‡æ‰§è¡Œä¸€æ¬¡signal()æ–¹æ³•ï¼Œæ•ˆæœå°±æ˜¯å°†ç­‰å¾…é˜Ÿåˆ—ä¸­æ‰€æœ‰èŠ‚ç‚¹å…¨éƒ¨ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶å”¤é†’æ¯ä¸ªèŠ‚ç‚¹çš„çº¿ç¨‹ã€‚</p>
<h2 id="ç¬¬å…­ç« -javaå¹¶å‘å®¹å™¨å’Œæ¡†æ¶"><a href="#ç¬¬å…­ç« -javaå¹¶å‘å®¹å™¨å’Œæ¡†æ¶" class="headerlink" title="ç¬¬å…­ç«  javaå¹¶å‘å®¹å™¨å’Œæ¡†æ¶"></a>ç¬¬å…­ç«  javaå¹¶å‘å®¹å™¨å’Œæ¡†æ¶</h2><h3 id="1-ConcurrentHashMapçš„å®ç°åŸç†ä¸ä½¿ç”¨"><a href="#1-ConcurrentHashMapçš„å®ç°åŸç†ä¸ä½¿ç”¨" class="headerlink" title="1.ConcurrentHashMapçš„å®ç°åŸç†ä¸ä½¿ç”¨"></a>1.ConcurrentHashMapçš„å®ç°åŸç†ä¸ä½¿ç”¨</h3><p>ConcurrentHashMapæ˜¯çº¿ç¨‹å®‰å…¨ä¸”é«˜æ•ˆçš„HashMapã€‚</p>
<h4 id="âœ…ä¸ºä»€ä¹ˆä½¿ç”¨ConcurrentHashMap"><a href="#âœ…ä¸ºä»€ä¹ˆä½¿ç”¨ConcurrentHashMap" class="headerlink" title="âœ…ä¸ºä»€ä¹ˆä½¿ç”¨ConcurrentHashMap"></a>âœ…ä¸ºä»€ä¹ˆä½¿ç”¨ConcurrentHashMap</h4><p>ï¼ˆ1ï¼‰<strong>HashMapçº¿ç¨‹ä¸å®‰å…¨ä¼šæ­»å¾ªç¯</strong></p>
<p>HashMap åœ¨å¹¶å‘æ‰§è¡Œputæ“ä½œæ—¶ä¼šå¼•èµ·æ­»å¾ªç¯ï¼Œæ˜¯å› ä¸ºå¤šçº¿ç¨‹ä¼šå¯¼è‡´HashMapçš„Entryé“¾è¡¨å½¢æˆç¯å½¢æ•°æ®ç»“æ„ï¼Œä¸€æ—¦å½¢æˆç¯å½¢æ•°æ®ç»“æ„ï¼ŒEntryçš„nextèŠ‚ç‚¹æ°¸è¿œä¸ä¸ºç©ºï¼Œå°±ä¼šäº§ç”Ÿæ­»å¾ªç¯è·å–Entryã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">final HashMap&lt;String,String&gt; map = new HashMap&lt;&gt;(2); // å®¹é‡ä¸º2çš„Map</span><br><span class="line">Thread thread = new Thread(new Runnable() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        for (int i=0;i&lt;10000;i++)&#123;</span><br><span class="line">            new Thread(new Runnable() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void run() &#123;</span><br><span class="line">                    map.put(UUID.randomUUID().toString(),&quot;&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,&quot;ftf&quot;+i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,&quot;ftf&quot;);</span><br><span class="line">thread.start();</span><br><span class="line">thread.join();</span><br></pre></td></tr></table></figure>

<p>HashMapçš„å®ç°åŸç†ï¼š<br>HashMapçš„ä¸»å¹²æ˜¯ä¸€ä¸ªEntryæ•°ç»„ï¼ˆEntryæ˜¯ä»¥é“¾è¡¨çš„å½¢å¼å­˜å‚¨çš„ï¼‰ã€‚Entryæ˜¯HashMapçš„åŸºæœ¬ç»„æˆå•å…ƒï¼Œæ¯ä¸€ä¸ªEntryåŒ…å«ä¸€ä¸ªkey-valueé”®å€¼å¯¹ã€‚(å…¶å®æ‰€è°“Mapå…¶å®å°±æ˜¯ä¿å­˜äº†ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»çš„ä¸€ç§é›†åˆ)ã€‚</p>
<p>Entryç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123;</span><br><span class="line">    final K key;</span><br><span class="line">    V value;</span><br><span class="line">    Entry&lt;K,V&gt; next; // å­˜å‚¨æŒ‡å‘ä¸‹ä¸€ä¸ªEntryçš„å¼•ç”¨ï¼Œå•é“¾è¡¨ç»“æ„ã€‚</span><br><span class="line"> </span><br><span class="line">    int hash;	   // å¯¹keyçš„hashcodeå€¼è¿›è¡Œhashè¿ç®—åå¾—åˆ°çš„å€¼ï¼Œå­˜å‚¨åœ¨Entryï¼Œé¿å…é‡å¤è®¡ç®—ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼šHashMapç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ã€‚</p>
<p>HashMapåœ¨putçš„æ—¶å€™ï¼Œæ’å…¥çš„å…ƒç´ è¶…è¿‡äº†å®¹é‡(ç”±è´Ÿè½½å› å­å†³å®š)çš„èŒƒå›´å°±ä¼šè§¦å‘æ‰©å®¹æ“ä½œï¼Œå°±æ˜¯rehashï¼Œè¿™ä¸ªä¼šé‡æ–°å°†åŸæ•°ç»„çš„å†…å®¹é‡æ–°hashåˆ°æ–°çš„æ‰©å®¹æ•°ç»„ä¸­ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œå­˜åœ¨å…¶ä»–çš„å…ƒç´ ä¹Ÿåœ¨putæ“ä½œï¼Œå¦‚æœhashå€¼ç›¸åŒï¼Œå¯èƒ½å‡ºç°åŒæ—¶åœ¨åŒä¸€æ•°ç»„ä¸‹ç”¨é“¾è¡¨è¡¨ç¤ºï¼Œé€ æˆé—­ç¯ï¼Œå¯¼è‡´åœ¨getæ—¶ä¼šå‡ºç°æ­»å¾ªç¯ï¼Œæ‰€ä»¥HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p>
<p>HashMapçš„çº¿ç¨‹ä¸å®‰å…¨ä¸»è¦ä½“ç°åœ¨ä¼šé€ æˆæ­»å¾ªç¯ï¼Œæ•°æ®ä¸¢å¤±ï¼Œæ•°æ®è¦†ç›–è¿™äº›é—®é¢˜ã€‚å…¶ä¸­æ­»å¾ªç¯å’Œæ•°æ®ä¸¢å¤±æ˜¯åœ¨JDK1.7ä¸­å‡ºç°çš„é—®é¢˜ï¼Œåœ¨Jdk1.8ä¸­å·²ç»å¾—åˆ°è§£å†³ï¼Œç„¶è€ŒJDK1.8ä»ä¼šæœ‰æ•°æ®è¦†ç›–è¿™æ ·çš„é—®é¢˜ã€‚</p>
<p>ï¼ˆ2ï¼‰<strong>æ•ˆç‡ä½ä¸‹çš„HashTable</strong></p>
<p>HashTableå®¹å™¨ä½¿ç”¨synchronizedæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†åœ¨çº¿ç¨‹ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹HashTableçš„æ•ˆç‡éå¸¸ä½ä¸‹ã€‚å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®HashTableçš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹ä¹Ÿè®¿é—®HashTableçš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œä¼šè¿›å…¥é˜»å¡æˆ–è½®è¯¢çŠ¶æ€ï¼Œæ‰€ä»¥ç«äº‰è¶Šæ¿€çƒˆæ•ˆç‡è¶Šä½ã€‚</p>
<p>ï¼ˆ3ï¼‰ConcurrentHashMapçš„é”åˆ†æ®µæŠ€æœ¯å¯æœ‰æ•ˆæå‡å¹¶å‘è®¿é—®ç‡ã€‚</p>
<p>HashTableçš„çº¿ç¨‹éƒ½å¿…é¡»ç«äº‰åŒä¸€æŠŠé”ï¼Œå‡å¦‚å®¹å™¨é‡Œæœ‰å¤šæŠŠé”æ¯ä¸€æŠŠé”ç”¨äºé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼Œé‚£ä¹ˆå½“å¤šçº¿ç¨‹è®¿é—®å®¹å™¨é‡Œä¸åŒæ•°æ®æ®µçš„æ•°æ®æ—¶ï¼Œçº¿ç¨‹é—´å°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œä»è€Œå¯ä»¥æœ‰æ•ˆæé«˜å¹¶å‘ç‡ï¼Œè¿™å°±æ˜¯ConcurrentHashMapæ‰€ä½¿ç”¨çš„é”åˆ†æ®µæŠ€æœ¯ã€‚é¦–å…ˆå°†æ•°æ®åˆ†æˆä¸€æ®µä¸€æ®µåœ°å­˜å‚¨ï¼Œç„¶åç»™æ¯ä¸€æ®µæ•°æ®é…ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®çš„æ—¶å€™ï¼Œå…¶å®ƒæ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚</p>
<h4 id="âœ…ConcurrentHashMapçš„ç»“æ„"><a href="#âœ…ConcurrentHashMapçš„ç»“æ„" class="headerlink" title="âœ…ConcurrentHashMapçš„ç»“æ„"></a>âœ…ConcurrentHashMapçš„ç»“æ„</h4><p>ç±»å›¾ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ConcurrentHashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt;</span><br><span class="line">    implements ConcurrentMap&lt;K,V&gt;, Serializable</span><br></pre></td></tr></table></figure>

<p>ConcurrentHashMapæ˜¯ç”±Segmentæ•°ç»„ç»“æ„å’ŒHashEntryæ•°ç»„ç»“æ„ç»„æˆã€‚Segmentæ˜¯ä¸€ç§å¯é‡å…¥é”(ReentrantLock),åœ¨ConcurrentHashMapé‡Œæ‰®æ¼”é”çš„è§’è‰²ï¼›HashEntryåˆ™ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚ä¸€ä¸ªConcurrentHashMapé‡ŒåŒ…å«ä¸€ä¸ªSegmentæ•°ç»„ã€‚Segmentçš„ç»“æ„å’ŒHashMapç±»ä¼¼ï¼Œæ˜¯ä¸€ç§æ•°ç»„å’Œé“¾è¡¨ç»“æ„ã€‚<strong>ä¸€ä¸ªSegmenté‡ŒåŒ…å«ä¸€ä¸ªHashEntryæ•°ç»„</strong>ï¼Œ<strong>æ¯ä¸ªHashEntryæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ï¼ˆä¸€ä¸ªåŒ…å«æ•°æ®çš„é“¾è¡¨ï¼‰</strong>ï¼Œæ¯ä¸ªSegmenté‡Œå®ˆæŠ¤ç€ä¸€ä¸ªHashEntryæ•°ç»„é‡Œçš„å…ƒç´ ï¼Œå½“å¯¹HashEntryæ•°ç»„çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å¾—ä¸å®ƒå¯¹åº”çš„Segmenté”ã€‚</p>
<h4 id="âœ…ConcurrentHashMapçš„åˆå§‹åŒ–ä¸å®šä½"><a href="#âœ…ConcurrentHashMapçš„åˆå§‹åŒ–ä¸å®šä½" class="headerlink" title="âœ…ConcurrentHashMapçš„åˆå§‹åŒ–ä¸å®šä½"></a>âœ…ConcurrentHashMapçš„åˆå§‹åŒ–ä¸å®šä½</h4><p>ConcurrentHashMapåˆå§‹åŒ–æ–¹æ³•æ˜¯é€šè¿‡initialCapacity, loadFactorå’ŒconcurrencyLevelç­‰å‡ ä¸ªå‚æ•°æ¥åˆå§‹åŒ–segmentæ•°ç»„ï¼Œæ®µåç§»é‡segmentShiftï¼Œæ®µæ©ç segmentMaskå’Œæ¯ä¸ªsegmenté‡Œçš„HashEntryæ•°ç»„æ¥å®ç°ã€‚</p>
<p>ConcurrentHashMapä½¿ç”¨åˆ†æ®µé”Segmentæ¥ä¿æŠ¤ä¸åŒæ®µçš„æ•°æ®ï¼Œé‚£ä¹ˆåœ¨æ’å…¥å’Œè·å–å…ƒç´ çš„æ—¶å€™ï¼Œå¿…é¡»å…ˆé€šè¿‡æ•£åˆ—ç®—æ³•å®šä½åˆ°Segmentã€‚è€Œä¸”ï¼Œä¼šä½¿ç”¨å†æ•£è£‚ç®—æ³•å¯¹å…ƒç´ çš„hashCodeè¿›è¡Œä¸€æ¬¡å†æ•£åˆ—ã€‚</p>
<p>å†æ•£åˆ—çš„ç›®çš„ï¼šå‡å°‘æ•£åˆ—å†²çªï¼Œä½¿å…ƒç´ å‡åŒ€åœ°åˆ†å¸ƒåœ¨ä¸åŒçš„segmrntä¸Šï¼Œæé«˜å®¹å™¨çš„å­˜å–æ•ˆç‡ã€‚</p>
<h4 id="âœ…ConcurrentHashMapçš„æ“ä½œ"><a href="#âœ…ConcurrentHashMapçš„æ“ä½œ" class="headerlink" title="âœ…ConcurrentHashMapçš„æ“ä½œ"></a>âœ…ConcurrentHashMapçš„æ“ä½œ</h4><p>ï¼ˆ1ï¼‰get(key)</p>
<p>ç»è¿‡ä¸€æ¬¡å†æ•£åˆ—ï¼Œå…ˆå®šä½åˆ°segmentï¼Œç„¶åå†é€šè¿‡æ•£åˆ—è¿ç®—å®šä½åˆ°å…ƒç´ ã€‚<br>ä¸éœ€è¦åŠ é”ï¼Œé™¤éè¯»åˆ°çš„å€¼æ˜¯ç©ºçš„æ‰ä¼šåŠ é”é‡è¯»ã€‚åŸå› æ˜¯ï¼šå°†å…±äº«å˜é‡ï¼ˆsegmentå¤§å°ã€HashEntryé‡Œçš„valueï¼‰å®šä¹‰ä¸ºvolatileã€‚åˆ©ç”¨volatileåœ¨å¤šçº¿ç¨‹ä¸­çš„å¯è§æ€§ï¼Œå¯ä»¥è¢«å¤šçº¿ç¨‹è¯»ï¼Œä¿è¯ä¸ä¼šè¯»åˆ°è¿‡æœŸçš„å€¼ã€‚</p>
<p>ï¼ˆ2ï¼‰put(key, value)</p>
<p>å…ˆå®šä½åˆ°segmentï¼Œç„¶ååœ¨segmenté‡Œè¿›è¡Œæ’å…¥æ“ä½œã€‚åˆ†ä¸¤æ­¥ï¼š<br>1.æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Ÿ<br>å…ˆåˆ¤æ–­HashEntryæ•°ç»„æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼Œå¦‚æœè¶…è¿‡äº†å°±æ‰©å®¹ï¼Œæ‰©å®¹ä¹‹åå†æ’å…¥æ•°æ®ã€‚è€ŒHashMapæ˜¯å…ˆæ’å…¥å†æ‰©å®¹ï¼Œè¿™æ ·ä¸å¥½ï¼Œå› ä¸ºä¸‹æ¬¡å¯èƒ½å°±æ²¡æœ‰æ•°æ®è¿›æ¥äº†ï¼Œé‚£å°±ç™½æ‰©å®¹äº†ã€‚<br>2.å¦‚ä½•æ‰©å®¹ï¼Ÿ<br>å…ˆåˆ›å»ºä¸€ä¸ªå®¹é‡æ˜¯åŸæ¥2å€çš„æ•°ç»„ï¼Œç„¶åé€šè¿‡å¯¹åŸæ•°ç»„å…ƒç´ è¿›è¡Œå†æ•£åˆ—åæ’å…¥åˆ°æ–°æ•°ç»„ã€‚æ‰©å®¹åªä¼šå¯¹æŸä¸ªsegmentè¿›è¡Œã€‚</p>
<p>ï¼ˆ3ï¼‰size()</p>
<p>Segmentä¸­æœ‰ä¸€ä¸ªå…¨å±€å˜é‡countæ˜¯ä¸€ä¸ªvolatileå˜é‡ï¼Œå¯ä»¥ç´¯åŠ å„ä¸ªsegmentçš„countæ¥è®¡ç®—å¤§å°ã€‚ä½†æ˜¯å¯èƒ½ç´¯åŠ å‰countå‘ç”Ÿäº†å˜åŒ–ï¼Œç»Ÿè®¡ç»“æœä¸å‡†ã€‚ä½†æ˜¯é”ä½æ‰€æœ‰çš„segmentå†è®¡ç®—ä¹Ÿä¸åˆé€‚ã€‚</p>
<p>åœ¨æ¯ä¸ªsegmentä¸­æœ‰ä¸€ä¸ªvolatileä¿®é¥°çš„countå±æ€§ï¼Œè¡¨ç¤ºè¿™ä¸ªsegmentä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œå…ˆé€šè¿‡2æ¬¡ä¸åŠ é”çš„æ–¹æ³•ç»Ÿè®¡æ‰€æœ‰countçš„æ€»å’Œï¼Œå¦‚æœä¸¤æ¬¡ç»“æœä¸ç›¸ç­‰ï¼Œæˆ–è€…å®¹å™¨è¢«ä¿®æ”¹è¿‡äº†ï¼Œå°±å°†SegmentåŠ é”ï¼Œå†è¿›è¡Œç¬¬ä¸‰æ¬¡ç»Ÿè®¡ã€‚</p>
<p>ConcurrentHashMapä¸­æœ‰ä¸€ä¸ªmodCountå˜é‡ï¼Œæ¯æ¬¡put\remove\cleanæ“ä½œï¼Œéƒ½ä¼šå¯¹è¿™ä¸ªå€¼åŠ ä¸€ï¼Œé€šè¿‡æ¯”è¾ƒè¿™ä¸ªå€¼ï¼Œå°±çŸ¥é“æ˜¯å¦å®¹å™¨æ˜¯å¦è¢«ä¿®æ”¹äº†ã€‚</p>
<h3 id="2-ConcurrentLinkedQueue"><a href="#2-ConcurrentLinkedQueue" class="headerlink" title="2.ConcurrentLinkedQueue"></a>2.ConcurrentLinkedQueue</h3><p>æ— ç•Œçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ã€‚</p>
<p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™éœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å¯¹åˆ—ã€‚å¦‚æœè¦å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å¯¹åˆ—æœ‰2ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ä½¿ç”¨é˜»å¡ç®—æ³•ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨éé˜»å¡ç®—æ³•ã€‚ä½¿ç”¨é˜»å¡ç®—æ³•çš„å¯¹åˆ—å¯ä»¥ç”¨ä¸€ä¸ªé”ï¼ˆå…¥é˜Ÿå’Œå‡ºé˜Ÿç”¨åŒä¸€æŠŠé”ï¼‰æˆ–ä¸¤ä¸ªé”ï¼ˆå…¥é˜Ÿå’Œå‡ºé˜Ÿç”¨ä¸åŒçš„é”ï¼‰ç­‰æ–¹å¼æ¥å®ç°ã€‚éé˜»å¡çš„å®ç°æ–¹å¼åˆ™å¯ä»¥ä½¿ç”¨å¾ªç¯CASçš„æ–¹å¼æ¥å®ç°ã€‚ã€é”ä¹Ÿæ˜¯åŸºäºCASå’Œvolatileæ¥å®ç°çš„å§ã€‘</p>
<p>ConcurrentLinkedQueueæ˜¯ä¸€ä¸ªåŸºäºé“¾æ¥èŠ‚ç‚¹çš„æ— ç•Œçº¿ç¨‹å®‰å…¨å¯¹åˆ—ï¼Œå®ƒé‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„è§„åˆ™å¯¹èŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œå½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå®ƒä¼šæ·»åŠ åˆ°å¯¹åˆ—çš„å°¾éƒ¨ï¼›å½“æˆ‘ä»¬è·å–ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä¼šè¿”å›å¯¹åˆ—å¤´éƒ¨çš„å…ƒç´ ã€‚å®ƒé‡‡ç”¨äº†â€wait-freeâ€ç®—æ³•(å³CASç®—æ³•)æ¥å®ç°ã€‚</p>
<h4 id="âœ…ConcurrentLinkedQueueçš„ç»“æ„"><a href="#âœ…ConcurrentLinkedQueueçš„ç»“æ„" class="headerlink" title="âœ…ConcurrentLinkedQueueçš„ç»“æ„"></a>âœ…ConcurrentLinkedQueueçš„ç»“æ„</h4><p>ConcurrentLinkedQueueç”±headèŠ‚ç‚¹å’ŒtailèŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ç”±èŠ‚ç‚¹å…ƒç´ (item)å’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹(next)çš„å¼•ç”¨ç»„æˆï¼ŒèŠ‚ç‚¹å’ŒèŠ‚ç‚¹ä¹‹é—´å°±æ˜¯é€šè¿‡è¿™ä¸ªnextå…³è”èµ·æ¥ï¼Œä»è€Œç»„æˆä¸€å¼ é“¾è¡¨ç»“æ„çš„å¯¹åˆ—ã€‚é»˜è®¤æƒ…å†µä¸‹headèŠ‚ç‚¹å­˜å‚¨çš„å…ƒç´ ä¸ºç©ºï¼ŒtailèŠ‚ç‚¹ç­‰äºheadèŠ‚ç‚¹ã€‚</p>
<p>ç»§æ‰¿äº†AbstractQueueï¼Œä¸æ˜¯é˜»å¡é˜Ÿåˆ—ã€‚</p>
<p>ConcurrentLinkedQueueç”±headèŠ‚ç‚¹å’ŒtailèŠ‚ç‚¹ç»„æˆã€‚headã€tailã€nextã€itemå‡ä½¿ç”¨volatileä¿®é¥°ï¼Œä¿è¯å…¶å†…å­˜å¯è§æ€§ã€‚</p>
<h4 id="âœ…å…¥é˜Ÿåˆ—-offer-E-e"><a href="#âœ…å…¥é˜Ÿåˆ—-offer-E-e" class="headerlink" title="âœ…å…¥é˜Ÿåˆ—:offer(E e)"></a>âœ…å…¥é˜Ÿåˆ—:offer(E e)</h4><p>å…¥é˜Ÿåˆ—å°±æ˜¯å°†å…¥é˜ŸèŠ‚ç‚¹æ·»åŠ åˆ°å¯¹åˆ—çš„å°¾éƒ¨ã€‚å…¥é˜Ÿä¸»è¦åšä¸¤ä»¶äº‹æƒ…ï¼š<br>ç¬¬ä¸€ï¼šæ˜¯å°†å…¥é˜ŸèŠ‚ç‚¹è®¾ç½®æˆå½“å‰é˜Ÿåˆ—å°¾èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼›<br>ç¬¬äºŒï¼šæ˜¯æ›´æ–°tailèŠ‚ç‚¹ï¼Œå¦‚æœtailèŠ‚ç‚¹çš„nextä¸ä¸ºç©ºï¼Œåˆ™å°†å…¥é˜ŸèŠ‚ç‚¹è®¾ç½®ä¸ºtialèŠ‚ç‚¹ï¼Œæˆä¸ºé˜Ÿå°¾èŠ‚ç‚¹çš„nextèŠ‚ç‚¹ï¼Œå¦‚æœtailèŠ‚ç‚¹çš„nextä¸ºç©ºï¼Œåˆ™å°†å…¥é˜ŸèŠ‚ç‚¹çš„è®¾ç½®ä¸ºtailçš„nextèŠ‚ç‚¹ã€‚æ‰€ä»¥tailèŠ‚ç‚¹ä¸æ€»æ˜¯å°¾èŠ‚ç‚¹ã€‚ã€æ•ˆæœæ˜¯ä¸¤æ ¼ä¸¤æ ¼å¾—è·³ã€‘</p>
<p>1.å®šä½å°¾èŠ‚ç‚¹<br>tailèŠ‚ç‚¹å¹¶ä¸æ€»æ˜¯å°¾èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ¯æ¬¡å…¥é˜Ÿéƒ½å¿…é¡»å…ˆé€šè¿‡tailèŠ‚ç‚¹æ¥æ‰¾åˆ°å°¾èŠ‚ç‚¹ã€‚å°¾èŠ‚ç‚¹å¯èƒ½æ˜¯tailèŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½æ˜¯tailèŠ‚ç‚¹çš„nextèŠ‚ç‚¹ã€‚</p>
<p>2.è®¾ç½®å…¥é˜ŸèŠ‚ç‚¹ä¸ºå°¾èŠ‚ç‚¹<br>p.casNext(null,n)æ–¹æ³•ç”¨äºå°†å…¥é˜ŸèŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰å¯¹å°¾èŠ‚ç‚¹çš„nextèŠ‚ç‚¹ï¼Œå¦‚æœpæ˜¯nullï¼Œè¡¨ç¤ºpæ˜¯å½“å‰èŠ‚ç‚¹çš„å°¾èŠ‚ç‚¹ï¼Œå¦‚æœä¸ä¸ºnullï¼Œè¡¨ç¤ºæœ‰å…¶å®ƒçº¿ç¨‹æ›´æ–°äº†å°¾èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦é‡æ–°è·å–å½“å‰å¯¹åˆ—çš„å°¾èŠ‚ç‚¹ã€‚</p>
<p>âš ï¸ä¸æ˜¯æ¯æ¬¡å…¥é˜Ÿéƒ½æ›´æ–°tailèŠ‚ç‚¹ï¼š<br>å¦‚æœå°†tailèŠ‚ç‚¹æ°¸è¿œä½œä¸ºå°¾èŠ‚ç‚¹ï¼Œè¿™æ ·æ¯æ¬¡éƒ½éœ€è¦å¾ªç¯CASæ›´æ–°tailèŠ‚ç‚¹ï¼Œè€Œè®¾ç½®ä¸€ä¸ªåˆ°å°¾èŠ‚ç‚¹çš„è·ç¦»ï¼Œå½“tailåˆ°å°¾èŠ‚ç‚¹çš„è·ç¦»å¤§äºæŸä¸ªå€¼ï¼ˆé€šå¸¸ä¸º1ï¼‰çš„æ—¶å€™å†æ›´æ–°tailï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ›´æ–°çš„æ¬¡æ•°ï¼Œæé«˜å…¥é˜Ÿçš„æ•ˆç‡ã€‚å®šä½å°¾èŠ‚ç‚¹æ—¶å°±éœ€è¦å¢åŠ å¯¹volatileå˜é‡è¯»æ“ä½œï¼Œä½†æ˜¯å¯¹volatileå˜é‡çš„å†™æ“ä½œå¼€é”€è¦è¿œè¿œå¤§äºè¯»æ“ä½œï¼Œæ‰€ä»¥å…¥é˜Ÿæ•ˆç‡ä¼šæœ‰æ‰€æå‡ã€‚</p>
<p><strong>å…¥é˜Ÿæ–¹æ³•æ°¸è¿œè¿”å›trueï¼Œæ‰€ä»¥ä¸è¦é€šè¿‡è¿”å›å€¼åˆ¤æ–­å…¥é˜Ÿæ˜¯å¦æˆåŠŸã€‚</strong></p>
<h4 id="âœ…å‡ºé˜Ÿåˆ—ï¼špoll"><a href="#âœ…å‡ºé˜Ÿåˆ—ï¼špoll" class="headerlink" title="âœ…å‡ºé˜Ÿåˆ—ï¼špoll()"></a>âœ…å‡ºé˜Ÿåˆ—ï¼špoll()</h4><p>ä¸æ˜¯æ¯æ¬¡å‡ºé˜Ÿéƒ½æ›´æ–°headèŠ‚ç‚¹ï¼Œå½“headä¸­æœ‰å…ƒç´ ï¼Œå°±ç›´æ¥å¼¹å‡ºheadçš„å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ ï¼Œå°±å¼¹å‡ºheadçš„nextï¼Œç„¶åæ›´æ–°headèŠ‚ç‚¹ï¼ŒheadèŠ‚ç‚¹å˜ä¸ºå¼¹å‡ºèŠ‚ç‚¹çš„nextèŠ‚ç‚¹ã€‚ã€ä¸€æ¬¡èµ°ä¸¤æ ¼ã€‘<br>ä¹Ÿæ˜¯é€šè¿‡æ§åˆ¶è·ç¦»çš„æ–¹å¼ï¼Œå‡å°‘CASæ›´æ–°èŠ‚ç‚¹çš„æ¶ˆè€—ã€‚</p>
<h3 id="3-é˜»å¡é˜Ÿåˆ—"><a href="#3-é˜»å¡é˜Ÿåˆ—" class="headerlink" title="3.é˜»å¡é˜Ÿåˆ—"></a>3.é˜»å¡é˜Ÿåˆ—</h3><p>é˜»å¡å¯¹åˆ—(BlockingQueue)æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„å¯¹åˆ—ã€‚è¿™ä¸¤ä¸ªé™„åŠ æ“ä½œæ”¯æŒé˜»å¡çš„æ’å…¥å’Œç§»é™¤æ–¹æ³•ã€‚</p>
<p>1ï¼‰æ”¯æŒé˜»å¡çš„æ’å…¥æ–¹æ³•ï¼šæ„æ€æ˜¯å½“å¯¹åˆ—æ»¡æ—¶ï¼Œå¯¹åˆ—ä¼šé˜»å¡æ’å…¥å…ƒç´ çš„çº¿ç¨‹ï¼Œç›´åˆ°å¯¹åˆ—ä¸æ»¡ã€‚<br>2ï¼‰æ”¯æŒé˜»å¡çš„ç§»é™¤æ–¹æ³•ï¼šæ„æ€æ˜¯å½“å¯¹åˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…å¯¹åˆ—ä¸ä¸ºç©ºã€‚</p>
<p>é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å‘å¯¹åˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œå–å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…ç”¨æ¥å­˜æ”¾å…ƒç´ ï¼Œæ¶ˆè´¹è€…ç”¨æ¥è·å–å…ƒç´ çš„å®¹å™¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--------------------æ’å…¥å’Œç§»é™¤æ“ä½œçš„4ç§å¤„ç†æ–¹å¼--------------</span><br><span class="line"></span><br><span class="line">æ–¹æ³•/å¤„ç†æ–¹å¼    æŠ›å‡ºå¼‚å¸¸    è¿”å›ç‰¹æ®Šå€¼    ä¸€ç›´é˜»å¡    è¶…æ—¶é€€å‡º</span><br><span class="line">æ’å…¥æ–¹æ³•        add(e)     offer(e)     put(e)      offer(e,time,unit)</span><br><span class="line">ç§»é™¤æ–¹æ³•       remove()    poll()       take()     poll(time,unit)</span><br><span class="line">æ£€æŸ¥æ–¹æ³•      element()    peek()       ä¸å¯ç”¨      ä¸å¯ç”¨</span><br><span class="line"></span><br><span class="line">1ï¼‰æŠ›å‡ºå¼‚å¸¸ï¼šå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå¦‚æœå†å¾€å¯¹åˆ—é‡Œæ’å…¥å…ƒç´ ï¼Œä¼šæŠ›å‡ºIllegalStateException(&quot;Queue full&quot;)å¼‚å¸¸ã€‚å½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ ä¼šæŠ›å‡ºNoSuchElementExceptionå¼‚å¸¸ã€‚</span><br><span class="line">2ï¼‰è¿”å›ç‰¹æ®Šå€¼ï¼šå½“å¾€é˜Ÿåˆ—æ’å…¥å…ƒç´ æ—¶ï¼Œä¼šè¿”å›å…ƒç´ æ˜¯å¦æ’å…¥æˆåŠŸï¼ŒæˆåŠŸè¿”å›trueã€‚å¦‚æœæ˜¯ç§»é™¤æ–¹æ³•ï¼Œåˆ™æ˜¯ä»é˜Ÿåˆ—é‡Œå–å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰è¿”å›nullã€‚</span><br><span class="line">3ï¼‰ä¸€ç›´é˜»å¡ï¼šå½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå¦‚æœç”Ÿäº§è€…çº¿ç¨‹å¾€é˜Ÿåˆ—é‡Œputå…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ï¼Œç›´åˆ°å¯¹åˆ—å¯ç”¨æˆ–è€…å“åº”ä¸­æ–­é€€å‡ºã€‚å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå¦‚æœæ¶ˆè´¹è€…çº¿ç¨‹ä»é˜Ÿåˆ—é‡Œtakeå…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡ä½æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ä¸ºç©ºã€‚</span><br><span class="line">4ï¼‰è¶…æ—¶é€€å‡ºï¼šå½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå¦‚æœç”Ÿäº§è€…çº¿ç¨‹å¾€é˜Ÿåˆ—é‡Œæ’å…¥å…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœè¶…è¿‡äº†æŒ‡å®šçš„æ—¶é—´ï¼Œç”Ÿäº§è€…çº¿ç¨‹å°±ä¼šé€€å‡ºã€‚</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸å¯èƒ½å‡ºç°æ»¡çš„æƒ…å†µï¼Œå²æœˆä½¿ç”¨putå’Œofferæ°¸è¿œä¸ä¼šè¢«é˜»å¡ï¼Œè€Œä¸”ä½¿ç”¨offeræ–¹æ³•æ—¶ï¼Œæ€»è¿”å›trueã€‚</p>
<h4 id="âœ…javaæä¾›çš„å‡ ç§é˜»å¡é˜Ÿåˆ—"><a href="#âœ…javaæä¾›çš„å‡ ç§é˜»å¡é˜Ÿåˆ—" class="headerlink" title="âœ…javaæä¾›çš„å‡ ç§é˜»å¡é˜Ÿåˆ—"></a>âœ…javaæä¾›çš„å‡ ç§é˜»å¡é˜Ÿåˆ—</h4><p>ArrayBlockingQueue:    ä¸€ä¸ªç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ArrayBlockingQueueæ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</span><br><span class="line">æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡º(FIFO)çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</span><br><span class="line">é»˜è®¤æƒ…å†µä¸‹ä¸ä¿è¯çº¿ç¨‹å…¬å¹³çš„è®¿é—®é˜Ÿï¼Œå³ä¸ä¿è¯å…ˆé˜»å¡çº¿ç¨‹å…ˆè®¿é—®é˜Ÿåˆ—ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœæƒ³ä¿è¯å…¬å¹³æ€§ï¼Œå¯ä»¥ç”¨å¯é‡å…¥é”æ¥å®ç°</span><br><span class="line">ArrayBlockingQueue fairQueue = new ArrayBlockingQueue&lt;&gt;(1000, true);</span><br><span class="line">public ArrayBlockingQueue(int capacity, boolean fair) &#123;</span><br><span class="line">    if (capacity &lt;= 0)</span><br><span class="line">        throw new IllegalArgumentException();</span><br><span class="line">    this.items = new Object[capacity];</span><br><span class="line">    lock = new ReentrantLock(fair);</span><br><span class="line">    notEmpty = lock.newCondition();</span><br><span class="line">    notFull =  lock.newCondition();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LinkedBlockingQueue:    ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LinkedBlockingQueueæ˜¯ä¸€ä¸ªç”¨é“¾è¡¨å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</span><br><span class="line">æ­¤é˜Ÿåˆ—çš„é»˜è®¤å’Œæœ€å¤§é•¿åº¦ä¸ºInter.MAX_VALUEã€‚</span><br><span class="line">æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</span><br></pre></td></tr></table></figure>

<p>PriorityBlockingQueue:    ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PriorityBlockingQueueæ˜¯ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</span><br><span class="line">é»˜è®¤æƒ…å†µä¸‹å…ƒç´ é‡‡å–è‡ªç„¶é¡ºåºå‡åºæ’åˆ—ã€‚</span><br><span class="line">ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®ç°compareTo()æ–¹æ³•æ¥æŒ‡å®šå…ƒç´ æ’åºè§„åˆ™ï¼Œ</span><br><span class="line">æˆ–è€…åˆå§‹åŒ–PriorityBlockingQueueæ—¶ï¼ŒæŒ‡å®šæ„é€ å‚æ•°(Comparator)æ¥å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</span><br><span class="line">éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½ä¿è¯åŒä¼˜å…ˆçº§å…ƒç´ çš„æ’åºã€‚</span><br></pre></td></tr></table></figure>

<p>DelayQueue:    ä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DelayQueueæ˜¯ä¸€ä¸ªæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—.</span><br><span class="line">é˜Ÿåˆ—ä½¿ç”¨PriorityQueueæ¥å®ç°ã€‚</span><br><span class="line">é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç°Delayedæ¥å£ï¼Œåœ¨åˆ›å»ºå…ƒç´ æ—¶å¯ä»¥æŒ‡å®šå¤šä¹…ï¼ˆå…ƒç´ å­˜åœ¨äº†å¤šä¹…ï¼‰æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–å½“å‰å…ƒç´ ã€‚</span><br><span class="line">åªæœ‰åœ¨å»¶è¿ŸæœŸæ»¡æ—¶æ‰èƒ½ä»é˜Ÿåˆ—é‡Œæå–å…ƒç´ ã€‚</span><br><span class="line"></span><br><span class="line">åº”ç”¨åœºæ™¯ï¼š</span><br><span class="line">1ï¼‰ç¼“å­˜ç³»ç»Ÿçš„è®¾è®¡ï¼šå¯ä»¥ç”¨DelayQueueä¿å­˜ç¼“å­˜å…ƒç´ çš„æœ‰æ•ˆæœŸï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å¾ªç¯æŸ¥è¯¢DelayQueueï¼Œä¸€æ—¦èƒ½ä»DelayQueueè·å–å…ƒç´ æ—¶ï¼Œè¡¨ç¤ºç¼“å­˜æœ‰æ•ˆæœŸåˆ°äº†ã€‚</span><br><span class="line">2ï¼‰å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼šä½¿ç”¨DelayQueueä¿å­˜å½“å¤©å°†ä¼šæ‰§è¡Œçš„ä»»åŠ¡å’Œæ‰§è¡Œæ—¶é—´ï¼Œä¸€æ—¦ä»DelayQueueä¸­è·å–åˆ°ä»»åŠ¡å°±å¼€å§‹æ‰§è¡Œï¼Œæ¯”å¦‚TimeQueueå°±æ˜¯ä½¿ç”¨DelayQueueå®ç°çš„ã€‚</span><br><span class="line"></span><br><span class="line">a.å¦‚ä½•å®ç°Delayedæ¥å£</span><br><span class="line">DelayQueueé˜Ÿåˆ—çš„å…ƒç´ å¿…é¡»å®ç°Delayedæ¥å£ã€‚æˆ‘ä»¬å¯ä»¥å‚è€ƒScheduledThreadPoolExecutoré‡ŒScheduledFutureTaskç±»çš„å®ç°ï¼Œä¸€å…±æœ‰ä¸‰æ­¥ã€‚</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€æ­¥ï¼šåœ¨å¯¹è±¡åˆ›å»ºçš„æ—¶å€™ï¼Œåˆå§‹åŒ–åŸºæœ¬æ•°æ®ã€‚ä½¿ç”¨timeè®°å½•å½“å‰å¯¹è±¡å»¶è¿Ÿåˆ°ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨ï¼Œä½¿ç”¨sequenceNumberæ¥æ ‡è¯†å…ƒç´ åœ¨é˜Ÿåˆ—ä¸­çš„å…ˆåé¡ºåºã€‚</span><br><span class="line"></span><br><span class="line">private static final AtomicLong sequencer = new AtomicLong(0);</span><br><span class="line">private class ScheduledFutureTask&lt;V&gt; extends FutureTask&lt;V&gt; implements RunnableScheduledFuture&lt;V&gt; &#123;</span><br><span class="line">ScheduledFutureTask(Runnable r, V result, long ns) &#123;</span><br><span class="line">    super(r, result);</span><br><span class="line">    this.time = ns;</span><br><span class="line">    this.period = 0;</span><br><span class="line">    this.sequenceNumber = sequencer.getAndIncrement();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒæ­¥ï¼šå®ç°getDelayæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›å½“å‰å…ƒç´ è¿˜éœ€è¦å»¶æ—¶å¤šé•¿æ—¶é—´ï¼Œå•ä½æ˜¯çº³ç§’</span><br><span class="line"></span><br><span class="line">public long getDelay(TimeUnit unit) &#123;</span><br><span class="line">    return unit.convert(time - now(), TimeUnit.NANOSECONDS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸‰æ­¥ï¼šå®ç°compareTo()æ–¹æ³•æ¥æŒ‡å®šå…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œè®©å»¶æ—¶æ—¶é—´æœ€é•¿çš„æ”¾åœ¨é˜Ÿåˆ—çš„æœ«å°¾ã€‚</span><br><span class="line"></span><br><span class="line">public int compareTo(Delayed other) &#123;</span><br><span class="line">    if (other == this) // compare zero ONLY if same object</span><br><span class="line">        return 0;</span><br><span class="line">    if (other instanceof ScheduledFutureTask) &#123;</span><br><span class="line">        ScheduledFutureTask&lt;?&gt; x = (ScheduledFutureTask&lt;?&gt;)other;</span><br><span class="line">        long diff = time - x.time;</span><br><span class="line">        if (diff &lt; 0)</span><br><span class="line">            return -1;</span><br><span class="line">        else if (diff &gt; 0)</span><br><span class="line">            return 1;</span><br><span class="line">        else if (sequenceNumber &lt; x.sequenceNumber)</span><br><span class="line">            return -1;</span><br><span class="line">        else</span><br><span class="line">            return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    long d = (getDelay(TimeUnit.NANOSECONDS) -</span><br><span class="line">            other.getDelay(TimeUnit.NANOSECONDS));</span><br><span class="line">    return (d == 0) ? 0 : ((d &lt; 0) ? -1 : 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b. å¦‚ä½•å®ç°å»¶æ—¶é˜»å¡é˜Ÿåˆ—</span><br><span class="line">å»¶æ—¶é˜»å¡é˜Ÿåˆ—çš„å®ç°å¾ˆç®€å•ï¼Œå½“æ¶ˆè´¹è€…ä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ æ—¶ï¼Œå¦‚æœå…ƒç´ æ²¡æœ‰è¾¾åˆ°å»¶æ—¶æ—¶é—´ï¼Œå°±é˜»å¡å½“å‰çº¿ç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">public RunnableScheduledFuture take() throws InterruptedException &#123;</span><br><span class="line">    final ReentrantLock lock = this.lock;</span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">    try &#123;</span><br><span class="line">        for (;;) &#123;</span><br><span class="line">            RunnableScheduledFuture first = queue[0];</span><br><span class="line">            if (first == null)</span><br><span class="line">                available.await();</span><br><span class="line">            else &#123;</span><br><span class="line">                long delay = first.getDelay(TimeUnit.NANOSECONDS);</span><br><span class="line">                if (delay &lt;= 0)</span><br><span class="line">                    return finishPoll(first);</span><br><span class="line">                else if (leader != null)</span><br><span class="line">                    available.await();</span><br><span class="line">                else &#123;</span><br><span class="line">                    Thread thisThread = Thread.currentThread();</span><br><span class="line">                    leader = thisThread;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        available.awaitNanos(delay);</span><br><span class="line">                    &#125; finally &#123;</span><br><span class="line">                        if (leader == thisThread)</span><br><span class="line">                            leader = null;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        if (leader == null &amp;&amp; queue[0] != null)</span><br><span class="line">            available.signal();</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ä»£ç ä¸­çš„å˜é‡leaderæ˜¯ä¸€ä¸ªç­‰å¾…è·å–é˜Ÿåˆ—å¤´éƒ¨å…ƒç´ çš„çº¿ç¨‹ã€‚</span><br><span class="line">å¦‚æœleaderä¸ç­‰äºç©ºï¼Œè¡¨ç¤ºå·²ç»æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è·å–é˜Ÿåˆ—çš„å¤´å…ƒç´ ã€‚</span><br><span class="line">æ‰€ä»¥ï¼Œä½¿ç”¨await()æ–¹æ³•è®©å½“å‰çº¿ç¨‹ç­‰å¾…ä¿¡å·ã€‚</span><br><span class="line">å¦‚æœleaderç­‰äºç©ºï¼Œåˆ™æŠŠå½“å‰çº¿ç¨‹è®¾ç½®æˆleaderï¼Œå¹¶ä½¿ç”¨awaitNanos()æ–¹æ³•è®©å½“å‰çº¿ç¨‹ç­‰å¾…æ¥æ”¶ä¿¡å·æˆ–ç­‰å¾…delayæ—¶é—´ã€‚</span><br></pre></td></tr></table></figure>

<p>SynchronousQueue:    ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SynchronousQueueæ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸€ä¸ªputæ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œå¦åˆ™ä¸èƒ½ç»§ç»­æ·»åŠ å…ƒç´ ã€‚</span><br><span class="line">å®ƒæ”¯æŒå…¬å¹³è®¿é—®é˜Ÿåˆ—.</span><br><span class="line">é»˜è®¤æƒ…å†µä¸‹çº¿ç¨‹é‡‡ç”¨éå…¬å¹³æ€§ç­–ç•¥è®¿é—®é˜Ÿåˆ—ã€‚åˆ›å»ºå…¬å¹³æ€§è®¿é—®çš„SynchronousQueueï¼Œå¦‚æœè®¾ç½®trueï¼Œåˆ™ç­‰å¾…çš„çº¿ç¨‹ä¼šé‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„é¡ºåºè®¿é—®é˜Ÿåˆ—ã€‚</span><br><span class="line">è´Ÿè´£æŠŠç”Ÿäº§è€…çº¿ç¨‹å¤„ç†çš„æ•°æ®ç›´æ¥ä¼ é€’ç»™æ¶ˆè´¹è€…çº¿ç¨‹ã€‚</span><br><span class="line">é˜Ÿåˆ—æœ¬èº«å¹¶ä¸å­˜å‚¨ä»»ä½•å…ƒç´ ï¼Œéå¸¸é€‚åˆä¼ é€’æ€§åœºæ™¯ã€‚</span><br><span class="line">SynchronousQueueçš„ååé‡é«˜äºLinkedBlockingQueueå’ŒArrayBlockingQueueã€‚</span><br><span class="line">æœ‰ç‚¹åƒgoçš„channel</span><br></pre></td></tr></table></figure>

<p>LinkedTransferQueue:    ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LinkedTransferQueueæ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—ã€‚</span><br><span class="line">ç›¸å¯¹äºå…¶å®ƒé˜»å¡é˜Ÿåˆ—ï¼ŒlinkedTransferQueueå¤šäº†tryTransferå’Œtransferæ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰transferæ–¹æ³•</span><br><span class="line">å¦‚æœå½“å‰æœ‰æ¶ˆè´¹è€…æ­£åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ (æ¶ˆè´¹è€…ä½¿ç”¨take()æ–¹æ³•æˆ–å¸¦æœ‰æ—¶é—´é™åˆ¶çš„poll()æ–¹æ³•æ—¶)ï¼Œ</span><br><span class="line">transferæ–¹æ³•å¯ä»¥æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç«‹åˆ»transfer(ä¼ è¾“)ç»™æ¶ˆè´¹è€…ã€‚</span><br><span class="line">å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œtransferæ–¹æ³•ä¼šå°†å…ƒç´ å­˜æ”¾åœ¨é˜Ÿåˆ—çš„tailèŠ‚ç‚¹ï¼Œå¹¶ç­‰åˆ°è¯¥å…ƒç´ è¢«æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚</span><br><span class="line">ä¼šè®©CPUè‡ªæ—‹ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹å…ƒç´ ã€‚</span><br><span class="line">å› ä¸ºè‡ªæ—‹ä¼šæ¶ˆè€—CPUï¼Œæ‰€ä»¥è‡ªæ—‹ä¸€å®šçš„æ¬¡æ•°åä½¿ç”¨Thread.yield()æ–¹æ³•æ¥æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå…¶å®ƒçº¿ç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">ï¼ˆ2ï¼‰tryTransferæ–¹æ³•</span><br><span class="line">tryTransferæ–¹æ³•æ˜¯ç”¨æ¥è¯•æ¢ç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ æ˜¯å¦èƒ½ç›´æ¥ä¼ é€’ç»™æ¶ˆè´¹è€…ã€‚</span><br><span class="line">å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œåˆ™è¿”å›falseã€‚</span><br><span class="line">å’Œtransferæ–¹æ³•çš„åŒºåˆ«æ˜¯tryTransferæ–¹æ³•æ— è®ºæ¶ˆè´¹è€…æ˜¯å¦æ¥æ”¶ï¼Œæ–¹æ³•ç«‹å³è¿”å›ï¼Œ</span><br><span class="line">è€Œtransferæ–¹æ³•æ˜¯å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚</span><br><span class="line"></span><br><span class="line">å¯¹äºå¸¦æœ‰æ—¶é—´é™åˆ¶çš„tryTransfer(E e,long timeout,TimeUnit unit)æ–¹æ³•ï¼Œ</span><br><span class="line">è¯•å›¾æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥å…ƒç´ åˆ™ç­‰å¾…æŒ‡å®šçš„æ—¶é—´å†è¿”å›ã€‚</span><br><span class="line">å¦‚æœè¶…æ—¶è¿˜æ²¡æœ‰æ¶ˆè´¹å…ƒç´ ï¼Œåˆ™è¿”å›falseï¼Œå¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ¶ˆè´¹äº†å…ƒç´ ï¼Œåˆ™è¿”å›true.</span><br></pre></td></tr></table></figure>

<p>LinkedBlockingDeque:    ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LinkedBlockingDequeæ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚</span><br><span class="line">æ‰€è°“åŒå‘é˜Ÿåˆ—æŒ‡çš„æ˜¯å¯ä»¥ä»é˜Ÿåˆ—çš„ä¸¤ç«¯æ’å…¥å’Œç§»å‡ºå…ƒç´ ã€‚</span><br><span class="line">åŒå‘é˜Ÿåˆ—å› ä¸ºå¤šäº†ä¸ªæ“ä½œé˜Ÿåˆ—çš„å…¥å£ï¼Œåœ¨å¤šçº¿ç¨‹åŒæ—¶å…¥é˜Ÿæ—¶ï¼Œä¹Ÿå°±å‡å°‘äº†ä¸€åŠçš„ç«äº‰ã€‚</span><br><span class="line">ç›¸æ¯”å…¶å®ƒçš„é˜»å¡é˜Ÿåˆ—ï¼ŒLinkedBlockingDequeå¤šäº†addFirst,addLast,offerFirst,offerLast,peekFirstå’ŒpeekLastç­‰æ–¹æ³•ï¼Œ</span><br><span class="line">ä»¥Firstå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–(peek)æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</span><br><span class="line">ä»¥Lastå•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</span><br><span class="line">å¦å¤–ï¼Œæ’å…¥æ–¹æ³•addç­‰åŒäºaddLastï¼Œç§»é™¤æ–¹æ³•removeç­‰æ•ˆäºremoveFirstã€‚ä½†æ˜¯takeæ–¹æ³•å´ç­‰åŒäºtakeFirst.</span><br><span class="line"></span><br><span class="line">åœ¨åˆå§‹åŒ–LinkedBlockingDequeæ—¶å¯ä»¥è®¾ç½®å®¹é‡é˜²æ­¢å…¶è¿‡åº¦è†¨èƒ€ã€‚å¦å¤–åŒå‘é˜»å¡é˜Ÿåˆ—å¯ä»¥è¿ç”¨åœ¨&quot;å·¥ä½œçªƒå–&quot;æ¨¡å¼ä¸­ã€‚</span><br></pre></td></tr></table></figure>

<h4 id="âœ…é˜»å¡é˜Ÿåˆ—çš„å®ç°åŸç†"><a href="#âœ…é˜»å¡é˜Ÿåˆ—çš„å®ç°åŸç†" class="headerlink" title="âœ…é˜»å¡é˜Ÿåˆ—çš„å®ç°åŸç†"></a>âœ…é˜»å¡é˜Ÿåˆ—çš„å®ç°åŸç†</h4><p>ä½¿ç”¨é€šçŸ¥æ¨¡å¼å®ç°ã€‚æ‰€è°“é€šçŸ¥æ¨¡å¼ï¼Œå°±æ˜¯å½“ç”Ÿäº§è€…å¾€æ»¡çš„é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ æ—¶ä¼šé˜»å¡ä½ç”Ÿäº§è€…ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹äº†ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„å…ƒç´ åï¼Œä¼šé€šçŸ¥ç”Ÿäº§è€…å½“å‰é˜Ÿåˆ—å¯ç”¨ã€‚é€šè¿‡æŸ¥çœ‹JDKæºä»£ç å‘ç°ArrayBlockingQueueä½¿ç”¨äº†Conditionæ¥å®ç°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">notEmpty = lock.newCondition();</span><br><span class="line">notFull = lock.newChonditon();</span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœé˜Ÿåˆ—æ»¡ï¼šæ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œé€šè¿‡è°ƒç”¨notFull.await()é˜»å¡å½“å‰çº¿ç¨‹ï¼›ç§»é™¤å…ƒç´ é¢æ—¶å€™ï¼Œç”¨notFull.signal()å”¤é†’åœ¨notFullä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚</li>
<li>å¦‚æœé˜Ÿåˆ—ç©ºï¼šè¯»å–å…ƒç´ çš„æ—¶å€™ï¼Œé€šè¿‡notEmpty.await()é˜»å¡å½“å‰çº¿ç¨‹ï¼›å½“æ·»åŠ å…ƒç´ æ—¶ï¼Œè°ƒç”¨notEmpty.signal()å”¤é†’åœ¨notEmptyä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚</li>
</ul>
<p>é˜»å¡ç”Ÿäº§è€…await()ä¸»è¦é€šè¿‡LockSupport.park(this)æ¥å®ç°ã€‚å…¶ä¸­ï¼Œé¦–å…ˆè°ƒç”¨setBlockerå…ˆä¿å­˜ä¸€ä¸‹å°†è¦é˜»å¡çš„çº¿ç¨‹ï¼Œç„¶åè°ƒç”¨unsafe.parké˜»å¡å½“å‰çº¿ç¨‹ã€‚</p>
<h3 id="4-Fork-Joinæ¡†æ¶"><a href="#4-Fork-Joinæ¡†æ¶" class="headerlink" title="4.Fork&#x2F;Joinæ¡†æ¶"></a>4.Fork&#x2F;Joinæ¡†æ¶</h3><p>Fork&#x2F;Joinæ¡†æ¶æ˜¯Java 7 æä¾›çš„ä¸€ä¸ªç”¨äºå¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªæŠŠå¤§ä»»åŠ¡åˆ†å‰²æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼Œæœ€ç»ˆæ±‡æ€»æ¯ä¸ªå°ä»»åŠ¡ç»“æœåå¾—åˆ°å¤§ä»»åŠ¡ç»“æœçš„æ¡†æ¶ã€‚</p>
<h4 id="âœ…å·¥ä½œçªƒå–-work-stealing-ç®—æ³•"><a href="#âœ…å·¥ä½œçªƒå–-work-stealing-ç®—æ³•" class="headerlink" title="âœ…å·¥ä½œçªƒå–(work-stealing)ç®—æ³•"></a>âœ…å·¥ä½œçªƒå–(work-stealing)ç®—æ³•</h4><p>å·¥ä½œçªƒå–(work-stealing)ç®—æ³•æ˜¯æŒ‡æŸä¸ªçº¿ç¨‹ä»å…¶ä»–é˜Ÿåˆ—é‡Œçªƒå–ä»»åŠ¡æ¥æ‰§è¡Œã€‚</p>
<p>åšä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä»»åŠ¡ï¼Œå¯ä»¥æŠŠè¿™ä¸ªä»»åŠ¡åˆ†å‰²æˆè‹¥å¹²äº’ä¸ä¾èµ–çš„å­ä»»åŠ¡ï¼Œä¸ºäº†å‡å°‘çº¿ç¨‹é—´çš„ç«äº‰ï¼ŒæŠŠè¿™äº›å­ä»»åŠ¡åˆ†åˆ«æ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—é‡Œï¼Œå¹¶ä¸ºæ¯ä¸ªé˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œçº¿ç¨‹å’Œé˜Ÿåˆ—ä¸€ä¸€å¯¹åº”ã€‚<br>æ¯”å¦‚Açº¿ç¨‹è´Ÿè´£å¤„ç†Aé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œæœ‰çš„çº¿ç¨‹ä¼šæŠŠè‡ªå·±é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡å¹²å®Œï¼Œè€Œå…¶å®ƒçº¿ç¨‹å¯¹åº”çš„é˜Ÿåˆ—é‡Œè¿˜æœ‰ä»»åŠ¡ç­‰å¾…å¤„ç†ã€‚å¹²å®Œæ´»çš„çº¿ç¨‹ä¸å…¶ç­‰ç€ï¼Œä¸å¦‚å»å¸®å…¶ä»–çº¿ç¨‹å¹²æ´»ï¼Œäºæ˜¯å®ƒå°±å»å…¶ä»–çº¿ç¨‹é˜Ÿåˆ—é‡Œçªƒå–ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚è€Œåœ¨è¿™æ—¶å®ƒä»¬ä¼šè®¿é—®åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¸ºäº†å‡å°‘çªƒå–ä»»åŠ¡çº¿ç¨‹å’Œè¢«çªƒå–ä»»åŠ¡çº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œé€šå¸¸ä½¿ç”¨åŒç«¯é˜Ÿåˆ—ï¼Œè¢«çªƒå–ä»»åŠ¡çº¿ç¨‹æ°¸è¿œä»åŒç«¯é˜Ÿåˆ—å¤´éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œï¼Œè€Œçªƒå–ä»»åŠ¡çš„çº¿ç¨‹æ°¸è¿œä»åŒé˜Ÿåˆ—çš„å°¾éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œã€‚</p>
<p>å·¥ä½œçªƒå–ç®—æ³•çš„ä¼˜ç‚¹ï¼šå……åˆ†åˆ©ç”¨çº¿ç¨‹è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå‡å°‘äº†çº¿ç¨‹é—´çš„ç«äº‰ã€‚</p>
<p>å·¥ä½œçªƒå–ç®—æ³•çš„ç¼ºç‚¹ï¼šåœ¨æŸäº›æƒ…å†µä¸‹è¿˜æ˜¯å­˜åœ¨ç«äº‰ï¼Œæ¯”å¦‚åŒç«¯é˜Ÿåˆ—é‡Œåªæœ‰ä¸€ä¸ªä»»åŠ¡æ—¶ã€‚å¹¶ä¸”è¯¥ç®—æ³•ä¼šæ¶ˆè€—äº†æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚åˆ›å»ºå¤šä¸ªçº¿ç¨‹å’Œå¤šä¸ªåŒç«¯é˜Ÿåˆ—ã€‚</p>
<h4 id="âœ…Fork-Joinæ¡†æ¶çš„è®¾è®¡"><a href="#âœ…Fork-Joinæ¡†æ¶çš„è®¾è®¡" class="headerlink" title="âœ…Fork&#x2F;Joinæ¡†æ¶çš„è®¾è®¡"></a>âœ…Fork&#x2F;Joinæ¡†æ¶çš„è®¾è®¡</h4><p>æ­¥éª¤1ï¼šåˆ†å‰²ä»»åŠ¡ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªforkç±»æ¥æŠŠå¤§ä»»åŠ¡åˆ†å‰²æˆå­ä»»åŠ¡ï¼Œæœ‰å¯èƒ½å­ä»»åŠ¡è¿˜æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸åœåœ°åˆ†å‰²ï¼Œç›´åˆ°åˆ†å‰²å‡ºçš„å­ä»»åŠ¡è¶³å¤Ÿå°ã€‚</p>
<p>æ­¥éª¤2ï¼šæ‰§è¡Œä»»åŠ¡å¹¶åˆå¹¶ç»“æœã€‚åˆ†å‰²çš„å­ä»»åŠ¡åˆ†åˆ«æ”¾åœ¨åŒç«¯é˜Ÿåˆ—ï¼Œç„¶åå‡ ä¸ªå¯åŠ¨çº¿ç¨‹åˆ†åˆ«ä»åŒç«¯é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡æ‰§è¡Œã€‚å­ä»»åŠ¡æ‰§è¡Œå®Œçš„ç»“æœéƒ½ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä»é˜Ÿåˆ—é‡Œæ‹¿æ•°æ®ï¼Œç„¶ååˆå¹¶è¿™äº›æ•°æ®ã€‚</p>
<p>Fork&#x2F;Joinä½¿ç”¨ä¸¤ä¸ªç±»æ¥å®Œæˆä»¥ä¸Šä¸¤ä¸ªäº‹æƒ…ï¼š</p>
<p>1)ForkJoinTaskï¼šæˆ‘ä»¬è¦ä½¿ç”¨ForkJoinæ¡†æ¶ï¼Œå¿…é¡»é¦–å…ˆåˆ›å»ºä¸€ä¸ªForkJoinä»»åŠ¡ã€‚å®ƒæä¾›åœ¨ä»»åŠ¡ä¸­æ‰§è¡Œfork()å’Œjoin()æ“ä½œçš„æœºåˆ¶ã€‚<br>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç›´æ¥ç»§æ‰¿ForkJoinTaskç±»ï¼Œåªéœ€è¦ç»§æ‰¿å®ƒçš„å­ç±»ï¼ŒFork&#x2F;Joinæ¡†æ¶æä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªå­ç±»ã€‚<br>a.RecursiveAction: ç”¨äºæ²¡æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚<br>b.RecursiveTask:ç”¨äºæœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</p>
<p>2ï¼‰ForkJoinPoolï¼šForkJoinTaskéœ€è¦é€šè¿‡ForkJoinPoolæ¥æ‰§è¡Œã€‚</p>
<p>ä»»åŠ¡åˆ†å‰²å‡ºçš„å­ä»»åŠ¡ä¼šæ·»åŠ åˆ°å½“å‰å·¥ä½œçº¿ç¨‹æ‰€ç»´æŠ¤çš„åŒç«¯é˜Ÿåˆ—ä¸­ï¼Œè¿›å…¥é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚å½“ä¸€ä¸ªå·¥ä½œçº¿ç¨‹çš„é˜Ÿåˆ—é‡Œæš‚æ—¶æ²¡æœ‰ä»»åŠ¡æ—¶ï¼Œå®ƒä¼šéšæœºä»å…¶ä»–å·¥ä½œçº¿ç¨‹é˜Ÿåˆ—çš„å°¾éƒ¨è·å–ä¸€ä¸ªä»»åŠ¡ã€‚</p>
<h4 id="âœ…ä½¿ç”¨Fork-Joinçš„ä¾‹å­"><a href="#âœ…ä½¿ç”¨Fork-Joinçš„ä¾‹å­" class="headerlink" title="âœ…ä½¿ç”¨Fork&#x2F;Joinçš„ä¾‹å­"></a>âœ…ä½¿ç”¨Fork&#x2F;Joinçš„ä¾‹å­</h4><p>è®¡ç®—1+2+3+4çš„ç»“æœï¼š</p>
<p>1.å¦‚ä½•forkï¼šè®¾ç½®åˆ†å‰²çš„é˜ˆå€¼æ˜¯2ï¼Œç”±äºæ˜¯4ä¸ªæ•°å­—ç›¸åŠ ï¼Œæ‰€ä»¥Fork&#x2F;Joinæ¡†æ¶ä¼šæŠŠè¿™ä¸ªä»»åŠ¡forkæˆä¸¤ä¸ªå­ä»»åŠ¡</p>
<p>2.å¦‚ä½•joinï¼šjoinä¸¤ä¸ªå­ä»»åŠ¡çš„ç»“æœã€‚å› ä¸ºæ˜¯æœ‰ç»“æœçš„ä»»åŠ¡ï¼Œå› æ­¤å¿…é¡»ç»§æ‰¿RecursiveTask</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class CountTask extends RecursiveTask&lt;Integer&gt;&#123;</span><br><span class="line"> </span><br><span class="line">    private static final int THRESHOLD = 2;//é˜ˆå€¼</span><br><span class="line"> </span><br><span class="line">    private int start;</span><br><span class="line"> </span><br><span class="line">    private int end;</span><br><span class="line"> </span><br><span class="line">    public CountTask(int start,int end)&#123;</span><br><span class="line">        this.start = start;</span><br><span class="line">        this.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    protected Integer compute() &#123;</span><br><span class="line">        int sum = 0;</span><br><span class="line">        // å¦‚æœä»»åŠ¡è¶³å¤Ÿå°å°±è®¡ç®—ä»»åŠ¡</span><br><span class="line">        boolean canCompute = (end - start) &lt;= THRESHOLD;</span><br><span class="line">        if (canCompute)&#123;</span><br><span class="line">            for (int i=start;i&lt;=end;i++)&#123;</span><br><span class="line">                sum += i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            // å¦‚æœä»»åŠ¡å¤§äºé˜ˆå€¼ï¼Œå°±åˆ†è£‚æˆä¸¤ä¸ªå­ä»»åŠ¡è®¡ç®—</span><br><span class="line">            int middle = (start + end)/2;</span><br><span class="line">            CountTask leftTask = new CountTask(start,middle);</span><br><span class="line">            CountTask rightTask = new CountTask(middle+1,end);</span><br><span class="line"> </span><br><span class="line">            // æ‰§è¡Œå­ä»»åŠ¡</span><br><span class="line">            leftTask.fork();</span><br><span class="line">            rightTask.fork();</span><br><span class="line"> </span><br><span class="line">            // ç­‰å¾…å­ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå¹¶å¾—åˆ°ç»“æœ</span><br><span class="line">            int leftResult = leftTask.join();</span><br><span class="line">            int rightResult = rightTask.join();</span><br><span class="line"> </span><br><span class="line">            // åˆå¹¶å­ä»»åŠ¡</span><br><span class="line">            sum = leftResult + rightResult;</span><br><span class="line">        &#125;</span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        ForkJoinPool forkJoinPool = new ForkJoinPool();</span><br><span class="line">        // ç”Ÿæˆä¸€ä¸ªè®¡ç®—ä»»åŠ¡ï¼Œè´Ÿè´£è®¡ç®— 1+2+3+4</span><br><span class="line">        CountTask task = new CountTask(1,4);</span><br><span class="line">        // æ‰§è¡Œä¸€ä¸ªä»»åŠ¡</span><br><span class="line">        Future&lt;Integer&gt; result = forkJoinPool.submit(task);</span><br><span class="line">        try &#123;</span><br><span class="line">            System.out.println(&quot;é­”æ³•é©çš„æ—¥å¿—ä¿¡æ¯ï¼š----&gt;&quot;+ result.get());</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forkæ–¹æ³•æ˜¯æ‰§è¡Œï¼Œjoinæ–¹æ³•æ˜¯ç­‰å¾…æ‰§è¡Œå®Œè·å–è¿è¡Œç»“æœã€‚éœ€è¦å®ç°computeræ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œçœ‹æ€ä¹ˆæ‹†åˆ†ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡åœ¨è°ƒç”¨forkæ–¹æ³•æ—¶ï¼Œåˆä¼šè¿›å…¥computeæ–¹æ³•ï¼Œçœ‹çœ‹å½“å‰å­ä»»åŠ¡æ˜¯å¦éœ€è¦ç»§ç»­åˆ†å‰²æˆå­ä»»åŠ¡ï¼Œå¦‚æœä¸éœ€è¦ç»§ç»­åˆ†å‰²ï¼Œåˆ™æ‰§è¡Œå½“å‰å­ä»»åŠ¡å¹¶è¿”å›ç»“æœã€‚ä½¿ç”¨joinæ–¹æ³•ä¼šç­‰å¾…å­ä»»åŠ¡æ‰§è¡Œå®Œæˆå¹¶å¾—åˆ°ç»“æœã€‚</p>
<h4 id="âœ…Fork-Joinæ¡†æ¶çš„å¼‚å¸¸å¤„ç†"><a href="#âœ…Fork-Joinæ¡†æ¶çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="âœ…Fork&#x2F;Joinæ¡†æ¶çš„å¼‚å¸¸å¤„ç†"></a>âœ…Fork&#x2F;Joinæ¡†æ¶çš„å¼‚å¸¸å¤„ç†</h4><p>ForkJoinTaskåœ¨æ‰§è¡Œçš„æ—¶å€™å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡åŠæ³•åœ¨ä¸»çº¿ç¨‹é‡Œç›´æ¥æ•è·å¼‚å¸¸ï¼Œæ‰€ä»¥ForkJoinTaskæä¾›äº†isCompletedAbnormally()æ–¹æ³•æ¥æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²ç»æŠ›å‡ºå¼‚å¸¸æˆ–å·²ç»è¢«å–æ¶ˆäº†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ForkJoinTaskçš„getExceptionæ–¹æ³•è·å–å¼‚å¸¸ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (task.isCompletedAbnormally())&#123;</span><br><span class="line">    System.out.println(task.getException());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>getExceptionæ–¹æ³•è¿”å›Throwableå¯¹è±¡ï¼Œå¦‚æœä»»åŠ¡è¢«å–æ¶ˆäº†åˆ™è¿”å›CancellationExceptionã€‚å¦‚æœä»»åŠ¡æ²¡æœ‰å®Œæˆæˆ–è€…æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸åˆ™è¿”å› nullã€‚</p>
<h4 id="âœ…Fork-Joinæ¡†æ¶çš„å®ç°åŸç†"><a href="#âœ…Fork-Joinæ¡†æ¶çš„å®ç°åŸç†" class="headerlink" title="âœ…Fork&#x2F;Joinæ¡†æ¶çš„å®ç°åŸç†"></a>âœ…Fork&#x2F;Joinæ¡†æ¶çš„å®ç°åŸç†</h4><p>ForkJoinPoolç”±ForkJoinTaskæ•°ç»„å’ŒForkJoinWorkerThreadæ•°ç»„ç»„æˆçš„ï¼ŒForkJoinTaskæ•°ç»„è´Ÿè´£å°†å­˜æ”¾ç¨‹åºæäº¤ç»™ForkJoinPoolçš„ä»»åŠ¡ï¼Œè€ŒForkJoinWorkerThreadæ•°ç»„è´Ÿè´£æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚</p>
<p>ï¼ˆ1ï¼‰forkæ–¹æ³•å®ç°åŸç†ï¼š</p>
<p>è°ƒç”¨ForkJoinTaskçš„fork()æ–¹æ³•æ—¶ï¼Œç¨‹åºä¼šè°ƒç”¨ForkJoinWorkerThreadçš„pushTaskæ–¹æ³•å¼‚æ­¥åœ°æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œç„¶åç«‹å³è¿”å›ç»“æœã€‚</p>
<p>pushTaskæ–¹æ³•æŠŠå½“å‰ä»»åŠ¡å­˜æ”¾åœ¨ForkJoinTaskæ•°ç»„é˜Ÿåˆ—é‡Œã€‚ç„¶åå†è°ƒç”¨ForkJoinPoolçš„signalWork()æ–¹æ³•å”¤é†’æˆ–åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>ï¼ˆ2ï¼‰joinæ–¹æ³•å®ç°åŸç†</p>
<p>Joinæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯é˜»å¡å½“å‰çº¿ç¨‹å¹¶ç­‰å¾…è·å–ç»“æœã€‚</p>
<p>å®ƒè°ƒç”¨äº†doJoin()æ–¹æ³•ï¼Œé€šè¿‡doJoin()æ–¹æ³•å¾—åˆ°å½“å‰ä»»åŠ¡çš„çŠ¶æ€æ¥åˆ¤æ–­è¿”å›ä»€ä¹ˆç»“æœï¼Œä»»åŠ¡çŠ¶æ€æœ‰4ç§ï¼š<br>å·²å®Œæˆ(NORMAL)ï¼Œè¢«å–æ¶ˆ(CANCELLED)ï¼Œä¿¡å·(SIGNAL)å’Œå‡ºç°å¼‚å¸¸(EXCEPTION)ã€‚</p>
<p>a. å¦‚æœä»»åŠ¡çŠ¶æ€å·²å®Œæˆï¼Œåˆ™ç›´æ¥è¿”å›ä»»åŠ¡ç»“æœã€‚<br>b. å¦‚æœä»»åŠ¡çŠ¶æ€æ˜¯è¢«å–æ¶ˆï¼Œåˆ™ç›´æ¥æŠ›å‡ºCancellationExceptionã€‚<br>c. å¦‚æœä»»åŠ¡çŠ¶æ€æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¯¹åº”çš„å¼‚å¸¸ã€‚</p>
<p>åœ¨doJoin()æ–¹æ³•é‡Œï¼Œé¦–å…ˆé€šè¿‡ä»»åŠ¡çš„çŠ¶æ€ï¼Œçœ‹ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆï¼Œå¦‚æœæ‰§è¡Œå®Œæˆï¼Œåˆ™ç›´æ¥è¿”å›ä»»åŠ¡çŠ¶æ€ï¼›å¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œï¼Œåˆ™ä»ä»»åŠ¡æ•°ç»„é‡Œå–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œã€‚<br>å¦‚æœä»»åŠ¡é¡ºåˆ©æ‰§è¡Œå®Œæˆï¼Œåˆ™è®¾ç½®ä»»åŠ¡çŠ¶æ€ä¸ºNORMALï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è®°å½•å¼‚å¸¸ï¼Œå¹¶å°†ä»»åŠ¡çŠ¶æ€è®¾ç½®ä¸ºEXCEPTIONALã€‚</p>
<h2 id="ç¬¬ä¸ƒç« -javaä¸­çš„13ä¸ªåŸå­æ“ä½œç±»"><a href="#ç¬¬ä¸ƒç« -javaä¸­çš„13ä¸ªåŸå­æ“ä½œç±»" class="headerlink" title="ç¬¬ä¸ƒç«  javaä¸­çš„13ä¸ªåŸå­æ“ä½œç±»"></a>ç¬¬ä¸ƒç«  javaä¸­çš„13ä¸ªåŸå­æ“ä½œç±»</h2><p>å¤šçº¿ç¨‹åŒæ—¶æ›´æ–°ä¸€ä¸ªå˜é‡ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨synchronizedæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œsynchronizedä¼šä¿è¯å¤šçº¿ç¨‹ä¸ä¼šåŒæ—¶æ›´æ–°å˜é‡iã€‚</p>
<p>Javaä»JDK 1.5å¼€å§‹æä¾›äº†java.util.concurrent.atomicåŒ…ï¼ˆä»¥ä¸‹ç®€ç§°AtomicåŒ…ï¼‰ï¼Œè¿™ä¸ªåŒ…ä¸­çš„åŸå­æ“ä½œç±»æä¾›äº†ä¸€ç§ç”¨æ³•ç®€å•ã€æ€§èƒ½é«˜æ•ˆã€çº¿ç¨‹å®‰å…¨åœ°æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ–¹å¼ã€‚</p>
<p>AtomicåŒ…é‡Œä¸€å…±æä¾›äº†13ä¸ªç±»ï¼Œå±äº4ç§ç±»å‹çš„åŸå­æ›´æ–°æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åŸå­æ›´æ–°åŸºæœ¬ç±»å‹ã€åŸå­æ›´æ–°æ•°ç»„ã€åŸå­æ›´æ–°å¼•ç”¨å’ŒåŸå­æ›´æ–°å±æ€§ï¼ˆå­—æ®µï¼‰ã€‚AtomicåŒ…é‡Œçš„ç±»åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨Unsafeå®ç°çš„åŒ…è£…ç±»ã€‚</p>
<blockquote>
<p>Unsafeç±»ä½äºsun.miscåŒ…ä¸‹ï¼Œå®ƒæ˜¯javaå®ç°é«˜å¹¶å‘çš„åŸºç¡€ï¼Œé€šè¿‡å®ƒå¯ä»¥æ‰§è¡Œä¸€äº›ä¸å®‰å…¨çš„æ“ä½œï¼Œå¦‚åƒCè¯­è¨€ä¸€æ ·ç›´æ¥æ“ä½œå†…å­˜èµ„æºï¼Œ<br>å®ƒæä¾›çš„è¿™äº›æ–¹æ³•å¢å¼ºäº†javaå¯¹åº•å±‚èµ„æºçš„æ“ä½œèƒ½åŠ›ï¼Œä½†åŒæ—¶ä¹Ÿå¢åŠ äº†ç¨‹åºå‡ºé”™çš„é£é™©.<br>Unsafeæä¾›çš„APIå¤§è‡´å¯åˆ†ä¸ºå†…å­˜æ“ä½œã€CASã€Classç›¸å…³ã€å¯¹è±¡æ“ä½œã€çº¿ç¨‹è°ƒåº¦ã€ç³»ç»Ÿä¿¡æ¯è·å–ã€å†…å­˜å±éšœç›¸å…³ã€æ•°ç»„ç›¸å…³ç­‰ã€‚</p>
</blockquote>
<blockquote>
<p>CAS(compareAndSwap)å³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼Œæ˜¯å®ç°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ã€‚CASåº•å±‚ä¸ºä¸€æ¡åŸå­æŒ‡ä»¤cmpxchgï¼Œå¯ä»¥ä¿è¯åŸå­æ€§ï¼ŒUnsafeæä¾›çš„CASæ–¹æ³•å¦‚compareAndSwapIntåº•å±‚å°±æ˜¯CPUæŒ‡ä»¤cmpxchgã€‚<br>CASåœ¨javaå¹¶å‘åŒ…ä¸­çš„åŸå­ç±»å¦‚AtomicIntegerï¼ŒAQS(AbstractQueuedSynchronizer)ï¼ŒConcurrentHashMapç­‰å®ç°ä¸­éƒ½æœ‰å¹¿æ³›çš„ä½¿ç”¨ã€‚<br>å› æ­¤ï¼Œä¸ç®¡æ˜¯Atomicè¿˜æ˜¯ä»€ä¹ˆé”é‡Œçš„CASéƒ½ä¾æ‰˜äºUnsafeåŒ…é‡Œçš„æ–¹æ³•ã€‚</p>
</blockquote>
<p>Unsafeç±»ï¼š<a href="https://www.cnblogs.com/strongmore/p/15468423.html">https://www.cnblogs.com/strongmore/p/15468423.html</a></p>
<h3 id="1-åŸå­æ›´æ–°åŸºæœ¬ç±»å‹ç±»"><a href="#1-åŸå­æ›´æ–°åŸºæœ¬ç±»å‹ç±»" class="headerlink" title="1.åŸå­æ›´æ–°åŸºæœ¬ç±»å‹ç±»"></a>1.åŸå­æ›´æ–°åŸºæœ¬ç±»å‹ç±»</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸‰ä¸ªç±»ï¼š</span><br><span class="line">Â· AtomicBooleanï¼šåŸå­æ›´æ–°å¸ƒå°”ç±»å‹ã€‚</span><br><span class="line">Â· AtomicIntegerï¼šåŸå­æ›´æ–°æ•´å‹ã€‚</span><br><span class="line">Â· AtomicLongï¼šåŸå­æ›´æ–°é•¿æ•´å‹ã€‚</span><br><span class="line"></span><br><span class="line">AtomicIntegerä¸ºä¾‹ï¼š</span><br><span class="line">Â· int addAndGetï¼ˆint deltaï¼‰ï¼šä»¥åŸå­æ–¹å¼å°†è¾“å…¥çš„æ•°å€¼ä¸å®ä¾‹ä¸­çš„å€¼ï¼ˆAtomicIntegeré‡Œçš„valueï¼‰ç›¸åŠ ï¼Œå¹¶è¿”å›ç»“æœã€‚</span><br><span class="line"></span><br><span class="line">Â· boolean compareAndSetï¼ˆint expectï¼Œint updateï¼‰ï¼šå¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥çš„å€¼ã€‚</span><br><span class="line"></span><br><span class="line">Â· int getAndIncrement()ï¼šä»¥åŸå­æ–¹å¼å°†å½“å‰å€¼åŠ 1ï¼Œæ³¨æ„ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯è‡ªå¢å‰çš„å€¼ã€‚</span><br><span class="line"></span><br><span class="line">Â· void lazySetï¼ˆint newValueï¼‰ï¼šæœ€ç»ˆä¼šè®¾ç½®æˆnewValueï¼Œä½¿ç”¨lazySetè®¾ç½®å€¼åï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚</span><br><span class="line"></span><br><span class="line">Â·int getAndSetï¼ˆint newValueï¼‰ï¼šä»¥åŸå­æ–¹å¼è®¾ç½®ä¸ºnewValueçš„å€¼ï¼Œå¹¶è¿”å›æ—§å€¼ã€‚</span><br></pre></td></tr></table></figure>

<p>æºç åˆ†æï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final int getAndIncrement() &#123;</span><br><span class="line">  for (;;) &#123;</span><br><span class="line">    int current = get(); </span><br><span class="line">    int next = current + 1;</span><br><span class="line">    if (compareAndSet(current, next)) </span><br><span class="line">        return current;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public final boolean compareAndSet(int expect, int update) &#123;</span><br><span class="line">    return unsafe.compareAndSwapInt(this, valueOffset, expect, update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AtomicåŒ…é‡Œçš„ç±»åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨Unsafeå®ç°çš„.<br>Unsafeåªæä¾›äº†3ç§CASæ–¹æ³•ï¼šcompareAndSwapObjectã€compare- AndSwapIntå’ŒcompareAndSwapLong.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public final native boolean compareAndSwapObject(Object o,  long offset, Object expected, Object x);  </span><br><span class="line">  </span><br><span class="line">public final native boolean compareAndSwapInt(Object o, long offset,  int expected, int x);  </span><br><span class="line">  </span><br><span class="line">public final native boolean compareAndSwapLong(Object o, long offset,  long expected, long x);  </span><br></pre></td></tr></table></figure>

<h3 id="2-åŸå­æ›´æ–°æ•°ç»„"><a href="#2-åŸå­æ›´æ–°æ•°ç»„" class="headerlink" title="2.åŸå­æ›´æ–°æ•°ç»„"></a>2.åŸå­æ›´æ–°æ•°ç»„</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸‰ä¸ªç±»ï¼š</span><br><span class="line">Â· AtomicIntegerArrayï¼šåŸå­æ›´æ–°æ•´å‹æ•°ç»„é‡Œçš„å…ƒç´ ã€‚</span><br><span class="line">Â· AtomicLongArrayï¼šåŸå­æ›´æ–°é•¿æ•´å‹æ•°ç»„é‡Œçš„å…ƒç´ ã€‚</span><br><span class="line">Â· AtomicReferenceArrayï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹æ•°ç»„é‡Œçš„å…ƒç´ ã€‚</span><br><span class="line"></span><br><span class="line">AtomicIntegerArrayä¸ºä¾‹ï¼š</span><br><span class="line">Â· int addAndGetï¼ˆint iï¼Œint deltaï¼‰ï¼šä»¥åŸå­æ–¹å¼å°†è¾“å…¥å€¼ä¸æ•°ç»„ä¸­ç´¢å¼•içš„å…ƒç´ ç›¸åŠ ã€‚</span><br><span class="line"></span><br><span class="line">Â· boolean compareAndSetï¼ˆint iï¼Œint expectï¼Œint updateï¼‰ï¼šå¦‚æœå½“å‰å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†æ•°ç»„ä½ç½®içš„å…ƒç´ è®¾ç½®æˆupdateå€¼ã€‚</span><br><span class="line"></span><br><span class="line">static int[] value = new int[] &#123; 1ï¼Œ 2 &#125;;  </span><br><span class="line">static AtomicIntegerArray ai = new AtomicIntegerArray(value); </span><br><span class="line">ai.getAndSet(0ï¼Œ 3);</span><br><span class="line">System.out.println(ai.get(0)); //3</span><br><span class="line">System.out.println(value[0]);  //1</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°ç»„valueé€šè¿‡æ„é€ æ–¹æ³•ä¼ é€’è¿›å»ï¼Œç„¶åAtomicIntegerArrayä¼šå°†å½“å‰æ•°ç»„å¤åˆ¶ä¸€ä»½ï¼Œæ‰€ä»¥å½“AtomicIntegerArrayå¯¹å†…éƒ¨çš„æ•°ç»„å…ƒç´ è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¸ä¼šå½±å“ä¼ å…¥çš„æ•°ç»„ã€‚</p>
<h3 id="3-åŸå­æ›´æ–°å¼•ç”¨ç±»å‹"><a href="#3-åŸå­æ›´æ–°å¼•ç”¨ç±»å‹" class="headerlink" title="3.åŸå­æ›´æ–°å¼•ç”¨ç±»å‹"></a>3.åŸå­æ›´æ–°å¼•ç”¨ç±»å‹</h3><p>åŸå­æ›´æ–°åŸºæœ¬ç±»å‹çš„AtomicIntegerï¼Œåªèƒ½æ›´æ–°ä¸€ä¸ªå˜é‡ï¼Œå¦‚æœè¦åŸå­æ›´æ–°å¤šä¸ªå˜é‡ï¼Œå°±éœ€è¦ä½¿ç”¨è¿™ä¸ªåŸå­æ›´æ–°å¼•ç”¨ç±»å‹æä¾›çš„ç±»ã€‚AtomicåŒ…æä¾›äº†ä»¥ä¸‹3ä¸ªç±»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Â· AtomicReferenceï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹ã€‚</span><br><span class="line">Â· AtomicReferenceFieldUpdaterï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚</span><br><span class="line">Â· AtomicMarkableReferenceï¼šåŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹ã€‚å¯ä»¥åŸå­æ›´æ–°ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„æ ‡è®°ä½å’Œå¼•ç”¨ç±»å‹ã€‚æ„é€ æ–¹æ³•æ˜¯AtomicMarkableReferenceï¼ˆV initialRefï¼Œboolean initialMarkï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">AtomicReferenceä¸ºä¾‹ï¼š</span><br><span class="line"></span><br><span class="line">public class AtomicReferenceTest &#123;</span><br><span class="line"></span><br><span class="line">    public static AtomicReference&lt;user&gt; atomicUserRef = new AtomicReference&lt;user&gt;();</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        User user = new User(&quot;conan&quot;ï¼Œ 15); atomicUserRef.set(user);</span><br><span class="line">        User updateUser = new User(&quot;Shinichi&quot;ï¼Œ 17); atomicUserRef.compareAndSet(userï¼Œ updateUser);</span><br><span class="line">        System.out.println(atomicUserRef.get().getName());</span><br><span class="line">        System.out.println(atomicUserRef.get().getOld());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-åŸå­æ›´æ–°å­—æ®µç±»"><a href="#4-åŸå­æ›´æ–°å­—æ®µç±»" class="headerlink" title="4.åŸå­æ›´æ–°å­—æ®µç±»"></a>4.åŸå­æ›´æ–°å­—æ®µç±»</h3><p>æ›´æ–°é™æ€ç±»é‡Œçš„æˆå‘˜å˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Â· AtomicIntegerFieldUpdaterï¼šåŸå­æ›´æ–°æ•´å‹çš„å­—æ®µçš„æ›´æ–°å™¨ã€‚</span><br><span class="line">Â· AtomicLongFieldUpdaterï¼šåŸå­æ›´æ–°é•¿æ•´å‹å­—æ®µçš„æ›´æ–°å™¨ã€‚</span><br><span class="line">Â· AtomicStampedReferenceï¼šåŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œå¯ç”¨äºåŸå­çš„æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è§£å†³ä½¿ç”¨CASè¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ABAé—®é¢˜ã€‚</span><br></pre></td></tr></table></figure>

<p>è¦æƒ³åŸå­åœ°æ›´æ–°å­—æ®µç±»éœ€è¦ä¸¤æ­¥ã€‚ç¬¬ä¸€æ­¥ï¼Œå› ä¸ºåŸå­æ›´æ–°å­—æ®µç±»éƒ½æ˜¯æŠ½è±¡ç±»ï¼Œæ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™å¿…é¡»ä½¿ç”¨é™æ€æ–¹æ³•newUpdater()åˆ›å»ºä¸€ä¸ªæ›´æ–°å™¨ï¼Œå¹¶ä¸”éœ€è¦è®¾ç½®æƒ³è¦æ›´æ–°çš„ç±»å’Œå±æ€§ã€‚ç¬¬äºŒæ­¥ï¼Œæ›´æ–°ç±»çš„å­—æ®µï¼ˆå±æ€§ï¼‰å¿…é¡»ä½¿ç”¨public volatileä¿®é¥°ç¬¦ã€‚</p>
<p>AstomicIntegerFieldUpdaterä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class AtomicIntegerFieldUpdaterTest &#123;</span><br><span class="line"></span><br><span class="line">   // åˆ›å»ºåŸå­æ›´æ–°å™¨ï¼Œå¹¶è®¾ç½®éœ€è¦æ›´æ–°çš„å¯¹è±¡ç±»å’Œå¯¹è±¡çš„å±æ€§</span><br><span class="line">    private static AtomicIntegerFieldUpdater&lt;User&gt; a = AtomicIntegerFieldUpdater.newUpdater(User.classï¼Œ &quot;old&quot;);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        User conan = new User(&quot;conan&quot;ï¼Œ 10);</span><br><span class="line">        System.out.println(a.getAndIncrement(conan)); //10</span><br><span class="line">        System.out.println(a.get(conan));  //11</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class User &#123;</span><br><span class="line">        private String name;</span><br><span class="line">        public volatile int old;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é™æ€å˜é‡å’Œæˆå‘˜å˜é‡ï¼š</span><br><span class="line">ç”±staticä¿®é¥°çš„å˜é‡ç§°ä¸ºé™æ€å˜é‡ï¼Œå…¶å®è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ã€‚</span><br><span class="line">å¦‚æœæŸä¸ªå†…å®¹æ˜¯è¢«æ‰€æœ‰å¯¹è±¡æ‰€å…±äº«ï¼Œé‚£ä¹ˆè¯¥å†…å®¹å°±åº”è¯¥ç”¨é™æ€ä¿®é¥°ï¼›</span><br><span class="line">æ²¡æœ‰è¢«é™æ€ä¿®é¥°çš„å†…å®¹ï¼Œå…¶å®æ˜¯å±äºå¯¹è±¡çš„ç‰¹æ®Šæè¿°ã€‚</span><br><span class="line"></span><br><span class="line">æˆå‘˜å˜é‡å’Œé™æ€å˜é‡çš„åŒºåˆ«ï¼š</span><br><span class="line">1.ç”Ÿå‘½å‘¨æœŸä¸åŒ</span><br><span class="line">æˆå‘˜å˜é‡éšç€å¯¹è±¡çš„åˆ›å»ºè€Œå­˜åœ¨ï¼Œéšç€å¯¹è±¡è¢«å›æ”¶è€Œé‡Šæ”¾ã€‚</span><br><span class="line">é™æ€å˜é‡éšç€ç±»çš„åŠ è½½è€Œå­˜åœ¨ï¼Œéšç€ç±»çš„æ¶ˆå¤±è€Œæ¶ˆå¤±ã€‚</span><br><span class="line">2.è°ƒç”¨æ–¹å¼ä¸åŒ</span><br><span class="line">æˆå‘˜å˜é‡åªèƒ½è¢«å¯¹è±¡è°ƒç”¨ã€‚</span><br><span class="line">é™æ€å˜é‡å¯ä»¥è¢«å¯¹è±¡è°ƒç”¨ï¼Œè¿˜å¯ä»¥è¢«ç±»åè°ƒç”¨ã€‚</span><br><span class="line">3.åˆ«åä¸åŒ</span><br><span class="line">æˆå‘˜å˜é‡ä¹Ÿç§°ä¸ºå®ä¾‹å˜é‡ã€‚</span><br><span class="line">é™æ€å˜é‡ä¹Ÿç§°ä¸ºç±»å˜é‡ã€‚</span><br><span class="line">4.æ•°æ®å­˜å‚¨ä½ç½®ä¸åŒ</span><br><span class="line">æˆå‘˜å˜é‡å­˜å‚¨åœ¨å †å†…å­˜çš„å¯¹è±¡ä¸­ï¼Œæ‰€ä»¥ä¹Ÿå«å¯¹è±¡çš„ç‰¹æœ‰æ•°æ®ã€‚</span><br><span class="line">é™æ€å˜é‡æ•°æ®å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆå…±äº«æ•°æ®åŒºï¼‰çš„é™æ€åŒºï¼Œæ‰€ä»¥ä¹Ÿå«å¯¹è±¡çš„å…±äº«æ•°æ®ã€‚ </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é™æ€æ–¹æ³•å’Œéé™æ€æ–¹æ³•ï¼š</span><br><span class="line">é™æ€æ–¹æ³•:æ˜¯ä½¿ç”¨staticå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•ï¼Œåˆå«ç±»æ–¹æ³•.å±äºç±»çš„ï¼Œ</span><br><span class="line">ä¸å±äºå¯¹è±¡ï¼Œ åœ¨å®ä¾‹åŒ–å¯¹è±¡ä¹‹å‰å°±å¯ä»¥é€šè¿‡ç±»å.æ–¹æ³•åè°ƒç”¨é™æ€æ–¹æ³•ã€‚</span><br><span class="line">éé™æ€æ–¹æ³•ï¼šåˆç§°ä¸ºå®ä¾‹æ–¹æ³•ï¼Œæˆå‘˜æ–¹æ³•ã€‚å±äºå¯¹è±¡çš„ï¼Œä¸å±äºç±»çš„ã€‚</span><br><span class="line"></span><br><span class="line">é™æ€æ–¹æ³•å’Œéé™æ€æ–¹æ³•çš„åŒºåˆ«ï¼š</span><br><span class="line">1.è°ƒç”¨æ–¹æ³•</span><br><span class="line">é™æ€æ–¹æ³•ä¸­ï¼Œå¯ä»¥è°ƒç”¨é™æ€æ–¹æ³•ï¼Œä¸èƒ½è°ƒç”¨éé™æ€æ–¹æ³•ã€‚åœ¨é™æ€æ–¹æ³•ä¸­ï¼Œä¸èƒ½ä½¿ç”¨superå’Œthiså…³é”®å­—ã€‚ä¸èƒ½å¼•ç”¨æˆå‘˜å˜é‡ã€‚</span><br><span class="line">æ™®é€šæ–¹æ³•ä¸­ï¼Œå¯ä»¥è°ƒç”¨æ™®é€šæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨é™æ€æ–¹æ³•ã€‚</span><br><span class="line">2.ä½¿ç”¨æ–¹æ³•</span><br><span class="line">é™æ€æ–¹æ³•å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œç±»åè°ƒç”¨å’Œå¯¹è±¡è°ƒç”¨ã€‚</span><br><span class="line">ä½†æ˜¯éé™æ€æ–¹æ³•åªèƒ½é€šè¿‡å¯¹è±¡è°ƒç”¨ã€‚ï¼ˆå¯¹è±¡å.æ–¹æ³•åï¼‰</span><br><span class="line">3.ç”Ÿå‘½å‘¨æœŸä¸åŒ</span><br><span class="line">é™æ€æ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸè·Ÿç›¸åº”çš„ç±»ä¸€æ ·é•¿ï¼Œé™æ€æ–¹æ³•å’Œé™æ€å˜é‡ä¼šéšç€ç±»çš„å®šä¹‰è€Œè¢«åˆ†é…å’Œè£…è½½å…¥å†…å­˜ä¸­ã€‚ä¸€ç›´åˆ°çº¿ç¨‹ç»“æŸï¼Œé™æ€å±æ€§å’Œæ–¹æ³•æ‰ä¼šè¢«é”€æ¯ã€‚</span><br><span class="line">éé™æ€æ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸå’Œç±»çš„å®ä¾‹åŒ–å¯¹è±¡ä¸€æ ·é•¿ï¼Œåªæœ‰å½“ç±»å®ä¾‹åŒ–äº†ä¸€ä¸ªå¯¹è±¡ï¼Œéé™æ€æ–¹æ³•æ‰ä¼šè¢«åˆ›å»ºï¼Œè€Œå½“è¿™ä¸ªå¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œéé™æ€æ–¹æ³•ä¹Ÿé©¬ä¸Šè¢«é”€æ¯ã€‚</span><br><span class="line"></span><br><span class="line">é™æ€æ–¹æ³•ä¼˜ç‚¹ï¼šå¸¸ä½åœ¨å†…å­˜ä¸­ï¼Œè°ƒç”¨å¿«æ·æ–¹ä¾¿ï¼Œå…¨å‰§å”¯ä¸€ï¼Œç”¨ç±»è°ƒç”¨å°±è¡Œã€‚</span><br><span class="line">åº”ç”¨åœºæ™¯ï¼š</span><br><span class="line">1. é™æ€æ–¹æ³•æœ€é€‚åˆå·¥å…·ç±»ä¸­æ–¹æ³•çš„å®šä¹‰ï¼›æ¯”å¦‚æ–‡ä»¶æ“ä½œï¼Œæ—¥æœŸå¤„ç†æ–¹æ³•ç­‰.</span><br><span class="line">2. é™æ€æ–¹æ³•é€‚åˆå…¥å£æ–¹æ³•çš„å®šä¹‰ï¼›å¦‚å•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºä»å¤–éƒ¨æ‹¿ä¸åˆ°æ„é€ å‡½æ•°ï¼Œæ‰€æœ‰å®šä¹‰ä¸€ä¸ªé™æ€çš„æ–¹æ³•è·å–å¯¹è±¡éå¸¸æœ‰å¿…è¦.</span><br><span class="line">3. é™æ€å˜é‡é€‚åˆå…¨å±€å˜é‡çš„å®šä¹‰.ï¼ˆå¦‚å¸ƒå°”å‹é™æ€æˆå‘˜å˜é‡åšæ§åˆ¶ç¬¦ï¼‰</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é™æ€ç±»ï¼š</span><br><span class="line">javaå…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªç±»é‡Œé¢å®šä¹‰é™æ€ç±»ã€‚æ¯”å¦‚å†…éƒ¨ç±»ï¼ˆnested classï¼‰ã€‚</span><br><span class="line">æŠŠnested classå°é—­èµ·æ¥çš„ç±»å«å¤–éƒ¨ç±»ã€‚</span><br><span class="line">åœ¨javaä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ç”¨staticä¿®é¥°é¡¶çº§ç±»ï¼ˆtop level classï¼‰ã€‚åªæœ‰å†…éƒ¨ç±»å¯ä»¥ä¸ºstaticã€‚</span><br><span class="line">ï¼ˆä¸€èˆ¬å·¥å…·ç±»ä¹Ÿä¸æ˜¯staticçš„ï¼Œæ–¹æ³•æ˜¯staticçš„ï¼‰</span><br><span class="line">ï¼ˆä¸€èˆ¬åœ¨ä¸€ä¸ªç±»é‡Œå†å®šä¹‰ä¸€ä¸ªç±»ç”¨äºåŒ…è£…æ•°æ®ï¼Œç”¨public static classï¼‰</span><br><span class="line"></span><br><span class="line">é™æ€å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼š</span><br><span class="line">1.å†…éƒ¨é™æ€ç±»ä¸éœ€è¦æœ‰æŒ‡å‘å¤–éƒ¨ç±»çš„å¼•ç”¨ã€‚ä½†éé™æ€å†…éƒ¨ç±»éœ€è¦æŒæœ‰å¯¹å¤–éƒ¨ç±»çš„å¼•ç”¨ã€‚ï¼ˆæ­¤è¯æ€æ ·ï¼Œæ„æ€æ˜¯éé™æ€å†…éƒ¨ç±»éœ€è¦å¯¹è±¡.ç±»åï¼Œé™æ€å†…éƒ¨ç±»éœ€è¦å¤–éƒ¨ç±»å.ç±»åï¼‰</span><br><span class="line">2.éé™æ€å†…éƒ¨ç±»èƒ½å¤Ÿè®¿é—®å¤–éƒ¨ç±»çš„é™æ€å’Œéé™æ€æˆå‘˜ã€‚é™æ€ç±»ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€æˆå‘˜ã€‚ä»–åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ã€‚</span><br><span class="line">3.ä¸€ä¸ªéé™æ€å†…éƒ¨ç±»ä¸èƒ½è„±ç¦»å¤–éƒ¨ç±»å®ä½“è¢«åˆ›å»ºï¼Œä¸€ä¸ªéé™æ€å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ•°æ®å’Œæ–¹æ³•ï¼Œå› ä¸ºä»–å°±åœ¨å¤–éƒ¨ç±»é‡Œé¢ã€‚</span><br><span class="line"></span><br><span class="line">class OuterClass&#123;</span><br><span class="line">  private static String msg = &quot;GeeksForGeeks&quot;;</span><br><span class="line">  // é™æ€å†…éƒ¨ç±»</span><br><span class="line">  public static class NestedStaticClass&#123;</span><br><span class="line">    // é™æ€å†…éƒ¨ç±»åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜</span><br><span class="line">    public void printMessage() &#123;</span><br><span class="line">     // è¯•ç€å°†msgæ”¹æˆéé™æ€çš„ï¼Œè¿™å°†å¯¼è‡´ç¼–è¯‘é”™è¯¯ </span><br><span class="line">     System.out.println(&quot;Message from nested static class: &quot; + msg); </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // éé™æ€å†…éƒ¨ç±»</span><br><span class="line">  public class InnerClass&#123;</span><br><span class="line">    // ä¸ç®¡æ˜¯é™æ€æ–¹æ³•è¿˜æ˜¯éé™æ€æ–¹æ³•éƒ½å¯ä»¥åœ¨éé™æ€å†…éƒ¨ç±»ä¸­è®¿é—®</span><br><span class="line">    public void display()&#123;</span><br><span class="line">     System.out.println(&quot;Message from non-static nested class: &quot;+ msg);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line">class Main</span><br><span class="line">&#123;</span><br><span class="line">  // æ€ä¹ˆåˆ›å»ºé™æ€å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»çš„å®ä¾‹</span><br><span class="line">  public static void main(String args[])&#123;</span><br><span class="line">    // åˆ›å»ºé™æ€å†…éƒ¨ç±»çš„å®ä¾‹</span><br><span class="line">    OuterClass.NestedStaticClass printer = new OuterClass.NestedStaticClass();</span><br><span class="line">    // åˆ›å»ºé™æ€å†…éƒ¨ç±»çš„éé™æ€æ–¹æ³•</span><br><span class="line">    printer.printMessage();  </span><br><span class="line">    // ä¸ºäº†åˆ›å»ºéé™æ€å†…éƒ¨ç±»ï¼Œæˆ‘ä»¬éœ€è¦å¤–éƒ¨ç±»çš„å®ä¾‹</span><br><span class="line">    OuterClass outer = new OuterClass();    </span><br><span class="line">    OuterClass.InnerClass inner = outer.new InnerClass();</span><br><span class="line">    // è°ƒç”¨éé™æ€å†…éƒ¨ç±»çš„éé™æ€æ–¹æ³•</span><br><span class="line">    inner.display();</span><br><span class="line">    // æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»“åˆä»¥ä¸Šæ­¥éª¤ï¼Œä¸€æ­¥åˆ›å»ºçš„å†…éƒ¨ç±»å®ä¾‹</span><br><span class="line">    OuterClass.InnerClass innerObject = new OuterClass().new InnerClass();</span><br><span class="line">    // åŒæ ·æˆ‘ä»¬ç°åœ¨å¯ä»¥è°ƒç”¨å†…éƒ¨ç±»æ–¹æ³•</span><br><span class="line">    innerObject.display();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Inner class &#x27;Person&#x27; may be &#x27;static&#x27; </span><br><span class="line">ideæç¤ºå†…éƒ¨ç±»æœ€å¥½æ˜¯é™æ€çš„. ä¸ç„¶ä¸èƒ½åœ¨æ‰€åœ¨å¤–éƒ¨ç±»é‡Œç›´æ¥newä¸€ä¸ªå¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªç±»åŒ…åœ¨å¦ä¸€ä¸ªå¤–éƒ¨ç±»é‡Œé¢ï¼Œå«åšå†…éƒ¨ç±»ï¼Œå¯ä»¥å’Œå…¶ä»–å†…éƒ¨ç±»é‡åã€‚</span><br><span class="line">ä½†æ˜¯å’Œä¸€ä¸ªç±»å¹¶åˆ—åœ¨ä¸€ä¸ªç±»æ–‡ä»¶é‡Œï¼Œä¸æ˜¯å†…éƒ¨ç±»ï¼Œä¸èƒ½é‡åã€‚ä¸åŒäºå†…éƒ¨ç±»ï¼Œæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Œç›¸å½“äºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œä¸å»ºè®®è¿™ä¹ˆåšã€‚</span><br></pre></td></tr></table></figure>

<p>é™æ€å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»ï¼š<a href="https://www.jb51.net/article/74838.htm">https://www.jb51.net/article/74838.htm</a></p>
<h2 id="ç¬¬å…«ç« -javaä¸­çš„å¹¶å‘å·¥å…·ç±»"><a href="#ç¬¬å…«ç« -javaä¸­çš„å¹¶å‘å·¥å…·ç±»" class="headerlink" title="ç¬¬å…«ç«  javaä¸­çš„å¹¶å‘å·¥å…·ç±»"></a>ç¬¬å…«ç«  javaä¸­çš„å¹¶å‘å·¥å…·ç±»</h2><p>JDKçš„å¹¶å‘åŒ…é‡Œæä¾›äº†å‡ ä¸ªéå¸¸æœ‰ç”¨çš„å¹¶å‘å·¥å…·ç±»ã€‚CountDownLatchã€CyclicBarrierå’ŒSemaphoreå·¥å…·ç±»æä¾›äº†ä¸€ç§å¹¶å‘æµç¨‹æ§åˆ¶çš„æ‰‹æ®µï¼ŒExchangerå·¥å…·ç±»æä¾›äº†åœ¨çº¿ç¨‹é—´äº¤æ¢æ•°æ®çš„ä¸€ç§æ–¹æ³•ã€‚</p>
<h3 id="1-ç­‰å¾…å¤šçº¿ç¨‹å®Œæˆçš„CountDownLatch"><a href="#1-ç­‰å¾…å¤šçº¿ç¨‹å®Œæˆçš„CountDownLatch" class="headerlink" title="1.ç­‰å¾…å¤šçº¿ç¨‹å®Œæˆçš„CountDownLatch"></a>1.ç­‰å¾…å¤šçº¿ç¨‹å®Œæˆçš„CountDownLatch</h3><p>åº”ç”¨åœºæ™¯ï¼šç­‰å¾…å…¶ä»–å¤šä¸ªçº¿ç¨‹æ‰§è¡Œå®Œäº†ï¼Œå†æ‰§è¡Œå½“å‰çº¿ç¨‹ã€‚</p>
<p>åœ¨JDK1.5ä¹‹åçš„å¹¶å‘åŒ…ä¸­æä¾›çš„CountDownLatchå¯ä»¥å®ç°joinçš„åŠŸèƒ½ï¼Œä¸€ä¸ªcountDownLatchçš„await()æ–¹æ³•ç›¸å½“äºå¤šä¸ªçº¿ç¨‹çš„joinæ–¹æ³•ã€‚joinçº¿ç¨‹ç»ˆæ­¢åï¼Œå…¶å®æ˜¯è°ƒç”¨äº†<code>this.notifyAll()æ–¹æ³•</code>ï¼Œåœ¨JVMé‡Œå®ç°çš„ï¼Œåœ¨JDKé‡Œçœ‹ä¸åˆ°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">    CountDownLatch countDownLatch = new CountDownLatch(2);</span><br><span class="line">    new Thread(new Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            System.out.println(1);</span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">            System.out.println(2);</span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">    countDownLatch.await();</span><br><span class="line">    System.out.println(3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨CountDownLatchçš„countDownæ–¹æ³•æ—¶ï¼ŒCountDownLatchçš„awaitæ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°Nå˜ä¸º0ã€‚å¯ä»¥æ˜¯Nä¸ªçº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯1ä¸ªçº¿ç¨‹çš„Nä¸ªæ‰§è¡Œæ­¥éª¤ã€‚ç”¨åœ¨å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªCountDownLatchçš„å¼•ç”¨ä¼ é€’åˆ°çº¿ç¨‹é‡Œå³å¯ã€‚</p>
<p>è¶…æ—¶æœºåˆ¶ï¼š<code>await(long time, TimeUnit unit)</code>ï¼Œè¿™ä¸ªæ–¹æ³•ç­‰å¾…ç‰¹å®šæ—¶é—´åï¼Œå°±ä¼šä¸å†é˜»æŒ¡å½“å‰çº¿ç¨‹ã€‚</p>
<p>âš ï¸CountDownLatchä¸å¯èƒ½é‡æ–°åˆå§‹åŒ–æˆ–è€…ä¿®æ”¹å…¶å†…éƒ¨è®¡æ•°å™¨çš„å€¼ã€‚</p>
<h3 id="2-åŒæ­¥å±éšœCyclicBarrier"><a href="#2-åŒæ­¥å±éšœCyclicBarrier" class="headerlink" title="2.åŒæ­¥å±éšœCyclicBarrier"></a>2.åŒæ­¥å±éšœCyclicBarrier</h3><p>CyclicBarrierçš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ä½¿ç”¨ï¼ˆCyclicï¼‰çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œè®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­è¿è¡Œã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šä¸€è¾†è½¦è£…10ä¸ªäººï¼Œä¸Šå¤Ÿ10ä¸ªäººæ‰å¼€è½¦ã€‚</p>
<p>CyclicBarrieré»˜è®¤çš„æ„é€ æ–¹æ³•æ˜¯CyclicBarrier(int parties)ï¼Œå…¶å‚æ•°è¡¨ç¤ºå±éšœæ‹¦æˆªçš„çº¿ç¨‹æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•å‘Šè¯‰CyclicBarrieræˆ‘å·²ç»åˆ°è¾¾äº†å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    CyclicBarrier cyclicBarrier = new CyclicBarrier(2);</span><br><span class="line">    new Thread(() -&gt; &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            cyclicBarrier.await();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(1);</span><br><span class="line">    &#125;).start();</span><br><span class="line">    try &#123;</span><br><span class="line">        cyclicBarrier.await();</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„è°ƒåº¦æ˜¯æœ‰CPUå†³å®šçš„ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½æœ‰å¯èƒ½å…ˆæ‰§è¡Œã€‚å¯èƒ½æ˜¯1ï¼Œ2ï¼Œä¹Ÿå¯èƒ½æ˜¯2ï¼Œ1.</p>
<p>CyclicBarrierè¿˜æä¾›äº†ä¸€ä¸ªé«˜çº§çš„æ„é€ å‡½æ•°<code>CyclicBarrier(int parties, Runnable barrierAction)</code>ï¼Œç”¨äºåœ¨æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœæ—¶ï¼Œä¼˜å…ˆæ‰§è¡ŒbarrierActionã€‚æ³¨æ„ï¼Œè¿™ä¸ªbarrierActionä¸ä¸€å®šæ˜¯è¦ç”¨cyclicBarrier.await()çš„çº¿ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.CyclicBarrier;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-18 22:50</span><br><span class="line"> **/</span><br><span class="line">public class CyclicTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        CyclicBarrier c = new CyclicBarrier(2, new A());</span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                c.await();</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(2);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        try &#123;</span><br><span class="line">            c.await();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class A implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            System.out.println(3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º3-1-2 æˆ–è€…3-2-1.</p>
<h4 id="âœ…çº¿ç¨‹çš„é˜»å¡çŠ¶æ€å’Œä¸­æ–­çŠ¶æ€"><a href="#âœ…çº¿ç¨‹çš„é˜»å¡çŠ¶æ€å’Œä¸­æ–­çŠ¶æ€" class="headerlink" title="âœ…çº¿ç¨‹çš„é˜»å¡çŠ¶æ€å’Œä¸­æ–­çŠ¶æ€"></a>âœ…çº¿ç¨‹çš„é˜»å¡çŠ¶æ€å’Œä¸­æ–­çŠ¶æ€</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">çº¿ç¨‹çš„é˜»å¡çŠ¶æ€å’Œä¸­æ–­çŠ¶æ€</span><br><span class="line"></span><br><span class="line">å·²çŸ¥ï¼š</span><br><span class="line">waitå’Œnotifyï¼š</span><br><span class="line">æ‰§è¡Œäº†ç›‘è§†å™¨çš„wait()æ–¹æ³•åï¼Œæ”¾å¼ƒé”è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</span><br><span class="line">æ‰§è¡Œäº†ç›‘è§†å™¨çš„notify()æ–¹æ³•åï¼Œè®©ä¸€ä¸ªçº¿ç¨‹ä»ç­‰å¾…é˜Ÿåˆ—åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</span><br><span class="line">wait()å’Œnotify()æ–¹æ³•ä½¿ç”¨çš„å‰ææ˜¯è¦è·å–å¯¹è±¡çš„é”çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨synchronized(obj)&#123;&#125;å†…ã€‚</span><br><span class="line">sleepæ–¹æ³•è¿›å…¥å®šæ—¶ç­‰å¾…çŠ¶æ€ï¼Œä¸ä¼šé‡Šæ”¾é”(å¦‚æœå†™åœ¨synchronizedå†…)ã€‚</span><br><span class="line"></span><br><span class="line">sleepå’ŒwaitåŒºåˆ«ï¼š</span><br><span class="line">1.sleepæ˜¯Threadç±»çš„æ–¹æ³•ï¼Œæ˜¯ã€Œé™æ€æ–¹æ³•ã€ã€‚waitæ˜¯Objectç±»çš„æ–¹æ³•ï¼Œè°ƒç”¨éœ€è¦å…·ä½“çš„å¯¹è±¡ã€‚</span><br><span class="line">2.sleepæ˜¯ä¸é‡Šæ”¾é”çš„ï¼Œè§£é™¤æ–¹æ³•è¦ä¹ˆæ˜¯timeoutï¼Œæˆ–è€…interruptä¸€ä¸‹è®©å®ƒæŠ›å‡ºInterruptedExceptionã€‚waitæ˜¯é‡Šæ”¾é”çš„ï¼Œå¯ä»¥è¢«notify/notifyAllæ¢å¤ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥timeoutæˆ–è€…interruptã€‚</span><br><span class="line">3.sleepåœ¨å“ªé‡Œéƒ½å¯ä»¥è°ƒç”¨ï¼Œwaitå¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—é‡Œè°ƒç”¨ï¼Œå¹¶ä¸”åŒæ­¥çš„å¯¹è±¡è¦è·Ÿwaitçš„å¯¹è±¡ä¸€æ ·ã€‚</span><br><span class="line">4.sleepä½œç”¨åªæ˜¯çº¿ç¨‹çš„æ“ä½œï¼Œç”¨äºçŸ­æ—¶é—´æš‚åœçº¿ç¨‹ï¼Œwait/notifyå¯ä»¥ç”¨ä½œçº¿ç¨‹é—´é€šä¿¡ï¼Œè¾¾åˆ°èµ„æºè°ƒåº¦çš„åŠŸèƒ½ã€‚</span><br><span class="line"></span><br><span class="line">Thread.yield():</span><br><span class="line">yieldæ–¹æ³•ä¹Ÿæ˜¯Threadç±»çš„é™æ€æ–¹æ³•ï¼Œé‡æ–°åˆ†é…ã€‚</span><br><span class="line">ä¼šæŠŠå½“å‰çº¿ç¨‹ä»å¯è¿è¡ŒçŠ¶æ€å˜æˆå°±ç»ªçŠ¶æ€ã€‚</span><br><span class="line">ä¹‹åä¼šcpuä¼šä»ä¼—å¤šå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ¥æ‰§è¡Œã€‚</span><br><span class="line"></span><br><span class="line">thread.join():</span><br><span class="line">joinæ˜¯Threadç±»æ–¹æ³•ï¼Œéé™æ€ï¼Œè¡¨ç¤ºç­‰å¾…è¯¥çº¿ç¨‹ç»“æŸï¼Œå½“å‰çº¿ç¨‹æ‰ç»§ç»­æ‰§è¡Œ</span><br><span class="line">joinè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</span><br><span class="line"></span><br><span class="line">çº¿ç¨‹ä¸­æ–­ï¼š</span><br><span class="line">suspend()æš‚åœå’Œresume()ç»§ç»­å®¹æ˜“é€ æˆæ­»é”ï¼Œstop()å…·æœ‰å›ºæœ‰çš„ä¸å®‰å…¨æ€§ã€‚å·²åºŸå¼ƒã€‚</span><br><span class="line">ç»ˆæ­¢çº¿ç¨‹çš„å‡ ç§æ–¹å¼ï¼š</span><br><span class="line">1.è®¾è®¡æ ‡è®°ä½æ³•ï¼švolatileçš„booleanç±»å‹å˜é‡æ¥æ§åˆ¶</span><br><span class="line">ç¼ºç‚¹ï¼šå¦‚æœä»£ç å¹¶æ²¡æœ‰è¿™ç§å¾ªç¯è¯­å¥ï¼Œæˆ–è€…çº¿ç¨‹è¢«å…¶ä»–è¯­å¥é˜»å¡äº†ï¼Œçº¿ç¨‹å¯èƒ½ä¸€ç›´ä¸ä¼šå»æ£€æŸ¥æ ‡è®°ä½ã€‚</span><br><span class="line">2.thread.interrupt()æ–¹æ³•ä¸­æ–­</span><br><span class="line">çº¿ç¨‹é‡Œæœ‰ä¸€ä¸ªbooleanç±»å‹çš„ä¸­æ–­çŠ¶æ€ï¼Œæ˜¯ä¸€ä¸ªæ ‡è®°ä½ï¼Œæ˜¯å­˜åœ¨Nativeå±‚çš„ã€‚</span><br><span class="line">å½“ä½¿ç”¨Threadçš„interrupt()æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä¼šè¢«è®¾ç½®ä¸ºtrueã€‚</span><br><span class="line">ä¸€äº›é˜»å¡æ–¹æ³•å°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸InterruptedExceptionã€‚å¦‚æœæ²¡æœ‰è¿™ç§é˜»å¡æ–¹æ³•ï¼Œé‚£å°±ä»€ä¹ˆéƒ½ä¸ä¼šåšã€‚</span><br><span class="line">interrupt()æ–¹æ³•æ˜¯å®ä¾‹æ–¹æ³•</span><br><span class="line">è¿˜æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šisInterrupted() å’Œ interrupted() </span><br><span class="line">ç›¸åŒç‚¹æ˜¯è¿™ä¸¤ä¸ªéƒ½æ˜¯è¿”å›ä¸€ä¸ªbooleanå€¼ï¼Œtrueè¡¨ç¤ºä¸­æ–­ï¼Œfalseè¡¨ç¤ºæœªè¢«ä¸­æ–­ã€‚</span><br><span class="line">ä¸åŒç‚¹æ˜¯interrupted()æ˜¯é™æ€æ–¹æ³•ï¼Œåªèƒ½åœ¨å½“å‰çº¿ç¨‹è°ƒç”¨ï¼Œåˆ¤æ–­æ˜¯trueåä¼šæ¸…é™¤æ ‡è®°ï¼Œä¹Ÿå°±æ˜¯é‡ç½®ä¸ºfalseã€‚isInterrupted()æ˜¯å®ä¾‹æ–¹æ³•ï¼Œä¸ä¼šæ¸…é™¤æ ‡è®°ï¼Œæ‰€ä»¥å¯ä»¥å¤šæ¬¡åˆ¤æ–­ã€‚</span><br><span class="line"></span><br><span class="line">*åœ¨Thread.sleepè¿™äº›æ–¹æ³•ï¼ŒæŠ›å‡ºInterruptedExceptionå¼‚å¸¸åä¼šæ¸…é™¤æ ‡è®°ä½çŠ¶æ€ã€‚</span><br><span class="line">ä¸€ä¸ªå…³äºä¸­æ–­çš„ä¾‹å­è§ä¸‹é¢ä»£ç </span><br><span class="line"></span><br><span class="line">*æ‰€è°“çš„interruptçº¿ç¨‹ä¸­æ–­ï¼Œåªæ˜¯ä¿®æ”¹äº†ä¸€ä¸ªæ ‡è®°ä½ï¼Œéœ€è¦æˆ‘ä»¬åˆ¤æ–­æ ‡è®°ä½åšåç»­çš„å¤„ç†ã€‚</span><br><span class="line">å¦‚æœcatchä»£ç å—ä»€ä¹ˆéƒ½ä¸å¤„ç†ï¼Œä¼šç»§ç»­è·‘å®Œå‰©ä¸‹çš„ä»£ç ã€‚æ‰€ä»¥åº”è¯¥ç†è§£ä¸ºã€å¹¶ä¸æ˜¯ä¸­æ–­ï¼Œè€Œæ˜¯é€šçŸ¥ä½ åº”è¯¥è‡ªè¡Œä¸­æ–­äº†ã€</span><br><span class="line">çº¿ç¨‹ä¸åº”è¯¥äº¤ç»™åˆ«çš„çº¿ç¨‹ä¸­æ–­ï¼Œåº”è¯¥ç”±è‡ªå·±ä¸­æ–­è‡ªå·±ï¼Œè¿‡ç¨‹ä¸­ä¿è¯èµ„æºå’Œå˜é‡å·²åˆç†çš„å¤„ç†äº†ï¼ˆè¯¥å…³çš„å…³ï¼Œè¯¥é‡Šæ”¾çš„é‡Šæ”¾ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">çº¿ç¨‹é˜»å¡ï¼š</span><br><span class="line">é˜»å¡å’Œéé˜»å¡æ˜¯å½¢å®¹å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„ç›¸äº’å½±å“çš„ï¼Œä¸€ä¸ªçº¿ç¨‹å ç”¨äº†ä¸´ç•ŒåŒºèµ„æºï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹å¿…é¡»åœ¨ä¸´ç•ŒåŒºå¤–ç­‰å¾…ã€‚</span><br><span class="line">å¦‚æœä¸€ä¸ªçº¿ç¨‹ä¸€ç›´å ç”¨ä¸é‡Šæ”¾èµ„æºï¼Œé‚£ä¹ˆå…¶ä»–éœ€è¦è¯¥ä¸´ç•ŒåŒºèµ„æºçš„çº¿ç¨‹éƒ½å¿…é¡»ä¸€ç›´ç­‰å¾…ã€‚</span><br><span class="line">éé˜»å¡å°±æ˜¯è¿è¡Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºï¼Œåªè¦ä¿è¯ä¸æŠŠæ•°æ®ä¿®æ”¹åå°±è¡Œã€‚</span><br><span class="line"></span><br><span class="line">çº¿ç¨‹é˜»å¡çš„åœºæ™¯ï¼š</span><br><span class="line">è¿è¡Œçš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥é”æ± ä¸­ã€‚</span><br><span class="line">å‘å‡ºI/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡çŠ¶æ€ï¼ŒI/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚</span><br><span class="line"></span><br><span class="line">çº¿ç¨‹é˜»å¡å’Œç­‰å¾…çš„åŒºåˆ«ï¼š</span><br><span class="line">åœ¨javaä¸­ï¼Œçº¿ç¨‹é˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹æœ¬èº«ä¸å¯è®¡åˆ’çš„ï¼Œè€Œçº¿ç¨‹ç­‰å¾…çŠ¶æ€æ˜¯çº¿ç¨‹æœ¬èº«è®¡åˆ’ä¹‹å†…çš„ã€‚</span><br><span class="line">ç›¸åŒç‚¹ï¼š</span><br><span class="line">ï¼ˆ1ï¼‰éƒ½ä¼šæš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚</span><br><span class="line">åŒºåˆ«ç‚¹ï¼š</span><br><span class="line">ï¼ˆ1ï¼‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€æ˜¯è¢«åŠ¨çš„, è€Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€æ˜¯ä¸»åŠ¨çš„ã€‚</span><br><span class="line">é˜»å¡çŠ¶æ€çš„è¢«åŠ¨ï¼šçº¿ç¨‹åœ¨åŒæ­¥ä»£ç å¤–ï¼Œè·å–å¯¹è±¡é”å¤±è´¥æ—¶ï¼Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼›ä½•æ—¶è·å–å¯¹è±¡é”å¤±è´¥ä¸å¯çŸ¥ï¼Œå³çº¿ç¨‹é˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹æœ¬èº«ä¸å¯è®¡åˆ’çš„ã€‚</span><br><span class="line">ç­‰å¾…çŠ¶æ€çš„ä¸»åŠ¨ï¼šçº¿ç¨‹åœ¨åŒæ­¥ä»£ç å†…ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹æ“ä½œæ—¶ï¼Œçº¿ç¨‹æ¥å…¥ç­‰å¾…çŠ¶æ€ï¼›ä½•æ—¶ç­‰å¾…å…¶ä»–çº¿ç¨‹æ“ä½œå¯çŸ¥ï¼Œå³çº¿ç¨‹ç­‰å¾…çŠ¶æ€æ˜¯çº¿ç¨‹æœ¬èº«è®¡åˆ’ä¹‹å†…çš„ã€‚</span><br><span class="line"></span><br><span class="line">countDownLatch/cyclicBarrierçš„awaitæ–¹æ³•è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¼šä¸ä¼šé‡Šæ”¾é”ï¼Ÿ</span><br><span class="line">ç»æµ‹è¯•ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œä¸ä¼šé‡Šæ”¾é”ã€‚</span><br><span class="line"></span><br><span class="line">æ€»ç»“ï¼š</span><br><span class="line">waitè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé‡Šæ”¾é”ã€‚</span><br><span class="line">sleepè¿›å…¥å®šæ—¶ç­‰å¾…çŠ¶æ€ï¼Œä¸é‡Šæ”¾é”ã€‚</span><br><span class="line">awaitè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸é‡Šæ”¾é”ã€‚</span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹ä¸­æ–­çš„è®²è§£ï¼š<a href="https://blog.csdn.net/alcoholdi/article/details/79475029">https://blog.csdn.net/alcoholdi/article/details/79475029</a></p>
<p>å…³äºçº¿ç¨‹ä¸­æ–­çš„æºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Thread implements Runnable &#123;</span><br><span class="line"> </span><br><span class="line">    // ä¸­æ–­ç›®æ ‡çº¿ç¨‹</span><br><span class="line">    public void interrupt() &#123;</span><br><span class="line">        if (this != Thread.currentThread())</span><br><span class="line">            checkAccess();</span><br><span class="line"> </span><br><span class="line">        synchronized (blockerLock) &#123;</span><br><span class="line">            Interruptible b = blocker;</span><br><span class="line">            if (b != null) &#123;</span><br><span class="line">                interrupt0();           // Just to set the interrupt flag</span><br><span class="line">                b.interrupt(this);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        interrupt0();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    // è¿”å›ç›®æ ‡çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€	staticåœ¨è¿™é‡Œç†è§£ä¸ºï¼šåªä¾›å½“å‰çº¿ç¨‹ä½¿ç”¨è¿™ä¸ªæ–¹æ³•</span><br><span class="line">    public static boolean interrupted() &#123;</span><br><span class="line">        return currentThread().isInterrupted(true);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    // åˆ¤æ–­ç›®æ ‡çº¿ç¨‹æ˜¯å¦ä¸­æ–­</span><br><span class="line">    public boolean isInterrupted() &#123;</span><br><span class="line">        return isInterrupted(false);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    private native boolean isInterrupted(boolean ClearInterrupted);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªå…³äºä¸­æ–­çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-18 09:06</span><br><span class="line"> **/</span><br><span class="line">public class InterruptDemo &#123;</span><br><span class="line"></span><br><span class="line">    private static SimpleDateFormat sdf = new SimpleDateFormat(&quot;HH:mm:ss:SSS&quot;);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">//        InterruptThread t = new InterruptThread();</span><br><span class="line">        Interrupt2Thread t = new Interrupt2Thread();</span><br><span class="line">//        Interrupt3Thread t = new Interrupt3Thread();</span><br><span class="line"></span><br><span class="line">        t.start();</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(3500);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        t.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class InterruptThread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    // æŠ›å‡ºInterruptedExceptionåä¸­æ–­æ ‡å¿—è¢«æ¸…é™¤</span><br><span class="line">                    // åœ¨catchä¸­ç›´æ¥returnç»“æŸçº¿ç¨‹</span><br><span class="line">                    System.out.println(sdf.format(new Date()) + Thread.currentThread() + &quot; catch &quot; + isInterrupted() + &quot; &quot; + interrupted()); //false false</span><br><span class="line">                    System.out.println(sdf.format(new Date()) + Thread.currentThread() + &quot; &quot; + isInterrupted()+ &quot; &quot; + interrupted()); //false false</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(sdf.format(new Date()) + Thread.currentThread() + &quot; &quot; + isInterrupted()+ &quot; &quot; + interrupted()); //ä¸è¾“å‡º</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Interrupt2Thread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while (!isInterrupted()) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    // æŠ›å‡ºInterruptedExceptionåä¸­æ–­æ ‡å¿—è¢«æ¸…é™¤</span><br><span class="line">                    // å¯ä»¥å†æ¬¡è°ƒç”¨interruptæ¢å¤ä¸­æ–­</span><br><span class="line">                    // catchä¸­å†æ¬¡è°ƒç”¨interruptæ¢å¤ä¸­æ–­çŠ¶æ€ï¼Œwhileä¸­ä¸‹æ¬¡åˆ¤æ–­isInterrupted()ä¸­ç»“æŸçº¿ç¨‹</span><br><span class="line">                    System.out.println(sdf.format(new Date()) + Thread.currentThread() + &quot; catch &quot; + isInterrupted()+ &quot; &quot; + interrupted()); //false false</span><br><span class="line">                    //interrupt();</span><br><span class="line">                    //å¦‚æœä¸åœ¨catché‡Œå†ä¸­æ–­ï¼Œä¼šä¸€ç›´æ‰§è¡Œ</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(sdf.format(new Date()) + Thread.currentThread() + &quot; &quot; + isInterrupted()+ &quot; &quot;);</span><br><span class="line">//                System.out.println(sdf.format(new Date()) + Thread.currentThread() + &quot; &quot; + isInterrupted()+ &quot; &quot; + interrupted());</span><br><span class="line">                //å¦‚æœç”¨äº†ä¸Šé¢çš„é‚£ä¸ªï¼Œä¸­æ–­æ ‡è¯†ä¸ºä¼šè¾“å‡ºtrueåè¢«é‡ç½®ä¸ºfalseï¼Œç»§ç»­å¾ªç¯ï¼Œä¸ä¼šåœ</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Interrupt3Thread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">        @SneakyThrows</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while (!isInterrupted()) &#123;</span><br><span class="line">                Thread.sleep(1000);</span><br><span class="line">                // æŠ›å‡ºInterruptedExceptionåä¸­æ–­æ ‡å¿—è¢«æ¸…é™¤</span><br><span class="line">                // å¯ä»¥å†æ¬¡è°ƒç”¨interruptæ¢å¤ä¸­æ–­</span><br><span class="line">                // catchä¸­å†æ¬¡è°ƒç”¨interruptæ¢å¤ä¸­æ–­çŠ¶æ€ï¼Œwhileä¸­ä¸‹æ¬¡åˆ¤æ–­isInterrupted()ä¸­ç»“æŸçº¿ç¨‹</span><br><span class="line">                System.out.println(sdf.format(new Date()) + Thread.currentThread() + &quot; catch &quot; + isInterrupted()+ &quot; &quot; + interrupted()); //false false</span><br><span class="line">                interrupt();</span><br><span class="line">                //System.out.println(sdf.format(new Date()) + Thread.currentThread() + &quot; &quot; + isInterrupted()+ &quot; &quot;);</span><br><span class="line">                System.out.println(sdf.format(new Date()) + Thread.currentThread() + &quot; &quot; + isInterrupted()+ &quot; &quot; + interrupted());</span><br><span class="line">                //å¦‚æœç”¨äº†ä¸Šé¢çš„é‚£ä¸ªï¼Œä¸­æ–­æ ‡è¯†ä¸ºä¼šè¾“å‡ºtrueåè¢«é‡ç½®ä¸ºfalseï¼Œç»§ç»­å¾ªç¯ï¼Œç›´åˆ°åœ¨ä¸»çº¿ç¨‹å†…ä¸­æ–­ï¼ŒæŠ›å‡ºInterruptedException</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•awaitæ–¹æ³•ä¼šä¸ä¼šé‡Šæ”¾é”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-18 22:33</span><br><span class="line"> **/</span><br><span class="line">public class AwaitTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Object lock = 1;</span><br><span class="line">        CountDownLatch countDownLatch = new CountDownLatch(1);</span><br><span class="line">        Thread thread1 = new Thread()&#123;</span><br><span class="line">            @SneakyThrows</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                synchronized (lock) &#123;</span><br><span class="line">                    System.out.println(&quot;thread1 get lock&quot;);</span><br><span class="line">                    countDownLatch.await();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Thread thread2 = new Thread(() -&gt; &#123;</span><br><span class="line">            synchronized (lock) &#123;</span><br><span class="line">                System.out.println(&quot;thread2 get lock&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CyclicBarrierçš„ä½¿ç”¨åœºæ™¯ï¼šå¤šç”¨äºå¤šçº¿ç¨‹è®¡ç®—æ•°æ®ï¼Œæœ€ååˆå¹¶è®¡ç®—ç»“æœçš„åœºæ™¯ã€‚<br>ä¸€ä¸ªåˆå¹¶è®¡ç®—ç»“æœçš„ä¾‹å­ï¼Œç”¨äº†barrierActionå‚æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.concurrent.ConcurrentHashMap;</span><br><span class="line">import java.util.concurrent.CyclicBarrier;</span><br><span class="line">import java.util.concurrent.ExecutorService;</span><br><span class="line">import java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-18 23:02</span><br><span class="line"> **/</span><br><span class="line">public class CyclicDemo &#123;</span><br><span class="line"></span><br><span class="line">    private static SimpleDateFormat sdf = new SimpleDateFormat(&quot;HH:mm:ss:SSS&quot;);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        BankWaterService bankWaterService = new BankWaterService();</span><br><span class="line">        bankWaterService.count();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class BankWaterService implements Runnable &#123;</span><br><span class="line">        private final CyclicBarrier c = new CyclicBarrier(4, this);  //è¿™é‡Œå±éšœè§£é™¤åæ‰§è¡Œæœ¬çº¿ç¨‹ã€‚</span><br><span class="line">        private final ExecutorService executor = Executors.newFixedThreadPool(4);</span><br><span class="line">        private final ConcurrentHashMap&lt;String, Integer&gt; sheetBankWaterCount = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        private void count() &#123;</span><br><span class="line">            for (int i = 0; i &lt; 4; i++) &#123;</span><br><span class="line">                executor.execute(new Runnable() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void run() &#123;</span><br><span class="line">                        sheetBankWaterCount.put(Thread.currentThread().getName(), 3);</span><br><span class="line">                        try &#123;</span><br><span class="line">                            c.await();</span><br><span class="line">                            System.out.println(sdf.format(new Date()) + &quot; &quot; + Thread.currentThread().getName());</span><br><span class="line">                        &#125; catch (Exception e) &#123;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            int result = 0;</span><br><span class="line">            for (Map.Entry&lt;String, Integer&gt; sheet : sheetBankWaterCount.entrySet()) &#123;</span><br><span class="line">                result += sheet.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(sdf.format(new Date()) + &quot; &quot; + &quot;result:&quot; + result);</span><br><span class="line">            executor.shutdownNow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«"><a href="#3-CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«" class="headerlink" title="3.CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«"></a>3.CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«</h3><p>1ã€ä½¿ç”¨çš„åœºæ™¯ä¸ä¸€æ ·ï¼ŒCyclicBarrieré˜»å¡æ¯ä¸ªçº¿ç¨‹ï¼ˆæ¯ä¸ªçº¿ç¨‹éƒ½ç­‰å¾…æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœï¼‰ï¼Œåƒåˆ†å¸ƒå¼é—®é¢˜ï¼Œå±éšœæ¸…é™¤äº†ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥ç»§ç»­åšè‡ªå·±çš„äº‹æƒ…ï¼›CountDownLatché˜»å¡ç­‰å¾…çº¿ç¨‹ï¼ˆç­‰å¾…çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆï¼‰å‘é›†ä¸­å¼çš„ï¼Œæœ€åç”±ç­‰å¾…çº¿ç¨‹ç»Ÿä¸€å¤„ç†ã€‚</p>
<p>2ã€CountDownLatchçš„è®¡æ•°å™¨åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè€ŒCyclicBarrierçš„è®¡æ•°å™¨å¯ä»¥ä½¿ç”¨reset()æ–¹æ³•é‡ç½®ã€‚æ‰€ä»¥CyclicBarrierèƒ½å¤„ç†æ›´ä¸ºå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¡ç®—å‘ç”Ÿé”™è¯¯ï¼Œå¯ä»¥é‡ç½®è®¡æ•°å™¨ï¼Œå¹¶è®©çº¿ç¨‹é‡å¼„ä¸‹æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p>3ã€CyclicBarrierè¿˜æä¾›å…¶ä»–æœ‰ç”¨çš„æ–¹æ³•ï¼Œæ¯”å¦‚getNumberWaitingæ–¹æ³•å¯ä»¥è·å¾—CyclicBarrieré˜»å¡çš„çº¿ç¨‹æ•°é‡ã€‚isBroken()æ–¹æ³•ç”¨æ¥äº†è§£é˜»å¡çš„çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ã€‚</p>
<p>cyclicBarrierçº¿ç¨‹ä¸­æ–­ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.CyclicBarrier;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-19 18:37</span><br><span class="line"> **/</span><br><span class="line">public class CyclicInterruptTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        CyclicBarrier c = new CyclicBarrier(3);</span><br><span class="line">        Thread thread = new Thread(() -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                c.await();</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                //e.printStackTrace();</span><br><span class="line">                System.out.println(e);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(2);</span><br><span class="line">        &#125;);</span><br><span class="line">        thread.start();</span><br><span class="line">        thread.interrupt();</span><br><span class="line">        try &#123;</span><br><span class="line">            c.await();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            System.out.println(c.isBroken());</span><br><span class="line">//            e.printStackTrace();</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">java.lang.InterruptedException</span><br><span class="line">2</span><br><span class="line">true</span><br><span class="line">java.util.concurrent.BrokenBarrierException</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼šå°½ç®¡å±éšœæ•°æ˜¯3ï¼Œä½†æ˜¯å…¶ä¸­ä¸€ä¸ªä¸­æ–­äº†çš„è¯ï¼Œå…¶ä»–çš„awaitä¹Ÿä¼šè·‘å‡ºå¼‚å¸¸ã€‚è¢«ä¸­æ–­çš„æŠ›å‡ºInterruptedExceptionï¼Œå…¶ä»–çš„æŠ›å‡ºBrokenBarrierExceptionã€‚</p>
<h3 id="4-æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°çš„Semaphore"><a href="#4-æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°çš„Semaphore" class="headerlink" title="4.æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°çš„Semaphore"></a>4.æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°çš„Semaphore</h3><p>Semaphoreï¼ˆä¿¡å·é‡ï¼‰æ˜¯ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œå®ƒé€šè¿‡åè°ƒå„ä¸ªçº¿ç¨‹ï¼Œä»¥ä¿è¯åˆç†çš„ä½¿ç”¨å…¬å…±èµ„æºã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šSemaphoreå¯ä»¥åšæµé‡æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯å…¬ç”¨èµ„æºæœ‰é™çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥ã€‚<br>å‡å¦‚æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œè¦è¯»å–å‡ ä¸‡ä¸ªæ–‡ä»¶çš„æ•°æ®ï¼Œå› ä¸ºéƒ½æ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨å‡ åä¸ªçº¿ç¨‹å¹¶å‘çš„è¯»å–ï¼Œä½†æ˜¯å¦‚æœè¯»åˆ°å†…å­˜åï¼Œè¿˜éœ€è¦å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œè€Œæ•°æ®åº“è¿æ¥æ•°åªæœ‰10ä¸ªï¼Œè¿™æ˜¯æˆ‘ä»¬å¿…é¡»æ§åˆ¶åªæœ‰10ä¸ªçº¿ç¨‹åŒæ—¶è·å–æ•°æ®åº“è¿æ¥ä¿æŒæ•°æ®ï¼Œå¦åˆ™ä¼šæŠ¥é”™æ— æ³•è·å–æ•°æ®åº“è¿æ¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨Semaphoreæ¥åšæµé‡æ§åˆ¶ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private static final int THREAD_COUNT = 30;</span><br><span class="line">private static final ExecutorService executorService = Executors.newFixedThreadPool(THREAD_COUNT);</span><br><span class="line">private static final Semaphore s = new Semaphore(10);</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    for (int i = 0; i &lt; THREAD_COUNT; i++) &#123;</span><br><span class="line">        executorService.execute(() -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                s.acquire();</span><br><span class="line">                System.out.println(&quot;save data&quot;);</span><br><span class="line">                s.release();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    executorService.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶æœ‰30ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œä½†æ˜¯åªå…è®¸10ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚<br>ä¸ºä»€ä¹ˆä¸å¼€å§‹åˆ›å»º10ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± å‘¢ï¼Ÿå› ä¸ºå‰é¢éœ€è¦30ä¸ªï¼Œåªæ˜¯åœ¨ä»£ç æŸéƒ¨åˆ†é™åˆ¶10ä¸ªã€‚<br>æ„é€ æ–¹æ³•Semaphore(int permits)æ¥æ”¶ä¸€ä¸ªæ•´å‹çš„æ•°ç»„ï¼Œè¡¨ç¤ºå¯ç”¨çš„è®¸å¯è¯æ•°é‡ã€‚<br>Semaphoreçš„acquire()æ–¹æ³•è·å–ä¸€ä¸ªè®¸å¯è¯ï¼Œè·å–ä¸åˆ°å°±é˜»å¡ï¼Œä½¿ç”¨å®Œä¹‹åè°ƒç”¨release()æ–¹æ³•å½’è¿˜è®¸å¯è¯ã€‚è¿˜å¯ä»¥ä½¿ç”¨tryAcquire()æ–¹æ³•å°è¯•è·å–è®¸å¯è¯ã€‚</p>
<p>å…¶ä»–æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">intavailablePermits():è¿”å›ä¿¡å·é‡ä¸­å½“å‰å¯ç”¨çš„è®¸å¯è¯æ•°ç›®ã€‚</span><br><span class="line">ingetQueueLength():è¿”å›æ­£åœ¨ç­‰å¾…è·å–è®¸å¯è¯çš„çº¿ç¨‹æ•°ã€‚</span><br><span class="line">booleanhasQueueThreads():æ˜¯å¦æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–è®¸å¯è¯</span><br><span class="line">void reducePermits(int reduction):å‡å°‘reductionä¸ªè®¸å¯è¯ï¼Œæ˜¯ä¸ªprotectedæ–¹æ³•ã€‚</span><br><span class="line">Collection getQueuedThreads():è¿”å›æ‰€æœ‰ç­‰å¾…è·å–è®¸å¯è¯çš„çº¿ç¨‹é›†åˆï¼Œæ˜¯ä¸ªprotectedæ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="5-çº¿ç¨‹é—´äº¤äº’æ•°æ®çš„Exchanger"><a href="#5-çº¿ç¨‹é—´äº¤äº’æ•°æ®çš„Exchanger" class="headerlink" title="5.çº¿ç¨‹é—´äº¤äº’æ•°æ®çš„Exchanger"></a>5.çº¿ç¨‹é—´äº¤äº’æ•°æ®çš„Exchanger</h3><p>Exchangerï¼ˆäº¤æ¢è€…ï¼‰æ˜¯ä¸€ä¸ªç”¨äºçº¿ç¨‹é—´åä½œçš„å·¥å…·ç±»ã€‚Exchangerç”¨äºè¿›è¡Œçº¿ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚å®ƒæä¾›ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œåœ¨è¿™ä¸ªåŒæ­¥ç‚¹ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯ä»¥äº¤æ¢å½¼æ­¤çš„æ•°æ®ã€‚è¿™ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡exhange()æ–¹æ³•äº¤æ¢æ•°æ®ï¼Œå¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œexhange()æ–¹æ³•ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡Œexchangeæ–¹æ³•ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½è¾¾åˆ°åŒæ­¥ç‚¹æ—¶ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹å°±å¯ä»¥äº¤æ¢æ•°æ®ï¼Œå°†æœ¬çº¿ç¨‹ç”Ÿäº§å‡ºæ¥çš„æ•°æ®ä¼ é€’ç»™å¯¹æ–¹ã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šå¯ç”¨äºé—ä¼ ç®—æ³•ï¼Œå°†ä¸¤ä¸ªäººä½œä¸ºäº¤é…å¯¹è±¡ï¼Œäº¤æ¢ä¸¤ä¸ªäººçš„æ•°æ®ã€‚è¿˜å¯ä»¥ç”¨äºæ ¡å¯¹å·¥ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦å°†çº¸è´¨é“¶è¡Œæµæ°´é€šè¿‡äººå·¥çš„æ–¹å¼å½•å…¥æˆç”µå­é“¶è¡Œæµæ°´ï¼Œä¸ºäº†é¿å…é”™è¯¯ï¼Œé‡‡ç”¨ABå²—ä¸¤äººè¿›è¡Œå½•å…¥ï¼Œå½•å…¥ä¹‹åæ¯”å¯¹ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.javaer;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.Exchanger;</span><br><span class="line">import java.util.concurrent.ExecutorService;</span><br><span class="line">import java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-11-19 19:23</span><br><span class="line"> **/</span><br><span class="line">public class ExchangerTest &#123;</span><br><span class="line">    private static final Exchanger&lt;String&gt; exgr = new Exchanger&lt;&gt;();</span><br><span class="line">    private static final ExecutorService threadPool = Executors.newFixedThreadPool(2);</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        threadPool.execute(() -&gt; &#123;</span><br><span class="line">            String a = &quot;é“¶è¡Œæµæ°´A&quot;;</span><br><span class="line">            try &#123;</span><br><span class="line">                String exchange = exgr.exchange(a);</span><br><span class="line">                System.out.println(&quot;B å½•å…¥çš„æ˜¯:&quot; + exchange + &quot; Aå½•å…¥çš„æ˜¯ï¼š&quot; + a);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        threadPool.execute(() -&gt; &#123;</span><br><span class="line">            String b = &quot;é“¶è¡Œæµæ°´B&quot;;</span><br><span class="line">            try &#123;</span><br><span class="line">                String exchange = exgr.exchange(b);</span><br><span class="line">                System.out.println(&quot;A å½•å…¥çš„æ˜¯:&quot; + exchange + &quot; Bå½•å…¥çš„æ˜¯ï¼š&quot; + b);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸¤ä¸ªçº¿ç¨‹ä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œexchange()æ–¹æ³•ï¼Œåˆ™ä¼šä¸€ç›´ç­‰å¾…ï¼Œå¦‚æœå•å‘ç‰¹æ®Šæƒ…å†µå‘ç”Ÿï¼Œé¿å…ä¸€ç›´ç­‰å¾…ï¼Œå¯ä»¥ä½¿ç”¨<code>exchange(V x, long timeout, TimeUnit unit)</code>è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´ã€‚</p>
<p>åŸä¹¦ç¬”è®°ï¼š<a href="https://blog.csdn.net/tianzhonghaoqing/article/details/123976376">https://blog.csdn.net/tianzhonghaoqing/article/details/123976376</a></p>
<h2 id="ç¬¬ä¹ç« -javaä¸­çš„çº¿ç¨‹æ± "><a href="#ç¬¬ä¹ç« -javaä¸­çš„çº¿ç¨‹æ± " class="headerlink" title="ç¬¬ä¹ç«  javaä¸­çš„çº¿ç¨‹æ± "></a>ç¬¬ä¹ç«  javaä¸­çš„çº¿ç¨‹æ± </h2><p>åˆç†åœ°ä½¿ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¸¦æ¥3ä¸ªå¥½å¤„ï¼š<br>é™ä½èµ„æºæ¶ˆè€—(é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—)<br>æé«˜å“åº”é€Ÿåº¦(å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œ)<br>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§(çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§çº¿ç¨‹)</p>
<h3 id="1-çº¿ç¨‹æ± çš„å®ç°åŸç†"><a href="#1-çº¿ç¨‹æ± çš„å®ç°åŸç†" class="headerlink" title="1.çº¿ç¨‹æ± çš„å®ç°åŸç†"></a>1.çº¿ç¨‹æ± çš„å®ç°åŸç†</h3><p>ThreadPoolExecutoræ‰§è¡Œexecuteæ–¹æ³•åˆ†ä¸‹é¢4ç§æƒ…å†µï¼š</p>
<p>1ã€å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹å°‘äºcorePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¸ç®¡å·²æœ‰çº¿ç¨‹æ˜¯ä¸æ˜¯ç©ºé—²(éœ€è¦è·å–å…¨å±€é”)</p>
<p>2ã€å¦‚æœè¿è¡Œçš„çº¿ç¨‹ç­‰äºæˆ–å¤šäºcorePoolSizeï¼Œåˆ™å°†ä»»åŠ¡åŠ å…¥BlockingQueue</p>
<p>3ã€å¦‚æœBlockingQueueé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹(éæ ¸å¿ƒçº¿ç¨‹)æ¥å¤„ç†ä»»åŠ¡(éœ€è¦è·å–å…¨å±€é”ï¼‰</p>
<p>4ã€å¦‚æœåˆ›å»ºæ–°çº¿ç¨‹å°†ä½¿å½“å‰è¿è¡Œçš„çº¿ç¨‹è¶…å‡ºmaximumPoolSizeï¼Œä»»åŠ¡å°†è¢«æ‹’ç»ï¼Œå¹¶è°ƒç”¨RejectedExecutionHandler.rejectedExecution()æ–¹æ³•</p>
<p>å·¥ä½œçº¿ç¨‹ï¼šçº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œä¼šå°†çº¿ç¨‹å°è£…æˆå·¥ä½œçº¿ç¨‹Workerï¼ŒWorkeråœ¨æ‰§è¡Œå®Œä»»åŠ¡åï¼Œè¿˜ä¼šå¾ªç¯è·å–å·¥ä½œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡æ¥æ‰§è¡Œã€‚</p>
<h3 id="2-çº¿ç¨‹æ± çš„åˆ›å»º"><a href="#2-çº¿ç¨‹æ± çš„åˆ›å»º" class="headerlink" title="2.çº¿ç¨‹æ± çš„åˆ›å»º"></a>2.çº¿ç¨‹æ± çš„åˆ›å»º</h3><p><code>new ThreadPoolExecutor(xxx)</code>ï¼Œå…¶ä¸­å‚æ•°å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š</p>
<p>1ã€corePoolSize(çº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°)ï¼šå½“æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡(å³ä½¿å…¶ä»–ç©ºé—²çš„åŸºæœ¬çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°ä»»åŠ¡ä¹Ÿä¼šåˆ›å»ºï¼Œæ»¡äº†ä¸å†åˆ›å»ºã€‚ï¼‰å¦‚æœè°ƒç”¨äº†çº¿ç¨‹æ± çš„prestartAllCoreThreads()æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰åŸºæœ¬çº¿ç¨‹ã€‚</p>
<p>2ã€runnableTaskQueue(ä»»åŠ¡é˜Ÿåˆ—)ï¼šç”¨äºä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ArrayBlockingQueue:åŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOåŸåˆ™å¯¹å…ƒç´ æ’åºã€‚</span><br><span class="line"></span><br><span class="line">LinkedBlockingQueue:åŸºäºé“¾è¡¨ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒFIFOåŸåˆ™ï¼Œååé‡é«˜äºArrayBlockingQueueï¼Œ</span><br><span class="line">é™æ€å·¥å‚æ–¹æ³•Executors.newFixedThreadPool()ä½¿ç”¨è¯¥é˜Ÿåˆ—ã€‚</span><br><span class="line"></span><br><span class="line">SynchronousQueue:ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´é˜»å¡ã€‚ååé‡é«˜äºLinkedBlockingQueueã€‚</span><br><span class="line">é™æ€å·¥å‚æ–¹æ³•Executors.newCachedThreadPoolä½¿ç”¨è¯¥é˜Ÿåˆ—ã€‚</span><br><span class="line"></span><br><span class="line">PriorityBlockingQueue:ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡é˜Ÿåˆ—ã€‚</span><br></pre></td></tr></table></figure>

<p>3ã€maximumPoolSize(çº¿ç¨‹æ± æœ€å¤§æ•°é‡)ï¼šçº¿ç¨‹æ± å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™çº¿ç¨‹æ± ä¼šå†åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œæ”¹å‚æ•°æ²¡æ•ˆæœã€‚</p>
<p>4ã€ThreadFactoryï¼šè®¾ç½®åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œå¯ä»¥ç»™çº¿ç¨‹å‘½åã€‚</p>
<p>5ã€RejectedExecutionHandler(é¥±å’Œç­–ç•¥)ï¼šå½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œåˆ™é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AbortPolicy(é»˜è®¤)ï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</span><br><span class="line">CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡ã€‚</span><br><span class="line">DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡</span><br><span class="line">DiscardPolicyï¼šä¸å¤„ç†ï¼Œä¸¢å¼ƒæ‰ä¸”ä¸æŠ›å‡ºå¼‚å¸¸</span><br></pre></td></tr></table></figure>

<p>6ã€keepAliveTime(çº¿ç¨‹æ´»åŠ¨ä¿æŒæ—¶é—´)ï¼šçº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹ç©ºé—²åä¿æŒå­˜æ´»çš„æ—¶é—´(è¶…è¿‡è¯¥æ—¶é•¿ï¼Œéæ ¸å¿ƒçº¿ç¨‹å°±ä¼šè¢«å›æ”¶)</p>
<p>7ã€TimeUnit(çº¿ç¨‹æ´»åŠ¨ä¿æŒæ—¶é—´çš„å•ä½)</p>
<h3 id="3-å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡"><a href="#3-å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡" class="headerlink" title="3.å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡"></a>3.å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡</h3><ul>
<li>execute()ï¼šç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸ</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">threadsPool.execute(new Runnable() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>submit()ï¼šç”¨äºæäº¤éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡(è¿”å›futureç±»å‹çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸä¸”å¯ä»¥é€šè¿‡å¯¹è±¡çš„get()æ¥è·å–è¿”å›å€¼).<br>get()æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆã€‚<code>get(long timeout, TimeUnit unit)</code>å¯é˜»å¡ä¸€æ®µæ—¶é—´åç«‹å³è¿”å›ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Future&lt;Object&gt; future = executor.submit(harReturnValuetask);</span><br><span class="line">    try &#123;</span><br><span class="line">    	Object s = future.get();</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">    	// å¤„ç†ä¸­æ–­å¼‚å¸¸</span><br><span class="line">    &#125; catch (ExecutionException e) &#123;</span><br><span class="line">    	// å¤„ç†æ— æ³•æ‰§è¡Œä»»åŠ¡å¼‚å¸¸</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">    	// å…³é—­çº¿ç¨‹æ± </span><br><span class="line">    	executor.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-å…³é—­çº¿ç¨‹æ± "><a href="#4-å…³é—­çº¿ç¨‹æ± " class="headerlink" title="4.å…³é—­çº¿ç¨‹æ± "></a>4.å…³é—­çº¿ç¨‹æ± </h3><p>çº¿ç¨‹æ± çš„shutdownæˆ–shutdownNowæ–¹æ³•å…³é—­çº¿ç¨‹æ± ï¼ŒåŸç†æ˜¯éå†çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œç„¶åé€ä¸ªè°ƒç”¨çº¿ç¨‹çš„interruptæ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹ã€‚</p>
<p>æ— æ³•å“åº”ä¸­æ–­çš„çº¿ç¨‹å¯èƒ½æ°¸è¿œæ— æ³•ç»ˆæ­¢ã€‚</p>
<p>shutdown &#x3D;&gt; å¹³ç¼“å…³é—­ï¼Œç­‰å¾…æ‰€æœ‰å·²æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œå†å…³é—­<br>shutdownNow &#x3D;&gt; ç«‹åˆ»å…³é—­ï¼Œåœæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶è¿”å›é˜Ÿåˆ—ä¸­æœªæ‰§è¡Œçš„ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shutdownå’ŒshutdownNowï¼š</span><br><span class="line">1ã€shutdown()</span><br><span class="line">é˜»æ­¢æ–°æ¥çš„ä»»åŠ¡æäº¤ï¼Œå¯¹å·²ç»æäº¤äº†çš„ä»»åŠ¡ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ã€‚</span><br><span class="line">å½“å·²ç»æäº¤çš„ä»»åŠ¡æ‰§è¡Œå®Œåï¼Œå®ƒä¼šå°†é‚£äº›é—²ç½®çš„çº¿ç¨‹ï¼ˆidleWorksï¼‰è¿›è¡Œä¸­æ–­ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ã€‚</span><br><span class="line">å°†çº¿ç¨‹æ± çš„çŠ¶æ€æ”¹æˆSHUTDOWNï¼Œå½“å†å°†æ‰§è¡Œexecuteæäº¤ä»»åŠ¡æ—¶ï¼Œå¦‚æœæµ‹è¯•åˆ°çŠ¶æ€ä¸ä¸ºRUNNINGï¼Œåˆ™æŠ›å‡ºrejectedExecutionï¼Œä»è€Œè¾¾åˆ°é˜»æ­¢æ–°ä»»åŠ¡æäº¤çš„ç›®çš„ã€‚</span><br><span class="line"></span><br><span class="line">2ã€shutdownNow()</span><br><span class="line">é˜»æ­¢æ–°æ¥çš„ä»»åŠ¡æäº¤ï¼ŒåŒæ—¶ä¼šä¸­æ–­å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œå³workersä¸­çš„çº¿ç¨‹ã€‚</span><br><span class="line">å®ƒè¿˜å°†workQueueä¸­çš„ä»»åŠ¡ç»™ç§»é™¤ï¼Œå¹¶å°†è¿™äº›ä»»åŠ¡æ·»åŠ åˆ°åˆ—è¡¨ä¸­è¿›è¡Œè¿”å›ã€‚</span><br><span class="line">é€šè¿‡å°†çº¿ç¨‹æ± çš„çŠ¶æ€æ”¹æˆSTOPï¼Œå½“å†å°†æ‰§è¡Œexecuteæäº¤ä»»åŠ¡æ—¶ï¼Œå¦‚æœæµ‹è¯•åˆ°çŠ¶æ€ä¸ä¸ºRUNNINGï¼Œåˆ™æŠ›å‡ºrejectedExecutionï¼Œä»è€Œè¾¾åˆ°é˜»æ­¢æ–°ä»»åŠ¡æäº¤çš„ç›®çš„.</span><br><span class="line">ä¸€ä¸ªç‰¹ä¾‹ï¼š</span><br><span class="line">ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨sleepçŠ¶æ€ä¸­ï¼Œæ­¤æ—¶æ‰§è¡ŒshutdownNow()ï¼Œ</span><br><span class="line">å®ƒå‘è¯¥çº¿ç¨‹å‘èµ·interrupt()è¯·æ±‚ï¼Œè€Œsleep()æ–¹æ³•é‡åˆ°æœ‰interrupt()è¯·æ±‚æ—¶ï¼Œä¼šæŠ›å‡ºInterruptedExceptionï¼Œå¹¶æ¸…é™¤ä¸­æ–­æ ‡å¿—</span><br><span class="line">å¦‚æœcatchäº†ï¼Œå¹¶æ²¡æœ‰åœ¨catchä¸­å†interrupt()ï¼Œä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</span><br><span class="line">å¦‚æœå‘å¤–æŠ›å‡ºå¼‚å¸¸ï¼Œä¼šä¸­æ–­</span><br></pre></td></tr></table></figure>

<h3 id="5-åˆç†é…ç½®çº¿ç¨‹æ± "><a href="#5-åˆç†é…ç½®çº¿ç¨‹æ± " class="headerlink" title="5.åˆç†é…ç½®çº¿ç¨‹æ± "></a>5.åˆç†é…ç½®çº¿ç¨‹æ± </h3><p>1ã€ä»»åŠ¡çš„æ€§è´¨ï¼š</p>
<p>CPUå¯†é›†å‹ä»»åŠ¡ï¼šé…ç½®å°½å¯èƒ½å°çš„çº¿ç¨‹(Ncpu+1)ï¼Œå› ä¸ºCPUå¯†é›†å‹ä»»åŠ¡ä½¿å¾—CPUä½¿ç”¨ç‡å¾ˆé«˜ï¼Œè‹¥å¼€è¿‡å¤šçš„çº¿ç¨‹æ•°èƒ½å¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ï¼Œå¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚</p>
<p>IOå¯†é›†å‹ä»»åŠ¡ï¼šé…ç½®å°½å¯èƒ½å¤šçš„çº¿ç¨‹(2*Ncpu)ï¼Œå› ä¸ºCPUä½¿ç”¨ç‡å¹¶ä¸é«˜ï¼Œå¯ä»¥è®©CPUåœ¨ç­‰å¾…IOçš„æ—¶å€™å»å¤„ç†åˆ«çš„ä»»åŠ¡ï¼Œå……åˆ†åˆ©ç”¨CPUæ—¶é—´ã€‚</p>
<p>æ··åˆå‹ä»»åŠ¡ï¼šå¯å°†ä»»åŠ¡åˆ†æˆIOå¯†é›†å‹å’ŒCPUå¯†é›†å‹ä»»åŠ¡(ä¸¤ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´ç›¸å·®ä¸å¤§æ—¶)ï¼Œç„¶ååˆ†åˆ«ç”¨ä¸åŒçš„çº¿ç¨‹æ± å»å¤„ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CPUå¯†é›†å‹å’ŒIOå¯†é›†å‹ï¼š</span><br><span class="line">CPUå¯†é›†å‹ï¼šéœ€éå¸¸å¤šCPUè®¡ç®—èµ„æºï¼Œè®©æ¯ä¸ªCPUæ ¸å¿ƒéƒ½å‚ä¸è®¡ç®—ï¼ŒCPUæ€§èƒ½å……åˆ†åˆ©ç”¨ï¼Œåº”é¿å…è¿‡å¤šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</span><br><span class="line">IOå¯†é›†å‹ï¼šç½‘ç»œã€ç£ç›˜ IO ï¼ˆä¸DBã€ç¼“å­˜ï¼‰ï¼Œä¸€æ—¦IOï¼Œçº¿ç¨‹å°±ç­‰å¾…ï¼Œç»“æŸæ‰æ‰§è¡Œã€‚å¤šè®¾çº¿ç¨‹æ•°ï¼Œç­‰å¾…æ—¶å»åšå…¶å®ƒäº‹ï¼Œæé«˜æ•ˆç‡ã€‚</span><br></pre></td></tr></table></figure>

<p>2ã€ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼šä¼˜å…ˆçº§ä¸åŒçš„ä»»åŠ¡å¯ä»¥ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—PriorityBlockingQueueæ¥å¤„ç†</p>
<p>3ã€ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼šå¯ä»¥äº¤ç»™ä¸åŒè§„æ¨¡çš„çº¿ç¨‹æ± æ¥å¤„ç†ï¼Œæˆ–è€…ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚æ‰§è¡Œæ—¶é—´çŸ­çš„å…ˆæ‰§è¡Œ</p>
<p>4ã€ä»»åŠ¡çš„ä¾èµ–æ€§ï¼šæ¯”å¦‚ä¾èµ–æ•°æ®åº“è¿æ¥æ± çš„ä»»åŠ¡ï¼Œçº¿ç¨‹æäº¤SQLåéœ€è¦ç­‰å¾…æ•°æ®åº“è¿”å›ç»“æœï¼Œç­‰å¾…çš„æ—¶é—´è¶Šé•¿ï¼ŒCPUç©ºé—²æ—¶é—´å°±è¶Šé•¿(ç›¸å½“äºIOå¯†é›†å‹ä»»åŠ¡ï¼Œåº”è®¾ç½®è¾ƒå¤§çº¿ç¨‹æ•°)</p>
<p>5ã€å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œå¯ä»¥å¢åŠ ç³»ç»Ÿç¨³å®šæ€§å’Œé¢„è­¦èƒ½åŠ›ï¼Œå†æŠ›å¼ƒä»»åŠ¡çš„æ—¶å€™åŠ ç›‘æ§ï¼Œæ— ç•Œé˜Ÿåˆ—ä¼šæ’‘æ»¡å†…å­˜ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸èƒ½ç”¨ã€‚</p>
<h3 id="6-çº¿ç¨‹æ± çš„ç›‘æ§"><a href="#6-çº¿ç¨‹æ± çš„ç›‘æ§" class="headerlink" title="6.çº¿ç¨‹æ± çš„ç›‘æ§"></a>6.çº¿ç¨‹æ± çš„ç›‘æ§</h3><p>å¦‚æœåœ¨ç³»ç»Ÿä¸­å¤§é‡ä½¿ç”¨çº¿ç¨‹æ± ï¼Œåˆ™éœ€è¦å¯¹çº¿ç¨‹æ± è¿›è¡Œç›‘æ§ï¼Œåœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œå¯æ ¹æ®çº¿ç¨‹æ± çš„ä½¿ç”¨çŠ¶å†µå¿«é€Ÿå®šä½é—®é¢˜ã€‚å¯ä½¿ç”¨ä»¥ä¸‹å±æ€§ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">taskCountï¼šçº¿ç¨‹æ± éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡</span><br><span class="line">completedTaskCountï¼šçº¿ç¨‹æ± åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å·²å®Œæˆçš„ä»»åŠ¡æ•°é‡</span><br><span class="line">largestPoolSizeï¼šçº¿ç¨‹æ± é‡Œæ›¾ç»åˆ›å»ºè¿‡çš„æœ€å¤§çº¿ç¨‹æ•°é‡</span><br><span class="line">getPoolSizeï¼šçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡(çº¿çº¿ç¨‹æ± ä¸é”€æ¯çš„è¯ï¼Œçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹ä¸ä¼šè‡ªåŠ¨é”€æ¯)</span><br><span class="line">getActiveCountï¼šè·å–æ´»åŠ¨çš„çº¿ç¨‹æ•°</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç»§æ‰¿çº¿ç¨‹æ± æ¥è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œé‡å†™çº¿ç¨‹æ± çš„beforeExecuteã€afterExecuteå’Œterminatedæ–¹æ³•è¿›è¡Œç›‘æ§ã€‚åœ¨æ‰§è¡Œå‰ã€æ‰§è¡Œåã€çº¿ç¨‹æ± å…³é—­å‰ç›‘æ§ï¼Œæ¯”å¦‚ï¼šä»»åŠ¡å¹³å‡æ‰§è¡Œæ—¶é—´ï¼Œæœ€å¤§æ‰§è¡Œæ—¶é—´ï¼Œæœ€å°æ‰§è¡Œæ—¶é—´ã€‚</p>
<h3 id="7-Executorsçš„çº¿ç¨‹æ± ï¼š"><a href="#7-Executorsçš„çº¿ç¨‹æ± ï¼š" class="headerlink" title="7.Executorsçš„çº¿ç¨‹æ± ï¼š"></a>7.Executorsçš„çº¿ç¨‹æ± ï¼š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®šé•¿çº¿ç¨‹æ± (FixedThreadPool)ï¼šç”¨äºæ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°</span><br><span class="line">åªæœ‰æ ¸å¿ƒçº¿ç¨‹</span><br><span class="line">çº¿ç¨‹æ•°é‡å›ºå®š</span><br><span class="line">æ‰§è¡Œå®Œç«‹å³å›æ”¶</span><br><span class="line">ä»»åŠ¡é˜Ÿåˆ—ä¸ºé“¾è¡¨ç»“æ„çš„æœ‰ç•Œé˜Ÿåˆ—(æ¶ˆè€—å†…å­˜)</span><br><span class="line"></span><br><span class="line">å®šæ—¶çº¿ç¨‹æ± (ScheduledThreadPool)ï¼šç”¨äºæ‰§è¡Œå®šæ—¶æˆ–å‘¨æœŸæ€§çš„ä»»åŠ¡</span><br><span class="line">æ ¸å¿ƒçº¿ç¨‹æ•°é‡å›ºå®š</span><br><span class="line">éæ ¸å¿ƒçº¿ç¨‹æ•°é‡æ— é™(çº¿ç¨‹è¿‡å¤šå¯¼è‡´å†…å­˜æº¢å‡º)</span><br><span class="line">æ‰§è¡Œå®Œé—²ç½®10msåå›æ”¶</span><br><span class="line">ä»»åŠ¡é˜Ÿåˆ—ä¸ºå»¶æ—¶é˜»å¡é˜Ÿåˆ—</span><br><span class="line"></span><br><span class="line">å¯ç¼“å­˜çº¿ç¨‹æ± (CachedThreadPool)ï¼šæ‰§è¡Œå¤§é‡ä¸”è€—æ—¶å°‘çš„ä»»åŠ¡</span><br><span class="line">æ— æ ¸å¿ƒçº¿ç¨‹</span><br><span class="line">éæ ¸å¿ƒçº¿ç¨‹æ•°é‡æ— é™(çº¿ç¨‹è¿‡å¤šå¯¼è‡´å†…å­˜æº¢å‡º)</span><br><span class="line">æ‰§è¡Œå®Œé—²ç½®60såå›æ”¶</span><br><span class="line">ä»»åŠ¡é˜Ÿåˆ—ä¸ºä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—</span><br><span class="line"></span><br><span class="line">å•çº¿ç¨‹åŒ–çº¿ç¨‹æ± (SingleThreadExecutor)ï¼šåº”ç”¨äºä¸é€‚åˆå¹¶å‘ä½†å¯èƒ½å¼•èµ·IOé˜»å¡æ€§åŠå½±å“UIçº¿ç¨‹å“åº”çš„æ“ä½œï¼Œå¦‚æ•°æ®åº“æ“ä½œ</span><br><span class="line">åªæœ‰1ä¸ªæ ¸å¿ƒçº¿ç¨‹</span><br><span class="line">æ— éæ ¸å¿ƒçº¿ç¨‹</span><br><span class="line">æ‰§è¡Œå®Œç«‹å³å›æ”¶</span><br><span class="line">ä»»åŠ¡é˜Ÿåˆ—ä¸ºé“¾è¡¨ç»“æ„çš„æœ‰ç•Œé˜Ÿåˆ—(æ¶ˆè€—å†…å­˜)</span><br></pre></td></tr></table></figure>

<p>åŸä¹¦ç¬”è®°ï¼š<a href="https://blog.csdn.net/qq_41398418/article/details/126279652">https://blog.csdn.net/qq_41398418/article/details/126279652</a></p>
<h2 id="ç¬¬åç« -Executoræ¡†æ¶"><a href="#ç¬¬åç« -Executoræ¡†æ¶" class="headerlink" title="ç¬¬åç«  Executoræ¡†æ¶"></a>ç¬¬åç«  Executoræ¡†æ¶</h2><p>åœ¨Javaä¸­ï¼Œä½¿ç”¨çº¿ç¨‹æ¥å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ã€‚Javaçº¿ç¨‹çš„åˆ›å»ºä¸é”€æ¯éœ€è¦ä¸€å®šçš„å¼€é”€ï¼Œå¦‚æœæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè¿™äº›çº¿ç¨‹çš„åˆ›å»ºä¸é”€æ¯å°†æ¶ˆè€—å¤§é‡çš„è®¡ç®—èµ„æºã€‚åŒæ—¶ï¼Œ ä¸ºæ¯ä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè¿™ç§ç­–ç•¥å¯èƒ½ä¼šä½¿å¤„äºé«˜è´Ÿè·çŠ¶æ€çš„åº”ç”¨æœ€ç»ˆå´©æºƒã€‚</p>
<p>Javaçš„çº¿ç¨‹æ—¢æ˜¯å·¥ä½œå•å…ƒï¼Œä¹Ÿæ˜¯æ‰§è¡Œæœºåˆ¶ã€‚ä»JDK 5å¼€å§‹ï¼ŒæŠŠå·¥ä½œå•å…ƒä¸æ‰§è¡Œæœºåˆ¶åˆ†ç¦»å¼€æ¥ã€‚å·¥ä½œå•å…ƒåŒ…æ‹¬Runnableå’ŒCallableï¼Œè€Œæ‰§è¡Œæœºåˆ¶ç”±Executoræ¡†æ¶æä¾›ã€‚</p>
<h3 id="1-Executoræ¡†æ¶"><a href="#1-Executoræ¡†æ¶" class="headerlink" title="1.Executoræ¡†æ¶"></a>1.Executoræ¡†æ¶</h3><h4 id="âœ…Executoræ¡†æ¶çš„ä¸¤çº§è°ƒåº¦æ¨¡å‹"><a href="#âœ…Executoræ¡†æ¶çš„ä¸¤çº§è°ƒåº¦æ¨¡å‹" class="headerlink" title="âœ…Executoræ¡†æ¶çš„ä¸¤çº§è°ƒåº¦æ¨¡å‹"></a>âœ…Executoræ¡†æ¶çš„ä¸¤çº§è°ƒåº¦æ¨¡å‹</h4><p>åœ¨HotSpot VMçš„çº¿ç¨‹æ¨¡å‹ä¸­ï¼ŒJavaçº¿ç¨‹ï¼ˆjava.lang.Threadï¼‰è¢«ä¸€å¯¹ä¸€æ˜ å°„ä¸ºæœ¬åœ°æ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚æ“ä½œç³»ç»Ÿä¼šè°ƒåº¦æ‰€æœ‰çº¿ç¨‹å¹¶å°†å®ƒä»¬åˆ†é…ç»™å¯ç”¨çš„CPUã€‚</p>
<p><strong>ä¸¤çº§è°ƒåº¦æ¨¡å‹</strong>ï¼š<br>åœ¨ä¸Šå±‚ï¼ŒJavaå¤šçº¿ç¨‹ç¨‹åºé€šå¸¸æŠŠåº”ç”¨åˆ†è§£ä¸ºè‹¥å¹²ä¸ªä»»åŠ¡ï¼Œç„¶åä½¿ç”¨ç”¨æˆ·çº§çš„è°ƒåº¦å™¨ï¼ˆExecutoræ¡†æ¶ï¼‰å°†è¿™äº›ä»»åŠ¡æ˜ å°„ä¸ºå›ºå®šæ•°é‡çš„çº¿ç¨‹ï¼›åœ¨åº•å±‚ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å°†è¿™äº›çº¿ç¨‹æ˜ å°„åˆ°ç¡¬ä»¶å¤„ç†å™¨ä¸Šã€‚<br><em>åº”ç”¨ç¨‹åºé€šè¿‡Executoræ¡†æ¶æ§åˆ¶ä¸Šå±‚çš„è°ƒåº¦ï¼›è€Œä¸‹å±‚çš„è°ƒåº¦ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ§åˆ¶ï¼Œä¸‹å±‚çš„è°ƒåº¦ä¸å—åº”ç”¨ç¨‹åºçš„æ§åˆ¶ã€‚</em></p>
<h4 id="âœ…Executoræ¡†æ¶çš„ç»“æ„"><a href="#âœ…Executoræ¡†æ¶çš„ç»“æ„" class="headerlink" title="âœ…Executoræ¡†æ¶çš„ç»“æ„"></a>âœ…Executoræ¡†æ¶çš„ç»“æ„</h4><p>Executoræ¡†æ¶ä¸»è¦ç”±3å¤§éƒ¨åˆ†ç»„æˆï¼š</p>
<p>1ã€ä»»åŠ¡ã€‚åŒ…æ‹¬è¢«æ‰§è¡Œä»»åŠ¡éœ€è¦å®ç°çš„æ¥å£ï¼šRunnableæ¥å£æˆ–Callableæ¥å£ã€‚</p>
<p>2ã€ä»»åŠ¡çš„æ‰§è¡Œã€‚åŒ…æ‹¬ä»»åŠ¡æ‰§è¡Œæœºåˆ¶çš„æ ¸å¿ƒæ¥å£Executorï¼Œä»¥åŠå®ç°è‡ªExecutorçš„ExecutorServiceæ¥å£ã€‚Executoræ¡†æ¶æœ‰ä¸¤ä¸ªå…³é”®ç±»å®ç°äº†ExecutorServiceæ¥å£ï¼ˆThreadPoolExecutorå’Œ<br>ScheduledThreadPoolExecutorï¼‰ã€‚</p>
<p>3ã€å¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚åŒ…æ‹¬æ¥å£Futureå’Œå®ç°Futureæ¥å£çš„FutureTaskç±»ã€‚</p>
<hr>
<p>Executoræ¡†æ¶çš„ç±»ä¸æ¥å£ï¼š</p>
<p>1ã€Executoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæ˜¯Executoræ¡†æ¶çš„åŸºç¡€ï¼Œå®ƒå°†ä»»åŠ¡çš„æäº¤ä¸ä»»åŠ¡çš„æ‰§è¡Œåˆ†ç¦»å¼€æ¥ã€‚</p>
<p>2ã€ExecutorServiceæ¥å£ï¼Œå®ç°è‡ªExecutoræ¥å£ã€‚</p>
<p>3ã€ThreadPoolExecutorç±»æ˜¯çº¿ç¨‹æ± çš„æ ¸å¿ƒå®ç°ç±»ï¼Œç”¨æ¥æ‰§è¡Œè¢«æäº¤çš„ä»»åŠ¡ã€‚</p>
<p>4ã€ScheduledThreadPoolExecutoræ˜¯ä¸€ä¸ªå®ç°ç±»ï¼Œå¯ä»¥åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œå‘½ä»¤ï¼Œæˆ–è€…å®šæœŸæ‰§è¡Œå‘½ä»¤ã€‚<br>ScheduledThreadPoolExecutoræ¯”Timeræ›´çµæ´»ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚</p>
<p>5ã€Futureæ¥å£å’Œå®ç°Futureæ¥å£çš„FutureTaskç±»ï¼Œä»£è¡¨å¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚</p>
<p>6ã€Runnableæ¥å£å’ŒCallableæ¥å£çš„å®ç°ç±»ï¼Œéƒ½å¯ä»¥è¢«ThreadPoolExecutoræˆ–Scheduled- ThreadPoolExecutoræ‰§è¡Œã€‚</p>
<hr>
<p>ä½¿ç”¨æ­¥éª¤ï¼š</p>
<p>1.åˆ›å»ºä»»åŠ¡å¯¹è±¡ï¼šä¸»çº¿ç¨‹åˆ›å»ºå®ç°Runnableæˆ–è€…Callableæ¥å£çš„ä»»åŠ¡å¯¹è±¡ã€‚<code>å·¥å…·ç±»Executorså¯ä»¥æŠŠä¸€ä¸ªRunnableå¯¹è±¡å°è£…ä¸ºä¸€ä¸ªCallableå¯¹è±¡ï¼ˆExecutors.callableï¼ˆRunnable taskï¼‰æˆ–Executors.callableï¼ˆRunnable taskï¼ŒObject resuleï¼‰ï¼‰</code></p>
<p>2.ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œï¼šæŠŠRunnableå¯¹è±¡ç›´æ¥äº¤ç»™ExecutorServiceæ‰§è¡Œ<code>ï¼ˆExecutorService.executeï¼ˆRunnable commandï¼‰ï¼‰</code>ï¼›æˆ–è€…ä¹Ÿå¯ä»¥æŠŠRunnableå¯¹è±¡æˆ–Callableå¯¹è±¡æäº¤ç»™ExecutorServiceæ‰§è¡Œ<code>ï¼ˆExecutorService.submitï¼ˆRunnable taskï¼‰æˆ–ExecutorService.submitï¼ˆCallabletaskï¼‰ï¼‰</code><br>å¦‚æœæ‰§è¡ŒExecutorService.submitï¼ˆâ€¦ï¼‰ï¼ŒExecutorServiceå°†è¿”å›ä¸€ä¸ªå®ç°Futureæ¥å£çš„å¯¹è±¡ï¼ˆåˆ°ç›®å‰ä¸ºæ­¢çš„JDKä¸­ï¼Œè¿”å›çš„æ˜¯FutureTaskå¯¹è±¡ï¼‰ã€‚ç”±äºFutureTaskå®ç°äº†Runnableï¼Œç¨‹åºå‘˜ä¹Ÿå¯ä»¥åˆ›å»ºFutureTaskï¼Œç„¶åç›´æ¥äº¤ç»™ExecutorServiceæ‰§è¡Œã€‚</p>
<p>3.submitçš„è·å–ç»“æœï¼šä¸»çº¿ç¨‹å¯ä»¥æ‰§è¡Œ<code>FutureTask.get()</code>æ–¹æ³•æ¥ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ä¸»çº¿ç¨‹ä¹Ÿå¯ä»¥æ‰§è¡Œ<code>FutureTask.cancelï¼ˆboolean mayInterruptIfRunningï¼‰</code>æ¥å–æ¶ˆæ­¤ä»»åŠ¡çš„æ‰§è¡Œã€‚</p>
<h4 id="âœ…-Executoræ¡†æ¶çš„æˆå‘˜"><a href="#âœ…-Executoræ¡†æ¶çš„æˆå‘˜" class="headerlink" title="âœ… Executoræ¡†æ¶çš„æˆå‘˜"></a>âœ… Executoræ¡†æ¶çš„æˆå‘˜</h4><p>Executoræ¡†æ¶çš„ä¸»è¦æˆå‘˜ï¼šThreadPoolExecutorã€<br>ScheduledThreadPoolExecutorã€Futureæ¥å£ã€Runnableæ¥å£ã€Callableæ¥å£å’ŒExecutorsã€‚</p>
<hr>
<p>ï¼ˆ1ï¼‰ ThreadPoolExecutor</p>
<p>ThreadPoolExecutorå¯ä»¥ä½¿ç”¨å·¥å‚ç±»Executorsæ¥åˆ›å»ºã€‚Executorså¯ä»¥åˆ›å»º3ç§ç±»å‹çš„ThreadPoolExecutorï¼šSingleThreadExecutorã€FixedThreadPoolå’ŒCachedThreadPoolã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å›ºå®šçº¿ç¨‹æ•°çš„FixedThreadPoolçš„ APIã€‚</span><br><span class="line">é€‚ç”¨äºä¸ºäº†æ»¡è¶³èµ„æºç®¡ç†çš„éœ€æ±‚ï¼Œè€Œéœ€è¦é™åˆ¶å½“å‰çº¿ç¨‹æ•°é‡çš„åº”ç”¨åœºæ™¯ï¼Œå®ƒé€‚ç”¨äºè´Ÿè½½æ¯”è¾ƒé‡çš„æœåŠ¡å™¨ã€‚</span><br><span class="line">public static ExecutorService newFixedThreadPool(int nThreads) &#123;</span><br><span class="line">    return new ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">        0L, TimeUnit.MILLISECONDS,</span><br><span class="line">        new LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å•ä¸ªçº¿ç¨‹çš„SingleThreadExecutorçš„API.</span><br><span class="line">é€‚ç”¨äºéœ€è¦ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡ï¼›åªè¦ä¸€ä¸ªçº¿ç¨‹çš„åº”ç”¨åœºæ™¯ã€‚</span><br><span class="line">public static ExecutorService newSingleThreadExecutor(ThreadFactory threadFactory) &#123;</span><br><span class="line">    return new FinalizableDelegatedExecutorService(new ThreadPoolExecutor(1, 1,</span><br><span class="line">        0L, TimeUnit.MILLISECONDS,</span><br><span class="line">        new LinkedBlockingQueue&lt;Runnable&gt;(),</span><br><span class="line">        threadFactory));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CachedThreadPoolæ˜¯å¤§å°æ— ç•Œçš„çº¿ç¨‹æ± ï¼Œ</span><br><span class="line">é€‚ç”¨äºæ‰§è¡Œå¾ˆå¤šçš„çŸ­æœŸå¼‚æ­¥ä»»åŠ¡çš„å°ç¨‹åºï¼Œæˆ–è€… æ˜¯è´Ÿè½½è¾ƒè½»çš„æœåŠ¡å™¨ã€‚</span><br><span class="line">public static ExecutorService newCachedThreadPool() &#123;</span><br><span class="line">    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,</span><br><span class="line">        60L, TimeUnit.SECONDS,</span><br><span class="line">        new SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>ï¼ˆ2ï¼‰ ScheduledThreadPoolExecutor<br>ScheduledThreadPoolExecutorå¯ä»¥ä½¿ç”¨å·¥å‚ç±»Executorsæ¥åˆ›å»ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ScheduledThreadPoolExecutorã€‚</span><br><span class="line">åŒ…å«è‹¥å¹²ä¸ªçº¿ç¨‹çš„ScheduledThreadPoolExecutorã€‚</span><br><span class="line">é€‚ç”¨äºéœ€è¦å¤šä¸ªåå°çº¿ç¨‹æ‰§è¡Œå‘¨æœŸä»»åŠ¡</span><br><span class="line">public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) &#123;</span><br><span class="line">    return new ScheduledThreadPoolExecutor(corePoolSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SingleThreadScheduledExecutorã€‚</span><br><span class="line">åªåŒ…å«ä¸€ä¸ªçº¿ç¨‹çš„ScheduledThreadPoolExecutorã€‚</span><br><span class="line">public static ScheduledExecutorService newSingleThreadScheduledExecutor() &#123;</span><br><span class="line">    return new DelegatedScheduledExecutorService</span><br><span class="line">        (new ScheduledThreadPoolExecutor(1));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>ï¼ˆ3ï¼‰ Futureæ¥å£</p>
<p>Futureæ¥å£å’Œå®ç°Futureæ¥å£çš„FutureTaskç±»ç”¨æ¥è¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚å½“æˆ‘ä»¬æŠŠRunnable æ¥å£æˆ–Callableæ¥å£çš„å®ç°ç±»æäº¤ï¼ˆsubmitï¼‰ç»™ThreadPoolExecutoræˆ–<br>ScheduledThreadPoolExecutoræ—¶ï¼Œä¼šå‘æˆ‘ä»¬è¿”å›ä¸€ä¸ªFutureTaskå¯¹è±¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">api:</span><br><span class="line">&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);</span><br><span class="line">&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result);</span><br><span class="line">Future&lt;?&gt; submit(Runnable task);</span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰æœ€æ–°çš„JDK 8ä¸ºæ­¢ï¼ŒJavaé€šè¿‡ä¸Šè¿°APIè¿”å›çš„æ˜¯ä¸€ä¸ªFutureTaskå¯¹è±¡ã€‚ä½†ä»APIå¯ä»¥çœ‹åˆ°ï¼ŒJavaä»…ä»…ä¿è¯è¿”å›çš„æ˜¯ä¸€ä¸ªå®ç°äº†Futureæ¥å£çš„å¯¹è±¡ã€‚</p>
<hr>
<p>ï¼ˆ4ï¼‰ Runnableæ¥å£å’ŒCallableæ¥å£</p>
<p>Runnableæ¥å£å’ŒCallableæ¥å£çš„å®ç°ç±»ï¼Œéƒ½å¯ä»¥è¢«ThreadPoolExecutoræˆ–Scheduled- ThreadPoolExecutoræ‰§è¡Œã€‚å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯Runnableä¸ä¼šè¿”å›ç»“æœï¼Œè€ŒCallableå¯ä»¥è¿”å›ç»“æœã€‚</p>
<p>å·¥å‚ç±»Executorså¯ä»¥æŠŠä¸€ä¸ªRunnableåŒ…è£…æˆä¸€ä¸ªCallableã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static Callable&lt;Object&gt; callable(Runnable task) //ç»“æœæ˜¯null</span><br><span class="line"></span><br><span class="line">public static &lt;T&gt; Callable&lt;T&gt; callable(Runnable task, T result)  //ç»“æœæ˜¯result</span><br></pre></td></tr></table></figure>

<h3 id="2-ThreadPoolExecutorè¯¦è§£"><a href="#2-ThreadPoolExecutorè¯¦è§£" class="headerlink" title="2.ThreadPoolExecutorè¯¦è§£"></a>2.ThreadPoolExecutorè¯¦è§£</h3><p>ä»‹ç»ä¸€ä¸‹Executorsåˆ›å»ºçš„ä¸‰ç§ç”¨çš„æ˜¯ä»€ä¹ˆå‚æ•°</p>
<p>1.FixThreadPoolå†…éƒ¨ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—LinkedBlockingQueueä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—çš„å®¹é‡ä¸ºInteger.MAX_VALUEï¼Œç”±äºæ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¸ä¼šæ‹’ç»ä»»åŠ¡ï¼ŒmaximumPoolæ²¡æœ‰æ„ä¹‰ï¼Œå¯èƒ½ä¼šé€ æˆä»»åŠ¡æ— é™å †ç§¯ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿèµ„æºè€—å°½çš„æƒ…å†µã€‚</p>
<p>2.SingleThreadExecutorï¼šä¸FixThreadPoolç±»ä¼¼ï¼Œåªæ˜¯SingleThreadExecutorçš„çº¿ç¨‹æ•°å›ºå®šä¸º1</p>
<p>3.CachedThreadPoolçš„corePoolä¸ºç©ºï¼ŒmaximumPoolSizeä¸ºInteger.MAX_VALUEï¼ŒkeepAliveTimeä¸º60Lï¼Œè¿™æ„å‘³ç€çº¿ç¨‹ç©ºé—²è¶…è¿‡60ç§’åˆ™ä¼šè¿›è¡Œå›æ”¶ã€‚CachedThreadPoolå†…éƒ¨ä½¿ç”¨ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—SynchronousQueueä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ç§»é™¤æ“ä½œã€‚è¿™æ„å‘³ç€å¦‚æœä»»åŠ¡çš„æäº¤é€Ÿåº¦é«˜äºçº¿ç¨‹çš„å¤„ç†é€Ÿåº¦ï¼Œé‚£ä¹ˆCachedThreadPoolåˆ™ä¼šä¸æ–­çš„åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œåœ¨æç«¯çš„æƒ…å†µä¸‹ï¼Œä¼šè€—å°½CPUå’Œå†…å­˜èµ„æºã€‚</p>
<h3 id="3-ScheduledThreadPoolExecutor"><a href="#3-ScheduledThreadPoolExecutor" class="headerlink" title="3.ScheduledThreadPoolExecutor"></a>3.ScheduledThreadPoolExecutor</h3><p>ScheduledThreadPoolExecutorä¸»è¦ç”¨æ¥æ‰§è¡Œéœ€è¦å»¶è¿Ÿæˆ–è€…å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒåŠŸèƒ½ä¸Timerç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯Timeråªèƒ½å•çº¿ç¨‹å…è®¸ï¼ŒScheduledThreadPoolExecutorå¯ä»¥æŒ‡å®šå¤šä¸ªçº¿ç¨‹ã€‚</p>
<p>ScheduledThreadPoolExecutoræ‰§è¡Œ<code>scheduleAtFixedRate()æ–¹æ³•æˆ–è€…scheduleWithFixedDelay()</code>æ–¹æ³•æ—¶ï¼Œä¼šæŠŠè¦æ‰§è¡Œçš„ä»»åŠ¡æ”¾åœ¨ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—DelayQueueä¸­ï¼Œ<code>ScheduledThreadPoolExecutorä¼šæŠŠRunableå¯¹è±¡å°è£…æˆScheduledFutureTaskï¼ˆå®ç°äº†RunnableScheduledFutureæ¥å£ï¼‰</code>ã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä»DelayQueueä¸­è·å–ScheduledFutureTaskã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private class ScheduledFutureTask&lt;V&gt;</span><br><span class="line">    extends FutureTask&lt;V&gt; implements RunnableScheduledFuture&lt;V&gt;</span><br></pre></td></tr></table></figure>

<p>ScheduledFutureTaskå†…éƒ¨åŒ…å«ä¸‰ä¸ªæˆå‘˜å˜é‡ã€‚<br>timeï¼šä»»åŠ¡è¦è¢«æ‰§è¡Œçš„å…·ä½“æ—¶é—´<br>sequenceNumberï¼šä»»åŠ¡æ’åºç¼–å·ï¼Œå¦‚æœä¸¤ä¸ªä»»åŠ¡çš„timeç›¸åŒï¼Œé‚£ä¹ˆåˆ™sequenceNumberè¾ƒå°çš„ä¼šå…ˆæ‰§è¡Œ<br>periodï¼šä»»åŠ¡æ‰§è¡Œçš„å‘¨æœŸ</p>
<hr>
<p>ScheduledThreadPoolExecutoræ‰§è¡Œä»»åŠ¡çš„æµç¨‹å¤§ä½“æ˜¯ï¼š<br>1.ä»DelayQueueä¸­è·å–ScheduledFutureTaskï¼ˆtimeå¤§äºå½“å‰æ—¶é—´çš„ä»»åŠ¡ï¼‰<br>2.æ‰§è¡ŒScheduledFutureTask<br>3.ä¿®æ”¹ScheduledFutureTaskçš„timeä¸ºä¸‹æ¬¡è¦æ‰§è¡Œçš„æ—¶é—´<br>4.å°†ScheduledFutureTaskå†æ¬¡æ”¾å…¥DelayQueueä¸­</p>
<h3 id="3-FutureTask"><a href="#3-FutureTask" class="headerlink" title="3.FutureTask"></a>3.FutureTask</h3><p>Futureæ¥å£å’ŒFutureTaskå®ç°ç±»ä»£è¡¨çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œçš„ç»“æœï¼Œå¯ä»¥é€šè¿‡FutureTask.get()æ–¹æ³•è·å–å¼‚æ­¥è¿”å›çš„ç»“æœã€‚</p>
<p>FutureTaskç±»è¿˜å®ç°äº†Runnableæ¥å£ï¼Œå› æ­¤å¯ä»¥äº¤ç»™Executoræ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œï¼š<code>FutureTask.run()</code>ã€‚</p>
<hr>
<p>æ ¹æ®FutureTask.runè¢«æ‰§è¡Œçš„æ—¶æœºï¼ŒFutureTaskå¯å¤„äºä¸‹é¢3ç§çŠ¶æ€ï¼š<br>æœªå¯åŠ¨ï¼šæ–¹æ³•è¿˜æ²¡æœ‰è¢«æ‰§è¡Œä¹‹å‰ï¼ŒFutureTaskå¤„äºæœªå¯åŠ¨çŠ¶æ€<br>å·²å¯åŠ¨ï¼šæ–¹æ³•è¢«æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒFutureTaskå¤„äºå·²å¯åŠ¨çŠ¶æ€<br>å·²å®Œæˆï¼šæ–¹æ³•æ‰§è¡Œå®Œåæ­£å¸¸ç»“æŸæˆ–ã€å–æ¶ˆ(å³æ‰§è¡ŒFutureTask.cancel)æˆ–æŠ›å¼‚å¸¸ï¼ŒFutureTaskå¤„äºå·²å®ŒæˆçŠ¶æ€</p>
<hr>
<p>FutureTaskçŠ¶æ€å†³å®šgetå’Œcancelæ–¹æ³•æ‰§è¡Œç»“æœï¼š</p>
<p>1.geiæ–¹æ³•ï¼šå¦‚æœæœªå¯åŠ¨æˆ–å·²å¯åŠ¨çŠ¶æ€ï¼Œgetæ–¹æ³•å°†å¯¼è‡´è°ƒç”¨çº¿ç¨‹é˜»å¡ï¼Œå¦‚æœå·²å®ŒæˆçŠ¶æ€ï¼Œgetæ–¹æ³•å°†å¯¼è‡´è°ƒç”¨çº¿ç¨‹ç«‹å³è¿”å›ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>2.cancelæ–¹æ³•ï¼šå½“å¤„äºæœªå¯åŠ¨çŠ¶æ€ï¼Œè¯¥ä»»åŠ¡å°†ä¸ä¼šæ‰§è¡Œï¼Œå½“å¤„äºå·²å¯åŠ¨çŠ¶æ€ï¼Œ<code>Future.cancel(true)</code>å°†ä¸­æ–­æ­¤ä»»åŠ¡çº¿ç¨‹æ¥åœæ­¢ä»»åŠ¡ï¼Œ<code>Future.cancel(false)</code>å°†ä¸ä¼šå¯¹æ­£åœ¨æ‰§è¡Œæ­¤ä»»åŠ¡çš„çº¿ç¨‹äº§ç”Ÿå½±å“ï¼Œå½“å¤„äºå·²å®ŒæˆçŠ¶æ€æ—¶ï¼Œcancelæ–¹æ³•å°†è¿”å›falseã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æŠŠæŸä¸ªä»»åŠ¡æ‰§è¡Œå®Œåå¹¶è·å–ç»“æœå®ƒæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå¯ä½¿ç”¨FutureTaskã€‚</p>
<hr>
<p>FutureTaskçš„å®ç°ï¼š</p>
<p>FutureTaskçš„å®ç°åŸºäºAbstractQueuedSynchronizer(AQSæ˜¯åŒæ­¥æ¡†æ¶ï¼Œå®ƒæä¾›é€šç”¨æœºåˆ¶æ¥åŸå­æ€§ç®¡ç†åŒæ­¥çŠ¶æ€ã€é˜»å¡å’Œå”¤é†’çº¿ç¨‹ï¼Œä»¥åŠç»´æŠ¤è¢«é˜»å¡çº¿ç¨‹çš„é˜Ÿåˆ—)ã€‚java.util.concurrenté‡Œçš„å¾ˆå¤šé˜»å¡ç±»ï¼šReetrantLockã€Semaphoreã€ReetrantReadWriteLockã€CountDownLatchéƒ½æ˜¯åŸºäºAQSå®ç°ã€‚</p>
<hr>
<p>AQSé—å¿˜çš„çŸ¥è¯†ï¼š<br>AQSå®ç°çš„åŒæ­¥å™¨éƒ½ä¼šåŒ…å«ä¸¤ç§ç±»å‹çš„æ“ä½œï¼š<br>1.acquuireæ“ä½œï¼Œè·å–åŒæ­¥çŠ¶æ€ï¼Œç”¨æ¥é˜»å¡è°ƒç”¨çº¿ç¨‹ã€‚FutureTaskä¸­ä¸ºgetæ–¹æ³•ã€‚<br>2.releaseæ“ä½œï¼Œé‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œç”¨æ¥è§£é™¤é˜»å¡çº¿ç¨‹çš„é˜»å¡ï¼ŒFutureTaskä¸­ä¸ºrunæ–¹æ³•å’Œcancelæ–¹æ³•ã€‚</p>
<hr>
<p>åŸºäºå¤åˆä¼˜å…ˆäºåŸºç¡€åŸåˆ™ï¼ŒFutureTaskçš„å†…éƒ¨ç§æœ‰ç±»Syncç»§æ‰¿è‡ªAQSã€‚å®ç°äº†AQSçš„<code>tryAcquireShared(int) å’Œ tryReleaseShared(int)</code>.</p>
<p>ğŸ¤”å› ä¸ºFutureTaskæ¶‰åŠåˆ°çº¿ç¨‹çš„é˜»å¡å”¤é†’ä¹Ÿå°±æ˜¯åŒæ­¥ï¼Œæ‰€ä»¥ç”¨AQSã€‚</p>
<h2 id="ç¬¬åä¸€ç« -javaå¹¶å‘ç¼–ç¨‹å®è·µ"><a href="#ç¬¬åä¸€ç« -javaå¹¶å‘ç¼–ç¨‹å®è·µ" class="headerlink" title="ç¬¬åä¸€ç«  javaå¹¶å‘ç¼–ç¨‹å®è·µ"></a>ç¬¬åä¸€ç«  javaå¹¶å‘ç¼–ç¨‹å®è·µ</h2><h3 id="1-ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼"><a href="#1-ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼" class="headerlink" title="1.ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼"></a>1.ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼</h3><p>ä»€ä¹ˆæ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ï¼Ÿ</p>
<p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼æ˜¯<strong>é€šè¿‡ä¸€ä¸ªå®¹å™¨æ¥è§£å†³ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å¼ºè€¦åˆé—®é¢˜</strong>ã€‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å½¼æ­¤ä¹‹é—´ä¸ç›´æ¥é€šä¿¡ï¼Œè€Œæ˜¯<strong>é€šè¿‡é˜»å¡é˜Ÿåˆ—æ¥è¿›è¡Œé€šä¿¡</strong>ï¼Œæ‰€ä»¥ç”Ÿäº§è€…ç”Ÿäº§å®Œæ•°æ®ä¹‹åä¸ç”¨ç­‰å¾…æ¶ˆè´¹è€…å¤„ç†ï¼Œç›´æ¥æ‰”ç»™é˜»å¡é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ä¸æ‰¾ç”Ÿäº§è€…è¦æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥ä»é˜»å¡é˜Ÿåˆ—é‡Œå–ï¼Œ<strong>é˜»å¡é˜Ÿåˆ—å°±ç›¸å½“äºä¸€ä¸ªç¼“å†²åŒº</strong>ï¼Œå¹³è¡¡äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ã€‚</p>
<p>è¿™ä¸ªé˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”¨æ¥ç»™ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…è§£è€¦çš„ã€‚çºµè§‚å¤§å¤šæ•°è®¾è®¡æ¨¡å¼ï¼Œéƒ½ä¼š<strong>æ‰¾ä¸€ä¸ªç¬¬ä¸‰è€…å‡ºæ¥è¿›è¡Œè§£è€¦</strong>ï¼Œå¦‚å·¥å‚æ¨¡å¼çš„ç¬¬ä¸‰è€…æ˜¯å·¥å‚ç±»ï¼Œæ¨¡æ¿æ¨¡å¼çš„ç¬¬ä¸‰è€…æ˜¯æ¨¡æ¿ç±»ã€‚åœ¨å­¦ä¹ ä¸€äº›è®¾è®¡æ¨¡å¼çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆæ‰¾åˆ°è¿™ä¸ªæ¨¡å¼çš„ç¬¬ä¸‰è€…ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç†Ÿæ‚‰ä¸€ä¸ªè®¾è®¡æ¨¡å¼ã€‚</p>
<p>è·å–æœºå™¨æœ‰å¤šå°‘ä¸ªCPUï¼Œæ¥å†³å®šçº¿ç¨‹æ± å¤§å°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int corePoolSize = Runtime.getRuntime().availableProcessors();</span><br></pre></td></tr></table></figure>


<h3 id="2-å¤šç”Ÿäº§è€…å’Œå¤šæ¶ˆè´¹è€…åœºæ™¯"><a href="#2-å¤šç”Ÿäº§è€…å’Œå¤šæ¶ˆè´¹è€…åœºæ™¯" class="headerlink" title="2.å¤šç”Ÿäº§è€…å’Œå¤šæ¶ˆè´¹è€…åœºæ™¯"></a>2.å¤šç”Ÿäº§è€…å’Œå¤šæ¶ˆè´¹è€…åœºæ™¯</h3><p>åœ¨å¤šæ ¸æ—¶ä»£ï¼Œå¤šçº¿ç¨‹å¹¶å‘å¤„ç†é€Ÿåº¦æ¯”å•çº¿ç¨‹å¤„ç†é€Ÿåº¦æ›´å¿«ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å¤šä¸ªçº¿ç¨‹æ¥ç”Ÿäº§æ•°æ®ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨å¤šä¸ªæ¶ˆè´¹çº¿ç¨‹æ¥æ¶ˆè´¹æ•°æ®ã€‚è€Œæ›´å¤æ‚çš„æƒ…å†µæ˜¯ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹çš„æ•°æ®ï¼Œæœ‰å¯èƒ½éœ€è¦ç»§ç»­å¤„ç†ï¼Œäºæ˜¯æ¶ˆè´¹è€…å¤„ç†å®Œæ•°æ®ä¹‹åï¼Œå®ƒåˆè¦ä½œä¸ºç”Ÿäº§è€…æŠŠæ•°æ®æ”¾åœ¨æ–°çš„é˜Ÿåˆ—é‡Œï¼Œäº¤ç»™å…¶ä»–æ¶ˆè´¹è€…ç»§ç»­å¤„ç†.</p>
<h3 id="3-çº¿ç¨‹æ± å°±æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼"><a href="#3-çº¿ç¨‹æ± å°±æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼" class="headerlink" title="3.çº¿ç¨‹æ± å°±æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼"></a>3.çº¿ç¨‹æ± å°±æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼</h3><p>Java ä¸­çš„çº¿ç¨‹æ± ç±»å…¶å®å°±æ˜¯ä¸€ç§ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼çš„å®ç°æ–¹å¼ï¼Œä½†æ˜¯æ›´åŠ é«˜æ˜ã€‚ç”Ÿäº§è€…æŠŠä»»åŠ¡ä¸¢ç»™çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹å¹¶å¤„ç†ä»»åŠ¡ï¼Œå¦‚æœå°†è¦è¿è¡Œçš„ä»»åŠ¡æ•°å¤§äºçº¿ç¨‹æ± çš„åŸºæœ¬çº¿ç¨‹æ•°å°±æŠŠä»»åŠ¡æ‰”åˆ°é˜»å¡é˜Ÿåˆ—é‡Œï¼Œè¿™ç§åšæ³•æ¯”åªä½¿ç”¨ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—æ¥å®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼æ˜¾ç„¶è¦é«˜æ˜å¾ˆå¤šï¼Œå› ä¸ºæ¶ˆè´¹è€…èƒ½å¤Ÿå¤„ç†ç›´æ¥å°±å¤„ç†æ‰äº†ï¼ˆä¸ç”¨ä¸­è½¬é˜Ÿåˆ—ï¼‰ï¼Œè¿™æ ·é€Ÿåº¦æ›´å¿«ï¼Œè€Œç”Ÿäº§è€…å…ˆå­˜ï¼Œæ¶ˆè´¹è€…å†å–è¿™ç§æ–¹å¼æ˜¾ç„¶æ…¢ä¸€äº›ã€‚</p>
<p>ç”Ÿäº§è€…æ¶ˆè´¹è€…ä¾‹å­ï¼š</p>
<p>è°ƒç”¨ä¸€ä¸ªè¿œç¨‹æ¥å£æŸ¥è¯¢æ•°æ®ï¼Œå¦‚æœè¿œç¨‹æœåŠ¡æ¥å£æŸ¥è¯¢æ—¶éœ€è¦å‡ åç§’çš„æ—¶é—´ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æä¾›ä¸€ä¸ªç”³è¯·æŸ¥è¯¢çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£æŠŠè¦ç”³è¯·æŸ¥è¯¢ä»»åŠ¡æ”¾æ•°æ®åº“ä¸­ï¼Œç„¶åè¯¥æ¥å£ç«‹åˆ»è¿”å›ã€‚ç„¶åæœåŠ¡å™¨ç«¯ç”¨çº¿ç¨‹è½®è¯¢å¹¶è·å–ç”³è¯·ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä¹‹åå‘æ¶ˆæ¯ç»™è°ƒç”¨æ–¹ï¼Œè®©è°ƒç”¨æ–¹å†æ¥è°ƒç”¨å¦å¤–ä¸€ä¸ªæ¥å£å–æ•°æ®ã€‚</p>
<p>å†æ¯”å¦‚ï¼š</p>
<p>1.æœ‰ä¸€äº›ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡æ”¾åœ¨dbé‡Œï¼Œè¡¨ç¤ºå®Œæˆè¿›ç¨‹ï¼ŒåŒæ—¶å°†è¡¨çš„idæ”¾å…¥redisé˜Ÿåˆ—ä¸­ã€‚</p>
<p>2.ä»»åŠ¡å¤„ç†ç«¯ï¼Œä»redisé˜Ÿåˆ—ä¸­å–å‡ºidï¼Œå†ç”¨idä»æ•°æ®åº“è¯»å‡ºä¸€ä¸ªä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œå¹¶æ›´æ–°dbä¸­ä»»åŠ¡å®Œæˆçš„è¿›ç¨‹ã€‚</p>
<p>3.å› ä¸ºredisç¼“å­˜ç¨³å®šæ€§è€ƒè™‘ï¼Œå®šæ—¶ä»»åŠ¡æ‚dbä¸­é•¿æ—¶é—´æœªå®Œæˆçš„ä»»åŠ¡ï¼Œå°†idæ”¾å…¥redisé˜Ÿåˆ—ä¸­ã€‚</p>
<h3 id="4-çº¿ä¸Šé—®é¢˜å®šä½"><a href="#4-çº¿ä¸Šé—®é¢˜å®šä½" class="headerlink" title="4.çº¿ä¸Šé—®é¢˜å®šä½"></a>4.çº¿ä¸Šé—®é¢˜å®šä½</h3><p>çœ‹æ—¥å¿—ã€ç³»ç»ŸçŠ¶æ€å’Œ dump çº¿ç¨‹ã€‚</p>
<p>åœ¨ Java è¿›ç¨‹è¿™ä¸€è¡Œé‡Œå¯ä»¥çœ‹åˆ° CPU åˆ©ç”¨ç‡æ˜¯ 300%ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œè¿™ä¸ªæ˜¯å½“å‰æœºå™¨æ‰€æœ‰æ ¸åŠ åœ¨ä¸€èµ·çš„ CPU åˆ©ç”¨ç‡ã€‚</p>
<p>jstackå‘½ä»¤å¯ä»¥æŠŠçº¿ç¨‹ dump ä¸‹æ¥ï¼Œçœ‹çœ‹ç©¶ç«Ÿæ˜¯å“ªä¸ªçº¿ç¨‹ã€æ‰§è¡Œä»€ä¹ˆä»£ç é€ æˆçš„ CPU åˆ©ç”¨ç‡é«˜ã€‚</p>
<p>dump å‡ºæ¥çš„çº¿ç¨‹ IDï¼ˆnidï¼‰æ˜¯åå…­è¿›åˆ¶çš„ï¼Œè€Œæˆ‘ä»¬ç”¨ TOP å‘½ä»¤çœ‹åˆ°çš„çº¿ç¨‹ ID æ˜¯åè¿›åˆ¶çš„ï¼Œæ‰€ä»¥è¦ç”¨ printf å‘½ä»¤è½¬æ¢ä¸€ä¸‹è¿›åˆ¶ã€‚ç„¶åç”¨åå…­è¿›åˆ¶çš„ ID å» dump é‡Œæ‰¾åˆ°å¯¹åº”çš„çº¿ç¨‹ã€‚</p>
<p>åè¿›åˆ¶è½¬åå…­è¿›åˆ¶ï¼š<br><code>printf &quot;%x\n&quot; 31558</code></p>
<p><code>netstat -nat | grep 8080 -c</code> å¤šå°‘å°æœºå™¨è¿æ¥åˆ°æœ¬æœº8080ç«¯å£</p>
<p><code>ps -eLf|grep java -c</code> çœ‹javaçº¿ç¨‹æ•°</p>
<h3 id="5-å¼‚æ­¥ä»»åŠ¡æ± "><a href="#5-å¼‚æ­¥ä»»åŠ¡æ± " class="headerlink" title="5.å¼‚æ­¥ä»»åŠ¡æ± "></a>5.å¼‚æ­¥ä»»åŠ¡æ± </h3><p>å¦‚æœä¸€ä¸ªä»»åŠ¡ä»è¿›çº¿ç¨‹æ± ä¹‹åï¼Œè¿è¡Œçº¿ç¨‹æ± çš„ç¨‹åºé‡å¯äº†ï¼Œé‚£ä¹ˆçº¿ç¨‹æ± é‡Œçš„ä»»åŠ¡å°±ä¼šä¸¢å¤±ã€‚å¦å¤–ï¼Œçº¿ç¨‹æ± åªèƒ½å¤„ç†æœ¬æœºçš„ä»»åŠ¡ï¼Œåœ¨é›†ç¾¤ç¯å¢ƒä¸‹ä¸èƒ½æœ‰æ•ˆåœ°è°ƒåº¦æ‰€æœ‰æœºå™¨çš„ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œç»“åˆçº¿ç¨‹æ± å¼€å‘ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¤„ç†æ± ã€‚</p>
<p>ä»»åŠ¡æ± çš„ä¸»è¦å¤„ç†æµç¨‹æ˜¯ï¼Œæ¯å°æœºå™¨ä¼šå¯åŠ¨ä¸€ä¸ªä»»åŠ¡æ± ï¼Œæ¯ä¸ªä»»åŠ¡æ± é‡Œæœ‰å¤šä¸ªçº¿ç¨‹æ± ï¼Œå½“æŸå°æœºå™¨å°†ä¸€ä¸ªä»»åŠ¡äº¤ç»™ä»»åŠ¡æ± åï¼Œä»»åŠ¡æ± ä¼šå…ˆå°†è¿™ä¸ªä»»åŠ¡ä¿å­˜åˆ°æ•°æ®ä¸­ï¼Œç„¶åæŸå°æœºå™¨ä¸Šçš„ä»»åŠ¡æ± ä¼šä»æ•°æ®åº“ä¸­è·å–å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå†æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚</p>
<p>æ¯ä¸ªä»»åŠ¡æœ‰å‡ ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯åˆ›å»ºï¼ˆNEWï¼‰ã€æ‰§è¡Œä¸­ï¼ˆEXECUTINGï¼‰ã€RETRYï¼ˆé‡è¯•ï¼‰ã€æŒ‚èµ·ï¼ˆSUSPENDï¼‰ã€ä¸­æ­¢ï¼ˆTEMINERï¼‰å’Œæ‰§è¡Œå®Œæˆï¼ˆFINISHï¼‰ã€‚</p>
<p>åˆ›å»ºï¼šæäº¤ç»™ä»»åŠ¡æ± ä¹‹åçš„çŠ¶æ€ã€‚<br>æ‰§è¡Œä¸­ï¼šä»»åŠ¡æ± ä»æ•°æ®åº“ä¸­æ‹¿åˆ°ä»»åŠ¡æ‰§è¡Œæ—¶çš„çŠ¶æ€ã€‚<br>é‡è¯•ï¼šå½“æ‰§è¡Œä»»åŠ¡æ—¶å‡ºç°é”™è¯¯ï¼Œç¨‹åºæ˜¾å¼åœ°å‘Šè¯‰ä»»åŠ¡æ± è¿™ä¸ªä»»åŠ¡éœ€è¦é‡è¯•ï¼Œå¹¶è®¾ç½®ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ã€‚<br>æŒ‚èµ·ï¼šå½“ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œä¾èµ–äºå…¶ä»–ä»»åŠ¡å®Œæˆæ—¶ï¼Œå¯ä»¥å°†è¿™ä¸ªä»»åŠ¡æŒ‚èµ·ï¼Œå½“æ”¶åˆ°æ¶ˆæ¯åï¼Œå†å¼€å§‹æ‰§è¡Œã€‚<br>ä¸­æ­¢ï¼šä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œè®©ä»»åŠ¡æ± åœæ­¢æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå¹¶è®¾ç½®é”™è¯¯æ¶ˆæ¯å‘Šè¯‰è°ƒç”¨ç«¯ã€‚<br>æ‰§è¡Œå®Œæˆï¼šä»»åŠ¡æ‰§è¡Œç»“æŸã€‚</p>
]]></content>
      <categories>
        <category>ç¬”è®°</category>
      </categories>
      <tags>
        <tag>notes</tag>
      </tags>
  </entry>
  <entry>
    <title>mavenä¸nexus</title>
    <url>/2022/06/01/myblog/java/maven%E5%92%8Cnuxus/</url>
    <content><![CDATA[<h3 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h3><ol>
<li><p>ä¼˜ç§€çš„æ„å»ºå·¥å…·<br>é€šè¿‡ç®€å•çš„å‘½ä»¤ï¼Œèƒ½å¤Ÿå®Œæˆæ¸…ç†ã€ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰ä¸€ç³»åˆ—è¿‡ç¨‹ã€‚åŒæ—¶ï¼Œä¸å¾—ä¸æçš„æ˜¯ï¼ŒMavenæ˜¯è·¨å¹³å°çš„ï¼Œæ— è®ºæ˜¯åœ¨Windowsã€è¿˜æ˜¯åœ¨Linuxæˆ–Macä¸Šï¼Œéƒ½å¯ä»¥ä½¿ç”¨åŒæ ·çš„å‘½ä»¤ã€‚</p>
</li>
<li><p>ä¾èµ–ç®¡ç†å·¥å…·<br>é¡¹ç›®ä¾èµ–çš„ç¬¬ä¸‰æ–¹çš„å¼€æºç±»åº“ï¼Œéƒ½å¯ä»¥é€šè¿‡ä¾èµ–çš„æ–¹å¼å¼•å…¥åˆ°é¡¹ç›®ä¸­æ¥ã€‚ä»£æ›¿äº†åŸæ¥éœ€è¦é¦–å…ˆä¸‹è½½ç¬¬ä¸‰æ–¹jarï¼Œå†åŠ å…¥åˆ°é¡¹ç›®ä¸­çš„æ–¹å¼ã€‚ä»è€Œæ›´å¥½çš„è§£å†³äº†åˆä½œå¼€å‘ä¸­ä¾èµ–å¢å¤šã€ç‰ˆæœ¬ä¸ä¸€è‡´ã€ç‰ˆæœ¬å†²çªã€ä¾èµ–è‡ƒè‚¿ç­‰é—®é¢˜ã€‚<br>å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼ŸMavené€šè¿‡åæ ‡ç³»ç»Ÿå‡†ç¡®çš„å®šä½æ¯ä¸€ä¸ªæ„ä»¶ï¼Œå³é€šè¿‡åæ ‡æ‰¾åˆ°å¯¹åº”çš„javaç±»åº“ã€‚</p>
</li>
<li><p>é¡¹ç›®ä¿¡æ¯ç®¡ç†å·¥å…·<br>èƒ½å¤Ÿç®¡ç†é¡¹ç›®æè¿°ã€å¼€å‘è€…åˆ—è¡¨ã€ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿåœ°å€ã€è®¸å¯è¯ç­‰ä¸€äº›æ¯”è¾ƒé›¶æ•£çš„é¡¹ç›®ä¿¡æ¯ã€‚é™¤äº†ç›´æ¥çš„é¡¹ç›®ä¿¡æ¯ï¼Œé€šè¿‡Mavenè‡ªåŠ¨ç”Ÿæˆçš„ç«™ç‚¹ï¼Œä»¥åŠä¸€äº›å·²æœ‰çš„æ’ä»¶ï¼Œè¿˜èƒ½å¤Ÿè½»æ¾è·å¾—é¡¹ç›®æ–‡æ¡£ã€æµ‹è¯•æŠ¥å‘Šã€é™æ€åˆ†ææŠ¥å‘Šã€æºç ç‰ˆæœ¬ã€æ—¥å¿—æŠ¥å‘Šç­‰éå¸¸å…·æœ‰ä»·å€¼çš„é¡¹ç›®ä¿¡æ¯ã€‚</p>
</li>
</ol>
<h3 id="mavenå‘½ä»¤"><a href="#mavenå‘½ä»¤" class="headerlink" title="mavenå‘½ä»¤"></a>mavenå‘½ä»¤</h3><p>âœ…å¸¸è§æ‰“åŒ…å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mvn clean package -Dmaven.test.skip=true		-- è·³è¿‡å•æµ‹æ‰“åŒ…</span><br><span class="line">mvn clean install -Dmaven.test.skip=true		-- è·³è¿‡å•æµ‹æ‰“åŒ…ï¼Œå¹¶æŠŠæ‰“å¥½çš„åŒ…ä¸Šä¼ åˆ°æœ¬åœ°ä»“åº“</span><br><span class="line">mvn clean deploy -Dmaven.test.skip=true			-- è·³è¿‡å•æµ‹æ‰“åŒ…ï¼Œå¹¶æŠŠæ‰“å¥½çš„åŒ…ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“</span><br></pre></td></tr></table></figure>

<p>âœ…mvnå‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mvn -v //æŸ¥çœ‹ç‰ˆæœ¬ </span><br><span class="line">mvn archetype:create //åˆ›å»º Maven é¡¹ç›® </span><br><span class="line">mvn compile //ç¼–è¯‘æºä»£ç  </span><br><span class="line">mvn test-compile //ç¼–è¯‘æµ‹è¯•ä»£ç  </span><br><span class="line">mvn test //è¿è¡Œåº”ç”¨ç¨‹åºä¸­çš„å•å…ƒæµ‹è¯• </span><br><span class="line">mvn site //ç”Ÿæˆé¡¹ç›®ç›¸å…³ä¿¡æ¯çš„ç½‘ç«™ </span><br><span class="line">mvn package //ä¾æ®é¡¹ç›®ç”Ÿæˆ jar æ–‡ä»¶ </span><br><span class="line">mvn install //åœ¨æœ¬åœ° Repository ä¸­å®‰è£… jar </span><br><span class="line">mvn -Dmaven.test.skip=true //å¿½ç•¥æµ‹è¯•æ–‡æ¡£ç¼–è¯‘ </span><br><span class="line">mvn clean //æ¸…é™¤ç›®æ ‡ç›®å½•ä¸­çš„ç”Ÿæˆç»“æœ </span><br><span class="line">mvn clean compile //å°†.javaç±»ç¼–è¯‘ä¸º.classæ–‡ä»¶ </span><br><span class="line">mvn clean package //è¿›è¡Œæ‰“åŒ… </span><br><span class="line">mvn clean test //æ‰§è¡Œå•å…ƒæµ‹è¯• </span><br><span class="line">mvn clean deploy //éƒ¨ç½²åˆ°ç‰ˆæœ¬ä»“åº“ </span><br><span class="line">mvn clean install //ä½¿å…¶ä»–é¡¹ç›®ä½¿ç”¨è¿™ä¸ªjar,ä¼šå®‰è£…åˆ°mavenæœ¬åœ°ä»“åº“ä¸­ </span><br><span class="line">mvn archetype:generate //åˆ›å»ºé¡¹ç›®æ¶æ„ </span><br><span class="line">mvn dependency:list //æŸ¥çœ‹å·²è§£æä¾èµ– </span><br><span class="line">mvn dependency:tree com.xx.xxx //çœ‹åˆ°ä¾èµ–æ ‘ </span><br><span class="line">mvn dependency:analyze //æŸ¥çœ‹ä¾èµ–çš„å·¥å…· </span><br><span class="line">mvn help:system //ä»ä¸­å¤®ä»“åº“ä¸‹è½½æ–‡ä»¶è‡³æœ¬åœ°ä»“åº“ </span><br><span class="line">mvn help:active-profiles //æŸ¥çœ‹å½“å‰æ¿€æ´»çš„profiles </span><br><span class="line">mvn help:all-profiles //æŸ¥çœ‹æ‰€æœ‰profiles </span><br><span class="line">mvn help:effective -pom //æŸ¥çœ‹å®Œæ•´çš„pomä¿¡æ¯</span><br></pre></td></tr></table></figure>



<h3 id="mavenä»“åº“"><a href="#mavenä»“åº“" class="headerlink" title="mavenä»“åº“"></a>mavenä»“åº“</h3><p>mavençš„ä¾èµ–ç®¡ç†åŠŸèƒ½ï¼Œé€šè¿‡åœ¨Pomä¸­æŒ‡å®šåæ ‡çš„å½¢å¼å°†jarå¼•å…¥åˆ°é¡¹ç›®ä¸­ã€‚jaråŒ…å°±å­˜æ”¾åœ¨ä»“åº“ä¸­ã€‚</p>
<p>Mavençš„ä»“åº“åˆ†ä¸ºæœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ã€‚è¿œç¨‹ä»“åº“åˆ†ä¸ºï¼šä¸­å¤®ä»“åº“ã€ç§æœã€å…¶ä»–è¿œç¨‹ä»“åº“ã€‚</p>
<p>å½“Mavenæ ¹æ®åæ ‡å¯»æ‰¾æ„ä»¶æ—¶ï¼Œå®ƒé¦–å…ˆä¼šæŸ¥çœ‹æœ¬åœ°ä»“åº“ï¼Œå¦‚æœæœ¬åœ°ä»“åº“å­˜åœ¨æ­¤æ„ä»¶ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ï¼›å¦‚æœæœ¬åœ°ä»“åº“ä¸å­˜åœ¨æ­¤æ„ä»¶ï¼Œæˆ–è€…éœ€è¦æŸ¥çœ‹æ˜¯å¦æœ‰æ›´æ–°çš„æ„ä»¶ç‰ˆæœ¬ï¼ŒMavenä¼šå»è¿œç¨‹ä»“åº“æŸ¥æ‰¾ï¼Œå‘ç°éœ€è¦çš„æ„ä»¶ä¹‹åï¼Œä¸‹è½½åˆ°æœ¬åœ°ä»“åº“å†ä½¿ç”¨ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦ç§æœï¼Ÿ</p>
<p>1.ä¸€äº›æ— æ³•ä»å¤–éƒ¨ä»“åº“ä¸‹è½½çš„æ„ä»¶ï¼Œä¾‹å¦‚å†…éƒ¨çš„é¡¹ç›®ï¼Œå¯ä»¥éƒ¨ç½²åˆ°ç§æœä¸Šï¼Œä»¥ä¾¿ä¾›å…¶ä»–ä¾èµ–é¡¹ç›®ä½¿ç”¨ã€‚</p>
<p>2.ä¸ºäº†èŠ‚çœå¸¦å®½å’Œæ—¶é—´ï¼Œåœ¨å±€åŸŸç½‘å†…æ¶è®¾ä¸€ä¸ªç§æœ‰çš„ä»“åº“æœåŠ¡å™¨ï¼Œç”¨å…¶ä»£ç†æ‰€æœ‰å¤–éƒ¨çš„è¿œç¨‹ä»“åº“ã€‚å½“æœ¬åœ°Mavené¡¹ç›®éœ€è¦ä¸‹è½½æ„ä»¶æ—¶ï¼Œå…ˆå»ç§æœè¯·æ±‚ï¼Œå¦‚æœç§æœæ²¡æœ‰ï¼Œåˆ™å†å»è¿œç¨‹ä»“åº“è¯·æ±‚ï¼Œä»è¿œç¨‹ä»“åº“ä¸‹è½½æ„ä»¶åï¼ŒæŠŠæ„ä»¶ç¼“å­˜åœ¨ç§æœä¸Šã€‚è¿™æ ·ï¼Œå³ä½¿æš‚æ—¶æ²¡æœ‰Interneté“¾æ¥ï¼Œç”±äºç§æœå·²ç»ç¼“å­˜äº†å¤§é‡æ„ä»¶ï¼Œæ•´ä¸ªé¡¹ç›®è¿˜æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ã€‚åŒæ—¶ï¼Œä¹Ÿé™ä½äº†ä¸­å¤®ä»“åº“çš„è´Ÿè·ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç§æœï¼Œæˆ‘ä»¬æ‰€éœ€çš„æ‰€æœ‰æ„ä»¶éƒ½éœ€è¦é€šè¿‡mavençš„ä¸­å¤®ä»“åº“å’Œç¬¬ä¸‰æ–¹çš„Mavenä»“åº“ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè€Œä¸€ä¸ªå›¢é˜Ÿä¸­çš„æ‰€æœ‰äººéƒ½é‡å¤çš„ä»mavenä»“åº“ä¸‹è½½æ„ä»¶æ— ç–‘åŠ å¤§äº†ä»“åº“çš„è´Ÿè½½å’Œæµªè´¹äº†å¤–ç½‘å¸¦å®½ï¼Œå¦‚æœç½‘é€Ÿæ…¢çš„è¯ï¼Œè¿˜ä¼šå½±å“é¡¹ç›®çš„è¿›ç¨‹ã€‚å¾ˆå¤šæƒ…å†µä¸‹é¡¹ç›®çš„å¼€å‘éƒ½æ˜¯åœ¨å†…ç½‘è¿›è¡Œçš„ï¼Œè¿æ¥ä¸åˆ°mavenä»“åº“æ€ä¹ˆåŠå‘¢ï¼Ÿå¼€å‘çš„å…¬å…±æ„ä»¶æ€ä¹ˆè®©å…¶å®ƒé¡¹ç›®ä½¿ç”¨ï¼Ÿè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸å¾—ä¸ä¸ºè‡ªå·±çš„å›¢é˜Ÿæ­å»ºå±äºè‡ªå·±çš„mavenç§æœï¼Œè¿™æ ·æ—¢èŠ‚çœäº†ç½‘ç»œå¸¦å®½ä¹Ÿä¼šåŠ é€Ÿé¡¹ç›®æ­å»ºçš„è¿›ç¨‹ï¼Œå½“ç„¶å‰ææ¡ä»¶å°±æ˜¯ä½ çš„ç§æœä¸­æ‹¥æœ‰é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰æ„ä»¶ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<p>æ€»è€Œè¨€ä¹‹ï¼šç§æœåœ¨ç”¨æˆ·å±€åŸŸç½‘å†…çš„ç‰¹æ®Šè¿œç¨‹ä»“åº“ï¼Œç§æœèµ·åˆ°äº†mavenç”¨æˆ·ä¸ä¸­å¤®ä»“åº“çš„ä¸­é—´ä½œç”¨ï¼Œç§æœä»ä¸­å¤®ä»“åº“ç¼“å­˜æ„ä»¶ï¼Œmavenç”¨æˆ·ä»ç§æœä¸‹è½½æ„ä»¶ã€‚</p>
<h3 id="nexus"><a href="#nexus" class="headerlink" title="nexus"></a>nexus</h3><p>nexuså°±æ˜¯ç§æœçš„ä¸€ç§ã€‚</p>
<p>nexusæ˜¯ä¸€ä¸ªå¼ºå¤§çš„mavenä»“åº“ç®¡ç†å™¨,å®ƒæå¤§çš„ç®€åŒ–äº†æœ¬åœ°å†…éƒ¨ä»“åº“çš„ç»´æŠ¤å’Œå¤–éƒ¨ä»“åº“çš„è®¿é—®.</p>
<p>nexusæä¾›äº†å¼ºå¤§çš„ä»“åº“ç®¡ç†åŠŸèƒ½,æ„ä»¶æœç´¢åŠŸèƒ½,å®ƒåŸºäºREST,å‹å¥½çš„UIæ˜¯ä¸€ä¸ªextjsçš„RESTå®¢æˆ·ç«¯,å ç”¨è¾ƒå°‘çš„å†…å­˜,åŸºäºç®€å•æ–‡ä»¶ç³»ç»Ÿè€Œéæ•°æ®åº“.</p>
<p>èŠ‚çœå¤–ç½‘å¸¦å®½ï¼›åŠ é€ŸMavenæ„å»ºï¼›éƒ¨ç½²ç¬¬ä¸‰æ–¹æ„ä»¶ï¼›æé«˜ç¨³å®šæ€§ï¼Œå¢å¼ºæ§åˆ¶ï¼›é™ä½ä¸­å¤®ä»“åº“çš„è´Ÿè·ï¼›æ§åˆ¶å’Œå®¡è®¡ï¼›å»ºç«‹æœ¬åœ°å†…éƒ¨å…¬ç”¨ä»“åº“ã€‚</p>
<p>è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/youngdeng/p/15098442.html">https://www.cnblogs.com/youngdeng/p/15098442.html</a></p>
<p>å¦‚ä½•é…ç½®ï¼š<a href="https://www.jianshu.com/p/5b06b2541336">https://www.jianshu.com/p/5b06b2541336</a></p>
<h3 id="é…ç½®é¡¹ç›®é‡åˆ°çš„å‡ ä¸ªé—®é¢˜"><a href="#é…ç½®é¡¹ç›®é‡åˆ°çš„å‡ ä¸ªé—®é¢˜" class="headerlink" title="é…ç½®é¡¹ç›®é‡åˆ°çš„å‡ ä¸ªé—®é¢˜"></a>é…ç½®é¡¹ç›®é‡åˆ°çš„å‡ ä¸ªé—®é¢˜</h3><p>èƒŒæ™¯ï¼šæŠŠä¹‹å‰çš„åŒ…æƒ³ç§»åŠ¨åˆ°æ–°åˆ›å»ºçš„ä¸€ä¸ªå­åŒ…é‡Œã€‚</p>
<p>âœ…çˆ¶å­å·¥ç¨‹å¼•ç”¨çš„é—®é¢˜</p>
<p>1ã€Parentæ€ä¹ˆèƒ½æ‰¾åˆ°childAå’ŒchildBå‘¢ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;modules&gt;</span><br><span class="line">   &lt;module&gt;childA&lt;/module&gt;</span><br><span class="line">   &lt;module&gt;childB&lt;/module&gt;</span><br><span class="line">&lt;/modules&gt;</span><br></pre></td></tr></table></figure>

<p>2ã€pomâ€ç»§æ‰¿â€çš„æ¦‚å¿µ</p>
<p>å¦‚æœåˆ†åˆ«å»åœ¨å„è‡ªçš„pomé‡Œå¼•ç”¨åŒ…ï¼Œå°±ä¼šå¯¼è‡´pomæ–‡ä»¶å¼•å…¥çš„åŒ…é‡å¤ã€‚<br>çˆ¶pomå†™å¥½äº†ï¼Œå­pomå°±é€šè¿‡<code>&lt;parent&gt;</code>æ ‡ç­¾ç»§æ‰¿çˆ¶pomçš„ä¾èµ–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">   &lt;groupId&gt;com.sang.main&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;Parent-Moduel&lt;/artifactId&gt;</span><br><span class="line">   &lt;version&gt;1.0.2&lt;/version&gt;</span><br><span class="line">   &lt;relativePath&gt;../pom.xml&lt;/relativePath&gt;  &lt;!--æœ¬ä¾‹ä¸­æ­¤å¤„æ˜¯å¯é€‰çš„ï¼Œä¸æ˜¯åœ¨å¤–å±‚åŒ…ä¸‹çš„è¯ç”¨--&gt;</span><br><span class="line">&lt;/parent&gt;</span><br></pre></td></tr></table></figure>

<p>å­pomä¸­å¼•å…¥<code>&lt;parent&gt;</code>æ ‡ç­¾åï¼Œå°±ä¼šä»çˆ¶pomç»§æ‰¿<code>&lt;version&gt;</code>ç­‰å±æ€§äº†,ä¸»pomä¸­æŠŠä¾èµ–é€šè¿‡<code>&lt;dependecyManagement&gt;</code>å¼•èµ·æ¥ï¼Œè¡¨ç¤ºå­pomå¯èƒ½ä¼šç”¨åˆ°çš„jaråŒ…ä¾èµ–ï¼Œå­åŒ…å¼•ç”¨çš„è¯ï¼Œå¯ä»¥ä¸åŠ versionå±æ€§ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ï¼ŒåŠ äº†çš„è¯è¡¨ç¤ºå­åŒ…å•ç‹¬ç”¨è¿™ä¸ªç‰ˆæœ¬ã€‚</p>
<p>æ‘˜è‡ªï¼š<a href="https://blog.csdn.net/SunFlowerXT/article/details/105531109">https://blog.csdn.net/SunFlowerXT/article/details/105531109</a></p>
<p>âœ…Junitæ‰¾ä¸åˆ°çš„é—®é¢˜ï¼Œtestæ”¾åœ¨mainé‡Œï¼Œç»“æ„é™å®šscopeä¸ºtest</p>
<p>âœ…class notFound ä»¥åŠ æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±»</p>
<p>é¡¹ç›®ç»“æ„æ²¡æœ‰å®‰æ’æ˜ç™½çš„åŸå› ï¼Œç‚¹project structureï¼Œçˆ¶åŒ…ä¸‹é¢çš„mainåŒ…å’ŒteståŒ…ä¸‹çš„javaåŒ…å•¥çš„éƒ½ä¸ä½œä¸ºsourceå’Œtestï¼Œresourceä¹Ÿä¸ä½œä¸ºreesourceã€‚å­åŒ…ä¸‹é¢çš„æ¨¡å—é€‰å¥½ã€‚å°±å¯ä»¥äº†ã€‚</p>
<p>âœ…æ‰“åŒ…æ—¶æ³¨æ„</p>
<p>æ‰“åŒ…æ—¶æ³¨æ„ï¼š</p>
<p>å½“mvnä»“åº“é‡Œç¼ºå°‘jaråŒ…ï¼ŒåŒæ—¶åˆä»ä¸­å¤®ä»“åº“è‡ªåŠ¨ä¸‹è½½ä¸ä¸‹æ¥çš„æ—¶å€™ï¼Œå°±éœ€è¦è‡ªå·±ä¸‹è½½jaråŒ…ç„¶åæ”¾ä»“åº“é‡Œäº†ï¼Œ<br>ä½†æ˜¯æœ‰æ—¶å€™åªæ˜¯ç®€å•çš„æŠŠjarå’Œsourceæ”¾ä»“åº“çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶ä¸ç®¡ç”¨ï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥ç”¨å‘½ä»¤æŠŠjaræŠŠæ‰“è¿›å»ï¼š<br><code>mvn install:install-file -Dfile=D:\xxx.jar -DgroupId=commons-dbcp -DartifactId= commons-dbcp -Dversion= 1.4 -Dpackaging=jar</code><br>-Dfile æ˜¯å­˜åœ¨æœ¬åœ°ç£ç›˜é‡Œjar çš„è·¯å¾„</p>
<p>âœ…jaråŒ…å†²çª</p>
<p>mvn dependency:treeå‘½ä»¤è§£å†³jaråŒ…å†²çª<br>å½“é¡¹ç›®å‡ºç°jaråŒ…å†²çªæ—¶,ç”¨å‘½ä»¤mvn dependency:tree æŸ¥çœ‹ä¾èµ–æƒ…å†µ<br>mvn dependency:tree æŸ¥çœ‹ä¾èµ–æ ‘,æŸ¥çœ‹åŒ…ç»“æ„é—´çš„ä¾èµ–<br>mvn dependency:tree &gt;d:&#x2F;tmp æŠŠç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ï¼Œ<br>ç„¶åå†pom.xmlæ–‡ä»¶é‡Œæ’é™¤æ‰å†²çªçš„jaråŒ…</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/good_good_xiu/article/details/116740333">https://blog.csdn.net/good_good_xiu/article/details/116740333</a></p>
<p>âš ï¸æœ¬åœ°å¯åŠ¨é¡¹ç›®ï¼Œæœ‰åŒ…æ˜¾çº¢ï¼Œåœ¨maven - root - compileä¸€ä¸‹ã€‚<br>mavenä¸­çš„compileå‘½ä»¤æ˜¯ç”¨æ¥å°†æºä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œçš„classæ–‡ä»¶ï¼Œæˆ–è€…æŠŠå®ƒæ‰“åŒ…æˆjaræ–‡ä»¶ï¼Œä»¥ä¾¿ä»–äººä½¿ç”¨ã€‚</p>
<p>âœ…ä¸ºä»€ä¹ˆåŒ…æ²¡æœ‰åœ¨pomä¸­å¼•å…¥ï¼Œä½†æ˜¯compileç¼–è¯‘ä¹‹ååœ¨targetæ–‡ä»¶ä¸­å´å‡ºç°äº†å‘¢ã€‚<br>mavenä¼šè‡ªåŠ¨å¯»æ‰¾ä¾èµ–å¹¶è‡ªåŠ¨åŠ è½½å®ƒä»¬ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå³ä½¿å®ƒä»¬æ²¡æœ‰åœ¨pomæ–‡ä»¶ä¸­æ˜¾å¼å¼•å…¥ï¼Œä¹Ÿä¼šè¢«è‡ªåŠ¨åŠ è½½åˆ°é¡¹ç›®ä¸­ã€‚ä¹Ÿæœ‰å¯èƒ½å…¶ä»–ä¾èµ–å¼•å…¥äº†è¯¥åŒ…ã€‚è¿™äº›jaråŒ…ä¼šè¢«ç¼–è¯‘æˆclassæ–‡ä»¶ï¼ŒmavenæŠŠå®ƒä»¬æ”¾åœ¨targetç›®å½•ä¸‹ï¼Œä»¥ä¾¿æ­£å¸¸ä½¿ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>javaè¯Šæ–­</title>
    <url>/2022/09/10/myblog/java/java%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h2 id="javaè¯Šæ–­å·¥å…·arthas"><a href="#javaè¯Šæ–­å·¥å…·arthas" class="headerlink" title="javaè¯Šæ–­å·¥å…·arthas"></a>javaè¯Šæ–­å·¥å…·arthas</h2><h3 id="âœ…ç®€ä»‹"><a href="#âœ…ç®€ä»‹" class="headerlink" title="âœ…ç®€ä»‹"></a>âœ…ç®€ä»‹</h3><p>Arthas æ˜¯Alibabaå¼€æºçš„Javaè¯Šæ–­å·¥å…·ã€‚å®‰è£…åœ¨ç³»ç»Ÿæ‰€åœ¨æœåŠ¡å™¨ã€‚å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æˆ–è€…è¿ç»´äººå‘˜æŸ¥æ‰¾é—®é¢˜ï¼Œåˆ†ææ€§èƒ½ï¼Œbugè¿½è¸ªã€‚</p>
<p>è§£å†³é—®é¢˜ï¼š<br>1ã€ä»¥å…¨å±€è§†è§’æ¥æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µã€å¥åº·çŠ¶å†µã€‚<br>2ã€åç¼–è¯‘æºç ï¼ŒæŸ¥çœ‹jvmåŠ è½½çš„æ˜¯å¦ä¸ºé¢„æœŸçš„æ–‡ä»¶å†…å®¹ã€‚<br>3ã€æŸ¥çœ‹æŸä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œå‚æ•°ç­‰ç­‰ã€‚<br>4ã€æ–¹æ³•å†…è°ƒç”¨è·¯å¾„åŠå„æ–¹æ³•è°ƒç”¨è€—æ—¶ã€‚<br>5ã€æŸ¥çœ‹jvmè¿è¡ŒçŠ¶å†µã€‚<br>6ã€å¤–éƒ¨.classæ–‡ä»¶é‡æ–°åŠ è½½åˆ°jvmé‡Œã€‚<br>ç­‰ç­‰â€¦..</p>
<p>åœºæ™¯ï¼š<br>1ï¼‰è°ƒç”¨æ¥å£æ—¶ï¼Œæ¥å£è¿”å›å¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚æœè¯¥å¼‚å¸¸ä¿¡æ¯æ²¡æœ‰æ¸…æ™°çš„å®šä½åˆ°ä»£ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šå¸¸åªèƒ½ä¾é å¤§è„‘å›å¿†ä»£ç ï¼Œæ¥ä¼°è®¡é”™è¯¯å‘ç”Ÿåœ°äº†ï¼Œå¦‚æœæ— æ³•ä¼°è®¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å°±ä¼šè¿›å…¥æµ‹è¯•ç¯å¢ƒï¼Œæ¨¡æ‹Ÿå¤ç°ï¼Œå¦‚æœæ— æ³•å¤ç°ã€‚<br>2ï¼‰è¿™ä¸ªæŸ¥è¯¢ï¼Œè€—æ—¶20sï¼Œæˆ‘ä»¬æƒ³è¦åˆ†æä¸€ä¸‹åˆ°åº•æ˜¯å“ªäº›ä»£ç å¯¼è‡´çš„ã€‚ä½†æ˜¯è¯¥æ–¹æ³•å†…éƒ¨åˆç©¿æ’è°ƒç”¨äº†å…¶å®ƒä¸šåŠ¡åŠŸèƒ½æ–¹æ³•ï¼Œéš¾é“æ‰‹å†™System.currentTimeMillis()è‡ªå·±åšå‡è¿ç®—ï¼Œè¿˜æ˜¯guavaçš„StopWatchäº¦æˆ–æ˜¯commonsçš„StopWatchï¼Ÿè¿™å‡ ç§æ–¹å¼éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åµŒå…¥ä»£ç ï¼Œå®¹æ˜“é—æ¼ã€è´¹åŠ›è¿˜è´¹æ—¶ã€‚<br>ç­‰ç­‰<br>arthaså¯ä»¥ä¸ºæˆ‘ä»¬è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¸®åŠ©ç¨‹åºå‘˜å°½æ—©ä¸‹ç­ï¼Œå°½æ—©äº¤ä»£ã€‚</p>
<h3 id="âœ…å®‰è£…å¯åŠ¨"><a href="#âœ…å®‰è£…å¯åŠ¨" class="headerlink" title="âœ…å®‰è£…å¯åŠ¨"></a>âœ…å®‰è£…å¯åŠ¨</h3><p>ä¸‹è½½: wget <a href="https://alibaba.github.io/arthas/arthas-boot.jar">https://alibaba.github.io/arthas/arthas-boot.jar</a><br>å¯åŠ¨: java -jar arthas-boot.jar</p>
<p>é€€å‡ºarthas<br>quit â€”â€” é€€å‡ºå½“å‰ Arthas å®¢æˆ·ç«¯ï¼Œå…¶ä»– Arthas å®¢æˆ·ç«¯ä¸å—å½±å“<br>shutdown â€”â€” å…³é—­ Arthas æœåŠ¡ç«¯ï¼Œæ‰€æœ‰ Arthas å®¢æˆ·ç«¯å…¨éƒ¨é€€å‡º &amp; é‡ç½®æ‰€æœ‰å¢å¼ºè¿‡çš„ç±»ï¼Œå°±ä¸ç”¨å•ç‹¬è°ƒç”¨reset</p>
<h3 id="âœ…åº”ç”¨"><a href="#âœ…åº”ç”¨" class="headerlink" title="âœ…åº”ç”¨"></a>âœ…åº”ç”¨</h3><p>1ã€æŸ¥çœ‹æŸæ–¹æ³•è€—æ—¶</p>
<p><code>trace cn.asae.e.contract.web.ContractController getContract</code></p>
<p>2ã€æ˜¾ç¤ºè¿›ç¨‹ç›¸å…³ä¿¡æ¯ï¼Œä»ªè¡¨ç›˜</p>
<p><code>dashboard</code></p>
<p>3ã€æŸ¥çœ‹ç±»é‡ŒæŸä¸ªæ–¹æ³•çš„è¿”å›å€¼å’Œå…¥å‚</p>
<p>å‘½ä»¤+ç±»å®Œå…¨é™å®šå+ç›‘æµ‹æ–¹æ³•+è¡¨è¾¾å¼<br><code>watch cn.asae.e.contract.web.ContractSubjectController getContractSubjectLogs &quot;&#123;params,returnObj&#125;&quot;</code></p>
<p>4ã€æ—¶ç©ºéš§é“</p>
<p>æ–¹æ³•æ‰§è¡Œæ•°æ®çš„æ—¶ç©ºéš§é“ï¼Œè®°å½•ä¸‹æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›ä¿¡æ¯ï¼Œå¹¶èƒ½å¯¹è¿™äº›ä¸åŒçš„æ—¶é—´ä¸‹è°ƒç”¨è¿›è¡Œè§‚æµ‹</p>
<p><code>tt -t cn.asae.e.contract.web.ContractSubjectController getContractSubjectLogs</code><br>-t ä»£è¡¨è®°å½•ä¸‹æ¯æ¬¡æ–¹æ³•æ‰§è¡Œæƒ…å†µ</p>
<p>5ã€æŸ¥çœ‹JVMå·²åŠ è½½çš„ç±»ä¿¡æ¯</p>
<p><code>sc -d cn.asae.e.contract.web.ContractSubjectController</code></p>
<p>-d è¾“å‡ºå½“å‰ç±»çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿™ä¸ªç±»æ‰€åŠ è½½çš„åŸå§‹æ–‡ä»¶æ¥æºã€ç±»çš„å£°æ˜ã€åŠ è½½çš„ClassLoaderç­‰è¯¦ç»†ä¿¡æ¯ã€‚<br>å¦‚æœä¸€ä¸ªç±»è¢«å¤šä¸ªClassLoaderæ‰€åŠ è½½ï¼Œåˆ™ä¼šå‡ºç°å¤šæ¬¡</p>
<p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/jiawen010/p/15513454.html">https://www.cnblogs.com/jiawen010/p/15513454.html</a></p>
<p>å…¶ä»–ï¼š<a href="https://blog.csdn.net/weixin_37650458/article/details/123561000">https://blog.csdn.net/weixin_37650458/article/details/123561000</a></p>
<h2 id="fullGC"><a href="#fullGC" class="headerlink" title="fullGC"></a>fullGC</h2><h3 id="âœ…ä»€ä¹ˆæ˜¯GC-heapåˆ†åŒº"><a href="#âœ…ä»€ä¹ˆæ˜¯GC-heapåˆ†åŒº" class="headerlink" title="âœ…ä»€ä¹ˆæ˜¯GC &amp; heapåˆ†åŒº"></a>âœ…ä»€ä¹ˆæ˜¯GC &amp; heapåˆ†åŒº</h3><p>Javaåƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒJavaé€šè¿‡å¯è¾¾æ€§åˆ†æä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ˜¯å¦å­˜åœ¨ï¼Œå½“ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œå°†å›æ”¶å †ä¸­çš„å¯¹è±¡ã€‚å›æ”¶æ— ç”¨å†…å­˜ç©ºé—´</p>
<p>ä¸€èˆ¬è€Œè¨€ï¼ŒGCä¸»è¦æ˜¯é’ˆå¯¹è¿è¡Œçš„æ•°æ®åŒºçš„ã€‚ä½œä¸ºç¨‹åºå‘˜è¦å…³æ³¨çš„åŒºåŸŸä¸»è¦æœ‰5å—ï¼Œåˆ†åˆ«æ˜¯æ–¹æ³•åŒº(Method Area)ï¼ŒJavaæ ˆ(Java stack)ï¼Œæœ¬åœ°æ–¹æ³•æ ˆ(Native Method Stack)ï¼Œå †(Heap)ï¼Œç¨‹åºè®¡æ•°å™¨(Program Counter Register)ã€‚å®é™…jvmåœ¨ç®¡ç†å†…å­˜çš„æ—¶å€™ï¼Œæ¯”è¿™ä¸ªåˆ†çš„æ›´ç»†è‡´ï¼Œåªä¸è¿‡åšåº”ç”¨ç¨‹åºå¼€å‘ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨è¿™5å—å°±å¯ä»¥äº†ã€‚</p>
<p>â€œå †â€ï¼Œä¹Ÿå°±æ˜¯Heapäº†ï¼Œå®ƒæ˜¯Jvmç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚ç¨‹åºçš„ä¸»è¦æ•°æ®ä¹Ÿéƒ½æ˜¯å­˜æ”¾åœ¨å †å†…å­˜ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç¨‹åºæ‰€åˆ›å»ºçš„å¯¹è±¡åŸºæœ¬ä¸Šéƒ½åœ¨è¯¥åŒºåŸŸè¿›è¡Œå†…å­˜åˆ†é…ï¼Œè¿™ä¸€å—åŒºåŸŸè¢«æ‰€æœ‰çš„çº¿ç¨‹æ‰€å…±äº«ï¼Œé€šå¸¸å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ä¸€èˆ¬éƒ½æ˜¯è¿™ä¸ªåŒºåŸŸçš„æ•°æ®å‡ºç°çš„é—®é¢˜ã€‚é€šå¸¸æˆ‘ä»¬æ‰€è¯´çš„gcä¸»è¦æ˜¯é’ˆå¯¹java heapè¿™å—åŒºåŸŸçš„ã€‚</p>
<p>HeapåŒºåœ¨è®¾è®¡ä¸Šæ˜¯åˆ†ä»£è®¾è®¡çš„ï¼Œå…¶åˆ’åˆ†ä¸ºäº†Edenã€Survivor å’Œ Tenured&#x2F;Old ï¼Œå…¶ä¸­EdenåŒºã€Survivor(å­˜æ´»)å±äºå¹´è½»ä»£ï¼ŒTenured&#x2F;OldåŒºå±äºè€å¹´ä»£æˆ–è€…æŒä¹…ä»£ã€‚</p>
<p>ä¸€èˆ¬æˆ‘ä»¬å°†å¹´è½»ä»£å‘ç”Ÿçš„GCç§°ä¸ºMinor GCï¼Œå¯¹è€å¹´ä»£è¿›è¡ŒGCç§°ä¸ºMajor GCã€‚</p>
<p>è€ŒFullGCæ˜¯å¯¹æ•´ä¸ªå †æ¥è¯´çš„ï¼Œåœ¨æœ€è¿‘å‡ ä¸ªç‰ˆæœ¬çš„JDKé‡Œé»˜è®¤åŒ…æ‹¬äº†å¯¹æ°¸ç”Ÿå¸¦å³æ–¹æ³•åŒºçš„å›æ”¶(JDK8ä¸­æ— æ°¸ç”Ÿå¸¦äº†)ï¼Œå‡ºç°Full GCçš„æ—¶å€™ç»å¸¸ä¼´éšè‡³å°‘ä¸€æ¬¡çš„Minor GC,ä½†éç»å¯¹çš„ã€‚Major GCçš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯”Minor GCæ…¢10å€ä»¥ä¸Šã€‚</p>
<hr>
<p>JVMçš„å †åŒºå¯¹è±¡åˆ†é…çš„ä¸€èˆ¬è§„åˆ™ï¼š</p>
<ol>
<li><p>å¯¹è±¡ä¼˜å…ˆåœ¨EdenåŒºåˆ†é…ï¼Œå½“edenä¸å¤Ÿåˆ†é…æ—¶ï¼Œè¿›è¡Œä¸€æ¬¡minor gcã€‚ï¼ˆjavaå¯¹è±¡å¤§å¤šå¾ˆå¿«æ²¡æ‰ï¼Œæ‰€ä»¥minor gcå¾ˆé¢‘ç¹ï¼‰</p>
</li>
<li><p>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£(-XX:PretenureSizeThreshold&#x3D;3145728 è¿™ä¸ªå‚æ•°æ¥å®šä¹‰å¤šå¤§çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£)</p>
</li>
<li><p>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£(-XX:MaxTenuringThreshold&#x3D;1è®¾ç½®æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼)</p>
</li>
<li><p>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šï¼šè™šæ‹Ÿæœºå¹¶ä¸ä¼šæ°¸è¿œåœ°è¦æ±‚å¯¹è±¡çš„å¹´é¾„éƒ½å¿…é¡»è¾¾åˆ°MaxTenuringThresholdæ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœSurvivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡çš„å¤§å°æ€»å’Œå¤§äºSurvivorçš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£</p>
</li>
<li><p>ç©ºé—´åˆ†é…æ‹…ä¿ï¼šè®¡ç®—æ–°ç”Ÿä»£minor gcåå‰©ä¸‹çš„å¯¹è±¡è‹¥survivoræ— æ³•å®¹çº³ï¼Œæ˜¯å¦èƒ½é€šè¿‡è€å¹´ä»£æ¥æ‹…ä¿åˆ†é…ç©ºé—´ï¼Œå¦‚æœä¸èƒ½ï¼Œéœ€è¦è§¦å‘ä¸€æ¬¡full gcã€‚HandlePromotionFailure&#x3D;falseè®¾ç½®æ˜¯å¦å…è®¸è€å¹´ä»£æ‹…ä¿ã€‚</p>
</li>
<li><p>åªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äº(æ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»å¤§å°æˆ–è€…å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°)å°±ä¼šè¿›è¡Œminor GCï¼Œå¦åˆ™ä¼šè¿›è¡Œfull GCã€‚</p>
</li>
</ol>
<h3 id="âœ…FullGCçš„è§¦å‘æ¡ä»¶"><a href="#âœ…FullGCçš„è§¦å‘æ¡ä»¶" class="headerlink" title="âœ…FullGCçš„è§¦å‘æ¡ä»¶"></a>âœ…FullGCçš„è§¦å‘æ¡ä»¶</h3><p>FullGCæ˜¯é’ˆå¯¹æ•´ä¸ªHeapåŒºè€Œè¨€çš„ï¼Œå®ƒå°†åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µè¢«è§¦å‘ï¼š</p>
<p>1ã€åœ¨ç¨‹åºä¸­è°ƒç”¨äº†System.gc()æ–¹æ³•ã€‚æ­¤æ–¹æ³•çš„è°ƒç”¨æ˜¯å»ºè®®JVMè¿›è¡ŒFull GC,è™½ç„¶åªæ˜¯å»ºè®®è€Œéä¸€å®šï¼Œä½†å¾ˆå¤šæƒ…å†µä¸‹å®ƒä¼šè§¦å‘ Full GC,ä»è€Œå¢åŠ Full GCçš„é¢‘ç‡ï¼Œä¹Ÿå³å¢åŠ äº†é—´æ­‡æ€§åœé¡¿çš„æ¬¡æ•°ã€‚å¼ºçƒˆå½±å“ç³»å»ºè®®èƒ½ä¸ä½¿ç”¨æ­¤æ–¹æ³•å°±åˆ«ä½¿ç”¨ï¼Œè®©è™šæ‹Ÿæœºè‡ªå·±å»ç®¡ç†å®ƒçš„å†…å­˜ï¼Œå¯é€šè¿‡<code>-XX:+ DisableExplicitGC</code>æ¥ç¦æ­¢RMI(Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨)è°ƒç”¨System.gcã€‚</p>
<p>2ã€è€å¹´ä»£ç©ºé—´ä¸è¶³ã€‚è€å¹´ä»£ç©ºé—´åªæœ‰åœ¨æ–°ç”Ÿä»£å¯¹è±¡è½¬å…¥åŠåˆ›å»ºä¸ºå¤§å¯¹è±¡ã€å¤§æ•°ç»„æ—¶æ‰ä¼šå‡ºç°ä¸è¶³çš„ç°è±¡ï¼Œå½“æ‰§è¡ŒFull GCåç©ºé—´ä»ç„¶ä¸è¶³ï¼Œåˆ™æŠ›å‡ºå¦‚ä¸‹é”™è¯¯ã€java.lang.OutOfMemoryError: Java heap spaceã€‘ï¼Œè€Œä¸ºé¿å…ä»¥ä¸Šä¸¤ç§çŠ¶å†µå¼•èµ·çš„Full GCï¼Œè°ƒä¼˜æ—¶åº”å°½é‡åšåˆ°è®©å¯¹è±¡åœ¨Minor GCé˜¶æ®µè¢«å›æ”¶ã€è®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»ä¸€æ®µæ—¶é—´åŠä¸è¦åˆ›å»ºè¿‡å¤§çš„å¯¹è±¡åŠæ•°ç»„ã€‚</p>
<p>3ã€Permanet Generationç©ºé—´æ»¡äº†ã€‚ä¹Ÿå°±æ˜¯ä»¥å‰æ‰€è¯´çš„æ–¹æ³•åŒºï¼ŒPermanet Generationä¸­å­˜æ”¾çš„ä¸ºä¸€äº›classçš„ä¿¡æ¯ç­‰ï¼Œå½“ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤šæ—¶ï¼ŒPermanet Generationå¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡ç”¨CMS GCï¼ˆconcurrent mark sweep æ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰çš„æƒ…å†µä¸‹ä¼šæ‰§è¡ŒFull GCã€‚å¦‚æœç»è¿‡Full GCä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆJVMä¼šæŠ›å‡ºé”™è¯¯ä¿¡æ¯ï¼šjava.lang.OutOfMemoryError: PermGen space ã€‚ä¸ºé¿å…Perm Genå æ»¡é€ æˆFull GCç°è±¡ï¼Œå¯é‡‡ç”¨çš„æ–¹æ³•ä¸ºå¢å¤§Perm Genç©ºé—´æˆ–è½¬ä¸ºä½¿ç”¨CMS GCã€‚</p>
<p>4ã€é€šè¿‡Minor GCåè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜ã€‚å¦‚æœå‘ç°ç»Ÿè®¡æ•°æ®è¯´ä¹‹å‰Minor GCçš„å¹³å‡æ™‹å‡å¤§å°æ¯”ç›®å‰old genå‰©ä½™çš„ç©ºé—´å¤§ï¼Œåˆ™ä¸ä¼šè§¦å‘Minor GCè€Œæ˜¯è½¬ä¸ºè§¦å‘full GCã€‚ç”±EdenåŒºã€From SpaceåŒºå‘To SpaceåŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äºTo Spaceå¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è€å¹´ä»£çš„å¯ç”¨å†…å­˜å°äºè¯¥å¯¹è±¡å¤§å°ã€‚åˆ†é…å¾ˆå¤§çš„å¯¹è±¡ã€‚æ‰€è°“å¤§å¯¹è±¡ï¼Œæ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„javaå¯¹è±¡ï¼Œä¾‹å¦‚å¾ˆé•¿çš„æ•°ç»„ï¼Œæ­¤ç§å¯¹è±¡ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œè€Œè€å¹´ä»£è™½ç„¶æœ‰å¾ˆå¤§çš„å‰©ä½™ç©ºé—´ï¼Œä½†æ˜¯æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…ç»™å½“å‰å¯¹è±¡ï¼Œæ­¤ç§æƒ…å†µå°±ä¼šè§¦å‘JVMè¿›è¡ŒFull GCã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCMSåƒåœ¾æ”¶é›†å™¨æä¾›äº†ä¸€ä¸ªå¯é…ç½®çš„å‚æ•°ï¼Œå³<code>-XX:+UseCMSCompactAtFullCollection</code>å¼€å…³å‚æ•°ï¼Œç”¨äºåœ¨â€œäº«å—â€å®ŒFull GCæœåŠ¡ä¹‹åé¢å¤–å…è´¹èµ é€ä¸€ä¸ªç¢ç‰‡æ•´ç†çš„è¿‡ç¨‹ï¼Œå†…å­˜æ•´ç†çš„è¿‡ç¨‹æ— æ³•å¹¶å‘çš„ï¼Œç©ºé—´ç¢ç‰‡é—®é¢˜æ²¡æœ‰äº†ï¼Œä½†åœé¡¿æ—¶é—´ä¸å¾—ä¸å˜é•¿äº†ï¼ŒJVMè®¾è®¡è€…ä»¬è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªå‚æ•° <code>-XX:CMSFullGCsBeforeCompaction</code>ï¼Œè¿™ä¸ªå‚æ•°ç”¨äºè®¾ç½®åœ¨æ‰§è¡Œå¤šå°‘æ¬¡ä¸å‹ç¼©çš„Full GCåï¼Œè·Ÿç€æ¥ä¸€æ¬¡å¸¦å‹ç¼©çš„ã€‚</p>
<h3 id="âœ…åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#âœ…åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="âœ…åˆ†ä»£æ”¶é›†ç®—æ³•"></a>âœ…åˆ†ä»£æ”¶é›†ç®—æ³•</h3><p>é’ˆå¯¹å¹´è½»ä»£å’Œè€å¹´ä»£ï¼ŒJVMå°†ä½¿ç”¨ä¸åŒçš„åƒåœ¾æ”¶é›†ç®—æ³•è¿›è¡Œæ”¶é›†ï¼Œè¾¾åˆ°é«˜æ•ˆçš„åƒåœ¾å›æ”¶ã€‚</p>
<p>1ã€å¹´è½»ä»£é‡‡ç”¨çš„æ˜¯æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œå°†éœ€è¦å›æ”¶çš„å¯¹è±¡æ ‡è®°ï¼Œå°†ä¸éœ€è¦çš„å¯¹è±¡ç§»åŠ¨åˆ°Survivorç©ºé—´ï¼Œç„¶åå°†æ ‡è®°å¯¹è±¡å›æ”¶ï¼Œè¯¥ç®—æ³•å¯ä»¥å®ç°å¯¹å¤§å¤šæ•°ä¼šå¤±æ•ˆçš„å¯¹è±¡è¿›è¡Œå›æ”¶ï¼Œå¯¹å°‘éƒ¨åˆ†ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡è¿›è¡Œè½¬ç§»ï¼Œä¿è¯edenåŒºæ‹¥æœ‰è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè€Œä¸”å¤åˆ¶çš„æ•ˆç‡é«˜ã€‚</p>
<p>å› ä¸ºåœ¨å¹´è½»ä»£ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡ä¸€èˆ¬æ˜¯å¾ˆå°‘çš„ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶éƒ½æœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œé€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ã€‚</p>
<p>2ã€è€å¹´ä»£é‡‡ç”¨çš„æ˜¯æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œå°†éœ€è¦å›æ”¶çš„å¯¹è±¡æ ‡è®°ï¼Œå°†ä¸éœ€è¦çš„å¯¹è±¡è¿›è¡Œç§»åŠ¨æ•´ç†ï¼Œä½¿ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡å ç”¨è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå†æ¸…é™¤å›æ”¶å¯¹è±¡ï¼Œä¿è¯è€å¹´ä»£æ‹¥æœ‰è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè€Œä¸”æ•´ç†æ•ˆç‡é«˜ã€‚</p>
<p>å› ä¸ºåœ¨è€å¹´ä»£éœ€è¦å›æ”¶çš„å¯¹è±¡ä¸€èˆ¬æ˜¯å¾ˆå°‘çš„ï¼Œå…¶å­˜æ´»ç‡è¾ƒé«˜ã€æ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ã€‚</p>
<p>3ã€CMS GCï¼ˆconcurrent mark sweep æ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰è€å¹´ä»£ä¸­ä½¿ç”¨ï¼šæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œåç»Ÿä¸€å›æ”¶ã€‚ç¼ºç‚¹ï¼šæ ‡è®°æ¸…é™¤æ•ˆç‡ä¸é«˜ï¼Œäº§ç”Ÿç¢ç‰‡å¤šã€‚ä½†æ˜¯å¹¶å‘æ”¶é›†ï¼Œä½åœé¡¿ã€‚</p>
<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/weixin_35291771/article/details/114075710">https://blog.csdn.net/weixin_35291771/article/details/114075710</a></p>
<p>æ¢ç§˜Javaè™šæ‹Ÿæœºâ€”â€”å†…å­˜ç®¡ç†ä¸åƒåœ¾å›æ”¶ï¼š<br><a href="http://www.blogjava.net/chhbjh/archive/2012/01/28/368936.html">http://www.blogjava.net/chhbjh/archive/2012/01/28/368936.html</a></p>
<h3 id="âœ…ä»€ä¹ˆæ˜¯fullgc"><a href="#âœ…ä»€ä¹ˆæ˜¯fullgc" class="headerlink" title="âœ…ä»€ä¹ˆæ˜¯fullgc"></a>âœ…ä»€ä¹ˆæ˜¯fullgc</h3><p>ä¸€äº›æ¦‚å¿µï¼š</p>
<p>GC<br>GC å…¨ç§°ä¸ºgarbage collection,ä¸­æ–‡å«ä¹‰ä¸ºåƒåœ¾å›æ”¶ï¼Œåœ¨jvmä¸­çš„å«ä¹‰ä¸ºå›æ”¶æ— ç”¨å†…å­˜ç©ºé—´</p>
<p>Young space<br>ä¸­æ–‡åä¸ºå¹´è½»ä»£æˆ–è€…æ–°ç”Ÿä»£ï¼Œä¸ºJVM å †çš„ä¸€éƒ¨åˆ†ï¼Œç”±åˆ†ä»£GCæ¦‚å¿µåˆ’åˆ†è€Œæ¥ï¼Œä¿å­˜ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡</p>
<p>Tenured space<br>ä¸­æ–‡åä¸ºè€å¹´ä»£æˆ–å¹´è€ä»£ï¼Œä¸ºJVM å †çš„ä¸€éƒ¨åˆ†ï¼Œç”±åˆ†ä»£GCæ¦‚å¿µåˆ’åˆ†è€Œæ¥ï¼Œä¿å­˜ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡</p>
<p>Minor GC<br>minor gcæŒ‡çš„æ˜¯å‘ç”Ÿåœ¨å¹´è½»ä»£æˆ–è€…è¯´æ–°ç”Ÿä»£ï¼ˆYoung spaceï¼‰ä¸­çš„gcï¼Œä¹Ÿæœ‰äººç§°å…¶ä¸ºyoung gcæˆ–è€…ygc,åœ¨ä¸‹æ–‡ä¸­æˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨minor gcè¡¨ç¤º</p>
<p>Major GC<br>major gcæŒ‡çš„æ˜¯å‘ç”Ÿåœ¨è€å¹´ä»£ï¼ˆTenured spaceï¼‰ä¸­çš„gcï¼Œä¹Ÿæœ‰äººç§°ä¸ºold gc,o gc,cms gcç­‰ï¼Œåœ¨ä¸‹æ–‡æˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨major gcè¡¨ç¤º</p>
<p>stop the world<br>æŒ‡çš„æ˜¯ç”¨æˆ·çº¿ç¨‹åœ¨è¿è¡Œè‡³å®‰å…¨ç‚¹ï¼ˆsafe pointï¼‰æˆ–å®‰å…¨åŒºåŸŸï¼ˆsafe regionï¼‰ä¹‹åï¼Œå°±è‡ªè¡ŒæŒ‚èµ·ï¼Œè¿›å…¥æš‚åœçŠ¶æ€ï¼Œå¯¹å¤–çš„è¡¨ç°çœ‹èµ·æ¥å°±åƒæ˜¯å…¨ä¸–ç•Œéƒ½åœæ­¢è¿è½¬äº†ä¸€æ ·,è€Œä¸è®ºä½•ç§gcç®—æ³•ï¼Œä¸è®ºæ˜¯minor gcè¿˜æ˜¯major gcéƒ½ä¼šstop the worldï¼ŒåŒºåˆ«åªåœ¨äºstop the worldçš„æ—¶é—´é•¿çŸ­ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯Full GC</strong></p>
<p>å…ˆè¯´ä¸€ä¸‹ç»“è®ºï¼ŒFull GCè¿™ä¸ªæ¦‚å¿µæ˜¯æ²¡æœ‰å®˜æ–¹å®šä¹‰çš„ï¼Œè€Œä¸”å«ä¹‰è¿˜ç‰¹åˆ«æ··ä¹±ï¼Œåœ¨ä¸åŒåœ°æ–¹è¡¨è¾¾çš„å«ä¹‰æ˜¯ä¸åŒçš„ï¼Œéœ€è¦å°±ä¸åŒçš„åœºæ™¯åˆ†åˆ«è¿›è¡Œè®¨è®ºã€‚</p>
<p>å¤§ä¼—è®¤çŸ¥ä¸Šï¼š<br>åœ¨é€šå¸¸æ„ä¹‰ä¸Šäººä»¬å£ä¸­è¯´çš„Full GCä¸ºä¸€æ¬¡ç‰¹æ®ŠGCè¡Œä¸ºçš„æè¿°ï¼Œè¿™æ¬¡GCä¼šå›æ”¶æ•´ä¸ªå †çš„å†…å­˜ï¼ŒåŒ…å«è€å¹´ä»£ï¼Œæ–°ç”Ÿä»£ï¼Œmetaspaceç­‰ï¼Œè¿™ä¸ªæ˜¯æœ€å¸¸è§çš„ä¸€ç§è®¤çŸ¥ï¼Œå¾ˆå¤šäººä¹Ÿå°±äº†è§£åˆ°è¿™ä¸ªç¨‹åº¦ï¼Œå› æ­¤åœ¨é‡åˆ°ä¸€äº›ç‰¹æ®Šåœºæ™¯çš„æ—¶å€™å°±ä¼šå‘ç°å®é™…æƒ…å†µå’Œè‡ªå·±çš„è®¤çŸ¥ä¼šå‘ç”Ÿå†²çª</p>
<p>ä»GCæ—¥å¿—ä¸Šï¼š<br>åœ¨gc.logä¸­ä¼šå‘ç°åœ¨éƒ¨åˆ†gcæ—¥å¿—å¤´ä¸­ä¹Ÿæœ‰Full GCè¿™æ ·çš„å­—çœ¼ï¼Œè¿™é‡Œè¡¨ç¤ºçš„å«ä¹‰æ˜¯åœ¨è¿™æ¬¡GCçš„å…¨è¿‡ç¨‹ä¸­ï¼Œéƒ½æ˜¯Stop The worldçš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™æ¬¡GCçš„å…¨è¿‡ç¨‹ä¸­æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹éƒ½æ˜¯å¤„äºæš‚åœçš„çŠ¶æ€</p>
<p>é˜¿é‡Œè€å“¥æ€»ç»“çš„ï¼š<a href="https://blog.csdn.net/kep159/article/details/103088438">https://blog.csdn.net/kep159/article/details/103088438</a></p>
<h3 id="âœ…jstatæŸ¥çœ‹GC"><a href="#âœ…jstatæŸ¥çœ‹GC" class="headerlink" title="âœ…jstatæŸ¥çœ‹GC"></a>âœ…jstatæŸ¥çœ‹GC</h3><p><strong>ä½¿ç”¨jstat æŸ¥å‡ºæ¥çš„FGC æ¬¡æ•°å’Œæ—¶é—´ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯è€å¹´ä»£çš„æ”¶é›†å™¨å‘ç”ŸStop the world çš„æ¬¡æ•°å’ŒæŒç»­æ—¶é—´</strong></p>
<p>1ã€æŸ¥è¯¢GCä½¿ç”¨æƒ…å†µï¼š<br><code>jstat -gcutil 23484 1000 5</code></p>
<p>1000æ˜¯é—´éš”æ—¶é—´ï¼Œ5æ˜¯æ€»å…±æ‰“å°5æ¬¡ï¼Œå¯ç¼ºçœã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">68.75   0.00  62.73   0.17  96.39  90.54      2    0.010     0    0.000    0.010</span><br><span class="line"></span><br><span class="line">S0: æ–°ç”Ÿä»£ä¸­Survivor space 0åŒºå·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯”</span><br><span class="line">S1: æ–°ç”Ÿä»£ä¸­Survivor space 1åŒºå·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯”</span><br><span class="line">E: æ–°ç”Ÿä»£å·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯”</span><br><span class="line">O: è€å¹´ä»£å·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯”</span><br><span class="line">Mï¼šå…ƒæ•°æ®åŒºä½¿ç”¨æ¯”ä¾‹</span><br><span class="line">CCSï¼šå‹ç¼©ä½¿ç”¨æ¯”ä¾‹</span><br><span class="line">YGC: ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°å½“å‰ï¼Œå‘ç”ŸYang GC çš„æ¬¡æ•°</span><br><span class="line">YGCT: ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°å½“å‰ï¼ŒYang GCæ‰€ç”¨çš„æ—¶é—´ã€å•ä½ç§’ã€‘</span><br><span class="line">FGC: ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°å½“å‰ï¼Œå‘ç”ŸFull GCçš„æ¬¡æ•°</span><br><span class="line">FGCT: ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°å½“å‰ï¼ŒFull GCæ‰€ç”¨çš„æ—¶é—´</span><br><span class="line">GCT: ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°å½“å‰ï¼Œç”¨äºåƒåœ¾å›æ”¶çš„æ€»æ—¶é—´ã€å•ä½ç§’ã€‘</span><br></pre></td></tr></table></figure>

<p>2ã€åƒåœ¾æ€»ä½“å›æ”¶ç»Ÿè®¡<br><code>jstat -gc 91185 1000 5</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line"> 68.75   0.00  62.73   0.17  96.39  90.54      2    0.010     0    0.000    0.010</span><br><span class="line"></span><br><span class="line">S0Cï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„å¤§å°</span><br><span class="line">S1Cï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°</span><br><span class="line">S0Uï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line">S1Uï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line">ECï¼šä¼Šç”¸å›­åŒºçš„å¤§å°</span><br><span class="line">EUï¼šä¼Šç”¸å›­åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line">OCï¼šè€å¹´ä»£å¤§å°</span><br><span class="line">OUï¼šè€å¹´ä»£ä½¿ç”¨å¤§å°</span><br><span class="line">MCï¼šæ–¹æ³•åŒºå¤§å°</span><br><span class="line">MUï¼šæ–¹æ³•åŒºä½¿ç”¨å¤§å°</span><br><span class="line">CCSC:å‹ç¼©ç±»ç©ºé—´å¤§å°</span><br><span class="line">CCSU:å‹ç¼©ç±»ç©ºé—´ä½¿ç”¨å¤§å°</span><br><span class="line">YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line">YGCTï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</span><br><span class="line">FGCï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line">FGCTï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</span><br><span class="line">GCTï¼šåƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´</span><br></pre></td></tr></table></figure>

<p>3ã€æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡<br><code>jstat -gcnew 91185 1000 5</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT</span><br><span class="line">5120.0 5120.0 3520.2    0.0  7  15 5120.0  33280.0  20877.8      2    0.010</span><br><span class="line"></span><br><span class="line">S0Cï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºå¤§å°</span><br><span class="line">S1Cï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°</span><br><span class="line">S0Uï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line">S1Uï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line">TT:å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æ¬¡æ•°</span><br><span class="line">MTT:å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æœ€å¤§æ¬¡æ•°</span><br><span class="line">DSS:æœŸæœ›çš„å¹¸å­˜åŒºå¤§å°</span><br><span class="line">ECï¼šä¼Šç”¸å›­åŒºçš„å¤§å°</span><br><span class="line">EUï¼šä¼Šç”¸å›­åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line">YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line">YGCTï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</span><br></pre></td></tr></table></figure>

<p>4ã€å †å†…å­˜ç»Ÿè®¡<br><code>jstat -gccapacity 18528 1000 5 //æ•´ä½“ç»Ÿè®¡</code><br><code>jstat -gcnewcapacity 18528 1000 5 //æ–°ç”Ÿä»£ç»Ÿè®¡</code><br><code>jstat -gcoldcapacity 18528 1000 5 //è€å¹´ä»£ç»Ÿè®¡</code></p>
<h2 id="javaå †æ ˆ"><a href="#javaå †æ ˆ" class="headerlink" title="javaå †æ ˆ"></a>javaå †æ ˆ</h2><h3 id="âœ…javaå†…å­˜ç©ºé—´"><a href="#âœ…javaå†…å­˜ç©ºé—´" class="headerlink" title="âœ…javaå†…å­˜ç©ºé—´"></a>âœ…javaå†…å­˜ç©ºé—´</h3><p>JAVAåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œåœ¨å†…å­˜ä¸­åˆ’åˆ†5ç‰‡ç©ºé—´è¿›è¡Œæ•°æ®çš„å­˜å‚¨ã€‚åˆ†åˆ«æ˜¯ï¼š1ï¼šç¨‹åºè®¡æ•°å™¨ã€‚2ï¼šæœ¬åœ°æ–¹æ³•æ ˆã€‚3ï¼šæ–¹æ³•åŒºã€‚4ï¼šæ ˆã€‚5ï¼šå †ã€‚<br>å †å’Œæ ˆéƒ½æ˜¯Javaç”¨æ¥åœ¨RAMä¸­å­˜æ”¾æ•°æ®çš„åœ°æ–¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç¨‹åºè®¡æ•°å™¨ï¼šçº¿ç¨‹ç§æœ‰ï¼Œå­˜å‚¨å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨ã€‚</span><br><span class="line">å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½ä¾èµ–è¯¥è®¡æ•°å™¨ã€‚æº¢å‡ºæ¦‚ç‡æä½ã€‚</span><br><span class="line"></span><br><span class="line">javaè™šæ‹Ÿæœºæ ˆï¼šçº¿ç¨‹ç§æœ‰ã€‚å±€éƒ¨å˜é‡è¡¨çš„å¤§å°åœ¨ç¼–è¯‘å™¨ç¡®å®šã€‚</span><br><span class="line">æ–¹æ³•çš„ç›¸å…³è°ƒç”¨ä¿¡æ¯ã€å˜é‡ä¿¡æ¯ï¼Œå¯¹è±¡çš„å¼•ç”¨ã€‚</span><br><span class="line">ä¼šæŠ›å‡ºï¼šStackOverflowErrorå’ŒOutOfMemoryError</span><br><span class="line"></span><br><span class="line">æœ¬åœ°æ–¹æ³•æ ˆï¼šä¸ºæœ¬åœ°æ–¹æ³•æ‰€æœåŠ¡</span><br><span class="line"></span><br><span class="line">javaå †ï¼šçº¿ç¨‹å…±äº«åŒºåŸŸï¼Œå­˜å‚¨å¯¹è±¡å®ä¾‹åŠæ•°ç»„ã€‚æœ‰å¯èƒ½æŠ›å‡ºOutOfMemoryError</span><br><span class="line"></span><br><span class="line">æ–¹æ³•åŒºï¼šçº¿ç¨‹å…±äº«åŒºåŸŸï¼Œå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œå³æ—¶å˜å¼‚åçš„ä»£ç ã€‚</span><br><span class="line">åˆå«æ°¸ä¹…ä»£ï¼Œjava8ä¸­é€æ­¥å–æ¶ˆï¼Œè¢«metaspaceå…ƒæ•°æ®åŒºå–ä»£ã€‚æœ‰å¯èƒ½æŠ›å‡ºOutOfMemoryError</span><br><span class="line"></span><br><span class="line">ç›´æ¥å†…å­˜ï¼šNIOæœºåˆ¶ï¼Œä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ã€‚</span><br></pre></td></tr></table></figure>

<p>1ã€å †</p>
<p>å¯ä»¥æŠŠå †ç†è§£ä¸ºä¸€å®¶é¤å…ï¼Œé‡Œé¢æœ‰200å¼ æ¡Œå­ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šèƒ½åŒæ—¶å®¹çº³200æ¡Œå®¢äººå°±é¤ï¼Œæ¥ä¸€æ‰¹å®¢äººå°±ä¸ºä»–ä»¬å®‰æ’ä¸€äº›æ¡Œå­ï¼Œå¦‚æœæŸå¤©æ¥çš„å®¢äººç‰¹åˆ«å¤šï¼Œè¶…è¿‡200æ¡Œäº†ï¼Œé‚£å°±ä¸èƒ½å†æ¥å¾…è¶…å‡ºçš„å®¢äººäº†ã€‚</p>
<p>å½“ç„¶ï¼Œè¿›æ¥åƒé¥­çš„å®¢äººä¸å¯èƒ½æ˜¯åŒæ—¶çš„ï¼Œæœ‰çš„æ—©ï¼Œæœ‰çš„æ™šï¼Œå…ˆåƒå¥½çš„å®¢äººï¼Œè€æ¿ä¼šå®‰æ’ç»™ä»–ä»¬ç»“è´¦èµ°äººï¼Œç„¶åç©ºå‡ºæ¥çš„æ¡Œå­åˆèƒ½æ¥å¾…æ–°çš„å®¢äººã€‚</p>
<p>è¿™é‡Œï¼Œå †å°±æ˜¯é¤å…ï¼Œæœ€å¤§å®¹é‡200æ¡Œå°±æ˜¯å †å†…å­˜çš„å¤§å°ï¼Œè€æ¿å°±ç›¸å½“äºGC(åƒåœ¾å›æ”¶)ï¼Œç»™å®¢äººå®‰æ’æ¡Œå­å°±ç›¸å½“äºjavaåˆ›å»ºå¯¹è±¡çš„æ—¶å€™åˆ†é…å †å†…å­˜ï¼Œç»“è´¦å°±ç›¸å½“äºGCå›æ”¶å¯¹è±¡å ç”¨çš„ç©ºé—´ã€‚</p>
<p>2ã€æ ˆ</p>
<p>æ¥ç€æŠŠæ ˆæ¯”ä½œä¸€å£åºŸäº•ï¼Œè¿™å£äº•å¤šå¹´ä¸ç”¨å·²ç»æ²¡æ°´äº†ï¼Œä¸»äººç°åœ¨æŠŠå®ƒä½œä¸ºè´®å­˜è‡ªé…¿é…’çš„åœ°æ–¹ï¼Œå­˜é…’çš„æ—¶å€™å°±ç”¨ç»³å­å‹¾ç€é…’å›å­æ…¢æ…¢æ”¾ä¸‹å»ï¼Œåé¢å†å­˜å°±ä¸€å›ä¸€å›å †ç€æ”¾ä¸Šå»ï¼Œå–é…’çš„æ—¶å€™å°±å…ˆå–æœ€ä¸Šé¢çš„å›å­ã€‚</p>
<h3 id="âœ…ä»€ä¹ˆæ—¶å€™å­˜åˆ°å †Heapé‡Œ"><a href="#âœ…ä»€ä¹ˆæ—¶å€™å­˜åˆ°å †Heapé‡Œ" class="headerlink" title="âœ…ä»€ä¹ˆæ—¶å€™å­˜åˆ°å †Heapé‡Œ"></a>âœ…ä»€ä¹ˆæ—¶å€™å­˜åˆ°å †Heapé‡Œ</h3><p>å­˜æ”¾ï¼šå­˜æ”¾ç”±newåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„ã€‚</p>
<p>åœ¨å †ä¸­åˆ†é…çš„å†…å­˜ï¼Œç”±javaè™šæ‹Ÿæœºè‡ªåŠ¨åƒåœ¾å›æ”¶å™¨æ¥ç®¡ç†ã€‚åœ¨å †ä¸­äº§ç”Ÿäº†ä¸€ä¸ªæ•°ç»„æˆ–è€…å¯¹è±¡åï¼Œä¼šåœ¨æ ˆä¸­å®šä¹‰ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å–å€¼ç­‰äºæ•°ç»„æˆ–è€…å¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„é¦–åœ°å€ï¼Œå¼•ç”¨å˜é‡ç›¸å½“äºä¸ºæ•°ç»„æˆ–è€…å¯¹è±¡èµ·çš„ä¸€ä¸ªåˆ«åï¼Œæˆ–è€…ä»£å·ã€‚</p>
<p>æ•°ç»„ï¼†å¯¹è±¡æœ¬èº«åœ¨å †ä¸­åˆ†é…ï¼Œå³ä½¿ç¨‹åºè¿è¡Œåˆ°ä½¿ç”¨newäº§ç”Ÿæ•°ç»„å’Œå¯¹è±¡çš„è¯­å¥æ‰€åœ¨åœ°ä»£ç å—ä¹‹å¤–ï¼Œæ•°ç»„å’Œå¯¹è±¡æœ¬èº«å ç”¨çš„å †å†…å­˜ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ï¼Œæ•°ç»„å’Œå¯¹è±¡åœ¨æ²¡æœ‰å¼•ç”¨å˜é‡æŒ‡å‘å®ƒçš„æ—¶å€™ï¼Œæ‰å˜æˆåƒåœ¾ï¼Œä¸èƒ½å†è¢«ä½¿ç”¨ï¼Œä½†æ˜¯ä»ç„¶å ç€å†…å­˜ï¼Œåœ¨éšåçš„ä¸€ä¸ªä¸ç¡®å®šçš„æ—¶é—´è¢«åƒåœ¾å›æ”¶å™¨é‡Šæ”¾æ‰ã€‚è¿™ä¸ªä¹Ÿæ˜¯javaæ¯”è¾ƒå å†…å­˜çš„ä¸»è¦åŸå› ï¼Œå®é™…ä¸Šï¼Œæ ˆä¸­çš„å˜é‡æŒ‡å‘å †å†…å­˜ä¸­çš„å˜é‡ï¼Œè¿™å°±æ˜¯ Java ä¸­çš„æŒ‡é’ˆ!</p>
<p>å †å†…å­˜çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ<br>ç¬¬ä¸€ç‚¹ï¼šå †å…¶å®å¯ä»¥ç±»ä¼¼çš„çœ‹åšæ˜¯ç®¡é“ï¼Œæˆ–è€…è¯´æ˜¯å¹³æ—¶å»æ’é˜Ÿä¹°ç¥¨çš„æƒ…å†µå·®ä¸å¤šï¼Œæ‰€ä»¥å †å†…å­˜çš„ç‰¹ç‚¹å°±æ˜¯ï¼šå…ˆè¿›å…ˆå‡ºï¼Œåè¿›åå‡ºï¼Œä¹Ÿå°±æ˜¯ä½ å…ˆæ’é˜Ÿå¥½ï¼Œä½ å…ˆä¹°ç¥¨ã€‚<br>ç¬¬äºŒç‚¹ï¼šå †å¯ä»¥åŠ¨æ€åœ°åˆ†é…å†…å­˜å¤§å°ï¼Œç”Ÿå­˜æœŸä¹Ÿä¸å¿…äº‹å…ˆå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…å†…å­˜çš„ï¼Œä½†ç¼ºç‚¹æ˜¯ï¼Œç”±äºè¦åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…å†…å­˜ï¼Œå­˜å–é€Ÿåº¦è¾ƒæ…¢ã€‚<br>newå¯¹è±¡åœ¨å †ä¸­å¦‚ä½•åˆ†é…ï¼Ÿ<br>ç”±Javaè™šæ‹Ÿæœºçš„è‡ªåŠ¨åƒåœ¾å›æ”¶å™¨æ¥ç®¡ç†ã€‚</p>
<h3 id="âœ…ä»€ä¹ˆæ—¶å€™å­˜åˆ°æ ˆStacké‡Œ"><a href="#âœ…ä»€ä¹ˆæ—¶å€™å­˜åˆ°æ ˆStacké‡Œ" class="headerlink" title="âœ…ä»€ä¹ˆæ—¶å€™å­˜åˆ°æ ˆStacké‡Œ"></a>âœ…ä»€ä¹ˆæ—¶å€™å­˜åˆ°æ ˆStacké‡Œ</h3><p>å­˜æ”¾ï¼šåœ¨å‡½æ•°ä¸­å®šä¹‰çš„ä¸€äº›åŸºæœ¬ç±»å‹çš„å˜é‡(8ç§ï¼Œint, short, long, byte, float, double, boolean, charï¼Œä¸åŒ…å«String)å’Œå¯¹è±¡çš„å¼•ç”¨å˜é‡ã€mainæ–¹æ³•ã€æ–¹æ³•å‡½æ•°</p>
<p>å½“åœ¨ä¸€æ®µä»£ç å—ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡æ—¶ï¼Œjavaå°±åœ¨æ ˆä¸­ä¸ºè¿™ä¸ªå˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå½“è¶…è¿‡å˜é‡çš„ä½œç”¨åŸŸåï¼Œjavaä¼šè‡ªåŠ¨é‡Šæ”¾æ‰ä¸ºè¯¥å˜é‡åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œè¯¥å†…å­˜ç©ºé—´å¯ä»¥ç«‹åˆ»è¢«å¦ä½œä»–ç”¨ã€‚</p>
<p>æ ˆå†…å­˜çš„ç‰¹ç‚¹<br>ç¬¬ä¸€ç‚¹ï¼šæ ˆå†…å­˜å°±å¥½åƒä¸€ä¸ªçŸ¿æ³‰æ°´ç“¶ï¼Œå¾€é‡Œé¢æ”¾å…¥ä¸œè¥¿ï¼Œé‚£ä¹ˆå…ˆæ”¾å…¥çš„æ²‰å…¥åº•éƒ¨ï¼Œæ‰€ä»¥å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼šå…ˆè¿›åå‡ºï¼Œåè¿›å…ˆå‡º<br>ç¬¬äºŒç‚¹ï¼šå­˜å–é€Ÿåº¦æ¯”å †è¦å¿«ï¼Œä»…æ¬¡äºå¯„å­˜å™¨ã€‚ä½†ç¼ºç‚¹æ˜¯ï¼Œå­˜åœ¨æ ˆä¸­çš„æ•°æ®å¤§å°ä¸ç”Ÿå­˜æœŸå¿…é¡»æ˜¯ç¡®å®šçš„ï¼Œç¼ºä¹çµæ´»æ€§ã€‚</p>
<p>æ ˆä¸­ä¸»è¦å­˜æ”¾ä¸€äº›åŸºæœ¬ç±»å‹çš„å˜é‡ï¼ˆint, short, long, byte, float, double, boolean, charï¼‰å’Œå¯¹è±¡å¥æŸ„ã€‚<br>æ ˆå†…å­˜åˆ†é…æœºåˆ¶<br>æ ˆå†…å­˜å¯ä»¥ç§°ä¸ºä¸€çº§ç¼“å­˜ï¼Œç”±åƒåœ¾å›æ”¶å™¨è‡ªåŠ¨å›æ”¶<br>ä¾‹å­ï¼š<br>int a &#x3D; 3;<br>int b &#x3D; 3;</p>
<h3 id="âœ…å †æ ˆçš„åŒºåˆ«"><a href="#âœ…å †æ ˆçš„åŒºåˆ«" class="headerlink" title="âœ…å †æ ˆçš„åŒºåˆ«"></a>âœ…å †æ ˆçš„åŒºåˆ«</h3><p>JVMæ˜¯åŸºäºå †æ ˆçš„è™šæ‹Ÿæœºï¼ŒJVMä¸ºæ–°åˆ›å»ºçš„çº¿ç¨‹éƒ½åˆ†é…ä¸€ä¸ªå †æ ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸€ä¸ªJavaç¨‹åºæ¥è¯´ï¼Œå®ƒçš„è¿è¡Œå°±æ˜¯é€šè¿‡å¯¹å †æ ˆçš„æ“ä½œæ¥å®Œæˆçš„ã€‚å †æ ˆä»¥å¸§ä¸ºå•ä½ä¿å­˜çº¿ç¨‹çš„çŠ¶æ€ã€‚JVMå¯¹å †æ ˆåªè¿›è¡Œä¸¤ç§æ“ä½œï¼šä»¥å¸§ä¸ºå•ä½çš„å‹æ ˆå’Œå‡ºæ ˆæ“ä½œã€‚</p>
<p>å·®å¼‚ï¼š<br>1). å †å†…å­˜ç”¨æ¥å­˜æ”¾ç”±newåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„<br>2). æ ˆå†…å­˜ç”¨æ¥å­˜æ”¾æ–¹æ³•æˆ–è€…å±€éƒ¨å˜é‡ç­‰<br>3). å †æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œåè¿›åå‡º<br>4). æ ˆæ˜¯å…ˆè¿›åå‡ºï¼Œåè¿›å…ˆå‡º<br>5). å…±äº«æ€§çš„ä¸åŒï¼šæ ˆå†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œ<strong>å †å†…å­˜æ˜¯æ‰€æœ‰çº¿ç¨‹å…±æœ‰çš„</strong><br>6). ç”Ÿå­˜ç©ºé—´ä¸åŒï¼šæ ˆä¸­æ•°æ®çš„ç”Ÿå­˜ç©ºé—´ä¸€èˆ¬åœ¨å½“å‰scopeså†…(å°±æ˜¯ç”±{â€¦}æ‹¬èµ·æ¥çš„åŒºåŸŸ).</p>
<p>æ ˆï¼š</p>
<p>å‡½æ•°ä¸­å®šä¹‰çš„åŸºæœ¬ç±»å‹å˜é‡ï¼Œå¯¹è±¡çš„å¼•ç”¨å˜é‡éƒ½åœ¨å‡½æ•°çš„æ ˆå†…å­˜ä¸­åˆ†é…ã€‚<br>æ ˆå†…å­˜ç‰¹ç‚¹ï¼Œæ•°æ•°æ®ä¸€æ‰§è¡Œå®Œæ¯•ï¼Œå˜é‡ä¼šç«‹å³é‡Šæ”¾ï¼ŒèŠ‚çº¦å†…å­˜ç©ºé—´ã€‚<br>æ ˆå†…å­˜ä¸­çš„æ•°æ®ï¼Œæ²¡æœ‰é»˜è®¤åˆå§‹åŒ–å€¼ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®ã€‚</p>
<p>å †ï¼š</p>
<p>å †å†…å­˜ç”¨æ¥å­˜æ”¾newåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„ã€‚<br>å †å†…å­˜ä¸­æ‰€æœ‰çš„å®ä½“éƒ½æœ‰å†…å­˜åœ°å€å€¼ã€‚<br>å †å†…å­˜ä¸­çš„å®ä½“æ˜¯ç”¨æ¥å°è£…æ•°æ®çš„ï¼Œè¿™äº›æ•°æ®éƒ½æœ‰é»˜è®¤åˆå§‹åŒ–å€¼ã€‚<br>å †å†…å­˜ä¸­çš„å®ä½“ä¸å†è¢«æŒ‡å‘æ—¶ï¼ŒJVMå¯åŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè‡ªåŠ¨æ¸…é™¤ï¼Œè¿™ä¹Ÿæ˜¯JAVAä¼˜äºC++çš„è¡¨ç°ä¹‹ä¸€ï¼ˆC++ä¸­éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨æ¸…é™¤ï¼‰</p>
<h3 id="âœ…String-str-â€œabcâ€çš„å†…éƒ¨å·¥ä½œ"><a href="#âœ…String-str-â€œabcâ€çš„å†…éƒ¨å·¥ä½œ" class="headerlink" title="âœ…String str &#x3D; â€œabcâ€çš„å†…éƒ¨å·¥ä½œ"></a>âœ…String str &#x3D; â€œabcâ€çš„å†…éƒ¨å·¥ä½œ</h3><p>(1)å…ˆå®šä¹‰ä¸€ä¸ªåä¸ºstrçš„å¯¹Stringç±»çš„å¯¹è±¡å¼•ç”¨å˜é‡ï¼šString strï¼›</p>
<p>(2)åœ¨æ ˆä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰å­˜æ”¾å€¼ä¸ºâ€abcâ€çš„åœ°å€ï¼ˆå¼•ç”¨ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åœ¨æ ˆä¸­å¼€è¾Ÿä¸€ä¸ªå­˜æ”¾å­—é¢å€¼ä¸ºâ€abcâ€çš„åœ°å€ï¼Œæ¥ç€åœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Stringç±»çš„å¯¹è±¡â€œabcâ€ï¼Œå¹¶å°†è¯¥å­—ç¬¦ä¸²æŒ‡å‘è¿™ä¸ªåœ°å€ï¼Œè€Œä¸”åœ¨æ ˆä¸­è¿™ä¸ªåœ°å€æ—è¾¹è®°ä¸‹è¿™ä¸ªå¼•ç”¨çš„å¯¹è±¡â€œabcâ€ã€‚å¦‚æœå·²ç»æœ‰äº†å€¼ä¸ºâ€abcâ€çš„åœ°å€ï¼Œåˆ™æŸ¥æ‰¾å¯¹è±¡â€œabcâ€ï¼Œå¹¶è¿”å›â€œabcâ€çš„åœ°å€ã€‚</p>
<p>(3)å°†stræŒ‡å‘å¯¹è±¡â€œabcâ€çš„åœ°å€ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€èˆ¬Stringç±»ä¸­å­—ç¬¦ä¸²å€¼éƒ½æ˜¯ç›´æ¥å­˜å€¼çš„ã€‚ä½†åƒString str &#x3D; â€œabcâ€ï¼›è¿™ç§åœºåˆä¸‹ï¼Œå…¶å­—ç¬¦ä¸²å€¼å´æ˜¯ä¿å­˜äº†ä¸€ä¸ªæŒ‡å‘å­˜åœ¨æ ˆä¸­æ•°æ®çš„å¼•ç”¨ï¼<br><strong>ï¼ˆæœ‰ç‚¹é—®é¢˜ï¼ŒæŒ‡å‘çš„æ˜¯å †ä¸­çš„å­—ç¬¦ä¸²å¸¸é‡æ± é‡Œçš„å­—ç¬¦ä¸²å§ï¼Ÿï¼Ÿï¼‰</strong></p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String str1 = â€œabcâ€;  </span><br><span class="line">String str2 = â€œabcâ€;  </span><br><span class="line">System.out.println(str1==str2); //true</span><br></pre></td></tr></table></figure>

<p>str1.equals(str2)ï¼›çš„æ–¹å¼æ˜¯å°†æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚&#x3D;&#x3D;å·ï¼Œæ ¹æ®JDKçš„è¯´æ˜ï¼Œåªæœ‰åœ¨ä¸¤ä¸ªå¼•ç”¨éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡æ—¶æ‰è¿”å›çœŸå€¼ã€‚è€Œæˆ‘ä»¬åœ¨è¿™é‡Œè¦çœ‹çš„æ˜¯ï¼Œstr1ä¸str2æ˜¯å¦éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡ã€‚<br>ç»“æœè¯´æ˜ï¼ŒJVMåˆ›å»ºäº†ä¸¤ä¸ªå¼•ç”¨str1å’Œstr2ï¼Œä½†åªåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸”ä¸¤ä¸ªå¼•ç”¨éƒ½æŒ‡å‘äº†è¿™ä¸ªå¯¹è±¡ã€‚å®ç°å †ä¸­æ•°æ®çš„å…±äº«ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String str1 = â€œabcâ€;  </span><br><span class="line">String str2 = â€œabcâ€;  //æ²¡åˆ›å»ºæ–°å¯¹è±¡ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°å¼•ç”¨å˜é‡</span><br><span class="line">str1 = â€œbcdâ€;   //æ”¹å˜å€¼ï¼Œåªèƒ½åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¼•ç”¨å˜é‡æŒ‡å‘æ–°çš„å¯¹è±¡</span><br><span class="line">System.out.println(str1 + â€œ,â€ + str2); //bcd, abc  </span><br><span class="line">System.out.println(str1==str2); //false</span><br></pre></td></tr></table></figure>

<p>èµ‹å€¼çš„å˜åŒ–å¯¼è‡´äº†ç±»å¯¹è±¡å¼•ç”¨çš„å˜åŒ–ï¼Œstr1æŒ‡å‘äº†å¦å¤–ä¸€ä¸ªæ–°å¯¹è±¡ï¼è€Œstr2ä»æ—§æŒ‡å‘åŸæ¥çš„å¯¹è±¡ã€‚ä¸Šä¾‹ä¸­ï¼Œå½“æˆ‘ä»¬å°†str1çš„å€¼æ”¹ä¸ºâ€bcdâ€æ—¶ï¼ŒJVMå‘ç°åœ¨æ ˆä¸­æ²¡æœ‰å­˜æ”¾è¯¥å€¼çš„åœ°å€ï¼Œä¾¿å¼€è¾Ÿäº†è¿™ä¸ªåœ°å€ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå…¶å­—ç¬¦ä¸²çš„å€¼æŒ‡å‘è¿™ä¸ªåœ°å€ã€‚</p>
<p>ğŸ’¡åŸå› ï¼šäº‹å®ä¸Šï¼ŒStringç±»è¢«è®¾è®¡æˆä¸ºä¸å¯æ”¹å˜(immutable)çš„ç±»ã€‚å¦‚æœä½ è¦æ”¹å˜å…¶å€¼ï¼Œå¯ä»¥ï¼Œä½†JVMåœ¨è¿è¡Œæ—¶æ ¹æ®æ–°å€¼æ‚„æ‚„åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç„¶åå°†è¿™ä¸ªå¯¹è±¡çš„åœ°å€è¿”å›ç»™åŸæ¥ç±»çš„å¼•ç”¨ã€‚è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹è™½è¯´æ˜¯å®Œå…¨è‡ªåŠ¨è¿›è¡Œçš„ï¼Œä½†å®ƒæ¯•ç«Ÿå ç”¨äº†æ›´å¤šçš„æ—¶é—´ã€‚åœ¨å¯¹æ—¶é—´è¦æ±‚æ¯”è¾ƒæ•æ„Ÿçš„ç¯å¢ƒä¸­ï¼Œä¼šå¸¦æœ‰ä¸€å®šçš„ä¸è‰¯å½±å“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String str1 = new String(â€œabcâ€);</span><br><span class="line">String str2 = â€œabcâ€;</span><br><span class="line">System.out.println(str1==str2); //false</span><br></pre></td></tr></table></figure>

<p>ğŸ’¡åŸå› ï¼šåªè¦æ˜¯ç”¨new()æ¥æ–°å»ºå¯¹è±¡çš„ï¼Œéƒ½ä¼šåœ¨å †ä¸­åˆ›å»ºï¼Œè€Œä¸”å…¶å­—ç¬¦ä¸²æ˜¯å•ç‹¬å­˜å€¼çš„ï¼Œå³ä½¿ä¸æ ˆä¸­çš„æ•°æ®ç›¸åŒï¼Œä¹Ÿä¸ä¼šä¸æ ˆä¸­çš„æ•°æ®å…±äº«ã€‚<br><strong>ï¼ˆä¸å­—ç¬¦ä¸²å¸¸é‡æ± å…±äº«å§ï¼Ÿï¼‰</strong></p>
<p><strong>æ„æ€æ˜¯ï¼šString str &#x3D; â€œabcâ€ çš„åˆ›å»ºå¯¹è±¡æ–¹å¼ï¼Œä¼šåœ¨æ ˆä¸­ä¿å­˜â€œabcâ€ã€‚ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å§ï¼Ÿï¼‰å¦‚æœå¤šæ¬¡è¿™æ ·åˆ›å»ºä¸€ä¸ªå€¼çš„Stringå¯¹è±¡ï¼Œä¼šå…ˆå»æ ˆé‡Œçœ‹æœ‰æ²¡æœ‰ï¼Œå¦‚æœæœ‰ï¼Œå †é‡Œå°±ä¸æ–°å»ºå¯¹è±¡äº†ï¼Œæ ˆé‡Œæ–°å»ºä¸€ä¸ªå¼•ç”¨å˜é‡æŒ‡å‘é‚£ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºï¼Œä½†æ˜¯newæ–¹å¼ä¸ä¼šçœ‹ï¼Œéƒ½æ˜¯æ–°å»ºã€‚</strong></p>
<p>ç»“è®ºï¼š</p>
<p>(1)æˆ‘ä»¬åœ¨ä½¿ç”¨è¯¸å¦‚String str &#x3D; â€œabcâ€; çš„æ ¼å¼å®šä¹‰ç±»æ—¶ï¼Œæ€»æ˜¯æƒ³å½“ç„¶åœ°è®¤ä¸ºï¼Œæˆ‘ä»¬åˆ›å»ºäº†Stringç±»çš„å¯¹è±¡strã€‚æ‹…å¿ƒé™·é˜±ï¼å¯¹è±¡å¯èƒ½å¹¶æ²¡æœ‰è¢«åˆ›å»ºï¼å”¯ä¸€å¯ä»¥è‚¯å®šçš„æ˜¯ï¼ŒæŒ‡å‘Stringç±»çš„å¼•ç”¨è¢«åˆ›å»ºäº†ã€‚è‡³äºè¿™ä¸ªå¼•ç”¨åˆ°åº•æ˜¯å¦æŒ‡å‘äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¿…é¡»æ ¹æ®ä¸Šä¸‹æ–‡æ¥è€ƒè™‘ï¼Œé™¤éä½ é€šè¿‡new()æ–¹æ³•æ¥æ˜¾è¦åœ°åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œæ›´ä¸ºå‡†ç¡®çš„è¯´æ³•æ˜¯ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘Stringç±»çš„å¯¹è±¡çš„å¼•ç”¨å˜é‡strï¼Œè¿™ä¸ªå¯¹è±¡å¼•ç”¨å˜é‡æŒ‡å‘äº†æŸä¸ªå€¼ä¸ºâ€abcâ€çš„Stringå¯¹è±¡ã€‚</p>
<p>(2)ä½¿ç”¨String str &#x3D; â€œabcâ€; çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ï¼Œå› ä¸ºJVMä¼šè‡ªåŠ¨æ ¹æ®æ ˆä¸­æ•°æ®çš„å®é™…æƒ…å†µæ¥å†³å®šæ˜¯å¦æœ‰å¿…è¦åˆ›å»ºæ–°å¯¹è±¡ã€‚è€Œå¯¹äºString str &#x3D; new String(â€œabcâ€); çš„ä»£ç ï¼Œåˆ™ä¸€æ¦‚åœ¨å †ä¸­åˆ›å»ºæ–°å¯¹è±¡ï¼Œè€Œä¸ç®¡å…¶å­—ç¬¦ä¸²å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ˜¯å¦æœ‰å¿…è¦åˆ›å»ºæ–°å¯¹è±¡ï¼Œä»è€ŒåŠ é‡äº†ç¨‹åºçš„è´Ÿæ‹…ã€‚è¿™ä¸ªæ€æƒ³åº”è¯¥æ˜¯äº«å…ƒæ¨¡å¼çš„æ€æƒ³ï¼Œä½†JDKçš„å†…éƒ¨åœ¨è¿™é‡Œå®ç°æ˜¯å¦åº”ç”¨äº†è¿™ä¸ªæ¨¡å¼ï¼Œä¸å¾—è€ŒçŸ¥ã€‚</p>
<p>(3)å½“æ¯”è¾ƒåŒ…è£…ç±»é‡Œé¢çš„æ•°å€¼æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œç”¨equals()æ–¹æ³•ï¼›å½“æµ‹è¯•ä¸¤ä¸ªåŒ…è£…ç±»çš„å¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œç”¨&#x3D;&#x3D;ã€‚</p>
<p>(4)ç”±äºStringç±»çš„ä¸å¯æ”¹å˜immutableæ€§è´¨ï¼Œå½“Stringå˜é‡éœ€è¦ç»å¸¸å˜æ¢å…¶å€¼æ—¶ï¼Œåº”è¯¥è€ƒè™‘ä½¿ç”¨StringBufferç±»ï¼Œä»¥æé«˜ç¨‹åºæ•ˆç‡ã€‚</p>
<p>å‚è€ƒï¼š<br>ç¨‹åºä¸­å †æ ˆç©ºé—´åŠ è½½è¿‡ç¨‹ï¼š<a href="https://www.jb51.net/article/229958.htm">https://www.jb51.net/article/229958.htm</a><br>å †æ ˆåŒºåˆ«ã€Stringåˆ›å»ºè¿‡ç¨‹ï¼š<a href="https://zhuanlan.zhihu.com/p/529280783">https://zhuanlan.zhihu.com/p/529280783</a></p>
<h3 id="Stringä¸å¯å˜æ€ä¹ˆç†è§£"><a href="#Stringä¸å¯å˜æ€ä¹ˆç†è§£" class="headerlink" title="Stringä¸å¯å˜æ€ä¹ˆç†è§£"></a>Stringä¸å¯å˜æ€ä¹ˆç†è§£</h3><p>çœ‹äº†ä¸€åœˆä¼˜ç‚¹æ¨¡ç³Šï¼Œä¸»è¦å‡ ä¸ªç–‘é—®ï¼š<br>1ã€<code>String s = &quot;abc&quot;;</code>ï¼Œåˆ°åº•æ€ä¹ˆä¸ªæµç¨‹ï¼Œå·²æœ‰çš„å­—ç¬¦ä¸²æ€ä¹ˆæ‰¾åˆ°çš„ã€‚<br>2ã€å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨å“ªé‡Œå­˜çš„ã€‚åˆæ­¥ç»“è®ºæ˜¯java8åœ¨å †ä¸­ã€‚<br>3ã€è¿è¡Œæ—¶å¸¸é‡æ± å’Œå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Ÿ</p>
<p><strong>çœ‹çœ‹jvmè™šæ‹Ÿæœºå†è§£æƒ‘å§</strong></p>
<p>stringç±»ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„ï¼š<br><a href="https://blog.csdn.net/liuqinhou/article/details/126160186">https://blog.csdn.net/liuqinhou/article/details/126160186</a></p>
<p>Stringæºç è§’åº¦åˆ†æä¸ºä»€ä¹ˆä¸å¯å˜ï¼Œé€šè¿‡åå°„çš„æ–¹æ³•æ”¹å˜ï¼š<br><a href="https://blog.csdn.net/zhangjg_blog/article/details/18319521">https://blog.csdn.net/zhangjg_blog/article/details/18319521</a></p>
<p>æµ…è°ˆä¸ºä»€ä¹ˆJavaé‡Œé¢Stringç±»æ˜¯ä¸å¯å˜çš„ï¼š<br><a href="https://www.jb51.net/article/157814.htm">https://www.jb51.net/article/157814.htm</a></p>
<p>Stringæ˜¯å¦‚ä½•å®ç°å…¶å¯¹è±¡ä¸å¯å˜ï¼š<br><a href="https://zhuanlan.zhihu.com/p/498718374">https://zhuanlan.zhihu.com/p/498718374</a></p>
<p>Java å¸¸é‡æ± è¯¦è§£ï¼ˆä¸€ï¼‰å­—ç¬¦ä¸²å¸¸é‡æ± ï¼š<br><a href="https://blog.csdn.net/Prior_SX/article/details/123463430">https://blog.csdn.net/Prior_SX/article/details/123463430</a></p>
<p>å­—ç¬¦ä¸²å¸¸é‡æ± å’Œè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯åœ¨å †è¿˜æ˜¯åœ¨æ–¹æ³•åŒºï¼Ÿ<br><a href="https://www.cnblogs.com/cosmos-wong/p/12925299.html">https://www.cnblogs.com/cosmos-wong/p/12925299.html</a></p>
<p>Java8ä¸­å­—ç¬¦ä¸²å¸¸é‡æ± åˆ°åº•æ˜¯åœ¨å“ªé‡Œï¼š<br><a href="https://blog.51cto.com/u_14234228/2489846">https://blog.51cto.com/u_14234228/2489846</a></p>
<h3 id="âœ…å †å†…å­˜å…±äº«æ€§é—®é¢˜"><a href="#âœ…å †å†…å­˜å…±äº«æ€§é—®é¢˜" class="headerlink" title="âœ…å †å†…å­˜å…±äº«æ€§é—®é¢˜"></a>âœ…å †å†…å­˜å…±äº«æ€§é—®é¢˜</h3><p>é—®é¢˜æ¥æºï¼šæ—¢ç„¶å„ä¸ªjavaè¿›ç¨‹å…±äº«å †å†…å­˜ï¼Œé‚£ä¹ˆçœ‹fullgcçš„æƒ…å†µè·Ÿå“ªä¸ªè¿›ç¨‹çº¿ç¨‹æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p>
<p>æ²¡é”™ï¼Œå †æ˜¯å…¨å±€å…±äº«çš„ï¼Œä½†æ˜¯ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜</p>
<p>å°±æ˜¯å¤šä¸ªçº¿ç¨‹åœ¨å †ä¸ŠåŒæ—¶ç”³è¯·ç©ºé—´ï¼Œå¦‚æœåœ¨å¹¶å‘çš„åœºæ™¯ä¸­ï¼Œä¸¤ä¸ªçº¿ç¨‹å…ˆåæŠŠå¯¹è±¡å¼•ç”¨æŒ‡å‘äº†åŒä¸€ä¸ªå †çš„å†…å­˜åŒºåŸŸï¼Œé‚£å¯èƒ½å°±ä¼šå‡ºç°é—®é¢˜ï¼›ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Œå°±å¾—è¿›è¡ŒåŒæ­¥æ§åˆ¶ï¼Œè¯´åˆ°åŒæ­¥æ§åˆ¶ï¼Œå°±ä¼šå½±å“åˆ°æ•ˆç‡ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªå¹¶å‘é—®é¢˜ï¼Œå¯¹è±¡çš„å†…å­˜åˆ†é…è¿‡ç¨‹å°±å¿…é¡»è¿›è¡ŒåŒæ­¥æ§åˆ¶ã€‚<br>HotSpotè™šæ‹Ÿæœºï¼ˆHotSpotè™šæ‹Ÿæœºæ˜¯ç›®å‰æœ€æµè¡Œçš„è™šæ‹Ÿæœºï¼‰çš„æ–¹æ¡ˆï¼š<br>æ¯ä¸ªçº¿ç¨‹åœ¨Javaå †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œç„¶ååœ¨ç»™å¯¹è±¡åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œç›´æ¥åœ¨è‡ªå·±è¿™å—â€ç§æœ‰â€å†…å­˜ä¸­åˆ†é…ï¼Œå½“è¿™éƒ¨åˆ†åŒºåŸŸç”¨å®Œä¹‹åï¼Œå†åˆ†é…æ–°çš„â€ç§æœ‰â€å†…å­˜ã€‚<br>è¿™ç§æ–¹æ¡ˆè¢«ç§°ä¹‹ä¸ºTLABåˆ†é…ï¼Œå³Thread Local Allocation Bufferã€‚è¿™éƒ¨åˆ†Bufferæ˜¯ä»å †ä¸­åˆ’åˆ†å‡ºæ¥çš„ï¼Œä½†æ˜¯æ˜¯æœ¬åœ°çº¿ç¨‹ç‹¬äº«çš„ã€‚</p>
<p><strong>TLAB</strong></p>
<p>TLABæ˜¯è™šæ‹Ÿæœºåœ¨å †å†…å­˜çš„edenåˆ’åˆ†å‡ºæ¥çš„ä¸€å—ä¸“ç”¨ç©ºé—´ï¼Œæ˜¯<strong>çº¿ç¨‹ä¸“å±</strong>çš„ã€‚åœ¨è™šæ‹Ÿæœºçš„TLABåŠŸèƒ½å¯åŠ¨çš„æƒ…å†µä¸‹ï¼Œåœ¨çº¿ç¨‹åˆå§‹åŒ–æ—¶ï¼Œè™šæ‹Ÿæœºä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—TLABç©ºé—´ï¼Œ<strong>åªç»™å½“å‰çº¿ç¨‹ä½¿ç”¨</strong>ï¼Œè¿™æ ·<strong>æ¯ä¸ªçº¿ç¨‹éƒ½å•ç‹¬æ‹¥æœ‰ä¸€ä¸ªç©ºé—´</strong>ï¼Œå¦‚æœéœ€è¦åˆ†é…å†…å­˜ï¼Œå°±åœ¨è‡ªå·±çš„ç©ºé—´ä¸Šåˆ†é…ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ç«äº‰çš„æƒ…å†µï¼Œå¯ä»¥å¤§å¤§æå‡åˆ†é…æ•ˆç‡ã€‚</p>
<p><strong>æ‰€ä»¥è¯´ï¼Œå› ä¸ºæœ‰äº†TLABæŠ€æœ¯ï¼Œå †å†…å­˜å¹¶ä¸æ˜¯å®Œå®Œå…¨å…¨çš„çº¿ç¨‹å…±äº«ï¼Œå…¶edenåŒºåŸŸä¸­è¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†ç©ºé—´æ˜¯åˆ†é…ç»™çº¿ç¨‹ç‹¬äº«çš„ã€‚</strong></p>
<p>âš ï¸TLABæ˜¯çº¿ç¨‹ç‹¬äº«çš„ï¼Œä½†æ˜¯åªæ˜¯åœ¨â€œåˆ†é…â€è¿™ä¸ªåŠ¨ä½œä¸Šæ˜¯çº¿ç¨‹ç‹¬äº«çš„ï¼Œè‡³äºåœ¨è¯»å–ã€åƒåœ¾å›æ”¶ç­‰åŠ¨ä½œä¸Šéƒ½æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚è€Œä¸”åœ¨ä½¿ç”¨ä¸Šä¹Ÿæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶æ¯ä¸ªçº¿ç¨‹åœ¨åˆå§‹åŒ–æ—¶éƒ½ä¼šå»å †å†…å­˜ä¸­ç”³è¯·ä¸€å—TLABï¼Œå¹¶ä¸æ˜¯è¯´è¿™ä¸ªTLABåŒºåŸŸçš„å†…å­˜å…¶ä»–çº¿ç¨‹å°±å®Œå…¨æ— æ³•è®¿é—®äº†ï¼Œå…¶ä»–çº¿ç¨‹çš„è¯»å–è¿˜æ˜¯å¯ä»¥çš„ï¼Œåªä¸è¿‡æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸä¸­åˆ†é…å†…å­˜è€Œå·²ã€‚å¹¶ä¸”ï¼Œåœ¨TLABåˆ†é…ä¹‹åï¼Œå¹¶ä¸å½±å“å¯¹è±¡çš„ç§»åŠ¨å’Œå›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶å¯¹è±¡åˆšå¼€å§‹å¯èƒ½é€šè¿‡TLABåˆ†é…å†…å­˜ï¼Œå­˜æ”¾åœ¨EdenåŒºï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šè¢«åƒåœ¾å›æ”¶æˆ–è€…è¢«ç§»åˆ°Survivor Spaceã€Old Genç­‰ã€‚</p>
<p>âš ï¸TLABå¸¦æ¥çš„é—®é¢˜ï¼š<br>TLABæ˜¯åœ¨edenåŒºåˆ†é…çš„ï¼Œå› ä¸ºedenåŒºåŸŸæœ¬èº«å°±ä¸å¤ªå¤§ï¼Œè€Œä¸”TLABç©ºé—´çš„å†…å­˜ä¹Ÿéå¸¸å°ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»…å æœ‰æ•´ä¸ªEdenç©ºé—´çš„1%ã€‚æ‰€ä»¥ï¼Œå¿…ç„¶å­˜åœ¨ä¸€äº›å¤§å¯¹è±¡æ˜¯æ— æ³•åœ¨TLABç›´æ¥åˆ†é…ã€‚<br>é‡åˆ°TLABä¸­æ— æ³•åˆ†é…çš„å¤§å¯¹è±¡ï¼Œå¯¹è±¡è¿˜æ˜¯å¯èƒ½åœ¨edenåŒºæˆ–è€…è€å¹´ä»£ç­‰è¿›è¡Œåˆ†é…çš„ï¼Œä½†æ˜¯è¿™ç§åˆ†é…å°±éœ€è¦è¿›è¡ŒåŒæ­¥æ§åˆ¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ç»å¸¸è¯´ï¼šå°çš„å¯¹è±¡æ¯”å¤§çš„å¯¹è±¡åˆ†é…èµ·æ¥æ›´åŠ é«˜æ•ˆã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªæ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜ï¼Œè™šæ‹Ÿæœºå®šä¹‰äº†ä¸€ä¸ªrefill_wasteçš„å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥ç¿»è¯‘ä¸ºâ€œæœ€å¤§æµªè´¹ç©ºé—´â€ã€‚</p>
<p>å½“è¯·æ±‚åˆ†é…çš„å†…å­˜å¤§äºrefill_wasteçš„æ—¶å€™ï¼Œä¼šé€‰æ‹©åœ¨å †å†…å­˜ä¸­åˆ†é…ã€‚è‹¥å°äºrefill_wasteå€¼ï¼Œåˆ™ä¼šåºŸå¼ƒå½“å‰TLABï¼Œé‡æ–°åˆ›å»ºTLABè¿›è¡Œå¯¹è±¡å†…å­˜åˆ†é…ã€‚</p>
<p>æ€»ç»“ï¼š<br>ä¸ºäº†ä¿è¯å¯¹è±¡çš„å†…å­˜åˆ†é…è¿‡ç¨‹ä¸­çš„çº¿ç¨‹å®‰å…¨æ€§ï¼ŒHotSpotè™šæ‹Ÿæœºæä¾›äº†ä¸€ç§å«åšTLAB(Thread Local Allocation Buffer)çš„æŠ€æœ¯ã€‚</p>
<p>åœ¨çº¿ç¨‹åˆå§‹åŒ–æ—¶ï¼Œè™šæ‹Ÿæœºä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—TLABç©ºé—´ï¼Œåªç»™å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œå½“éœ€è¦åˆ†é…å†…å­˜æ—¶ï¼Œå°±åœ¨è‡ªå·±çš„ç©ºé—´ä¸Šåˆ†é…ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ç«äº‰çš„æƒ…å†µï¼Œå¯ä»¥å¤§å¤§æå‡åˆ†é…æ•ˆç‡ã€‚</p>
<p>æ‰€ä»¥ï¼Œâ€œå †æ˜¯çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸâ€è¿™å¥è¯å¹¶ä¸å®Œå…¨æ­£ç¡®ï¼Œå› ä¸ºTLABæ˜¯å †å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œä»–åœ¨è¯»å–ä¸Šç¡®å®æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œä½†æ˜¯åœ¨å†…å­˜åˆ†é…ä¸Šï¼Œæ˜¯çº¿ç¨‹ç‹¬äº«çš„ã€‚</p>
<p>TLABçš„ç©ºé—´å…¶å®å¹¶ä¸å¤§ï¼Œæ‰€ä»¥å¤§å¯¹è±¡è¿˜æ˜¯å¯èƒ½éœ€è¦åœ¨å †å†…å­˜ä¸­ç›´æ¥åˆ†é…ã€‚é‚£ä¹ˆï¼Œå¯¹è±¡çš„å†…å­˜åˆ†é…æ­¥éª¤å°±æ˜¯å…ˆå°è¯•TLABåˆ†é…ï¼Œç©ºé—´ä¸è¶³ä¹‹åï¼Œå†åˆ¤æ–­æ˜¯å¦åº”è¯¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œç„¶åå†ç¡®å®šæ˜¯å†edenåˆ†é…è¿˜æ˜¯åœ¨è€å¹´ä»£åˆ†é…ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/jiey0407/article/details/125190629">https://blog.csdn.net/jiey0407/article/details/125190629</a></p>
<h2 id="jvmæ€§èƒ½ç›‘æ§å·¥å…·"><a href="#jvmæ€§èƒ½ç›‘æ§å·¥å…·" class="headerlink" title="jvmæ€§èƒ½ç›‘æ§å·¥å…·"></a>jvmæ€§èƒ½ç›‘æ§å·¥å…·</h2><h3 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h3><p>java virtual machine process status tool<br>jps ä¸»è¦ç”¨æ¥è¾“å‡º JVM ä¸­è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ä¿¡æ¯</p>
<p>è¯­æ³•æ ¼å¼ï¼š<code>jps [options] [hostid]</code><br>å¦‚æœä¸æŒ‡å®š hostid å°±é»˜è®¤ä¸ºå½“å‰ä¸»æœºæˆ–æœåŠ¡å™¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-q ä¸è¾“å‡ºç±»åã€Jaråå’Œä¼ å…¥mainæ–¹æ³•çš„å‚æ•°</span><br><span class="line">-m è¾“å‡ºä¼ å…¥mainæ–¹æ³•çš„å‚æ•°</span><br><span class="line">-l è¾“å‡ºmainç±»æˆ–Jarçš„å…¨é™å</span><br><span class="line">-v è¾“å‡ºä¼ å…¥JVMçš„å‚æ•°</span><br></pre></td></tr></table></figure>

<p>jpså‘½ä»¤è·å–å®é™…çš„è¿›ç¨‹idï¼Œæ˜¯å»ç”¨æˆ·çš„ä¸´æ—¶ç›®å½•ä¸‹å»æ‹¿è¿›ç¨‹idçš„ã€‚<br>æ–‡ä»¶è·¯å¾„ï¼š&#x2F;tmp&#x2F;hsperfdata_{userName}&#x2F;ï¼Œå­˜å‚¨äº†å½“å‰ç”¨æˆ·çš„è¿›ç¨‹ä¿¡æ¯ã€‚</p>
<h3 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h3><p>stack trace for java æ˜¾ç¤ºè™šæ‹Ÿæœºçš„çº¿ç¨‹å¿«ç…§ã€‚<br>jstack ä¸»è¦ç”¨æ¥æŸ¥çœ‹æŸä¸ª Java è¿›ç¨‹å†…çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ã€‚</p>
<p>è¯­æ³•æ ¼å¼ï¼š<code>jstack [option] pid</code><br>å¦‚æœæ˜¯åœ¨64ä½æœºå™¨ä¸Šï¼Œéœ€è¦æŒ‡å®šé€‰é¡¹â€-J-d64â€</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-l long listingsï¼Œä¼šæ‰“å°å‡ºé¢å¤–çš„é”ä¿¡æ¯ï¼Œåœ¨å‘ç”Ÿæ­»é”æ—¶å¯ä»¥ç”¨jstack -l pidæ¥è§‚å¯Ÿé”æŒæœ‰æƒ…å†µ</span><br><span class="line">-m mixed modeï¼Œä¸ä»…ä¼šè¾“å‡ºJavaå †æ ˆä¿¡æ¯ï¼Œè¿˜ä¼šè¾“å‡ºC/C++å †æ ˆä¿¡æ¯ï¼ˆæ¯”å¦‚Nativeæ–¹æ³•ï¼‰</span><br></pre></td></tr></table></figure>

<p>jstack å¯ä»¥å®šä½åˆ°çº¿ç¨‹å †æ ˆï¼Œæ ¹æ®å †æ ˆä¿¡æ¯æˆ‘ä»¬å¯ä»¥å®šä½åˆ°å…·ä½“ä»£ç ï¼Œæ‰€ä»¥å®ƒåœ¨ JVM æ€§èƒ½è°ƒä¼˜ä¸­ä½¿ç”¨å¾—éå¸¸å¤šã€‚ä¾‹å¦‚ï¼šæ‰¾å‡ºæŸä¸ª Java è¿›ç¨‹ä¸­æœ€è€—è´¹ CPU çš„ Java çº¿ç¨‹å¹¶å®šä½å †æ ˆä¿¡æ¯ã€‚</p>
<p>ç¬¬ä¸€æ­¥å…ˆæ‰¾å‡º Java è¿›ç¨‹ ID<br><code>ps -ef | grep åº”ç”¨ | grep -v grep</code></p>
<p>ç¬¬äºŒæ­¥æ‰¾å‡ºè¯¥è¿›ç¨‹å†…æœ€è€—è´¹ CPU çš„çº¿ç¨‹<br>å¯ä»¥ä½¿ç”¨ <code>ps -Lfp pid </code>æˆ–è€… <code>ps -mp pid -o THREAD, tid, time</code> æˆ–è€… <code>top -Hp pid</code> .ã€æœ‰æ²¡æœ‰å¯ä»¥è¾“å‡ºæŒ‰æ—¶é—´æ’åºçš„ï¼Œä¸”åŒºåˆ†daemonçš„ã€‘</p>
<p>ä½¿ç”¨<code>printf &quot;%x\n&quot; çº¿ç¨‹id</code> å°†çº¿ç¨‹idè½¬æ¢ä¸º16è¿›åˆ¶å€¼ã€‚</p>
<p><code>jstack è¿›ç¨‹id | grep 16è¿›åˆ¶çº¿ç¨‹id</code><br>ä»è€Œå®šä½ä»£ç ï¼Œå¯èƒ½æ˜¯å“ªé‡Œwaitæ—¶é—´é•¿äº†ã€‚</p>
<p><code>jstack -l è¿›ç¨‹id æŸ¥çœ‹è¿›ç¨‹ä¸‹æ‰€æœ‰çº¿ç¨‹</code></p>
<hr>
<p>jstackæ‰“å°çš„ä¿¡æ¯æ€ä¹ˆçœ‹ï¼š<br>dump æ–‡ä»¶é‡Œï¼Œå€¼å¾—å…³æ³¨çš„çº¿ç¨‹çŠ¶æ€æœ‰ï¼š<br>æ­»é”ï¼ŒDeadlockï¼ˆé‡ç‚¹å…³æ³¨ï¼‰<br>æ‰§è¡Œä¸­ï¼ŒRunnable<br>ç­‰å¾…èµ„æºï¼ŒWaiting on conditionï¼ˆé‡ç‚¹å…³æ³¨ï¼‰<br>ç­‰å¾…è·å–ç›‘è§†å™¨ï¼ŒWaiting on monitor entryï¼ˆé‡ç‚¹å…³æ³¨ï¼‰<br>æš‚åœï¼ŒSuspended<br>å¯¹è±¡ç­‰å¾…ä¸­ï¼ŒObject.wait() æˆ– TIMED_WAITING<br>é˜»å¡ï¼ŒBlockedï¼ˆé‡ç‚¹å…³æ³¨ï¼‰<br>åœæ­¢ï¼ŒParked</p>
<hr>
<p><strong>å®ä¾‹ä¸€ï¼šWaiting to lock å’Œ Blocked</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;RMI TCP Connection(267865)-172.16.5.25&quot; daemon prio=10 tid=0x00007fd508371000 nid=0x55ae waiting for monitor entry [0x00007fd4f8684000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">at org.apache.log4j.Category.callAppenders(Category.java:201)</span><br><span class="line">- waiting to lock &lt;0x00000000acf4d0c0&gt; (a org.apache.log4j.Logger)</span><br><span class="line">at org.apache.log4j.Category.forcedLog(Category.java:388)</span><br><span class="line">at org.apache.log4j.Category.log(Category.java:853)</span><br><span class="line">at org.apache.commons.logging.impl.Log4JLogger.warn(Log4JLogger.java:234)</span><br><span class="line">at com.tuan.core.common.lang.cache.remote.SpyMemcachedClient.get(SpyMemcachedClient.java:110)</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š<br>1ï¼‰çº¿ç¨‹çŠ¶æ€æ˜¯ Blockedï¼Œé˜»å¡çŠ¶æ€ã€‚è¯´æ˜çº¿ç¨‹ç­‰å¾…èµ„æºè¶…æ—¶ï¼<br>2ï¼‰â€œ waiting to lock &lt;0x00000000acf4d0c0&gt;â€æŒ‡ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…ç»™è¿™ä¸ª 0x00000000acf4d0c0 åœ°å€ä¸Šé”ï¼ˆè‹±æ–‡å¯æè¿°ä¸ºï¼štrying to obtain  0x00000000acf4d0c0 lockï¼‰ã€‚<br>3ï¼‰åœ¨ dump æ—¥å¿—é‡ŒæŸ¥æ‰¾å­—ç¬¦ä¸² 0x00000000acf4d0c0ï¼Œå‘ç°æœ‰å¤§é‡çº¿ç¨‹éƒ½åœ¨ç­‰å¾…ç»™è¿™ä¸ªåœ°å€ä¸Šé”ã€‚å¦‚æœèƒ½åœ¨æ—¥å¿—é‡Œæ‰¾åˆ°è°è·å¾—äº†è¿™ä¸ªé”ï¼ˆå¦‚locked &lt; 0x00000000acf4d0c0 &gt;ï¼‰ï¼Œå°±å¯ä»¥é¡ºè—¤æ‘¸ç“œäº†ã€‚<br>4ï¼‰â€œwaiting for monitor entryâ€è¯´æ˜æ­¤çº¿ç¨‹é€šè¿‡ synchronized(obj) {â€¦â€¦} ç”³è¯·è¿›å…¥äº†ä¸´ç•ŒåŒºï¼Œä»è€Œè¿›å…¥äº†ä¸‹å›¾1ä¸­çš„â€œEntry Setâ€é˜Ÿåˆ—ï¼Œä½†è¯¥ obj å¯¹åº”çš„ monitor è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼Œæ‰€ä»¥æœ¬çº¿ç¨‹åœ¨ Entry Set é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚<br>5ï¼‰ç¬¬ä¸€è¡Œé‡Œï¼Œâ€RMI TCP Connection(267865)-172.16.5.25â€æ˜¯ Thread Name ã€‚tidæŒ‡Java Thread idã€‚nidæŒ‡nativeçº¿ç¨‹çš„idã€‚prioæ˜¯çº¿ç¨‹ä¼˜å…ˆçº§ã€‚[0x00007fd4f8684000]æ˜¯çº¿ç¨‹æ ˆèµ·å§‹åœ°å€ã€‚</p>
<hr>
<p><strong>å®ä¾‹äºŒï¼šWaiting on condition å’Œ TIMED_WAITING</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;RMI TCP Connection(idle)&quot; daemon prio=10 tid=0x00007fd50834e800 nid=0x56b2 waiting on condition [0x00007fd4f1a59000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (parking)</span><br><span class="line">at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">- parking to wait for  &lt;0x00000000acd84de8&gt; (a java.util.concurrent.SynchronousQueue$TransferStack)</span><br><span class="line">at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)</span><br><span class="line">at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:424)</span><br><span class="line">at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:323)</span><br><span class="line">at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:874)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:945)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)</span><br><span class="line">at java.lang.Thread.run(Thread.java:662)</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<p>1ï¼‰â€œTIMED_WAITING (parking)â€ä¸­çš„ timed_waiting æŒ‡ç­‰å¾…çŠ¶æ€ï¼Œä½†è¿™é‡ŒæŒ‡å®šäº†æ—¶é—´ï¼Œåˆ°è¾¾æŒ‡å®šçš„æ—¶é—´åè‡ªåŠ¨é€€å‡ºç­‰å¾…çŠ¶æ€ï¼›parkingæŒ‡çº¿ç¨‹å¤„äºæŒ‚èµ·ä¸­ã€‚</p>
<p>2ï¼‰â€œwaiting on conditionâ€éœ€è¦ä¸å †æ ˆä¸­çš„â€œparking to wait for  &lt;0x00000000acd84de8&gt; (a java.util.concurrent.SynchronousQueue$TransferStack)â€ç»“åˆæ¥çœ‹ã€‚é¦–å…ˆï¼Œæœ¬çº¿ç¨‹è‚¯å®šæ˜¯åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‘ç”Ÿï¼Œæ¥æŠŠè‡ªå·±å”¤é†’ã€‚å…¶æ¬¡ï¼ŒSynchronousQueue å¹¶ä¸æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåªæ˜¯çº¿ç¨‹ä¹‹é—´ç§»äº¤ä¿¡æ¯çš„æœºåˆ¶ï¼Œå½“æˆ‘ä»¬æŠŠä¸€ä¸ªå…ƒç´ æ”¾å…¥åˆ° SynchronousQueue ä¸­æ—¶å¿…é¡»æœ‰å¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…æ¥å—ç§»äº¤çš„ä»»åŠ¡ï¼Œå› æ­¤è¿™å°±æ˜¯æœ¬çº¿ç¨‹åœ¨ç­‰å¾…çš„æ¡ä»¶ã€‚<br>3ï¼‰åˆ«çš„å°±çœ‹ä¸å‡ºæ¥äº†ã€‚</p>
<hr>
<p><strong>å®ä¾‹ä¸‰ï¼šin Obejct.wait() å’Œ TIMED_WAITING</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;RMI RenewClean-[172.16.5.19:28475]&quot; daemon prio=10 tid=0x0000000041428800 nid=0xb09 in Object.wait() [0x00007f34f4bd0000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (on object monitor)</span><br><span class="line">at java.lang.Object.wait(Native Method)</span><br><span class="line">- waiting on &lt;0x00000000aa672478&gt; (a java.lang.ref.ReferenceQueue$Lock)</span><br><span class="line">at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)</span><br><span class="line">- locked &lt;0x00000000aa672478&gt; (a java.lang.ref.ReferenceQueue$Lock)</span><br><span class="line">at sun.rmi.transport.DGCClient$EndpointEntry$RenewCleanThread.run(DGCClient.java:516)</span><br><span class="line">at java.lang.Thread.run(Thread.java:662)</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<p>1ï¼‰â€œTIMED_WAITING (on object monitor)â€ï¼Œå¯¹äºæœ¬ä¾‹è€Œè¨€ï¼Œæ˜¯å› ä¸ºæœ¬çº¿ç¨‹è°ƒç”¨äº† java.lang.Object.wait(long timeout) è€Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p>
<p>2ï¼‰â€œWait Setâ€ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€å°±æ˜¯â€œ in Object.wait() â€ã€‚å½“çº¿ç¨‹è·å¾—äº† Monitorï¼Œè¿›å…¥äº†ä¸´ç•ŒåŒºä¹‹åï¼Œå¦‚æœå‘ç°çº¿ç¨‹ç»§ç»­è¿è¡Œçš„æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå®ƒåˆ™è°ƒç”¨å¯¹è±¡ï¼ˆä¸€èˆ¬å°±æ˜¯è¢« synchronized çš„å¯¹è±¡ï¼‰çš„ wait() æ–¹æ³•ï¼Œæ”¾å¼ƒäº† Monitorï¼Œè¿›å…¥ â€œWait Setâ€é˜Ÿåˆ—ã€‚åªæœ‰å½“åˆ«çš„çº¿ç¨‹åœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨äº† notify() æˆ–è€… notifyAll() ï¼Œâ€œ Wait Setâ€é˜Ÿåˆ—ä¸­çº¿ç¨‹æ‰å¾—åˆ°æœºä¼šå»ç«äº‰ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—å¯¹è±¡çš„ Monitorï¼Œæ¢å¤åˆ°è¿è¡Œæ€ã€‚</p>
<p>3ï¼‰RMI RenewClean æ˜¯ DGCClient çš„ä¸€éƒ¨åˆ†ã€‚DGC æŒ‡çš„æ˜¯ Distributed GCï¼Œå³åˆ†å¸ƒå¼åƒåœ¾å›æ”¶ã€‚</p>
<p>4ï¼‰è¯·æ³¨æ„ï¼Œæ˜¯å…ˆ locked &lt;0x00000000aa672478&gt;ï¼Œå waiting on &lt;0x00000000aa672478&gt;ï¼Œä¹‹æ‰€ä»¥å…ˆé”å†ç­‰åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¯·çœ‹ä¸‹é¢å®ƒçš„ä»£ç å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">static private class  Lock &#123; &#125;;</span><br><span class="line">private Lock lock = new Lock();</span><br><span class="line">public Reference&lt;? extends T&gt; remove(long timeout)</span><br><span class="line">&#123;</span><br><span class="line">    synchronized (lock) &#123;</span><br><span class="line">        Reference&lt;? extends T&gt; r = reallyPoll();</span><br><span class="line">        if (r != null) return r;</span><br><span class="line">        for (;;) &#123;</span><br><span class="line">            lock.wait(timeout);</span><br><span class="line">            r = reallyPoll();</span><br><span class="line">            â€¦â€¦</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å³ï¼Œçº¿ç¨‹çš„æ‰§è¡Œä¸­ï¼Œå…ˆç”¨ synchronized è·å¾—äº†è¿™ä¸ªå¯¹è±¡çš„ Monitorï¼ˆå¯¹åº”äº  locked &lt;0x00000000aa672478&gt; ï¼‰ï¼›å½“æ‰§è¡Œåˆ° lock.wait(timeout);ï¼Œçº¿ç¨‹å°±æ”¾å¼ƒäº† Monitor çš„æ‰€æœ‰æƒï¼Œè¿›å…¥â€œWait Setâ€é˜Ÿåˆ—ï¼ˆå¯¹åº”äº  waiting on &lt;0x00000000aa672478&gt; ï¼‰ã€‚<br>5ï¼‰ä»å †æ ˆä¿¡æ¯çœ‹ï¼Œæ˜¯æ­£åœ¨æ¸…ç† remote references to remote objects ï¼Œå¼•ç”¨çš„ç§Ÿçº¦åˆ°äº†ï¼Œåˆ†å¸ƒå¼åƒåœ¾å›æ”¶åœ¨é€ä¸€æ¸…ç†å‘¢ã€‚</p>
<p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/nexiyi/p/java_thread_jstack.html">https://www.cnblogs.com/nexiyi/p/java_thread_jstack.html</a></p>
<h3 id="jmapå’Œjhat"><a href="#jmapå’Œjhat" class="headerlink" title="jmapå’Œjhat"></a>jmapå’Œjhat</h3><p>jmapï¼ˆMemory Mapï¼‰å’Œjhatï¼ˆJava Heap Analysis Toolï¼‰</p>
<p>jmapç”¨æ¥æŸ¥çœ‹<strong>å †å†…å­˜</strong>ä½¿ç”¨çŠ¶å†µï¼Œä¸€èˆ¬ç»“åˆjhatä½¿ç”¨ã€‚<br>jmapè¯­æ³•æ ¼å¼ï¼š<code>jmap [option] pid</code>  pidä¸ºè¿›ç¨‹id</p>
<p>æ‰“å°è¿›ç¨‹çš„ç±»åŠ è½½å™¨å’Œç±»åŠ è½½å™¨åŠ è½½çš„æŒä¹…ä»£å¯¹è±¡ä¿¡æ¯ï¼Œè¾“å‡ºï¼šç±»åŠ è½½å™¨åç§°ã€å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼ˆä¸å¯é ï¼‰ã€å¯¹è±¡åœ°å€ã€çˆ¶ç±»åŠ è½½å™¨ã€å·²åŠ è½½çš„ç±»å¤§å°ç­‰ä¿¡æ¯</p>
<p>ä½¿ç”¨<strong>jmap -heap pid</strong>æŸ¥çœ‹è¿›ç¨‹å †å†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„GCç®—æ³•ã€å †é…ç½®å‚æ•°å’Œå„ä»£ä¸­å †å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p>
<p>ä½¿ç”¨<code>jmap -histo pid</code> &#x2F; <code>jmap -histo:live pid</code>æŸ¥çœ‹å †å†…å­˜ä¸­çš„å¯¹è±¡æ•°ç›®ã€å¤§å°ç»Ÿè®¡ç›´æ–¹å›¾ï¼Œå¦‚æœå¸¦ä¸Šliveåˆ™åªç»Ÿè®¡æ´»å¯¹è±¡.<br>åŠ ä¸Š<code>| more</code> æŒ‰ç±»åˆ«ç»Ÿè®¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jmap -histo:live 21711 | more </span><br><span class="line">num     #instances         #bytes  class name------------</span><br><span class="line">   1:         38445        5597736  &lt;constMethodKlass&gt;</span><br><span class="line">   2:         38445        5237288  &lt;methodKlass&gt;</span><br><span class="line"></span><br><span class="line">class nameæ˜¯å¯¹è±¡ç±»å‹</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„æƒ…å†µæ˜¯ï¼šç”¨jmapæŠŠè¿›ç¨‹å†…å­˜ä½¿ç”¨æƒ…å†µdumpåˆ°æ–‡ä»¶ä¸­ï¼Œå†ç”¨jhatåˆ†ææŸ¥çœ‹ã€‚jmapè¿›è¡Œdumpå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š<code>jmap -dump:format=b,file=dumpFileName pid</code></p>
<p>ä¾‹å¦‚ï¼š<code>jmap -dump:format=b,file=/tmp/dump.dat è¿›ç¨‹id</code></p>
<p>dump.datæ–‡ä»¶å¾ˆå¤§ã€‚<br>dumpå‡ºæ¥çš„æ–‡ä»¶å¯ä»¥ç”¨MATã€VisualVMç­‰å·¥å…·æŸ¥çœ‹ï¼Œè¿™é‡Œç”¨jhatæŸ¥çœ‹ï¼š<code>jhat -port 9998 /tmp/dump.dat</code><br>ç„¶åå°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸»æœºåœ°å€ï¼š9998 æŸ¥çœ‹äº†ã€‚##### ###</p>
<h3 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h3><p>JVMç»Ÿè®¡ç›‘æµ‹å·¥å…·<br>jvm statistics monitoring toolï¼šç”¨äºæ”¶é›†è™šæ‹Ÿæœºå„æ–¹é¢çš„è¿è¡Œæ•°æ®ã€‚</p>
<p>è¯­æ³•æ ¼å¼ï¼š<code>jstat [ generalOption | outputOptions vmid [interval[s|ms] [count]] ]</code></p>
<p>vmidæ˜¯Javaè™šæ‹ŸæœºIDï¼Œåœ¨Linux&#x2F;Unixç³»ç»Ÿä¸Šä¸€èˆ¬å°±æ˜¯è¿›ç¨‹IDã€‚intervalæ˜¯é‡‡æ ·æ—¶é—´é—´éš”ã€‚countæ˜¯é‡‡æ ·æ•°ç›®ã€‚ ä¾‹å¦‚ï¼š<code>jstat -gc è¿›ç¨‹id 250 4</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jstat -gc 21711 250 4 </span><br><span class="line">S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT   </span><br><span class="line">192.0  192.0   64.0   0.0    6144.0   1854.9   32000.0     4111.6   55296.0 25472.7    702    0.431   3      0.218    0.649</span><br><span class="line">192.0  192.0   64.0   0.0    6144.0   1972.2   32000.0     4111.6   55296.0 25472.7    702    0.431   3      0.218    0.649</span><br><span class="line"></span><br><span class="line">S0Cã€S1Cã€S0Uã€S1Uï¼šSurvivor 0/1åŒºå®¹é‡ï¼ˆCapacityï¼‰å’Œä½¿ç”¨é‡ï¼ˆUsedï¼‰</span><br><span class="line">è¿è¡Œä»¥æ¥ï¼Œæ€»è€—æ—¶ï¼Œå•ä½s</span><br><span class="line">ECã€EUï¼šEdenåŒºå®¹é‡å’Œä½¿ç”¨é‡</span><br><span class="line">OCã€OUï¼šå¹´è€ä»£å®¹é‡å’Œä½¿ç”¨é‡</span><br><span class="line">PCã€PUï¼šæ°¸ä¹…ä»£å®¹é‡å’Œä½¿ç”¨é‡</span><br><span class="line">YGCã€YGTï¼šå¹´è½»ä»£GCæ¬¡æ•°å’ŒGCè€—æ—¶</span><br><span class="line">FGCã€FGCTï¼šFull GCæ¬¡æ•°å’ŒFull GCè€—æ—¶</span><br><span class="line">GCTï¼šGCæ€»è€—æ—¶</span><br></pre></td></tr></table></figure>

<p>JVMå †å†…å­˜å¸ƒå±€ï¼š<br>å †å†…å­˜ &#x3D; å¹´è½»ä»£ + å¹´è€ä»£ + æ°¸ä¹…ä»£<br>å¹´è½»ä»£ &#x3D; EdenåŒº + ä¸¤ä¸ªSurvivoråŒºï¼ˆFromå’ŒToï¼‰</p>
<p><code>jstat -gcutil 23484 1000 5</code> ç›‘è§†å†…å®¹åŸºæœ¬ä¸gcç›¸åŒï¼Œä½†è¾“å‡ºçš„ä¸»è¦æ˜¯å·²å ç”¨çš„æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”ã€‚</p>
<p><code>jstat -gccause 23484 1000 5</code> æŸ¥è¯¢gcçš„åŸå› ã€‚</p>
<h3 id="hprof"><a href="#hprof" class="headerlink" title="hprof"></a>hprof</h3><p>ï¼ˆHeap&#x2F;CPU Profiling Toolï¼‰<br>hprofèƒ½å¤Ÿå±•ç°CPUä½¿ç”¨ç‡ï¼Œç»Ÿè®¡å †å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p>
<p>è¯­æ³•æ ¼å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -agentlib:hprof[=options] ToBeProfiledClass</span><br><span class="line">java -Xrunprof[:options] ToBeProfiledClass</span><br><span class="line">javac -J-agentlib:hprof[=options] ToBeProfiledClass</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼š<code>java -agentlib:hprof=cpu=samples,interval=20,depth=3 ä¸»ç±»</code><br>æ¯éš”20æ¯«ç§’é‡‡æ ·CPUæ¶ˆè€—ä¿¡æ¯ï¼Œå †æ ˆæ·±åº¦ä¸º3ï¼Œç”Ÿæˆçš„profileæ–‡ä»¶åç§°æ˜¯java.hprof.txtï¼Œåœ¨å½“å‰ç›®å½•ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>javac -J-agentlib:hprof=cpu=times Hello.java</code><br>èƒ½å¤Ÿè·å¾—æ›´åŠ ç»†ç²’åº¦çš„CPUæ¶ˆè€—ä¿¡æ¯ï¼Œèƒ½å¤Ÿç»†åˆ°æ¯ä¸ªæ–¹æ³•è°ƒç”¨çš„å¼€å§‹å’Œç»“æŸï¼Œå®ƒçš„å®ç°ä½¿ç”¨äº†å­—èŠ‚ç æ³¨å…¥æŠ€æœ¯ï¼ˆBCIï¼‰ã€‚</p>
<p>JVMæ€§èƒ½è°ƒä¼˜ç›‘æ§å·¥å…·jpsã€jstackã€jmapã€jhatã€jstatã€hprofä½¿ç”¨è¯¦è§£ï¼š<a href="https://zhuanlan.zhihu.com/p/294950372?utm_medium=social&utm_oi=690843302169178112">https://zhuanlan.zhihu.com/p/294950372?utm_medium=social&amp;utm_oi=690843302169178112</a></p>
<h3 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h3><p>è™šæ‹Ÿæœºé…ç½®ä¿¡æ¯ï¼Œ<code>jinfo è¿›ç¨‹id</code></p>
<h3 id="å›¾åƒåŒ–ç•Œé¢åˆ†æå·¥å…·"><a href="#å›¾åƒåŒ–ç•Œé¢åˆ†æå·¥å…·" class="headerlink" title="å›¾åƒåŒ–ç•Œé¢åˆ†æå·¥å…·"></a>å›¾åƒåŒ–ç•Œé¢åˆ†æå·¥å…·</h3><p>VisualVMã€JProfileã€MAT</p>
<h2 id="å‡ ç§æ’æŸ¥æ€è·¯"><a href="#å‡ ç§æ’æŸ¥æ€è·¯" class="headerlink" title="å‡ ç§æ’æŸ¥æ€è·¯"></a>å‡ ç§æ’æŸ¥æ€è·¯</h2><h3 id="çº¿ç¨‹cpuå ç”¨é«˜"><a href="#çº¿ç¨‹cpuå ç”¨é«˜" class="headerlink" title="çº¿ç¨‹cpuå ç”¨é«˜"></a>çº¿ç¨‹cpuå ç”¨é«˜</h3><p>1.<code>ps -ef|grep java</code> æˆ–è€… jps æŸ¥æ‰¾å‡ºè¿›ç¨‹id<br>2.<code>top -Hp è¿›ç¨‹id</code> æŸ¥æ‰¾å‡ºæœ€è€—cpuçš„çº¿ç¨‹id <code>top -c</code>çœ‹è¿›ç¨‹çš„<br>3.<code>printf &quot;%x\n&quot;</code> çº¿ç¨‹id  è½¬æ¢ä¸º16è¿›åˆ¶çš„id<br>4.ä½¿ç”¨<code>jstack è¿›ç¨‹id | grep 16è¿›åˆ¶çº¿ç¨‹id</code>  æŸ¥æ‰¾å‡ºå †æ ˆä¿¡æ¯ï¼Œåˆ†æ</p>
<p>å¦å¤–ï¼Œarthasä¹Ÿå¯ä»¥æ‰“å°å‡ºå‰å¤šå°‘ä¸ªçº¿ç¨‹åŠå æœ‰cpuæƒ…å†µ<br><code>thread -n 5</code></p>
<h3 id="OOM"><a href="#OOM" class="headerlink" title="OOM"></a>OOM</h3><p>é™¤äº†ç¨‹åºè®¡æ•°å™¨ï¼Œå…¶ä»–å†…å­˜å­˜å‚¨éƒ½å¯èƒ½OOMã€‚<br>æœ‰å¯èƒ½ï¼šæ•°æ®é‡å¤§ã€JVMå†…å­˜å®¹é‡å‚æ•°åˆ†é…ä¸åˆç†ã€ä»£ç bugæ­»å¾ªç¯æ— é™åˆ†é…å®¹é‡<br>1ã€å†…å­˜æ³„éœ²ï¼Œå¯¹è±¡å·²ç»æ­»äº†ï¼Œæ— æ³•é€šè¿‡åƒåœ¾æ”¶é›†å™¨è¿›è¡Œè‡ªåŠ¨å›æ”¶ï¼Œé€šè¿‡æ‰¾å‡ºæ³„éœ²çš„ä»£ç ä½ç½®å’ŒåŸå› ï¼Œæ‰å¥½ç¡®å®šè§£å†³æ–¹æ¡ˆï¼›<br>2ã€å†…å­˜æº¢å‡ºï¼Œå†…å­˜ä¸­çš„å¯¹è±¡éƒ½è¿˜å¿…é¡»å­˜æ´»ç€ï¼Œè¿™è¯´æ˜Javaå †åˆ†é…ç©ºé—´ä¸è¶³ï¼Œæ£€æŸ¥å †è®¾ç½®å¤§å°ï¼ˆ-Xmxä¸-Xmsï¼‰ï¼Œæ£€æŸ¥ä»£ç æ˜¯å¦å­˜åœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¤ªé•¿ã€æŒæœ‰çŠ¶æ€æ—¶é—´è¿‡é•¿çš„æƒ…å†µã€‚</p>
<p>1.å…ˆä½¿ç”¨jmapçœ‹ä¸€ä¸‹å †å†…å­˜ä½¿ç”¨æƒ…å†µ<br>2.<code>jmap -dump:format=b,file=/tmp/dump.dat è¿›ç¨‹id</code> dumpæ–‡ä»¶<br>3.ä½¿ç”¨MATå·¥å…·åˆ†æ<br>matå·¥å…·çš„ä½¿ç”¨ï¼š<a href="https://developer.aliyun.com/article/44641">https://developer.aliyun.com/article/44641</a></p>
<h3 id="full-gc"><a href="#full-gc" class="headerlink" title="full gc"></a>full gc</h3><p>1.<code>jstat -gcutil è¿›ç¨‹id 1000 40</code>æŸ¥çœ‹gcæƒ…å†µï¼Œ1sä¸€æ¬¡ï¼Œ40æ¬¡åŠ¨æ€çœ‹gcå¢é•¿<br>2.æ‰¾åˆ°gc.log<br>é‡Œé¢æœ‰gcå‰å †ä½¿ç”¨ç©ºé—´&gt;gcåå †å·²ä½¿ç”¨ç©ºé—´ï¼Œè¿˜æœ‰ç”¨æˆ·æ€æ¶ˆè€—çš„cpuæ—¶é—´ã€å†…æ ¸æ€æ¶ˆè€—çš„cpuæ—¶é—´ã€æ“ä½œä»å¼€å§‹åˆ°ç»“æŸç»è¿‡çš„æ—¶é—´ã€‚</p>
<p>æ¨¡æ‹Ÿgcçœ‹æ—¥å¿—ï¼š<br><a href="https://javastack.blog.csdn.net/article/details/109006521">https://javastack.blog.csdn.net/article/details/109006521</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>mybatiså®æˆ˜</title>
    <url>/2022/06/02/myblog/java/mybatis%E5%AE%9E%E6%88%98/</url>
    <content><![CDATA[<h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3><p>1ã€mybatis <code>&lt;if&gt;</code> æ ‡ç­¾ä¸æ˜¯å¿…é¡»åœ¨<code>&lt;where&gt;</code>æ ‡ç­¾ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from table</span><br><span class="line">&lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;uis != null&quot;&gt;</span><br><span class="line">        uid = #&#123;uid&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/where&gt;</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">where status = 0</span><br><span class="line">&lt;if test=&quot;uis != null&quot;&gt;</span><br><span class="line">    and uid = #&#123;uid&#125;</span><br><span class="line">&lt;/if&gt;</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">&lt;if test=&quot;uis != null&quot;&gt;</span><br><span class="line">    where uid = #&#123;uid&#125;</span><br><span class="line">&lt;/if&gt;</span><br></pre></td></tr></table></figure>

<p>2ã€mybatisä¸­ï¼Œ<code>select * from in &lt;foreach&gt; #&#123;list&#125;</code>ï¼Œä¸­çš„listä¸èƒ½æ˜¯ç©ºï¼Œä¸èƒ½ä¸ºnullï¼Œä¼šæŠ¥é”™ã€‚</p>
<p>3ã€mybatisæŸ¥å‡ºçš„ç»“æœæ˜¯listï¼Œå¦‚æœç»“æœæ˜¯ä¸€æ¡éƒ½æ²¡æœ‰ï¼Œé‚£ä¹ˆè¿”å›çš„æ˜¯ç©ºlistï¼Œè€Œä¸æ˜¯nullã€‚</p>
<p>4ã€mybatis sum å¦‚æœæ²¡æœ‰è®°å½•ï¼Œè¿”å›çš„æ˜¯nullï¼Œæ‰€ä»¥è¦æ³¨æ„mybatisè¿”å›ç»“æœéƒ½ç”¨åŒ…è£…ç±»å‹æ¥æ¥ã€‚</p>
<p>5.mybatisæŸ¥å‡ºçš„Dateç±»å‹ï¼Œæ˜¯æ¯«ç§’æ—¶é—´æˆ³ï¼Œå¯ä»¥ç”¨Stringæ¥Dateç±»å‹ï¼Œåªä¸è¿‡æ˜¯ï¼š2023-01-01 11:11:11.1ï¼Œæ‰€ä»¥å¾—ç”¨.substring(0,19)ï¼Œæ³¨æ„è¯¥æ–¹æ³•stringæ˜¯nullä¸è¡Œï¼Œä½æ•°ä¸å¤Ÿä¹Ÿä¼šæŠ¥é”™ã€‚</p>
<p>6.mybatisæ¥selectï¼Œinä¸€ä¸ªlistï¼Œå¦‚æœä¼ å…¥çš„listæ˜¯nullæˆ–è€…ç©ºä¼šæŠ¥é”™ã€‚<br>nullä¼šæŠ¥é”™ï¼šorg.mybatis.spring.MybatisSystemException<br>ç©ºlistä¼šerror sql<br>å¦‚æœåŠ äº†<code>&lt;where&gt;</code>æ ‡ç­¾å’Œ<code>&lt;if&gt;</code>æ ‡ç­¾ï¼Œä¼šå¯¼å‡ºæ‰€æœ‰çš„ã€‚<br><code>&lt;if test=&quot;list != null and list.size() &gt; 0&quot;&gt;</code></p>
<h3 id="mybatis-error"><a href="#mybatis-error" class="headerlink" title="mybatis error"></a>mybatis error</h3><h4 id="âœ…Mybatis-Exception-Translator-translateExceptionIfPossible"><a href="#âœ…Mybatis-Exception-Translator-translateExceptionIfPossible" class="headerlink" title="âœ…Mybatis Exception Translator.translateExceptionIfPossible"></a>âœ…Mybatis Exception Translator.translateExceptionIfPossible</h4><p>åŸå› ï¼šæ’å…¥æ—¶æ‰¾ä¸åˆ°å‚æ•°ï¼Œæ‰¹é‡æ’å…¥æ—¶ä¼ çš„listä¸ºç©ºä¹Ÿä¼šæŠ¥æ­¤é—®é¢˜ã€‚</p>
<h3 id="resultMapå’ŒresultType"><a href="#resultMapå’ŒresultType" class="headerlink" title="resultMapå’ŒresultType"></a>resultMapå’ŒresultType</h3><p>ResultTypeå’ŒResultMapéƒ½æ˜¯æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶è¿”å›çš„ç»“æœé›†ã€‚<br>ResultTypeç›¸å¯¹ä¸ResultMapè€Œè¨€æ›´ç®€å•ä¸€ç‚¹ã€‚åªæœ‰æ»¡è¶³ORMï¼ˆObject Relational Mappingï¼Œå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ—¶ï¼Œå³æ•°æ®åº“è¡¨ä¸­çš„å­—æ®µåå’Œå®ä½“ç±»ä¸­çš„å±æ€§å®Œå…¨ä¸€è‡´æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨ï¼Œå¦åˆ™ä¼šå‡ºç°æ•°æ®ä¸æ˜¾ç¤ºçš„æƒ…å†µã€‚<br>ResultMapå’ŒResultTypeçš„åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯ResultMapæ›´å¼ºå¤§ä¸€ç‚¹ï¼ŒResultMapå¯ä»¥å®ç°å°†æŸ¥è¯¢ç»“æœæ˜ å°„ä¸ºå¤æ‚ç±»å‹çš„pojoã€‚</p>
<h4 id="resultType"><a href="#resultType" class="headerlink" title="resultType"></a>resultType</h4><p>1.javaçš„åŸºç¡€ç±»å‹åŠå…¶åŒ…è£…ç±»int,doubleå’Œjava.lang.Integer,java.lang.Doubleç­‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿”å›å€¼ä¸ºintï¼ŒresultTypeä¸ºint ,java.lang.Integerä¹Ÿå¯ä»¥--&gt;</span><br><span class="line">&lt;select id=&quot;countUser&quot; resultType=&quot;int&quot;&gt;</span><br><span class="line">    select count(*) from user</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>2.è‡ªå·±å®šä¹‰çš„å®ä½“ç±»,å®ä½“ç±»å’Œæ•°æ®åº“å­—æ®µéœ€è¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´éœ€è¦ä½¿ç”¨resulMapè‡ªå®šä¹‰mapï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨mapã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿”å›å€¼ä¸ºå®ä½“ç±»ï¼ŒresultTypeä¸ºUser--&gt;</span><br><span class="line">&lt;select id=&quot;getUser&quot; resultType=&quot;com.entity.User&quot;&gt;</span><br><span class="line">   select * from User where id=#&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>3.mapç±»å‹ï¼ŒDaoå±‚çš„è¿”å›ç±»å‹ä¸º<code>Map&lt;String, Object&gt;</code>ï¼Œkeyæ˜¯å¯¹åº”çš„columnå€¼ï¼Œvalueæ˜¯æ•°æ®ä¸­çš„æ•°æ®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> è¿”å›å€¼ä¸ºMap&lt;String,Object&gt;ï¼ŒresultTypeä¸ºmap--&gt;</span><br><span class="line">&lt;select id=&quot;getUserSelective&quot; resultType=&quot;map&quot;&gt;</span><br><span class="line">    select name,address,salary from User where id=#&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>4.Listé›†åˆï¼Œå…¶ä¸­è¯¥é›†åˆçš„ç±»å‹å¯ä»¥ä¸º1,2,3ä¸­æåˆ°çš„ç±»å‹ã€‚Daoå±‚çš„è¿”å›ç±»å‹ä¸º<code>List&lt;User&gt;</code>ï¼Œè¿™é‡Œåªå±•ç¤ºäº†å®ä½“ç±»é›†åˆ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿”å›å€¼ä¸ºList&lt;User&gt;ï¼ŒresultTypeä¸ºUser--&gt;</span><br><span class="line">&lt;select id=&quot;getUserList&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    select * from user</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h4><p>ç»“æœé›†çš„æ˜ å°„æ˜¯ MyBatis æœ€å¼ºå¤§çš„ç‰¹æ€§,é€šè¿‡ä½¿ç”¨resultMapæˆ–resultTypeå¯ä»¥è§£å†³å¤æ‚æ˜ å°„é—®é¢˜ã€‚åŸºç¡€ç®€å•çš„ä½¿ç”¨resultTypeå°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœå‡ºç°tableä¸­åˆ—å’Œå®ä½“ç±»ä¸­çš„å±æ€§ä¸ä¸€è‡´æˆ–è€…å¤šè¡¨çº§è”ã€‚é‚£ä¹ˆè¿™æ—¶resultMapå°±å¯ä»¥å‘æŒ¥ä½œç”¨äº†ã€‚</p>
<p>TestDao.xml:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;mapper namespace=&quot;com.repository.TestDao&quot;&gt;</span><br><span class="line">    //å®šä¹‰æ˜ å°„</span><br><span class="line">    &lt;resultMap id=&quot;TestResultMap&quot; type=&quot;com.entity.TestDO&quot;&gt;</span><br><span class="line">        &lt;result column=&quot;id&quot; property=&quot;id&quot; jdbcType=&quot;INTEGER&quot; /&gt;</span><br><span class="line">        &lt;result column=&quot;name&quot; property=&quot;name&quot; jdbcType=&quot;VARCHAR&quot; /&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    //å®šä¹‰è¿”å›æ ç›®</span><br><span class="line">    &lt;sql id=&quot;all_colum_without_id&quot;&gt;</span><br><span class="line">        name</span><br><span class="line">    &lt;/sql&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sql id=&quot;all_colum&quot;&gt;</span><br><span class="line">        name,&lt;include refid=&quot;all_colum_without_id&quot;/&gt;</span><br><span class="line">    &lt;/sql&gt;</span><br><span class="line"></span><br><span class="line">    //æ’å…¥è¯­å¥</span><br><span class="line">    &lt;insert id=&quot;insertOne&quot; parameterType=&quot;com.entity.TestDO&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;&gt;</span><br><span class="line">        insert into table (&lt;include refid=&quot;all_colum_without_id&quot;/&gt;)</span><br><span class="line">        values (#&#123;name&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">    //æ‰¹é‡æ’å…¥</span><br><span class="line">    &lt;insert id=&quot;insertBatch&quot; parameterType=&quot;com.entity.TestDO&quot;&gt;</span><br><span class="line">        insert into table (&lt;include refid=&quot;all_colum_without_id&quot;/&gt;)</span><br><span class="line">        values</span><br><span class="line">        &lt;foreach collection=&quot;testDOList&quot; separator=&quot;,&quot; item=&quot;item&quot; index=&quot;index&quot;&gt;</span><br><span class="line">            (#&#123;item.name&#125;,</span><br><span class="line">            #&#123;item.age&#125;)</span><br><span class="line">            &lt;/foreach&gt;</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">    //æŸ¥è¯¢</span><br><span class="line">    &lt;select id=&quot;findById&quot; resultMap=&quot;TestResultMap&quot;&gt;</span><br><span class="line">        select &lt;include refid=&quot;all_colum&quot;/&gt; from table where id=#&#123;id&#125;</span><br><span class="line">        &lt;if test=&quot;age != null&quot;&gt;</span><br><span class="line">            and age=#&#123;age&#125;</span><br><span class="line">        &lt;if&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p>TestDao.javaæ¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">public interface TestDao &#123;</span><br><span class="line">    //æ’å…¥</span><br><span class="line">    Integer insertOne(TestDO testDO);</span><br><span class="line">    //æ‰¹é‡æ’å…¥</span><br><span class="line">    Integer insertBatch(List&lt;TestDO&gt; testDOList);</span><br><span class="line">    //æŸ¥è¯¢</span><br><span class="line">    TestDO findById(Long id, Integer age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>jdbcTypeå‘Šè¯‰æ¡†æ¶å¦‚ä½•è§£æè¿™ä¸ªå±æ€§ï¼ˆå¯¹åº”æ•°æ®åº“ä¸­çš„ç±»å‹ï¼‰ï¼Œcolumnæ˜¯æ•°æ®åº“ä¸­tableçš„åˆ—åï¼Œpropertyæ˜¯å®ä½“ç±»ä¸­å¯¹åº”çš„å±æ€§åå­—ï¼Œtypeæ˜¯å¯¹åº”çš„å®ä½“ç±»ï¼Œid&#x3D;â€TestResultMapâ€æ˜¯è¿™ä¸ªresultMapçš„ä¸€ä¸ªå¼•ç”¨æ ‡å¿—ã€‚</p>
<p>è¿™æ ·ä½¿ç”¨resultMapå°±åƒç”¨resultTypeå¯¹åº”å®ä½“ç±»ï¼Œåœ¨selectå‡ºæ¥çš„è¯­å¥ä¸­ç›´æ¥å¯¹å­—æ®µå°±è¡Œasï¼Œasä¸ºå®ä½“ç±»å±æ€§åï¼Œæˆ–é©¼å³°å½¢å¼å°±è¡Œã€‚</p>
<p>resultMapæ›´å¤æ‚çš„ç”¨æ³•ï¼š<a href="https://blog.csdn.net/wobuaizhi/article/details/83104464">https://blog.csdn.net/wobuaizhi/article/details/83104464</a></p>
<h3 id="è¿”å›æ˜ å°„ä¸‹åˆ’çº¿è½¬é©¼å³°"><a href="#è¿”å›æ˜ å°„ä¸‹åˆ’çº¿è½¬é©¼å³°" class="headerlink" title="è¿”å›æ˜ å°„ä¸‹åˆ’çº¿è½¬é©¼å³°"></a>è¿”å›æ˜ å°„ä¸‹åˆ’çº¿è½¬é©¼å³°</h3><p>æ„æ€æ˜¯è¿”å›å€¼å¯¹åº”åˆ°å¯¹è±¡ï¼Œmysqlè¿”å›çš„å­—æ®µåï¼ˆapp_idï¼‰ï¼Œç›´æ¥æ˜ å°„åˆ°å¯¹è±¡å±æ€§åï¼ˆappIdï¼‰ã€‚</p>
<p>ç¬¬ä¸€ç§ Spring Boot</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mybatis.configuration.map-underscore-to-camel-case=true</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ mybatis-config.xmlé…ç½®ä¸­åŠ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- å…¨å±€é…ç½® --&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">    </span><br><span class="line">       &lt;!-- æ˜¯å¦å¼€å¯è‡ªåŠ¨é©¼å³°å‘½åè§„åˆ™æ˜ å°„</span><br><span class="line">        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line">&lt;/configuration&gt; </span><br></pre></td></tr></table></figure>

<h3 id="mybatis-useGeneratedKeys-keyProperty"><a href="#mybatis-useGeneratedKeys-keyProperty" class="headerlink" title="mybatis useGeneratedKeys keyProperty"></a>mybatis useGeneratedKeys keyProperty</h3><p>useGeneratedKeys ï¼ˆä»…é€‚ç”¨äº insert å’Œ updateï¼‰è¿™ä¼šä»¤ MyBatis ä½¿ç”¨ JDBC çš„ getGeneratedKeys æ–¹æ³•æ¥å–å‡ºç”±æ•°æ®åº“å†…éƒ¨ç”Ÿæˆçš„ä¸»é”®ï¼ˆæ¯”å¦‚ï¼šåƒ MySQL å’Œ SQL Server è¿™æ ·çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„è‡ªåŠ¨é€’å¢å­—æ®µï¼‰ï¼Œé»˜è®¤å€¼ï¼šfalseã€‚</p>
<p>é¦–å…ˆï¼Œå¦‚æœä½ çš„æ•°æ®åº“æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®çš„å­—æ®µï¼ˆæ¯”å¦‚ MySQL å’Œ SQL Serverï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥è®¾ç½® useGeneratedKeys&#x3D;â€trueâ€ï¼Œç„¶åå†æŠŠ keyProperty è®¾ç½®ä¸ºç›®æ ‡å±æ€§å°± OK äº†ã€‚</p>
<p>ä½œç”¨ï¼šåœ¨insetæ—¶ï¼Œå¯ä»¥ä¸ç”¨ç®¡ä¸»é”®æ’å…¥å¤šå°‘ï¼Œè€Œä¸”æ’å…¥åï¼Œè¿˜èƒ½ç›´æ¥ç”¨å¯¹è±¡é‡Œçš„å€¼ï¼Œå› ä¸ºè‡ªåŠ¨è¿”å›äº†ã€‚å»ºè¡¨æ—¶å¿…é¡»è®¾ç½®ä¸»é”®è‡ªå¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;insert id=&quot;insertAuthor&quot; useGeneratedKeys=&quot;true&quot;</span><br><span class="line">    keyProperty=&quot;id&quot;&gt;</span><br><span class="line">  insert into Author (username,password,email,bio)</span><br><span class="line">  values (#&#123;username&#125;,#&#123;password&#125;,#&#123;email&#125;,#&#123;bio&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<h3 id="DUPLICATE"><a href="#DUPLICATE" class="headerlink" title="DUPLICATE"></a>DUPLICATE</h3><p>duplicateåœ¨mybatisä¸­çš„ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;insert id=&quot;insertOne&quot; parameterType=&quot;com.entity.TestDO&quot;&gt;</span><br><span class="line">    insert into table (id, &lt;include refid=&quot;all_colum_without_id&quot;/&gt;)</span><br><span class="line">    values (0, #&#123;name&#125;)</span><br><span class="line">    ON DUPLICATE KEY UPDATE name=values(name), age=values(age)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">valuesåé¢å°±æ˜¯æ’å…¥è¦æŸ¥å“ªäº›ã€‚</span><br><span class="line">updateåé¢æ˜¯æ›´æ–°è¦æ›´æ–°å“ªäº›</span><br><span class="line">ä»€ä¹ˆæ—¶å€™æ›´æ–°è¦çœ‹è¡¨çš„ä¸»é”®ç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•</span><br><span class="line">idå¯é€‰ï¼ŒåŠ äº†idï¼Œå°±ä¼ 0</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ›´æ–°çš„æ—¶å€™æ˜¯ä¸ä¼šè¿”å›idçš„ï¼Œæ‰€ä»¥è¦å»æ‰ï¼š<code>useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;</code><br>å¦‚æœä¸å»æ‰ï¼Œä¼šæŠ¥<code>executorexception: error getting generated key or setting result to parameter object</code></p>
<h3 id="xmlé‡Œé¢foreachæ ‡ç­¾é‡Œé¢çš„å±æ€§separator"><a href="#xmlé‡Œé¢foreachæ ‡ç­¾é‡Œé¢çš„å±æ€§separator" class="headerlink" title="xmlé‡Œé¢foreachæ ‡ç­¾é‡Œé¢çš„å±æ€§separator"></a>xmlé‡Œé¢foreachæ ‡ç­¾é‡Œé¢çš„å±æ€§separator</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> &lt;if test=&quot;myList != null&quot;&gt;</span><br><span class="line">    AND dm in</span><br><span class="line">    &lt;foreach collection=&quot;myList &quot; item=&quot;item&quot; open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">        #&#123;item , jdbcType=VARCHAR &#125;</span><br><span class="line">    &lt;/foreach&gt;</span><br><span class="line">&lt;/if&gt;</span><br></pre></td></tr></table></figure>
<p>æ¸²æŸ“ä¸ºsqlï¼š<code>AND dm in ( &#39;03&#39; , &#39;04&#39;)</code></p>
<p>å¦‚æœseparatorå±æ€§ä¸ºorï¼Œæ¸²æŸ“ä¸ºï¼š<code>AND ( dm  = &#39;01&#39;or dm   = &#39;02&#39; or dm   = &#39;03&#39;) </code></p>
<h3 id="whereæ ‡ç­¾çš„ä½œç”¨"><a href="#whereæ ‡ç­¾çš„ä½œç”¨" class="headerlink" title="whereæ ‡ç­¾çš„ä½œç”¨"></a>whereæ ‡ç­¾çš„ä½œç”¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;select&quot; resultType=&quot;DO&quot;&gt;</span><br><span class="line"> SELECT * FROM hdc</span><br><span class="line"> WHERE</span><br><span class="line"> &lt;if test=&quot;state != null&quot;&gt;</span><br><span class="line"> state = #&#123;state&#125;</span><br><span class="line"> &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœstateå‚æ•°ä¸ºç©ºæ—¶ï¼Œæœ€ç»ˆç”ŸæˆSQLè¯­å¥ä¸º<br>SELECT * FROM hdc WHERE<br>æ‰§è¡Œä¼šå‡ºé”™ï¼Œå¯ä»¥åœ¨where ååŠ ä¸€ä¸ª1&#x3D;1ï¼Œä½†æ˜¯ç´¯èµ˜</p>
<p>ç”¨<code>&lt;where&gt;...&lt;/where&gt;</code>æ ‡ç­¾å°±å¥½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;selectOne&quot; resultType=&quot;DO&quot;&gt;</span><br><span class="line"> SELECT * FROM hdc</span><br><span class="line"> &lt;where&gt;</span><br><span class="line">  &lt;if test=&quot;state != null&quot;&gt;</span><br><span class="line">    state = #&#123;state&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line"> &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼š<code>&lt;where&gt;</code>æ ‡ç­¾ï¼Œ1ã€åœ¨åé¢if nulléƒ½æ˜¯ç©ºæ—¶ï¼Œå¯ä»¥è‡ªåŠ¨åˆ é™¤whereã€‚2ã€åœ¨åé¢å¤šä¸ªif nullï¼Œç¬¬ä¸€ä¸ªä¸ºnullæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ æ‰åé¢æœ‰çš„andã€‚</p>
<h3 id="trimå®ç°åŠ¨æ€sql"><a href="#trimå®ç°åŠ¨æ€sql" class="headerlink" title="trimå®ç°åŠ¨æ€sql"></a>trimå®ç°åŠ¨æ€sql</h3><p>åœºæ™¯ï¼šæƒ³ä½¿ç”¨havingï¼Œhavingåé¢ç”¨if nullæ ‡ç­¾ï¼Œå¦‚æœåé¢çš„if nulléƒ½æ˜¯nullï¼Œhavingä¼šç•™ç€ï¼Œå¯¼è‡´å‡ºé”™ã€‚</p>
<p>trim åœ¨è‹±è¯­ä¸­æœ‰â€œç‚¹ç¼€ç‰©â€ï¼Œä¿®å‰ªçš„æ„æ€ã€‚å¯ä»¥æŠŠâ€˜â€™æ ‡ç­¾ä¸ºä¸€ä¸ªè£…é¥°sqlçš„æ ‡ç­¾ã€‚trimæ ‡ç­¾å¸¸ç”¨äºåŠ¨æ€ç”Ÿæˆsqlçš„åœºæ™¯ä¸‹ã€‚</p>
<p>åŸºæœ¬æ ¼å¼ï¼š<br><code>&lt;trim prefix=&quot;&quot; suffix=&quot;&quot; suffixOverrides=&quot;&quot; prefixOverrides=&quot;&quot;&gt;&lt;/trim&gt;</code><br>prefixï¼š<br>è¡¨ç¤ºåœ¨trimåŒ…è£¹çš„SQLè¯­å¥å‰é¢æ·»åŠ çš„æŒ‡å®šå†…å®¹ã€‚<br>suffixï¼š<br>è¡¨ç¤ºåœ¨trimåŒ…è£¹çš„SQLæœ«å°¾æ·»åŠ æŒ‡å®šå†…å®¹<br>prefixOverridesï¼š<br>è¡¨ç¤ºå»æ‰ï¼ˆè¦†ç›–ï¼‰trimåŒ…è£¹çš„SQLçš„æŒ‡å®šé¦–éƒ¨å†…å®¹<br>suffixOverridesï¼š<br>è¡¨ç¤ºå»æ‰ï¼ˆè¦†ç›–ï¼‰trimåŒ…è£¹çš„SQLçš„æŒ‡å®šå°¾éƒ¨å†…å®¹</p>
<p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/425922768">https://zhuanlan.zhihu.com/p/425922768</a></p>
<p>ä¾‹å­(æŸ¥è¾“å…¥çš„listçš„å…ƒç´ æ˜¯ä¸æ˜¯åœ¨æŸ¥å¤„çš„ä¸€ä¸ªlistå­—æ®µé‡Œæœ‰)ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">group by id</span><br><span class="line">&lt;trim prefix=&quot;having&quot; prefixOverrides=&quot;and&quot;&gt;</span><br><span class="line">    &lt;if test=&quot;nameList != null and nameList.size() &gt; 0&quot;&gt;</span><br><span class="line">        &lt;foreach collection=&quot;nameList&quot; open=&quot;(&quot; close=&quot;)&quot; item=&quot;name&quot; index=&quot;index&quot; separator=&quot;or&quot;&gt;</span><br><span class="line">            find_in_set(#&#123;name&#125;, names) &gt; 0</span><br><span class="line">        &lt;/foreach&gt;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line"></span><br><span class="line">    &lt;if test=&quot;nameList != null and nameList.size() &gt; 0&quot;&gt;</span><br><span class="line">        and</span><br><span class="line">        &lt;foreach collection=&quot;nameList&quot; open=&quot;(&quot; close=&quot;)&quot; item=&quot;name&quot; index=&quot;index&quot; separator=&quot;or&quot;&gt;</span><br><span class="line">            find_in_set(#&#123;name&#125;, names) &gt; 0</span><br><span class="line">        &lt;/foreach&gt;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/trim&gt;</span><br></pre></td></tr></table></figure>


<h3 id="æ¡ä»¶æ„é€ å™¨QueryWrapper"><a href="#æ¡ä»¶æ„é€ å™¨QueryWrapper" class="headerlink" title="æ¡ä»¶æ„é€ å™¨QueryWrapper"></a>æ¡ä»¶æ„é€ å™¨QueryWrapper</h3><p>QueryWrapperæ˜¯åœ¨ä½¿ç”¨Mybatis-plusä¸­ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ï¼Œä¹Ÿå«ä½œæ„é€ å™¨ï¼Œèƒ½ç®€åŒ–sqlçš„æ“ä½œã€‚MyBatisPlus ä¾èµ–ï¼šmybatis-plus-boot-starter</p>
<p>é¦–å…ˆï¼ŒMapperæ¥å£éœ€è¦ç»§æ‰¿<code>BaseMapper&lt;T&gt;</code>æŠ½è±¡ç±»ï¼ŒåŠ @Mapperæ³¨è§£ã€‚</p>
<p>LambdaQueryWrapperå’ŒQueryWrapperæŸ¥è¯¢æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä½¿ç”¨Lambdaè¯­æ³•æ›´åŠ æ–¹ä¾¿ï¼Œæ›´å®¹æ˜“ç†è§£ã€‚</p>
<p>LambdaQueryWrapperå’ŒQueryWrapperçš„åŒºåˆ«ï¼š<br>é¦–å…ˆå®ƒä»¬éƒ½æ˜¯Mybatis-plusæä¾›çš„æŸ¥è¯¢æ„é€ å™¨ï¼Œç”¨äºæ„å»ºæŸ¥è¯¢æ¡ä»¶ã€‚<br>1ã€LambdaQueryWrapperæ”¯æŒLambdaè¡¨è¾¾å¼ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œè€ŒQuerryWrapperä¸æ”¯æŒã€‚<br>2ã€LambdaQueryWrapperå¯ä»¥é¿å…æ‰‹å†™é”™è¯¯çš„å­—æ®µåï¼Œå› ä¸ºå®ƒä¼šåœ¨ç¼–è¯‘æœŸé—´è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚è€ŒQueryWrapperåªèƒ½åœ¨è¿è¡Œæ—¶æ‰å‘ç°é”™è¯¯ã€‚<br>3ã€LambdaQueryWrapperå¯ä»¥é“¾å¼è°ƒç”¨ï¼Œæ›´åŠ ä¼˜é›…ç®€æ´ã€‚è€ŒQueryWrapperéœ€è¦æ¯æ¬¡é‡æ–°åˆ›å»ºä¸€ä¸ªå®ä¾‹æ¥æ·»åŠ æ–°çš„æŸ¥è¯¢æ¡ä»¶ã€‚</p>
<p>ç”¨æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@GetMapping(&quot;/list&quot;)</span><br><span class="line">public List&lt;Student&gt; list(Student student)&#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Student&gt; lqw = new LambdaQueryWrapper&lt;Student&gt;();</span><br><span class="line">    lqw.eq(Student::getName, student.getName()); </span><br><span class="line">    //ä¹Ÿå¯ä»¥ï¼šlqw.eq(&quot;name&quot;, student.getName());</span><br><span class="line">    lqw.like(Student::getClass,student.getClass());</span><br><span class="line">    lqw.between(&quot;age&quot;,student.getAge1(),student.getAge2());</span><br><span class="line">    lqw.orderByAsc(&quot;age&quot;);</span><br><span class="line">    List&lt;Student&gt; list = studentDao.list(lqw);</span><br><span class="line">    return list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å¯¹åº”sqlï¼š<code>select * from student where name = &#39;?&#39; and class like &#39;%?%&#39; and age between &#39;?&#39; and &#39;?&#39; order by &#39;?&#39; asc</code></p>
<p>QueryWrapperå…¶å®å¯ä»¥ç†è§£æˆä¸€ä¸ªæ”¾æŸ¥è¯¢æ¡ä»¶çš„ç›’å­ï¼Œæˆ‘ä»¬æŠŠæŸ¥è¯¢æ¡ä»¶æ”¾åœ¨é‡Œé¢ï¼Œä»–å°±ä¼šè‡ªåŠ¨æŒ‰ç…§å¯¹åº”çš„æ¡ä»¶è¿›è¡ŒæŸ¥è¯¢æ•°æ®ã€‚</p>
<p>æ ¹æ®ä¸åŒçš„æŸ¥è¯¢è¦æ±‚ï¼Œæœ‰ä¸åŒçš„ç”¨æ³•ï¼Œå¸¸ç”¨åˆ°çš„æ¯”å¦‚ï¼šeqï¼ˆç›¸ç­‰ï¼‰ã€likeã€andã€orã€isNullã€isNotNullã€neï¼ˆä¸ç›¸ç­‰ï¼‰ã€likeRightã€betweenã€gtï¼ˆå¤§äºï¼‰ã€ltï¼ˆå°äºï¼‰ç­‰</p>
<hr>
<p>ä½¿ç”¨QueryWrapperæ¥æ›´æ–°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">QueryWrapper&lt;user&gt; qw = new QueryWrapper&lt;&gt;();</span><br><span class="line">qw.eq(&quot;id&quot;, 1);</span><br><span class="line">User user = new User();</span><br><span class="line">user.setName(&quot;liu&quot;);</span><br><span class="line">int rows = userMapper.update(user, qw);</span><br></pre></td></tr></table></figure>


<h3 id="ä½¿ç”¨Mapæ¥æ”¶mybatisç»“æœ"><a href="#ä½¿ç”¨Mapæ¥æ”¶mybatisç»“æœ" class="headerlink" title="ä½¿ç”¨Mapæ¥æ”¶mybatisç»“æœ"></a>ä½¿ç”¨Mapæ¥æ”¶mybatisç»“æœ</h3><p>ResultSetæ˜¯ä¸€ä¸ªè¡¨ç¤ºæ•°æ®åº“ç»“æœé›†çš„æ¥å£ï¼Œåœ¨javaä¸­ç”¨äºè¡¨ç¤ºä»æ•°æ®åº“æŸ¥è¯¢çš„ç»“æœï¼Œå…è®¸é€šè¿‡è¡Œå’Œåˆ—çš„æ–¹å¼è®¿é—®æ•°æ®ï¼Œä»è€Œä»æ•°æ®åº“ä¸­æ£€ç´¢å’Œæ“ä½œæ•°æ®ã€‚</p>
<p>ä½†æ˜¯Mybatisä¸æ”¯æŒç›´æ¥ç”¨ResultSetæ¥æ”¶æŸ¥è¯¢ç»“æœã€‚å› ä¸ºMybatisé‡‡ç”¨çš„æ˜¯ç‰©ç†æ˜ å°„æŠ€æœ¯ï¼Œè€ŒResultSetåªèƒ½è·å–è¡Œåˆ—æ•°æ®ï¼Œå¾—ä¸åˆ°ç‰©ç†æ˜ å°„çš„ç»“æœã€‚</p>
<p>é‚£ä¹ˆé™¤äº†å®šä¹‰DOï¼Œè¿˜å¯ä»¥ç”¨ä»€ä¹ˆæ¥æ”¶mybatisè¿”å›çš„æ•°æ®å‘¢ï¼Ÿ ç”¨Mapã€‚</p>
<p>daoæ¥å£æ€ä¹ˆå†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@MapKey(&quot;æŸå­—æ®µå&quot;)</span><br><span class="line">Map&lt;String, Object&gt; selectAll();</span><br></pre></td></tr></table></figure>

<p>xmlæ€ä¹ˆå†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;select id=&quot;select&quot; resultType=&quot;java.util.Map&quot;&gt;</span><br><span class="line"> SELECT * FROM hdc</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>@MapKey æ˜¯MyBatisæ¡†æ¶çš„æ³¨è§£ï¼Œä½œç”¨æ˜¯å°†Listç»“æœé›†è½¬æ¢æˆkey-valueå½¢å¼çš„Mapç»“æœé›†ï¼Œæ–¹ä¾¿å¿«é€Ÿä»ç»“æœé›†ä¸­æŸ¥è¯¢æŒ‡å®šç»“æœã€‚</p>
<p>@MapKey(value&#x3D;â€â€) æ˜¯mybatisçš„æ³¨è§£ï¼Œç”¨æ¥æ˜ å°„Mapç±»å‹çš„è”åˆæŸ¥è¯¢ç»“æœã€‚ä½œç”¨æ˜¯æŒ‡å®šä»æŸ¥è¯¢ç»“æœçš„æŸä¸ªå­—æ®µæ˜ å°„åˆ°Mapçš„Keyï¼Œè¿™ä¸ªæ³¨è§£æ˜¯å¿…é¡»çš„ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ªå­—æ®µä¸ºkeyã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class UserMapper()&#123;</span><br><span class="line"> </span><br><span class="line">    //ä½¿ç”¨listæ¥æ”¶</span><br><span class="line">    //[&#123;id:1111,name:&quot;foo&quot;&#125;,&#123;id:2222,name:&quot;bar&quot;&#125;]</span><br><span class="line">    public List&lt;User&gt; useList();</span><br><span class="line"> </span><br><span class="line">    //ä½¿ç”¨å¸¦æœ‰@Mapkey(&quot;id&quot;)çš„Map&lt;Integer,User&gt;æ¥æ”¶</span><br><span class="line">    //&#123;1111:&#123;id:1111,name:&quot;foo&quot;&#125;,2222:&#123;id:2222,name:&quot;bar&quot;&#125;&#125;</span><br><span class="line">    @Mapkey(&quot;id&quot;)</span><br><span class="line">    public Map&lt;Integer,User&gt; useMap();</span><br><span class="line"></span><br><span class="line">    //ä¸æƒ³å®šä¹‰DOï¼Œç›´æ¥ç”¨List&lt;Map&lt;String, Object&gt;&gt;æ¥æ”¶</span><br><span class="line">    //è¿”å›çš„ç»“æœMapæ˜¯å­—æ®µåï¼šå€¼ï¼Œè·Ÿ@MapKeyé‡Œçš„valueæ²¡å•¥å…³ç³»</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¸èƒ½ç”¨<code>List&lt;Object&gt;</code>æ¥ç»“æœã€‚<br>å¦‚æœ@MapKeyä¸­çš„valueæ˜¯nullï¼Œä¼šå±•ç¤ºä¸€ä¸ªkeyä¸ºnullçš„mapã€‚</p>
<hr>
<p>MyBatisä¸­çš„åŠ¨æ€SQLä»¥åŠ@ResultMap,@MapKeyå’Œ@Optionsçš„ä½¿ç”¨ï¼š<br><a href="https://www.freesion.com/article/2930425356/">https://www.freesion.com/article/2930425356/</a></p>
<h3 id="ResultHandler"><a href="#ResultHandler" class="headerlink" title="ResultHandler"></a>ResultHandler</h3><p>ResultHandlerï¼Œé¡¾åæ€ä¹‰ï¼Œå¯¹è¿”å›çš„ç»“æœè¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆå¾—åˆ°è‡ªå·±æƒ³è¦çš„æ•°æ®æ ¼å¼æˆ–ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥è‡ªå®šä¹‰è¿”å›ç±»å‹ã€‚å¯ä»¥è¿­ä»£æŸ¥è¯¢ç»“æœé›†ï¼Œå°†å…¶å­˜å‚¨åœ¨é›†åˆä¸­ï¼Œæˆ–æ‰§è¡Œè‡ªå®šä¹‰å¤„ç†ã€‚å®ƒæ˜¯mybatisçš„ä¸€ä¸ªæ¥å£ï¼Œç”¨æ¥å¤„ç†ç»“æœé›†ï¼Œä»è€Œè·å–ç‰¹å®šçš„æ•°æ®æˆ–è€…æ“ä½œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface ResultHandler&lt;T&gt; &#123;</span><br><span class="line">    void handleResult(ResultContext&lt;? extends T&gt; var1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Mapperæ¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface GoodsDao &#123;</span><br><span class="line">    public void selectGoods(ResultHandler resultHandler); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜ å°„æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;   </span><br><span class="line">&lt;!DOCTYPE mapper   </span><br><span class="line">PUBLIC &quot;-//ibatis.apache.org//DTD Mapper 3.0//EN&quot;  </span><br><span class="line">&quot;http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.yht.mybatisTest.dao.GoodsDao&quot;&gt;</span><br><span class="line">   </span><br><span class="line">    &lt;select id=&quot;selectGoods&quot; resultType=&quot;map&quot;&gt;  </span><br><span class="line">        select price,name from goods</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">                                                        </span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p>selectGoodsæ–¹æ³•çš„æŸ¥è¯¢ç»“æœæ˜¯<code>List&lt;Map&gt;</code>ï¼Œå‡å¦‚ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼šæƒ³ç»Ÿè®¡ä»·æ ¼ä½äº50çš„ä¹¦ç±æœ‰å“ªäº›ï¼Œä»·æ ¼é«˜äº50çš„ä¹¦ç±æœ‰å“ªäº›ï¼Œè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±ç”¨åˆ°äº†ResultHandlerï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªSelectGoodsResultHandlerã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SelectGoodsResultHandler implements ResultHandler&#123;</span><br><span class="line"></span><br><span class="line">    private Map&lt;String, List&lt;String&gt;&gt; resultMap = new HashMap&lt;String, List&lt;String&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public void handleResult(ResultContext context) &#123;</span><br><span class="line">        if(resultMap.get(&quot;lowPrice&quot;) == null &amp;&amp; resultMap.get(&quot;highPrice&quot;) == null)&#123;</span><br><span class="line">            List&lt;String&gt; lowList = new ArrayList&lt;String&gt;();</span><br><span class="line">            List&lt;String&gt; highList = new ArrayList&lt;String&gt;();</span><br><span class="line">            resultMap.put(&quot;lowPrice&quot;, lowList);</span><br><span class="line">            resultMap.put(&quot;highPrice&quot;, highList);</span><br><span class="line">        &#125;</span><br><span class="line">        @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">        Map&lt;String,Object&gt; resultObject = (Map&lt;String, Object&gt;)context.getResultObject();</span><br><span class="line">        BigDecimal price = (BigDecimal) resultObject.get(&quot;price&quot;);</span><br><span class="line">        String name = (String) resultObject.get(&quot;name&quot;);</span><br><span class="line">        if(price.intValue() &lt; 50)&#123;</span><br><span class="line">            ((List&lt;String&gt;)resultMap.get(&quot;lowPrice&quot;)).add(name);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            ((List&lt;String&gt;)resultMap.get(&quot;highPrice&quot;)).add(name);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public Map&lt;String, List&lt;String&gt;&gt; getResults()&#123;</span><br><span class="line">        return resultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class GoodsDaoTest &#123;</span><br><span class="line">    </span><br><span class="line">    private static SqlSessionFactory sqlSessionFactory = null;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void selectGoodsTest()&#123;</span><br><span class="line">        </span><br><span class="line">        SqlSession sqlSession = getSqlSessionFactory().openSession(true);</span><br><span class="line">        GoodsDao goodsMapper = sqlSession.getMapper(GoodsDao.class);</span><br><span class="line">        SelectGoodsResultHandler resultHandler = new SelectGoodsResultHandler();</span><br><span class="line">        goodsMapper.selectGoods(resultHandler);</span><br><span class="line">        System.out.println(resultHandler.getResults().toString());;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public static SqlSessionFactory getSqlSessionFactory() &#123;</span><br><span class="line">        String resource = &quot;spring-ibatis.xml&quot;;</span><br><span class="line">        if(sqlSessionFactory == null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                sqlSessionFactory = new SqlSessionFactoryBuilder().build(Resources</span><br><span class="line">                        .getResourceAsReader(resource));</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                // TODO Auto-generated catch block</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/51life/p/9633002.html">https://www.cnblogs.com/51life/p/9633002.html</a></p>
<p>mybatisä¹‹ResultHandlerå¦‚ä½•ä½¿ç”¨ï¼š<br><a href="https://www.jianshu.com/p/8773d0e786d8">https://www.jianshu.com/p/8773d0e786d8</a></p>
<h3 id="mybatisä¼ è¡¨å"><a href="#mybatisä¼ è¡¨å" class="headerlink" title="mybatisä¼ è¡¨å"></a>mybatisä¼ è¡¨å</h3><p>mybatis æ€ä¹ˆä¼ å…¥è¡¨åæ¥æ§åˆ¶æ’å…¥å“ªä¸ªè¡¨ï¼Ÿ<br>åœ¨ MyBatis ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ¨æ€ SQL çš„æ–¹å¼æ¥ä¼ å…¥è¡¨åï¼Œä»è€Œæ§åˆ¶æ’å…¥å“ªä¸ªè¡¨ã€‚</p>
<p>è²ä½“æ“ä½œå¦‚ä¸‹ï¼š<br>1.åœ¨Mapperxml æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ parameterType æŒ‡å®šä¸€ä¸ªå‚æ•°ç±»å‹ä¸º stringï¼Œç”¨äºæ¥æ”¶è¦æ’å…¥çš„è¡¨åã€‚</p>
<p>2.åœ¨æ’å…¥è¯­å¥ä¸­ï¼Œä½¿ç”¨ ï¼„{} æ“ä½œå¾…å°†è¯¥å‚æ•°ä¼ é€’åˆ° SQLä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void insertIntoTable(@Param(&quot;tableName&quot;) String tableName, ...)</span><br><span class="line"></span><br><span class="line">&lt;insert id=&quot;insertIntoTable&quot;&gt;</span><br><span class="line">    INSERT INTO $&#123;tableName&#125; (column, column2) VALUES (#&#123;value1&#125;, #&#123;value2&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé™¤äº†è¡¨åå‚æ•°ï¼Œå¦ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡ï¼Œåœ¨xmlæ–‡ä»¶ä¸­åŠ å¯¹è±¡å.å­—æ®µåæ¥è°ƒç”¨ã€‚</p>
<p>3.åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œä¼ é€’è¦æ’å…¥çš„è¡¨åå³å¯ã€‚<br>String tableName &#x3D; user;<br>mapper.insertIntoTable (tableName, value1, value2);<br>æ³¨æ„ï¼šä½¿ç”¨ï¼„{}æ“ä½œç¬¦ä¼ é€’å‚æ•°ï¼Œéœ€è¦æ³¨æ„ SQL æ³¨å…¥çš„é—®é¢˜ï¼Œå› æ­¤éœ€è¦è¿›è¡Œå¿…è¦çš„å®‰å…¨æªæ–½ï¼Œå¦‚è¾“å…¥å‚æ•°çš„å‚æ•°æ ¡éªŒç­‰ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>logæ—¥å¿—ä¸mavenæ‰“åŒ…</title>
    <url>/2022/04/03/myblog/java/log%E6%97%A5%E5%BF%97%E4%B8%8Emaven%E6%89%93%E5%8C%85/</url>
    <content><![CDATA[<p>å·¥ä½œä¸­éœ€è¦å°†åº”ç”¨éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œæƒ³æ¥ä¹‹å‰ç”¨goçš„æ—¶å€™è²Œä¼¼æ˜¯ç›´æ¥ç¼–è¯‘è¿è¡Œå°±åœ¨æœ¬åœ°éƒ¨ç½²äº†ï¼Œä½†æ˜¯javaéœ€è¦ç”¨åˆ°mavenæ‰“åŒ…ï¼Œè¿˜æ²¡æ‰“åŒ…è¿‡ï¼Œå­¦ä¹ ä¸€ä¸‹ã€‚é¡ºä¾¿å·¥ä½œä¸­æŸ¥çœ‹æ—¥å¿—å¯¹log4jã€sjf4jã€logbackã€lombackè¿™å‡ ä¸ªä¸œè¥¿æœ‰ç‚¹è¿·ç³Šï¼Œæ‰€ä»¥å…ˆå­¦ä¸€ä¸‹æ—¥å¿—ç›¸å…³çš„ï¼Œç„¶åå»ºå·¥ç¨‹æ‰“åŒ…éƒ¨ç½²åœ¨æœ¬åœ°çœ‹ä¸‹æ•ˆæœã€‚</p>
<h3 id="1-lombok"><a href="#1-lombok" class="headerlink" title="1.lombok"></a>1.lombok</h3><p>è‡ªç„¶ä¸å¿…å¤šè¯´ï¼Œlombokå¯ä»¥é€šè¿‡ç®€å•çš„æ³¨è§£çš„å½¢å¼æ¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–å’Œæ¶ˆé™¤ä¸€äº›å¿…é¡»æœ‰ä½†æ˜¾å¾—å¾ˆè‡ƒè‚¿çš„Javaä»£ç ï¼Œæ¯”å¦‚å¸¸è§çš„Getter&amp;Setterã€toString()ã€æ„é€ å‡½æ•°ç­‰ç­‰ã€‚lombokä¸ä»…æ–¹ä¾¿ç¼–å†™ï¼ŒåŒæ—¶ä¹Ÿè®©æˆ‘ä»¬çš„ä»£ç æ›´ç®€æ´ã€‚</p>
<p>lombokæä¾›äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„jaråŒ…ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸æˆ‘ä»¬çš„é¡¹ç›®è¿›è¡Œé›†æˆã€‚</p>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>ç¬¬ä¸€æ­¥ï¼šåŠ å…¥lombokä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>scop&#x3D;providedï¼Œè¡¨ç¤ºå®ƒåªåœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæ•ˆï¼Œä¸éœ€è¦æ‰“å…¥åŒ…ä¸­ï¼Œlombokåœ¨ç¼–è¯‘æœŸå°†å¸¦lombokæ³¨è§£çš„javaæ–‡ä»¶æ­£ç¡®ç¼–è¯‘ä¸ºå®Œæ•´çš„classæ–‡ä»¶ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šideaä¸­æ·»åŠ lombokæ’ä»¶</p>
<p>å¦åˆ™ä¼šæŠ¥ç¼ºå°‘æ–¹æ³•å’Œæ²¡æœ‰è®¾ç½®å±æ€§çš„å¼‚å¸¸ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®å¯ç”¨æ³¨é‡Šå¤„ç†</p>
<p>è®¾ç½®ä¸­ Annotation processorsï¼Œenable annotation processingã€‚</p>
<h4 id="lombokåŸç†"><a href="#lombokåŸç†" class="headerlink" title="lombokåŸç†"></a>lombokåŸç†</h4><ol>
<li>javacå¯¹æºä»£ç è¿›è¡Œåˆ†æï¼Œç”Ÿæˆäº†ä¸€æ£µæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰</li>
<li>ç¼–è¯‘è¿‡ç¨‹ä¸­è°ƒç”¨å®ç°äº†â€œJSR 269 APIâ€çš„Lombokç¨‹åº</li>
<li>æ­¤æ—¶Lombokå°±å¯¹ç¬¬ä¸€æ­¥éª¤å¾—åˆ°çš„ASTè¿›è¡Œå¤„ç†ï¼Œæ‰¾åˆ°@Dataæ³¨è§£æ‰€åœ¨ç±»å¯¹åº”çš„è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œç„¶åä¿®æ”¹è¯¥è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œå¢åŠ getterå’Œsetteræ–¹æ³•å®šä¹‰çš„ç›¸åº”æ ‘èŠ‚ç‚¹</li>
<li>javacä½¿ç”¨ä¿®æ”¹åçš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ï¼Œå³ç»™classå¢åŠ æ–°çš„èŠ‚ç‚¹ï¼ˆä»£ç å—ï¼‰</li>
</ol>
<h3 id="2-SLF4J"><a href="#2-SLF4J" class="headerlink" title="2.SLF4J"></a>2.SLF4J</h3><h4 id="æ¥å£ä¸åŒ…å…³ç³»"><a href="#æ¥å£ä¸åŒ…å…³ç³»" class="headerlink" title="æ¥å£ä¸åŒ…å…³ç³»"></a>æ¥å£ä¸åŒ…å…³ç³»</h4><p>Simple logging Facade for Javaï¼Œæ„æ€ä¸ºç®€å•æ—¥å¿—é—¨é¢ï¼Œå®ƒæ˜¯æŠŠä¸åŒçš„æ—¥å¿—ç³»ç»Ÿçš„å®ç°è¿›è¡Œäº†å…·ä½“çš„æŠ½è±¡åŒ–ï¼Œåªæä¾›äº†ç»Ÿä¸€çš„æ—¥å¿—ä½¿ç”¨æ¥å£ï¼Œä½¿ç”¨æ—¶åªéœ€è¦æŒ‰ç…§å…¶æä¾›çš„æ¥å£æ–¹æ³•è¿›è¡Œè°ƒç”¨å³å¯ï¼Œç”±äº<strong>å®ƒåªæ˜¯ä¸€ä¸ªæ¥å£</strong>ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„å¯ä»¥ç›´æ¥å•ç‹¬ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ï¼Œæ‰€ä»¥æœ€ç»ˆæ—¥å¿—çš„æ ¼å¼ã€è®°å½•çº§åˆ«ã€è¾“å‡ºæ–¹å¼ç­‰éƒ½è¦<strong>é€šè¿‡æ¥å£ç»‘å®šçš„å…·ä½“çš„æ—¥å¿—ç³»ç»Ÿæ¥å®ç°</strong>ï¼Œè¿™äº›å…·ä½“çš„æ—¥å¿—ç³»ç»Ÿå°±æœ‰log4jã€logbackã€java.util.loggingç­‰ï¼Œå®ƒä»¬æ‰å®ç°äº†å…·ä½“çš„æ—¥å¿—ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p>
<p>SLF4Jåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®é™…ä½¿ç”¨æ—¶å¿…é¡»è¦ç»“åˆå…·ä½“çš„æ—¥å¿—ç³»ç»Ÿæ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹SLF4Jå’Œå„ä¸ªå…·ä½“çš„æ—¥å¿—ç³»ç»Ÿè¿›è¡Œç»‘å®šæ—¶çš„æ¡†æ¶åŸç†å›¾ï¼š</p>
<p><img src="/images/logback.png"></p>
<p>slf4jåŸç†å¾ˆç®€å•ï¼Œä»–åªæä¾›ä¸€ä¸ªæ ¸å¿ƒslf4j api(å°±æ˜¯slf4j-api.jaråŒ…)ï¼Œè¿™ä¸ªåŒ…åªæœ‰æ—¥å¿—çš„æ¥å£ï¼Œå¹¶æ²¡æœ‰å®ç°ï¼Œæ‰€ä»¥å¦‚æœè¦ä½¿ç”¨å°±å¾—<strong>å†ç»™å®ƒæä¾›ä¸€ä¸ªå®ç°äº†äº›æ¥å£çš„æ—¥å¿—åŒ…</strong>ï¼Œæ¯” å¦‚ï¼šlog4jã€common loggingã€jdk logæ—¥å¿—å®ç°åŒ…ç­‰ï¼Œä½†æ˜¯<strong>è¿™äº›æ—¥å¿—å®ç°åˆä¸èƒ½é€šè¿‡æ¥å£ç›´æ¥è°ƒç”¨</strong>ï¼Œå®ç°ä¸Šä»–ä»¬æ ¹æœ¬å°±å’Œslf4j-apiä¸ä¸€è‡´ï¼Œå› æ­¤slf4jåˆå¢åŠ äº†ä¸€å±‚æ¥<strong>è½¬æ¢å„æ—¥å¿—å®ç°åŒ…çš„ä½¿ç”¨</strong>ï¼Œå½“ç„¶slf4j-simpleé™¤å¤–ã€‚å…¶ç»“æ„å¦‚ä¸‹ï¼š </p>
<blockquote>
<p>slf4j-api(æ¥å£å±‚)<br> | |<br>å„æ—¥å¿—å®ç°åŒ…çš„è¿æ¥å±‚( slf4j-jdk14, slf4j-log4j)<br> | |<br>å„æ—¥å¿—å®ç°åŒ… 	</p>
</blockquote>
<p><strong>æ‰€ä»¥ï¼Œç»“åˆå„æ—¥å¿—å®ç°åŒ…ä½¿ç”¨æ—¶æä¾›çš„jaråŒ…æƒ…å†µä¸ºï¼š</strong></p>
<p>SLF4Jå’Œlogbackç»“åˆä½¿ç”¨æ—¶éœ€è¦æä¾›çš„jarï¼šslf4j-api.jarã€logback-classic.jarã€logback-core.jar</p>
<p>SLF4Jå’Œlog4jç»“åˆä½¿ç”¨æ—¶éœ€è¦æä¾›çš„jarï¼šslf4j-api.jarã€slf4j-log4j12.jarã€log4j.jar</p>
<p>å’Œlog4j2é…åˆéœ€è¦å¯¼å…¥log4j2çš„<strong>log4j-api.jar</strong>ã€<strong>log4j-core.jar</strong>å’Œæ¡¥æ¥åŒ…<strong>log4j-slf4j-impl.jar</strong>ã€‚</p>
<p>SLF4Jå’ŒJDKä¸­java.util.loggingç»“åˆä½¿ç”¨æ—¶éœ€è¦æä¾›çš„jarï¼šslf4j-api.jarã€slf4j-jdk14.jar</p>
<p>SLF4Jå’Œsimple(SLF4Jæœ¬èº«æä¾›çš„ä¸€ä¸ªæ¥å£çš„ç®€å•å®ç°)ç»“åˆä½¿ç”¨æ—¶éœ€è¦æä¾›çš„jarï¼šslf4j-api.jarã€slf4j-simple.jar</p>
<p>å½“ç„¶è¿˜æœ‰å…¶ä»–çš„æ—¥å¿—å®ç°åŒ…ï¼Œä»¥ä¸Šæ˜¯ç»å¸¸ä¼šä½¿ç”¨åˆ°çš„ä¸€äº›ã€‚</p>
<p>*<strong>æ³¨æ„ï¼Œä»¥ä¸Šslf4jå’Œå„æ—¥å¿—å®ç°åŒ…ç»“åˆä½¿ç”¨æ—¶æœ€å¥½åªä½¿ç”¨ä¸€ç§ç»“åˆï¼Œä¸ç„¶çš„è¯ä¼šæç¤ºé‡å¤ç»‘å®šæ—¥å¿—ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´æ—¥å¿—æ— æ³•è¾“å‡ºã€‚*</strong></p>
<h4 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>*<strong>slf4j-api.jar:å¯¹å¤–æä¾›ç»Ÿä¸€çš„æ—¥å¿—è°ƒç”¨æ¥å£ï¼Œè¯¥æ¥å£å…·ä½“æä¾›çš„è°ƒç”¨æ–¹å¼å’Œæ–¹æ³•ä¸¾ä¾‹è¯´æ˜ï¼š*</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">ã€€ã€€<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Tester.class);  </span><br><span class="line">ã€€ã€€<span class="comment">//é€šè¿‡LoggerFactoryè·å–Loggerå®ä¾‹</span></span><br><span class="line">ã€€ã€€<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//æ¥å£é‡Œçš„ç»Ÿä¸€çš„è°ƒç”¨æ–¹æ³•ï¼Œå„å…·ä½“çš„æ—¥å¿—ç³»ç»Ÿéƒ½æœ‰å®ç°è¿™äº›æ–¹æ³•</span></span><br><span class="line">ã€€ã€€		logger.info(<span class="string">&quot;testlog: &#123;&#125;&quot;</span>, <span class="string">&quot;test&quot;</span>); </span><br><span class="line">       logger.debug(<span class="string">&quot;testlog: &#123;&#125;&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">       logger.error(<span class="string">&quot;testlog: &#123;&#125;&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">       logger.trace(<span class="string">&quot;testlog: &#123;&#125;&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">       logger.warn(<span class="string">&quot;testlog: &#123;&#125;&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">ã€€ã€€&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨Lombokæä¾›çš„@Slf4jæ³¨è§£ï¼Œå¯ä»¥çœå»è·å–Loggerå¯¹è±¡çš„æ­¥éª¤ï¼Œç›´æ¥ä½¿ç”¨log.info()â€¦</p>
<p><strong>å¦‚æœç³»ç»Ÿä¸­ä¹‹å‰å·²ç»ä½¿ç”¨äº†log4jåšæ—¥å¿—è¾“å‡ºï¼Œæƒ³ä½¿ç”¨slf4jä½œä¸ºç»Ÿä¸€çš„æ—¥å¿—è¾“å‡ºï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</strong></p>
<p>å¦‚æœä¹‹å‰ç³»ç»Ÿä¸­æ˜¯å•ç‹¬ä½¿ç”¨log4jåšä¸ºæ—¥å¿—è¾“å‡ºçš„ï¼Œè¿™æ—¶å†æƒ³ä½¿ç”¨slf4jåšä¸ºæ—¥å¿—è¾“å‡ºæ—¶ï¼Œå¦‚æœç³»ç»Ÿä¸­æ—¥å¿—æ¯”è¾ƒå¤šï¼Œæ­¤æ—¶æ›´æ”¹æ—¥å¿—è¾“å‡ºæ–¹æ³•è‚¯å®šæ˜¯ä¸å¤ªç°å®çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨log4j-over-slf4j.jarå°†ä½¿ç”¨log4jæ—¥å¿—æ¡†æ¶è¾“å‡ºçš„æ—¥å¿—è·¯ç”±åˆ°slf4jä¸Šæ¥ç»Ÿä¸€é‡‡ç”¨slf4jæ¥è¾“å‡ºæ—¥å¿—ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ï¼Ÿ</h4><p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨SLF4J?</strong></p>
<ul>
<li>slf4jæ˜¯ä¸€ä¸ª<strong>æ—¥å¿—æ¥å£ï¼Œè‡ªå·±æ²¡æœ‰å…·ä½“å®ç°æ—¥å¿—ç³»ç»Ÿ</strong>ï¼Œåªæä¾›äº†ä¸€ç»„æ ‡å‡†çš„è°ƒç”¨api,è¿™æ ·<strong>å°†è°ƒç”¨å’Œå…·ä½“çš„æ—¥å¿—å®ç°åˆ†ç¦»</strong>ï¼Œ<strong>ä½¿ç”¨slf4jåæœ‰åˆ©äºæ ¹æ®è‡ªå·±å®é™…çš„éœ€æ±‚æ›´æ¢å…·ä½“çš„æ—¥å¿—ç³»ç»Ÿ</strong>ï¼Œæ¯”å¦‚ï¼Œä¹‹å‰ä½¿ç”¨çš„å…·ä½“çš„æ—¥å¿—ç³»ç»Ÿä¸ºlog4jï¼Œæƒ³æ›´æ¢ä¸ºlogbackæ—¶ï¼Œåªéœ€è¦åˆ é™¤log4jç›¸å…³çš„jarï¼Œç„¶ååŠ å…¥logbackç›¸å…³çš„jarå’Œæ—¥å¿—é…ç½®æ–‡ä»¶å³å¯ï¼Œè€Œä¸éœ€è¦æ”¹åŠ¨å…·ä½“çš„æ—¥å¿—è¾“å‡ºæ–¹æ³•ï¼Œè¯•æƒ³å¦‚æœæ²¡æœ‰é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œå½“ä½ çš„ç³»ç»Ÿä¸­æ—¥å¿—è¾“å‡ºæœ‰æˆåƒä¸Šä¸‡æ¡æ—¶ï¼Œä½ è¦æ›´æ¢æ—¥å¿—ç³»ç»Ÿå°†æ˜¯å¤šä¹ˆåºå¤§çš„ä¸€é¡¹å·¥ç¨‹ã€‚å¦‚æœä½ å¼€å‘çš„æ˜¯ä¸€ä¸ªé¢å‘å…¬ä¼—ä½¿ç”¨çš„ç»„ä»¶æˆ–å…¬å…±æœåŠ¡æ¨¡å—ï¼Œé‚£ä¹ˆä¸€å®šè¦ä½¿ç”¨slf4çš„è¿™ç§å½¢å¼ï¼Œè¿™æœ‰åˆ©äºåˆ«äººåœ¨è°ƒç”¨ä½ çš„æ¨¡å—æ—¶ä¿æŒå’Œä»–ç³»ç»Ÿä¸­ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—è¾“å‡ºã€‚</li>
<li><strong>slf4jæ—¥å¿—è¾“å‡ºæ—¶å¯ä»¥ä½¿ç”¨{}å ä½ç¬¦</strong>ï¼Œå¦‚ï¼Œlogger.info(â€œtestlog: {}â€, â€œtestâ€)ï¼Œè€Œå¦‚æœåªä½¿ç”¨log4jåšæ—¥å¿—è¾“å‡ºæ—¶ï¼Œåªèƒ½ä»¥logger.info(â€œtestlog:â€+â€testâ€)è¿™ç§å½¢å¼ï¼Œå‰è€…è¦æ¯”åè€…åœ¨æ€§èƒ½ä¸Šæ›´å¥½ï¼Œåè€…é‡‡ç”¨+è¿æ¥å­—ç¬¦ä¸²æ—¶å°±æ˜¯new ä¸€ä¸ªString å­—ç¬¦ä¸²ï¼Œåœ¨æ€§èƒ½ä¸Šå°±ä¸å¦‚å‰è€…ã€‚</li>
</ul>
<h3 id="3-log4j-log-for-java"><a href="#3-log4j-log-for-java" class="headerlink" title="3.log4j(log for java)"></a>3.<strong>log4j(log for java)</strong></h3><p>Log4jæ˜¯Apacheçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé€šè¿‡ä½¿ç”¨Log4jï¼Œæˆ‘ä»¬å¯ä»¥<strong>æ§åˆ¶æ—¥å¿—ä¿¡æ¯è¾“é€çš„ç›®çš„åœ°</strong>æ˜¯æ§åˆ¶å°ã€æ–‡ä»¶ã€GUIç»„ä»¶ï¼Œç”šè‡³æ˜¯å¥—æ¥å£æœåŠ¡å™¨ã€NTçš„äº‹ä»¶è®°å½•å™¨ã€UNIX Syslogå®ˆæŠ¤è¿›ç¨‹ç­‰ï¼›æˆ‘ä»¬ä¹Ÿå¯ä»¥<strong>æ§åˆ¶æ¯ä¸€æ¡æ—¥å¿—çš„è¾“å‡ºæ ¼å¼</strong>ï¼›é€šè¿‡å®šä¹‰æ¯ä¸€æ¡æ—¥å¿—ä¿¡æ¯çš„çº§åˆ«ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´åŠ ç»†è‡´åœ°æ§åˆ¶æ—¥å¿—çš„ç”Ÿæˆè¿‡ç¨‹ã€‚æœ€ä»¤äººæ„Ÿå…´è¶£çš„å°±æ˜¯ï¼Œè¿™äº›å¯ä»¥<strong>é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥çµæ´»åœ°è¿›è¡Œé…ç½®</strong>ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åº”ç”¨çš„ä»£ç ã€‚</p>
<p><strong>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</strong></p>
<ul>
<li>å¼•å…¥jar,ä½¿ç”¨log4jæ—¶éœ€è¦çš„jarä¸ºï¼šlog4j.jarã€‚</li>
<li>å®šä¹‰é…ç½®æ–‡ä»¶log4j.propertiesæˆ–log4j.xml</li>
<li>åœ¨å…·ä½“çš„ç±»ä¸­è¿›è¡Œä½¿ç”¨ï¼š<ul>
<li>åœ¨éœ€è¦æ—¥å¿—è¾“å‡ºçš„ç±»ä¸­åŠ å…¥ï¼šprivate static final Logger logger &#x3D; Logger.getLogger(Tester.class);  &#x2F;&#x2F;é€šè¿‡Loggerè·å–Loggerå®ä¾‹</li>
<li>åœ¨éœ€è¦è¾“å‡ºæ—¥å¿—çš„åœ°æ–¹è°ƒç”¨ç›¸åº”æ–¹æ³•å³å¯ï¼šlogger.debug(â€œSystem â€¦..â€)</li>
</ul>
</li>
</ul>
<h3 id="4-logback"><a href="#4-logback" class="headerlink" title="4.logback"></a>4.logback</h3><p>logbackåŒæ ·æ˜¯ç”±log4jçš„ä½œè€…è®¾è®¡å®Œæˆçš„ï¼Œæ‹¥æœ‰æ›´å¥½çš„ç‰¹æ€§ï¼Œç”¨æ¥å–ä»£log4jçš„ä¸€ä¸ªæ—¥å¿—æ¡†æ¶ï¼Œæ˜¯slf4jçš„åŸç”Ÿå®ç°(å³ç›´æ¥å®ç°äº†slf4jçš„æ¥å£ï¼Œè€Œlog4jå¹¶æ²¡æœ‰ç›´æ¥å®ç°ï¼Œæ‰€ä»¥å°±éœ€è¦ä¸€ä¸ªé€‚é…å™¨slf4j-log4j12.jar)ï¼Œlogbackä¸€å…±æœ‰ä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼š</p>
<ul>
<li>logback-coreï¼šå…¶å®ƒä¸¤ä¸ªæ¨¡å—çš„åŸºç¡€æ¨¡å—</li>
<li>logback-classicï¼šå®ƒæ˜¯log4jçš„ä¸€ä¸ªæ”¹è‰¯ç‰ˆæœ¬ï¼ŒåŒæ—¶å®ƒå®Œæ•´å®ç°äº†slf4j APIä½¿ä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›´æ¢æˆå…¶å®ƒæ—¥å¿—ç³»ç»Ÿå¦‚log4jæˆ–JDK14 Logging</li>
<li>logback-accessï¼šè®¿é—®æ¨¡å—ä¸Servletå®¹å™¨é›†æˆæä¾›é€šè¿‡Httpæ¥è®¿é—®æ—¥å¿—çš„åŠŸèƒ½</li>
</ul>
<p>åŒæ ·ï¼Œå•ç‹¬ä½¿ç”¨å®ƒæ—¶ï¼Œéœ€è¦å¼•å…¥ä»¥ä¸Šjarï¼Œç„¶åè¿›è¡Œé…ç½®æ–‡ä»¶çš„é…ç½®ï¼Œæœ€åå°±æ˜¯åœ¨ç›¸å…³ç±»ä¸­è¿›è¡Œä½¿ç”¨ï¼Œä½¿ç”¨æ—¶åŠ å…¥ä»¥ä¸‹è¯­å¥:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ã€€ã€€<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Test.class);</span><br><span class="line"> ã€€logger.info(<span class="string">&quot;æ‰“å°æ—¥å¿—&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦æ”¹ä»£ç çš„æ—¥å¿—çº§åˆ«ï¼šæ”¹logback-spring.xmlé‡Œçš„<code>&lt;root level=&quot;INFO&quot;&gt;</code></p>
<h3 id="5-logå‘å±•å²"><a href="#5-logå‘å±•å²" class="headerlink" title="5.logå‘å±•å²"></a>5.logå‘å±•å²</h3><p>ä»JDK1.4å¼€å§‹æä¾›java.until.loggingæ—¥å¿—æ¡†æ¶æ¥æ‰“å°æ—¥å¿—ï¼Œä½†æ˜¯å¤§ä½¬è§‰å¾—JULå¤ªéš¾ç”¨äº†ï¼Œå°±è‡ªå·±æ‰‹æ’¸äº†ä¸ªlog4jï¼Œåæ¥log4jå‘ç°å®‰å…¨æ¼æ´ï¼ŒåŠ ä¸Šä»£ç ç»“æ„é—®é¢˜éš¾ä»¥ç»´æŠ¤ï¼Œäºæ˜¯ä»1.2å°±åœæ­¢æ›´æ–°log4jï¼Œå¹¶åˆé‡æ–°æ‰‹æ’¸äº†ä¸ªlog4j2ï¼Œå†åæ¥ï¼Œè¿™ä¸ªå¤§ä½¬åˆåŒæ‰‹æ’¸äº†ä¸€ä¸ªæ€§èƒ½æ›´é«˜ã€åŠŸèƒ½æ›´å…¨çš„logbackã€‚</p>
<p>ä»æ­¤ï¼Œè¿™ä¸ªå¤§ä½¬æ„å»ºäº†logçš„ä¸–ç•Œï¼Œä¹Ÿåˆ›é€ äº†æœ€å¸¸è§çš„æ—¥å¿—æ¡†æ¶ï¼šlog4jã€log4j2ã€logbackã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨log4jï¼Œéœ€è¦log4j.jar</span></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger_log4j</span> <span class="operator">=</span> Logger.getLogger(Test.class);</span><br><span class="line">logger_log4j.info(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨log4j2ï¼Œéœ€è¦log4j-api.jarã€log4j-core.jar</span></span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger_log4j2</span> <span class="operator">=</span> LogManager.getLogger(Test.class);</span><br><span class="line">logger_log4j2.info(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// logbackï¼Œéœ€è¦logback-classic.jarã€logback-core.jar</span></span><br><span class="line"><span class="keyword">import</span> ch.qos.logback.classic.Logger;</span><br><span class="line"><span class="keyword">import</span> ch.qos.logback.classic.LoggerContext;</span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger_logback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoggerContext</span>().getLogger(Test.class);</span><br><span class="line">logger_logback.info(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// java.until.loggingï¼Œç®€ç§°jul</span></span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger_jul</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;java.Test&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ä¸éš¾çœ‹å‡ºï¼Œä½¿ç”¨ä¸åŒçš„æ—¥å¿—æ¡†æ¶ï¼Œå°±è¦å¼•å…¥ä¸åŒçš„jaråŒ…ï¼Œä½¿ç”¨ä¸åŒçš„ä»£ç è·å–Loggerã€‚</p>
<p>äºæ˜¯Apache Commons Loggingå‡ºç°äº†ã€‚</p>
<p>Common-loggingæä¾›äº†ä¸€ä¸ªæ—¥å¿—å…¥å£ï¼Œç§°ä½œâ€é—¨é¢æ—¥å¿—â€ï¼Œå³å®ƒä¸è´Ÿè´£å†™æ—¥å¿—ï¼Œè€Œæ˜¯<strong>æä¾›ç”¨ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œé€šè¿‡jaræ¥å†³å®šä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶</strong>ï¼Œè¿™æ ·å°±ä¸è¦å†æ›´æ¢æ¡†æ¶çš„æ—¶å€™å†ä¿®æ”¹ä»£ç äº†ã€‚åæ¥å¼€å‘äº†log4jçš„å¤§ä½¬åˆå› ä¸ºå«Œå¼ƒCommon-loggingéš¾ç”¨ï¼Œå¼€å‘äº†é—¨é¢æ—¥å¿—æ¡†æ¶<strong>slf4j</strong>ï¼Œä»Šå¤©å°±æ‹¿slf4jè®²è¿°é—¨é¢æ—¥å¿—ã€‚</p>
<p>é—¨é¢æ—¥å¿—å’Œè®¾è®¡æ¨¡å¼ä¸­çš„<strong>å¤–è§‚æ¨¡å¼</strong>å¦‚å‡ºä¸€è¾™ï¼Œæœ¬èº«ä¸æä¾›æœåŠ¡ï¼Œä¸ºå­ç³»ç»Ÿæä¾›ç»Ÿä¸€çš„å…¥å£ï¼Œå°è£…å­ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œä¾¿äºå®¢æˆ·ç«¯è°ƒç”¨ã€‚slf4jå°±åƒæ˜¯èœé¸Ÿé©¿ç«™ï¼Œæœ¬èº«æ²¡æœ‰å¿«é€’æœåŠ¡ï¼Œä½†æ˜¯æä¾›é¡ºä¸°ã€ä¸­é€šç­‰å¿«é€’æœåŠ¡ï¼Œè‡³äºä½ æƒ³ç”¨é¡ºä¸°è¿˜æ˜¯ç”¨ä¸­é€šï¼Œå®Œå…¨å–å†³äºä½ çš„æƒ³æ³•ã€‚</p>
<p>ä½¿ç”¨slf4jï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Test.class);</span><br><span class="line">logger.info(<span class="string">&quot;Hello World!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨slf4jéœ€è¦é¦–å…ˆå¯¼å…¥<strong>slf4j-api.jar</strong>ï¼Œå’Œlog4jé…åˆï¼Œéœ€è¦å¯¼å…¥<strong>log4j.jar</strong>ï¼Œä»¥åŠæ¡¥æ¥åŒ…<strong>slf4j-log412.jar</strong>ã€‚</p>
<p>logbackåªéœ€è¦å¯¼å…¥<strong>logback-classic.jar</strong>å’Œ<strong>logback-core.jar</strong>å³å¯ï¼Œä¸éœ€è¦æ¡¥æ¥åŒ…ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨æ¡¥æ¥åŒ…ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨æ¡¥æ¥åŒ…ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨æ¡¥æ¥åŒ…ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨æ¡¥æ¥åŒ…ï¼Ÿ</h4><p>slf4jä»LoggerFactory.getLogger()å¼€å§‹ï¼ŒåŸç†å°±æ˜¯å°±æ˜¯è®©ClassLoaderä»classpath(ä¾èµ–çš„jar)ä¸­æ‰¾åˆ°<strong>StaticLoggerBinder</strong>è¿™ä¸ªç±»ï¼Œç„¶ååˆ©ç”¨ä»–æ¥è¿”å›log4jã€logbackä¸­çš„Loggerï¼Œç„¶åæ‰“å°æ—¥å¿—ã€‚</p>
<p>æ‰€è°“çš„æ¡¥æ¥åŒ…ï¼Œå°±æ˜¯å®ç°StaticLoggerBinderç±»ï¼Œç”¨æ¥è¿æ¥slf4jå’Œæ—¥å¿—æ¡†æ¶ã€‚å› ä¸ºlog4jå’Œlog4j2åˆšå¼€å§‹æ²¡æœ‰StaticLoggerBinderè¿™ä¸ªç±»ï¼Œä¸ºäº†ä¸æ”¹å˜ç¨‹åºç»“æ„ï¼Œåªèƒ½é‡æ–°å†™ä¸€ä¸ªæ–°çš„jaræ¥å®ç°StaticLoggerBinderã€‚è€Œlogbackå‡ºç°slf4jä¹‹åï¼Œäºæ˜¯åœ¨logbackæœ¬èº«çš„jarä¸­å®ç°äº†StaticLoggerBinderï¼Œæ‰€ä»¥å°±ä¸éœ€è¦æ¡¥æ¥åŒ…ã€‚</p>
<p>StaticLoggerBinderå®ç°äº†ä½¿ç”¨åº•å±‚æ—¥å¿—æ¡†æ¶åˆ›å»ºLoggerçš„åŠŸèƒ½ï¼Œå„è‡ªçš„StaticLoggerBinderä¸ºslf4jæä¾›çš„Loggerï¼Œå†æä¾›ç»™ç”¨æˆ·æ‰“å°æ—¥å¿—ã€‚</p>
<p>log4jå’Œlog4j2æ¡¥æ¥åŒ…åŠlogbackä¾èµ–é‡Œï¼Œéƒ½æœ‰StaticLoggerBinderç±»ã€‚</p>
<p>â€œClass path contains multiple SLF4J bindings.â€åœ¨ä½¿ç”¨slf4jçš„æ—¶å€™ä¼šé‡åˆ°ä»¥ä¸Šçš„æŠ¥å‘Šä¿¡æ¯ã€‚ç©¶å…¶æ ¹æœ¬æ˜¯å› ä¸ºlogback-classicã€log4j-slf4j-implã€slf4j-log412ã€slf4j-jdkè¿™äº›jarä¸èƒ½åŒæ—¶å­˜åœ¨ã€‚ä»–ä»¬éƒ½å®ç°äº†StaticLoggerBinderç±»è€Œå¯¼è‡´å†²çªï¼Œslf4jæ— æ³•ç¡®å®šåˆ°åº•ç”¨å“ªä¸ªæ—¥å¿—æ¡†æ¶ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li><p>lombokæ˜¯ä¸€ä¸ªå¯ä»¥ç®€åŒ–ä»£ç çš„jaråŒ…ï¼Œéœ€è¦å¯¼å…¥ä¾èµ–ï¼Œæ·»åŠ æ’ä»¶ï¼Œå¯ä»¥è¯´æ˜¯å¼€å‘å¿…å¤‡ã€‚è·Ÿæ—¥å¿—æ²¡å•¥å…³ç³»ï¼Œåªä¸è¿‡@Slf4jæ³¨è§£æ˜¯lombokæä¾›çš„ï¼Œç”¨æ¥åœ¨æ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨logã€‚</p>
</li>
<li><p>slf4jæ˜¯æ—¥å¿—é—¨é¢ï¼Œä¸€ä¸ªæ—¥å¿—æ¥å£ï¼Œè€Œä¸æä¾›æ—¥å¿—ç³»ç»Ÿå®ç°ï¼Œæ–¹ä¾¿æ—¥å¿—ç³»ç»Ÿä¸è°ƒç”¨çš„åˆ†ç¦»ï¼Œå¯ä»¥æ–¹ä¾¿æ›´æ¢æ—¥å¿—ç³»ç»Ÿã€‚ç›¸å½“äºæ˜¯æä¾›äº†ä¸€ç§æ—¥å¿—è¾“å‡ºçš„è§„èŒƒï¼Œä¸‹é¢çš„æ—¥å¿—ç³»ç»Ÿéƒ½éœ€è¦å®ç°è¿™äº›æ–¹æ³•ï¼Œç»Ÿä¸€äº†æ—¥å¿—è¾“å‡ºè§„èŒƒã€‚å®ƒå®ç°äº†æ—¥å¿—æ¡†æ¶ä¸€äº›é€šç”¨çš„apiï¼Œlog4jå’Œlogbackæ˜¯å…·ä½“çš„æ—¥å¿—æ¡†æ¶ã€‚</p>
</li>
<li><p>log4jå°±æ˜¯ä¸€ä¸ªæ—¥å¿—å®ç°ç³»ç»Ÿï¼Œå…·ä½“çš„é…ç½®æ–‡ä»¶log4j.propertiesæ€ä¹ˆå†™ï¼Œè¿˜å¾—å†çœ‹çœ‹ã€‚log4jåœ¨ç»“åˆslf4jæ—¶éœ€è¦ä½¿ç”¨ä¸€ä¸ªé€‚é…ç±»æ¡¥æ¥åŒ…ã€‚ä½¿ç”¨Logger.getLoggerã€‚</p>
</li>
<li><p>logbackæ—¶æ¯”log4jæ–°çš„æ—¥å¿—å®ç°ç³»ç»Ÿï¼Œç›´æ¥å®ç°äº†slf4jæ¥å£ï¼Œä½¿ç”¨LoggerFactory.getLoggerã€‚</p>
<p>ä»–ä»¬å¯ä»¥å•ç‹¬çš„ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç»‘å®šslf4jä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>å•ç‹¬ä½¿ç”¨ï¼Œåˆ†åˆ«è°ƒç”¨æ¡†æ¶è‡ªå·±çš„æ–¹æ³•æ¥è¾“å‡ºæ—¥å¿—ä¿¡æ¯ã€‚ç»‘å®šslf4jä¸€èµ·ä½¿ç”¨ã€‚è°ƒç”¨slf4jçš„apiæ¥è¾“å…¥æ—¥å¿—ä¿¡æ¯ï¼Œå…·ä½“ä½¿ç”¨ä¸åº•å±‚æ—¥å¿—æ¡†æ¶æ— å…³ï¼ˆéœ€è¦åº•å±‚æ¡†æ¶çš„é…ç½®æ–‡ä»¶ï¼‰ã€‚æ˜¾ç„¶ä¸æ¨èå•ç‹¬ä½¿ç”¨æ—¥å¿—æ¡†æ¶ã€‚å‡è®¾é¡¹ç›®ä¸­å·²ç»ä½¿ç”¨äº†log4jï¼Œè€Œæˆ‘ä»¬æ­¤æ—¶åŠ è½½äº†ä¸€ä¸ªç±»åº“ï¼Œè€Œè¿™ä¸ªç±»åº“ä¾èµ–å¦ä¸€ä¸ªæ—¥å¿—æ¡†æ¶ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ—¥å¿—æ¡†æ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸éº»çƒ¦çš„äº‹æƒ…ã€‚è€Œä½¿ç”¨äº†slf4jå°±ä¸åŒäº†ï¼Œç”±äºåº”ç”¨è°ƒç”¨çš„æŠ½è±¡å±‚çš„apiï¼Œä¸åº•å±‚æ—¥å¿—æ¡†æ¶æ˜¯æ— å…³çš„ï¼Œå› æ­¤å¯ä»¥ä»»æ„æ›´æ¢æ—¥å¿—æ¡†æ¶ã€‚</p>
</li>
</ol>
<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><h4 id="1-mavené¡¹ç›®"><a href="#1-mavené¡¹ç›®" class="headerlink" title="1.mavené¡¹ç›®"></a>1.mavené¡¹ç›®</h4><p>å¾ˆä¹…æ²¡åœ¨è¿™ä¸ªç”µè„‘ä¸Šæ–°å»ºmavené¡¹ç›®ï¼Œç»“æœé—®é¢˜æ¥äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">~/.m2 â¯ mvn -v      </span><br><span class="line">zsh: command not found: mvn</span><br></pre></td></tr></table></figure>

<p>ä¹‹å‰å‡ºç°çš„é—®é¢˜åˆå‡ºç°äº†ï¼Œä¹‹å‰é‡æ–°é…ç½®äº†ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œå¯æ˜¯brew info maven ä¹Ÿæ‰¾ä¸åˆ°ä¹‹å‰mavenå®‰è£…çš„è·¯å¾„ï¼Œéš¾é“ä¹‹å‰æˆ‘ä¸æ˜¯é€šè¿‡brewå®‰è£…çš„å—ï¼Ÿ</p>
<p>å¦å¤–åœ¨èµ„æºåº“ä¸­ä¹Ÿæ²¡æ‰¾åˆ°ï¼Œå¥½å§ï¼Œé‡æ–° brew install maven ğŸ˜…ã€‚å¯æ˜¯brewå®‰è£…æŠ¥é”™ã€‚</p>
<p>å®˜ç½‘<a href="https://maven.apache.org/download.cgi%E4%B8%8B%E8%BD%BDapache-maven-3.8.5-bin.tar.gz%E3%80%82%E8%A7%A3%E5%8E%8B%E5%88%B0%E8%B5%84%E6%BA%90%E5%BA%93%E4%B8%AD%E3%80%82%E9%82%A3%E4%B9%88%E5%A6%82%E4%BD%95%E4%BD%BF%E5%BE%97%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E8%BE%93%E5%85%A5mvn%E8%83%BD%E5%A4%9F%E6%89%BE%E5%88%B0maven%E5%8C%85%EF%BC%9F%E5%B0%B1%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%BA%86%E3%80%82">https://maven.apache.org/download.cgiä¸‹è½½apache-maven-3.8.5-bin.tar.gzã€‚è§£å‹åˆ°èµ„æºåº“ä¸­ã€‚é‚£ä¹ˆå¦‚ä½•ä½¿å¾—åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥mvnèƒ½å¤Ÿæ‰¾åˆ°mavenåŒ…ï¼Ÿå°±éœ€è¦é…ç½®ç¯å¢ƒå˜é‡äº†ã€‚</a></p>
<p>ä¸‹è½½ä¹‹åï¼Œéœ€è¦é…ç½®ç¯å¢ƒå˜é‡ï¼Œä¸ç»æƒ³èµ·ä¹‹å‰çš„ç–‘é—®ï¼šjdkç¯å¢ƒå˜é‡åœ¨&#x2F;etc&#x2F;profileä¸­é…ç½®ï¼Œè€Œmavenä¸­çš„ç¯å¢ƒå˜é‡åœ¨~&#x2F;.bash_profileï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>æˆ‘ä»¬å¸¸è¯´çš„ç¯å¢ƒå˜é‡ä¿®æ”¹ä¸»è¦åŒ…å«ä¸¤ç±»æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ profile å’Œ bashrc æ–‡ä»¶ã€‚profile æ–‡ä»¶åˆåˆ†ä¸ºï¼šâ€&#x2F;etc&#x2F;profileâ€ï¼Œâ€<del>&#x2F;.bash_profileâ€ï¼›bashrc æ–‡ä»¶åˆ™åˆåˆ†ä¸º â€œ&#x2F;etc&#x2F;bashrcâ€ï¼Œå’Œ â€œ</del>&#x2F;.bashrcâ€ æ–‡ä»¶ã€‚</p>
<p>è¯´åˆ°è¿™å„¿ï¼Œå¯èƒ½è¿·æƒ‘äº†ï¼Œæˆ‘åœ¨æˆ‘ç”µè„‘é‡Œæ²¡çœ‹åˆ°.bash_profileå’Œ.bashrcå•Šï¼Œä½†æ˜¯çœ‹åˆ°.zshrcäº†ï¼Œè¿™æ˜¯ä¸ºå•¥ï¼Ÿ</p>
<blockquote>
<p>iterm2ä»¥åŠmacè‡ªå¸¦çš„terminaléƒ½æ˜¯ç»ˆç«¯æ¨¡æ‹Ÿå™¨ã€‚æœ€å¼€å§‹æ—¶å€™å°±ç”¨èµ·äº†iterm2.</p>
<p>bashï¼Œzshæ˜¯shellï¼Œzshå…¼å®¹bash</p>
<p>shellï¼šå£³ï¼Œç”¨å®ƒè¡¨ç¤ºâ€œä¸ºä½¿ç”¨è€…æä¾›çš„æ“ä½œç•Œé¢â€ï¼ŒShellæ³›æŒ‡æ‰€æœ‰ä¸ºç”¨æˆ·æä¾›æ“ä½œç•Œé¢çš„ç¨‹åºï¼Œåˆ†ä¸ºä¸¤ç±»ï¼šå‘½ä»¤è¡Œï¼ˆCLIï¼‰ä¸å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨èŠshellçš„æ—¶å€™ï¼Œå…¶å®éƒ½æ˜¯èŠçš„Linuxçš„å‘½ä»¤è¡Œç•Œé¢ã€‚</p>
</blockquote>
<blockquote>
<p>shå’Œbashå’Œzsh :</p>
<p>shå…¨ç§°ä¸ºBourne Shellï¼Œæ¥è‡ªäº1977å¹´åº•çš„Unix v7ç‰ˆã€‚äºŒè¿›åˆ¶æ–‡ä»¶ä½ç½®ä¸º<code>/bin/sh</code>ã€‚ </p>
<p>bashå…¨ç§°ä¸ºBourne-Again Shellï¼Œæ˜¯åœ¨1989å¹´å¯¹shçš„é‡å†™ç‰ˆï¼Œæ›¿ä»£äº†shã€‚äºŒè¿›åˆ¶æ–‡ä»¶ä½ç½®ä¸º<code>/bin/bash</code>ã€‚ </p>
<p>ç°åœ¨çš„Linuxç³»ç»Ÿä»¥åŠmacOSç³»ç»Ÿçš„shelléƒ½é»˜è®¤ä½¿ç”¨bashã€‚</p>
<p>Zshå³Z shellï¼Œæ˜¯ä¸€æ¬¾å¯ç”¨ä½œäº¤äº’å¼ç™»å½•çš„shellåŠè„šæœ¬ç¼–å†™çš„å‘½ä»¤è§£é‡Šå™¨ã€‚Zshå¯¹Bourne shellåšå‡ºäº†å¤§é‡æ”¹è¿›ï¼ŒåŒæ—¶åŠ å…¥äº†Bashã€kshåŠtcshçš„æŸäº›åŠŸèƒ½ã€‚ </p>
<p>æ‰€ä»¥è¯´Zshä¹Ÿæ˜¯ä¸€ä¸ªShellï¼Œå°±æ˜¯ä¼šæ¯”bashèƒ½å¥½ç”¨å¾ˆå¤šã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯2019å¹´èµ·ï¼ŒmacOSçš„é»˜è®¤Shellä»Bashæ”¹ä¸ºZshçš„åŸå› ï¼Ÿ</p>
<p>zshæ‹¥æœ‰å®Œå–„çš„æ’ä»¶æœºåˆ¶ä»¥åŠä¸°å¯Œçš„ç”Ÿæ€ï¼Œå’Œoh my zshä¸€èµ·é£Ÿç”¨æ›´ä½³</p>
</blockquote>
<h5 id="æŸ¥çœ‹æœ¬åœ°Shellçš„å‘½ä»¤"><a href="#æŸ¥çœ‹æœ¬åœ°Shellçš„å‘½ä»¤" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°Shellçš„å‘½ä»¤"></a>æŸ¥çœ‹æœ¬åœ°Shellçš„å‘½ä»¤</h5><ul>
<li><p>æŸ¥çœ‹å½“å‰Linuxçš„å…¨éƒ¨Shellï¼š<code>cat /etc/shells</code></p>
</li>
<li><p>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„Shellï¼š<code>echo $SHELL</code>æˆ–è€…<code>echo $0</code></p>
</li>
<li><p>åˆ‡æ¢é»˜è®¤çš„Shellï¼š<code>chsh -s [shellçš„äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„]</code>ï¼Œä¹‹åè¦é‡æ–°ç™»é™†Shellæ‰èƒ½ç”Ÿæ•ˆå“ˆã€‚ä¾‹å¦‚ï¼š</p>
</li>
<li><ul>
<li>åˆ‡æ¢ä¸ºBashï¼š <code>chsh -s /bin/bash</code></li>
<li>åˆ‡æ¢ä¸ºZshï¼š<code>chsh -s /bin/zsh</code></li>
</ul>
</li>
</ul>
<h5 id="Shellçš„å„ç§é…ç½®æ–‡ä»¶"><a href="#Shellçš„å„ç§é…ç½®æ–‡ä»¶" class="headerlink" title="Shellçš„å„ç§é…ç½®æ–‡ä»¶"></a>Shellçš„å„ç§é…ç½®æ–‡ä»¶</h5><p>æ— è®ºæ˜¯Bashè¿˜æ˜¯Zshï¼Œéƒ½æ˜¯æœ‰å„è‡ªçš„é…ç½®æ–‡ä»¶æ¥å®Œæˆè‡ªå·±çš„å·¥ä½œçš„ã€‚è¿™äº›é…ç½®æ–‡ä»¶éƒ½æ˜¯éšè—æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“è¿™äº›é…ç½®ã€‚ä½†æ˜¯åœ¨è¿™é‡Œä¹Ÿè¦ç»™å¤§å®¶æ€»ç»“ä¸€ä¸‹éƒ½æœ‰å“ªäº›é…ç½®æ–‡ä»¶ï¼Œä¹Ÿè®¸ä»¥åç”¨çš„ä¸Šå‘¢ã€‚ </p>
<h5 id="Bashçš„é…ç½®æ–‡ä»¶"><a href="#Bashçš„é…ç½®æ–‡ä»¶" class="headerlink" title="Bashçš„é…ç½®æ–‡ä»¶"></a>Bashçš„é…ç½®æ–‡ä»¶</h5><ul>
<li>&#x2F;etc&#x2F;profileï¼šä¸ºç³»ç»Ÿçš„<strong>æ¯ä¸ªç”¨æˆ·</strong>è®¾ç½®ç¯å¢ƒä¿¡æ¯ï¼Œå½“ç”¨æˆ·ç¬¬ä¸€æ¬¡<strong>ç™»å½•</strong>æ—¶ä¼šæ‰§è¡Œè¯¥æ–‡ä»¶é‡Œçš„å‘½ä»¤ã€‚é»˜è®¤ä¼šç›´æ¥è°ƒç”¨&#x2F;etc&#x2F;bashrcã€‚è¯¥æ–‡ä»¶çš„æ”¹åŠ¨éœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆã€‚ç”¨äºè®¾ç½®ç³»ç»Ÿçº§åˆ«çš„ç¯å¢ƒå˜é‡å’Œå¯åŠ¨ç¨‹åºï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸‹é…ç½®ä¼šå¯¹æ‰€æœ‰çš„ç”¨æˆ·ç”Ÿæ•ˆã€‚</li>
<li>&#x2F;etc&#x2F;bashrcï¼šä¸ºæ¯ä¸€ä¸ªè¿è¡Œbash shellçš„ç”¨æˆ·æ‰§è¡Œæ­¤æ–‡ä»¶ã€‚å½“bash shellè¢«æ‰“å¼€æ—¶ï¼Œä¼šè¯»å–å¹¶æ‰§è¡Œè¯¥æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ‰€ä»¥ä¿®æ”¹è¯¥æ–‡ä»¶åï¼Œé‡æ–°æ‰“å¼€Shellå³å¯ç”Ÿæ•ˆã€‚</li>
<li>~&#x2F;.bash_profileï¼šå’Œ&#x2F;etc&#x2F;profileç±»ä¼¼ï¼Œä½†æ˜¯åªå¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆã€‚åªå¯¹å•ä¸€ç”¨æˆ·ç”Ÿæ•ˆï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªç”¨æˆ·çº§åˆ«çš„è®¾ç½®ï¼Œå¯ä»¥ç†è§£ä¸ºæŸä¸€ç”¨æˆ·ä¸‹çš„profile</li>
<li>~&#x2F;.bashrcï¼šå’Œ&#x2F;etc&#x2F;bashrcç±»ä¼¼ï¼Œä½†æ˜¯åªå¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆã€‚</li>
<li>~&#x2F;.bash_logoutï¼šå½“æ¯æ¬¡é€€å‡ºbash shellæ—¶ï¼Œæ‰§è¡Œè¯¥æ–‡ä»¶ã€‚</li>
<li>~&#x2F;.bash_historyï¼šä¿å­˜äº†å†å²å‘½ä»¤ã€‚åœ¨Shellä¸ºBashæ—¶ï¼Œæ¯æ¬¡æ•²å‡»å‘½ä»¤æ—¶ï¼Œéƒ½ä¼šä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œ</li>
</ul>
<h5 id="Zshçš„é…ç½®æ–‡ä»¶"><a href="#Zshçš„é…ç½®æ–‡ä»¶" class="headerlink" title="Zshçš„é…ç½®æ–‡ä»¶"></a>Zshçš„é…ç½®æ–‡ä»¶</h5><ul>
<li>&#x2F;etc&#x2F;bashrc å¯¹åº” &#x2F;etc&#x2F;zshrc</li>
<li>~&#x2F;.bash_profile å¯¹åº” ~&#x2F;.zprofile</li>
</ul>
<p>åŠ è½½é¡ºåºï¼šzshenvã€zprofileã€zshrcã€zlogin</p>
<hr>
<p>æ‰€ä»¥è¯´ï¼Œå„ç§æ•™ç¨‹é‡Œè¯´çš„é…ç½®éƒ½æ˜¯é»˜è®¤bashçš„ï¼Œbashçš„é…ç½®æ–‡ä»¶å¯¹æ ‡åˆ°zshä¸­å°±å¯ä»¥ã€‚</p>
<p><strong>&#x2F;etc&#x2F;profile å’Œ &#x2F;etc&#x2F;bashrc è¿™ç§åœ¨ &#x2F;etc ç›®å½•ä¸‹çš„é…ç½®åˆ™éƒ½å±äºå…¨å±€é…ç½®ï¼Œæ‰€æœ‰ç”¨æˆ·çš„shelléƒ½æœ‰æƒä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡ï¼Œï½&#x2F; åˆ™å±äºç”¨æˆ·çº§åˆ«çš„</strong></p>
<h5 id="æ€»ç»“ä¸€ä¸‹ï¼šå„ç§é…ç½®æ–‡ä»¶å¯ä»¥æŒ‰ä¸¤ç§æ–¹å¼åˆ†ç±»ï¼š"><a href="#æ€»ç»“ä¸€ä¸‹ï¼šå„ç§é…ç½®æ–‡ä»¶å¯ä»¥æŒ‰ä¸¤ç§æ–¹å¼åˆ†ç±»ï¼š" class="headerlink" title="æ€»ç»“ä¸€ä¸‹ï¼šå„ç§é…ç½®æ–‡ä»¶å¯ä»¥æŒ‰ä¸¤ç§æ–¹å¼åˆ†ç±»ï¼š"></a>æ€»ç»“ä¸€ä¸‹ï¼šå„ç§é…ç½®æ–‡ä»¶å¯ä»¥æŒ‰ä¸¤ç§æ–¹å¼åˆ†ç±»ï¼š</h5><table>
<thead>
<tr>
<th></th>
<th>profile</th>
<th align="center">bashrc&#x2F;zshrc</th>
</tr>
</thead>
<tbody><tr>
<td>å…¨å±€</td>
<td>&#x2F;etc&#x2F;profileï¼ˆæ— å…³å“ªä¸ªshellï¼‰</td>
<td align="center">&#x2F;etc&#x2F;bashrc</td>
</tr>
<tr>
<td>ç”¨æˆ·</td>
<td>~&#x2F;.bash_profile ï¼ˆä¸“ç”¨äºå“ªä¸ªshellï¼‰</td>
<td align="center">~&#x2F;.bashrc</td>
</tr>
</tbody></table>
<p>profileçš„bashrcåŒºåˆ«?</p>
<p>è¦ææ¸…bashrcä¸profileçš„åŒºåˆ«ï¼Œé¦–å…ˆè¦å¼„æ˜ç™½ä»€ä¹ˆæ˜¯äº¤äº’å¼shellå’Œéäº¤äº’å¼shellï¼Œå³login shell å’Œnon-login shellã€‚</p>
<p>äº¤äº’å¼æ¨¡å¼å°±æ˜¯shellç­‰å¾…ä½ çš„è¾“å…¥ï¼Œå¹¶ä¸”æ‰§è¡Œä½ æäº¤çš„å‘½ä»¤ã€‚è¿™ç§æ¨¡å¼è¢«ç§°ä½œäº¤äº’å¼æ˜¯å› ä¸ºshellä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚è¿™ç§æ¨¡å¼ä¹Ÿæ˜¯å¤§å¤šæ•°ç”¨æˆ·éå¸¸ç†Ÿæ‚‰çš„ï¼šç™»å½•ã€æ‰§è¡Œä¸€äº›å‘½ä»¤ã€ç­¾é€€ã€‚å½“ä½ ç­¾é€€åï¼Œshellä¹Ÿç»ˆæ­¢äº†ã€‚ shellä¹Ÿå¯ä»¥è¿è¡Œåœ¨å¦å¤–ä¸€ç§æ¨¡å¼ï¼šéäº¤äº’å¼æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œshellä¸ä¸ä½ è¿›è¡Œäº¤äº’ï¼Œè€Œæ˜¯è¯»å–å­˜æ”¾åœ¨æ–‡ä»¶ä¸­çš„å‘½ä»¤,å¹¶ä¸”æ‰§è¡Œå®ƒä»¬ã€‚å½“å®ƒè¯»åˆ°æ–‡ä»¶çš„ç»“å°¾ï¼Œshellä¹Ÿå°±ç»ˆæ­¢äº†ã€‚</p>
<p>bashrc ä¸ profile éƒ½ç”¨äºä¿å­˜ç”¨æˆ·çš„ç¯å¢ƒä¿¡æ¯ï¼Œbashrcç”¨äºäº¤äº’å¼non-loginshellï¼Œè€Œprofileç”¨äºäº¤äº’å¼login shellã€‚</p>
<ol>
<li><p>&#x2F;etc&#x2F;profile: æ­¤æ–‡ä»¶ä¸ºç³»ç»Ÿçš„æ¯ä¸ªç”¨æˆ·è®¾ç½®ç¯å¢ƒä¿¡æ¯,å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•æ—¶,è¯¥æ–‡ä»¶è¢«æ‰§è¡Œ.å¹¶ä»&#x2F;etc&#x2F;profile.dç›®å½•çš„é…ç½®æ–‡ä»¶ä¸­æœé›†shellçš„è®¾ç½®.</p>
</li>
<li><p>&#x2F;etc&#x2F;bashrc: ä¸ºæ¯ä¸€ä¸ªè¿è¡Œbash shellçš„ç”¨æˆ·æ‰§è¡Œæ­¤æ–‡ä»¶.å½“bash shellè¢«æ‰“å¼€æ—¶,è¯¥æ–‡ä»¶è¢«è¯»å–.</p>
</li>
<li><p>~&#x2F;.bash_profile: æ¯ä¸ªç”¨æˆ·éƒ½å¯ä½¿ç”¨è¯¥æ–‡ä»¶è¾“å…¥ä¸“ç”¨äºè‡ªå·±ä½¿ç”¨çš„shellä¿¡æ¯,å½“ç”¨æˆ·ç™»å½•æ—¶,è¯¥æ–‡ä»¶ä»…ä»…æ‰§è¡Œä¸€æ¬¡!é»˜è®¤æƒ…å†µä¸‹,ä»–è®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡,æ‰§è¡Œç”¨æˆ·çš„.bashrcæ–‡ä»¶.</p>
</li>
<li><p>~&#x2F;.bashrc: è¯¥æ–‡ä»¶åŒ…å«ä¸“ç”¨äºä½ çš„bash shellçš„bashä¿¡æ¯,å½“ç™»å½•æ—¶ä»¥åŠæ¯æ¬¡æ‰“å¼€æ–°çš„shellæ—¶,è¯¥æ–‡ä»¶è¢«è¯»å–.</p>
</li>
<li><p>~&#x2F;.bash_logout: å½“æ¯æ¬¡é€€å‡ºç³»ç»Ÿ(é€€å‡ºbash shell)æ—¶,æ‰§è¡Œè¯¥æ–‡ä»¶.</p>
</li>
</ol>
<p>å¦å¤–,&#x2F;etc&#x2F;profileä¸­è®¾å®šçš„å˜é‡(å…¨å±€)çš„å¯ä»¥ä½œç”¨äºä»»ä½•ç”¨æˆ·,è€Œ~&#x2F;.bashrcç­‰ä¸­è®¾å®šçš„å˜é‡(å±€éƒ¨)åªèƒ½ç»§æ‰¿&#x2F;etc&#x2F;profileä¸­çš„å˜é‡,ä»–ä»¬æ˜¯â€çˆ¶å­â€å…³ç³».</p>
<hr>
<p>å½“ç™»å…¥ç³»ç»Ÿæ—¶å€™è·å¾—ä¸€ä¸ªshellè¿›ç¨‹æ—¶ï¼Œå…¶è¯»å–ç¯å¢ƒè®¾å®šæ¡£æœ‰ä¸‰æ­¥</p>
<p>1ã€é¦–å…ˆè¯»å…¥çš„æ˜¯å…¨å±€ç¯å¢ƒå˜é‡è®¾å®šæ¡£&#x2F;etc&#x2F;profileï¼Œç„¶åæ ¹æ®å…¶å†…å®¹è¯»å–é¢å¤–çš„è®¾å®šçš„æ–‡æ¡£ï¼Œå¦‚<br>&#x2F;etc&#x2F;profile.då’Œ&#x2F;etc&#x2F;inputrc</p>
<p>2ã€ç„¶åæ ¹æ®ä¸åŒä½¿ç”¨è€…å¸å·ï¼Œå»å…¶å®¶ç›®å½•è¯»å–<del>&#x2F;.bash_profileï¼Œå¦‚æœè¿™è¯»å–ä¸äº†å°±è¯»å–</del>&#x2F;.bash_loginï¼Œè¿™ä¸ªä¹Ÿè¯»å–ä¸äº†æ‰ä¼šè¯»å–<br>~&#x2F;.profileï¼Œè¿™ä¸‰ä¸ªæ–‡æ¡£è®¾å®šåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œè¯»å–æœ‰ä¼˜å…ˆå…³ç³»</p>
<p>3ã€ç„¶ååœ¨æ ¹æ®ç”¨æˆ·å¸å·è¯»å–~&#x2F;.bashrc</p>
<hr>
<p>æ€»ç»“ï¼šé…ç½®æ–‡ä»¶å…¨å±€&#x2F;ç”¨æˆ·â€”äº¤äº’çš„&#x2F;éäº¤äº’çš„ï¼Œjdkçš„é…ç½®å°±æ˜¯åœ¨&#x2F;etc&#x2F;profileä¸­ï¼Œmavençš„é…ç½®åœ¨ï½&#x2F;.bash_profileæ—¢ç„¶ç”¨çš„æ˜¯zshï¼Œå°±åœ¨ ~&#x2F;.zprofileé‡Œé¢é…ç½®ã€‚</p>
<hr>
<p>åœ¨ï½&#x2F;.zprofileæ–‡ä»¶ä¸­ï¼Œæ·»åŠ é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export M=&quot;/usr/local/ApacheMaven&quot;</span><br><span class="line">export PATH=&quot;$M/bin:$PATH&quot;</span><br></pre></td></tr></table></figure>

<p>source ï½&#x2F;.zprofile å³å¯ã€‚</p>
<p>ç„¶åé…ç½®ä¸€ä¸‹é˜¿é‡Œäº‘ä»“åº“ã€‚åœ¨setting.xmlæ–‡ä»¶ä¸­ï¼Œè¦å…³æ³¨ä¸¤ä¸ªåœ°æ–¹ï¼Œ<em><strong>localRepository</strong></em>å’Œ<em><strong>mirrors</strong></em>ã€‚ç¬¬ä¸€ä¸ªlocalRepositoryæ˜¯ä½ æœ¬åœ°ä»“åº“æ‰€åœ¨çš„ä½ç½®ï¼Œä½ çš„åŒ…éƒ½ä¼šä¸‹è½½åˆ°è¿™é‡Œï¼Œé»˜è®¤åœ¨ä½ ç”¨æˆ·ç›®å½•çš„.m2ç›®å½•ä¸‹ï¼Œè¿™é‡Œå¯ä»¥æ¢æˆä½ æƒ³å­˜æ”¾çš„åœ°å€ã€‚ç¬¬äºŒä¸ªmirroræ˜¯ä½ çš„åŒ…ä¸‹è½½åœ°å€ï¼Œå› ä¸ºæœ‰å¢™ï¼Œæ‰€ä»¥å»ºè®®å¢åŠ é˜¿é‡Œäº‘ä»“åº“é…ç½®ï¼Œæ¥åŠ é€Ÿä¸‹è½½ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>é˜¿é‡Œäº‘å…¬å…±ä»“åº“<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-åˆ›å»ºmaven-webé¡¹ç›®"><a href="#2-åˆ›å»ºmaven-webé¡¹ç›®" class="headerlink" title="2.åˆ›å»ºmaven webé¡¹ç›®"></a>2.åˆ›å»ºmaven webé¡¹ç›®</h4><p>æ–°å»ºmavené¡¹ç›®æ—¶é€‰ä¸­create from archetypeï¼Œé€‰æ‹©org.apache.maven.archetypes:maven-archetype-webappã€‚</p>
<p>é€‰æ‹©è‡ªå·±mavençš„setting.xmlã€‚</p>
<p>é…ç½®tomcatæœåŠ¡å™¨ï¼Œé€‰æ‹©tomcat-localï¼Œç»™æœåŠ¡å™¨å–åå­—ï¼Œé€‰ç‰ˆæœ¬ç«¯å£å·ä¹‹ç±»çš„ã€‚</p>
<p>deploymentä¸­artifacté€‰æ‹©è¦éƒ¨ç½²çš„jaråŒ…ï¼Œé€‰explodedçš„ã€‚</p>
<p>é€‰æ‹©çƒ­éƒ¨ç½²ï¼Œåœ¨å®é™…å¼€å‘ä¸­æ˜¯å¾ˆç®¡ç”¨çš„webå¼€å‘ï¼Œä½ åå°ï¼Œæ”¹äº†å•¥ä»–å°±çƒ­éƒ¨ç½²ï¼Œä¸ç”¨ä½ é‡å¯tomcatï¼Œå‰å°çš„ä¹Ÿæ˜¯ï¼Œä½ ä¿®æ”¹jsp,css,jsä»€ä¹ˆçš„éƒ½å¯ä»¥ç›´æ¥è¿›è¡Œçƒ­éƒ¨ç½²ï¼Œä½ åªè¦è‡ªå·±åˆ·æ–°ä¸€ä¸‹ä½ çš„é¡µé¢å°±è¡Œäº†ã€‚</p>
<h4 id="3-ä½¿ç”¨log4jé›†åˆslf4j"><a href="#3-ä½¿ç”¨log4jé›†åˆslf4j" class="headerlink" title="3.ä½¿ç”¨log4jé›†åˆslf4j"></a>3.ä½¿ç”¨log4jé›†åˆslf4j</h4><p>Apache Log4jæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æ—¥å¿—è®°å½•å·¥å…·ï¼Œå®ƒçš„æ—¥å¿—çº§åˆ«æŒ‰ä¸‹é¢é¡ºåºé€’å‡ï¼š</p>
<table>
<thead>
<tr>
<th>çº§åˆ«</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>OFF</td>
<td>æœ€é«˜çº§åˆ«ï¼Œç”¨äºå…³é—­æ—¥å¿—è®°å½•ã€‚</td>
</tr>
<tr>
<td>FATAL</td>
<td>å°†å¯¼è‡´åº”ç”¨ç¨‹åºæå‰ç»ˆæ­¢çš„ä¸¥é‡é”™è¯¯çš„ä¿¡æ¯å°†ç«‹å³å‘ˆç°åœ¨æ—¥å¿—ä¸Šã€‚</td>
</tr>
<tr>
<td>ERROR</td>
<td>å°†å…¶ä»–è¿è¡Œæ—¶é”™è¯¯æˆ–æ„å¤–æƒ…å†µçš„ä¿¡æ¯å‘ˆç°åœ¨æ—¥å¿—ä¸Šã€‚</td>
</tr>
<tr>
<td>WARN</td>
<td>ä½¿ç”¨å·²è¿‡æ—¶çš„APIï¼ŒAPIçš„æ»¥ç”¨ï¼Œæ½œåœ¨é”™è¯¯ï¼Œå…¶ä»–ä¸è‰¯çš„æˆ–æ„å¤–çš„è¿è¡Œæ—¶çš„çŠ¶å†µï¼ˆä½†ä¸ä¸€å®šæ˜¯é”™è¯¯çš„ï¼‰</td>
</tr>
<tr>
<td>INFO</td>
<td>ä¸€äº›æ„Ÿå…´è¶£çš„è¿è¡Œæ—¶äº‹ä»¶ï¼ˆå¯åŠ¨&#x2F;å…³é—­</td>
</tr>
<tr>
<td>DEBUG</td>
<td>ä¸€äº›è¯¦ç»†ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç¨‹åºçš„è¿è¡ŒçŠ¶æ€</td>
</tr>
<tr>
<td>TRACE</td>
<td>æœ€è¯¦ç»†çš„ä¿¡æ¯ã€‚ä¸€èˆ¬è¿™äº›ä¿¡æ¯åªè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</td>
</tr>
</tbody></table>
<h5 id="ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ä¾èµ–"><a href="#ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ä¾èµ–" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ä¾èµ–"></a>ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ä¾èµ–</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0-alpha7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬äºŒæ­¥ï¼šé…ç½®log4jçš„é…ç½®æ–‡ä»¶"><a href="#ç¬¬äºŒæ­¥ï¼šé…ç½®log4jçš„é…ç½®æ–‡ä»¶" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šé…ç½®log4jçš„é…ç½®æ–‡ä»¶"></a>ç¬¬äºŒæ­¥ï¼šé…ç½®log4jçš„é…ç½®æ–‡ä»¶</h5><p>å…¶é…ç½®æ–‡ä»¶åä¸ºlog4j.propertiesï¼Œ<strong>éœ€è¦æ‰‹åŠ¨åœ¨java&#x2F;resourcesä¸‹åˆ›å»º</strong>ï¼Œå¦‚æœå»ºåœ¨å…¶ä»–ä½ç½®ï¼Œideaè¿™ä¸ªå·¥å…·å°†æ— æ³•è¯†åˆ«ã€‚è¯¥é…ç½®æ–‡ä»¶ç”¨æ¥è®¾ç½®è®°å½•å™¨çš„çº§åˆ«ã€å­˜æ”¾å™¨å’Œå¸ƒå±€çš„ï¼Œå®ƒå¯æ¥key&#x3D;valueæ ¼å¼çš„è®¾ç½®æˆ–xmlæ ¼å¼çš„è®¾ç½®ä¿¡æ¯ã€‚é€šè¿‡é…ç½®ï¼Œå¯ä»¥åˆ›å»ºå‡ºLog4Jçš„è¿è¡Œç¯å¢ƒã€‚</p>
<p>Log4Jé…ç½®æ–‡ä»¶çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">### set log levels é…ç½®æ ¹Logger###</span></span><br><span class="line"><span class="comment">### log4j.rootLogger  = [ level ] , appenderName1 , appenderName2 ,  â€¦ ###</span></span><br><span class="line"><span class="comment">###  level : æ˜¯æ—¥å¿—è®°å½•çš„ä¼˜å…ˆçº§ ä¼˜å…ˆçº§ä»é«˜åˆ°ä½åˆ†åˆ«æ˜¯ERRORã€WARNã€INFOã€DEBUG</span></span><br><span class="line"><span class="comment">###  æ¯”å¦‚åœ¨è¿™é‡Œå®šä¹‰äº†INFOçº§åˆ«ï¼Œåˆ™åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰DEBUGçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯å°†ä¸è¢«æ‰“å°å‡ºæ¥</span></span><br><span class="line"><span class="comment">### Appender ä¸ºæ—¥å¿—è¾“å‡ºç›®çš„åœ° è¿™é‡Œ å°†debugå±‚çº§åŠä»¥ä¸Šçš„ä¿¡æ¯è¾“å‡ºåˆ°consoleå’Œfileï¼Œè‡ªå·±å®šä¹‰çš„åå­—  ###</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span> = <span class="string">DEBUG,Console,File</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">###  è¾“å‡ºåˆ°æ§åˆ¶å°  ###</span></span><br><span class="line"><span class="attr">log4j.appender.Console</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.Console.Target</span>=<span class="string">System.out</span></span><br><span class="line"><span class="attr">log4j.appender.Console.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.Console.layout.ConversionPattern</span>=<span class="string">[%d&#123;yy/MM/dd HH:mm:ss:SSS&#125;]-%l:%m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ ###</span></span><br><span class="line"><span class="attr">log4j.appender.File</span>=<span class="string">org.apache.log4j.RollingFileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.File.File</span>=<span class="string">$&#123;project&#125;src/main/resources/log/app.log</span></span><br><span class="line"><span class="attr">log4j.appender.File.MaxFileSize</span>=<span class="string">10MB</span></span><br><span class="line"><span class="attr">log4j.appender.File.Threshold</span>=<span class="string">ALL</span></span><br><span class="line"><span class="attr">log4j.appender.File.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.File.layout.ConversionPattern</span>=<span class="string">[%p][%d&#123;yyyy-MM-dd HH\:mm\:ss,SSS&#125;][%c]%m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#   %m   è¾“å‡ºä»£ç ä¸­æŒ‡å®šçš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">#ã€€ã€€%p   è¾“å‡ºä¼˜å…ˆçº§ï¼Œå³DEBUGï¼ŒINFOï¼ŒWARNï¼ŒERRORï¼ŒFATAL</span></span><br><span class="line"><span class="comment">#ã€€ã€€%r   è¾“å‡ºè‡ªåº”ç”¨å¯åŠ¨åˆ°è¾“å‡ºè¯¥logä¿¡æ¯è€—è´¹çš„æ¯«ç§’æ•°</span></span><br><span class="line"><span class="comment">#ã€€ã€€%c   è¾“å‡ºæ‰€å±çš„ç±»ç›®ï¼Œé€šå¸¸å°±æ˜¯æ‰€åœ¨ç±»çš„å…¨å</span></span><br><span class="line"><span class="comment">#ã€€ã€€%t   è¾“å‡ºäº§ç”Ÿè¯¥æ—¥å¿—äº‹ä»¶çš„çº¿ç¨‹å</span></span><br><span class="line"><span class="comment">#ã€€ã€€%n   è¾“å‡ºä¸€ä¸ªå›è½¦æ¢è¡Œç¬¦ï¼ŒWindowså¹³å°ä¸ºâ€œ\r\nâ€ï¼ŒUnixå¹³å°ä¸ºâ€œ\nâ€</span></span><br><span class="line"><span class="comment">#ã€€ã€€%d   è¾“å‡ºæ—¥å¿—æ—¶é—´ç‚¹çš„æ—¥æœŸæˆ–æ—¶é—´ï¼Œé»˜è®¤æ ¼å¼ä¸ºISO8601ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶åæŒ‡å®šæ ¼å¼ï¼Œæ¯”å¦‚ï¼š%d&#123;yyy MMM dd HH:mm:ss , SSS&#125;ï¼Œè¾“å‡ºç±»ä¼¼ï¼š2002å¹´10æœˆ18æ—¥  22 ï¼š 10 ï¼š 28 ï¼Œ 921</span></span><br><span class="line"><span class="comment">#ã€€ã€€%l   è¾“å‡ºæ—¥å¿—äº‹ä»¶çš„å‘ç”Ÿä½ç½®ï¼ŒåŒ…æ‹¬ç±»ç›®åã€å‘ç”Ÿçš„çº¿ç¨‹ï¼Œä»¥åŠåœ¨ä»£ç ä¸­çš„è¡Œæ•°ã€‚ä¸¾ä¾‹ï¼šTestlog4.main(TestLog4.java: 10 )</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### Appender ä¸ºæ—¥å¿—è¾“å‡ºç›®çš„åœ°ï¼ŒLog4jæä¾›çš„appenderæœ‰ä»¥ä¸‹å‡ ç§ï¼š</span></span><br><span class="line"><span class="comment">#org.apache.log4j.ConsoleAppenderï¼ˆæ§åˆ¶å°ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">#org.apache.log4j.FileAppenderï¼ˆæ–‡ä»¶ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">#org.apache.log4j.DailyRollingFileAppenderï¼ˆæ¯å¤©äº§ç”Ÿä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">#org.apache.log4j.RollingFileAppenderï¼ˆæ–‡ä»¶å¤§å°åˆ°è¾¾æŒ‡å®šå°ºå¯¸çš„æ—¶å€™äº§ç”Ÿä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">#org.apache.log4j.WriterAppenderï¼ˆå°†æ—¥å¿—ä¿¡æ¯ä»¥æµæ ¼å¼å‘é€åˆ°ä»»æ„æŒ‡å®šçš„åœ°æ–¹ï¼‰</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### Layoutï¼šæ—¥å¿—è¾“å‡ºæ ¼å¼ï¼ŒLog4jæä¾›çš„layoutæœ‰ä»¥ä¸‹å‡ ç§</span></span><br><span class="line"><span class="comment">#org.apache.log4j.HTMLLayoutï¼ˆä»¥HTMLè¡¨æ ¼å½¢å¼å¸ƒå±€ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">#org.apache.log4j.PatternLayoutï¼ˆå¯ä»¥çµæ´»åœ°æŒ‡å®šå¸ƒå±€æ¨¡å¼ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">#org.apache.log4j.SimpleLayoutï¼ˆåŒ…å«æ—¥å¿—ä¿¡æ¯çš„çº§åˆ«å’Œä¿¡æ¯å­—ç¬¦ä¸²ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">#org.apache.log4j.TTCCLayoutï¼ˆåŒ…å«æ—¥å¿—äº§ç”Ÿçš„æ—¶é—´ã€çº¿ç¨‹ã€ç±»åˆ«ç­‰ç­‰ä¿¡æ¯ï¼‰</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œé€šè¿‡Thresholdè®¾ç½®ï¼Œå¯ä»¥æŠŠå¼‚å¸¸æ—¥å¿—å•ç‹¬è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">### set log levels ###</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span> = <span class="string">debug ,  stdout ,  D ,  E</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### è¾“å‡ºåˆ°æ§åˆ¶å° ###</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span> = <span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span> = <span class="string">System.out</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span> = <span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span> =  <span class="string">[%p][%d&#123;yyyy-MM-dd HH\:mm\:ss,SSS&#125;][%c]%m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ ###</span></span><br><span class="line"><span class="attr">log4j.appender.D</span> = <span class="string">org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.D.File</span> = <span class="string">$&#123;project&#125;src/main/resources/log/app.log</span></span><br><span class="line"><span class="attr">log4j.appender.D.Append</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">log4j.appender.D.Threshold</span> = <span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.appender.D.layout</span> = <span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.D.layout.ConversionPattern</span> = <span class="string">[%p][%d&#123;yyyy-MM-dd HH\:mm\:ss,SSS&#125;][%c]%m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### ä¿å­˜å¼‚å¸¸ä¿¡æ¯åˆ°å•ç‹¬æ–‡ä»¶ ###</span></span><br><span class="line"><span class="attr">log4j.appender.E</span> = <span class="string">org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.E.File</span> = <span class="string">$&#123;project&#125;src/main/resources/log/error.log</span></span><br><span class="line"><span class="attr">log4j.appender.E.Append</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">log4j.appender.E.Threshold</span> = <span class="string">ERROR</span></span><br><span class="line"><span class="attr">log4j.appender.E.layout</span> = <span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.E.layout.ConversionPattern</span> = <span class="string">[%p][%d&#123;yyyy-MM-dd HH\:mm\:ss,SSS&#125;][%c]%m%n</span></span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬ä¸‰æ­¥ï¼šç¼–å†™æµ‹è¯•ç±»"><a href="#ç¬¬ä¸‰æ­¥ï¼šç¼–å†™æµ‹è¯•ç±»" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šç¼–å†™æµ‹è¯•ç±»"></a>ç¬¬ä¸‰æ­¥ï¼šç¼–å†™æµ‹è¯•ç±»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.PropertyConfigurator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Log4jDemo</span> &#123;</span><br><span class="line">    <span class="comment">//private static Logger logger = LoggerFactory.getLogger(Log4jTestDemo.class);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•</span></span><br><span class="line">        String relativelyPath=System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®špropertiesæ–‡ä»¶ä½ç½®</span></span><br><span class="line">        PropertyConfigurator.configure(relativelyPath+ <span class="string">&quot;/src/main/resources/conf/log4j.properties&quot;</span>);</span><br><span class="line">        <span class="comment">// è®°å½•debugçº§åˆ«çš„ä¿¡æ¯</span></span><br><span class="line">        log.debug(<span class="string">&quot;This is debug message.&quot;</span>);</span><br><span class="line">        <span class="comment">// è®°å½•infoçº§åˆ«çš„ä¿¡æ¯</span></span><br><span class="line">        log.info(<span class="string">&quot;This is info message.&quot;</span>);</span><br><span class="line">        <span class="comment">// è®°å½•errorçº§åˆ«çš„ä¿¡æ¯</span></span><br><span class="line">        log.error(<span class="string">&quot;This is error message.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤éé…ç½®æ–‡ä»¶åœ¨resourcesç›®å½•ä¸‹ï¼Œå¦åˆ™ä¸èƒ½è‡ªå·±æ‰¾åˆ°é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œè¿˜éœ€è¦åœ¨ä»£ç ä¸­æŒ‡å®šä½ç½®ï¼Œä½æ•ˆï¼</p>
<p>è¿™ä¸ªé—®é¢˜è²Œä¼¼åœ¨springä¸­å¾—åˆ°è§£å†³ï¼Œåœ¨web.xmlä¸­å¢åŠ é…ç½®ï¼š</p>
<p><a href="https://blog.csdn.net/HenryMrZ/article/details/79258057">https://blog.csdn.net/HenryMrZ/article/details/79258057</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>log4jConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:/conf/log4j.properties<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="4-mavené¡¹ç›®æ‰“åŒ…"><a href="#4-mavené¡¹ç›®æ‰“åŒ…" class="headerlink" title="4.mavené¡¹ç›®æ‰“åŒ…"></a>4.mavené¡¹ç›®æ‰“åŒ…</h4><p>æœ‰ä¸ªé—®é¢˜ï¼šwebé¡¹ç›®è¿›è¡Œéƒ¨ç½²å‰ï¼Œå¿…é¡»è¦å°†é¡¹ç›®è¿›è¡Œæ‰“åŒ…å—ï¼Ÿ</p>
<p>ç›´æ¥éƒ¨ç½²åœ¨tomcatï¼Œå¹¶æ²¡æœ‰åœ¨targetæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°waråŒ…ã€‚</p>
<p>maven-webé¡¹ç›®è¦ä½¿ç”¨servletï¼Œå°±è¦å¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¼å…¥ä¹‹åreimportä¸€ä¸‹pom.xmlã€‚</p>
<p>å‘ç°éƒ¨ç½²ä¹‹åï¼ŒåŸæœ¬çš„System.getPropertyè¾“å‡ºçš„é¡¹ç›®ç›®å½•å˜æˆäº†tomcatçš„binç›®å½•ã€‚</p>
<h5 id="ä»‹ç»ä¸€ä¸‹System-getProperty"><a href="#ä»‹ç»ä¸€ä¸‹System-getProperty" class="headerlink" title="ä»‹ç»ä¸€ä¸‹System.getProperty()"></a>ä»‹ç»ä¸€ä¸‹System.getProperty()</h5><p>Javaä¸­ç»™æˆ‘ä»¬æä¾›äº†System.getProperty()è¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥è·å–åˆ°Java JVMä»¥åŠæ“ä½œç³»ç»Ÿçš„ä¸€äº›å‚æ•°ï¼Œå¯ä»¥ä¾›ç¨‹åºåˆ¤æ–­ç­‰ã€‚</p>
<p>System.getProperty()æ–¹æ³•ä¸­éœ€è¦ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²çš„å‚æ•°ï¼Œè¡¨ç¤ºéœ€è¦è·å–é‚£ä¸ªç¯å¢ƒé…ç½®ï¼Œè·å¾—ç»“æœä¸ºStringã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.getProperty(<span class="string">&quot;java.vm.version&quot;</span>);<span class="comment">//javaè™šæ‹Ÿæœºç‰ˆæœ¬  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;java.vendor.url&quot;</span>); <span class="comment">//javaå®˜æ–¹ç½‘ç«™  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;java.vm.nam&quot;</span>); <span class="comment">//javaè™šæ‹Ÿæœºåç§°  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;user.country&quot;</span>); <span class="comment">//å›½å®¶æˆ–åœ°åŒº  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;user.dir&quot;</span>); <span class="comment">//å·¥ç¨‹çš„è·¯å¾„  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;java.runtime.version&quot;</span>);<span class="comment">//javaè¿è¡Œç¯å¢ƒç‰ˆæœ¬  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;os.arch&quot;</span>); <span class="comment">//æ“ä½œç³»ç»Ÿä½æ•°ï¼ˆ32æˆ–64ï¼‰  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;os.name&quot;</span>); <span class="comment">//æ“ä½œç³»ç»Ÿåç§°  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;sun.jnu.encoding&quot;</span>); <span class="comment">//ç¼–ç æ ¼å¼  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;os.version&quot;</span>); <span class="comment">//æ“çºµç³»ç»Ÿç‰ˆæœ¬  </span></span><br><span class="line">System.getProperty(<span class="string">&quot;java.version&quot;</span>); <span class="comment">//javaç‰ˆæœ¬ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå¦‚ä½•æ‰¾åˆ°è·¯å¾„ä¸‹çš„log4j.propertiesé…ç½®æ–‡ä»¶å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> req.getServletContext().getRealPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">System.out.println(filePath); <span class="comment">// æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„</span></span><br><span class="line"><span class="comment">// æŒ‡å®špropertiesæ–‡ä»¶ä½ç½®</span></span><br><span class="line">PropertyConfigurator.configure(filePath + <span class="string">&quot;WEB-INF/classes/conf/log4j.properties&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="é¡¹ç›®ä¸­targetç›®å½•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#é¡¹ç›®ä¸­targetç›®å½•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="é¡¹ç›®ä¸­targetç›®å½•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>é¡¹ç›®ä¸­targetç›®å½•æ˜¯ä»€ä¹ˆï¼Ÿ</h5><p>targetæ˜¯ç”¨æ¥å­˜æ”¾é¡¹ç›®æ„å»ºåçš„æ–‡ä»¶å’Œç›®å½•ã€jaråŒ…ã€waråŒ…ã€ç¼–è¯‘çš„classæ–‡ä»¶ï¼Œæ‰€æœ‰éƒ½æ˜¯Mavenæ„å»ºæ—¶ç”Ÿæˆçš„ã€‚</p>
<p><a href="https://blog.51cto.com/zhangzhixi/5102490?b=totalstatistic">https://blog.51cto.com/zhangzhixi/5102490?b=totalstatistic</a></p>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼štomcatè¿è¡Œä¹‹åï¼Œæ—¥å¿—ä¸ä¿å­˜åœ¨æ–‡ä»¶ä¸­äº†ï¼Œéš¾é“æ˜¯è¯†åˆ«ä¸äº†projectç›®å½•äº†å—ï¼Ÿ</p>
<p>ç¡®å®ï¼Œlogè¾“å‡ºåˆ°äº†tomcatä¸­çš„binç›®å½•ä¸­ã€‚æ”¹æˆç»å¯¹ç›®å½•ã€‚</p>
<h5 id="æ‰“åŒ…éƒ¨ç½²"><a href="#æ‰“åŒ…éƒ¨ç½²" class="headerlink" title="æ‰“åŒ…éƒ¨ç½²"></a>æ‰“åŒ…éƒ¨ç½²</h5><p>ç”±äºwebé¡¹ç›®æ²¡æœ‰å†™javaæ–‡ä»¶æ²¡æœ‰mainå‡½æ•°, æ˜¯æ— æ³•ç›´æ¥è¿è¡Œçš„, å› æ­¤webé¡¹ç›®éœ€è¦æ”¾åœ¨ä¸€ä¸ªå®¹å™¨é‡Œæ‰èƒ½è¿è¡Œ</p>
<p>è¿™é‡Œå°±å°†webé¡¹ç›®æ”¾åœ¨Tomcatè¿™ä¸ªwebæœåŠ¡å™¨é‡Œè¿è¡Œ</p>
<p>åŸºäºmavençš„webé¡¹ç›® â€œ æ‰“åŒ…ã€éƒ¨ç½²ã€ä½¿ç”¨â€ æ“ä½œæ­¥éª¤å¦‚ä¸‹:</p>
<ol>
<li>æ‰“åŒ…ï¼šåœ¨IDEAä¸»ç•Œé¢çš„å³è¾¹æ‰¾åˆ°maven, åœ¨mavençš„ç”Ÿå‘½å‘¨æœŸLifecycleä¸‹é¢æ‰¾åˆ°package, åŒå‡»packageå‘½ä»¤è¿›è¡Œè¿è¡Œã€‚åº•ä¸‹çš„æ§åˆ¶å°æç¤º BUILD SUCCESS ä»£è¡¨æ„å»ºæˆåŠŸã€‚æ„å»ºæˆåŠŸä¹‹å, æ ¹æ®æ§åˆ¶å°é‡Œæç¤ºçš„waråŒ…è·¯å¾„æ‰¾åˆ°warçš„ä½ç½®ã€‚</li>
<li>éƒ¨ç½²ï¼šâ€éƒ¨ç½²â€œ æ“ä½œ      (éƒ¨ç½²å°±æ˜¯æ‰‹åŠ¨æŠŠæ‰“åŒ…å¥½çš„waråŒ…å¤åˆ¶åˆ°tomcat-webappsä¸‹è¾¹)</li>
</ol>
<blockquote>
<p>ä¸æ‰“jaråŒ…è¿è¡Œï¼Œtomcatæ–‡ä»¶å¤¹ä¸‹æ²¡æœ‰åº”ç”¨çš„ç—•è¿¹å•Šã€‚ã€todoã€‘åº”è¯¥æ˜¯æŠŠwaråŒ…æ”¾åœ¨tomcatç›®å½•ä¸‹å’Œideaä¸­å¯åŠ¨ä¸å¤ªä¸€æ ·ã€‚ideaä¸­éœ€è¦ideaä¸€ç›´åœ¨è¿è¡ŒçŠ¶æ€ã€‚ä½†æ˜¯ideaä¸­è¿è¡Œçš„ä¹Ÿæ˜¯tomcatï¼Ÿ</p>
</blockquote>
<ol start="3">
<li><p>è¿è¡Œï¼Œé¦–å…ˆå°†TomcatåŠ è½½åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡</p>
<blockquote>
<p>é…ç½®tomcatç¯å¢ƒå˜é‡ï¼š</p>
<p>å¦‚æœä¸é…ç½®çš„è¯ï¼Œéœ€è¦æ¯æ¬¡éƒ½è¿›åˆ°tomcatçš„binç›®å½•ä¸‹è¿è¡Œstartup.shå¯åŠ¨ã€‚</p>
<p>åœ¨ ï½&#x2F;.zprofile æ–‡ä»¶ä¸­å¢åŠ   export PATH&#x3D;${PATH}:tomcat binç›®å½•</p>
<p>â€‹    è¯­æ³•ï¼š</p>
<p>â€‹    ${}ä¸ºå ä½ç¬¦ï¼Œ${PATH} å’Œ $PATHç­‰æ•ˆ</p>
<p>â€‹    &#x3D;å‰åä¸èƒ½æœ‰ç©ºæ ¼</p>
<p>â€‹    : ä¸ºåˆ†éš”ç¬¦ï¼ˆç­‰åŒäºwindowsç¯å¢ƒå˜é‡ä¸­çš„ ; ï¼‰</p>
<p>â€‹    PATH&#x3D;$PATH:xxx å¯ä»¥ç†è§£ä¸º â€œ PATH+&#x3D;xxx â€œï¼ˆå½“ç„¶ä¸èƒ½è¿™ä¹ˆå†™ï¼‰<br>â€‹    PATH&#x3D;xxx:$PATHè¿™ç§å†™æ³•äº¦å¯ï¼Œåªæ˜¯å‰åé¡ºåºçš„é—®é¢˜ï¼›</p>
<p>export -p æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡</p>
<ol>
<li>sudo su ç”³è¯·æƒé™</li>
<li>startup.sh            &#x2F;&#x2F;å¯åŠ¨tomacat</li>
<li>shutdown.sh          &#x2F;&#x2F;å…³é—­tomcat</li>
</ol>
</blockquote>
</li>
</ol>
<p>å¯åŠ¨ä¹‹åï¼Œå¥½å¥‡æ—¶ä¸€ç›´åœ¨è¿è¡Œè¿˜æ˜¯æ€ä¹ˆçš„ï¼Œåº”è¯¥æ˜¯ä¸€ç›´åœ¨è¿è¡Œã€‚èµ·ä¸ªå®šæ—¶çº¿ç¨‹è¯•ä¸€ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ScheduledExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newSingleThreadScheduledExecutor();</span><br><span class="line">service.scheduleAtFixedRate(()-&gt;&#123;</span><br><span class="line">    log.info(<span class="string">&quot;Thread &#123;&#125;, now &#123;&#125;.&quot;</span>, Thread.currentThread(), <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">&#125;, <span class="number">1</span>, <span class="number">3</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<p>æŠ¥ä¸èƒ½ç”¨lambadaè¡¨è¾¾å¼çš„é”™è¯¯ï¼Œæˆ‘æ”¹äº†levelç­‰çº§ä¸º8ï¼Œæ‰“åŒ…æ—¶è¿˜æŠ¥é”™ã€‚ä¸ç”¨è¯•äº†ï¼Œåªè¦tomcatå¼€çš„ï¼Œåº”ç”¨å°±ä¸€ç›´æ˜¯èµ·çš„ã€‚æ¯è®¿é—®ä¸€æ¬¡ï¼Œlogæ–‡ä»¶ä¸­å°±è®°å½•æ—¥å¿—ã€‚</p>
<h3 id="mavenæ‰“åŒ…"><a href="#mavenæ‰“åŒ…" class="headerlink" title="mavenæ‰“åŒ…"></a>mavenæ‰“åŒ…</h3><h4 id="1-ideaä¸­ä½¿ç”¨mavenæ’ä»¶æ‰“åŒ…"><a href="#1-ideaä¸­ä½¿ç”¨mavenæ’ä»¶æ‰“åŒ…" class="headerlink" title="1.ideaä¸­ä½¿ç”¨mavenæ’ä»¶æ‰“åŒ…"></a>1.ideaä¸­ä½¿ç”¨mavenæ’ä»¶æ‰“åŒ…</h4><p>ä¸Šé¢å°±æ˜¯ç”¨æ­¤æ“ä½œï¼Œåº”è¯¥å…ˆcleanï¼Œå†compileç¼–è¯‘ï¼Œå†æ‰“åŒ…çš„ã€‚</p>
<p>mvn clean æ¸…ç©ºclassæ–‡ä»¶<br>mvn compile ç¼–è¯‘<br>mvn package æ‰“åŒ…<br>mvn test æµ‹è¯•<br>mvn install æ‰“åŒ…å¹¶ä¸Šä¼ åˆ°æœ¬åœ°ä»“åº“<br>mvn deploy ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“<br>mvn -Dmaven.test.skip&#x3D;true è·³è¿‡æµ‹è¯•</p>
<p>pomä¸­çš„æ’ä»¶åº”è¯¥æ˜¯è‡ªåŠ¨ç»™æˆ‘åŠ çš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>log-maven-package<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span><span class="comment">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-clean-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- see http://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.22.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-install-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-deploy-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>  è¿™ç§æ‰“åŒ…æ–¹å¼ä¼šæœ‰å¤–éƒ¨ä¾èµ–åŒ…ã€‚</p>
<h4 id="2-ç›´æ¥ä½¿ç”¨mvn-packageæ‰“åŒ…"><a href="#2-ç›´æ¥ä½¿ç”¨mvn-packageæ‰“åŒ…" class="headerlink" title="2.ç›´æ¥ä½¿ç”¨mvn packageæ‰“åŒ…"></a>2.ç›´æ¥ä½¿ç”¨mvn packageæ‰“åŒ…</h4><p>ä¸åœ¨ POM ä¸­é…ç½®ä»»ä½•æ’ä»¶ï¼Œç›´æ¥ä½¿ç”¨ <code>mvn package</code> è¿›è¡Œé¡¹ç›®æ‰“åŒ…ï¼Œè¿™å¯¹äºæ²¡æœ‰ä½¿ç”¨å¤–éƒ¨ä¾èµ–åŒ…çš„é¡¹ç›®æ˜¯å¯è¡Œçš„ã€‚ä½†å¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹ JAR åŒ…ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸º <code>mvn package</code> æ‰“çš„ JAR åŒ…ä¸­æ˜¯ä¸å«æœ‰ä¾èµ–åŒ…ï¼Œä¼šå¯¼è‡´ä½œä¸šè¿è¡Œæ—¶å‡ºç°æ‰¾ä¸åˆ°ç¬¬ä¸‰æ–¹ä¾èµ–çš„å¼‚å¸¸ã€‚è¿™ç§æ–¹å¼å±€é™æ€§æ¯”è¾ƒå¤§ï¼Œå› ä¸ºå®é™…çš„é¡¹ç›®å¾€å¾€å¾ˆå¤æ‚ï¼Œé€šå¸¸éƒ½ä¼šä¾èµ–ç¬¬ä¸‰æ–¹ JARã€‚</p>
<p>å¤§æ•°æ®æ¡†æ¶çš„å¼€å‘è€…ä¹Ÿè€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥åŸºæœ¬æ‰€æœ‰çš„æ¡†æ¶éƒ½æ”¯æŒåœ¨æäº¤ä½œä¸šæ—¶ä½¿ç”¨ <code>--jars</code> æŒ‡å®šç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼çš„é—®é¢˜åŒæ ·å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯ä½ å¿…é¡»ä¿æŒç”Ÿäº§ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒä¸­çš„æ‰€æœ‰ JAR åŒ…ç‰ˆæœ¬ä¸€è‡´ï¼Œè¿™æ˜¯æœ‰ç»´æŠ¤æˆæœ¬çš„ã€‚</p>
<p>åŸºäºä¸Šé¢è¿™äº›åŸå› ï¼Œæœ€ç®€å•çš„æ˜¯é‡‡ç”¨ <code>All In One</code> çš„æ‰“åŒ…æ–¹å¼ï¼ŒæŠŠæ‰€æœ‰ä¾èµ–éƒ½æ‰“åŒ…åˆ°ä¸€ä¸ª JAR æ–‡ä»¶ä¸­ï¼Œæ­¤æ—¶å¯¹ç¯å¢ƒçš„ä¾èµ–æ€§æœ€å°ã€‚è¦å®ç°è¿™ä¸ªç›®çš„ï¼Œå¯ä»¥ä½¿ç”¨ Maven æä¾›çš„ <code>maven-assembly-plugin</code> æˆ– <code>maven-shade-plugin</code> æ’ä»¶ã€‚</p>
<blockquote>
<p>æˆ‘ç›´æ¥ä½¿ç”¨mvn package æŠ¥é”™è¯¯</p>
<p>[ERROR] No compiler is provided in this environment. Perhaps you are running on a JRE rather than a JDK?</p>
<p>æœªè§£å†³</p>
</blockquote>
<h4 id="3-maven-assembly-pluginæ’ä»¶"><a href="#3-maven-assembly-pluginæ’ä»¶" class="headerlink" title="3.maven-assembly-pluginæ’ä»¶"></a>3.maven-assembly-pluginæ’ä»¶</h4><p><code>Assembly</code> æ’ä»¶æ”¯æŒå°†é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ã€æ–‡ä»¶éƒ½æ‰“åŒ…åˆ°åŒä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ä¸­ã€‚ç›®å‰æ”¯æŒè¾“å‡ºä»¥ä¸‹æ–‡ä»¶ç±»å‹ï¼š</p>
<ul>
<li>zip</li>
<li>tar</li>
<li>tar.gz (or tgz)</li>
<li>tar.bz2 (or tbz2)</li>
<li>tar.snappy</li>
<li>tar.xz (or txz)</li>
<li>jar</li>
<li>dir</li>
<li>war</li>
</ul>
<p><strong>åŸºæœ¬ä½¿ç”¨</strong></p>
<p>åœ¨ POM.xml ä¸­å¼•å…¥æ’ä»¶ï¼ŒæŒ‡å®šæ‰“åŒ…æ ¼å¼çš„é…ç½®æ–‡ä»¶ <code>assembly.xml</code>(åç§°å¯è‡ªå®šä¹‰)ï¼Œå¹¶æŒ‡å®šä½œä¸šçš„ä¸»å…¥å£ç±»ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é¡¹ç›®æœ€ç»ˆæ‰“åŒ…æˆçš„åå­— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>community<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">descriptors</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptor</span>&gt;</span>src/main/resources/assembly.xml<span class="tag">&lt;/<span class="name">descriptor</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">descriptors</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- æŒ‡å®šå¯åŠ¨ç±» --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.liuxuan.Log4jDemo<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>assembly.xml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">assembly</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/ASSEMBLY/2.0.0&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/ASSEMBLY/2.0.0 </span></span></span><br><span class="line"><span class="string"><span class="tag">                              http://maven.apache.org/xsd/assembly-2.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æŒ‡æ˜æ‰“åŒ…æ–¹å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">formats</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">format</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">format</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">formats</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">includeBaseDirectory</span>&gt;</span>false<span class="tag">&lt;/<span class="name">includeBaseDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencySets</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>/<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">useProjectArtifact</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useProjectArtifact</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">unpack</span>&gt;</span>true<span class="tag">&lt;/<span class="name">unpack</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--è¿™é‡Œä»¥æ’é™¤ storm ç¯å¢ƒä¸­å·²ç»æä¾›çš„ storm-core ä¸ºä¾‹ï¼Œæ¼”ç¤ºæ’é™¤ Jar åŒ…--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>org.apache.storm:storm-core<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencySets</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">assembly</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‡‡ç”¨ maven-assembly-plugin è¿›è¡Œæ‰“åŒ…æ—¶å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<p>mvn assembly:assembly </p>
<blockquote>
<p>é—®é¢˜ï¼šä½¿ç”¨å‘½ä»¤mvn compile æ—¶ï¼Œä¼šæŠ¥é”™ no compilerï¼Œä½†æ˜¯ideaä¸­ç‚¹å‡»æ—¶æ²¡é—®é¢˜ã€‚æ‰€ä»¥å¾—å…ˆç‚¹compileç¼–è¯‘ï¼Œå†æ‰§è¡Œassemblyå‘½ä»¤ã€‚</p>
</blockquote>
<p>æ‰“åŒ…åä¼šåŒæ—¶ç”Ÿæˆä¸¤ä¸ª JAR åŒ…ï¼Œå…¶ä¸­åç¼€ä¸º <code>jar-with-dependencies</code> æ˜¯å«æœ‰ç¬¬ä¸‰æ–¹ä¾èµ–çš„ JAR åŒ…ï¼Œåç¼€æ˜¯ç”± <code>assembly.xml</code> ä¸­ <code>&lt;id&gt;</code> æ ‡ç­¾æŒ‡å®šçš„ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¿®æ”¹ã€‚</p>
<h4 id="4-maven-shade-pluginæ’ä»¶"><a href="#4-maven-shade-pluginæ’ä»¶" class="headerlink" title="4.maven-shade-pluginæ’ä»¶"></a>4.maven-shade-pluginæ’ä»¶</h4><p><code>maven-shade-plugin</code> æ¯” <code>maven-assembly-plugin</code> åŠŸèƒ½æ›´ä¸ºå¼ºå¤§ï¼Œæ¯”å¦‚ä½ çš„å·¥ç¨‹ä¾èµ–å¾ˆå¤šçš„ JAR åŒ…ï¼Œè€Œè¢«ä¾èµ–çš„ JAR åˆä¼šä¾èµ–å…¶ä»–çš„ JAR åŒ…ï¼Œè¿™æ ·,å½“å·¥ç¨‹ä¸­ä¾èµ–åˆ°ä¸åŒçš„ç‰ˆæœ¬çš„ JAR æ—¶ï¼Œå¹¶ä¸” JAR ä¸­å…·æœ‰ç›¸åŒåç§°çš„èµ„æºæ–‡ä»¶æ—¶ï¼Œshade æ’ä»¶ä¼šå°è¯•å°†æ‰€æœ‰èµ„æºæ–‡ä»¶æ‰“åŒ…åœ¨ä¸€èµ·æ—¶ï¼Œè€Œä¸æ˜¯å’Œ assembly ä¸€æ ·æ‰§è¡Œè¦†ç›–æ“ä½œã€‚</p>
<p><strong>é€šå¸¸ä½¿ç”¨ <code>maven-shade-plugin</code> å°±èƒ½å¤Ÿå®Œæˆå¤§å¤šæ•°çš„æ‰“åŒ…éœ€æ±‚ï¼Œå…¶é…ç½®ç®€å•ä¸”é€‚ç”¨æ€§æœ€å¹¿ï¼Œå› æ­¤å»ºè®®ä¼˜å…ˆä½¿ç”¨æ­¤æ–¹å¼ã€‚</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é¡¹ç›®æœ€ç»ˆæ‰“åŒ…æˆçš„åå­— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>community<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">transformers</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- æŒ‡å®šå¯åŠ¨ç±» --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">transformer</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">implementation</span>=<span class="string">&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.ronz.community.CommunityApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">                            </span><br><span class="line">                            <span class="comment">&lt;!-- ä¸‹é¢çš„é…ç½®ä»…é’ˆå¯¹å­˜åœ¨åŒåèµ„æºæ–‡ä»¶çš„æƒ…å†µï¼Œå¦‚æ²¡æœ‰åˆ™ä¸ç”¨é…ç½®--&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- æœ‰äº›é¡¹ç›®åŒ…å¯èƒ½ä¼šåŒ…å«åŒæ–‡ä»¶åçš„èµ„æºæ–‡ä»¶ï¼ˆä¾‹å¦‚å±æ€§æ–‡ä»¶ï¼‰--&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- ä¸ºé¿å…è¦†ç›–ï¼Œå¯ä»¥å°†å®ƒä»¬çš„å†…å®¹åˆå¹¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">transformer</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">implementation</span>=<span class="string">&quot;org.apache.maven.plugins.shade.resource.AppendingTransformer&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">resource</span>&gt;</span>META-INF/spring.handlers<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">transformer</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">implementation</span>=<span class="string">&quot;org.apache.maven.plugins.shade.resource.AppendingTransformer&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">resource</span>&gt;</span>META-INF/spring.schemas<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">transformers</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ maven-shade-plugin è¿›è¡Œæ‰“åŒ…çš„æ—¶å€™ï¼Œæ‰“åŒ…å‘½ä»¤å’Œæ™®é€šæ‰“åŒ…ä¸€æ ·</p>
<p>mvn package</p>
<h4 id="5-ä½¿ç”¨-maven-jar-plugin-å’Œ-maven-dependency-plugin-æ’ä»¶"><a href="#5-ä½¿ç”¨-maven-jar-plugin-å’Œ-maven-dependency-plugin-æ’ä»¶" class="headerlink" title="5.ä½¿ç”¨ maven-jar-plugin å’Œ maven-dependency-plugin æ’ä»¶"></a>5.ä½¿ç”¨ maven-jar-plugin å’Œ maven-dependency-plugin æ’ä»¶</h4><p>æ­¤ç§æ‰“åŒ…æ–¹å¼æœ‰ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„ç¼ºç‚¹ï¼šæ‰“åŒ…åä¼šåœ¨ <code>target</code> ç›®å½•ä¸‹ç”Ÿæˆ <code>lib</code> ç›®å½•ï¼ˆå­˜æ”¾ä¾èµ– Jarï¼‰å’Œé¡¹ç›® Jarã€‚ä¹Ÿå°±æ˜¯è¯´ç”±äºä¾èµ–éƒ½å­˜åœ¨äº <code>lib</code> ç›®å½•ä¸­ï¼Œæ‰€ä»¥è¦æƒ³è¿è¡Œ Jar åŒ…ï¼Œå¿…é¡»å°† Jar åŒ…å’Œ <code>lib</code>ç›®å½•æ”¾åœ¨åŒä¸€ä¸ªè·¯å¾„ä¸‹ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é¡¹ç›®æœ€ç»ˆæ‰“åŒ…æˆçš„åå­— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>community<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- ä¼šåœ¨ MANIFEST.MF ä¸­ç”Ÿæˆ Class-Path é¡¹ --&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- ç³»ç»Ÿä¼šæ ¹æ® Class-Path é¡¹é…ç½®çš„è·¯å¾„åŠ è½½ä¾èµ– --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- æŒ‡å®šä¾èµ–åŒ…æ‰€åœ¨ç›®å½•ï¼Œç›¸å¯¹äºé¡¹ç›®æœ€ç»ˆ Jar åŒ…çš„è·¯å¾„ --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">classpathPrefix</span>&gt;</span>lib/<span class="tag">&lt;/<span class="name">classpathPrefix</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- æŒ‡å®š MainClass --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.ronz.community.CommunityApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®ä¾èµ–åŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ç›¸å½“äºæ‰§è¡Œ mvn å‘½ä»¤ï¼Œå°†ä¾èµ–æ‰“åŒ…åˆ°æŒ‡å®šç›®å½• --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--å°†ä¾èµ–æ‰“åŒ…è‡³ target ä¸‹çš„ lib ç›®å½•--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ€æƒ³ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p>
<p>é¦–å…ˆè¯´ maven-jar-plugin æ’ä»¶ï¼Œå®ƒçš„æ€æƒ³å°±æ˜¯ï¼šæŒ‡å®šå¯åŠ¨ç±»ã€æŒ‡å®šä¾èµ–åŒ…ç›¸å¯¹äºé¡¹ç›®æœ€ç»ˆ Jar åŒ…æ‰€åœ¨çš„è·¯å¾„ã€ç»™ MANIFEST.MF æ–‡ä»¶æ·»åŠ  Class-Path å±æ€§ï¼ˆè¿è¡Œé¡¹ç›® Jar åŒ…æ—¶ä¼šæ ¹æ® Class-Path å±æ€§æ¥æ‰¾åˆ°å…·ä½“ä¾èµ– Jar åŒ…çš„è·¯å¾„ï¼‰ã€‚</p>
<p>æ¥ç€æ˜¯ maven-dependency-plugin æ’ä»¶ï¼Œå®ƒçš„ä¸»è¦æ€æƒ³å°±æ˜¯ï¼šæŒ‡å®šæ‰€æœ‰ä¾èµ–è¢«æ‰“åŒ…ä¸º Jar åŒ…åçš„å­˜æ”¾è·¯å¾„ã€‚</p>
<p>pom.xml æ–‡ä»¶é…ç½®å®Œæ¯•ä¹‹åï¼Œå°±å¯ä»¥è¿è¡Œæ‰“åŒ…å‘½ä»¤äº†ï¼š<br><em># è·³è¿‡æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œ package å‘½ä»¤</em> mvn package -Dmaven.test.skip&#x3D;true</p>
<p>è¿™ç§æ–¹å¼æ‰“åŒ…å‡ºæ¥çš„ Jar åŒ…ï¼Œåœ¨ä»£ç å±‚é¢åªåŒ…å«äº†é¡¹ç›®æœ¬èº«çš„ä»£ç ã€‚è€Œé¡¹ç›®çš„ä¾èµ–éƒ½ä»¥ Jar åŒ…çš„å½¢å¼æ”¾åœ¨äº†é¡¹ç›® Jar åŒ…åŒçº§åˆ«ç›®å½•ä¸‹çš„ <code>lib</code> ç›®å½•ä¸­ï¼Œè¿™äº›ä¾èµ– Jar åŒ…çš„è·¯å¾„åœ¨ <code>MANIFEST.MF</code> æ–‡ä»¶ä¸­éƒ½ä»¥è·¯å¾„çš„æ–¹å¼æŒ‡æ˜äº†ã€‚</p>
<h4 id="æ‰“åŒ…æ€»ç»“"><a href="#æ‰“åŒ…æ€»ç»“" class="headerlink" title="æ‰“åŒ…æ€»ç»“"></a>æ‰“åŒ…æ€»ç»“</h4><p>å·¥ä½œä¸­ç”¨åˆ°çš„å‘½ä»¤åªæ˜¯ï¼šmvn package -Dmaven.test.skip&#x3D;trueï¼Œä½†æ˜¯çœ‹é¡¹ç›®ä¸­è²Œä¼¼ä½¿ç”¨çš„æ˜¯assemblyã€‚</p>
<p>æ¨èä½¿ç”¨maven-shade-pluginæ’ä»¶ï¼Œå¯ä»¥é¿å…å‰é¢çš„èµ„æºæ–‡ä»¶è¢«åé¢çš„è¦†ç›–æ‰ã€‚</p>
<p>åªæ˜¯mvn compile è¿™ä¸ªé—®é¢˜è¿˜æ²¡è§£å†³ï¼Œä¸ºä»€ä¹ˆideaä¸­ç‚¹å‡»compileèƒ½å¤Ÿç¼–è¯‘ï¼Œç»ˆç«¯æ‰§è¡Œå‘½ä»¤å´ä¸è¡Œã€‚</p>
<h3 id="githubåœ°å€"><a href="#githubåœ°å€" class="headerlink" title="githubåœ°å€"></a>githubåœ°å€</h3><p><a href="https://github.com/jadeliuliu/log-maven-package/tree/master">https://github.com/jadeliuliu/log-maven-package/tree/master</a></p>
<p>æ‘˜è‡ªï¼š</p>
<p>slf4jã€log4jã€logbackï¼š<a href="https://www.cnblogs.com/javalinux/p/15683735.html">https://www.cnblogs.com/javalinux/p/15683735.html</a></p>
<p>logå‘å±•å²ï¼š<a href="https://juejin.cn/post/7033021644142542878">https://juejin.cn/post/7033021644142542878</a></p>
<p>ideaä¸­åˆ›å»ºmaven webé¡¹ç›®ï¼š<a href="https://www.cnblogs.com/weiqingfeng/p/9494914.html">https://www.cnblogs.com/weiqingfeng/p/9494914.html</a></p>
<p>macåŒºåˆ†.bash_profile å’Œ&#x2F;etc&#x2F;profileï¼š<a href="https://blog.csdn.net/weixin_42214743/article/details/116133257">https://blog.csdn.net/weixin_42214743/article/details/116133257</a></p>
<p>bashå’Œzshï¼š<a href="https://www.zhihu.com/question/20036548/answer/2345481001">https://www.zhihu.com/question/20036548/answer/2345481001</a></p>
<p>log4jé…ç½®æ–‡ä»¶ï¼š<a href="http://www.blogjava.net/zJun/archive/2006/06/28/55511.html">http://www.blogjava.net/zJun/archive/2006/06/28/55511.html</a></p>
<p>mavené¡¹ç›®æ‰“åŒ…éƒ¨ç½²åˆ°tomcatï¼š<a href="https://blog.csdn.net/asdx1020/article/details/104554811">https://blog.csdn.net/asdx1020/article/details/104554811</a>   &amp;&amp;   <a href="https://blog.csdn.net/Shangxingya/article/details/107295800">https://blog.csdn.net/Shangxingya/article/details/107295800</a></p>
<p>å¸¸ç”¨mavenæ‰“åŒ…æ–¹å¼ï¼š<a href="https://juejin.cn/post/6844904067194437639#heading-1">https://juejin.cn/post/6844904067194437639#heading-1</a>   &amp;&amp; <a href="https://blog.csdn.net/zhuxian1277/article/details/119880760">https://blog.csdn.net/zhuxian1277/article/details/119880760</a></p>
<h3 id="logæ—¥å¿—æ€ä¹ˆä¼ å‚"><a href="#logæ—¥å¿—æ€ä¹ˆä¼ å‚" class="headerlink" title="logæ—¥å¿—æ€ä¹ˆä¼ å‚"></a>logæ—¥å¿—æ€ä¹ˆä¼ å‚</h3><p>ä¸åŒäºString.formatå’Œsoutï¼Œlogä½¿ç”¨å ä½ç¬¦ä¼ å‚ï¼Œå°±æ˜¯{}ï¼Œå‰é¢ç”¨:è¿˜æ˜¯&#x3D;è¿˜æ˜¯å…¶ä»–æ— æ‰€è°“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">log.info(&quot;remindï¼šorderInfo:&#123;&#125;&quot;, JSON.toJSONString(orderInfo));</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯log.erroré‡Œé¢è¿˜æœ‰Exceptionå¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆæ‰“å°:<br>å¯¹äºå¼‚å¸¸ï¼Œæ˜¯ä¸éœ€è¦å ä½ç¬¦çš„ï¼Œè€Œä¸”ä¹Ÿä¸éœ€è¦ e.getMessage()ï¼Œç›´æ¥æ‰“å°å‡ºæ¥å³å¯.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">&#125; catch (Exeception e) &#123;</span><br><span class="line">    log.error(&quot;error in order:&#123;&#125;&quot;, JSON.toJSONString(orderInfo), e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="logæ—¥å¿—çº§åˆ«å¼€å…³"><a href="#logæ—¥å¿—çº§åˆ«å¼€å…³" class="headerlink" title="logæ—¥å¿—çº§åˆ«å¼€å…³"></a>logæ—¥å¿—çº§åˆ«å¼€å…³</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(log.isDebugEnabled()) &#123;</span><br><span class="line">    log.debug();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>maven</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ssmæ˜¯ä»€ä¹ˆ</title>
    <url>/2022/06/25/myblog/java/ssm/</url>
    <content><![CDATA[<p>SSMæ¡†æ¶ï¼šSpring + SpringMVC + MyBatis</p>
<p>Springå’ŒSpringMVCæ˜¯å½“å‰ä¼ä¸šå¼€å‘å¿…ç”¨æ¡†æ¶ä¹‹ä¸€ï¼ŒMyBatisåˆ™æ˜¯ä¸æ•°æ®åº“äº¤äº’çš„æŒä¹…å±‚æ¡†æ¶ä¹‹ä¸€ï¼Œç”±äºæ˜“ç”¨æ€§å’Œè½»ä¾¿æ€§ï¼Œåˆ™è¢«å¤§å¤šäº’è”ç½‘å…¬å¸æ‰€é€‰ç”¨ã€‚SSMåŸºç¡€æ¡†æ¶çš„æŒæ¡æ˜¯å½“å‰ä¼ä¸šå¼€å‘æœ€åŸºæœ¬çš„è¦æ±‚ï¼Œä¹Ÿæ˜¯å…¶ä»–æŠ€æœ¯å­¦ä¹ å’Œè¿›é˜¶çš„å¿…è¦åŸºç¡€ã€‚</p>
<p>bç«™è§†é¢‘åœ°å€ï¼š<a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=42">https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=42</a></p>
<h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><h3 id="SpringMVCç®€ä»‹"><a href="#SpringMVCç®€ä»‹" class="headerlink" title="SpringMVCç®€ä»‹"></a>SpringMVCç®€ä»‹</h3><p>MVCæ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>MVC æ¨¡å¼ä»£è¡¨ Model-View-Controllerï¼ˆæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼‰ æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ç”¨äºåº”ç”¨ç¨‹åºçš„åˆ†å±‚å¼€å‘ã€‚</p>
<ul>
<li><strong>Modelï¼ˆæ¨¡å‹ï¼‰</strong> - æ¨¡å‹ä»£è¡¨ä¸€ä¸ªå­˜å–æ•°æ®çš„å¯¹è±¡æˆ– JAVA POJOã€‚å®ƒä¹Ÿå¯ä»¥å¸¦æœ‰é€»è¾‘ï¼Œåœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–°æ§åˆ¶å™¨ã€‚</li>
<li><strong>Viewï¼ˆè§†å›¾ï¼‰</strong> - è§†å›¾ä»£è¡¨æ¨¡å‹åŒ…å«çš„æ•°æ®çš„å¯è§†åŒ–ã€‚</li>
<li><strong>Controllerï¼ˆæ§åˆ¶å™¨ï¼‰</strong> - æ§åˆ¶å™¨ä½œç”¨äºæ¨¡å‹å’Œè§†å›¾ä¸Šã€‚å®ƒæ§åˆ¶æ•°æ®æµå‘æ¨¡å‹å¯¹è±¡ï¼Œå¹¶åœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–°è§†å›¾ã€‚å®ƒä½¿è§†å›¾ä¸æ¨¡å‹åˆ†ç¦»å¼€ã€‚</li>
</ul>
<p>SpringMVCæ¦‚è¿°ï¼Ÿ</p>
<p>SpringMVCæ˜¯ä¸€ç§åŸºäºJavaå®ç°çš„MVCè®¾è®¡æ¨¡å‹çš„è¯·æ±‚é©±åŠ¨ç±»å‹çš„è½»é‡çº§Webæ¡†æ¶ï¼Œå±äºSpringFrameWorkçš„åç»­äº§å“ï¼Œå·²ç»èåˆåœ¨Spring Web Flowä¸­ã€‚</p>
<p>SpringMVCå·²ç»æˆä¸ºç›®å‰æœ€ä¸»æµçš„MVCæ¡†æ¶ä¹‹ä¸€ï¼Œå¹¶ä¸”éšç€Spring3.0çš„å‘å¸ƒï¼Œå…¨é¢è¶…è¶ŠStructs2ï¼Œæˆä¸ºæœ€ä¼˜ç§€çš„MVCæ¡†æ¶ã€‚å®ƒé€šè¿‡ä¸€å¥—æ³¨è§£ï¼Œè®©ä¸€ä¸ªç®€å•çš„Javaç±»æˆä¸ºå¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨ï¼Œè€Œæ— é¡»å®ç°ä»»ä½•æ¥å£ã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒRESTfulç¼–ç¨‹é£æ ¼çš„è¯·æ±‚ã€‚webæ–‡ä»¶å¤¹å†…serveletï¼Ÿ</p>
<h3 id="MyBatisç®€ä»‹"><a href="#MyBatisç®€ä»‹" class="headerlink" title="MyBatisç®€ä»‹"></a>MyBatisç®€ä»‹</h3><p>æŒä¹…å±‚æ¡†æ¶ï¼Œæ–¹ä¾¿æ•°æ®åº“æ“ä½œçš„ã€‚</p>
<p>åŸå§‹æ¯”è¾ƒç¹ççš„jdbcæ“ä½œï¼šæ³¨å†Œé©±åŠ¨â€“è·å¾—è¿æ¥â€“è·å¾—statementâ€“æ‰§è¡ŒæŸ¥è¯¢â€“éå†ç»“æœé›†ï¼ˆå°è£…å®ä½“ï¼Œä¼ é€’ï¼‰â€“é‡Šæ”¾èµ„æºã€‚</p>
<p>ç¼ºç‚¹ï¼šä»£ç é‡å¤ï¼ˆæ¯”å¦‚è·å¾—è¿æ¥èµ„æºï¼‰ï¼Œèµ„æºé¢‘ç¹è¿æ¥å…³é—­ï¼Œæ¶ˆè€—èµ„æºï¼Œsqlè¯­å¥æ¯”è¾ƒæ­»ï¼Œå¾—è§£è€¦åˆï¼Œç”¨é…ç½®æ–‡ä»¶ã€‚</p>
<p>jdbcç¼ºç‚¹ï¼šï¼ˆ1ï¼‰æ•°æ®åº“åˆ›å»ºã€é‡Šæ”¾èµ„æºé€ æˆç³»ç»Ÿèµ„æºæµªè´¹ä»è€Œå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚ï¼ˆ2ï¼‰sqlè¯­å¥åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ï¼Œé€ æˆä»£ç ä¸æ˜“ç»´æŠ¤ï¼Œå®é™…åº”ç”¨sqlå˜åŒ–çš„å¯èƒ½è¾ƒå¤§ï¼Œsqlå˜åŠ¨éœ€è¦æ”¹å˜javaä»£ç ï¼Œè€¦åˆæ€§é«˜ã€‚ï¼ˆ3ï¼‰æŸ¥è¯¢æ“ä½œæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å°†ç»“æœé›†ä¸­çš„æ•°æ®æ‰‹åŠ¨å°è£…åˆ°å®ä½“ä¸­ï¼Œæ’å…¥æ“ä½œæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å°†å®ä½“çš„æ•°æ®è®¾ç½®åˆ°sqlè¯­å¥çš„å ä½ç¬¦ä½ç½®ã€‚</p>
<p>åº”å¯¹ä¸Šè¿°é—®é¢˜ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆï¼šï¼ˆ1ï¼‰ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–è¿æ¥èµ„æºã€‚ï¼ˆ2ï¼‰å°†sqlè¯­å¥æŠ½åˆ°xmlé…ç½®æ–‡ä»¶ä¸­ã€‚ï¼ˆ3ï¼‰ä½¿ç”¨åå°„ã€å†…çœç­‰åº•å±‚æŠ€æœ¯ï¼Œè‡ªåŠ¨å°†å®ä½“ä¸è¡¨è¿›è¡Œå±æ€§ä¸å­—æ®µçš„è‡ªåŠ¨æ˜ å°„ã€‚</p>
<p>MyBatisæ˜¯ä¸€ä¸ªä¼˜ç§€çš„åŸºäºjavaçš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒå†…éƒ¨å°è£…äº†jdbcï¼Œä½¿å¼€å‘è€…åªéœ€è¦å…³æ³¨sqlè¯­å¥æœ¬èº«ï¼Œè€Œä¸éœ€è¦èŠ±è´¹ç²¾åŠ›å»å¤„ç†åŠ è½½é©±åŠ¨ã€åˆ›å»ºè¿æ¥ã€åˆ›å»ºstatementç­‰ç¹æ‚çš„è¿‡ç¨‹ï¼Œ</p>
<p>MyBatisé€šè¿‡xmlæˆ–æ³¨è§£çš„æ–¹å¼å°†è¦æ‰§è¡Œçš„å„ç§statementé…ç½®èµ·æ¥ï¼Œå¹¶é€šè¿‡javaå¯¹è±¡å’Œstatementä¸­çš„sqlçš„åŠ¨æ€å‚æ•°è¿›è¡Œæ˜ å°„ç”Ÿæˆæœ€ç»ˆæ‰§è¡Œçš„sqlè¯­å¥ã€‚</p>
<p>MyBatisæ¡†æ¶æ‰§è¡Œsqlå¹¶å°†ç»“æœé›†æ˜ å°„ä¸ºjavaå¯¹è±¡å¹¶è¿”å›ï¼Œé‡‡ç”¨ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ€æƒ³è§£å†³äº†å®ä½“å’Œæ•°æ®åº“æ˜ å°„çš„é—®é¢˜ï¼Œå¯¹jdbcè¿›è¡Œå°è£…ï¼Œå±è”½jdbc apiåº•å±‚è®¿é—®ç»†èŠ‚ï¼Œä¸ä¸jdbcæ‰“äº¤é“å°±å¯ä»¥å®Œæˆå¯¹æ•°æ®åº“çš„æŒä¹…åŒ–æ“ä½œã€‚</p>
<h3 id="mvcå’Œservletçš„å…³ç³»"><a href="#mvcå’Œservletçš„å…³ç³»" class="headerlink" title="mvcå’Œservletçš„å…³ç³»"></a>mvcå’Œservletçš„å…³ç³»</h3><p>1ã€Servletä¸JSPä¸€èµ·ä¸ºWebåº”ç”¨å¼€å‘å¸¦æ¥äº†å·¨å¤§çš„è´¡çŒ®ï¼Œåæ¥å‡ºç°çš„ä¼—å¤šJava Webåº”ç”¨å¼€å‘æ¡†æ¶éƒ½æ˜¯åŸºäºè¿™ä¸¤ç§æŠ€æœ¯çš„ï¼Œæ›´ç¡®åˆ‡çš„è¯´ï¼Œéƒ½æ˜¯åŸºäºServletæŠ€æœ¯çš„ã€‚</p>
<p>2ã€Springmvcçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªDispatcherServletï¼Œå¹¶ä¸”DispatcherServletç»§æ‰¿è‡ª FrameworkServletç»§æ‰¿è‡ªHttpServletBean ç»§æ‰¿è‡ªHttpServletï¼ˆä¹Ÿå°±æ˜¯ä½ è¯´çš„serveltï¼‰ æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ä¸œè¥¿ã€‚å…¶å®å°±æ˜¯åŸºäºtomcatç­‰è¿™äº›webå®¹å™¨å¯¹æˆ‘ä»¬çš„CSè¯·æ±‚èƒ½åšæ›´å¤šçš„äº‹æƒ…ï¼Œå¦‚æ ¡éªŒï¼Œæ‹¦æˆªï¼ˆAOPæ€æƒ³ï¼‰ï¼ŒåæœŸæ¸²æŸ“ç­‰ç­‰ï¼Œå¥½è®©æˆ‘ä»¬ä¸“æ³¨äºä¸šåŠ¡çš„å¼€å‘ã€‚</p>
<p>æ€»ç»“</p>
<p>1ã€servletå°±æ˜¯ä¸€ä¸ªJavaæ¥å£ï¼Œæ˜¯JavaEEè§„èŒƒçš„ä¸€ç§<br>2ã€Servletå®¹å™¨ä¹Ÿå«åšServletå¼•æ“ï¼šå…¨ç§°server appletï¼Œæ„ä¸ºæœåŠ¡ç¨‹åºã€‚ä¸»è¦ä½œç”¨æ˜¯ç»™ä¸Šçº§å®¹å™¨(Tomcat)æä¾›doGet()å’ŒdoPost()ç­‰æ–¹æ³•ã€‚å…¶ç”Ÿå‘½å‘¨æœŸå®ä¾‹åŒ–ã€åˆå§‹åŒ–ã€è°ƒç”¨ã€é”€æ¯å—æ§äº Tomcatå®¹å™¨ã€‚<br>3ã€è€ŒTcomcatã€webLogicç­‰webå®¹å™¨åŒ…å«servletå®¹å™¨ã€‚<br>4ã€Tomcatå®¹å™¨å±äºwebå®¹å™¨çš„ä¸€ç§ï¼Œwebå®¹å™¨è¿˜åŒ…æ‹¬weblogicå®¹å™¨ã€JBosså®¹å™¨ç­‰ã€‚<br>5ã€webå®¹å™¨ï¼šå¯ä»¥éƒ¨ç½²å¤šä¸ªWEBåº”ç”¨ç¨‹åºçš„ç¯å¢ƒã€‚<br>6ã€Spring MVC ï¼ˆSpringBootï¼‰å…¶å®å°±æ˜¯åŸºäºtomcatç­‰è¿™äº›webå®¹å™¨å¯¹æˆ‘ä»¬çš„CSè¯·æ±‚èƒ½åšæ›´å¤šçš„äº‹æƒ…</p>
<p>è½¬è‡ªï¼š<a href="https://zhuanlan.zhihu.com/p/295173834">https://zhuanlan.zhihu.com/p/295173834</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>ssm</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠJavaåŸºç¡€å…¥é—¨ã€‹é¢å‘å¯¹è±¡</title>
    <url>/2021/11/08/myblog/java/%E3%80%8AJava%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E3%80%8B/</url>
    <content><![CDATA[<h2 id="Javaå¼€å‘å…¥é—¨"><a href="#Javaå¼€å‘å…¥é—¨" class="headerlink" title="Javaå¼€å‘å…¥é—¨"></a>Javaå¼€å‘å…¥é—¨</h2><p>Javaæ˜¯ç”±Sunå…¬å¸äº1995å¹´å¼€å‘çš„å¯ç¼–å†™è·¨å¹³å°åº”ç”¨è½¯ä»¶ã€å®Œå…¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡è¯­è¨€ã€‚2009å¹´è¢«Oracleå…¬å¸æ”¶è´­ã€‚</p>
<h3 id="Javaä¸‰ä¸ªæŠ€æœ¯å¹³å°"><a href="#Javaä¸‰ä¸ªæŠ€æœ¯å¹³å°" class="headerlink" title="Javaä¸‰ä¸ªæŠ€æœ¯å¹³å°"></a>Javaä¸‰ä¸ªæŠ€æœ¯å¹³å°</h3><p>é’ˆå¯¹ä¸åŒçš„å¼€å‘å¸‚åœºï¼ŒSunå…¬å¸å°†Javaåˆ’åˆ†ä¸ºä¸‰ä¸ªæŠ€æœ¯å¹³å°ã€‚</p>
<p>ï¼ˆ1ï¼‰Java SEï¼šï¼ˆstandard editionï¼‰Javaå¹³å°æ ‡å‡†ç‰ˆï¼Œä¸ºå¼€å‘æ™®é€šæ¡Œé¢å’Œå•†åŠ¡åº”ç”¨ç¨‹åºæä¾›çš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä¸‰ä¸ªå¹³å°ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼ŒJava EEå’ŒJava MEéƒ½æ˜¯ä»Java SEçš„åŸºç¡€ä¸Šå‘å±•è€Œæ¥ï¼ŒJava SEåŒ…æ‹¬Javaæœ€æ ¸å¿ƒçš„ç±»åº“ï¼Œå¦‚é›†åˆã€IOã€æ•°æ®åº“è¿æ¥åŠç½‘ç»œç¼–ç¨‹ã€‚</p>
<p>ï¼ˆ2ï¼‰Java EEï¼šï¼ˆenterprise editionï¼‰å¹³å°ä¼ä¸šç‰ˆï¼Œä¸ºå¼€å‘ä¼ä¸šçº§åº”ç”¨ç¨‹åºæä¾›çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Servletã€JSPã€JavaBeanã€EJBã€Web Serviceç­‰ã€‚ç”¨æ¥åšwebå¼€å‘çš„javaæ¡†æ¶ã€‚</p>
<p>ï¼ˆ3ï¼‰Java MEï¼šï¼ˆmicro editionï¼‰å¹³å°å¾®å‹ç‰ˆï¼Œä¸ºå¼€å‘ç”µå­æ¶ˆè´¹äº§å“å’ŒåµŒå…¥å¼è®¾å¤‡æä¾›çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºå¾®å‹æ•°å­—ç”µå­è®¾å¤‡ä¸Šè½¯ä»¶ç¨‹åºçš„å¼€å‘ï¼Œä¾‹å¦‚å®¶ç”¨ç”µå™¨å¢åŠ æ™ºèƒ½åŒ–æ§åˆ¶å’Œè”ç½‘åŠŸèƒ½ï¼Œæœªæ‰‹æœºå¢åŠ æ¸¸æˆå’Œé€šè®¯å½•ç®¡ç†åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œè¿˜æä¾›HTTPç­‰åè®®ï¼Œä¸ºç§»åŠ¨ç”µè¯æä¾›Client&#x2F;Serveræ–¹å¼è®¿é—®Internetï¼Œæä¾›æ— çº¿äº¤æµã€‚</p>
<p>ä¸ç®¡å“ªä¸ªç‰ˆæœ¬ï¼Œéƒ½æ˜¯javaè¯­è¨€å®ç°çš„ä¸€ä¸ªæ¡†æ¶ã€‚ä¹‹æ‰€ä»¥è¦åˆ†ç‰ˆæœ¬ï¼Œæ˜¯å› ä¸º3ä¸ªç‰ˆæœ¬æ˜¯é’ˆå¯¹ä¸åŒé—®é¢˜ï¼Œè®¾è®¡çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>J2SEæ˜¯æ ‡å‡†ç‰ˆæœ¬ï¼ŒJ2MEæ˜¯æ‰‹æœºæ–¹å‘çš„ï¼ŒJ2EEæ˜¯ç½‘ç«™å¼€å‘æ–¹å‘çš„ã€‚</p>
<h3 id="è¯­è¨€ç‰¹ç‚¹"><a href="#è¯­è¨€ç‰¹ç‚¹" class="headerlink" title="è¯­è¨€ç‰¹ç‚¹"></a>è¯­è¨€ç‰¹ç‚¹</h3><ul>
<li>ç®€å•æ˜“ç”¨ï¼šä¸¢å¼ƒäº†c++ä¸­çš„ï¼šæ“ä½œç¬¦é‡è½½ã€å¤šç»§æ‰¿ã€è‡ªåŠ¨å¼ºåˆ¶ç±»å‹è½¬æ¢ã€ä¸ä½¿ç”¨æŒ‡é’ˆè€Œæ˜¯å¼•ç”¨ï¼Œæä¾›è‡ªåŠ¨åˆ†é…å’Œå›æ”¶å†…å­˜ç©ºé—´ã€‚</li>
<li>å®‰å…¨å¯é ï¼šJavaé€šå¸¸è¢«ç”¨åœ¨ç½‘ç»œç¯å¢ƒä¸­ï¼Œä¸ºæ­¤ï¼ŒJava æä¾›äº†ä¸€ä¸ªå®‰å…¨æœºåˆ¶ä»¥é˜²æ¶æ„ä»£ç çš„æ”»å‡»ã€‚é™¤äº†Java è¯­è¨€å…·æœ‰çš„è®¸å¤šå®‰å…¨ç‰¹æ€§ä»¥å¤–ï¼ŒJava å¯¹é€šè¿‡ç½‘ç»œä¸‹è½½çš„ç±»å…·æœ‰ä¸€ä¸ªå®‰å…¨é˜²èŒƒæœºåˆ¶ï¼ˆç±» ClassLoaderï¼‰ï¼Œå¦‚åˆ†é…ä¸åŒçš„åå­—ç©ºé—´ä»¥é˜²æ›¿ä»£æœ¬åœ°çš„åŒåç±»ã€å­—èŠ‚ä»£ç æ£€æŸ¥ï¼Œå¹¶æä¾›å®‰å…¨ç®¡ç†æœºåˆ¶ï¼ˆç±» SecurityManagerï¼‰è®© Java åº”ç”¨è®¾ç½®å®‰å…¨å“¨å…µã€‚</li>
<li>è·¨å¹³å°ï¼šé€šè¿‡JVMè™šæ‹Ÿæœºåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šå…è®¸Javaç¨‹åºã€‚</li>
<li>é¢å‘å¯¹è±¡ï¼šå°†ä¸€åˆ‡äº‹ç‰©éƒ½çœ‹æˆå¯¹è±¡ï¼Œç±»ã€æ¥å£ã€ç»§æ‰¿ã€‚åªæ”¯æŒç±»ä¹‹é—´çš„å•ç»§æ‰¿ï¼Œæ”¯æŒæ¥å£ä¹‹é—´çš„å¤šç»§æ‰¿ï¼Œæ”¯æŒç±»ä¸æ¥å£ä¹‹é—´çš„å®ç°æœºåˆ¶ï¼ˆimplementsï¼‰ã€‚javaå…¨é¢æ”¯æŒåŠ¨æ€ç»‘å®šï¼Œc++åªå¯¹è™šå‡½æ•°ä½¿ç”¨åŠ¨æ€ç»‘å®šã€‚</li>
<li>æ”¯æŒå¤šçº¿ç¨‹ï¼šå†…ç½®äº†å¤šçº¿ç¨‹æ§åˆ¶ï¼Œå¯ä½¿ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</li>
</ul>
<h3 id="JDK-JRE-JVM"><a href="#JDK-JRE-JVM" class="headerlink" title="JDK&gt;JRE&gt;JVM"></a><strong>JDK&gt;JRE&gt;JVM</strong></h3><p><strong>JVM</strong> ï¼šï¼ˆJava Virtual Machineï¼‰ï¼Œ Java è™šæ‹Ÿæœºã€‚å®ƒåªè®¤è¯† xxx.class ç±»å‹çš„æ–‡ä»¶ï¼Œèƒ½å¤Ÿå°† class æ–‡ä»¶ä¸­çš„å­—èŠ‚ç æŒ‡ä»¤è¿›è¡Œè¯†åˆ«å¹¶è°ƒç”¨æ“ä½œç³»ç»Ÿå‘ä¸Šçš„ API å®ŒæˆåŠ¨ä½œã€‚jvm æ˜¯ Java èƒ½å¤Ÿè·¨å¹³å°çš„æ ¸å¿ƒã€‚</p>
<p><strong>JRE</strong> ï¼šï¼ˆJava Runtime Environmentï¼‰ï¼ŒJava è¿è¡Œæ—¶ç¯å¢ƒã€‚ä¸»è¦åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œjvm çš„æ ‡å‡†å®ç°å’Œ Java çš„ä¸€äº›åŸºæœ¬ç±»åº“ã€‚å®ƒç›¸å¯¹äº jvm æ¥è¯´ï¼Œå¤šå‡ºæ¥çš„æ˜¯ä¸€éƒ¨åˆ†çš„ Java ç±»åº“ã€‚æ™®é€šç”¨æˆ·åªéœ€è¦JREè¿›è¡Œè¿è¡Œå·²ç»ç¼–è¯‘å¥½çš„javaç¨‹åºï¼Œè€Œä¸éœ€è¦å¼€å‘ã€‚</p>
<p><strong>JDK</strong> ï¼šï¼ˆJava Development Kitï¼‰ï¼ŒJava å¼€å‘å·¥å…·åŒ…ã€‚jdk æ˜¯æ•´ä¸ª Java å¼€å‘çš„æ ¸å¿ƒï¼Œå®ƒé›†æˆäº† jre å’Œä¸€äº›å¥½ç”¨çš„å°å·¥å…·ã€‚ä¾‹å¦‚ï¼šjavac.exeï¼ˆç¼–è¯‘ java æºç çš„ç¼–è¯‘å™¨ javacï¼‰ï¼Œjava.exeï¼ˆjavaè¿è¡Œå·¥å…·ï¼‰ï¼Œjar.exeï¼ˆjavaæ‰“åŒ…å·¥å…·ï¼‰ï¼Œjavaæ–‡æ¡£ç”Ÿæˆå·¥å…· ç­‰å¾ˆå¤š java ç¨‹åºè°ƒè¯•å’Œåˆ†æçš„å·¥å…·ã€‚</p>
<p>1996å¹´æ¨å‡ºjdk1.0ï¼Œéšååˆ°1.5æ”¹å˜å‘½åæ–¹å¼ï¼Œjdk1.5&#x3D;jdk5.2017å¹´jdk9ï¼Œ2018å¹´jdk10.ä½†æ˜¯å¹¶ä¸ç¨³å®šã€‚ç›®å‰æœ€å¤šè¿ç”¨jdk8.</p>
<p>å®‰è£…jdkæ—¶ï¼Œå®‰è£…å¼€å‘å·¥å…·ï¼ˆåŒ…æ‹¬javac.exeã€java.exeç­‰ï¼Œä»¥åŠä¸€ä¸ªä¸“ç”¨JREç¯å¢ƒï¼‰ï¼Œæºä»£ç ï¼ˆJavaæ‰€æœ‰æ ¸å¿ƒç±»åº“çš„æºä»£ç ï¼‰ï¼Œå…¬å…±JREç›¸å½“äºå¤šè£…ä¸€ä¸ªJREåœ¨å…¶ä»–è·¯å¾„ï¼Œæ‰€ä»¥ä¸éœ€è¦ã€‚</p>
<p>JDK&#x3D;JRE(JVM+JAVAåŸºæœ¬ç±»åº“)+å¼€å‘å·¥å…·</p>
<h3 id="JDKç›®å½•"><a href="#JDKç›®å½•" class="headerlink" title="JDKç›®å½•"></a>JDKç›®å½•</h3><ul>
<li>binç›®å½•ï¼šå­˜æ”¾ä¸€äº›å¯æ‰§è¡Œç¨‹åºï¼Œå¦‚javac.exeï¼ˆjavaç¼–è¯‘å™¨ï¼‰ã€java.exeï¼ˆjavaè¿è¡Œå·¥å…·ï¼‰ã€jar.exeï¼ˆæ‰“åŒ…å·¥å…·ï¼‰ã€javadoc.exeï¼ˆæ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼‰ç­‰ã€‚</li>
<li>dbç›®å½•ï¼šçº¯javaå®ç°çš„æ”¯æŒJDBC4.0æ‰€æœ‰è§„èŒƒçš„å°å‹æ•°æ®åº“ã€‚</li>
<li>includeç›®å½•ï¼šç”±äºJDKæ˜¯é€šè¿‡Cå’ŒC++å®ç°çš„ï¼Œå› æ­¤åœ¨å¯åŠ¨æ—¶å¼•å…¥ä¸€äº›Cè¯­è¨€çš„å¤´æ–‡ä»¶ï¼Œè¯¥ç›®å½•å°±æ˜¯å­˜æ”¾è¿™äº›å¤´æ–‡ä»¶çš„ã€‚</li>
<li>jreç›®å½•ï¼šJavaè¿è¡Œæ—¶ç¯å¢ƒçš„æ ¹ç›®å½•ï¼Œï¼ŒåŒ…æ‹¬javaè™šæ‹Ÿæœºã€è¿è¡Œæ—¶çš„ç±»åŒ…ã€javaåº”ç”¨å¯åŠ¨å™¨ä»¥åŠä¸€ä¸ªbinç›®å½•ï¼Œä¸åŒ…æ‹¬å¼€å‘ç¯å¢ƒä¸­çš„å¼€å‘å·¥å…·ã€‚</li>
<li>libç›®å½•ï¼šjavaç±»åº“æˆ–åº“æ–‡ä»¶ï¼Œæ˜¯å¼€å‘å·¥å…·ä½¿ç”¨çš„å½’æ¡£åŒ…æ–‡ä»¶ã€‚</li>
</ul>
<blockquote>
<p>javac.exeï¼šç¼–è¯‘å™¨å·¥å…·ï¼Œå°†javaæ–‡ä»¶ç¼–è¯‘æˆå¯æ‰§è¡Œçš„javaå­—èŠ‚ç æ–‡ä»¶.class</p>
<p>java.exeï¼šjavaè¿è¡Œå·¥å…·ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªjavaè™šæ‹Ÿæœºè¿›ç¨‹ï¼Œä¸“é—¨è´Ÿè´£è¿è¡Œå­—èŠ‚ç æ–‡ä»¶</p>
</blockquote>
<h3 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h3><p>ç›®çš„ï¼šåœ¨ä»»ä½•ä½ç½®éƒ½èƒ½å¤Ÿç¼–è¯‘å’Œè¿è¡Œjavaç¨‹åºã€‚</p>
<p>é…ç½®ï¼šPATHï¼šç”¨äºå‘ŠçŸ¥æ“ä½œç³»ç»Ÿå»æŒ‡å®šè·¯å¾„å¯»æ‰¾JDKï¼ŒCLASSPATHï¼šå‘ŠçŸ¥JDKå»æŒ‡å®šè·¯å¾„æŸ¥æ‰¾ç±»æ–‡ä»¶(.classæ–‡ä»¶)</p>
<p>å½“åœ¨å‘½ä»¤çª—å£ä¸­è¿è¡Œä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿé¦–å…ˆä¼šåœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾æ˜¯å¦å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¼šåœ¨PATHç¯å¢ƒå˜é‡ä¸­å®šä¹‰çš„è·¯å¾„ä¸‹å¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ã€‚</p>
<h3 id="javaè¿è¡Œæœºåˆ¶"><a href="#javaè¿è¡Œæœºåˆ¶" class="headerlink" title="javaè¿è¡Œæœºåˆ¶"></a>javaè¿è¡Œæœºåˆ¶</h3><p>.javaæ–‡ä»¶ï¼Œ</p>
<p>ä½¿ç”¨javac.exeå³javaç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘ï¼Œ</p>
<p>.classæ–‡ä»¶ï¼Œ</p>
<p>ä½¿ç”¨javaå‘½ä»¤å¼€å¯Javaè™šæ‹Ÿæœºè¿è¡Œç¨‹åºï¼Œjavaè™šæ‹Ÿæœºé¦–å…ˆå°†ç¼–è¯‘å¥½çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼ˆç±»åŠ è½½ï¼Œç”±ç±»åŠ è½½å™¨å®Œæˆï¼‰ï¼Œç„¶åè™šæ‹Ÿæœºé€šè¿‡javaè§£æå™¨å¯¹åŠ è½½åˆ°å†…å­˜ä¸­çš„javaç±»è¿›è¡Œè§£é‡Šæ‰§è¡Œï¼Œ</p>
<p>æœºå™¨ç æ–‡ä»¶ï¼Œ</p>
<p>è®¡ç®—æœºè¿è¡Œæœºå™¨ç æ–‡ä»¶ã€‚</p>
<blockquote>
<p>javaç¨‹åºæ˜¯ç”±javaè™šæ‹Ÿæœºè´Ÿè´£è§£é‡Šæ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿï¼Œå› æ­¤è·¨å¹³å°ã€‚</p>
</blockquote>
<h3 id="ç±»åŒ…"><a href="#ç±»åŒ…" class="headerlink" title="ç±»åŒ…"></a>ç±»åŒ…</h3><p>importå¯¼åŒ…ï¼šimport åŒ…å.ç±»å  &#x2F;  import åŒ…å.*</p>
<p>javaçš„æ ¸å¿ƒç±»ä¸»è¦æ”¾åœ¨javaåŒ…åŠå…¶å­åŒ…ä¸‹ã€‚javaæ‰©å±•çš„å¤§éƒ¨åˆ†ç±»åœ¨javaxåŒ…åŠå…¶å­åŒ…ä¸‹ã€‚</p>
<p>java.utilï¼šjavaçš„å¤§é‡å·¥å…·ç±»ã€é›†åˆç±»ï¼Œå¦‚Arraysã€Listã€Setç­‰</p>
<p>java.netï¼šjavaç½‘ç»œç¼–ç¨‹ç›¸å…³çš„ç±»å’Œæ¥å£</p>
<p>java.ioï¼šjavaè¾“å…¥è¾“å‡ºç›¸å…³ç±»å’Œæ¥å£</p>
<p>java.awtï¼šæ„å»ºå›¾å½¢ç•Œé¢GUIçš„ç±»å’Œæ¥å£</p>
<p>java.sqlï¼šæ•°æ®åº“ç¼–ç¨‹</p>
<h2 id="Javaç¼–ç¨‹åŸºç¡€"><a href="#Javaç¼–ç¨‹åŸºç¡€" class="headerlink" title="Javaç¼–ç¨‹åŸºç¡€"></a>Javaç¼–ç¨‹åŸºç¡€</h2><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>å•è¡Œ&#x2F;&#x2F;  å¤šè¡Œ&#x2F;*  *&#x2F;</p>
<p>æ–‡æ¡£æ³¨é‡Šï¼šå¯¹æŸä¸ªç±»æˆ–ç±»ä¸­çš„æ–¹æ³•è¿›è¡Œç³»ç»Ÿæ€§è§£é‡Šè¯´æ˜ã€‚å¼€å‘äººå‘˜å¯ä½¿ç”¨JDKæä¾›çš„javadocå·¥å…·å°†æ–‡æ¡£æ³¨é‡Šæå–å‡ºæ¥ç”Ÿæˆä¸€ä»½APIå¸®åŠ©æ–‡æ¡£ã€‚ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">*  content</span><br><span class="line">*  content</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<h3 id="å‘½åè§„èŒƒ"><a href="#å‘½åè§„èŒƒ" class="headerlink" title="å‘½åè§„èŒƒ"></a>å‘½åè§„èŒƒ</h3><p>åŒ…åï¼šä¸€å¾‹å°å†™<br>ç±»åã€æ¥å£åï¼šé¦–å­—æ¯å¤§å†™<br>å¸¸é‡åï¼šéƒ½å¤§å†™ä¸‹åˆ’çº¿è¿æ¥<br>å˜é‡åå’Œæ–¹æ³•åï¼šä¸€ä¸ªå•è¯é¦–å­—æ¯å°å†™ï¼Œåé¢é¦–å­—æ¯å¤§å†™</p>
<h3 id="å˜é‡çš„æ•°æ®ç±»å‹"><a href="#å˜é‡çš„æ•°æ®ç±»å‹" class="headerlink" title="å˜é‡çš„æ•°æ®ç±»å‹"></a>å˜é‡çš„æ•°æ®ç±»å‹</h3><p>å…«ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼š<br>byteï¼šæ˜¯8ä½ã€æœ‰ç¬¦å·çš„ï¼Œä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°ï¼›-128~127ï¼›<br>shortï¼š16ä½<br>intï¼š32ä½<br>longï¼š64ä½ï¼Œæ‰€èµ‹çš„å€¼è¶…è¿‡intçš„å–å€¼èŒƒå›´ï¼Œåˆ™éœ€è¦åŠ Lï¼Œlong num&#x3D;10000000L;<br>floatï¼šå•ç²¾åº¦32ä½ï¼Œå°æ•°é»˜è®¤ä¸ºdoubleç±»å‹ï¼Œå› æ­¤å®šä¹‰floatå‹éœ€è¦åœ¨åé¢åŠ f&#x2F;F<br>doubleï¼šåŒç²¾åº¦64ä½<br>booleanï¼šå¸ƒå°”<br>charï¼šå­—ç¬¦ï¼Œ2ä¸ªå­—èŠ‚</p>
<p>å¼•ç”¨æ•°æ®ç±»å‹ï¼š<br>å¼•ç”¨ç±»å‹æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å‘å¯¹è±¡çš„å˜é‡æ˜¯å¼•ç”¨å˜é‡ã€‚è¿™äº›å˜é‡åœ¨å£°æ˜æ—¶è¢«æŒ‡å®šä¸ºä¸€ä¸ªç‰¹å®šçš„ç±»å‹ã€‚å˜é‡ä¸€æ—¦å£°æ˜åï¼Œç±»å‹å°±ä¸èƒ½è¢«æ”¹å˜äº†ã€‚å¯¹è±¡ã€æ•°ç»„éƒ½æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ã€‚<br>æ‰€æœ‰å¼•ç”¨ç±»å‹çš„é»˜è®¤å€¼éƒ½æ˜¯nullï¼Œè¡¨ç¤ºæ²¡æœ‰æŒ‡å‘ä»»ä½•å¯¹è±¡ã€‚</p>
<p><code>char c=&#39;a&#39;</code> å’Œ <code>char c=97</code>ä¸€æ ·ã€‚å› ä¸ºå¯ä»¥å°†charå˜é‡èµ‹å€¼ä¸º0-65535èŒƒå›´å†…çš„æ•´æ•°ï¼Œè®¡ç®—æœºå°†æ•´æ•°è‡ªåŠ¨è½¬åŒ–ä¸ºå¯¹åº”çš„å­—ç¬¦ã€‚</p>
<h3 id="å˜é‡çš„ç±»å‹è½¬æ¢"><a href="#å˜é‡çš„ç±»å‹è½¬æ¢" class="headerlink" title="å˜é‡çš„ç±»å‹è½¬æ¢"></a>å˜é‡çš„ç±»å‹è½¬æ¢</h3><p>ï¼ˆ1ï¼‰è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼ˆéšå¼ç±»å‹è½¬æ¢ï¼‰ï¼šå°†ä¸€ä¸ªç±»å‹å–å€¼èŒƒå›´å°çš„æ•°å€¼ç›´æ¥èµ‹å€¼ç»™å¦ä¸€ä¸ªå–å€¼èŒƒå›´å¤§çš„æ•°æ®ç±»å‹å˜é‡ã€‚å¤§å£¶è£…å°å£¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">byte b=3;</span><br><span class="line">int x=b;</span><br><span class="line">double y=x;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆæ˜¾å¼ç±»å‹è½¬æ¢ï¼‰ï¼šç›®æ ‡ç±»å‹å–å€¼èŒƒå›´å°äºæºç±»å‹ã€‚å°å£¶è£…å¤§å£¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">byte a;</span><br><span class="line">int b=298;</span><br><span class="line">a=(byte)b;   //ç»“æœaä¼šå˜æˆ42</span><br></pre></td></tr></table></figure>

<p>å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸­å¯èƒ½ä¸¢å¤±ç²¾åº¦ï¼Œä¾‹å¦‚intå ç”¨4ä¸ªå­—èŠ‚ï¼Œè€Œbyteå ç”¨1ä¸ªå­—èŠ‚ï¼Œ298å˜äºŒè¿›åˆ¶ååªç•™ä¸‹æœ€ä½çš„å…«ä½ã€‚</p>
<p>ï¼ˆ3ï¼‰è¡¨è¾¾å¼ç±»å‹è‡ªåŠ¨æå‡ï¼šbyteã€shortã€charç±»å‹çš„å˜é‡åœ¨è¿ç®—æœŸé—´ç±»å‹ä¼šè‡ªåŠ¨æç¤ºä¸ºintç±»å‹ï¼Œç„¶åè¿›è¡Œè¿ç®—ï¼Œå› æ­¤åœ¨æœ€åè·å¾—ç»“æœæ—¶éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p>
<p>ï¼ˆ4ï¼‰åœ¨ä½¿ç”¨+&#x3D;ã€-&#x3D;ã€*&#x3D;ç­‰è¿ç®—ç¬¦æ—¶ï¼Œå¼ºåˆ¶ç±»å‹è½¬æ¢ä¼šè‡ªåŠ¨å®Œæˆã€‚</p>
<h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h3><p>æ•´å½¢å¸¸é‡ï¼šäºŒè¿›åˆ¶0b&#x2F;0Bå¼€å¤´ï¼Œå…«è¿›åˆ¶0å¼€å¤´ï¼Œåå…­è¿›åˆ¶0x&#x2F;0Xå¼€å¤´ã€‚</p>
<p>nullï¼šè¡¨ç¤ºå¯¹è±¡çš„å¼•ç”¨ä¸ºç©ºã€‚</p>
<p>éœ€è¦ç”¨finalå…³é”®å­—å®šä¹‰å¸¸é‡ï¼š<br><code>final int a=0</code></p>
<p>è½¬ä¹‰ç¬¦<br>\r  å›è½¦ç¬¦<br>\n  æ¢è¡Œç¬¦<br>\t  åˆ¶è¡¨ç¬¦<br>\b  é€€æ ¼ç¬¦ï¼Œbackspace<br>\ååŠ &#39;æˆ–&quot;æˆ–\è¡¨ç¤ºæœ¬èº«</p>
<h3 id="switchè¯­å¥"><a href="#switchè¯­å¥" class="headerlink" title="switchè¯­å¥"></a>switchè¯­å¥</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(expression)&#123;</span><br><span class="line">    <span class="keyword">case</span> value :</span><br><span class="line">       <span class="comment">//è¯­å¥</span></span><br><span class="line">       <span class="keyword">break</span>; <span class="comment">//å¯é€‰ï¼Œå¯ä»¥ä¸breakè€Œç»§ç»­æ‰§è¡Œã€‚</span></span><br><span class="line">    <span class="keyword">case</span> value :</span><br><span class="line">       <span class="comment">//è¯­å¥</span></span><br><span class="line">       <span class="keyword">break</span>; <span class="comment">//å¯é€‰</span></span><br><span class="line">    <span class="comment">//ä½ å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„caseè¯­å¥</span></span><br><span class="line">    <span class="keyword">default</span> : <span class="comment">//å¯é€‰ï¼Œæœ€åæ‰çœ‹</span></span><br><span class="line">       <span class="comment">//è¯­å¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><p>å®šä¹‰çš„ä¸‰ç§æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] nums=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">100</span>];</span><br><span class="line"><span class="type">int</span>[] nums=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="type">int</span>[] nums=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">å‰–æï¼š<span class="type">int</span>[] nums;  numså˜é‡çš„ç±»å‹æ˜¯<span class="type">int</span>[]ã€‚</span><br><span class="line">numsä¼šå ç”¨ä¸€å—å†…å­˜å•å…ƒï¼Œnums=<span class="keyword">new</span> <span class="title class_">int</span>[]; è¡¨ç¤ºåˆ›å»ºæ•°ç»„ï¼Œå¹¶å°†æ•°ç»„çš„å†…å­˜åœ°å€èµ‹å€¼ç»™å˜é‡numsã€‚åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å¯ä»¥ç”¨å˜é‡numsæ¥å¼•ç”¨æ•°ç»„.</span><br></pre></td></tr></table></figure>

<p>å¤šç»´æ•°ç»„ï¼š<code>String[][] str = new String[3][4];</code></p>
<p>java.util.Arrays ç±»èƒ½æ–¹ä¾¿åœ°æ“ä½œæ•°ç»„ï¼Œå®ƒæä¾›çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€çš„ã€‚</p>
<p>å¯¹æ•°ç»„è¿›è¡Œæ’åºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] arr = &#123;<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">3</span>&#125;;</span><br><span class="line">Arrays.sort(arr);</span><br><span class="line">Arrays.sort(arr,<span class="number">1</span>,<span class="number">4</span>);  å·¦é—­å³å¼€</span><br></pre></td></tr></table></figure>

<h2 id="é¢å‘å¯¹è±¡ï¼ˆä¸Šï¼‰"><a href="#é¢å‘å¯¹è±¡ï¼ˆä¸Šï¼‰" class="headerlink" title="é¢å‘å¯¹è±¡ï¼ˆä¸Šï¼‰"></a>é¢å‘å¯¹è±¡ï¼ˆä¸Šï¼‰</h2><p>é¢å‘å¯¹è±¡æ˜¯æŠŠæ„æˆé—®é¢˜çš„äº‹ç‰©æŒ‰ç…§ä¸€å®šè§„åˆ™åˆ’åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œç„¶åé€šè¿‡è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•æ¥è§£å†³é—®é¢˜ã€‚</p>
<p>å°è£…ï¼šå°†å¯¹è±¡çš„å±æ€§å’Œè¡Œä¸ºå°è£…èµ·æ¥ã€‚</p>
<p>ç»§æ‰¿ï¼šæè¿°ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ï¼Œä½¿å¾—æ— é¡»é‡æ–°ç¼–å†™åŸæœ‰ç±»çš„æƒ…å†µä¸‹å¯¹åŸæœ‰ç±»çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•ã€‚</p>
<p>å¤šæ€ï¼šä¸€ä¸ªç±»ä¸­å®šä¹‰çš„å±æ€§å’ŒåŠŸèƒ½è¢«å…¶ä»–ç±»ç»§æ‰¿åï¼Œå½“æŠŠå­ç±»å¯¹è±¡ç›´æ¥èµ‹å€¼ç»™çˆ¶ç±»å¼•ç”¨å˜é‡æ—¶ï¼Œç›¸åŒå¼•ç”¨ç±»å‹çš„å˜é‡è°ƒç”¨åŒä¸€æ–¹æ³•æ‰€å‘ˆç°å‡ºçš„å¤šç§ä¸åŒè¡Œä¸ºç‰¹å¾ã€‚</p>
<p>ç±»æ˜¯å¯¹è±¡çš„æŠ½è±¡ï¼Œå…±åŒç‰¹å¾ä½œä¸ºå±æ€§ï¼ˆæˆå‘˜å˜é‡ï¼‰ï¼Œå…±åŒè¡Œä¸ºä½œä¸ºç±»çš„æ–¹æ³•ï¼ˆæˆå‘˜æ–¹æ³•ï¼‰ã€‚å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ã€‚</p>
<p>åˆ›å»ºå¯¹è±¡ï¼š<code>Person p=new Person();</code></p>
<p>ç¬¬ä¸€æ­¥ï¼š<code>Person p;</code> å£°æ˜ä¸€ä¸ªPersonç±»å‹çš„å˜é‡p</p>
<p>ç¬¬äºŒæ­¥ï¼š<code>=new Person();</code>åˆ›å»ºPersonå¯¹è±¡ï¼Œå¹¶å°†Personå¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€èµ‹å€¼ç»™å˜é‡pï¼Œè¿™æ ·å˜é‡pä¾¿æŒæœ‰äº†å¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<p>å†…å­˜ä¸­ï¼Œpå˜é‡å­˜å¯¹è±¡çš„åœ°å€ï¼Œåœ¨æ ˆå†…å­˜ï¼Œpæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘çœŸæ­£çš„å¯¹è±¡ã€‚å¯¹è±¡åˆ›å»ºåœ¨å †å†…å­˜ã€‚</p>
<blockquote>
<p>æ ˆå†…å­˜ï¼šå­˜æ”¾åŸºæœ¬ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨å˜é‡ã€‚</p>
<p>å †å†…å­˜ï¼šå­˜æ”¾newåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„ã€‚</p>
</blockquote>
<p>åˆ›å»ºå¥½å¯¹è±¡åï¼Œå¯ä»¥é€šè¿‡å¯¹è±¡çš„å¼•ç”¨æ¥è®¿é—®å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜ã€‚å¯¹è±¡å¼•ç”¨.å¯¹è±¡æˆå‘˜</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ›å»ºçš„å¯¹è±¡æœ¬èº«æ¥å¼•ç”¨å¯¹è±¡æˆå‘˜ï¼š<code>new Person().æˆå‘˜</code>ã€‚ç”±äºæ²¡æœ‰å¯¹è±¡å¼•ç”¨çš„å­˜åœ¨ï¼Œåœ¨å®Œæˆä¸€ä¸ªå¯¹è±¡æˆå‘˜çš„è®¿é—®åï¼Œè¯¥å¯¹è±¡å˜æˆåƒåœ¾å¯¹è±¡ã€‚<strong>å½“å¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•å˜é‡æ‰€å¼•ç”¨å°±ä¼šå˜æˆåƒåœ¾ã€‚</strong></p>
<h3 id="è®¿é—®æ§åˆ¶ç¬¦"><a href="#è®¿é—®æ§åˆ¶ç¬¦" class="headerlink" title="è®¿é—®æ§åˆ¶ç¬¦"></a>è®¿é—®æ§åˆ¶ç¬¦</h3><p>è®¿é—®æ§åˆ¶çº§åˆ«ç”±å°åˆ°å¤§ï¼šprivateâ†’defaultâ†’protectedâ†’public</p>
<ul>
<li>privateï¼ˆå½“å‰ç±»è®¿é—®çº§åˆ«ï¼‰ï¼šè¯¥æˆå‘˜åªèƒ½è¢«è¯¥ç±»çš„å…¶ä»–æˆå‘˜è®¿é—®ï¼Œå…¶ä»–ç±»æ— æ³•ç›´æ¥è®¿é—®ã€‚</li>
<li>defaultï¼ˆåŒ…è®¿é—®çº§åˆ«ï¼‰ï¼šä¸ä½¿ç”¨ä»»ä½•è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦çš„è¯ï¼Œå°±æ˜¯defaultï¼Œè¡¨ç¤ºè¿™ä¸ªç±»æˆ–è€…ç±»çš„æˆå‘˜åªèƒ½è¢«æœ¬åŒ…ä¸­çš„å…¶ä»–ç±»è®¿é—®ã€‚</li>
<li>protectedï¼ˆå­ç±»è®¿é—®çº§åˆ«ï¼‰ï¼šæˆå‘˜èƒ½è¢«åŒä¸€åŒ…å†…çš„å…¶ä»–ç±»è®¿é—®ï¼Œä¹Ÿèƒ½è¢«ä¸åŒåŒ…ä¸‹è¯¥ç±»çš„å­ç±»è®¿é—®ã€‚</li>
<li>publicï¼ˆå…¬å…±è®¿é—®çº§åˆ«ï¼‰ï¼šè¯¥ç±»æˆ–ç±»çš„æˆå‘˜èƒ½è¢«æ‰€æœ‰çš„ç±»è®¿é—®ï¼Œä¸ç®¡æ˜¯å¦åœ¨åŒä¸€åŒ…ä¸­ã€‚</li>
</ul>
<blockquote>
<p>å¦‚æœä¸€ä¸ªjavaæºæ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰ç±»éƒ½æ²¡æœ‰publicä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆè¿™ä¸ªæºæ–‡ä»¶çš„æ–‡ä»¶åå¯ä»¥æ˜¯ä¸€åˆ‡åˆæ³•çš„æ–‡ä»¶åã€‚</p>
<p>å¦‚æœjavaæºæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªpublicä¿®é¥°çš„ç±»ï¼Œåˆ™æºæ–‡ä»¶åå¿…é¡»ä¸publicä¿®é¥°çš„ç±»çš„ç±»åä¸€è‡´ã€‚</p>
</blockquote>
<h3 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h3><p>ç±»çš„å°è£…ï¼Œæ˜¯æŒ‡å°†å¯¹è±¡çš„å±æ€§éšè—åœ¨å¯¹è±¡å†…éƒ¨ï¼Œè®¾ä¸ºprivateçº§åˆ«ï¼Œä¸å…è®¸å¤–éƒ¨ç¨‹åºç›´æ¥è®¿é—®å¯¹è±¡çš„å†…éƒ¨ä¿¡æ¯ï¼Œè€Œé€šè¿‡ç±»å†…publicçš„æ–¹æ³•ï¼ˆsetxxxï¼Œgetxxxï¼‰å®ç°å¯¹å†…éƒ¨ä¿¡æ¯çš„æ“ä½œåŠè®¿é—®ã€‚</p>
<h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><p>åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„åŒæ—¶ä¸ºè¿™ä¸ªå¯¹è±¡çš„å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•æ¥å®ç°ã€‚</p>
<p>æ„é€ æ–¹æ³•éœ€è¦æ»¡è¶³çš„ä¸‰ä¸ªæ¡ä»¶ï¼šæ–¹æ³•åä¸ç±»åç›¸åŒã€åœ¨æ–¹æ³•åçš„å‰é¢æ²¡æœ‰è¿”å›å€¼ç±»å‹çš„å£°æ˜ã€æ–¹æ³•ä¸­ä¸èƒ½ä½¿ç”¨returnè¿”å›ä¸€ä¸ªå€¼ä½†æ˜¯å¯ä»¥å•ç‹¬returnæ¥ç»“æŸæ–¹æ³•ã€‚</p>
<p>æ„é€ æ–¹æ³•çš„é‡è½½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class TreeNode &#123;</span><br><span class="line">    int val;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line">    TreeNode() &#123;&#125;</span><br><span class="line">    TreeNode(int val) &#123; this.val = val; &#125;</span><br><span class="line">    TreeNode(int val, TreeNode left, TreeNode right) &#123;</span><br><span class="line">        this.val = val;</span><br><span class="line">        this.left = left;</span><br><span class="line">        this.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨javaä¸­æ¯ä¸ªç±»éƒ½è‡³å°‘æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰æ˜¾ç¤ºåœ°å®šä¹‰æ„é€ æ–¹æ³•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºè¿™ä¸ªç±»åˆ›å»ºä¸€ä¸ªæ— å‚æ„é€ æ–¹æ³•ã€‚ä½†æ˜¯ä¸€æ—¦è‡ªå·±å®šä¹‰äº†æœ‰å‚çš„æ„é€ æ–¹æ³•ï¼Œç³»ç»Ÿå°†ä¸å†æä¾›æ— å‚çš„æ„é€ æ–¹æ³•ã€‚</p>
<blockquote>
<p>ç–‘é—®ï¼šæ„é€ æ–¹æ³•ç”¨æ¥åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ä¸ºå¯¹è±¡çš„æˆå‘˜å˜é‡èµ‹å€¼ï¼Œè€Œåœ¨å®šä¹‰ç±»çš„æ—¶å€™ï¼Œå¯ä»¥å£°æ˜å˜é‡ï¼ˆä¸èµ‹å€¼ï¼‰ä¹Ÿå¯ä»¥å®šä¹‰å˜é‡ï¼ˆèµ‹å€¼ï¼‰ï¼Œé‚£ä¹ˆå®šä¹‰äº†å˜é‡ä¹‹åï¼Œå®ä¾‹åŒ–å¯¹è±¡ï¼Œæ˜¯ç»™å¯¹è±¡çš„æˆå‘˜èµ‹åˆå€¼äº†å—ï¼Ÿåº”è¯¥æ˜¯å§</p>
</blockquote>
<h3 id="thiså…³é”®å­—"><a href="#thiså…³é”®å­—" class="headerlink" title="thiså…³é”®å­—"></a>thiså…³é”®å­—</h3><p>å…³é”®å­—thisç”¨æ¥æŒ‡ä»£å½“å‰å¯¹è±¡ï¼Œç”¨æ¥åœ¨æ–¹æ³•ä¸­è®¿é—®å¯¹è±¡çš„å…¶ä»–æˆå‘˜ã€‚</p>
<ul>
<li>é€šè¿‡thiså…³é”®å­—è°ƒç”¨æˆå‘˜å˜é‡ï¼Œè§£å†³ä¸å±€éƒ¨å˜é‡åç§°å†²çªçš„é—®é¢˜ã€‚</li>
<li>é€šè¿‡thiså…³é”®å­—è°ƒç”¨æˆå‘˜æ–¹æ³•ã€‚</li>
<li>é€šè¿‡thiså…³é”®å­—è°ƒç”¨æ„é€ å‡½æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•æ˜¯åœ¨å®ä¾‹åŒ–å¯¹è±¡æ—¶è¢«javaè™šæ‹Ÿæœºè‡ªåŠ¨è°ƒç”¨çš„ï¼Œä½†æ˜¯å¯ä»¥<strong>åœ¨ä¸€ä¸ªæ„é€ æ–¹æ³•ä¸­</strong>ç”¨<code>this(å‚æ•°);</code>çš„å½¢å¼æ¥è°ƒç”¨å…¶ä»–çš„æ„é€ æ–¹æ³•ã€‚æ³¨æ„ï¼šåªèƒ½åœ¨æ„é€ æ–¹æ³•ä¸­ç”¨ï¼Œä¸”å¿…é¡»æ˜¯æ„é€ æ–¹æ³•ä¸­çš„ç¬¬ä¸€æ¡è¯­å¥ï¼Œä¸”åªèƒ½å‡ºç°ä¸€æ¬¡ï¼Œè€Œä¸”ä¸èƒ½åœ¨ä¸¤ä¸ªæ„é€ æ–¹æ³•ä¸­ç›¸äº’è°ƒç”¨ã€‚</li>
</ul>
<h3 id="staticå…³é”®å­—"><a href="#staticå…³é”®å­—" class="headerlink" title="staticå…³é”®å­—"></a>staticå…³é”®å­—</h3><p>ï¼ˆ1ï¼‰é™æ€å˜é‡</p>
<p>ç±»å†…çš„æ•°æ®æˆå‘˜è¢«ä¸€ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹å¯¹è±¡æ‰€å…±äº«æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚å­¦æ ¡å­¦ç”Ÿçš„å­¦æ ¡åã€‚ä¸å¿…è¦åœ¨æ¯ä¸ªå¯¹è±¡å ç”¨çš„ç©ºé—´ä¸­éƒ½å£°æ˜è¿™ä¸ªå¯¹è±¡ï¼Œè€Œæ˜¯åœ¨å¯¹è±¡ä¹‹å¤–çš„ç©ºé—´ä¸­å£°æ˜ä¸€ä¸ªå˜é‡ä¾›æ‰€æœ‰å¯¹è±¡æ¥å…±äº«ã€‚</p>
<p>æ³¨æ„ï¼šstaticå…³é”®å­—åªèƒ½ç”¨äºä¿®é¥°æˆå‘˜å˜é‡ï¼Œä¸èƒ½ç”¨äºä¿®é¥°å±€éƒ¨å˜é‡ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> String schoolName;</span><br><span class="line">&#125;</span><br><span class="line">mainå‡½æ•°ä¸­ï¼š</span><br><span class="line">Student.schoolName=<span class="string">&quot;daxue&quot;</span>;</span><br><span class="line">Student stu1=<span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">ä½¿ç”¨ï¼š stu1.schoolName</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰é™æ€æ–¹æ³•</p>
<p>å¸Œæœ›åœ¨ä¸åˆ›å»ºå¯¹è±¡çš„æƒ…å†µä¸‹å°±å¯ä»¥è°ƒç”¨æŸä¸ªæ–¹æ³•æ—¶ä½¿ç”¨ã€‚</p>
<p>è®¿é—®æ–¹å¼ï¼š<code>ç±»å.æ–¹æ³•</code>    æˆ–    <code>å®ä¾‹å¯¹è±¡å.æ–¹æ³•</code></p>
<p>æ³¨æ„ï¼šåœ¨ä¸€ä¸ªé™æ€æ–¹æ³•ä¸­åªèƒ½è®¿é—®ç”¨staticä¿®é¥°çš„æˆå‘˜ï¼ŒåŸå› åœ¨äºæ²¡æœ‰æ²¡sttaicä¿®é¥°çš„æˆå‘˜éœ€è¦å…ˆåˆ›å»ºå¯¹è±¡æ‰èƒ½è®¿é—®ï¼Œè€Œé™æ€æ–¹æ³•åœ¨è¢«è°ƒç”¨æ—¶å¯ä»¥ä¸åˆ›å»ºä»»ä½•å¯¹è±¡ã€‚</p>
<blockquote>
<p>æ€è€ƒï¼šä¸€ä¸ªæ–‡ä»¶ä¸­å¯ä»¥æœ‰å¤šä¸ªç±»ï¼Œæ–‡ä»¶åå«publicçš„ç±»çš„åå­—ï¼Œç±»å†…å¯ä»¥æœ‰public static mainå‡½æ•°ï¼Œæœ‰mainå‡½æ•°çš„ç±»å¾—æ˜¯publicçš„?</p>
<p>static çš„æˆå‘˜å‡½æ•°ï¼Œåªèƒ½è®¿é—®staticçš„æˆå‘˜ï¼ˆå‡½æ•°æˆ–å˜é‡ï¼‰ï¼Œpublic static mainå‡½æ•°ä¸­å¯ä»¥åˆ›å»ºå…¶ä»–ç±»çš„å¯¹è±¡ï¼Œç„¶åè®¿é—®å…¶ä»–éstaticç±»çš„æˆå‘˜ã€‚</p>
</blockquote>
<p>ï¼ˆ3ï¼‰é™æ€ä»£ç å—</p>
<p>static{â€¦}  åœ¨ç±»è¢«åŠ è½½æ—¶ï¼Œé™æ€ä»£ç å—ä¼šæ‰§è¡Œï¼Œç”±äºç±»åªåŠ è½½ä¸€æ¬¡ï¼Œå› æ­¤é™æ€ä»£ç å—ä¹Ÿåªæ‰§è¡Œä¸€æ¬¡ã€‚é€šå¸¸ä½¿ç”¨é™æ€ä»£ç å—å¯¹ç±»çš„æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–å¯¹è±¡æ—¶ä¼šåŠ è½½ç±»ã€‚</p>
<h2 id="é¢å‘å¯¹è±¡ï¼ˆä¸‹ï¼‰"><a href="#é¢å‘å¯¹è±¡ï¼ˆä¸‹ï¼‰" class="headerlink" title="é¢å‘å¯¹è±¡ï¼ˆä¸‹ï¼‰"></a>é¢å‘å¯¹è±¡ï¼ˆä¸‹ï¼‰</h2><h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><p>is açš„å…³ç³»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class çˆ¶ç±» &#123;</span><br><span class="line">&#125;</span><br><span class="line">class å­ç±» extends çˆ¶ç±» &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å­ç±»åœ¨ç»§æ‰¿çˆ¶ç±»çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ‹¥æœ‰çˆ¶ç±»æ‰€æœ‰å…¬å…±çš„æˆå‘˜ã€‚</p>
<p>javaä¸­åªæ”¯æŒå•ç»§æ‰¿ï¼Œä¸å…è®¸å¤šç»§æ‰¿ï¼Œä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªç›´æ¥çˆ¶ç±»ã€‚</p>
<h3 id="é‡å†™çˆ¶ç±»æ–¹æ³•"><a href="#é‡å†™çˆ¶ç±»æ–¹æ³•" class="headerlink" title="é‡å†™çˆ¶ç±»æ–¹æ³•"></a>é‡å†™çˆ¶ç±»æ–¹æ³•</h3><p>ä¸èƒ½ä½¿ç”¨æ¯”çˆ¶ç±»ä¸­é‡å†™çš„æ–¹æ³•æ›´ä¸¥æ ¼çš„è®¿é—®æƒé™ï¼Œå¦‚çˆ¶ç±»çš„è®¿é—®æƒé™æ˜¯publicï¼Œå­ç±»æ–¹æ³•ä¸èƒ½æ˜¯privateã€‚</p>
<p>ä¹Ÿå¯ä»¥é‡æ–°å®šä¹‰çˆ¶ç±»çš„å±æ€§ã€‚</p>
<h3 id="superå…³é”®å­—"><a href="#superå…³é”®å­—" class="headerlink" title="superå…³é”®å­—"></a>superå…³é”®å­—</h3><p>å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•æˆ–é‡æ–°å®šä¹‰çˆ¶ç±»å±æ€§åï¼Œå­ç±»å¯¹è±¡æ— æ³•ç›´æ¥è®¿é—®ä»–ä»¬ï¼Œå› æ­¤ï¼Œç”¨superè®¿é—®ã€‚<code>super.æˆå‘˜å˜é‡/æˆå‘˜æ–¹æ³•</code></p>
<p>è¿˜å¯ä»¥ç”¨superå…³é”®å­—æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚<code>super([å‚æ•°1,å‚æ•°2]);</code>ä½†æ˜¯ï¼Œåªèƒ½å‡ºç°åœ¨å­ç±»æ„é€ æ–¹æ³•çš„ç¬¬ä¸€è¡Œï¼Œä¸”åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</p>
<p>æ³¨æ„ï¼šå­ç±»çš„æ„é€ æ–¹æ³•ä¸­ä¸€å®šä¼šè°ƒç”¨çˆ¶ç±»çš„æŸä¸ªæ„é€ æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡superæŒ‡å®šã€‚å¦‚æœæ²¡æœ‰superï¼Œåˆ™ä¼šé»˜è®¤è°ƒç”¨çˆ¶ç±»æ— å‚çš„æ„é€ æ–¹æ³•ã€‚å› æ­¤ï¼Œå¦‚æœçˆ¶ç±»åªå®šä¹‰äº†æœ‰å‚çš„æ„é€ æ–¹æ³•ï¼Œç³»ç»Ÿä¸ç»™é»˜è®¤æ— å‚æ„é€ æ–¹æ³•ï¼Œå°±ä¼šå‡ºé”™ã€‚å› æ­¤éœ€è¦åœ¨çˆ¶ç±»æ·»åŠ æ— å‚æ„é€ æ–¹æ³•ï¼Œæˆ–è€…å­ç±»æŒ‡å®šè°ƒç”¨çˆ¶ç±»æœ‰å‚æ„é€ æ–¹æ³•ã€‚</p>
<h3 id="Objectç±»"><a href="#Objectç±»" class="headerlink" title="Objectç±»"></a>Objectç±»</h3><p>javaä¸­çš„Objectç±»æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œæ¯ä¸ªç±»éƒ½ç›´æ¥æˆ–é—´æ¥åœ°ç»§æ‰¿è‡ªè¯¥ç±»ï¼Œç§°ä¸ºè¶…ç±»ã€åŸºç±»ã€æˆ–æ ¹ç±»ã€‚Objectç±»ä¸­æœ‰ä¸€äº›è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚</p>
<p><code>å¯¹è±¡å.toString()  </code>è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</p>
<h3 id="finalå…³é”®å­—"><a href="#finalå…³é”®å­—" class="headerlink" title="finalå…³é”®å­—"></a>finalå…³é”®å­—</h3><p>ä¸å¯æ›´æ”¹ï¼Œæœ€ç»ˆçš„æ„æ€ã€‚</p>
<p>ï¼ˆ1ï¼‰ä¿®é¥°ç±»ï¼šä¸èƒ½è¢«ç»§æ‰¿ã€‚</p>
<p>ï¼ˆ2ï¼‰ä¿®é¥°æ–¹æ³•ï¼šä¸èƒ½è¢«å­ç±»é‡å†™</p>
<p>ï¼ˆ3ï¼‰ä¿®é¥°å˜é‡ï¼šå¸¸é‡ï¼Œåªèƒ½è¢«èµ‹å€¼ä¸€æ¬¡ã€‚</p>
<p>finalä¿®é¥°çš„æˆå‘˜å˜é‡ï¼Œå¿…é¡»åœ¨å£°æ˜çš„åŒæ—¶è¿›è¡Œèµ‹å€¼ã€‚</p>
<p>finalä¿®é¥°çš„å±€éƒ¨å˜é‡ï¼Œå¯ä»¥å…ˆå£°æ˜ï¼Œå†è¿›è¡Œä¸€æ¬¡èµ‹å€¼ã€‚</p>
<h3 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h3><p>ä¾‹å¦‚åœ¨å®šä¹‰Animalç±»æ—¶ï¼Œshout()æ–¹æ³•æ— æ³•æ˜ç¡®è¡¨ç¤ºï¼Œjavaæä¾›æŠ½è±¡æ–¹æ³•æ¥ä½¿å¾—å…¶æ— éœ€æä¾›æ–¹æ³•çš„å…·ä½“å®ç°ã€‚</p>
<p>æŠ½è±¡æ–¹æ³•ï¼š<code>public abstract void shout();</code>æ²¡æœ‰å¤§æ‹¬å·</p>
<p>åŒ…å«æŠ½è±¡æ–¹æ³•çš„ç±»ä¸€å®šæ˜¯æŠ½è±¡ç±»ï¼Œclasså‰åŠ abstractï¼Œä½†æ˜¯æŠ½è±¡ç±»ä¸­å¯ä»¥ä¸åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚</p>
<p>æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½åˆ›å»ºå­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­å®ç°æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚</p>
<h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><p>æ¥å£æ˜¯ä¸€ç§ç‰¹æ®Šçš„æŠ½è±¡ç±»ï¼Œå®ƒä¸åŒ…å«æ™®é€šæ–¹æ³•ï¼Œå†…éƒ¨æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯æŠ½è±¡æ–¹æ³•ã€‚</p>
<p>JDK8ä¸­å¯¹æ¥å£è¿›è¡Œäº†é‡æ–°å®šä¹‰ï¼Œæ¥å£ä¸­é™¤äº†æŠ½è±¡æ–¹æ³•å¤–ï¼Œå¯ä»¥æœ‰defaultä¿®é¥°çš„é»˜è®¤æ–¹æ³•ï¼Œstaticä¿®é¥°çš„é™æ€æ–¹æ³•ï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½å…è®¸æœ‰æ–¹æ³•ä½“ã€‚</p>
<p>ç”¨interfaceä¿®é¥°ï¼Œå¯ä»¥extendså¤šä¸ªæ¥å£ã€‚æ¥å£å†…éƒ¨å¯ä»¥æœ‰finalå¸¸é‡ï¼Œå®šä¹‰å¸¸é‡æ—¶å¿…é¡»è¿›è¡Œåˆå§‹åŒ–èµ‹å€¼ã€‚</p>
<p>å°æç¤ºï¼šå®šä¹‰å¸¸é‡æ—¶<code>public static final</code>å¯çœç•¥ï¼Œå®šä¹‰æ–¹æ³•æ—¶<code>public abstract</code>å¯çœç•¥</p>
<p>è°ƒç”¨é™æ€æ–¹æ³•ï¼š<code>æ¥å£å.æ–¹æ³•å</code></p>
<p>è°ƒç”¨æŠ½è±¡æ–¹æ³•å’Œé»˜è®¤æ–¹æ³•éœ€è¦é€šè¿‡æ¥å£å®ç°ç±»çš„å®ä¾‹å¯¹è±¡æ¥è°ƒç”¨ã€‚é»˜è®¤æ–¹æ³•ä¸éœ€è¦å­ç±»ä¸­å®ç°ã€‚</p>
<p><code>public interface Hockey extends Sports, Event</code>   æ¥å£çš„å¤šç»§æ‰¿</p>
<p>ä¸€ä¸ªç±»å¯ä»¥åœ¨ç»§æ‰¿ä¸€ä¸ªç±»çš„åŒæ—¶å®ç°å¤šä¸ªæ¥å£ï¼š<code>public class ç±»å extends ç±»å implements æ¥å£1ï¼Œæ¥å£2</code>  ï¼Œextendéœ€è¦åœ¨å‰é¢</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœä¸€ä¸ªç±»é€šè¿‡implementå®ç°æ¥å£ï¼Œå¦‚æœè¯¥ç±»æ˜¯æŠ½è±¡ç±»ï¼Œåˆ™å¯ä»¥å®ç°æ¥å£ä¸­çš„éƒ¨åˆ†æŠ½è±¡æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯æŠ½è±¡ç±»ï¼Œåˆ™éœ€è¦å®ç°æ¥å£ä¸­çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ã€‚</p>
</blockquote>
<p>æ€»ç»“ï¼šç±»ç»§æ‰¿ç±»ï¼ˆåªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†åŒæ—¶å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼‰ï¼Œæ¥å£ç»§æ‰¿æ¥å£ï¼ˆå¯ä¸€æ¬¡ç»§æ‰¿å¤šä¸ªæ¥å£ï¼‰ï¼Œç±»å®ç°æ¥å£ï¼ˆå¯ä¸€æ¬¡å®ç°å¤šä¸ªæ¥å£ï¼‰</p>
<h3 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h3><p>å¤šæ€æ˜¯æŒ‡ä¸€ä¸ªç±»ä¸­å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•è¢«å…¶ä»–ç±»ç»§æ‰¿æˆ–é‡å†™åï¼Œå½“æŠŠå­ç±»å¯¹è±¡ç›´æ¥èµ‹å€¼ç»™çˆ¶ç±»å¼•ç”¨å˜é‡æ—¶ï¼Œç›¸åŒå¼•ç”¨ç±»å‹çš„å˜é‡è°ƒç”¨åŒä¸€æ–¹æ³•æ‰€å‘ˆç°çš„å¤šç§ä¸åŒå½¢æ€ã€‚</p>
<p>æŠŠå­ç±»å¯¹è±¡ç›´æ¥èµ‹å€¼ç»™çˆ¶ç±»å¼•ç”¨å˜é‡æ—¶ï¼Œç¨‹åºåªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“è¯¥å¼•ç”¨å˜é‡å…·ä½“ä»£è¡¨å“ªä¸ªå­ç±»å¯¹è±¡ã€‚</p>
<h3 id="å¯¹è±¡çš„ç±»å‹è½¬æ¢"><a href="#å¯¹è±¡çš„ç±»å‹è½¬æ¢" class="headerlink" title="å¯¹è±¡çš„ç±»å‹è½¬æ¢"></a>å¯¹è±¡çš„ç±»å‹è½¬æ¢</h3><p>å­ç±»å¯¹è±¡å½“ä½œçˆ¶ç±»ç±»å‹ä½¿ç”¨ï¼šå‘ä¸Šè½¬å‹</p>
<p><code>Animal an1=new Cat();</code>   ä¸éœ€è¦ä»»ä½•æ˜¾ç¤ºå£°æ˜ï¼Œä½†æ˜¯ä¸èƒ½é€šè¿‡çˆ¶ç±»å˜é‡å»è°ƒç”¨å­ç±»ç‰¹æœ‰çš„æ–¹æ³•ã€‚</p>
<p>è¦æƒ³ä½¿ç”¨å­ç±»ç‰¹æœ‰çš„æ–¹æ³•ï¼Œéœ€è¦å°†æœ¬è´¨ä¸ºCatç±»å‹çš„an1å¯¹è±¡ç”±Animalç±»å‹å‘ä¸‹è½¬å‹ä¸ºCatç±»å‹ã€‚</p>
<p><code>Cat cat=(Cat)an1;</code> å°±å¯ä»¥ç”¨catå˜é‡æ¥è°ƒç”¨å­ç±»ç‰¹æœ‰æ–¹æ³•äº†ã€‚</p>
<p><code>instanceof</code>å…³é”®å­—ï¼Œç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæŸä¸ªç±»æˆ–æ¥å£çš„å®ä¾‹æˆ–å­ç±»å®ä¾‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Animal an1=new Cat();</span><br><span class="line">if(an1 instanceof Cat)&#123;</span><br><span class="line">    Cat cat=(Cat)an1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å†…éƒ¨ç±»"><a href="#å†…éƒ¨ç±»" class="headerlink" title="å†…éƒ¨ç±»"></a>å†…éƒ¨ç±»</h3><p>javaä¸­å…è®¸ä¸€ä¸ªç±»çš„å†…éƒ¨å®šä¹‰ç±»ï¼Œè¿™æ ·çš„ç±»å«å†…éƒ¨ç±»ã€‚å†…éƒ¨ç±»æ‰€åœ¨ç±»å«å¤–éƒ¨ç±»ã€‚æ ¹æ®å†…éƒ¨ç±»çš„ä½ç½®ã€ä¿®é¥°ç¬¦ã€å®šä¹‰æ–¹å¼çš„ä¸åŒåˆ†ä¸ºå››ç§ã€‚</p>
<p>ï¼ˆ1ï¼‰æˆå‘˜å†…éƒ¨ç±»</p>
<p>åƒæˆå‘˜å˜é‡ã€æˆå‘˜æ–¹æ³•ä¸€æ ·çš„å­˜åœ¨ï¼Œåœ¨æˆå‘˜å†…éƒ¨ç±»ä¸­ï¼Œå¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ã€‚åœ¨å¤–éƒ¨ç±»ä¸­ï¼Œå¯ä»¥è®¿é—®æˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¤–éƒ¨ç±»è®¿é—®å†…éƒ¨ç±»çš„æˆå‘˜ï¼š</span><br><span class="line">Inner inner = new Inner();</span><br><span class="line">inner.æˆå‘˜</span><br><span class="line">åœ¨ä¸å¤–éƒ¨ç±»å¹³è¡Œçš„ç±»ä¸­ï¼š</span><br><span class="line">Outer out = new Outer();  åˆ›å»ºå¤–éƒ¨ç±»å¯¹è±¡</span><br><span class="line">Outer.Inner in = new Inner();   åˆ›å»ºå†…éƒ¨ç±»å¯¹è±¡</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å±€éƒ¨å†…éƒ¨ç±»</p>
<p>ä¹Ÿå«æ–¹æ³•å†…éƒ¨ç±»ï¼Œæ˜¯å®šä¹‰åœ¨æŸä¸ªæ–¹æ³•å†…çš„ï¼Œæœ‰æ•ˆèŒƒå›´ä»…é™äºæ–¹æ³•å†…éƒ¨ã€‚</p>
<p>å±€éƒ¨å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»æ‰€æœ‰æˆå‘˜ï¼Œè€Œåªæœ‰åœ¨åŒ…å«å±€éƒ¨å†…éƒ¨ç±»çš„æ–¹æ³•ä¸­æ‰å¯ä»¥è®¿é—®å†…éƒ¨ç±»çš„æˆå‘˜ã€‚</p>
<p>ï¼ˆ3ï¼‰é™æ€å†…éƒ¨ç±»</p>
<p>ä½¿ç”¨staticå…³é”®å­—ä¿®é¥°çš„æˆå‘˜å†…éƒ¨ç±»ï¼Œé™æ€å†…éƒ¨ç±»åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨ä¸å¤–éƒ¨ç±»å¹³è¡Œçš„ç±»ä¸­ï¼š</span><br><span class="line">Outer.Inner inner = new Outer.Inner();</span><br><span class="line">inner.æˆå‘˜</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸€èˆ¬åœ¨åˆ·é¢˜æ—¶ï¼Œå®šä¹‰Solutionç±»ï¼Œç±»å†…å®šä¹‰æˆå‘˜æ–¹æ³•å®ç°ç®—æ³•ã€‚æµ‹è¯•æ—¶ï¼Œå®šä¹‰å¦ä¸€ä¸ªç±»ï¼Œç±»å†…mainå‡½æ•°ä¸­è¾“å…¥è¾“å‡ºï¼Œç„¶åå®šä¹‰å¯¹è±¡<code>Solution s = new Solution();</code>é€šè¿‡å¯¹è±¡è®¿é—®ç®—æ³•æ–¹æ³•ã€‚</p>
</blockquote>
<p>ï¼ˆ4ï¼‰åŒ¿åå†…éƒ¨ç±»</p>
<p>åœ¨javaä¸­è°ƒç”¨æŸä¸ªæ–¹æ³•æ—¶ï¼Œå¦‚æœè¯¥æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œé™¤äº†å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‚æ•°æ¥å£å®ç°ç±»ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å®ç°æ¥å£æ¥ä½œä¸ºè¯¥æ–¹æ³•çš„å‚æ•°ã€‚</p>
<p>åŒ¿åå†…éƒ¨ç±»å°±æ˜¯æ²¡æœ‰åç§°çš„å†…éƒ¨ç±»ï¼Œåœ¨è°ƒç”¨åŒ…å«æœ‰æ¥å£ç±»å‹å‚æ•°çš„æ–¹æ³•æ—¶ï¼Œé€šå¸¸ä¸ºäº†ç®€åŒ–ä»£ç ï¼Œä¸ä¼šåˆ›å»ºä¸€ä¸ªæ¥å£çš„å®ç°ç±»ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ å…¥ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡åŒ¿åå†…éƒ¨ç±»çš„å½¢å¼ä¼ å…¥ä¸€ä¸ªæ¥å£ç±»å‹å‚æ•°ï¼Œåœ¨åŒ¿åå†…éƒ¨ç±»ä¸­ç›´æ¥å®Œæˆæ–¹æ³•çš„å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰åŠ¨ç‰©ç±»æ¥å£</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">shout</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		String name=<span class="string">&quot;maomao&quot;</span>;</span><br><span class="line">		<span class="comment">//å®šä¹‰åŒ¿åå†…éƒ¨ç±»ä½œä¸ºå‚æ•°ä¼ é€’ç»™animalShoutæ–¹æ³•</span></span><br><span class="line">		animalShout(<span class="keyword">new</span> <span class="title class_">Animal</span>()&#123;</span><br><span class="line">		    <span class="comment">//åŒ¿åå†…éƒ¨ç±»ä¸­å®ç°shoutæ–¹æ³•</span></span><br><span class="line">		    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shout</span><span class="params">()</span>&#123;</span><br><span class="line">		    	<span class="comment">//JDK8å¼€å§‹ï¼Œå±€éƒ¨å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»å¯ä»¥è®¿é—®éfinalçš„å±€éƒ¨å˜é‡</span></span><br><span class="line">		    	System.out.println(name+â€œå–µå–µâ€)ï¼›</span><br><span class="line">		    &#125;</span><br><span class="line">		&#125;)ï¼›</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//å®šä¹‰é™æ€æ–¹æ³•animalShout(),æ¥æ”¶æ¥å£ç±»å‹å‚æ•°</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">animalShout</span><span class="params">(Animal an)</span>&#123;</span><br><span class="line">		an.shout(); <span class="comment">//è°ƒç”¨ä¼ å…¥å¯¹è±¡çš„shout()æ–¹æ³•</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ†ä¸¤æ­¥ï¼š</p>
<p>ç¬¬ä¸€æ­¥ <code>animalShout(new Animal()&#123;&#125;)</code> å‚æ•°ä½ç½®åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè¡¨ç¤ºåˆ›å»ºçš„å¯¹è±¡ä¸ºAnimalçš„å­ç±»å®ä¾‹ï¼Œè¯¥å­ç±»æ˜¯åŒ¿åçš„ã€‚</p>
<p>ç¬¬äºŒæ­¥<code>&#123;&#125;</code>ä¸­ç¼–å†™åŒ¿åå­ç±»çš„å®ç°ä»£ç ã€‚</p>
<h3 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h3><p>Lambda è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ç§°ä¸º<strong>é—­åŒ…</strong>ï¼Œå®ƒæ˜¯æ¨åŠ¨ Java 8 å‘å¸ƒçš„æœ€é‡è¦æ–°ç‰¹æ€§ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªæ¸…æ™°ç®€æ´çš„è¡¨è¾¾å¼æ¥è¡¨è¾¾ä¸€ä¸ªæ¥å£ã€‚</p>
<p>åŒ¿åå†…éƒ¨ç±»å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåŒ¿åå†…éƒ¨ç±»çš„å®ç°éå¸¸ç®€å•ï¼Œä¾‹å¦‚åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œé‚£ä¹ˆåŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•ä»ç„¶å†—ä½™ã€‚</p>
<p>Lambdaè¡¨è¾¾å¼é’ˆå¯¹æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£å®ç°ï¼Œä»¥ç®€æ´çš„è¡¨è¾¾å¼å½¢å¼å®ç°æ¥å£åŠŸèƒ½æ¥ä½œä¸ºæ–¹æ³•å‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(parameters) -&gt;&#123; statements; &#125;</span><br><span class="line">å¯é€‰ç±»å‹å£°æ˜ï¼šä¸éœ€è¦å£°æ˜å‚æ•°ç±»å‹ï¼Œç¼–è¯‘å™¨å¯ä»¥ç»Ÿä¸€è¯†åˆ«å‚æ•°å€¼ã€‚</span><br><span class="line">å¯é€‰çš„å‚æ•°åœ†æ‹¬å·ï¼šä¸€ä¸ªå‚æ•°æ— éœ€å®šä¹‰åœ†æ‹¬å·ï¼Œä½†å¤šä¸ªå‚æ•°éœ€è¦å®šä¹‰åœ†æ‹¬å·ã€‚</span><br><span class="line">å¯é€‰çš„å¤§æ‹¬å·ï¼šå¦‚æœä¸»ä½“åŒ…å«äº†ä¸€ä¸ªè¯­å¥ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨å¤§æ‹¬å·ã€‚</span><br><span class="line">å¯é€‰çš„è¿”å›å…³é”®å­—ï¼šå¦‚æœä¸»ä½“åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼è¿”å›å€¼åˆ™ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿”å›å€¼ï¼Œreturnå¯çœç•¥</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ï¼Œç”¨lambdaè¡¨è¾¾å¼æ¥åšï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">animalShout(()-&gt;System.out.println(name+â€œå–µå–µâ€);)</span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h3><p>Lambdaè¡¨è¾¾å¼å¯ä»¥å®ç°åŒ¿åå†…éƒ¨ç±»çš„åŠŸèƒ½ï¼Œä½†æ˜¯å±€é™åœ¨äºæ¥å£ä¸­åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•æ—¶æ‰èƒ½ä½¿ç”¨Lambdaè¡¨è¾¾å¼ä»£æ›¿åŒ¿åå†…éƒ¨ç±»ã€‚</p>
<p>å› ä¸ºLambdaè¡¨è¾¾å¼æ˜¯åŸºäºå‡½æ•°å¼æ¥å£å®ç°çš„ï¼Œå‡½æ•°å¼æ¥å£å°±æ˜¯åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚</p>
<p>JDK8ä¸­ä¸“é—¨ä¸ºå‡½æ•°å¼æ¥å£å¼•å…¥@FunctionalInterfaceæ³¨è§£ï¼Œæ˜¾ç¤ºåœ°æ ‡è¯†æ¥å£æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå¦‚æœä¸æ˜¯ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Calculate</span>&#123;</span><br><span class="line">	<span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		showSum(<span class="number">10</span>, <span class="number">20</span>, (x,y)-&gt;x+y);  <span class="comment">//å®ç°æ–¹æ³•</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//åˆ›å»ºå‚æ•°ä¸ºæ¥å£çš„æ–¹æ³•</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showSum</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, Calculate cu)</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;å’Œä¸ºï¼š&quot;</span>+cu.sum(x, y));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Lambdaè¡¨è¾¾å¼çš„å¼•ç”¨å½¢å¼"><a href="#Lambdaè¡¨è¾¾å¼çš„å¼•ç”¨å½¢å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼çš„å¼•ç”¨å½¢å¼"></a>Lambdaè¡¨è¾¾å¼çš„å¼•ç”¨å½¢å¼</h3><p>Lambdaè¡¨è¾¾å¼çš„ä¸»ä½“åªæœ‰ä¸€æ¡è¯­å¥æ—¶ï¼Œç¨‹åºå¯é€šè¿‡<code>ï¼šï¼š</code>çš„è¯­æ³•æ ¼å¼æ¥å¼•ç”¨æ–¹æ³•å’Œæ„é€ å™¨ã€‚æœ¬è´¨æ˜¯å¯¹Lambdaè¡¨è¾¾å¼çš„ä¸»ä½“éƒ¨åˆ†å·²å­˜åœ¨çš„æ–¹æ³•è¿›è¡Œç›´æ¥å¼•ç”¨ã€‚</p>
<p>ç›¸å½“äºcalcæ–¹æ³•éœ€è¦å®ç°ï¼Œè€Œåˆç°æˆçš„absæ–¹æ³•å¯ä»¥ç”¨ã€‚</p>
<p>ï¼ˆ1ï¼‰ç±»åå¼•ç”¨æ™®é€šæ–¹æ³•&#x2F;é™æ€æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Calculate</span>&#123;</span><br><span class="line">	<span class="type">int</span> <span class="title function_">calc</span><span class="params">(<span class="type">int</span> num)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒ…å«é™æ€æ–¹æ³•çš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Math</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">abs</span><span class="params">(<span class="type">int</span> num)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(num&lt;<span class="number">0</span>)  <span class="keyword">return</span> -num;</span><br><span class="line">		<span class="keyword">else</span>  <span class="keyword">return</span> num;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printAbs</span><span class="params">(<span class="type">int</span> num, Calculate cu)</span>&#123;</span><br><span class="line">		System.out.println(cu.calc(num));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="comment">//ä½¿ç”¨lambdaè¡¨è¾¾å¼</span></span><br><span class="line">		printAbs(-<span class="number">10</span>, n-&gt;Math.abs(n));</span><br><span class="line">		<span class="comment">//ä½¿ç”¨æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">		printAbs(-<span class="number">10</span>, Math::abs);  ç±»å::ç±»é™æ€æ–¹æ³•/æ™®é€šæ–¹æ³•å</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å¯¹è±¡åå¼•ç”¨æ–¹æ³•</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡å®ä¾‹åŒ–å¯¹è±¡çš„åç§°æ¥å¯¹å…¶æ–¹æ³•è¿›è¡Œå¼•ç”¨ã€‚æ˜¯æ™®é€šæ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Math ma = new Math();</span><br><span class="line">printAbs(-10, n-&gt;ma.abs(n));</span><br><span class="line">printAbs(-10,ma::abs);</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰æ„é€ å™¨å¼•ç”¨æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PersonBuilder</span>&#123;</span><br><span class="line">	Person <span class="title function_">buildPerson</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªPersonç±»ï¼Œå¹¶æ·»åŠ æœ‰å‚æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.name=name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printName</span><span class="params">(String name, PersonBuilder bu)</span>&#123;</span><br><span class="line">		System.out.println(bu.buildPerson(name).getName());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="comment">//ä½¿ç”¨lambdaè¡¨è¾¾å¼   ()-&gt;new ç±»å()</span></span><br><span class="line">		printAbs(<span class="string">&quot;å¼ ä¸‰&quot;</span>, name-&gt;<span class="keyword">new</span> <span class="title class_">Person</span>(name));</span><br><span class="line">		<span class="comment">//ä½¿ç”¨æ–¹æ³•å¼•ç”¨    ç±»å::new</span></span><br><span class="line">		printAbs(<span class="string">&quot;å¼ ä¸‰&quot;</span>, Person::<span class="keyword">new</span>); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h3><p>javaè¯­è¨€å¼•å…¥äº†å¼‚å¸¸ï¼Œä»¥å¼‚å¸¸ç±»çš„å½¢å¼å¯¹æ­£å¸¸æƒ…å†µè¿›è¡Œå°è£…ã€‚</p>
<p>å¼‚å¸¸ç±»éƒ½ç»§æ‰¿è‡ªjava.lang.Throwableç±»ã€‚</p>
<p>Throwableæœ‰ä¸¤ä¸ªç›´æ¥å­ç±»Errorå’ŒExceptionã€‚</p>
<p>å…¶ä¸­Errorç§°ä¸ºé”™è¯¯ç±»ï¼Œä»£è¡¨Javaè¿è¡Œæ—¶äº§ç”Ÿçš„ç³»ç»Ÿå†…éƒ¨é”™è¯¯æˆ–èµ„æºè€—å°½çš„é”™è¯¯ï¼Œå¦‚ç³»ç»Ÿå´©æºƒã€è™šæ‹Ÿæœºé”™è¯¯ã€‚</p>
<p>Exceptionç±»ç§°ä¸ºå¼‚å¸¸ç±»ï¼Œæ ‡è¯†ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„é”™è¯¯ï¼Œå¼‚å¸¸å¤„ç†éƒ½æ˜¯é’ˆå¯¹è¯¥ç±»åŠå…¶å­ç±»ã€‚RuntimeExceptionè¡¨ç¤ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå…¶ä»–è¡¨ç¤ºç¼–è¯‘æ—¶å¼‚å¸¸ã€‚</p>
<p>Throwableç±»ä¸­å¸¸ç”¨çš„æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public String getMessage()</span><br><span class="line">è¿”å›å…³äºå‘ç”Ÿçš„å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™ä¸ªæ¶ˆæ¯åœ¨Throwable ç±»çš„æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–äº†ã€‚</span><br><span class="line">public void printStackTrace()</span><br><span class="line">æ‰“å°toString()ç»“æœå’Œæ ˆå±‚æ¬¡åˆ°System.errï¼Œå³é”™è¯¯è¾“å‡ºæµã€‚</span><br><span class="line">public Throwable getCause()</span><br><span class="line">è¿”å›ä¸€ä¸ªThrowable å¯¹è±¡ä»£è¡¨å¼‚å¸¸åŸå› ã€‚</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ—¶å¼‚å¸¸æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç”±Javaè™šæ‹Ÿæœºè‡ªåŠ¨è¿›è¡Œæ•è·å¤„ç†çš„ã€‚ä¾‹å¦‚æ•°ç»„è¶Šç•Œã€‚</p>
<h3 id="tryâ€¦catchâ€¦finally"><a href="#tryâ€¦catchâ€¦finally" class="headerlink" title="tryâ€¦catchâ€¦finally"></a>tryâ€¦catchâ€¦finally</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨é™¤æ³•æ–¹æ³•ä¸­ï¼š</span><br><span class="line">try&#123;</span><br><span class="line">   å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„è¯­å¥</span><br><span class="line">&#125;catch(Exceptionç±»æˆ–å…¶å­ç±» e1)&#123;</span><br><span class="line">   å¯¹æ•è·çš„å¼‚å¸¸è¿›è¡Œç›¸åº”çš„å¤„ç†</span><br><span class="line">   System.out.println(&quot;å¼‚å¸¸ï¼š&quot;+e1.getMessage());</span><br><span class="line">&#125;finally&#123;</span><br><span class="line">	æ— è®ºç¨‹åºæ˜¯å¦å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œçš„ä»£ç å—</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>try{}ä¸­çš„ä»£ç å—å‘ç”Ÿå¼‚å¸¸ï¼Œç³»ç»Ÿä¼šå°†è¿™ä¸ªå¼‚å¸¸çš„ä¿¡æ¯å°è£…æˆä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ï¼Œä¼ é€’ç»™catch(){}ä»£ç å—ï¼Œcatchä»£ç å—éœ€è¦ä¸€ä¸ªå‚æ•°æŒ‡æ˜å®ƒæ‰€èƒ½æ¥æ”¶çš„å¼‚å¸¸ç±»å‹ï¼Œå¿…é¡»æ˜¯Exceptionç±»æˆ–å…¶å­ç±»ã€‚</p>
<p>finally{}ä¸­çš„ä»£ç ä¸å—returnè¯­å¥å’Œç¨‹åºå¼‚å¸¸çš„å½±å“ï¼Œå¯ä»¥ç”¨æ¥å®Œæˆå¿…é¡»è¦åšçš„äº‹ï¼Œä¾‹å¦‚é‡Šæ”¾ç³»ç»Ÿèµ„æºã€å…³é—­çº¿ç¨‹æ± ç­‰ã€‚ä½†æ˜¯åœ¨tryâ€¦catchâ€¦ä»£ç å—ä¸­æ‰§è¡Œäº†<code>System.exit(0)</code>è¯­å¥çš„è¯ï¼Œfinallyä¸ä¼šæ‰§è¡Œï¼Œå› ä¸º<code>System.exit(0)</code>è¡¨ç¤ºé€€å‡ºå½“å‰çš„javaè™šæ‹Ÿæœºã€‚</p>
<h3 id="throwså…³é”®å­—"><a href="#throwså…³é”®å­—" class="headerlink" title="throwså…³é”®å­—"></a>throwså…³é”®å­—</h3><p>ç”¨äºå°†å¼‚å¸¸ä»å½“å‰æ–¹æ³•ä¸­æŠ›å‡ºï¼Œthrowså†™åœ¨æ–¹æ³•å£°æ˜çš„åé¢ï¼Œåè·Ÿå£°æ˜æ–¹æ³•ä¸­å‘ç”Ÿå¼‚å¸¸çš„ç±»å‹ï¼Œè¿™ç§åšæ³•å«åšæ–¹æ³•ç”³æ˜æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ä¸€ä¸ªæ–¹æ³•å¯ä»¥å£°æ˜æŠ›å‡ºå¤šä¸ªå¼‚å¸¸ï¼Œå¤šä¸ªå¼‚å¸¸ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static int divide(int x, int y) throws Exception&#123;</span><br><span class="line">	int res=x/y;</span><br><span class="line">	return res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨äº†throwsåï¼Œè¿˜éœ€è¦å†å‡ºç°å¼‚å¸¸çš„ä»£ç ï¼ˆmainä¸­ï¼‰å¤„ä½¿ç”¨tryâ€¦catchâ€¦ä»£ç å—è¿›è¡Œæ•è·å¤„ç†ã€‚</p>
<h3 id="throwå…³é”®å­—"><a href="#throwå…³é”®å­—" class="headerlink" title="throwå…³é”®å­—"></a>throwå…³é”®å­—</h3><p>throwç”¨äºæ–¹æ³•ä½“å†…ï¼Œå¹¶ä¸”æŠ›å‡ºçš„æ˜¯ä¸€ä¸ªå¼‚å¸¸ç±»å¯¹è±¡ã€‚</p>
<p>é€šè¿‡throwå…³é”®å­—æŠ›å‡ºå¼‚å¸¸åï¼Œè¿˜éœ€è¦tryâ€¦catchâ€¦æˆ–throwså…³é”®å­—å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void deposit(double amount) throws Exception</span><br><span class="line">&#123;</span><br><span class="line">  if(åˆ¤æ–­)&#123;</span><br><span class="line">      throw new Exception(&quot;å¼‚å¸¸&quot;); //å¯ä»¥ç”¨æ¥æŒ‡ç¤ºå¼‚å¸¸ä¿¡æ¯</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>throwæŠ›å‡ºå¼‚å¸¸å¯¹è±¡ï¼Œç„¶åé€šè¿‡throwså…³é”®å­—æŠ›å‡ºå¼‚å¸¸ï¼Œæœ€åé€šè¿‡tryâ€¦catchâ€¦è¯­å¥æ•è·å¼‚å¸¸ã€‚</p>
<h3 id="è‡ªå®šä¹‰å¼‚å¸¸"><a href="#è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸"></a>è‡ªå®šä¹‰å¼‚å¸¸</h3><p>javaå…è®¸ç”¨æˆ·è‡ªå®šä¹‰å¼‚å¸¸ï¼Œä½†è‡ªå®šä¹‰çš„å¼‚å¸¸ç±»å¿…é¡»ç»§æ‰¿è‡ªExceptionæˆ–å…¶å­ç±»ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ä½¿ç”¨super()è¯­å¥è°ƒç”¨Exceptionçš„æ„é€ æ–¹æ³•å³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> 	<span class="title class_">MyException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">MyException</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="built_in">super</span>();  <span class="comment">//è°ƒç”¨æ— å‚æ„é€ æ–¹æ³•</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">MyException</span><span class="params">(String message)</span>&#123;</span><br><span class="line">		<span class="built_in">super</span>(message);  <span class="comment">//è°ƒç”¨æœ‰å‚æ„é€ æ–¹æ³•</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><p>javaæä¾›åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆJava GCï¼‰ï¼Œè™šæ‹Ÿæœºä¼šè‡ªåŠ¨å›æ”¶åƒåœ¾å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>å½“ä¸€ä¸ªå¯¹è±¡åœ¨å †å†…å­˜ä¸­è¿è¡Œæ—¶ï¼Œæ ¹æ®å®ƒè¢«å¼•ç”¨å˜é‡æ‰€å¼•ç”¨çš„çŠ¶æ€ï¼Œå¯ä»¥æŠŠå®ƒæ‰€å¤„çš„çŠ¶æ€åˆ†ä¸ºä¸‰ç§ï¼š</p>
<p>ï¼ˆ1ï¼‰å¯ç”¨çŠ¶æ€ï¼šå¯¹è±¡è¢«åˆ›å»ºåï¼Œæœ‰ä¸€ä¸ªä»¥ä¸Šçš„å¼•ç”¨å˜é‡å¼•ç”¨å®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡åœ¨ç¨‹åºä¸­å°†å¤„äºå¯ç”¨çŠ¶æ€ï¼Œç¨‹åºå¯ä»¥é€šè¿‡å¼•ç”¨å˜é‡æ¥è°ƒç”¨è¯¥å¯¹è±¡çš„å®ä¾‹å˜é‡å’Œæ–¹æ³•ã€‚</p>
<p>ï¼ˆ2ï¼‰å¯æ¢å¤çŠ¶æ€ï¼šç¨‹åºä¸­æŸä¸ªå¯¹è±¡ä¸å†æœ‰ä»»ä½•å¼•ç”¨å˜é‡å¼•ç”¨å®ƒï¼Œå®ƒå°±è¿›å…¥äº†å¯æ¢å¤çŠ¶æ€ã€‚ç³»ç»Ÿå‡†å¤‡å›æ”¶ï¼Œå›æ”¶ä¹‹å‰ä¼šè°ƒç”¨å¯æ¢å¤çŠ¶æ€å¯¹è±¡çš„<code>finalize()</code>æ–¹æ³•è¿›è¡Œèµ„æºæ¸…ç†ã€‚å¦‚æœåœ¨è°ƒç”¨<code>finalize()</code>æ–¹æ³•ä¹‹å‰é‡æ–°ä½¿ä¸€ä¸ªå¼•ç”¨å˜é‡å¼•ç”¨è¯¥å¯¹è±¡ï¼Œåˆ™è¿™ä¸ªå¯¹è±¡ä¼šå†æ¬¡å˜ä¸ºå¯ç”¨å¯¹è±¡ã€‚</p>
<p>ï¼ˆ3ï¼‰ä¸å¯ç”¨çŠ¶æ€ï¼šè°ƒç”¨<code>finalize()</code>æ–¹æ³•åï¼Œå¯¹è±¡è¿›å…¥ä¸å¯ç”¨çŠ¶æ€ï¼Œå†…å­˜è¢«æ¸…ç†ã€‚</p>
<blockquote>
<p>ä¸€ä¸ªå¯¹è±¡åœ¨å¤±å»å¼•ç”¨æˆä¸ºåƒåœ¾åï¼Œä¼šæš‚æ—¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåƒåœ¾å †ç§¯åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œjavaè™šæ‹Ÿæœºä¼šå¯åŠ¨åƒåœ¾å›æ”¶å™¨å°†è¿™äº›åƒåœ¾å¯¹è±¡ä»å†…å­˜ä¸­é‡Šæ”¾ï¼Œä¹Ÿå°±è¯´å›æ”¶çš„æ—¶æœºæ— æ³•æŠŠæ¡ã€‚</p>
</blockquote>
<p>å¼ºåˆ¶ç³»ç»Ÿè¿›è¡Œåƒåœ¾å›æ”¶çš„æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">System.gc();</span><br><span class="line">æˆ–ï¼š</span><br><span class="line">Runtime.getRuntime().gc();</span><br></pre></td></tr></table></figure>

<h3 id="finalize-æ–¹æ³•"><a href="#finalize-æ–¹æ³•" class="headerlink" title="finalize()æ–¹æ³•"></a>finalize()æ–¹æ³•</h3><p>å½“ä¸€ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­è¢«é‡Šæ”¾æ—¶ï¼Œå®ƒçš„<code>finalize()</code>æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œ<code>finalize()</code>æ–¹æ³•æ˜¯å®šä¹‰åœ¨Objectç±»ä¸­çš„å®ä¾‹æ–¹æ³•ï¼Œæ–¹æ³•åŸå‹ï¼š</p>
<p><code>protected void finalize() throws Throwable&#123;&#125;</code></p>
<p>ä»»ä½•javaç±»éƒ½å¯ä»¥é‡å†™Objectç±»çš„<code>finalize()</code>æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­æ¸…ç†å¯¹è±¡å ç”¨çš„èµ„æºã€‚é‡å†™å®ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class Person&#123;</span><br><span class="line">	public void finalize()&#123;</span><br><span class="line">		System.out.println(&quot;d&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>servletå…¥é—¨</title>
    <url>/2022/03/19/myblog/java/servlet/</url>
    <content><![CDATA[<h3 id="1-Httpåè®®"><a href="#1-Httpåè®®" class="headerlink" title="1.Httpåè®®"></a>1.Httpåè®®</h3><p>HTTPåè®®çš„ç‰¹ç‚¹<br>1.æ”¯æŒå®¢æˆ· &#x2F; æœåŠ¡å™¨æ¨¡å¼ 	<br>2.ç®€å•å¿«é€Ÿ<br>3.çµæ´»<br>4.æ— è¿æ¥ï¼ŒHTTP1.1 ç‰ˆæœ¬åæ”¯æŒå¯æŒç»­è¿æ¥<br>5.æ— çŠ¶æ€</p>
<p>HTTP url:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//host[:port]/[abs_path]</span></span><br><span class="line">http:<span class="comment">//IP(ä¸»æœºå/åŸŸå):ç«¯å£/è®¿é—®çš„èµ„æºè·¯å¾„</span></span><br></pre></td></tr></table></figure>

<ul>
<li>http è¡¨ç¤ºé€šè¿‡HTTPåè®®æ¥å®šä½ç½‘ç»œèµ„æº</li>
<li>host è¡¨ç¤ºåˆæ³•çš„ Internet ä¸»æœºåæˆ–è€… ip åœ°å€</li>
<li>port æŒ‡ä¸€ä¸ªç«¯å£å·ï¼Œä¸ºç©ºåˆ™ä¸º 80</li>
<li>abs_path æŒ‡å®šè¯·æ±‚çš„ URL</li>
</ul>
<h4 id="HTTP-è¯·æ±‚"><a href="#HTTP-è¯·æ±‚" class="headerlink" title="HTTP è¯·æ±‚"></a>HTTP è¯·æ±‚</h4><ul>
<li>httpè¯·æ±‚ç”±è¯·æ±‚è¡Œã€<strong>è¯·æ±‚å¤´</strong>ã€è¯·æ±‚æ­£æ–‡ç»„æˆã€‚<ul>
<li>è¯·æ±‚ä½“ç¬¬ä¸€è¡Œå°±æ˜¯è¯·æ±‚è¡Œï¼›è¯·æ±‚è¡Œç”±è¯·æ±‚æ–¹å¼ï¼Œè¯·æ±‚è·¯å¾„ã€è¯·æ±‚åè®®ç‰ˆæœ¬ä¸‰éƒ¨åˆ†ç»„æˆ</li>
<li>è¯·æ±‚å¤´æŒ‡ä¸€è¡Œä¸€è¡Œçš„é”®å€¼å¯¹</li>
<li>æ­£æ–‡å³æ˜¯å†…å®¹ï¼›GETè¯·æ±‚æ²¡æœ‰æ­£æ–‡ï¼Œå…¶å†…å®¹ç›´æ¥è·Ÿåœ¨åœ°å€åé¢</li>
</ul>
</li>
</ul>
<h4 id="HTTP-å“åº”"><a href="#HTTP-å“åº”" class="headerlink" title="HTTP å“åº”"></a>HTTP å“åº”</h4><ul>
<li>åœ¨æ¥æ”¶å’Œè§£é‡Šè¯·æ±‚æ¶ˆæ¯åï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ª HTTP å“åº”æ¶ˆæ¯ã€‚HTTP å“åº”ç”±çŠ¶æ€è¡Œã€æ¶ˆæ¯æŠ¥å¤´ã€å“åº”æ­£æ–‡ç»„æˆ<ul>
<li>çŠ¶æ€è¡Œç”±åè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ã€è¯·æ±‚ç»“æœç»„æˆ</li>
<li>æ¶ˆæ¯æŠ¥å¤´ä¸è¯·æ±‚å¤´å¤§è‡´ç›¸åŒ</li>
<li>å“åº”æ­£æ–‡å°±æ˜¯æµè§ˆå™¨å‘ˆç°çš„å†…å®¹</li>
</ul>
</li>
</ul>
<h4 id="æ¶ˆæ¯å¤´"><a href="#æ¶ˆæ¯å¤´" class="headerlink" title="æ¶ˆæ¯å¤´"></a>æ¶ˆæ¯å¤´</h4><p>â€ƒâ€ƒHTTPæ¶ˆæ¯ç”±å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„è¯·æ±‚å’ŒæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„å“åº”ç»„æˆï¼Œè¯·æ±‚æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯éƒ½æ˜¯ç”±å¼€å§‹è¡Œï¼ˆå¯¹äºè¯·æ±‚æ¶ˆæ¯ï¼Œ å¼€å§‹è¡Œå°±æ˜¯è¯·æ±‚è¡Œï¼›å“åº”æ¶ˆæ¯åˆ™æ˜¯çŠ¶æ€è¡Œï¼‰ï¼Œæ¶ˆæ¯æŠ¥å¤´ï¼Œç©ºè¡Œï¼Œæ¶ˆæ¯æ­£æ–‡ï¼ˆå¯é€‰ï¼‰ç»„æˆ</p>
<p>â€ƒâ€ƒæ¯ä¸€ä¸ªæŠ¥å¤´åŸŸéƒ½æ˜¯ç”± åå­—+â€:â€+ç©ºæ ¼+å€¼ ç»„æˆï¼Œæ¶ˆæ¯æŠ¥å¤´åŸŸçš„åå­—æ˜¯å¤§å°å†™æ— å…³çš„</p>
<p>1.è¯·æ±‚å¤´ï¼š</p>
<p>â€ƒâ€ƒè¯·æ±‚æŠ¥å¤´å…è®¸å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€’è¯·æ±‚çš„é™„åŠ ä¿¡æ¯ä»¥åŠå®¢æˆ·ç«¯è‡ªèº«çš„ä¿¡æ¯ï¼Œæ— æ³•é€šè¿‡å‚æ•°æ¥ä¼ é€’çš„ç”¨è¯·æ±‚å¤´ã€‚</p>
<ul>
<li><p>refererï¼š è¯¥è¯·æ±‚å¤´æŒ‡æ˜è¯·æ±‚ä»å“ªé‡Œæ¥</p>
<p> æ­¤è¯·æ±‚å¤´åé¢æ¥çš„å€¼ä¸ºä¸Šä¸€ä¸ªé¡µé¢çš„URLåœ°å€ï¼Œé€šå¸¸ç”¨æ¥åšç»Ÿè®¡ã€é˜²ç›—é“¾ã€‚å¦‚æœæ˜¯ä»æµè§ˆå™¨åœ°å€æ ç›´æ¥è¾“å…¥è¿›è¡Œè®¿é—®çš„ï¼Œéƒ½æ²¡æœ‰è¯¥è¯·æ±‚å¤´ã€‚ä¾‹å¦‚ç™¾åº¦çš„å¹¿å‘Šï¼Œæœä¸€ä¸ªä¸œè¥¿ï¼Œå‡ºç°å¹¿å‘Šå­—æ ·çš„è¿æ¥ï¼Œç‚¹å‡»ä¼šè®°å½•æ˜¯ä»ç™¾åº¦æœç´¢è¿›æ¥çš„ã€‚ä¾‹å¦‚é‚€è¯·å¥½å‹ï¼Œç”¨æ¥è®°å½•æ˜¯è°é‚€è¯·è¿›æ¥çš„ã€‚ä¾‹å¦‚ä»aé¡µé¢åˆ°dé¡µé¢ï¼Œå¿…é¡»è¦ç»è¿‡bé¡µé¢å’Œcé¡µé¢ï¼Œé˜²ç›—é“¾ã€‚</p>
</li>
</ul>
<p>2.å“åº”å¤´</p>
<p>â€ƒâ€ƒå“åº”æŠ¥å¤´å…è®¸æœåŠ¡å™¨ä¼ é€’ä¸èƒ½æ”¾åœ¨çŠ¶æ€è¡Œä¸­çš„é™„åŠ å“åº”æ¶ˆæ¯ï¼Œä»¥åŠå…³äºæœåŠ¡å™¨çš„ä¿¡æ¯å’Œå¯¹Request-URLæ‰€æ ‡è¯†çš„èµ„æºè¿›è¡Œä¸‹ä¸€æ­¥è®¿é—®çš„ä¿¡æ¯</p>
<ul>
<li>locationï¼ˆé‡å®šå‘ï¼‰ï¼šlocation å“åº”æŠ¥å¤´åŸŸç”¨äºé‡å®šå‘æ¥æ”¶è€…åˆ°ä¸€ä¸ªæ–°ä½ç½®</li>
</ul>
<p>â€ƒâ€ƒlocationå“åº”æŠ¥å¤´åŸŸï¼Œå¸¸ç”¨åœ¨æœåŠ¡å™¨æ›´æ¢åŸŸåæ—¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>refreshï¼šç¬¬ä¸€ç§æ˜¯å®šæ—¶è‡ªåŠ¨è·³è½¬åˆ° [url]æŒ‡å®šçš„é¡µé¢ï¼ˆå•ä½ä¸ºç§’ï¼‰ï¼ˆ307é‡å®šå‘è¿‡æ¥çš„ï¼‰ï¼Œå¯ä»¥åœ¨htmlé¡µé¢é€šè¿‡metaæ ‡ç­¾å®ç°ï¼Œä¹Ÿå¯ä»¥åœ¨åå°å®ç°ï¼›ç¬¬äºŒç§æ˜¯ä¸å¸¦ [url] æ˜¯æŒ‡æ¯ [content] ç§’åˆ·æ–°ä¸€æ¬¡é¡µé¢</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">&quot;refresh&quot;</span> content=<span class="string">&quot;3;url=http://www.baidu.com&quot;</span>&gt;</span><br></pre></td></tr></table></figure>



<h3 id="2-servletæ¦‚è¿°"><a href="#2-servletæ¦‚è¿°" class="headerlink" title="2.servletæ¦‚è¿°"></a>2.servletæ¦‚è¿°</h3><p>Servlet æ˜¯ Server ä¸ Applet çš„ç¼©å†™ï¼Œæ˜¯æœåŠ¡ç«¯å°ç¨‹åºçš„æ„æ€ã€‚ä½¿ç”¨ Java è¯­è¨€ç¼–å†™çš„æœåŠ¡å™¨ç«¯ç¨‹åºï¼Œå¯ä»¥ç”ŸæˆåŠ¨æ€çš„ WEB é¡µï¼ŒServlet ä¸»è¦è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œå¹¶ç”±æœåŠ¡å™¨è°ƒç”¨æ‰§è¡Œï¼Œ æ˜¯ä¸€ç§æŒ‰ç…§ Servlet æ ‡å‡†æ¥å¼€å‘çš„ç±»ã€‚ æ˜¯ SUN å…¬å¸æä¾›çš„ä¸€é—¨ç”¨äºå¼€å‘åŠ¨æ€ Web èµ„æºçš„æŠ€æœ¯ã€‚ï¼ˆè¨€å¤–ä¹‹æ„ï¼šè¦å®ç° web å¼€å‘ï¼Œéœ€è¦å®ç° Servlet æ ‡å‡†ï¼‰</p>
<p>Servlet æœ¬è´¨ä¸Šä¹Ÿæ˜¯ Java ç±»ï¼Œä½†è¦éµå¾ª Servlet è§„èŒƒè¿›è¡Œç¼–å†™ï¼Œæ²¡æœ‰ main()æ–¹æ³•ï¼Œå®ƒçš„åˆ›å»ºã€ä½¿ç”¨ã€é”€æ¯éƒ½ç”± Servletå®¹å™¨è¿›è¡Œç®¡ç†(å¦‚ Tomcat)ã€‚ï¼ˆè¨€å¤–ä¹‹æ„ï¼šå†™è‡ªå·±çš„ç±»ï¼Œä¸ç”¨å†™ main æ–¹æ³•ï¼Œåˆ«äººè‡ªåŠ¨è°ƒç”¨ï¼‰</p>
<p>Servlet æ˜¯å’Œ HTTP åè®®æ˜¯ç´§å¯†è”ç³»çš„ï¼Œå…¶å¯ä»¥å¤„ç† HTTP åè®®ç›¸å…³çš„æ‰€æœ‰å†…å®¹ã€‚è¿™ä¹Ÿæ˜¯ Servlet åº”ç”¨å¹¿æ³›çš„åŸå› ä¹‹ä¸€ã€‚<br>æä¾›äº† Servlet åŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå«åš Servlet å®¹å™¨ï¼Œå…¶å¸¸è§å®¹å™¨æœ‰å¾ˆå¤šï¼Œå¦‚ Tomcat, Jetty, WebLogic Server, WebSphere, JBoss ç­‰ç­‰ã€‚</p>
<p><strong>tomcatå’Œservletçš„å…³ç³»</strong></p>
<p>Tomcat æ˜¯Webåº”ç”¨æœåŠ¡å™¨,æ˜¯ä¸€ä¸ªServlet&#x2F;JSPå®¹å™¨. Tomcat ä½œä¸ºServletå®¹å™¨,è´Ÿè´£å¤„ç†å®¢æˆ·è¯·æ±‚,æŠŠè¯·æ±‚ä¼ é€ç»™Servlet,å¹¶å°†Servletçš„å“åº”ä¼ é€å›ç»™å®¢æˆ·.è€ŒServletæ˜¯ä¸€ç§è¿è¡Œåœ¨æ”¯æŒJavaè¯­è¨€çš„æœåŠ¡å™¨ä¸Šçš„ç»„ä»¶ã€‚</p>
<h3 id="3-ä½¿ç”¨servlet"><a href="#3-ä½¿ç”¨servlet" class="headerlink" title="3.ä½¿ç”¨servlet"></a>3.ä½¿ç”¨servlet</h3><h4 id="3-1-æ–°å»ºwebé¡¹ç›®"><a href="#3-1-æ–°å»ºwebé¡¹ç›®" class="headerlink" title="3.1.æ–°å»ºwebé¡¹ç›®"></a>3.1.æ–°å»ºwebé¡¹ç›®</h4><p>åˆ›å»ºwebå·¥ç¨‹ï¼Œjava enterprise - web applicationï¼Œå¼•å…¥jdkã€tomcatã€‚</p>
<h4 id="3-2-å®ç°servletè§„èŒƒ"><a href="#3-2-å®ç°servletè§„èŒƒ" class="headerlink" title="3.2.å®ç°servletè§„èŒƒ"></a>3.2.å®ç°servletè§„èŒƒ</h4><p>å®ç° Servlet è§„èŒƒï¼Œå³ç»§æ‰¿ HttpServlet ç±»ï¼ˆtomcaté‡Œçš„jaråŒ…æ”¯æŒçš„ï¼‰ï¼Œè¯¥ç±»ä¸­å·²ç»å®Œæˆäº†é€šä¿¡çš„è§„åˆ™ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œä¸šåŠ¡çš„å®ç°å³å¯ã€‚</p>
<p><strong>é‡å†™ service æ–¹æ³•</strong><br>æ»¡è¶³ Servlet è§„èŒƒåªæ˜¯è®©æˆ‘ä»¬çš„ç±»èƒ½å¤Ÿæ»¡è¶³æ¥æ”¶è¯·æ±‚çš„è¦æ±‚ï¼Œæ¥æ”¶åˆ°è¯·æ±‚åéœ€è¦å¯¹è¯·æ±‚è¿›è¡Œåˆ†æï¼Œä»¥åŠè¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œè®¡ç®—å‡ºç»“æœï¼Œåˆ™éœ€è¦æ·»åŠ ä»£ç ï¼Œåœ¨è§„èŒƒä¸­æœ‰ä¸€ä¸ªå«åš serviceçš„æ–¹æ³•ï¼Œä¸“é—¨ç”¨æ¥åšè¯·æ±‚å¤„ç†çš„æ“ä½œï¼Œä¸šåŠ¡ä»£ç åˆ™å¯ä»¥å†™åœ¨è¯¥æ–¹æ³•ä¸­ã€‚</p>
<p><strong>é€šè¿‡æ³¨è§£è®¾ç½®è·¯å¾„</strong></p>
<p>åœ¨å®Œæˆå¥½äº†ä¸€åˆ‡ä»£ç çš„ç¼–å†™åï¼Œè¿˜éœ€è¦å‘æœåŠ¡å™¨è¯´æ˜ï¼Œç‰¹å®šè¯·æ±‚å¯¹åº”ç‰¹å®šèµ„æºã€‚</p>
<p>å¼€å‘servleté¡¹ç›®ï¼Œä½¿ç”¨@WebServletå°†ä¸€ä¸ªç»§æ‰¿äºjavax.servlet.http.HttpServlet çš„ç±»å®šä¹‰ä¸ºServletç»„ä»¶ã€‚åœ¨Servlet3.0 ä¸­ ï¼Œ å¯ä»¥ä½¿ç”¨@WebServletæ³¨è§£å°†ä¸€ä¸ªç»§æ‰¿javax.servlet.http.HttpServletçš„ç±»æ ‡æ³¨ä¸ºå¯ä»¥å¤„ç†ç”¨æˆ·è¯·æ±‚çš„Servletã€‚</p>
<blockquote>
<p>javax.servletä¸‹é¢æœ‰ä¸¤ä¸ªservlet-apiï¼Œä¸€ä¸ªæ˜¯servlet-apiï¼Œè¿™ä¸ªå®šä¹‰äº†servletè§„èŒƒï¼Œä¸€ä¸ªæ˜¯javax.servlet-apiï¼Œè¿™ä¸ªæ˜¯serlvetæä¾›çš„apiã€‚<br>@WebServletè¿™ä¸ªæ³¨è§£æ˜¯åœ¨javax.servlet-apiä¾èµ–åŒ…é‡Œ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">nameå¯å†™å¯ä¸å†™ï¼Œvalueè¿‡æ»¤å™¨ä¼šæ‹¦æˆªï¼ŒurlPatternsè¿‡æ»¤å™¨ä¸ä¼šæ‹¦æˆª</span><br><span class="line"><span class="meta">@WebServlet(name=&quot;Servlet01&quot;,value=&quot;/ser01&quot;)</span> </span><br><span class="line"><span class="meta">@WebServlet(name=&quot;Servlet01&quot;,urlPatterns = &quot;/ser01&quot;)</span></span><br><span class="line">ä¹Ÿå¯ä»¥é…ç½®å¤šä¸ªè·¯å¾„ï¼š</span><br><span class="line"><span class="meta">@WebServlet(name=&quot;Servlet01&quot;,value=&#123;&quot;/ser01&quot;,&#x27;/ser001&#x27;&#125;)</span> </span><br><span class="line"><span class="meta">@WebServlet(name=&quot;Servlet01&quot;,urlPatterns=&#123;&quot;/ser01&quot;,&#x27;/ser001&#x27;&#125;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-19 17:00</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/ser01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello Servlet!&quot;</span>);</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-å‘å¸ƒé¡¹ç›®å¹¶å¯åŠ¨æœåŠ¡"><a href="#3-3-å‘å¸ƒé¡¹ç›®å¹¶å¯åŠ¨æœåŠ¡" class="headerlink" title="3.3.å‘å¸ƒé¡¹ç›®å¹¶å¯åŠ¨æœåŠ¡"></a>3.3.å‘å¸ƒé¡¹ç›®å¹¶å¯åŠ¨æœåŠ¡</h4><p>åˆ°æ­¤ï¼Œéœ€è¦ç¼–å†™å’Œé…ç½®çš„åœ°æ–¹å·²ç»å®Œæˆï¼Œé¡¹ç›®å·²ç»å®Œæ•´äº†ï¼Œä½†æ˜¯å¦‚æœéœ€è¦å¤–ç•Œèƒ½å¤Ÿè®¿é—®ï¼Œ è¿˜éœ€è¦å°†é¡¹ç›®å‘å¸ƒåˆ°æœåŠ¡å™¨ä¸Šå¹¶è¿è¡ŒæœåŠ¡å™¨ã€‚</p>
<p>è®¾ç½®tomcaté…ç½®ï¼Œè®¾ç½®é¡¹ç›®çš„ç«™ç‚¹åï¼ˆé¡¹ç›®å¯¹å¤–è®¿é—®è·¯å¾„ï¼‰</p>
<p>é…ç½®ä¸­é€‰deploymentæ›´æ”¹ç«™ç‚¹åã€‚</p>
<p>ç„¶åå¯åŠ¨å°±å¯ä»¥è®¿é—®é¡µé¢ã€‚</p>
<p><a href="http://localhost:8080/servlet_demo/ser01">http://localhost:8080/servlet_demo/ser01</a></p>
<p>tomcatæœ‰ä¸ªç»¿ç‚¹è¡¨ç¤ºæ­£åœ¨è¿è¡Œã€‚</p>
<h3 id="4-servletå·¥ä½œæµç¨‹"><a href="#4-servletå·¥ä½œæµç¨‹" class="headerlink" title="4.servletå·¥ä½œæµç¨‹"></a>4.servletå·¥ä½œæµç¨‹</h3><p>1.é€šè¿‡è¯·æ±‚å¤´è·çŸ¥æµè§ˆå™¨è®¿é—®çš„æ˜¯å“ªä¸ªä¸»æœº</p>
<p>2.å†é€šè¿‡è¯·æ±‚è¡Œè·å–è®¿é—®çš„æ˜¯å“ªä¸ªä¸€ä¸ªwebåº”ç”¨</p>
<p>3.å†é€šè¿‡è¯·æ±‚è¡Œä¸­çš„è¯·æ±‚è·¯å¾„è·çŸ¥è®¿é—®çš„æ˜¯å“ªä¸ªèµ„æº</p>
<p>4.é€šè¿‡è·å–çš„èµ„æºè·¯å¾„åœ¨é…ç½®ä¸­åŒ¹é…åˆ°çœŸå®çš„è·¯å¾„</p>
<p>5.æœåŠ¡å™¨ä¼šåˆ›å»ºservletå¯¹è±¡ï¼Œï¼ˆå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œåˆ›å»ºservletå®ä¾‹ï¼Œå¹¶è°ƒç”¨initæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼‰</p>
<p>6.è°ƒç”¨serviceï¼ˆrequestï¼Œ responseï¼‰æ–¹æ³•æ¥å¤„ç†è¯·æ±‚å’Œå“åº”çš„æ“ä½œ</p>
<p>7.è°ƒç”¨serviceå®Œæ¯•åè¿”å›æœåŠ¡å™¨ï¼Œç”±æœåŠ¡å™¨å°†responseç¼“å†²åŒºçš„æ•°æ®å–å‡ºï¼Œä»¥httpå“åº”çš„æ ¼å¼å‘é€ç»™æµè§ˆå™¨</p>
<h3 id="5-servletå·¥ä½œæ¨¡å¼"><a href="#5-servletå·¥ä½œæ¨¡å¼" class="headerlink" title="5.servletå·¥ä½œæ¨¡å¼"></a>5.servletå·¥ä½œæ¨¡å¼</h3><ul>
<li>å®¢æˆ·ç«¯å‘é€è¯·æ±‚è‡³æœåŠ¡å™¨</li>
<li>æœåŠ¡å™¨å¯åŠ¨å¹¶è°ƒç”¨Servletï¼ŒServletæ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚ç”Ÿæˆå“åº”å†…å®¹å¹¶å°†å…¶ä¼ ç»™æœåŠ¡å™¨</li>
<li>æœåŠ¡å™¨å°†å“åº”è¿”å›å®¢æˆ·ç«¯</li>
</ul>
<h3 id="6-servletç”Ÿå‘½å‘¨æœŸ"><a href="#6-servletç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="6.servletç”Ÿå‘½å‘¨æœŸ"></a>6.servletç”Ÿå‘½å‘¨æœŸ</h3><p>Servletæ²¡æœ‰ main()æ–¹æ³•ï¼Œä¸èƒ½ç‹¬ç«‹è¿è¡Œï¼Œå®ƒçš„è¿è¡Œå®Œå…¨ç”± Servlet å¼•æ“æ¥æ§åˆ¶å’Œè°ƒåº¦ã€‚ æ‰€è°“ç”Ÿå‘½å‘¨æœŸï¼ŒæŒ‡çš„æ˜¯servlet å®¹å™¨ä½•æ—¶åˆ›å»º servlet å®ä¾‹ã€ä½•æ—¶è°ƒç”¨å…¶æ–¹æ³•è¿›è¡Œè¯·æ±‚çš„å¤„ç†ã€ ä½•æ—¶å¹¶é”€æ¯å…¶å®ä¾‹çš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p>
<ol>
<li>å®ä¾‹å’Œåˆå§‹åŒ–æ—¶æœºï¼ˆç±»åŠ è½½å’Œå®åŠ›åŒ–ï¼‰<br>å½“è¯·æ±‚åˆ°è¾¾å®¹å™¨æ—¶ï¼Œå®¹å™¨æŸ¥æ‰¾è¯¥ servlet å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ä¾‹å¹¶è¿›è¡Œåˆå§‹åŒ–ã€‚</li>
<li>å°±ç»ª&#x2F;è°ƒç”¨&#x2F;æœåŠ¡é˜¶æ®µ<br>æœ‰è¯·æ±‚åˆ°è¾¾å®¹å™¨ï¼Œå®¹å™¨è°ƒç”¨ servlet å¯¹è±¡çš„ service()æ–¹æ³•,å¤„ç†è¯·æ±‚çš„æ–¹æ³•åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼›<br>HttpServlet çš„ service()æ–¹æ³•ï¼Œä¼šä¾æ®è¯·æ±‚æ–¹å¼æ¥è°ƒç”¨ doGet()æˆ–è€… doPost()æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œ è¿™ä¸¤ä¸ª do æ–¹æ³•é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦å­ç±»å» overrideã€‚</li>
<li>é”€æ¯æ—¶æœº<br>å½“å®¹å™¨å…³é—­æ—¶ï¼ˆåº”ç”¨ç¨‹åºåœæ­¢æ—¶ï¼‰ï¼Œä¼šå°†ç¨‹åºä¸­çš„ Servlet å®ä¾‹è¿›è¡Œé”€æ¯ã€‚</li>
</ol>
<p>ä¸Šè¿°çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥é€šè¿‡ Servlet ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ¥è§‚å¯Ÿã€‚åœ¨ Servlet ä¸­æœ‰ä¸‰ä¸ªç”Ÿå‘½å‘¨ æœŸæ–¹æ³•ï¼Œä¸ç”±ç”¨æˆ·æ‰‹åŠ¨è°ƒç”¨ï¼Œè€Œæ˜¯åœ¨ç‰¹å®šçš„æ—¶æœºç”±å®¹å™¨è‡ªåŠ¨è°ƒç”¨ï¼Œè§‚å¯Ÿè¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³• å³å¯è§‚å¯Ÿåˆ° Servlet çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>1âƒ£ï¸ init æ–¹æ³•ï¼Œåœ¨ Servlet å®ä¾‹åˆ›å»ºä¹‹åæ‰§è¡Œï¼ˆè¯æ˜è¯¥ Servlet æœ‰å®ä¾‹åˆ›å»ºäº†ï¼‰</p>
<p>2âƒ£ï¸service æ–¹æ³•ï¼Œæ¯æ¬¡æœ‰è¯·æ±‚åˆ°è¾¾æŸä¸ª Servlet æ–¹æ³•æ—¶æ‰§è¡Œï¼Œç”¨æ¥å¤„ç†è¯·æ±‚ï¼ˆè¯æ˜è¯¥Servlet è¿›è¡ŒæœåŠ¡äº†ï¼‰</p>
<p>3âƒ£ï¸destroy æ–¹æ³•ï¼ŒServlet å®ä¾‹é”€æ¯æ—¶æ‰§è¡Œï¼ˆè¯æ˜è¯¥ Servlet çš„å®ä¾‹è¢«é”€æ¯äº†ï¼‰</p>
<p>Servlet çš„ç”Ÿå‘½å‘¨æœŸï¼Œç®€å•çš„æ¦‚æ‹¬è¿™å°±åˆ†ä¸ºå››æ­¥ï¼šservlet ç±»åŠ è½½â€“&gt;å®ä¾‹åŒ–â€“&gt;æœåŠ¡â€“&gt;é”€æ¯ã€‚<br>ä¸‹é¢æè¿°ä¸€ä¸‹ Tomcat ä¸ Servlet æ˜¯å¦‚ä½•å·¥ä½œçš„,çœ‹çœ‹ä¸‹é¢çš„æ—¶åºå›¾ï¼š</p>
<p><img src="/images/servlet%E6%97%B6%E5%BA%8F%E5%9B%BE.png"></p>
<ol>
<li>Web Client å‘ Servlet å®¹å™¨ï¼ˆTomcatï¼‰å‘å‡º Http è¯·æ±‚</li>
<li>Servlet å®¹å™¨æ¥æ”¶ Web Client çš„è¯·æ±‚</li>
<li>Servlet å®¹å™¨åˆ›å»ºä¸€ä¸ª HttpServletRequest å¯¹è±¡ï¼Œå°† Web Client è¯·æ±‚çš„ä¿¡æ¯å°è£…åˆ°è¿™ä¸ªå¯¹è±¡ ä¸­</li>
<li>Servlet å®¹å™¨åˆ›å»ºä¸€ä¸ª HttpServletResponse å¯¹è±¡</li>
<li>Servlet å®¹å™¨è°ƒHttpServlet å¯¹è±¡service æ–¹æ³•ï¼ŒæŠŠ Request ä¸ Response ä½œä¸ºå‚æ•°ï¼Œä¼ ç»™ HttpServlet</li>
<li>HttpServlet è°ƒç”¨ HttpServletRequest å¯¹è±¡çš„æœ‰å…³æ–¹æ³•ï¼Œè·å– Http è¯·æ±‚ä¿¡æ¯</li>
<li>HttpServlet è°ƒç”¨ HttpServletResponse å¯¹è±¡çš„æœ‰å…³æ–¹æ³•ï¼Œç”Ÿæˆå“åº”æ•°æ®</li>
<li>Servlet å®¹å™¨æŠŠ HttpServlet çš„å“åº”ç»“æœä¼ ç»™ Web Client</li>
</ol>
<h3 id="7-å½¢å‚ï¼šHttpServletRequestå¯¹è±¡"><a href="#7-å½¢å‚ï¼šHttpServletRequestå¯¹è±¡" class="headerlink" title="7.å½¢å‚ï¼šHttpServletRequestå¯¹è±¡"></a>7.å½¢å‚ï¼šHttpServletRequestå¯¹è±¡</h3><p>HttpServletRequest å¯¹è±¡ï¼šä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šè¯·æ±‚çš„å‚æ•°ï¼Œå‘é€çš„å¤´ä¿¡æ¯ç­‰éƒ½å±äºå®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯ï¼Œservice()æ–¹æ³•ä¸­å½¢å‚æ¥æ”¶çš„HttpServletRequest æ¥å£çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡ä¸»è¦åº”ç”¨åœ¨ HTTP åè®®ä¸Šï¼Œè¯¥å¯¹è±¡æ˜¯ç”± Tomcat å°è£…å¥½ä¼ é€’è¿‡æ¥ã€‚</p>
<p>HttpServletRequest æ˜¯ ServletRequest çš„å­æ¥å£ï¼ŒServletRequest åªæœ‰ä¸€ä¸ªå­æ¥å£ï¼Œå°±æ˜¯ HttpServletRequestã€‚æ—¢ç„¶åªæœ‰ä¸€ä¸ªå­æ¥å£ä¸ºä»€ä¹ˆä¸å°†ä¸¤ä¸ªæ¥å£åˆå¹¶ä¸ºä¸€ä¸ªï¼Ÿ<br>ä»é•¿è¿œä¸Šè®²ï¼šç°åœ¨ä¸»è¦ç”¨çš„åè®®æ˜¯ HTTP åè®®ï¼Œä½†ä»¥åå¯èƒ½å‡ºç°æ›´å¤šæ–°çš„åè®®ã€‚è‹¥ä»¥åæƒ³è¦æ”¯æŒè¿™ç§æ–°åè®®ï¼Œåªéœ€è¦ç›´æ¥ç»§æ‰¿ ServletRequest æ¥å£å°±è¡Œäº†ã€‚</p>
<p>åœ¨ HttpServletRequest æ¥å£ä¸­ï¼Œå®šä¹‰çš„æ–¹æ³•å¾ˆå¤šï¼Œä½†éƒ½æ˜¯å›´ç»•æ¥æ”¶å®¢æˆ·ç«¯å‚æ•°çš„ã€‚ä½†æ˜¯æ€ä¹ˆæ‹¿åˆ°è¯¥å¯¹è±¡å‘¢ï¼Ÿä¸éœ€è¦ï¼Œç›´æ¥åœ¨ Service æ–¹æ³•ä¸­ç”±å®¹å™¨ä¼ å…¥è¿‡æ¥ï¼Œè€Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å–å‡ºå¯¹è±¡ä¸­çš„æ•°æ®ï¼Œè¿›è¡Œåˆ†æã€å¤„ç†ã€‚</p>
<h4 id="æ¥æ”¶è¯·æ±‚"><a href="#æ¥æ”¶è¯·æ±‚" class="headerlink" title="æ¥æ”¶è¯·æ±‚"></a>æ¥æ”¶è¯·æ±‚</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-20 09:41</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/ser03&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet3</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å¸¸ç”¨æ–¹æ³•</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚æ—¶çš„å®Œæ•´è·¯å¾„ï¼ˆä»httpå¼€å§‹ï¼Œåˆ°ï¼Ÿå‰é¢ç»“æŸï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURL() +<span class="string">&quot;&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;url:&quot;</span>+url);</span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚æ—¶çš„éƒ¨åˆ†è·¯å¾„ï¼ˆä»é¡¹ç›®çš„ç«™ç‚¹åç§°å¼€å§‹ï¼Œåˆ°ï¼Ÿå‰é¢ç»“æŸï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> req.getRequestURI();</span><br><span class="line">        System.out.println(<span class="string">&quot;uri:&quot;</span>+uri);</span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚æ—¶çš„å‚æ•°å­—ç¬¦ä¸²ï¼ˆä»ï¼Ÿå¼€å§‹ï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queryString</span> <span class="operator">=</span> req.getQueryString();</span><br><span class="line">        System.out.println(<span class="string">&quot;queryString:&quot;</span>+queryString);</span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚æ–¹å¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> req.getMethod();</span><br><span class="line">        System.out.println(<span class="string">&quot;method:&quot;</span>+method);</span><br><span class="line">        <span class="comment">// è·å–å½“å‰åè®®ç‰ˆæœ¬</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">protocol</span> <span class="operator">=</span> req.getProtocol();</span><br><span class="line">        System.out.println(<span class="string">&quot;protocol:&quot;</span>+protocol);</span><br><span class="line">        <span class="comment">// è·å–é¡¹ç›®çš„ç«™ç‚¹å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">webApp</span> <span class="operator">=</span> req.getContextPath();</span><br><span class="line">        System.out.println(<span class="string">&quot;webApp:&quot;</span>+webApp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è·å–è¯·æ±‚çš„å‚æ•°</span></span><br><span class="line"><span class="comment">         * http://localhost:8080/servlet_demo/ser03?uname=lili&amp;upwd=lslsls&amp;input=111&amp;input=222&amp;input=333</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// è·å–æŒ‡å®šåç§°çš„å‚æ•°å€¼,è¿”å›å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uname</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">upwd</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;upwd&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;uname:&quot;</span>+uname);</span><br><span class="line">        System.out.println(<span class="string">&quot;upwd:&quot;</span>+upwd);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æŒ‡å®šåç§°çš„å‚æ•°çš„æ‰€æœ‰å‚æ•°å€¼,è¿”å›å­—ç¬¦ä¸²æ•°ç»„ï¼ˆç”¨äºå¤é€‰æ¡†ä¼ å€¼ï¼‰</span></span><br><span class="line">        String[] strings = req.getParameterValues(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(strings != <span class="literal">null</span> &amp;&amp; strings.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(String s : strings)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;strings:&quot;</span>+s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¯·æ±‚ä¹±ç é—®é¢˜"><a href="#è¯·æ±‚ä¹±ç é—®é¢˜" class="headerlink" title="è¯·æ±‚ä¹±ç é—®é¢˜"></a>è¯·æ±‚ä¹±ç é—®é¢˜</h4><p>ç”±äºç°åœ¨çš„ request å±äºæ¥æ”¶å®¢æˆ·ç«¯çš„å‚æ•°ï¼Œæ‰€ä»¥å¿…ç„¶æœ‰å…¶é»˜è®¤çš„è¯­è¨€ç¼–ç ï¼Œä¸»è¦æ˜¯ç”±äºåœ¨è§£æè¿‡ç¨‹ä¸­é»˜è®¤ä½¿ç”¨çš„ç¼–ç æ–¹å¼ä¸º ISO-8859-1(æ­¤ç¼–ç ä¸æ”¯æŒä¸­æ–‡)ï¼Œæ‰€ä»¥è§£ææ—¶ä¸€å®šä¼šå‡ºç°ä¹±ç ã€‚è¦æƒ³è§£å†³è¿™ç§ä¹±ç é—®é¢˜ï¼Œéœ€è¦è®¾ç½®request ä¸­çš„ç¼–ç æ–¹å¼ï¼Œå‘Šè¯‰æœåŠ¡å™¨ä»¥ä½•ç§æ–¹å¼æ¥è§£ææ•°æ®ã€‚æˆ–è€…åœ¨æ¥æ”¶åˆ°ä¹±ç æ•°æ®ä»¥åï¼Œå†é€šè¿‡ç›¸åº”çš„ç¼–ç æ ¼å¼è¿˜åŸã€‚<br>æ–¹å¼ä¸€ï¼š</p>
<p><code>String nuname = new String(request.getParameter(name).getBytes(&quot;ISO-8859-1&quot;),&quot;UTF-8&quot;); </code></p>
<p>å€ŸåŠ©äº†String å¯¹è±¡çš„æ–¹æ³•ï¼Œè¯¥ç§æ–¹å¼å¯¹ä»»ä½•è¯·æ±‚æœ‰æ•ˆï¼Œæ˜¯é€šç”¨çš„ã€‚ä½†æ˜¯åŸæœ¬ä¸æ˜¯ä¹±ç çš„ï¼Œä½¿ç”¨çš„è¯ä¼šå‡ºç°ä¹±ç ã€‚<br>Tomcat8èµ·ï¼Œä»¥åçš„GETæ–¹å¼è¯·æ±‚æ˜¯ä¸ä¼šå‡ºç°ä¹±ç çš„ã€‚POSTè¯·æ±‚æ˜¯ä¼šä¹±ç çš„ã€‚</p>
<p>ç”¨JSPè¿›è¡Œpostè¯·æ±‚è¡¨å•æäº¤ï¼šæ–°å»ºlogin.jsp</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;ç™»å½•&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;ser03&quot;</span>&gt;</span><br><span class="line">        å§“åï¼š&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;uname&quot;</span>&gt; &lt;br&gt;</span><br><span class="line">        å¯†ç ï¼š&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;upwd&quot;</span>&gt; &lt;br&gt;</span><br><span class="line">        &lt;button&gt;ç™»å½•&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è®¿é—®ï¼š<a href="http://localhost:8080/servlet_demo/login.jsp">http://localhost:8080/servlet_demo/login.jsp</a></p>
<p>æ–¹å¼äºŒï¼šé€šè¿‡è®¾ç½®æœåŠ¡å™¨è§£æç¼–ç çš„æ ¼å¼ï¼ˆåªé’ˆå¯¹postè¯·æ±‚ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®ç¼–ç æ ¼å¼</span></span><br><span class="line">req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);	</span><br></pre></td></tr></table></figure>

<h4 id="è¯·æ±‚è½¬å‘"><a href="#è¯·æ±‚è½¬å‘" class="headerlink" title="è¯·æ±‚è½¬å‘"></a>è¯·æ±‚è½¬å‘</h4><p>è¯·æ±‚è½¬å‘ï¼Œæ˜¯ä¸€ç§æœåŠ¡å™¨çš„è¡Œä¸ºï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾åï¼ŒæœåŠ¡å™¨è¿›è¡Œè½¬å‘ï¼Œæ­¤æ—¶ä¼šå°†è¯·æ±‚å¯¹è±¡è¿›è¡Œä¿å­˜ï¼Œåœ°å€æ ä¸­çš„ URL åœ°å€ä¸ä¼šæ”¹å˜ï¼Œå¾—åˆ°å“åº”åï¼ŒæœåŠ¡å™¨ç«¯å†å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä»å§‹è‡³ç»ˆåªæœ‰ä¸€ä¸ªè¯·æ±‚å‘å‡ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-20 21:34</span></span><br><span class="line"><span class="comment"> * è¯·æ±‚è½¬å‘è·³è½¬</span></span><br><span class="line"><span class="comment"> * å¯ä»¥è®©è¯·æ±‚ä»æœåŠ¡ç«¯è·³è½¬åˆ°å®¢æˆ·ç«¯å³jspï¼ˆæˆ–è·³è½¬åˆ°æŒ‡å®šServletï¼‰æœåŠ¡å™¨è¡Œä¸º</span></span><br><span class="line"><span class="comment"> * ç‰¹ç‚¹ï¼š1ã€‚æœåŠ¡ç«¯è¡Œä¸º 2ã€‚åœ°å€æ ä¸ä¼šå‘ç”Ÿæ”¹å˜</span></span><br><span class="line"><span class="comment"> * 3ã€‚ä»å§‹è‡³ç»ˆåªæœ‰ä¸€ä¸ªè¯·æ±‚ 4ã€‚requestæ•°æ®å¯ä»¥å…±äº«</span></span><br><span class="line"><span class="comment"> * åªèƒ½è·³ä¸€æ¬¡</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/ser04&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet4</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„å‚æ•°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uname</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ser04 uname:&quot;</span>+uname);</span><br><span class="line">        <span class="comment">// è¯·æ±‚è½¬å‘è·³è½¬åˆ°ser03</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;ser03&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="requestä½œç”¨åŸŸ"><a href="#requestä½œç”¨åŸŸ" class="headerlink" title="requestä½œç”¨åŸŸ"></a><strong>requestä½œç”¨åŸŸ</strong></h4><p>é€šè¿‡è¯¥å¯¹è±¡å¯ä»¥åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ä¼ é€’æ•°æ®ï¼Œä½œç”¨èŒƒå›´ï¼šåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æœ‰æ•ˆï¼Œå³æœåŠ¡å™¨è·³è½¬æœ‰æ•ˆã€‚ï¼ˆè¯·æ±‚è½¬å‘è·³è½¬æ—¶æœ‰æ•ˆï¼Œç›´æ¥è®¿é—®è·³è½¬çš„urlæ— æ•ˆï¼‰ã€‚ä½œç”¨åŸŸåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­ï¼Œåœ¨è¯·æ±‚è½¬å‘è¿‡ç¨‹ä¸­é€šè¿‡requestæ¥ä¼ è¾“&#x2F;å…±äº«æ•°æ®ã€‚</p>
<p>Ser05ï¼Œå‡†å¤‡ç”¨æ¥è¯·æ±‚è½¬å‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-20 21:34</span></span><br><span class="line"><span class="comment"> * requestä½œç”¨åŸŸ</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/ser05&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet5</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®åŸŸå¯¹è±¡</span></span><br><span class="line">        req.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;list&quot;</span>, list);</span><br><span class="line">        <span class="comment">// è¯·æ±‚è½¬å‘å¹¶è·³è½¬åˆ°Servlet6ï¼Œå…±äº«åŒä¸€ä¸ªreqå¯¹è±¡</span></span><br><span class="line">        <span class="comment">//req.getRequestDispatcher(&quot;ser06&quot;).forward(req, resp);</span></span><br><span class="line">        <span class="comment">// ä¸€èˆ¬æ˜¯ä»å®¢æˆ·ç«¯è·å–æ•°æ®ï¼Œæ‰€ä»¥è·³è½¬åˆ°jspå®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="comment">// è¯·æ±‚è½¬å‘è·³è½¬åˆ°jspï¼Œå¹¶é€šè¿‡åŸŸå¯¹è±¡ä¼ é€’æ•°æ®</span></span><br><span class="line">        <span class="comment">// htmlå°±ä¸è¡Œï¼Œå› ä¸ºæ˜¯é™æ€é¡µé¢ï¼Œè€Œjspæ˜¯åŠ¨æ€é¡µé¢</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;attribute.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·³è½¬åˆ°ser06</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-20 21:34</span></span><br><span class="line"><span class="comment"> * requestä½œç”¨åŸŸ</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/ser06&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet6</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// è·å–åŸŸå¯¹è±¡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) req.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;nameï¼š&quot;</span> + name);</span><br><span class="line">        List&lt;String&gt; list = (List&lt;String&gt;) req.getAttribute(<span class="string">&quot;list&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·³è½¬åˆ°jspï¼š</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;attributeé¡µé¢&lt;/h2&gt;</span><br><span class="line">&lt;%-- å¦‚æœè¦åœ¨jspä¸­å†™javaä»£ç ï¼Œéœ€è¦å†™åœ¨è„šæœ¬æ®µä¸­ --%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="comment">// è·å–åŸŸå¯¹è±¡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) request.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;nameï¼š&quot;</span> + name);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<h3 id="8-å½¢å‚ï¼šHttpServletResponseå¯¹è±¡"><a href="#8-å½¢å‚ï¼šHttpServletResponseå¯¹è±¡" class="headerlink" title="8.å½¢å‚ï¼šHttpServletResponseå¯¹è±¡"></a>8.å½¢å‚ï¼š<strong>HttpServletResponseå¯¹è±¡</strong></h3><p>WebæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„httpè¯·æ±‚ï¼Œä¼šé’ˆå¯¹æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªç”¨äºä»£è¡¨è¯·æ±‚çš„ request å¯¹è±¡å’Œä»£è¡¨å“åº”çš„ response å¯¹è±¡ã€‚<br>request å’Œ response å¯¹è±¡ä»£è¡¨è¯·æ±‚å’Œå“åº”ï¼šè·å–å®¢æˆ·ç«¯æ•°æ®ï¼Œéœ€è¦é€šè¿‡ request å¯¹è±¡ï¼›å‘å®¢æˆ·ç«¯è¾“å‡ºæ•°æ®ï¼Œéœ€è¦é€šè¿‡ response å¯¹è±¡ã€‚</p>
<p>HttpServletResponse çš„ä¸»è¦åŠŸèƒ½ç”¨äºæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œå“åº”ï¼Œå°† Web æœåŠ¡å™¨å¤„ç†åçš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚service()æ–¹æ³•ä¸­å½¢å‚æ¥æ”¶çš„æ˜¯ HttpServletResponse æ¥å£çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­å°è£…äº†å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€å‘é€å“åº”å¤´ï¼Œå‘é€å“åº”çŠ¶æ€ç çš„æ–¹æ³•ã€‚</p>
<h4 id="å“åº”æ•°æ®"><a href="#å“åº”æ•°æ®" class="headerlink" title="å“åº”æ•°æ®"></a>å“åº”æ•°æ®</h4><p>æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œå¯ä»¥é€šè¿‡ HttpServletResponse å¯¹è±¡ç›´æ¥è¿›è¡Œå“åº”ï¼Œå“åº”æ—¶éœ€è¦è·å–è¾“å‡ºæµã€‚æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<p>getWriter() è·å–å­—ç¬¦æµ(åªèƒ½å“åº”å­—ç¬¦) </p>
<p>getOutputStream() è·å–å­—èŠ‚æµ(èƒ½å“åº”ä¸€åˆ‡æ•°æ®)</p>
<p>å“åº”å›çš„æ•°æ®åˆ°å®¢æˆ·ç«¯è¢«æµè§ˆå™¨è§£æã€‚<br>æ³¨æ„ï¼šä¸¤è€…ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚ä¸€ä¸ªæ–‡ä»¶é‡Œåªèƒ½ç”¨ä¸€ä¸ªï¼Œå› ä¸ºresponseåªæœ‰ä¸€ä¸ªã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-22 08:50</span></span><br><span class="line"><span class="comment"> * getWriter() å­—ç¬¦è¾“å‡ºæµ(è¾“å‡ºå­—ç¬¦ä¸²)</span></span><br><span class="line"><span class="comment"> * getOutputStream() å­—èŠ‚è¾“å‡ºæµ(è¾“å‡ºä¸€åˆ‡æ•°æ®)</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/ser07&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet7</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"><span class="comment">//        // getWriteè·å–å­—ç¬¦è¾“å‡ºæµ</span></span><br><span class="line"><span class="comment">//        PrintWriter writer = resp.getWriter();</span></span><br><span class="line"><span class="comment">//        // è¾“å‡ºæ•°æ®</span></span><br><span class="line"><span class="comment">//        writer.write(&quot;hello&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// getOutputStreamå­—èŠ‚è¾“å‡ºæµ</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> resp.getOutputStream();</span><br><span class="line">        <span class="comment">// è¾“å‡ºæ•°æ®</span></span><br><span class="line">        out.write(<span class="string">&quot;hi&quot;</span>.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å“åº”ä¹±ç é—®é¢˜"><a href="#å“åº”ä¹±ç é—®é¢˜" class="headerlink" title="å“åº”ä¹±ç é—®é¢˜"></a>å“åº”ä¹±ç é—®é¢˜</h4><p>åœ¨å“åº”ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å“åº”çš„å†…å®¹ä¸­å«æœ‰ä¸­æ–‡ï¼Œåˆ™æœ‰å¯èƒ½å‡ºç°ä¹±ç ã€‚è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨å“åº”çš„æ•°æ®ä¹Ÿä¼šç»è¿‡ç½‘ç»œä¼ è¾“ï¼ŒæœåŠ¡å™¨ç«¯æœ‰ä¸€ç§ç¼–ç æ–¹å¼ï¼Œåœ¨å®¢æˆ·ç«¯ä¹Ÿå­˜åœ¨ä¸€ç§ç¼–ç æ–¹å¼ï¼Œå½“ä¸¤ç«¯ä½¿ç”¨çš„ç¼–ç æ–¹å¼ä¸åŒæ—¶åˆ™å‡ºç°ä¹±ç ã€‚</p>
<p>getWriter()çš„å­—ç¬¦ä¹±ç <br>å¯¹äº getWriter()è·å–åˆ°çš„å­—ç¬¦æµï¼Œå“åº”ä¸­æ–‡å¿…å®šå‡ºä¹±ç ï¼Œç”±äºæœåŠ¡å™¨ç«¯åœ¨è¿›è¡Œç¼–ç æ—¶é»˜è®¤ä¼šä½¿ç”¨ ISO-8859-1 æ ¼å¼çš„ç¼–ç ï¼Œè¯¥ç¼–ç æ–¹å¼å¹¶ä¸æ”¯æŒä¸­æ–‡ã€‚</p>
<p>è¦è§£å†³è¯¥ç§ä¹±ç åªèƒ½åœ¨æœåŠ¡å™¨ç«¯å‘ŠçŸ¥æœåŠ¡å™¨ä½¿ç”¨ä¸€ç§èƒ½å¤Ÿæ”¯æŒä¸­æ–‡çš„ç¼–ç æ ¼å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬é€šå¸¸ç”¨çš„â€UTF-8â€ã€‚</p>
<p>å®¢æˆ·ç«¯ä¹Ÿè¦è®¾ç½®ï¼Œå­—èŠ‚è¾“å‡ºæµå¯ä»¥è®¾ç½®å“åº”ç±»å‹ï¼Œé»˜è®¤æ˜¯å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®æœåŠ¡ç«¯çš„ç¼–ç æ ¼å¼</span></span><br><span class="line">resp.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®å®¢æˆ·ç«¯çš„ç¼–ç æ ¼å¼å’Œå“åº”ç±»å‹</span></span><br><span class="line">resp.setHeader(<span class="string">&quot;content-type&quot;</span>, <span class="string">&quot;text/html;charset=UTF-8&quot;</span>);       </span><br></pre></td></tr></table></figure>

<p>å­—ç¬¦è¾“å‡ºæµä¹Ÿä¸€æ ·ã€‚</p>
<p>ä¹Ÿå¯ä»¥åŒæ—¶è®¾ç½®å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç¼–ç æ ¼å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæ—¶è®¾ç½®æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ç¼–ç æ ¼å¼</span></span><br><span class="line">resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼šè¦æƒ³è§£å†³å“åº”çš„ä¹±ç ï¼Œåªéœ€è¦ä¿è¯ä½¿ç”¨æ”¯æŒä¸­æ–‡çš„ç¼–ç æ ¼å¼ã€‚å¹¶ä¸”ä¿è¯æœåŠ¡å™¨ç«¯ å’Œå®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„ç¼–ç æ–¹å¼å³å¯ã€‚</p>
<h4 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h4><p>é‡å®šå‘æ˜¯ä¸€ç§æœåŠ¡å™¨æŒ‡å¯¼ï¼Œå®¢æˆ·ç«¯çš„è¡Œä¸ºã€‚å®¢æˆ·ç«¯å‘å‡ºç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œè¢«æœåŠ¡å™¨æ¥æ”¶å¤„ç†åï¼ŒæœåŠ¡å™¨ä¼šè¿›è¡Œå“åº”ï¼Œåœ¨å“åº”çš„åŒæ—¶ï¼ŒæœåŠ¡å™¨ä¼šç»™å®¢æˆ·ç«¯ä¸€ä¸ªæ–°çš„åœ°å€ï¼ˆä¸‹æ¬¡è¯·æ±‚çš„åœ°å€ response.sendRedirect(url);ï¼‰ï¼Œå½“å®¢æˆ·ç«¯æ¥æ”¶åˆ°å“åº”åï¼Œä¼šç«‹åˆ»ã€é©¬ä¸Šã€è‡ªåŠ¨æ ¹æ®æœåŠ¡å™¨ç»™çš„æ–°åœ°å€å‘èµ·ç¬¬äºŒä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å¹¶ä½œå‡ºå“åº”ï¼Œé‡å®šå‘å®Œæˆã€‚<br>ä»æè¿°ä¸­å¯ä»¥çœ‹å‡ºé‡å®šå‘å½“ä¸­æœ‰ä¸¤ä¸ªè¯·æ±‚å­˜åœ¨ï¼Œå¹¶ä¸”å±äºå®¢æˆ·ç«¯è¡Œä¸ºã€‚</p>
<p>ç‰¹ç‚¹ï¼š<br>æœåŠ¡ç«¯æŒ‡å¯¼ï¼Œå®¢æˆ·ç«¯è¡Œä¸º<br>å­˜åœ¨ä¸¤æ¬¡è¯·æ±‚<br> requestå¯¹è±¡ä¸å…±äº«</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-22 08:50</span></span><br><span class="line"><span class="comment"> * é‡å®šå‘ 302</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/ser08&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet8</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ser08&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">uname</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ser08:&quot;</span>+uname);</span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;ser07&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è§‚å¯Ÿæµè§ˆå™¨æˆ‘ä»¬å‘ç°ç¬¬ä¸€æ¬¡è¯·æ±‚è·å¾—çš„å“åº”ç ä¸º 302ï¼Œå¹¶ä¸”å«æœ‰ä¸€ä¸ª location å¤´ä¿¡æ¯ã€‚å¹¶ä¸”åœ°å€æ æœ€ç»ˆçœ‹åˆ°çš„åœ°å€æ˜¯å’Œç¬¬ä¸€æ¬¡è¯·æ±‚åœ°å€ä¸åŒçš„ï¼Œåœ°å€æ å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<h4 id="è¯·æ±‚è½¬å‘ä¸é‡å®šå‘çš„åŒºåˆ«"><a href="#è¯·æ±‚è½¬å‘ä¸é‡å®šå‘çš„åŒºåˆ«" class="headerlink" title="è¯·æ±‚è½¬å‘ä¸é‡å®šå‘çš„åŒºåˆ«"></a><strong>è¯·æ±‚è½¬å‘ä¸é‡å®šå‘çš„åŒºåˆ«</strong></h4><p><img src="/images/%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91.png"></p>
<p>å¯¹äºè¯·æ±‚è½¬å‘ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå‰ç«¯é¡µé¢è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œreq.getAttributeè·å–å‚æ•°ï¼Œæˆ–æ˜¯req.setAttributeè®¾ç½®å‚æ•°ï¼Œä½¿ç”¨è¯·æ±‚è½¬å‘å¯ä»¥å°†å‚æ•°ä¼ é€’åˆ°jspé¡µé¢ï¼Œjspé¡µé¢ä½¿ç”¨req.getAttributeè¿›è¡Œè·å–ã€‚</p>
<p>è€Œé‡å®šå‘æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„é¡µé¢ï¼Œä¸¤ä¸ªé¡µé¢ä¹‹é—´æ²¡æœ‰å‚æ•°ä¼ é€’ã€‚</p>
<p>è¯·æ±‚è½¬å‘çš„åœ°å€åªèƒ½æ˜¯å½“å‰ç«™ç‚¹ä¸‹ï¼ˆå­—ç¬¦ä¸²å‚æ•°å°±æ˜¯åŠ è½½é¡¹ç›®æ ¹ç›®å½•åé¢çš„å­—ç¬¦ä¸²ï¼‰ï¼Œé‡å®šå‘åœ°å€å¯ä»¥æ˜¯ä»»æ„åœ°å€ã€‚è·¨åŸŸè·³è½¬åªèƒ½ç”¨é‡å®šå‘ã€‚</p>
<h3 id="9-cookie"><a href="#9-cookie" class="headerlink" title="9.cookie"></a>9.cookie</h3><p>webç¨‹åºä½¿ç”¨httpåè®®ä¼ è¾“ï¼Œhttpæ— çŠ¶æ€ï¼Œå¯¼è‡´æ¯ä¸€æ¬¡è¿æ¥ä¼ è¾“çš„æ•°æ®é‡å¢å¤§ã€‚æœåŠ¡å™¨ä»ç½‘ç»œè¿æ¥ä¸­æ— æ³•è·å¾—å®¢æˆ·ç«¯èº«ä»½ï¼Œcookieç›¸å½“äºæ˜¯æœåŠ¡ç«¯é¢å‘ç»™å®¢æˆ·ç«¯çš„é€šè¡Œè¯ã€‚ä¸åŒçš„æœåŠ¡å™¨åº”ç”¨ç»™å®¢æˆ·ç«¯çš„cookieä¹Ÿä¸ä¸€æ ·ï¼Œæ˜¯éš”ç¦»çš„ã€‚</p>
<p>cookieæ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ç§æŠ€æœ¯ï¼Œé€šè¿‡æœåŠ¡å™¨çš„ç¨‹åºèƒ½å°†ä¸€äº›åªé¡»ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæˆ–è€…åœ¨å®¢æˆ·ç«¯è¿›è¡Œå¤„ç†çš„æ•°æ®ï¼Œæ”¾åœ¨æœ¬åœ°çš„è®¡ç®—æœºä¸Šï¼Œä¸éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œå› è€Œæé«˜ç½‘é¡µå¤„ç†çš„æ•ˆç‡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå‡å°‘æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œä½†æ˜¯ç”±äºcookieæ˜¯æœåŠ¡å™¨ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å…¶å®‰å…¨æ€§ä¹Ÿæ˜¯å¾ˆå·®çš„ã€‚ä¾‹å¦‚å¸¸è§çš„è®°ä½å¯†ç åˆ™å¯ä»¥é€šè¿‡cookieæ¥å®ç°ï¼Œè¿˜æœ‰é€šå¸¸çš„æ¨èæ˜¾ç¤ºã€‚</p>
<p>æœ‰ä¸€ä¸ªä¸“é—¨æ“ä½œCookieçš„ç±»javax.servlet.http.Cookieã€‚éšç€æœåŠ¡å™¨ç«¯çš„å“åº”å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä¿å­˜åœ¨æµè§ˆå™¨ã€‚å½“ä¸‹æ¬¡å†è®¿é—®æœåŠ¡å™¨æ—¶æŠŠCookieå†å¸¦å›æœåŠ¡å™¨ã€‚</p>
<p>Cookieçš„æ ¼å¼ï¼šé”®å€¼å¯¹ç”¨&#x3D;è¿æ¥ï¼Œå¤šä¸ªé”®å€¼å¯¹é—´ç”¨;éš”å¼€ã€‚</p>
<h4 id="cookieçš„åˆ›å»ºå’Œå‘é€"><a href="#cookieçš„åˆ›å»ºå’Œå‘é€" class="headerlink" title="cookieçš„åˆ›å»ºå’Œå‘é€"></a>cookieçš„åˆ›å»ºå’Œå‘é€</h4><p>é€šè¿‡ new Cookie(â€œkeyâ€,â€œvalueâ€);æ¥åˆ›å»ºä¸€ä¸ª Cookie å¯¹è±¡ï¼Œè¦æƒ³å°† Cookie éšå“åº”å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œéœ€è¦å…ˆæ·»åŠ åˆ° response å¯¹è±¡ä¸­ï¼Œresponse.addCookie(cookie);æ­¤æ—¶è¯¥ cookie å¯¹è±¡åˆ™éšç€å“åº”å‘é€è‡³äº†å®¢æˆ·ç«¯ã€‚åœ¨æµè§ˆå™¨ä¸Šå¯ä»¥çœ‹è§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.cookie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-26 11:04</span></span><br><span class="line"><span class="comment"> * cookieçš„åˆ›å»ºå’Œå‘é€</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/coo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cookie01</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºcookie nameå”¯ä¸€</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">        <span class="comment">// å‘é€ï¼ˆå“åº”ï¼‰cookie</span></span><br><span class="line">        resp.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>macæµè§ˆå™¨æ£€æŸ¥cookieï¼šå³é”®æ£€æŸ¥å…ƒç´ â€“å‚¨å­˜ç©ºé—´â€“ç‚¹å‡»cookie</p>
<h4 id="cookieçš„è·å–"><a href="#cookieçš„è·å–" class="headerlink" title="cookieçš„è·å–"></a>cookieçš„è·å–</h4><p>åœ¨æœåŠ¡å™¨ç«¯åªæä¾›äº†ä¸€ä¸ª getCookies()çš„æ–¹æ³•ç”¨æ¥è·å–å®¢æˆ·ç«¯å›ä¼ çš„æ‰€æœ‰ cookie ç»„æˆçš„ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœéœ€è¦è·å–å• ä¸ª cookie åˆ™éœ€è¦é€šè¿‡éå†ï¼ŒgetName()è·å– Cookie çš„åç§°ï¼ŒgetValue()è·å– Cookie çš„å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.cookie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-26 11:04</span></span><br><span class="line"><span class="comment"> * cookieçš„è¿”å›ï¼Œæ˜¯æ•°ç»„</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/coo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cookie02</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// è·å–cookieæ•°ç»„</span></span><br><span class="line">        Cookie[] cookies = req.getCookies();</span><br><span class="line">        <span class="comment">// éç©ºåˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span>(cookies != <span class="literal">null</span> &amp;&amp; cookies.length &gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">// éå†cookieæ•°ç»„</span></span><br><span class="line">            <span class="keyword">for</span>(Cookie cookie : cookies)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cookie.getName();</span><br><span class="line">                <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cookie.getValue();</span><br><span class="line">                System.out.println(<span class="string">&quot;åç§°ï¼š&quot;</span>+name+<span class="string">&quot;--å€¼ï¼š&quot;</span>+value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è¿è¡Œå°±æœ‰ä¸Šæ¬¡ä¼ å…¥æµè§ˆå™¨çš„cookieã€‚</p>
<h4 id="cookieè®¾ç½®åˆ°æœŸæ—¶é—´"><a href="#cookieè®¾ç½®åˆ°æœŸæ—¶é—´" class="headerlink" title="cookieè®¾ç½®åˆ°æœŸæ—¶é—´"></a>cookieè®¾ç½®åˆ°æœŸæ—¶é—´</h4><p>é™¤äº† Cookie çš„åç§°å’Œå†…å®¹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å…³å¿ƒä¸€ä¸ªä¿¡æ¯ï¼Œåˆ°æœŸæ—¶é—´ï¼Œåˆ°æœŸæ—¶é—´ç”¨æ¥æŒ‡å®šè¯¥ cookie ä½•æ—¶å¤±æ•ˆã€‚é»˜è®¤ ä¸ºå½“å‰æµè§ˆå™¨å…³é—­å³å¤±æ•ˆã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾å®š cookie çš„æœ‰æ•ˆæ—¶é—´ï¼ˆé€šè¿‡åˆ°æœŸæ—¶é—´è®¡ç®—ï¼‰ï¼Œé€šè¿‡ setMaxAge(int time);æ–¹æ³•è®¾å®š cookie çš„æœ€å¤§æœ‰æ•ˆæ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚</p>
<p>åˆ°æœŸæ—¶é—´çš„å–å€¼ï¼š</p>
<ul>
<li><p>è´Ÿæ•´æ•°</p>
<p>è‹¥ä¸ºè´Ÿæ•°ï¼Œè¡¨ç¤ºä¸åœ¨ç¡¬ç›˜å­˜å‚¨è¯¥ cookieã€‚</p>
<p>cookie çš„ maxAge å±æ€§çš„é»˜è®¤å€¼å°±æ˜¯-1ï¼Œè¡¨ç¤ºåªåœ¨æµè§ˆå™¨å†…å­˜ä¸­å­˜æ´»ï¼Œä¸€æ—¦å…³é—­æµè§ˆå™¨çª—å£ï¼Œé‚£ä¹ˆ cookie å°±ä¼šæ¶ˆå¤±ã€‚</p>
</li>
<li><p>æ­£æ•´æ•°</p>
<p>å¤§äº 0 çš„æ•´æ•°ï¼Œè¡¨ç¤ºå­˜å‚¨çš„ç§’æ•°ã€‚</p>
<p>è¡¨ç¤º cookie å¯¹è±¡å¯å­˜æ´»æŒ‡å®šçš„ç§’æ•°ã€‚å½“ç”Ÿå‘½å¤§äº 0 æ—¶ï¼Œæµè§ˆå™¨ä¼šæŠŠ Cookie ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼Œå°±ç®—å…³é—­æµè§ˆå™¨ï¼Œ å°±ç®—é‡å¯å®¢æˆ·ç«¯ç”µè„‘ï¼Œcookie ä¹Ÿä¼šå­˜æ´»ç›¸åº”çš„æ—¶é—´ã€‚</p>
</li>
<li><p>é›¶(ç”¨äºåˆ é™¤Cookie)</p>
<p>è‹¥ä¸º 0ï¼Œè¡¨ç¤ºåˆ é™¤è¯¥ cookieã€‚</p>
<p>cookie ç”Ÿå‘½ç­‰äº 0 æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å€¼ï¼Œå®ƒè¡¨ç¤º cookie è¢«ä½œåºŸï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåŸæ¥æµè§ˆå™¨å·²ç»ä¿å­˜äº†è¿™ä¸ª Cookieï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ Cookie çš„ setMaxAge(0)æ¥åˆ é™¤è¿™ä¸ª Cookieã€‚ æ— è®ºæ˜¯åœ¨æµè§ˆå™¨å†…å­˜ä¸­ï¼Œè¿˜æ˜¯åœ¨å®¢æˆ·ç«¯ ç¡¬ç›˜ä¸Šéƒ½ä¼šåˆ é™¤è¿™ä¸ª Cookieã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.cookie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-26 11:04</span></span><br><span class="line"><span class="comment"> * cookieçš„åˆ°æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/coo3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cookie03</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// é»˜è®¤å€¼-1ï¼Œè¡¨ç¤ºåªåœ¨æµè§ˆå™¨å†…å­˜ä¸­</span></span><br><span class="line">        <span class="comment">// åˆ›å»ºCookieå¯¹è±¡</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®Cookie 3å¤©åå¤±æ•ˆ</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">3</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">        <span class="comment">// å‘é€Cookieå¯¹è±¡ è®¾ç½®ä¹‹åå¿…éœ€è¿›è¡Œå“åº”</span></span><br><span class="line">        resp.addCookie(cookie);</span><br><span class="line">        <span class="comment">// åˆ é™¤ä¹‹å‰çš„cookie</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">oldCookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;kkk&quot;</span>);</span><br><span class="line">        oldCookie.setMaxAge(<span class="number">0</span>);</span><br><span class="line">        resp.addCookie(oldCookie);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="cookieçš„æ³¨æ„ç‚¹"><a href="#cookieçš„æ³¨æ„ç‚¹" class="headerlink" title="cookieçš„æ³¨æ„ç‚¹"></a>cookieçš„æ³¨æ„ç‚¹</h4><ul>
<li>Cookieä¿å­˜åœ¨å½“å‰æµè§ˆå™¨ä¸­ã€‚</li>
</ul>
<p>åœ¨ä¸€èˆ¬çš„ç«™ç‚¹ä¸­å¸¸å¸¸æœ‰è®°ä½ç”¨æˆ·åè¿™æ ·ä¸€ä¸ªæ“ä½œï¼Œè¯¥æ“ä½œåªæ˜¯å°†ä¿¡æ¯ä¿å­˜åœ¨æœ¬æœºä¸Šï¼Œæ¢ç”µè„‘ä»¥åè¿™äº›ä¿¡æ¯å°±æ—  æ•ˆäº†ã€‚è€Œä¸” cookie è¿˜ä¸èƒ½è·¨æµè§ˆå™¨ã€‚</p>
<ul>
<li>Cookieå­˜ä¸­æ–‡é—®é¢˜ ï¼ˆä¸€èˆ¬ä¸å­˜ä¸­æ–‡ï¼‰</li>
</ul>
<p>Cookie ä¸­ä¸èƒ½å‡ºç°ä¸­æ–‡ï¼Œå¦‚æœæœ‰ä¸­æ–‡åˆ™é€šè¿‡ URLEncoder.encode()æ¥è¿›è¡Œç¼–ç ï¼Œè·å–æ—¶é€šè¿‡ URLDecoder.decode()æ¥è¿›è¡Œè§£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;å§“å&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="string">&quot;å¼ ä¸‰&quot;</span>;</span><br><span class="line"><span class="comment">// é€šè¿‡ URLEncoder.encode()æ¥è¿›è¡Œç¼–ç </span></span><br><span class="line">name = URLEncoder.encode(name);</span><br><span class="line">value = URLEncoder.encode(value);</span><br><span class="line"><span class="comment">// åˆ›å»ºCookieå¯¹è±¡</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(name,value);</span><br><span class="line"><span class="comment">// å‘é€Cookieå¯¹è±¡</span></span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//è·å–æ—¶é€šè¿‡ URLDecoder.decode()æ¥è¿›è¡Œè§£ç </span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> URLDecoder.decode(cookie.getName());</span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> URLDecoder.decode(cookie.getValue());</span><br></pre></td></tr></table></figure>

<ul>
<li>åŒåCookieé—®é¢˜</li>
</ul>
<p>å¦‚æœæœåŠ¡å™¨ç«¯å‘é€é‡å¤çš„Cookieé‚£ä¹ˆä¼šè¦†ç›–åŸæœ‰çš„Cookieã€‚</p>
<ul>
<li>æµè§ˆå™¨å­˜æ”¾Cookieçš„æ•°é‡</li>
</ul>
<p>ä¸åŒçš„æµè§ˆå™¨å¯¹Cookieä¹Ÿæœ‰é™å®šï¼ŒCookieçš„å­˜å‚¨æœ‰æ˜¯ä¸Šé™çš„ã€‚Cookieæ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰çš„ï¼Œè€Œä¸”ä¸€èˆ¬ æ˜¯ç”±æœåŠ¡å™¨ç«¯åˆ›å»ºå’Œè®¾å®šã€‚åæœŸç»“åˆSessionæ¥å®ç°å›è¯è·Ÿè¸ªã€‚Cookieçš„å¤§å°ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸€èˆ¬æ˜¯4kbä»¥ä¸‹ã€‚</p>
<h4 id="cookieçš„è·¯å¾„"><a href="#cookieçš„è·¯å¾„" class="headerlink" title="cookieçš„è·¯å¾„"></a>cookieçš„è·¯å¾„</h4><p>Cookieçš„setPathè®¾ç½®cookieçš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„ç›´æ¥å†³å®šæœåŠ¡å™¨çš„è¯·æ±‚æ˜¯å¦ä¼šä»æµè§ˆå™¨ä¸­åŠ è½½æŸäº›cookieã€‚</p>
<p><strong>æƒ…æ™¯ä¸€ï¼šå½“å‰æœåŠ¡å™¨ä¸‹ä»»ä½•é¡¹ç›®çš„ä»»æ„èµ„æºéƒ½å¯è·å–Cookieå¯¹è±¡</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;XXX&quot;</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®è·¯å¾„ä¸º&quot;/&quot;ï¼Œè¡¨ç¤ºåœ¨å½“å‰æœåŠ¡å™¨ä¸‹ä»»ä½•é¡¹ç›®éƒ½å¯è®¿é—®åˆ°Cookieå¯¹è±¡</span></span><br><span class="line">cookie.setPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<p><strong>æƒ…æ™¯äºŒï¼šå½“å‰é¡¹ç›®ä¸‹çš„èµ„æºå¯è·å–Cookieå¯¹è±¡ ï¼ˆé»˜è®¤ä¸è®¾ç½®Cookieçš„pathï¼‰</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;XXX&quot;</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®è·¯å¾„ä¸º&quot;/s01&quot;ï¼Œè¡¨ç¤ºåœ¨å½“å‰é¡¹ç›®ä¸‹ä»»ä½•é¡¹ç›®éƒ½å¯è®¿é—®åˆ°Cookieå¯¹è±¡</span></span><br><span class="line">cookie.setPath(<span class="string">&quot;/servlet_demo&quot;</span>); <span class="comment">// é»˜è®¤æƒ…å†µï¼Œå¯ä¸è®¾ç½®pathçš„å€¼</span></span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<p><strong>æƒ…æ™¯ä¸‰ï¼šæŒ‡å®šé¡¹ç›®ä¸‹çš„èµ„æºå¯è·å–Cookieå¯¹è±¡</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* å½“å‰é¡¹ç›®è·¯å¾„ä¸ºï¼šservlet_demo */</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;XXX&quot;</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®è·¯å¾„ä¸º&quot;/servlet_1&quot;ï¼Œè¡¨ç¤ºåœ¨s02é¡¹ç›®ä¸‹æ‰å¯è®¿é—®åˆ°Cookieå¯¹è±¡</span></span><br><span class="line">cookie.setPath(<span class="string">&quot;/servlet_1&quot;</span>); <span class="comment">// åªèƒ½åœ¨servlet_1é¡¹ç›®ä¸‹è·å–Cookieï¼Œå°±ç®—cookieæ˜¯servlet_demoäº§ç”Ÿçš„ï¼Œservlet_demoä¹Ÿä¸èƒ½è·å–å®ƒ</span></span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<p><strong>æƒ…æ™¯å››ï¼šæŒ‡å®šé¡¹ç›®çš„æŒ‡å®šç›®å½•ä¸‹çš„èµ„æºå¯è·å–Cookieå¯¹è±¡</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;XXX&quot;</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®è·¯å¾„ä¸º&quot;/servlet_demo/coo1&quot;ï¼Œè¡¨ç¤ºåœ¨servlet_demo/coo1ç›®å½•ä¸‹æ‰å¯è®¿é—®åˆ°Cookieå¯¹è±¡</span></span><br><span class="line">cookie.setPath(<span class="string">&quot;/servlet_demo/cook&quot;</span>); </span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬è®¾ç½®pathï¼Œå¦‚æœå½“å‰è®¿é—®çš„è·¯å¾„åŒ…å«äº†cookieçš„è·¯å¾„ï¼ˆå½“å‰è®¿é—®è·¯å¾„åœ¨cookieè·¯å¾„åŸºç¡€ä¸Šè¦æ¯”cookieçš„èŒƒå›´å°ï¼‰cookieå°±ä¼šåŠ è½½åˆ°requestå¯¹è±¡ä¹‹ä¸­ã€‚</p>
<p>cookieçš„è·¯å¾„æŒ‡çš„æ˜¯å¯ä»¥è®¿é—®è¯¥cookieçš„é¡¶å±‚ç›®å½•ï¼Œè¯¥è·¯å¾„çš„å­è·¯å¾„ä¹Ÿå¯ä»¥è®¿é—®è¯¥cookieã€‚</p>
<p>æ€»ç»“ï¼šå½“è®¿é—®çš„è·¯å¾„åŒ…å«äº†cookieçš„è·¯å¾„æ—¶ï¼Œåˆ™è¯¥è¯·æ±‚å°†å¸¦ä¸Šè¯¥cookieï¼›å¦‚æœè®¿é—®è·¯å¾„ä¸åŒ…å«cookieè·¯å¾„ï¼Œåˆ™è¯¥è¯·æ±‚ä¸ä¼šæºå¸¦è¯¥cookieã€‚</p>
<h3 id="10-HttpSessionå¯¹è±¡"><a href="#10-HttpSessionå¯¹è±¡" class="headerlink" title="10.HttpSessionå¯¹è±¡"></a>10.HttpSessionå¯¹è±¡</h3><p>ä¸Šé¢è®²è§£äº†è¯·æ±‚çš„æ¦‚å¿µï¼Œæ— çŠ¶æ€ï¼Œæ— æ³•åšåˆ°å¤šä¸ªè¯·æ±‚ä¹‹é—´çš„æ•°æ®å…±äº«ã€‚</p>
<p>HttpSessionå¯¹è±¡æ˜¯javax.servlet.http.HttpSessionçš„å®ä¾‹ï¼Œè¯¥æ¥å£å¹¶ä¸åƒHttpServletRequestæˆ–HttpServletResponseè¿˜å­˜åœ¨ä¸€ä¸ªçˆ¶æ¥å£ï¼Œè¯¥æ¥å£åªæ˜¯ä¸€ä¸ªçº¯ç²¹çš„æ¥å£ã€‚è¿™å› ä¸ºSessionæœ¬èº«å°±å±äºHTTPåè®®çš„èŒƒç•´ã€‚</p>
<p>Sessionï¼šåœ¨è®¡ç®—æœºä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œç§°ä¸ºâ€œä¼šè¯æ§åˆ¶â€ã€‚Sessionå¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„Webé¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨Sessionå¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚</p>
<p>å¯¹äºæœåŠ¡å™¨è€Œè¨€ï¼Œæ¯ä¸€ä¸ªè¿æ¥åˆ°å®ƒçš„å®¢æˆ·ç«¯éƒ½æ˜¯ä¸€ä¸ª sessionï¼Œservlet å®¹å™¨ä½¿ç”¨æ­¤æ¥å£åˆ›å»º HTTP å®¢æˆ·ç«¯å’Œ HTTP æœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯ã€‚ä¼šè¯å°†ä¿ç•™æŒ‡å®šçš„æ—¶é—´æ®µï¼Œè·¨å¤šä¸ªè¿æ¥æˆ–æ¥è‡ªç”¨æˆ·çš„é¡µé¢è¯·æ±‚ã€‚<strong>ä¸€ ä¸ªä¼šè¯é€šå¸¸å¯¹åº”äºä¸€ä¸ªç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯èƒ½å¤šæ¬¡è®¿é—®ä¸€ä¸ªç«™ç‚¹</strong>ã€‚å¯ä»¥é€šè¿‡æ­¤æ¥å£æŸ¥çœ‹å’Œæ“ä½œæœ‰å…³æŸä¸ªä¼šè¯ çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¼šè¯æ ‡è¯†ç¬¦ã€åˆ›å»ºæ—¶é—´å’Œæœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ã€‚åœ¨æ•´ä¸ª session ä¸­ï¼Œæœ€é‡è¦çš„å°±æ˜¯å±æ€§çš„æ“ä½œã€‚</p>
<p>sessionæ— è®ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ç«¯éƒ½å¯ä»¥æ„ŸçŸ¥åˆ°ï¼Œè‹¥é‡æ–°æ‰“å¼€ä¸€ä¸ªæ–°çš„æµè§ˆå™¨ï¼Œåˆ™æ— æ³•å–å¾—ä¹‹å‰è®¾ç½®çš„sessionï¼Œå› ä¸ºæ¯ä¸€ä¸ªsessionåªä¿å­˜åœ¨å½“å‰çš„æµè§ˆå™¨å½“ä¸­ï¼Œå¹¶åœ¨ç›¸å…³çš„é¡µé¢å–å¾—ã€‚</p>
<p>sessionçš„ä½œç”¨æ˜¯ä¸ºäº†æ ‡è¯†ä¸€æ¬¡ä¼šè¯ï¼Œæˆ–è€…è¯´ç¡®è®¤ä¸€ä¸ªç”¨æˆ·ï¼›å¹¶ä¸”åœ¨**ä¸€æ¬¡ä¼šè¯ï¼ˆä¸€ä¸ªç”¨æˆ·çš„å¤šæ¬¡è¯·æ±‚ï¼‰**æœŸé—´å…±äº«æ•°æ®ã€‚å¯ä»¥é€šè¿‡request.getSession()æ–¹æ³•ï¼Œæ¥è·å–å½“å‰ä¼šè¯çš„sessionå¯¹è±¡ã€‚å½“è·å–sessionå¯¹è±¡æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­sessionå¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è·å–sessionå¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-26 22:54</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/sess01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Session1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// sessionå¯¹è±¡çš„è·å–,</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        <span class="comment">// è·å–sessionçš„å”¯ä¸€æ ‡è¯†--ä¼šè¯æ ‡è¯†ç¬¦</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> session.getId();</span><br><span class="line">        System.out.println(<span class="string">&quot;å”¯ä¸€æ ‡è¯†ç¬¦å·ï¼š&quot;</span>+id);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ›å»ºæ—¶é—´ï¼š&quot;</span>+session.getCreationTime());</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´(æ—¶é—´æˆ³)ï¼š&quot;</span>+session.getLastAccessedTime());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦æ˜¯æ–°çš„sessionå¯¹è±¡ï¼š&quot;</span>+session.isNew());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="æ ‡è¯†ä¼šè¯-JSESSIONID"><a href="#æ ‡è¯†ä¼šè¯-JSESSIONID" class="headerlink" title="æ ‡è¯†ä¼šè¯ JSESSIONID"></a><strong>æ ‡è¯†ä¼šè¯ JSESSIONID</strong></h4><p>Session æ—¢ç„¶æ˜¯ä¸ºäº†æ ‡è¯†ä¸€æ¬¡ä¼šè¯ï¼Œé‚£ä¹ˆæ­¤æ¬¡ä¼šè¯å°±åº”è¯¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡å¿—ï¼Œè¿™ä¸ªæ ‡å¿—å°±æ˜¯ sessionIdã€‚</p>
<p>æ¯å½“ä¸€æ¬¡è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨å¼€å¯äº†ä¼šè¯ï¼ˆè®¿é—®äº† sessionï¼‰ï¼ŒæœåŠ¡å™¨ç¬¬ä¸€æ­¥ä¼šæŸ¥çœ‹æ˜¯å¦ä»å®¢æˆ·ç«¯å›ä¼ ä¸€ä¸ªåä¸º JSESSION çš„ cookieï¼Œå¦‚æœæ²¡æœ‰åˆ™è®¤ä¸ºè¿™æ˜¯ä¸€æ¬¡æ–°çš„ä¼šè¯ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ session å¯¹è±¡ï¼Œå¹¶ç”¨å”¯ä¸€çš„ sessionId ä¸ºæ­¤æ¬¡ä¼šè¯åšä¸€ä¸ªæ ‡å¿—ï¼Œ<strong>å¹¶ä¸”è¿˜ä¼šä¼ å¯¹åº”çš„cookieåœ¨æµè§ˆå™¨</strong>ã€‚å¦‚æœæœ‰ JESSIONID è¿™ä¸ª cookie å›ä¼ ï¼ŒæœåŠ¡å™¨åˆ™ä¼š æ ¹æ® JSESSIONID è¿™ä¸ªå€¼å»æŸ¥çœ‹æ˜¯å¦å«æœ‰ id ä¸º JSESSION å€¼çš„ session å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰åˆ™è®¤ä¸ºæ˜¯ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ session å¯¹è±¡ï¼Œå¹¶æ ‡å¿—æ­¤æ¬¡ä¼šè¯ï¼Œ<strong>å¹¶ä¼šå‘æµè§ˆå™¨å“åº”ä¸€ä¸ªæ–°çš„cookieï¼Œæµè§ˆå™¨æ›´æ–°è¿™ä¸ªcookie</strong>ï¼›å¦‚æœæ‰¾åˆ°äº†ç›¸åº”çš„ session å¯¹è±¡ï¼Œåˆ™è®¤ä¸ºæ˜¯ä¹‹å‰æ ‡å¿—è¿‡çš„ä¸€æ¬¡ä¼šè¯ï¼Œè¿”å›è¯¥ session å¯¹è±¡ï¼Œæ•°æ®è¾¾åˆ°å…±äº«ã€‚</p>
<blockquote>
<p>æµè§ˆå™¨æ¯ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨ï¼Œéƒ½ä¼šå°†cookieä¼ ç»™åå°ï¼Œåå°å¯ä»¥æ“ä½œcookieå†å“åº”ã€‚</p>
<p>æµè§ˆå™¨é‡Œå¯ä»¥å°†sessionidçš„cookieåˆ æ‰ã€‚</p>
</blockquote>
<p>è¿™é‡Œæåˆ°ä¸€ä¸ªå«åš JSESSION çš„ cookieï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ cookieï¼Œå½“ç”¨æˆ·è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œå¦‚æœè®¿é—®äº† sessionï¼Œåˆ™æœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªåä¸º JSESSIONï¼Œå€¼ä¸ºè·å–åˆ°çš„ sessionï¼ˆæ— è®ºæ˜¯è·å–åˆ°çš„è¿˜æ˜¯ æ–°åˆ›å»ºçš„ï¼‰çš„ sessionId çš„ cookie å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ° response å¯¹è±¡ä¸­ï¼Œå“åº”ç»™å®¢æˆ·ç«¯ï¼Œæœ‰æ•ˆæ—¶é—´ä¸ºå…³é—­æµè§ˆå™¨ã€‚</p>
<p>sessionidä»¥cookieçš„å½¢å¼å­˜å‚¨ï¼› Session çš„åº•å±‚ä¾èµ– Cookie æ¥å®ç°ã€‚ä¸€ä¸ªæœåŠ¡å™¨åº”ç”¨å¯ä»¥å¯¹åº”å¤šä¸ªcookieï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªsessionã€‚</p>
<p>cookieæ˜¯ä¸ºäº†æ–¹ä¾¿å‡å°‘æ•°æ®ä¼ è¾“çš„ï¼Œè®©æœåŠ¡ç«¯è®°ä½å®¢æˆ·ç«¯èº«ä»½çš„ï¼›sessionæ˜¯ä¸ºäº†å¤šæ¬¡è®¿é—®è®°ä½çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ˜¯å½¢æˆä¼šè¯çš„ã€‚</p>
<p>cookieæ˜¯æœ‰è·¯å¾„çš„ï¼Œsessionå°±çœ‹æ˜¯ä¸æ˜¯ä¸€æ¬¡ä¼šè¯äº†ã€‚</p>
<h4 id="sessionåŸŸå¯¹è±¡"><a href="#sessionåŸŸå¯¹è±¡" class="headerlink" title="sessionåŸŸå¯¹è±¡"></a>sessionåŸŸå¯¹è±¡</h4><p>Session ç”¨æ¥è¡¨ç¤ºä¸€æ¬¡ä¼šè¯ï¼Œåœ¨ä¸€æ¬¡ä¼šè¯ä¸­æ•°æ®æ˜¯å¯ä»¥å…±äº«çš„ï¼Œè¿™æ—¶ session ä½œä¸ºåŸŸå¯¹è±¡å­˜åœ¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">setAttribute(String name, Object o); <span class="comment">// è®¾ç½®åŸŸå¯¹è±¡å†…å®¹ </span></span><br><span class="line">getAttribute(String name); <span class="comment">// è·å–åŸŸå¯¹è±¡å†…å®¹ </span></span><br><span class="line">removeAttribute(String name); <span class="comment">//åˆ é™¤åŸŸå¯¹è±¡å†…å®¹</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-27 09:50</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/sess02&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Session2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;uname&quot;</span>, <span class="string">&quot;lili&quot;</span>);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;pwd&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">        session.removeAttribute(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;lili&quot;</span>);</span><br><span class="line">        <span class="comment">// è¯·æ±‚è½¬å‘è·³è½¬åˆ°jspé¡µé¢ï¼Œè¯·æ±‚è½¬å‘ï¼Œä¸€æ¬¡è¯·æ±‚ï¼Œrequestå¯ä»¥æ‹¿åˆ°ï¼Œsessionä¹Ÿå¯ä»¥æ‹¿åˆ°</span></span><br><span class="line">        <span class="comment">//req.getRequestDispatcher(&quot;sess01.jsp&quot;).forward(req, resp);</span></span><br><span class="line">        <span class="comment">// é‡å®šå‘è·³è½¬åˆ°jspé¡µé¢,ä¸¤æ¬¡è¯·æ±‚ï¼Œrequestå¤±æ•ˆï¼Œä½†æ˜¯sessionå¯ä»¥æ‹¿åˆ°</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;sess01.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: mac</span><br><span class="line">  Date: <span class="number">2022</span>/<span class="number">3</span>/<span class="number">27</span></span><br><span class="line">  Time: ä¸Šåˆ<span class="number">10</span>:<span class="number">00</span></span><br><span class="line">  To change <span class="built_in">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;è·å–åŸŸå¯¹è±¡&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="comment">// è·å–sessionåŸŸå¯¹è±¡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">uname</span> <span class="operator">=</span> (String) request.getSession().getAttribute(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> (String) request.getSession().getAttribute(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–requeståŸŸå¯¹è±¡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) request.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;session uname:&quot;</span>+uname);</span><br><span class="line">    System.out.println(<span class="string">&quot;session pwd:&quot;</span>+ pwd);</span><br><span class="line">    System.out.println(<span class="string">&quot;request name:&quot;</span>+ name);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>æ•°æ®å­˜å‚¨åœ¨ session åŸŸå¯¹è±¡ä¸­ï¼Œå½“ session å¯¹è±¡ä¸å­˜åœ¨äº†ï¼Œæ•°æ®ä¹Ÿå°±ä¸èƒ½å…±äº«äº†ã€‚ä¸åŒçš„æœåŠ¡å™¨åº”ç”¨ä¹‹é—´ï¼Œsessionå¯¹è±¡ä¹Ÿæ˜¯éš”ç¦»çš„ï¼Œä¸¤ä¸ªä¸åŒçš„sessionå¯¹è±¡é—´æ•°æ®ä¸èƒ½å…±äº«ã€‚</p>
<h4 id="sessionçš„é”€æ¯"><a href="#sessionçš„é”€æ¯" class="headerlink" title="sessionçš„é”€æ¯"></a><strong>sessionçš„é”€æ¯</strong></h4><p>1.é»˜è®¤åˆ°æœŸæ—¶é—´</p>
<p>å½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚servletå¹¶ä¸”æ“ä½œsessionæ—¶ï¼Œsessionå¯¹è±¡ç”Ÿæˆï¼ŒTomcatä¸­sessioné»˜è®¤çš„å­˜æ´»æ—¶é—´ä¸º30minï¼Œå³ä½ ä¸æ“ä½œç•Œé¢çš„æ—¶é—´ï¼Œä¸€æ—¦æœ‰æ“ä½œï¼Œsessionä¼šé‡æ–°è®¡æ—¶ã€‚</p>
<p>sessionçš„é»˜è®¤æ—¶é—´å¯ä»¥åœ¨tomcatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹çš„web.xmlæ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ã€‚å•ä½ä¸ºåˆ†ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>30<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.è®¾ç½®åˆ°æœŸæ—¶é—´</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡session.setMaxInactionInterval()å¯ä»¥è‡ªè¡Œè®¾å®šå­˜æ´»æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">session.setMaxInactiveInterval(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//10ç§’åé”€æ¯session</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸ¥çœ‹sessionæœ€å¤§ä¸æ´»åŠ¨æ—¶é—´ï¼Œå³å­˜æ´»æ—¶é—´</span></span><br><span class="line">System.out.println(session.getMaxInactiveInterval());</span><br></pre></td></tr></table></figure>

<p>3.ç«‹å³é”€æ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">session.invalidate();</span><br><span class="line"><span class="comment">//sessionç«‹å³ä½œåºŸ</span></span><br></pre></td></tr></table></figure>

<p>æµè§ˆå™¨æ¯æ¬¡è®¿é—®éƒ½æ˜¯ä¸€ä¸ªæ–°çš„ã€‚</p>
<p>4.å…³é—­æµè§ˆå™¨</p>
<p>sessionåº•å±‚ä»¥æ¥cookieï¼Œcookieå¯¹è±¡é»˜è®¤åªåœ¨æµè§ˆå™¨å†…å­˜ä¸­å­˜æ´»ï¼Œå…³é—­æµè§ˆå™¨å³å¤±æ•ˆã€‚</p>
<p>è¿™ä¸ªé»˜è®¤çš„ä¼˜å…ˆçº§é«˜ï¼Œå¦‚æœä¸å…³æµè§ˆå™¨30åˆ†é’Ÿå¤±æ•ˆï¼Œå…³äº†æµè§ˆå™¨ç«‹é©¬å¤±æ•ˆã€‚</p>
<p>5.å…³é—­æœåŠ¡å™¨</p>
<p>éæ­£å¸¸å…³é—­æœåŠ¡å™¨æ—¶æ‰ä¼šå¤±æ•ˆã€‚  	</p>
<p>å¦‚æœæ˜¯æ­£å¸¸å…³é—­æœåŠ¡å™¨ï¼Œsessionä¼šè¢«é’åŒ–åˆ°æœ¬åœ°ç£ç›˜ï¼Œä¸‹æ¬¡è®¿é—®æ—¶ä¼šä»æœ¬åœ°ç£ç›˜ä¸­æ´»åŒ–å‡ºæ¥ã€‚åœ¨ å·¥ä½œç©ºé—´ work ç›®å½•ä¸‹çš„ SESSION.ser æ–‡ä»¶ä¸­ã€‚ </p>
<p>Session å¤±æ•ˆåˆ™æ„å‘³ç€æ­¤æ¬¡ä¼šè¯ç»“æŸï¼Œæ•°æ®å…±äº«ç»“æŸã€‚</p>
<h3 id="11-ServletContextå¯¹è±¡"><a href="#11-ServletContextå¯¹è±¡" class="headerlink" title="11.ServletContextå¯¹è±¡"></a>11.ServletContextå¯¹è±¡</h3><h4 id="ServletContextå¯¹è±¡çš„è·å–"><a href="#ServletContextå¯¹è±¡çš„è·å–" class="headerlink" title="ServletContextå¯¹è±¡çš„è·å–"></a>ServletContextå¯¹è±¡çš„è·å–</h4><p>æ¯ä¸€ä¸ªwebåº”ç”¨éƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªServletContextå¯¹è±¡ï¼Œåˆç§°ä¸ºApplicationå¯¹è±¡ï¼Œä»åç§°ä¸­å¯çŸ¥ï¼Œè¯¥å¯¹è±¡æ˜¯ä¸åº”ç”¨ç¨‹åºç›¸å…³çš„ã€‚åœ¨webå®¹å™¨å¯åŠ¨æ—¶ï¼Œä¼šä¸ºæ¯ä¸€ä¸ªwebåº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ServletContextå¯¹è±¡ã€‚</p>
<p>è¯¥å¯¹è±¡æœ‰ä¸¤å¤§ä½œç”¨ï¼Œç¬¬ä¸€ã€ä½œä¸ºåŸŸå¯¹è±¡æ¥å…±äº«æ•°æ®ï¼Œæ­¤æ—¶æ•°æ®åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«ï¼›ç¬¬äºŒã€è¯¥å¯¹è±¡ä¸­ä¿å­˜äº†å½“å‰åº”ç”¨ç¨‹åºç›¸å…³ä¿¡æ¯ã€‚ä¾‹å¦‚å¯ä»¥é€šè¿‡getServerInfo()æ–¹æ³•è·å–å½“å‰æœåŠ¡å™¨ä¿¡æ¯ï¼ŒgetRealPath(String path)è·å–èµ„æºçš„çœŸå®è·¯å¾„ç­‰ã€‚</p>
<p>ServletContextå¯¹è±¡è·å–ï¼š</p>
<p>â‘ .é€šè¿‡requestå¯¹è±¡è·å–</p>
<p>ServletContext servletContext &#x3D; req.getServletContext();<br>(ä¸èƒ½ç”¨äº†ï¼Ÿ)</p>
<p>â‘¡.é€šè¿‡sessionå¯¹è±¡è·å–</p>
<p>ServletContext servletContext &#x3D; request.getSession().getServletContext();</p>
<p>â‘¢.é€šè¿‡servletConfigå¯¹è±¡è·å–ï¼Œåœ¨Servletæ ‡å‡†ä¸­æä¾›äº†ServletConfigæ–¹æ³•</p>
<p>ServletContext servletContext &#x3D; getServletConfig().getServletContext();</p>
<p>â‘£.ç›´æ¥è·å– Servletç±»ä¸­æä¾›äº†ç›´æ¥è·å–ServletContextå¯¹è±¡çš„æ–¹æ³•</p>
<p>ServletContext servletContext &#x3D; getServletContext();</p>
<p>å¸¸ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> getServletContext();</span><br><span class="line"><span class="comment">//å¸¸ç”¨æ–¹æ³•</span></span><br><span class="line"><span class="comment">//è·å–å½“å‰æœåŠ¡å™¨çš„ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//Apache Tomcat/9.0.59</span></span><br><span class="line"><span class="type">String</span> <span class="variable">ServletInfo</span> <span class="operator">=</span> servletContext.getServerInfo();</span><br><span class="line">System.out.println(<span class="string">&quot;æœåŠ¡å™¨å½“å‰çš„ç‰ˆæœ¬ä¿¡æ¯ï¼š&quot;</span> + ServletInfo);</span><br><span class="line"><span class="comment">//è·å–é¡¹ç›®çš„çœŸå®è·¯å¾„</span></span><br><span class="line"><span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> servletContext.getRealPath(<span class="string">&quot;/&quot;</span>);     <span class="comment">//è¡¨ç¤ºè·å–æ ¹è·¯å¾„,é¡¹ç›®çš„è€Œä¸æ˜¯åº”ç”¨çš„</span></span><br><span class="line"><span class="comment">///Users/liuxuan/MyProject/JavaProject/java/web/target/web/</span></span><br><span class="line">System.out.println(<span class="string">&quot;è·å–é¡¹ç›®çš„çœŸå®è·¯å¾„ï¼š&quot;</span> + realPath);</span><br></pre></td></tr></table></figure>



<h4 id="ServletContextåŸŸå¯¹è±¡"><a href="#ServletContextåŸŸå¯¹è±¡" class="headerlink" title="ServletContextåŸŸå¯¹è±¡"></a>ServletContextåŸŸå¯¹è±¡</h4><p>ServletContextä¹Ÿå¯ä»¥å½“åšåŸŸå¯¹è±¡æ¥ä½¿ç”¨ï¼Œé€šè¿‡ServletContextä¸­å­˜å–æ•°æ®ï¼Œå¯ä»¥ä½¿å¾—æ•´ä¸ªåº”ç”¨ç¨‹åºå…±äº«æŸäº›æ•°æ®ã€‚å½“ç„¶ä¸å»ºè®®å­˜æ”¾è¿‡å¤šæ•°æ®ï¼Œå› ä¸ºServletContextä¸­çš„æ•°æ®ä¸€æ—¦å­˜å‚¨è¿›å»æ²¡æœ‰æ‰‹åŠ¨ç§»é™¤çš„è¯ï¼Œå°†ä¼šä¸€ç›´ä¿å­˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-29 09:19</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/con02&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Context2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> &#123;</span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> getServletContext();</span><br><span class="line">        <span class="comment">// è®¾ç½®åŸŸå¯¹è±¡</span></span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–åŸŸå¯¹è±¡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) servletContext.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        <span class="comment">// ç§»é™¤åŸŸå¯¹è±¡</span></span><br><span class="line">        servletContext.removeAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Servletä¸‰å¤§ä½œç”¨åŸŸ</strong>ï¼š</p>
<p>1.requeståŸŸå¯¹è±¡<br>åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æœ‰æ•ˆã€‚è¯·æ±‚è½¬å‘æœ‰æ•ˆ,é‡å®šå‘å¤±è´¥ã€‚</p>
<p>2.sessionåŸŸå¯¹è±¡<br>åœ¨ä¸€æ¬¡ä¼šè¯ä¸­æœ‰æ•ˆã€‚è¯·æ±‚è½¬å‘å’Œé‡å®šå‘éƒ½æœ‰æ•ˆï¼Œsessioné”€æ¯åå¤±æ•ˆã€‚</p>
<p>3.servletContextåŸŸå¯¹è±¡<br>åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆã€‚æœåŠ¡å™¨å…³é—­é”€æ¯ã€‚</p>
<h3 id="12-æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"><a href="#12-æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½" class="headerlink" title="12.æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"></a>12.æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½</h3><p>servletä¸­å¦‚ä½•å®ç°æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ã€‚</p>
<h4 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h4><p>æ–‡ä»¶ä¸Šä¼ æ¶‰åŠåˆ°å‰å°é¡µé¢çš„ç¼–å†™å’Œåå°æœåŠ¡å™¨ç«¯ä»£ç çš„ç¼–å†™ï¼Œå‰å°å‘é€æ–‡ä»¶ï¼Œåå°æ¥æ”¶å¹¶ä¿å­˜æ–‡ä»¶ï¼Œè¿™æ‰æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ ã€‚</p>
<h5 id="å‰å°é¡µé¢"><a href="#å‰å°é¡µé¢" class="headerlink" title="å‰å°é¡µé¢"></a>å‰å°é¡µé¢</h5><p>åœ¨åšæ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„ç•Œé¢ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¡¨å•ï¼Œå¹¶ä¸”è¡¨å•çš„è¯·æ±‚æ–¹å¼ä¸º POSTï¼›å…¶æ¬¡æˆ‘ä»¬çš„ form è¡¨å•çš„ enctype å¿…é¡»è®¾ä¸ºâ€multipart&#x2F;form-dataâ€å³ enctype&#x3D;â€œmultipart&#x2F;form-dataâ€ æ„æ€æ˜¯è®¾ç½®è¡¨å•çš„ MIME ç¼–ç ã€‚é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªç¼–ç æ ¼å¼æ˜¯ â€application&#x2F;x-www-form-urlencodedâ€ï¼Œä¸èƒ½ç”¨äºæ–‡ä»¶ä¸Šä¼ ï¼›åªæœ‰ä½¿ç”¨äº† multipart&#x2F;form-data æ‰èƒ½å®Œæ•´åœ°ä¼ é€’æ–‡ä»¶æ•°æ®ã€‚</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: mac</span><br><span class="line">  Date: <span class="number">2022</span>/<span class="number">3</span>/<span class="number">29</span></span><br><span class="line">  Time: ä¸‹åˆ<span class="number">9</span>:<span class="number">41</span></span><br><span class="line">  To change <span class="built_in">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;æ–‡ä»¶ä¸Šä¼ &lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">        <span class="number">1.</span>å‡†å¤‡è¡¨å•</span><br><span class="line">        <span class="number">2.</span>è®¾ç½®è¡¨å•çš„æäº¤ç±»å‹ method=<span class="string">&quot;post&quot;</span></span><br><span class="line">        <span class="number">3.</span>è®¾ç½®è¡¨å•ç±»å‹ä¸ºæ–‡ä»¶ä¸Šä¼ è¡¨å• enctype=<span class="string">&quot;multipart/form-data&quot;</span></span><br><span class="line">        <span class="number">4.</span>è®¾ç½®æ–‡ä»¶æäº¤çš„åœ°å€ action=<span class="string">&quot;uploadServlet&quot;</span></span><br><span class="line">        <span class="number">5.</span>å‡†å¤‡è¡¨å•å…ƒç´  <span class="number">1.</span>æ™®é€šè¡¨å•é¡¹ type=<span class="string">&quot;text&quot;</span> <span class="number">2.</span>æ–‡ä»¶é¡¹ type=<span class="string">&quot;file&quot;</span></span><br><span class="line">        <span class="number">6.</span>è®¾ç½®è¡¨å•å…ƒç´ çš„nameå±æ€§å€¼ï¼Œå¦åˆ™åå°æ— æ³•æ¥æ”¶æ•°æ®</span><br><span class="line">        --&gt;</span><br><span class="line">    &lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;uploadServlet&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">        å§“åï¼š&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;uname&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">        æ–‡ä»¶ï¼š&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;myfile&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">        &lt;!-- button é»˜è®¤çš„ type å±æ€§æ˜¯ submitï¼Œåšæäº¤æŒ‰é’®å¯ä»¥ä¸è®¾ç½® type --&gt;</span><br><span class="line">        &lt;button type=<span class="string">&quot;submit&quot;</span>&gt; æäº¤ &lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h5 id="åå°å®ç°"><a href="#åå°å®ç°" class="headerlink" title="åå°å®ç°"></a>åå°å®ç°</h5><p>ä½¿ç”¨æ³¨è§£ <code>@MultipartConfig</code>æ ‡è¯†ä¸ºæ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼Œ Servlet å°† <code>Multipart/form-data</code> çš„postè¯·æ±‚å°è£…æˆ Part é€šè¿‡partå¯¹ä¸Šä¼ æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.file;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.MultipartConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Part;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-29 21:51</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@MultipartConfig</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/uploadServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ ......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸ºä¿è¯æ•°æ®æ­£ç¡®æ€§ï¼Œé¦–å…ˆè®¾ç½®ç¼–ç </span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ™®é€šè¡¨å•é¡¹å‚æ•°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uname</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;uname&quot;</span>); <span class="comment">// è¡¨å•å…ƒç´ ä¸­ uname çš„å€¼</span></span><br><span class="line">        System.out.println(<span class="string">&quot;unameï¼š&quot;</span> + uname);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å– Part å¯¹è±¡ï¼Œä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line">        <span class="type">Part</span> <span class="variable">part</span> <span class="operator">=</span> req.getPart(<span class="string">&quot;myfile&quot;</span>); <span class="comment">// è¡¨å•ä¸­ file æ–‡ä»¶åŸŸçš„ name å±æ€§å€¼</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡ part å¯¹è±¡å¾—åˆ°ä¸Šä¼ çš„æ–‡ä»¶å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> part.getSubmittedFileName();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸Šä¼ çš„æ–‡ä»¶åï¼š&quot;</span> + fileName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾—åˆ°æ–‡ä»¶è¦å­˜æ”¾çš„è·¯å¾„--é¡¹ç›®è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> req.getServletContext().getRealPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        System.out.println(filePath); <span class="comment">// æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„</span></span><br><span class="line">        <span class="comment">// /Users/liuxuan/MyProject/JavaProject/servletdemo/servlet-demo/out/artifacts/servlet_demo_war_exploded/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿å­˜æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„</span></span><br><span class="line">        part.write(filePath + <span class="string">&quot;/&quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å‰ç«¯é¡µé¢â€¦&#x2F;upload.jspé€‰æ‹©æ–‡ä»¶æäº¤åï¼Œè‡ªåŠ¨è·³è½¬è‡³â€¦&#x2F;uploadServleté¡µé¢ã€‚</p>
<p>âš ï¸ä¸€ä¸ªé£˜çº¢é—®é¢˜</p>
<p>Servlet3.0æ–°å¢äº†request.getParts()&#x2F;getPart(String filename) apiï¼Œç”¨äºè·å–ä½¿ç”¨multipart&#x2F;form-dataæ ¼å¼ä¼ é€’çš„httpè¯·æ±‚çš„è¯·æ±‚ä½“ï¼Œé€šå¸¸ç”¨äºè·å–ä¸Šä¼ æ–‡ä»¶ã€‚ç”¨äºä»è¯·æ±‚ä¸­è§£æä¸Šä¼ çš„æ–‡ä»¶ã€‚</p>
<p>request.getParts()  è·å–è¯·æ±‚ä¸­å…¨éƒ¨æ–‡ä»¶<br>getPart(String filename)   è·å–è¯·æ±‚ä¸­æŒ‡å®šnameçš„æ–‡ä»¶</p>
<p>æ‰€ä»¥getPartæ–¹æ³•é£˜çº¢çš„è¯ï¼Œçœ‹ä¸€ä¸‹ç”¨çš„servletæ–¹æ³•ç‰ˆæœ¬æ˜¯ä¸æ˜¯3.0çš„ã€‚</p>
<p><code>InputStream is = part.getInputStream();</code> è·å–è¾“å…¥æµ</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨request.getParts()æ–¹æ³•å¿…é¡»ç»™servletæ·»åŠ æ³¨è§£@MultipartConfigï¼Œå¦åˆ™è™½ç„¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯è·å–ä¸åˆ°æ•°æ®ã€‚</p>
<p>æ›´å¤šç”¨æ³•æ’’ï¼š<br><a href="https://blog.csdn.net/u012334071/article/details/50261063/">https://blog.csdn.net/u012334071/article/details/50261063/</a></p>
<p><a href="https://wenku.baidu.com/view/c66d20190a12a21614791711cc7931b765ce7b61.html">https://wenku.baidu.com/view/c66d20190a12a21614791711cc7931b765ce7b61.html</a></p>
<p><a href="https://www.cnblogs.com/sunyongxing/articles/2622891.html">https://www.cnblogs.com/sunyongxing/articles/2622891.html</a></p>
<h4 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸‹è½½"></a>æ–‡ä»¶ä¸‹è½½</h4><p>å³å°†æœåŠ¡å™¨ä¸Šçš„èµ„æºä¸‹è½½ï¼ˆæ‹·è´ï¼‰åˆ°æœ¬åœ°ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä¸‹è½½ï¼šé€šè¿‡è¶…é“¾æ¥ä¸‹è½½ã€é€šè¿‡ä»£ç ä¸‹è½½ã€‚</p>
<p>é¡¹ç›®å†…çš„æ–‡æœ¬æˆ–å›¾ç‰‡èµ„æºæ–‡ä»¶å¤¹éœ€è¦é€šè¿‡ Tomcat -&gt; Deployment è¿›è¡Œä¸Šä¼ æ‰èƒ½é€šè¿‡é¡¹ç›®å‘å¸ƒï¼Œè¿›è¡Œè®¿é—®ã€‚</p>
<h5 id="è¶…é“¾æ¥ä¸‹è½½"><a href="#è¶…é“¾æ¥ä¸‹è½½" class="headerlink" title="è¶…é“¾æ¥ä¸‹è½½"></a>è¶…é“¾æ¥ä¸‹è½½</h5><p>å½“æˆ‘ä»¬åœ¨HTMLæˆ–JSPé¡µé¢ä¸­ä½¿ç”¨aæ ‡ç­¾æ—¶ï¼ŒåŸæ„æ˜¯å¸Œæœ›èƒ½å¤Ÿè¿›è¡Œè·³è½¬ï¼Œä½†å½“è¶…é“¾æ¥é‡åˆ°æµè§ˆå™¨ä¸è¯†åˆ«çš„èµ„æºæ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ï¼›å½“é‡åˆ°æµè§ˆå™¨èƒ½å¤Ÿç›´æ¥æ˜¾ç¤ºçš„èµ„æºï¼Œæµè§ˆå™¨å°±ä¼šé»˜è®¤æ˜¾ç¤ºå‡ºæ¥ï¼Œæ¯”å¦‚txtã€pngã€jpgç­‰ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡downloadå±æ€§è§„å®šæµè§ˆå™¨è¿›è¡Œä¸‹è½½ã€‚ä½†æœ‰äº›æµè§ˆå™¨å¹¶ä¸æ”¯æŒã€‚</p>
<p>åœ¨webæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªdownloadæ–‡ä»¶å¤¹ï¼Œå‡†å¤‡å›¾ç‰‡ã€æ–‡æœ¬æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œæ–‡ä»¶å­˜æ”¾åœ°å€éœ€è¦é…ç½®ä¸€ä¸‹ï¼Œç‚¹å³ä¸Šè§’configurationï¼Œå†ç‚¹deploymentï¼Œå†ç‚¹åŠ å·external sourceï¼Œé€‰åˆ°downloadæ–‡ä»¶å¤¹ä¸‹ï¼Œå†æ”¹ä¸€ä¸‹application contextï¼š&#x2F;servlet_demo&#x2F;downloadã€‚è¿™æ ·æ–‡ä»¶å¤¹ä¸‹çš„èµ„æºæ‰èƒ½è¢«æµè§ˆå™¨è®¿é—®åˆ°ã€‚ï¼ˆè¿™ä¸ªdownloadæ˜¯æ–‡ä»¶å¤¹åå­—ï¼‰</p>
<p>è®¿é—®ï¼š<a href="http://localhost:8080/servlet_demo/download.html">http://localhost:8080/servlet_demo/download.html</a> ï¼ˆè¿™ä¸ªdownloadæ˜¯htmlåå­—ï¼‰</p>
<p>download.htmlï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>æ–‡ä»¶ä¸‹è½½<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æµè§ˆå™¨èƒ½å¤Ÿè¯†åˆ«çš„èµ„æºï¼Œç‚¹å‡»å±•ç¤º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;download/TacoCloud.jpeg&quot;</span>&gt;</span>å›¾ç‰‡æ–‡ä»¶<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;download/Taco.java&quot;</span>&gt;</span>æ–‡æœ¬æ–‡ä»¶<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åŠ downloadç‚¹å‡»ä¸‹è½½,å¯ä¸å†™å±æ€§åï¼Œè¡¨ç¤ºæ–‡ä»¶å --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;download/TacoCloud.jpeg&quot;</span> <span class="attr">download</span>=<span class="string">&quot;ç™¾åº¦.jpeg&quot;</span>&gt;</span>å›¾ç‰‡æ–‡ä»¶<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;download/Taco.java&quot;</span> <span class="attr">download</span>=<span class="string">&quot;&quot;</span>&gt;</span>æ–‡æœ¬æ–‡ä»¶<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æµè§ˆå™¨ä¸èƒ½å¤Ÿè¯†åˆ«çš„èµ„æº,è‡ªåŠ¨ä¸‹è½½ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>å‹ç¼©æ–‡ä»¶<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="åå°å®ç°ä¸‹è½½"><a href="#åå°å®ç°ä¸‹è½½" class="headerlink" title="åå°å®ç°ä¸‹è½½"></a>åå°å®ç°ä¸‹è½½</h5><p>å®ç°æ­¥éª¤ï¼š</p>
<p>å¾—çŸ¥é“è¦ä¸‹è½½çš„èµ„æºæ–‡ä»¶åï¼Œæ–‡ä»¶åä¼ åˆ°åå°ä»£ç ä¹‹åï¼š</p>
<ol>
<li>éœ€è¦é€šè¿‡response.setContentTypeæ–¹æ³•è®¾ç½®Content-typeå¤´å­—æ®µçš„å€¼ï¼Œä¸ºæµè§ˆå™¨æ— æ³•ä½¿ç”¨æŸç§æ–¹å¼æˆ–æ¿€æ´»æŸä¸ªç¨‹åºæ¥å¤„ç†çš„MIMEç±»å‹ï¼Œä¾‹å¦‚â€œapplication&#x2F;octet-streamâ€æˆ–â€œapplication&#x2F;x-msdownloadâ€˜ç­‰ã€‚</li>
<li>éœ€è¦é€šè¿‡response.setHeaderæ–¹æ³•è®¾ç½®Content-Dispositionå¤´çš„å€¼ä¸ºâ€œattachment;filename&#x3D;æ–‡ä»¶åâ€œ</li>
<li>è¯»å–ä¸‹è½½æ–‡ä»¶ï¼Œè°ƒç”¨response.getOutputStreamæ–¹æ³•å‘å®¢æˆ·ç«¯å†™å…¥é™„ä»¶å†…å®¹ã€‚</li>
</ol>
<p>ç¬¬ä¸€æ­¥ï¼šå†™htmlé¡µé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;æ–‡ä»¶ä¸‹è½½&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;downloadServlet&quot;</span>&gt;</span><br><span class="line">        æ–‡ä»¶åï¼š&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;fileName&quot;</span> placeholder=<span class="string">&quot;è¯·è¾“å…¥è¦ä¸‹è½½çš„æ–‡ä»¶å&quot;</span>&gt;</span><br><span class="line">        &lt;button&gt;ä¸‹è½½&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šå†™ä¸€ä¸ªservleté¡µé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.servlet.file;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-31 21:59</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/downloadServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DownloadServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//é‡å†™é’¥åŒ™çš„</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ä¸‹è½½===&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®è¯·æ±‚çš„ç¼–ç æ ¼å¼</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// ä¹±ç é—®é¢˜ï¼Œè®¾ç½®ç¼–ç æ ¼å¼</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–å‚æ•°ï¼ˆå¾—åˆ°è¦ä¸‹è½½çš„æ–‡ä»¶åï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;fileName&quot;</span>);</span><br><span class="line">        <span class="comment">// å‚æ•°çš„éç©ºåˆ¤æ–­  trim()å»é™¤å­—ç¬¦ä¸²å‰åç©ºæ ¼ï¼Œä¸­é—´çš„ä¸ç®¡</span></span><br><span class="line">        <span class="keyword">if</span>(fileName == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(fileName.trim()))&#123;</span><br><span class="line">            resp.getWriter().write(<span class="string">&quot;è¯·è¾“å…¥è¦ä¸‹è½½çš„æ–‡ä»¶åï¼&quot;</span>);</span><br><span class="line">            resp.getWriter().close();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¾—åˆ°å›¾ç‰‡å­˜æ”¾çš„è·¯å¾„,æ–‡ä»¶æ”¾åœ¨é…ç½®å¥½çš„downloadç›®å½•ä¸‹çš„ã€‚</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> req.getServletContext().getRealPath(<span class="string">&quot;/download/&quot;</span>);</span><br><span class="line">        <span class="comment">// é€šè¿‡è·¯å¾„å¾—åˆ°fileå¯¹è±¡</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path + fileName);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶ï¼š&quot;</span>+ file);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ–‡ä»¶å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸ªæ ‡å‡†æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(file.exists() &amp;&amp; file.isFile())&#123;</span><br><span class="line">            <span class="comment">// 1.è®¾ç½®å“åº”ç±»å‹ï¼Œè®¾ç½®ä¸ºæµè§ˆå™¨æ— æ³•ä½¿ç”¨æŸç§æ–¹å¼æˆ–æ¿€æ´»æŸä¸ªç¨‹åºæ¥å¤„ç†çš„MIMEç±»å‹</span></span><br><span class="line">            resp.setContentType(<span class="string">&quot;application/x-msdownload&quot;</span>);</span><br><span class="line">            <span class="comment">// 2.è®¾ç½®å“åº”å¤´</span></span><br><span class="line">            resp.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + fileName);</span><br><span class="line">            <span class="comment">// 3.å¾—åˆ°fileæ–‡ä»¶çš„è¾“å…¥æµ</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">            <span class="comment">// 4.å¾—åˆ°å­—èŠ‚è¾“å‡ºæµï¼Œå­—ç¬¦è¾“å‡ºæµæ–‡ä»¶æ˜¯ä¸è¡Œçš„</span></span><br><span class="line">            <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> resp.getOutputStream();</span><br><span class="line">            <span class="comment">// 5.å®šä¹‰byteæ•°ç»„</span></span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="comment">// 6.å®šä¹‰é•¿åº¦</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// 7.å¾ªç¯è¾“å‡º</span></span><br><span class="line">            <span class="keyword">while</span> ((len = in.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                out.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 8.å…³é—­èµ„æº</span></span><br><span class="line">            out.close();</span><br><span class="line">            in.close();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resp.getWriter().write(<span class="string">&quot;æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·é‡è¯•ï¼&quot;</span>);</span><br><span class="line">            resp.getWriter().close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="githubåœ°å€"><a href="#githubåœ°å€" class="headerlink" title="githubåœ°å€"></a>githubåœ°å€</h3><p><a href="https://github.com/jadeliuliu/servletdemo/tree/master/servlet-demo">https://github.com/jadeliuliu/servletdemo/tree/master/servlet-demo</a></p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p>æ¯”è¾ƒå…¨çš„æ–‡ç« ï¼š<a href="https://blog.csdn.net/qq_19782019/article/details/80292110">https://blog.csdn.net/qq_19782019/article/details/80292110</a></p>
<p>å®ç°ï¼š<a href="https://blog.csdn.net/Hello_zbs/article/details/108394660">https://blog.csdn.net/Hello_zbs/article/details/108394660</a></p>
<p>bç«™è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1Ta4y1H7Vc?p=26&spm_id_from=pageDriver">https://www.bilibili.com/video/BV1Ta4y1H7Vc?p=26&amp;spm_id_from=pageDriver</a></p>
<p>å­¦ä¹ ç¬”è®°ï¼š<a href="https://www.cnblogs.com/yuan-liu/p/15255326.html">https://www.cnblogs.com/yuan-liu/p/15255326.html</a></p>
<h3 id="servletçš„getå’Œpostè¯·æ±‚"><a href="#servletçš„getå’Œpostè¯·æ±‚" class="headerlink" title="servletçš„getå’Œpostè¯·æ±‚"></a>servletçš„getå’Œpostè¯·æ±‚</h3><p>getï¼šå°†æ•°æ®é€šè¿‡urlé™„åŠ æ•°æ®ç°è¡Œçš„å‘æœåŠ¡å™¨å‘é€æ•°æ®<br>postï¼šå°†æ•°æ®å­˜æ”¾åœ¨è¯·æ±‚ä½“ä¸­éšæ€§çš„å‘æœåŠ¡å™¨å‘é€æ•°æ®</p>
<p>åŒºåˆ«ï¼š<br>1.getå¸¸ç”¨äºä¸åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æŸ¥è¯¢åŠŸèƒ½ ï¼ˆä¸ç”¨è¾“å…¥å¯†ç ï¼‰<br>2.postç”¨äºå®‰å…¨æ€§è¾ƒé«˜çš„åŠŸèƒ½æˆ–è€…æœåŠ¡å™¨çš„â€œå†™â€æ“ä½œ egï¼šç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€æ›´æ–°è´¦ç›®</p>
<p>service()æ˜¯è¯·æ±‚å¤„ç†çš„æ ¸å¿ƒæ–¹æ³•ï¼Œæ— è®ºæ˜¯getæˆ–è€…æ˜¯postéƒ½ä¼šè¢«service()æ–¹æ³•å¤„ç†ã€‚<br>å½“é‡‡ç”¨æ— å·®åˆ«è¯·æ±‚æ—¶ï¼Œå¯ä»¥ç”¨service()æ–¹æ³•ã€‚<br>request.getMethod()æŸ¥çœ‹è¯·æ±‚æ–¹å¼<br>doGet()æ–¹æ³•å¤„ç†getè¯·æ±‚<br>doPost()æ–¹æ³•å¤„ç†postè¯·æ±‚<br>response.setContentType(â€œtext&#x2F;html;charset&#x3D;UTF-8â€);è§£å†³ä¸­æ–‡ä¹±ç </p>
<p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6869979139164602382">https://juejin.cn/post/6869979139164602382</a></p>
<h3 id="WebServletå’Œ-RequestMapping"><a href="#WebServletå’Œ-RequestMapping" class="headerlink" title="@WebServletå’Œ@RequestMapping"></a>@WebServletå’Œ@RequestMapping</h3><p>éƒ½æ˜¯ç”¨åœ¨Controllerç±»é‡Œï¼Œç”¨äºæ‹¦æˆªç‰¹å®šè¯·æ±‚çš„ã€‚</p>
<p>@WebServletæ³¨è§£ä½œç”¨åœ¨ç±»ä¸Šï¼Œç”¨äºæ ‡æ³¨åœ¨ä¸€ä¸ªç»§æ‰¿äº†HttpServletç±»ä¹‹ä¸Šï¼Œå±äºç±»çº§åˆ«çš„æ³¨è§£ï¼Œä¸€èˆ¬ç”¨äºéœ€è¦æœ‰HttpServletRequestè¯·æ±‚ä¸­å¸¦äº†å‚æ•°ï¼Œæˆ–è€…éœ€è¦filterç­‰åœºæ™¯ï¼Œè¿™ä¸ªæ˜¯Servletå®ç°çš„è·¯å¾„æ˜ å°„é€»è¾‘ã€‚</p>
<p>@RequestMapping åœ¨controllerç±»ä¸ŠåŠ ï¼Œå…·ä½“çš„æ–¹æ³•ä¸Šå†åŠ ï¼Œ å¯ä»¥åœ¨æ§åˆ¶å™¨ç±»çš„çº§åˆ«å’Œ&#x2F;æˆ–å…¶ä¸­çš„æ–¹æ³•çš„çº§åˆ«ä¸Šä½¿ç”¨ å¤„ç†æ™®é€šçš„URIè¯·æ±‚ï¼Œæˆ–è€…httpè¯·æ±‚ï¼Œè¿™ä¸ªæ˜¯springå®ç°çš„DispatcherServletçš„è·¯å¾„æ˜ å°„é€»è¾‘ã€‚</p>
<p>âœ… ä¸¤ç§æ„é€ Controllerçš„åŒºåˆ«ï¼š</p>
<p>Controlleræ˜¯spring çš„ä¸€ä¸ªbeanï¼Œç”±springçš„IOCæ¥ç®¡ç†çš„ä¸€ä¸ªbean</p>
<p>Servletæ˜¯ä¸€ä¸ªæ¥å£æˆ–è€…æ¥å£çš„å®ç°ï¼ˆå¸¸è§çš„æ˜¯GenericServlet å’Œ HttpServletï¼‰</p>
<p>Servletå®ç°æ–¹å¼ï¼š<br>æœ‰ä¸€ä¸ªæ˜ å°„å…³ç³»servlet-mappingï¼Œurlçš„endpoint å¯¹åº”çš„å…·ä½“çš„servletï¼Œ æ¯”å¦‚è§„å®šâ€™&#x2F;demoâ€™ æ˜ å°„åˆ°ServletDemoï¼ˆç»§æ‰¿è‡ªHttpServletï¼Œé‡å†™doGetï¼ŒdoPostç­‰æ–¹æ³•ï¼‰.<br>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥localhost:8088&#x2F;demo   , è¿™ä¸ªè¯·æ±‚å°±ä¼šæ‰§è¡Œåˆ°ServletDemoçš„doGetæ–¹æ³•ï¼Œç»è¿‡ä¸€ç³»åˆ—é€»è¾‘ï¼Œæœ€ç»ˆå°†è¦è¿”å›ç»™æµè§ˆå™¨çš„æ•°æ®å†™å…¥HttpServletResponseï¼Œè¿™æ ·æµè§ˆå™¨å°±èƒ½æ”¶åˆ°ç»“æœã€‚</p>
<p>Controllerå®ç°æ–¹å¼ï¼š<br>åªæ˜¯ä¸€ä¸ªbeanï¼Œæ–¹æ³•ä¸Šå¯ä»¥åŠ ä¸Šæ³¨è§£GetMappingï¼ŒPostMappingç­‰ï¼Œæ ‡æ³¨æ˜ å°„çš„urlçš„endpointã€‚<br>Servletå®¹å™¨ï¼ˆTomcatç­‰ï¼‰æ¥æ”¶åˆ°è¯·æ±‚ä»¥åï¼Œå°†è¯·æ±‚äº¤ç»™DispatcherServletçš„serviceæ–¹æ³•æ¥å¤„ç†ï¼Œservletä¼šåœ¨doDispatché‡Œé¢å…ˆæ‰¾åˆ°mappedHandler ï¼Œç„¶åæ‰¾åˆ°HandlerAdapterã€‚è°ƒç”¨HandlerAdapter çš„handleæ–¹æ³•ï¼Œå…¶å®åº”è¯¥æ˜¯AbstractHandlerMethodAdapterï¼Œ<br>ç„¶åè°ƒç”¨åˆ°RequestMappingHandlerAdapterçš„handleInternalï¼Œæœ€ç»ˆè°ƒç”¨åˆ°invokeAndHandleï¼Œåå°„è°ƒç”¨controllerçš„æ–¹æ³•ã€‚æ‰¾åˆ°endpointå¯¹åº”çš„beançš„æ–¹æ³•ï¼Œå¹¶è°ƒç”¨ã€‚</p>
<p>æ€»ç»“ï¼š<br><em><strong>å®¹å™¨&#x3D;&#x3D;ã€‹DispatcherServlet (serviceæ–¹æ³•) &#x3D;&#x3D;ã€‹ doDispatcher &#x3D;&#x3D;ã€‹HandlerAdapter ï¼ˆhandleï¼‰&#x3D;ã€‹AbstractHandlerMethodAdapter&#x3D;&#x3D;ã€‹RequestMappingHandlerAdapter &#x3D;&#x3D;ã€‹invokeAndHandle&#x3D;&#x3D;ã€‹åå°„å…·ä½“çš„controlleræ–¹æ³•</strong></em></p>
<p>è½¬è‡ªï¼š<a href="https://www.cnblogs.com/huainanyin/p/15936212.html">https://www.cnblogs.com/huainanyin/p/15936212.html</a></p>
<p>Springæä¾›çš„DispatcherServletæ˜¯æ€ä¹ˆè°ƒç”¨æˆ‘ä»¬çš„Controlleré‡Œçš„ä¸šåŠ¡æ¥å£çš„ï¼š<a href="https://blog.csdn.net/caoyuanyenang/article/details/114401414">https://blog.csdn.net/caoyuanyenang/article/details/114401414</a></p>
<p>âœ…@RequestMapingå‚æ•°<br>è§javaæ³¨è§£</p>
<h3 id="cookie-session-tockençš„åŒºåˆ«"><a href="#cookie-session-tockençš„åŒºåˆ«" class="headerlink" title="cookie session tockençš„åŒºåˆ«"></a>cookie session tockençš„åŒºåˆ«</h3><p>é‰´æƒï¼šé‰´å®šæƒé™</p>
<p>âœ…cookie</p>
<p>cookieæ˜¯é‰´æƒçš„æ–¹å¼ä¹‹ä¸€ï¼Œæ˜¯å®¢æˆ·ç«¯ç™»å½•åï¼ŒæœåŠ¡å™¨ç«¯ç”Ÿæˆåå‘é€ç»™å®¢æˆ·ç«¯çš„ã€‚cookieå¯ä»¥ä¿å­˜å¾ˆå¤šç§æ•°æ®ï¼Œä½†æ˜¯ä»–åªèƒ½ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¸”åœ¨å®‰å…¨æ€§ä¸Šæœ‰éšæ‚£ã€‚<br>åœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åï¼ŒæœåŠ¡å™¨ç«¯ç”Ÿæˆä¸€ä¸ªcookieï¼Œå¹¶å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä¿å­˜åœ¨å®¢æˆ·ç«¯æœ¬åœ°ï¼Œä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™å¸¦ä¸Šcookieã€‚</p>
<p>âœ…session</p>
<p>sessionæ˜¯ä¸€ç§ä¼šè¯ï¼Œæ¯”å¦‚æˆ‘å‘èµ·è¯·æ±‚åˆ°å…³é—­æµè§ˆå™¨è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªä¼šè¯ã€‚sessionæ˜¯é‰´æƒçš„æ–¹å¼ä¹‹äºŒï¼Œåœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„sessionï¼Œå¹¶ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œå†æŠŠsession idä¿å­˜åˆ°cookieé‡Œé¢ï¼Œé€šè¿‡cookieå‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°cookieè¿‡åï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶å°±ä¼šæŠŠcookieå¸¦ä¸Šï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¸­çš„session idåå°±ä¼šæŠŠå®ƒä¸ä¹‹å‰ä¿å­˜çš„sessionåšå¯¹æ¯”ï¼Œå¦‚æœæ˜¯ä¸€æ ·çš„ï¼Œé‚£å°±è¯´æ˜æ˜¯å·²ç»ç™»å½•è¿‡çš„ï¼Œå¦‚æœä¸ä¸€æ ·ï¼Œé‚£å°±éœ€è¦é‡æ–°ç™»å½•ï¼šæœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯åˆ›é€ ä¸€ä¸ªsessionï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªä¸sessionç›¸å…³è”çš„session idå­˜æ”¾åˆ°cookieä¸­ï¼Œåœ¨æœ¬æ¬¡å“åº”ä¸­è¿”å›åˆ°å®¢æˆ·ç«¯ä¿å­˜ã€‚</p>
<p>âœ…token</p>
<p>tokenæ˜¯ä¸€ä¸ªä»¤ç‰Œï¼Œæ˜¯é‰´æƒæ–¹å¼ä¹‹ä¸‰ï¼Œä»–æ˜¯ç”±ä¸€éƒ¨åˆ†å›ºå®šçš„headerã€ä»¥åŠbodyç»„æˆçš„ï¼Œåœ¨bodyä¸­å¯ä»¥æ”¾userid+ç”µè¯å·ç ï¼Œç­‰ç”¨æˆ·çš„ééšç§˜ä¿¡æ¯ï¼Œç„¶åå†é€šè¿‡æŸç§åŠ å¯†æ–¹å¼ï¼ŒæŠŠè¿™ä¸¤éƒ¨åˆ†åŠ å¯†å½¢æˆä¸€ä¸ªç§˜é’¥ã€‚</p>
<p>åœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªtokenï¼Œå¯ä»¥é€šè¿‡cookieä¹Ÿå¯ä»¥ç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°tokenåï¼Œä¼šæŠŠå®ƒä¿å­˜åœ¨æœ¬åœ°ï¼Œåœ¨ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œä¼šå¸¦ä¸Šï¼ŒæœåŠ¡å™¨ç«¯æ”¶åˆ°äºŒæ¬¡è¯·æ±‚ä»¥åŠå¸¦ä¸Šçš„tokenåï¼Œä¼šå†æ ¹æ®ç”¨æˆ·çš„ä¿¡æ¯å»åŠ å¯†ä¸€ä¸ªtokenï¼Œå†æŠŠä¸¤æ¬¡tokenè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæ˜¯ç›¸åŒçš„ï¼Œé‚£å°±ä¸ç”¨å†ç™»å½•äº†ï¼Œå¦‚æœä¸ä¸€æ ·å°±éœ€è¦å†é‡æ–°ç™»å½•ã€‚</p>
<p>ç¬¬ä¸€æ¬¡è¯·æ±‚å®¢æˆ·ç«¯å‘é€çš„æ²¡æœ‰è¿™ä¸ªtockenï¼ŒæœåŠ¡ç«¯ç”Ÿæˆtockenç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ç¬¬äºŒæ¬¡å‘é€å¸¦ä¸Štockenï¼Œå°±ä¸ç”¨é‡æ–°ç™»é™†äº†ã€‚æœåŠ¡ç«¯ä¸ä¿å­˜tockenã€‚</p>
<p>âœ…åŒºåˆ«</p>
<p>cookieã€sessionã€tokençš„åŒºåˆ«<br>1.ç”Ÿæˆçš„ä½ç½®ç›¸åŒï¼šcookieã€sessionã€tokenéƒ½æ˜¯åœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆï¼›<br>2.ä¿å­˜çš„ä½ç½®ä¸åŒï¼šcookieã€tokenä¿å­˜åœ¨å®¢æˆ·ç«¯æœ¬åœ°ï¼Œsessionä¿å­˜åœ¨æœåŠ¡å™¨ï¼›<br>3.é‰´æƒè¿‡ç¨‹ä¸åŒï¼š<br>cookieæ˜¯å°†è¯·æ±‚ä¸­æºå¸¦çš„cookieä¸æœåŠ¡å™¨è®°å½•çš„cookieåšå¯¹æ¯”ï¼›<br>sessionæ˜¯å°†è¯·æ±‚ä¸­æºå¸¦çš„sessionä¸æœåŠ¡å™¨å­˜å‚¨çš„sessionåšå¯¹æ¯”ï¼›<br>tokenæ˜¯å°†è¯·æ±‚ä¸­æºå¸¦çš„tokenä¸æœåŠ¡å™¨é€šè¿‡è¯·æ±‚ä¸­çš„ä¿¡æ¯ï¼ˆuseridã€ç­¾åï¼‰ç”Ÿæˆçš„tokenä½œå¯¹æ¯”ã€‚</p>
<p>æ‘˜è‡ªï¼š<a href="https://blog.csdn.net/qq_43844012/article/details/124271258">https://blog.csdn.net/qq_43844012/article/details/124271258</a></p>
<p>cookieï¼šç”¨æ¥ä¿å­˜ä¸€äº›ä¿¡æ¯åœ¨å®¢æˆ·ç«¯çš„ï¼Œæ¯”å¦‚è®°ä½å¯†ç å’Œæ¨èæ˜¾ç¤ºã€‚<br>sessionï¼šæ˜¯ç”¨æ¥æ ‡è¯†ä¸€æ¬¡ä¼šè¯çš„ï¼Œåœ¨ä¸€æ¬¡ä¼šè¯æœŸé—´å…±äº«æ•°æ®ã€‚<br>tokenï¼šç”¨æ¥ä½œä¸ºå¯†é’¥å¿«æ·ç™»å½•çš„</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>servlet</tag>
      </tags>
  </entry>
  <entry>
    <title>jarã€warã€tomcatã€servlet</title>
    <url>/2022/06/04/myblog/java/war%E5%8C%85jar%E5%8C%85%E6%89%93%E5%8C%85tomcat%E9%83%A8%E7%BD%B2servlet%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[<h3 id="tomcatä¸servlet"><a href="#tomcatä¸servlet" class="headerlink" title="tomcatä¸servlet"></a>tomcatä¸servlet</h3><p>1.tomcatå°±æ˜¯ä¸€ä¸ªwebåº”ç”¨æœåŠ¡å™¨ï¼Œç›¸å½“äºå¸‚å­˜æ”¾javaç¨‹åºçš„å®¹å™¨ã€‚ä»¥ä¾¿æœåŠ¡è¢«è®¿é—®ã€‚<br>2.servletå®é™…ä¸Šæ˜¯javaç±»ï¼Œjavaè¯­è¨€ç¼–å†™çš„æœåŠ¡å™¨ç«¯ç¨‹åºï¼Œå®ƒç”¨æ¥å¤„ç†httpåè®®ç›¸å…³çš„æ‰€æœ‰å†…å®¹ï¼Œæ²¡æœ‰mainæ–¹æ³•ï¼Œéœ€è¦åœ¨servletå®¹å™¨ä¸­è¿›è¡Œç®¡ç†ï¼Œå¯ä»¥æ˜¯tomactã€‚å¦‚ä½•ä½¿ç”¨ï¼šç»§æ‰¿HttpServletï¼ˆtomcaté‡Œçš„jaråŒ…æ”¯æŒï¼‰ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬å®Œæˆé€šä¿¡çš„è§„åˆ™ã€‚<br>3.tomcatä¸servletå…³ç³»ï¼štomcatæ˜¯servlet&#x2F;jspå®¹å™¨ï¼Œservletæ—¶webåº”ç”¨å¼€å‘çš„ç»„ä»¶ï¼Œtomcatè´Ÿè´£å¤„ç†å®¢æˆ·è¯·æ±‚ï¼ŒæŠŠè¯·æ±‚ä¼ é€ç»™servletï¼Œå†å°†servletçš„å“åº”ä¼ é€å›ç»™å®¢æˆ·ã€‚<br>4.æ–°å»ºwebå·¥ç¨‹æ—¶ï¼Œå¦‚æœä¸ç”¨mavenï¼Œjava enterprise - web applicationï¼Œå†å¼•å…¥jdkã€tomcatï¼ˆtomcatçš„libä¸‹æœ‰servletåŒ…ï¼‰ã€‚å¦‚æœç”¨mavenï¼Œå°±é€‰archetype-webappã€‚</p>
<h3 id="waråŒ…ä¸jaråŒ…"><a href="#waråŒ…ä¸jaråŒ…" class="headerlink" title="waråŒ…ä¸jaråŒ…"></a>waråŒ…ä¸jaråŒ…</h3><p>1.Jaræ–‡ä»¶ï¼ˆæ‰©å±•åä¸º. Jarï¼ŒJava Application Archiveï¼‰åŒ…å«Javaç±»çš„æ™®é€šåº“ã€èµ„æºï¼ˆresourcesï¼‰ã€è¾…åŠ©æ–‡ä»¶ï¼ˆauxiliary filesï¼‰ç­‰ã€‚<br>2.jaråŒ…æ˜¯javaæ‰“çš„åŒ…ï¼Œä¸€èˆ¬åªæ˜¯åŒ…æ‹¬ä¸€äº›ç¼–è¯‘åclassæ–‡ä»¶å’Œä¸€äº›éƒ¨ç½²æ–‡ä»¶ï¼Œåœ¨å£°æ˜äº†Main_classä¹‹åæ˜¯å¯ä»¥ç”¨javaå‘½ä»¤è¿è¡Œçš„ã€‚<br>3.jaråŒ…é€šå¸¸æ˜¯å¼€å‘æ—¶è¦å¼•ç”¨é€šç”¨ç±»ï¼Œæ‰“æˆåŒ…ä¾¿äºå­˜æ”¾ç®¡ç†ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>1.Waræ–‡ä»¶ï¼ˆæ‰©å±•åä¸º.War,Web Application Archiveï¼‰åŒ…å«å…¨éƒ¨Webåº”ç”¨ç¨‹åºã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼Œä¸€ä¸ªWebåº”ç”¨ç¨‹åºè¢«å®šä¹‰ä¸ºå•ç‹¬çš„ä¸€ç»„æ–‡ä»¶ã€ç±»å’Œèµ„æºï¼Œç”¨æˆ·å¯ä»¥å¯¹waræ–‡ä»¶è¿›è¡Œå°è£…ï¼Œå¹¶æŠŠå®ƒä½œä¸ºå°å‹æœåŠ¡ç¨‹åºï¼ˆservletï¼‰æ¥è®¿é—®ã€‚<br>2.waråŒ…å¯ä»¥ç†è§£ä¸ºjavawebæ‰“çš„åŒ…ï¼Œæ˜¯ä¸€ä¸ªwebæ¨¡å—ï¼ŒåŒ…æ‹¬å†™çš„ä»£ç ç¼–è¯‘æˆçš„classæ–‡ä»¶ï¼Œä¾èµ–çš„åŒ…ï¼Œé…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰çš„ç½‘ç«™é¡µé¢ï¼ŒåŒ…æ‹¬htmlï¼Œjspç­‰ç­‰ã€‚ä¸€ä¸ªwaråŒ…å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªwebé¡¹ç›®ï¼Œé‡Œé¢æ˜¯é¡¹ç›®çš„æ‰€æœ‰ä¸œè¥¿ã€‚<br>3.waråŒ…éœ€è¦å‘å¸ƒåˆ°ä¸€ä¸ªå®¹å™¨é‡Œé¢ï¼Œæ‹¿Tomcatæ¥è¯´,å°†waræ–‡ä»¶åŒ…æ”¾ç½®å®ƒçš„\webapps\ç›®å½•ä¸‹ï¼Œå¯åŠ¨Tomcat,è¿™ä¸ªåŒ…å¯ä»¥è‡ªåŠ¨è¿›è¡Œè§£å‹ï¼Œä¹Ÿå°±æ˜¯ä½ çš„webç›®å½•ï¼Œç›¸å½“äºå‘å¸ƒäº†ã€‚<br>4.WARæ˜¯Sunæå‡ºçš„ä¸€ç§Webåº”ç”¨ç¨‹åºæ ¼å¼ï¼Œä¸JARç±»ä¼¼ï¼Œä¹Ÿæ˜¯è®¸å¤šæ–‡ä»¶çš„ä¸€ä¸ªå‹ç¼©åŒ…ã€‚è¿™ä¸ªåŒ…ä¸­çš„æ–‡ä»¶æŒ‰ä¸€å®šç›®å½•ç»“æ„æ¥ç»„ç»‡ï¼šé€šå¸¸å…¶æ ¹ç›®å½•ä¸‹åŒ…å«æœ‰Htmlå’ŒJspæ–‡ä»¶æˆ–è€…åŒ…å«è¿™ä¸¤ç§æ–‡ä»¶çš„ç›®å½•ï¼Œå¦å¤–è¿˜ä¼šæœ‰ä¸€ä¸ªWEB-INFç›®å½•ï¼Œè¿™ä¸ªç›®å½•å¾ˆé‡è¦ã€‚é€šå¸¸åœ¨WEB-INFç›®å½•ä¸‹æœ‰ä¸€ä¸ªweb.xmlæ–‡ä»¶å’Œä¸€ä¸ªclassesç›®å½•ï¼Œweb.xmlæ˜¯è¿™ä¸ªåº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œè€Œclassesç›®å½•ä¸‹åˆ™åŒ…å«ç¼–è¯‘å¥½çš„Servletç±»å’ŒJspæˆ–Servletæ‰€ä¾èµ–çš„å…¶å®ƒç±»ï¼ˆJavaBeanï¼‰ã€‚å¦å¤–è¿˜æœ‰META-INFç›®å½•ï¼Œé‡Œé¢æœ‰MANIFEST.MFæ–‡ä»¶ã€‚å­˜å‚¨äº†é¡¹ç›®çš„å…ƒä¿¡æ¯ã€‚å…¶ä¸­æ–‡ä»¶manifest.mfä»…æ­¤ä¸€ä»½ï¼Œæè¿°äº†ç¨‹åºçš„åŸºæœ¬ä¿¡æ¯ã€Main-Classçš„å…¥å£ã€jarä¾èµ–è·¯å¾„Class-Pathã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/Sunny5319/article/details/90933532">https://blog.csdn.net/Sunny5319/article/details/90933532</a></p>
<p>jaråŒ…å’ŒwaråŒ…éƒ½æ˜¯ä¸ºäº†é¡¹ç›®çš„éƒ¨ç½²å’Œå‘å¸ƒï¼Œé€šå¸¸åœ¨æ‰“åŒ…éƒ¨ç½²çš„æ—¶å€™ï¼Œä¼šåœ¨é‡Œé¢åŠ ä¸Šéƒ¨ç½²çš„ç›¸å…³ä¿¡æ¯ã€‚è¿™ä¸ªæ‰“åŒ…å®é™…ä¸Šå°±æ˜¯æŠŠä»£ç å’Œä¾èµ–çš„ä¸œè¥¿å‹ç¼©åœ¨ä¸€èµ·ï¼Œå˜æˆåç¼€åä¸º.jarå’Œ.warçš„æ–‡ä»¶</p>
<hr>
<p>ä»€ä¹ˆæ—¶å€™ç”¨jarã€war?<br>å½“ä½ çš„é¡¹ç›®åœ¨æ²¡æœ‰å®Œå…¨å®Œæˆçš„æ—¶å€™ï¼Œä¸é€‚åˆä½¿ç”¨waræ–‡ä»¶ï¼Œå› ä¸ºä½ çš„ç±»ä¼šç”±äºè°ƒè¯•ä¹‹ç±»çš„ç»å¸¸æ”¹ï¼Œè¿™æ ·æ¥å›åˆ é™¤ã€åˆ›å»ºwaræ–‡ä»¶å¾ˆä¸æ–¹ä¾¿ï¼Œæ¥å›ä¿®æ”¹ï¼Œæ¥å›æ‰“åŒ…ï¼Œæœ€å¥½æ˜¯ä½ çš„é¡¹ç›®å·²ç»å®Œæˆäº†ï¼Œä¸åšä¿®æ”¹çš„æ—¶å€™ï¼Œé‚£å°±æ‰“ä¸ªwaråŒ…ï¼Œè¿™ä¸ªæ—¶å€™ä¸€ä¸ªwaræ–‡ä»¶å°±ç›¸å½“äºä¸€ä¸ªwebåº”ç”¨ç¨‹åºï¼›è€Œjaræ–‡ä»¶å°±æ˜¯æŠŠç±»å’Œä¸€äº›ç›¸å…³çš„èµ„æºå°è£…åˆ°ä¸€ä¸ªåŒ…ä¸­ï¼Œä¾¿äºç¨‹åºä¸­å¼•ç”¨ã€‚</p>
<h3 id="jaråŒ…æ‰“åŒ…"><a href="#jaråŒ…æ‰“åŒ…" class="headerlink" title="jaråŒ…æ‰“åŒ…"></a>jaråŒ…æ‰“åŒ…</h3><p>å®‰è£…å¥½JDKä¹‹å,jar.exeå°±å·²ç»å®‰è£…å¥½äº†ã€‚åœ¨å‘½ä»¤è¡Œä¸­é”®å…¥jarå‘½ä»¤ä¹‹åï¼Œä¼šæœ‰è¯¦ç»†çš„ç”¨æ³•ä»‹ç»ã€‚</p>
<h4 id="âœ…å•ä¸ªæ–‡ä»¶æ‰“åŒ…"><a href="#âœ…å•ä¸ªæ–‡ä»¶æ‰“åŒ…" class="headerlink" title="âœ…å•ä¸ªæ–‡ä»¶æ‰“åŒ…"></a>âœ…å•ä¸ªæ–‡ä»¶æ‰“åŒ…</h4><p>å°†ä¸€ä¸ªå•ç‹¬çš„javaæ–‡ä»¶æ‰“åŒ…ï¼š<br><code>jar cvf /Users/liuxuan/MyProject/java/test.jar /Users/liuxuan/MyProject/java/jartest/hello.java</code><br>ä½¿ç”¨<code>java -jar test.jar</code> æç¤ºæ²¡æœ‰ä¸»æ¸…å•å±æ€§ã€‚</p>
<p>æ‰€ä»¥å¢åŠ æ¸…å•é…ç½®æ–‡ä»¶ï¼šMANIFEST.MF</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Manifest-Version: 1.0</span><br><span class="line">Main-Class: hello</span><br><span class="line"></span><br><span class="line">//æ³¨æ„ï¼š1. å†’å·åé¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œ2. æœ€åå¿…é¡»å›è½¦åˆ°æ–°çš„ç©ºè¡Œ</span><br></pre></td></tr></table></figure>
<p>å†æ‰“åŒ…ï¼š<code>jar cvfm test.jar ./*</code><br>java -jarè¿è¡Œï¼Œæ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» helloã€‚</p>
<p>æ‰€ä»¥åœ¨æ‰“åŒ…å‰å…ˆç¼–è¯‘ï¼š<code>javac hello.java</code>ï¼Œç”Ÿæˆclassæ–‡ä»¶ï¼Œç„¶åå†æ‰“åŒ…ï¼Œè¿è¡Œï¼Œå¯ä»¥æ‰§è¡Œã€‚</p>
<blockquote>
<p>META-INFæ–‡ä»¶å¤¹ç›¸å½“äºä¸€ä¸ªä¿¡æ¯åŒ…ï¼Œç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•è·å¾—Java 2å¹³å°çš„è®¤å¯ä¸è§£é‡Šï¼Œç”¨æ¥é…ç½®åº”ç”¨ç¨‹åºã€æ‰©å±•ç¨‹åºã€ç±»åŠ è½½å™¨å’ŒæœåŠ¡ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹å’Œå…¶ä¸­çš„ MANIFEST.MFæ–‡ä»¶ï¼Œåœ¨ç”¨jaræ‰“åŒ…æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚<br>æ‰§è¡Œjaræ–‡ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªjaré‡Œæ˜¯éœ€è¦å…·å¤‡ META-INF&#x2F;MANIFEST.MFçš„ï¼Œå¦åˆ™java -jarå°±æ‰¾ä¸åˆ°main classã€‚</p>
</blockquote>
<p>å¤šä¸ªæ–‡ä»¶ä¹Ÿå¯ä»¥å¦‚æ­¤æ‰“åŒ…ï¼Œé¦–å…ˆåº”è¯¥javacç¼–è¯‘ï¼Œç„¶åå¢åŠ ä¸»æ¸…å•é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­å¯ä»¥æŒ‡ç¤ºé»˜è®¤å…¥å£å‡½æ•°ï¼ˆå…¶ä¸­æœ‰mainæ–¹æ³•ï¼‰ã€‚å¦‚æœæ‰“çš„åŒ…ä¸­æœ‰å…¶ä»–ç±»ï¼Œjava -jar jaråŒ… æ˜¯è¿è¡Œé»˜è®¤ç±»ï¼Œè¿è¡Œå…¶ä»–ç±»æ–¹æ³•ï¼š<code>java -cp test.jar com.test.sum 3 9</code>ã€‚<br>mainå‡½æ•°å¯ä»¥æœ‰è¾“å…¥å‚æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.test;</span><br><span class="line"></span><br><span class="line">public class sum&#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        if(args.length &lt; 2)&#123;</span><br><span class="line">            System.out.println(&quot;Paras: num1 num2&quot;);</span><br><span class="line">            System.exit(-1);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        final int num1 = Integer.valueOf(args[0]);</span><br><span class="line">        System.out.println(&quot;Num1: &quot; + num1);</span><br><span class="line">        final int num2 = Integer.valueOf(args[1]);</span><br><span class="line">        System.out.println(&quot;Num2: &quot; + num2);</span><br><span class="line"></span><br><span class="line">        final int sum = num1 + num2;</span><br><span class="line">        System.out.println(num1 + &quot; + &quot; + num2 + &quot; = &quot; + sum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/Xminyang/article/details/108059776">https://blog.csdn.net/Xminyang/article/details/108059776</a></p>
<h4 id="âœ…ä½¿ç”¨ideaæ‰“åŒ…"><a href="#âœ…ä½¿ç”¨ideaæ‰“åŒ…" class="headerlink" title="âœ…ä½¿ç”¨ideaæ‰“åŒ…"></a>âœ…ä½¿ç”¨ideaæ‰“åŒ…</h4><p>ğŸ¤”ä¸å¯ä»¥java -jarçš„æ‰“åŒ…ï¼š<br>1.ç‚¹å‡»intellij ideaå·¦ä¸Šè§’çš„â€œFileâ€èœå• -&gt; Project Structure<br>2.ç‚¹å‡»â€Artifactsâ€ -&gt; ç»¿è‰²çš„â€+â€ -&gt; â€œJARâ€ -&gt; Empty<br>3. Nameæ å¡«å…¥è‡ªå®šä¹‰çš„åå­—ï¼ŒOutput ditectoryé€‰æ‹©jaråŒ…ç›®æ ‡ç›®å½•ï¼ŒAvailable Elementsé‡ŒåŒå‡»éœ€è¦æ·»åŠ åˆ°jaråŒ…çš„æ–‡ä»¶ï¼ˆæ·»åŠ javaå·¥ç¨‹ç¼–è¯‘æ–‡ä»¶ï¼‰<br>4. OKä¹‹åï¼Œç‚¹å‡»èœå•ä¸­â€œBuildâ€ -&gt; â€œBuild Artifactsâ€<br>5. ç‚¹å‡»å¼¹å‡ºæ¡†ä¸­å¾…ç”ŸæˆjaråŒ…ä¸‹é¢çš„buildå³å¯</p>
<p>ç”Ÿæˆäº†jaråŒ…ï¼Œç›´æ¥java -jaræ‰§è¡Œï¼ŒæŠ¥<code>Error: Invalid or corrupt jarfile testjar.jar</code>.<br>éœ€è¦ç”¨ -cp æŒ‡å®šç±»æ¥æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š<code>java -cp testjar.jar leecode.JianPanHang500</code></p>
<p>ğŸ¤”å¯ä»¥ç›´æ¥java -jarçš„æ‰“åŒ…ï¼š<br>å¦‚æœéœ€è¦ç›´æ¥java -jar æ‰§è¡Œçš„jaråŒ…ï¼š<br>1.ç‚¹å‡»â€Artifactsâ€ -&gt; ç»¿è‰²çš„â€+â€ -&gt; â€œJARâ€ -&gt; from modulesâ€¦<br>2.é€‰æ‹©ä¸»ç±»ï¼Œé€‰æ‹©META-INFä½ç½®<br>3.OKä¹‹åï¼Œç‚¹å‡»èœå•ä¸­â€œBuildâ€ -&gt; â€œBuild Artifactsâ€<br>4.ç‚¹å‡»å¼¹å‡ºæ¡†ä¸­å¾…ç”ŸæˆjaråŒ…ä¸‹é¢çš„buildå³å¯</p>
<p>æ³¨æ„ï¼šåœ¨é€‰æ‹©ä¸»ç±»æ—¶éœ€è¦å…¨è·¯å¾„ï¼Œrebuildä¹‹åå¯ä»¥é‡æ–°ç¼–è¯‘ï¼Œ<code>java -jar lee.jar</code>ç›´æ¥è¿è¡Œä¸»ç±»ã€‚</p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_42239765/article/details/123236019">https://blog.csdn.net/qq_42239765/article/details/123236019</a></p>
<h4 id="âœ…ä½¿ç”¨mavenæ‰“åŒ…"><a href="#âœ…ä½¿ç”¨mavenæ‰“åŒ…" class="headerlink" title="âœ…ä½¿ç”¨mavenæ‰“åŒ…"></a>âœ…ä½¿ç”¨mavenæ‰“åŒ…</h4><p>ğŸ¤”ä¸åŒ…å«ä¾èµ–åŒ…ï¼Œä¹Ÿä¸æŒ‡å®šå…¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;!-- é¡¹ç›®æœ€ç»ˆæ‰“åŒ…æˆçš„åå­— --&gt;</span><br><span class="line">    &lt;finalName&gt;mylogmavenpackage&lt;/finalName&gt;</span><br><span class="line">  &lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;!-- æŒ‡å®šé¡¹ç›®ç¼–è¯‘æ—¶çš„javaç‰ˆæœ¬å’Œç¼–ç æ–¹å¼ --&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.7.0&lt;/version&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">        &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">        &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">      &lt;/configuration&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">  &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>

<p>ğŸ¤”æŒ‡å®šå…¥å£ï¼Œå°†ä¾èµ–çš„jaråŒ…è¾“å‡ºåˆ°æŒ‡å®šç›®å½•<br>æŒ‡å®šäº†å…¥å£ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨java -jar project.jaræ‰§è¡Œï¼Œä½†æ˜¯ç¬¬ä¸‰æ–¹ä¾èµ–å­˜åœ¨ä¸€ä¸ªæŒ‡å®šçš„å¤–éƒ¨ç›®å½•ä¸‹ï¼Œè¿ç§»æ—¶éœ€å°†jarå’Œä¾èµ–ç›®å½•ä¸€èµ·è¿ç§»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">  &lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;!-- æŒ‡å®šé¡¹ç›®ç¼–è¯‘æ—¶çš„javaç‰ˆæœ¬å’Œç¼–ç æ–¹å¼ --&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.7.0&lt;/version&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">        &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">        &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">      &lt;/configuration&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;archive&gt;</span><br><span class="line">          &lt;manifest&gt;</span><br><span class="line">            &lt;mainClass&gt;com.netty.client.SignalClient&lt;/mainClass&gt; &lt;!-- æŒ‡å®šå…¥å£ç±» --&gt;</span><br><span class="line">            &lt;addClasspath&gt;true&lt;/addClasspath&gt; &lt;!-- åœ¨jarçš„MFæ–‡ä»¶ä¸­ç”Ÿæˆclasspathå±æ€§ --&gt;</span><br><span class="line">            &lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt; &lt;!-- classpathå‰ç¼€,å³ä¾èµ–jaråŒ…çš„è·¯å¾„ --&gt;</span><br><span class="line">          &lt;/manifest&gt;</span><br><span class="line">        &lt;/archive&gt;</span><br><span class="line">      &lt;/configuration&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.1.1&lt;/version&gt;</span><br><span class="line">      &lt;executions&gt;</span><br><span class="line">        &lt;execution&gt;</span><br><span class="line">          &lt;id&gt;copy&lt;/id&gt;</span><br><span class="line">          &lt;phase&gt;install&lt;/phase&gt;</span><br><span class="line">          &lt;goals&gt;</span><br><span class="line">            &lt;goal&gt;copy-dependencies&lt;/goal&gt;</span><br><span class="line">          &lt;/goals&gt;</span><br><span class="line">          &lt;configuration&gt;</span><br><span class="line">            &lt;!-- æŒ‡å®šä¾èµ–åŒ…çš„è¾“å‡ºè·¯å¾„ï¼Œéœ€ä¸ä¸Šæ–¹çš„classpathPrefixä¿æŒä¸€è‡´ --&gt;</span><br><span class="line">            &lt;outputDirectory&gt;$&#123;project.build.directory&#125;/lib&lt;/outputDirectory&gt;</span><br><span class="line">          &lt;/configuration&gt;</span><br><span class="line">        &lt;/execution&gt;</span><br><span class="line">      &lt;/executions&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">  &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>

<p>ğŸ¤”å°†é¡¹ç›®ä¾èµ–å’Œé¡¹ç›®æ‰“æˆä¸€ä¸ªjaråŒ…ï¼ˆèƒ–åŒ…ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">  &lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;!-- æŒ‡å®šé¡¹ç›®ç¼–è¯‘æ—¶çš„javaç‰ˆæœ¬å’Œç¼–ç æ–¹å¼ --&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.7.0&lt;/version&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">        &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">        &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">      &lt;/configuration&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;archive&gt;</span><br><span class="line">          &lt;manifest&gt;</span><br><span class="line">            &lt;mainClass&gt;com.netty.client.SignalClient&lt;/mainClass&gt; &lt;!-- æŒ‡å®šå…¥å£ç±»è·¯å¾„ --&gt;</span><br><span class="line">          &lt;/manifest&gt;</span><br><span class="line">        &lt;/archive&gt;</span><br><span class="line">        &lt;descriptorRefs&gt;</span><br><span class="line">          &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt; &lt;!-- jaråŒ…åç¼€ï¼Œç”Ÿæˆçš„jaråŒ…å½¢å¼ä¸ºï¼šproject-1.0-SNAPSHOT-jar-with-dependencies.jar --&gt;</span><br><span class="line">        &lt;/descriptorRefs&gt;</span><br><span class="line">      &lt;/configuration&gt;</span><br><span class="line">      &lt;!-- æ·»åŠ æ­¤é¡¹åï¼Œå¯ç›´æ¥ä½¿ç”¨mvn package | mvn install --&gt;</span><br><span class="line">      &lt;!-- ä¸æ·»åŠ æ­¤é¡¹ï¼Œéœ€ç›´æ¥ä½¿ç”¨mvn package assembly:single --&gt;</span><br><span class="line">      &lt;executions&gt;</span><br><span class="line">        &lt;execution&gt;</span><br><span class="line">          &lt;id&gt;make-assembly&lt;/id&gt;</span><br><span class="line">          &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">          &lt;goals&gt;</span><br><span class="line">            &lt;goal&gt;single&lt;/goal&gt;</span><br><span class="line">          &lt;/goals&gt;</span><br><span class="line">        &lt;/execution&gt;</span><br><span class="line">      &lt;/executions&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">  &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>

<h3 id="æ‰“waråŒ…"><a href="#æ‰“waråŒ…" class="headerlink" title="æ‰“waråŒ…"></a>æ‰“waråŒ…</h3><p>ä¸Šé¢æ‰“jaråŒ…ï¼Œå…¶å®éƒ½æœ‰å¯¹åº”çš„æ‰“waråŒ…çš„æ–¹æ³•ï¼š</p>
<p>âœ…æ‰‹åŠ¨æ‰“waråŒ…<br><code>jar cvf test.war ./*</code></p>
<p>âœ…ideaæ‰“waråŒ…<br>artifactä¸­é€‰æ‹©web applicationï¼Œexplodeå¯¹äºwar explodeï¼Œarchiveå¯¹åº”warã€‚</p>
<p>âœ…mavenæ‰“waråŒ…<br>pom.xmlä¸­æŒ‡ç¤º<br><code>&lt;packaging&gt;war&lt;/packaging&gt;</code><br>mavenæœ‰å¤šç§æ‰“åŒ…æ–¹å¼ã€‚</p>
<h3 id="waråŒ…å’Œwar-explodeåŒ…"><a href="#waråŒ…å’Œwar-explodeåŒ…" class="headerlink" title="waråŒ…å’Œwar explodeåŒ…"></a>waråŒ…å’Œwar explodeåŒ…</h3><p>1.waræ¨¡å¼<br>è¿™ç§å¯ä»¥ç§°ä¹‹ä¸ºæ˜¯å‘å¸ƒæ¨¡å¼ï¼Œå°±æ˜¯å…ˆå°†WEBå·¥ç¨‹æ‰“æˆwaråŒ…ï¼Œç„¶åå†å°†å…¶ä¸Šä¼ åˆ°æœåŠ¡å™¨è¿›è¡Œå‘å¸ƒ ã€‚</p>
<p>2.war explodedæ¨¡å¼<br>æ˜¯å°†WEBå·¥ç¨‹ä»¥å½“å‰æ–‡ä»¶å¤¹çš„ä½ç½®å…³ç³»ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå³ç›´æ¥æŠŠæ–‡ä»¶å¤¹ã€jspé¡µé¢ ã€classesç­‰ç­‰ç§»åˆ°Tomcat éƒ¨ç½²æ–‡ä»¶å¤¹é‡Œé¢ï¼Œè¿›è¡ŒåŠ è½½éƒ¨ç½²ã€‚å› æ­¤è¿™ç§æ–¹å¼æ”¯æŒçƒ­éƒ¨ç½²ï¼Œä¸€èˆ¬åœ¨å¼€å‘çš„æ—¶å€™ä¹Ÿæ˜¯ç”¨è¿™ç§æ–¹å¼ã€‚<br>åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™ï¼Œä½¿ç”¨çƒ­éƒ¨ç½²çš„è¯ï¼Œåº”è¯¥å¯¹Tomcatè¿›è¡Œç›¸åº”çš„è®¾ç½®ï¼Œè¿™æ ·çš„è¯ä¿®æ”¹çš„jspç•Œé¢ä»€ä¹ˆçš„ä¸œè¥¿æ‰å¯ä»¥åŠæ—¶çš„æ˜¾ç¤ºå‡ºæ¥ã€‚<br>ï¼ˆçƒ­éƒ¨ç½²ï¼Œå¯¹äºJavaåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œçƒ­éƒ¨ç½²å°±æ˜¯åœ¨è¿è¡Œæ—¶æ›´æ–°Javaç±»æ–‡ä»¶ã€‚ï¼‰</p>
<p>é—®é¢˜ï¼š<br>ideaè¿›è¡Œéƒ¨ç½²ï¼Œä¼šå°†waråŒ…ç§»åˆ°tomcat webappæ–‡ä»¶å¤¹ä¸‹å—ï¼Ÿ</p>
<h3 id="java-webå·¥ç¨‹ç›®å½•ç»“æ„"><a href="#java-webå·¥ç¨‹ç›®å½•ç»“æ„" class="headerlink" title="java webå·¥ç¨‹ç›®å½•ç»“æ„"></a>java webå·¥ç¨‹ç›®å½•ç»“æ„</h3><p>1.srcæ–‡ä»¶å¤¹ï¼šè¿™æ˜¯ç”¨æ¥å­˜æ”¾Javaæºæ–‡ä»¶ã€‚ä¸‹é¢æœ‰mainæ–‡ä»¶å¤¹å’Œtestæ–‡ä»¶å¤¹ã€‚<br>1.1.src&#x2F;main&#x2F;javaï¼šå­˜æ”¾ç›¸åº”çš„Javaä»£ç ï¼Œå¹¶æ ¹æ®å¯¹åº”çš„Javaé¡¹ç›®ç»§ç»­åˆ†å±‚<br>1.2.src&#x2F;main&#x2F;resourceï¼šå­˜æ”¾ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚application.propertiesã€logback.xml<br>1.3.src&#x2F;main&#x2F;webappï¼šWebåº”ç”¨çš„ç½‘é¡µï¼Œç”¨æ¥æ”¾é™æ€èµ„æºæ¯”å¦‚HTMLã€CSSã€å›¾ç‰‡ç­‰æ–‡ä»¶ã€‚WEB-INFç›®å½•æ‰€åœ¨ã€‚WEB-INFä¸­å­˜æ”¾ç½‘ç«™é…ç½®æ–‡ä»¶ç›®å½•ï¼Œweb.xmlç­‰é…ç½®ä¿¡æ¯ã€‚</p>
<p>2..ideaæ–‡ä»¶å¤¹ï¼šæ˜¯å­˜å‚¨IntelliJ IDEAé¡¹ç›®çš„é…ç½®ä¿¡æ¯ï¼Œä¸»è¦å†…å®¹æœ‰IntelliJ IDEAé¡¹ç›®æœ¬èº«çš„ä¸€äº›ç¼–è¯‘é…ç½®ã€æ–‡ä»¶ç¼–ç ä¿¡æ¯ã€jaråŒ…çš„æ•°æ®æºå’Œç›¸å…³çš„æ’ä»¶é…ç½®ä¿¡æ¯ã€‚ä¸€èˆ¬ç”¨gitåšç‰ˆæœ¬æ§åˆ¶çš„æ—¶å€™ä¼šæŠŠ.ideaæ–‡ä»¶å¤¹æ’é™¤ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶ä¸‹ä¿å­˜çš„éƒ½æ˜¯ä¸ªäººæœ¬åœ°Ideaç¼–è¯‘å™¨çš„é…ç½®ã€‚</p>
<p>3.targetæ–‡ä»¶å¤¹ï¼šæ˜¯ç”¨æ¥å­˜æ”¾é¡¹ç›®æ„å»ºåçš„æ–‡ä»¶å’Œç›®å½•ã€jaråŒ…ã€waråŒ…ã€ç¼–è¯‘çš„classæ–‡ä»¶ï¼Œéƒ½æ˜¯mavenæ„å»ºæ—¶ç”Ÿæˆçš„ã€‚å­˜æ”¾çš„æ˜¯å•ä¸ªmoduleçš„ç¼–è¯‘ç»“æœã€‚</p>
<p>4.outæ–‡ä»¶å¤¹ï¼šå­˜æ”¾è¯¥é¡¹ç›®ä¸‹æ‰€æœ‰moduleçš„ç¼–è¯‘ç»“æœã€‚</p>
<p>5.pom.xmlï¼šé¡¹ç›®å¯¹è±¡æ¨¡å‹</p>
<h3 id="æ–°å»ºä¸ªwebå·¥ç¨‹å¹¶éƒ¨ç½²"><a href="#æ–°å»ºä¸ªwebå·¥ç¨‹å¹¶éƒ¨ç½²" class="headerlink" title="æ–°å»ºä¸ªwebå·¥ç¨‹å¹¶éƒ¨ç½²"></a>æ–°å»ºä¸ªwebå·¥ç¨‹å¹¶éƒ¨ç½²</h3><p>1.new projectï¼Œé€‰mavenï¼Œé€‰maven-archetype-webapp<br>2.é€‰æ‹©maven settingï¼Œæ–°å»ºå·¥ç¨‹<br>3.ç®€å•å†™ä¸ªindex.jspï¼Œåœ¨webappç›®å½•ä¸‹ï¼ˆä¸»é¡µï¼‰<br>4.é€šè¿‡ideaéƒ¨ç½²ï¼Œç”Ÿæˆwar_explodeåŒ…ï¼Œçƒ­éƒ¨ç½²<br>5.lsof -i:8080 æŸ¥çœ‹ç«¯å£å ç”¨<br>6.targetæ–‡ä»¶å¤¹ä¸‹æœ‰waråŒ…äº†ï¼Œä½†æ˜¯åœ¨tomcat-webappæ–‡ä»¶å¤¹ä¸‹å¹¶æ²¡æœ‰è¯¥é¡¹ç›®ã€‚<br>7.å…³é—­ideaï¼Œwebä¹Ÿæ— æ³•è®¿é—®äº†ï¼Œæ‰€ä»¥è¦æƒ³ä¸€ç›´è¿è¡Œï¼Œå¾—æ‰“jaråŒ…æ”¾åœ¨webappç›®å½•ä¸‹ï¼Ÿ<br>8.å¹¶ä¸”å‘ç°ï¼Œæ²¡ç”¨servletï¼Œä¸ç”¨å¯¼å…¥servletåŒ…ã€‚</p>
<h3 id="pom-xmlç»“æ„"><a href="#pom-xmlç»“æ„" class="headerlink" title="pom.xmlç»“æ„"></a>pom.xmlç»“æ„</h3><p>pom.xml å°±æ˜¯ maven çš„é…ç½®æ–‡ä»¶ï¼Œç”¨ä»¥æè¿°é¡¹ç›®çš„å„ç§ä¿¡æ¯ã€‚</p>
<p><code>&lt;project </code>  æ˜¯ pom.xml ä¸­æè¿°ç¬¦çš„æ ¹ã€‚</p>
<p><code>&lt;modelVersion&gt;</code> æŒ‡å®š pom.xml ç¬¦åˆå“ªä¸ªç‰ˆæœ¬çš„æè¿°ç¬¦ã€‚maven 2 å’Œ 3 åªèƒ½ä¸º 4.0.0ã€‚</p>
<p>åœ¨ maven ä¸­ï¼Œæ ¹æ® groupIdã€artifactIdã€version ç»„åˆæ¥å”¯ä¸€è¯†åˆ«ä¸€ä¸ª jar åŒ…ã€‚<br><code>&lt;groupId&gt;</code> - å›¢ä½“ã€ç»„ç»‡çš„æ ‡è¯†ç¬¦ã€‚å›¢ä½“æ ‡è¯†çš„çº¦å®šæ˜¯ï¼Œå®ƒä»¥åˆ›å»ºè¿™ä¸ªé¡¹ç›®çš„ç»„ç»‡åç§°çš„é€†å‘åŸŸå(reverse domain name)å¼€å¤´ã€‚ä¸€èˆ¬å¯¹åº”ç€ java çš„åŒ…ç»“æ„ã€‚<br><code>&lt;artifactId&gt;</code> - å•ç‹¬é¡¹ç›®çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ä¾‹å¦‚junitã€‚ä¸è¦åœ¨ artifactId ä¸­åŒ…å«ç‚¹å·(.)ã€‚<br><code>&lt;version&gt;</code> - ä¸€ä¸ªé¡¹ç›®çš„ç‰¹å®šç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>maven åœ¨ç‰ˆæœ¬ç®¡ç†æ—¶å€™å¯ä»¥ä½¿ç”¨å‡ ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸² SNAPSHOTã€LATESTã€RELEASEã€‚æ¯”å¦‚ 1.0-SNAPSHOTã€‚å„ä¸ªéƒ¨åˆ†çš„å«ä¹‰å’Œå¤„ç†é€»è¾‘å¦‚ä¸‹è¯´æ˜ï¼š<br>SNAPSHOT - è¿™ä¸ªç‰ˆæœ¬ä¸€èˆ¬ç”¨äºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¡¨ç¤ºä¸ç¨³å®šçš„ç‰ˆæœ¬ã€‚<br>LATEST - æŒ‡æŸä¸ªç‰¹å®šæ„ä»¶çš„æœ€æ–°å‘å¸ƒï¼Œè¿™ä¸ªå‘å¸ƒå¯èƒ½æ˜¯ä¸€ä¸ªå‘å¸ƒç‰ˆï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ª snapshot ç‰ˆï¼Œå…·ä½“çœ‹å“ªä¸ªæ—¶é—´æœ€åã€‚<br>RELEASE ï¼šæŒ‡æœ€åä¸€ä¸ªå‘å¸ƒç‰ˆã€‚</p>
</blockquote>
<p><code>&lt;packaging&gt;</code> - é¡¹ç›®çš„ç±»å‹ï¼Œæè¿°äº†é¡¹ç›®æ‰“åŒ…åçš„è¾“å‡ºï¼Œé»˜è®¤æ˜¯ jarã€‚å¸¸è§çš„è¾“å‡ºç±»å‹ä¸ºï¼špom, jar, maven-plugin, ejb, war, ear, rar, parã€‚</p>
<p><code>&lt;name&gt;</code> - é¡¹ç›®åå­—</p>
<p><code>&lt;url&gt;</code> - é¡¹ç›®ç½‘ç«™</p>
<p><code>&lt;description&gt;</code> - é¡¹ç›®æè¿°</p>
<p><code>&lt;parent&gt;</code> - maven æ”¯æŒç»§æ‰¿åŠŸèƒ½ã€‚å­ POM å¯ä»¥ä½¿ç”¨ parent æŒ‡å®šçˆ¶ POM ï¼Œç„¶åç»§æ‰¿å…¶é…ç½®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;my-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0&lt;/version&gt;</span><br><span class="line">    &lt;relativePath&gt;../my-parent&lt;/relativePath&gt;</span><br><span class="line">  &lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">relativePath ï¼š åœ¨æœç´¢æœ¬åœ°å’Œè¿œç¨‹å­˜å‚¨åº“ä¹‹å‰ï¼Œå®ƒä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å¯ä»¥ç”¨ä½œ maven çš„æŒ‡ç¤ºç¬¦ï¼Œä»¥é¦–å…ˆæœç´¢ç»™å®šè¯¥é¡¹ç›®çˆ¶çº§çš„è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>

<p><code>&lt;modules&gt;</code> - å­æ¨¡å—åˆ—è¡¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;modules&gt;</span><br><span class="line">    &lt;module&gt;my-project-api&lt;/module&gt;</span><br><span class="line">    &lt;module&gt;my-project-repository&lt;/module&gt;</span><br><span class="line">&lt;/modules&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;properties&gt;</code> - å±æ€§åˆ—è¡¨ã€‚å®šä¹‰çš„å±æ€§å¯ä»¥åœ¨ pom.xml æ–‡ä»¶ä¸­ä»»æ„å¤„ä½¿ç”¨ã€‚ä½¿ç”¨æ–¹å¼ä¸º ${propertie} ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¾‹å­ï¼š</span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">		&lt;!-- Test --&gt;</span><br><span class="line">		&lt;junit.version&gt;1.16.1&lt;/junit.version&gt;</span><br><span class="line">	&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;$&#123;junit.version&#125;&lt;/version&gt;</span><br><span class="line">		&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;dependencies&gt;</code> - ä¾èµ–é…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">groupId, artifactId, version - å’ŒåŸºæœ¬é…ç½®ä¸­çš„ groupIdã€artifactIdã€version æ„ä¹‰ç›¸åŒã€‚</span><br><span class="line"></span><br><span class="line">type - å¯¹åº” packaging çš„ç±»å‹ï¼Œå¦‚æœä¸ä½¿ç”¨ type æ ‡ç­¾ï¼Œmaven é»˜è®¤ä¸º jarã€‚</span><br><span class="line"></span><br><span class="line">scope - æ­¤å…ƒç´ æŒ‡çš„æ˜¯ä»»åŠ¡çš„ç±»è·¯å¾„ï¼ˆç¼–è¯‘å’Œè¿è¡Œæ—¶ï¼Œæµ‹è¯•ç­‰ï¼‰ä»¥åŠå¦‚ä½•é™åˆ¶ä¾èµ–å…³ç³»çš„ä¼ é€’æ€§ã€‚æœ‰ 5 ç§å¯ç”¨çš„é™å®šèŒƒå›´ï¼š</span><br><span class="line">compile : å¦‚æœæ²¡æœ‰æŒ‡å®š scope æ ‡ç­¾ï¼Œmaven é»˜è®¤ä¸ºè¿™ä¸ªèŒƒå›´ã€‚ç¼–è¯‘ä¾èµ–å…³ç³»åœ¨æ‰€æœ‰ classpath ä¸­éƒ½å¯ç”¨ã€‚æ­¤å¤–ï¼Œè¿™äº›ä¾èµ–å…³ç³»è¢«ä¼ æ’­åˆ°ä¾èµ–é¡¹ç›®ã€‚</span><br><span class="line">provided : ä¸ compile ç±»ä¼¼ï¼Œä½†æ˜¯è¡¨ç¤ºæ‚¨å¸Œæœ› jdk æˆ–å®¹å™¨åœ¨è¿è¡Œæ—¶æä¾›å®ƒã€‚å®ƒåªé€‚ç”¨äºç¼–è¯‘å’Œæµ‹è¯• classpathï¼Œä¸å¯ä¼ é€’ã€‚</span><br><span class="line">runtime : æ­¤èŒƒå›´è¡¨ç¤ºç¼–è¯‘ä¸éœ€è¦ä¾èµ–å…³ç³»ï¼Œè€Œæ˜¯ç”¨äºæ‰§è¡Œã€‚å®ƒæ˜¯åœ¨è¿è¡Œæ—¶å’Œæµ‹è¯• classpathï¼Œä½†ä¸æ˜¯ç¼–è¯‘ classpathã€‚</span><br><span class="line">test : æ­¤èŒƒå›´è¡¨ç¤ºæ­£å¸¸ä½¿ç”¨åº”ç”¨ç¨‹åºä¸éœ€è¦ä¾èµ–å…³ç³»ï¼Œä»…é€‚ç”¨äºæµ‹è¯•ç¼–è¯‘å’Œæ‰§è¡Œé˜¶æ®µã€‚å®ƒä¸æ˜¯ä¼ é€’çš„ã€‚</span><br><span class="line">system : æ­¤èŒƒå›´ä¸ provided ç±»ä¼¼ï¼Œé™¤äº†æ‚¨å¿…é¡»æä¾›æ˜ç¡®åŒ…å«å®ƒçš„ jarã€‚è¯¥ artifact å§‹ç»ˆå¯ç”¨ï¼Œå¹¶ä¸”ä¸æ˜¯åœ¨ä»“åº“ä¸­æŸ¥æ‰¾ã€‚</span><br><span class="line"></span><br><span class="line">systemPath - ä»…å½“ä¾èµ–èŒƒå›´æ˜¯ç³»ç»Ÿæ—¶æ‰ä½¿ç”¨ã€‚å¦åˆ™ï¼Œå¦‚æœè®¾ç½®æ­¤å…ƒç´ ï¼Œæ„å»ºå°†å¤±è´¥ã€‚è¯¥è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨ propertie æ¥æŒ‡å®šç‰¹å®šçš„è·¯å¾„ï¼Œå¦‚\$ &#123;java.home&#125; / libã€‚ç”±äºå‡å®šå…ˆå‰å®‰è£…äº†ç³»ç»ŸèŒƒå›´ä¾èµ–å…³ç³»ï¼Œmaven å°†ä¸ä¼šæ£€æŸ¥é¡¹ç›®çš„ä»“åº“ï¼Œè€Œæ˜¯æ£€æŸ¥åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ²¡æœ‰ï¼Œmaven å°†ä¼šå¤±è´¥ï¼Œå¹¶å»ºè®®æ‚¨æ‰‹åŠ¨ä¸‹è½½å®‰è£…ã€‚</span><br><span class="line"></span><br><span class="line">optional - optional è®©å…¶ä»–é¡¹ç›®çŸ¥é“ï¼Œå½“æ‚¨ä½¿ç”¨æ­¤é¡¹ç›®æ—¶ï¼Œæ‚¨ä¸éœ€è¦è¿™ç§ä¾èµ–æ€§æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚</span><br><span class="line"></span><br><span class="line">exclusions - åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ’é™¤å…ƒç´ ï¼Œæ¯ä¸ªæ’é™¤å…ƒç´ éƒ½åŒ…å«ä¸€ä¸ªè¡¨ç¤ºè¦æ’é™¤çš„ä¾èµ–å…³ç³»çš„ groupId å’Œ artifactIdã€‚ä¸å¯é€‰é¡¹ä¸åŒï¼Œå¯èƒ½æˆ–å¯èƒ½ä¸ä¼šå®‰è£…å’Œä½¿ç”¨ï¼Œæ’é™¤ä¸»åŠ¨ä»ä¾èµ–å…³ç³»æ ‘ä¸­åˆ é™¤è‡ªå·±ã€‚</span><br></pre></td></tr></table></figure>

<p><code>&lt;dependencyManagement&gt;</code> - æ˜¯åœ¨<code>&lt;dependencies&gt;</code>å¤–ç”¨çš„ã€‚è¡¨ç¤ºä¾èµ– jar åŒ…çš„å£°æ˜ã€‚å³ä½ åœ¨é¡¹ç›®ä¸­çš„ dependencyManagement ä¸‹å£°æ˜äº†ä¾èµ–ï¼Œmaven ä¸ä¼šåŠ è½½è¯¥ä¾èµ–ï¼ŒdependencyManagement å£°æ˜å¯ä»¥è¢«å­ POM ç»§æ‰¿ã€‚<br>å®ƒçš„ä¸€ä¸ªä½¿ç”¨æ¡ˆä¾‹æ˜¯å½“æœ‰çˆ¶å­é¡¹ç›®çš„æ—¶å€™ï¼Œçˆ¶é¡¹ç›®ä¸­å¯ä»¥åˆ©ç”¨ <code>&lt;dependencyManagement&gt;</code> å£°æ˜å­é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çš„ä¾èµ– jar åŒ…ï¼Œä¹‹åï¼Œå½“æŸä¸ªæˆ–è€…æŸå‡ ä¸ªå­é¡¹ç›®éœ€è¦åŠ è½½è¯¥ä¾èµ–çš„æ—¶å€™ï¼Œå°±å¯ä»¥åœ¨å­é¡¹ç›®ä¸­ dependencies èŠ‚ç‚¹åªé…ç½® groupId å’Œ artifactId å°±å¯ä»¥å®Œæˆä¾èµ–çš„å¼•ç”¨ã€‚<br><code>&lt;dependencyManagement&gt;</code> ä¸»è¦æ˜¯ä¸ºäº†ç»Ÿä¸€ç®¡ç†ä¾èµ–åŒ…çš„ç‰ˆæœ¬ï¼Œç¡®ä¿æ‰€æœ‰å­é¡¹ç›®ä½¿ç”¨çš„ç‰ˆæœ¬ä¸€è‡´ï¼Œç±»ä¼¼çš„è¿˜æœ‰pluginså’ŒpluginManagementã€‚</p>
<p><code>&lt;build&gt;</code> - æ„å»ºé…ç½®ã€‚<br><code>&lt;plugins&gt;</code> - é…ç½®æ’ä»¶ï¼Œåœ¨<code>&lt;build&gt;</code>ä¸‹ã€‚<br><code>pluginManagement</code> - ä¸ dependencyManagement å¾ˆç›¸ä¼¼ï¼Œåœ¨å½“å‰ POM ä¸­ä»…å£°æ˜æ’ä»¶ï¼Œè€Œä¸æ˜¯å®é™…å¼•å…¥æ’ä»¶ã€‚å­ POM ä¸­åªé…ç½® groupId å’Œ artifactId å°±å¯ä»¥å®Œæˆæ’ä»¶çš„å¼•ç”¨ï¼Œä¸”å­ POM æœ‰æƒé‡å†™ pluginManagement å®šä¹‰ã€‚<br>å®ƒçš„ç›®çš„åœ¨äºç»Ÿä¸€æ‰€æœ‰å­ POM çš„æ’ä»¶ç‰ˆæœ¬ã€‚<br><code>&lt;extensions&gt;</code> - æ‰©å±•é…ç½®ï¼Œæ‰©å±•æ˜¯åœ¨æ„å»ºæœŸé—´æ¿€æ´»çš„ artifactsã€‚æ‰©å±•ä¸éœ€è¦å®é™…æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä¹Ÿä¸åŒ…å« Mojoã€‚å› æ­¤ï¼Œæ‰©å±•å¯¹äºæŒ‡å®šæ™®é€šæ’ä»¶æ¥å£çš„å¤šä¸ªå®ç°ä¸­çš„ä¸€ä¸ªæ˜¯éå¸¸å¥½çš„ã€‚</p>
<p>pom.xmlè§£æï¼š<a href="https://zhuanlan.zhihu.com/p/76874769">https://zhuanlan.zhihu.com/p/76874769</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠJavaåŸºç¡€å…¥é—¨ã€‹ä¹‹ç½‘ç»œç¼–ç¨‹</title>
    <url>/2021/12/02/myblog/java/%E3%80%8AJava%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E3%80%8B%E4%B9%8B%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="IPåœ°å€å’Œç«¯å£å·"><a href="#IPåœ°å€å’Œç«¯å£å·" class="headerlink" title="IPåœ°å€å’Œç«¯å£å·"></a>IPåœ°å€å’Œç«¯å£å·</h2><p>IPv4ç”±å››ä¸ªå­—èŠ‚å¤§å°çš„äºŒè¿›åˆ¶æ•°æ¥è¡¨ç¤ºï¼Œé€šå¸¸å†™æˆåè¿›åˆ¶å½¢å¼ï¼Œæ¯ä¸ªæ•°åœ¨0-255ä¹‹é—´ã€‚</p>
<p>IPv6ä½¿ç”¨16ä¸ªå­—èŠ‚è¡¨ç¤ºIPåœ°å€ã€‚</p>
<p>æœ€åˆè®¾è®¡äº’è”ç½‘æ—¶ï¼Œä¸ºäº†ä¾¿äºå¯»å€ä»¥åŠå±‚æ¬¡åŒ–æ„é€ ç½‘ç»œï¼Œæ¯ä¸ªIPåœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå³â€ç½‘ç»œ.ä¸»æœºâ€ï¼Œç½‘ç»œéƒ¨åˆ†è¡¨ç¤ºå…¶å±äºäº’è”ç½‘çš„å“ªä¸€ä¸ªç½‘ç»œï¼Œæ˜¯ç½‘ç»œçš„åœ°å€ç¼–ç ï¼Œä¸»æœºéƒ¨åˆ†è¡¨ç¤ºå…¶å±äºè¯¥ç½‘ç»œä¸­çš„å“ªä¸€å°ä¸»æœºï¼Œæ˜¯ç½‘ç»œä¸­ä¸€ä¸ªä¸»æœºçš„åœ°å€ç¼–ç ï¼ŒäºŒè€…æ˜¯ä¸»ä»å…³ç³»ã€‚</p>
<p>IPåœ°å€åˆ†ä¸ºäº”ç±»ï¼šå¸¸ç”¨çš„æ˜¯A.B.Cç±»ï¼š</p>
<p>â‘ Aç±»åœ°å€ï¼šç¬¬ä¸€æ®µç½‘ç»œåœ°å€ï¼Œå…¶ä½™ä¸‰æ®µä¸»æœºåœ°å€ï¼ŒèŒƒå›´æ˜¯1.0.0.0 â€“ 127.255.255.255ã€‚</p>
<p>â‘¡Bç±»åœ°å€ï¼šå‰ä¸¤æ®µç½‘ç»œåœ°å€ï¼Œå…¶ä½™ä¸¤æ®µä¸»æœºåœ°å€ï¼ŒèŒƒå›´æ˜¯128.0.0.0 â€“ 191.255.255.255ã€‚</p>
<p>â‘¢Cç±»åœ°å€ï¼šå‰ä¸‰æ®µç½‘ç»œåœ°å€ï¼Œæœ€åä¸€æ®µä¸»æœºåœ°å€ï¼ŒèŒƒå›´æ˜¯192.0.0.0 â€“ 223.255.255.255ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæœ¬åœ°å›ç¯åœ°å€127.0.0.1ï¼ŒæŒ‡æœ¬æœºåœ°å€ï¼Œæ”¹åœ°å€ä¸€èˆ¬ç”¨æ¥æµ‹è¯•ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼šping 127.0.0.1 ç”¨æ¥æµ‹è¯•æœ¬æœºTCP&#x2F;IPåè®®æ˜¯å¦æ­£å¸¸ã€‚</p>
<p>ç«¯å£å·ç”¨æ¥è®¿é—®ç›®æ ‡è®¡ç®—æœºä¸­çš„æŸä¸ªåº”ç”¨ç¨‹åºã€‚è®¡ç®—æœºä¸­ï¼Œä¸åŒçš„åº”ç”¨ç¨‹åºæ˜¯é€šè¿‡ç«¯å£å·æ¥åŒºåˆ†çš„ï¼Œç«¯å£å·æ˜¯ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼ˆ16ä½äºŒè¿›åˆ¶æ•°ï¼‰è¡¨ç¤ºçš„ï¼Œå–å€¼èŒƒå›´æ˜¯ï¼š0 ~ 65535ã€‚å…¶ä¸­ï¼Œ0 ~ 1023ä¹‹é—´çš„ç«¯å£å·ç”¨äºä¸€äº›çŸ¥åçš„ç½‘ç»œæœåŠ¡å’Œåº”ç”¨ï¼Œç”¨æˆ·çš„æ™®é€šåº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨1024ä»¥ä¸Šçš„ç«¯å£å·ï¼Œä»è€Œé¿å…ç«¯å£å·è¢«å¦å¤–ä¸€äº›åº”ç”¨æˆ–æœåŠ¡æ‰€å ç”¨ã€‚</p>
<h2 id="InetAddress"><a href="#InetAddress" class="headerlink" title="InetAddress"></a>InetAddress</h2><p>JDKä¸­æä¾›äº†ä¸€ä¸ªä¸IPåœ°å€ç›¸å…³çš„InetAddressç±»ï¼Œè¯¥ç±»ç”¨äºå°è£…ä¸€ä¸ªIPåœ°å€ï¼Œå¹¶æä¾›ä¸€ç³»åˆ—ä¸IPåœ°å€æœ‰å…³çš„æ–¹æ³•ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getByName(String host);  <span class="comment">//è·å–è¡¨ç¤ºæŒ‡å®šä¸»æœºçš„InetAddresså¯¹è±¡</span></span><br><span class="line">getLocalHost()      <span class="comment">//è·å–æœ¬æœºçš„InetAddresså¯¹è±¡ï¼ŒInetAddress.getLocalHost()</span></span><br><span class="line">getHostName()     <span class="comment">//InetAddresså¯¹è±¡.getHostName  è·å–ä¸»æœºåï¼Œè¿”å›String</span></span><br><span class="line">isReachable(<span class="type">int</span> timeout)   <span class="comment">//InetAddresså¯¹è±¡.isReachableï¼Œåˆ¤æ–­åœ¨é™å®šæ—¶é—´å†…æŒ‡å®šçš„IPåœ°å€æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œè¿”å›boolean</span></span><br><span class="line">getHostAddress()    <span class="comment">//InetAddresså¯¹è±¡.getHostAddressï¼Œè·å–å­—ç¬¦ä¸²æ ¼å¼çš„åŸå§‹IPåœ°å€ï¼Œè¿”å›String</span></span><br></pre></td></tr></table></figure>

<p><code>getHostName</code>è·å–æŸä¸ªä¸»æœºçš„åŸŸåï¼Œå¦‚æœInetAddresså¯¹è±¡æ˜¯é€šè¿‡ä¸»æœºååˆ›å»ºçš„ï¼Œåˆ™å°†è¿”å›è¯¥ä¸»æœºåï¼›å¦åˆ™æ ¹æ®IPåœ°å€åå‘æŸ¥æ‰¾å¯¹åº”çš„ä¸»æœºåï¼Œå¦‚æœæ‰¾åˆ°åˆ™å°†å…¶è¿”å›ï¼Œå¦åˆ™è¿”å›IPåœ°å€ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: webproject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: InetAddressç±»ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-02 12:52</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InetAdd</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//è·å–æœ¬æœºInetAddresså¯¹è±¡</span></span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">local</span> <span class="operator">=</span> InetAddress.getLocalHost();  <span class="comment">//ç›¸å½“äº InetAddress.getByName(&quot;localhost&quot;);</span></span><br><span class="line">        <span class="comment">//è·å–ä¸»æœºåä¸º&quot;www.baidu.com&quot;çš„InetAddresså¯¹è±¡</span></span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">remote</span> <span class="operator">=</span> InetAddress.getByName(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;InetAddresså¯¹è±¡ï¼š&quot;</span>+local);</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ¬æœºipï¼š&quot;</span>+local.getHostAddress());</span><br><span class="line">        System.out.println(<span class="string">&quot;ç™¾åº¦ipï¼š&quot;</span>+remote.getHostAddress());</span><br><span class="line">        System.out.println(<span class="string">&quot;3så†…æ˜¯å¦å¯è®¿é—®ç™¾åº¦ï¼š&quot;</span>+remote.isReachable(<span class="number">3000</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ¬æœºä¸»æœºåï¼š&quot;</span>+local.getHostName());</span><br><span class="line">        System.out.println(<span class="string">&quot;ç™¾åº¦ä¸»æœºåï¼š&quot;</span>+remote.getHostName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸€å®šè¦throwså¼‚å¸¸ã€‚</p>
</blockquote>
<h2 id="TCPä¸UDP"><a href="#TCPä¸UDP" class="headerlink" title="TCPä¸UDP"></a>TCPä¸UDP</h2><p>UDPï¼šuser datagram protocol ç”¨æˆ·æ•°æ®æŠ¥åè®®</p>
<p>TCPï¼štransmission control protocol ä¼ è¾“æ§åˆ¶åè®®</p>
<p>UDPï¼šæ— è¿æ¥é€šä¿¡åè®®ï¼Œæ•°æ®çš„å‘é€ç«¯å’Œæ¥æ”¶ç«¯ä¸å»ºç«‹é€»è¾‘è¿æ¥ã€‚å‘é€ç«¯ä¸ä¼šç¡®è®¤æ¥æ”¶ç«¯æ˜¯å¦å­˜åœ¨ï¼Œæ¥æ”¶ç«¯ä¹Ÿä¸ä¼šå‘å‘é€ç«¯åé¦ˆæ˜¯å¦æ”¶åˆ°æ•°æ®ã€‚æ¶ˆè€—èµ„æºå°ï¼Œé€šä¿¡æ•ˆç‡é«˜ï¼Œå»¶è¿Ÿå°ã€‚ç”¨äºéŸ³é¢‘ã€è§†é¢‘ä¼ è¾“ã€‚ä½†æ˜¯ä¸ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p>
<p>TCPï¼šä¼ è¾“æ•°æ®å‰å…ˆåœ¨å‘é€ç«¯å’Œæ¥æ”¶ç«¯å»ºç«‹é€»è¾‘è¿æ¥ï¼Œç„¶åå†ä¼ è¾“æ•°æ®ï¼Œå¿…é¡»æ˜ç¡®å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ï¼Œä¿è¯ä¸¤å°è®¡ç®—æœºä¹‹é—´å¯é æ— å·®é”™çš„æ•°æ®ä¼ è¾“ã€‚</p>
<h2 id="UDPç¼–ç¨‹"><a href="#UDPç¼–ç¨‹" class="headerlink" title="UDPç¼–ç¨‹"></a>UDPç¼–ç¨‹</h2><p>UDPé€šä¿¡è¿‡ç¨‹ç›¸å½“äºåœ¨ä¸¤ä¸ªç å¤´ä¹‹é—´é€šè¿‡é›†è£…ç®±å‘é€è´§ç‰©ã€‚JDKä¸­æä¾›ä¸€ä¸ªDatagramPacketç±»ï¼Œè¯¥ç±»çš„å®ä¾‹å¯¹è±¡ç›¸å½“äºä¸€ä¸ªé›†è£…ç®±ï¼Œç”¨äºå°è£…UDPé€šä¿¡ä¸­å‘é€æˆ–è€…æ¥æ”¶çš„æ•°æ®ã€‚DatagramSocketç±»ï¼Œè¯¥ç±»çš„å®ä¾‹å¯¹è±¡ç›¸å½“äºç å¤´ï¼Œç”¨äºå‘é€å’Œæ¥æ”¶DatagramPacketæ•°æ®æŠ¥ã€‚</p>
<h3 id="DatagramPacket"><a href="#DatagramPacket" class="headerlink" title="DatagramPacket"></a>DatagramPacket</h3><p>åˆ›å»ºå‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„DatagramPacketå¯¹è±¡æ—¶ï¼Œä½¿ç”¨çš„æ„é€ æ–¹æ³•æœ‰æ‰€ä¸åŒã€‚æ¥æ”¶ç«¯çš„æ„é€ æ–¹æ³•åªéœ€è¦æ¥æ”¶ä¸€ä¸ªå­—èŠ‚æ•°ç»„æ¥å­˜æ”¾æ¥æ”¶åˆ°çš„æ•°æ®ã€‚å‘é€ç«¯çš„æ„é€ æ–¹æ³•ä¸ä½†è¦æ¥æ”¶å­˜æ”¾äº†å‘é€æ•°æ®çš„å­—èŠ‚æ•°ç»„ï¼Œè¿˜éœ€è¦æŒ‡å®šæ¥æ”¶ç«¯IPåœ°å€å’Œç«¯å£å·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DatagramPacket(<span class="type">byte</span>[] buf, <span class="type">int</span> length)   ç”¨äºæ¥æ”¶ç«¯ï¼ŒæŒ‡å®šå­—èŠ‚æ•°ç»„å’Œæ•°æ®çš„å¤§å°</span><br><span class="line">DatagramPacket(<span class="type">byte</span>[] buf, <span class="type">int</span> offset, <span class="type">int</span> length)   å¢åŠ ä¸€ä¸ªåç§»é‡ï¼Œä»è¯¥ä½ç½®å¼€å§‹å‘é€</span><br><span class="line">DatagramPacket(<span class="type">byte</span>[] buf, <span class="type">int</span> length, InetAddress add, <span class="type">int</span> port)   ç”¨äºå‘é€ç«¯ï¼ŒæŒ‡å®šå­—èŠ‚æ•°ç»„å’Œæ•°æ®çš„å¤§å°ï¼Œå¿…é¡»çš„ç›®æ ‡ipå’Œç«¯å£</span><br><span class="line">DatagramPacket(<span class="type">byte</span>[] buf, <span class="type">int</span> offset, <span class="type">int</span> length, InetAddress add, <span class="type">int</span> port)   å¢åŠ ä¸€ä¸ªåç§»é‡ï¼Œä»è¯¥ä½ç½®å¼€å§‹å‘é€</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ä¼ å…¥çš„æ˜¯InetAddresså¯¹è±¡ï¼Œè€Œä¸æ˜¯Stringå½¢å¼çš„ipåœ°å€ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DatagramPacketå¯¹è±¡.getAddress()  å¾—åˆ°InetAddresså¯¹è±¡ï¼Œå‘é€ç«¯çš„å¾—åˆ°çš„æ˜¯æ¥æ”¶ç«¯çš„</span><br><span class="line">DatagramPacketå¯¹è±¡.getPort()  è¿”å›<span class="type">int</span>ç«¯å£å·ï¼Œå‘é€ç«¯è¿”å›æ¥æ”¶ç«¯çš„</span><br><span class="line">DatagramPacketå¯¹è±¡.getData()  è¿”å›æ¥æ”¶/å‘é€çš„æ•°æ®ï¼Œå‘é€çš„è¿”å›å‘é€çš„ï¼Œè¿”å›<span class="type">byte</span>[]ç±»å‹</span><br><span class="line">DatagramPacketå¯¹è±¡.getLength() è¿”å›<span class="type">int</span>æ¥æ”¶/å‘é€çš„æ•°æ®é•¿åº¦</span><br></pre></td></tr></table></figure>

<h3 id="DatagramSocket"><a href="#DatagramSocket" class="headerlink" title="DatagramSocket"></a>DatagramSocket</h3><p>ç”¨äºåˆ›å»ºå‘é€ç«¯å’Œæ¥æ”¶ç«¯å¯¹è±¡ï¼Œåˆ›å»ºå‘é€ç«¯å’Œæ¥æ”¶ç«¯DatagramSocketå¯¹è±¡æ—¶ï¼Œä½¿ç”¨çš„æ„é€ æ–¹æ³•ä¸åŒã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DatagramSocket(<span class="type">int</span> port)  ç”¨äºå‘é€ç«¯ï¼Œåœ¨åˆ›å»ºå‘é€ç«¯DatagramSocketå¯¹è±¡æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šç«¯å£å·ï¼Œç³»ç»Ÿè¿›è¡Œåˆ†é…ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šã€‚ç”¨äºæ¥æ”¶ç«¯ï¼Œå¿…é¡»æŒ‡å®šç«¯å£å·ã€‚</span><br><span class="line">DatagramSocket(<span class="type">int</span> port, InetAddress addr)  æŒ‡å®šç«¯å£å·å¤–ï¼Œè¿˜æŒ‡å®šäº†ipåœ°å€ï¼Œç”¨äºè®¡ç®—æœºä¸Šæœ‰å¤šå—ç½‘å¡ï¼Œæ˜ç¡®è§„å®šæ•°æ®é€šè¿‡å“ªå—ç½‘å¡å‘å¤–å‘é€æˆ–æ¥æ”¶ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DatagramSocketå¯¹è±¡.receive(DatagramPacket p)   ç”¨äºæ¥æ”¶DatagramPacketæ•°æ®æŠ¥ï¼Œåœ¨æ¥æ”¶åˆ°æ•°æ®ä¹‹å‰ä¼šä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¦‚æœå‘é€æ¶ˆæ¯çš„é•¿åº¦æ¯”æ•°æ®æŠ¥é•¿ï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æˆªå–ã€‚</span><br><span class="line">DatagramSocketå¯¹è±¡.send(DatagramPacket p)   ç”¨äºå‘é€DatagramPacketæ•°æ®æŠ¥ï¼Œå…¶ä¸­åº”è¯¥åŒ…å«å‘é€çš„æ•°æ®ã€é•¿åº¦ã€æ¥æ”¶ç«¯ipã€ç«¯å£å·</span><br><span class="line">DatagramSocketå¯¹è±¡.close()   å…³é—­å½“å‰socketï¼Œé€šçŸ¥é©±åŠ¨ç¨‹åºé‡Šæ”¾ä¸ºè¿™ä¸ªsocketä¿ç•™çš„èµ„æºã€‚</span><br></pre></td></tr></table></figure>

<h3 id="UDPå®ç°"><a href="#UDPå®ç°" class="headerlink" title="UDPå®ç°"></a>UDPå®ç°</h3><p>é€šä¿¡æ—¶ï¼Œéœ€è¦æ¥æ”¶ç«¯ç¨‹åºå…ˆè¿è¡Œï¼Œæ‰èƒ½é¿å…å› å‘é€ç«¯å‘é€çš„æ•°æ®æ— æ³•æ¥æ”¶è€Œé€ æˆçš„æ•°æ®ä¸¢å¤±ã€‚</p>
<p>æ¥æ”¶ç«¯ç¨‹åºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: webproject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: UDPæ¥æ”¶ç«¯ç¨‹åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-02 19:41</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPReceiver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªæŒ‡å®šç«¯å£å·ä¸º8900çš„æ¥æ”¶ç«¯DatagramSocketå¯¹è±¡</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">8900</span>);</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªé•¿åº¦ä¸º1024çš„å­—èŠ‚æ•°ç»„ï¼Œç”¨äºæ¥æ”¶æ•°æ®</span></span><br><span class="line">        <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªDatagramPacketæ•°æ®æŠ¥å¯¹è±¡ï¼Œç”¨äºå°è£…æ¥æ”¶çš„æ•°æ®</span></span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf, buf.length);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;   <span class="comment">//ä½¿å¾—ä¸€ç›´å¾ªç¯æ¥æ”¶</span></span><br><span class="line">            <span class="comment">//ç­‰å¾…æ¥æ”¶æ•°æ®ï¼Œåœ¨æ²¡æœ‰æ¥æ”¶åˆ°ä¹‹å‰å¤„äºé˜»å¡çŠ¶æ€</span></span><br><span class="line">            server.receive(packet);</span><br><span class="line">            <span class="comment">//è°ƒç”¨DatagramPacketçš„æ–¹æ³•è·å¾—æ¥æ”¶åˆ°çš„ä¿¡æ¯ï¼Œå¹¶è½¬æ¢æˆå­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(packet.getData(), <span class="number">0</span>, packet.getLength());</span><br><span class="line">            System.out.println(packet.getAddress()+<span class="string">&quot;:&quot;</span>+packet.getPort()+<span class="string">&quot;å‘é€æ¶ˆæ¯ï¼š&quot;</span>+str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘é€ç«¯ç¨‹åºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: webproject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: UDPå‘é€ç«¯ç¨‹åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-02 20:25</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPSender</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªæŒ‡å®šç«¯å£å·3000çš„å‘é€ç«¯DatagramSocketå¯¹è±¡</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">3000</span>); <span class="comment">//å¯ä»¥ä¸æŒ‡å®šç«¯å£</span></span><br><span class="line">        <span class="comment">//å®šä¹‰è¦å‘é€çš„æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;hello world!&quot;</span>;</span><br><span class="line">        System.out.println(Arrays.toString(str.getBytes()));</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªDatagramPacketæ•°æ®æŠ¥å¯¹è±¡ï¼Œå°è£…å‘é€ç«¯ä¿¡æ¯ä»¥åŠå‘é€åœ°å€</span></span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(str.getBytes(),</span><br><span class="line">                str.getBytes().length, InetAddress.getByName(<span class="string">&quot;localhost&quot;</span>), <span class="number">8900</span>);  <span class="comment">//è¿™ä¸ªä¸€å®šè¦ä¸æ¥æ”¶ç«¯ç¨‹åºè®¾ç½®ä¸€æ ·</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å¼€å§‹å‘é€æ•°æ®...&quot;</span>);</span><br><span class="line">        client.send(packet);</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>byte[]æ•°ç»„ï¼Œé‡Œé¢å­˜çš„æ˜¯æ•°å­—ï¼Œç¼–è§£ç å˜ä¸ºå­—ç¬¦ä¸²ã€‚</p>
<p>ç–‘é—®ï¼šbyteæ˜¯1å­—èŠ‚ï¼Œ8bitï¼Œcharæ˜¯2å­—èŠ‚ï¼Œå¦‚ä½•å¯¹åº”ï¼Ÿ</p>
<p>ä¸€ä¸ªå­—ç¬¦ç­‰äºå‡ ä¸ªå­—èŠ‚ï¼Ÿ</p>
<p>ä¸åŒçš„å­—ç¬¦æ‰€å çš„å­—èŠ‚æ˜¯ä¸åŒçš„ã€‚</p>
<p>ASCIIç ï¼š</p>
<p>ä¸€ä¸ªè‹±æ–‡å­—æ¯ï¼ˆä¸åˆ†å¤§å°å†™ï¼‰å ä¸€ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œä¸€ä¸ªä¸­æ–‡æ±‰å­—å ä¸¤ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚ä¸€ä¸ªäºŒè¿›åˆ¶æ•°å­—åºåˆ—ï¼Œåœ¨è®¡ç®—æœºä¸­ä½œä¸ºä¸€ä¸ªæ•°å­—å•å…ƒï¼Œä¸€èˆ¬ä¸º8ä½äºŒè¿›åˆ¶æ•°ï¼Œæ¢ç®—ä¸ºåè¿›åˆ¶ã€‚æœ€å°å€¼0ï¼Œæœ€å¤§å€¼255ã€‚å¦‚ä¸€ä¸ªASCIIç å°±æ˜¯ä¸€ä¸ªå­—èŠ‚ã€‚</p>
<p>UTF-8ç¼–ç ï¼š</p>
<p>ä¸€ä¸ªè‹±æ–‡å­—ç¬¦ç­‰äºä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªä¸­æ–‡ï¼ˆå«ç¹ä½“ï¼‰ç­‰äºä¸‰ä¸ªå­—èŠ‚ã€‚</p>
<p>Unicodeç¼–ç ï¼š</p>
<p>ä¸€ä¸ªè‹±æ–‡ç­‰äºä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªä¸­æ–‡ï¼ˆå«ç¹ä½“ï¼‰ç­‰äºä¸¤ä¸ªå­—èŠ‚ã€‚</p>
<p>GBKç¼–ç ï¼š</p>
<p>ä¸­æ–‡å ä¸¤ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å 1ä¸ªå­—èŠ‚ã€‚</p>
</blockquote>
<p>UDPç¨‹åºåœ¨å‘é€æ•°æ®æ—¶æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨å°è£…åˆ°<code>DatagramPacket</code>æ•°æ®æŠ¥ä¸­è¿›è¡Œç»Ÿä¸€å‘é€çš„ï¼Œç„¶è€Œ<code>DatagramPacket</code>æ•°æ®æŠ¥ä¸€æ¬¡æ€§å…è®¸å°è£…çš„æ•°æ®é‡æ˜¯æœ‰é™åº¦çš„ï¼Œç†è®ºæœ€å¤§å€¼æ˜¯ï¼š65507ä¸ªå­—èŠ‚ï¼ˆIPæ•°æ®æŠ¥çš„æœ€å¤§é™åˆ¶65535å­—èŠ‚å‡å»IPé¦–éƒ¨çš„20å­—èŠ‚å’ŒUDPé¦–éƒ¨çš„8å­—èŠ‚ï¼‰ã€‚ä½†æ˜¯è®¸å¤šå¹³å°å®é™…çš„æœ€å¤§é™åˆ¶æ˜¯8192å­—èŠ‚ï¼ˆ8Kï¼‰ã€‚</p>
<blockquote>
<p>æ£€æŸ¥è®¡ç®—æœºä½¿ç”¨çš„ç«¯å£ï¼šnetstat -anb</p>
<p>æŠ¥é”™ï¼šnetstat: option requires an argument â€“ p</p>
<p>åœ¨Macä¸Šæ­£ç¡®ä½¿ç”¨çš„æ–¹æ³•æ˜¯ï¼šå³-féœ€è¦åŠ ä¸Šåœ°å€æ—ï¼Œ-péœ€è¦åŠ ä¸Šåè®®TCPæˆ–è€…UDPç­‰</p>
<p>aï¼‰å¦‚æœéœ€è¦æŸ¥è¯¢inetï¼Œnetstat -anvf inet</p>
<p> bï¼‰å¦‚æœéœ€è¦æŸ¥è¯¢TCPï¼Œ netstat -anvp tcp</p>
<p> bï¼‰å¦‚æœéœ€è¦æŸ¥è¯¢UDPï¼Œnetstat -anvp udp   </p>
<p>netstat -anvp tcp |grep 10001</p>
</blockquote>
<h3 id="å°é¡¹ç›®-èŠå¤©ç¨‹åº"><a href="#å°é¡¹ç›®-èŠå¤©ç¨‹åº" class="headerlink" title="å°é¡¹ç›®-èŠå¤©ç¨‹åº"></a>å°é¡¹ç›®-èŠå¤©ç¨‹åº</h3><p>æ¨¡æ‹Ÿqqä¸­ä¸¤ä¸ªç”¨æˆ·ä¸€å¯¹ä¸€èŠå¤©ï¼Œé€šè¿‡å¤šçº¿ç¨‹å®ç°å‘é€ç«¯å’Œæ¥æ”¶ç«¯åŠŸèƒ½ã€‚</p>
<p>ä¸»æœºç¨‹åºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.udp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketException;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: webproject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: èŠå¤©ç¨‹åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-02 21:51</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatRoom1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.print(<span class="string">&quot;è¾“å…¥æœ¬æœºç«¯å£å·ï¼š&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">serverPort</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        System.out.print(<span class="string">&quot;è¾“å…¥ç›®æ ‡è®¡ç®—æœºç«¯å£å·ï¼š&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">targetPort</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        System.out.println(<span class="string">&quot;èŠå¤©æœåŠ¡å¯åŠ¨ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºèŠå¤©ç¨‹åºæ”¶å‘å¹³å°DatagramSocketå¯¹è±¡</span></span><br><span class="line">            <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(serverPort);</span><br><span class="line">            <span class="comment">//å¯åŠ¨ä¿¡æ¯æ¥æ”¶ç«¯å’Œå‘é€ç«¯ç¨‹åº</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ChatReceiver</span>(socket), <span class="string">&quot;æ¥æ”¶ç«¯æœåŠ¡&quot;</span>).start();</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ChatSender</span>(socket, targetPort), <span class="string">&quot;å‘é€æœåŠ¡&quot;</span>).start();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(SocketException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥æ”¶ç¨‹åºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.udp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: webproject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æ¥æ”¶ç«¯ç¨‹åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-02 22:06</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatReceiver</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="comment">//éœ€è¦æœ‰DatagramSocketå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> DatagramSocket server;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatReceiver</span><span class="params">(DatagramSocket server)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.server = server;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="comment">//å®šä¹‰ä¸€ä¸ªDatagramPacketæ•°æ®æŠ¥å¯¹è±¡ï¼Œç”¨äºå°è£…æ¥æ”¶çš„æ•°æ®</span></span><br><span class="line">            <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf, buf.length);</span><br><span class="line">            System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ•°æ®&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;   <span class="comment">//ä½¿å¾—ä¸€ç›´å¾ªç¯æ¥æ”¶</span></span><br><span class="line">                <span class="comment">//ç­‰å¾…æ¥æ”¶æ•°æ®ï¼Œåœ¨æ²¡æœ‰æ¥æ”¶åˆ°ä¹‹å‰å¤„äºé˜»å¡çŠ¶æ€</span></span><br><span class="line">                server.receive(packet);</span><br><span class="line">                <span class="comment">//è°ƒç”¨DatagramPacketçš„æ–¹æ³•è·å¾—æ¥æ”¶åˆ°çš„ä¿¡æ¯ï¼Œå¹¶è½¬æ¢æˆå­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(packet.getData(), <span class="number">0</span>, packet.getLength());</span><br><span class="line">                System.out.println(<span class="string">&quot;æ”¶åˆ°&quot;</span>+packet.getAddress()+<span class="string">&quot;:&quot;</span>+packet.getPort()+<span class="string">&quot;å‘é€çš„æ•°æ®ï¼š&quot;</span>+str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘é€ç¨‹åºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.udp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: webproject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å‘é€ç«¯ç¨‹åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-02 22:14</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatSender</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="comment">//éœ€è¦æœ‰DatagramSocketå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> DatagramSocket client;</span><br><span class="line">    <span class="comment">//è¿˜éœ€è¦ç›®æ ‡ç«¯å£å·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> targetPort;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatSender</span><span class="params">(DatagramSocket client, <span class="type">int</span> targetPort)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.client = client;</span><br><span class="line">        <span class="built_in">this</span>.targetPort = targetPort;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">                <span class="type">byte</span>[] buf = data.getBytes();</span><br><span class="line">                <span class="comment">//è¿™é‡Œéœ€è¦ç›®æ ‡ipåœ°å€ï¼Œä»¥åŠç›®æ ‡ç«¯å£å·</span></span><br><span class="line">                <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf, buf.length,</span><br><span class="line">                        InetAddress.getByName(<span class="string">&quot;127.0.0.1&quot;</span>), targetPort);</span><br><span class="line">                <span class="comment">//127.0.0.1 å’Œ localhost ä¸€æ ·ï¼Œéƒ½æ˜¯æœ¬æœº</span></span><br><span class="line">                client.send(packet);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…³äºç«¯å£å·æœ‰ç‚¹ä¹±ï¼š</p>
<p>å‘é€ç«¯ï¼šDatagramSocketä¸­å¯æŒ‡å®šä¹Ÿå¯ä¸æŒ‡å®šç«¯å£å·ã€‚DatagramPacketä¸€å®šè¦æŒ‡å®šæ¥æ”¶ç«¯çš„ipå’Œæ¥æ”¶ç«¯æ¥æ”¶ç«¯å£ã€‚</p>
<p>æ¥æ”¶ç«¯ï¼šDatagramSocketä¸€å®šè¦æŒ‡å®šæ¥æ”¶ç«¯å£ï¼ŒDatagramPacketé‡Œé¢ä¸éœ€è¦ipå’Œç«¯å£ã€‚</p>
<p>åœ¨ä¸Šé¢çš„UDPå®ç°ä¸­ï¼Œå‘é€å’Œæ¥æ”¶çš„ç«¯å£å·ä¸åŒã€‚æ˜¯å•å‘çš„ã€‚</p>
<p>è¿™ä¸ªèŠå¤©ç¨‹åºä¸­ï¼Œæ¨¡æ‹Ÿä¸¤ä¸ªä¸»æœºï¼Œä¸€ä¸ªä¸»æœºçš„å‘é€å’Œæ¥æ”¶çš„ç«¯å£æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªä¸»æœºå‘é€å’Œæ¥æ”¶çš„socketä¸€æ ·ã€‚ä½†æ˜¯ä¸¤ä¸ªç›®æ ‡ä¸»æœºçš„ç«¯å£è¦å¯¹åº”ä¸Šã€‚æ˜¯åŒå‘çš„ã€‚</p>
</blockquote>
<h2 id="TCPç¼–ç¨‹"><a href="#TCPç¼–ç¨‹" class="headerlink" title="TCPç¼–ç¨‹"></a>TCPç¼–ç¨‹</h2><p>UDPåªæœ‰å‘é€ç«¯å’Œæ¥æ”¶ç«¯ï¼Œä¸åŒºåˆ†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼Œè®¡ç®—æœºä¹‹é—´å¯ä»¥ä»»æ„åœ°å‘é€æ•°æ®ã€‚</p>
<p>TCPä¸¥æ ¼åŒºåˆ†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼Œåœ¨é€šä¿¡æ—¶ï¼Œå¿…é¡»å…ˆç”±å®¢æˆ·ç«¯å»è¿æ¥æœåŠ¡å™¨ç«¯æ‰èƒ½å®ç°é€šä¿¡ï¼ŒæœåŠ¡å™¨ç«¯ä¸ä¼šä¸»åŠ¨è¿æ¥å®¢æˆ·ç«¯ã€‚</p>
<p>JDKæä¾›ServerSocketç±»è¡¨ç¤ºæœåŠ¡å™¨ç«¯ï¼ŒSocketç±»è¡¨ç¤ºå®¢æˆ·ç«¯ã€‚é€šä¿¡æ—¶ï¼Œé¦–å…ˆåˆ›å»ºä»£è¡¨æœåŠ¡å™¨ç«¯çš„ServerSocketå¯¹è±¡ï¼Œå¼€å¯ä¸€ä¸ªæœåŠ¡ï¼Œå¹¶ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ï¼›ç„¶ååˆ›å»ºSocketå¯¹è±¡ä»£è¡¨å®¢æˆ·ç«¯ï¼Œå‘æœåŠ¡å™¨ç«¯å‘å‡ºè¿æ¥è¯·æ±‚ã€‚æœåŠ¡å™¨ç«¯å“åº”è¯·æ±‚ï¼Œä¸¤è€…å»ºç«‹è¿æ¥åæ­£å¼è¿›è¡Œé€šä¿¡ã€‚</p>
<h3 id="ServerSocket"><a href="#ServerSocket" class="headerlink" title="ServerSocket"></a>ServerSocket</h3><p>java.netåŒ…ä¸­ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç«¯ï¼Œéœ€è¦è‡ªå·±ç«¯å£å·ï¼Œæ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>ServerSocket()   <span class="comment">//æ²¡æœ‰æŒ‡å®šç«¯å£å·ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦bind(SocketAddress endpoint)æ–¹æ³•å°†å…¶ç»‘å®šåˆ°æŒ‡å®šç«¯å£å·ã€‚</span></span><br><span class="line"><span class="number">2.</span>ServerSocket(<span class="type">int</span> port)   <span class="comment">//æŒ‡å®šç«¯å£ï¼Œå¦‚æœå‚æ•°æ˜¯0ï¼Œç³»ç»Ÿä¼šåˆ†é…ä¸€ä¸ªæœªè¢«å ç”¨çš„ç«¯å£å·ï¼Œå¹¶ä¸å¸¸ç”¨ï¼Œå› ä¸ºå®¢æˆ·ç«¯éœ€è¦çŸ¥é“ç«¯å£å·ã€‚ï¼ˆæœ€å¸¸ç”¨ï¼‰</span></span><br><span class="line"><span class="number">3.</span>ServerSocket(<span class="type">int</span> port, <span class="type">int</span> backlog)  <span class="comment">//backlogè¡¨ç¤ºåœ¨æœåŠ¡å™¨å¿™æ—¶ï¼Œå¯ä¸ä¹‹ä¿æŒè¿æ¥è¯·æ±‚çš„ç­‰å¾…å®¢æˆ·ç«¯æ•°é‡ã€‚é»˜è®¤50ã€‚</span></span><br><span class="line"><span class="number">4.</span>ServerSocket(<span class="type">int</span> port, <span class="type">int</span> backlog, InetAddress bindAddr)  <span class="comment">//åœ¨å¤šç½‘å¡æƒ…å†µä¸‹ä½¿ç”¨ï¼ŒæŒ‡å®šä½¿ç”¨æœåŠ¡å™¨çš„å“ªä¸ªip</span></span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ServerSocketå¯¹è±¡.accept()   <span class="comment">//ç­‰å¾…ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œä¸å®¢æˆ·ç«¯è¿æ¥ä¹‹å‰ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¦‚æœæœ‰è¿æ¥å°±è¿”å›ä¸ä¹‹è¿æ¥çš„å®¢æˆ·ç«¯Socketå¯¹è±¡</span></span><br><span class="line">ServerSocketå¯¹è±¡.getInetAddress()   <span class="comment">//è¿”å›ä¸€ä¸ªInetAddresså¯¹è±¡ï¼Œè¡¨ç¤ºServerSocketç»‘å®šçš„ip</span></span><br><span class="line">ServerSocketå¯¹è±¡.isClosed()   <span class="comment">//è¿”å›booleanï¼Œåˆ¤æ–­ServerSocketå¯¹è±¡æ˜¯å¦ä¸ºå…³é—­çŠ¶æ€</span></span><br><span class="line">ServerSocketå¯¹è±¡.bindï¼ˆSocketAddress endpointï¼‰  <span class="comment">//æ— è¿”å›ï¼Œå°†ServerSocketå¯¹è±¡ç»‘å®šåˆ°æŒ‡å®šipå’Œç«¯å£</span></span><br></pre></td></tr></table></figure>

<h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3><p>ç”¨äºå®ç°TCPå®¢æˆ·ç«¯ç¨‹åºï¼Œéœ€è¦ç›®æ ‡ipå’Œç«¯å£å·ï¼ˆæœ¬æœºç«¯å£å·å‘¢ï¼Ÿï¼‰ï¼Œæ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>Socket()  <span class="comment">//æ²¡æœ‰æŒ‡å®šipå’Œç«¯å£å·ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦è°ƒç”¨connect(SocketAddress endpoint)æ–¹æ³•å®Œæˆä¸æŒ‡å®šæœåŠ¡å™¨ç«¯çš„è¿æ¥ï¼Œå‚æ•°endpointå°è£…äº†ipåœ°å€å’Œç«¯å£å·ã€‚</span></span><br><span class="line"><span class="number">2.</span>Socket(String host, <span class="type">int</span> port)   <span class="comment">//hostè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„ipåœ°å€</span></span><br><span class="line"><span class="number">3.</span>Socket(InetAddress add, <span class="type">int</span> port)   <span class="comment">//addå°è£…ip</span></span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>Socketå¯¹è±¡.getPort()  <span class="comment">//è¿”å›intï¼Œè·å¾—Socketè¿æ¥çš„è¿œç¨‹æœåŠ¡å™¨çš„ç«¯å£å·</span></span><br><span class="line"><span class="number">2.</span>Socketå¯¹è±¡.getLocalAddress()   <span class="comment">//è¿”å›Socketå¯¹è±¡ç»‘å®šçš„æœ¬åœ°ip</span></span><br><span class="line"><span class="number">3.</span>Socketå¯¹è±¡.close()  <span class="comment">//æ— è¿”å›ï¼Œå…³é—­Socketè¿æ¥ï¼Œå…³é—­ä¹‹å‰ï¼Œå…ˆå…³é—­æ‰€æœ‰è¾“å…¥è¾“å‡ºæµ</span></span><br><span class="line"><span class="number">4.</span>Socketå¯¹è±¡.getInputStream()  <span class="comment">//è¿”å›ä¸€ä¸ªInputStreamç±»å‹çš„è¾“å…¥æµå¯¹è±¡ã€‚æœåŠ¡å™¨ç«¯çš„Socketè°ƒç”¨ï¼Œç”¨äºè·å–æ¥è‡ªå®¢æˆ·ç«¯å‘é€çš„æ•°æ®ã€‚å®¢æˆ·ç«¯çš„Socketè°ƒç”¨ï¼Œç”¨äºè·å–æ¥è‡ªæœåŠ¡ç«¯å‘é€çš„æ•°æ®ã€‚</span></span><br><span class="line"><span class="number">5.</span>Socketå¯¹è±¡.getOutputStream()  <span class="comment">//è¿”å›ä¸€ä¸ªOutputStreamç±»å‹çš„è¾“å‡ºæµå¯¹è±¡ã€‚æœåŠ¡å™¨ç«¯çš„Socketè°ƒç”¨ï¼Œç”¨äºå‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚å®¢æˆ·ç«¯çš„Socketè°ƒç”¨ï¼Œç”¨äºå‘æœåŠ¡ç«¯å‘é€æ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure>

<p>å½“å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥åï¼Œæ•°æ®æ˜¯ä»¥I&#x2F;Oæµçš„å½¢å¼è¿›è¡Œäº¤äº’çš„ã€‚</p>
<p>è¾“å…¥æµå’Œè¾“å‡ºæµçš„æ–¹æ³•éƒ½æ˜¯Socketå¯¹è±¡è°ƒç”¨çš„ï¼Œæ— è®ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ç«¯ä¸­ï¼Œéƒ½æœ‰Socketå¯¹è±¡ã€‚è¾“å…¥æµç”¨æ¥è·å–è¾“å…¥åˆ°æœ¬æœºçš„æ•°æ®ï¼Œreadæ–¹æ³•ã€‚è¾“å‡ºæµç”¨æ¥å‘å¦ä¸€å°è¾“å‡ºæ•°æ®ï¼Œwriteæ–¹æ³•ã€‚</p>
<h3 id="TCPå®ç°"><a href="#TCPå®ç°" class="headerlink" title="TCPå®ç°"></a>TCPå®ç°</h3><p>æœåŠ¡å™¨ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.tcp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: webproject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TCPæœåŠ¡å™¨ç«¯å®ç°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-03 11:23</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºæŒ‡å®šç«¯å£å·çš„æœåŠ¡ç«¯ServerSocketå¯¹è±¡</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">7788</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//è°ƒç”¨acceptæ–¹æ³•å¼€å§‹æ¥æ”¶æ•°æ®</span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">client</span> <span class="operator">=</span> server.accept();</span><br><span class="line">            System.out.println(<span class="string">&quot;acceptè¿”å›ï¼Œè¿æ¥æˆåŠŸã€‚&quot;</span>);</span><br><span class="line">            <span class="comment">//å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œwriteæ–¹æ³•</span></span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> client.getOutputStream();</span><br><span class="line">            <span class="comment">//å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œç”¨å®¢æˆ·ç«¯çš„è¾“å‡ºæµ</span></span><br><span class="line">            os.write((<span class="string">&quot;æˆ‘æ˜¯æœåŠ¡ç«¯ã€‚&quot;</span>).getBytes());</span><br><span class="line">            <span class="comment">//æ¨¡æ‹Ÿäº¤äº’è€—æ—¶</span></span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            <span class="comment">//å…³é—­æµå’ŒSocketè¿æ¥</span></span><br><span class="line">            os.close();</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>clientï¼ˆSocketç±»å‹çš„å¯¹è±¡ï¼‰ç”¨äºè¡¨ç¤ºå®¢æˆ·ç«¯ï¼Œé€šè¿‡è¯¥å¯¹è±¡å¯ä»¥è·å–ä¸å®¢æˆ·ç«¯å…³è”çš„è¾“å‡ºæµå¹¶å‘å®¢æˆ·ç«¯å‘é€ä¿¡æ¯ã€‚</p>
<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.tcp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.SocketHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: webproject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TCPå®¢æˆ·ç«¯ç¨‹åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-03 13:01</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªSocketå¹¶è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡ç«¯</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getLocalHost(), <span class="number">7788</span>);</span><br><span class="line">        <span class="comment">//è·å–è¾“å…¥åˆ°æœ¬æœºçš„æ•°æ®ï¼Œå¹¶æ‰“å°ï¼Œç”¨readæ–¹æ³•</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> client.getInputStream();</span><br><span class="line">        <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> is.read(buf);</span><br><span class="line">        <span class="keyword">while</span>(len!=-<span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(buf, <span class="number">0</span>, len));</span><br><span class="line">            len = is.read(buf);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å…³é—­æµå’ŒSocketè¿æ¥</span></span><br><span class="line">        is.close();</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šï¼Œä¸€å°ä¸»æœºä¸¤ä¸ªç«¯å£åˆ†åˆ«æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ç­‰å¾…è¿æ¥ï¼Œå®¢æˆ·ç«¯è¿æ¥æˆåŠŸåï¼ŒæœåŠ¡ç«¯çŸ¥é“äº†è‡ªå·±è¾“å‡ºè¿æ¥æˆåŠŸã€‚ç„¶åæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯ä¼ è¾“æˆ‘æ˜¯æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯å¹¶æ²¡æœ‰å‘æœåŠ¡ç«¯ä¼ è¾“ã€‚æœåŠ¡ç«¯ â€“&gt; å®¢æˆ·ç«¯ã€‚   æœåŠ¡ç«¯éœ€è¦æŒ‡å®šç«¯å£å·ï¼Œå®¢æˆ·ç«¯éœ€è¦æŒ‡å®šè¦è¿æ¥çš„ç›®æ ‡çš„ipå’Œç«¯å£å·ï¼ˆå’ŒæœåŠ¡ç«¯ç«¯å£å·ä¸€æ ·ï¼‰ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦è‡ªå·±çš„ç«¯å£å·ï¼Ÿç³»ç»Ÿè‡ªå·±ç»™å®¢æˆ·ç«¯ç«¯å£ã€‚</p>
<p>ä»¥ä¸Šæ¶‰åŠåˆ°IOæ“ä½œã€‚</p>
<h3 id="å¤šçº¿ç¨‹çš„TCPç½‘ç»œç¨‹åº"><a href="#å¤šçº¿ç¨‹çš„TCPç½‘ç»œç¨‹åº" class="headerlink" title="å¤šçº¿ç¨‹çš„TCPç½‘ç»œç¨‹åº"></a>å¤šçº¿ç¨‹çš„TCPç½‘ç»œç¨‹åº</h3><p>ä¸Šé¢çš„å®ç°æ˜¯ï¼šä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºè¯·æ±‚æœåŠ¡å™¨ç«¯æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¼šç»“æŸé˜»å¡çŠ¶æ€ï¼Œå®Œæˆç¨‹åºçš„è¿è¡Œã€‚å®é™…ä¸Šï¼ŒæœåŠ¡å™¨ç«¯ç¨‹åºå…è®¸å¤šä¸ªåº”ç”¨ç¨‹åºè®¿é—®ï¼ŒæœåŠ¡å™¨ç«¯éƒ½æ˜¯å¤šçº¿ç¨‹çš„ã€‚</p>
<p>æœåŠ¡å™¨ç«¯ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Socketå¯¹è±¡ï¼Œå¹¶ä¸”å¼€å¯ä¸€ä¸ªæ–°çº¿ç¨‹ä½¿ä¸¤ä¸ªSocketå»ºç«‹ä¸“çº¿è¿›è¡Œé€šä¿¡ã€‚</p>
<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.threadtcp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: webproject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å¤šçº¿ç¨‹TCPæœåŠ¡ç«¯ç¨‹åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-03 20:06</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTCPServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºæŒ‡å®šç«¯å£å·çš„æœåŠ¡ç«¯ServerSocketå¯¹è±¡</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">7789</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//è°ƒç”¨acceptæ–¹æ³•å¼€å§‹æ¥æ”¶æ•°æ®</span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">client</span> <span class="operator">=</span> server.accept();</span><br><span class="line">            <span class="comment">//é’ˆå¯¹æ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè¿æ¥ç®¡ç†</span></span><br><span class="line">            <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> client.getPort();</span><br><span class="line">                    System.out.println(<span class="string">&quot;ä¸ç«¯å£å·ä¸º&quot;</span>+port+<span class="string">&quot;çš„å®¢æˆ·ç«¯è¿æ¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">                    <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> client.getOutputStream();</span><br><span class="line">                    <span class="comment">//å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œç”¨è¾“å‡ºæµï¼ˆä¸åº”è¯¥ç”¨æœåŠ¡ç«¯çš„è¾“å‡ºæµå—ï¼Ÿï¼‰</span></span><br><span class="line">                    os.write((<span class="string">&quot;æˆ‘æ˜¯æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å‘ä½ é—®å¥½ã€‚&quot;</span>).getBytes());</span><br><span class="line">                    <span class="comment">//æ¨¡æ‹Ÿäº¤äº’è€—æ—¶</span></span><br><span class="line">                    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;ç»“æŸä¸å®¢æˆ·ç«¯æ•°æ®äº¤äº’ã€‚&quot;</span>);</span><br><span class="line">                    <span class="comment">//å…³é—­æµå’ŒSocketè¿æ¥</span></span><br><span class="line">                    os.close();</span><br><span class="line">                    client.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//æ‰§è¡Œçº¿ç¨‹ç±»ï¼Œä¸å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®äº¤äº’</span></span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯ç¨‹åºæ²¡å˜ï¼Œæä¸‰ä¸ªå®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•ã€‚åŒæ ·åªæ˜¯æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚</p>
<h3 id="å°é¡¹ç›®-æ–‡ä»¶ä¸Šä¼ "><a href="#å°é¡¹ç›®-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å°é¡¹ç›®-æ–‡ä»¶ä¸Šä¼ "></a>å°é¡¹ç›®-æ–‡ä»¶ä¸Šä¼ </h3><p>å®ç°å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å›¾ç‰‡ï¼ŒæœåŠ¡ç«¯æ¥æ”¶å›¾ç‰‡å¹¶ä¿å­˜ã€‚ç•¥ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠJavaåŸºç¡€å…¥é—¨ã€‹ç±»ä¸é›†åˆ</title>
    <url>/2021/11/17/myblog/java/%E3%80%8AJava%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E3%80%8B%E7%B1%BB%E4%B8%8E%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[<h2 id="javaä¸­çš„å¸¸ç”¨ç±»"><a href="#javaä¸­çš„å¸¸ç”¨ç±»" class="headerlink" title="javaä¸­çš„å¸¸ç”¨ç±»"></a>javaä¸­çš„å¸¸ç”¨ç±»</h2><h3 id="Stringç±»"><a href="#Stringç±»" class="headerlink" title="Stringç±»"></a>Stringç±»</h3><p>Stringç±»çš„å‡ ç§åˆå§‹åŒ–æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>ä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡ç›´æ¥åˆå§‹åŒ–ä¸€ä¸ªStringå¯¹è±¡</span><br><span class="line"><span class="type">String</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="literal">null</span>;  åˆå§‹åŒ–ä¸ºç©º</span><br><span class="line"><span class="type">String</span> <span class="variable">ss</span> <span class="operator">=</span> â€œâ€;  åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²</span><br><span class="line"><span class="type">String</span> <span class="variable">ss</span> <span class="operator">=</span> â€œabcâ€;  åˆå§‹åŒ–ä¸ºabc</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>ä½¿ç”¨Stringçš„æ„é€ æ–¹æ³•åˆå§‹åŒ–å­—ç¬¦ä¸²å¯¹è±¡</span><br><span class="line"><span class="type">String</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>();  åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²</span><br><span class="line"><span class="type">String</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);  åˆå§‹åŒ–ä¸ºabc</span><br><span class="line"><span class="comment">//æ ¹æ®æŒ‡å®šå­—ç¬¦æ•°ç»„åˆ›å»ºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">char</span>[] ch = <span class="keyword">new</span> <span class="title class_">char</span>[]&#123;<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>&#125;;</span><br><span class="line"><span class="type">String</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(ch);</span><br></pre></td></tr></table></figure>

<p>Stringç±»åŸºæœ¬æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s=<span class="string">&quot;abcdefghigk&quot;</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š&quot;</span>+s.length());</span><br><span class="line"><span class="comment">//å­—ç¬¦ä¸²æ˜¯.length()ï¼Œæ•°ç»„æ˜¯.length</span></span><br><span class="line">System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²ç¬¬iä¸ªå­—ç¬¦ï¼š&quot;</span>+s.charAt(i));</span><br><span class="line">System.out.println(<span class="string">&quot;å­—ç¬¦cç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼š&quot;</span>+s.indexOf(<span class="string">&#x27;c&#x27;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;å­—ç¬¦cæœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼š&quot;</span>+s.lastIndexOf(<span class="string">&#x27;c&#x27;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;å­å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼š&quot;</span>+s.indexOf(<span class="string">&quot;ab&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;å­å­—ç¬¦ä¸²æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼š&quot;</span>+s.lastIndexOf(<span class="string">&quot;ab&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>å­—ç¬¦ä¸²çš„è½¬æ¢æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s=<span class="string">&quot;abcdefg&quot;</span>;</span><br><span class="line"><span class="comment">//å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„ï¼š</span></span><br><span class="line"><span class="type">char</span>[] ch=s.toCharArray();</span><br><span class="line">System.out.println(<span class="string">&quot;intå€¼è½¬æ¢ä¸ºstringç±»å‹ï¼š&quot;</span>+String.valueOf(<span class="number">100</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ï¼š&quot;</span>+s.toUpperCase());</span><br></pre></td></tr></table></figure>

<p>å­—ç¬¦ä¸²çš„æ›¿æ¢å’Œå»é™¤ç©ºæ ¼æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s=<span class="string">&quot;  a b &quot;</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;å»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯ç©ºæ ¼åçš„ç»“æœï¼š&quot;</span>+s.trim());</span><br><span class="line"><span class="comment">//ç”¨å­—ç¬¦ä¸²æ›¿æ¢æ“ä½œå®Œæˆå»é™¤ç©ºæ ¼</span></span><br><span class="line">System.out.println(<span class="string">&quot;å»é™¤å­—ç¬¦ä¸²æ‰€æœ‰ç©ºæ ¼åçš„ç»“æœï¼š&quot;</span>+s.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>replace()æ–¹æ³•æ˜¯å¯ä»¥æ›¿æ¢å­å­—ç¬¦ä¸²çš„ã€‚</p>
<p>å­—ç¬¦ä¸²çš„åˆ¤æ–­æ“ä½œï¼šè¿”å›booleanç±»å‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s=<span class="string">&quot;Starter&quot;</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ¤æ–­æ˜¯å¦ä»¥å­—ç¬¦ä¸²Stå¼€å¤´ï¼š&quot;</span>+s.startWith(<span class="string">&quot;St&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ¤æ–­æ˜¯å¦ä»¥å­—ç¬¦ä¸²erç»“å°¾ï¼š&quot;</span>+s.endWith(<span class="string">&quot;er&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ¤æ–­æ˜¯å¦åŒ…å«arï¼š&quot;</span>+s.contains(<span class="string">&quot;ar&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼š&quot;</span>+s.isEmpty());</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼š&quot;</span>+s.equals(<span class="string">&quot;St&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="å’Œequals"><a href="#å’Œequals" class="headerlink" title="&#x3D;&#x3D;å’Œequals()"></a>&#x3D;&#x3D;å’Œequals()</h4><p> &#x3D;&#x3D;å¯¹äºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ çš„ä½œç”¨æ•ˆæœæ˜¯ä¸åŒçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸åŒ</li>
<li>å¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å¼•ç”¨ï¼ˆå¯¹è±¡çš„å†…å­˜åœ°å€ï¼‰æ˜¯å¦ç›¸åŒï¼Œstringæ˜¯å¼•ç”¨ç±»å‹ã€‚</li>
</ul>
<p>equals æœ¬è´¨ä¸Šå°±æ˜¯ &#x3D;&#x3D;ï¼Œåªä¸è¿‡ String å’Œ Integer ç­‰é‡å†™äº† equals æ–¹æ³•ï¼Œ<strong>æŠŠå®ƒå˜æˆäº†å€¼æ¯”è¾ƒã€‚</strong></p>
<p>åœ¨Stringç±»ä¸­ï¼Œé‡å†™äº†çˆ¶ç±»Objectä¸­çš„equals()æ–¹æ³•ã€‚æŠŠå®ƒå˜æˆäº†<strong>å€¼æ¯”è¾ƒ</strong>ã€‚</p>
<p>&#x3D;&#x3D;å’Œequals()æ–¹æ³•ä¸åŒï¼Œequalsæ–¹æ³•ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦å€¼æ˜¯å¦ç›¸ç­‰ï¼Œ&#x3D;&#x3D;æ–¹æ³•ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">x</span> <span class="operator">=</span> <span class="string">&quot;string&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">y</span> <span class="operator">=</span> <span class="string">&quot;string&quot;</span>;</span><br><span class="line">x==y  (<span class="literal">true</span>)  x.equals(y)  (<span class="literal">true</span>)</span><br><span class="line"><span class="type">String</span> <span class="variable">z</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;string&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;string&quot;</span>);</span><br><span class="line">z==m  (<span class="literal">false</span>)  z.equals(m)  (<span class="literal">true</span>)</span><br><span class="line">x==z  (<span class="literal">false</span>)  x.equals(z)  (<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>å­—ç¬¦ä¸²çš„æˆªå–ä¸åˆ†å‰²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s=<span class="string">&quot;2021-11-11&quot;</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;æˆªå–ï¼š&quot;</span>+s.substring(<span class="number">5</span>));</span><br><span class="line"><span class="comment">//ç»“æœä¸º11-24  å·¦é—­å³å¼€åŸåˆ™ï¼Œä»ä¸‹æ ‡5å¼€å§‹æˆªå–</span></span><br><span class="line">System.out.println(<span class="string">&quot;æˆªå–ï¼š&quot;</span>+s.substring(<span class="number">5</span>,<span class="number">7</span>));</span><br><span class="line"><span class="comment">//ç»“æœä¸º11</span></span><br><span class="line">String[] sArray=s.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line"><span class="comment">//å°†å­—ç¬¦ä¸²æŒ‰ç…§æŸä¸ªå­—ç¬¦è¿›è¡Œåˆ†å‰²ï¼Œå˜ä¸ºå­—ç¬¦ä¸²æ•°ç»„</span></span><br></pre></td></tr></table></figure>

<p>javaä¸­ï¼ŒStringç±»æ˜¯finalç±»å‹çš„ï¼Œæ‰€ä»¥ä½¿ç”¨Stringç±»å®šä¹‰çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå®ƒä¸€æ—¦åˆ›å»ºï¼Œå†…å®¹å’Œé•¿åº¦ä¸å¯æ”¹å˜ã€‚</p>
<h3 id="StringBufferç±»"><a href="#StringBufferç±»" class="headerlink" title="StringBufferç±»"></a>StringBufferç±»</h3><p>ç±»ä¼¼ä¸€ä¸ªå­—ç¬¦å®¹å™¨ï¼Œåœ¨å…¶ä¸­æ·»åŠ å’Œåˆ é™¤å­—ç¬¦æ—¶ï¼Œæ“ä½œçš„éƒ½æ˜¯è¿™ä¸ªå­—ç¬¦å®¹å™¨ï¼Œä¸ä¼šäº§ç”Ÿæ–°çš„StringBufferå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StringBuffer sb=<span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">sb.append(<span class="string">&quot;abc&quot;</span>);   <span class="comment">//æ·»åŠ å­—ç¬¦ä¸²ï¼Œå§‹ç»ˆæ˜¯æ·»åŠ åˆ°ç¼“å†²åŒºçš„æœ«å°¾</span></span><br><span class="line">sb.insert(<span class="number">3</span>,<span class="string">&quot;de&quot;</span>);   <span class="comment">//åœ¨3çš„å‰é¢æ’å…¥ï¼Œå˜ä¸ºabcde</span></span><br><span class="line">sb.setCharAt(<span class="number">2</span>,<span class="string">&#x27;f&#x27;</span>);  <span class="comment">//ä¿®æ”¹æŒ‡å®šä½ç½®å­—ç¬¦ï¼Œå˜ä¸ºabfde</span></span><br><span class="line">sb.replace(<span class="number">3</span>,<span class="number">5</span>,<span class="string">&quot;gh&quot;</span>);  <span class="comment">//å·¦é—­å³å¼€æ›¿æ¢æŒ‡å®šä½ç½®å­—ç¬¦ä¸²æˆ–å­—ç¬¦</span></span><br><span class="line">System.out.println(sb.reverse());   <span class="comment">//å­—ç¬¦ä¸²ç¿»è½¬ç»“æœ</span></span><br><span class="line">sb.delete(<span class="number">3</span>,<span class="number">7</span>);   <span class="comment">//å·¦é—­å³å¼€åˆ é™¤</span></span><br><span class="line">sb.deleteCharAt(<span class="number">2</span>);   <span class="comment">//åˆ é™¤æŒ‡å®šä½ç½®å­—ç¬¦</span></span><br><span class="line">sb.delete(<span class="number">0</span>,sb.length());   <span class="comment">//æ¸…ç©ºç¼“å†²åŒº</span></span><br></pre></td></tr></table></figure>

<h3 id="Stringå’ŒStringBufferåŒºåˆ«"><a href="#Stringå’ŒStringBufferåŒºåˆ«" class="headerlink" title="Stringå’ŒStringBufferåŒºåˆ«"></a>Stringå’ŒStringBufferåŒºåˆ«</h3><p>ï¼ˆ1ï¼‰Stringç±»å®šä¹‰çš„å­—ç¬¦ä¸²æ˜¯å¸¸é‡ï¼Œä¸€æ—¦åˆ›å»ºåï¼Œå†…å®¹å’Œé•¿åº¦éƒ½æ˜¯æ— æ³•æ”¹å˜çš„ã€‚StringBufferç±»è¡¨ç¤ºå­—ç¬¦å®¹å™¨ï¼Œå…¶å†…å®¹å’Œé•¿åº¦å¯ä»¥éšæ—¶ä¿®æ”¹ã€‚</p>
<p>ï¼ˆ2ï¼‰Stringç±»é‡å†™äº†Objectç±»çš„equals()æ–¹æ³•ï¼Œè€ŒStringBufferç±»æ²¡æœ‰é‡å†™Objectç±»çš„equalsæ–¹æ³•ï¼Œä¾ç„¶è¡¨ç¤ºå†…å­˜åœ°å€ç›¸åŒï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s1=<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">String s2=<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">System.out.println(s1.equals(s2));   <span class="comment">//ç»“æœä¸ºtrue</span></span><br><span class="line"></span><br><span class="line">StringBuffer sb1=<span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">StringBuffer sb2=<span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">System.out.println(sb1.equals(sb2));   <span class="comment">//ç»“æœä¸ºfalse</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰Stringç±»å¯¹è±¡å¯ä»¥ç”¨æ“ä½œç¬¦+è¿›è¡Œè¿æ¥ï¼Œè€ŒStringBufferç±»å¯¹è±¡ä¹‹é—´ä¸èƒ½ã€‚</p>
<h3 id="StringBuilderç±»"><a href="#StringBuilderç±»" class="headerlink" title="StringBuilderç±»"></a>StringBuilderç±»</h3><p>é™¤äº†ä½¿ç”¨StringBufferå¤–ï¼ŒJDK1.5ä¹‹åæä¾›äº†StringBuilderç±»ï¼ŒåŒæ ·å¯ä»¥æ“ä½œå­—ç¬¦ä¸²ã€‚</p>
<p>ä¸åŒä¹‹å¤„åœ¨äºï¼ŒStringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒStringBuilderæ²¡æœ‰å®ç°çº¿ç¨‹å®‰å…¨åŠŸèƒ½ï¼Œæ‰€ä»¥æ€§èƒ½ç•¥é«˜ã€‚å› æ­¤ï¼Œä¸€èˆ¬åˆ›å»ºä¸€ä¸ªå†…å®¹å¯å˜çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘StringBuilderç±»ã€‚</p>
<p>StringBuilderç±»çš„æ–¹æ³•å’ŒStringBufferç±»ä¸€æ ·ã€‚</p>
<h3 id="Systemç±»"><a href="#Systemç±»" class="headerlink" title="Systemç±»"></a>Systemç±»</h3><p>Systemç±»å®šä¹‰äº†ä¸€äº›ä¸ç³»ç»Ÿç›¸å…³çš„å±æ€§å’Œæ–¹æ³•ï¼Œå®ƒæ‰€æä¾›çš„å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Systemç±»è¿›è¡Œè°ƒç”¨ï¼ˆä¸ç”¨åˆ›å»ºå¯¹è±¡è¿›è¡Œè°ƒç”¨ï¼‰ã€‚</p>
<h4 id="getProperties-æ–¹æ³•"><a href="#getProperties-æ–¹æ³•" class="headerlink" title="getProperties()æ–¹æ³•"></a>getProperties()æ–¹æ³•</h4><p>ç”¨äºè·å–å½“å‰ç³»ç»Ÿçš„å…¨éƒ¨å±æ€§ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªPropertieså¯¹è±¡ï¼Œå…¶ä¸­å°è£…äº†ç³»ç»Ÿçš„æ‰€æœ‰å±æ€§ï¼Œè¿™äº›å±æ€§ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜åœ¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemPropertiesDemo</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	    <span class="comment">//è·å–ç³»ç»Ÿæ‰€æœ‰å±æ€§</span></span><br><span class="line">		<span class="type">Properties</span> <span class="variable">pro</span> <span class="operator">=</span> System.getProperties();</span><br><span class="line">		<span class="comment">//è·å–æ‰€æœ‰ç³»ç»Ÿå±æ€§çš„keyï¼Œè¿”å›setå¯¹è±¡</span></span><br><span class="line">        Set&lt;String&gt;proName=pro.stringPropertyNames();</span><br><span class="line">        <span class="keyword">for</span>(String key:proName)&#123;</span><br><span class="line">            <span class="comment">//è·å–keyï¼ˆå±æ€§åï¼‰å¯¹åº”çš„å±æ€§å€¼</span></span><br><span class="line">            String value=System.getProperty(key);</span><br><span class="line">            System.out.println(key+<span class="string">&quot;-&gt;&quot;</span>+value);</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="currentTimeMillis"><a href="#currentTimeMillis" class="headerlink" title="currentTimeMillis()"></a>currentTimeMillis()</h4><p>currentTimeMillis()æ–¹æ³•è¿”å›ä¸€ä¸ªlongç±»å‹çš„å€¼ï¼Œè¡¨ç¤ºå½“å‰æ—¶é—´ä¸1970å¹´1æœˆ1æ—¥0ç‚¹0åˆ†0ç§’ä¹‹é—´çš„æ—¶é—´å·®ï¼Œå•ä½æ¯«ç§’ã€‚</p>
<h4 id="arraycopy-æ–¹æ³•"><a href="#arraycopy-æ–¹æ³•" class="headerlink" title="arraycopy()æ–¹æ³•"></a>arraycopy()æ–¹æ³•</h4><p>ç”¨äºå°†ä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ å¿«é€Ÿæ‹·è´åˆ°å¦ä¸€ä¸ªæ•°ç»„ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] a=&#123;<span class="number">101</span>,<span class="number">102</span>,<span class="number">103</span>,<span class="number">104</span>,<span class="number">105</span>,<span class="number">106</span>&#125;;  <span class="comment">//æºæ•°ç»„</span></span><br><span class="line"><span class="type">int</span>[] b=&#123;<span class="number">201</span>,<span class="number">202</span>,<span class="number">203</span>,<span class="number">204</span>,<span class="number">205</span>&#125;;   <span class="comment">//ç›®æ ‡æ•°ç»„</span></span><br><span class="line">System.arraycopy(a,<span class="number">2</span>,b,<span class="number">0</span>,<span class="number">4</span>);</span><br><span class="line"><span class="comment">//æœ€ç»ˆbå˜ä¸º103ï¼Œ104ï¼Œ105ï¼Œ106ï¼Œ205</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¾‹å­ä¸­ï¼Œä»aæ•°ç»„ç´¢å¼•ä¸º2çš„å…ƒç´ å¼€å§‹æ‹·è´ï¼Œå¹¶ä¸”æ‹·è´4ä¸ªå…ƒç´ å­˜æ”¾åœ¨ç›®æ ‡æ•°ç»„ä¸­ç´¢å¼•ä¸º0çš„ä½ç½®ã€‚</p>
<p>æ³¨æ„ï¼šè¿›è¡Œæ•°ç»„æ‹·è´æ—¶ï¼Œä¸€å®šè¦ä¿è¯æºæ•°ç»„ç±»å‹å’Œç›®æ ‡æ•°ç»„ç±»å‹ä¸€è‡´ï¼Œæˆªå–çš„é•¿åº¦ä¸èƒ½è¶…è¿‡æºæ•°ç»„ç•Œé™ï¼Œä¹Ÿä¸èƒ½è¶…è¿‡ç›®æ ‡æ•°ç»„å¯ä»¥å®¹çº³çš„ä¸ªæ•°ã€‚</p>
<h4 id="gc-æ–¹æ³•å’Œexit-int-status-æ–¹æ³•"><a href="#gc-æ–¹æ³•å’Œexit-int-status-æ–¹æ³•" class="headerlink" title="gc()æ–¹æ³•å’Œexit(int status)æ–¹æ³•"></a>gc()æ–¹æ³•å’Œexit(int status)æ–¹æ³•</h4><p>gc()æ–¹æ³•ç”¨äºå¯åŠ¨javaçš„åƒåœ¾å›æ”¶å™¨ï¼Œå¹¶å¯¹å†…å­˜ä¸­çš„åƒåœ¾å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚</p>
<p>exit(int status)ç”¨äºç»ˆæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„javaè™šæ‹Ÿæœºï¼Œå‚æ•°è¡¨ç¤ºå½“å‰å‘ç”Ÿçš„å¼‚å¸¸çŠ¶æ€ï¼Œä¸€èˆ¬æŒ‡å®š0ï¼Œè¡¨ç¤ºæ­£å¸¸é€€å‡ºï¼Œå¦åˆ™è¡¨ç¤ºå¼‚å¸¸ç»ˆæ­¢ã€‚</p>
<h3 id="Runtimeç±»"><a href="#Runtimeç±»" class="headerlink" title="Runtimeç±»"></a>Runtimeç±»</h3><p>Runtimeç±»ç”¨äºè¡¨ç¤ºJavaè™šæ‹Ÿæœºè¿è¡Œæ—¶çš„çŠ¶æ€ï¼Œç”¨äºå°è£…Javaè™šæ‹Ÿæœºè¿›ç¨‹ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è¯¥ç±»çš„å®ä¾‹å¯¹è±¡æ¥è·å–å½“å‰è™šæ‹Ÿæœºçš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>æ¯æ¬¡ä½¿ç”¨javaå‘½ä»¤å¯åŠ¨javaè™šæ‹Ÿæœºæ—¶éƒ½ä¼šå¯¹åº”ä¸€ä¸ªRuntimeå®ä¾‹ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œåº”ç”¨ç¨‹åºä¼šé€šè¿‡è¯¥å®ä¾‹ä¸å…¶è¿è¡Œæ—¶çš„ç¯å¢ƒç›¸è¿ã€‚åº”ç”¨ç¨‹åºä¸èƒ½åˆ›å»ºè‡ªå·±çš„Runtimeå®ä¾‹ï¼Œè‹¥æƒ³åœ¨ç¨‹åºä¸­è·å¾—ä¸€ä¸ªRuntimeå®ä¾‹ï¼Œå¯ä»¥é€šè¿‡getRuntime()æ–¹æ³•è·å–ä¸ä¹‹ç›¸å…³çš„Runtimeå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Runtime rt=Runtime.getRuntime(); <span class="comment">//è·å–javaç¨‹åºå…³è”çš„è¿è¡Œæ—¶å¯¹è±¡</span></span><br><span class="line">System.out.println(<span class="string">&quot;å¤„ç†å™¨ä¸ªæ•°ï¼š&quot;</span>+rt.availableProcessors()); <span class="comment">//å•ä½ä¸ª</span></span><br><span class="line">System.out.println(<span class="string">&quot;ç©ºé—²å†…å­˜å¤§å°ï¼š&quot;</span>+rt.freeMemory()); <span class="comment">//å•ä½å­—èŠ‚</span></span><br><span class="line">System.out.println(<span class="string">&quot;æœ€å¤§å¯ç”¨å†…å­˜å¤§å°ï¼š&quot;</span>+rt.maxMemory()); <span class="comment">//å•ä½å­—èŠ‚</span></span><br></pre></td></tr></table></figure>

<h4 id="exec-æ–¹æ³•"><a href="#exec-æ–¹æ³•" class="headerlink" title="exec()æ–¹æ³•"></a>exec()æ–¹æ³•</h4><p>è¯¥æ–¹æ³•ç”¨äºæ‰§è¡Œä¸€ä¸ªDOSå‘½ä»¤ï¼Œå®ç°å’Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥DOSå‘½ä»¤åŒæ ·çš„æ•ˆæœã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Runtime rt=Runtime.getRuntime();</span><br><span class="line">rt.exec(<span class="string">&quot;notepad.exe&quot;</span>)   <span class="comment">//æ‰“å¼€è®°äº‹æœ¬</span></span><br></pre></td></tr></table></figure>

<p>exec()æ–¹æ³•è¿”å›ä¸€ä¸ªProcesså¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šè¿‡Processå¯¹è±¡å¯å¯¹äº§ç”Ÿçš„æ–°è¿›ç¨‹è¿›è¡Œç®¡ç†ï¼Œå¦‚å…³é—­destroy()æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Runtime rt=Runtime.getRuntime();</span><br><span class="line"><span class="type">Process</span> <span class="variable">pr</span> <span class="operator">=</span> rt.exec(<span class="string">&quot;notepad.exe&quot;</span>)   <span class="comment">//æ‰“å¼€è®°äº‹æœ¬</span></span><br><span class="line"><span class="comment">//ç¨‹åºä¼‘çœ 3s</span></span><br><span class="line">Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">pr.destroy();   <span class="comment">//å…³é—­è¿›ç¨‹</span></span><br></pre></td></tr></table></figure>

<h3 id="Mathç±»"><a href="#Mathç±»" class="headerlink" title="Mathç±»"></a>Mathç±»</h3><p>Mathç±»æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œä¸»è¦ç”¨äºå®Œæˆå¤æ‚çš„æ•°å­¦è¿ç®—ï¼Œå¦‚æ±‚ç»å¯¹å€¼ï¼Œä¸‰è§’å‡½æ•°ï¼ŒæŒ‡æ•°è¿ç®—ç­‰ã€‚å…¶æ„é€ æ–¹æ³•è¢«å®šä¹‰ä¸ºprivateï¼Œå› æ­¤æ— æ³•åˆ›å»ºMathç±»çš„å¯¹è±¡ã€‚</p>
<p>Mathç±»çš„å¤šæœ‰æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åæ¥è°ƒç”¨å®ƒä»¬ã€‚</p>
<p>é™¤é™æ€æ–¹æ³•å¤–ï¼ŒMathç±»ä¸­è¿˜æœ‰ä¸¤ä¸ªé™æ€å¸¸é‡PIå’ŒEï¼Œåˆ†åˆ«è¡¨ç¤ºÎ å’Œeã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Math.abs(-1);</span><br><span class="line">Math.sin/tan/cos(2.0);</span><br><span class="line">Math.sqrt(4);  //æ±‚å¹³æ–¹æ ¹</span><br><span class="line">Math.cbrt(9);  //æ±‚ç«‹æ–¹æ ¹</span><br><span class="line">Math.pow(2,2);  //å¹‚æ¬¡è¿ç®—</span><br><span class="line">Math.ceil(1.2);  //å¤§äºå‚æ•°çš„æœ€å°æ•´æ•°ï¼Œè¿”å›doubleç±»å‹çš„æ•°</span><br><span class="line">Math.floor(1.2);  //å°äºå‚æ•°çš„æœ€å¤§æ•´æ•°ï¼Œè¿”å›doubleç±»å‹çš„æ•°</span><br><span class="line">Math.round(1.2);  //å››èˆäº”å…¥çš„æ•´æ•°ï¼Œè¿”å›intç±»å‹çš„æ•°</span><br><span class="line">Math.max(1,2);</span><br><span class="line">Math.min(1,2);</span><br><span class="line">Math.random();   //ç”Ÿæˆä¸€ä¸ªå¤§äºç­‰äº0.0å°äº1.0çš„éšæœºå€¼</span><br></pre></td></tr></table></figure>

<h3 id="Randomç±»"><a href="#Randomç±»" class="headerlink" title="Randomç±»"></a>Randomç±»</h3><p>åœ¨JDKçš„java.utilåŒ…ä¸­ï¼Œæœ‰ä¸€ä¸ªRandomç±»ï¼Œå¯ä»¥åœ¨æŒ‡å®šçš„å–å€¼èŒƒå›´å†…éšæœºäº§ç”Ÿæ•°å­—ã€‚</p>
<p>Randomç±»æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Random()   æ— å‚æ„é€ ï¼Œé€šè¿‡å®ƒåˆ›å»ºçš„Randomå®ä¾‹å¯¹è±¡æ¯æ¬¡ä½¿ç”¨çš„ç§å­éšæœºï¼Œå› æ­¤æ¯ä¸ªå¯¹è±¡æ‰€äº§ç”Ÿçš„éšæœºæ•°ä¸åŒã€‚</span><br><span class="line">Random(<span class="type">long</span> seed)  æœ‰å‚æ„é€ ï¼Œä½¿ç”¨ç§å­åˆ›å»ºä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå½“seedç›¸åŒæ—¶ï¼Œæ¯æ¬¡å®ä¾‹åŒ–Randomå¯¹è±¡ä¼šç”Ÿæˆç›¸åŒçš„éšæœºæ•°</span><br></pre></td></tr></table></figure>

<p>Randomç±»çš„å„ç§æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">r.nextBoolean()    éšæœºçš„<span class="type">boolean</span></span><br><span class="line">r.nextDouble()   <span class="type">double</span>ç±»å‹çš„éšæœºæ•°</span><br><span class="line">r.nextFloat()  <span class="type">float</span>ç±»å‹çš„éšæœºæ•°</span><br><span class="line">r.nextInt()   <span class="type">int</span>ç±»å‹çš„éšæœºæ•°</span><br><span class="line">r.nextInt(<span class="number">10</span>)  <span class="number">0</span>åˆ°<span class="number">10</span>ä¹‹é—´<span class="type">int</span>ç±»å‹çš„éšæœºæ•°</span><br><span class="line">r.nextLong()   <span class="type">long</span>å‹éšæœºæ•°</span><br></pre></td></tr></table></figure>

<h3 id="åŒ…è£…ç±»"><a href="#åŒ…è£…ç±»" class="headerlink" title="åŒ…è£…ç±»"></a>åŒ…è£…ç±»</h3><p>è™½ç„¶Javaæ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œä½†å®ƒæ‰€åŒ…å«çš„8ç§åŸºæœ¬æ•°æ®ç±»å‹å´ä¸æ”¯æŒé¢å‘å¯¹è±¡çš„ç¼–ç¨‹æœºåˆ¶ï¼ˆæ²¡æœ‰å±æ€§å’Œæ–¹æ³•ï¼‰ã€‚Javaä¹‹æ‰€ä»¥æä¾›è¿™8ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿å¸¸è§„æ•°æ®çš„å¤„ç†ã€‚ä½†æ˜¯åœ¨Javaç§ï¼Œå¾ˆå¤šç±»çš„æ–¹æ³•éƒ½éœ€è¦æ¥æ”¶å¼•ç”¨ç±»å‹çš„å¯¹è±¡ï¼Œæ­¤æ—¶å°±æ— æ³•å°†ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ä¼ å…¥ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒJDKæä¾›äº†ä¸€ç³»åˆ—çš„åŒ…è£…ç±»ï¼Œé€šè¿‡åŒ…è£…ç±»å¯ä»¥å°†åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼åŒ…è£…ä¸ºå¼•ç”¨æ•°æ®ç±»å‹çš„å¯¹è±¡ã€‚</p>
<table>
<thead>
<tr>
<th align="center">byte</th>
<th align="center">Byte</th>
</tr>
</thead>
<tbody><tr>
<td align="center">char</td>
<td align="center">Character</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">Integer</td>
</tr>
<tr>
<td align="center">short</td>
<td align="center">Short</td>
</tr>
<tr>
<td align="center">long</td>
<td align="center">Long</td>
</tr>
<tr>
<td align="center">float</td>
<td align="center">Float</td>
</tr>
<tr>
<td align="center">double</td>
<td align="center">Double</td>
</tr>
<tr>
<td align="center">boolean</td>
<td align="center">Boolean</td>
</tr>
</tbody></table>
<p>åŒ…è£…ç±»å’ŒåŸºæœ¬æ•°æ®ç±»å‹åœ¨è½¬æ¢æ—¶ï¼Œå¼•å…¥äº†è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±</p>
<p>è£…ç®±ï¼šå°†åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡èµ‹ç»™å¯¹åº”çš„åŒ…è£…ç±»å˜é‡ï¼ˆå¯¹è±¡ï¼‰ã€‚</p>
<p><code>int a=20;    Integer b=a;</code></p>
<p>æ‹†ç®±ï¼šå°†åŒ…è£…ç±»å¯¹è±¡ç±»å‹ç›´æ¥èµ‹ç»™ä¸€ä¸ªå¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹å˜é‡ã€‚</p>
<p><code>int c=b</code></p>
<p>æ­¤å¤–ï¼ŒJavaè¿˜æä¾›äº†å…¶ä»–æ–¹æ³•æ¥æ”¯æŒåŸºæœ¬æ•°æ®ç±»å‹ã€åŸºæœ¬æ•°æ®åŒ…è£…ç±»ä»¥åŠå­—ç¬¦ä¸²ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚</p>
<p>ï¼ˆ1ï¼‰Stringç±»çš„valueOf()æ–¹æ³•ï¼Œå°†å…«ç§åŸºæœ¬æ•°æ®ç±»å‹è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int num=123;</span><br><span class="line">String s=String.valueOf(num);</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰åŒ…è£…ç±»çš„valueOf()æ–¹æ³•ï¼Œæ—¢å¯ä»¥å®ç°è£…ç®±ï¼Œä¹Ÿå¯ä»¥å®ç°å°†å†…å®¹åŒ¹é…çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹åº”çš„åŒ…è£…ç±»ï¼ˆé™¤CharacteråŒ…è£…ç±»ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int num=123;</span><br><span class="line">Integer in=Integer.valueOf(num);</span><br><span class="line">String s=&quot;123&quot;;</span><br><span class="line">Integer in2=Integer.valueOf(s);</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰é€šè¿‡åŒ…è£…ç±»çš„æœ‰å‚æ„é€ æ–¹æ³•å°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºåŒ…è£…ç±»ï¼ˆè£…ç®±ï¼‰ï¼Œä¹Ÿå¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºåŒ…è£…ç±»ï¼ˆé™¤CharacteråŒ…è£…ç±»ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int num=123;</span><br><span class="line">Integer in=new Integer(num);</span><br><span class="line">String s=&quot;123&quot;;</span><br><span class="line">Integer in2=new Integer(s);</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰é€šè¿‡åŒ…è£…ç±»çš„é™æ€æ–¹æ³•parseXxx()æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String s=&quot;123&quot;;</span><br><span class="line">int num=Integer.parseInt(s);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‡¡æ˜¯ç±»å.æ–¹æ³•åçš„ï¼Œéƒ½æ˜¯é™æ€staticæ–¹æ³•</p>
</blockquote>
<p>ï¼ˆ5ï¼‰åŒ…è£…ç±»éƒ½é‡å†™äº†Objectç±»ä¸­çš„toStringæ–¹æ³•ï¼Œå°†åŒ…è£…ç±»è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Integer in=new Integer(123);</span><br><span class="line">//Integer in=Integer.valueOf(123);</span><br><span class="line">String s=in.toString();</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šåŒ…è£…ç±»çš„<code>valueOf(String s)</code>å’Œ<code>parseInt(String s)</code> ä¸­ï¼Œå‚æ•°sä¸èƒ½ä¸ºnullï¼Œè€Œä¸”éœ€è¦å’Œè§£æå¯¹åº”ã€‚</p>
<h3 id="Dateç±»"><a href="#Dateç±»" class="headerlink" title="Dateç±»"></a>Dateç±»</h3><p>JDKä¸­çš„java.utilåŒ…ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªDateç±»ç”¨æ¥è¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´ï¼Œè¯¥ç±»åœ¨JDK1.0æ—¶å·²ç»å¼€å§‹ä½¿ç”¨ã€‚JDK8ä¸­æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Date()  <span class="comment">//ç”¨æ¥åˆ›å»ºå½“å‰æ—¥æœŸæ—¶é—´çš„Dateå¯¹è±¡ã€‚</span></span><br><span class="line">Date date1=<span class="keyword">new</span> <span class="title class_">Date</span>();  <span class="comment">//Sat Jan 11:09:21 CST 2021</span></span><br><span class="line">Date(<span class="type">long</span> date)  <span class="comment">//ç”¨äºåˆ›å»ºæŒ‡å®šæ—¶é—´çš„Dateå¯¹è±¡ï¼Œdateæ˜¯1970.1.1.0.0.0ä»¥æ¥çš„æ¯«ç§’æ•°ï¼Œå³æ—¶é—´æˆ³</span></span><br><span class="line">Date date2=<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis()+<span class="number">1000</span>);</span><br><span class="line"><span class="comment">//Sat Jan 11:09:22 CST 2021</span></span><br></pre></td></tr></table></figure>

<h3 id="Calendarç±»"><a href="#Calendarç±»" class="headerlink" title="Calendarç±»"></a>Calendarç±»</h3><p>Calendarç±»ç”¨äºå®Œæˆæ—¥æœŸå’Œæ—¶é—´å­—æ®µçš„æ“ä½œï¼Œå¯ä»¥é€šè¿‡ç‰¹å®šæ–¹æ³•è®¾ç½®å’Œè¯»å–æ—¥æœŸçš„ç‰¹å®šéƒ¨åˆ†ã€‚</p>
<p>Calendarç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸å¯ä»¥è¢«å®ä¾‹åŒ–ï¼Œåœ¨ç¨‹åºä¸­éœ€è¦è°ƒç”¨é™æ€æ–¹æ³•getInstance()æ¥å¾—åˆ°ä¸€ä¸ªCalendarå¯¹è±¡ï¼Œç„¶åæ‰èƒ½è°ƒç”¨å…¶ç›¸åº”çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>ç–‘é—®ï¼ŸæŠ½è±¡ç±»åˆ›å»ºå¯¹è±¡ï¼Œè¿™æ˜¯ä»€ä¹ˆæ“ä½œï¼Ÿ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Calendar</span> <span class="variable">ca</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line"><span class="type">int</span> year=ca.get(Calendar.YEAR);</span><br><span class="line"><span class="type">int</span> month=ca.get(Calendar.MONTH)+<span class="number">1</span>;  <span class="comment">//æ³¨æ„æœˆä»½0-11ï¼Œéœ€è¦åŠ 1</span></span><br><span class="line"><span class="type">int</span> date=ca.get(Calendar.DATE);</span><br><span class="line"><span class="type">int</span> hour=ca.get(Calendar.HOUR);</span><br><span class="line"><span class="type">int</span> minute=ca.get(Calendar.MINUTE);</span><br><span class="line"><span class="type">int</span> second=ca.get(Calendar.SECOND);</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ å’Œä¿®æ”¹æ—¶é—´çš„åŠŸèƒ½å¯ä»¥é€šè¿‡addå’Œsetæ–¹æ³•å®ç°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Calendar ca = Calendar.getInstance();</span><br><span class="line">ca.set(2021.11.11);   //è®¾ç½®æŒ‡å®šæ—¥æœŸ</span><br><span class="line">ca.add(Calendar.DATE,100);  //ä¸ºæŒ‡å®šæ—¥æœŸå¢åŠ æ—¶é—´</span><br><span class="line">è¾“å‡ºæ—¶é—´ä¾ç„¶éœ€è¦ç”¨getæ–¹æ³•æ¥è·å–å¹´æœˆæ—¥ã€‚</span><br></pre></td></tr></table></figure>

<p>Calendaræœ‰ä¸¤ç§è§£é‡Šæ—¥å†å­—æ®µçš„æ¨¡å¼ï¼Œå®¹é”™æ¨¡å¼å’Œéå®¹é”™æ¨¡å¼ï¼Œå®¹é”™æ¨¡å¼ä¸‹ï¼Œæœˆæ˜¯12æ˜¯å¯ä»¥æ¥å—çš„ã€‚é»˜è®¤å®¹é”™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Calendar ca = Calendar.getInstance();</span><br><span class="line">ca.set(Calendar.MONTH, 13);  //ä¸ä¼šæŠ¥é”™</span><br><span class="line">//å¼€å¯non-lenientéå®¹é”™æ¨¡å¼</span><br><span class="line">ca.setLenient(false);</span><br><span class="line">ca.set(Calendar.MONTH, 13);  //ä¼šæŠ¥é”™</span><br></pre></td></tr></table></figure>

<p>Dateå’ŒCalendarå¯¹è±¡ä¹‹é—´çš„è½¬åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">System.out.println(ca.getTime());  //Calendarçš„getTimeæ–¹æ³•è¿”å›ä¸€ä¸ªè¡¨ç¤ºCalendaræ—¶é—´å€¼çš„Dateå¯¹è±¡ã€‚</span><br><span class="line">setTime(Date date)</span><br><span class="line">Calendar ca = setTime(date);  //Calendarçš„setTimeæ–¹æ³•æ¥æ”¶ä¸€ä¸ªDateå¯¹è±¡ï¼Œå°†Dateå¯¹è±¡è¡¨ç¤ºçš„æ—¶é—´å€¼è®¾ç½®ç»™Calendarå¯¹è±¡ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="JDK8çš„æ—¥æœŸå’Œæ—¶é—´ç±»"><a href="#JDK8çš„æ—¥æœŸå’Œæ—¶é—´ç±»" class="headerlink" title="JDK8çš„æ—¥æœŸå’Œæ—¶é—´ç±»"></a>JDK8çš„æ—¥æœŸå’Œæ—¶é—´ç±»</h3><p>ä¸ºäº†æ»¡è¶³æ›´å¤šçš„éœ€æ±‚ï¼ŒJDK8æ¯”ä¹‹å‰çš„ç‰ˆæœ¬å¢åŠ äº†ä¸€ä¸ªjava.timeåŒ…ï¼Œåœ¨è¯¥åŒ…ä¸‹åŒ…å«äº†æ›´å¤šæ—¥æœŸå’Œæ—¶é—´æ“ä½œç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>ã€Clockç±»</span><br><span class="line"><span class="type">Clock</span> <span class="variable">cl</span> <span class="operator">=</span> Clock.systemUTC();</span><br><span class="line">è·å–UTCæ—¶åŒºè½¬æ¢çš„å½“å‰æ—¶é—´ï¼š cl.instance()</span><br><span class="line">è·å–UTCæ—¶åŒºè½¬æ¢çš„æ¯«ç§’æ•°ï¼š cl.millis()</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>Durationç±»</span><br><span class="line"><span class="type">Duration</span> <span class="variable">du</span> <span class="operator">=</span> Duration.ofDays(<span class="number">1</span>);</span><br><span class="line">ä¸€å¤©ç­‰äºå¤šå°‘å°æ—¶ï¼š  du.toHours()</span><br><span class="line">ä¸€å¤©ç­‰äºå¤šå°‘åˆ†é’Ÿï¼š  du.toMinutes()</span><br><span class="line">ä¸€å¤©ç­‰äºå¤šå°‘ç§’ï¼š  du.toMillis()</span><br><span class="line">    </span><br><span class="line"><span class="number">3.</span>Instantç±»</span><br><span class="line"><span class="type">Instant</span> <span class="variable">in</span> <span class="operator">=</span> Instant.now();</span><br><span class="line">UTCæ—¶åŒºçš„å½“å‰æ—¶é—´ï¼šin</span><br><span class="line">å½“å‰æ—¶é—´ä¸€å°æ—¶åçš„æ—¶é—´ï¼šin.plusSeconds(<span class="number">3600</span>)</span><br><span class="line">å½“å‰æ—¶é—´ä¸€å°æ—¶å‰çš„æ—¶é—´ï¼šin.minusSeconds(<span class="number">3600</span>)</span><br><span class="line">    </span><br><span class="line"><span class="number">4.</span>LocalDate</span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">lo</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">ä»é»˜è®¤æ—¶åŒºçš„ç³»ç»Ÿæ—¶é’Ÿè·å¾—å½“å‰æ—¥æœŸï¼šlo</span><br><span class="line">    </span><br><span class="line"><span class="number">5.</span>LocalTime</span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">lo</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">ä»é»˜è®¤æ—¶åŒºçš„ç³»ç»Ÿæ—¶é’Ÿè·å¾—å½“å‰æ—¶é—´ï¼šlo</span><br><span class="line">    </span><br><span class="line"><span class="number">6.</span>LocalDateTime</span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">lo</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">ä»é»˜è®¤æ—¶åŒºçš„ç³»ç»Ÿæ—¶é’Ÿè·å¾—å½“å‰æ—¥æœŸå’Œæ—¶é—´ï¼šlo</span><br><span class="line">å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´åŠ ä¸Š<span class="number">1</span>å¤©<span class="number">3</span>å°æ—¶<span class="number">30</span>åˆ†é’Ÿï¼š</span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalDateTime.plusDays(<span class="number">1</span>).plusHours(<span class="number">3</span>).plusMinutes(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>Yearã€YearMonthã€MonthDay</span><br><span class="line">å½“å‰å¹´ä»½ï¼š<span class="type">Year</span> <span class="variable">ye</span> <span class="operator">=</span> Year.now();</span><br><span class="line">å½“å‰å¹´æœˆï¼š<span class="type">YearMonth</span> <span class="variable">ym</span> <span class="operator">=</span> YearMonth.now();</span><br><span class="line">å½“å‰æœˆæ—¥ï¼š<span class="type">MonthDay</span> <span class="variable">md</span> <span class="operator">=</span> MonthDay.now();</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span>è·å–ç³»ç»Ÿé»˜è®¤æ—¶åŒº</span><br><span class="line"><span class="type">ZoneId</span> <span class="variable">zi</span> <span class="operator">=</span> ZoneId.systemDefault();</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œclock.instant()å’ŒInstant.now()è·å–çš„æ—¶é—´éƒ½æ˜¯é»˜è®¤ä½¿ç”¨UTCæ—¶åŒºï¼ˆä¸–ç•Œåè°ƒæ—¶é—´ï¼Œä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼‰ï¼Œæ¯”ä¸­å›½æ ‡å‡†æ—¶é—´CSTæ—©å…«å°æ—¶ã€‚</p>
<h3 id="æ ¼å¼åŒ–ç±»"><a href="#æ ¼å¼åŒ–ç±»" class="headerlink" title="æ ¼å¼åŒ–ç±»"></a>æ ¼å¼åŒ–ç±»</h3><h4 id="DateFormatç±»"><a href="#DateFormatç±»" class="headerlink" title="DateFormatç±»"></a>DateFormatç±»</h4><p>ä½¿ç”¨Dateç±»æ—¶ï¼Œç¨‹åºæ‰“å°Dateå¯¹è±¡æ‰€è¾“å‡ºçš„å½“å‰æ—¶é—´éƒ½æ˜¯è‹±æ–‡æ ¼å¼è¾“å‡ºçš„ï¼Œè¦æƒ³ä»¥ä¸­æ–‡çš„æ ¼å¼è¾“å‡ºï¼Œå°±éœ€è¦DateFormatç±»ã€‚</p>
<p>DateFormatç±»ä¸“é—¨ç”¨äºå°†æ—¥æœŸæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²æˆ–è€…å°†ç”¨ç‰¹å®šæ ¼å¼æ˜¾ç¤ºçš„æ—¥æœŸå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªDateå¯¹è±¡ã€‚</p>
<p>DateFormatç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½è¢«ç›´æ¥å®ä¾‹åŒ–ï¼Œä½†å®ƒæä¾›äº†ä¸€ç³»åˆ—çš„é™æ€æ–¹æ³•æ¥è·å–DateFormatç±»çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶èƒ½è°ƒç”¨å…¶ä»–ç›¸åº”çš„æ–¹æ³•è¿›è¡Œæ“ä½œã€‚</p>
<p>å®šä¹‰äº†å››ç§é™æ€æ–¹æ³•ç”¨äºè·å–DateFormatç±»çš„å®ä¾‹å¯¹è±¡ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹æ—¥æœŸæˆ–è€…æ—¶é—´éƒ¨åˆ†è¿›è¡Œæ ¼å¼åŒ–ã€‚</p>
<blockquote>
<p>ç–‘é—®ã€‚</p>
</blockquote>
<p>åœ¨DateFormatç±»ä¸­è¿˜å®šä¹‰äº†è®¸å¤šå¸¸é‡ï¼Œå…¶ä¸­å››ä¸ªå¸¸é‡å€¼æ˜¯ç”¨äºä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•çš„ï¼ŒåŒ…æ‹¬FULLã€LONGã€MEDIUMã€SHORTã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºDateå¯¹è±¡</span></span><br><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="comment">//1.å½“å‰æ—¥æœŸçš„å®Œæ•´æ ¼å¼å¯¹è±¡</span></span><br><span class="line"><span class="comment">//é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">fullFormat</span> <span class="operator">=</span> DateFormat.getDateInstance(DateFormat.FULL);</span><br><span class="line"><span class="comment">//formatå°†ä¸€ä¸ªDateæ ¼å¼åŒ–ä¸ºæ—¥æœŸ/æ—¶é—´å­—ç¬¦ä¸²</span></span><br><span class="line">System.out.println(fullFormat.format(date));</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.å½“å‰æ—¥æœŸçš„é•¿æ ¼å¼å¯¹è±¡</span></span><br><span class="line"><span class="comment">//é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">longFormat</span> <span class="operator">=</span> DateFormat.getDateInstance(DateFormat.LONG);</span><br><span class="line"><span class="comment">//formatå°†ä¸€ä¸ªDateæ ¼å¼åŒ–ä¸ºæ—¥æœŸ/æ—¶é—´å­—ç¬¦ä¸²</span></span><br><span class="line">System.out.println(longFormat.format(date));</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.å½“å‰æ—¥æœŸæ—¶é—´çš„æ™®é€šæ ¼å¼å¯¹è±¡</span></span><br><span class="line"><span class="comment">//é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">mediumFormat</span> <span class="operator">=</span> DateFormat.getDateTimeInstance(DateFormat.MEDIUM);</span><br><span class="line"><span class="comment">//formatå°†ä¸€ä¸ªDateæ ¼å¼åŒ–ä¸ºæ—¥æœŸ/æ—¶é—´å­—ç¬¦ä¸²</span></span><br><span class="line">System.out.println(mediumFormat.format(date));</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.å½“å‰æ—¥æœŸæ—¶é—´çš„çŸ­æ ¼å¼å¯¹è±¡</span></span><br><span class="line"><span class="comment">//é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">shortFormat</span> <span class="operator">=</span> DateFormat.getDateTimeInstance(DateFormat.SHORT);</span><br><span class="line"><span class="comment">//formatå°†ä¸€ä¸ªDateæ ¼å¼åŒ–ä¸ºæ—¥æœŸ/æ—¶é—´å­—ç¬¦ä¸²</span></span><br><span class="line">System.out.println(shortFormat.format(date));</span><br></pre></td></tr></table></figure>

<p>DateFormatç±»ä¸­è¿˜æœ‰parse(String source)æ–¹æ³•ï¼Œèƒ½å¤Ÿå°†ä¸€ä¸ªå­—ç¬¦ä¸²è§£æä¸ºDateå¯¹è±¡ï¼Œä½†æ˜¯å®ƒè¦æ±‚å­—ç¬¦ä¸²å¿…é¡»ç¬¦åˆæ—¥æœŸ&#x2F;æ—¶é—´çš„æ ¼å¼è¦æ±‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºæ™®é€šæ ¼å¼çš„DateFormatå¯¹è±¡</span></span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">dt1</span> <span class="operator">=</span> DateFormat.getDateInstance();</span><br><span class="line"><span class="comment">//åˆ›å»ºLongæ ¼å¼çš„DateFormatå¯¹è±¡</span></span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">dt2</span> <span class="operator">=</span> DateFormat.getDateInstance(DateFormat.LONG);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰æ—¥æœŸæ ¼å¼çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;2021-11-11&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;2021å¹´11æœˆ11æ—¥&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡ºå¯¹åº”æ ¼å¼çš„å­—ç¬¦ä¸²è§£æä¸ºDateå¯¹è±¡åçš„ç»“æœ</span></span><br><span class="line">System.out.println(dt1.parse(s1));</span><br><span class="line">System.out.println(dt2.parse(s2));</span><br></pre></td></tr></table></figure>

<h4 id="SimpleDateFormatç±»"><a href="#SimpleDateFormatç±»" class="headerlink" title="SimpleDateFormatç±»"></a>SimpleDateFormatç±»</h4><p>DateFormatç±»ä¸­parseæ–¹æ³•å°†å­—ç¬¦ä¸²è§£æä¸ºæ—¥æœŸæ—¶ï¼Œéœ€è¦å›ºå®šæ ¼å¼ï¼Œä¸çµæ´»ã€‚</p>
<p>SimpleDateFormatç±»æ˜¯DateFormatç±»çš„å­ç±»ï¼Œå¯ä»¥ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå®ä¾‹å¯¹è±¡ã€‚åœ¨åˆ›å»ºå®ä¾‹å¯¹è±¡æ—¶ï¼Œæ„é€ æ–¹æ³•éœ€è¦æ¥æ”¶ä¸€ä¸ªè¡¨ç¤ºæ—¥æœŸæ ¼å¼æ¨¡æ¿çš„å­—ç¬¦ä¸²å‚æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;Gyyyyå¹´MMæœˆddæ—¥ï¼šä»Šå¹´æ—¶yyyyå¹´çš„ç¬¬Då¤©ï¼Œæ˜ŸæœŸï¼šE&quot;</span>);    <span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="comment">//æŒ‰SimpleDateFormatå¯¹è±¡çš„æ—¥æœŸæ¨¡æ¿æ ¼å¼åŒ–Dateå¯¹è±¡</span></span><br><span class="line">System.out.println(sdf.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢æ˜¯å°†ä¸€ä¸ªDateæ—¶é—´å¯¹è±¡è½¬æ¢ä¸ºæŒ‡å®šæ ¼å¼å­—ç¬¦ä¸²å½¢å¼ã€‚</p>
<p>SimpleDateFormatç±»ä¹Ÿå¯ä»¥å°†ä¸€ä¸ªæŒ‡å®šæ ¼å¼å­—ç¬¦ä¸²è§£æä¸ºDateå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy/MM/dd&quot;</span>);    <span class="comment">//åˆ›å»ºå¯¹è±¡,å¹¶æŒ‡å®šæ—¥æœŸæ ¼å¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;2021/11/11&quot;</span>;</span><br><span class="line"><span class="comment">//å°†å­—ç¬¦ä¸²è§£æä¸ºDateå¯¹è±¡</span></span><br><span class="line">System.out.println(sdf.parse(s));</span><br></pre></td></tr></table></figure>

<h4 id="DateTimeFormatterç±»"><a href="#DateTimeFormatterç±»" class="headerlink" title="DateTimeFormatterç±»"></a>DateTimeFormatterç±»</h4><p>é™¤DateFormatç±»ä»¥åŠSimpleDateFormatç±»ï¼ŒJDK8åœ¨java.time.formatåŒ…ä¸‹è¿˜æä¾›äº†ä¸€ä¸ªDateTimeFormatterç±»ï¼Œè¯¥ç±»ä¹Ÿæ˜¯æ ¼å¼åŒ–ç±»ï¼Œç›¸å½“äºDateFormatç±»ä»¥åŠSimpleDateFormatç±»çš„åˆä½“ï¼Œå®ƒä¸ä»…å¯ä»¥å°†æ—¥æœŸæ—¶é—´ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥å°†å­—ç¬¦ä¸²è§£ææˆæ—¥æœŸã€æ—¶é—´å¯¹è±¡ã€‚</p>
<p>1.å­—ç¬¦ä¸²è½¬æ¢æˆæ—¥æœŸæ—¶é—´ç±»å‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testStringT0LocalDate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// String --&gt; LocalDate</span></span><br><span class="line">        <span class="comment">//ä½¿ç”¨æ¨¡å¼å­—ç¬¦ä¸²åˆ›å»ºDateTimeFormatteræ ¼å¼å™¨</span></span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">localDate</span> <span class="operator">=</span> LocalDate.parse(<span class="string">&quot;2019-12-07&quot;</span>);</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€<span class="type">DateTimeFormatter</span> <span class="variable">pattern</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyå¹´MMæœˆddæ—¥&quot;</span>);		ã€€ã€€ã€€ã€€ã€€ã€€    </span><br><span class="line">ã€€ã€€ã€€ã€€ã€€System.out.println(LocalDate.parse(<span class="string">&quot;2019-10-09&quot;</span>).format(pattern));</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€</span><br><span class="line">        <span class="comment">// String --&gt; LocalTime</span></span><br><span class="line">        <span class="type">LocalTime</span> <span class="variable">localTime</span> <span class="operator">=</span> LocalTime.parse(<span class="string">&quot;07:43:53&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// String --&gt;LocalDateTime</span></span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>); <span class="comment">// 12å°æ—¶</span></span><br><span class="line">ã€€ã€€ã€€ã€€ <span class="type">DateTimeFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>); <span class="comment">// 24å°æ—¶              LocalDate localDate = LocalDate.parse(&quot;2019-12-07 07:43:53&quot;,formatter);</span></span><br><span class="line">        </span><br><span class="line">        System.out.println(localDate);</span><br><span class="line">        System.out.println(localTime);</span><br><span class="line">        System.out.println(localDate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.æ—¥æœŸæ—¶é—´ç±»å‹è½¬æ¢æˆå­—ç¬¦ä¸²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testLocalDateToString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//localDate --&gt; String </span></span><br><span class="line">        <span class="comment">//ä½¿ç”¨å¸¸é‡åˆ›å»ºDateTimeFormatte</span></span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">localDate</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">        <span class="type">String</span> <span class="variable">format1</span> <span class="operator">=</span> localDate.format(DateTimeFormatter.BASIC_ISO_DATE);    <span class="comment">//yyyyMMdd</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">format2</span> <span class="operator">=</span> localDate.format(DateTimeFormatter.ISO_DATE);            <span class="comment">//yyyy-MM-dd</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2.LocalTime  --&gt; String</span></span><br><span class="line">        <span class="type">LocalTime</span> <span class="variable">localTime</span> <span class="operator">=</span> LocalTime.now();</span><br><span class="line">        <span class="type">String</span> <span class="variable">format3</span> <span class="operator">=</span> localTime.format(DateTimeFormatter.ISO_TIME);            <span class="comment">//20:19:22.42</span></span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;hh:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">format4</span> <span class="operator">=</span> localTime.format(formatter);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3.LocalDateTime  --&gt; String        </span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">localDateTime</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">formatter2</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">format5</span> <span class="operator">=</span> localDateTime.format(formatter2);</span><br><span class="line">        </span><br><span class="line">        System.out.println(format1);</span><br><span class="line">        System.out.println(format2);</span><br><span class="line">        System.out.println(format3);</span><br><span class="line">        System.out.println(format4);</span><br><span class="line">        System.out.println(format5);     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h2><p>æ•°ç»„çš„é•¿åº¦ä¸å¯å˜ï¼Œå› æ­¤ä¸ºäº†ä¿å­˜æ•°ç›®ä¸ç¡®å®šçš„å¯¹è±¡ï¼ŒJavaæä¾›äº†ä¸€ç³»åˆ—ç‰¹æ®Šçš„ç±»ï¼Œç»Ÿç§°é›†åˆï¼Œé›†åˆå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”é•¿åº¦å¯å˜ã€‚</p>
<h3 id="é›†åˆæ¦‚è¿°"><a href="#é›†åˆæ¦‚è¿°" class="headerlink" title="é›†åˆæ¦‚è¿°"></a>é›†åˆæ¦‚è¿°</h3><p>Javaä¸­çš„é›†åˆå°±åƒä¸€ä¸ªå®¹å™¨ï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨Javaå¯¹è±¡ï¼ˆå®é™…ä¸Šæ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼‰ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥æ˜¯ä»»æ„çš„æ•°æ®ç±»å‹ï¼Œå¹¶ä¸”é•¿åº¦å¯å˜ã€‚è¿™äº›é›†åˆç±»éƒ½ä½äºjava.utilåŒ…ä¸­ã€‚</p>
<p>é›†åˆç±»æŒ‰ç…§å…¶å­˜å‚¨ç»“æ„å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šå•åˆ—é›†åˆCollectionï¼ŒåŒåˆ—é›†åˆMapã€‚</p>
<p>ï¼ˆ1ï¼‰Collectionï¼šå•åˆ—é›†åˆçš„æ ¹æ¥å£ï¼Œç”¨äºå­˜å‚¨ä¸€ç³»åˆ—ç¬¦åˆæŸç§è§„å¾‹çš„å…ƒç´ ã€‚Collectioné›†åˆæœ‰ä¸¤ä¸ªé‡è¦çš„å­æ¥å£ï¼Œåˆ†åˆ«æ˜¯Listå’ŒSetã€‚Listé›†åˆç‰¹ç‚¹ï¼šå…ƒç´ æœ‰åºï¼Œå¯é‡å¤ã€‚Seté›†åˆç‰¹ç‚¹ï¼šå…ƒç´ æ— åºï¼Œä¸å¯é‡å¤ã€‚Listæ¥å£çš„ä¸»è¦å®ç°ç±»ï¼šArrayListã€LinkedListã€‚Setæ¥å£çš„ä¸»è¦å®ç°ç±»ï¼šHashSetã€TreeSetã€‚</p>
<p>ï¼ˆ2ï¼‰Mapï¼šåŒåˆ—é›†åˆçš„æ ¹æ¥å£ï¼Œç”¨äºå­˜å‚¨å…·æœ‰é”®å€¼æ˜ å°„å…³ç³»çš„å…ƒç´ ã€‚Mapæ¥å£çš„ä¸»è¦å®ç°ç±»ï¼šHashMapã€TreeMapã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/2017af8f90a9dff713a5fa908b990a05.png" alt="image-20211113111401531"></p>
<p>è™šçº¿æ˜¯æ¥å£ç±»å‹ï¼Œå®çº¿æ˜¯å®ç°ç±»ã€‚</p>
<h3 id="Listæ¥å£"><a href="#Listæ¥å£" class="headerlink" title="Listæ¥å£"></a>Listæ¥å£</h3><p>Listæ¥å£ç»§æ‰¿è‡ªCollectionæ¥å£ï¼Œæ˜¯å•åˆ—é›†åˆçš„ä¸€ä¸ªé‡è¦åˆ†æ”¯ï¼Œä¹ æƒ¯æ€§åœ°å°†å®ç°äº†Listæ¥å£çš„å¯¹è±¡ç§°ä¸ºListé›†åˆã€‚</p>
<p>åœ¨Listé›†åˆä¸­<strong>å…è®¸å‡ºç°é‡å¤</strong>çš„å…ƒç´ ï¼Œæ‰€æœ‰çš„å…ƒç´ ä»¥ä¸€ç§çº¿æ€§æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œåœ¨ç¨‹åºä¸­å¯ä»¥é€šè¿‡ç´¢å¼•æ¥è®¿é—®é›†åˆä¸­çš„æŒ‡å®šå…ƒç´ ï¼Œå¦å¤–ï¼ŒListé›†åˆ<strong>å…ƒç´ æœ‰åº</strong>ï¼Œå³å…ƒç´ çš„å­˜å…¥é¡ºåºå’Œå–å‡ºé¡ºåºä¸€è‡´ã€‚</p>
<h4 id="ArrayListé›†åˆ"><a href="#ArrayListé›†åˆ" class="headerlink" title="ArrayListé›†åˆ"></a>ArrayListé›†åˆ</h4><p>ArrayListæ˜¯ç¨‹åºä¸­æœ€å¸¸è§çš„ä¸€ç§é›†åˆã€‚åœ¨ArrayListå†…éƒ¨å°è£…äº†ä¸€ä¸ªé•¿åº¦å¯å˜çš„æ•°ç»„å¯¹è±¡ï¼Œå½“å­˜å…¥çš„å…ƒç´ è¶…è¿‡æ•°ç»„é•¿åº¦æ—¶ï¼ŒArrayListä¼šåœ¨å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„æ¥å­˜å‚¨è¿™äº›å…ƒç´ ï¼Œå› æ­¤ArrayListå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªé•¿åº¦å¯å˜çš„æ•°ç»„ã€‚</p>
<p>æ­£æ˜¯ç”±äºArrayListå†…éƒ¨çš„æ•°æ®å­˜å‚¨ç»“æ„æ˜¯æ•°ç»„å½¢å¼ï¼Œåœ¨å¢åŠ å’Œåˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ æ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„æ•°ç»„ï¼Œæ•ˆç‡æ¯”è¾ƒä½ï¼Œå› æ­¤ä¸é€‚åˆåšå¤§é‡çš„å¢åˆ æ“ä½œã€‚ä½†æ˜¯åœ¨éå†å’ŒæŸ¥æ‰¾å…ƒç´ æ—¶æ˜¾å¾—éå¸¸é«˜æ•ˆã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºArrayListé›†åˆ</span></span><br><span class="line"><span class="type">ArrayList</span> <span class="variable">lis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">lis.add(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">lis.add(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">é•¿åº¦ï¼š lis.size();</span><br><span class="line">æŸ¥è¯¢ï¼š lis.get(i);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨ArrayListé›†åˆæ—¶å¹¶æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šé›†åˆä¸­å­˜å‚¨ä»€ä¹ˆç±»å‹çš„å…ƒç´ ï¼Œä¼šäº§ç”Ÿå®‰å…¨éšæ‚£ï¼Œæ¶‰åŠåˆ°æ³›å‹å®‰å…¨æœºåˆ¶çš„é—®é¢˜ã€‚</p>
<h4 id="LinkedListé›†åˆ"><a href="#LinkedListé›†åˆ" class="headerlink" title="LinkedListé›†åˆ"></a>LinkedListé›†åˆ</h4><p>ArrayListæŸ¥è¯¢æ—¶é€Ÿåº¦å¾ˆå¿«ï¼Œå¢åˆ æ—¶æ•ˆç‡è¾ƒä½ï¼Œå› æ­¤å¦ä¸€ä¸ªå®ç°ç±»ï¼šLinkedListã€‚</p>
<p>è¯¥é›†åˆå†…éƒ¨åŒ…å«ä¸¤ä¸ªNodeç±»å‹çš„firstå’Œlastå±æ€§ç»´æŠ¤ä¸€ä¸ªåŒå‘å¾ªç¯é“¾è¡¨ï¼Œé“¾è¡¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä½¿ç”¨å¼•ç”¨çš„æ–¹å¼è®°ä½å®ƒçš„å‰ä¸€ä¸ªå…ƒç´ å’Œåä¸€ä¸ªå…ƒç´ ï¼Œä»è€Œå¯ä»¥å°†æ‰€æœ‰çš„å…ƒç´ å½¼æ­¤è¿æ¥èµ·æ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">LinkedList</span> <span class="variable">lik</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">lik.add(<span class="string">&quot;bb&quot;</span>);   <span class="comment">//æ·»åŠ å…ƒç´ </span></span><br><span class="line">lik.add(<span class="string">&quot;cc&quot;</span>);</span><br><span class="line">lik.offer(<span class="string">&quot;dd&quot;</span>);  <span class="comment">//å‘é›†åˆå°¾éƒ¨è¿½åŠ å…ƒç´ </span></span><br><span class="line">lik.push(<span class="string">&quot;aa&quot;</span>);  <span class="comment">//å‘é›†åˆå¤´éƒ¨æ·»åŠ å…ƒç´ </span></span><br><span class="line">System.out.println(lik);   <span class="comment">//è¾“å‡ºé›†åˆä¸­çš„å…ƒç´ </span></span><br><span class="line"><span class="comment">//è·å–å…ƒç´ </span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> lik.peek();   <span class="comment">//è·å–é›†åˆç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">System.out.println(obj);</span><br><span class="line"><span class="comment">//åˆ é™¤å…ƒç´ </span></span><br><span class="line">lik.removeFirst();   <span class="comment">//åˆ é™¤é›†åˆç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">lik.pollLast();   <span class="comment">//åˆ é™¤é›†åˆæœ€åä¸€ä¸ªå…ƒç´ </span></span><br></pre></td></tr></table></figure>

<h3 id="Collectioné›†åˆéå†"><a href="#Collectioné›†åˆéå†" class="headerlink" title="Collectioné›†åˆéå†"></a>Collectioné›†åˆéå†</h3><h4 id="Iteratoréå†é›†åˆ"><a href="#Iteratoréå†é›†åˆ" class="headerlink" title="Iteratoréå†é›†åˆ"></a>Iteratoréå†é›†åˆ</h4><p>Iteratoræ¥å£æ˜¯Javaé›†åˆæ¡†æ¶ä¸­çš„ä¸€å‘˜ï¼Œä½†å®ƒä¸Collectionã€Mapæ¥å£æœ‰æ‰€ä¸åŒï¼ŒCollectionæ¥å£ä¸Mapæ¥å£ä¸»è¦ç”¨æ¥å­˜å‚¨å…ƒç´ ï¼Œè€ŒIteratorä¸»è¦ç”¨äºè¿­ä»£è®¿é—®ï¼ˆå³éå†ï¼‰Collectionä¸­çš„å…ƒç´ ï¼Œå› æ­¤Iteratorå¯¹è±¡ä¹Ÿè¢«å«åšè¿­ä»£å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºArrayListé›†åˆ</span></span><br><span class="line"><span class="type">ArrayList</span> <span class="variable">lis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">lis.add(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">lis.add(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line"><span class="comment">//è·å–Iteratorå¯¹è±¡</span></span><br><span class="line"><span class="type">Iterator</span> <span class="variable">it</span> <span class="operator">=</span> lis.iterator();</span><br><span class="line"><span class="comment">//åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="keyword">while</span>(it.hashNext())&#123;</span><br><span class="line">	<span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> it.next();  <span class="comment">//è·å–ArrayListé›†åˆä¸­çš„å…ƒç´ </span></span><br><span class="line">	System.out.println(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Iteratorè¿­ä»£å™¨å¯¹è±¡åœ¨éå†é›†åˆæ—¶ï¼Œå†…éƒ¨é‡‡ç”¨æŒ‡é’ˆçš„æ–¹å¼æ¥è·Ÿè¸ªé›†åˆä¸­çš„å…ƒç´ ã€‚</p>
<p>åœ¨è°ƒç”¨Iteratorçš„next()æ–¹æ³•ä¹‹å‰ï¼Œè¿­ä»£å™¨çš„ç´¢å¼•ä½äºç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œä¸æŒ‡å‘ä»»ä½•å…ƒç´ ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨è¿­ä»£å™¨çš„next()æ–¹æ³•åï¼Œè¿­ä»£å™¨çš„ç´¢å¼•æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶å°†è¯¥å…ƒç´ è¿”å›ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨Iteratorè¿­ä»£å™¨å¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œè¿­ä»£æ—¶ï¼Œå¦‚æœè°ƒç”¨äº†é›†åˆå¯¹è±¡çš„remove()æ–¹æ³•å»åˆ é™¤å…ƒç´ ï¼Œä¼šå‡ºç°å¼‚å¸¸ã€‚å› ä¸ºé›†åˆä¸­åˆ é™¤äº†å…ƒç´ ä¼šå¯¼è‡´è¿­ä»£å™¨é¢„æœŸçš„è¿­ä»£æ¬¡æ•°å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´è¿­ä»£å™¨çš„ç»“æœä¸å‡†ç¡®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(it.hashNext())&#123;</span><br><span class="line">	<span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> it.next();  <span class="comment">//è·å–ArrayListé›†åˆä¸­çš„å…ƒç´ </span></span><br><span class="line">	System.out.println(obj);</span><br><span class="line">	<span class="keyword">if</span>(<span class="string">&quot;aa&quot;</span>.equals(obj))&#123;</span><br><span class="line">		lis.remove(obj);  <span class="comment">//åˆ é™¤é›†åˆå…ƒç´ </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•ä¸€ï¼šåœ¨åˆ é™¤åç”¨breaké€€å‡ºã€‚</p>
<p>è§£å†³æ–¹æ³•äºŒï¼šä½¿ç”¨è¿­ä»£å™¨æœ¬èº«çš„åˆ é™¤æ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(&quot;aa&quot;.equals(obj))&#123;</span><br><span class="line">	it.remove();   //åˆ é™¤é›†åˆå…ƒç´ </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨è¿­ä»£å™¨å¯¹è±¡çš„remove()æ–¹æ³•åˆ é™¤å…ƒç´ å¯¼è‡´çš„è¿­ä»£æ¬¡æ•°å˜åŒ–ï¼Œå¯¹è¿­ä»£å™¨å¯¹è±¡æœ¬èº«æ¥è®²æ˜¯å¯é¢„çŸ¥çš„ã€‚</p>
<h4 id="foreachéå†é›†åˆ"><a href="#foreachéå†é›†åˆ" class="headerlink" title="foreachéå†é›†åˆ"></a>foreachéå†é›†åˆ</h4><p>JDK5å¼€å§‹æä¾›ï¼Œæ˜¯ä¸€ç§ç®€æ´çš„forå¾ªç¯ï¼Œä¹Ÿç§°å¢å¼ºforå¾ªç¯ï¼Œç”¨äºéå†æ•°ç»„æˆ–é›†åˆä¸­çš„å…ƒç´ ã€‚ä¼šè‡ªåŠ¨éå†å®¹å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ArrayList</span> <span class="variable">lis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"><span class="keyword">for</span>(Object obj:lis)&#123;</span><br><span class="line">    System.out.println(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œåœ¨foreachå¾ªç¯éå†é›†åˆå’Œæ•°ç»„æ—¶ï¼Œåªèƒ½è®¿é—®é›†åˆä¸­çš„å…ƒç´ ï¼Œä¸èƒ½å¯¹å…¶ä¸­çš„å…ƒç´ è¿›è¡Œä¿®æ”¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> String[] str = &#123;<span class="string">&quot;aa&quot;</span>,<span class="string">&quot;bb&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">for</span>(String s:str)&#123;</span><br><span class="line">	s=<span class="string">&quot;aa&quot;</span>;   <span class="comment">//æ”¹å˜å¯¹stringæ•°ç»„æ²¡æ•ˆæœ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰æ•ˆæœæ˜¯å› ä¸ºä»£ç ä¸­<code>s=&quot;aa&quot;;</code>åªæ˜¯å°†ä¸´æ—¶å˜é‡sæŒ‡å‘ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå’Œæ•°ç»„ä¸­çš„å…ƒç´ æ²¡æœ‰å…³ç³»ã€‚</p>
<p>è€Œåœ¨æ™®é€šçš„forå¾ªç¯ä¸­ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥è¿›è¡Œä¿®æ”¹ã€‚</p>
<h4 id="JDK8çš„forEachéå†é›†åˆ"><a href="#JDK8çš„forEachéå†é›†åˆ" class="headerlink" title="JDK8çš„forEachéå†é›†åˆ"></a>JDK8çš„forEachéå†é›†åˆ</h4><p>åœ¨JDK8ä¸­ï¼Œæ ¹æ®Lambdaè¡¨è¾¾å¼ç‰¹æ€§ï¼Œå¢åŠ äº†ä¸€ä¸ª<code>forEach(Consumer action)</code>æ–¹æ³•æ¥éå†é›†åˆï¼Œè¯¥æ–¹æ³•éœ€è¦ä¸€ä¸ªå‡½æ•°å¼æ¥å£ä½œä¸ºå‚æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ArrayList</span> <span class="variable">lis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">lis.forEach(obj-&gt;System.out.println(<span class="string">&quot;è¿­ä»£é›†åˆå…ƒç´ ï¼š&quot;</span>+obj))</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•ä¼ é€’çš„æ˜¯ä¸€ä¸ªLambdaè¡¨è¾¾å¼å½¢å¼ä¹¦å†™çš„å‡½æ•°å¼æ¥å£ã€‚forEachæ–¹æ³•åœ¨æ‰§è¡Œæ—¶ä¼šè‡ªåŠ¨éå†é›†åˆå…ƒç´ å¹¶å°†å…ƒç´ é€ä¸ªä¼ é€’ç»™Lambdaè¡¨è¾¾å¼çš„å½¢å‚ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒJDK8è¿˜ä¸ºIteratorè¿­ä»£å™¨å¯¹è±¡å¢åŠ äº†forEachRemaining(Consumer action)æ–¹æ³•æ¥è¿›è¡Œéå†ï¼ŒåŒæ ·éœ€è¦ä¸€ä¸ªå‡½æ•°å¼æ¥å£ä½œä¸ºå‚æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ArrayList</span> <span class="variable">lis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"><span class="type">Iterator</span> <span class="variable">it</span> <span class="operator">=</span> lis.iterator();</span><br><span class="line">it.forEachRemianing(obj-&gt;System.out.println(<span class="string">&quot;è¿­ä»£é›†åˆå…ƒç´ ï¼š&quot;</span>+obj));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æç¤ºï¼šæœ¬èŠ‚å¯¹lListé›†åˆéå†çš„æ–¹æ³•ï¼Œå¯¹å•åˆ—é›†åˆCollectionè¿›è¡Œéå†ï¼Œå› æ­¤å¯¹Seté›†åˆä¹Ÿé€‚ç”¨ã€‚</p>
</blockquote>
<h3 id="Setæ¥å£"><a href="#Setæ¥å£" class="headerlink" title="Setæ¥å£"></a>Setæ¥å£</h3><p>ä¹ æƒ¯æ€§åœ°å°†å®ç°äº†Setæ¥å£çš„å¯¹è±¡ç§°ä¸ºSeté›†åˆã€‚Seté›†åˆä¸­çš„å…ƒç´ <strong>æ— åº</strong>ï¼ˆæŒ‡å­˜å…¥çš„é¡ºåºå’Œä¸€èµ·è¾“å‡ºçš„é¡ºåºæ˜¯å¦ä¸€è‡´ï¼‰ï¼Œå¹¶ä¸”ä¼šä»¥æŸç§è§„åˆ™ä¿è¯å­˜å…¥çš„<strong>å…ƒç´ ä¸å‡ºç°é‡å¤</strong>ã€‚Setæ¥å£ä¸»è¦æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼šHashSetã€TreeSetã€‚</p>
<p>HashSetæ˜¯æ ¹æ®å¯¹è±¡çš„å“ˆå¸Œå€¼æ¥ç¡®å®šå…ƒç´ åœ¨é›†åˆä¸­çš„å­˜å‚¨çš„ä½ç½®ï¼Œå› æ­¤å…·æœ‰è‰¯å¥½çš„å­˜å–å’ŒæŸ¥æ‰¾æ€§èƒ½ã€‚</p>
<p>TreeSetæ˜¯ä»¥äºŒå‰æ ‘çš„æ–¹å¼æ¥å­˜å‚¨å…ƒç´ ï¼Œå®ƒå¯ä»¥å®ç°å¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚</p>
<h4 id="HashSeté›†åˆ"><a href="#HashSeté›†åˆ" class="headerlink" title="HashSeté›†åˆ"></a>HashSeté›†åˆ</h4><p>HashSetæ˜¯Setæ¥å£çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå…ƒç´ ä¸å¯é‡å¤ä¸”æ— åºã€‚</p>
<p>ä¿é‡ä¸é‡å¤ï¼šå½“å‘HashSeté›†åˆä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå³è°ƒç”¨HashSeté›†åˆçš„add()æ–¹æ³•ï¼Œé¦–å…ˆè°ƒç”¨å½“å‰å­˜å…¥å…ƒç´ çš„hashCode()æ–¹æ³•è·å¾—å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼Œç„¶åæ ¹æ®å¯¹è±¡çš„å“ˆå¸Œå€¼è®¡ç®—å‡ºä¸€ä¸ªå­˜å‚¨ä½ç½®ï¼šå¦‚æœè¯¥ä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ ï¼Œåˆ™ç›´æ¥å°†å…ƒç´ å­˜å…¥ï¼›å¦‚æœè¯¥ä½ç½®ä¸Šæœ‰å…ƒç´ å­˜åœ¨ï¼Œåˆ™ä¼šè°ƒç”¨equals()æ–¹æ³•è®©å½“å‰å­˜å…¥çš„å…ƒç´ ä¾æ¬¡å’Œè¯¥ä½ç½®ä¸Šçš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœè¿”å›çš„ç»“æœä¸ºfalseå°±å°†è¯¥å…ƒç´ å­˜å…¥é›†åˆï¼›è¿”å›çš„ç»“æœä¸ºtrueåˆ™è¯´æ˜æœ‰é‡å¤å…ƒç´ ï¼Œå°±å°†è¯¥å…ƒç´ èˆå¼ƒã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">HashSet</span> <span class="variable">se</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line">se.add(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">se.add(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line"><span class="comment">//éå†è¾“å‡ºSeté›†åˆçš„å…ƒç´ </span></span><br><span class="line">set.forEach(obj-&gt;System.out.println(obj));</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†ä¿è¯HashSetçš„æ­£å¸¸å·¥ä½œï¼Œåœ¨å­˜å…¥å¯¹è±¡æ—¶ï¼Œéœ€è¦é‡å†™Objectç±»ä¸­çš„hashCode()å’Œequals()æ–¹æ³•ã€‚Stringç±»å·²ç»é»˜è®¤é‡å†™äº†<code>hashCode()</code>å’Œ<code>equals()</code></p>
<p>å¦‚æœå°†å¼€å‘è€…è‡ªå®šä¹‰çš„ç±»å‹å¯¹è±¡å­˜å…¥HashSetï¼Œéœ€è¦é‡å†™<code>hashCode()</code>å’Œ<code>equals()</code>ï¼Œæ”¹ä¸ºå€¼æ¯”è¾ƒï¼Œå¦åˆ™æ²¡é‡å†™çš„<code>equals()</code>æ–¹æ³•è®¤ä¸ºä¸¤ä¸ªå€¼ç›¸åŒçš„å¼•ç”¨å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡åœ°å€ä¸åŒï¼Œè®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œè¾¾ä¸åˆ°å»é‡çš„æ•ˆæœã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String id, String name)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.id=id;</span><br><span class="line">		<span class="built_in">this</span>.name=name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//é‡å†™toString()æ–¹æ³•</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id+<span class="string">&quot;:&quot;</span>+name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//é‡å†™hashCodeæ–¹æ³•ï¼Œæ ¹æ®idåˆ¤å®š</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id.hashCode();  <span class="comment">//è¿”å›idå±æ€§çš„å“ˆå¸Œå€¼</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//é‡å†™equalsæ–¹æ³•</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span>&#123;</span><br><span class="line">		<span class="comment">//thisè¡¨ç¤ºè¯¥å¯¹è±¡ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡ï¼Œå¦‚æœæ˜¯åˆ™trueç›¸åŒ</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">this</span> == obj)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºStudentç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¿”å›false</span></span><br><span class="line">		<span class="keyword">if</span>(!(obj <span class="keyword">instanceof</span> Student))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//å°†å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºStudentç±»å‹</span></span><br><span class="line">		<span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> (Student)obj;</span><br><span class="line">		<span class="comment">//æ ¹æ®idå€¼æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">		<span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> <span class="built_in">this</span>.id.equals(stu.id);</span><br><span class="line">		<span class="keyword">return</span> b;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="TreeSeté›†åˆ"><a href="#TreeSeté›†åˆ" class="headerlink" title="TreeSeté›†åˆ"></a>TreeSeté›†åˆ</h4><p>TreeSetå†…éƒ¨é‡‡ç”¨å¹³è¡¡äºŒå‰æ ‘å­˜å‚¨å…ƒç´ ï¼Œè¿™æ ·çš„ç»“æ„ä¿è¯TreeSeté›†åˆä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ï¼Œå¹¶ä¸”å¯ä»¥å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼ˆå’ŒSetçš„æ— åºæ— å…³ï¼‰ã€‚å·¦å­æ ‘å°äºæ ¹èŠ‚ç‚¹ï¼Œå³å­æ ‘å¤§äºæ ¹èŠ‚ç‚¹ã€‚å½“æ’å…¥ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œé¦–å…ˆä¸é¡¶å±‚å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå°äºå·¦è¾¹ï¼Œå¤§äºå³è¾¹ï¼Œç›´åˆ°æœ€åä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå¦‚æœå’Œå¶å­èŠ‚ç‚¹ä¸€æ ·ï¼Œåˆ™å°†è¯¥é‡å¤å…ƒç´ å»æ‰ã€‚å¦åˆ™å°äºå·¦è¾¹ï¼Œå¤§äºå³è¾¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">TreeSet</span> <span class="variable">ts</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeSet</span>();</span><br><span class="line">ts.add(<span class="number">3</span>);</span><br><span class="line">ts.add(<span class="number">9</span>);</span><br><span class="line">ts.add(<span class="number">1</span>);</span><br><span class="line">ts.add(<span class="number">21</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;tsé›†åˆï¼š&quot;</span>+ts);  <span class="comment">//è¾“å‡ºä¸º[1,3,9,21]æœ‰åº</span></span><br><span class="line">é¦–å…ƒç´ ï¼š ts.first()  <span class="comment">//1</span></span><br><span class="line">å°¾å…ƒç´ ï¼š ts.last()   <span class="comment">//21</span></span><br><span class="line"><span class="comment">//æ¯”è¾ƒå¹¶è·å–å…ƒç´ </span></span><br><span class="line">ts.floor(<span class="number">9</span>)  <span class="comment">//é›†åˆä¸­å°äºæˆ–ç­‰äº9çš„æœ€å¤§ä¸€ä¸ªå…ƒç´  9</span></span><br><span class="line">ts.higher(<span class="number">10</span>)  <span class="comment">//é›†åˆä¸­å¤§äº10çš„æœ€å°å…ƒç´  21</span></span><br><span class="line">åˆ é™¤å¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š </span><br><span class="line"><span class="type">Object</span> <span class="variable">first</span> <span class="operator">=</span> ts.pollFirst();</span><br><span class="line">åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ï¼š </span><br><span class="line"><span class="type">Object</span> <span class="variable">last</span> <span class="operator">=</span> ts.pollLast();</span><br></pre></td></tr></table></figure>

<p>é›†åˆä¸­å…ƒç´ æ·»åŠ é¡ºåºæ— è®ºå¦‚ä½•ï¼Œæœ€åéƒ½ä¼šæŒ‰ä¸€å®šé¡ºåºæ’åˆ—ã€‚å› ä¸ºå¹³è¡¡äºŒå‰æ ‘ï¼Œæ¯æ¬¡æ’å…¥éƒ½ä¼šä¸å…¶ä»–å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åæ’å…¥æœ‰åºçš„å¯¹è±¡åºåˆ—ä¸­ã€‚</p>
<p>é›†åˆä¸­çš„å…ƒç´ åœ¨è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œéƒ½ä¼šè°ƒç”¨<code>compareTo()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯<code>Comparable</code>æ¥å£ä¸­å®šä¹‰çš„ï¼Œå› æ­¤è¦æƒ³å¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œå°±å¿…é¡»å®ç°<code>Comparable</code>æ¥å£ã€‚Javaä¸­å¤§å¤šæ•°ç±»éƒ½å®ç°äº†<code>Comparable</code>æ¥å£ï¼Œå¹¶é»˜è®¤å®ç°æ¥å£ä¸­çš„<code>compareTo()</code>æ–¹æ³•ï¼Œå¦‚Integerã€Doubleã€Stringç­‰ã€‚</p>
<p>å®é™…å¼€å‘ä¸­ï¼Œå¯¹è‡ªå®šä¹‰ç±»å‹çš„æ•°æ®æ²¡æœ‰å®ç°<code>Comparable</code>æ¥å£ï¼Œæ— æ³•ç›´æ¥åœ¨TreeSeté›†åˆä¸­è¿›è¡Œæ’åºæ“ä½œã€‚å› æ­¤ï¼ŒJavaæä¾›äº†ä¸¤ç§TreeSetçš„æ’åºè§„åˆ™ï¼šè‡ªç„¶æ’åºã€å®šåˆ¶æ’åºã€‚é»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨è‡ªç„¶æ’åºã€‚</p>
<p>ï¼ˆ1ï¼‰è‡ªç„¶æ’åº</p>
<p>è‡ªç„¶æ’åºè¦æ±‚å‘TreeSeté›†åˆä¸­å­˜å‚¨çš„å…ƒç´ æ‰€åœ¨ç±»å¿…é¡»å®ç°<code>Comparable</code>æ¥å£ï¼Œå¹¶é‡å†™<code>compareTo()</code>æ–¹æ³•ã€‚ç„¶åTreeSeté›†åˆå°±ä¼šå¯¹è¯¥ç±»å‹å…ƒç´ ä½¿ç”¨<code>compareTo()</code>æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼Œé»˜è®¤å‡åºæ’åºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰Teacherç±»å®ç°Comparableæ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Teacher</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&#123;</span><br><span class="line">	String name;</span><br><span class="line">	<span class="type">int</span> age;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Teacher</span><span class="params">(String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.name=name;</span><br><span class="line">		<span class="built_in">this</span>.age=age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name+<span class="string">&quot;:&quot;</span>+age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//é‡å†™compareToæ–¹æ³•</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Object obj)</span>&#123;</span><br><span class="line">		<span class="type">Teacher</span> <span class="variable">s</span> <span class="operator">=</span> (Teacher)obj;</span><br><span class="line">		<span class="comment">//å®šä¹‰æ¯”è¾ƒæ–¹å¼ï¼Œå…ˆæ¯”è¾ƒå¹´é¾„ageï¼Œå†æ¯”è¾ƒname,å‡åº</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">this</span>.age-s.age&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">this</span>.age-s.age==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>.name.compareTo(s.name);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å®šåˆ¶æ’åº</p>
<p>é€šè¿‡åœ¨åˆ›å»ºTreeSeté›†åˆæ—¶å°±è‡ªå®šä¹‰ä¸€ä¸ªæ¯”è¾ƒå™¨æ¥å¯¹å…ƒç´ è¿›è¡Œå®šåˆ¶æ’åºã€‚è‡ªå®šä¹‰çš„ç±»å‹æ•°æ®ä¸­æ— éœ€å®ç°Comparableæ¥å£ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•è¿›è¡Œæ’åºã€‚</p>
<p>ä¾‹å­ï¼šæŒ‰ç…§é›†åˆä¸­å­—ç¬¦ä¸²çš„é•¿åº¦è¿›è¡Œå®šåˆ¶æ’åºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"><span class="comment">//å®šä¹‰æ¯”è¾ƒå™¨å®ç°Comparatoræ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComparator</span> <span class="keyword">implements</span> <span class="title class_">Comparator</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Object obj1, Object obj2)</span>&#123;</span><br><span class="line">		String s1=(String)obj1;</span><br><span class="line">		String s2=(String)obj2;</span><br><span class="line">		<span class="type">int</span> temp=s1.length()-s2.length();</span><br><span class="line">		<span class="keyword">return</span> temp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">	<span class="comment">//æ³•1.åˆ›å»ºé›†åˆæ—¶ï¼Œä¼ å…¥Comparatoræ¥å£å®ç°å®šåˆ¶æ’åº</span></span><br><span class="line">		TreeSet ts=<span class="keyword">new</span> <span class="title class_">TreeSet</span>(<span class="keyword">new</span> <span class="title class_">MyComparator</span>());</span><br><span class="line">		ts.add(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">		ts.add(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">		ts.add(<span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">		System.out.println(ts);</span><br><span class="line">	<span class="comment">//æ³•2.åˆ›å»ºé›†åˆæ—¶ï¼Œä½¿ç”¨Lambdaè¡¨è¾¾å¼å®šåˆ¶æ’åºï¼Œæ— åºä¸Šé¢çš„MyComparator</span></span><br><span class="line">		TreeSet ts2=<span class="keyword">new</span> <span class="title class_">TreeSet</span>((obj1,obj2)-&gt;&#123;</span><br><span class="line">			String s1=(String)obj1;</span><br><span class="line">			String s2=(String)obj2;</span><br><span class="line">			<span class="keyword">return</span> s1.length()-s2.length();</span><br><span class="line">		&#125;);</span><br><span class="line">		ts2.add(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">		ts2.add(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">		ts2.add(<span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">		System.out.println(ts2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mapæ¥å£"><a href="#Mapæ¥å£" class="headerlink" title="Mapæ¥å£"></a>Mapæ¥å£</h3><p>Mapæ¥å£æ˜¯ä¸€ç§åŒåˆ—é›†åˆï¼ŒåŒ…å«é”®å¯¹è±¡keyå’Œå€¼valueï¼Œé”®å’Œå€¼å¯¹è±¡ä¹‹é—´å­˜åœ¨ä¸€ç§æ˜ å°„ï¼Œä¸€å¯¹ä¸€çš„ï¼Œä¸€ä¸ªkeyå¯¹åº”å”¯ä¸€ä¸€ä¸ªvalueï¼Œé”®å¯¹è±¡keyä¸å¯é‡å¤ã€‚</p>
<h4 id="HashMapé›†åˆ"><a href="#HashMapé›†åˆ" class="headerlink" title="HashMapé›†åˆ"></a>HashMapé›†åˆ</h4><p>HahMapé›†åˆå­˜å‚¨é”®å€¼æ˜ å°„å…³ç³»ï¼Œè¯¥é›†åˆçš„é”®å’Œå€¼å…è®¸ä¸ºç©ºï¼Œä½†é”®ä¸èƒ½é‡å¤ï¼Œä¸”é›†åˆä¸­çš„å…ƒç´ æ˜¯<strong>æ— åºçš„</strong>ã€‚</p>
<p>HashMapåº•å±‚ï¼šå“ˆå¸Œè¡¨ç»“æ„&#x3D;æ•°ç»„+é“¾è¡¨ã€‚æ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ç»“æ„ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸ºäº†è§£å†³å“ˆå¸Œå€¼å†²çªè€Œå­˜åœ¨çš„åˆ†æ”¯ç»“æ„ã€‚å› æ­¤HashMapå¯¹å…ƒç´ çš„å¢åˆ æ”¹æŸ¥è¡¨ç°å‡ºçš„æ•ˆç‡éƒ½å¾ˆé«˜ã€‚</p>
<p>æ°´å¹³æ–¹å‘ä¸Šæ•°ç»„çš„é•¿åº¦ç§°ä¸ºHashMapé›†åˆçš„å®¹é‡ï¼ˆcapacityï¼‰ï¼Œç«–ç›´æ–¹å‘æ¯ä¸ªå…ƒç´ å¯¹åº”çš„é“¾è¡¨ç»“æ„ç§°ä¸ºä¸€ä¸ªæ¡¶ï¼ˆbucketï¼‰ï¼Œæ¯ä¸ªæ¡¶çš„ä½ç½®åœ¨é›†åˆä¸­éƒ½æœ‰å¯¹åº”çš„æ¡¶å€¼ï¼Œç”¨äºå¿«é€Ÿå®šä½ã€‚æ¯ä¸ªé“¾è¡¨ç»“æ„æ˜¯&lt;key,value&gt;çš„é”®å€¼å¯¹ã€‚</p>
<p>å½“å‘HashMapé›†åˆæ·»åŠ å…ƒç´ æ—¶ï¼Œé¦–å…ˆè°ƒç”¨é”®å¯¹è±¡kçš„hash(k)æ–¹æ³•ï¼Œå¿«é€Ÿå®šä½å¹¶å¯»å€åˆ°è¯¥å…ƒç´ åœ¨é›†åˆä¸­è¦å­˜å‚¨çš„ä½ç½®ã€‚åœ¨å®šä½åˆ°å­˜å‚¨å…ƒç´ é”®å¯¹è±¡kçš„å“ˆå¸Œå€¼æ‰€å¯¹åº”æ¡¶ä½ç½®åï¼Œä¼šå‡ºç°ä¸¤ç§æƒ…å†µï¼š<br>1.é”®å¯¹è±¡kçš„hashå€¼æ‰€åœ¨çš„æ¡¶ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥å‘è¯¥æ¡¶æ’å…¥å…ƒç´ å¯¹è±¡ã€‚<br>2.é”®å¯¹è±¡kçš„hashå€¼æ‰€åœ¨çš„æ¡¶ä½ç½®ä¸ä¸ºç©ºï¼Œåˆ™ç»§ç»­é€šè¿‡é”®å¯¹è±¡çš„equals(k)æ–¹æ³•æ¯”è¾ƒæ–°æ’å…¥çš„å…ƒç´ é”®å¯¹è±¡kå’Œå·²å­˜åœ¨çš„å…ƒç´ é”®å¯¹è±¡kæ˜¯å¦ç›¸åŒï¼š<br>1.å¦‚æœç›¸åŒï¼Œåˆ™ä¼šå¯¹åŸæœ‰å…ƒç´ çš„å€¼å¯¹è±¡vè¿›è¡Œæ›¿æ¢å¹¶è¿”å›åŸæ¥çš„æ—§å€¼ã€‚<br>2.å¦‚æœéƒ½ä¸ç›¸åŒï¼Œåˆ™åœ¨è¯¥æ¡¶çš„é“¾è¡¨ç»“æ„å¤´éƒ¨æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹æ¥æ’å…¥æ–°çš„å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">m.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;3&quot;</span>,<span class="string">&quot;cc&quot;</span>);  <span class="comment">//putå·²å­˜åœ¨çš„keyï¼Œä¼šè¿›è¡Œè¦†ç›–</span></span><br><span class="line">System.out.println(m);  <span class="comment">//æ‰“å°</span></span><br><span class="line"><span class="comment">//æŸ¥çœ‹é”®æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">m.containsKey(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="comment">//è·å–é”®å¯¹åº”çš„å€¼</span></span><br><span class="line">m.get(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="comment">//è·å–é”®é›†åˆã€å€¼é›†åˆ</span></span><br><span class="line">m.keySet()</span><br><span class="line">m.values()</span><br><span class="line"><span class="comment">//æ›¿æ¢æŒ‡å®šé”®çš„å€¼</span></span><br><span class="line">m.replace(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;dd&quot;</span>);</span><br><span class="line">åˆ é™¤æŒ‡å®šé”®å€¼å¯¹</span><br><span class="line">m.remove(<span class="string">&quot;1&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼ŒHashMapæŸ¥æ‰¾æ—¶ï¼Œéœ€è¦éå†é“¾è¡¨ï¼Œé€ä¸€é€šè¿‡equalsæ–¹æ³•è¿›è¡Œæ¯”å¯¹ï¼Œå› æ­¤æ¡¶è¶Šå¤šï¼ŒHashMapä¸­çš„é“¾è¡¨è¶Šå°‘ï¼Œæ€§èƒ½è¶Šå¥½ã€‚å±äºç©ºé—´æ¢æ—¶é—´ã€‚</p>
<p>HashMapä¸­ï¼Œ<strong>åŠ¨æ€åˆ†é…æ¡¶çš„æ•°é‡</strong>ï¼šé€šè¿‡<code>new HashMap()</code>æ–¹æ³•åˆ›å»ºHashMapæ—¶ï¼Œä¼šé»˜è®¤é›†åˆå®¹é‡capacityå¤§å°ä¸º16ï¼ŒåŠ è½½å› å­loadFactorä¸º0.75ï¼Œæ­¤æ—¶é›†åˆæ¡¶çš„é˜ˆå€¼ä¸º12ï¼Œè¶…è¿‡12ä¸ªæ—¶ï¼ŒHashMapä¼šé»˜è®¤å¢åŠ ä¸€å€æ¡¶çš„æ•°é‡ã€‚å¼€å‘è€…ä¹Ÿå¯ä»¥ä½¿ç”¨<code>new HashMap(int intialCapacity, float loadFactor)</code>æ„é€ æ–¹æ³•ï¼Œåœ¨åˆ›å»ºHashMapé›†åˆæ—¶æŒ‡å®šé›†åˆå®¹é‡å’ŒåŠ è½½å› å­ã€‚</p>
<h4 id="Mapé›†åˆéå†"><a href="#Mapé›†åˆéå†" class="headerlink" title="Mapé›†åˆéå†"></a>Mapé›†åˆéå†</h4><h5 id="Iteratorè¿­ä»£å™¨éå†"><a href="#Iteratorè¿­ä»£å™¨éå†" class="headerlink" title="Iteratorè¿­ä»£å™¨éå†"></a>Iteratorè¿­ä»£å™¨éå†</h5><p>ä½¿ç”¨Iteratorè¿­ä»£å™¨éå†Mapé›†åˆï¼Œéœ€è¦å…ˆå°†Mapé›†åˆè½¬æ¢ä¸ºIteratoræ¥å£å¯¹è±¡ï¼Œç„¶åè¿›è¡Œéå†ï¼Œæœ‰ä¸¤ç§æ–¹æ³•è¿›è¡Œè½¬æ¢ï¼š</p>
<p>ï¼ˆ1ï¼‰keySet()æ–¹æ³•</p>
<p>å…ˆå°†Mapé›†åˆä¸­æ‰€æœ‰é”®å¯¹è±¡è½¬æ¢ä¸ºSetå•åˆ—é›†åˆï¼Œç„¶åå°†Seté›†åˆè½¬æ¢ä¸ºIteratoræ¥å£å¯¹è±¡ï¼Œéå†å¾—åˆ°é”®ï¼Œå†è·å¾—å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">m.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;3&quot;</span>,<span class="string">&quot;cc&quot;</span>); </span><br><span class="line"><span class="type">Set</span> <span class="variable">keySet</span> <span class="operator">=</span> map.keySet();   <span class="comment">//è·å–é”®çš„é›†åˆ</span></span><br><span class="line"><span class="type">Iterator</span> <span class="variable">it</span> <span class="operator">=</span> keySet.iterator();  <span class="comment">//è¿­ä»£é”®çš„é›†åˆ</span></span><br><span class="line"><span class="keyword">while</span>(it.hashNext())&#123;</span><br><span class="line">	<span class="type">Object</span> <span class="variable">k</span> <span class="operator">=</span> it.next();</span><br><span class="line">	<span class="type">Object</span> <span class="variable">v</span> <span class="operator">=</span> m.get(key);</span><br><span class="line">	System.out.println(k+<span class="string">&quot;:&quot;</span>+v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰entrySet()æ–¹æ³•</p>
<p>å°†åŸæœ‰Mapé›†åˆä¸­çš„é”®å€¼å¯¹ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿”å›ä¸ºSeté›†åˆï¼Œæ¥ç€å°†Setè½¬æ¢ä¸ºIteratoræ¥å£å¯¹è±¡ï¼Œç„¶åè·å–é”®å€¼å¯¹æ˜ å°„å…³ç³»ï¼Œå–å‡ºé”®å’Œå€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">m.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;3&quot;</span>,<span class="string">&quot;cc&quot;</span>); </span><br><span class="line"><span class="type">Set</span> <span class="variable">entrySet</span> <span class="operator">=</span> m.entrySet();</span><br><span class="line"><span class="type">Iterator</span> <span class="variable">it</span> <span class="operator">=</span> entrySet.iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">	Map.<span class="type">Entry</span> <span class="variable">en</span> <span class="operator">=</span> (Map.Entry)(it.next());</span><br><span class="line">	<span class="type">Object</span> <span class="variable">k</span> <span class="operator">=</span> en.getKey();</span><br><span class="line">	<span class="type">Object</span> <span class="variable">v</span> <span class="operator">=</span> en.getValue();</span><br><span class="line">	System.out.println(k+<span class="string">&quot;:&quot;</span>+v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Map.Entryæ˜¯Mapæ¥å£å†…éƒ¨ç±»ï¼Œæ¯ä¸ªMap.Entryå¯¹è±¡ä»£è¡¨Mapä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚getKeyå’ŒgetValueæ˜¯æ˜ å°„å¯¹è±¡çš„æ–¹æ³•ã€‚</p>
<h5 id="forEach-æ–¹æ³•"><a href="#forEach-æ–¹æ³•" class="headerlink" title="forEach()æ–¹æ³•"></a>forEach()æ–¹æ³•</h5><p>å†JDK8ä¸­æ ¹æ®Lambdaè¡¨è¾¾å¼ç‰¹æ€§æ–°å¢äº†ä¸€ä¸ªforEachæ–¹æ³•æ¥éå†Mapé›†åˆï¼Œè¯¥æ–¹æ³•éœ€è¦çš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå¯ä»¥ç”¨Lambdaè¡¨è¾¾å¼ä¹¦å†™è¿™ä¸ªå‡½æ•°å¼æ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">m.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;3&quot;</span>,<span class="string">&quot;cc&quot;</span>); </span><br><span class="line">m.forEach((k,v)-&gt;System.out.println(k+<span class="string">&quot;:&quot;</span>+v));</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåªæƒ³éå†valueï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Collection</span> <span class="variable">v</span> <span class="operator">=</span> m.values();</span><br><span class="line">v.forEach(va-&gt;System.out.println(va));</span><br></pre></td></tr></table></figure>

<h4 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h4><p>HashMapæ— åºï¼Œä¸ä¿è¯é›†åˆå…ƒç´ å­˜å…¥å’Œå–å‡ºçš„é¡ºåºã€‚</p>
<p>ä½†æ˜¯LinkedHashMapæ˜¯HashMapçš„å­ç±»ï¼Œå’ŒLinkedListä¸€æ ·ä½¿ç”¨åŒå‘é“¾è¡¨æ¥ç»´æŠ¤å†…éƒ¨å…ƒç´ çš„å…³ç³»ï¼Œä½¿å¾—å…ƒç´ æœ‰åºï¼ˆå­˜å…¥å’Œå–å‡ºçš„é¡ºåºï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>();  <span class="comment">//åˆ›å»º</span></span><br></pre></td></tr></table></figure>

<h4 id="TreeMapé›†åˆ"><a href="#TreeMapé›†åˆ" class="headerlink" title="TreeMapé›†åˆ"></a>TreeMapé›†åˆ</h4><p>Mapæ¥å£çš„å¦ä¸€ä¸ªå®ç°ç±»TreeMapï¼ŒåŒæ ·ä¸å…è®¸é‡å¤çš„é”®ã€‚TreeMapå†…éƒ¨æ˜¯é€šè¿‡äºŒå‰æ ‘çš„åŸç†æ¥ä¿è¯é”®çš„å”¯ä¸€æ€§ï¼Œè¿™ä¸TreeSeté›†åˆå­˜å‚¨çš„åŸç†ä¸€æ ·ï¼Œå› æ­¤ï¼ŒTreeMapä¸­æ‰€æœ‰çš„é”®æ˜¯æŒ‰ç…§æŸç§é¡ºåºæ’åˆ—çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeMap</span>();</span><br><span class="line">m.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">m.put(<span class="string">&quot;3&quot;</span>,<span class="string">&quot;cc&quot;</span>);</span><br><span class="line">System.out.println(m);</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„é”®æ˜¯Stringç±»å‹ï¼ŒStringç±»å®ç°äº†Comparableæ¥å£ï¼Œå› æ­¤é»˜è®¤ä¼šæŒ‰ç…§è‡ªç„¶é¡ºåºä»å°åˆ°å¤§è¿›è¡Œæ’åˆ—ã€‚</p>
<p>æ¡¶TreeSetä¸€æ ·ï¼ŒTreeMapå¯ä»¥è‡ªå®šä¹‰æ¯”è¾ƒå™¨Comparatorçš„æ–¹å¼å¯¹æ‰€æœ‰çš„é”®è¿›è¡Œå®šåˆ¶æ’åºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰æ¯”è¾ƒå™¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComparator</span> <span class="keyword">implements</span> <span class="title class_">Comparator</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Object obj1, Object obj2)</span>&#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">key1</span> <span class="operator">=</span> (String)obj1;</span><br><span class="line">		<span class="type">String</span> <span class="variable">key2</span> <span class="operator">=</span> (String)obj2;</span><br><span class="line">	    <span class="keyword">return</span> key2.compareTo(key1);  <span class="comment">//ä»å¤§åˆ°å°æ’åˆ—</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeMap</span>(<span class="keyword">new</span> <span class="title class_">MyComparator</span>());</span><br></pre></td></tr></table></figure>

<h4 id="Propertiesé›†åˆ"><a href="#Propertiesé›†åˆ" class="headerlink" title="Propertiesé›†åˆ"></a>Propertiesé›†åˆ</h4><p>Mapæ¥å£è¿˜æœ‰ä¸€ä¸ªå®ç°æ¥Hashtableï¼Œå®ƒå’ŒHashMapååˆ†ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºHashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤åœ¨ä½¿ç”¨ä¸ŠHashtableçš„æ•ˆç‡ä¸åŠHashMapã€‚å› æ­¤é€šå¸¸ä½¿ç”¨HashMapã€‚</p>
<p>ä½†æ˜¯Hashtableæœ‰ä¸€ä¸ªå­ç±»Propertiesï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸²ç±»å‹çš„é”®å€¼ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œç»å¸¸ç”¨æ¥å­˜å–åº”ç”¨çš„é…ç½®é¡¹ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼štest.properties</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">color = red;</span><br><span class="line">size = 10;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="comment">//1.é€šè¿‡Propertiesè¿›è¡Œå±æ€§æ–‡ä»¶è¯»å–æ“ä½œ</span></span><br><span class="line">	<span class="type">Properties</span> <span class="variable">pps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">	<span class="comment">//åŠ è½½æ–‡ä»¶</span></span><br><span class="line">	pps.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;test.properties&quot;</span>));</span><br><span class="line">	<span class="comment">//éå†é”®å€¼å¯¹ä¿¡æ¯</span></span><br><span class="line">	pps.forEach((k,v)-&gt;System.out.println(k+<span class="string">&quot;:&quot;</span>+v));</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//2.é€šè¿‡Propertiesè¿›è¡Œå±æ€§æ–‡ä»¶å†™å…¥æ“ä½œ</span></span><br><span class="line">	<span class="comment">//æŒ‡å®šå†™å…¥æ“ä½œçš„æ–‡ä»¶åç§°å’Œä½ç½®</span></span><br><span class="line">	FileOutputStream out <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;test.properties&quot;</span>);</span><br><span class="line">	<span class="comment">//å‘Propertiesç±»æ–‡ä»¶è¿›è¡Œå†™å…¥é”®å€¼å¯¹ä¿¡æ¯</span></span><br><span class="line">	pps.setProperty(<span class="string">&quot;charset&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">	<span class="comment">//å°†æ­¤Propertiesé›†åˆä¸­æ–°å¢çš„é”®å€¼å¯¹å†™å…¥é…ç½®æ–‡ä»¶</span></span><br><span class="line">	pps.store(out, <span class="string">&quot;æ–°å¢charsetç¼–ç &quot;</span>)ï¼›</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Propertiesçš„setPropertyæ–¹æ³•ï¼Œç”¨æ¥æ–°å¢ä¸€ä¸ªé”®å€¼å¯¹å…ƒç´ ã€‚storeæ–¹æ³•ç”¨æ¥å°†æ–°å¢ä¿¡æ¯å†™å…¥åˆ°propertiesé…ç½®æ–‡ä»¶ã€‚</p>
<h3 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h3><p>åœ¨ä¹‹å‰åˆ›å»ºé›†åˆï¼Œå½“æŠŠä¸€ä¸ªå¯¹è±¡å­˜å…¥é›†åˆåï¼Œé›†åˆä¼šå¿˜è®°è¿™ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œå°†è¯¥å¯¹è±¡ä»é›†åˆä¸­å–å‡ºæ—¶ï¼Œè¿™ä¸ªå¯¹è±¡çš„ç¼–è¯‘ç±»å‹å°±ä¼šç»Ÿä¸€å˜æˆObjectç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­˜å…¥å…ƒç´ å•¥ç±»å‹éƒ½è¡Œï¼Œä½†æ˜¯å–å‡ºå…ƒç´ åï¼Œè¿›è¡Œå¼ºåˆ¶è½¬æ¢å®¹æ˜“å‡ºé”™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ArrayList lis = new ArrayList();</span><br><span class="line">lis.add(&quot;aa&quot;);</span><br><span class="line">lis.add(&quot;bb&quot;);</span><br><span class="line">for(Object obj:lis)&#123;</span><br><span class="line">	String s = (String)obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºè§£å†³è¯¥é—®é¢˜ï¼ŒJavaå¼•å…¥â€œå‚æ•°åŒ–ç±»å‹â€æ¦‚å¿µï¼Œå³æ³›å‹ã€‚æ³›å‹å¯ä»¥é™å®šæ“ä½œçš„æ•°æ®ç±»å‹ï¼Œåœ¨å®šä¹‰é›†åˆç±»æ—¶ï¼Œå¯ä»¥ä½¿ç”¨â€œ&lt;å‚æ•°åŒ–ç±»å‹&gt;â€çš„å½¢å¼æŒ‡å®šé›†åˆä¸­å­˜å‚¨çš„æ•°æ®ç±»å‹ã€‚</p>
<p><code>ArrayList&lt;String&gt;lis = new ArrayList&lt;String&gt;();</code></p>
<p>è¿™æ ·é™å®šäº†é›†åˆå…ƒç´ çš„æ•°æ®ç±»å‹ï¼Œç¨‹åºç¼–è¯‘æ—¶ç±»å‹ä¸å¿…é…çš„è¯ä¼šç¼–è¯‘ä¸é€šè¿‡ï¼Œé¿å…è¿è¡Œæ—¶å‘ç”Ÿé”™è¯¯ã€‚éå†æ—¶<code>for(String s:lis)&#123;&#125;</code></p>
<h2 id="å¸¸ç”¨å·¥å…·ç±»"><a href="#å¸¸ç”¨å·¥å…·ç±»" class="headerlink" title="å¸¸ç”¨å·¥å…·ç±»"></a>å¸¸ç”¨å·¥å…·ç±»</h2><h3 id="Collectionså·¥å…·ç±»"><a href="#Collectionså·¥å…·ç±»" class="headerlink" title="Collectionså·¥å…·ç±»"></a>Collectionså·¥å…·ç±»</h3><p>Javaæä¾›çš„ä¸€ä¸ªä¸“é—¨å·¥å…·ç±»ç”¨æ¥æ“ä½œé›†åˆï¼Œä½äºjava.utilåŒ…ä¸­ã€‚Collectionsç±»ä¸­æä¾›äº†å¤§é‡çš„é™æ€æ–¹æ³•ç”¨äºå¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€æŸ¥æ‰¾ã€ä¿®æ”¹ç­‰æ“ä½œã€‚</p>
<h4 id="æ·»åŠ ã€æ’åº"><a href="#æ·»åŠ ã€æ’åº" class="headerlink" title="æ·»åŠ ã€æ’åº"></a>æ·»åŠ ã€æ’åº</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;String&gt;lis = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//æ·»åŠ å…ƒç´ </span></span><br><span class="line">Collections.addAll(lis,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>);</span><br><span class="line"><span class="comment">//é›†åˆå¯ä»¥ç›´æ¥è¾“å‡ºï¼Œè€Œæ•°ç»„ä¸å¯ä»¥ï¼Œæ•°ç»„å¯ä»¥ç”¨forEachçš„Lambdaè¡¨è¾¾å¼ï¼Ÿ</span></span><br><span class="line">System.out.println(lis);</span><br><span class="line">Collections.sort(lis);  <span class="comment">//æ’åº</span></span><br><span class="line">Collections.reverse(lis);  <span class="comment">//åè½¬</span></span><br><span class="line">Collections.shuffle(lis);  <span class="comment">//éšæœºæ‰“ä¹±é›†åˆé¡ºåº</span></span><br><span class="line">Collections.swap(lis,<span class="number">0</span>,lis.size()-<span class="number">1</span>);  <span class="comment">//äº¤æ¢å…ƒç´ </span></span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥æ‰¾ã€æ›¿æ¢"><a href="#æŸ¥æ‰¾ã€æ›¿æ¢" class="headerlink" title="æŸ¥æ‰¾ã€æ›¿æ¢"></a>æŸ¥æ‰¾ã€æ›¿æ¢</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt;lis = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//æ·»åŠ å…ƒç´ </span></span><br><span class="line">Collections.addAll(lis,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">æœ€å¤§å…ƒç´ ï¼š Collections.max(lis);</span><br><span class="line">æœ€å°å…ƒç´ ï¼š Collections.min(lis);</span><br><span class="line">Collections.replace(lis,<span class="number">2</span>,<span class="number">0</span>);  <span class="comment">//å°†é›†åˆä¸­çš„2ç”¨0æ›¿æ¢æ‰</span></span><br><span class="line">Collections.sort(lis);  <span class="comment">//æ’åº</span></span><br><span class="line"><span class="comment">//é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æŸ¥æ‰¾å…ƒç´ 3æ‰€åœ¨çš„è§’æ ‡ï¼Œä¸€å®šè¦å…ˆæ’åº</span></span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> Collections.binarySearch(lis, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Arrayså·¥å…·ç±»"><a href="#Arrayså·¥å…·ç±»" class="headerlink" title="Arrayså·¥å…·ç±»"></a>Arrayså·¥å…·ç±»</h3><p>javaé’ˆå¯¹æ•°ç»„æ“ä½œæä¾›çš„æ•°æ®å·¥å…·ç±»Arraysï¼Œæä¾›å¤§é‡é™æ€æ–¹æ³•ã€‚</p>
<h4 id="sortæ’åº"><a href="#sortæ’åº" class="headerlink" title="sortæ’åº"></a>sortæ’åº</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] arr = &#123;<span class="number">9</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">ä¸èƒ½é€šè¿‡System.outç›´æ¥æ‰“å°æ•°ç»„ï¼Œéœ€è¦<span class="keyword">for</span>å¾ªç¯æ‰“å°</span><br><span class="line">Arrays.sort(arr);  <span class="comment">//æ’åº</span></span><br><span class="line">Arrays.sort(arr,<span class="number">1</span>,<span class="number">4</span>);  å·¦é—­å³å¼€</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Arrays.sort(arr);</span><br><span class="line"><span class="type">int</span> index=Arrays.binarySearch(arr,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h4 id="æ‹·è´"><a href="#æ‹·è´" class="headerlink" title="æ‹·è´"></a>æ‹·è´</h4><p>åœ¨ä¸ç ´ååŸæ•°ç»„çš„æƒ…å†µä¸‹ä½¿ç”¨æ•°ç»„çš„éƒ¨åˆ†å…ƒç´ ï¼Œå°†æŒ‡å®šèŒƒå›´çš„å…ƒç´ æ‹·è´åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] arr = &#123;<span class="number">9</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>&#125;;</span><br><span class="line"><span class="type">int</span>[] cop = Arrays.copyOfRange(arr, <span class="number">1</span>, <span class="number">7</span>);</span><br><span class="line"><span class="comment">//ç»“æœcopï¼š8ï¼Œ3ï¼Œ5ï¼Œ2ï¼Œ0ï¼Œ0ï¼Œå·¦é—­å³å¼€å…±å…­ä¸ªï¼Œæ²¡æœ‰çš„ç”¨é»˜è®¤0</span></span><br></pre></td></tr></table></figure>

<h4 id="æ›¿æ¢"><a href="#æ›¿æ¢" class="headerlink" title="æ›¿æ¢"></a>æ›¿æ¢</h4><p>å°†æ•°ç»„çš„æ‰€æœ‰å…ƒç´ æ›¿æ¢ä¸ºä¸€ä¸ªå…ƒç´ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Arrays.fill(arr,<span class="number">8</span>);  <span class="comment">//å…¨æ¢ä¸º8</span></span><br></pre></td></tr></table></figure>

<h3 id="èšåˆæ“ä½œ"><a href="#èšåˆæ“ä½œ" class="headerlink" title="èšåˆæ“ä½œ"></a>èšåˆæ“ä½œ</h3><p>Lambdaè¡¨è¾¾å¼å¯ä»¥ç®€åŒ–é›†åˆå’Œæ•°ç»„çš„éå†ã€è¿‡æ»¤å’Œæå–ç­‰æ“ä½œã€‚åŸºäºæ­¤ç‰¹æ€§ï¼ŒJDK8æ–°å¢äº†èšåˆæ“ä½œã€‚</p>
<h4 id="Streamæ¥å£"><a href="#Streamæ¥å£" class="headerlink" title="Streamæ¥å£"></a>Streamæ¥å£</h4><p>JDK8æä¾›ï¼Œè¯¥æ¥å£å°†é›†åˆã€æ•°ç»„ä¸­çš„å…ƒç´ è½¬æ¢ä¸ºStreamæµçš„å½¢å¼ï¼Œå¹¶ç»“åˆLambdaè¡¨è¾¾å¼è¿›ä¸€æ­¥ç®€åŒ–é›†åˆã€æ•°ç»„ä¸­å…ƒç´ çš„æŸ¥æ‰¾ã€è¿‡æ»¤ã€è½¬æ¢æ“ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line">List&lt;String&gt;lis <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">lis.add(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">lis.add(<span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">lis.add(<span class="string">&quot;dddd&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªStreamæµå¯¹è±¡</span></span><br><span class="line">Stream&lt;String&gt;stream = lis.stream();</span><br><span class="line"><span class="comment">//å¯¹Streamæµä¸­çš„å…ƒç´ è¿›è¡Œè¿‡æ»¤ã€æˆªå–</span></span><br><span class="line">Stream&lt;String&gt;stream2 = stream.filter(i-&gt;i.startsWith(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">Stream&lt;String&gt;stream3 = stream.filter(i-&gt;i.length()&gt;<span class="number">1</span>);</span><br><span class="line">Stream&lt;String&gt;stream4 = stream2.limit(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//å¯¹Streamæµä¸­çš„å…ƒç´ è¿›è¡Œç»ˆç»“æ“ä½œ</span></span><br><span class="line">stream4.forEach(j-&gt;System.out.println(j));</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡é“¾å¼è¡¨è¾¾å¼çš„å½¢å¼å®Œæˆèšåˆæ“ä½œ</span></span><br><span class="line">lis.stream().filter(i-&gt;i.startsWith(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">			.limit(<span class="number">1</span>)</span><br><span class="line">			.forEach(j-&gt;System.out.println(j));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç–‘é—®ï¼šåˆ›å»ºlistæ—¶ï¼Œæœ€å…ˆçš„Listå’ŒArrayListæœ‰ä½•åŒºåˆ«ï¼Ÿ</p>
<p>List<int>å¯ä»¥å—ï¼Ÿè¿˜æ˜¯è¯´å…ƒç´ å¿…é¡»ä¸ºå¼•ç”¨ç±»å‹</p>
</blockquote>
<p>é“¾å¼è¡¨è¾¾å¼ï¼šè°ƒç”¨æœ‰è¿”å›å€¼çš„æ–¹æ³•æ—¶ä¸è·å–è¿”å›å€¼è€Œæ˜¯ç›´æ¥å†è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œå®ç°èšåˆæ“ä½œï¼Œä¹Ÿè¢«ç§°ä¸ºæ“ä½œç®¡é“æµã€‚</p>
<p>æ‰§è¡ŒæŸä¸ªæ–¹æ³•è¿”å›ç±»å‹ä»ä¸ºstreamæµå¯¹è±¡çš„æ–¹æ³•å½’ä¸ºä¸­é—´æ“ä½œï¼Œå¦‚è¿‡æ»¤æˆªå–æ’åºã€‚</p>
<p>æ‰§è¡Œæ–¹æ³•åè¿”å›ç±»å‹ä¸å†æ˜¯Streamæµå¯¹è±¡çš„æ–¹æ³•å½’ä¸ºç»ˆç»“æ“ä½œï¼Œå¦‚éå†ç»Ÿè®¡æ”¶é›†ã€‚</p>
<h4 id="åˆ›å»ºStreamæµå¯¹è±¡"><a href="#åˆ›å»ºStreamæµå¯¹è±¡" class="headerlink" title="åˆ›å»ºStreamæµå¯¹è±¡"></a>åˆ›å»ºStreamæµå¯¹è±¡</h4><p>èšåˆæ“ä½œé’ˆå¯¹çš„æ˜¯å¯è¿­ä»£æ•°æ®è¿›è¡Œæ“ä½œï¼šå¦‚é›†åˆã€æ•°ç»„ã€‚å› æ­¤åˆ›å»ºStreamæµå¯¹è±¡æ˜¯å°†é›†åˆã€æ•°ç»„é€šè¿‡ä¸€äº›æ–¹æ³•è½¬æ¢ä¸ºStreamæµå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºStreamæµå¯¹è±¡çš„é›†ä¸­æ–¹æ³•</span></span><br><span class="line">Integer[] arr = &#123;<span class="number">9</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>&#125;;</span><br><span class="line"><span class="comment">//å°†æ•°ç»„è½¬æ¢ä¸ºListé›†åˆ</span></span><br><span class="line">List&lt;Integer&gt;lis=Arrays.asList(arr);</span><br><span class="line"><span class="comment">//1.ä½¿ç”¨é›†åˆå¯¹è±¡çš„stream()é™æ€æ–¹æ³•åˆ›å»ºstreamæµå¯¹è±¡</span></span><br><span class="line">Stream&lt;Integer&gt;stream=lis.stream();</span><br><span class="line">stream.forEach(i-&gt;System.out.print(i+<span class="string">&quot; &quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.ä½¿ç”¨Streamæ¥å£çš„of()é™æ€æ–¹æ³•ä¸ºåŸºæœ¬ç±»å‹åŒ…è£…ç±»æ•°ç»„ã€å¼•ç”¨ç±»å‹æ•°ç»„ã€å•ä¸ªå…ƒç´ åˆ›å»ºstreamæµå¯¹è±¡</span></span><br><span class="line">Stream&lt;Integer&gt;stream2=Stream.of(arr);</span><br><span class="line">stream2.forEach(i-&gt;System.out.print(i+<span class="string">&quot; &quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.ä½¿ç”¨Arraysæ•°ç»„å·¥å…·ç±»çš„stream()é™æ€æ–¹æ³•åˆ›å»ºstreamæµå¯¹è±¡</span></span><br><span class="line">Stream&lt;Integer&gt;stream3=Arrays.stream(arr);</span><br><span class="line">stream3.forEach(i-&gt;System.out.print(i+<span class="string">&quot; &quot;</span>));</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šé›†åˆå¯¹è±¡çš„stream()é™æ€æ–¹æ³•åªæ˜¯é’ˆå¯¹å•åˆ—é›†åˆCollectionæ¥å£å¯¹è±¡æä¾›çš„ï¼Œå¯¹Mapé›†åˆé¦–å…ˆé€šè¿‡Mapé›†åˆçš„<code>keySet()  values()  entrySet()</code>æ–¹æ³•è½¬æ¢ä¸ºå•åˆ—Seté›†åˆã€‚</p>
<h4 id="map-æ˜ å°„"><a href="#map-æ˜ å°„" class="headerlink" title="map()æ˜ å°„"></a>map()æ˜ å°„</h4><p>Streamæµå¯¹è±¡çš„map()æ–¹æ³•å¯ä»¥å°†æµå¯¹è±¡ä¸­çš„å…ƒç´ é€šè¿‡ç‰¹å®šçš„è§„åˆ™è¿›è¡Œä¿®æ”¹ç„¶åæ˜ å°„ä¸ºå¦ä¸€ä¸ªæµå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;String&gt;stream=Stream.of(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>);</span><br><span class="line">stream.map(String::toUpperCase)  <span class="comment">//æµä¸­æ‰€æœ‰å…ƒç´ å­—æ¯è½¬ä¸ºå¤§å†™</span></span><br><span class="line">	  .sorted()</span><br><span class="line">	  .forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h4 id="æˆªå–limit"><a href="#æˆªå–limit" class="headerlink" title="æˆªå–limit()"></a>æˆªå–limit()</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">stream.skip(<span class="number">1</span>)   <span class="comment">//è·³è¿‡æµä¸­çš„å‰ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">      .limit(<span class="number">2</span>)   <span class="comment">//æˆªå–å‰2ä¸ªå…ƒç´ </span></span><br><span class="line">      .forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h4 id="æ”¶é›†"><a href="#æ”¶é›†" class="headerlink" title="æ”¶é›†"></a>æ”¶é›†</h4><p>forEach()æ“ä½œæ— æ³•å°†è¿›è¡Œä¸­é—´æ“ä½œåçš„æµå…ƒç´ ä½œä¸ºæˆ‘ä»¬ç†Ÿæ‚‰çš„å¯¹è±¡æˆ–æ˜¯æ•°æ®ç±»å‹è¿›è¡Œä¿å­˜ï¼Œä¸ºæ­¤JDK8ä¸ºæ“ä½œæµå¯¹è±¡å¢åŠ äº†ä¸€ä¸ªç»ˆç»“æ“ä½œâ€”-collectã€‚</p>
<p>collectå¯ä»¥æŠŠStreamä¸­çš„å…ƒç´ ä¿å­˜ä¸ºå¦ä¸€ç§å½¢å¼ï¼Œå¦‚é›†åˆã€å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¿å­˜ä¸ºListé›†åˆ</span></span><br><span class="line">Stream&lt;String&gt;stre = Stream.of(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>);</span><br><span class="line">List&lt;String&gt;lis = stre.filter(i-&gt;i,startWith(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">					  .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†æµå…ƒç´ ä½¿ç”¨&quot;and&quot;è¿æ¥ï¼Œæ”¶é›†åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­</span></span><br><span class="line">Stream&lt;String&gt;stre = Stream.of(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">st</span> <span class="operator">=</span> stre.filter(i-&gt;i,startWith(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">					  .collect(Collectors.joining(<span class="string">&quot;and&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿å­˜ä¸ºæ•°ç»„</span></span><br><span class="line">Stream&lt;String&gt;stre = Stream.of(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>);</span><br><span class="line">String[] arr = stre.filter(i-&gt;i,startWith(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">					  .collect(Collectors.toArray());</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šä¸€ä¸ªStreamå¯ä»¥è¿›è¡Œå¤šä¸ªä¸­é—´æ“ä½œï¼Œä½†åªèƒ½è¿›è¡Œä¸€ä¸ªç»ˆç»“æ“ä½œï¼Œä¸€æ—¦è¿›è¡Œäº†ç»ˆç»“æ“ä½œï¼Œæµå¯¹è±¡å°±ä¸å¤å­˜åœ¨äº†ã€‚å› æ­¤ï¼Œåªèƒ½ä¿å­˜ä¸€æ¬¡ã€‚</p>
<h4 id="Parrel-Streamå¹¶è¡Œæµ"><a href="#Parrel-Streamå¹¶è¡Œæµ" class="headerlink" title="Parrel Streamå¹¶è¡Œæµ"></a>Parrel Streamå¹¶è¡Œæµ</h4><p>JDK8é’ˆå¯¹å¤§æ‰¹é‡æ•°æ®æä¾›å¹¶è¡Œæµï¼Œå¹¶è¡Œæµæ˜¯å°†æºæ•°æ®åˆ†ä¸ºå¤šä¸ªå­æµå¯¹è±¡è¿›è¡Œå¤šçº¿ç¨‹æ“ä½œï¼ˆå¤šä¸ªç®¡é“æµï¼‰ï¼Œç„¶åå°†å¤„ç†çš„ç»“æœå†æ±‡æ€»ä¸ºä¸€ä¸ªæµå¯¹è±¡ã€‚</p>
<p>å¹¶è¡Œæµå¯ä»¥æé«˜ç¨‹åºæ‰§è¡Œæ•ˆç‡ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹æ‰§è¡Œæ—¶ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œéœ€è¦ä¿è¯æºæ•°æ®åœ¨å¹¶è¡Œæ‰§è¡Œæ—¶ä¸ä¼šè¢«æ”¹å˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºListé›†åˆæ•°æ®æº</span></span><br><span class="line">List&lt;String&gt;lis = Arrays.asList(<span class="string">&quot;aa&quot;</span>,<span class="string">&quot;bb&quot;</span>,<span class="string">&quot;cc&quot;</span>);</span><br><span class="line"><span class="comment">//1.ç›´æ¥ç”¨Collectionæ¥å£çš„parallelStream()åˆ›å»ºå¹¶è¡Œæµ</span></span><br><span class="line">Stream&lt;String&gt;para = lis.parallelStream();</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºå¹¶è¡Œæµ</span></span><br><span class="line">System.out.println(para.isParallel());</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.ä½¿ç”¨BaseStreamæ¥å£çš„parallel()æ–¹æ³•å°†ä¸²è¡Œæµè½¬å˜ä¸ºå¹¶è¡Œæµ</span></span><br><span class="line">Stream&lt;String&gt;str = Stream.of(<span class="string">&quot;aa&quot;</span>,<span class="string">&quot;bb&quot;</span>.<span class="string">&quot;cc&quot;</span>);</span><br><span class="line">Stream&lt;String&gt;para = str.parallel();</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºå¹¶è¡Œæµ</span></span><br><span class="line">System.out.println(para.isParallel());</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠJavaåŸºç¡€å…¥é—¨ã€‹ä¹‹GUI</title>
    <url>/2021/11/26/myblog/java/%E3%80%8Ajava%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E3%80%8B%E4%B9%8BGUI/</url>
    <content><![CDATA[<p>GUIï¼šGraphical User Interface å›¾å½¢ç”¨æˆ·æ¥å£ã€‚ç”¨æ¥æä¾›ç»™ç”¨æˆ·æ“ä½œçš„å›¾åƒç•Œé¢çš„æ¥å£ã€‚</p>
<p>javaé’ˆå¯¹GUIè®¾è®¡æä¾›äº†ä¸€äº›åŸºæœ¬çš„å›¾å½¢ç”¨æˆ·æ¥å£å¼€å‘å·¥å…·ï¼Œå¦‚AWTã€Swingã€JavaFXã€‚</p>
<p>AWTæ˜¯sunå…¬å¸æœ€æ—©æ¨å‡ºçš„ä¸€å¥—APIï¼Œç»„ä»¶ç§ç±»æœ‰é™ï¼Œæ— æ³•å®ç°GUIè®¾è®¡çš„å…¨éƒ¨åŠŸèƒ½ã€‚</p>
<h2 id="Swingæ¦‚è¿°"><a href="#Swingæ¦‚è¿°" class="headerlink" title="Swingæ¦‚è¿°"></a>Swingæ¦‚è¿°</h2><p>æ—©æœŸJDK1.0å‘å¸ƒæ—¶ï¼Œå°±ä¸ºGUIå¼€å‘æä¾›äº†ä¸€å¥—åŸºç¡€ç±»åº“ï¼ˆAWTï¼‰ï¼Œå³æŠ½è±¡çª—å£å·¥å…·åŒ…ã€‚AWTéœ€è¦ç‰ºç‰²åŠŸèƒ½æ¥å®ç°å¹³å°æ— å…³æ€§ã€‚å› æ­¤ï¼ŒSunå…¬å¸å¯¹AWTè¿›è¡Œæ”¹è¿›ï¼Œæå‡ºSwingç»„ä»¶ï¼Œæä¾›æ›´åŠ ä¸°å¯Œçš„ç»„ä»¶å’ŒåŠŸèƒ½ï¼Œæ¥æ»¡è¶³GUIè®¾è®¡çš„ä¸€åˆ‡éœ€æ±‚ã€‚</p>
<p>Swingæ˜¯ä¸€ç»„è½»é‡çº§ç»„ä»¶ï¼Œç”±Javaè¯­è¨€å¼€å‘ï¼ŒåŒæ—¶åº•å±‚ä»¥AWTä¸ºåŸºç¡€ã€‚Swingå¹¶ä¸æ˜¯AWTçš„æ›¿ä»£å“ï¼Œè€Œæ˜¯åœ¨åŸæœ‰çš„AWTçš„åŸºç¡€ä¸Šè¿›è¡Œè¡¥å……å’Œæ”¹è¿›ã€‚</p>
<p>Swingç»„ä»¶çš„æ‰€æœ‰ç±»éƒ½ç»§æ‰¿è‡ªContainerç±»ï¼Œç„¶åæ ¹æ®GUIå¼€å‘çš„åŠŸèƒ½æ‰©å±•äº†ä¸¤ä¸ªä¸»è¦åˆ†æ”¯ï¼šå®¹å™¨åˆ†æ”¯ï¼ˆWindowçª—å£å’ŒPanelé¢æ¿ï¼‰å’Œç»„ä»¶åˆ†æ”¯ã€‚</p>
<p>å®¹å™¨åˆ†æ”¯æ˜¯ä¸ºäº†å®ç°å›¾å½¢ç”¨æˆ·ç•Œé¢çª—å£å®¹å™¨è€Œè®¾è®¡çš„ã€‚</p>
<p>ç»„ä»¶åˆ†æ”¯æ˜¯ä¸ºäº†å®ç°å‘å®¹å™¨ä¸­å¡«å……æ•°æ®ã€å…ƒç´ ä»¥åŠäººæœºäº¤äº’ç»„ä»¶ç­‰åŠŸèƒ½ã€‚</p>
<p>Swingç»„ä»¶ç±»ä¸­å¸¸ç”¨çš„é¡¶çº§å®¹å™¨ç±»åŒ…æ‹¬ï¼šJAppletã€JFrameå’ŒJDialogã€‚å¸¸ç”¨çš„ç»„ä»¶ç±»ï¼šAbstractButtonç±»åŠå…¶å­ç±»å°±æ˜¯ç”¨æ¥å®šä¹‰æŒ‰é’®å¸¸è§è¡Œä¸ºçš„å·¥å…·ç±»ï¼ŒJTextComponentç±»åŠå…¶å­ç±»å°±æ˜¯ç”¨æ¥å®šä¹‰æ–‡æœ¬å†…å®¹ç¼–è¾‘åŒºåŸŸçš„å·¥å…·ç±»ã€‚</p>
<h2 id="JavaFXæ¦‚è¿°"><a href="#JavaFXæ¦‚è¿°" class="headerlink" title="JavaFXæ¦‚è¿°"></a>JavaFXæ¦‚è¿°</h2><p>JavaFXåŒSwingä¸€æ ·ï¼Œéƒ½ç”¨äºå¤„ç†å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å›¾å½¢å’Œå¤šåª’ä½“å¤„ç†å·¥å…·åŒ…é›†åˆï¼Œå…è®¸å¼€å‘è€…è®¾è®¡ã€åˆ›å»ºã€æµ‹è¯•ã€è°ƒè¯•å’Œéƒ¨ç½²å¯Œå®¢æˆ·ç«¯ç¨‹åºï¼Œå¹¶ä¸”å’ŒJavaä¸€æ ·å…·æœ‰è·¨å¹³å°ç‰¹æ€§ã€‚</p>
<p>Sunå…¬å¸äº2008å¹´æ¨å‡ºJavaFXï¼Œæ¥å¼¥è¡¥Javaåœ¨æ¡Œé¢åº”ç”¨ç¨‹åºçš„ç¼ºé™·ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠJavaåŸºç¡€å…¥é—¨ã€‹IO</title>
    <url>/2021/11/25/myblog/java/%E3%80%8Ajava%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E3%80%8B%E4%B9%8BIO%E6%B5%81/</url>
    <content><![CDATA[<h2 id="I-Oæµæ¦‚è¿°"><a href="#I-Oæµæ¦‚è¿°" class="headerlink" title="I&#x2F;Oæµæ¦‚è¿°"></a>I&#x2F;Oæµæ¦‚è¿°</h2><p>javaä¸­å°†ä¸åŒè¾“å…¥è¾“å‡ºè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“æŠ½è±¡è¡¨è¿°ä¸ºâ€œæµâ€ã€‚</p>
<p>åˆ†ç±»1ï¼šæ ¹æ®æ“ä½œçš„æ•°æ®å•ä½ä¸åŒï¼Œåˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚</p>
<p>åˆ†ç±»2ï¼šæ ¹æ®ä¼ è¾“æ–¹å‘ï¼Œåˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµã€‚è¾“å…¥æµåªèƒ½ä»æµä¸­è¯»å–æ•°æ®ï¼Œè€Œä¸èƒ½å†™å…¥æ•°æ®ï¼›è¾“å‡ºæµåªèƒ½å‘æµä¸­å†™å…¥æ•°æ®ï¼Œè€Œä¸èƒ½ä»ä¸­è¯»å–æ•°æ®ã€‚</p>
<p>åˆ†ç±»3ï¼šæ ¹æ®æµçš„åŠŸèƒ½ä¸åŒï¼Œåˆ†ä¸ºèŠ‚ç‚¹æµå’Œå¤„ç†æµã€‚èŠ‚ç‚¹æµè¢«ç§°ä¸ºä½çº§æµï¼ŒæŒ‡å¯ä»¥ä»ä¸€ä¸ªç‰¹å®šçš„I&#x2F;Oè®¾å¤‡è¯»å†™æ•°æ®çš„æµï¼Œå®ƒåªèƒ½ç›´æ¥è¿æ¥æ•°æ®æºï¼Œè¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œã€‚å¤„ç†æµä¹Ÿè¢«ç§°ä¸ºé«˜çº§æµï¼Œç”¨äºå¯¹ä¸€ä¸ªå·²å­˜åœ¨çš„èŠ‚ç‚¹æµè¿›è¡Œè¿æ¥å’Œå°è£…ï¼Œé€šè¿‡å°è£…åçš„æµæ¥å®ç°æµçš„è¯»å†™èƒ½åŠ›ã€‚å½“ä½¿ç”¨å¤„ç†æµæ—¶ï¼Œç¨‹åºä¸ä¼šç›´æ¥è¿æ¥åˆ°å®é™…çš„æ•°æ®æºï¼Œè€Œæ˜¯è¿æ¥åœ¨å·²å­˜åœ¨çš„æµä¹‹ä¸Šã€‚</p>
<p>javaä¸­çš„I&#x2F;Oæµä¸»è¦å®šä¹‰åœ¨java.ioåŒ…ä¸­ï¼Œè¯¥åŒ…æœ‰å››ä¸ªé¡¶çº§ç±»ï¼Œéƒ½æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯æ‰€æœ‰æµç±»å‹çš„çˆ¶ç±»ã€‚</p>
<p><img src="/images/IO%E6%B5%81.jpg"></p>
<h2 id="å­—èŠ‚æµ"><a href="#å­—èŠ‚æµ" class="headerlink" title="å­—èŠ‚æµ"></a>å­—èŠ‚æµ</h2><p>è®¡ç®—æœºä¸­ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯äºŒè¿›åˆ¶ï¼ˆå­—èŠ‚ï¼‰å½¢å¼å­˜åœ¨çš„ã€‚JDKæä¾›äº†<code>InputStream</code>å’Œ<code>OutputStream</code>ã€‚å­—èŠ‚è¾“å…¥æµï¼šä»æºè®¾å¤‡ç»æµä¸­èµ°å‘ç¨‹åºã€‚å­—èŠ‚è¾“å‡ºæµï¼šä»ç¨‹åºè¾“å‡ºç»æµä¸­èµ°å‘ç›®æ ‡ã€‚è¾“å…¥è¾“å‡ºæ˜¯ç›¸å¯¹ç¨‹åºè€Œè¨€çš„ï¼Œè¾“å…¥åˆ°è¾“å‡ºåˆ°çš„æ„æ€ã€‚</p>
<h3 id="æ–‡ä»¶çš„è¯»å†™"><a href="#æ–‡ä»¶çš„è¯»å†™" class="headerlink" title="æ–‡ä»¶çš„è¯»å†™"></a>æ–‡ä»¶çš„è¯»å†™</h3><p>é’ˆå¯¹æ–‡ä»¶çš„è¯»å†™ï¼Œæœ‰ä¸¤ä¸ªç±»ï¼š<code>FileInputStream</code>å’Œ<code>FileOutputStream</code>ã€‚</p>
<p><code>FileInputStream</code>æ˜¯<code>InputStream</code>çš„å­ç±»ï¼Œç”±äºä»æ–‡ä»¶è¯»å–æ•°æ®æ˜¯é‡å¤çš„æ“ä½œï¼Œå› æ­¤éœ€è¦é€šè¿‡å¾ªç¯è¯­å¥æ¥å®ç°æ•°æ®çš„æŒç»­è¯»å–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">		<span class="comment">//åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å­—èŠ‚è¾“å…¥æµæ¥è¯»å–æ–‡ä»¶</span></span><br><span class="line">		<span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">		<span class="comment">//å®šä¹‰intå˜é‡</span></span><br><span class="line">		<span class="type">int</span> b=<span class="number">0</span>; </span><br><span class="line">		<span class="comment">//é€šè¿‡å¾ªç¯è¯»å–æ–‡ä»¶ï¼Œå½“è¿”å›å€¼ä¸º-1ç»“æŸå¾ªç¯</span></span><br><span class="line">		<span class="keyword">while</span>((b=in.read())!=-<span class="number">1</span>)&#123;</span><br><span class="line">			System.out.println(b);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//å…³é—­æµ</span></span><br><span class="line">		in.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚å†…å®¹ä¸ºhelloï¼Œå­—ç¬¦å ä¸€ä¸ªå­—èŠ‚ï¼Œå› æ­¤æ˜¾ç¤ºçš„æ˜¯è¿™äº”ä¸ªå­—èŠ‚æ‰€å¯¹åº”çš„ASCIIç å€¼ã€‚</p>
<p><code>FileOutputStream</code>è´Ÿè´£å°†æ•°æ®å†™å…¥æ–‡ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">		<span class="comment">//åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å­—èŠ‚è¾“å‡ºæµæ¥å†™æ–‡ä»¶</span></span><br><span class="line">		<span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;out.txt&quot;</span>);</span><br><span class="line">		<span class="comment">//å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">		<span class="comment">//å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„è¿›è¡Œå†™å…¥æ“ä½œ</span></span><br><span class="line">		out.write(str.getBytes());</span><br><span class="line">		<span class="comment">//å…³é—­æµ</span></span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‹¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™ä¼šé¦–å…ˆå°†æ–‡ä»¶ä¸­å†…å®¹æ“¦ç©ºï¼Œå†å†™å…¥ã€‚</p>
<p>è‹¥æƒ³è¿½åŠ å†…å®¹ï¼š<code>FileOutputStream out = new FileOutputStream(&quot;out.txt&quot;, true);</code></p>
<p>I&#x2F;Oæµåœ¨è¿›è¡Œæ•°æ®è¯»å†™æ—¶ï¼Œä¼šå‡ºç°å¼‚å¸¸ï¼Œä¸Šè¿°ä»£ç ä½¿ç”¨throwså°†å¼‚å¸¸æŠ›å‡ºã€‚ä½†æ˜¯ä¸€æ—¦é‡åˆ°I&#x2F;Oå¼‚å¸¸ï¼Œcloseæ–¹æ³•æ— æ³•æ‰§è¡Œï¼Œæµå¯¹è±¡æ‰€å ç”¨çš„ç³»ç»Ÿèµ„æºå°†ä¸èƒ½é‡Šæ”¾ã€‚å› æ­¤é€šå¸¸å°†å…³é—­æµçš„æ“ä½œå†™åœ¨finallyä»£ç å—ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">finally</span>&#123;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(in!=<span class="literal">null</span>)  in.close();</span><br><span class="line">	&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(out!=<span class="literal">null</span>)  out.close();</span><br><span class="line">	&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡ä»¶çš„æ‹·è´"><a href="#æ–‡ä»¶çš„æ‹·è´" class="headerlink" title="æ–‡ä»¶çš„æ‹·è´"></a>æ–‡ä»¶çš„æ‹·è´</h3><p>é€šè¿‡è¾“å…¥æµæ¥è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå¹¶é€šè¿‡è¾“å‡ºæµå°†æ•°æ®å†™å…¥æ–°æ–‡ä»¶ã€‚</p>
<p>å®šä¹‰ä¸€æ¬¡è¾“å‡ºæµåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå®šä¹‰ä¹‹åå¤šæ¬¡å†™å…¥ï¼Œéƒ½æ˜¯è¿½åŠ çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">		<span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;source/src.jpg&quot;</span>)</span><br><span class="line">		<span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;target/src.jpg&quot;</span>);</span><br><span class="line">		<span class="type">int</span> b=<span class="number">0</span>;</span><br><span class="line">		<span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">while</span>((b=in.read())!=-<span class="number">1</span>)&#123;</span><br><span class="line">			out.write(b);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">&quot;èŠ±è´¹æ—¶é—´ä¸ºï¼š&quot;</span>+(endTime-beginTime)+<span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line">		<span class="comment">//å…³é—­æµ</span></span><br><span class="line">		in.close();</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å­—èŠ‚æµçš„ç¼“å†²åŒº"><a href="#å­—èŠ‚æµçš„ç¼“å†²åŒº" class="headerlink" title="å­—èŠ‚æµçš„ç¼“å†²åŒº"></a>å­—èŠ‚æµçš„ç¼“å†²åŒº</h3><p>ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åœ°æ‹·è´ï¼Œéœ€è¦é¢‘ç¹æ“ä½œæ–‡ä»¶ï¼Œå› æ­¤æ„å»ºä¸€ä¸ªå­—èŠ‚æ•°ç»„ä½œä¸ºä¸´æ—¶ç¼“å†²åŒºã€‚å¯ä»¥ä¸€æ¬¡æ€§è¯»å†™ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">		<span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;source/src.jpg&quot;</span>);</span><br><span class="line">		<span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;target/src.jpg&quot;</span>);</span><br><span class="line">		<span class="type">int</span> len=<span class="number">0</span>;</span><br><span class="line">		<span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">		<span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">while</span>((len=in.read(buffer))!=-<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="comment">//é€šè¿‡å˜é‡lenè®°ä½è¯»å…¥æ•°ç»„çš„å­—èŠ‚æ•°ï¼Œlenè¡¨ç¤ºè¯»å–å­—èŠ‚çš„æ•°ç›®</span></span><br><span class="line">			out.write(buffer, <span class="number">0</span>, len); <span class="comment">//ä»bufferçš„0ä½ç½®å¼€å§‹å†™å…¥lenä¸ªå­—èŠ‚</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">&quot;èŠ±è´¹æ—¶é—´ä¸ºï¼š&quot;</span>+(endTime-beginTime)+<span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line">		<span class="comment">//å…³é—­æµ</span></span><br><span class="line">		in.close();</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>readæ–¹æ³•å†…æ— ä¸œè¥¿æ—¶ï¼Œè¡¨ç¤ºä»è¾“å…¥æµè¯»å–ä¸€ä¸ª8ä½çš„å­—èŠ‚ï¼ŒæŠŠå®ƒè½¬æ¢ä¸º0-255çš„æ•´æ•°ï¼Œå¹¶è¿”å›è¿™ä¸ªæ•´æ•°ï¼Œå½“æ²¡æœ‰å¯ç”¨å­—èŠ‚æ—¶ï¼Œå°†è¿”å›-1ã€‚</p>
<p>readæ–¹æ³•å†…æ˜¯byteæ•°ç»„æ—¶ï¼Œè¡¨ç¤ºè¯»å–è‹¥å¹²å­—èŠ‚ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æŒ‡å®šçš„å­—èŠ‚æ•°ç»„ä¸­ï¼Œè¿”å›æ•´æ•°è¡¨ç¤ºè¯»å–çš„å­—èŠ‚çš„æ•°ç›®ã€‚</p>
<p>writeæ–¹æ³•å†…ï¼Œä¸€ä¸ªintè¡¨ç¤ºå†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå­—èŠ‚æ•°ç»„è¡¨ç¤ºå†™å…¥å­—èŠ‚æ•°ç»„ä¸­çš„æ‰€æœ‰å­—èŠ‚ï¼Œä¹Ÿå¯ä»¥å†™å…¥æŒ‡å®šæ•°ç›®å­—èŠ‚ã€‚</p>
<p>è¾“å‡ºæµçš„flush()æ–¹æ³•è¡¨ç¤ºå°†è¾“å‡ºç¼“å†²åŒºï¼ˆé€šå¸¸æ˜¯å­—èŠ‚æ•°ç»„ï¼‰ä¸­çš„æ•°æ®å¼ºåˆ¶å†™å…¥ç›®æ ‡è®¾å¤‡ï¼Œæ­¤è¿‡ç¨‹ç§°ä¸ºåˆ·æ–°ã€‚</p>
</blockquote>
<h3 id="å­—èŠ‚ç¼“å†²æµ"><a href="#å­—èŠ‚ç¼“å†²æµ" class="headerlink" title="å­—èŠ‚ç¼“å†²æµ"></a>å­—èŠ‚ç¼“å†²æµ</h3><p>I&#x2F;OåŒ…ä¸­æä¾›äº†ä¸¤ä¸ªå¸¦ç¼“å†²çš„å­—èŠ‚æµï¼Œåˆ†åˆ«ä¸º<code>BufferedInputStream</code>å’Œ<code>BufferedOutputStream</code>ï¼Œå®ƒä»¬çš„æ„é€ æ–¹æ³•ä¸­åˆ†åˆ«æ¥æ”¶<code>InputStream</code>å’Œ<code>OutputStream</code>ç±»å‹çš„å‚æ•°ä½œä¸ºå¯¹è±¡ã€‚å†è¯»å†™æ•°æ®æ—¶æä¾›ç¼“å†²åŠŸèƒ½ã€‚</p>
<p>å…¶å®å°±åƒæ˜¯ä¸Šä¸€èŠ‚çš„ç³»ç»Ÿå®ç°ã€‚</p>
<p>å…³ç³»ï¼šæºè®¾å¤‡â€”å­—èŠ‚æµâ€”å­—èŠ‚ç¼“å†²æµâ€”åº”ç”¨ç¨‹åºâ€”å­—èŠ‚ç¼“å†²æµâ€”å­—èŠ‚æµâ€”ç›®æ ‡è®¾å¤‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">		<span class="type">BufferedInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;source/src.jpg&quot;</span>));</span><br><span class="line">		<span class="type">BufferedOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;target/src.jpg&quot;</span>));</span><br><span class="line">		<span class="type">int</span> len=<span class="number">0</span>;</span><br><span class="line">		<span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">while</span>((len=in.read())!=-<span class="number">1</span>)&#123;</span><br><span class="line">			out.write(len)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">&quot;èŠ±è´¹æ—¶é—´ä¸ºï¼š&quot;</span>+(endTime-beginTime)+<span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line">		<span class="comment">//å…³é—­æµ</span></span><br><span class="line">		in.close();</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼“å†²æµå¯¹è±¡å†…éƒ¨éƒ½å®šä¹‰äº†ä¸€ä¸ªå¤§å°ä¸º8192çš„å­—èŠ‚æ•°ç»„ã€‚è¯»å†™éƒ½æ˜¯åˆ°ä¸€ä¸ªå­—èŠ‚æ•°ç»„ä¸­ï¼Œå……å½“ç¼“å†²ã€‚</p>
<h2 id="å­—ç¬¦æµ"><a href="#å­—ç¬¦æµ" class="headerlink" title="å­—ç¬¦æµ"></a>å­—ç¬¦æµ</h2><p>Readeræ˜¯å­—ç¬¦è¾“å…¥æµï¼Œç”¨äºä»æŸä¸ªæºè®¾å¤‡è¯»å–å­—ç¬¦ã€‚Writeræ˜¯å­—ç¬¦è¾“å‡ºæµã€‚ç”¨äºå‘æŸä¸ªç›®æ ‡è®¾å¤‡å†™å…¥å­—ç¬¦ã€‚</p>
<p>è¾“å…¥è¾“å‡ºæ˜¯ç›¸å¯¹ç¨‹åºè€Œè¨€çš„ï¼Œè¾“å…¥åˆ°è¾“å‡ºåˆ°çš„æ„æ€ã€‚è¯»å’Œå†™æ˜¯è¯»åˆ°ç¨‹åºå’Œä»ç¨‹åºä¸­å†™å‡ºçš„æ„æ€ã€‚</p>
<h3 id="å­—ç¬¦æµæ“ä½œæ–‡ä»¶"><a href="#å­—ç¬¦æµæ“ä½œæ–‡ä»¶" class="headerlink" title="å­—ç¬¦æµæ“ä½œæ–‡ä»¶"></a>å­—ç¬¦æµæ“ä½œæ–‡ä»¶</h3><p>ä»æ–‡ä»¶è¯»å–å­—ç¬¦ç”¨å­—ç¬¦è¾“å…¥æµFileReaderã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">		<span class="type">FileReader</span> <span class="variable">fileReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;reader.txt&quot;</span>);</span><br><span class="line">		<span class="type">int</span> b=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((b=fileReader.read())!=-<span class="number">1</span>)&#123;</span><br><span class="line">			System.out.print((<span class="type">char</span>)b)</span><br><span class="line">		&#125;</span><br><span class="line">		fileReader.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>readè¿”å›çš„æ˜¯intç±»å‹ï¼Œå› æ­¤è¦è·å¾—å­—ç¬¦éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p>
<p>å‘æ–‡ä»¶ä¸­å†™å…¥å­—ç¬¦ç”¨FileWriterç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">		<span class="type">FileWriter</span> <span class="variable">fileWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;writer.txt&quot;</span>);</span><br><span class="line">		fileWriter.write(<span class="string">&quot;ä½ å¥½,\r\n&quot;</span>);</span><br><span class="line">		fileWriter.write(<span class="string">&quot;ä¸–ç•Œã€‚\r\n&quot;</span>);</span><br><span class="line">		fileWriterr.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†™å…¥æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨åˆ™å…ˆæ¸…ç©ºï¼Œé¡¹è¿½åŠ çš„è¯ï¼Œåˆ™æ„é€ æ—¶åé¢åŠ trueã€‚</p>
<p>ä¸å­—èŠ‚æµç±»ä¼¼ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥åŠ å­—ç¬¦æµç¼“å†²åŒº</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> len=<span class="number">0</span>;</span><br><span class="line"><span class="type">char</span>[] buff=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">while</span>((len=fileReader.read(buff))!=-<span class="number">1</span>)&#123;</span><br><span class="line">	fileWriter.write(buff, <span class="number">0</span>, len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ç¼“å†²æµ"><a href="#å­—ç¬¦ç¼“å†²æµ" class="headerlink" title="å­—ç¬¦ç¼“å†²æµ"></a>å­—ç¬¦ç¼“å†²æµ</h3><p>å­—ç¬¦æµä¹Ÿæä¾›äº†å¸¦ç¼“å†²åŒºçš„å­—ç¬¦ç¼“å†²æµï¼Œ<code>BufferedReader</code>å’Œ<code>BufferedWriter</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">	    <span class="comment">//åˆ›å»ºå­—ç¬¦è¾“å…¥ç¼“å†²æµå¯¹è±¡</span></span><br><span class="line">	    <span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;read.txt&quot;</span>));</span><br><span class="line">	    <span class="comment">//åˆ›å»ºå­—ç¬¦è¾“å‡ºç¼“å†²æµå¯¹è±¡</span></span><br><span class="line">	    <span class="type">BufferedWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;write.txt&quot;</span>));</span><br><span class="line">	    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	    <span class="keyword">while</span>((str=in.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">	    	out.write(str);</span><br><span class="line">	    	out.newLine();</span><br><span class="line">	    &#125;</span><br><span class="line">	    in.close();</span><br><span class="line">	    out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>BufferedReader</code>çš„readLine()æ–¹æ³•ï¼Œç”¨äºä¸€æ¬¡è¯»å–ä¸€è¡Œæ–‡æœ¬ã€‚</p>
<h2 id="è½¬æ¢æµ"><a href="#è½¬æ¢æµ" class="headerlink" title="è½¬æ¢æµ"></a>è½¬æ¢æµ</h2><p>JDKä¸­æä¾›äº†ä¸¤ä¸ªç±»å®ç°å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµã€‚</p>
<p>å­—èŠ‚è¾“å…¥æµè½¬å˜ä¸ºå­—ç¬¦è¾“å…¥æµï¼š<code>InputStreamReader</code></p>
<p>å­—èŠ‚è¾“å‡ºæµè½¬å˜ä¸ºå­—ç¬¦è¾“å‡ºæµï¼š<code>OutputStreamWriter</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºå­—èŠ‚è¾“å…¥æµï¼Œè·å–æºæ–‡ä»¶</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;read.txt&quot;</span>);</span><br><span class="line"><span class="comment">//å°†å­—èŠ‚è¾“å…¥æµå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦è¾“å…¥æµå¯¹è±¡</span></span><br><span class="line"><span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in);</span><br><span class="line"><span class="comment">//åˆ›å»ºå­—ç¬¦è¾“å…¥ç¼“å†²æµå¯¹è±¡</span></span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(isr);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºå­—èŠ‚è¾“å‡ºæµï¼ŒæŒ‡å®šç›®æ ‡æ–‡ä»¶</span></span><br><span class="line"><span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;write.txt&quot;</span>);</span><br><span class="line"><span class="comment">//å°†å­—èŠ‚è¾“å‡ºæµå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦è¾“å‡ºæµå¯¹è±¡</span></span><br><span class="line"><span class="type">OutputStreamWriter</span> <span class="variable">osw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamReader</span>(out);</span><br><span class="line"><span class="comment">//åˆ›å»ºå­—ç¬¦è¾“å‡ºç¼“å†²æµå¯¹è±¡</span></span><br><span class="line"><span class="type">BufferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(osw);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç–‘é—®ï¼Œä¸æ˜ç™½æ„ä¹‰ä½•åœ¨ï¼Œæ–‡ä»¶æ—¶å­—èŠ‚ç æ–‡ä»¶ï¼Œç¨‹åºä¾§ç”¨å­—ç¬¦æµæœ‰ä½•ç›Šå¤„ã€‚</p>
</blockquote>
<h2 id="Fileç±»"><a href="#Fileç±»" class="headerlink" title="Fileç±»"></a>Fileç±»</h2><p>é€šè¿‡I&#x2F;Oæµå¯ä»¥å¯¹æ–‡ä»¶çš„å†…å®¹è¿›è¡Œè¯»å†™æ“ä½œï¼Œä½†æ˜¯å¯¹æ–‡ä»¶æœ¬èº«è¿›è¡Œä¸€äº›å¸¸è§„æ“ä½œï¼Œä¾‹å¦‚åˆ›å»ºã€åˆ é™¤ã€é‡å‘½åç­‰ï¼ŒJDKæä¾›äº†ä¸€ä¸ªFileç±»ã€‚</p>
<p>Fileç±»ç”¨äºå°è£…ä¸€ä¸ªè·¯å¾„ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚è¯¥ç±»ä¸»è¦ç”¨äºæ–‡ä»¶å’Œç›®å½•çš„åˆ›å»ºã€æ–‡ä»¶çš„æŸ¥æ‰¾å’Œæ–‡ä»¶çš„åˆ é™¤ç­‰ã€‚</p>
<p>Fileå¯¹è±¡ä»£è¡¨ç£ç›˜ä¸­å®é™…å­˜åœ¨çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirList</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">dirname</span> <span class="operator">=</span> <span class="string">&quot;/java&quot;</span>;</span><br><span class="line">        <span class="type">File</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dirname);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶/æ–‡ä»¶å¤¹åç§°ï¼š&quot;</span>+f1.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–‡ä»¶/æ–‡ä»¶å¤¹å¤§å°ï¼š&quot;</span>+f1.length()+<span class="string">&quot;bytes&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (f1.isDirectory()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Directory of &quot;</span> + dirname);</span><br><span class="line">            String s[] = f1.list();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length; i++) &#123;</span><br><span class="line">                <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dirname + <span class="string">&quot;/&quot;</span> + s[i]);</span><br><span class="line">                <span class="keyword">if</span> (f.isDirectory()) &#123;</span><br><span class="line">                    System.out.println(s[i] + <span class="string">&quot; is a directory&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(s[i] + <span class="string">&quot; is a file&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(dirname + <span class="string">&quot; is not a directory&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦æˆåŠŸåˆ é™¤ï¼š&quot;</span>+f1.delete());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éå†æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œç”¨listæ–¹æ³•ï¼Œé™¤äº†ä¸Šé¢çš„æ–¹æ³•å¤–ï¼Œè¿˜å¯ä»¥é‡‡ç”¨æ•°ç»„å·¥å…·ç±»Arraysçš„streamæ–¹æ³•è¿›è¡Œéå†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line">String[] fileNames = file.list();</span><br><span class="line">Arrays.stream(fileNames).forEach(f-&gt;System.out.println(f));</span><br></pre></td></tr></table></figure>

<p>è‹¥æ˜¯æƒ³è¦è·å¾—æŒ‡å®šç±»å‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚.txtæ–‡ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‘listä¼ å…¥lambdaè¡¨è¾¾å¼å½¢å¼çš„å‚æ•°ï¼Œè¿›è¡Œè¿‡æ»¤ã€‚</span></span><br><span class="line">String[] fileNames=file.list((dir,name)-&gt;name.endsWith(<span class="string">&quot;.txt&quot;</span>));</span><br><span class="line">Arrays.stream(fileNames).forEach(f-&gt;System.out.println(f));</span><br></pre></td></tr></table></figure>

<p>è‹¥æ˜¯è¦éå†æ‰€æœ‰æ–‡ä»¶åŠç›®å½•ï¼ŒåŒ…æ‹¬å­ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ä½¿ç”¨listFilesæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªFileå¯¹è±¡æ•°ç»„ã€‚è¿›è¡Œé€’å½’ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;è·¯å¾„&quot;</span>);</span><br><span class="line">        func(file);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//éå†ç›®å½•åŠå…¶å­ç›®å½•æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">func</span><span class="params">(File file)</span>&#123;</span><br><span class="line">        File[] listFiles=file.listFiles();</span><br><span class="line">        <span class="keyword">for</span>(File files:listFiles)&#123;</span><br><span class="line">            <span class="keyword">if</span>(files.isDirectory())&#123;</span><br><span class="line">                func(files);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(files);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šjavaä¸­çš„åˆ é™¤æ–‡ä»¶æ˜¯é€šè¿‡javaè™šæ‹Ÿæœºç›´æ¥åˆ é™¤çš„ï¼Œè€Œä¸èµ°å›æ”¶ç«™ã€‚</p>
</blockquote>
<h2 id="RandomAccessFile"><a href="#RandomAccessFile" class="headerlink" title="RandomAccessFile"></a>RandomAccessFile</h2><p>ä¸å±äºæµç±»ï¼Œä½†å…·æœ‰è¯»å†™æ–‡ä»¶æ•°æ®çš„åŠŸèƒ½ï¼Œå¯ä»¥éšæœºä»æ–‡ä»¶çš„ä»»ä½•ä½ç½®å¼€å§‹æ‰§è¡Œè¯»å†™æ•°æ®çš„æ“ä½œã€‚</p>
<h2 id="å¯¹è±¡åºåˆ—åŒ–"><a href="#å¯¹è±¡åºåˆ—åŒ–" class="headerlink" title="å¯¹è±¡åºåˆ—åŒ–"></a>å¯¹è±¡åºåˆ—åŒ–</h2><p>ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å°†ä¸€äº›æ•°æ®æ°¸ä¹…åœ°ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ•°æ®åœ¨javaä¸­éƒ½æ˜¯ä¿å­˜åœ¨å¯¹è±¡å½“ä¸­çš„ï¼Œå¦‚ä½•å°†å¯¹è±¡ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œå°±ç”¨javaä¸­çš„å¯¹è±¡åºåˆ—åŒ–ã€‚</p>
<p>å¯¹è±¡çš„åºåˆ—åŒ–ï¼ˆSerializableï¼‰æ˜¯æŒ‡å°†ä¸€ä¸ªJavaå¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªI&#x2F;Oæµä¸­å­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ã€‚å¯ä»¥ä½¿å†…å­˜ä¸­çš„Javaå¯¹è±¡è½¬æ¢æˆä¸å¹³å°æ— å…³çš„äºŒè¿›åˆ¶æµã€‚</p>
<p>å°†I&#x2F;Oæµä¸­çš„å­—èŠ‚åºåˆ—æ¢å¤ä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹â€“ååºåˆ—åŒ–ã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ç‹¬ç«‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªå¹³å°ä¸Šåºåˆ—åŒ–çš„å¯¹è±¡å¯ä»¥åœ¨å¦ä¸€ä¸ªå®Œå…¨ä¸åŒçš„å¹³å°ä¸Šååºåˆ—åŒ–è¯¥å¯¹è±¡ã€‚</p>
<p>æƒ³è®©å¯¹è±¡åºåˆ—åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡æ‰€åœ¨çš„ç±»å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¿…é¡»å®ç°Serializableæˆ–Externalizableä¸¤ä¸ªæ¥å£ä¹‹ä¸€ã€‚Externalizableæ€§èƒ½å¥½ä½†æ˜¯ç¼–ç¨‹å¤æ‚ï¼Œå› æ­¤å¤§éƒ¨åˆ†é‡‡ç”¨Serializableã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializeDemo</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String [] args)</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="type">Employee</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">      e.name = <span class="string">&quot;Reyan Ali&quot;</span>;</span><br><span class="line">      e.address = <span class="string">&quot;Phokka Kuan, Ambehta Peer&quot;</span>;</span><br><span class="line">      e.SSN = <span class="number">11122333</span>;</span><br><span class="line">      e.number = <span class="number">101</span>;</span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="type">FileOutputStream</span> <span class="variable">fileOut</span> <span class="operator">=</span></span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;/tmp/employee.ser&quot;</span>);</span><br><span class="line">         <span class="type">ObjectOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fileOut);</span><br><span class="line">         out.writeObject(e);</span><br><span class="line">         out.close();</span><br><span class="line">         fileOut.close();</span><br><span class="line">         System.out.printf(<span class="string">&quot;Serialized data is saved in /tmp/employee.ser&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(IOException i)</span><br><span class="line">      &#123;</span><br><span class="line">          i.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeserializeDemo</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String [] args)</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="type">Employee</span> <span class="variable">e</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="type">FileInputStream</span> <span class="variable">fileIn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;/tmp/employee.ser&quot;</span>);</span><br><span class="line">         <span class="type">ObjectInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fileIn);</span><br><span class="line">         e = (Employee) in.readObject();</span><br><span class="line">         in.close();</span><br><span class="line">         fileIn.close();</span><br><span class="line">      &#125;<span class="keyword">catch</span>(IOException i)</span><br><span class="line">      &#123;</span><br><span class="line">         i.printStackTrace();</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">      &#125;<span class="keyword">catch</span>(ClassNotFoundException c)</span><br><span class="line">      &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;Employee class not found&quot;</span>);</span><br><span class="line">         c.printStackTrace();</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">&quot;Deserialized Employee...&quot;</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;Name: &quot;</span> + e.name);</span><br><span class="line">      System.out.println(<span class="string">&quot;Address: &quot;</span> + e.address);</span><br><span class="line">      System.out.println(<span class="string">&quot;SSN: &quot;</span> + e.SSN);</span><br><span class="line">      System.out.println(<span class="string">&quot;Number: &quot;</span> + e.number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>readObject() æ–¹æ³•ä¸­çš„ try&#x2F;catchä»£ç å—å°è¯•æ•è· ClassNotFoundException å¼‚å¸¸ã€‚å¯¹äº JVM å¯ä»¥ååºåˆ—åŒ–å¯¹è±¡ï¼Œå®ƒå¿…é¡»æ˜¯èƒ½å¤Ÿæ‰¾åˆ°å­—èŠ‚ç çš„ç±»ã€‚å¦‚æœJVMåœ¨ååºåˆ—åŒ–å¯¹è±¡çš„è¿‡ç¨‹ä¸­æ‰¾ä¸åˆ°è¯¥ç±»ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ª ClassNotFoundException å¼‚å¸¸ã€‚</p>
<p>æ³¨æ„ï¼ŒreadObject() æ–¹æ³•çš„è¿”å›å€¼è¢«è½¬åŒ–æˆ Employee å¼•ç”¨ã€‚</p>
<p>å½“å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼Œå±æ€§ SSN çš„å€¼ä¸º 111222333ï¼Œä½†æ˜¯å› ä¸ºè¯¥å±æ€§æ˜¯çŸ­æš‚çš„ï¼Œè¯¥å€¼æ²¡æœ‰è¢«å‘é€åˆ°è¾“å‡ºæµã€‚æ‰€ä»¥ååºåˆ—åŒ–å Employee å¯¹è±¡çš„ SSN å±æ€§ä¸º 0ã€‚</p>
<h2 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h2><p>ä»JDK1.4å¼€å§‹ï¼Œjavaæä¾›äº†ä¸€ç³»åˆ—æ”¹è¿›çš„ç”¨äºå¤„ç†è¾“å…¥è¾“å‡ºçš„æ–°åŠŸèƒ½ï¼Œè¢«ç§°ä¸ºNIOï¼ˆNew I&#x2F;Oï¼‰ã€‚</p>
<p>NIOé‡‡ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ–¹å¼æ¥å¤„ç†è¾“å…¥è¾“å‡ºï¼Œå°†æ–‡ä»¶æˆ–æ–‡ä»¶çš„ä¸€æ®µåŒºåŸŸæ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œåƒè®¿é—®å†…å­˜ä¸€æ ·æ¥è®¿é—®æ–‡ä»¶ã€‚</p>
<p>æ ‡å‡†çš„IOä¸­ä½¿ç”¨å­—èŠ‚æµå’Œå­—ç¬¦æµï¼ŒNIOä¸­ï¼Œä½¿ç”¨é€šé“Channelå’Œç¼“å†²åŒºBufferã€‚æ•°æ®æ€»æ˜¯ä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œæˆ–ä»ç¼“å†²åŒºå†™å…¥é€šé“ã€‚</p>
<p>Bufferå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªæ•°ç»„ç¼“å†²åŒºï¼Œè¯»å…¥æˆ–å†™å‡ºåˆ°Channelä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½å…ˆæ”¾åœ¨Bufferä¸­ã€‚</p>
<p>Channelæ˜¯å¯¹ä¼ ç»Ÿçš„è¾“å…¥è¾“å‡ºçš„æ¨¡æ‹Ÿï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½é€šè¿‡é€šé“æµçš„å½¢å¼ä¼ è¾“ã€‚</p>
<p>Selectoré€‰æ‹©å™¨ï¼Œç”¨äºç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆä¾‹å¦‚è¿æ¥æ‰“å¼€ã€æ•°æ®åˆ°è¾¾ï¼‰ä¸»è¦ç”¨äºå¤šçº¿ç¨‹å¤„ç†ã€‚</p>
<h2 id="NIO-2"><a href="#NIO-2" class="headerlink" title="NIO.2"></a>NIO.2</h2><p>JDK7å¼•å…¥æ–°çš„I&#x2F;O APIï¼Œæä¾›å…¨é¢çš„æ–‡ä»¶è¾“å…¥è¾“å‡ºä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®ä¸æ”¯æŒï¼Œå¹¶ä¸”æ–°å¢java.nio.fileåŒ…åŠå…¶å­åŒ…ï¼Œæä¾›åŸºäºå¼‚æ­¥Channelçš„è¾“å…¥è¾“å‡ºã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠJavaåŸºç¡€å…¥é—¨ã€‹ä¹‹å¤šçº¿ç¨‹</title>
    <url>/2021/11/30/myblog/java/%E3%80%8Ajava%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E3%80%8B%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<p>åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œå¤šçº¿ç¨‹å°±æ˜¯æŒ‡ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­æœ‰å¤šæ¡å¹¶å‘æ‰§è¡Œçš„çº¿ç´¢ï¼Œæ¯æ¡çº¿ç´¢ç§°ä¸ºä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä»¬äº¤æ›¿æ‰§è¡Œï¼Œå½¼æ­¤é—´å¯ä»¥è¿›è¡Œé€šä¿¡ã€‚</p>
<h2 id="çº¿ç¨‹æ¦‚è¿°"><a href="#çº¿ç¨‹æ¦‚è¿°" class="headerlink" title="çº¿ç¨‹æ¦‚è¿°"></a>çº¿ç¨‹æ¦‚è¿°</h2><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><p>åœ¨ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç‹¬ç«‹æ‰§è¡Œçš„ç¨‹åºéƒ½å¯ç§°ä¸ºä¸€ä¸ªè¿›ç¨‹ã€‚</p>
<p>åœ¨å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿä¸­ï¼Œè¡¨é¢ä¸Šçœ‹æ˜¯æ”¯æŒè¿›ç¨‹å¹¶å‘æ‰§è¡Œçš„ï¼Œä½†å®é™…ä¸Šå¹¶ä¸æ˜¯åœ¨åŒä¸€æ—¶åˆ»è¿è¡Œçš„ã€‚è®¡ç®—æœºçš„åº”ç”¨ç¨‹åºéƒ½æ˜¯ç”±CPUæ‰§è¡Œçš„ï¼Œä¸€ä¸ªCPUåœ¨æŸä¸ªæ—¶é—´ç‚¹åªèƒ½æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿèƒ½åœ¨æçŸ­çš„æ—¶é—´å†…åœ¨ä¸åŒçš„è¿›ç¨‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œæ‰€ä»¥ç»™äººä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºçš„æ„Ÿè§‰ã€‚</p>
<h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><p>å¤šçº¿ç¨‹çœ‹ä¼¼æ˜¯åŒæ—¶å¹¶å‘æ‰§è¡Œçš„ï¼Œå…¶å®æ˜¯å’Œè¿›ç¨‹ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”±CPUæ§åˆ¶å¹¶è½®æµæ‰§è¡Œçš„ï¼Œåªä¸è¿‡CPUè¿è¡Œé€Ÿåº¦éå¸¸å¿«ã€‚</p>
<h2 id="çº¿ç¨‹çš„åˆ›å»º"><a href="#çº¿ç¨‹çš„åˆ›å»º" class="headerlink" title="çº¿ç¨‹çš„åˆ›å»º"></a>çº¿ç¨‹çš„åˆ›å»º</h2><p>åœ¨Javaä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼æ¥å®ç°å¤šçº¿ç¨‹</p>
<p>1.ç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•ã€‚</p>
<p>2.å®ç°Runnableæ¥å£ï¼Œé‡å†™run()æ–¹æ³•ã€‚</p>
<p>3.å®ç°Callableæ¥å£ï¼Œé‡å†™call()æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨Futureæ¥è·å–call()æ–¹æ³•çš„è¿”å›ç»“æœã€‚</p>
<h3 id="Threadç±»å®ç°å¤šçº¿ç¨‹"><a href="#Threadç±»å®ç°å¤šçº¿ç¨‹" class="headerlink" title="Threadç±»å®ç°å¤šçº¿ç¨‹"></a>Threadç±»å®ç°å¤šçº¿ç¨‹</h3><p>Threadç±»æ˜¯java.langåŒ…ä¸‹çš„ä¸€ä¸ªçº¿ç¨‹ç±»ï¼Œç”¨æ¥å®ç°Javaå¤šçº¿ç¨‹ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªThreadçº¿ç¨‹ç±»çš„å­ç±»ï¼ˆå­çº¿ç¨‹ï¼‰ï¼ŒåŒæ—¶é‡å†™Threadç±»çš„run()æ–¹æ³•ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè¯¥å­ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.å®šä¹‰ä¸€ä¸ªç»§æ‰¿Threadçº¿ç¨‹ç±»çš„å­ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread1</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">	<span class="comment">//åˆ›å»ºå­çº¿ç¨‹æœ‰å‚æ„é€ æ–¹æ³•,nameæ˜¯çº¿ç¨‹åå­—</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">MyThread1</span><span class="params">(String name)</span>&#123;</span><br><span class="line">		<span class="built_in">super</span>(name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//é‡å†™Threadç±»çš„run()æ–¹æ³•</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(i++,<span class="number">5</span>)&#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName()</span><br><span class="line">							+<span class="string">&quot;çš„runæ–¹æ³•åœ¨è¿è¡Œ&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="comment">//2.åˆ›å»ºMyThread1å®ä¾‹å¯¹è±¡</span></span><br><span class="line">		<span class="type">MyThread1</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread1</span>(<span class="string">&quot;thread1&quot;</span>);</span><br><span class="line">		<span class="comment">//è°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">		thread1.start();</span><br><span class="line">		<span class="type">MyThread1</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread1</span>(<span class="string">&quot;thread2&quot;</span>);</span><br><span class="line">		<span class="comment">//è°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">		thread2.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>currentThread()æ˜¯Threadç±»çš„é™æ€æ–¹æ³•ï¼Œç”¨æ¥è·å–å½“å‰çº¿ç¨‹å¯¹è±¡ï¼ŒgetNameæ–¹æ³•ç”¨æ¥è·å–çº¿ç¨‹åç§°ã€‚</p>
<p>ç»“æœæ˜¯ï¼šä¸¤ä¸ªçº¿ç¨‹å®ä¾‹äº¤äº’è¿è¡Œã€‚</p>
<h3 id="Runnableæ¥å£å®ç°å¤šçº¿ç¨‹"><a href="#Runnableæ¥å£å®ç°å¤šçº¿ç¨‹" class="headerlink" title="Runnableæ¥å£å®ç°å¤šçº¿ç¨‹"></a>Runnableæ¥å£å®ç°å¤šçº¿ç¨‹</h3><p>Threadç±»å®ç°å¤šçº¿ç¨‹çš„å±€é™æ€§ï¼šå› ä¸ºJavaåªæ”¯æŒç±»çš„å•ç»§æ‰¿ï¼Œå¦‚æœæŸä¸ªç±»å·²ç»ç»§æ‰¿äº†å…¶ä»–çˆ¶ç±»ï¼Œå°±æ— æ³•å†ç»§æ‰¿Threadç±»æ¥å®ç°å¤šçº¿ç¨‹ã€‚å› æ­¤ï¼Œè€ƒè™‘é€šè¿‡å®ç°Runnableæ¥å£æ¥å®ç°å¤šçº¿ç¨‹ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªRunnableæ¥å£çš„å®ç°ç±»ï¼ŒåŒæ—¶é‡å†™æ¥å£ä¸­çš„runæ–¹æ³•ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºRunnableæ¥å£çš„å®ç°ç±»å¯¹è±¡ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨Threadæœ‰å‚æ„é€ æ–¹æ³•åˆ›å»ºçº¿ç¨‹å®ä¾‹ï¼Œå¹¶å°†Runnableæ¥å£çš„å®ç°ç±»çš„å®ä¾‹å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p>
<p>ç¬¬å››æ­¥ï¼šè°ƒç”¨çº¿ç¨‹å®ä¾‹çš„startæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.å®šä¹‰ä¸€ä¸ªå®ç°Runnableæ¥å£çš„å®ç°ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">	<span class="comment">//é‡å†™runæ–¹æ³•</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(i++,<span class="number">5</span>)&#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName()</span><br><span class="line">							+<span class="string">&quot;çš„runæ–¹æ³•åœ¨è¿è¡Œ&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="comment">//2.åˆ›å»ºRunnableæ¥å£å®ç°ç±»çš„å®ä¾‹å¯¹è±¡</span></span><br><span class="line">		<span class="type">MyThread2</span> <span class="variable">myThread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread2</span>();</span><br><span class="line">		<span class="comment">//3.ä½¿ç”¨Thread(Runnable target, String name)æ„é€ æ–¹æ³•åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">		<span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(myThread2, <span class="string">&quot;thread1&quot;</span>);</span><br><span class="line">		<span class="comment">//4.è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„startæ–¹æ³•å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">		thread1.start();</span><br><span class="line">		<span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(myThread2, <span class="string">&quot;thread2&quot;</span>);</span><br><span class="line">		thread2.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Runnableæ¥å£ä¸­åªæœ‰ä¸€ä¸ªæŠ½è±¡çš„runæ–¹æ³•ï¼Œè¯¥æ¥å£å±äºJDK8ä¸­å®šä¹‰çš„å‡½æ•°å¼æ¥å£ï¼Œåœ¨ä½¿ç”¨ä¸­å¯ä»¥ç›´æ¥é€šè¿‡Lambdaè¡¨è¾¾å¼çš„æ–¹å¼ç®€æ´åœ°å®ç°çº¿ç¨‹å®ä¾‹ã€‚</p>
<h3 id="Callableæ¥å£å®ç°å¤šçº¿ç¨‹"><a href="#Callableæ¥å£å®ç°å¤šçº¿ç¨‹" class="headerlink" title="Callableæ¥å£å®ç°å¤šçº¿ç¨‹"></a>Callableæ¥å£å®ç°å¤šçº¿ç¨‹</h3><p>Threadç±»å’ŒRunnableæ¥å£å®ç°å¤šçº¿ç¨‹ï¼Œé‡å†™runæ–¹æ³•ï¼Œç”±äºè¯¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œå› æ­¤æ— æ³•ä»å¤šä¸ªçº¿ç¨‹ä¸­è·å–è¿”å›ç»“æœã€‚å› æ­¤ï¼ŒJDK5å¼€å§‹ï¼Œjavaæä¾›äº†ä¸€ä¸ªCallableæ¥å£ï¼Œæ¥æ»¡è¶³è¿™ç§æ—¢èƒ½åˆ›å»ºå¤šçº¿ç¨‹åˆå¯ä»¥æœ‰è¿”å›å€¼çš„éœ€æ±‚ã€‚</p>
<p>ä¸Runnableä¸åŒï¼Œè¿™æ¬¡ä¼ å…¥Threadç±»æœ‰å‚æ„é€ æ–¹æ³•çš„æ˜¯Runnableæ¥å£çš„å­ç±»FutureTaskå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¯¹è±¡ä¸­å°è£…äº†å¸¦æœ‰è¿”å›å€¼çš„Callableæ¥å£å®ç°ç±»ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªCallableæ¥å£çš„å®ç°ç±»ï¼ŒåŒæ—¶é‡å†™Callableæ¥å£çš„callæ–¹æ³•</p>
<p>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºCallableæ¥å£çš„å®ç°ç±»å¯¹è±¡ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡FutureTaskçº¿ç¨‹ç»“æœå¤„ç†ç±»çš„æœ‰å‚æ„é€ æ–¹æ³•æ¥å°è£…Callableæ¥å£å®ç°ç±»å¯¹è±¡ã€‚</p>
<p>ç¬¬å››æ­¥ï¼šä½¿ç”¨å‚æ•°ä¸ºFutureTaskç±»å¯¹è±¡çš„Threadæœ‰å‚æ„é€ æ–¹æ³•åˆ›å»ºThreadçº¿ç¨‹å®ä¾‹ã€‚</p>
<p>ç¬¬äº”æ­¥ï¼šè°ƒç”¨çº¿ç¨‹å®ä¾‹çš„startæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.cocurrent.*;</span><br><span class="line"><span class="comment">//1.å®šä¹‰ä¸€ä¸ªå®ç°Callableæ¥å£çš„å®ç°ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread3</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Object&gt;&#123;</span><br><span class="line">	<span class="comment">//é‡å†™callæ–¹æ³•</span></span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">		<span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(i++,<span class="number">5</span>)&#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName()</span><br><span class="line">							+<span class="string">&quot;çš„runæ–¹æ³•åœ¨è¿è¡Œ&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> i;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException,</span><br><span class="line">														ExecutionException&#123;</span><br><span class="line">		<span class="comment">//2.åˆ›å»ºCallableæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line">		<span class="type">MyThread3</span> <span class="variable">myThread3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread3</span>();</span><br><span class="line">		<span class="comment">//3.ä½¿ç”¨FutureTaskå°è£…Callableæ¥å£</span></span><br><span class="line">		FutureTask&lt;Object&gt;ft1 = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(myThread3);</span><br><span class="line">		<span class="comment">//4.ä½¿ç”¨Thread()æ„é€ æ–¹æ³•åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">		<span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(ft1, <span class="string">&quot;thread1&quot;</span>);</span><br><span class="line">		<span class="comment">//5.å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">		thread1.start();</span><br><span class="line">		FutureTask&lt;Object&gt;ft2 = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(myThread3);</span><br><span class="line">		<span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(ft2, <span class="string">&quot;thread1&quot;</span>);</span><br><span class="line">		thread2.start();</span><br><span class="line">		<span class="comment">//é€šè¿‡FutureTaskå¯¹è±¡çš„æ–¹æ³•ç®¡ç†è¿”å›å€¼</span></span><br><span class="line">		System.out.println(<span class="string">&quot;thread1è¿”å›ç»“æœï¼š&quot;</span>+ft1.get());</span><br><span class="line">		System.out.println(<span class="string">&quot;thread2è¿”å›ç»“æœï¼š&quot;</span>+ft2.get());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FutureTaskç±»ç”¨æ¥å°è£…å’Œç®¡ç†è¿”å›ç»“æœï¼Œç›´æ¥çˆ¶æ¥å£æ˜¯RunnableFutureï¼ŒRunnableFutureæ¥å£æ˜¯å®ç°è‡ªRunnableæ¥å£å’ŒFutureæ¥å£ã€‚</p>
<p>Futureæ¥å£æ—¶JDK5æä¾›çš„ç”¨æ¥ç®¡ç†çº¿ç¨‹æ‰§è¡Œè¿”å›ç»“æœçš„ï¼Œå…±æœ‰äº”ä¸ªæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">cancel</span><span class="params">(<span class="type">boolean</span> å‚æ•°)</span>   <span class="comment">//ç”±äºå–æ¶ˆä»»åŠ¡ï¼Œå‚æ•°ä¸ºtrueè¡¨ç¤ºå¯ä»¥å–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isCancelled</span><span class="params">()</span>    <span class="comment">//åˆ¤æ–­æ˜¯å¦è¢«å–æ¶ˆæˆåŠŸ</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isDone</span><span class="params">()</span>    <span class="comment">//åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆ</span></span><br><span class="line">V <span class="title function_">get</span><span class="params">()</span>     <span class="comment">//è·å–æ‰§è¡Œç»“æœï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå‘ç”Ÿé˜»å¡ï¼Œä¸€ç›´ç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰è¿”å›æ‰§è¡Œç»“æœ</span></span><br><span class="line">V <span class="title function_">get</span><span class="params">(<span class="type">long</span> time, TumeUnit unit)</span>  <span class="comment">//ç”±äºåœ¨æŒ‡å®šæ—¶é—´å†…è·å–æ‰§è¡Œç»“æœ</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰ç§æ–¹æ³•çš„å¯¹æ¯”åˆ†æ"><a href="#ä¸‰ç§æ–¹æ³•çš„å¯¹æ¯”åˆ†æ" class="headerlink" title="ä¸‰ç§æ–¹æ³•çš„å¯¹æ¯”åˆ†æ"></a>ä¸‰ç§æ–¹æ³•çš„å¯¹æ¯”åˆ†æ</h3><p>Callableæ¥å£çš„æ–¹æ³•æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”å¯ä»¥å£°æ˜æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>è‹¥æ˜¯æƒ³è¦å¤šä¸ªçº¿ç¨‹å…±äº«ä¸€ä¸ªæ•°æ®ï¼Œåˆ™ç”±äºç»§æ‰¿Threadçš„æ–¹æ³•éœ€è¦åˆ›å»ºå¤šä¸ªå­ç±»çš„çº¿ç¨‹å¯¹è±¡ï¼Œæ— æ³•å…±äº«ç±»å†…çš„privateå˜é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">MyThread1</span>().start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">MyThread1</span>().start();</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå¤šçº¿ç¨‹æ—¶ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡æ„é€ æ–¹æ³•æŒ‡å®šçº¿ç¨‹åç§°ï¼Œåˆ™ç³»ç»Ÿä¼šé»˜è®¤ç”Ÿæˆçº¿ç¨‹åç§°ã€‚</p>
<p>ä¸ºäº†ç¡®ä¿å¤šä¸ªçº¿ç¨‹å…±äº«ä¸€ä¸ªæ•°æ®ï¼Œç”¨Runnableæ¥å£å®ç°ï¼Œç¨‹åºåªåˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œè€Œæ˜¯åˆ›å»ºå¤šä¸ªthreadç±»çš„å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">MyThread2</span> <span class="variable">myThread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread2</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(myThread2, <span class="string">&quot;çº¿ç¨‹1&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(myThread2, <span class="string">&quot;çº¿ç¨‹2&quot;</span>).start();</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼ŒRunnableæ¥å£æˆ–Callableæ¥å£å®ç°å¤šçº¿ç¨‹ç›¸æ¯”äºç»§æ‰¿Threadç±»æ¥è¯´ï¼Œå¥½å¤„åœ¨äºï¼š</p>
<p>ï¼ˆ1ï¼‰é€‚åˆå¤šä¸ªçº¿ç¨‹å¤„ç†åŒä¸€ä¸ªå…±äº«èµ„æºçš„æƒ…å†µï¼Œä½“ç°é¢å‘å¯¹è±¡è®¾è®¡æ€æƒ³ã€‚</p>
<p>ï¼ˆ2ï¼‰é¿å…Javaå•ç»§æ‰¿çš„å±€é™ï¼Œè‹¥ç±»å·²ç»§æ‰¿æŸçˆ¶ç±»ï¼Œåˆ™è¿˜å¯ä»¥å®ç°æ¥å£ã€‚</p>
<h3 id="åå°çº¿ç¨‹"><a href="#åå°çº¿ç¨‹" class="headerlink" title="åå°çº¿ç¨‹"></a>åå°çº¿ç¨‹</h3><p>mainæ–¹æ³•ä¸­åˆ›å»ºå¹¶å¯åŠ¨å‡ ä¸ªæ–°çº¿ç¨‹åï¼Œä¸»çº¿ç¨‹éšä¹‹ç»“æŸï¼Œä½†æ˜¯ï¼Œè™½ç„¶ä¸»çº¿ç¨‹ç»“æŸäº†ï¼Œä½†æ•´ä¸ªJavaç¨‹åºå¹¶æœªç»“æŸï¼Œå¯¹javaç¨‹åºæ¥è¯´ï¼Œåªè¦è¿˜æœ‰å‰å°çº¿ç¨‹åœ¨è¿è¡Œï¼Œè¿™ä¸ªè¿›ç¨‹å°±ä¸ä¼šç»“æŸã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹ä¸­åªæœ‰åå°çº¿ç¨‹è¿è¡Œï¼Œè¿™ä¸ªè¿›ç¨‹å°±ä¼šç»“æŸã€‚</p>
<p>æ–°åˆ›å»ºçš„çº¿ç¨‹é»˜è®¤æ˜¯å‰å°çº¿ç¨‹ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å¯¹è±¡åœ¨å¯åŠ¨ä¹‹å‰è°ƒç”¨äº†setDaemon(true)è¯­å¥ï¼Œè¿™ä¸ªçº¿ç¨‹å°±å˜æˆä¸€ä¸ªåå°çº¿ç¨‹ã€‚</p>
<p>åˆ¤æ–­æ˜¯å¦æ˜¯åå°çº¿ç¨‹ï¼š<code>th.isDaemon()</code></p>
<p><code>th.setDaemon(true);   thread.start();  </code>  &#x2F;&#x2F;ä¸€å®šæ˜¯åœ¨startå¯åŠ¨ä¹‹å‰</p>
<p>æ•´ä¸ªè¿›ç¨‹ç»“æŸï¼ŒJVMä¼šé€šçŸ¥åå°çº¿ç¨‹ç»“æŸï¼Œç”±äºåå°çº¿ç¨‹ä»æ¥æ”¶æŒ‡ä»¤åˆ°åšå‡ºå“åº”ï¼Œéœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œç»“æŸåå°è¿›ç¨‹ä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿã€‚</p>
<h2 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠçŠ¶æ€è½¬æ¢"><a href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠçŠ¶æ€è½¬æ¢" class="headerlink" title="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠçŠ¶æ€è½¬æ¢"></a>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠçŠ¶æ€è½¬æ¢</h2><p>åœ¨Javaä¸­ï¼Œä»»ä½•å¯¹è±¡éƒ½æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œçº¿ç¨‹ä¹Ÿä¸ä¾‹å¤–ï¼ŒThreadå¯¹è±¡åˆ›å»ºå®Œæˆæ—¶ï¼Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¾¿å¼€å§‹äº†ï¼Œå½“æ‰§è¡Œå®Œæ¯•æˆ–æŠ›å‡ºå¼‚å¸¸æˆ–é”™è¯¯æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸä¾¿ç»“æŸã€‚</p>
<p><img src="/images/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.jpg"></p>
<p><em><strong>æ–°å»ºçŠ¶æ€</strong></em>ï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡åï¼Œä»…ä»…ç”±JVMä¸ºå…¶åˆ†é…äº†å†…å­˜ï¼Œæ²¡æœ‰è¡¨ç°å‡ºä»»ä½•çº¿ç¨‹çš„åŠ¨æ€ç‰¹å¾ã€‚</p>
<p><em><strong>å°±ç»ªçŠ¶æ€</strong></em>ï¼šçº¿ç¨‹å¯¹è±¡è°ƒç”¨startæ–¹æ³•ä¹‹åï¼Œç­‰å¾…JVMè°ƒåº¦ï¼Œæ­¤æ—¶å¹¶æœªè¿è¡Œã€‚</p>
<p><em><strong>è¿è¡ŒçŠ¶æ€</strong></em>ï¼šçº¿ç¨‹å¯¹è±¡è·å¾—JVMè°ƒåº¦ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªCPUï¼Œåˆ™å…è®¸å¤šä¸ªçº¿ç¨‹å¹¶è¡Œè¿è¡Œã€‚</p>
<p><em><strong>é˜»å¡çŠ¶æ€</strong></em>ï¼šçº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå‘å‡ºI&#x2F;Oè¯·æ±‚æ—¶ï¼Œè¯¥çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚å½“çº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­è·å–åŒæ­¥é”æ—¶ï¼Œå´è¢«å¦ä¸€ä¸ªçº¿ç¨‹è·å–ï¼Œæ­¤æ—¶JVMæŠŠå½“å‰çº¿ç¨‹å­˜åˆ°å¯¹è±¡çš„é”æ± ä¸­ï¼Œè¯¥çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚æ­¤æ—¶ï¼ŒJVMä¸ä¼šç»™çº¿ç¨‹åˆ†é…CPUï¼Œç›´åˆ°çº¿ç¨‹é‡æ–°è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šè½¬æ¢åˆ°è¿è¡ŒçŠ¶æ€ã€‚</p>
<p><em><strong>ç­‰å¾…çŠ¶æ€</strong></em>ï¼šå½“å¤„äºè¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨äº†é™åˆ¶çš„æ–¹æ³•åï¼Œå¦‚wait()æ–¹æ³•ã€join()æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚<br>å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹æ— æ³•ç«‹å³äº‰å¤ºCPUä½¿ç”¨æƒï¼Œéœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œç‰¹å®šçš„æ“ä½œåï¼Œæ‰æœ‰æœºä¼šå†æ¬¡äº‰å¤ºï¼Œå°†ç­‰å¾…çŠ¶æ€å˜ä¸ºè¿è¡ŒçŠ¶æ€ã€‚<br><code>wait()</code>æ–¹æ³•ï¼šç­‰å¾…å…¶ä»–çº¿ç¨‹è°ƒç”¨<code>notify()</code>æˆ–<code>notifyAll()</code>æ–¹æ³•ï¼Œæ¥å”¤é†’å½“å‰ç­‰å¾…ä¸­çš„çº¿ç¨‹ã€‚<br><code>join()</code>æ–¹æ³•ï¼šå¿…é¡»ç­‰å¾…å…¶ä»–åŠ å…¥çš„çº¿ç¨‹ç»ˆæ­¢ã€‚</p>
<p><em><strong>å®šæ—¶ç­‰å¾…çŠ¶æ€</strong></em>ï¼šç±»ä¼¼ç­‰å¾…çŠ¶æ€ï¼Œæ‰§è¡Œ<code>sleep(long millis)ã€wait(long timeout)ã€join(long millis)</code>ç­‰æ–¹æ³•ã€‚å¿…é¡»ç­‰å¾…å…¶ä»–ç›¸å…³çº¿ç¨‹æ‰§è¡Œå®Œç‰¹å®šæ“ä½œ<strong>æˆ–</strong>é™æ—¶æ—¶é—´ç»“æŸåï¼Œæ‰æœ‰æœºä¼šå†æ¬¡äº‰å¤ºCPUï¼Œè¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚</p>
<p><em><strong>ç»ˆæ­¢çŠ¶æ€</strong></em>ï¼šçº¿ç¨‹çš„run()æ–¹æ³•æˆ–è€…call()æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæˆ–çº¿ç¨‹æŠ›å‡ºä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸ï¼ˆExceptionï¼‰ã€é”™è¯¯ï¼ˆErrorï¼‰ï¼Œçº¿ç¨‹è¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚ä¸€æ—¦è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼Œçº¿ç¨‹å°†ä¸å†æ‹¥æœ‰è¿è¡Œçš„èµ„æ ¼ï¼Œä¹Ÿä¸èƒ½å†è½¬æ¢åˆ°å…¶ä»–çŠ¶æ€ï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸã€‚</p>
<h2 id="çº¿ç¨‹çš„è°ƒåº¦"><a href="#çº¿ç¨‹çš„è°ƒåº¦" class="headerlink" title="çº¿ç¨‹çš„è°ƒåº¦"></a>çº¿ç¨‹çš„è°ƒåº¦</h2><p>Javaè™šæ‹Ÿæœºä¼šæŒ‰ç…§ç‰¹å®šçš„æœºåˆ¶ä¸ºç¨‹åºä¸­çš„æ¯ä¸ªçº¿ç¨‹åˆ†é…CPUçš„ä½¿ç”¨æƒï¼Œè¿™ç§æœºåˆ¶å«åšçº¿ç¨‹çš„è°ƒåº¦ã€‚</p>
<p>è®¡ç®—æœºä¸­çº¿ç¨‹çš„è°ƒåº¦æœ‰ä¸¤ç§æ¨¡å‹ï¼š<br>1ã€åˆ†æ—¶æ¨¡å‹ï¼šæ‰€æœ‰çº¿ç¨‹è½®æµè·å¾—CPUçš„ä½¿ç”¨æƒï¼Œå¹¶ä¸”å¹³å‡åˆ†é…æ¯ä¸ªçº¿ç¨‹å ç”¨çš„CPUæ—¶é—´ç‰‡ã€‚<br>2ã€æŠ¢å å¼è°ƒåº¦æ¨¡å¼ï¼šè®©å¯è¿è¡Œæ± ä¸­æ‰€æœ‰å°±ç»ªçŠ¶æ€çš„çº¿ç¨‹äº‰æŠ¢CPUçš„ä½¿ç”¨æƒï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹è·å¾—CPUæ¦‚ç‡æ›´å¤§ã€‚</p>
<p>Javaè™šæ‹Ÿæœºé»˜è®¤é‡‡ç”¨æŠ¢å å¼è°ƒåº¦æ¨¡å¼ï¼Œç‰¹å®šéœ€æ±‚ä¸‹éœ€è¦æ”¹å˜æ¨¡å¼ï¼Œç”±ç¨‹åºè‡ªå·±æ¥æ§åˆ¶CPUçš„è°ƒåº¦ã€‚</p>
<h3 id="çº¿ç¨‹çš„ä¼˜å…ˆçº§"><a href="#çº¿ç¨‹çš„ä¼˜å…ˆçº§" class="headerlink" title="çº¿ç¨‹çš„ä¼˜å…ˆçº§"></a>çº¿ç¨‹çš„ä¼˜å…ˆçº§</h3><p>çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”¨1-10ä¹‹é—´çš„æ•´æ•°æ¥è¡¨ç¤ºï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚é™¤äº†ç›´æ¥ç”¨æ•°å­—å¤–ï¼Œè¿˜å¯ç”¨Threadç±»ä¸­æä¾›çš„ä¸‰ä¸ªé™æ€å¸¸é‡è¡¨ç¤ºçº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="comment">//ç”¨lambdaè¡¨è¾¾å¼åˆ›å»ºçº¿ç¨‹ï¼Ÿ</span></span><br><span class="line">		<span class="type">Thread</span> <span class="variable">th1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName()</span><br><span class="line">						+<span class="string">&quot;æ­£åœ¨è¾“å‡ºi+&quot;</span>+i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,<span class="string">&quot;ä¼˜å…ˆçº§è¾ƒä½çš„çº¿ç¨‹&quot;</span>);</span><br><span class="line">		<span class="type">Thread</span> <span class="variable">th2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>; j&lt;<span class="number">10</span>; j++)&#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName()</span><br><span class="line">						+<span class="string">&quot;æ­£åœ¨è¾“å‡ºj+&quot;</span>+j);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,<span class="string">&quot;ä¼˜å…ˆçº§è¾ƒé«˜çš„çº¿ç¨‹&quot;</span>);</span><br><span class="line">		<span class="comment">//è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§</span></span><br><span class="line">		th1.setPriority(Thread.MIN_PRIORITY);  <span class="comment">//MIN=1 NORM=5  MAX=10</span></span><br><span class="line">		th2.setPriority(<span class="number">10</span>);</span><br><span class="line">		th1.start();</span><br><span class="line">		th2.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="çº¿ç¨‹ä¼‘çœ "><a href="#çº¿ç¨‹ä¼‘çœ " class="headerlink" title="çº¿ç¨‹ä¼‘çœ "></a>çº¿ç¨‹ä¼‘çœ </h3><p>å°†æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœï¼Œå°†CPUä½¿ç”¨æƒè®©ç»™å…¶ä»–çº¿ç¨‹ï¼Œè¿™æ˜¯å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•sleep(long millis)ï¼Œè¯¥æ–¹æ³•ä½¿å¾—çº¿ç¨‹è¿›å…¥ä¼‘çœ ç­‰å¾…çŠ¶æ€ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å°±å¯ä»¥å¾—åˆ°æ‰§è¡Œçš„æœºä¼šã€‚sleep(long millis)æ–¹æ³•ä¼šå£°æ˜æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œå› æ­¤åœ¨è°ƒåŠ¨è¯¥æ–¹æ³•æ—¶åº”è¯¥æ•è·å¼‚å¸¸ï¼Œæˆ–è€…å£°æ˜æŠ›å‡ºå¼‚å¸¸ã€‚ä¼‘çœ æ—¶é—´ç»“æŸåï¼Œçº¿ç¨‹æ‰ä¼šè½¬æ¢åˆ°å°±ç»ªçŠ¶æ€ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="type">Thread</span> <span class="variable">th1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName()</span><br><span class="line">						+<span class="string">&quot;æ­£åœ¨è¾“å‡ºi+&quot;</span>+i);</span><br><span class="line">				<span class="keyword">if</span>(i==<span class="number">2</span>)&#123;</span><br><span class="line">					<span class="keyword">try</span>&#123;</span><br><span class="line">						<span class="comment">//åœ¨è¯¥çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œè®©å…¶ä»–çº¿ç¨‹å…ˆæ‰§è¡Œ</span></span><br><span class="line">						Thread.sleep(<span class="number">500</span>);</span><br><span class="line">					&#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,<span class="string">&quot;çº¿ç¨‹1&quot;</span>);</span><br><span class="line">		<span class="type">Thread</span> <span class="variable">th2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>; j&lt;<span class="number">10</span>; j++)&#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName()</span><br><span class="line">						+<span class="string">&quot;æ­£åœ¨è¾“å‡ºj+&quot;</span>+j);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,<span class="string">&quot;çº¿ç¨‹2&quot;</span>);</span><br><span class="line">		th1.start();</span><br><span class="line">		th2.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="çº¿ç¨‹è®©æ­¥"><a href="#çº¿ç¨‹è®©æ­¥" class="headerlink" title="çº¿ç¨‹è®©æ­¥"></a>çº¿ç¨‹è®©æ­¥</h3><p><code>Thread.yield();</code> ä½¿å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æš‚åœï¼Œä½†ä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹ï¼Œåªæ˜¯å°†çº¿ç¨‹è½¬æ¢æˆå°±ç»ªçŠ¶æ€ï¼Œè®©çº¿ç¨‹çš„è°ƒåº¦å™¨é‡æ–°è°ƒåº¦ä¸€æ¬¡ã€‚Threadçš„yieldæ–¹æ³•ï¼Œåœ¨çº¿ç¨‹ç±»å®ç°å†…ä½¿ç”¨ã€‚</p>
<p>ç›¸å½“äºè®©å ç€CPUçš„çº¿ç¨‹è®©æ­¥ï¼Œäº¤å‡ºCPUï¼Œå¤§å®¶é‡æ–°æŠ¢å ä¸€æ¬¡ï¼Œå› æ­¤ï¼Œä¹Ÿæœ‰å¯èƒ½è‡ªå·±å†æŠ¢åˆ°ã€‚</p>
<h3 id="çº¿ç¨‹æ’é˜Ÿ"><a href="#çº¿ç¨‹æ’é˜Ÿ" class="headerlink" title="çº¿ç¨‹æ’é˜Ÿ"></a>çº¿ç¨‹æ’é˜Ÿ</h3><p>å½“æŸä¸ªçº¿ç¨‹aä¸­è°ƒç”¨å…¶ä»–çº¿ç¨‹bçš„joinæ–¹æ³•æ—¶ï¼Œçº¿ç¨‹aå°†è¢«é˜»å¡ï¼Œçº¿ç¨‹bæ’é˜Ÿä¼˜å…ˆæ‰§è¡Œï¼Œç›´åˆ°çº¿ç¨‹bæ‰§è¡Œå®Œæˆåï¼Œçº¿ç¨‹aæ‰ä¼šå®Œæˆã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Thread1</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;<span class="number">6</span>; i++)&#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName()+<span class="string">&quot;è¾“å…¥ï¼š&quot;</span>+i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line">		<span class="comment">//åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">		<span class="type">Thread</span> <span class="variable">th1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Thread1</span>(), <span class="string">&quot;thread1&quot;</span>);</span><br><span class="line">		th1.start();</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName()+<span class="string">&quot;è¾“å…¥&quot;</span>+i);</span><br><span class="line">			<span class="keyword">if</span>(i==<span class="number">2</span>)&#123;</span><br><span class="line">				th1.join();  <span class="comment">//th1æ’é˜Ÿæ‰§è¡Œï¼Œmainé˜»å¡ï¼Œåœ¨th1æ‰§è¡Œå®Œæ‰ä¼šç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤joinæ— å‚æ•°çš„çº¿ç¨‹æ’é˜Ÿæ–¹æ³•å¤–ï¼ŒThreadè¿˜æä¾›äº†å¸¦æœ‰æ—¶é—´å‚æ•°çš„çº¿ç¨‹æ’é˜Ÿæ–¹æ³•<code>join(long millis)</code>ã€‚è¡¨ç¤ºéœ€è¦ç­‰å¾…æ’é˜Ÿçš„çº¿ç¨‹æ‰§è¡ŒæŒ‡å®šæ—¶é—´åï¼Œæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚</p>
<p>mianå‡½æ•°æœ¬èº«ä¹Ÿç®—æ˜¯ä¸€ä¸ªä¸»çº¿ç¨‹ã€‚</p>
<h2 id="å¤šçº¿ç¨‹åŒæ­¥"><a href="#å¤šçº¿ç¨‹åŒæ­¥" class="headerlink" title="å¤šçº¿ç¨‹åŒæ­¥"></a>å¤šçº¿ç¨‹åŒæ­¥</h2><p>å¤šçº¿ç¨‹åŒæ­¥ï¼šé™åˆ¶æŸä¸ªèµ„æºåœ¨åŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚</p>
<p>Runnableæ¥å£å®ç°å¤šçº¿ç¨‹ï¼Œé€‚åˆå¤šä¸ªçº¿ç¨‹å¤„ç†åŒä¸€ä¸ªå…±äº«èµ„æºçš„æƒ…å†µã€‚ä½†æ˜¯å…±äº«çš„æ—¶å€™ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p>
<h3 id="åŒæ­¥ä»£ç å—"><a href="#åŒæ­¥ä»£ç å—" class="headerlink" title="åŒæ­¥ä»£ç å—"></a>åŒæ­¥ä»£ç å—</h3><p>Javaæä¾›äº†çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œå½“å¤šä¸ªçº¿ç¨‹ä½¿ç”¨åŒä¸€å…±äº«èµ„æºæ—¶ï¼Œå¯ä»¥å°†<strong>å¤„ç†å…±äº«èµ„æºçš„æ“ä½œä»£ç </strong>æ”¾ç½®åœ¨ä¸€ä¸ªä½¿ç”¨synchronizedå…³é”®å­—æ¥ä¿®é¥°çš„ä»£ç å—ä¸­ï¼Œè¿™æ®µä»£ç å—è¢«ç§°ä½œåŒæ­¥ä»£ç å—ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line">	<span class="comment">//æ“ä½œå…±äº«èµ„æºä»£ç å—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>lockæ˜¯ä¸€ä¸ªé”å¯¹è±¡ï¼Œæ˜¯åŒæ­¥ä»£ç å—çš„å…³é”®ã€‚å½“çº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥é”å¯¹è±¡çš„æ ‡å¿—ä½ï¼Œé»˜è®¤æƒ…å†µä¸‹æ ‡å¿—ä½ä¸º1ï¼Œæ­¤æ—¶çº¿ç¨‹ä¼šæ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼ŒåŒæ—¶å°†é”å¯¹è±¡çš„æ ‡å¿—ä½ç½®ä¸º0ã€‚å½“ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œåˆ°è¿™æ®µåŒæ­¥ä»£ç å—æ—¶ï¼Œç”±äºé”å¯¹è±¡çš„æ ‡å¿—ä½ä¸º0ï¼Œæ–°çº¿ç¨‹ä¼šå‘ç”Ÿé˜»å¡ï¼Œç­‰é”å¯¹è±¡çš„æ ‡å¿—ä½è¢«ç½®ä¸º1ï¼Œæ–°çº¿ç¨‹æ‰èƒ½è¿›å…¥åŒæ­¥ä»£ç å—æ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚ï¼ˆå¥½æ¯”å…¬å…±ç”µè¯äº­ï¼Œå‰ä¸€ä¸ªæ‰“å®Œå‡ºæ¥ï¼Œåé¢çš„äººæ‰èƒ½è¿›å»ï¼‰ã€‚</p>
<p>åŒæ­¥ä»£ç å—ä¸­çš„é”å¯¹è±¡å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œä½†å¤šä¸ªçº¿ç¨‹å…±äº«çš„é”å¯¹è±¡å¿…é¡»æ˜¯ç›¸åŒçš„ã€‚é”å¯¹è±¡çš„åˆ›å»ºä»£ç ä¸èƒ½æ”¾åœ¨run()æ–¹æ³•ä¸­ï¼Œå¦åˆ™æ¯ä¸ªçº¿ç¨‹è¿è¡Œåˆ°run()æ–¹æ³•éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªä¸åŒçš„é”ï¼Œæ¯ä¸ªé”æœ‰è‡ªå·±çš„æ ‡å¿—ä½ï¼Œæ— æ³•åŒæ­¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.multithread;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: multithread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å¤šçº¿ç¨‹æ¨¡æ‹Ÿå”®ç¥¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-11-30 13:15</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test_Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SaleThread</span> <span class="variable">saleThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SaleThread</span>();</span><br><span class="line">        <span class="comment">//åˆ›å»ºå¹¶å¼€å¯4ä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿå››ä¸ªå”®ç¥¨çª—å£</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£3&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£4&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SaleThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tickets</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();  <span class="comment">//å®šä¹‰ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨ä½œåŒæ­¥ä»£ç å—çš„é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">                <span class="keyword">if</span>(tickets&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">try</span>&#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);  <span class="comment">//æ¨¡æ‹Ÿå”®ç¥¨è€—æ—¶è¿‡ç¨‹</span></span><br><span class="line">                    &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()</span><br><span class="line">                                +<span class="string">&quot;æ­£åœ¨å‘å”®ç¬¬&quot;</span>+tickets--+<span class="string">&quot;å¼ ç¥¨&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸€ä¸ªæ–‡ä»¶ä¸­å¯ä»¥æœ‰å¤šä¸ªclassç±»ï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªå«mianå‡½æ•°çš„ç±»ï¼Œå¹¶ä¸”æ–‡ä»¶åéœ€è¦å’Œå«mainå‡½æ•°çš„ç±»çš„åå­—ç›¸åŒã€‚</p>
</blockquote>
<h3 id="åŒæ­¥æ–¹æ³•"><a href="#åŒæ­¥æ–¹æ³•" class="headerlink" title="åŒæ­¥æ–¹æ³•"></a>åŒæ­¥æ–¹æ³•</h3><p>åœ¨æ–¹æ³•å‰é¢ä¹Ÿå¯ä»¥ä½¿ç”¨synchronizedå…³é”®å­—æ¥ä¿®é¥°ï¼Œè¢«ä¿®é¥°çš„æ–¹æ³•ä¸ºåŒæ­¥æ–¹æ³•ï¼Œå®ƒèƒ½å®ç°å’ŒåŒæ­¥ä»£ç å—åŒæ ·çš„åŠŸèƒ½ã€‚</p>
<p><code>[ä¿®é¥°ç¬¦] synchronized è¿”å›å€¼ç±»å‹ æ–¹æ³•å(å‚æ•°)&#123;&#125;</code></p>
<p>è¢«synchronizedä¿®é¥°çš„æ–¹æ³•åœ¨æŸä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œè®¿é—®è¯¥æ–¹æ³•çš„å…¶ä»–çº¿ç¨‹éƒ½ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹è®¿é—®å®Œæ¯•åï¼Œå…¶ä»–çº¿ç¨‹æ‰æœ‰æœºä¼šæ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.multithread;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: multithread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: åŒæ­¥æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-11-30 13:47</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test_Thread1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SaleThread1</span> <span class="variable">saleThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SaleThread1</span>();</span><br><span class="line">        <span class="comment">//åˆ›å»ºå¹¶å¼€å¯4ä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿå››ä¸ªå”®ç¥¨çª—å£</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£3&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£4&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SaleThread1</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tickets</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;    <span class="comment">//åœ¨runæ–¹æ³•ä¸­è°ƒç”¨synchronizedä¿®é¥°çš„åŒæ­¥æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            saleTicket();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">saleTicket</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(tickets&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                Thread.sleep(<span class="number">10</span>);  <span class="comment">//æ¨¡æ‹Ÿå”®ç¥¨è€—æ—¶è¿‡ç¨‹</span></span><br><span class="line">            &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()</span><br><span class="line">                    +<span class="string">&quot;æ­£åœ¨å‘å”®ç¬¬&quot;</span>+tickets--+<span class="string">&quot;å¼ ç¥¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ­¥ä»£ç å—çš„é”æ˜¯è‡ªå·±å®šä¹‰çš„ä»»æ„ç±»å‹çš„å¯¹è±¡ã€‚åŒæ­¥æ–¹æ³•çš„é”æ˜¯å½“å‰è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯thisæŒ‡å‘çš„å¯¹è±¡ã€‚åŒæ­¥æ–¹æ³•è¢«æ‰€æœ‰çº¿ç¨‹æ‰€å…±äº«ï¼Œæ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡ç›¸å¯¹äºæ‰€æœ‰çº¿ç¨‹æ¥è¯´æ˜¯å”¯ä¸€çš„ï¼Œä»è€Œä¿è¯äº†é”çš„å”¯ä¸€æ€§ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå…¶ä»–çš„çº¿ç¨‹å°±ä¸èƒ½è¿›å…¥è¯¥æ–¹æ³•ã€‚</p>
<p>æœ‰æ—¶ï¼Œéœ€è¦åŒæ­¥çš„æ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼Œé™æ€æ–¹æ³•ä¸éœ€è¦åˆ›å»ºå¯¹è±¡å°±å¯ç”¨ç±»åè°ƒç”¨ï¼Œé™æ€åŒæ­¥æ–¹æ³•çš„é”æ˜¯è¯¥æ–¹æ³•æ‰€åœ¨ç±»çš„classå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥ç›´æ¥ç”¨<code>ç±»å.class</code>çš„æ–¹å¼æ¥è·å–ã€‚</p>
<p>åŒæ­¥ä»£ç å—å’ŒåŒæ­¥æ–¹æ³•ï¼šè§£å†³äº†å¤šçº¿ç¨‹è®¿é—®å…±äº«æ•°æ®æ—¶çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå³åŠ é”æ¥ä½¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p>
<p>å¼Šç«¯ï¼šçº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥ä»£ç æ—¶æ¯æ¬¡éƒ½ä¼šåˆ¤æ–­é”çš„çŠ¶æ€ï¼Œæ¶ˆè€—èµ„æºï¼Œæ•ˆç‡è¾ƒä½ã€‚</p>
<h3 id="åŒæ­¥é”"><a href="#åŒæ­¥é”" class="headerlink" title="åŒæ­¥é”"></a>åŒæ­¥é”</h3><p>synchronizedåŒæ­¥ä»£ç å—å’ŒåŒæ­¥æ–¹æ³•ä½¿ç”¨ä¸€ç§å°é—­å¼çš„é”æœºåˆ¶ï¼Œä½†æ˜¯å®ƒæ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ç­‰å€™è·å¾—é”çš„çº¿ç¨‹ï¼Œä¹Ÿæ— æ³•é€šè¿‡è½®è¯¢å¾—åˆ°é”ã€‚</p>
<p>JDK5å¼€å§‹ï¼Œjavaæä¾›äº†ä¸€ä¸ªåŠŸèƒ½æ›´å¼ºå¤§çš„Locké”ï¼ŒLocké”ä¸synchronizedéšå¼é”åœ¨åŠŸèƒ½ä¸ŠåŸºæœ¬ç›¸åŒï¼Œæœ€å¤§çš„ä¼˜åŠ¿åœ¨äºLocké”å¯ä»¥è®©æŸä¸ªçº¿ç¨‹åœ¨æŒç»­è·å–åŒæ­¥é”å¤±è´¥åè¿”å›ï¼Œä¸å†ç»§ç»­ç­‰å¾…ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ çµæ´»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: multithread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: Locké”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-11-30 14:51</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tset_Lock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LockThread</span> <span class="variable">saleThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LockThread</span>();</span><br><span class="line">        <span class="comment">//åˆ›å»ºå¹¶å¼€å¯4ä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿå››ä¸ªå”®ç¥¨çª—å£</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£3&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(saleThread, <span class="string">&quot;çª—å£4&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LockThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tickets</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="comment">//å®šä¹‰ä¸€ä¸ªlocké”å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            lo.lock();</span><br><span class="line">            <span class="keyword">if</span>(tickets&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);  <span class="comment">//æ¨¡æ‹Ÿå”®ç¥¨è€—æ—¶è¿‡ç¨‹</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName()</span><br><span class="line">                            +<span class="string">&quot;æ­£åœ¨å‘å”®ç¬¬&quot;</span>+tickets--+<span class="string">&quot;å¼ ç¥¨&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">                    lo.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Lock</code>æ¥å£çš„å®ç°ç±»ï¼š<code>ReentrantLock</code>ã€‚</p>
<p>è¿˜æœ‰<code>tryLock()</code>æ–¹æ³•ç”¨æ¥åˆ¤æ–­æŸä¸ªçº¿ç¨‹é”æ˜¯å¦å¯ç”¨ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä¸ç®¡æ˜¯åŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•è¿˜æ˜¯åŒæ­¥é”ï¼Œé”å¯¹è±¡éƒ½æ˜¯å‡ ä¸ªçº¿ç¨‹å…±äº«çš„ï¼Œä¸èƒ½åœ¨runæ–¹æ³•ä¸­å®šä¹‰ï¼Œéƒ½æ˜¯åœ¨runæ–¹æ³•ä¹‹å¤–å®šä¹‰ã€‚åŒæ­¥æ–¹æ³•ä¸­ï¼Œåªåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡ä»£è¡¨é”å¯¹è±¡ã€‚</p>
</blockquote>
<h3 id="æ­»é”é—®é¢˜"><a href="#æ­»é”é—®é¢˜" class="headerlink" title="æ­»é”é—®é¢˜"></a>æ­»é”é—®é¢˜</h3><p>ä¸¤ä¸ªçº¿ç¨‹éƒ½éœ€è¦å¯¹æ–¹æ‰€å ç”¨çš„é”ï¼Œä½†æ˜¯éƒ½æ— æ³•é‡Šæ”¾è‡ªå·±æ‰€æ‹¥æœ‰çš„é”ã€‚</p>
<h2 id="å¤šçº¿ç¨‹é€šä¿¡"><a href="#å¤šçº¿ç¨‹é€šä¿¡" class="headerlink" title="å¤šçº¿ç¨‹é€šä¿¡"></a>å¤šçº¿ç¨‹é€šä¿¡</h2><p>æ§åˆ¶å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ä¸€å®šçš„é¡ºåºè½®æµæ‰§è¡Œï¼Œæ­¤æ—¶å°±éœ€è¦è®©çº¿ç¨‹é—´è¿›è¡Œé€šä¿¡ï¼Œä¿è¯çº¿ç¨‹ä»»åŠ¡çš„åè°ƒè¿›è¡Œã€‚</p>
<p>Javaåœ¨Objectç±»ä¸­æä¾›äº†<code>wait()ã€notify()ã€notifyAll()</code>ç­‰æ–¹æ³•ç”¨äºè§£å†³çº¿ç¨‹é—´çš„é€šä¿¡é—®é¢˜ã€‚æ‰€æœ‰ç±»éƒ½æ˜¯Objectç±»çš„å­ç±»æˆ–é—´æ¥å­ç±»ï¼Œå› æ­¤ä»»ä½•ç±»éƒ½å¯ç›´æ¥ç”¨è¿™äº›æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">wait</span><span class="params">()</span>  <span class="comment">//ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">notify</span><span class="params">()</span>  <span class="comment">//å”¤é†’æ­¤åŒæ­¥é”ä¸Šç­‰å¾…çš„ç¬¬ä¸€ä¸ªè°ƒç”¨wait()æ–¹æ³•çš„çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">notifyAll</span><span class="params">()</span>  <span class="comment">//å”¤é†’æ­¤åŒæ­¥é”ä¸Šè°ƒç”¨wait()æ–¹æ³•çš„æ‰€æœ‰çº¿ç¨‹</span></span><br></pre></td></tr></table></figure>

<p>è¿™äº›æ–¹æ³•çš„è°ƒç”¨è€…éƒ½æ˜¯<strong>åŒæ­¥é”å¯¹è±¡</strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: multithread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: çº¿ç¨‹é—´é€šä¿¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-11-30 15:40</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread_Commu</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªé›†åˆç±»ï¼Œæ¨¡æ‹Ÿå­˜å‚¨ç”Ÿäº§çš„å•†å“</span></span><br><span class="line">        List&lt;Object&gt; goods = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è®°å½•çº¿ç¨‹æ‰§è¡Œå‰ç»Ÿä¸€çš„èµ·å§‹æ—¶é—´start</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…çº¿ç¨‹ï¼Œç”±äºç”Ÿäº§å•†å“å¹¶å­˜å…¥å•†å“é›†åˆ</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(System.currentTimeMillis()-start&lt;=<span class="number">1000</span>)&#123;  <span class="comment">//æ§åˆ¶æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">                <span class="comment">//ä½¿ç”¨synchronizedå…³é”®å­—åŒæ­¥å•†å“ç”Ÿäº§å’Œæ¶ˆè´¹</span></span><br><span class="line">                <span class="keyword">synchronized</span> (goods)&#123;</span><br><span class="line">                    <span class="comment">//æœ‰å•†å“å°±è®©ç”Ÿäº§è€…ç­‰å¾…</span></span><br><span class="line">                    <span class="keyword">if</span>(goods.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">try</span>&#123;</span><br><span class="line">                            goods.wait();</span><br><span class="line">                        &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">//ç”Ÿäº§è€…ç»§ç»­ç”Ÿäº§å•†å“</span></span><br><span class="line">                        num++;</span><br><span class="line">                        goods.add(<span class="string">&quot;å•†å“&quot;</span>+num);</span><br><span class="line">                        System.out.println(<span class="string">&quot;ç”Ÿäº§å•†å“&quot;</span>+num);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;ç”Ÿäº§è€…&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(System.currentTimeMillis()-start&lt;=<span class="number">1000</span>)&#123;  <span class="comment">//æ§åˆ¶æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">                <span class="comment">//ä½¿ç”¨synchronizedå…³é”®å­—åŒæ­¥å•†å“ç”Ÿäº§å’Œæ¶ˆè´¹</span></span><br><span class="line">                <span class="keyword">synchronized</span> (goods)&#123;</span><br><span class="line">                    <span class="comment">//å•†å“ä¸è¶³å°±å”¤é†’ç”Ÿäº§è€…è¿›è¡Œç”Ÿäº§</span></span><br><span class="line">                    <span class="keyword">if</span>(goods.size()&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                        goods.notifyAll();</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">//ç»§ç»­æ¶ˆè´¹å•†å“</span></span><br><span class="line">                        num++;</span><br><span class="line">                        goods.remove(<span class="string">&quot;å•†å“&quot;</span>+num);</span><br><span class="line">                        System.out.println(<span class="string">&quot;æ¶ˆè´¹å•†å“&quot;</span>+num);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;æ¶ˆè´¹è€…&quot;</span>);</span><br><span class="line">        <span class="comment">//åŒæ—¶å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸¤ä¸ªçº¿ç¨‹ï¼Œå¹¶ç»Ÿä¸€æ‰§è¡Œ100msæ—¶é—´</span></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šï¼Œå®ç°ä¾›éœ€æœ‰åºã€å‡è¡¡ï¼ŒæŒ‰ç…§å…ˆç”Ÿäº§åæ¶ˆè´¹çš„é¡ºåºè½®æµæ‰§è¡Œã€‚</p>
<p>æ³¨æ„ï¼šwaitå‡½æ•°ä¸­ï¼Œå¯æœ‰æ—¶é—´ï¼Œæ—¶é—´åˆ°äº†ï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨å”¤é†’å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ã€‚å”¤é†’çš„æ–¹å¼ï¼šå…¶ä»–çº¿ç¨‹notifyå”¤é†’ æˆ– æ—¶é—´åˆ°ã€‚</p>
<h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h2><p>å‰é¢çš„å¤šçº¿ç¨‹ä¸­ï¼Œå¤æ‚ä»»åŠ¡ä¼šé¢‘ç¹æ‰‹åŠ¨å¼åœ°åˆ›å»ºã€ç®¡ç†çº¿ç¨‹ï¼Œçº¿ç¨‹å¯¹è±¡ä½¿ç”¨äº†å¤§é‡çš„å†…å­˜ï¼Œåœ¨å¤§è§„æ¨¡åº”ç”¨ä¸­ï¼Œåˆ›å»ºã€åˆ†é…å’Œé‡Šæ”¾å¤šçº¿ç¨‹å¯¹è±¡ä¼šäº§ç”Ÿå¤§é‡å†…å­˜ç®¡ç†å¼€é”€ã€‚ä¸ºæ­¤ï¼ŒJavaæä¾›äº†çº¿ç¨‹æ± æ¥åˆ›å»ºå¤šçº¿ç¨‹ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–çº¿ç¨‹ç®¡ç†ã€‚</p>
<h3 id="Executoræ¥å£å®ç°çº¿ç¨‹æ± ç®¡ç†"><a href="#Executoræ¥å£å®ç°çº¿ç¨‹æ± ç®¡ç†" class="headerlink" title="Executoræ¥å£å®ç°çº¿ç¨‹æ± ç®¡ç†"></a>Executoræ¥å£å®ç°çº¿ç¨‹æ± ç®¡ç†</h3><p>ä»JDK5å¼€å§‹ï¼Œjava.util.concurrentåŒ…ä¸‹å¢åŠ äº†Executoræ¥å£åŠå…¶å­ç±»ï¼Œå…è®¸ä½¿ç”¨çº¿ç¨‹æ± æŠ€æœ¯æ¥ç®¡ç†çº¿ç¨‹å¹¶å‘é—®é¢˜ã€‚</p>
<p>Executoræ¥å£æä¾›ä¸€ä¸ªå¸¸ç”¨çš„ExecutorServiceå­æ¥å£ï¼Œé€šè¿‡è¯¥å­æ¥å£å¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†çº¿ç¨‹æ± ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: multithread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-12-01 12:50</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.å®šä¹‰ä¸€ä¸ªå®ç°Runnableæ¥å£æˆ–è€…Callableæ¥å£çš„å®ç°ç±»ï¼ŒåŒæ—¶é‡å†™run()æˆ–è€…call()æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread4</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Object&gt;&#123;</span><br><span class="line">    <span class="comment">//1.1é‡å†™Callableæ¥å£çš„call()æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i++&lt;<span class="number">5</span>)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()</span><br><span class="line">                              +<span class="string">&quot;çš„call()æ–¹æ³•åœ¨è¿è¡Œ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread_Pool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException &#123;</span><br><span class="line">        <span class="comment">//2.åˆ›å»ºRunnableæ¥å£æˆ–è€…Callableæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">MyThread4</span> <span class="variable">myth</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread4</span>();</span><br><span class="line">        <span class="comment">//3.ä½¿ç”¨Executorsçº¿ç¨‹æ‰§è¡Œå™¨ç±»åˆ›å»ºå¯æ‰©å±•çš„çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        <span class="comment">//4.å°†Callableæ¥å£å®ç°ç±»å¯¹è±¡æäº¤åˆ°çº¿ç¨‹æ± è¿›è¡Œç®¡ç†</span></span><br><span class="line">        Future&lt;Object&gt;res1 = executor.submit(myth);</span><br><span class="line">        Future&lt;Object&gt;res2 = executor.submit(myth);</span><br><span class="line">        <span class="comment">//5.å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">        executor.shutdown();</span><br><span class="line">        <span class="comment">//å¯¹äºæœ‰è¿”å›å€¼çš„çº¿ç¨‹ä»»åŠ¡ï¼Œè·å–æ‰§è¡Œç»“æœ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;thread-1è¿”å›ç»“æœï¼š&quot;</span>+res1.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;thread-2è¿”å›ç»“æœï¼š&quot;</span>+res2.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹æ± executorç³»ç»Ÿç»™åå­—pool-1.è¯¥çº¿ç¨‹æ± ä¸­ç®¡ç†æœ‰ä¸¤ä¸ªé»˜è®¤ç”Ÿæˆåç§°çš„çº¿ç¨‹thread-1å’Œthread-2.</p>
<p>çº¿ç¨‹æ± é€šè¿‡Executorsçš„newCachedThreadPoolæ–¹æ³•åˆ›å»ºï¼ŒExecutorsæ˜¯JDK5å¢åŠ çš„çº¿ç¨‹æ‰§è¡Œå™¨å·¥å…·ç±»ï¼Œæä¾›å››ç§æ–¹æ³•åˆ›å»ºçº¿ç¨‹æ± ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">newCachedThreadPool()    åˆ›å»ºä¸€ä¸ªå¯æ‰©å±•çº¿ç¨‹æ± çš„æ‰§è¡Œå™¨ã€‚é€‚åˆç”±äºå¯åŠ¨è®¸å¤šçŸ­æœŸä»»åŠ¡çš„åº”ç”¨ç¨‹åºã€‚</span><br><span class="line">newFixedThreadPool(<span class="type">int</span> n)     åˆ›å»ºå›ºå®šçº¿ç¨‹æ•°é‡çº¿ç¨‹æ± çš„æ‰§è¡Œå™¨ã€‚</span><br><span class="line">newSingleThreadExecutor()     åˆ›å»ºä¸€ä¸ªåªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡çš„å•çº¿ç¨‹</span><br><span class="line">newScheduledThreadPool(<span class="type">int</span> size)    åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure>

<h3 id="CompletableFutureç±»å®ç°çº¿ç¨‹æ± ç®¡ç†"><a href="#CompletableFutureç±»å®ç°çº¿ç¨‹æ± ç®¡ç†" class="headerlink" title="CompletableFutureç±»å®ç°çº¿ç¨‹æ± ç®¡ç†"></a>CompletableFutureç±»å®ç°çº¿ç¨‹æ± ç®¡ç†</h3><p>ä½¿ç”¨Callableæ¥å£å®ç°å¤šçº¿ç¨‹æ—¶ï¼Œä¼šç”¨åˆ°FutureTaskç±»å¯¹çº¿ç¨‹æ‰§è¡Œç»“æœè¿›è¡Œç®¡ç†å’Œè·å–ï¼Œè¯¥ç±»è·å–ç»“æœæ—¶æ˜¯é€šè¿‡é˜»å¡æˆ–è€…è½®è¯¢çš„æ–¹å¼ï¼Œæ¶ˆè€—è¿‡å¤šèµ„æºã€‚</p>
<p>JDK8å¢åŠ äº†ä¸€ä¸ªå¼ºå¤§çš„å‡½æ•°å¼å¼‚æ­¥ç¼–ç¨‹è¾…åŠ©ç±»CompletableFutureï¼Œè¯¥ç±»åŒæ—¶å®ç°äº†Futureæ¥å£å’ŒCompletionStageæ¥å£ï¼ˆJava8å¢åŠ çš„çº¿ç¨‹ä»»åŠ¡å®Œæˆç»“æœæ¥å£ï¼‰ï¼Œå¯ä»¥ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠJavaåŸºç¡€å…¥é—¨ã€‹ä¹‹JDBC</title>
    <url>/2021/11/27/myblog/java/%E3%80%8Ajava%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E3%80%8B%E4%B9%8BJDBC/</url>
    <content><![CDATA[<p>å®é™…å¼€å‘ä¸­ï¼Œé¡¹ç›®ä¸­çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ï¼ŒJavaå¯¹æ•°æ®åº“çš„æ“ä½œæä¾›äº†ä¸€å¥—å¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„APIï¼Œå³JDBCã€‚</p>
<h2 id="JDBCæ¦‚å¿µ"><a href="#JDBCæ¦‚å¿µ" class="headerlink" title="JDBCæ¦‚å¿µ"></a>JDBCæ¦‚å¿µ</h2><p>JDBCï¼ˆjava database connectivityï¼ŒJavaæ•°æ®åº“è¿æ¥ï¼‰æ˜¯ä¸€å¥—ç”¨äºæ‰§è¡ŒSQLè¯­å¥çš„Java APIã€‚åº”ç”¨ç¨‹åºé€šè¿‡è¯¥APIè¿æ¥åˆ°å…³ç³»å‹æ•°æ®åº“ï¼Œå¹¶ä½¿ç”¨SQLè¯­å¥æ¥å®Œæˆå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€‚</p>
<p>JDBCè¦æ±‚å„ä¸ªæ•°æ®åº“å‚å•†æŒ‰ç…§ç»Ÿä¸€çš„è§„èŒƒæ¥æä¾›æ•°æ®åº“é©±åŠ¨ï¼Œåœ¨ç¨‹åºä¸­ç”±JDBCå’Œå…·ä½“çš„æ•°æ®åº“é©±åŠ¨è”ç³»ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä¸å¿…ç›´æ¥ä¸åº•å±‚æ•°æ®åº“äº¤äº’ï¼Œä½¿å¾—ä»£ç çš„é€šç”¨æ€§æ›´å¼ºã€‚</p>
<p>JDBCåœ¨åº”ç”¨ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´èµ·åˆ°ä¸€ä¸ªæ¡¥æ¢ä½œç”¨ã€‚å½“åº”ç”¨ç¨‹åºä½¿ç”¨JDBCè®¿é—®ç‰¹å®šçš„æ•°æ®åº“æ—¶ï¼Œåªéœ€è¦é€šè¿‡ä¸åŒçš„æ•°æ®åº“é©±åŠ¨ä¸å…¶å¯¹åº”çš„æ•°æ®åº“è¿›è¡Œè¿æ¥ï¼Œè¿æ¥åå³å¯å¯¹è¯¥æ•°æ®åº“è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<h2 id="JDBCå¸¸ç”¨API"><a href="#JDBCå¸¸ç”¨API" class="headerlink" title="JDBCå¸¸ç”¨API"></a>JDBCå¸¸ç”¨API</h2><p>JDBCçš„APIä¸»è¦ä½äºjava.sqlåŒ…ä¸­ï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—è®¿é—®æ•°æ®åº“çš„æ¥å£å’Œç±»ã€‚</p>
<h3 id="Driveræ¥å£"><a href="#Driveræ¥å£" class="headerlink" title="Driveræ¥å£"></a>Driveræ¥å£</h3><p>æ˜¯æ‰€æœ‰JDBCé©±åŠ¨ç¨‹åºå¿…é¡»å®ç°çš„æ¥å£ï¼Œä¸“é—¨æä¾›ç»™æ•°æ®åº“å‚å•†ä½¿ç”¨ã€‚</p>
<h3 id="DriverManagerç±»"><a href="#DriverManagerç±»" class="headerlink" title="DriverManagerç±»"></a>DriverManagerç±»</h3><p>ç”¨äºåŠ è½½JDBCé©±åŠ¨å¹¶åˆ›å»ºä¸æ•°æ®åº“çš„è¿æ¥ã€‚åœ¨åŠ è½½æ•°æ®åº“é©±åŠ¨æ—¶ï¼Œé€šå¸¸ä½¿ç”¨Classç±»çš„é™æ€æ–¹æ³•forName()æ¥å®ç°ã€‚å‚æ•°æ˜¯æ•°æ®åº“é©±åŠ¨ç±»æ‰€å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p>
<h3 id="Connectionæ¥å£"><a href="#Connectionæ¥å£" class="headerlink" title="Connectionæ¥å£"></a>Connectionæ¥å£</h3><p>ä»£è¡¨Javaç¨‹åºå’Œæ•°æ®åº“çš„è¿æ¥å¯¹è±¡ï¼Œåªæœ‰è·å¾—è¯¥è¿æ¥å¯¹è±¡åï¼Œæ‰èƒ½è®¿é—®æ•°æ®åº“ï¼Œå¹¶æ“ä½œæ•°æ®è¡¨ã€‚</p>
<h3 id="Statementæ¥å£"><a href="#Statementæ¥å£" class="headerlink" title="Statementæ¥å£"></a>Statementæ¥å£</h3><p>ç”¨äºæ‰§è¡Œé™æ€çš„SQLè¯­å¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªç»“æœå¯¹è±¡ã€‚</p>
<p>Statementæ¥å£å¯¹è±¡å¯ä»¥é€šè¿‡Connectionå®ä¾‹çš„createStatement()æ–¹æ³•è·å¾—ï¼Œè¯¥æ–¹æ³•æŠŠé™æ€çš„SQLè¯­å¥å‘é€åˆ°æ•°æ®åº“ä¸­ç¼–è¯‘æ‰§è¡Œï¼Œç„¶åè¿”å›æ•°æ®åº“çš„å¤„ç†ç»“æœã€‚</p>
<h3 id="PreparedStatementæ¥å£"><a href="#PreparedStatementæ¥å£" class="headerlink" title="PreparedStatementæ¥å£"></a>PreparedStatementæ¥å£</h3><p>ä½¿ç”¨Statementæ¥å£æ“ä½œSQLè¯­å¥ä¼šè¿‡äºç¹çï¼Œå¹¶ä¸”å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œå› æ­¤ï¼ŒJDBCæä¾›äº†æ‰©å±•çš„PreparedStatementæ¥å£ã€‚æ˜¯Statementçš„å­æ¥å£ï¼Œç”¨äºæ‰§è¡Œé¢„ç¼–è¯‘çš„SQLè¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨å ä½ç¬¦ï¼Ÿæ¥æ›¿ä»£å‚æ•°ï¼Œç„¶åé€šè¿‡setXXX()æ–¹æ³•ä¸ºSQLè¯­å¥çš„å‚æ•°èµ‹å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String sql=<span class="string">&quot;insert into users(is,name,email) values(?,?,?)&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">prestmt</span> <span class="operator">=</span> conn.preparedStatement(sql);</span><br><span class="line">prestmt.setInt(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">prestmt.setString(<span class="number">2</span>,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">prestmt.setObject(<span class="number">3</span>,<span class="string">&quot;111@1.com&quot;</span>);  <span class="comment">//é€šç”¨æ–¹æ³•ï¼Ÿ</span></span><br><span class="line">prestmt.executeUpdate();</span><br></pre></td></tr></table></figure>

<h3 id="ResultSetæ¥å£"><a href="#ResultSetæ¥å£" class="headerlink" title="ResultSetæ¥å£"></a>ResultSetæ¥å£</h3><p>ç”¨äºä¿å­˜JDBCæ‰§è¡ŒæŸ¥è¯¢æ—¶è¿”å›çš„ç»“æœé›†ï¼Œç»“æœé›†å°è£…åœ¨ä¸€ä¸ªé€»è¾‘è¡¨æ ¼ä¸­ã€‚æ¥å£å†…éƒ¨æœ‰ä¸€ä¸ªæŒ‡å‘è¡¨æ ¼æ•°æ®è¡Œçš„æ¸¸æ ‡ï¼ˆæˆ–æŒ‡é’ˆï¼‰ï¼ŒResultSetå¯¹è±¡åˆå§‹åŒ–æ—¶ï¼Œæ¸¸æ ‡åœ¨ç¬¬ä¸€è¡Œä¹‹å‰ã€‚è°ƒç”¨next()æ–¹æ³•ï¼Œæ¸¸æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œï¼Œè‹¥ä¸‹ä¸€è¡Œæ²¡æœ‰æ•°æ®ï¼Œåˆ™è¿”å›falseã€‚</p>
<p>åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨nextæ–¹æ³•ä½œä¸ºwhileå¾ªç¯çš„æ¡ä»¶æ¥è¿­ä»£ResultSetç»“æœé›†ã€‚</p>
<p>getXXXæ–¹æ³•ç”¨äºè·å–æŒ‡å®šçš„æ•°æ®ï¼Œå¯ä»¥ç”¨ç´¢å¼•ï¼ˆä»1å¼€å§‹ï¼‰ä¹Ÿå¯ç”¨å­—æ®µçš„åç§°æ¥è·å–ã€‚</p>
<p>ä¾‹å¦‚ç¬¬1åˆ—å­—æ®µåä¸ºidï¼Œå­—æ®µç±»å‹intï¼Œå¯ä»¥ç”¨getInt(â€œidâ€)æˆ–getInt(1)è·å¾—è¯¥åˆ—çš„å€¼ã€‚</p>
<h2 id="å…·ä½“æ“ä½œ"><a href="#å…·ä½“æ“ä½œ" class="headerlink" title="å…·ä½“æ“ä½œ"></a>å…·ä½“æ“ä½œ</h2><h3 id="ç¬¬ä¸€æ­¥ï¼šåŠ è½½æ•°æ®åº“é©±åŠ¨"><a href="#ç¬¬ä¸€æ­¥ï¼šåŠ è½½æ•°æ®åº“é©±åŠ¨" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šåŠ è½½æ•°æ®åº“é©±åŠ¨"></a><em>ç¬¬ä¸€æ­¥ï¼šåŠ è½½æ•°æ®åº“é©±åŠ¨</em></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);  <span class="comment">//åŠ è½½mysqlæ•°æ®åº“çš„é©±åŠ¨</span></span><br><span class="line">Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);   <span class="comment">//åŠ è½½Oracleæ•°æ®åº“çš„é©±åŠ¨</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒæ­¥ï¼šè·å–æ•°æ®åº“è¿æ¥"><a href="#ç¬¬äºŒæ­¥ï¼šè·å–æ•°æ®åº“è¿æ¥" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šè·å–æ•°æ®åº“è¿æ¥"></a><em>ç¬¬äºŒæ­¥ï¼šè·å–æ•°æ®åº“è¿æ¥</em></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(String url, String user, String pwd);</span><br></pre></td></tr></table></figure>

<p>è¿æ¥æ•°æ®åº“çš„urléœ€è¦éµå¾ªå›ºå®šå†™æ³•ï¼š</p>
<p><code>jdbc:mysql://hostname:port/databasename</code></p>
<p>mysqlæŒ‡MySQLæ•°æ®åº“ï¼ŒhostnameæŒ‡ä¸»æœºçš„åç§°ï¼ˆå¦‚æœæ•°æ®åº“åœ¨æœ¬æœºä¸Šï¼Œhostnameå¯ä»¥ä¸ºlocalhostæˆ–127.0.0.1ã€‚å¦‚æœåœ¨å…¶ä»–æœºå™¨ä¸Šï¼Œé‚£ä¹ˆhostnameä¸ºæ‰€è¦è¿æ¥æœºå™¨çš„IPåœ°å€ã€‚portæŒ‡ç«¯å£å·ï¼Œmysqlé»˜è®¤ç«¯å£å·ä¸º3306ï¼ŒdatabasenameæŒ‡çš„æ˜¯mysqlä¸­ç›¸åº”æ•°æ®åº“çš„åå­—ã€‚</p>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡Connectionå¯¹è±¡è·å–Statementå¯¹è±¡"><a href="#ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡Connectionå¯¹è±¡è·å–Statementå¯¹è±¡" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡Connectionå¯¹è±¡è·å–Statementå¯¹è±¡"></a><em>ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡Connectionå¯¹è±¡è·å–Statementå¯¹è±¡</em></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ç”¨PreparedStatementã€‚</p>
<h3 id="ç¬¬å››æ­¥ï¼šä½¿ç”¨Statementæ‰§è¡ŒSQLè¯­å¥"><a href="#ç¬¬å››æ­¥ï¼šä½¿ç”¨Statementæ‰§è¡ŒSQLè¯­å¥" class="headerlink" title="ç¬¬å››æ­¥ï¼šä½¿ç”¨Statementæ‰§è¡ŒSQLè¯­å¥"></a><em>ç¬¬å››æ­¥ï¼šä½¿ç”¨Statementæ‰§è¡ŒSQLè¯­å¥</em></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execute(String sql);  ç”¨äºæ‰§è¡Œä»»æ„sqlè¯­å¥</span><br><span class="line">executeQuery(String sql);   æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œè¿”å›ä¸€ä¸ªResultSetç»“æœé›†å¯¹è±¡</span><br><span class="line">executeUpdate(String sql);  æ‰§è¡Œinsertã€updateã€deleteä¼šè¿”å›å—sqlè¯­å¥å½±å“çš„è¡Œæ•°ï¼Œæ‰§è¡Œcreateã€alterè¿”å›<span class="number">0</span></span><br><span class="line"></span><br><span class="line">ResultSet rs=stmt.executeQuery(sql);</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äº”æ­¥ï¼šæ“ä½œResultSetç»“æœé›†"><a href="#ç¬¬äº”æ­¥ï¼šæ“ä½œResultSetç»“æœé›†" class="headerlink" title="ç¬¬äº”æ­¥ï¼šæ“ä½œResultSetç»“æœé›†"></a><em>ç¬¬äº”æ­¥ï¼šæ“ä½œResultSetç»“æœé›†</em></h3><h3 id="ç¬¬å…­æ­¥ï¼šå…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æº"><a href="#ç¬¬å…­æ­¥ï¼šå…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æº" class="headerlink" title="ç¬¬å…­æ­¥ï¼šå…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æº"></a><em>ç¬¬å…­æ­¥ï¼šå…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æº</em></h3><p>é¡ºåºä¸ºï¼šResultSetã€Statementã€Connectionã€‚ä¸ºäº†ä¿è¯åœ¨å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿèƒ½å…³é—­èµ„æºï¼Œç”¨tryâ€¦catchçš„finallyä»£ç å—ç»Ÿä¸€å…³é—­èµ„æºã€‚</p>
<h2 id="ç¬¬ä¸€ä¸ªJDBCç¨‹åº"><a href="#ç¬¬ä¸€ä¸ªJDBCç¨‹åº" class="headerlink" title="ç¬¬ä¸€ä¸ªJDBCç¨‹åº"></a>ç¬¬ä¸€ä¸ªJDBCç¨‹åº</h2><h3 id="æ•°æ®åº“å»ºè¡¨"><a href="#æ•°æ®åº“å»ºè¡¨" class="headerlink" title="æ•°æ®åº“å»ºè¡¨"></a>æ•°æ®åº“å»ºè¡¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create database jdbc;</span><br><span class="line">show databases;</span><br><span class="line">use jdbc;</span><br><span class="line">create table test_table(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(40),</span><br><span class="line">    sex varchar(2),</span><br><span class="line">    birthday date</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŸ¥çœ‹è¡¨ç»“æ„ï¼š desc test_table;</span><br><span class="line">æŸ¥çœ‹å»ºè¡¨è¯­å¥ï¼šshow create table test_table;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå‡ºç°ä¸­æ–‡ä¹±ç çš„æƒ…å†µï¼Œæ˜¯å› ä¸ºMySQLæ•°æ®åº“é»˜è®¤ä½¿ç”¨UTF-8ç¼–ç æ ¼å¼ï¼Œè€Œå‘½ä»¤è¡Œçª—å£é»˜è®¤ä½¿ç”¨çš„æ˜¯GBKç¼–ç æ ¼å¼ï¼Œæ‰€ä»¥æ‰§è¡Œå¸¦æœ‰ä¸­æ–‡æ•°æ®çš„æ’å…¥è¯­å¥ä¼šå‡ºç°è§£æé”™è¯¯ã€‚éœ€è¦æ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set character_set_client=gbk;</span><br><span class="line">set character_set_results=gbk;</span><br></pre></td></tr></table></figure>

<h3 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">insert into test_table(name, sex, birthday)</span><br><span class="line">values(&#x27;jade&#x27;,&#x27;ç”·&#x27;,&#x27;2000-1-1&#x27;),(&#x27;marry&#x27;,&#x27;å¥³&#x27;,&#x27;1999-2-21&#x27;),(&#x27;james&#x27;,&#x27;ç”·&#x27;,&#x27;2010-2-3&#x27;);</span><br></pre></td></tr></table></figure>

<h3 id="æ–°å»ºé¡¹ç›®ï¼Œå¯¼å…¥æ•°æ®åº“é©±åŠ¨"><a href="#æ–°å»ºé¡¹ç›®ï¼Œå¯¼å…¥æ•°æ®åº“é©±åŠ¨" class="headerlink" title="æ–°å»ºé¡¹ç›®ï¼Œå¯¼å…¥æ•°æ®åº“é©±åŠ¨"></a>æ–°å»ºé¡¹ç›®ï¼Œå¯¼å…¥æ•°æ®åº“é©±åŠ¨</h3><p>IDEä¸‹æ­£å¸¸åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå³é”®æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå–ålibsã€‚</p>
<p>ä¸‹è½½Mysqlé©±åŠ¨æ–‡ä»¶ï¼š<a href="https://dev.mysql.com/downloads/connector/j/%EF%BC%8C%E9%80%89%E6%8B%A9platform">https://dev.mysql.com/downloads/connector/j/ï¼Œé€‰æ‹©platform</a> independentï¼Œä¸‹è½½ <strong>ZIP Archive</strong>ã€‚ç›´æ¥No thanks, just start my download.  å¤åˆ¶åˆ°libsæ–‡ä»¶å¤¹ä¸‹ã€‚</p>
<p>æŠŠjaråŒ…æ·»åŠ åˆ°é¡¹ç›®é‡Œï¼Œç±»ä¼¼eclipseçš„add to build pathåŠŸèƒ½ï¼Œfile â€“ project structure â€“ modules â€“ dependencies â€“ åŠ å· â€“ ç¬¬ä¸€é¡¹â€“æ·»åŠ jaråŒ… â€“ applyã€‚</p>
<h3 id="ç¼–å†™JDBCç¨‹åº"><a href="#ç¼–å†™JDBCç¨‹åº" class="headerlink" title="ç¼–å†™JDBCç¨‹åº"></a>ç¼–å†™JDBCç¨‹åº</h3><p>srcä¸‹æ–°å»ºåŒ…com.liuxuan.jdbcã€‚åˆ›å»ºç±»Testã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jdk.nashorn.internal.parser.JSONParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: JDBCdemo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: jdbc</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2021-11-27 22:09</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//1.åŠ è½½æ•°æ®åº“é©±åŠ¨ com.mysql.jdbc.Driver å¤šåŠ äº†cj</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">            <span class="comment">//2.é€šè¿‡DriverManagerè·å–æ•°æ®åº“è¿æ¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/jdbc&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;liuxuan&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;jade&quot;</span>;</span><br><span class="line">            conn = DriverManager.getConnection(url, username, password);</span><br><span class="line">            <span class="comment">//3.é€šè¿‡Connectionå¯¹è±¡è·å–Statementå¯¹è±¡</span></span><br><span class="line">            stmt = conn.createStatement();</span><br><span class="line">            <span class="comment">//4.ä½¿ç”¨Statementæ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from test_table&quot;</span>;</span><br><span class="line">            rs = stmt.executeQuery(sql);</span><br><span class="line">            <span class="comment">//5.æ“ä½œResultSetç»“æœé›†</span></span><br><span class="line">            System.out.println(<span class="string">&quot;id  |  name  |  sex  &quot;</span></span><br><span class="line">                            +<span class="string">&quot;  birthday  &quot;</span>);</span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">sex</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line">                <span class="type">Date</span> <span class="variable">birthday</span> <span class="operator">=</span> rs.getDate(<span class="string">&quot;birthday&quot;</span>);</span><br><span class="line">                System.out.println(id+<span class="string">&quot;  |  &quot;</span>+name+<span class="string">&quot;  |  &quot;</span></span><br><span class="line">                                +sex+<span class="string">&quot;  |  &quot;</span>+birthday);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">//6.å…³é—­è¿æ¥ï¼Œé‡Šæ”¾èµ„æº</span></span><br><span class="line">            <span class="keyword">if</span>(rs != <span class="literal">null</span>)&#123;rs.close();&#125;</span><br><span class="line">            <span class="keyword">if</span>(stmt != <span class="literal">null</span>)&#123;stmt.close();&#125;</span><br><span class="line">            <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;conn.close();&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonä¹‹é›¶ç¢çŸ¥è¯†ç‚¹</title>
    <url>/2025/08/05/myblog/python/python%E4%B9%8B%E9%9B%B6%E7%A2%8E%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
    <content><![CDATA[<h2 id="pythoné€šè¿‡æ‰§è¡Œå‘½ä»¤è·å–å‚æ•°"><a href="#pythoné€šè¿‡æ‰§è¡Œå‘½ä»¤è·å–å‚æ•°" class="headerlink" title="pythoné€šè¿‡æ‰§è¡Œå‘½ä»¤è·å–å‚æ•°"></a>pythoné€šè¿‡æ‰§è¡Œå‘½ä»¤è·å–å‚æ•°</h2><p>1ã€sys.argvï¼šè·å–è„šæœ¬è¿è¡Œæ—¶çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯è„šæœ¬åç§° </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Script name:&quot;</span>, sys.argv[<span class="number">0</span>])  <span class="comment"># è„šæœ¬åç§° </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Arguments:&quot;</span>, sys.argv[<span class="number">1</span>:])  <span class="comment"># å‚æ•°åˆ—è¡¨ </span></span><br><span class="line">è¿è¡Œå‘½ä»¤ï¼špython script.py arg1 arg2 arg3</span><br></pre></td></tr></table></figure>

<p>2ã€argparseï¼šé«˜çº§å‘½ä»¤è¡Œå‚æ•°è§£æ </p>
<p>é¦–å…ˆä½¿ç”¨argparse.ArgumentParseråˆ›å»ºè§£æå™¨ã€‚ç„¶åå®šä¹‰å‚æ•°ï¼ˆå¦‚ä½ç½®å‚æ•°ã€å¯é€‰å‚æ•°ç­‰ï¼‰ã€‚æœ€åè§£æå‚æ•°å¹¶è®¿é—®å…¶å€¼ã€‚ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè§£æå™¨ </span></span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">&quot;A simple argument parser example.&quot;</span>) </span><br><span class="line"><span class="comment"># æ·»åŠ å‚æ•° </span></span><br><span class="line">parser.add_argument(<span class="string">&quot;name&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;User&#x27;s name&quot;</span>) </span><br><span class="line">parser.add_argument(<span class="string">&quot;--age&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, <span class="built_in">help</span>=<span class="string">&quot;User&#x27;s age&quot;</span>, default=<span class="number">18</span>) </span><br><span class="line">parser.add_argument(<span class="string">&quot;--verbose&quot;</span>, action=<span class="string">&quot;store_true&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Enable verbose mode&quot;</span>) </span><br><span class="line"><span class="comment"># è§£æå‚æ•° </span></span><br><span class="line">args = parser.parse_args() </span><br><span class="line"><span class="comment"># è®¿é—®å‚æ•° </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Hello, <span class="subst">&#123;args.name&#125;</span>!&quot;</span>) </span><br><span class="line"><span class="comment"># ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚åªè¦å®ƒå‡ºç°åœ¨å‘½ä»¤è¡Œä¸­ï¼Œargs.verbose çš„å€¼å°±ä¼šè¢«è®¾ç½®ä¸º Trueã€‚</span></span><br><span class="line"><span class="keyword">if</span> args.verbose: </span><br><span class="line">è¿è¡Œå‘½ä»¤ï¼špython script.py Alice --age <span class="number">25</span> --verbose</span><br></pre></td></tr></table></figure>



<h2 id="åŠ¨æ€åŠ è½½æ¨¡å—"><a href="#åŠ¨æ€åŠ è½½æ¨¡å—" class="headerlink" title="åŠ¨æ€åŠ è½½æ¨¡å—"></a>åŠ¨æ€åŠ è½½æ¨¡å—</h2><p>importlib: ç”¨äºåŠ¨æ€åŠ è½½æ¨¡å—ã€‚ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">importlib.import_module <span class="comment"># åœ¨è¿è¡Œæ—¶æ ¹æ®æ¡ä»¶æˆ–é…ç½®å¯¼å…¥ä¸åŒæ¨¡å— </span></span><br><span class="line">module = import_module(<span class="string">&#x27;math&#x27;</span>) </span><br><span class="line"><span class="built_in">print</span>(module.sqrt(<span class="number">4</span>)) </span><br></pre></td></tr></table></figure>

<p>pkgutil.iter_modulesï¼šç”¨äºåŠ¨æ€åœ°åˆ—å‡ºæŒ‡å®šåŒ…æˆ–è·¯å¾„ä¸­çš„æ‰€æœ‰æ¨¡å— </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> module_info <span class="keyword">in</span> pkgutil.iter_modules():    </span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;Name: <span class="subst">&#123;module_info.name&#125;</span>, Is Package: <span class="subst">&#123;module_info.ispkg&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>inspect.getmembers ï¼šç”¨äºè·å–å¯¹è±¡ï¼ˆæ¨¡å—ã€ç±»ã€å®ä¾‹ç­‰ï¼‰çš„æ‰€æœ‰æˆå‘˜å±æ€§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">methods = inspect.getmembers(MyClass, predicate=inspect.isfunction) </span><br><span class="line">inspect.ismethod	å®ä¾‹æ–¹æ³• </span><br><span class="line">inspect.isfunction	æ™®é€šå‡½æ•° </span><br><span class="line">inspect.isclass	ç±»å¯¹è±¡ </span><br><span class="line">inspect.isdatadescriptor	æ•°æ®æè¿°ç¬¦ï¼ˆå¦‚<span class="built_in">property</span>ï¼‰ </span><br><span class="line">inspect.isgenerator	ç”Ÿæˆå™¨å¯¹è±¡</span><br></pre></td></tr></table></figure>



<h2 id="OutputNamedTuple"><a href="#OutputNamedTuple" class="headerlink" title="OutputNamedTuple"></a>OutputNamedTuple</h2><p>å‘½åå…ƒç»„ï¼Œå‘½åå…ƒç»„æ˜¯ç”± <code>collections.namedtuple()</code> å‡½æ•°åˆ›å»ºçš„æ•°æ®ç±»å‹ã€‚å‘½åå…ƒç»„æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªç±»æ˜¯ä»å†…ç½®çš„å…ƒç»„ç±»å‹ç»§æ‰¿è€Œæ¥çš„ï¼Œä½†ä¸æ™®é€šå…ƒç»„ä¸åŒçš„æ˜¯ï¼Œå®ƒçš„å…ƒç´ å¯ä»¥é€šè¿‡åå­—æ¥è®¿é—®ï¼Œè€Œä¸ä»…ä»…æ˜¯é€šè¿‡ç´¢å¼•ä½ç½®ã€‚</p>
<p>ç‰¹æ€§ï¼š<strong>å¯å‘½åæ€§</strong>ã€<strong>ä¸å¯å˜æ€§</strong>ã€<strong>è½»é‡çº§å¯¹è±¡</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªå‘½åå…ƒç»„ç±»å‹ &#x27;Person&#x27;</span></span><br><span class="line">Person = namedtuple(<span class="string">&#x27;Person&#x27;</span>, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ª Person å®ä¾‹</span></span><br><span class="line">person = Person(name=<span class="string">&#x27;Alice&#x27;</span>, age=<span class="number">30</span>, gender=<span class="string">&#x27;female&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡åç§°è®¿é—®å­—æ®µ</span></span><br><span class="line"><span class="built_in">print</span>(person.name)   <span class="comment"># è¾“å‡º: Alice</span></span><br><span class="line"><span class="built_in">print</span>(person.age)    <span class="comment"># è¾“å‡º: 30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ ·ä¹Ÿå¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®</span></span><br><span class="line"><span class="built_in">print</span>(person[<span class="number">0</span>])     <span class="comment"># è¾“å‡º: Alice</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£åŒ…æ“ä½œ</span></span><br><span class="line">name, age, gender = person</span><br><span class="line"><span class="built_in">print</span>(gender)        <span class="comment"># è¾“å‡º: female</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢ä¸ºå­—å…¸</span></span><br><span class="line">person_dict = person._asdict()</span><br><span class="line"><span class="built_in">print</span>(person_dict)   <span class="comment"># è¾“å‡º: OrderedDict([(&#x27;name&#x27;, &#x27;Alice&#x27;), (&#x27;age&#x27;, 30), (&#x27;gender&#x27;, &#x27;female&#x27;)])</span></span><br></pre></td></tr></table></figure>



<h2 id="å…ƒç»„å’Œå­—å…¸"><a href="#å…ƒç»„å’Œå­—å…¸" class="headerlink" title="å…ƒç»„å’Œå­—å…¸"></a>å…ƒç»„å’Œå­—å…¸</h2><p><strong>å…ƒç»„</strong>ï¼šæ˜¯ä¸€ä¸ªæœ‰åºçš„ã€ä¸å¯å˜çš„æ•°æ®é›†åˆã€‚å…ƒç»„ä¸­çš„å…ƒç´ é€šè¿‡ç´¢å¼•æ¥è®¿é—®ï¼Œæ”¯æŒé‡å¤å€¼ã€‚<br>ä¸€æ—¦åˆ›å»ºåï¼Œå…¶å†…å®¹ä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™è¢«ç§°ä¸ºâ€œä¸å¯å˜æ€§â€ï¼Œæ„å‘³ç€ä½ ä¸èƒ½æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹å…ƒç»„ä¸­çš„å…ƒç´ ã€‚<br>ä½¿ç”¨åœºæ™¯ï¼šå¤šè¿”å›å€¼å‡½æ•°ã€å›ºå®šé›†åˆç­‰ã€‚æ­¤å¤–ï¼Œå…ƒç»„å ç”¨çš„ç©ºé—´ç›¸å¯¹è¾ƒå°ï¼Œé€‚åˆç”¨äºå­˜å‚¨å°‘é‡ä½†å›ºå®šçš„é¡¹ç›®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tuple_example = (<span class="number">1</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="number">3.14</span>)</span><br><span class="line"><span class="built_in">print</span>(tuple_example[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<p><strong>å­—å…¸</strong>ï¼šæ˜¯ä¸€ä¸ªæ— åºçš„é”®å€¼å¯¹é›†åˆï¼Œé”®å¿…é¡»æ˜¯å”¯ä¸€çš„ä¸”ä¸å¯å˜ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å­—æˆ–å…ƒç»„ï¼‰ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚å­—å…¸é€šè¿‡é”®æ¥è®¿é—®å¯¹åº”çš„å€¼ã€‚<br>æ˜¯å¯å˜çš„ï¼Œä½ å¯ä»¥éšæ—¶æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ–°å­—å…¸ä¸­çš„é”®å€¼å¯¹ã€‚<br>ä½¿ç”¨åœºæ™¯ï¼šé€‚ç”¨äºéœ€è¦é¢‘ç¹æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„åœºåˆï¼Œå°¤å…¶æ˜¯åœ¨é”®å€¼å¯¹åº”å…³ç³»æ˜æ˜¾æ—¶ç‰¹åˆ«æœ‰æ•ˆã€‚ä½†æ˜¯ï¼Œå­—å…¸ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict_example = &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">3.14</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(dict_example[<span class="string">&#x27;name&#x27;</span>])</span><br></pre></td></tr></table></figure>



<h2 id="æŠ½è±¡åŸºç±»"><a href="#æŠ½è±¡åŸºç±»" class="headerlink" title="æŠ½è±¡åŸºç±»"></a>æŠ½è±¡åŸºç±»</h2><p><code>class BaseClass(metaclass=abc.ABCMeta)</code> è¿™è¡Œä»£ç å®šä¹‰äº†ä¸€ä¸ª<strong>æŠ½è±¡åŸºç±»</strong>ï¼ˆAbstract Base Classï¼‰ã€‚</p>
<p><strong><code>metaclass=abc.ABCMeta</code></strong>ï¼š</p>
<ul>
<li><code>metaclass</code>ï¼ˆå…ƒç±»ï¼‰æ˜¯åˆ›å»ºç±»çš„â€œç±»â€ã€‚å®ƒæ§åˆ¶ç€ç±»çš„åˆ›å»ºè¿‡ç¨‹ã€‚</li>
<li><code>abc.ABCMeta</code> æ˜¯ Python <code>abc</code> (Abstract Base Classes) æ¨¡å—æä¾›çš„ä¸€ä¸ªç‰¹æ®Šå…ƒç±»ã€‚</li>
<li>é€šè¿‡å°† <code>BaseClass</code> çš„å…ƒç±»æŒ‡å®šä¸º <code>abc.ABCMeta</code>ï¼Œæˆ‘ä»¬å‘Šè¯‰ Python <code>BaseClass</code> åº”è¯¥è¢«å½“ä½œä¸€ä¸ª<strong>æŠ½è±¡åŸºç±»</strong>æ¥å¤„ç†ã€‚</li>
</ul>
<p><strong>æŠ½è±¡åŸºç±»çš„æ ¸å¿ƒç‰¹ç‚¹å’Œä½œç”¨ï¼š</strong></p>
<ul>
<li><strong>ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–</strong>ï¼šä½ ä¸èƒ½ç›´æ¥åˆ›å»º <code>BaseClass</code> çš„å®ä¾‹ï¼ˆä¾‹å¦‚ <code>obj = BaseClass()</code> ä¼šæŠ›å‡ºé”™è¯¯ï¼‰ã€‚</li>
<li><strong>å®šä¹‰æ¥å£ï¼ˆå¥‘çº¦ï¼‰</strong>ï¼šå®ƒçš„ä¸»è¦ç›®çš„æ˜¯å®šä¹‰ä¸€ç»„æ–¹æ³•ï¼ˆç§°ä¸ºæŠ½è±¡æ–¹æ³•ï¼‰ï¼Œè¿™äº›æ–¹æ³•<strong>å¿…é¡»</strong>ç”±å®ƒçš„å­ç±»ï¼ˆç»§æ‰¿å®ƒçš„ç±»ï¼‰æ¥å®ç°ã€‚</li>
<li><strong>å¼ºåˆ¶å­ç±»å®ç°</strong>ï¼šå¦‚æœä¸€ä¸ªå­ç±»ç»§æ‰¿äº† <code>BaseClass</code>ï¼Œä½†æ²¡æœ‰å®ç°å…¶æ‰€æœ‰çš„æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆå°è¯•åˆ›å»ºè¿™ä¸ªå­ç±»çš„å®ä¾‹æ—¶ï¼ŒPython ä¼šæŠ›å‡º <code>TypeError</code> é”™è¯¯ã€‚</li>
<li><strong>å¦‚ä½•å®šä¹‰æŠ½è±¡æ–¹æ³•</strong>ï¼šåœ¨ <code>BaseClass</code> å†…éƒ¨ï¼Œä½¿ç”¨ <code>@abstractmethod</code> è£…é¥°å™¨æ¥æ ‡è®°å“ªäº›æ–¹æ³•æ˜¯æŠ½è±¡çš„ã€‚</li>
<li><strong>éæŠ½è±¡æ–¹æ³•</strong>ï¼šè¿™äº›æ–¹æ³•åœ¨æŠ½è±¡åŸºç±»ä¸­æä¾›äº†å…·ä½“çš„å®ç°ã€‚å­ç±»<strong>å¯ä»¥</strong>ç›´æ¥ç»§æ‰¿å¹¶ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©**é‡å†™ï¼ˆè¦†ç›–ï¼‰**å®ƒä»¬ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseClass</span>(metaclass=abc.ABCMeta):</span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°å®ƒã€‚&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_another_thing</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è¿™æ˜¯å¦ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment"># è¿™æ˜¯ä¸€ä¸ªéæŠ½è±¡æ–¹æ³•ï¼ˆå…·ä½“æ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">common_function</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è¿™æ˜¯ä¸€ä¸ªéæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¯ä»¥ç›´æ¥ç»§æ‰¿ä½¿ç”¨ã€‚&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;This is a common function provided by the base class.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é”™è¯¯ï¼šä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡åŸºç±»</span></span><br><span class="line"><span class="comment"># instance = BaseClass()  # TypeError!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteClass</span>(<span class="title class_ inherited__">BaseClass</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Doing something!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰å®ç° do_another_thing</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”™è¯¯ï¼šConcreteClass æ²¡æœ‰å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼Œä¸èƒ½å®ä¾‹åŒ–</span></span><br><span class="line"><span class="comment"># obj = ConcreteClass()  # TypeError!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FullyImplementedClass</span>(<span class="title class_ inherited__">BaseClass</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Doing something!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_another_thing</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Doing another thing!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®ï¼šå¯ä»¥å®ä¾‹åŒ–ï¼Œå› ä¸ºæ‰€æœ‰æŠ½è±¡æ–¹æ³•éƒ½è¢«å®ç°äº†</span></span><br><span class="line">obj = FullyImplementedClass()</span><br><span class="line">obj.do_something()  <span class="comment"># è¾“å‡º: Doing something!</span></span><br><span class="line">obj.do_another_thing()  <span class="comment"># è¾“å‡º: Doing another thing!</span></span><br></pre></td></tr></table></figure>

<p>ç°ä»£ Python æ›´æ¨èä½¿ç”¨ <code>abc.ABC</code> ä½œä¸ºåŸºç±»ï¼Œæ•ˆæœç›¸åŒï¼Œä½†å†™æ³•æ›´ç®€æ´</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseClass</span>(abc.ABC):</span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>pythonè¯­è¨€</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´åšè¿‡çš„ç¼–ç¨‹é¢˜ä¹‹Letcode100</title>
    <url>/2025/07/27/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E5%81%9A%E8%BF%87%E7%9A%84%E7%BC%96%E7%A8%8B%E9%A2%98%E4%B9%8BLetcode100/</url>
    <content><![CDATA[<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é¢˜ç›® é€šç”¨ï¼šæ•°ç»„åˆå§‹åŒ–åå¡«å……æŸä¸ªæ•°ï¼šArrays.fill(arr, 0);    æ•°ç»„æ’åºï¼šArrays.sort(names, Collections.reverseOrder());  æ•°ç»„è£…ç®±ï¼šInteger[] boxedNums = Arrays.stream(nums).boxed().toArray(Integer[]::new);  åè½¬æ•°ç»„ï¼šéœ€è¦å…ˆå˜ä¸ºListï¼ŒList list = Arrays.asList(arr);   Collections.reverse(list);    arr = list.toArray(new Integer[0]); (å˜ä¸ºInteger[]) æˆ–è€… resList.stream().mapToInt(Integer::intValue).toArray();  (å˜ä¸ºint[]) å°é¡¶å †ï¼šPriorityQueue minHeap = new PriorityQueue&lt;&gt;();   PriorityQueue&lt;Map.Entry&lt;Integer, Integer&gt;&gt; minHeap =          new PriorityQueue&lt;&gt;(Comparator.comparingInt(Map.Entry::getValue)); å¤§é¡¶å †ï¼šPriorityQueue maxHeap = new PriorityQueue&lt;&gt;(Comparator.reverseOrder());    heap.offeræ’å…¥ pollåˆ é™¤å…ƒç´  å †é¡¶å…ƒç´ peekã€‚ s.substring(startIndex, endIndex) å·¦é—­å³å¼€ int sum = Arrays.stream(nums).sum(); æ±‚å’Œ å›æ–‡é“¾è¡¨ï¼šå…ˆæŠŠå…ƒç´ éå†å‡ºæ¥åˆ°æ•°ç»„listï¼Œç„¶åå‰ååŒæŒ‡é’ˆè¿›è¡Œå¯¹æ¯”ã€‚è¿˜å¯ä»¥ä½¿ç”¨é€’å½’ï¼Œä½¿ç”¨é€’å½’åå‘è¿­ä»£èŠ‚ç‚¹ï¼ŒåŒæ—¶ä½¿ç”¨é€’å½’å‡½æ•°å¤–çš„å˜é‡å‘å‰è¿­ä»£ã€‚ ç¯å½¢é“¾è¡¨ï¼šæ–¹æ³•ä¸€ï¼šä½¿ç”¨HashSetè®°å½•èµ°è¿‡çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¹‹å‰èµ°è¿‡ï¼Œåˆ™ç¯å½¢é“¾è¡¨ã€‚æ–¹æ³•äºŒï¼šå¿«æ…¢æŒ‡é’ˆï¼Œæœ‰æ¢ä¸€å®šä¼šé‡åˆ°ï¼Œé‡åˆ°åï¼Œä¸€ä¸ªæŒ‡é’ˆä»èµ·å§‹èŠ‚ç‚¹å‡ºå‘ï¼Œä¸€ä¸ªæŒ‡é’ˆä»ç›¸é‡èŠ‚ç‚¹å‡ºå‘ï¼Œç›¸åŒé€Ÿåº¦ç§»åŠ¨ï¼Œæ’è§å°±æ˜¯ç¯å½¢ç›¸äº¤èŠ‚ç‚¹ã€‚ åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ï¼šåŒæŒ‡é’ˆï¼Œwhileæ¡ä»¶é‡Œå¯ä»¥æ˜¯ä¸¤ä¸ªå…¶ä¸­ä¹‹ä¸€ä¸ä¸ºnullï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸¤ä¸ªéƒ½ä¸ä¸ºnullï¼Œç„¶ånextç›´æ¥æŒ‡å‘å‰©ä½™çš„é‚£ä¸ªListNodeã€‚æ³¨æ„ListNode a = new Listnode(1);  ç„¶åListNode b = a; a/bå†å˜ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸è·Ÿç€å˜å¾—ï¼Œå› ä¸ºä¸æ˜¯abæŒ‡å‘çš„å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–ï¼Œè€Œæ˜¯bæŒ‡å‘äº†åˆ«çš„ä¸œè¥¿ã€‚ ä¸¤æ•°ç›¸åŠ ï¼šwhileå¾ªç¯ä¸­æ±‚å½“å‰æ•°å’Œè¿›ä½æ•°ï¼Œæœ€ååˆ¤æ–­è¿›ä½æ˜¯å¦ä¸º0ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦è¦åŠ ä¸€ä¸ªæ•°ã€‚ åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªç»“ç‚¹ï¼šåŒæŒ‡é’ˆï¼Œå¾—æ¨¡æ‹Ÿä¸€ä¸‹ï¼Œå¿«æŒ‡é’ˆç§»åŠ¨å‡ æ­¥ï¼ˆnæ­¥ï¼‰ï¼Œç„¶åæ…¢æŒ‡é’ˆåœæ­¢çš„æ¡ä»¶æ˜¯ä»€ä¹ˆï¼ˆfast!=nullï¼‰ã€‚è€ƒè™‘åªæœ‰ä¸€ä¸ªç»“ç‚¹çš„æƒ…å†µï¼Œå¾—ç”¨preHeadã€‚ ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ï¼ˆä¸èƒ½æ”¹èŠ‚ç‚¹çš„å€¼ï¼‰ï¼šè·Ÿé“¾è¡¨ç¿»è½¬ç±»ä¼¼ï¼Œéå†è¿‡ç¨‹ä¸­æ¨¡æ‹Ÿç¿»è½¬çš„è¿‡ç¨‹ï¼Œéœ€è¦å®šä¹‰å“ªäº›ä¸´æ—¶èŠ‚ç‚¹è¿›è¡Œè®°å½•ã€‚æ³¨æ„è¦ç”¨preHeadã€‚é“¾è¡¨ç¿»è½¬å°±ä¸ç”¨preHeadã€‚ kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨ï¼šæ˜¯ç¿»è½¬é“¾è¡¨çš„å¤æ‚ç‰ˆæœ¬ï¼Œä¸å…‰è¦ç¿»è½¬ï¼Œç¿»è½¬ä¹‹åè¿æ¥åˆ†æ®µï¼Œæ‰€ä»¥è¦åœ¨éå†è¿‡ç¨‹ä¸­è®°å½•å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ã€‚é¦–å…ˆåˆ¤æ–­åˆ†æ®µæ˜¯å¦å¤Ÿï¼Œé¡ºä¾¿éå†åˆ°tailèŠ‚ç‚¹ã€‚å­å‡½æ•°è¿›è¡Œåˆ†æ®µç¿»è½¬ï¼Œä¼ å…¥preHeadå’Œkï¼Œéå†ç”¨kï¼Œæå‰å®šä¹‰preå’Œcurï¼Œå¾ªç¯ä¸­1ä¿å­˜nextï¼Œ2ç®­å¤´ç¿»è½¬ï¼Œ3ç§»åŠ¨preå’Œcurã€‚ç„¶åè¿çº¿ï¼Œå†ç§»åŠ¨ã€‚ æ’åºé“¾è¡¨ï¼šäºŒåˆ†ï¼Œå½’å¹¶æ’åºï¼ˆé€’å½’ï¼‰å…ˆç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨ä¸­ç‚¹ï¼Œåˆ†å‰²è¿›è¡Œé€’å½’ï¼Œç»ˆæ­¢æ¡ä»¶æ˜¯åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚é€’å½’æ’åºåè¿›è¡Œmergeï¼ŒåŒæŒ‡é’ˆæ³•è¿›è¡Œåˆå¹¶ï¼Œå¾—ç”¨preHeadã€‚ åˆå¹¶kä¸ªå‡åºé“¾è¡¨ï¼šä¼˜å…ˆçº§é˜Ÿåˆ—PriorityQueueï¼Œå› ä¸ºæ•°ç»„é‡Œçš„åˆ—è¡¨éƒ½æ˜¯æ’å¥½åºçš„ï¼Œæ‰€ä»¥å…ˆæŠŠæ•°ç»„ä¸­æ¯ä¸ªåˆ—è¡¨çš„å¤´èŠ‚ç‚¹åŠ è¿›å»ï¼Œç„¶åå–é˜Ÿåˆ—é‡Œæœ€å°çš„ï¼Œç„¶åæŠŠå–åˆ°çš„èŠ‚ç‚¹çš„nextåŠ å…¥ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œç›´åˆ°ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸ºç©ºäº† LinkedHashMapï¼šLinkedHashMapç»§æ‰¿è‡ªHashMapï¼Œåœ¨ HashMap çš„åŸºç¡€ä¸Šå¢åŠ äº†å¯¹å…ƒç´ é¡ºåºçš„ç»´æŠ¤èƒ½åŠ›ï¼Œæ—¢å¯ä»¥æŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§è®¿é—®é¡ºåºæ’åºã€‚åº•å±‚å®ç°ï¼šHashMapï¼ˆå®ç°O(1) æ—¶é—´å¤æ‚åº¦çš„æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œï¼‰+ åŒå‘é“¾è¡¨ï¼ˆç”¨äºè®°å½•é”®å€¼å¯¹çš„é¡ºåºï¼Œé“¾è¡¨çš„å¤´èŠ‚ç‚¹è¡¨ç¤ºæœ€æ—©æ’å…¥æˆ–æœ€ä¹…æœªè®¿é—®çš„å…ƒç´ ï¼Œå°¾èŠ‚ç‚¹è¡¨ç¤ºæœ€è¿‘æ’å…¥æˆ–æœ€è¿‘è®¿é—®çš„å…ƒç´ ã€‚å½“å“ˆå¸Œè¡¨éœ€è¦æ‰©å®¹æ—¶ï¼ŒLinkedHashMap ä¼šé‡æ–°åˆ†é…æ¡¶ä¸­çš„èŠ‚ç‚¹ï¼Œä½†ä¸ä¼šå½±å“åŒå‘é“¾è¡¨çš„é¡ºåºã€‚æ‰©å®¹æ—¶æœºï¼šå½“å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡ å®¹é‡ Ã— è´Ÿè½½å› å­ï¼ˆé»˜è®¤0.75ï¼‰ æ—¶ï¼Œè§¦å‘æ‰©å®¹æ“ä½œã€‚æ‰©å®¹ä¸ºåŸæ•°ç»„å®¹é‡çš„ä¸¤å€ã€‚LinkedHashMapé»˜è®¤ä¸ç§»é™¤å…ƒç´ ï¼Œé‡å†™removeEldestEntryæ–¹æ³•è¿›è¡Œç§»é™¤æ¥å®ç°LRUã€‚ ä¸ºä»€ä¹ˆLRUå¾—æ˜¯åŒå‘é“¾è¡¨ï¼šæ¶‰åŠåˆ°æ‰¾åˆ°èŠ‚ç‚¹ï¼Œç„¶åæŠŠèŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨å°¾éƒ¨ï¼ŒåŒå‘é“¾è¡¨å®ç°è¯¥æ“ä½œåªéœ€è¦O1æ—¶é—´å¤æ‚åº¦ï¼Œå•å‘é“¾è¡¨æ— æ³•è·å–ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ˜¯Onå¤æ‚åº¦ã€‚ å®ç°LRUç¼“å­˜ï¼šå­˜æ”¾çš„æ˜¯key-valueå¯¹ï¼Œè‡ªå®šä¹‰åŒå‘é“¾è¡¨ï¼ŒèŠ‚ç‚¹å†…ç»´æŠ¤keyå’Œvalueï¼ŒHashMapæ˜¯ç”¨æ¥å¿«é€Ÿæ‰¾åˆ°èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥keyå°±æ˜¯keyï¼Œvalueæ˜¯NodeèŠ‚ç‚¹ã€‚éœ€è¦è‡ªå®šä¹‰åŒå‘é“¾è¡¨ç±»ï¼Œgetæ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­åœ¨ä¸åœ¨mapä¸­ï¼Œå¦‚æœåœ¨åˆ™ç§»åŠ¨èŠ‚ç‚¹åˆ°å°¾éƒ¨ã€‚putæ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­å®¹é‡æ˜¯å¦è¾¾åˆ°ä¸Šé™ï¼Œå¦‚æœè¾¾åˆ°åˆ™ç§»é™¤å¤´éƒ¨èŠ‚ç‚¹ï¼ˆä¼´éšæ”¹å˜sizeå’Œmapï¼‰ï¼Œç„¶åæ·»åŠ èŠ‚ç‚¹åˆ°å°¾èŠ‚ç‚¹ï¼ˆä¼´éšæ”¹å˜sizeå’Œmapï¼‰ã€‚æ³¨æ„å‰åéƒ½è¦å“¨å…µèŠ‚ç‚¹ï¼Œå¹¶ä¸”ç›¸è¿ã€‚ å±‚åºéå†ï¼šç”¨é˜Ÿåˆ—æ¥å®ç°ã€‚æ¯æ¬¡è®¿é—®ä¸€å±‚ï¼Œå¹¶æŠŠä¸‹ä¸€å±‚åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚ æ ˆï¼š Stack ç±»ç”±äºç»§æ‰¿è‡ª Vector å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Œä¸æ¨èä½¿ç”¨ã€‚Dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰æ¥å£æä¾›äº†æ›´çµæ´»å’Œé«˜æ•ˆçš„æ ˆå®ç°æ–¹æ³•ã€‚ArrayDeque å’Œ LinkedList æ˜¯æœ€å¸¸ç”¨çš„ Deque å®ç°ç±»ã€‚ Deque stack = new ArrayDeque&lt;&gt;(); stack.pop()ã€ stack.peek()ã€ stack.push(num) é˜Ÿåˆ—ï¼šä½¿ç”¨Queue é˜Ÿåˆ—ï¼šQueue queue = new ArrayDeque&lt;&gt;(); queue.offer(num)ã€queue.poll()ã€queue.peek() Queue æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¡¨ç¤ºé˜Ÿåˆ—ï¼ˆFIFOï¼Œå…ˆè¿›å…ˆå‡ºï¼‰çš„æ•°æ®ç»“æ„ã€‚ å•å‘é˜Ÿåˆ—ï¼Œoffer()ã€poll() å’Œ peek() Deque æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¡¨ç¤ºåŒç«¯é˜Ÿåˆ—çš„æ•°æ®ç»“æ„ã€‚ addFirst()ã€addLast()ã€pollFirst()ã€pollLast()ã€ç”¨ä½œæ ˆï¼Œé€šè¿‡ push() ã€ pop() ã€peek() Deque ç»§æ‰¿äº† Queue æ¥å£ã€‚ ArrayDeque å’Œ LinkedList éƒ½å®ç°äº† Deque æ¥å£ï¼Œå› æ­¤å®ƒä»¬éƒ½å¯ä»¥ç”¨ä½œåŒç«¯é˜Ÿåˆ—æˆ–æ™®é€šé˜Ÿåˆ—ã€‚ ArrayDequeï¼šåŸºäºåŠ¨æ€æ•°ç»„å®ç°ã€‚ä¸æ”¯æŒå­˜å‚¨ null å…ƒç´ ã€‚ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ LinkedListï¼šåŸºäºåŒå‘é“¾è¡¨å®ç°ã€‚æ”¯æŒå­˜å‚¨ null å…ƒç´ ã€‚ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å‰/ä¸­/ååºéå†ï¼šæ–¹æ³•ä¸€ï¼šé€’å½’æ³•ï¼Œé€’å½’çš„æ—¶å€™éšå¼åœ°ç»´æŠ¤äº†ä¸€ä¸ªæ ˆã€‚æ–¹æ³•äºŒï¼šè¿­ä»£æ³•ï¼Œæ˜¾å¼åœ°å°†è¿™ä¸ªæ ˆæ¨¡æ‹Ÿå‡ºæ¥ã€‚å‰åºéå†å…ˆæŠŠrootèŠ‚ç‚¹å‹è¿›å»ï¼Œç„¶åéå†ä¸­popåŠ åˆ°resé‡Œï¼Œå†å³å·¦èŠ‚ç‚¹å‹è¿›å»ã€‚ååºéå†ï¼Œå…ˆæŠŠrootèŠ‚ç‚¹å‹è¿›å»ï¼Œç„¶åå·¦å³èŠ‚ç‚¹ï¼Œè¿™æ ·æ˜¯å‰å³å·¦é¡ºåºï¼Œå†Collections.reverse(result)ä¸€ä¸‹ã€‚ä¸­åºéå†å…ˆä¸€ç›´å‹å·¦è¾¹çš„ï¼Œå‹åˆ°å¤´äº†ï¼Œå†åŠ åˆ°resï¼Œå†å‹å³èŠ‚ç‚¹ï¼Œæ³¨æ„whileé‡Œçš„æ¡ä»¶æ˜¯æ ˆä¸ç©ºæˆ–rootä¸ä¸ºnullï¼Œpopåï¼Œå‹popèŠ‚ç‚¹çš„å³èŠ‚ç‚¹ã€‚ å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼šä¸€ç§é€å±‚éå†çš„æ–¹å¼ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå…ˆè®¿é—®å½“å‰å±‚çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œç„¶åå†è®¿é—®ä¸‹ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚ä½¿ç”¨é˜Ÿåˆ—Queueæ¥å®ç°ã€‚ æ·±åº¦ä¼˜å…ˆæœç´¢ï¼šä¸€ç§æ²¿ç€æ ‘çš„æ·±åº¦æ–¹å‘å°½å¯èƒ½æ·±å…¥è®¿é—®èŠ‚ç‚¹çš„æ–¹å¼ï¼Œç›´åˆ°åˆ°è¾¾å¶å­èŠ‚ç‚¹åå†å›æº¯ã€‚ä½¿ç”¨é€’å½’æˆ–è€…æ ˆã€‚ äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ï¼šæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œé€’å½’ï¼Œç»ˆæ­¢æ¡ä»¶æ˜¯nullèŠ‚ç‚¹è¿”å›0ï¼Œä¸ç„¶çœ‹å·¦å³è°å¤§ã€‚ä¹Ÿå¯ä»¥ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œç±»ä¼¼å±‚åºéå†ï¼Œçœ‹æœ‰å¤šå°‘å±‚ã€‚ ç¿»è½¬äºŒå‰æ ‘ï¼šæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œé€’å½’ï¼Œç»ˆæ­¢æ¡ä»¶æ˜¯nullï¼Œè¿”å›nullï¼Œç„¶åå·¦å³èŠ‚ç‚¹é€’å½’ï¼Œç„¶åå·¦å³èŠ‚ç‚¹äº’æ¢ã€‚ å¯¹ç§°äºŒå‰æ ‘ï¼šé€’å½’ï¼Œè¾“å…¥ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸€å·¦ä¸€å³ï¼Œæ¯”è¾ƒã€‚ äºŒå‰æ ‘çš„ç›´å¾„ï¼šæ ‘ä¸­ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´æœ€é•¿è·¯å¾„çš„é•¿åº¦ã€‚å…¶å®è·Ÿå·¦å­æ ‘æ·±åº¦å’Œå³å­æ ‘æ·±åº¦(èŠ‚ç‚¹æ•°)æœ‰å…³ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œæœ€å¤§ç›´å¾„ä¸ä¸€å®šéœ€è¦ç»è¿‡æ ¹èŠ‚ç‚¹ï¼!å› æ­¤åœ¨é€’å½’ä¸­éœ€è¦è®°å½•ç»“æœã€‚é€’å½’è¿”å›èŠ‚ç‚¹æ•°ï¼Œè¾¹å°±åœ¨èŠ‚ç‚¹æ•°åŸºç¡€ä¸Š - 1ã€‚ å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘ï¼šé«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ï¼Œä¸èƒ½é€‰æ‹©ä¸­ç‚¹ä¹‹åç›´æ¥åšä¸€æ”¯å³ä¸€æ”¯ï¼Œç”¨é€’å½’ï¼Œå·¦è¾¹å³è¾¹åˆ†åˆ«å†é€’å½’ã€‚å…¶å®å°±æ˜¯æ ¹æ®ä¸­åºéå†æ¢å¤äºŒå‰æ ‘ï¼Œåªä¸è¿‡æŒ‡å®šä¸­ç‚¹ã€‚ éªŒè¯äºŒå‰æ ‘ï¼šä½¿ç”¨é€’å½’ï¼Œä½†æ˜¯ä¸èƒ½å•çº¯åœ°åªåˆ¤æ–­å·¦å­æ ‘å’Œå³å­æ ‘ï¼Œé€’å½’è¾“å…¥ä¸­è¿˜å¾—ä¼ æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œä¸èƒ½åªæ¯”çˆ¶èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¹Ÿå¾—æ¯”ï¼Œå°±ä¼ ä¸€ä¸ªmaxä¸€ä¸ªminã€‚ äºŒå‰æœç´¢æ ‘ä¸­ç¬¬kå°çš„å…ƒç´ ï¼šä¸­åºéå†æ˜¯é¡ºåºæ•°åˆ—ï¼Œå…ˆä¸­åºéå†å†æ‰¾æ•°ã€‚æ‹“å±•ï¼šå¦‚æœä¸€ä¸ªæ•°è¦é¢‘ç¹åœ°æ‰¾ç¬¬kå°ï¼Œæ€ä¹ˆä¼˜åŒ–ï¼Œæ¯ä¸ªèŠ‚ç‚¹è®°å½•ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„èŠ‚ç‚¹æ•°ï¼Œç„¶åå†æ‰¾ã€‚ äºŒå‰æ ‘çš„å³è§†å›¾ï¼šç±»ä¼¼å±‚åºéå†ï¼Œä½†æ˜¯åªè®°å½•æ¯å±‚çš„æœ€åä¸€ä¸ªæ•°ã€‚ç”¨é˜Ÿåˆ—ã€‚ äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨ï¼šå…ˆåºéå†çš„æ–¹å¼ï¼Œå³æŒ‡é’ˆæ˜¯nextã€‚å¯ä»¥å…ˆå…ˆåºéå†ï¼Œç„¶åå†å±•å¼€ä¸ºåˆ—è¡¨ã€‚æ–¹æ³•äºŒæ˜¯åŒæ—¶è¿›è¡Œï¼Œä½†æ˜¯è¦ç”¨è¿­ä»£æ–¹å¼çš„å‰åºéå†ï¼Œç”¨æ ˆæŠŠå³å­æ ‘èŠ‚ç‚¹è®°å½•ä¸‹æ¥ã€‚ ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ï¼šé€’å½’ï¼Œå‰ææ¡ä»¶æ˜¯éå†ä¸­æ²¡æœ‰é‡å¤å…ƒç´ ã€‚å‰åºéå†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå†ä»ä¸­åºéå†ä¸­æ‹†å‡ºå·¦å­æ ‘çš„ä¸­åºéå†å’Œå³å­æ ‘çš„ä¸­åºéå†ã€‚ åœ¨ä¸­åºéå†ä¸­æ‰¾èŠ‚ç‚¹ï¼Œç”¨ä¸€ä¸ªhashæ¥å¿«é€Ÿæ‰¾ï¼Œé€šè¿‡æ•°æ¥æ‰¾ç´¢å¼• è·¯å¾„æ€»å’Œï¼šç”¨é€’å½’è§£å†³ï¼Œä½†æ˜¯è¦æ³¨æ„ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹ï¼Œå¶å­ç»“ç‚¹å¾—æ˜¯leftå’Œrightéƒ½ä¸ºnullçš„ è·¯å¾„æ€»å’Œ2ï¼šéœ€è¦æ‰¾å‡ºä»æ ¹èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹çš„ç¬¦åˆè¦æ±‚çš„æ‰€æœ‰è·¯å¾„ã€‚æ³¨æ„1:æ·»åŠ ç»“æœæ—¶éœ€è¦æ·»åŠ ç»“æœçš„æ‹·è´ï¼Œå› ä¸ºæ˜¯å¼•ç”¨ä¼ é€’ã€‚æ³¨æ„2:éœ€è¦å›æº¯ï¼Œå°±æ˜¯åœ¨è¿”å›ä¸Šä¸€å±‚å‰listå»æ‰è¯¥èŠ‚ç‚¹ã€‚ è·¯å¾„æ€»å’Œ3ï¼šä¸é™åˆ¶ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹ï¼Œä½†æ˜¯éœ€è¦ä»ä¸Šåˆ°ä¸‹ï¼Œä¹Ÿå°±æ˜¯ä»çˆ¶èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹ã€‚ è§£æ³•1:æš´åŠ›æ³•ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½èµ°ä¸€éé€’å½’ã€‚dfså‡½æ•°ï¼Œè®¡ç®—çš„æ˜¯ä»¥rootä¸ºå¼€å§‹ï¼Œä¸ç®¡è°ä¸ºç»“æŸçš„ç¬¦åˆè¦æ±‚çš„æ•°é‡ï¼Œä¼šå­˜åœ¨æ•´æ•°æº¢å‡ºçš„é—®é¢˜ï¼ŒæŠŠdfså‡½æ•°çš„targetSumå‚æ•°ç±»å‹å˜ä¸ºlongå°±è¡Œäº†ã€‚è§£æ³•2: ç”¨å‰ç¼€å’Œï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªMapè®°å½•ä¹‹å‰è·¯å¾„ä¸Šä»æ ¹èŠ‚ç‚¹åˆ°æŸèŠ‚ç‚¹çš„å’Œå¯¹åº”çš„æ•°é‡ï¼Œè¿™æ ·åªéœ€è¦ç”¨ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„å’Œæ¥è§£å†³é—®é¢˜äº†ã€‚dfsé€’å½’è¿‡ç¨‹ä¸­è®°å½•æ ¹èŠ‚ç‚¹åˆ°ç›®å‰çš„æ€»å’Œã€‚dfsè¡¨ç¤ºä»¥å½“å‰èŠ‚ç‚¹ä¸ºå°¾èŠ‚ç‚¹ã€‚ä¾ç„¶è¦ç”¨Longè§£å†³æº¢å‡ºé—®é¢˜ã€‚ äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼šç”¨é€’å½’ï¼Œé€’å½’å‡½æ•°çš„è¾“å‡ºçš„æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆï¼Œé€€å‡ºæ¡ä»¶æ˜¯å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯ p æˆ– q æˆ– ç©ºï¼Œåˆ™ç›´æ¥è¿”å›å½“å‰èŠ‚ç‚¹ã€‚åœ¨å·¦å³å­æ ‘ä¸­åˆ†åˆ«é€’å½’æŸ¥æ‰¾ p å’Œ qï¼šå¦‚æœå·¦å­æ ‘è¿”å›éç©ºç»“æœä¸”å³å­æ ‘è¿”å›éç©ºç»“æœï¼Œåˆ™å½“å‰èŠ‚ç‚¹å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚å¦‚æœåªæœ‰å·¦å­æ ‘è¿”å›éç©ºç»“æœï¼Œåˆ™è¿”å›å·¦å­æ ‘çš„ç»“æœã€‚å¦‚æœåªæœ‰å³å­æ ‘è¿”å›éç©ºç»“æœï¼Œåˆ™è¿”å›å³å­æ ‘çš„ç»“æœã€‚è„‘å­é‡Œæ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œä¸€ä¸ªå‡½æ•°å°±è§£å†³ã€‚ äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œï¼šç”¨é€’å½’ï¼Œä¸é™åˆ¶çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ï¼Œå½“å‰èŠ‚ç‚¹è·¯å¾„=å½“å‰èŠ‚ç‚¹+å·¦è·¯å¾„+å³è·¯å¾„ï¼Œå¯¹æ¯”å…¨å±€æœ€å¤§ã€‚æ³¨æ„ï¼Œé€’å½’å‡½æ•°æ˜¯åŒ…å«rootèŠ‚ç‚¹çš„å•è¾¹çš„ã€‚ å²›å±¿æ•°é‡ï¼šé€’å½’dfsï¼Œé€’å½’ä½¿ç›¸é‚»çš„ç½®ä¸º0ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å¹¶æŸ¥é›†ï¼Œå¹¶æŸ¥é›†çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ ‘å½¢ç»“æ„ç»´æŠ¤é›†åˆå…³ç³»ï¼Œå¹¶é€šè¿‡è·¯å¾„å‹ç¼©ä¼˜åŒ–æŸ¥æ‰¾æ•ˆç‡ã€‚ç¬¬ä¸€æ­¥åˆå§‹åŒ–çˆ¶èŠ‚ç‚¹å’Œæ·±åº¦èŠ‚ç‚¹åˆ—è¡¨ï¼Œç„¶ååˆå¹¶ï¼Œåˆå¹¶è¿‡ç¨‹ä¸­å¯»æ‰¾rootèŠ‚ç‚¹æ˜¯å¦ç›¸åŒï¼Œä¸ç›¸åŒåˆ™éœ€è¦åˆå¹¶ï¼Œfindçš„è¿‡ç¨‹ä¸­é€’å½’ã€‚æ·±åº¦å°çš„å¾€æ·±åº¦å¤§çš„åˆå¹¶ï¼Œæé«˜æŸ¥æ‰¾æ ¹ç»“ç‚¹çš„æ•ˆç‡ã€‚å°†rankè¾ƒå°çš„æ ¹èŠ‚ç‚¹æŒ‡å‘rankè¾ƒå¤§çš„æ ¹èŠ‚ç‚¹ï¼Œä»¥ä¿æŒæ ‘çš„å¹³è¡¡ã€‚å¦‚æœä¸¤ä¸ªæ ¹èŠ‚ç‚¹çš„rankç›¸åŒï¼Œåˆ™å¯ä»¥å°†å…¶ä¸­ä¸€ä¸ªæ ¹èŠ‚ç‚¹ä½œä¸ºå¦ä¸€ä¸ªæ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå¹¶å°†rankå¢åŠ 1ã€‚ è…çƒ‚çš„æ©˜å­ï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œç”¨åˆ°é˜Ÿåˆ—ï¼Œå°†æœ€å¼€å§‹è…çƒ‚çš„æ©˜å­åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œç„¶åä¸€å±‚å±‚å¾€å¤–éå†ã€‚æ³¨æ„ï¼Œwhileåˆ¤æ–­é‡Œï¼Œé™¤äº†queueä¸ä¸ºç©ºï¼Œè¿˜éœ€è¦æ–°é²œæ©˜å­æ•°é‡å¤§äº0. è¯¾ç¨‹è¡¨ï¼šåˆ¤æ–­å›¾ä¸­æœ‰æ²¡æœ‰ç¯ã€‚ç”¨é‚»æ¥è¡¨æ¥è¡¨ç¤ºå›¾ï¼Œç»´æŠ¤èŠ‚ç‚¹çŠ¶æ€ï¼šæœªè®¿é—®ã€æ­£åœ¨è®¿é—®ã€å·²è®¿é—®ï¼Œç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œé€’å½’éå†ååºèŠ‚ç‚¹ï¼ˆåä¸ªæ–¹å‘æ˜¯ä¸æ˜¯ä¹Ÿè¡Œï¼Ÿï¼‰ã€‚å…¶å®å°±æ˜¯åˆ¤æ–­å›¾ä¸­æœ‰æ²¡æœ‰ç¯ã€‚é¦–å…ˆï¼Œæ„å»ºé‚»æ¥è¡¨ï¼Œæ”¾çš„æ˜¯èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹ã€‚å…¶æ¬¡ï¼Œåˆ›å»ºåˆå§‹çŠ¶æ€ï¼Œ0æœªè®¿é—®ï¼Œ1è®¿é—®ä¸­ï¼Œ2å·²è®¿é—®ã€‚ç„¶åè¿›è¡ŒDFSã€‚ Listè½¬æ¢ä¸ºInteger[]ï¼šlist.toArray(new Integer[list.size()]) Listè½¬æ¢ä¸ºint[]ï¼šres.stream().mapToInt(Integer :: intValue).toArray() è¯¾ç¨‹è¡¨è¾“å‡ºé¡ºåºï¼šæ³¨æ„ï¼Œåº”è¯¥åœ¨é€’å½’å›æº¯çš„æ—¶å€™å†å¾€ç»“æœé‡Œæ”¾å…¥ï¼Œå¦‚æœéå†çš„æ˜¯ååºèŠ‚ç‚¹ï¼Œè¿˜åº”è¯¥Collections.reverse(list)ã€‚ å…¨æ’åˆ—ï¼šç»™çš„å…ƒç´ æ— é‡å¤ï¼ŒåŒä¸€ä¸ªå…ƒç´ ä¸èƒ½é‡å¤ä½¿ç”¨ã€‚ç”¨é€’å½’DFSï¼Œä½†æ˜¯éœ€è¦è®°å½•å“ªäº›å…ƒç´ å·²ç»ä½¿ç”¨è¿‡äº†ã€‚åœ¨å›æº¯çš„æ—¶å€™éœ€è¦ç§»é™¤Listå’Œç§»é™¤è®°å½•ä½¿ç”¨å…ƒç´ çš„Setã€‚æ‹·è´ä¸€ä¸ªlistï¼šnew ArrayList&lt;&gt;(list)ã€‚ å­é›†ï¼šç»™çš„å…ƒç´ æ— é‡å¤ï¼Œè¿”å›æ‰€æœ‰å­é›†ï¼Œä¸èƒ½åŒ…å«é‡å¤çš„å­é›†ã€‚ä¸æ˜¯çœ‹æ’åˆ—äº†ï¼Œè€Œæ˜¯çœ‹å­é›†äº†ã€‚ä½¿ç”¨é€’å½’DFSï¼Œä½†æ˜¯ä¸ç”¨è®°å½•ä½¿ç”¨setäº†ï¼Œéœ€è¦è®°å½•å¼€å§‹é€’å½’ä½ç½®startã€‚ ç”µè¯å·ç çš„å­—æ¯ç»„åˆï¼šé€’å½’DFSï¼Œå¸¦startï¼Œåˆå§‹åŒ–mapï¼Œnew HashMap&lt;&gt;()&#123;&#123;put(1,&quot;a&quot;); put...)&#125;&#125;ï¼Œæ³¨æ„å¾—æ˜¯ä¸¤ä¸ªå¤§æ‹¬å·ã€‚éå†å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼šfor(char c : s.toCharArray())ã€‚s.substring(start, end)ã€‚ ç»„åˆæ€»å’Œï¼šç»™çš„æ˜¯æ— é‡å¤çš„æ•°ç»„ï¼Œè¿”å›å’Œä¸ºtargetçš„ç»„åˆæ–¹æ¡ˆï¼Œä¸€ä¸ªæ•°å¯ä»¥ä½¿ç”¨å¤šæ¬¡ã€‚ç”¨DFSï¼Œå…ˆç»™æ•°ç»„æ’ä¸ªåºï¼ŒDFSä¸­å¦‚æœå¤§äºtargetå°±Falseï¼Œåé¢å°±ä¸éå†äº†ã€‚ä¸ºäº†é¿å…é‡å¤ï¼Œåº”è¯¥ç”¨startæ¥é™åˆ¶å¼€å§‹éå†çš„æ•°å­—ã€‚æ³¨æ„ï¼š1.å†™å…¥ç»“æœä¼ å‰¯æœ¬ã€‚2.å…ˆæ’åºï¼Œå¤§äº†å°±ä¸ç”¨å¾€åèµ°äº†ã€‚3.å›æº¯åç§»é™¤èŠ‚ç‚¹ã€‚4.ä¼ starté¿å…ç»“æœé‡å¤ã€‚ æ‹¬å·ç”Ÿæˆï¼šç»™å‡ºä¸€ä¸ªnï¼Œè¿”å›å¯èƒ½çš„æ‹¬å·ç»„åˆã€‚DFSä¸­ä¸¤ç§æƒ…å†µï¼šæ”¾å·¦æ‹¬å·å’Œæ”¾å³æ‹¬å·ã€‚ å•è¯æœç´¢ï¼šæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œä¸èƒ½å…‰éå†å››å‘¨ï¼Œéå†è¿‡çš„è¿˜ä¸èƒ½å†éå†äº†ï¼Œä¸ç„¶ä¸€ç›´åœ¨dfsã€‚ç”¨setç»´æŠ¤è·¯å¾„ã€‚æœ€å¼€å§‹çš„æƒ³æ³•ï¼šä»å¤´å¼€å§‹DFSï¼Œç”¨Setè®°å½•èµ°è¿‡çš„è·¯å¾„é˜²æ­¢é‡å¤éå†ã€‚ä½†æ˜¯æ¯”è¾ƒå­—ç¬¦ä¸²éœ€è¦æ¯”è¾ƒç»“å°¾ã€‚æ”¹è¿›æ–¹æ³•ï¼šDFSï¼Œdfsèµ·ç‚¹ï¼šæ¯ä¸ªç‚¹ï¼›dfséœ€è¦æºå¸¦çš„ï¼šåŒ¹é…ä¸Šçš„å­—ç¬¦é•¿åº¦ï¼›dfså‡ºå£ï¼šå­—ç¬¦ä¸ä¸€æ ·/å­—ç¬¦é•¿åº¦è¾¾åˆ°ã€‚å·²ç»ç”¨è¿‡çš„å­—æ¯ä¸èƒ½å†ç”¨ï¼šå‘ä¸‹ä¸€ä¸ªé€’å½’ä¹‹å‰å˜ä¸ºå…¶ä»–å­—ç¬¦ï¼Œé€’å½’å®Œä¹‹åå†å˜å›æ¥ åˆ†å‰²å›æ–‡ä¸²ï¼šç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¯·ä½ å°† s åˆ†å‰²æˆä¸€äº›å­ä¸²ï¼Œä½¿æ¯ä¸ªå­ä¸²éƒ½æ˜¯å›æ–‡ä¸²ã€‚è¿”å› s æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆã€‚ è§£æ³•ï¼šDFS+å›æº¯ï¼Œè¦ä¼ startè®°å½•åˆ‡å‰²ä½ç½®ï¼Œforæ¨ªå‘éå†ï¼Œdfsçºµå‘éå†ã€‚æŠŠä¸€ä¸ªå­—ç¬¦ä¸²åˆ†å‰²æˆè‹¥å¹²ä¸ªå›æ–‡ä¸²ï¼ŒDFSï¼Œç›®æ ‡æ˜¯æŒ¨ä¸ªéå†ï¼Œéå†åˆ°å›æ–‡ä¸²å­˜ä¸€ä¸ªï¼Œç„¶åç»§ç»­å‘åéå†ï¼Œå‡ºé€’å½’çš„æ¡ä»¶æ˜¯éå†åˆ°äº†æœ«å°¾ã€‚è¦ç”¨startè®°å½•éå†åˆ°äº†å“ªé‡Œï¼Œæ³¨æ„å•ä¸ªå­—ç¬¦ä¹Ÿç®—å›æ–‡ã€‚ Nçš‡åï¼šè¾“å…¥nï¼Œæ±‚å¾—æ‰€æœ‰å¯èƒ½çš„æ’å¸ƒã€‚ä½¿ç”¨å›æº¯ï¼Œç”¨ä»€ä¹ˆè¡¨ç¤ºï¼šç”¨ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„è¡¨ç¤ºindexè¡Œçš„çš‡åæ”¾åœ¨valueåˆ—ã€‚ä»€ä¹ˆæ—¶å€™è®°å½•ï¼šæ‰€æœ‰è¡Œéƒ½å®Œå¤‡äº†æ·»åŠ ã€‚éœ€è¦æœ‰æ£€æŸ¥æ’å¸ƒæ˜¯å¦å¯ä»¥çš„æ–¹æ³•ã€‚ç”¨StringBuilderï¼Œs.setCharAt(track[i], &#x27;Q&#x27;); äºŒåˆ†æŸ¥æ‰¾ï¼šmid = l + (r - l) /2; è¦æ³¨æ„whileé‡Œçš„æ¡ä»¶æ˜¯l&lt;=rã€‚lè¦æ›´æ–°ä¸ºmid-1ã€‚rè¦æ›´æ–°ä¸ºr+1ã€‚ æœç´¢äºŒç»´çŸ©é˜µï¼šå…ˆç”¨ä¸€éäºŒåˆ†æ‰¾åœ¨å“ªä¸ªè¡Œï¼Œæ³¨æ„æ‰€åœ¨è¡Œæ˜¯æœ€åçš„l-1ã€‚å†ç”¨äºŒåˆ†æ‰¾åœ¨å“ªä¸ªåˆ—ã€‚ åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®ï¼šå…ˆäºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°ç›®æ ‡ï¼Œå†å‰åç§»åŠ¨æ‰¾ä½ç½®. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ï¼šç›´æ¥éå†è™½ç„¶èƒ½è§£ï¼Œä½†æ˜¯å¤æ‚åº¦è¦æ±‚è¾¾ä¸åˆ°ï¼Œè¦ç”¨äºŒåˆ†ã€‚ç”»å¼ å›¾ä¸¾ä¸ªä¾‹å­å¥½ç†è§£ï¼Œä¸­é—´èŠ‚ç‚¹å’Œä¸¤è¾¹èŠ‚ç‚¹åˆ¤æ–­å¯è¿‡æ»¤ä¸å¯èƒ½çš„ï¼Œæ³¨æ„å’Œä¼ ç»ŸäºŒåˆ†åŒºåˆ«ï¼šwhileé‡Œæ¡ä»¶l&lt;rã€‚ å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°ï¼šé™åˆ¶æ—¶é—´è´Ÿè´£åº¦logm+nï¼Œæ‰€ä»¥åŒæŒ‡é’ˆå‰åéå†æ˜¯ä¸è¡Œçš„ï¼Œå¾—äºŒåˆ†ã€‚æ€è·¯ï¼šæ‰©å±•åˆ°è·å–ç¬¬kå¤§çš„æ•°ï¼Œåˆ†åˆ«è·å–ä¸¤ä¸ªæ•°ç»„k/2çš„ä½ç½®ï¼Œå°çš„å·¦è¾¹å°±èƒ½æ·˜æ±°ã€‚ç¬¬ä¸€æ­¥ï¼šå‡ºé€’å½’æ¡ä»¶ï¼šå¦‚æœä¸€ä¸ªæ•°ç»„å·²ç»è¢«æ·˜æ±°æ²¡äº†ï¼Œåˆ™ç›´æ¥ä»å¦ä¸€ä¸ªè·å–ã€‚ç¬¬äºŒæ­¥ï¼šé€’å½’ï¼šè·å–æ¯ä¸ªæ•°ç»„çš„ç¬¬k/2ä½ç½®æ•°åšæ¯”è¾ƒï¼Œå¯èƒ½è¶Šç•Œï¼Œæ‰€ä»¥å¾—åˆ¤æ–­ã€‚æ³¨æ„å¾—æ˜¯index=s1+k/2-1ï¼Œç„¶åæ·˜æ±°indexåŠä¹‹å‰çš„ã€‚å…ˆè¦çœ‹kæ˜¯ä¸æ˜¯ç­‰äº1ï¼Œç­‰äº1åˆ™å¯ä»¥ç›´æ¥åˆ¤æ–­ã€‚ æœ‰æ•ˆçš„æ‹¬å·ï¼šæ„ä»¶ä¸€ä¸ªmapå’Œå·¦æ‹¬å·listï¼Œç”¨æ ˆï¼Œä¸ºç©ºæˆ–è€…ä¸ºå·¦æ‹¬å·åˆ™åŠ å…¥ï¼Œä¸ºå³æ‹¬å·åˆ™popå‡ºæ¥çœ‹æ˜¯å¦åŒ¹é…ï¼Œæœ€åè¿”å›æ ˆæ˜¯å¦ä¸ºç©ºã€‚Map&lt;Character, Character&gt; map = new HashMap&lt;&gt;()&#123;&#123;put(&#x27;)&#x27;, &#x27;(&#x27;);   List left = Arrays.asList(&#x27;(&#x27;, &#x27;&#123;&#x27;, &#x27;[&#x27;);  Deque stack = new ArrayDeque&lt;&gt;();   éå†stringï¼šchar c : s.toCharArray() å­—ç¬¦ä¸²è§£ç ï¼šé‡å¤æ¬¡æ•°å¯èƒ½æ˜¯å¤šä½çš„ï¼Œå¼€å§‹ä½¿ç”¨ä¸€ä¸ªæ ˆè®°å½•é‡å¤æ¬¡æ•°å’Œå­—ç¬¦ä¸²ï¼Œæœ‰ç‚¹ä¹±ã€‚ä½¿ç”¨ä¸¤ä¸ªæ ˆåˆ†åˆ«è®°å½•ã€‚ä½¿ç”¨ä¸¤ä¸ªæ ˆï¼šä¸€ä¸ªå­˜é‡å¤æ¬¡æ•°ï¼Œä¸€ä¸ªå­˜ä¹‹å‰çš„è§£ç ç»“æœã€‚æ³¨æ„3[a2[c]è¿™ç§ï¼Œå·¦æ‹¬å·çš„æ—¶å€™è¿›è¡Œå‹æ ˆï¼Œå³æ‹¬å·çš„æ—¶å€™popæ ˆï¼Œè¿™æ—¶å€™éœ€è¦é‡å¤çš„æ˜¯currentStrï¼Œæ ˆé‡Œpopå‡ºçš„æ˜¯éœ€è¦åœ¨å‰é¢çš„ï¼Œé‡å¤å®Œä¹‹åè¦æ›´æ–°currentStrã€‚åˆ¤æ–­ä¸€ä¸ªcharä¸ºæ•°å­—çš„ä¸¤ç§åŠæ³•ï¼šCharacter.isDigit()ã€c - &#x27;0&#x27;&lt;=9ã€‚ æ¯æ—¥æ¸©åº¦ï¼šä¸€ä¸ªæ•°ç»„è¡¨ç¤ºæ¸©åº¦ï¼Œè¿”å›æ•°ç»„è¡¨ç¤ºå¯¹äºiå¤©ï¼Œä¸‹ä¸€ä¸ªæ›´é«˜æ¸©åº¦å‡ºç°åœ¨å‡ å¤©åï¼Œå¦‚æœä¸ä¼šå‡é«˜åˆ™0ã€‚ä½¿ç”¨æ ˆï¼Œçº ç»“äºå¦‚ä½•è®°å½•ç»“æœï¼Œå…¶å®æ ˆä¸­å­˜æ”¾çš„å…ƒç´ ä¸æ˜¯æ¸©åº¦ï¼Œè€Œæ˜¯ç´¢å¼•ã€‚æ ˆé‡Œçš„å…ƒç´ åº”è¯¥æ˜¯ä»å¤§åˆ°å°çš„ï¼Œéå†è¿‡ç¨‹ä¸­ï¼Œå…ƒç´ å¤§äºæ ˆé¡¶å°±popã€‚æ³¨æ„ï¼Œæ ˆé‡Œæ”¾çš„æ˜¯ç´¢å¼•ï¼Œä¸æ˜¯å®é™…æ¸©åº¦ã€‚ æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ï¼šä¸€ä¸ªæ•°ç»„è¡¨ç¤ºæŸ±çŠ¶å›¾çš„é«˜åº¦ï¼Œè¿”å›èƒ½å‹¾å‹’å‡ºçŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚æ€è€ƒæš´åŠ›æƒ…å†µä¸‹å¦‚ä½•è§£å†³ï¼šå¯¹æ¯ä¸€ä¸ªæŸ±å­ï¼Œå‘å·¦å‘å³æ‰©å±•ï¼Œç›´åˆ°é‡åˆ°æ¯”å®ƒçŸ®çš„ï¼Œé‚£ä¹ˆä»¥å½“å‰æŸ±å­é«˜åº¦ä¸ºé«˜çš„çŸ©å½¢çš„å®½åº¦å°±ç¡®è®¤å‡ºæ¥ï¼Œè¿™æ ·å†å…¨å±€æ¯”è¾ƒã€‚æ‰€ä»¥ï¼Œå…³é”®ç‚¹åœ¨äºæ‰¾å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„ä½ç½®å’Œå³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„ä½ç½®ã€‚ç”¨å•è°ƒæ ˆï¼Œæ ˆä¸­ä¾ç„¶ä¿å­˜ç´¢å¼•ã€‚æ¯å½“é‡åˆ°ä¸€ä¸ªæ¯”æ ˆé¡¶å…ƒç´ å°çš„é«˜åº¦æ—¶ï¼Œè¯´æ˜æ‰¾åˆ°äº†æ ˆé¡¶å…ƒç´ çš„å³è¾¹ç•Œï¼›å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œæ­¤æ—¶å®ƒçš„å·¦è¾¹æ˜¯å‰ä¸€ä¸ªæ ˆé¡¶å…ƒç´ ï¼ˆå³å·¦è¾¹ç•Œï¼‰ã€‚æ³¨æ„ï¼Œè·å–å·¦è¾¹ç•Œæ—¶stackä¸ºç©ºï¼Œåˆ™left=-1å¯ä»¥ã€‚è¿˜éœ€è¦ç®¡æœ€åä¸€ä¸ªå…ƒç´ çš„ç»“æœï¼Œæ‰€ä»¥forå¾ªç¯è¾¹ç•Œæ˜¯heights.lengthï¼Œæä¸ªæœ€åçš„0ä½œä¸ºå“¨å…µèŠ‚ç‚¹ã€‚ æ•°ç»„ä¸­çš„ç¬¬kä¸ªæœ€å¤§å…ƒç´ ï¼šä½¿ç”¨æœ€å°å †ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚å¦‚æœå †å¤§å°ä¸ºkï¼Œåˆ™éœ€è¦å¯¹æ¯”å †é¡¶å…ƒç´ å’Œå½“å‰å…ƒç´ å“ªä¸ªæ›´å¤§ã€‚å…¶å®ä¸ç”¨ï¼Œå…ˆæ’å…¥ï¼Œå¤§äºkåˆ™å¼¹å‡ºå †é¡¶å…ƒç´ å³å¯ã€‚ å‰kä¸ªé«˜é¢‘å…ƒç´ ï¼šå…ˆç”¨Mapè®°å½•é¢‘ç‡ï¼Œç„¶åç”¨å°é¡¶å †è®°å½•kä¸ªMap.Entryï¼Œè¡¨ç¤ºé”®å€¼å¯¹é¡¹ï¼Œå…¶ä»–å’Œkä¸ªæœ€å¤§å…ƒç´ ä¸€æ ·ã€‚ ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºï¼šè´ªå¿ƒï¼Œéå†è¿‡ç¨‹ä¸­è®°å½•å†å²æœ€ä½ç‚¹ï¼ŒåŒæ—¶è®°å½•æœ€å¤§æ”¶ç›Šã€‚ è·³è·ƒæ¸¸æˆï¼šåˆ¤æ–­æ˜¯å¦èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä¸‹æ ‡ã€‚éå†è¿‡ç¨‹ä¸­è®°å½•æœ€è¿œèƒ½è·³åˆ°å“ªé‡Œï¼Œå¦‚æœå½“å‰ç´¢å¼•å°äºmaxReachåˆ™ç›´æ¥è¿”å›falseã€‚ è·³è·ƒæ¸¸æˆ2ï¼šè¿”å›æœ€å°‘è·³è·ƒæ•°ã€‚æœ€å°‘è·³è·ƒæ•°ï¼Œä¸¤ç§æ–¹æ³•ï¼šä¸€ç§ç”¨åŠ¨æ€è§„åˆ’è®°å½•æœ€å°‘è·³è·ƒæ•°ï¼Œç„¶ååŒå±‚éå†å¤–å±‚éå†æ•°ç»„ï¼Œå†…å±‚éå†è¯¥ä½ç½®è·³è·ƒèŒƒå›´ã€‚å¦ä¸€ç§æ˜¯è´ªå¿ƒï¼ŒåŒå±‚å¾ªç¯ï¼Œå¤–å±‚whileä»åå¾€å‰éå†èƒ½è·³åˆ°çš„ä½ç½®ï¼Œå†…å±‚ä»å‰å¾€åæ‰¾æœ€å°‘è·³è·ƒä½ç½®ã€‚å‰ææ˜¯ä¸€å®šèƒ½è·³åˆ°ï¼Œä¸ç„¶ä¼šæ­»å¾ªç¯ï¼Œæ‰€ä»¥pos &gt; 0ã€‚ åˆ’åˆ†å­—æ¯åŒºé—´ï¼šåŒä¸€ä¸ªå­—æ¯æœ€å¤šå‡ºç°åœ¨ä¸€ä¸ªç‰‡æ®µä¸­ï¼Œè¿”å›è¡¨ç¤ºæ¯ä¸ªå­—ç¬¦ä¸²ç‰‡æ®µé•¿åº¦çš„åˆ—è¡¨ã€‚ç”¨ä¸€ä¸ªmapè®°å½•æ¯ä¸ªå­—ç¬¦æœ€åå‡ºç°çš„ä½ç½®ï¼Œç„¶åéå†å­—ç¬¦ä¸²è¿›è¡Œåˆ‡åˆ†ï¼Œè®°å½•startå’Œendï¼Œéå†è¿‡ç¨‹ä¸­æ›´æ–°endï¼Œå¦‚æœi==endåˆ™è¡¨ç¤ºå¯ä»¥åˆ‡åˆ†ã€‚ çˆ¬æ¥¼æ¢¯ï¼šæ¯æ¬¡çˆ¬1æˆ–2é˜¶ï¼Œæ€»å…±æœ‰å¤šå°‘ç§çˆ¬å°é˜¶çš„æ–¹æ³•ã€‚åŠ¨æ€è§„åˆ’ï¼Œdp[n+1]ï¼Œåˆå§‹åŒ–0å’Œ1ï¼Œç„¶åéå†ã€‚ æ¨è¾‰ä¸‰è§’ï¼šåŠ¨æ€è§„åˆ’ï¼ŒListåˆ›å»ºæ—¶åˆå§‹åŒ–ï¼šList list = Arrays.asList(&quot;apple&quot;)ã€‚Listè·å–get(index). æ‰“å®¶åŠ«èˆï¼šä¸èƒ½å·çªƒç›¸é‚»çš„æˆ¿å±‹ï¼ŒåŠ¨æ€è§„åˆ’ï¼Œdp[i]è¡¨ç¤ºå·åˆ°içš„æœ€å¤§æ”¶ç›Šï¼Œåˆå§‹åŒ–å‰ä¸¤ä¸ªã€‚ å®Œå…¨å¹³æ–¹æ•°ï¼šè¿”å›å’Œä¸ºnçš„å®Œå…¨å¹³æ–¹æ•°çš„æœ€å°‘æ•°é‡ï¼Œå¯é‡å¤ä½¿ç”¨çš„ã€‚åŠ¨æ€è§„åˆ’ï¼Œä¸€ä¸ªä¸€ç»´æ•°ç»„åˆå§‹åŒ–æ¯”è¾ƒå¤§çš„å€¼ã€‚åŒå±‚éå†ï¼Œå¤–å±‚éå†1-n/2çš„å¹³æ–¹æ•°ï¼Œå†…å±‚éå†dpæ•°ç»„ã€‚å¦‚æœå¤§äºå¹³æ–¹æ•°ï¼Œåˆ™æ›´æ–°ã€‚ é›¶é’±å…‘æ¢ï¼šç»™å®šä¸€ä¸ªå¯ç”¨é›¶é’±é¢å€¼æ•°ç»„å’Œæ€»é‡‘é¢ï¼Œè¿”å›éœ€è¦çš„æœ€å°‘ç¡¬å¸æ•°é‡ï¼Œéƒ½æ˜¯å¯é‡å¤ä½¿ç”¨çš„ï¼Œæ€è·¯å’Œå®Œå…¨å¹³æ–¹æ•°ä¸€æ ·ã€‚æ³¨æ„åˆå§‹åŒ–ç”¨Integer.MAX_VALUE-1ã€‚ å•è¯æ‹†åˆ†ï¼šç»™ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œåˆ¤æ–­èƒ½å¦ç”¨åˆ—è¡¨ä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥å‡ºè¯¥å­—ç¬¦ä¸²ï¼Œå¯é‡å¤ä½¿ç”¨ã€‚æ˜¯èƒŒåŒ…é—®é¢˜ã€‚å®Œå…¨å¹³æ–¹æ•°æ˜¯å…ˆéå†å¹³æ–¹æ•°ï¼Œå†éå†æ•°ã€‚è¿™é‡Œéœ€è¦å…ˆéå†å­—ç¬¦ä¸²å†éå†ç‰©å“åˆ—è¡¨ã€‚å› ä¸ºè¿™é‡Œå¯¹ç‰©å“é¡ºåºæ˜¯æœ‰è¦æ±‚çš„ã€‚dp[i]è¡¨ç¤ºä»¥å­—ç¬¦ä¸²i-1ç´¢å¼•ç»“å°¾çš„ç»“æœã€‚// æ£€æŸ¥ä»¥i-1ç»“å°¾çš„å­—ç¬¦å¾€å‰å€’çš„å­—ç¬¦ä¸²ï¼Œå’ŒwordDict[j]æ˜¯ä¸æ˜¯ä¸€æ ·ã€‚ æœ€é•¿é€’å¢å­åºåˆ—ï¼šå­åºåˆ—æ˜¯é¡ºåºä¸èƒ½å˜ï¼Œå¯ä»¥åˆ æ‰éƒ¨åˆ†å…ƒç´ ç»„æˆã€‚åŠ¨æ€è§„åˆ’dp[i]è¡¨ç¤ºä»¥iç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—ï¼ŒåŒå±‚éå†ã€‚ ä¹˜ç§¯æœ€å¤§å­æ•°ç»„ï¼šå¾—æ˜¯è¿ç»­çš„æœ€å¤§å­æ•°ç»„ã€‚ç”¨åŠ¨æ€è§„åˆ’ï¼Œä¸¤ç»´æ•°ç»„è®°å½•i-jçš„è¿ç»­ä¹˜ç§¯ï¼Œè¦åŒå±‚éå†ï¼Œæ„Ÿè§‰ä¸æ˜¯æœ€ä¼˜ã€‚æ­£è§£ï¼šå…³é”®ç‚¹ï¼šå› ä¸ºè´Ÿæ•°çš„å­˜åœ¨ï¼Œæœ€å¤§å’Œæœ€å°å¯èƒ½ä¸€ä¸‹åè½¬ã€‚è®°å½•é˜¶æ®µæœ€å¤§å€¼å’Œé˜¶æ®µæœ€å°å€¼ï¼ˆä¹Ÿå°±æ˜¯ä»¥ä¸Šä¸€ä¸ªæ•°ä¸ºå°¾éƒ¨çš„æœ€å¤§å€¼æœ€å°å€¼ï¼‰ã€‚å› ä¸ºè´Ÿæ•°å­˜åœ¨ï¼Œå½“éå†åˆ°è´Ÿæ•°æ—¶ï¼Œæœ€å¤§æ•°å’Œæœ€å°æ•°è¦åšäº¤æ¢ã€‚éå†è¿‡ç¨‹ä¸­è®°å½•æœ€å¤§çš„é˜¶æ®µæœ€å¤§å€¼ã€‚ åˆ†å‰²ç­‰å’Œå­é›†ï¼šç»™ä¸€ä¸ªæ•°ç»„ï¼Œèƒ½å¦åˆ†æˆä¸¤ä¸ªå’Œç›¸ç­‰çš„å­é›†ï¼Œä¸è¦æ±‚è¿ç»­ã€‚æ˜¯ä¸€ä¸ªèƒŒåŒ…é—®é¢˜ï¼Œç»´æŠ¤dp[i][j]ï¼Œiè¡¨ç¤ºè€ƒè™‘0-içš„ç‰©å“ï¼Œjè¡¨ç¤ºå®¹é‡ä¸ºjï¼Œdpå€¼è¡¨ç¤ºèƒŒåŒ…æœ€å¤§èƒ½æ”¾çš„é‡é‡ã€‚åˆå§‹åŒ–i=0çš„æ—¶å€™ï¼Œjä¸ºå¤šå°‘èƒ½æ”¾ä¸‹æ”¹ç‰©å“ã€‚ä¸éœ€è¦æå‰æ’åºçš„ã€‚éå†æ—¶å€™åŒå±‚å¾ªç¯ï¼Œå¤–å±‚ç‰©å“ï¼Œå†…å±‚é‡é‡ã€‚å†…å±‚ä¹Ÿå¾—ä»1å¼€å§‹éå†ã€‚ä¸¤ç§é€‰æ‹©ï¼šä¸€ç§ä¸æ”¾è¿™ä¸ªï¼Œä¸€ç§æ”¾è¿™ä¸ªã€‚ æœ€é•¿æœ‰æ•ˆæ‹¬å·ï¼šåªåŒ…å«()çš„å­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºæœ€é•¿æœ‰æ•ˆçš„è¿ç»­å­—ä¸²é•¿åº¦ã€‚ç”¨æ ˆä¿å­˜å·¦æ‹¬å·çš„ç´¢å¼•ï¼Œåˆå§‹åŒ–æ—¶ï¼Œæ ˆå…ˆå‹å…¥ -1ï¼Œè¡¨ç¤ºâ€œæœ‰æ•ˆæ‹¬å·å­ä¸²èµ·ç‚¹å‰çš„ä½ç½®â€ã€‚é‡åˆ°å³æ‹¬å·åˆ™å¼¹å‡ºæ ˆé¡¶ï¼Œå¦‚æœå¼¹å‡ºåæ ˆç©ºäº†ï¼Œè¯´æ˜é‡åˆ°ä¸èƒ½é…å¯¹çš„å³æ‹¬å·ï¼ŒæŠŠå½“å‰ä½ç½®ä¸‹æ ‡å…¥æ ˆï¼ˆæ–°èµ·ç‚¹ï¼‰ã€‚å¦åˆ™ï¼Œå½“å‰æœ‰æ•ˆæ‹¬å·é•¿åº¦ä¸ºi - æ ˆé¡¶ä¸‹æ ‡ï¼Œæ›´æ–°æœ€å¤§é•¿åº¦ã€‚è¿™é‡Œè®°å½•ä¸æ˜¯é‡åˆ°ä¸æœ‰æ•ˆå†è®°å½•ï¼Œè€Œæ˜¯æ¯æ¬¡é‡åˆ°æœ‰æ•ˆæ—¶è®°å½•ã€‚ ä¸åŒè·¯å¾„ï¼šå¤šç»´åŠ¨æ€è§„åˆ’ï¼Œç®€å•ã€‚ æœ€å°è·¯å¾„å’Œï¼šä¾ç„¶å¤šç»´è·¯å¾„è§„åˆ’ï¼Œåˆå§‹åŒ–å·¦è¾¹å’Œä¸Šè¾¹ï¼Œç›´æ¥åœ¨åŸæ•°ç»„ä¸Šæ“ä½œã€‚ æœ€é•¿å›æ–‡å­ä¸²ï¼šå¤šç»´æ•°ç»„è¡¨ç¤ºi-jçš„å­ä¸²æ˜¯å¦æ˜¯å›æ–‡å­ä¸²ï¼Œæ¨æ¼”å…³ç³»å†³å®šéå†é¡ºåºï¼Œijä¾èµ–i+1,j-1ï¼Œæ‰€ä»¥ä»å·¦ä¸‹è§’å¼€å§‹éå†ã€‚å¦‚æœijå­—ç¬¦ç›¸ç­‰ï¼Œç›¸å·®&lt;=1ï¼Œæˆ–è€…dp[i+1][j-1]ä¸ºtrueï¼Œåˆ™ä¸ºå›æ–‡ï¼Œè®°å½•ç»“æœ æœ€é•¿å…¬å…±å­åºåˆ—ï¼šä¸¤ä½æ•°ç»„è¡¨ç¤ºtext1çš„i-1ç»“å°¾å’Œtext2çš„j-1ç»“å°¾çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦ã€‚æ³¨æ„å­—ç¬¦ä¸ç­‰äºçš„æ—¶å€™ï¼ŒMath.max(dp[i - 1][j], dp[i][j - 1]). ç¼–è¾‘è·ç¦»ï¼šæ’å…¥ã€åˆ é™¤ã€æ›¿æ¢ã€‚æ€è·¯ï¼šäºŒç»´åŠ¨æ€æ•°ç»„ï¼Œé•¿åº¦len1+1*len2+1ï¼Œè¡¨ç¤ºi-1ç»“å°¾å’Œj-1ç»“å°¾çš„ã€‚ä¸ºä»€ä¹ˆæ•°ç»„é•¿åº¦è¦+1ï¼Œå› ä¸º0çš„ä½ç½®éœ€è¦éå†ï¼Œåˆå§‹åŒ–ä¸å¥½åˆå§‹åŒ–ï¼Œåªèƒ½ç”¨-1çš„åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä¸ºå¯¹åº”çš„ijã€‚çŠ¶æ€è½¬ç§»ï¼šå­—ç¬¦ç›¸ç­‰åˆ™ç­‰äºdp[i-1][j-1]ï¼Œä¸æƒ³ç­‰åˆ™åˆ é™¤ï¼šdp[i-1][j], dp[i][j-1]ï¼Œä¿®æ”¹ï¼šdp[i-1][j-1]ï¼Œå…¶ä¸­å–æœ€å°ç„¶å+1ã€‚ åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼šéå†ï¼Œç”¨mapå¯ä»¥ï¼Œä½†æ˜¯æœ€å¥½çš„æ˜¯ç”¨å¼‚æˆ–è¿ç®—ï¼Œ^ï¼Œç›¸åŒå¼‚æˆ–ä¸º0ï¼Œä¸0å¼‚æˆ–ä¸ºè‡ªå·±ã€‚ å¤šæ•°å…ƒç´ ï¼šä½¿ç”¨æŠ•ç¥¨æœºåˆ¶ï¼Œè®°å½•ä¸€ä¸ªç»“æœæ•°å’Œä¸€ä¸ªæ•°é‡ï¼Œå¦‚æœæ•°é‡ç­‰äº0åˆ™æ¢æ•°ï¼Œå¦åˆ™çœ‹å½“å‰æ•°æ˜¯å¦ç­‰äºç»“æœæ•°ï¼Œå†³å®šæŠ•ç¥¨+1/-1ã€‚ é¢œè‰²åˆ†ç±»ï¼šä¸‰è‰²å›½æ——é—®é¢˜ï¼ŒåŒæŒ‡é’ˆï¼Œéƒ½ä»0å¼€å§‹éå†ï¼Œä¸€ä¸ªæŒ‡é’ˆç”¨æ¥æ¢1ï¼Œä¸€ä¸ªæŒ‡é’ˆç”¨æ¥æ¢0ï¼Œä½†æ˜¯æ¢0éœ€è¦æ³¨æ„ï¼Œå¯èƒ½æŠŠ1æ¢å‡ºå»äº†ï¼Œæ‰€ä»¥æ¢å®Œ0ä¹‹åå¦‚æœp0&lt;p1å°±å¾—äº¤æ¢iå’Œp1ã€‚ ä¸‹ä¸€ä¸ªæ’åˆ—ï¼šä¸¾ä¸ªä¾‹å­123654ï¼Œ124653ï¼Œå…ˆè¦ä»åå¾€å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‡åºçš„ï¼Œç„¶åä»åå¾€å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”å‡åºå¯¹ç¬¬ä¸€ä¸ªæ•°å¤§çš„ï¼Œç„¶åäº¤æ¢ï¼Œå˜æˆäº†124653ï¼Œç„¶ååè½¬i+1åˆ°æœ«å°¾è¿™æ®µã€‚ </span><br></pre></td></tr></table></figure>

<h2 id="ä¸¤æ•°ä¹‹å’Œ"><a href="#ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="ä¸¤æ•°ä¹‹å’Œ"></a>ä¸¤æ•°ä¹‹å’Œ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ target  çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</span><br><span class="line">ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä½¿ç”¨ä¸¤æ¬¡ç›¸åŒçš„å…ƒç´ ã€‚</span><br><span class="line">ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(target - nums[i])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i, map.get(target - nums[i])&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="å­—æ¯å¼‚ä½è¯åˆ†ç»„"><a href="#å­—æ¯å¼‚ä½è¯åˆ†ç»„" class="headerlink" title="## å­—æ¯å¼‚ä½è¯åˆ†ç»„"></a>## å­—æ¯å¼‚ä½è¯åˆ†ç»„</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯·ä½ å°† å­—æ¯å¼‚ä½è¯ ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœåˆ—è¡¨ã€‚</span><br><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥: strs = [&quot;eat&quot;, &quot;tea&quot;, &quot;tan&quot;, &quot;ate&quot;, &quot;nat&quot;, &quot;bat&quot;]</span><br><span class="line">è¾“å‡º: [[&quot;bat&quot;],[&quot;nat&quot;,&quot;tan&quot;],[&quot;ate&quot;,&quot;eat&quot;,&quot;tea&quot;]]</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">groupAnagrams</span><span class="params">(String[] strs)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ©ç”¨streamèšåˆstrs</span></span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; map = Arrays.stream(strs)</span><br><span class="line">                .collect(Collectors.groupingBy(str -&gt; &#123;</span><br><span class="line">                    <span class="comment">// å¯¹æ•°ç»„æ’åº</span></span><br><span class="line">                    <span class="type">char</span>[] array = str.toCharArray();</span><br><span class="line">                    Arrays.sort(array);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(array);</span><br><span class="line">                &#125;));</span><br><span class="line">        List&lt;List&lt;String&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(map.values());</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æœ€é•¿è¿ç»­åºåˆ—"><a href="#æœ€é•¿è¿ç»­åºåˆ—" class="headerlink" title="æœ€é•¿è¿ç»­åºåˆ—"></a>æœ€é•¿è¿ç»­åºåˆ—</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡ºæ•°å­—è¿ç»­çš„æœ€é•¿åºåˆ—ï¼ˆä¸è¦æ±‚åºåˆ—å…ƒç´ åœ¨åŸæ•°ç»„ä¸­è¿ç»­ï¼‰çš„é•¿åº¦ã€‚</span><br><span class="line">è¯·ä½ è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [100,4,200,1,3,2]</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼šæœ€é•¿æ•°å­—è¿ç»­åºåˆ—æ˜¯ [1, 2, 3, 4]ã€‚å®ƒçš„é•¿åº¦ä¸º 4ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestConsecutive</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxLen</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">preLen</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] == nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[i] != nums[i - <span class="number">1</span>] + <span class="number">1</span>) &#123;</span><br><span class="line">                maxLen = Math.max(maxLen, preLen);</span><br><span class="line">                preLen = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                preLen ++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maxLen = Math.max(maxLen, preLen);</span><br><span class="line">        <span class="keyword">return</span> maxLen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="ä¸‹ä¸€ä¸ªæ’åˆ—"><a href="#ä¸‹ä¸€ä¸ªæ’åˆ—" class="headerlink" title="ä¸‹ä¸€ä¸ªæ’åˆ—"></a>ä¸‹ä¸€ä¸ªæ’åˆ—</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•´æ•°æ•°ç»„çš„ä¸€ä¸ª æ’åˆ—  å°±æ˜¯å°†å…¶æ‰€æœ‰æˆå‘˜ä»¥åºåˆ—æˆ–çº¿æ€§é¡ºåºæ’åˆ—ã€‚</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼Œarr = [1,2,3] ï¼Œä»¥ä¸‹è¿™äº›éƒ½å¯ä»¥è§†ä½œ arr çš„æ’åˆ—ï¼š[1,2,3]ã€[1,3,2]ã€[3,1,2]ã€[2,3,1] ã€‚</span><br><span class="line">æ•´æ•°æ•°ç»„çš„ ä¸‹ä¸€ä¸ªæ’åˆ— æ˜¯æŒ‡å…¶æ•´æ•°çš„ä¸‹ä¸€ä¸ªå­—å…¸åºæ›´å¤§çš„æ’åˆ—ã€‚æ›´æ­£å¼åœ°ï¼Œå¦‚æœæ•°ç»„çš„æ‰€æœ‰æ’åˆ—æ ¹æ®å…¶å­—å…¸é¡ºåºä»å°åˆ°å¤§æ’åˆ—åœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œé‚£ä¹ˆæ•°ç»„çš„ ä¸‹ä¸€ä¸ªæ’åˆ— å°±æ˜¯åœ¨è¿™ä¸ªæœ‰åºå®¹å™¨ä¸­æ’åœ¨å®ƒåé¢çš„é‚£ä¸ªæ’åˆ—ã€‚å¦‚æœä¸å­˜åœ¨ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ’åˆ—ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„å¿…é¡»é‡æ’ä¸ºå­—å…¸åºæœ€å°çš„æ’åˆ—ï¼ˆå³ï¼Œå…¶å…ƒç´ æŒ‰å‡åºæ’åˆ—ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼Œarr = [1,2,3] çš„ä¸‹ä¸€ä¸ªæ’åˆ—æ˜¯ [1,3,2] ã€‚</span><br><span class="line">ç±»ä¼¼åœ°ï¼Œarr = [2,3,1] çš„ä¸‹ä¸€ä¸ªæ’åˆ—æ˜¯ [3,1,2] ã€‚</span><br><span class="line">è€Œ arr = [3,2,1] çš„ä¸‹ä¸€ä¸ªæ’åˆ—æ˜¯ [1,2,3] ï¼Œå› ä¸º [3,2,1] ä¸å­˜åœ¨ä¸€ä¸ªå­—å…¸åºæ›´å¤§çš„æ’åˆ—ã€‚</span><br><span class="line">ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡º nums çš„ä¸‹ä¸€ä¸ªæ’åˆ—ã€‚</span><br><span class="line"></span><br><span class="line">å¿…é¡» åŸåœ° ä¿®æ”¹ï¼Œåªå…è®¸ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´ã€‚</span><br></pre></td></tr></table></figure>

<p><strong>çº¯æ‰¾è§„å¾‹ï¼Œä¸¾ä¾‹ï¼š123654ï¼Œä»åå¾€å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ­£å‘å‡åºçš„ï¼Œå°±æ˜¯36ï¼Œç„¶åä»åå¾€å‰æ‰¾ç¬¬ä¸€ä¸ªæ¯”3å¤§çš„æ•°ï¼Œå°±æ˜¯4ï¼Œç„¶åäº¤æ¢ï¼Œäº¤æ¢ä¹‹ååè½¬i+1åˆ°æœ«å°¾è¿™æ®µã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nextPermutation</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸¾ä¾‹ï¼š123654ï¼Œçº¯æ‰¾è§„å¾‹ï¼Œä»åå¾€å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ­£å‘å‡åºçš„ï¼Œå°±æ˜¯36ï¼Œç„¶åä»åå¾€å‰æ‰¾ç¬¬ä¸€ä¸ªæ¯”3å¤§çš„æ•°ï¼Œå°±æ˜¯4ï¼Œç„¶åäº¤æ¢ï¼Œäº¤æ¢ä¹‹ååè½¬i+1åˆ°æœ«å°¾è¿™æ®µã€‚</span></span><br><span class="line">        <span class="comment">// 1.æ‰¾ç¬¬ä¸€ä¸ªæ­£å‘å‡åºçš„</span></span><br><span class="line">        <span class="comment">// æ²¡æœ‰æ‰¾åˆ°å°±ä¸åšç¬¬äºŒæ­¥äº¤æ¢ï¼Œæ¯”å¦‚321ï¼Œå¾—åè½¬</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">record</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nums.length - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i --) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt; nums[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                record = i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.ä»åå‘å‰æ‰¾æ¯”recordå¤§çš„æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (record &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">bigger</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (nums[bigger] &lt;= nums[record] &amp;&amp; bigger &gt; record) &#123;</span><br><span class="line">                bigger --;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(record, bigger, nums);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.ç¿»è½¬record+1åˆ°æœ«å°¾çš„</span></span><br><span class="line">        reverse(record + <span class="number">1</span>, nums.length - <span class="number">1</span>, nums);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">pre</span> <span class="operator">=</span> nums[i];</span><br><span class="line">        nums[i] = nums[j];</span><br><span class="line">        nums[j] = pre;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            swap(i, j, nums);</span><br><span class="line">            i ++;</span><br><span class="line">            j --;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="å¯»æ‰¾é‡å¤æ•°"><a href="#å¯»æ‰¾é‡å¤æ•°" class="headerlink" title="å¯»æ‰¾é‡å¤æ•°"></a>å¯»æ‰¾é‡å¤æ•°</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»™å®šä¸€ä¸ªåŒ…å« n + 1 ä¸ªæ•´æ•°çš„æ•°ç»„ nums ï¼Œå…¶æ•°å­—éƒ½åœ¨ [1, n] èŒƒå›´å†…ï¼ˆåŒ…æ‹¬ 1 å’Œ nï¼‰ï¼Œå¯çŸ¥è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ã€‚</span><br><span class="line">å‡è®¾ nums åªæœ‰ ä¸€ä¸ªé‡å¤çš„æ•´æ•° ï¼Œè¿”å› è¿™ä¸ªé‡å¤çš„æ•° ã€‚</span><br><span class="line">ä½ è®¾è®¡çš„è§£å†³æ–¹æ¡ˆå¿…é¡» ä¸ä¿®æ”¹ æ•°ç»„ nums ä¸”åªç”¨å¸¸é‡çº§ O(1) çš„é¢å¤–ç©ºé—´ã€‚</span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [1,3,4,2,2]</span><br><span class="line">è¾“å‡ºï¼š2</span><br></pre></td></tr></table></figure>

<p><strong>ä¸èƒ½ç”¨mapã€setï¼Œæ•°ç»„ä¸­å¦‚æœæ²¡æœ‰é‡å¤çš„æ•°ï¼Œé‚£å°±æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæœ‰é‡å¤çš„å°±æ˜¯å¤šä¸ªä¸‹æ ‡å¯¹åº”ä¸€ä¸ªæ•°çš„å…³ç³»ã€‚å’Œç¯å½¢é“¾è¡¨ç±»ä¼¼ï¼Œä½¿ç”¨å¿«æ…¢æŒ‡é’ˆã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findDuplicate</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// è¡ç”Ÿä¸ºç¯å½¢é“¾è¡¨é—®é¢˜ï¼Œç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°ç¯çš„å…¥å£ã€‚</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">slow</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fast</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°ç›¸é‡å¤„</span></span><br><span class="line">        slow = nums[slow];</span><br><span class="line">        fast = nums[nums[fast]];</span><br><span class="line">        <span class="keyword">while</span> (slow != fast) &#123;</span><br><span class="line">            slow = nums[slow];</span><br><span class="line">            fast = nums[nums[fast]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ…¢æŒ‡é’ˆä»0å‡ºå‘ï¼Œå¿«æŒ‡é’ˆä»åŸåœ°å‡ºå‘ï¼Œéƒ½+1è¡Œèµ°</span></span><br><span class="line">        slow = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (slow != fast) &#123;</span><br><span class="line">            slow = nums[slow];</span><br><span class="line">            fast = nums[fast];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜ä¹‹Python</title>
    <url>/2025/08/10/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E8%83%8C%E8%BF%87%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8BPython/</url>
    <content><![CDATA[<h2 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h2><p>Django æ˜¯ä¸€ä¸ªç”¨ Python ç¼–å†™çš„é«˜çº§ Web æ¡†æ¶ï¼Œå€¡å¯¼â€œå¼€ç®±å³ç”¨â€å’Œå¿«é€Ÿå¼€å‘ã€‚å®ƒå†…ç½®äº† ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰ã€URL è·¯ç”±ã€æ¨¡æ¿å¼•æ“ã€è¡¨å•å¤„ç†ã€ç”¨æˆ·è®¤è¯å’Œå¼ºå¤§çš„åå°ç®¡ç†ï¼ˆAdminï¼‰ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œèƒ½æœ‰æ•ˆå¤„ç† Web å¼€å‘ä¸­çš„å¸¸è§ä»»åŠ¡ã€‚Django éµå¾ª **MVTï¼ˆæ¨¡å‹-è§†å›¾-æ¨¡æ¿ï¼‰**è®¾è®¡æ¨¡å¼ï¼Œç»“æ„æ¸…æ™°ï¼Œä»£ç å¤ç”¨æ€§é«˜ã€‚å®ƒæ³¨é‡å®‰å…¨æ€§ï¼Œèƒ½è‡ªåŠ¨é˜²èŒƒ CSRFã€XSS ç­‰å¸¸è§æ”»å‡»ã€‚å‡­å€Ÿå…¶å®Œå¤‡çš„ç”Ÿæ€ç³»ç»Ÿå’Œä¸¥è°¨çš„è®¾è®¡ï¼ŒDjango éå¸¸é€‚åˆæ„å»ºæ•°æ®é©±åŠ¨ã€å®‰å…¨å¯é çš„ä¸­å¤§å‹ Web åº”ç”¨ï¼Œè®©å¼€å‘è€…æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</p>
<p><strong>ä½¿ç”¨ Django å¼€å‘çš„æ­¥éª¤</strong>ï¼š1. <strong>å®‰è£…</strong>ï¼š<code>pip install django</code>ã€‚2. <strong>åˆ›å»ºé¡¹ç›®</strong>ï¼š<code>django-admin startproject mysite</code>ï¼Œç”Ÿæˆé¡¹ç›®éª¨æ¶ã€‚3. <strong>åˆ›å»ºåº”ç”¨</strong>ï¼š<code>python manage.py startapp myapp</code>ï¼ŒDjango é¼“åŠ±åŠŸèƒ½æ¨¡å—åŒ–ã€‚4. <strong>å®šä¹‰æ¨¡å‹</strong>ï¼šåœ¨ <code>models.py</code> ä¸­ç”¨ Python ç±»å®šä¹‰æ•°æ®ç»“æ„ï¼ŒDjango ORM æ˜ å°„åˆ°æ•°æ®åº“ã€‚5. <strong>æ³¨å†Œåº”ç”¨</strong>ï¼šå°†åº”ç”¨åæ·»åŠ åˆ° <code>settings.py</code> çš„ <code>INSTALLED_APPS</code> ä¸­ã€‚6. <strong>è®¾è®¡ URL</strong>ï¼šåœ¨é¡¹ç›®å’Œåº”ç”¨ä¸­é…ç½® <code>urls.py</code>ï¼Œå°† URL è·¯ç”±åˆ°è§†å›¾ã€‚7. <strong>ç¼–å†™è§†å›¾</strong>ï¼šåœ¨ <code>views.py</code> ä¸­å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ï¼ˆå¦‚æ¸²æŸ“æ¨¡æ¿ï¼‰ã€‚8. <strong>åˆ›å»ºæ¨¡æ¿</strong>ï¼šåœ¨ <code>templates</code> ç›®å½•ä¸‹ç¼–å†™ HTML æ¨¡æ¿ã€‚9. <strong>è¿ç§»æ•°æ®åº“</strong>ï¼š<code>makemigrations</code> ç”Ÿæˆè¿ç§»æ–‡ä»¶ï¼Œ<code>migrate</code> åŒæ­¥æ¨¡å‹åˆ°æ•°æ®åº“ã€‚10. <strong>è¿è¡Œ</strong>ï¼š<code>python manage.py runserver</code> å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚</p>
<p><strong>åœ¨Dockerå†…è¿è¡Œ</strong>ï¼šç¼–å†™ <code>Dockerfile</code> å®šä¹‰Pythonç¯å¢ƒã€å®‰è£…ä¾èµ–ï¼ˆåŒ…æ‹¬Djangoï¼‰ï¼›åˆ›å»º <code>docker-compose.yml</code> é…ç½®WebæœåŠ¡å’Œæ•°æ®åº“ï¼ˆå¦‚PostgreSQLï¼‰ï¼›å°†ä»£ç å¤åˆ¶åˆ°é•œåƒï¼›æš´éœ²ç«¯å£ï¼ˆå¦‚8000ï¼‰ï¼›ä½¿ç”¨ <code>docker-compose up</code> æ„å»ºå¹¶è¿è¡Œå®¹å™¨ï¼ŒDjangoåº”ç”¨å³åœ¨éš”ç¦»ç¯å¢ƒä¸­å¯åŠ¨ã€‚</p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸é‚£äº›å¹´ä¹‹å¼€å§‹åˆ·LetCodeé¢˜ç±³</title>
    <url>/2025/08/10/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E4%B8%8D%E9%82%A3%E4%BA%9B%E5%B9%B4%E4%BA%86%E5%BC%80%E5%A7%8B%E5%88%B7%E9%A2%98/</url>
    <content><![CDATA[<h2 id="æœ€å¤§å­æ•°ç»„å’Œ"><a href="#æœ€å¤§å­æ•°ç»„å’Œ" class="headerlink" title="æœ€å¤§å­æ•°ç»„å’Œ"></a>æœ€å¤§å­æ•°ç»„å’Œ</h2><p>åŠ¨æ€è§„åˆ’ï¼Œdpè¡¨ç¤ºä»¥å½“å‰æ•°ç»“å°¾çš„æœ€å¤§è¿ç»­å’Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// åŠ¨æ€è§„åˆ’</span></span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i ++) &#123;</span><br><span class="line">            dp[i] = Math.max(dp[i - <span class="number">1</span>] + nums[i], nums[i]);</span><br><span class="line">            res = Math.max(res, dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ—‹è½¬é“¾è¡¨"><a href="#æ—‹è½¬é“¾è¡¨" class="headerlink" title="æ—‹è½¬é“¾è¡¨"></a>æ—‹è½¬é“¾è¡¨</h2><p>æ—‹è½¬å¤šå°‘å°±æ˜¯æŠŠåé¢å¤šå°‘èŠ‚ç‚¹æ¬åˆ°å‰é¢ã€‚æ³¨æ„kæ˜¯é“¾è¡¨é•¿åº¦æ•´æ•°å€æ—¶ä¸éœ€è¦åŠ¨ã€‚1.å…ˆè®¡ç®—é•¿åº¦ã€‚2.å–ä½™ã€‚3.æ‰¾æ–°çš„å°¾èŠ‚ç‚¹ã€‚4.é‡æ–°æ‹¼æ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">rotateRight</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="comment">// æœ¬è´¨ï¼šæ—‹è½¬å¤šå°‘å°±æ˜¯æŠŠåé¢å¤šå°‘èŠ‚ç‚¹æ¬åˆ°å‰é¢ã€‚æ³¨æ„kæ˜¯é“¾è¡¨é•¿åº¦æ•´æ•°å€æ—¶ä¸éœ€è¦åŠ¨ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == head) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// 1.å…ˆè®¡ç®—é•¿åº¦</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tail</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (tail.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            tail = tail.next;</span><br><span class="line">            len ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.å–ä½™</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> k % len;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> head;</span><br><span class="line">        <span class="comment">// 3.æ‰¾æ–°çš„å°¾èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">newTail</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; len - n; i ++) &#123;</span><br><span class="line">            newTail = newTail.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.é‡æ–°æ‹¼æ¥</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">res</span> <span class="operator">=</span> newTail.next;</span><br><span class="line">        newTail.next = <span class="literal">null</span>;</span><br><span class="line">        tail.next = head;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</h2><p>DFSæ·±åº¦ä¼˜å…ˆæœç´¢</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”¨DFSæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œä¸‰ç§æƒ…å†µï¼špå’Œqåœ¨æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å·¦å³å­æ ‘ã€pæ˜¯å…¬å…±ç¥–å…ˆqæ˜¯å­èŠ‚ç‚¹ã€qæ˜¯å…¬å…±ç¥–å…ˆpæ˜¯å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// è¿”å›æ¡ä»¶ï¼šåˆ°å¶å­èŠ‚ç‚¹/é‡åˆ°äº†pqå°±ä¸ç”¨å¾€ä¸‹äº†</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == root || root == p || root == q) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> lowestCommonAncestor(root.left, p, q);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> lowestCommonAncestor(root.right, p, q);</span><br><span class="line">        <span class="comment">// é€’å½’å‡½æ•°è¿”å›çš„æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å€™é€‰</span></span><br><span class="line">        <span class="comment">// å¦‚æœleftå’Œrightéƒ½ä¸ç©ºï¼Œè¯æ˜æ˜¯ç¬¬ä¸€ç§æƒ…å†µï¼Œåœ¨å·¦å³å­æ ‘ï¼Œè¿”å›root</span></span><br><span class="line">        <span class="comment">// å¦‚æœå…¶ä¸­ä¸€ä¸ªä¸ºç©ºï¼Œè¯æ˜åœ¨å½“å‰rootçš„ä¸€è¾¹ï¼Œè¿”å›éç©ºçš„</span></span><br><span class="line">        <span class="comment">// éƒ½ä¸ºnullï¼Œå°±æ˜¯éå†åˆ°å¶å­ç»“ç‚¹äº†ï¼Œè¿”å›null</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != left &amp;&amp; <span class="literal">null</span> != right) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != left) <span class="keyword">return</span> left;</span><br><span class="line">        <span class="keyword">return</span> right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ"><a href="#ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ" class="headerlink" title="ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ"></a>ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ</h2><p>æƒ³ç€ç”¨DFSï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦æ˜¯O(2^n)ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> res;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumTotal</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; triangle)</span> &#123;</span><br><span class="line">        <span class="comment">// æ·±åº¦ä¼˜å…ˆæœç´¢+å›æº¯</span></span><br><span class="line">        res = Integer.MAX_VALUE;</span><br><span class="line">        dfs(<span class="number">0</span>, <span class="number">0</span>, triangle, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> layer, <span class="type">int</span> index, List&lt;List&lt;Integer&gt;&gt; triangle, <span class="type">int</span> sum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (layer == triangle.size()) &#123;</span><br><span class="line">            res = Math.min(res, sum);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        dfs(layer + <span class="number">1</span>, index, triangle, sum + triangle.get(layer).get(index));</span><br><span class="line">        dfs(layer + <span class="number">1</span>, index + <span class="number">1</span>, triangle, sum + triangle.get(layer).get(index));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œå¹¶è¿›è¡Œç©ºé—´ä¼˜åŒ–ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n^2)ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumTotal</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; triangle)</span> &#123;</span><br><span class="line">        <span class="comment">// å¯ä»¥ç”¨åŠ¨æ€è§„åˆ’ï¼Œnè¡Œnåˆ—çš„dpæ•°ç»„è¡¨ç¤ºï¼ŒåŒå±‚éå†çŠ¶æ€è½¬ç§»ï¼Œç„¶åä»æ ¹èŠ‚ç‚¹æ‰¾æœ€å°çš„ã€‚</span></span><br><span class="line">        <span class="comment">// åŠ¨æ€è§„åˆ’å¯è¿›è¡Œç©ºé—´ä¼˜åŒ–ï¼Œåªç”¨ä¸¤è¡Œçš„æ•°ç»„è¡¨ç¤ºdpã€‚</span></span><br><span class="line">        <span class="comment">// ç”¨ä¸€è¡Œï¼Œè¡Œä¸è¡Œï¼ŒçŠ¶æ€è½¬ç§»indexä¾èµ–indexå’Œindex-1ï¼Œæ‰€ä»¥ä»å·¦åˆ°å³éå†ä¸è¡Œï¼Œå¾—ä»å³åˆ°å·¦ã€‚</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> triangle.size();</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        dp[<span class="number">0</span>] = triangle.get(<span class="number">0</span>).get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">layer</span> <span class="operator">=</span> <span class="number">1</span>; layer &lt; n; layer ++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> layer; index &gt;= <span class="number">0</span>; index --) &#123;</span><br><span class="line">                <span class="comment">// æ³¨æ„è¾¹ç•Œï¼Œå·¦è¾¹çš„åªèƒ½indexï¼Œå³è¾¹çš„åªèƒ½index-1ï¼Œleftè¡¨ç¤ºä»å·¦è¾¹ä¸‹æ¥</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> index == layer? Integer.MAX_VALUE : dp[index] + triangle.get(layer).get(index);</span><br><span class="line">                <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> index == <span class="number">0</span>? Integer.MAX_VALUE : dp[index - <span class="number">1</span>] + triangle.get(layer).get(index);</span><br><span class="line">                dp[index] = Math.min(left, right);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Arrays.toString(dp));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i ++) res = Math.min(res, dp[i]);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜ä¹‹Spring</title>
    <url>/2025/07/24/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E8%83%8C%E8%BF%87%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8BSpring/</url>
    <content><![CDATA[<h2 id="spring"><a href="#spring" class="headerlink" title="spring"></a>spring</h2><ul>
<li><p>Springçš„æ¶æ„ï¼š1âƒ£ï¸æ§åˆ¶åè½¬IOCå®¹å™¨ï¼Œè´Ÿè´£ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚2âƒ£ï¸AOPé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ç°è·¨åº”ç”¨ç¨‹åºçš„å…±æœ‰å…³æ³¨ç‚¹ï¼Œä»£ç å‰ååšå¢å¼ºã€‚3âƒ£ï¸ç®€åŒ–æ•°æ®è®¿é—®ï¼Œå¦‚JDBCï¼Œæä¾›ä¸€è‡´çš„æ•°æ®è®¿é—®ã€‚4âƒ£ï¸Webå±‚ï¼ŒSpring MVCæä¾›ä¸€ä¸ªåˆ†ç¦»çš„æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨å®ç°ï¼Œç”¨äºæ„å»ºWebåº”ç”¨ã€‚</p>
</li>
<li><p>spring beançš„åŠ è½½è¿‡ç¨‹&#x2F;ç”Ÿå‘½å‘¨æœŸï¼š1âƒ£ï¸å¯åŠ¨springåº”ç”¨ä¸Šä¸‹æ–‡ã€‚2âƒ£ï¸åŠ è½½beanå®šä¹‰ï¼šè¯»å–xmlæ–‡ä»¶ã€javaæ³¨è§£ã€javaé…ç½®ç±»ï¼Œä¸ºæ¯ä¸ªå£°æ˜çš„Beanåˆ›å»ºä¸€ä¸ªBeanDefinitionå¯¹è±¡ï¼ŒåŒ…å«beançš„æ‰€æœ‰å®šä¹‰ä¿¡æ¯ã€‚ 3âƒ£ï¸å®ä¾‹åŒ–beanï¼šè°ƒç”¨æ„é€ å‡½æ•°ã€ä¾èµ–æ³¨å…¥ã€BeanPostProcessor çš„å‰å¤„ç†ã€‚4âƒ£ï¸åˆå§‹åŒ–beanï¼šè°ƒç”¨beançš„åˆå§‹åŒ–æ–¹æ³•ï¼š@PostConstructæ³¨è§£çš„æ–¹æ³•ã€æŒ‡å®šçš„init-methodã€InitializingBeançš„afterPropertiesSetæ–¹æ³•ã€‚5âƒ£ï¸ä½¿ç”¨beanã€‚6âƒ£ï¸é”€æ¯ï¼šå®¹å™¨å…³é—­åï¼Œå¦‚æœBeanå®ç°äº†DisposableBeanæ¥å£ï¼Œåˆ™ä¼šå›è°ƒè¯¥æ¥å£çš„destroyæ–¹æ³•ã€‚</p>
</li>
<li><p>spring IOCï¼šæ§åˆ¶åè½¬ï¼Œé€šè¿‡springæ¥ç®¡ç†å¯¹è±¡çš„åˆ›å»ºã€é…ç½®ã€ç”Ÿå‘½å‘¨æœŸï¼ŒæŠŠæ§åˆ¶æƒäº¤ç»™springã€‚æä¾›BeanFactoryå’ŒApplicationContextä¸¤ç§IOCå®¹å™¨ï¼Œå®ç°å¯¹beançš„ç®¡ç†ã€‚å®ç°åŸç†ï¼šä¾èµ–æ³¨å…¥DIã€Beanç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
</li>
<li><p>spring AOPï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œä»£ç å‰ååšå¢å¼ºæ“ä½œï¼Œæé«˜ä»£ç æ¨¡å—æ€§ã€‚å®ç°ï¼šåŸºäºåŠ¨æ€ä»£ç†ï¼Œå®ç°æ¥å£ç”¨JDKåŠ¨æ€ä»£ç†ï¼Œå¦åˆ™CGLIBåŠ¨æ€ä»£ç†ã€‚@Aspectæ³¨è§£å’Œ@Aroundåˆ‡å…¥ç‚¹å®ç°åˆ‡é¢ã€‚</p>
</li>
<li><p>JDKå’ŒCGLIBåŠ¨æ€ä»£ç†ï¼šJDKåŠ¨æ€ä»£ç†é’ˆå¯¹ç±»å®ç°æŸä¸ªæ¥å£ï¼ŒåŸºäºåå°„ç”Ÿæˆå®ç°åŒæ ·æ¥å£çš„ä»£ç†ç±»ã€‚CGLIBåº•å±‚åŸºäºasmç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œé€šè¿‡ä¿®æ”¹å­—èŠ‚ç ç”Ÿæˆä¸€ä¸ªå­ç±»ã€‚</p>
</li>
<li><p>Spring AOPå’ŒAspectJ AOPï¼šSpring AOP åŸºäºåŠ¨æ€ä»£ç†å®ç°ï¼Œåªèƒ½åœ¨è¿è¡Œæ—¶ç»‡å…¥ï¼Œæ€§èƒ½æ¯”AspectJç¼–è¯‘ç»‡å…¥æ…¢ã€‚AspectJåªæ”¯æŒç¼–è¯‘å‰åå’Œç±»åŠ è½½æ—¶ç»‡å…¥ï¼Œæ€§èƒ½æ›´å¥½ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚</p>
</li>
<li><p>javaåå°„ï¼šå¯¹äºä»»ä½•ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½çŸ¥é“è¿™ä¸ªç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºJavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚getField(å±æ€§åå­—)å’ŒgetDeclaredFieldï¼ˆå¿½ç•¥è®¿é—®æ§åˆ¶ï¼‰è·å–å±æ€§Fieldã€‚getMethodè·å–æ–¹æ³•Methodã€‚invokeæ‰§è¡Œã€‚</p>
</li>
<li><p>BeanFactoryå’ŒApplicationContextï¼šéƒ½æ˜¯Springä¸­ç®¡ç†Beançš„å®¹å™¨ã€‚BeanFactoryæ˜¯Spring IoCå®¹å™¨çš„åŸºç¡€æ¥å£ï¼ŒApplicationContextå®ç°BeanFactoryï¼Œæä¾›æ›´ä¸°å¯ŒåŠŸèƒ½ï¼šå›½é™…åŒ–ã€äº‹ä»¶å‘å¸ƒã€æ³¨è§£æ”¯æŒã€‚BeanFactory é‡‡ç”¨æ‡’åŠ è½½ï¼ˆå»¶è¿Ÿåˆå§‹åŒ–ï¼‰ç­–ç•¥ï¼Œåªæœ‰åœ¨è¯·æ±‚è·å– Bean æ—¶æ‰ä¼šåˆ›å»ºå’Œåˆå§‹åŒ–è¯¥ Beanã€‚ApplicationContexté‡‡ç”¨å³æ—¶åŠ è½½ç­–ç•¥ï¼Œå®¹å™¨å¯åŠ¨æ—¶ä¼šé¢„å…ˆåˆ›å»ºå’Œåˆå§‹åŒ–æ‰€æœ‰ Singleton Beanã€‚</p>
</li>
<li><p>FactoryBeanå’ŒBeanFactoryï¼šBeanFactoryæ˜¯IOCå®¹å™¨ï¼Œè´Ÿè´£ç”Ÿäº§å’Œç®¡ç†Beanå¯¹è±¡ï¼šè¯»å–beané…ç½®ã€åŠ è½½beanã€ä¾èµ–æ³¨å…¥ã€beanç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚FactoryBeanæ˜¯å·¥å‚Beanï¼Œå¯ä»¥å®ç°è¯¥æ¥å£æ¥è‡ªå®šä¹‰Beançš„åˆ›å»ºè¿‡ç¨‹ã€‚é‡å†™getObjectæ–¹æ³•æ§åˆ¶Beançš„åˆ›å»ºï¼ŒgetBeanè·å–Beanå®ä¾‹ã€‚</p>
</li>
<li><p>Springäº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ï¼šç”¨æ¥å®šä¹‰ä¸šåŠ¡æ–¹æ³•ä¹‹é—´äº‹åŠ¡å¤„ç†æ–¹å¼çš„æœºåˆ¶ï¼Œæ ¹æ®ç»™å®šçš„äº‹åŠ¡è§„åˆ™æ¥åˆ›å»ºå’Œæ§åˆ¶äº‹åŠ¡çš„è¾¹ç•Œå’ŒèŒƒå›´ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚@Transactionalæ³¨è§£çš„propagationå±æ€§æŒ‡å®šã€‚ä¾‹å¦‚é“¶è¡Œè½¬è´¦æ“ä½œä¸­æœ‰ä¸ªå®¡è®¡æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¼‚å¸¸ä¸æƒ³å½±å“è½¬è´¦äº‹åŠ¡çš„å›æ»šï¼Œå°±ç”¨REQUIRES_NEWåˆ›å»ºæ–°äº‹åŠ¡ã€‚ä¸€å…±æœ‰ä¸ƒç§ï¼š1.REQUIREDï¼šé»˜è®¤çš„ï¼Œå­˜åœ¨å°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œæ²¡æœ‰äº‹åŠ¡å°±åˆ›å»ºæ–°çš„ã€‚2.REQUIRES_NEWï¼šæ— è®ºå­˜ä¸å­˜åœ¨éƒ½åˆ›å»ºæ–°çš„ã€‚3.NOT_SUPPORTEDï¼šéäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå­˜åœ¨äº‹åŠ¡åˆ™æŒ‚èµ·ã€‚4.SUPPORTSï¼šå­˜åœ¨åˆ™åŠ å…¥äº‹åŠ¡ï¼Œä¸å­˜åœ¨åˆ™éäº‹åŠ¡ã€‚5.NESTEDï¼šå¦‚æœå­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡ï¼ˆå¯ç‹¬ç«‹æäº¤ï¼Œå¤–éƒ¨äº‹åŠ¡å›æ»šå®ƒä¹Ÿå¾—å›æ»šï¼‰å†…æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŒ‰REQUIREDå±æ€§æ‰§è¡Œã€‚6.NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚7.MANDATORYï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚</p>
</li>
<li><p>@Autowiredå’Œ@Resourceï¼šéƒ½æ˜¯ç”¨æ¥å®ç°ä¾èµ–æ³¨å…¥çš„æ³¨è§£ã€‚@Autowiredæ˜¯springçš„æ³¨è§£ï¼Œé»˜è®¤æ ¹æ®ç±»å‹æ³¨å…¥ï¼Œå¤šä¸ªç±»å‹ç›¸åŒåˆ™è¿›ä¸€æ­¥æ ¹æ®åç§°ã€‚å¦‚æœæŒ‰ç…§ç±»å‹åŒ¹é…æ¥å£ä¸åŒå®ç°ç±»éœ€è¦ç»“åˆ@Qualifierã€‚æä¾›requiredå±æ€§å…è®¸æ‰¾ä¸åˆ°beanæ—¶æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ã€‚@Resourceæ˜¯j2eeçš„æ³¨è§£ï¼Œé»˜è®¤æŒ‰byNameè‡ªåŠ¨æ³¨å…¥ï¼Œä¸èƒ½ç”¨äºæ„é€ å‡½æ•°ã€‚</p>
</li>
<li><p>Springæ ¸å¿ƒæ³¨è§£ï¼š@SpringBootApplicationï¼šç»„åˆæ³¨è§£ï¼Œç”¨äºå¯åŠ¨Spring Bootåº”ç”¨ï¼ŒåŒ…å«@Configurationã€@EnableAutoConfigurationå’Œ@ComponentScanã€‚@Componentï¼šæ ‡æ³¨ä¸€ä¸ªç±»ä¸ºéœ€è¦Springç®¡ç†çš„beanã€‚@Configurationï¼šè¡¨æ˜è¯¥ç±»æ˜¯ç”¨äºå®šä¹‰Beançš„é…ç½®ç±»ï¼Œé…åˆ@Beanæ¥åœ¨å®¹å™¨ä¸­æ³¨å†Œè‡ªå®šä¹‰çš„Beanï¼Œæ–¹æ³•è¿”å›å¯¹è±¡è¢«å®¹å™¨ç®¡ç†ã€‚@Transactionalï¼šç”¨äºå£°æ˜ä¸€ä¸ªæ–¹æ³•æˆ–ç±»éœ€è¦äº‹åŠ¡ç®¡ç†ã€‚</p>
</li>
<li><p>Springä¾èµ–æ³¨å…¥æ³¨è§£ï¼š@Autowiredã€@Qualifierã€@Resourceã€@Valueï¼šæ³¨å…¥æ™®é€šç±»å‹çš„å±æ€§ã€‚</p>
</li>
<li><p>Springç»„ä»¶æ‰«ææ³¨è§£ï¼š@Serviceï¼šç”¨äºServiceå±‚çš„ç»„ä»¶ã€‚@Repositoryï¼šç”¨äºDAOå±‚çš„ç»„ä»¶ã€‚@Controllerï¼šç”¨äºæ ‡è®°æ§åˆ¶å±‚ç»„ä»¶ã€‚</p>
</li>
<li><p>spring beanç”Ÿå‘½å‘¨æœŸï¼š1.åˆ›å»ºbeançš„å®ä¾‹ï¼Œåœ¨å †ä¸­å¼€è¾Ÿä¸€å—å†…å­˜ç©ºé—´ç»™è¿™ä¸ªå¯¹è±¡ï¼Œç”Ÿæˆå®ä¾‹å¯¹è±¡ã€‚2.å¡«å……beançš„æˆå‘˜å±æ€§ã€‚3.è°ƒç”¨initializeBeanæ–¹æ³•åˆå§‹åŒ–beanï¼ˆè°ƒç”¨@PostConstructã€å®ç°Awareæ¥å£çš„æ–¹æ³•ã€beforeâ€¦æ–¹æ³•ã€init-methodæ–¹æ³•ã€afterPropertiesSetæ–¹æ³•ï¼‰ã€‚</p>
</li>
<li><p>springçš„ä¸‰çº§ç¼“å­˜ï¼šç”¨æ¥è§£å†³å•ä¾‹beanå¾ªç¯ä¾èµ–é—®é¢˜ï¼Œæå‰æ‹¿åˆ°æœªåˆå§‹åŒ–å®Œå…¨çš„å¯¹è±¡ã€‚ç¬¬ä¸€çº§ç¼“å­˜ï¼šç”¨æ¥ä¿å­˜å®ä¾‹åŒ–ã€åˆå§‹åŒ–éƒ½å®Œæˆçš„å¯¹è±¡ã€‚ç¬¬äºŒçº§ç¼“å­˜ï¼šç”¨æ¥ä¿å­˜å®ä¾‹åŒ–å®Œæˆä½†æ˜¯æœªåˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡ã€‚ç¬¬ä¸‰çº§ç¼“å­˜ï¼šä¿å­˜åˆ›å»ºæ—©æœŸbeançš„å·¥å‚ObjectFactoryï¼ŒgetObject()åˆ›å»ºä¸€ä¸ªå¯¹è¯¥beançš„æ—©æœŸå¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨å¯ä»¥è¢«äºŒçº§ç¼“å­˜ä½¿ç”¨ï¼Œç¡®ä¿beanå¯ä»¥æŒ‰éœ€è¦çš„ä»£ç†å’Œå¢å¼ºåˆ›å»ºå‡ºæ¥ã€‚åŸç†ï¼šå®ä¾‹åŒ–å’Œåˆå§‹åŒ–æµç¨‹åˆ†å¼€ï¼Œåœ¨Beanå®Œå…¨åˆå§‹åŒ–ä¹‹å‰ï¼Œå¯ä»¥æš´éœ²ä¸€ä¸ªæ—©æœŸçš„beanå¼•ç”¨ï¼Œä»è€Œæ‰“ç ´å¾ªç¯ä¾èµ–ã€‚</p>
</li>
<li><p>äºŒçº§ç¼“å­˜è¡Œä¸è¡Œï¼šå½“æ¶‰åŠAOPæˆ–å…¶ä»–ä»£ç†å¢å¼ºæ—¶ï¼Œä»…å‡­äºŒçº§ç¼“å­˜ä¸å¤Ÿï¼Œå› ä¸ºè¦åœ¨è¿”å›ä»£ç†å¯¹è±¡å‰ç¡®ä¿æ‰§è¡Œæ‰€æœ‰å¢å¼ºçš„é€»è¾‘ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªbeanéœ€è¦è¢«ä»£ç†ï¼Œå®ƒé¦–å…ˆåº”è¯¥é€šè¿‡ä¸‰çº§ç¼“å­˜çš„ObjectFactoryè¢«åˆ›å»ºï¼Œè¯¥å·¥å‚è´Ÿè´£å¤„ç†æ‰€æœ‰çš„ä»£ç†ç›¸å…³é€»è¾‘ã€‚ä¸€æ—¦ç»è¿‡è¿™ä¸ªæ­¥éª¤å¾—åˆ°çš„beanè¢«æ”¾å…¥äºŒçº§ç¼“å­˜ä¸­ï¼Œå®ƒå°±å¯ä»¥è¢«å…¶ä»–beanä½¿ç”¨äº†ã€‚</p>
</li>
<li><p>springè§£å†³å¾ªç¯ä¾èµ–çš„å…·ä½“æµç¨‹ï¼š1.å•ä¾‹beané¦–å…ˆæ£€æŸ¥ä¸€çº§ç¼“å­˜ï¼Œå­˜åœ¨åˆ™ç›´æ¥è¿”å›ã€‚2.ä¸å­˜åœ¨åˆ™å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿˜æœªå±æ€§æ³¨å…¥å’Œåˆå§‹åŒ–ã€‚3.åˆ›å»ºå¥½beanå®ä¾‹åï¼Œå°†ObjectFactoryæ”¾å…¥ä¸‰çº§ç¼“å­˜ã€‚4.å±æ€§æ³¨å…¥ï¼Œè¯·æ±‚åˆ›å»ºä¾èµ–çš„beanï¼Œå¦‚æœæœ‰å¾ªç¯ä¾èµ–ï¼Œé€šè¿‡ä¸‰çº§ç¼“å­˜åˆ›å»ºä¸€ä¸ªæ—©æœŸçš„beanå¼•ç”¨ï¼Œå¹¶æ”¾åˆ°äºŒçº§ç¼“å­˜ï¼ŒåŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ã€‚5.å®Œæˆæ³¨å…¥åŠåˆå§‹åŒ–ï¼Œbeanåˆ›å»ºæˆåŠŸã€‚6.beanæ”¾å…¥ä¸€çº§ç¼“å­˜ï¼Œå¹¶ä»äºŒçº§å’Œä¸‰çº§ç¼“å­˜ä¸­ç§»é™¤ã€‚</p>
</li>
<li><p>spring beanï¼šæ ¹æ®ä½œç”¨åŸŸï¼ŒSingletonï¼šé»˜è®¤çš„ä½œç”¨åŸŸï¼Œæ•´ä¸ªå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œé€‚ç”¨äºé…ç½®ç±»ã€å·¥å…·ç±»ã€æœåŠ¡ç±»ã€‚Prototypeï¼šåŸå‹beanï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚springå®¹å™¨ä»…è´Ÿè´£å®ä¾‹åŒ–ï¼Œä¸ç®¡ç”Ÿå‘½å‘¨æœŸã€‚Requestï¼šæ¯ä¸ªHTTPè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªBeanï¼Œä»…é€‚ç”¨äºwebåº”ç”¨ã€‚Sessionï¼šæ¯ä¸ªHTTP Sessionéƒ½ä¼šåˆ›å»ºä¸€ä¸ªBeanï¼Œä»…é€‚ç”¨äºwebåº”ç”¨ã€‚</p>
</li>
<li><p>@PostConstructï¼šJava EE 5å¼•å…¥çš„æ³¨è§£ï¼Œåœ¨Beançš„å®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥å®Œæˆåè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ç”¨æ¥æ‰§è¡Œå¿…è¦çš„åˆå§‹åŒ–ä»£ç ï¼Œä¾‹å¦‚èµ„æºåˆ†é…ï¼ŒåŠ è½½æ•°æ®ã€‚é€šè¿‡å®¹å™¨æ¥æ§åˆ¶åˆå§‹åŒ–ã€‚ä¿®é¥°æ— å‚æ•°æ— è¿”å›å€¼æ–¹æ³•ï¼Œæ¯ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªè¯¥æ–¹æ³•ã€‚InitializingBeanæ¥å£çš„afterPropertiesSetå’Œé…ç½®beanæ—¶çš„init-methodä¹Ÿæœ‰ç±»ä¼¼åŠŸèƒ½ã€‚@PostConstructå…ˆäºä»–ä¿©ã€‚</p>
</li>
<li><p>InitializingBeanï¼šæ¥å£ï¼Œå®šä¹‰äº†afterPropertiesSetæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨beançš„æ‰€æœ‰å±æ€§éƒ½è®¾ç½®å¥½ä¹‹åæ‰§è¡Œï¼Œç”¨äºåœ¨ä¾èµ–æ³¨å…¥åæ‰§è¡ŒæŸäº›åˆå§‹åŒ–æ“ä½œã€‚</p>
</li>
<li><p>ApplicationContextAwareï¼šç”¨äºæ–¹ä¾¿è·å–ApplicationContextï¼Œspringä¼šè‡ªåŠ¨è°ƒç”¨setApplicationContext(ApplicationContext applicationContext)æ–¹æ³•ï¼Œå¯å°†ApplicationContextå®ä¾‹æ³¨å…¥åˆ°beanä¸­ï¼Œç”¨äºè·å–å…¶ä»–beanã€è®¿é—®èµ„æºæ–‡ä»¶ã€å‘å¸ƒäº‹ä»¶ã€‚</p>
</li>
<li><p>springäº‹åŠ¡çš„å®ç°åŸç†ï¼šä¸¤ç§äº‹åŠ¡çš„å®ç°æ–¹å¼ï¼šç¼–ç¨‹å¼ï¼ˆé€šè¿‡ä»£ç æ§åˆ¶äº‹åŠ¡å¤„ç†é€»è¾‘ï¼‰ã€å£°æ˜å¼ï¼ˆ@Transactionalæ³¨è§£å®ç°ï¼‰ã€‚äº‹åŠ¡çš„æ“ä½œæœ¬ç”±æ•°æ®åº“è‡ªåŠ¨æ§åˆ¶ï¼Œä¸ºæ–¹ä¾¿ä¸šåŠ¡é€»è¾‘æ“ä½œï¼Œç”±springæ¡†æ¶æ§åˆ¶ã€‚springäº‹åŠ¡çš„å®ç°åŸç†æ˜¯é€šè¿‡AOPå®ç°ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œä»£ç†ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åç»‡å…¥äº‹åŠ¡ç®¡ç†çš„ç›¸å…³æ“ä½œï¼šäº‹åŠ¡å¼€å§‹ï¼Œå…ˆæŠŠäº‹åŠ¡çš„è‡ªåŠ¨æäº¤ç»™å…³é—­ã€æäº¤äº‹åŠ¡ã€å¼‚å¸¸å›æ»šã€‚å¯ä»¥è®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€è¶…æ—¶è®¾ç½®ã€‚æ€»ä¹‹ï¼ŒSpring AOP æä¾›äº†å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„åŸºç¡€ï¼Œä½¿å¾—äº‹åŠ¡ç®¡ç†é€»è¾‘èƒ½å¤Ÿä»¥åˆ‡é¢çš„å½¢å¼ï¼Œç»‡å…¥åˆ°ä¸šåŠ¡é€»è¾‘ä¸­ã€‚</p>
</li>
<li><p>aæ–¹æ³•åŠ äº†@Transactionalï¼Œbæ–¹æ³•æ²¡åŠ ï¼Œbå†…éƒ¨è°ƒç”¨aï¼Œä¼šæœ‰äº‹åŠ¡äº§ç”Ÿå—ï¼š@Transactionalå£°æ˜å¼äº‹åŠ¡ï¼Œäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºå†³å®šäº‹åŠ¡å¦‚ä½•ä¼ æ’­å’Œè¾¹ç•Œæ‰€åœ¨ã€‚ç”±äºspringçš„äº‹åŠ¡ç®¡ç†æ˜¯åŸºäºAOPï¼Œé€šè¿‡ä»£ç†å®ç°çš„ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§ï¼Œå¦‚æœæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œè‡ªè°ƒç”¨ï¼Œaæ–¹æ³•çš„è°ƒç”¨ä¸ä¼šé€šè¿‡springç”Ÿæˆçš„ä»£ç†å¯¹è±¡è°ƒç”¨ï¼Œä¸ä¼šå¼€å§‹æ–°çš„äº‹åŠ¡ã€‚ç¬¬äºŒç§ï¼Œåœ¨ä¸åŒçš„ç±»ä¸­ï¼Œaæ–¹æ³•é€šè¿‡springçš„ä»£ç†å¯¹è±¡è°ƒç”¨ï¼Œå¼€å§‹ä¸€ä¸ªæ–°äº‹åŠ¡ã€‚</p>
</li>
</ul>
<h2 id="springboot"><a href="#springboot" class="headerlink" title="springboot"></a>springboot</h2><ul>
<li>ä»€ä¹ˆæ˜¯springbootï¼šåŸºäºspringçš„å¼€æºæ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿåˆ›å»ºç‹¬ç«‹çš„ç”Ÿäº§çº§åˆ«çš„å¯è¿è¡Œçš„Springåº”ç”¨ç¨‹åºã€‚ä¸æ˜¯SpringåŠŸèƒ½ä¸Šçš„å¢å¼ºï¼Œè€Œæ˜¯æä¾›ä¸€ç§å¿«é€Ÿå¼€å‘Springé¡¹ç›®çš„æ–¹å¼ã€‚springé—®é¢˜ï¼šå†™é…ç½®æ–‡ä»¶ç¹çï¼Œä¾èµ–ç¹çï¼Œmavenåæ ‡ç‰ˆæœ¬é—®é¢˜ã€‚springbootæä¾›çš„ä¼˜ç‚¹ï¼šè‡ªåŠ¨é…ç½®ã€èµ·æ­¥ä¾èµ–ã€å®‰å…¨ã€‚çº¦å®šä¼˜äºé…ç½®çš„ç†å¿µï¼Œå¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨é…ç½®å¤§é‡springé…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯è‡ªåŠ¨é…ç½®ã€‚æä¾›ä¸€ç³»åˆ—çš„èµ·æ­¥ä¾èµ–starterï¼Œå¿«é€Ÿæ„å»ºå‡ºä¸€äº›å¸¸ç”¨çš„åº”ç”¨ç¨‹åºï¼Œæ•´åˆJunitã€redisã€mybatisç­‰å¾ˆæ–¹ä¾¿ã€‚å¸®åŠ©ç®¡ç†jaråŒ…ç‰ˆæœ¬ï¼Œé¿å…ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li>
<li>Springã€Spring MVCå’ŒSpringBootåŒºåˆ«ï¼šSpringæ˜¯Javaå¼€å‘æ¡†æ¶ï¼Œç”¨äºåˆ›å»ºä¼ä¸šçº§çš„javaåº”ç”¨ç¨‹åºï¼Œæä¾›IOCå’ŒAOPç­‰åŠŸèƒ½ã€‚Spring MVCæ˜¯Springæ¡†æ¶çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºåˆ›å»ºWebåº”ç”¨ç¨‹åºï¼Œä½¿ç”¨æ§åˆ¶å™¨ã€è§†å›¾å’Œæ¨¡å‹æ¥å®ç°MVCè®¾è®¡æ¨¡å¼ã€‚Spring Bootæ˜¯ä¸€ä¸ªåŸºäºSpringæ¡†æ¶çš„å¿«é€Ÿå¼€å‘å·¥å…·ï¼Œä½¿ç”¨è‡ªåŠ¨é…ç½®å¿«é€Ÿåˆ›å»ºSpringåº”ç”¨ç¨‹åºã€‚æ€»ç»“ï¼šSpringæ˜¯åŸºç¡€æ¡†æ¶ï¼ŒSpring MVCæ˜¯åŸºäºSpringçš„Webæ¡†æ¶ï¼Œè€ŒSpring Bootåˆ™æ˜¯åŸºäºSpringçš„å¿«é€Ÿå¼€å‘æ¡†æ¶ã€‚Spring Bootå†…åµŒäº†Tomcatã€Jettyç­‰Webå®¹å™¨ï¼Œå¯ä»¥ç›´æ¥è¿è¡ŒWebåº”ç”¨ç¨‹åºï¼Œè€ŒSpring MVCéœ€è¦éƒ¨ç½²åˆ°Webå®¹å™¨ä¸­æ‰èƒ½è¿è¡Œã€‚</li>
<li>springbootè‡ªåŠ¨é…ç½®çš„åŸç†ï¼šåŸºäºSpringçš„æ¡ä»¶åŒ–é…ç½®åŠŸèƒ½å®ç°ï¼ŒConditionæ¥å£å’Œ@Conditionalæ³¨è§£ã€‚ä»¥åŠspringbootçš„ä¸€ç³»åˆ—è‡ªåŠ¨é…ç½®ç±»ï¼ŒSpring Bootåº”ç”¨çš„å…¥å£ç±»ä¼šä½¿ç”¨@SpringBootApplicationæ³¨è§£ï¼Œå®ƒåŒ…å«@SpringBootConfigurationï¼Œ@EnableAutoConfigurationå’Œ@ComponentScanæ³¨è§£ï¼Œ@EnableAutoConfigurationæ˜¯è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒã€‚@EnableAutoConfigurationåˆ©ç”¨Springçš„@Importæ³¨è§£æ¥åŠ è½½é…ç½®ç±»ï¼ŒMETA-INF&#x2F;spring.factoriesé…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†å¤§é‡çš„é…ç½®ç±»ï¼Œspringbootåº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åŠ è½½è¿™äº›é…ç½®ç±»ã€‚å¹¶ä¸”åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨Conditionæ¥åŠ è½½æ»¡è¶³æ¡ä»¶çš„beanï¼Œå¦‚DataSourceã€JdbcTemplateç­‰ã€‚ï¼ˆæ€»ç»“ï¼š1.æ¡ä»¶æ³¨è§£ 2.@EnableAutoConfigurationï¼‰</li>
<li>springbootæ ¸å¿ƒæ³¨è§£ï¼š@SpringBootApplicationï¼šå¤åˆæ³¨è§£ï¼Œæ ‡è¯†springbootåº”ç”¨çš„ä¸»ç±»ã€‚@Configurationè¡¨æ˜è¯¥ç±»æ˜¯javaé…ç½®ç±»ã€‚@ EnableAutoConfigurationå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ã€‚@ComponentScanç”¨äºè‡ªåŠ¨æ‰«æå’Œæ³¨å†Œbeanã€‚</li>
<li>spring boot starterï¼šæ˜¯é¢„é…ç½®çš„ä¾èµ–ç®¡ç†å™¨ï¼Œå°†ä¸€ç»„åº“&#x2F;ä¾èµ–æ†ç»‘åœ¨ä¸€èµ·ï¼Œä¾¿äºå¼€å‘ç‰¹å®šç±»å‹çš„åº”ç”¨ç¨‹åºã€‚ç®€åŒ–ä¾èµ–ç®¡ç†ï¼Œæä¾›å¼€ç®±å³ç”¨çš„é…ç½®ï¼Œæ˜¯çº¦å®šä¼˜äºé…ç½®çš„åº”ç”¨ï¼Œé›†æˆå¸¸ç”¨æŠ€æœ¯å’Œåº“ã€‚spring-boot-starter-webï¼šå¼€å‘Webåº”ç”¨ï¼ŒåŒ…å«Spring MVCã€Tomcatå®¹å™¨ç­‰ã€‚spring-boot-starter-data-jpaï¼šä½¿ç”¨JPAçš„Starterï¼ŒåŒ…å«Hibernateã€Spring Data JPAã€Spring ORMç­‰ä¾èµ–ã€‚spring-boot-starter-data-redisï¼šä½¿ç”¨Redisçš„Starterï¼ŒåŒ…å«Jediså®¢æˆ·ç«¯å’ŒSpring Data Redisç­‰ä¾èµ–ã€‚spring-boot-starter-testï¼šé€‚ç”¨äºæµ‹è¯•çš„Starterï¼ŒåŒ…å«JUnitã€Mockitoã€Spring Testç­‰ä¾èµ–ã€‚spring-boot-starter-actuatorï¼šç›‘è§†å™¨ï¼Œé€‚ç”¨äºç›‘æ§å’Œç®¡ç†Spring Bootåº”ç”¨ç¨‹åºçš„Starterï¼ŒåŒ…å«Spring Boot Actuatorç­‰ä¾èµ–ã€‚</li>
<li>spring-boot-starter-parentï¼šspringbootå®˜æ–¹æä¾›çš„ä¸€ä¸ªMavençˆ¶å·¥ç¨‹ï¼Œæ˜¯springbooté¡¹ç›®çš„çˆ¶å·¥ç¨‹ï¼Œparentå…ƒç´ è®¾ç½®ä¸ºå®ƒï¼Œç»§æ‰¿ä¸€äº›å¸¸ç”¨ä¾èµ–å’Œæ’ä»¶ï¼Œå‡å°‘æ‰‹åŠ¨é…ç½®ã€‚ç»Ÿä¸€ç®¡ç†springbootä¸­çš„å¸¸ç”¨ä¾èµ–ç‰ˆæœ¬å·ï¼Œç¡®ä¿ç‰ˆæœ¬å…¼å®¹æ€§ã€‚</li>
<li>å¦‚ä½•è‡ªå®šä¹‰spring boot starterï¼šåœ¨é¡¹ç›®çš„src&#x2F;main&#x2F;resourcesç›®å½•ä¸‹åˆ›å»ºMETA-INF&#x2F;spring.factoriesæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼šorg.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;com.example.my_starter.MyAutoConfigurationï¼Œå‘Šè¯‰springbootå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½é…ç½®ç±»ã€‚åˆ›å»ºMyAutoConfigurationé…ç½®ç±»ï¼Œå¹¶åœ¨ç±»ä¸ŠåŠ ä¸Š@Configurationæ³¨è§£ï¼Œåœ¨å…¶ä¸­å®šä¹‰éœ€è¦è‡ªåŠ¨é…ç½®çš„Beanã€‚ç„¶åæ‰“åŒ…ä¸Šä¼ Mavenä»“åº“ã€‚</li>
<li>spring-boot-maven-pluginï¼šç”¨äºå°†SpringBootåº”ç”¨ï¼Œä»¥åŠä¾èµ–é¡¹å’Œé…ç½®æ–‡ä»¶æ‰“åŒ…æˆå¯æ‰§è¡Œçš„JaråŒ…æˆ–WaråŒ…ï¼ŒåŒ…å«åµŒå…¥å¼çš„Tomcatå®¹å™¨æˆ–Jettyå®¹å™¨ã€‚æ–¹ä¾¿éƒ¨ç½²å’Œè¿è¡Œã€‚</li>
<li>springbootæ‰“æˆçš„jaråŒ…å’Œæ™®é€šjaråŒ…åŒºåˆ«ï¼š1âƒ£ï¸springbootçš„jaråŒ…æ˜¯å¯æ‰§è¡Œçš„jaråŒ…ï¼ŒåŒ…å«äº†å†…åµŒçš„Tomcatã€Jettyç­‰WebæœåŠ¡å™¨ï¼Œå¯ç›´æ¥è¿è¡Œã€‚æ™®é€šjaråŒ…çº¸åŒ…å«ç±»ã€èµ„æºç­‰ï¼Œéœ€è¦åœ¨å¤–éƒ¨ç¯å¢ƒä¸­æ‰‹åŠ¨é…ç½®WebæœåŠ¡å™¨è¿è¡Œã€‚2âƒ£ï¸springbootæ‰“çš„jaråŒ…ä¸­åŒ…å«äº†å¯åŠ¨ç±»çš„mainæ–¹æ³•ï¼Œå¯ç›´æ¥è¿è¡Œã€‚æ™®é€šjaråŒ…éœ€è¦æŒ‡å®šå¯åŠ¨ç±»ã€‚3âƒ£ï¸springbootçš„jaråŒ…ä¸­åŒ…å«ä¸€äº›é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚application.propertiesï¼Œç”¨äºé…ç½®å±æ€§ã€æ•°æ®æºç­‰ã€‚æ™®é€šjaråŒ…ä¸åŒ…å«ã€‚</li>
<li>springbootå®ç°çƒ­éƒ¨ç½²ï¼šä½¿ç”¨Spring DevToolså·¥å…·ï¼Œæ”¯æŒåº”ç”¨ç¨‹åºä»£ç ä¿®æ”¹åè‡ªåŠ¨é‡æ–°åŠ è½½åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å’ŒæœåŠ¡å™¨ã€‚spring loadedä¹Ÿè¡Œï¼Œé¿å…åå¤æ„å»ºå’Œéƒ¨ç½²ã€‚</li>
<li>springbootå¯ä»¥å…¼å®¹è€springé¡¹ç›®å—ï¼šå¯ä»¥ä½¿ç”¨@ImportResourceæ³¨è§£æ¥åŠ è½½è€çš„xmlé…ç½®æ–‡ä»¶ï¼Œç”¨äº@Configurationæˆ–@SpringBootApplicationç±»ä¸Šã€‚</li>
</ul>
]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜ä¹‹redis&amp;mysql</title>
    <url>/2025/07/24/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E8%83%8C%E8%BF%87%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8Bredismysql/</url>
    <content><![CDATA[<h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><ul>
<li><p>redisåˆ†å¸ƒå¼é”åŸç†ï¼š1âƒ£ï¸setnxé”®ä¸å­˜åœ¨æ—¶è®¾ç½®ï¼Œexpireè¿‡æœŸæ—¶é—´é¿å…æ­»é”ã€‚2âƒ£ï¸çœ‹é—¨ç‹—æœºåˆ¶ï¼Œå¦‚æœå®¢æˆ·ç«¯ä»åœ¨è¿è¡Œï¼Œè‡ªåŠ¨ç»­ç§Ÿé”ã€‚3âƒ£ï¸è‡ªæ—‹ï¼Œå°è¯•è‡ªæ—‹å›ºå®šæ—¶é—´ã€‚å›ºå®šæ¬¡æ•°ã€‚4âƒ£ï¸luaè„šæœ¬ç”¨äºæ‰§è¡Œå¤æ‚æ“ä½œï¼Œå¹¶ä¿è¯åŸå­æ€§ã€‚5âƒ£ï¸redisåˆ†å¸ƒå¼é”ä¸å®Œå…¨å¯é ï¼Œä¸»ä»å¤åˆ¶ï¼Œä¸»èŠ‚ç‚¹åŒæ­¥åˆ°ä»èŠ‚ç‚¹ä¹‹å‰å´©æºƒï¼Œä»èŠ‚ç‚¹å‡çº§ï¼Œåˆè·å–åˆ°é”ã€‚</p>
</li>
<li><p>redisé›†ç¾¤ï¼š1âƒ£ï¸è‡ªåŠ¨åˆ†ç‰‡ï¼šæ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤šä¸ªå“ˆå¸Œæ§½ã€‚2âƒ£ï¸æ— ä¸­å¿ƒæ¶æ„ï¼šèŠ‚ç‚¹å¯¹ç­‰ï¼Œæ— ä¸­å¿ƒèŠ‚ç‚¹ã€‚3âƒ£ï¸ä¸»ä»å¤åˆ¶ï¼šä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹ï¼Œå®ç°æ•…éšœæ¢å¤ã€æ•°æ®å†—ä½™ã€è¯»å†™åˆ†ç¦»ã€‚</p>
</li>
<li><p>redisä¸¤ç§åŒæ­¥ç­–ç•¥ï¼šå…¨é‡RDBæ–‡ä»¶ã€å¢é‡åŒæ­¥AOF</p>
</li>
<li><p>redisæŒä¹…åŒ–ï¼šredisæ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼ŒæŒä¹…åŒ–æœºåˆ¶å°†æ•°æ®å­˜å‚¨åˆ°ç£ç›˜æ–‡ä»¶ã€‚RDBå¿«ç…§æ˜¯æŸä¸ªæ—¶é—´ç‚¹æ•°æ®çš„äºŒè¿›åˆ¶å…¨é‡å¤‡ä»½ã€‚AOFæ—¥å¿—æ˜¯ä¿®æ”¹å†…å­˜æ•°æ®çš„æŒ‡ä»¤è®°å½•ã€‚</p>
</li>
<li><p>redisçš„RDBï¼šredisæ˜¯å•çº¿ç¨‹çš„ï¼Œä¸ºäº†ä¸é˜»å¡è¯·æ±‚å“åº”ï¼Œforkå­çº¿ç¨‹è¿›è¡Œå¿«ç…§æŒä¹…åŒ–ï¼ŒæŒä¹…åŒ–æœŸé—´ï¼Œä¸¤çº¿ç¨‹å…±äº«ä¸€ä»½å®ä½“èµ„æºï¼Œåªæœ‰åœ¨å†™æ“ä½œå‘ç”Ÿæ—¶ï¼Œå…±äº«çš„å†…å­˜é¡µä¼šè¢«å¤åˆ¶ï¼Œå‰¯æœ¬ä¾›å†™æ“ä½œä½¿ç”¨ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰ï¼Œæœ€å°åŒ–å¯¹ä¸»è¿›ç¨‹å½±å“ã€‚</p>
</li>
<li><p>redisçš„AOFï¼šä½¿ç”¨fsyncå‘½ä»¤å°†æŒ‡ä»¤è®°å½•å­˜å…¥AOFæ–‡ä»¶ï¼Œæ¯1sæ‰§è¡Œä¸€æ¬¡</p>
</li>
<li><p>redisé‡å¯ä½¿ç”¨å“ªç§æŒä¹…åŒ–ï¼šéƒ½å¼€å¯çš„è¯ä½¿ç”¨AOFæŒä¹…åŒ–ï¼Œå› ä¸ºåŒ…å«æ›´å®Œæ•´çš„æ“ä½œå†å²è®°å½•ã€‚</p>
</li>
<li><p>rediså“¨å…µæœºåˆ¶ï¼šä¿è¯é«˜å¯ç”¨ï¼Œå®ç°é›†ç¾¤ç›‘æ§æ•…éšœè½¬ç§»ã€‚å¤šä¸ªsentinelèŠ‚ç‚¹ã€‚1âƒ£ï¸ç›‘æ§ï¼šsentialèŠ‚ç‚¹ä¸å…¶ä»–master&#x2F;slave&#x2F;sentinelèŠ‚ç‚¹å‘é€PINGåšå¿ƒè·³æ£€æµ‹ï¼Œäº¤æ¢ä¿¡æ¯ç›‘æ§ä¸»ä»æ‹“æ‰‘ã€‚2âƒ£ï¸ä¸»è§‚å®¢è§‚ä¸‹çº¿ï¼šä¸»è§‚ä¸€å°è®¤ä¸ºï¼Œå®¢è§‚å¤§å¤šæ•°è®¤ä¸ºã€‚3âƒ£ï¸å“¨å…µé€‰ä¸¾ï¼šsentinelé€‰å‡ºä¸€ä¸ªleaderåšæ•…éšœè½¬ç§»ï¼Œraftç®—æ³•ï¼Œ1.èŠ‚ç‚¹è®¤ä¸ºä¸»ç®¡ä¸‹çº¿å°±ç”³è¯·æˆä¸ºleaderï¼Œ2.å…¶ä»–èŠ‚ç‚¹æ²¡æœ‰ç­”åº”åˆ«äººå°±ç­”åº”ä»–ï¼Œ3.ç¥¨æ•°è¾¾æ ‡å°±æˆä¸ºleaderã€‚4âƒ£ï¸æ•…éšœè½¬ç§»ï¼šæ ¹æ®ä»èŠ‚ç‚¹ä¼˜å…ˆçº§é€‰æ‹©æ–°çš„masterèŠ‚ç‚¹ï¼Œsentinel leaderå‘å…¶ä»–èŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œå¹¶å…³æ³¨åŸmasterã€‚</p>
</li>
<li><p>redisåŒå†™ä¸€è‡´æ€§ï¼šæ›´æ–°æ“ä½œåŒæ—¶å†™å…¥æ•°æ®åº“å’Œç¼“å­˜ï¼Œå› ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç½‘ç»œå»¶è¿Ÿã€ç³»ç»Ÿæ•…éšœç­‰åŸå› ï¼Œå¯¼è‡´ä¸¤è€…æ•°æ®ä¸ä¸€è‡´ï¼Œè§£å†³ï¼š1.å…ˆå†™æ•°æ®åº“å†åˆ ç¼“å­˜ï¼šé«˜å¹¶å‘å¯èƒ½ä¼šå¤šæ¬¡ç¼“å­˜ç©¿é€ï¼Œå¢åŠ æ•°æ®åº“å‹åŠ›ã€‚2.å…ˆå†™æ•°æ®åº“å†æ›´æ–°ç¼“å­˜ï¼šä¸ä¼šç¼“å­˜ç©¿é€ï¼Œä½†æ˜¯æ›´æ–°ç¼“å­˜æ“ä½œéœ€è¦å¹¶å‘æ§åˆ¶é˜²æ­¢ç«äº‰ã€‚æ›´é«˜çº§ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¿éšœé¡ºåºã€åˆ†å¸ƒå¼é”ã€‚</p>
</li>
<li><p>rediså»¶æ—¶åŒåˆ ï¼šåœ¨åˆ é™¤æ•°æ®æ—¶ï¼Œé˜²æ­¢åˆ é™¤ä¸èƒ½å®Œå…¨åŒæ­¥ï¼Œé¦–å…ˆåˆ é™¤æ•°æ®åº“è®°å½•ï¼Œå†ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜è®°å½•ï¼Œå»¶æ—¶çŸ­æš‚æ—¶é—´åï¼Œå†åˆ ä¸€æ¬¡ç¼“å­˜ã€‚é¿å…ç¼“å­˜ç½‘ç»œæŠ–åŠ¨æœªåˆ é™¤ã€‚å¦‚æœä¹‹é—´åˆå†™å…¥ï¼Œç¼“å­˜ç©¿é€ä¸€æ¬¡è¯»åˆ°æ•°æ®åº“ã€‚</p>
</li>
<li><p>redisç¼“å­˜å‡»ç©¿ï¼šå•ä¸ªkeyè®¿é—®å¹¶å‘è¿‡é«˜ï¼Œè¿‡æœŸæ—¶è¯·æ±‚ç›´æ¥æ‰“åœ¨DBä¸Šï¼Œæ•°æ®åº“å‹åŠ›å¤§ã€‚è§£å†³ï¼šåŠ é”ï¼Œç¼“å­˜æ²¡æœ‰å°±å¯¹keyåŠ é”æŸ¥åº“åæ›´æ–°ç¼“å­˜ã€å°†è¿‡æœŸæ—¶é—´ä¹Ÿå†™åœ¨valueä¸­ï¼Œå¼‚æ­¥åˆ·æ–°è¿‡æœŸæ—¶é—´ã€æ¥å£é™æµé™çº§ç†”æ–­ã€‚</p>
</li>
<li><p>redisç¼“å­˜ç©¿é€ï¼šæŸ¥è¯¢åœ¨ç¼“å­˜å’ŒDBä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œéƒ½æ‰“åˆ°DBï¼Œå°±åƒç¼“å­˜ä¸å­˜åœ¨ã€‚è§£å†³ï¼šåœ¨è¯·æ±‚ç¼“å­˜å‰åŠ å¸ƒéš†è¿‡æ»¤å™¨ï¼Œç­›æ‰ä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ã€‚</p>
</li>
<li><p>redisç¼“å­˜é›ªå´©ï¼šå¤§æ‰¹é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼Œå¤§é‡è¯·æ±‚ç›´æ¥æ‰“åˆ°DBã€‚è§£å†³ï¼šç¼“å­˜æ•°æ®è¿‡æœŸæ—¶é—´è®¾ç½®éšæœºï¼Œçƒ­ç‚¹æ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨ä¸åŒç¼“å­˜æ•°æ®åº“ã€‚</p>
</li>
<li><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼šå¿«è¯»åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ï¼Œå¯èƒ½è¯¯åˆ¤ä¸ä¼šæ¼åˆ¤ã€‚å®ç°ï¼šé•¿åº¦mçš„ä½æ•°ç»„ã€kä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°kä¸ªä½ç½®ï¼Œå°†å¯¹åº”ä½ç½®ä¸º1ã€‚æŸ¥æ‰¾æ—¶çœ‹æ˜¯ä¸æ˜¯æ‰€æœ‰å“ˆå¸Œå‡½æ•°å¾—åˆ°çš„ä½éƒ½æ˜¯1.</p>
</li>
<li><p>RDBMSå’ŒNoSQLï¼šå…³ç³»å‹æ•°æ®åº“ï¼ˆç»„ç»‡åŒ–ç»“æ„ï¼Œè¡Œåˆ—æ ¼å¼ï¼‰ã€Not only sqlï¼ˆæ•°æ®å­˜å‚¨æ²¡æœ‰å›ºå®šæ ¼å¼ï¼Œå¯æ¨ªå‘æ‰©å±•ï¼‰ã€‚RDBMSï¼šå›ºå®šæŸ¥è¯¢è¯­è¨€ã€äº‹åŠ¡ä¸€è‡´æ€§ACIDã€‚NoSQLï¼šæ— å›ºå®šæŸ¥è¯¢è¯­è¨€ã€é”®å€¼redisã€åˆ—å­˜å‚¨HBaseã€æ–‡æ¡£MongoDBã€å›¾å½¢å­˜å‚¨Neo4jã€æœ€ç»ˆä¸€è‡´æ€§BASEã€‚</p>
</li>
<li><p>redisï¼šè¿œç¨‹å­—å…¸æœåŠ¡ï¼Œé”®å€¼å¯¹ï¼Œæ•°æ®ç¼“å­˜åœ¨å†…å­˜ï¼Œå‘¨æœŸæ€§æŒä¹…åŒ–åˆ°ç£ç›˜ã€ä¸»ä»åŒæ­¥ã€å“¨å…µæœºåˆ¶é«˜å¯ç”¨ã€‚åº”ç”¨ï¼šé«˜é€Ÿç¼“å­˜ã€è®¡æ•°å™¨ã€‚</p>
</li>
<li><p>redisæ•°æ®ç»“æ„ï¼š1âƒ£ï¸Stringï¼šæœ€å¤§512Mï¼Œå®ç°ï¼šæœªä½¿ç”¨Cè¯­è¨€å­—ç¬¦ä¸²ï¼Œè‡ªå·±å®ç°ç®€å•åŠ¨æ€å­—ç¬¦ä¸²SDSï¼Œå¸¦é•¿åº¦ä¿¡æ¯ï¼Œembstrç¼–ç å’Œrawç¼–ç ï¼Œå­—ç¬¦ä¸²ä¿®æ”¹æ—¶æ£€æŸ¥å­—ç¬¦ä¸²é•¿åº¦é¿å…ç¼“å†²åŒºæº¢å‡ºï¼Œå‡å°‘å†…å­˜é‡æ–°åˆ†é…æ¬¡æ•°ã€‚2âƒ£ï¸åˆ—è¡¨Listï¼šåŒå‘é“¾è¡¨å‹æ•°æ®ç»“æ„ï¼Œå¯ä¸¤ç«¯æ’å…¥å¼¹å‡ºï¼Œå¯æŒ‡å®šä¸‹æ ‡&#x2F;èŒƒå›´è·å–ã€‚å®ç°æ¶ˆæ¯é˜Ÿåˆ—ã€åˆ†é¡µã€‚å®ç°ï¼šquikListï¼Œå¤–å±‚æ˜¯åŒå‘é“¾è¡¨linkedListï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯zipListå‹ç¼©åˆ—è¡¨ï¼Œå°†å¤šä¸ªå…ƒç´ åºåˆ—åŒ–å­˜å‚¨åœ¨ä¸€å—è¿ç»­å†…å­˜ä¸­ã€‚3âƒ£ï¸Seté›†åˆï¼šä¸å…è®¸é‡å¤ï¼Œæ²¡æœ‰é¡ºåºï¼Œæ”¯æŒå¤šé›†åˆé—´å¹¶é›†äº¤é›†å·®é›†æ“ä½œã€‚å®ç°ï¼šå¦‚æœå…ƒç´ éƒ½æ•´æ•°ä¸”æ•°é‡è¾ƒå°‘ï¼Œä½¿ç”¨intsetæ•´æ•°é›†åˆå‹ç¼©æ•°æ®ç»“æ„ã€‚å¦åˆ™ä½¿ç”¨hashTableã€‚4âƒ£ï¸zsetæœ‰åºé›†åˆï¼šç»™æ¯ä¸ªå…ƒç´ å¤šè®¾ç½®ä¸€ä¸ªåˆ†æ•°ï¼Œä½œä¸ºæ’åºçš„ä¾æ®ã€‚å®ç°ï¼šhashTableå­˜å‚¨å…ƒç´ åˆ°åˆ†æ•°çš„æ˜ å°„ï¼Œå¿«é€ŸæŸ¥è¯¢å’Œæ›´æ–°åˆ†æ•°ã€‚è·³è·ƒè¡¨skiplistç»´æŠ¤å…ƒç´ çš„æœ‰åºæ€§ï¼Œå¹¶æä¾›é«˜æ•ˆèŒƒå›´æŸ¥è¯¢ã€‚5âƒ£ï¸hashï¼šå­˜å‚¨key-valueè®°å½•ã€‚å®ç°ï¼šå½“å­—æ®µå’Œå€¼æ•°é‡ä¸å¤šæ—¶ï¼Œä½¿ç”¨å‹ç¼©åˆ—è¡¨zipListã€‚å¦åˆ™ä½¿ç”¨å“ˆå¸Œè¡¨hashtableï¼Œæ¯é¡¹éƒ½åŒ…å«æŒ‡å‘é”®çš„æŒ‡é’ˆå’ŒæŒ‡å‘å€¼çš„æŒ‡é’ˆã€‚</p>
</li>
<li><p>redisä¸ºä»€ä¹ˆå¿«ï¼š1.å®Œå…¨åŸºäºå†…å­˜ 2.å•çº¿ç¨‹æ— ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ 3.åŸºäºCè¯­è¨€ï¼Œä¼˜åŒ–è¿‡çš„æ•°æ®ç»“æ„ 4.åŸºäºéé˜»å¡çš„IOå¤šè·¯å¤ç”¨å’Œäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œä½¿ç”¨Seletorç›‘è§†æ‰€æœ‰æ³¨å†Œçš„é€šé“ï¼ŒIOäº‹ä»¶å‘ç”Ÿæ—¶è¿›è¡Œé€šçŸ¥ã€‚å•çº¿ç¨‹é«˜æ•ˆå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ã€‚</p>
</li>
<li><p>redis6.0æ”¹ç”¨å¤šçº¿ç¨‹ï¼šä¾ç„¶ä½¿ç”¨å•çº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œåªæ˜¯å¤šçº¿ç¨‹å¤„ç†æ•°æ®è¯»å†™å’Œåè®®è§£æã€‚redisæ€§èƒ½ç“¶é¢ˆåœ¨ç½‘ç»œIOè€ŒéCPUã€‚</p>
</li>
<li><p>redisçƒ­keyé—®é¢˜ï¼šæŸä¸ªkeyå¤§é‡å¹¶å‘æ‰“åˆ°ä¸€å°æœåŠ¡å™¨ï¼Œè¾¾åˆ°ç½‘å¡ä¸Šçº¿ï¼Œå®•æœºã€‚ç¼“å­˜é›ªå´©ã€‚è§£å†³ï¼šçƒ­keyæ‰“æ•£åœ¨ä¸åŒæœåŠ¡å™¨ã€‚æå‰åŠ è½½çƒ­keyåˆ°å†…å­˜ï¼Œå†…å­˜åšäºŒçº§ç¼“å­˜ã€‚</p>
</li>
<li><p>redisè®¾ç½®è¿‡æœŸæ—¶é—´ï¼šexpire key secondsï¼›set key value EX secondsï¼›åº•å±‚é‡‡ç”¨è¿‡æœŸå­—å…¸å­˜å‚¨é”®çš„è¿‡æœŸæ—¶é—´ã€‚</p>
</li>
<li><p>redisè¿‡æœŸç­–ç•¥ï¼š1âƒ£ï¸æƒ°æ€§åˆ é™¤ï¼šæŸ¥è¯¢keyæ—¶æ‰å¯¹è¿‡æœŸæ—¶é—´æ£€æµ‹ï¼Œå·²è¿‡æœŸåˆ é™¤ã€‚2âƒ£ï¸å®šæœŸåˆ é™¤ï¼šå®šæœŸæ‰§è¡Œè¿‡æœŸé”®çš„æ‰«æå’Œåˆ é™¤ï¼Œé¿å…æ¶ˆè€—è¿‡å¤šè®¡ç®—èµ„æºï¼Œä½¿ç”¨é‡‡æ ·çš„è¿‡ç¨‹éšæœºæŠ½å–ï¼Œå¦‚æœè¿‡æœŸçš„å¤šå°±å†æŠ½æ ·ã€‚3âƒ£ï¸éƒ½æ²¡åˆ é™¤çš„ï¼šç­‰rediså†…å­˜æ·˜æ±°æœºåˆ¶ã€‚</p>
</li>
<li><p>rediså†…å­˜æ·˜æ±°ï¼šLRUæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ï¼Œæ·˜æ±°æœ€é•¿æ—¶é—´æ²¡æœ‰è®¿é—®çš„ã€‚é“¾è¡¨&#x2F;å“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨ã€‚redisä¸­ä½¿ç”¨è¿‘ä¼¼çš„LRUï¼ŒéšæœºæŠ½å–ä¸€äº›é”®ï¼Œæ£€æŸ¥æœ€åè®¿é—®æ—¶é—´æˆ³ï¼Œæ·˜æ±°æœ€ä¹…æœªè®¿é—®çš„ã€‚</p>
</li>
<li><p>redisé«˜å¯ç”¨ï¼šä¸»ä»æ¶æ„ã€å“¨å…µã€æŒä¹…åŒ–</p>
</li>
<li><p>redisäº‹åŠ¡ï¼š1âƒ£ï¸äº‹åŠ¡æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆï¼Œæ•°æ®åº“äº‹åŠ¡é€šè¿‡ACIDä¿è¯ï¼Œundo logæ’¤é”€æ—¥å¿—ã€‚2âƒ£ï¸redisä¸­äº‹åŠ¡æœºåˆ¶ï¼šé€šè¿‡MULTIã€EXECã€WATCH å’Œ DISCARD å››ä¸ªå‘½ä»¤æä¾›ã€‚MULTIå¼€å¯äº‹åŠ¡ï¼Œè¾“å…¥å¤šä¸ªå‘½ä»¤ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œè€Œæ˜¯æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè°ƒç”¨EXECå‘½ä»¤æ‰ä¼šå°†é˜Ÿåˆ—ä¸­å‘½ä»¤åŸå­æ‰§è¡Œã€‚3âƒ£ï¸äº‹åŠ¡ç›‘æ§ï¼šWATCHå‘½ä»¤è®¾ç½®ç›‘æ§çš„é”®ï¼Œåœ¨äº‹åŠ¡æ“ä½œä¹‹å‰å°±ç›‘æ§ï¼Œå¦‚æœEXECä¹‹å‰é”®è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹ï¼Œåˆ™ä¸æ‰§è¡ŒDISCARDã€‚æ˜¯ä¸€ç§CASä¹è§‚é”çš„æœºåˆ¶ã€‚</p>
</li>
<li><p>redisæ“ä½œä¸€ä¸ªå‘½ä»¤æœ€è€—æ—¶çš„åœ°æ–¹ï¼šç½‘ç»œIOå»¶è¿Ÿï¼šå°½å¯èƒ½ä½¿ç”¨é•¿è¿æ¥æˆ–è¿æ¥æ± ã€‚æ•°æ®æŒä¹…åŒ–å»¶è¿Ÿï¼šåˆç†é…ç½®RDBå¿«ç…§å’ŒAOF Rewriteæ—¶æœºï¼ˆæ¯ç§’ï¼Ÿæ¯æ¡æŒ‡ä»¤ï¼Ÿï¼‰ï¼Œé¿å…é¢‘ç¹çš„forkå¸¦æ¥çš„å»¶è¿Ÿã€‚æ•°æ®æ·˜æ±°å¼•å‘çš„å»¶è¿Ÿï¼šé¿å…åŒä¸€æ—¶é—´å¤§é‡keyè¿‡æœŸã€‚</p>
</li>
</ul>
<h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><ul>
<li><p>RDBMSå’ŒNoSQLï¼šRDBMSå…³ç³»å‹æ•°æ®åº“ï¼ˆç»„ç»‡åŒ–ç»“æ„ï¼Œè¡¨æ ¼è¡Œåˆ—æ ¼å¼ï¼ŒMysqlã€Oracleã€PostgreSQLï¼‰ã€Not only sqléå…³ç³»å‹æ•°æ®åº“ï¼ˆæ•°æ®å­˜å‚¨æ²¡æœ‰å›ºå®šæ ¼å¼ï¼Œå¯æ¨ªå‘æ‰©å±•ï¼‰ã€‚1âƒ£ï¸æ•°æ®ç»“æ„ï¼šç»“æ„åŒ–ä¸éç»“æ„åŒ–ï¼Œé”®å€¼redisã€åˆ—å­˜å‚¨HBaseã€æ–‡æ¡£MongoDBã€å›¾å½¢å­˜å‚¨Neo4jã€‚2âƒ£ï¸æ•°æ®å…³è”ï¼šsqlä¸­å¤šå¼ è¡¨å¯å…³è”ï¼Œnosqlæ•°æ®ä¹‹é—´æ— å…³è”ã€‚3âƒ£ï¸æŸ¥è¯¢è¯­è¨€ï¼šsqlå›ºå®šæŸ¥è¯¢è¯­è¨€ï¼Œnosqlä¸å›ºå®šæŸ¥è¯¢è¯­è¨€ã€‚4âƒ£ï¸äº‹åŠ¡ä¸€è‡´æ€§ï¼šsqlæä¾›å¼ºä¸€è‡´æ€§å’Œå®Œæ•´äº‹åŠ¡æ”¯æŒï¼Œnosqlæä¾›BASEåŸºæœ¬å¯ç”¨ã€è½¯çŠ¶æ€ã€æœ€ç»ˆä¸€è‡´æ€§ã€‚5âƒ£ï¸å­˜å‚¨æ–¹å¼ï¼šsqlå­˜åœ¨ç£ç›˜ï¼Œnosqlå­˜åœ¨å†…å­˜ã€‚6âƒ£ï¸æ‰©å±•æ€§ï¼šsqlå‚ç›´æ‰©å±•ï¼Œå‡çº§å•ä¸ªæœåŠ¡å™¨çš„å†…å­˜cpuå­˜å‚¨ç©ºé—´ã€‚nosqlå¯æ°´å¹³æ‰©å±•ï¼Œåˆ†å¸ƒå¼å­˜å‚¨ã€‚</p>
</li>
<li><p>æ•°æ®åº“äº‹åŠ¡ï¼šä¸€æ¡&#x2F;å¤šæ¡è¯­å¥ç»„æˆï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œçš„æ‰§è¡Œå•å…ƒã€‚1âƒ£ï¸åŸå­æ€§ï¼šæœ€å°æ‰§è¡Œå•å…ƒï¼Œæ“ä½œå¤±è´¥æ—¶undo logæ¥å›æ»šã€‚2âƒ£ï¸ä¸€è‡´æ€§ï¼šäº‹åŠ¡æ‰§è¡Œå‰åæ•°æ®ä¿æŒä¸€è‡´ã€‚3âƒ£ï¸éš”ç¦»æ€§ï¼šå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¹‹é—´ä¸ä¼šäº’ç›¸å¹²æ‰°ï¼ŒMVCCã€é”æœºåˆ¶å®ç°ä¸åŒéš”ç¦»çº§åˆ«ã€‚4âƒ£ï¸æŒä¹…æ€§ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤å¯¹æ•°æ®åº“çš„ä¿®æ”¹æ˜¯æ°¸ä¹…çš„ï¼Œç³»ç»Ÿå´©æºƒæ—¶ä½¿ç”¨redoæ—¥å¿—æ¥æ¢å¤ã€‚</p>
</li>
<li><p>redoæ—¥å¿—å’Œundoæ—¥å¿—ï¼š1âƒ£ï¸redo logï¼šé‡åšæ—¥å¿—ï¼Œä¿éšœæŒä¹…æ€§ï¼Œç³»ç»Ÿå´©æºƒæ—¶æ¢å¤æ•°æ®ã€‚ç‰©ç†æ—¥å¿—ï¼Œè®°å½•æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹æ“ä½œã€‚æ›´æ–°å…ˆå†™å…¥redo logï¼Œå†ç©ºé—²æ—¶æ›´æ–°åˆ°ç£ç›˜ï¼Œé¢„å†™å¼æŠ€æœ¯å‡å°‘IOé¢‘ç‡ã€‚2âƒ£ï¸undo logï¼šæ’¤é”€æ—¥å¿—ï¼Œä¿éšœåŸå­æ€§ï¼Œå›æ»šæ—¶æ¢å¤æ•°æ®ã€‚é€»è¾‘æ—¥å¿—ï¼Œè®°å½•æ•°æ®æ“ä½œçš„é€†å‘æ“ä½œã€‚è¿˜æä¾›ä¸€è‡´æ€§è¯»ï¼Œå³ä½¿æ•°æ®è¢«ä¿®æ”¹ä¹Ÿèƒ½ä»undo logè®¿é—®åˆ°ä¿®æ”¹å‰çš„æ•°æ®ã€‚</p>
</li>
<li><p>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–äº‹åŠ¡å½±å“çš„ç¨‹åº¦ã€‚1âƒ£ï¸è¯»æœªæäº¤ï¼šå¯èƒ½è„è¯»ï¼ˆè¯»åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„ä¿®æ”¹ï¼‰ã€‚2âƒ£ï¸è¯»å·²æäº¤ï¼šä¸å¯é‡å¤åº¦ï¼ˆäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°æ•°æ®ä¸ä¸€è‡´ï¼‰ã€‚3âƒ£ï¸å¯é‡å¤åº¦ï¼šé»˜è®¤çš„ï¼Œå¹»è¯»ï¼ˆå¯èƒ½è¯»åˆ°ç¬¬ä¸€æ¬¡è¯»æ²¡æœ‰çš„æ–°çºªå½•ï¼Œè¡Œæ•°ä¸ä¸€è‡´ï¼‰ã€‚4âƒ£ï¸ä¸²è¡ŒåŒ–ï¼šäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œå¼ºåˆ¶é”å®šäº‹åŠ¡è®¿é—®çš„æ•°æ®ï¼Œé”ç«äº‰ã€‚ï¼ˆè¡¨çº§é”ï¼‰</p>
</li>
<li><p>è§£å†³ä¸å¯é‡å¤åº¦ï¼šMVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ŒåŒä¸€æ—¶åˆ»ä¸åŒäº‹åŠ¡è¯»å–åˆ°ä¸åŒç‰ˆæœ¬çš„æ•°æ®ã€‚å®ç°ï¼šéšè—åˆ—ã€undo logã€ç‰ˆæœ¬é“¾ã€‚æ¯è¡Œæ•°æ®å¤šä¸ªéšè—åˆ—ï¼ˆç‰ˆæœ¬å·ã€åˆ é™¤æ—¶é—´ã€æŒ‡å‘undo logçš„æŒ‡é’ˆï¼‰ï¼Œundo logé€šè¿‡å›æ»šæŒ‡é’ˆæŠŠä¸€ä¸ªæ•°æ®è¡Œæ‰€æœ‰å¿«ç…§è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªç‰ˆæœ¬é“¾ï¼Œä½¿ç”¨äº‹åŠ¡ç‰ˆæœ¬å·æ¯”è¾ƒæ¥æ§åˆ¶æ•°æ®ç‰ˆæœ¬ã€‚ä¼˜ç‚¹ï¼šé¿å…åŠ é”ï¼Œå…è®¸è¯»å†™æ“ä½œå¹¶å‘æ‰§è¡Œã€‚</p>
</li>
<li><p>mysqlçš„é”ï¼šè¡¨é”ã€è¡Œé”ï¼ˆInnodbæœ‰ï¼Œé€šè¿‡ç»™ç´¢å¼•é¡¹åŠ é”å®ç°ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•ç›¸å½“äºè¡¨é”ï¼‰ã€‚å…±äº«é”ã€æ’ä»–é”ã€‚insertã€updateã€deleteæ“ä½œinnodbä¼šè‡ªåŠ¨ç»™æ¶‰åŠåˆ°çš„æ•°æ®åŠ æ’ä»–é”ã€‚select for updateåŠ æ’ä»–é”ã€‚select lock in share modeåŠ å…±äº«é”ã€‚</p>
</li>
<li><p>é—´éš™é”ï¼šInnodbä¸­çš„ï¼Œç”¨äºé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸æ˜¯å›ºå®šçš„è¡Œæ•°æ®ã€‚Innodbä¸­å¯é‡å¤è¯»åŠæ›´é«˜çº§åˆ«ä½¿ç”¨çš„é”æœºåˆ¶ã€‚å¯ä»¥é¿å…å¹»è¯»ï¼Œé¿å…å…¶ä»–äº‹åŠ¡åœ¨è¯¥èŒƒå›´å†…æ’å…¥ã€‚</p>
</li>
<li><p>æ„å‘é”ï¼šInnodbä¸­çš„é”æœºåˆ¶ï¼Œç”¨æ¥äº‹åŠ¡è·è¡Œé”ä¹‹å‰è¡¨æ˜é”å®šæ„å›¾ï¼Œåˆ†ä¸ºæ„å‘å…±äº«é”å’Œæ„å‘æ’ä»–é”ã€‚æ„å‘é”æ˜¯è¡¨çº§é”ï¼Œè·è¡Œé”ä¹‹å‰å…ˆè·å–å¯¹åº”æ„å‘é”ï¼Œä¸éœ€è¦æ£€æŸ¥æ¯è¡Œçš„é”çŠ¶æ€ï¼Œé€šè¿‡æ„å‘é”äº†è§£è¡¨çš„é”ä½¿ç”¨æƒ…å†µã€‚æ„å‘å…±äº«é”ä¸é˜»å¡å…¶ä»–æ„å‘å…±äº«é”ï¼Œæ„å‘æ’ä»–é”ä¸é˜»å¡å…¶ä»–æ„å‘æ’ä»–é”ã€‚æ„å‘å…±äº«é”ï¼ˆISï¼‰æˆ–æ„å‘æ’ä»–é”ï¼ˆIXï¼‰ä¼šé˜»å¡æ•´ä¸ªè¡¨çš„æ’ä»–é”ã€‚</p>
</li>
<li><p>å¿«ç…§è¯»å’Œå½“å‰è¯»ï¼šå¿«ç…§è¯»ï¼šæ‰§è¡Œæ™®é€šçš„selectæŸ¥è¯¢ï¼ŒInnodbä½¿ç”¨MVCCè¿›è¡Œå¿«ç…§è¯»ï¼Œä¸åŠ è¡Œé”ï¼Œä¸ä¼šé˜»å¡å…¶ä»–äº‹åŠ¡çš„è¯»å†™æ“ä½œï¼Œæä¾›ä¸€è‡´æ€§çš„éé˜»å¡è¯»å–ã€‚å½“å‰è¯»ï¼šæ˜¾å¼åŠ é”selectã€updateã€deleteï¼Œä¼šå¯¹å¯¹åº”æ•°æ®è¡ŒåŠ æ’ä»–é”ï¼Œè·å–æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p>
</li>
<li><p>Innodpå’ŒMyisamï¼šInnoDBæ”¯æŒäº‹åŠ¡å¤„ç†ã€è¡Œçº§é”å®šå’Œå¤–é”®çº¦æŸï¼Œé€‚åˆäºé«˜å¹¶å‘å’Œéœ€è¦å¼ºæ•°æ®å®Œæ•´æ€§çš„åº”ç”¨ã€‚MyISAMæ‹¥æœ‰è¾ƒé«˜çš„è¯»å–é€Ÿåº¦å’Œå…¨æ–‡ç´¢å¼•æ”¯æŒï¼Œä½†ä¸æ”¯æŒäº‹åŠ¡å¤„ç†ï¼Œåªæœ‰è¡¨çº§é”å®šã€‚</p>
</li>
<li><p>Mysqlç´¢å¼•ï¼šæ•°æ®åº“è¡¨ä¸­ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå¸®åŠ©æé«˜æ•°æ®æ£€ç´¢é€Ÿç‡ã€‚ä½¿ç”¨Bæ ‘å’ŒB+æ ‘ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚Innodbä¸­ä¸»é”®ç´¢å¼•ä½¿ç”¨èšç°‡ç´¢å¼•ï¼ŒB+æ ‘å¶å­ç»“ç‚¹å­˜å‚¨è¡¨çš„å®é™…è¡Œæ•°æ®ã€‚éä¸»é”®ç´¢å¼•ä½¿ç”¨B+æ ‘ï¼Œå¶å­ç»“ç‚¹å­˜å‚¨å¯¹åº”è¡Œä¸»é”®è€Œä¸æ˜¯è¡Œæ•°æ®æœ¬èº«ã€‚Myisamä¸­éƒ½æ˜¯éèšç°‡ç´¢å¼•ï¼ŒB+æ ‘å¶å­ç»“ç‚¹å­˜å‚¨è¡Œæ•°æ®çš„æŒ‡é’ˆã€‚</p>
</li>
<li><p>Mysqlç´¢å¼•ç¼ºç‚¹ï¼šç©ºé—´æˆæœ¬ã€ç»´æŠ¤æˆæœ¬ï¼ˆæ•°æ®æ’å…¥åˆ é™¤æ›´æ–°æ—¶ç´¢å¼•ä¹Ÿéœ€è¦æ›´æ–°ï¼Œå¯¼è‡´æ›´æ–°æ“ä½œå˜æ…¢ï¼‰ã€‚ç´¢å¼•é€šå¸¸ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ã€‚</p>
</li>
<li><p>Mysqlä¸­æœ‰å“ªäº›ç´¢å¼•ï¼šä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€ç©ºé—´ç´¢å¼•ã€ç»„åˆç´¢å¼•ã€å¤–é”®ç´¢å¼•</p>
</li>
<li><p>Bæ ‘å’ŒB+æ ‘åŒºåˆ«ï¼šéƒ½æ˜¯å¤šè·¯æœç´¢æ ‘ï¼Œè‡ªå¹³è¡¡ã€‚B+æ ‘æ‰€æœ‰çš„å€¼å­˜å‚¨åœ¨å¶å­ç»“ç‚¹ï¼Œå¹¶ä¸”å½¢æˆæœ‰åºé“¾è¡¨ï¼Œé€‚åˆèŒƒå›´æŸ¥è¯¢ï¼Œå†…éƒ¨èŠ‚ç‚¹å­˜å‚¨é”®å’ŒæŒ‡å‘å¶å­ç»“ç‚¹çš„æŒ‡é’ˆã€‚æ›´èƒ–æ›´ä½ï¼ŒIOæ•ˆç‡é«˜ã€‚Bæ ‘æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨é”®å’Œå€¼ï¼Œå¯¹äºç‚¹æŸ¥è¯¢æ›´ä¸ºé«˜æ•ˆã€‚</p>
</li>
<li><p>å“ˆå¸Œç´¢å¼•ï¼šMemoryå­˜å‚¨å¼•æ“ä½¿ç”¨ï¼ŒåŸºäºå†…å­˜ã€‚æ•£åˆ—ç®—æ³•ä½¿ç”¨å“ˆå¸Œè¡¨å¾ˆå¿«O(1)ï¼Œé€‚åˆç­‰å€¼æ¯”è¾ƒæŸ¥è¯¢ï¼Œä¸é€‚åˆèŒƒå›´æŸ¥è¯¢ã€‚å¦‚æœé‡å¤çš„é”®ä¼šå“ˆå¸Œå†²çªã€‚Innodbä¸­è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€‚</p>
</li>
<li><p>çº¢é»‘æ ‘ï¼šè‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼ŒèŠ‚ç‚¹è¦ä¹ˆçº¢è‰²è¦ä¹ˆé»‘è‰²ï¼Œæ ¹èŠ‚ç‚¹é»‘è‰²ï¼Œçº¢èŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ï¼Œå¶å­ç»“ç‚¹éƒ½æ˜¯é»‘è‰²ç©ºèŠ‚ç‚¹ã€‚é€šè¿‡æ—‹è½¬ã€é‡æ–°ç€è‰²æ¥ç»´æŒå¹³è¡¡ã€‚</p>
</li>
<li><p>èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼šèšç°‡ç´¢å¼•ï¼šæ•°æ®å­˜å‚¨å’Œç´¢å¼•æ”¾åœ¨ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­ç»“ç‚¹ä¿å­˜äº†è¡Œæ•°æ®ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ã€éèšç°‡ç´¢å¼•ï¼šæ•°æ®å’Œç´¢å¼•åˆ†å¼€ï¼Œç´¢å¼•ç»“æ„çš„å¶å­ç»“ç‚¹å­˜å‚¨è¡Œæ•°æ®çš„æŒ‡é’ˆï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰ã€‚èšç°‡ç´¢å¼•ä¸­ï¼Œè¡¨ä¸­æ•°æ®çš„ç‰©ç†é¡ºåºå’Œç´¢å¼•é¡ºåºä¸€è‡´ï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚</p>
</li>
<li><p>æœ€å·¦å‰ç¼€åŒ¹é…ï¼šè”åˆç´¢å¼•ä¸­ï¼ŒæŸ¥è¯¢æ—¶ä½¿ç”¨çš„whereå­å¥ä¸­çš„æ¡ä»¶å¿…é¡»åŒ…å«è”åˆç´¢å¼•ä¸­æœ€å·¦è¾¹çš„åˆ—ç´¢å¼•æ‰èƒ½ç”Ÿæ•ˆï¼Œå¦‚æœè·³è¿‡æˆ–ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™åé¢åˆ—ä¸èƒ½æœ‰æ•ˆä½¿ç”¨ç´¢å¼•ã€‚å› ä¸ºB+æ ‘æ˜¯æœ‰åºçš„ã€‚</p>
</li>
<li><p>sqlè¯­å¥æ‰§è¡Œè¿‡ç¨‹ï¼š1.å»ºç«‹è¿æ¥ 2.mysql8.0æŸ¥çœ‹æ˜¯å¦å¼€å¯ç¼“å­˜ 3.è§£æå™¨è¿›è¡Œè¯­æ³•è§£æï¼Œç”Ÿæˆè§£ææ ‘ï¼Œæ£€æŸ¥è¯­æ³•æ­£ç¡® 4.ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼ŒæŸ¥çœ‹æ˜¯å¦å¯ä¼˜åŒ–ã€‚5.æ‰§è¡Œå¼•æ“æ‰§è¡Œsqlã€‚</p>
</li>
<li><p>æ•°æ®åº“ä¸‰èŒƒå¼ï¼š1.åˆ—ä¸å¯åˆ†å‰² 2.æ‰€æœ‰éä¸»é”®å­—æ®µéƒ½ä¾èµ–äºä¸»é”® 3.æ‰€æœ‰éä¸»é”®å­—æ®µç›´æ¥ä¾èµ–äºä¸»é”®ã€‚</p>
</li>
<li><p>å›è¡¨æŸ¥è¯¢å’Œè¦†ç›–ç´¢å¼•ï¼šå›è¡¨æŸ¥è¯¢æ˜¯æ™®é€šç´¢å¼•ï¼Œå…ˆå®šä½ä¸»é”®ï¼Œå†å®šä½è¡Œè®°å½•ï¼Œæ‰«æä¸¤éç´¢å¼•æ ‘ã€‚è¦†ç›–ç´¢å¼•æ˜¯ç´¢å¼•ä¸­åŒ…å«äº†æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰å­—æ®µï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è·å–æ•°æ®ï¼Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œå‡å°‘ç£ç›˜IOã€‚</p>
</li>
<li><p>explainï¼šå±•ç¤ºå¦‚ä½•æ‰§è¡Œselectè¯­å¥ï¼šå¦‚ä½•ä½¿ç”¨ç´¢å¼•ã€è¡¨è¿æ¥é¡ºåºã€ä¼°è®¡æ‰«æè¡Œæ•°ã€‚</p>
</li>
<li><p>æ•°æ®åº“ä¼˜åŒ–ï¼š1.å»ºç´¢å¼•ï¼Œwhere order by group byæ¶‰åŠçš„åˆ—å»ºç«‹ç´¢å¼•ã€‚2.ç´¢å¼•ä¼˜åŒ–ï¼Œæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä¸ä½¿ç”¨like â€œ%abcâ€ã€‚3.å»ºç«‹åˆ†åŒºï¼Œå¦‚æ—¶é—´å­—æ®µ4.åˆ©ç”¨ç¼“å­˜redisï¼Œç¼“å­˜çƒ­æ•°æ®5.æŸ¥è¯¢é™å®šæ•°æ®èŒƒå›´ï¼Œå¦‚æŸ¥è¯¢ä¸€ä¸ªæœˆå†…çš„6.è¯»å†™åˆ†ç¦»7.åˆ†åº“åˆ†è¡¨ï¼Œå‚ç›´æ‹†åˆ†æ°´å¹³æ‹†åˆ†8.æ•°æ®å¼‚æ„åˆ°es9.å†·çƒ­æ•°æ®åˆ†ç¦»10.å‡çº§OceanBase</p>
</li>
<li><p>æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼š!&#x3D;ã€is nullã€orã€&gt;&lt;ã€inã€not in</p>
</li>
<li><p>mysqlä¸­charå’Œvarcharçš„åŒºåˆ«ï¼šcharæ˜¯å›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå³ä½¿å­˜å‚¨æ•°æ®çŸ­äºè®¾è®¡é•¿åº¦ï¼Œä¼šç”¨ç©ºæ ¼å¡«å……ï¼Œæ‰€ä»¥å¯ä»¥å¿«é€ŸæŸ¥è¯¢ã€‚varcharå¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œåªå ç”¨å¿…è¦ç©ºé—´åŠ ä¸€ä¸ªé¢å¤–çš„é•¿åº¦å­—èŠ‚ï¼ŒèŠ‚çœç©ºé—´ä½†å½±å“æŸ¥è¯¢æ€§èƒ½ã€‚</p>
</li>
<li><p>deleteå’Œtruncateï¼šdeleteåˆ é™¤è¡¨æ—¶ä¼šå¢åŠ å¤§é‡undoæ—¥å¿—å’Œredoæ—¥å¿—ï¼Œtruncateä¼šç«‹å³åˆ é™¤è¡¨ä¸­æ‰€æœ‰æ•°æ®ï¼Œä¸èƒ½å›æ»šï¼Œå¿«é€Ÿé‡Šæ”¾å ç”¨çš„ç©ºé—´ã€‚</p>
</li>
<li><p>mysqlä¸»ä»å¤åˆ¶ï¼šä¸»æœåŠ¡å™¨å°†å˜æ›´è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinary logï¼‰æ–‡ä»¶ï¼Œä»æœåŠ¡å™¨è¿æ¥åˆ°ä¸»æœåŠ¡å™¨åï¼Œè¯·æ±‚ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®å¼€å§‹ä¼ é€æ—¥å¿—ï¼Œå­˜åˆ°ä¸­ç»§æ—¥å¿—relay logï¼Œå¼€çº¿ç¨‹é‡æ”¾ã€‚æ•°æ®å†—ä½™ã€è¯»å†™åˆ†ç¦»ã€é«˜å¯ç”¨æ€§ã€‚</p>
</li>
<li><p>ä¸»ä»å¤åˆ¶çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼šä¸»ä»å¤åˆ¶æœ‰å»¶æ—¶ï¼Œå¯èƒ½é€ æˆè¯»åˆ°ä¸ä¸€è‡´çš„æ•°æ®ã€‚æ ¹æ®æ•°æ®å¤åˆ¶åˆ°ä»æœåŠ¡å™¨å¯¹ä¸»æœåŠ¡å™¨äº‹åŠ¡æäº¤çš„å½±å“ï¼Œåˆ†ä¸ºï¼š1.å¼‚æ­¥å¤åˆ¶ï¼ˆå†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ä¹‹åç¡®è®¤äº‹åŠ¡æäº¤ï¼Œä»æœåŠ¡å™¨è½åäºä¸»æœåŠ¡å™¨ï¼Œä¸ä¸€è‡´é£é™©é«˜ï¼‰2.åŠåŒæ­¥å¤åˆ¶ï¼ˆç­‰å¾…è‡³å°‘ä¸€ä¸ªä»æœåŠ¡å™¨æ”¶åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼Œä¸»æœåŠ¡å™¨æ•…éšœæ—¶å¯ä»¥æ‰¾åˆ°è¿™ä¸ªä»æœåŠ¡å™¨æˆä¸ºä¸»ï¼‰3.åŒæ­¥å¤åˆ¶ï¼ˆç­‰å¾…æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œè¾ƒé«˜çš„æ•°æ®ä¸€è‡´æ€§ï¼‰</p>
</li>
<li><p>mysqlé›†ç¾¤æ¶æ„ï¼š1âƒ£ï¸ä¸€ä¸»å¤šä»æ¶æ„ï¼šå†™æ“ä½œéƒ½ä¸»åº“ï¼Œä»åº“è´Ÿè´£è¯»ã€‚2âƒ£ï¸å¤šçº§å¤åˆ¶æ¶æ„ï¼šä¸€ä¸»å’Œå¤šä»ä¹‹é—´å¢åŠ ä¸€ä¸ªmaster2ä¸»åº“ï¼Œè¡¨éƒ½æ˜¯ç©ºè¡¨ï¼Œä»…è´Ÿè´£è½¬å‘binlogã€‚å‡è½»ä¸»åº“è´Ÿæ‹…ã€‚3âƒ£ï¸åŒä¸»æ¶æ„ï¼šmaster1å’Œmaster2äº’ä¸ºä¸»ä»ã€‚</p>
</li>
<li><p>mysqlåˆ†åº“åˆ†è¡¨ï¼šå°†æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªæ•°æ®åº“å’Œè¡¨ä¸­ã€‚å‚ç›´æ‹†åˆ†ï¼šæŒ‰ç…§è¡¨çš„åˆ—æ¥è¿›è¡Œæ‹†åˆ†ï¼Œå°†ä¸€ä¸ªè¡¨åˆ†å‰²æˆå¤šä¸ªè¡¨ã€‚æ°´å¹³æ‹†åˆ†ï¼šæŒ‰ç…§è¡¨çš„è¡Œè¿›è¡Œæ‹†åˆ†ï¼Œç”¨æŸä¸ªidåšå“ˆå¸Œå–ä½™è¿›è¡Œåˆ†æ•£ã€‚æŒ‘æˆ˜ï¼šæ•°æ®ä¸€è‡´æ€§ã€è·¨åº“æˆ–è·¨è¡¨çš„äº‹åŠ¡å¤„ç†ã€æ•°æ®è¿ç§»å’Œé‡æ–°åˆ†ç‰‡ç­‰é—®é¢˜ã€‚è§£å†³ï¼šä¸¤é˜¶æ®µæäº¤ä¼šé”å®šèµ„æºã€‚XAåè®®ã€‚äº‹åŠ¡è¡¥å¿ã€‚</p>
</li>
<li><p>è·¨åº“äº‹åŠ¡ï¼štddlä¸æ”¯æŒè·¨åº“äº‹åŠ¡æäº¤ï¼Œå¼ºä¸€è‡´æ€§éœ€è¦ä½¿ç”¨åˆ‡é¢äº‹åŠ¡å®ç°ã€‚æœ€ç»ˆä¸€è‡´æ€§å¯ä»¥ç”¨çŠ¶æ€æœº+å®šæ—¶ä»»åŠ¡å®ç°ã€‚</p>
</li>
<li><p>è‡ªå¢idï¼š1.redisæä¾›incrå‘½ä»¤ï¼Œå•çº¿ç¨‹ã€‚2.é›ªèŠ±idï¼š41ä½æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼Œèƒ½ç”¨70å¹´ï¼‰ï¼Œ10ä½æœºå™¨æ ‡è¯†ï¼Œ12ä½åºåˆ—å·ã€‚</p>
</li>
<li><p>åˆ†åº“åˆ†è¡¨ä¹‹ä¸»é”®idï¼šéœ€è¦ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„åˆ†å¸ƒå¼idï¼š1âƒ£ï¸æ•°æ®åº“è‡ªå¢é•¿idï¼Œæ ¹æ®è¡¨çš„æ•°é‡è®¾ç½®æ­¥é•¿ï¼Œä½†æ˜¯ä¸èƒ½æ‰©è¡¨äº†ã€‚2âƒ£ï¸redis incr&#x2F;incrbyå‘½ä»¤ç”Ÿæˆè‡ªå¢é•¿idã€‚æ•°æ®å­˜åœ¨å†…å­˜ï¼Œå®ä¾‹å®•æœºå¯èƒ½ä¸¢æ•°æ®ã€‚3âƒ£ï¸uuidï¼šæœ¬åœ°ç”Ÿäº§ä¸å ç”¨ç½‘ç»œèµ„æºï¼Œç¼ºç‚¹æ˜¯å¤ªé•¿ï¼Œä¸å…·å¤‡æœ‰åºæ€§ã€‚é€‚åˆç”¨äºç¼–å·ã€‚4âƒ£ï¸é›ªèŠ±ç®—æ³•ï¼šæœ‰åºå¢é•¿ï¼Œå…¨å±€å”¯ä¸€ã€‚æ¯ç§’å¯ç”Ÿæˆå››ç™¾å¤šä¸‡idã€‚åˆ†ä¸‰æ®µï¼šæ—¶é—´æ¯«ç§’çº§ã€é›†ç¾¤+æœºå™¨idã€åºåˆ—å·ã€‚å¯çµæ´»åˆ†é…æ¯”ç‰¹ä½ã€‚ç¼ºç‚¹ï¼šå¼ºä¾èµ–æœºå™¨æ—¶é’Ÿï¼Œå¯èƒ½å¯¼è‡´å‘å·é‡å¤ã€‚ç¾å›¢Leafåˆ†å¸ƒå¼idä¸­ï¼Œå¼•å…¥zookeeperï¼ŒæœåŠ¡å‘zookeeperè·å–æœºå™¨idï¼Œzookeeperæ£€æµ‹æ—¶é—´æ˜¯å¦æ­£ç¡®ã€‚</p>
</li>
<li><p>mysqlå’ŒOracleçš„åŒºåˆ«ï¼š1âƒ£ï¸oracleæ•°æ®åº“æ˜¯ä¸€ä¸ªé‡é‡çº§å¯¹è±¡å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆORDBMSï¼‰ï¼Œæ”¶è´¹çš„ã€‚mysqlæ˜¯ä¸€ä¸ªè½»é‡çº§å¼€æºçš„å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ï¼Œå¼€æºçš„å…è´¹çš„ã€‚2âƒ£ï¸å®‰å…¨æ€§ä¸Šï¼šoracleéªŒè¯ç”¨æˆ·çš„å‚æ•°æœ‰å¾ˆå¤šï¼Œæœ‰ç€è¾ƒå¼ºçš„å®‰å…¨æ€§ï¼ŒmysqléªŒè¯ç”¨æˆ·çš„å‚æ•°åªæœ‰ä¸‰ä¸ªï¼ˆç”¨æˆ·åã€å¯†ç ã€ä½ç½®ï¼‰ï¼Œå®‰å…¨æ€§è¾ƒå¼±ã€‚3âƒ£ï¸å¯¹äº‹åŠ¡çš„æ”¯æŒï¼šMySQLåœ¨innodbå­˜å‚¨å¼•æ“çš„è¡Œçº§é”çš„æƒ…å†µä¸‹æ‰å¯æ”¯æŒäº‹åŠ¡ï¼Œè€ŒOracleåˆ™å®Œå…¨æ”¯æŒäº‹åŠ¡ã€‚4âƒ£ï¸mysqlçš„è¯Šæ–­è°ƒä¼˜æ–¹æ³•è¾ƒå°‘ï¼Œä¸»è¦æœ‰æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚Oracleæœ‰å„ç§æˆç†Ÿçš„æ€§èƒ½è¯Šæ–­è°ƒä¼˜å·¥å…·ã€‚5âƒ£ï¸å¹¶å‘æ€§ï¼šmysqlè™½ç„¶InnoDBå¼•æ“çš„è¡¨å¯ç”¨è¡Œçº§é”ï¼Œä½†è¡Œçº§é”æœºåˆ¶ä¾èµ–äºè¡¨çš„ç´¢å¼•ï¼Œå¦‚æœè¡¨æ²¡æœ‰ç´¢å¼•ï¼Œæˆ–è€…sqlè¯­å¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œå°†ä½¿ç”¨è¡¨çº§é”ã€‚Oracleä½¿ç”¨è¡Œçº§é”ï¼Œå¯¹èµ„æºé”å®šç²’åº¦æ›´å°ï¼Œä¸ä¾èµ–äºç´¢å¼•ã€‚6âƒ£ï¸åº”ç”¨ï¼šOracleåº”ç”¨äºå¤§å‹å¤æ‚çš„ä¼ä¸šçº§åº”ç”¨ï¼Œæ€§èƒ½ã€å¯ä¼¸ç¼©æ€§ã€å¯é æ€§æ›´å¼ºå¤§ã€‚mysqlåº”ç”¨äºä¸­å°å‹åº”ç”¨ã€‚</p>
</li>
<li><p>mysqlå½“å‰è¯»å’Œå¿«ç…§è¯»ï¼š1âƒ£ï¸å¿«ç…§è¯»æ˜¯æŒ‡è¯»å–æ•°æ®ä¸éœ€è¦ç­‰å¾…å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®é”çš„é‡Šæ”¾ï¼Œé€šè¿‡MVCCå…è®¸è¯»å–æ•°æ®çš„å†å²ç‰ˆæœ¬ï¼Œæä¾›ä¸€è‡´æ€§è§†å›¾ï¼Œå®ç°äº†éé˜»å¡çš„è¯»ã€‚æ™®é€šçš„selectæ“ä½œå°±æ˜¯å¿«ç…§è¯»ï¼ŒRRå¯é‡å¤è¯»å’ŒRCè¯»å·²æäº¤ä¸‹çš„selectæ˜¯å¿«ç…§è¯»ã€‚2âƒ£ï¸å½“å‰è¯»ï¼šè¯»å–æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶å¯¹è¯»å–çš„æ•°æ®åŠ é”ï¼ˆè¡Œé”æˆ–é—´éš™é”ï¼‰ã€‚å¸¸ç”¨äºéœ€è¦ä¿®æ”¹æ•°æ®çš„åœºæ™¯ï¼Œä¾‹å¦‚updateã€deleteã€select for updateã€‚åœ¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ä¸‹ï¼Œå³ä½¿æ™®é€šselectä¹Ÿæ˜¯å½“å‰è¯»ã€‚</p>
</li>
<li><p>ç´¢å¼•ä¼˜åŒ–ï¼šå»ºç«‹åˆé€‚çš„è”åˆç´¢å¼•ï¼Œè¾¾åˆ°è¦†ç›–ç´¢å¼•ï¼Œå°½é‡ä¿æŒåŒºåˆ†åº¦é«˜çš„åœ¨æœ€å·¦</p>
</li>
<li><p>mysqlçš„deleteæ–‡ä»¶å¤§å°ä¸å˜ï¼šInnodbé‡‡ç”¨å»¶è¿Ÿç©ºé—´å›æ”¶ï¼Œåˆ é™¤æ•°æ®ä»…åšæ ‡è®°ï¼Œä¸ç«‹å³å›æ”¶ç£ç›˜ç©ºé—´ï¼Œé¿å…é¢‘ç¹ç£ç›˜æ“ä½œã€‚æ•°æ®æ–‡ä»¶ä»¥æ•°æ®é¡µä¸ºå•ä½ç»„ç»‡ã€‚è€Œä¸”deleteä¼šè®°å½•redoå’Œundoæ—¥å¿—ï¼Œæ¶ˆè€—IOèµ„æºå’Œå­˜å‚¨ç©ºé—´ã€‚ä½¿ç”¨ï¼šTruncate tableåˆ é™¤è¡¨çš„æ‰€æœ‰æ•°æ®å¹¶åˆå§‹åŒ–ã€‚dropé‡å»ºè¡¨ï¼Œåˆ é™¤åé‡å»ºã€‚</p>
</li>
<li><p>dropã€deleteã€truncateï¼šdeleteå¯å›æ»šï¼Œä¼šè§¦å‘è¡¨ä¸Šçš„è§¦å‘å™¨ã€‚truncateåˆ é™¤è¡¨ä¸­æ‰€æœ‰æ•°æ®ï¼Œä¸èƒ½å›æ»šï¼Œæ›´å¿«ï¼Œå ç”¨ç©ºé—´å°ã€‚dropåˆ é™¤è¡¨ï¼Œè§¦å‘å™¨ä¸ä¼šè§¦å‘ã€‚</p>
</li>
<li><p>é€‚åˆ&#x2F;ä¸é€‚åˆå»ºç«‹ç´¢å¼•ï¼šé€‚åˆï¼šé¢‘ç¹ä½¿ç”¨çš„ã€ç”¨æ¥ç¼©å°æŸ¥è¯¢èŒƒå›´çš„ã€éœ€è¦æ’åˆ—çš„ã€‚ä¸é€‚åˆï¼šæŸ¥è¯¢ä¸­å¾ˆå°‘æ¶‰åŠçš„ã€é‡å¤å€¼æ¯”è¾ƒå¤šçš„ã€ç‰¹æ®Šçš„æ•°æ®ç±»å‹å¦‚textçš„ã€‚</p>
</li>
<li><p>mybatisæ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼šå»¶è¿ŸåŠ è½½æ˜¯ç”¨åˆ°æ•°æ®æ—¶æ‰è¿›è¡ŒåŠ è½½ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡å…³è”æ•°æ®ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è®¾ç½®å»¶è¿ŸåŠ è½½ï¼ŒæŒ‰éœ€å–æã€‚åº•å±‚ä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†å®ç°ï¼Œåˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œç›®æ ‡å¯¹è±¡æ˜¯å¼€å¯å»¶è¿ŸåŠ è½½çš„mapperæ‰€æ˜ å°„çš„å®ä½“ç±»ã€‚é€šè¿‡å­—èŠ‚ç æŠ€æœ¯è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±»ï¼Œè°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œè¿›å…¥æ‹¦æˆªå™¨çš„invokeæ–¹æ³•ï¼Œæ‰§è¡ŒsqlæŸ¥è¯¢ä»¥è·å–å…³è”æ•°æ®ï¼Œæ³¨å…¥åˆ°å¯¹è±¡å±æ€§ä¸­ã€‚</p>
</li>
</ul>
<h2 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h2><ul>
<li>Mybatisä¿è¯è·¨åº“æ•°æ®ä¸€è‡´æ€§ï¼Ÿï¼šMybatisæ˜¯ä¸€ä¸ªæŒä¹…å±‚æ¡†æ¶ï¼Œä¸ç›´æ¥æä¾›è·¨åº“è°ƒç”¨æ•°æ®ä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆã€‚éœ€è¦å€ŸåŠ©å¤–éƒ¨åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ã€ä¸¤é˜¶æ®µæäº¤ã€æœ€ç»ˆä¸€è‡´æ€§ã€åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶XAåè®®ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜ä¹‹java2024</title>
    <url>/2025/07/23/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E8%83%8C%E8%BF%87%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8Bjava2024/</url>
    <content><![CDATA[<h2 id="å†…å­˜æ¨¡å‹"><a href="#å†…å­˜æ¨¡å‹" class="headerlink" title="å†…å­˜æ¨¡å‹"></a>å†…å­˜æ¨¡å‹</h2><ul>
<li>jvmå†…å­˜æ¨¡å‹ï¼šçº¿ç¨‹å…±æœ‰ï¼šå †ï¼ˆå¯¹è±¡å®ä¾‹å’Œæ•°ç»„ï¼‰ã€æ–¹æ³•åŒºï¼ˆè¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ï¼‰ã€ç›´æ¥å†…å­˜ï¼ˆéè¿è¡Œæ—¶æ•°æ®ï¼ŒIOæ“ä½œï¼‰ã€‚çº¿ç¨‹ç§æœ‰ï¼šè™šæ‹Ÿæœºæ ˆï¼ˆä¸€ä¸ªæ–¹æ³•ä¸€ä¸ªæ ˆå¸§ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€è¿”å›åœ°å€ï¼‰ã€æœ¬åœ°æ–¹æ³•æ ˆï¼ˆnativeæ–¹æ³•ï¼‰ã€PCç¨‹åºè®¡æ•°å™¨ï¼ˆä¸‹ä¸€æ¡æŒ‡ä»¤ä½ç½®çš„æŒ‡é’ˆï¼‰</li>
<li>jmmå†…å­˜æ¨¡å‹ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹å…±äº«å˜é‡çš„åŒæ­¥ï¼Œä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¯è§æ€§ã€æœ‰åºæ€§ã€‚ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ï¼Œå¯è§æ€§volatileçº¿ç¨‹æ›´æ”¹äº†å·¥ä½œå†…å­˜ä¸­çš„å…±äº«å˜é‡å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹é©¬çœ‹åˆ°ï¼Œæœ‰åºæ€§volatileç¦æ­¢æŒ‡ä»¤é‡æ’synchronizedé”ï¼ŒåŸå­æ€§synchronizedå’ŒCASæ— é”çš„åŸå­æ“ä½œ</li>
</ul>
<h2 id="é”ã€å¹¶å‘ç¼–ç¨‹"><a href="#é”ã€å¹¶å‘ç¼–ç¨‹" class="headerlink" title="é”ã€å¹¶å‘ç¼–ç¨‹"></a>é”ã€å¹¶å‘ç¼–ç¨‹</h2><ul>
<li><p>javaæœ‰å“ªäº›é”ï¼šå†…ç½®é”synchronizedã€é‡å…¥é”ReentrantLockã€è¯»å†™é”ReadWriteLockã€æ¡ä»¶é”Condition</p>
</li>
<li><p>synchronizedï¼šå†…ç½®é”ï¼Œæ§åˆ¶å¯¹å…±äº«èµ„æºè®¿é—®çš„åŒæ­¥æœºåˆ¶ï¼Œä¿®é¥°å®ä¾‹æ–¹æ³•ã€é™æ€æ–¹æ³•ã€ä»£ç å—ï¼ŒåŸç†ï¼šå¯¹è±¡å¤´MarkWordï¼Œè®°å½•hashCodeã€é”æ ‡å¿—ã€GCå¹´é¾„ã€‚ä¿®é¥°ä»£ç å—monitorenterå’Œmonitorexistå­—èŠ‚ç æŒ‡ä»¤ã€‚ä¿®é¥°æ–¹æ³•flagsæŒ‡ä»¤ï¼Œé”çš„è®¡æ•°å™¨ã€‚é”å‡çº§ï¼šæ— é”ã€åå‘é”ï¼ˆè®°å½•çº¿ç¨‹æŒ‡é’ˆï¼‰ã€è½»é‡çº§é”ï¼ˆCASè‡ªæ—‹ï¼‰ã€é‡é‡çº§é”ï¼ˆé˜»å¡çº¿ç¨‹ï¼‰</p>
</li>
<li><p>volatileï¼šè½»é‡çº§çš„synchronizedï¼Œä¿è¯å…±äº«å˜é‡çš„å¯è§æ€§ï¼Œè¯»å†™æ“ä½œç›´æ¥å¯¹ä¸»å†…å­˜è¿›è¡Œï¼Œä¸ä¼šå¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œè°ƒåº¦ã€‚ç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚lockå‰ç¼€æŒ‡ä»¤ï¼Œç›¸å½“äºå†…å­˜å±éšœã€‚ä¿è¯åŸå­æ“ä½œçº¿ç¨‹å®‰å…¨ã€‚éåŸå­æ“ä½œä¸ä¿è¯ï¼Œç”¨AtomicIntegerã€CASã€‚</p>
</li>
<li><p>CASï¼šæ— é”çš„åŸå­æ“ä½œï¼Œç”¨æ¥åœ¨å¹¶å‘ç¼–ç¨‹ä¸­å®ç°æ— é”åŒæ­¥ã€‚éé˜»å¡çš„ï¼Œå‡å°‘é”å¼€é”€ã€‚ABAé—®é¢˜ï¼Œå¯¼è‡´è‡ªæ—‹ï¼Œæ¶ˆè€—CPUï¼Œåªèƒ½ä¸€ä¸ªå˜é‡çš„åŸå­æ“ä½œã€‚</p>
</li>
<li><p>ReentrantLockï¼šå¯é‡å…¥çš„äº’æ–¥é”ï¼Œå¯é‡å…¥ã€APIå±‚é¢é”ã€å¯å“åº”ä¸­æ–­ã€å¯å…¬å¹³ä¸å…¬å¹³ã€Conditionåˆ†ç¦»å¯¹è±¡çš„ç­‰å¾…é›†åˆã€‚åŸç†ï¼šé˜Ÿåˆ—åŒæ­¥å™¨AQSï¼Œä¸­volatileå˜é‡stateè®°å½•é”çš„çŠ¶æ€å’Œé‡å…¥æ¬¡æ•°ï¼ŒCASæ“ä½œæ›´æ–°çŠ¶æ€å˜é‡å’ŒåŠ å…¥ç­‰å¾…é˜Ÿåˆ—å’Œæ›´æ–°é˜Ÿåˆ—å¤´èŠ‚ç‚¹ï¼ŒFIFOé˜Ÿåˆ—ç®¡ç†ç­‰å¾…é”çš„çº¿ç¨‹ã€‚</p>
</li>
<li><p>Conditionï¼šæ¡ä»¶é”ï¼Œä¸ReentrantLockç»“åˆä½¿ç”¨ï¼Œæ›´ç²¾ç»†æ§åˆ¶ç­‰å¾…å”¤é†’ï¼Œæœ‰é€‰æ‹©åœ°å”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹ã€‚</p>
</li>
<li><p>å…¬å¹³é”å’Œéå…¬å¹³é”ï¼šå…¬å¹³é”æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œéå…¬å¹³é”è·é”ä¹‹å‰ä¸ç®¡ç­‰å¾…é˜Ÿåˆ—ï¼Œå‡å°‘å”¤é†’çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚</p>
</li>
<li><p>RentrantLockå¦‚ä½•å®ç°å…¬å¹³éå…¬å¹³ï¼šå­ç±» <code>FairSync</code> å’Œ <code>NonfairSync</code>ã€‚é»˜è®¤éå…¬å¹³é”ï¼Œçº¿ç¨‹å°è¯•ç›´æ¥è·å–é”ï¼Œä¸è€ƒè™‘ç­‰å¾…é˜Ÿåˆ—ä¸­çš„é¡ºåºã€‚æ–°åˆ°æ¥çš„çº¿ç¨‹å¦‚æœæ­¤æ—¶é”æ°å¥½å¯ç”¨ï¼Œåˆ™å¯ä»¥ç›´æ¥è·å–é”ï¼Œå‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæé«˜äº†ååé‡ã€‚å…¬å¹³é”ä¸­ï¼Œè·å–é”æ—¶ä¼šæ£€æŸ¥åŒæ­¥é˜Ÿåˆ—ï¼ˆAQS é˜Ÿåˆ—ï¼‰ä¸­æ˜¯å¦æœ‰æ¯”å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´æ›´é•¿çš„çº¿ç¨‹ã€‚å¦‚æœæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼›å¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹æˆ–è‡ªå·±æ˜¯é˜Ÿåˆ—ä¸­æœ€å‰é¢çš„ï¼Œåˆ™å¯ä»¥å°è¯•è·å–é”ã€‚è¿™æ ·ä¿è¯äº†æœ€å…ˆè¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ä¼˜å…ˆè·å¾—é”ï¼Œéµå¾ªå…ˆæ¥å…ˆæœåŠ¡çš„åŸåˆ™ã€‚</p>
</li>
<li><p>ä¿¡å·é‡Semaphoreï¼šæ§åˆ¶å¯¹æœ‰é™èµ„æºè®¿é—®çš„è®¡æ•°å™¨ï¼Œå®ç°èµ„æºæ± ï¼Œæ§åˆ¶å¹¶å‘æ•°ã€‚permitä¸º1æ—¶äº’æ–¥é”ã€‚</p>
</li>
<li><p>é—­é”CountDownLatchï¼šç”¨äºç­‰å¾…ä¸€ç»„çº¿ç¨‹éƒ½å®Œæˆä¹‹åæ‰ç»§ç»­æ“ä½œï¼Œä¸å¯é‡ç”¨ã€‚</p>
</li>
<li><p>æ …æ CyclicBarrierï¼šä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…éƒ½è¾¾åˆ°æŸä¸ªå±éšœç‚¹å†ç»§ç»­æ‰§è¡Œï¼Œå¯é‡ç”¨ã€‚</p>
</li>
<li><p>è¯»å†™é”ReadWriteLockï¼šå¯åŒæ—¶è¯»ï¼Œå†™æ“ä½œäº’æ–¥ï¼ŒåŸç†AQSï¼ŒçŠ¶æ€å˜é‡æŒ‰ä½åˆ‡å‰²è®°å½•å¤šä¸ªçº¿ç¨‹çŠ¶æ€ã€‚é”é™çº§ï¼šåœ¨é‡Šæ”¾å†™é”ä¹‹å‰å…ˆè·å–è¯»é”ï¼Œé¿å…åœ¨é‡Šæ”¾å†™é”å’Œè·å–è¯»é”ä¹‹é—´å…¶ä»–çº¿ç¨‹ä¿®æ”¹å˜é‡ï¼Œä¿è¯å¯è§æ€§ã€‚å› ä¸ºåŒä¸€çº¿ç¨‹ï¼Œæ‰€ä»¥å…è®¸è·å–è¯»é”ã€‚</p>
</li>
<li><p>AQSï¼šAbstractQueuedSynchronizeré˜Ÿåˆ—åŒæ­¥å™¨ï¼ŒåŸºäºFIFOç­‰å¾…é˜Ÿåˆ—çš„åŒæ­¥æ¡†æ¶ï¼Œvolatileå’ŒCASå®ç°åŒæ­¥çŠ¶æ€ç®¡ç†ï¼Œå†…ç½®FIFOé˜Ÿåˆ—å®ç°çº¿ç¨‹æ’é˜Ÿç­‰å¾…æœºåˆ¶ã€‚æ„å»ºå„ç§é˜»å¡æ€§è´¨çš„åŒæ­¥å™¨ã€‚</p>
</li>
<li><p>é”ä¼˜åŒ–ï¼š1.å‡å°é”ç²’åº¦ï¼šå¤§é”å˜ä¸ºä¸åŒçš„å°é”æ¥å‡å°‘é”ç«äº‰æé«˜å¹¶å‘ï¼Œä¾‹å¦‚ConcurrentHashMapçš„åˆ†æ®µé”ã€‚2.é”åˆ†ç¦»ï¼šè¯»å†™åˆ†ç¦»ReadWriteLockè¯»é”å…±äº«å†™é”ç‹¬å ã€‚3.é”æ¶ˆé™¤ï¼šä¸å¿…è¦çš„ä¸åŠ é”ï¼Œå‡å°‘é”æŒæœ‰æ—¶é—´ã€‚4.é”ç²—åŒ–ï¼šçŸ­æ—¶é—´é‡å¤è·å–åŒä¸€é”ï¼Œå°†é”èŒƒå›´æ‰©å¤§ï¼Œå‡å°‘é”å¼€é”€ã€‚5.ä½¿ç”¨æ— é”æ•°æ®ç»“æ„ï¼šCopyOnWriteArrayListï¼Œatomicä¸‹çš„åŸå­ç±»ï¼Œvolatile+casï¼Œå®ç°æ— é”çš„çº¿ç¨‹å®‰å…¨æ“ä½œã€‚</p>
</li>
<li><p>CopyOnWriteArrayListï¼šçº¿ç¨‹å®‰å…¨çš„ArrayListã€‚å†™æ—¶å¤åˆ¶ã€‚è¯»å–çš„æ—¶å€™åœ¨å½“å‰æ•°ç»„è¿›è¡Œï¼Œä¿®æ”¹çš„æ—¶å€™ï¼Œå¤åˆ¶å½“å‰åˆ—è¡¨ï¼Œåœ¨æ–°åˆ—è¡¨ä¸Šä¿®æ”¹ï¼Œç„¶åå°†åŸåˆ—è¡¨å¼•ç”¨æŒ‡å‘æ–°çš„åˆ—è¡¨ã€‚è¿™ä¸ªæ›´æ–°æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œä½¿ç”¨volatile å˜é‡æ¥å­˜å‚¨åº•å±‚æ•°ç»„çš„å¼•ç”¨ï¼Œå†™æ“ä½œåœ¨è¯»æ“ä½œä¹‹å‰å®Œæˆã€‚</p>
</li>
<li><p>æ‚²è§‚é”å’Œä¹è§‚é”ï¼šæ‚²è§‚é”è®¤ä¸ºå†²çªæ™®éå­˜åœ¨ï¼Œé˜»æ­¢å¹¶å‘è®¿é—®ä¿è¯ä¸€è‡´æ€§ã€‚ä¹è§‚é”é€šè¿‡æ•°æ®ç‰ˆæœ¬å·æ¥æ£€æµ‹å†²çªï¼Œå†²çªä¹‹åæ’¤é”€æˆ–é‡è¯•ã€‚</p>
</li>
<li><p>æ­»é”ï¼šå¤šçº¿ç¨‹äº’ç›¸æŒæœ‰å’Œç­‰å¾…å¯¹æ–¹çš„èµ„æºï¼Œå½¢æˆå¾ªç¯ç­‰å¾…ã€‚äº’æ–¥æ¡ä»¶ã€è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ã€ä¸å¯å‰¥å¤ºæ¡ä»¶ã€å¾ªç¯ç­‰å¾…æ¡ä»¶ã€‚CASç ´åäº’æ–¥æ¡ä»¶ï¼Œé“¶è¡Œå®¶ç®—æ³•åˆ†é…èµ„æºä¹‹å‰å…ˆæ£€æŸ¥æ˜¯å¦ä¼šæ­»é”ï¼Œç ´åå¾ªç¯ç­‰å¾…ã€‚</p>
</li>
<li><p>çº¿ç¨‹æ± ï¼šç®¡ç†ä¸€ç³»åˆ—çº¿ç¨‹çš„èµ„æºæ± ï¼Œé¿å…çº¿ç¨‹é¢‘ç¹åˆ›å»ºé”€æ¯å¼€é”€ï¼Œæé«˜å“åº”é€Ÿåº¦ã€‚1.ThreadPoolExecutoræ„é€ å‡½æ•°åˆ›å»ºï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€é˜»å¡é˜Ÿåˆ—ã€æœ€å¤§çº¿ç¨‹å­˜æ´»æ—¶é—´ã€threadFactoryã€é¥±å’Œç­–ç•¥ï¼‰2.Executorså·¥å…·ç±»åˆ›å»ºï¼ˆä¸æ¨èï¼Œä½¿ç”¨æ— ç•Œé˜»å¡é˜Ÿåˆ—OOMï¼ŒCachedThreadPoolä½¿ç”¨åŒæ­¥é˜Ÿåˆ—åˆ›å»ºçº¿ç¨‹æ•°æ— é™åˆ¶OOMï¼‰</p>
</li>
<li><p>çº¿ç¨‹æ± é¥±å’Œç­–ç•¥ï¼šAbortPolicyæŠ›å‡ºå¼‚å¸¸æ¥æ‹’ç»ã€CallerRunsPolicyè°ƒç”¨çº¿ç¨‹ä¸­è¿è¡Œã€DiscardPolicyç›´æ¥ä¸¢å¼ƒã€DiscardOldestPolicyä¸¢å¼ƒæœ€æ—©æœªå¤„ç†çš„ã€‚</p>
</li>
<li><p>çº¿ç¨‹æ± é˜»å¡é˜Ÿåˆ—ï¼šArrayBlockingQueueåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—FIFOã€LinkedBlockingQueueåŸºäºé“¾è¡¨çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€SynchronousQueueåŒæ­¥é˜Ÿåˆ—æ— å®¹é‡ã€DelayQueueå»¶è¿Ÿæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå»¶è¿ŸæœŸæ»¡æ—¶ä»é˜Ÿåˆ—å–å‡ºã€PriorityBlockingQueueæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p>
</li>
<li><p>çº¿ç¨‹æ± å¤„ç†é¡ºåºï¼šæ ¸å¿ƒçº¿ç¨‹ã€ä»»åŠ¡é˜Ÿåˆ—ã€æœ€å¤§çº¿ç¨‹ã€é¥±å’Œç­–ç•¥</p>
</li>
<li><p>ThreadPoolExecutorçš„executeå’Œsubmitï¼š1.executeæ˜¯Executoræ–¹æ³•ï¼Œsubmitæ˜¯ExecutorServiceæ–¹æ³•ã€‚2.executeåªæ¥æ”¶Runnableï¼Œå‡ºç°å¼‚å¸¸åŸåœ°æŠ›å‡ºã€‚submitæ¥æ”¶Runnableå’ŒCallableï¼Œè¿”å›Futureï¼Œæ•è·å¼‚å¸¸åœ¨future.getæ–¹æ³•ä¸­æŠ›å‡ºã€‚</p>
</li>
<li><p>happens-beforeï¼šå‘ç¨‹åºå‘˜æä¾›è·¨çº¿ç¨‹çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚volatileè§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileçš„å†™happens - beforeåç»­å¯¹è¿™ä¸ªvolatileçš„è¯»ã€‚ç›‘è§†å™¨è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”happens - beforeéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸè§„åˆ™ï¼šstartã€joinã€‚</p>
</li>
</ul>
<h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><ul>
<li>Threadçš„runæ–¹æ³•å’Œstartæ–¹æ³•ï¼š1.newä¸€ä¸ªThreadï¼Œè°ƒç”¨startæ–¹æ³•ï¼Œè¡¨ç¤ºå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…åˆ†é…åˆ°æ—¶é—´ç‰‡åè¿è¡Œã€‚æ˜¯å¤šçº¿ç¨‹å·¥ä½œã€‚2.ç›´æ¥æ‰§è¡Œrunæ–¹æ³•ä¸ä¼šä»¥å¤šçº¿ç¨‹æ–¹å¼æ‰§è¡Œã€‚</li>
<li>åˆ›å»ºçº¿ç¨‹æ–¹å¼ï¼š1âƒ£ï¸ç»§æ‰¿Threadç±»ï¼Œé‡å†™runæ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡è°ƒç”¨startæ–¹æ³•ã€‚2âƒ£ï¸å®ç°Runnableæ¥å£ï¼Œé‡å†™runæ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™Threadçš„æ„é€ æ–¹æ³•ï¼Œè°ƒç”¨startã€‚æˆ–è€…ä¼ é€’ç»™çº¿ç¨‹æ± çš„submit&#x2F;executeæ–¹æ³•ã€‚3âƒ£ï¸å®ç°Callableæ¥å£ï¼Œé‡å†™callæ–¹æ³•ï¼Œæœ‰è¿”å›ï¼Œåˆ›å»ºFutureTaskå¯¹è±¡ï¼Œcallableå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™FutureTaskæ„é€ å‡½æ•°ã€‚å°†FutureTaskå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™Threadæ„é€ å‡½æ•°ï¼Œè°ƒç”¨startã€‚æ‰§è¡ŒfutureTask.get()æ–¹æ³•è·å–çº¿ç¨‹æ‰§è¡Œçš„ç»“æœã€‚</li>
<li>Runnableå’ŒThreadï¼š1âƒ£ï¸javaå•ç»§æ‰¿ï¼ŒThreadç±»æœ‰å±€é™æ€§ã€‚Threadç±»å®ç°äº†Runnableæ¥å£ã€‚2âƒ£ï¸Runnableæ›´å®¹æ˜“å¯ä»¥å®ç°å¤šä¸ªçº¿ç¨‹é—´çš„èµ„æºå…±äº«ï¼Œæäº¤ç»™ThreadåŒä¸€ä¸ªRunnableå¯¹è±¡ï¼Œå…±äº«å…¶ä¸­çš„privateå¯¹è±¡ã€‚ï¼ˆåªæ˜¯å…±äº«ï¼Œçº¿ç¨‹å®‰å…¨è¦åŠ åŒæ­¥ï¼‰ã€‚å¤šä¸ªthreadå¯¹è±¡å…±äº«staticå˜é‡ã€‚</li>
<li>Runnableå’ŒCallableï¼š1.æ–¹æ³•ç­¾åä¸åŒï¼ŒRunnableæ˜¯runæ–¹æ³•ï¼ŒCallableæ˜¯callæ–¹æ³•ã€‚2.è¿”å›å€¼ç±»å‹ä¸åŒï¼ŒRunnableæ— è¿”å›ï¼ŒCallableçš„callæ–¹æ³•è¿”å›æŒ‡å®šç±»å‹ç»“æœï¼Œé€šè¿‡Futureæ¥å£è·å–æ‰§è¡Œç»“æœã€‚3.å¼‚å¸¸å¤„ç†ä¸åŒï¼šRunnableå¼‚å¸¸åŸåœ°æŠ›å‡ºï¼ŒCallableçš„callæ–¹æ³•é€šè¿‡Future.getæ–¹æ³•æ¥æ•è·å¼‚å¸¸ä¿¡æ¯ã€‚</li>
<li>çº¿ç¨‹çŠ¶æ€ï¼šåˆ›å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡ã€ç­‰å¾…ã€å®šæ—¶ç­‰å¾…ã€ç»ˆæ­¢ã€‚1âƒ£ï¸startæ–¹æ³•åç­‰å¾…JVMè°ƒåº¦ï¼Œå°±ç»ªã€‚è°ƒåº¦åˆ°ä¹‹åæ˜¯è¿è¡Œã€‚2âƒ£ï¸è¿è¡Œåˆ°å°±ç»ªï¼šThread.yieldæ–¹æ³•ä½¿çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œè®©å‡ºCPUèµ„æºç»™å…¶ä»–çº¿ç¨‹æ‰§è¡Œã€‚3âƒ£ï¸é˜»å¡çŠ¶æ€ï¼šçº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå‘å‡ºI&#x2F;Oè¯·æ±‚æ—¶ï¼Œè¯¥çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚å½“çº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­å°è¯•è·å–åŒæ­¥é”æ—¶ï¼Œå´è¢«å¦ä¸€ä¸ªçº¿ç¨‹è·å–ï¼Œæ­¤æ—¶JVMæŠŠå½“å‰çº¿ç¨‹å­˜åˆ°å¯¹è±¡çš„é”æ± ä¸­ï¼Œè¯¥çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚4âƒ£ï¸é˜»å¡åˆ°è¿è¡Œï¼šè·å–åˆ°é”ã€‚5âƒ£ï¸è¿è¡Œåˆ°ç­‰å¾…ï¼šè°ƒç”¨o.wait()æ–¹æ³•å’Œthread.join()æ–¹æ³•ï¼ˆè¡¨ç¤ºç­‰å¾…è°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹ç»“æŸï¼Œå½“å‰çº¿ç¨‹æ‰ç»§ç»­æ‰§è¡Œï¼‰ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚6âƒ£ï¸å®šæ—¶ç­‰å¾…ï¼šThread.sleepæ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œä¸é‡Šæ”¾é”ã€‚o.waitæ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé‡Šæ”¾åŒæ­¥é”ï¼Œwaitæ–¹æ³•éœ€è¦åœ¨åŒæ­¥æ–¹æ³•&#x2F;ä»£ç å—ä¸­ã€‚7âƒ£ï¸notifyæ–¹æ³•å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ï¼Œè¿›å…¥å°±ç»ªçŠ¶æ€ã€‚</li>
<li>è¿›ç¨‹å’Œçº¿ç¨‹ï¼šè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•å…ƒã€‚çº¿ç¨‹æ˜¯å¤„ç†å™¨ä»»åŠ¡è°ƒåº¦å’Œæ‰§è¡Œçš„åŸºæœ¬å•å…ƒã€‚å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒºï¼Œä¸å…±äº«æ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚</li>
<li>ThreadLocalï¼šæ˜¯çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œçº¿ç¨‹ç§æœ‰ï¼Œå®ç°çº¿ç¨‹ä¹‹é—´çš„æ•°æ®éš”ç¦»ï¼Œé¿å…ä½¿ç”¨å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚æ³¨æ„åœ¨çº¿ç¨‹æ± ä¸­ï¼Œçº¿ç¨‹è¢«å¤ç”¨ï¼Œéœ€è¦åŠæ—¶æ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li>
<li>ThreadLocalå’ŒThreadLocalMapçš„å…³ç³»ï¼šThreadLocalMapæ˜¯ThreadLocalçš„å†…éƒ¨æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªThreadå¯¹è±¡æœ‰ä¸€ä¸ªThreadLocalMapå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨çº¿ç¨‹å±€éƒ¨å˜é‡çš„é”®å€¼å¯¹ï¼Œé”®æ˜¯ThreadLocaå¯¹è±¡ï¼Œå€¼æ˜¯ThreadLocalå¯¹è±¡å­˜çš„å±€éƒ¨å˜é‡ã€‚æ¯ä¸ªçº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªThreadLocalå¯¹è±¡ã€‚</li>
<li>ThreadLocalä¸ºä»€ä¹ˆå†…å­˜æ³„éœ²ï¼šæ¯ä¸ªçº¿ç¨‹çš„ThreadLocalMapï¼Œkeyæ˜¯ThreadLocalå¯¹è±¡ï¼ˆå¼±å¼•ç”¨ï¼‰ï¼Œvalueæ˜¯å­˜å…¥çš„å€¼ï¼ˆå¼ºå¼•ç”¨ï¼‰ã€‚ThreadLocalå¯¹è±¡ä½œä¸ºkeyæ˜¯å¼±å¼•ç”¨ï¼Œå¤–éƒ¨å¼ºå¼•ç”¨æ¶ˆå¤±åï¼ŒGCç›´æ¥å›æ”¶ï¼Œä½†valueè¿˜è¢«å¼ºå¼•ç”¨é”æ­»ã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åå¤åˆ©ç”¨ï¼ŒThreadLocalMapè·Ÿç€é•¿å¯¿ã€‚Mapé‡Œçš„åºŸå¼ƒç‰©å“ï¼ˆnull key + valueï¼‰è¶Šç§¯è¶Šå¤šï¼Œç›´åˆ°OOMã€‚ä¸è°ƒç”¨set&#x2F;get&#x2F;removeï¼ŒThreadLocalMapä¸ä¼šè‡ªåŠ¨æ¸…ç†null keyçš„Entryã€‚</li>
<li>ThreadLocalä¸ºä»€ä¹ˆä¸ç”¨å¼ºå¼•ç”¨ï¼šç”¨å¼ºå¼•ç”¨â†’ThreadLocalå¯¹è±¡æ°¸ä¸å›æ”¶ï¼Œæ³„æ¼æ›´ä¸¥é‡ï¼å¼±å¼•ç”¨è‡³å°‘èƒ½å›æ”¶keyï¼Œç»™ç¨‹åºå‘˜ä¸€ä¸ªè¡¥æ•‘æœºä¼šã€‚æ‰€ä»¥ï¼Œç”¨å®Œå¿…é¡»è¦removeã€‚çº¿ç¨‹ç»“æŸä¼šè‡ªåŠ¨æ¸…ç†ï¼Œä½†æ˜¯çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ°¸ä¸ç»“æŸã€‚</li>
<li>ThreadLocalMapå¦‚ä½•æ¸…ç†ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ç»ˆæ­¢æ—¶ï¼Œè¯¥çº¿ç¨‹çš„ <code>ThreadLocalMap</code> ä¼šéšç€çº¿ç¨‹å¯¹è±¡ä¸€èµ·è¢«åƒåœ¾å›æ”¶å™¨è‡ªåŠ¨æ¸…ç†ã€‚åœ¨ <code>set(T value)</code> å’Œ <code>get()</code> æ“ä½œä¸­ï¼Œå¦‚æœå‘ç°æŸä¸ª <code>Entry</code> çš„ <code>key</code> å·²ç»ä¸º <code>null</code>ï¼ˆå³ <code>ThreadLocal</code> è¢«åƒåœ¾å›æ”¶äº†ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ª <code>Entry</code> ä¼šè¢«ä» <code>ThreadLocalMap</code> ä¸­ç§»é™¤ã€‚å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„çº¿ç¨‹æˆ–çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œå¦‚æœä¸ä¸»åŠ¨æ¸…é™¤ä¸å†éœ€è¦çš„ <code>ThreadLocal</code> å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸º <code>ThreadLocalMap</code> ä¸­çš„å€¼æ˜¯å¼ºå¼•ç”¨ç±»å‹çš„ï¼Œå³ä½¿å¯¹åº”çš„ <code>ThreadLocal</code> å®ä¾‹å·²ç»è¢«åƒåœ¾å›æ”¶äº†ï¼ˆ<code>ThreadLocalMap</code> çš„é”®ä¸ºå¼±å¼•ç”¨ï¼‰ï¼Œåªè¦çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œè¿™äº›å€¼å°±ä¸ä¼šè¢«é‡Šæ”¾ã€‚çº¿ç¨‹æ± ä¸­ï¼Œåœ¨finallyä¸­ä½¿ç”¨<code>threadLocal.remove();</code>æ‰‹åŠ¨æ¸…ç†ã€‚</li>
</ul>
<h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><ul>
<li>SPIï¼šservice provider interfaceï¼ŒæœåŠ¡åŠ è½½æœºåˆ¶ï¼ŒMETA-INFä¸­é…ç½®æ¥å£å’Œå®ç°ï¼ŒServiceLoaderè¿è¡Œæ—¶å‘ç°å’ŒåŠ è½½å®ç°ï¼Œå¯åŠ¨æ€æ›¿æ¢æœåŠ¡å®ç°ã€‚æä¾›å¯æ‰©å±•çš„æ–¹å¼ï¼Œä½¿å¾—ç¬¬ä¸‰æ–¹æœåŠ¡å¯ä»¥æä¾›æ–°çš„å®ç°æˆ–è‡ªå®šä¹‰åŠŸèƒ½ï¼Œè§£è€¦æ¥å£å’ŒæœåŠ¡å®ç°ã€‚åº”ç”¨ï¼šJDBCé©±åŠ¨åŠ è½½ï¼Œæ—¥å¿—æ¡†æ¶é€‰æ‹©ã€‚</li>
</ul>
<h2 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h2><ul>
<li>IOï¼šæ¶‰åŠåˆ°æ•°æ®çš„å­˜å‚¨ã€äº¤æ¢ï¼Œéƒ½ç”¨IOï¼Œæ–‡ä»¶IOã€ç½‘ç»œIO</li>
<li>BIOï¼šåŒæ­¥é˜»å¡IOï¼Œæ¯æ¥ä¸€ä¸ªæ–°è¿æ¥å°±éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œæ•°æ®çš„è¯»å–å†™å…¥éƒ½éœ€è¦é˜»å¡åœ¨çº¿ç¨‹ä¸­ã€‚æµªè´¹çº¿ç¨‹èµ„æºï¼Œä¸é€‚åˆå•æœºè¿‡å¤šè¿æ¥ã€‚</li>
<li>NIOï¼šåŒæ­¥éé˜»å¡IOï¼Œçº¿ç¨‹å‘èµ·IOæ“ä½œï¼Œå¦‚æœæ•°æ®è¿˜æ²¡å‡†å¤‡å¥½ï¼Œå¯ç«‹å³è¿”å›æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚æ•°æ®å†™å…¥è¯»å–ä¸å†é˜»å¡ï¼Œä½†æ˜¯éœ€è¦ç­‰å¾…IOæ“ä½œå®Œæˆï¼Œå¯åŒæ—¶å¤„ç†å¤šä¸ªSocketè¯·æ±‚ã€‚é€‚ç”¨è¿æ¥å¤šä¸”æ¯”è¾ƒçŸ­çš„ã€‚</li>
<li>NIOå¤šè·¯å¤ç”¨ï¼šèƒŒæ™¯ï¼šåº”ç”¨ç¨‹åºè¯¢é—®æ•°æ®æ˜¯å¦å°±ç»ªéœ€è¦ç³»ç»Ÿè°ƒç”¨ã€‚å› æ­¤ä¸ºäº†è§£å†³é¢‘ç¹ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€æ¬¡å‘å†…æ ¸ä¼ é€’å¤šä¸ªéœ€è¦è¯¢é—®çš„Socketæ˜¯å¦å°±ç»ªï¼ˆSeletorï¼‰ã€‚selectã€pollå®ç°å¤šè·¯å¤ç”¨çš„æœºåˆ¶ï¼Œç›‘æ§å¤šä¸ªç½‘ç»œè¿æ¥çš„IOäº‹ä»¶ï¼Œpollæ²¡æœ‰æœ€å¤§è¿æ¥æ•°é™åˆ¶ã€‚epollæä¾›äº†æ›´é«˜æ•ˆçš„äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œåœ¨å†…æ ¸æ€å¼€è¾Ÿäº†ä¸¤ä¸ªé›†åˆï¼Œç©ºé—´æ¢æ—¶é—´ï¼Œä¸éœ€è¦æ¯æ¬¡ä¼ å…¥æ•´ä¸ªSocketé›†åˆï¼Œå‡å°‘æ‹·è´ï¼Œä¸éœ€è¦ä¸»åŠ¨åœ°å¯¹æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œè½®è¯¢ã€‚ï¼ˆå•çº¿ç¨‹ç›‘æ§å¤šä¸ªç½‘ç»œé€šé“ï¼Œè½®è¯¢é€šé“æ˜¯å¦å‡†å¤‡å¥½ï¼Œepollé€šé“å‡†å¤‡å¥½æ—¶å¾—åˆ°é€šçŸ¥ï¼‰</li>
<li>epollï¼š1âƒ£ï¸epoll_create:åœ¨å†…æ ¸ç”³è¯·ä¸€å—å†…å­˜åŒºåŸŸç”¨äºå­˜å‚¨éœ€è¦ç›‘æ§çš„fdï¼Œçº¢é»‘æ ‘å­˜å‚¨ã€‚2âƒ£ï¸epoll_ctl:å°†éœ€è¦ç›‘æ§çš„fdæ·»åŠ åˆ°åˆ›å»ºçš„é›†åˆä¸­ã€‚3âƒ£ï¸epoll_wait:è°ƒç”¨epoll_waitä»¥ç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼Œè¿™ä¸ªè°ƒç”¨ä¼šé˜»å¡ç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæˆ–è€…è¶…æ—¶ã€‚è¿”å›å°±ç»ªçš„fdé›†åˆï¼Œé“¾è¡¨å­˜å‚¨ã€‚å¼€å‘è€…åªéœ€è¦éå†è¿™ä¸ªåˆ—è¡¨å¹¶å¤„ç†æ¯ä¸ªäº‹ä»¶ã€‚</li>
<li>IOå¤šè·¯å¤ç”¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼šä¸€ä¸ªçº¿ç¨‹ç›‘å¬æ–°è¿æ¥çš„æ¥å…¥ã€‚è‹¥å¹²ä¸ªçº¿ç¨‹è´Ÿè´£å¤šä¸ªSocketçš„è¯»å†™ã€‚</li>
<li>AIOï¼šå¼‚æ­¥éé˜»å¡IOï¼Œjdk1.7å‡çº§ï¼Œå‘èµ·IOè¯·æ±‚åç«‹å³ç»§ç»­æ‰§è¡Œåç»­ä»£ç ï¼Œä¸éœ€è¦ç­‰å¾…IOæ“ä½œå®Œæˆã€‚å®Œæˆé€šè¿‡å›è°ƒäº‹ä»¶é€šçŸ¥æ¥å‘ŠçŸ¥è°ƒç”¨è€…ã€‚windowsä¸­æ“ä½œç³»ç»Ÿå®ç°ï¼ŒLinuxä¸­ä½¿ç”¨è‡ªå»ºçº¿ç¨‹æ± å®ç°ã€‚</li>
<li>Socketï¼›ç½‘ç»œé€šä¿¡åŸºæœ¬æ¦‚å¿µï¼Œä¸¤ç¨‹åºè¿æ¥è¿›è¡Œæ•°æ®äº¤æ¢</li>
<li>Channelï¼šèƒ½è¿›è¡Œè¯»å†™æ“ä½œçš„IOé€šé“ã€‚</li>
<li>Selectorï¼šå¯ä»¥ç›‘è§†å¤šä¸ªChannelçš„IOäº‹ä»¶ã€‚Channelæ³¨å†Œåœ¨Selectorä¸Šï¼Œå…è®¸å•çº¿ç¨‹ç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ã€‚</li>
<li>FDï¼šLinuxä¸­ä¸€åˆ‡çš†æ–‡ä»¶ã€‚æ— è®ºæ–‡ä»¶ã€Socketã€è®¾å¤‡æ–‡ä»¶ã€‚File Descriptoræ–‡ä»¶æè¿°ç¬¦ï¼Œçœ‹ä½œæ–‡ä»¶çš„idã€‚è¿›ç¨‹çº§åˆ«çš„èµ„æºå¥æŸ„ï¼Œæä¾›è®¿é—®æ–‡ä»¶çš„æŠ½è±¡å±‚ã€‚</li>
<li>Linuxç³»ç»Ÿåˆ†ä¸‰å±‚ï¼šUserã€Kernelã€Hardware</li>
<li>ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼šå†…æ ¸æ€æ˜¯æ§åˆ¶è®¡ç®—æœºç¡¬ä»¶èµ„æºï¼Œä¾‹å¦‚åè°ƒCPUåˆ†é…å†…å­˜ç©ºé—´ã€‚ç”¨æˆ·æ€æ˜¯æä¾›åº”ç”¨ç¨‹åºè¿è¡Œçš„ç©ºé—´ã€‚å†…æ ¸æä¾›çš„ä¸€ç»„é€šç”¨çš„è®¿é—®å†…æ ¸ç®¡ç†èµ„æºçš„æ¥å£æ˜¯ç³»ç»Ÿè°ƒç”¨ã€‚ç³»ç»Ÿè°ƒç”¨éœ€è¦å†…æ ¸æ€å’Œç”¨æˆ·æ€çš„åˆ‡æ¢ï¼Œæ¶‰åŠåˆ°CPUä¸­æ–­ã€å †æ ˆåˆ‡æ¢ã€å¯„å­˜å™¨ä¿å­˜ã€‚</li>
</ul>
<h2 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h2><ul>
<li><p>æ­»äº¡å¯¹è±¡åˆ¤æ–­æ–¹æ³•ï¼š1.å¼•ç”¨è®¡æ•°æ³•ï¼šç»™å¯¹è±¡åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œè¢«å¼•ç”¨+1ï¼Œå¼•ç”¨å¤±æ•ˆ-1ï¼Œæ— æ³•è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚2.å¯è¾¾æ€§åˆ†ææ³•ï¼šGC Rootä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»å®ƒä»¬å‘ä¸‹æœç´¢ï¼Œèµ°è¿‡çš„è·¯å¾„å«åšå¼•ç”¨é“¾ï¼Œä¸€ä¸ªå¯¹è±¡ä¸æ‰€æœ‰GC Rootéƒ½ä¸ç›¸è¿ï¼Œéœ€è¦è¢«å›æ”¶ã€‚</p>
</li>
<li><p>å¯è¾¾æ€§åˆ†æä¸­çš„ä¸¤æ¬¡æ ‡è®°ï¼šå¯è¾¾æ€§åˆ†æä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œå¹¶ä¸æ˜¯éæ­»ä¸å¯ï¼Œè€Œæ˜¯ç¼“åˆ‘ï¼Œéœ€è¦ä¸¤æ¬¡æ ‡è®°ã€‚ä¸€æ¬¡æ ‡è®°ç­›é€‰æ˜¯å¦éœ€è¦æ‰§è¡Œfinalizeæ–¹æ³•ï¼Œéœ€è¦è¿›å…¥ä¸‹ä¸€æ¬¡æ ‡è®°ã€‚ç¬¬äºŒæ¬¡æ ‡è®°æŸ¥çœ‹å¯¹è±¡finalizeæ–¹æ³•ä¸­å¯¹è±¡æ˜¯å¦è¢«å…¶ä»–å­˜æ´»çš„å¯¹è±¡å¼•ç”¨ï¼Œå¦‚æœæ˜¯é‚£ä¹ˆè¯¥å¯¹è±¡å°†å˜æˆå¯è¾¾çš„ã€‚finalizeç”¨æ¥åšå¤–éƒ¨èµ„æºæ¸…ç†ï¼Œè¢«try finallyå–ä»£ã€‚</p>
</li>
<li><p>åƒåœ¾æ”¶é›†ç®—æ³•ï¼š1âƒ£ï¸æ ‡è®°æ¸…é™¤ï¼šæ ‡è®°è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åç»Ÿä¸€å›æ”¶ã€‚ä¼šäº§ç”Ÿä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ã€‚2âƒ£ï¸æ ‡è®°å¤åˆ¶ï¼šyoungä½¿ç”¨ï¼Œå†…å­˜åˆ†ä¸ºä¸¤å—å„¿ï¼Œä¸€å—å„¿ä½¿ç”¨å®Œåï¼Œå°†å­˜æ´»çš„å¤åˆ¶åˆ°å¦ä¸€å—å„¿ï¼Œç„¶åæ¸…é™¤ã€‚å†…å­˜å‹ç¼©ä¸€åŠï¼Œå¤åˆ¶æ•ˆç‡ä½ã€‚3âƒ£ï¸æ ‡è®°æ•´ç†ï¼šoldä½¿ç”¨ï¼ŒæŠŠå­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…é™¤è¾¹ç•Œå¤–çš„å†…å­˜ã€‚è§£å†³ä¸è¿ç»­å†…å­˜ç¢ç‰‡ï¼Œä½†æ˜¯ç§»åŠ¨å­˜æ´»å¯¹è±¡å¹¶æ›´æ–°å¼•ç”¨è´Ÿæ‹…å¤§ã€‚åœé¡¿æ—¶é—´é•¿ã€‚4âƒ£ï¸åˆ†ä»£ï¼šæ–°ç”Ÿä»£ï¼šæ¯æ¬¡å­˜æ´»å¯¹è±¡è¾ƒå°‘ï¼Œå¤åˆ¶æ“ä½œå°‘ï¼Œç”¨æ ‡è®°å¤åˆ¶ï¼Œæ–°ç”Ÿä»£åˆ†ä¸ºè¾ƒå¤§çš„edenå’Œä¸¤ä¸ªè¾ƒå°çš„survivorï¼Œæ¯æ¬¡ä½¿ç”¨edenå’Œä¸€å—å„¿survivorï¼Œå›æ”¶æ—¶å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å„¿survivorã€‚å›æ”¶æ—¶ä¸ç”¨ä¸­æ–­åº”ç”¨ç¨‹åºæ‰§è¡Œï¼Œé¿å…ç¢ç‰‡åŒ–é—®é¢˜ã€‚è€å¹´ä»£å­˜æ´»ç‡è¾ƒé«˜ï¼Œæ²¡æœ‰é¢å¤–ç©ºé—´åˆ†é…æ‹…ä¿ï¼Œé€‰ç”¨æ ‡è®°æ¸…é™¤&#x2F;æ ‡è®°æ•´ç†ã€‚</p>
</li>
<li><p>edenã€survivorã€oldåˆ†é…é¡ºåºï¼šå¯¹è±¡ä¼˜å…ˆåœ¨edenåŒºåˆ†é…ï¼Œå¤§å¯¹è±¡å’Œé•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚ä¸€æ¬¡minor gcä¹‹åå­˜æ´»åœ¨survivorä¸­çš„å¯¹è±¡1å²ï¼Œæ­¤åæ¯åœ¨survivorä¸­ç†¬è¿‡ä¸€æ¬¡minor gcå°±+1å²ï¼Œè¾¾åˆ°é˜ˆå€¼æˆ–ä¸€åŠè¶…è¿‡åŒä¸€å¹´é¾„å°±æ™‹å‡è€å¹´ä»£ã€‚</p>
</li>
<li><p>ç©ºé—´åˆ†é…æ‹…ä¿ï¼šåœ¨minor gcä¹‹å‰ï¼Œè™šæ‹Ÿæœºæ£€æŸ¥è€å¹´ä»£çš„æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæˆç«‹ï¼Œminor gcå®‰å…¨ã€‚å¦‚æœä¸æˆç«‹ï¼Œçœ‹è™šæ‹Ÿæœºæ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå…è®¸çš„è¯æ£€æŸ¥ä¹‹å‰å†æ¬¡æ™‹å‡è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºåˆ™å°è¯•minor gcã€‚å¦‚æœå°äºæˆ–ä¸å…è®¸æ‹…ä¿å¤±è´¥ç›´æ¥full gcã€‚</p>
</li>
<li><p>å‡ ä¸ªgcï¼š1âƒ£ï¸minor gcï¼šä¹Ÿå«young gcï¼Œåœ¨æ–°ç”Ÿä»£ç©ºé—´ä¸è¶³æ—¶è§¦å‘ã€‚2âƒ£ï¸major gcï¼šè€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶è§¦å‘ï¼Œé€šå¸¸æ¶‰åŠæ•´ä¸ªå †çš„å›æ”¶ã€‚CMSä¸­ä¸ä¼šåœæ­¢æ‰€æœ‰çº¿ç¨‹ã€‚3âƒ£ï¸full gcï¼šåœæ­¢åº”ç”¨ç¨‹åºæ‰§è¡Œï¼Œæ•´ä¸ªå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚è€å¹´ä»£ä¸è¶³ã€å…ƒç©ºé—´ä¸è¶³ã€æ˜¾ç¤ºè°ƒç”¨System.gcã€æ‹…ä¿å¤±è´¥ã€‚</p>
</li>
<li><p>åƒåœ¾æ”¶é›†å™¨CMSï¼šConcurrent Mark Sweepï¼Œjdk8çš„ï¼Œå…³æ³¨æœ€çŸ­åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´ï¼Œè€å¹´ä»£ä½¿ç”¨å¤šçº¿ç¨‹çš„æ ‡è®°æ¸…é™¤ç®—æ³•ã€‚ç¬¬ä¸€æ¬¡å®ç°åƒåœ¾æ”¶é›†ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ã€‚æ–°ç”Ÿä»£ä½¿ç”¨æ ‡è®°å¤åˆ¶ParNew åƒåœ¾æ”¶é›†å™¨ï¼ŒSerialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚1âƒ£ï¸åˆå§‹æ ‡è®°ï¼šæš‚åœæ‰€æœ‰å…¶ä»–çº¿ç¨‹ï¼Œæ ‡è®°æ‰€æœ‰ç›´æ¥ä¸GC Rootsç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚2âƒ£ï¸å¹¶å‘æ ‡è®°ï¼šä»æ ¹å¯¹è±¡å¼€å§‹ï¼Œéå†å¯¹è±¡å›¾ï¼Œæ ‡è®°æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ã€‚3âƒ£ï¸é‡æ–°æ ‡è®°ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å‘ç”Ÿå˜åŠ¨çš„å¯¹è±¡å¼•ç”¨ï¼Œåœé¡¿ã€‚4âƒ£ï¸å¹¶å‘æ¸…é™¤ï¼šå¯¹æœªæ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤ã€‚ä¼˜ç‚¹ï¼šå¹¶å‘ã€ä½åœé¡¿ã€‚ç¼ºç‚¹ï¼šå¯¹CPUèµ„æºæ•æ„Ÿã€æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ã€äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p>
</li>
<li><p>åƒåœ¾æ”¶é›†å™¨G1ï¼šGarbage-Firstï¼Œjdk9çš„ï¼Œç²¾å‡†æ§åˆ¶åœé¡¿æ—¶é—´ï¼ŒG1æ•´ä½“æ¥çœ‹æ˜¯æ ‡è®°æ•´ç†ï¼Œå±€éƒ¨æ¥çœ‹æ˜¯æ ‡è®°å¤åˆ¶ã€‚ä¿ç•™åˆ†ä»£çš„æ¦‚å¿µï¼ŒæŠŠå †åˆ†ä¸ºè‹¥å¹²å›ºå®šå¤§å°çš„regionï¼Œæ¯ä¸ªregionæ‰®æ¼”edenã€survivorã€oldï¼Œç»´æŠ¤ä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©åƒåœ¾æœ€å¤šçš„åŒºåŸŸå›æ”¶ã€‚ä¸å†å›ºå®šæ”¶é›†æŸä¸ªåŒºåŸŸï¼Œè€Œæ˜¯çµæ´»ç»„æˆå›æ”¶é›†ã€‚1âƒ£ï¸åˆå§‹æ ‡è®°ï¼šæš‚åœå·¥ä½œçº¿ç¨‹ï¼Œæ ‡è®°ä»GC Rootsç›´æ¥å¯è¾¾çš„å¯¹è±¡ã€‚2âƒ£ï¸å¹¶å‘æ ‡è®°ï¼šéå†å¯¹è±¡å›¾ï¼Œæ ‡è®°æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ã€‚3âƒ£ï¸æœ€ç»ˆæ ‡è®°ï¼šä¿®æ­£åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç”±äºåº”ç”¨ç¨‹åºç»§ç»­è¿è¡Œå¯¼è‡´æ ‡è®°ä¿¡æ¯å˜åŒ–çš„éƒ¨åˆ†ã€‚4âƒ£ï¸ç­›é€‰å›æ”¶ï¼šåˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œæ„æˆå›æ”¶é›†ï¼ŒæŠŠå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„regionä¸­ï¼Œå†æ¸…ç†æ—§çš„regionã€‚æ¶‰åŠåˆ°å­˜æ´»å¯¹è±¡ç§»åŠ¨ï¼Œéœ€è¦æš‚åœå·¥ä½œçº¿ç¨‹ã€‚è¿™é‡Œå¤šæ¡æ”¶é›†å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆã€‚</p>
</li>
<li><p>CMSå’ŒG1ï¼š1.ä¸“æ³¨ä¸åŒï¼šCMSä¸“æ³¨äºå¹¶å‘æ¸…é™¤ä½å»¶è¿Ÿï¼Œåªéœ€å¤„ç†è€å¹´ä»£åˆ°æ–°ç”Ÿä»£çš„å¼•ç”¨ï¼Œä¼šå†…å­˜ç¢ç‰‡ã€‚G1æŒ‡å®šæœ€å¤§åœé¡¿æ—¶é—´ï¼Œåˆ†Regionçš„å†…å­˜å¸ƒå±€ï¼ŒæŒ‰æ”¶ç›ŠåŠ¨æ€ç¡®å®šå›æ”¶é›†ï¼Œä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚2.å°å†…å­˜CMSå ä¼˜ï¼Œå¤§å†…å­˜G1å ä¼˜ï¼Œåˆ†ç•Œçº¿6-8Gã€‚3.CMSåˆ†é…å¤§å¯¹è±¡ç©ºé—´ä¸è¶³æ—¶full gcï¼ŒG1æœŸæœ›åœé¡¿æ—¶é—´è®¾ç½®å¾ˆå°ï¼Œåƒåœ¾å›æ”¶èµ¶ä¸ä¸Šåˆ†é…æ—¶full gcã€‚</p>
</li>
<li><p>åƒåœ¾æ”¶é›†å™¨ZGCï¼šjdk11çš„ï¼Œä½å»¶è¿Ÿåƒåœ¾æ”¶é›†ã€‚åŸºäºRegionå†…å­˜å¸ƒå±€ï¼Œä¸è®¾åˆ†ä»£ï¼Œä½¿ç”¨è¯»å±éšœã€æŸ“è‰²æŒ‡é’ˆï¼Œå®ç°å¹¶å‘æ ‡è®°æ•´ç†ã€‚ç€è‰²ç¬”ï¼šåœ¨å¯¹è±¡å¤´ä¸­å¢åŠ é¢å¤–å†…å­˜ï¼ŒåŠ å¿«æ ‡è®°è¿‡ç¨‹ã€‚è¯»å±éšœï¼šè§£å†³åƒåœ¾å›æ”¶å’Œåº”ç”¨ç¨‹åºåŒæ—¶è¿›è¡Œæ—¶ï¼Œåº”ç”¨ç¨‹åºè¯»å–åˆ°è¢«å›æ”¶çš„å¯¹è±¡ã€‚åœ¨å¯¹è±¡å¤´éƒ¨å¢åŠ æ ‡è¯†ä½è¡¨ç¤ºå¯¹è±¡æ˜¯å¦æ­£åœ¨è¢«åƒåœ¾æ”¶é›†å™¨è®¿é—®ã€‚</p>
</li>
<li><p>javaå¯¹è±¡å¼•ç”¨ï¼š1.å¼ºå¼•ç”¨ï¼šä¼ ç»Ÿçš„å¼•ç”¨ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚2.è½¯å¼•ç”¨ï¼šç”¨äºç»´æŠ¤ä¸€äº›å¯æœ‰å¯æ— çš„å¯¹è±¡ã€‚åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿåˆ™ä¼šå›æ”¶è½¯å¼•ç”¨å¯¹è±¡ï¼Œå¦‚æœå›æ”¶äº†è½¯å¼•ç”¨å¯¹è±¡ä¹‹åä»ç„¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚3.å¼±å¼•ç”¨ï¼šæ‹¥æœ‰æ›´çŸ­çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“ JVM è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚4.è™šå¼•ç”¨ï¼šä¸€ç§å½¢åŒè™šè®¾çš„å¼•ç”¨ï¼Œå®ƒä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨ã€‚</p>
</li>
<li><p>jvmè°ƒä¼˜ä»å“ªé‡Œå…¥æ‰‹ï¼š1âƒ£ï¸å †å†…å­˜è®¾ç½®ï¼Œ-Xmsè®¾ç½®åˆå§‹å †å¤§å°ï¼Œ-Xmxè®¾ç½®æœ€å¤§å †å¤§å°ï¼Œè¿‡å°å¯¼è‡´é¢‘ç¹çš„åƒåœ¾å›æ”¶å’ŒOOMï¼Œè¿‡å¤§å¯¼è‡´é•¿æ—¶é—´çš„åƒåœ¾å›æ”¶åœé¡¿ã€‚2âƒ£ï¸åƒåœ¾æ”¶é›†å™¨é€‰æ‹©ï¼Œä¸²è¡Œã€å¹¶è¡Œã€CMSã€G1å›æ”¶å™¨ï¼Œè¡¡é‡æŒ‡æ ‡ï¼šå†…å­˜å ç”¨ã€ååé‡ã€å»¶è¿Ÿã€‚ç›‘æ§GCæ´»åŠ¨ï¼šä½¿ç”¨ç›‘æ§å·¥å…·ï¼šjstatã€VisualVMã€YourKitå’ŒGCæ—¥å¿—ã€‚3âƒ£ï¸çº¿ç¨‹å †æ ˆå¤§å°ï¼š-Xssè°ƒæ•´ï¼Œå½±å“æ ˆæ·±åº¦ã€‚4âƒ£ï¸è°ƒä¼˜ä»£ç ã€è°ƒæ•´å…ƒç©ºé—´çš„å¤§å°ï¼Œæ’æŸ¥å†…å­˜æ³„æ¼é£é™©ã€ç³»ç»Ÿçº§ä¼˜åŒ–ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜IOï¼‰ã€‚</p>
</li>
</ul>
<h2 id="æ•…éšœæ’æŸ¥"><a href="#æ•…éšœæ’æŸ¥" class="headerlink" title="æ•…éšœæ’æŸ¥"></a>æ•…éšœæ’æŸ¥</h2><ul>
<li>jvmæ’æŸ¥çº¿ç¨‹cpué—®é¢˜ï¼š1.ps -ef|grep java æˆ–è€… jps æŸ¥æ‰¾å‡ºè¿›ç¨‹idã€‚2.top -Hp è¿›ç¨‹id æŸ¥æ‰¾å‡ºæœ€è€—cpuçš„çº¿ç¨‹idã€‚ top -cçœ‹è¿›ç¨‹çš„ã€‚3.printf â€œ%x\nâ€ çº¿ç¨‹id ï¼Œè½¬æ¢ä¸º16è¿›åˆ¶çš„idã€‚4.ä½¿ç”¨jstack è¿›ç¨‹id | grep 16è¿›åˆ¶çº¿ç¨‹id æŸ¥æ‰¾å‡ºå †æ ˆä¿¡æ¯ï¼Œåˆ†æã€‚å¦å¤–ï¼Œarthasä¹Ÿå¯ä»¥æ‰“å°å‡ºå‰å¤šå°‘ä¸ªçº¿ç¨‹åŠå æœ‰cpuæƒ…å†µthread -n 5ã€‚</li>
<li>jvmæ€§èƒ½ç›‘æ§å·¥å…·ï¼š1âƒ£ï¸jpsï¼šè¾“å‡ºjvmä¸­è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ä¿¡æ¯ã€‚2âƒ£ï¸jstackï¼šç”Ÿæˆ Java è¿›ç¨‹çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œç”¨äºåˆ†æçº¿ç¨‹çŠ¶æ€å’Œæ­»é”ç­‰é—®é¢˜ã€‚jstack è¿›ç¨‹id | grep 16è¿›åˆ¶çº¿ç¨‹idã€‚3âƒ£ï¸jstatï¼šJVMç»Ÿè®¡ç›‘æµ‹å·¥å…·ï¼Œæ’æŸ¥gcï¼Œjstat -gc è¿›ç¨‹id 250 4ã€‚4âƒ£ï¸jmapå’Œjhatï¼šç”Ÿæˆ Java å†…å­˜å¿«ç…§ï¼Œåˆ†æå†…å­˜ä½¿ç”¨å’Œå†…å­˜æ³„æ¼ã€‚ç”¨jmapæŠŠè¿›ç¨‹å†…å­˜ä½¿ç”¨æƒ…å†µdumpåˆ°æ–‡ä»¶ä¸­ï¼Œå†ç”¨jhatåˆ†ææŸ¥çœ‹ã€‚</li>
<li>æœºå™¨æ…¢äº†æ€ä¹ˆæ’æŸ¥ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç£ç›˜IOã€ç½‘ç»œIOã€‚</li>
<li>æ’æŸ¥å·¥å…·ï¼š1.df -hæŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µã€‚2.free -h &#x2F; vmstatæ˜¾ç¤ºç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µã€‚3.mpstatå‘½ä»¤æŸ¥çœ‹cpuä½¿ç”¨æƒ…å†µï¼Œè¾“å‡ºå„ç§cpuæ—¶é—´ç™¾åˆ†æ¯”ã€‚4.netstat -sæŸ¥çœ‹ç½‘ç»œçŠ¶æ€ï¼Œæ˜¾ç¤ºå„ç§ç½‘ç»œåè®®çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¥æ”¶å‘é€æ•°æ®åŒ…æ•°ç­‰ã€‚5.iostat -xæŸ¥çœ‹IOç»Ÿè®¡ä¿¡æ¯ã€‚6.topå‘½ä»¤å®æ—¶æ˜¾ç¤ºLinuxç³»ç»Ÿä¸­è¿›ç¨‹çš„åŠ¨æ€è¿è¡Œä¿¡æ¯ï¼ŒåŒ…æ‹¬CPUå’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚top -Hp $pidç”¨äºæ˜¾ç¤ºç‰¹å®šè¿›ç¨‹çš„çº¿ç¨‹ä¿¡æ¯ã€‚</li>
<li>OOMæ’æŸ¥ï¼šé™¤äº†ç¨‹åºè®¡æ•°å™¨ï¼Œå…¶ä»–å†…å­˜å­˜å‚¨éƒ½å¯èƒ½OOMã€‚åŸå› ï¼š1.å†…å­˜æ³„æ¼ï¼šç¨‹åºæœªèƒ½é‡Šæ”¾ä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚2.Javaå †åˆ†é…ç©ºé—´ä¸è¶³å¯¼è‡´å†…å­˜æº¢å‡ºã€‚æ’æŸ¥ï¼šä½¿ç”¨jmap -dumpå‘½ä»¤dumpæ–‡ä»¶ï¼Œåœ¨å†…å­˜åˆ†æå·¥å…·å¦‚VisualVMã€MATä¸­è§‚å¯Ÿå¯¹è±¡å¼•ç”¨å…³ç³»ã€å¯¹è±¡æ•°é‡å¤§å°ã€‚å¯èƒ½æœªæ­£ç¡®é‡Šæ”¾èµ„æºã€å…³é—­æ–‡ä»¶æµã€æ–­å¼€ç½‘ç»œè¿æ¥ã€é”€æ¯å¯¹è±¡å¼•ç”¨ã€‚å®šä½åˆ°ä»£ç æ’æŸ¥ã€‚</li>
<li>jvmè°ƒä¼˜ï¼šåˆ†é…jvmå†…å­˜éœ€è¦è€ƒè™‘åº”ç”¨éœ€æ±‚ï¼Œæ˜¯å¦å¤„ç†å¤§é‡æ•°æ®ã€‚è€ƒè™‘åƒåœ¾æ”¶é›†å™¨ã€‚16gæœºå™¨å°†JVMæœ€å¤§å †å†…å­˜è®¾ç½®ä¸º12Gï¼ˆXms12G -Xmx12Gï¼‰ï¼Œä½¿ç”¨G1åƒåœ¾æ”¶é›†å™¨ã€‚å…ƒç©ºé—´å­˜å‚¨ç±»çš„å…ƒæ•°æ®ï¼Œè®¾ç½®åˆå§‹å€¼256Mï¼Œæœ€å¤§å€¼512Mã€‚çº¿ç¨‹å †æ ˆå¤§å°ï¼Œå‡ ç™¾KBåˆ°1MBï¼Œå–å†³äºæœ‰æ²¡æœ‰æ·±å±‚é€’å½’ï¼ˆ-Xss256kï¼‰ã€‚</li>
</ul>
<h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><ul>
<li><p>ArrayListå’ŒLinkedListï¼šArrayListåŸºäºåŠ¨æ€æ•°ç»„ï¼Œè¿ç»­å†…å­˜ï¼Œé€‚åˆéå†å’ŒæŸ¥æ‰¾å…ƒç´ ï¼Œä¸é€‚åˆå¢åˆ ï¼Œå¢åˆ åˆ›å»ºæ–°æ•°ç»„ã€‚LinkedListåŸºäºåŒå‘é“¾è¡¨ï¼Œé€‚åˆå¢åˆ ï¼Œä¸é€‚åˆéšæœºæŸ¥æ‰¾ã€‚</p>
</li>
<li><p>HashSetå’ŒTreeSetï¼šHashSetåº•å±‚åŸºäºHashMapã€‚TreeSetåŸºäºçº¢é»‘æ ‘ï¼Œå…ƒç´ å¤„äºæ’åºçŠ¶æ€ï¼Œæ”¯æŒæœ‰åºé›†åˆæ“ä½œã€‚</p>
</li>
<li><p>é˜Ÿåˆ—ï¼šQueueæ¥å£æ˜¯FIFOé˜Ÿåˆ—ï¼ŒDequeæ‰©å±•Queueæ˜¯åŒç«¯é˜Ÿåˆ—æ¥å£ã€‚ArrayDequeæ˜¯Dequeçš„å®ç°ï¼ŒåŒç«¯é˜Ÿåˆ—ã€‚LinkedListä¹Ÿæ˜¯Dequeçš„å®ç°ï¼Œå¯ä»¥åšåŒç«¯é˜Ÿåˆ—ã€‚Stackæ ˆï¼Œç»§æ‰¿è‡ªVectorã€‚Vectoræ˜¯åŒæ­¥é›†åˆï¼Œä½¿ç”¨synchronizedã€‚</p>
</li>
<li><p>HashMapï¼šæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ã€‚é“¾è¡¨é•¿åº¦&gt;8æ•°ç»„é•¿åº¦&gt;64æ—¶å˜çº¢é»‘æ ‘ã€‚é“¾è¡¨è§£å†³å“ˆå¸Œå†²çªï¼Œbucketã€‚é”®å’Œå€¼éƒ½å…è®¸ä¸ºç©ºã€‚</p>
</li>
<li><p>HashMapä¸ºä»€ä¹ˆä½¿ç”¨çº¢é»‘æ ‘ï¼šå“ˆå¸Œå‡½æ•°è´¨é‡ä¸é«˜&#x2F;å­˜å‚¨å¤§é‡æ•°æ®ï¼Œé“¾è¡¨å˜é•¿ï¼Œå½±å“æœç´¢æ•ˆç‡ã€‚æ‰€ä»¥jdk8ä¹‹åï¼Œé“¾è¡¨é•¿åº¦è¶…è¿‡8æ—¶ï¼Œé“¾è¡¨å˜çº¢é»‘æ ‘ï¼Œè‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæœç´¢å…ƒç´ æ—¶é—´å¤æ‚åº¦O(logn)ï¼Œæé«˜æœç´¢æ•ˆç‡ã€‚</p>
</li>
<li><p>HashMapæ‰©å®¹åº•å±‚æ•°ç»„ä¸ºä»€ä¹ˆæ‰©ä¸ºä¸¤å€ä¿æŒ2çš„å¹‚æ¬¡ï¼š1.æ–¹ä¾¿åˆ©ç”¨ä½è¿ç®—æ›¿ä»£å–æ¨¡è¿ç®—æ¥è®¡ç®—å…ƒç´ ç´¢å¼•ä½ç½®ã€‚2.å‡å°‘å†²çªï¼šäºŒè¿›åˆ¶ä½å¢åŠ ä¸€ä½ï¼Œåªçœ‹æœ€é«˜ä½è¦ä¹ˆç§»åŠ¨è¦ä¹ˆä¸å˜ï¼Œç¡®ä¿åˆ†å¸ƒå‡åŒ€ã€‚ </p>
</li>
<li><p>ConcurrentHashMapï¼šçº¿ç¨‹å®‰å…¨çš„HashMapï¼Œjdk7ä½¿ç”¨åˆ†æ®µé”ï¼Œåˆ†16æ®µï¼Œä¸€æ®µä¸€æŠŠé”ã€‚jdk8ä½¿ç”¨synchronizedå’ŒCASä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
</li>
<li><p>å¦‚ä½•æé«˜é“¾è¡¨æŸ¥è¯¢æ•ˆç‡ï¼š1.ä½¿ç”¨åŒå‘é“¾è¡¨ã€‚2.ä½¿ç”¨è·³è¡¨ï¼Œåœ¨é“¾è¡¨ä¸Šå¢åŠ å¤šçº§ç´¢å¼•ã€‚3.å…ƒç´ å­˜åˆ°å“ˆå¸Œè¡¨è¿›è¡Œæ˜ å°„ã€‚</p>
</li>
<li><p>B+æ ‘ï¼šç´¢å¼•æ•°æ®è®°å½•åœ¨å¶å­ç»“ç‚¹ï¼Œå½¢æˆæœ‰åºé“¾è¡¨ï¼Œæ–¹ä¾¿èŒƒå›´æŸ¥è¯¢ã€‚æç«¯é€€åŒ–å½¢æˆé“¾è¡¨ã€‚å…·æœ‰æ›´ä½çš„æ ‘é«˜ï¼Œé™ä½ç£ç›˜å¯»å€æ¬¡æ•°ï¼Œå‡å°‘IOæ¬¡æ•°ã€‚</p>
</li>
<li><p>è·³è¡¨ï¼šskip listï¼Œåˆ†å±‚ç»“æ„å¤šçº§é“¾è¡¨ï¼ŒéšæœºåŒ–çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨æœ‰åºå…ƒç´ ã€‚æä¾›å¯¹æ•°æ—¶é—´å¤æ‚åº¦ã€‚æ¯ä¸€å±‚éƒ½æ˜¯ä¸‹ä¸€å±‚çš„å¿«ç…§ï¼ŒåªåŒ…å«éƒ¨åˆ†å…ƒç´ ï¼Œæ¯å±‚å…ƒç´ é€šè¿‡æŒ‡é’ˆç›¸è¿ã€‚æŸ¥æ‰¾å…ˆä»é¡¶å±‚æŸ¥æ‰¾ï¼Œä»è€Œå¿«é€Ÿè·¨è¶Šå¤šä¸ªä¸å¿…è¦å…ƒç´ ã€‚åº”ç”¨ï¼šredisä¸­zsetä½¿ç”¨hash+è·³è¡¨ã€‚</p>
</li>
<li><p>å¤§é¡¶å †å°é¡¶å †ï¼šåŸºäºå®Œå…¨äºŒå‰æ ‘ï¼ˆé™¤æœ€åº•å±‚å¤–æ¯ä¸€å±‚éƒ½æ˜¯æ»¡çš„ï¼Œæœ€åº•å±‚ä»å·¦å‘å³å¡«å……ï¼‰ï¼Œå±‚åºéå†ç”¨æ•°ç»„è¡¨ç¤ºï¼Œç”¨æ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—ã€‚å¤§é¡¶å †ä¸­çˆ¶èŠ‚ç‚¹å¤§äºå­èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹æœ€å¤§ï¼ŒåŒå±‚æ²¡æœ‰é¡ºåºã€‚</p>
</li>
<li><p>LRUï¼šæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ã€‚å®ç°ï¼š1.é“¾è¡¨ï¼Œå¤´éƒ¨æ˜¯è¦æ·˜æ±°çš„ï¼Œæ¯æ¬¡é¡µé¢è®¿é—®å°†é¡µé¢ç§»åŠ¨åˆ°é“¾è¡¨å°¾éƒ¨ã€‚2.å“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨ï¼Œå“ˆå¸Œè¡¨ç”¨æ¥å¿«é€ŸæŸ¥æ‰¾é¡µé¢å¯¹åº”çš„é“¾è¡¨èŠ‚ç‚¹ã€‚3.æ—¶é—´æˆ³ï¼šæ¯ä¸ªé¡µé¢åˆ†é…æ—¶é—´æˆ³ï¼Œè¢«è®¿é—®æ—¶æ›´æ–°æ—¶é—´æˆ³ã€‚</p>
</li>
<li><p>æ“ä½œç³»ç»Ÿçš„é¡µé¢æ·˜æ±°ç®—æ³•ï¼š1.FIFOå…ˆè¿›å…ˆå‡ºï¼Œä½¿ç”¨é˜Ÿåˆ—ã€‚2.LFUæœ€ä¸å¸¸ç”¨ï¼Œä½¿ç”¨è®¡æ•°å™¨è·Ÿè¸ªæ¯ä¸ªé¡µé¢è®¿é—®æ¬¡æ•°ï¼Œæ¯æ¬¡æ·˜æ±°è®¿é—®æ¬¡æ•°æœ€å°‘çš„ï¼Œä¸è€ƒè™‘æ—¶é—´å±€éƒ¨æ€§ã€‚3.LRUæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ã€‚4.æ—¶é’Ÿç®—æ³•clockï¼ŒLRUè¿‘ä¼¼å®ç°ï¼Œç»´æŠ¤å¾ªç¯åˆ—è¡¨ã€‚</p>
</li>
<li><p>å…«ç§åŸºæœ¬æ•°æ®ç±»å‹åŠå°è£…ç±»ï¼šbyteæœ‰ç¬¦å·æ•´æ•°ï¼ˆ8bitï¼Œ-128-127ï¼‰ã€shortæœ‰ç¬¦å·16bitæ•´æ•°ã€intæœ‰ç¬¦å·32bitæ•´æ•°ã€longæœ‰ç¬¦å·64bitæ•´æ•°ã€float32bitå•ç²¾åº¦æµ®ç‚¹æ•°ã€double64bitåŒç²¾åº¦æµ®ç‚¹æ•°ã€char16bitçš„unicodeå­—ç¬¦ã€boolean</p>
</li>
<li><p>è£…ç®±å’Œæ‹†ç®±ï¼šè£…ç®±ï¼šåŸºæœ¬æ•°æ®ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”å°è£…ç±»å¯¹è±¡ï¼ˆç¼–è¯‘å™¨è½¬æ¢ä¸ºInteger.valueOfï¼‰ã€‚æ‹†ç®±ï¼šå°è£…ç±»å¯¹è±¡è‡ªåŠ¨è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆç¼–è¯‘å™¨è½¬æ¢ä¸ºo.intValue()ï¼‰ã€‚</p>
</li>
<li><p>Stringã€StringBuilderã€StringBufferï¼š1âƒ£ï¸Stringæ˜¯ä¸å¯å˜çš„ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ€§èƒ½è¾ƒä½ã€‚2âƒ£ï¸StringBuilderå¯å˜ï¼Œå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªè‡ªåŠ¨æ‰©å®¹çš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚3âƒ£ï¸StringBufferå¯å˜ï¼Œçº¿ç¨‹å®‰å…¨çš„ï¼Œsynchronizedã€‚</p>
</li>
<li><p>Stringä¸å¯å˜çš„è®¾è®¡åŸç†ï¼š1âƒ£ï¸å†…éƒ¨ä½¿ç”¨ç§æœ‰çš„finalå­—ç¬¦æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ï¼Œåˆ›å»ºä¹‹åå¼•ç”¨ä¸ä¼šæŒ‡å‘å¦ä¸€ä¸ªæ•°ç»„ã€‚2âƒ£ï¸è™½ç„¶æ•°ç»„æœ¬èº«å¯å˜ï¼Œä½†æ˜¯Stringæ²¡æœ‰æä¾›æ–¹æ³•ä¿®æ”¹æ•°ç»„å†…å®¹ã€‚3âƒ£ï¸è™šæ‹Ÿæœºç»´æŠ¤å­—ç¬¦ä¸²æ± ï¼Œç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²å¯å…±äº«åŒä¸€å†…å­˜åœ°å€ã€‚åˆ›å»ºæ—¶é¦–å…ˆæ£€æŸ¥å­—ç¬¦ä¸²æ± æ˜¯å¦æœ‰ç›¸åŒå†…å®¹å­—ç¬¦ä¸²å¯¹è±¡ï¼Œæœ‰åˆ™è¿”å›å¼•ç”¨ã€‚</p>
</li>
<li><p>Stringä¸å¯å˜çš„å¥½å¤„ï¼š1âƒ£ï¸å®‰å…¨æ€§ï¼šé˜²æ­¢è¢«æ¶æ„ä¿®æ”¹å¯¼è‡´çš„å®‰å…¨æ¼æ´ã€‚2âƒ£ï¸çº¿ç¨‹å®‰å…¨ï¼šStringå¯¹è±¡æœ¬èº«çº¿ç¨‹å®‰å…¨ã€‚æŒ‡å‘Stringå¯¹è±¡çš„å¼•ç”¨å˜é‡ä¸æ˜¯ã€‚3âƒ£ï¸å®ç°å­—ç¬¦ä¸²å¸¸é‡æ± æˆä¸ºå¯èƒ½ï¼Œé‡ç”¨å­—ç¬¦ä¸²ï¼ŒèŠ‚çœå†…å­˜å¼€é”€ã€‚4âƒ£ï¸åˆ›å»ºå­—ç¬¦ä¸²çš„å“ˆå¸Œç ç¼“å­˜ï¼šå­—ç¬¦ä¸²ä¸å¯å˜ï¼Œå“ˆå¸Œç ä¹Ÿä¸ä¼šå˜ï¼Œé€‚åˆä½œä¸ºé”®ä½¿ç”¨åœ¨å“ˆå¸Œè¡¨ä¸­HashMapã€‚</p>
</li>
<li><p>HashMapå’ŒTreeMapï¼šHashMapåŸºäºå“ˆå¸Œè¡¨ï¼Œä½¿ç”¨å“ˆå¸Œå‡½æ•°æä¾›O1çš„å¿«é€Ÿè®¿é—®ï¼Œä¸ä¿è¯å…ƒç´ é¡ºåºã€‚æ•°ç»„+é“¾è¡¨&#x2F;çº¢é»‘æ ‘ã€‚TreeMapåŸºäºçº¢é»‘æ ‘ï¼Œé”®å€¼å¯¹æŒ‰ç…§é”®çš„è‡ªç„¶é¡ºåºæˆ–æŒ‡å®šæ¯”è¾ƒå™¨é¡ºåºOlognå¤æ‚åº¦æ’åºã€‚ä¸¤è€…éƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p>
</li>
<li><p>åå°„æ€ä¹ˆåˆ›å»ºå¯¹è±¡ï¼š1âƒ£ï¸Classçš„newInstanceæ–¹æ³•ä¸ºæ— å‚æ„é€ å™¨çš„ç±»åˆ›å»ºï¼šClass&lt;?&gt; clazz &#x3D; Class.forName(â€œcom.Demoâ€); Object o &#x3D; clazz.newInstance(); 2âƒ£ï¸å…ˆè·å–Constructorï¼Œå†newInstanceã€‚å¯ä»¥è·å–æŒ‡å®šæ„é€ å‚æ•°çš„æ„é€ å™¨ã€‚3âƒ£ï¸ç§æœ‰æ–¹æ³•ï¼Œå¯ä»¥constructor.setAccessible(true); æ¥è®¾ç½®å¯è®¿é—®ã€‚</p>
</li>
<li><p>ArrayList å’Œ LinkedListæ€ä¹ˆçº¿ç¨‹å®‰å…¨ï¼š1âƒ£ï¸ä½¿ç”¨Collections.synchronizedList(list)å°†ä»»ä½•Listè½¬æ¢ä¸ºçº¿ç¨‹å®‰å…¨çš„Listã€‚ï¼ˆæ‰€æœ‰æ“ä½œéƒ½ä½¿ç”¨ç›¸åŒçš„å¯¹è±¡é”è¿›è¡ŒåŒæ­¥ï¼‰ã€‚2âƒ£ï¸ä½¿ç”¨æ˜¾å¼çš„åŒæ­¥å—ï¼Œæ¯æ¬¡è®¿é—®æ“ä½œæ—¶åŠ ç›¸åŒçš„é”ã€‚3âƒ£ï¸ä½¿ç”¨concurrentåŒ…ä¸­çš„å¹¶å‘é›†åˆï¼ŒCopyOnWriteArrayListï¼Œå†™æ—¶å¤åˆ¶ï¼Œé€‚ç”¨äºéå†æ“ä½œè¿œå¤šäºä¿®æ”¹æ“ä½œã€‚ConcurrentHashMapã€ConcurrentLinkedQueueã€‚</p>
</li>
<li><p>java.util.concurrentåŒ…ä¸‹æœ‰å“ªäº›ï¼š1âƒ£ï¸Executorï¼šçº¿ç¨‹è°ƒåº¦æ¡†æ¶ï¼šä»»åŠ¡Runnableï¼ŒCallableã€ä»»åŠ¡æ‰§è¡ŒExecutorServiceï¼ŒThreadPoolExecutor ScheduledThreadPoolExecutorã€å¼‚æ­¥è®¡ç®—ç»“æœFutureï¼ŒFutureTaskã€‚2âƒ£ï¸åŒæ­¥å™¨ï¼šCountDownLatchï¼ŒCyclicBarrierï¼ŒSemaphoreã€‚3âƒ£ï¸å¹¶å‘é›†åˆï¼šConcurrentHashMapï¼ŒConcurrentLinkedQueueï¼ŒCopyOnWriteArrayListï¼ŒCopyOnWriteArraySetï¼Œä»¥åŠæ”¯æŒé˜»å¡çš„çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ArrayBlockingQueueç­‰ã€‚4âƒ£ï¸åŸå­å˜é‡AtomicIntegerç­‰ã€‚5âƒ£ï¸é”Lockï¼šReentrantLockï¼ŒReadWriteLockã€‚</p>
</li>
<li><p>é‡å†™ <code>equals()</code> æ—¶å¿…é¡»é‡å†™ <code>hashCode()</code>ï¼šæ˜¯ä¸ºäº†ä¿è¯ <strong>ç›¸ç­‰çš„å¯¹è±¡å¿…é¡»æœ‰ç›¸åŒçš„å“ˆå¸Œç </strong>ï¼Œè¿™æ˜¯ Java çš„çº¦å®šã€‚å¦åˆ™åœ¨ä½¿ç”¨ <code>HashMap</code>ã€<code>HashSet</code> ç­‰å“ˆå¸Œç»“æ„æ—¶ï¼Œä¼šå¯¼è‡´å¯¹è±¡æ— æ³•æ­£ç¡®å­˜å–æˆ–æ¯”è¾ƒï¼Œå¼•å‘é€»è¾‘é”™è¯¯ã€‚</p>
</li>
</ul>
<h2 id="å¼‚å¸¸ä½“ç³»"><a href="#å¼‚å¸¸ä½“ç³»" class="headerlink" title="å¼‚å¸¸ä½“ç³»"></a>å¼‚å¸¸ä½“ç³»</h2><ul>
<li>javaå¼‚å¸¸ä½“ç³»ï¼šä¸€ä¸ªä»¥Throwableç±»ä¸ºæ ¹çš„ç±»å±‚æ¬¡ç»“æ„ï¼Œä¸¤ä¸ªåˆ†æ”¯ï¼š1âƒ£ï¸Errorå’ŒExceptionã€‚Erroré”™è¯¯ä»£è¡¨äº†JVMæ— æ³•é¢„æœŸæˆ–éš¾ä»¥æ¢å¤çš„ä¸¥é‡é—®é¢˜ï¼Œæ¯”å¦‚OOMã€StackOverflowErrorã€çº¿ç¨‹æ­»é”ç­‰ï¼Œä¸€èˆ¬æ— éœ€æ•æ‰ã€‚Exceptionå¼‚å¸¸åŒ…æ‹¬ï¼š2âƒ£ï¸Checked Exceptionså—æ£€å¼‚å¸¸ï¼Œåˆå«ç¼–è¯‘æ—¶å¼‚å¸¸ï¼Œåœ¨ç¼–å†™å¯èƒ½ä¼šæŠ›å‡ºå®ƒä»¬çš„æ–¹æ³•æ—¶éœ€è¦æ˜¾å¼åœ°è¿›è¡Œå¤„ç†ï¼ˆé€šè¿‡try-catchå—ï¼‰æˆ–å£°æ˜ï¼ˆé€šè¿‡throwså…³é”®å­—ï¼‰ï¼Œè¿™äº›å¼‚å¸¸é€šå¸¸æ˜¯å¤–éƒ¨é”™è¯¯ï¼Œå¦‚æ–‡ä»¶æœªæ‰¾åˆ°ï¼ˆFileNotFoundExceptionï¼‰ã€ç½‘ç»œé—®é¢˜ï¼ˆIOExceptionï¼‰ã€SQLå¼‚å¸¸ç­‰ã€‚3âƒ£ï¸Unchecked Exceptionséå—æ£€å¼‚å¸¸ï¼Œåˆå«è¿è¡Œæ—¶å¼‚å¸¸ï¼ŒåŒ…æ‹¬RuntimeExceptionåŠå…¶å­ç±»ï¼Œä¸éœ€è¦æ˜¾ç¤ºå¤„ç†æˆ–å£°æ˜ï¼Œé€šå¸¸æ˜¯ç¨‹åºé”™è¯¯ï¼Œä¾‹å¦‚æ•°ç»„è¶Šç•Œã€ç©ºæŒ‡é’ˆã€‚</li>
</ul>
<h2 id="å˜é‡ä¿®é¥°"><a href="#å˜é‡ä¿®é¥°" class="headerlink" title="å˜é‡ä¿®é¥°"></a>å˜é‡ä¿®é¥°</h2><ul>
<li><p>staticï¼šé™æ€</p>
<ul>
<li>åº”ç”¨äºå˜é‡ï¼šé™æ€å˜é‡æˆ–ç±»å˜é‡ï¼Œå˜é‡å±äºç±»è€Œä¸æ˜¯å¯¹è±¡ï¼Œæ‰€æœ‰è¯¥ç±»çš„å¯¹è±¡å…±äº«åŒä¸€ä¸ªé™æ€å˜é‡ã€‚</li>
<li>åº”ç”¨äºæ–¹æ³•ï¼šé™æ€æ–¹æ³•ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å±äºç±»ï¼Œå¯ä»¥ä¸ä¾èµ–äºå¯¹è±¡å®ä¾‹è¢«è°ƒç”¨ã€‚åªèƒ½è®¿é—®staticå˜é‡å’Œæ–¹æ³•ã€‚</li>
<li>å®šä¹‰é™æ€ä»£ç å—ï¼šåœ¨ç±»è¢«åŠ è½½åˆ°JVMæ—¶ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œå¸¸ç”¨äºåˆå§‹åŒ–é™æ€å˜é‡ã€‚</li>
<li>åº”ç”¨äºç±»ï¼šåªèƒ½ç”¨æ¥ä¿®é¥°å†…éƒ¨ç±»ï¼Œå¯ä»¥ä¸ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹è¢«åˆ›å»ºå’Œä½¿ç”¨ï¼Œå¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰é™æ€æˆå‘˜å’Œé™æ€æ–¹æ³•ã€‚</li>
</ul>
</li>
<li><p>finalï¼šå¸¸é‡ï¼Œç”¨äºåˆ›å»ºä¸å¯å˜å¯¹è±¡ã€é˜²æ­¢æ–¹æ³•æˆ–ç±»è¢«æ›´æ”¹</p>
<ul>
<li>ä¿®é¥°å˜é‡ï¼šè¡¨ç¤ºè¯¥å˜é‡ä¸€æ—¦è¢«åˆå§‹åŒ–åå°±ä¸èƒ½è¢«ä¿®æ”¹ï¼Œå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå˜é‡çš„å€¼ä¸èƒ½æ”¹å˜ï¼Œå¯¹äºå¼•ç”¨ç±»å‹ï¼Œå˜é‡ä¸èƒ½å†æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ‰€æŒ‡å‘çš„å¯¹è±¡å†…å®¹æœ¬èº«å¯ä»¥å˜åŒ–ã€‚</li>
<li>å½“finalåº”ç”¨äºæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•ä¸èƒ½è¢«å­ç±»è¦†ç›–ï¼ˆé‡å†™ï¼‰ã€‚</li>
<li>å½“finalåº”ç”¨äºç±»æ—¶ï¼Œå®ƒè¡¨æ˜è¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚</li>
</ul>
</li>
<li><p>ç±»åŠ è½½æœºåˆ¶ï¼šè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰è´Ÿè´£å°†ç±»çš„å­—èŠ‚ç Classæ–‡ä»¶ä»ä¸åŒçš„æ¥æºï¼ˆä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œç­‰ï¼‰åŠ è½½åˆ°Javaè™šæ‹Ÿæœºä¸­ã€‚1âƒ£ï¸åŠ è½½é˜¶æ®µï¼šç±»åŠ è½½å™¨è¯»å–äºŒè¿›åˆ¶æ•°æ®ï¼ˆ.classæ–‡ä»¶ï¼‰å¹¶ç”Ÿæˆå¯¹åº”çš„java.lang.Classå¯¹è±¡ã€‚2âƒ£ï¸éªŒè¯ï¼šç¡®ä¿åŠ è½½çš„ç±»çš„å­—èŠ‚ç æ˜¯åˆæ³•çš„ï¼Œæ£€æŸ¥å­—èŠ‚ç çš„æ ¼å¼ã€è¯­æ³•ã€æ•°æ®æµã€ç¬¦å·å¼•ç”¨ç­‰ã€‚3âƒ£ï¸å‡†å¤‡ï¼šä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼Œæ–¹æ³•åŒºä¸­åˆ†é…ã€‚4âƒ£ï¸è§£æï¼šå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚5âƒ£ï¸åˆå§‹åŒ–ï¼šæ‰§è¡Œé™æ€å˜é‡çš„èµ‹å€¼æ“ä½œå’Œé™æ€ä»£ç å—å†…çš„ä»£ç ã€‚</p>
</li>
<li><p>ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨ï¼šç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚</p>
</li>
<li><p>javaç¼–è¯‘é˜¶æ®µå’Œè¿è¡Œé˜¶æ®µï¼šç¼–è¯‘é˜¶æ®µæ˜¯æºä»£ç ï¼ˆ.javaæ–‡ä»¶ï¼‰è¢«ç¼–è¯‘å™¨è½¬æ¢æˆå­—èŠ‚ç ï¼ˆ.classæ–‡ä»¶ï¼‰çš„è¿‡ç¨‹ï¼Œç”±Javaç¼–è¯‘å™¨ï¼ˆ javacï¼‰è´Ÿè´£ã€‚è¿è¡Œé˜¶æ®µæ˜¯å°†.class æ–‡ä»¶åŠ è½½åˆ°JVMå¹¶æ‰§è¡Œçš„è¿‡ç¨‹ã€‚ç±»åŠ è½½åœ¨è¿è¡Œé˜¶æ®µï¼Œæ”¯æŒè¿è¡Œæ—¶ç»‘å®šï¼ˆæˆ–æ™šæœŸç»‘å®šï¼‰ï¼Œæ˜¯JavaåŠ¨æ€é“¾æ¥å’Œå¤šæ€çš„åŸºç¡€ã€‚</p>
</li>
<li><p>å¸¸é‡æ± ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ä½äºæ–¹æ³•åŒºã€‚å®ƒæ˜¯ç±»æ–‡ä»¶ä¸­æ¯ä¸ªç±»æˆ–æ¥å£çš„å¸¸é‡æ± è¡¨çš„è¿è¡Œæ—¶è¡¨ç¤ºï¼Œç”¨äºå­˜å‚¨ç¼–è¯‘å™¨ç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚å­—ç¬¦ä¸²å¸¸é‡æ± æœ€åˆä½äºæ–¹æ³•åŒºï¼Œåœ¨Java 7ä»¥åè¢«ç§»åˆ°å †å†…å­˜ã€‚å®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¸¸é‡æ± ï¼Œç”¨äºå­˜å‚¨å­—ç¬¦ä¸²å­—é¢é‡å’Œå¼•ç”¨ï¼Œç›®çš„æ˜¯é¿å…é‡å¤åˆ›å»ºç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä»¥èŠ‚çœå†…å­˜å’Œæå‡æ€§èƒ½ã€‚</p>
</li>
<li><p>åŒäº²å§”æ´¾æ¨¡å‹ï¼šJVMä¸­çš„åŒäº²å§”æ´¾æ˜¯ä¸€ç§ç±»åŠ è½½æœºåˆ¶ï¼Œé€šè¿‡ä¸€å±‚ä¸€å±‚çš„çˆ¶å­å…³ç³»å°†ç±»çš„åŠ è½½å·¥ä½œå§”æ´¾ç»™ä¸Šå±‚çš„ClassLoaderã€‚è¿™ç§æœºåˆ¶çš„ç›®çš„æ˜¯ä¸ºäº†é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œä¿è¯ç±»çš„åŠ è½½å®‰å…¨å’Œç±»çš„å…±äº«ã€‚</p>
</li>
<li><p>æƒ³åŠ è½½ä¸¤ä¸ªå…¨è·¯å¾„ç›¸åŒçš„ç±»ï¼š1.ä½¿ç”¨ä¸å…·æœ‰çˆ¶å­å…³ç³»çš„ç±»åŠ è½½å™¨ã€‚2.æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå¹¶é‡å†™ loadClass() æ–¹æ³•ï¼Œæ”¹å˜ç±»åŠ è½½çš„å§”æ´¾é€»è¾‘ã€‚</p>
</li>
<li><p>javaæ¥å£ä¸­å¯ä»¥æœ‰éæŠ½è±¡æ–¹æ³•å—ï¼šéæŠ½è±¡æ–¹æ³•å³å…·ä½“å®ç°çš„æ–¹æ³•ï¼Œjava8ä¹‹å‰åªèƒ½åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚java8å¼•å…¥äº†é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•ã€‚é»˜è®¤æ–¹æ³•ï¼šdefaultä¿®é¥°ã€‚é™æ€æ–¹æ³•ï¼šstaticä¿®é¥°ï¼Œå¯ä»¥é€šè¿‡æ¥å£åç›´æ¥è°ƒç”¨ã€‚java9è¿˜æä¾›äº†privateç§æœ‰æ–¹æ³•ã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜ä¹‹java2025</title>
    <url>/2025/07/27/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E8%83%8C%E8%BF%87%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8Bjava2025/</url>
    <content><![CDATA[<h2 id="Reactorå“åº”å¼ç¼–ç¨‹å’ŒReactorçº¿ç¨‹æ¨¡å‹"><a href="#Reactorå“åº”å¼ç¼–ç¨‹å’ŒReactorçº¿ç¨‹æ¨¡å‹" class="headerlink" title="Reactorå“åº”å¼ç¼–ç¨‹å’ŒReactorçº¿ç¨‹æ¨¡å‹"></a>Reactorå“åº”å¼ç¼–ç¨‹å’ŒReactorçº¿ç¨‹æ¨¡å‹</h2><p>Reactor æ˜¯ä¸€ä¸ªå“åº”å¼ç¼–ç¨‹åº“ï¼Œæä¾›äº†éé˜»å¡ã€é«˜æ•ˆçš„å¼‚æ­¥æ•°æ®æµå¤„ç†èƒ½åŠ›ã€‚Project Reactoråº”ç”¨äºSpringç”Ÿæ€ç³»ç»Ÿï¼ˆSpring WebFluxï¼‰ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å’Œå“åº”çš„å¼‚æ­¥æµå¼æ•°æ®ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š<br>éé˜»å¡ï¼šé€šè¿‡äº‹ä»¶é©±åŠ¨çš„æ–¹å¼å¤„ç†æ•°æ®æµï¼Œé¿å…çº¿ç¨‹é˜»å¡ã€‚<br>èƒŒå‹æ”¯æŒï¼šå…è®¸æ¶ˆè´¹è€…æ§åˆ¶ç”Ÿäº§è€…çš„é€Ÿç‡ï¼Œé˜²æ­¢èµ„æºè¿‡è½½ã€‚<br>é«˜æ•ˆæ€§ï¼šé€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚<br>å‡½æ•°å¼é£æ ¼ï¼šæä¾›ä¸°å¯Œçš„æ“ä½œç¬¦ï¼Œå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨å¯¹æ•°æ®æµè¿›è¡Œè½¬æ¢å’Œå¤„ç†ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå“åº”å¼ç³»ç»Ÿï¼ˆå¦‚ Spring WebFluxï¼‰ã€æ•°æ®æµå¤„ç†ï¼ˆå¦‚å®æ—¶æ—¥å¿—åˆ†æã€äº‹ä»¶æµå¤„ç†ï¼‰ã€‚</p>
<p>Reactor æä¾›äº†<strong>ä¸¤ä¸ªæ ¸å¿ƒç±»</strong>ï¼š<br>Fluxï¼šè¡¨ç¤ºå¯ä»¥å‘å°„ 0åˆ°Nä¸ªå…ƒç´  çš„å¼‚æ­¥æ•°æ®æµã€‚<br>Monoï¼šè¡¨ç¤ºå¯ä»¥å‘å°„ 0æˆ–1ä¸ªå…ƒç´  çš„å¼‚æ­¥æ•°æ®æµã€‚<br>Flux æ˜¯ Reactor ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç±»ï¼Œç”¨äºè¡¨ç¤ºå¯ä»¥å‘å°„å¤šä¸ªå…ƒç´ çš„å¼‚æ­¥æ•°æ®æµã€‚å‘å°„ 0åˆ°Nä¸ªå…ƒç´ ï¼Œå¹¶æœ€ç»ˆä»¥å®Œæˆæˆ–é”™è¯¯ä¿¡å·ç»“æŸã€‚Flux æä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦ï¼Œå¯ä»¥è½»æ¾åœ°å¯¹æ•°æ®æµè¿›è¡Œè½¬æ¢ã€è¿‡æ»¤ã€åˆå¹¶å’Œé”™è¯¯å¤„ç†ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>Reactorçº¿ç¨‹æ¨¡å‹ï¼šä¸€ç§ç»å…¸çš„IOå¤šè·¯å¤ç”¨è®¾è®¡æ¨¡å¼ï¼Œç”¨äºé«˜æ•ˆå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç›‘å¬ I&#x2F;O äº‹ä»¶ï¼ˆå¦‚è¯»å†™å°±ç»ªï¼‰ï¼Œå¹¶å°†è¿™äº›äº‹ä»¶åˆ†å‘ç»™ç›¸åº”çš„å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š<br>äº‹ä»¶é©±åŠ¨ï¼šé€šè¿‡ç›‘å¬ I&#x2F;O äº‹ä»¶ï¼ˆå¦‚ selectã€poll æˆ– epollï¼‰æ¥é¿å…é˜»å¡ç­‰å¾…ã€‚<br>å•çº¿ç¨‹æˆ–å¤šçº¿ç¨‹æ¨¡å‹ï¼šå•çº¿ç¨‹ Reactor æ¨¡å‹ï¼šæ‰€æœ‰äº‹ä»¶ç”±ä¸€ä¸ªçº¿ç¨‹å¤„ç†ã€‚å¤šçº¿ç¨‹ Reactor æ¨¡å‹ï¼šä½¿ç”¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†äº‹ä»¶ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚<br>éé˜»å¡ I&#x2F;Oï¼šé¿å…å› ç­‰å¾… I&#x2F;O æ“ä½œå®Œæˆè€Œé˜»å¡çº¿ç¨‹ï¼Œä»è€Œæé«˜ååé‡ã€‚</p>
<p><strong>å…¸å‹å®ç°</strong>ï¼šJava NIOã€Netty ç­‰æ¡†æ¶åŸºäº Reactor æ¨¡å‹æ„å»ºã€‚</p>
<p><strong>æ ¸å¿ƒç»„ä»¶</strong>ï¼š<br>Acceptorï¼šè´Ÿè´£æ¥æ”¶æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°äº‹ä»¶ç›‘å¬å™¨ä¸­ã€‚<br>Dispatcherï¼šè´Ÿè´£ç›‘å¬ I&#x2F;O äº‹ä»¶å¹¶åˆ†å‘ç»™å¯¹åº”çš„å¤„ç†å™¨ã€‚<br>Handlerï¼šå¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé«˜å¹¶å‘ç½‘ç»œæœåŠ¡ï¼ˆå¦‚ Web æœåŠ¡å™¨ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ã€éœ€è¦é«˜æ•ˆå¤„ç†å¤§é‡çŸ­è¿æ¥æˆ–é•¿è¿æ¥çš„åœºæ™¯ã€‚<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>Project Reactorå’ŒReactorçº¿ç¨‹æ¨¡å‹çš„è”ç³»ï¼š<br>**Project Reactor æä¾›äº†æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å“åº”å¼å¤„ç†ï¼Œè€Œ Reactorçº¿ç¨‹æ¨¡å‹åˆ™æ›´å…³æ³¨åº•å±‚ I&#x2F;O äº‹ä»¶çš„åˆ†å‘ï¼Œå¤„ç†ç½‘ç»œå±‚IOã€‚**éƒ½æ˜¯éé˜»å¡çš„ï¼Œéƒ½æ˜¯äº‹ä»¶é©±åŠ¨çš„ã€‚</p>
<h2 id="recordå…³é”®å­—"><a href="#recordå…³é”®å­—" class="headerlink" title="recordå…³é”®å­—"></a>recordå…³é”®å­—</h2><p>recordï¼šä¸€ç§ç”¨äº<strong>å®šä¹‰ä¸å¯å˜æ•°æ®è½½ä½“ç±»</strong>çš„ç‰¹æ®Šç±»å½¢å¼ï¼Œæ˜¯ Java 14 å¼•å…¥çš„ä¸€ä¸ªå…³é”®å­—ï¼Œæ­£å¼åœ¨ Java 16 æ ‡å‡†åŒ–ã€‚</p>
<p>record æ˜¯<strong>ä¸€ç§ç®€åŒ–æ•°æ®ç±»çš„è¯­æ³•ï¼Œç›®çš„æ˜¯å­˜å‚¨æ•°æ®è€Œä¸å¯¹è¿™äº›æ•°æ®è¿›è¡Œå¤æ‚çš„æ“ä½œæˆ–ä¿®æ”¹çš„åœºæ™¯ã€‚è‡ªåŠ¨ç”Ÿæˆäº†åŒ…æ‹¬æ„é€ å‡½æ•°ï¼Œgetterã€toStringã€equalsã€hashCode ç­‰æ–¹æ³•ã€‚</strong></p>
<p>å®ƒæ˜¯ä¸€ç§ä¸å¯å˜ï¼ˆImmutableï¼‰çš„ç±»ï¼Œæ‰€æœ‰å­—æ®µéƒ½æ˜¯ finalï¼Œåˆ›å»ºåçŠ¶æ€ä¸èƒ½æ›´æ”¹ã€‚</p>
<p><strong>ç”¨æ³•</strong>ï¼š<br>1ã€ä½œä¸ºç‹¬ç«‹çš„ç±»æ–‡ä»¶<br><code>public record Film(String name, String desc) &#123;&#125;</code></p>
<p>2ã€åµŒå¥—åœ¨å…¶ä»–ç±»ä¸­ï¼Œç±»ä¼¼é™æ€å†…éƒ¨ç±»<br><code>public static record Film</code></p>
<p>3ã€æ–¹æ³•å†…éƒ¨<br>ä» Java 16 å¼€å§‹ï¼Œrecord å¯ä»¥è¢«å®šä¹‰ä¸ºå±€éƒ¨ç±»ï¼ˆå³åœ¨æ–¹æ³•å†…éƒ¨å®šä¹‰ï¼‰ã€‚è¿™ç§ç”¨æ³•é€‚åˆ<strong>ä»…åœ¨æŸä¸ªæ–¹æ³•ä¸­ä½¿ç”¨çš„ä¸´æ—¶æ•°æ®ç»“æ„</strong>ã€‚ç›´æ¥record Film</p>
<p>PSï¼šé™æ€å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»ï¼šé™æ€å†…éƒ¨ç±»ä¸ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å¤–éƒ¨ç±»åè®¿é—®ã€‚åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ã€‚éé™æ€å†…éƒ¨ç±»ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œå¿…é¡»é€šè¿‡å¤–éƒ¨ç±»çš„å®ä¾‹æ¥åˆ›å»ºã€‚å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼Œå› ä¸ºå†…éƒ¨ç±»æŒæœ‰ä¸€ä¸ªå¯¹å¤–éƒ¨ç±»å®ä¾‹çš„éšå¼å¼•ç”¨ã€‚</p>
<h2 id="çº¿ä¸Šredisæœºå™¨çˆ†äº†ï¼Œå¦‚ä½•ä¼˜åŒ–"><a href="#çº¿ä¸Šredisæœºå™¨çˆ†äº†ï¼Œå¦‚ä½•ä¼˜åŒ–" class="headerlink" title="çº¿ä¸Šredisæœºå™¨çˆ†äº†ï¼Œå¦‚ä½•ä¼˜åŒ–"></a>çº¿ä¸Šredisæœºå™¨çˆ†äº†ï¼Œå¦‚ä½•ä¼˜åŒ–</h2><p>å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‘ç° Redis å‡ºç°å¼‚å¸¸ï¼Œæ¯”å¦‚å†…å­˜çˆ†äº†æˆ–è€…å“åº”å˜æ…¢ï¼Œé¦–å…ˆé€šè¿‡ Redis çš„ INFO å‘½ä»¤ï¼ˆ<strong>redis-cli info</strong>ï¼‰å’Œç›‘æ§å¹³å°æŸ¥çœ‹å½“å‰çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œç¡®è®¤æ˜¯<strong>å†…å­˜ã€CPUã€è¿æ¥æ•°è¿˜æ˜¯æŸä¸ªæ…¢æŸ¥è¯¢</strong>å¼•èµ·çš„ã€‚</p>
<p>å¦‚æœæ˜¯** Big Key **ï¼ˆå­˜å‚¨çš„æ•°æ®ä½“ç§¯å¾ˆå¤§ï¼Œå¦‚ä¸€ä¸ªHashåŒ…å«ä¸Šä¸‡ä¸ªå­—æ®µï¼‰æˆ–è€…çƒ­ Key é€ æˆçš„ï¼Œæˆ‘ä¼šè¿›è¡Œæ•°æ®ç»“æ„ä¼˜åŒ–ã€æ‹†åˆ† Keyã€å¼•å…¥æœ¬åœ°ç¼“å­˜ï¼›å¦‚æœæ˜¯è¿æ¥æ•°è¿‡é«˜ï¼Œæˆ‘ä¼šæ£€æŸ¥è¿æ¥æ± é…ç½®ï¼Œé€‚å½“å¢åŠ è¿æ¥æ± å¤§å°æˆ–å¼•å…¥è¿æ¥å¤ç”¨ã€‚</p>
<p>å¦‚æœæ˜¯ QPS è¿‡é«˜å¯¼è‡´ Redis æˆä¸ºç“¶é¢ˆï¼Œæˆ‘ä¼šè€ƒè™‘å¼•å…¥<strong>Redis é›†ç¾¤ã€è¯»å†™åˆ†ç¦»ã€æˆ–è€…å¯¹çƒ­ç‚¹æ•°æ®è¿›è¡Œç¼“å­˜</strong>ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä¹Ÿä¼šåŠ å¼ºç¼“å­˜çš„<strong>å¤±æ•ˆç­–ç•¥</strong>ã€é˜²æ­¢ç¼“å­˜ç©¿é€å’Œå‡»ç©¿ï¼Œå¹¶ç»“åˆå¸ƒéš†è¿‡æ»¤å™¨ç­‰æ‰‹æ®µä¿æŠ¤åç«¯æ•°æ®åº“ã€‚</p>
<h2 id="springå£°æ˜å¼äº‹åŠ¡-Transactional"><a href="#springå£°æ˜å¼äº‹åŠ¡-Transactional" class="headerlink" title="springå£°æ˜å¼äº‹åŠ¡@Transactional"></a>springå£°æ˜å¼äº‹åŠ¡@Transactional</h2><p>åœ¨Springä¸­äº‹åŠ¡ç®¡ç†çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œç¼–ç¨‹å¼äº‹åŠ¡å’Œå£°æ˜å¼äº‹åŠ¡ã€‚ç¼–ç¨‹å¼äº‹åŠ¡å°†ä¸šåŠ¡ä»£ç å’Œäº‹åŠ¡ä»£ç è€¦åˆåˆ°ä¸€å—ï¼Œå½“å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™è¿˜å¾—éœ€è¦æ‰‹åŠ¨å›æ»šäº‹åŠ¡ï¼Œä¸ä¼˜é›…ã€‚</p>
<p>å£°æ˜å¼äº‹åŠ¡ï¼š<strong>åŸºäºAOPï¼Œè®¾ç½®å¥½åˆ‡ç‚¹ï¼Œå½“æˆ‘ä»¬è°ƒç”¨äº‹åŠ¡æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨åˆ°ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡ä¸­åŠ å…¥äº†äº‹åŠ¡æäº¤å’Œå›æ»šçš„é€»è¾‘ã€‚å½“æ–¹æ³•æ‰§è¡ŒæˆåŠŸæ—¶æäº¤äº‹åŠ¡ï¼Œå½“æ–¹æ³•å‘ç”Ÿå¼‚å¸¸æ—¶å›æ»šäº‹åŠ¡ã€‚</strong></p>
<p>@Transactionalå¯ä»¥ç”¨åœ¨ç±»ï¼Œæ–¹æ³•ï¼Œæ¥å£ä¸Šï¼š</p>
<ol>
<li>ç”¨åœ¨ç±»ä¸Šï¼Œè¯¥ç±»çš„æ‰€æœ‰publicæ–¹æ³•éƒ½å…·æœ‰äº‹åŠ¡</li>
<li>ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œæ–¹æ³•å…·æœ‰äº‹åŠ¡ã€‚å½“ç±»å’Œæ–¹æ³•åŒæ—¶é…ç½®äº‹åŠ¡çš„æ—¶å€™ï¼Œæ–¹æ³•çš„å±æ€§ä¼šè¦†ç›–ç±»çš„å±æ€§</li>
<li>ç”¨åœ¨æ¥å£ä¸Šï¼Œä¸€èˆ¬ä¸å»ºè®®è¿™æ ·ä½¿ç”¨ï¼Œå› ä¸ºåªæœ‰åŸºäºæ¥å£çš„ä»£ç†ä¼šç”Ÿæ•ˆï¼Œå¦‚æœSpring AOPä½¿ç”¨cglibæ¥å®ç°åŠ¨æ€ä»£ç†ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼ˆå› ä¸ºæ³¨è§£ä¸èƒ½è¢«ç»§æ‰¿ï¼‰</li>
</ol>
<p><strong>@Transactionalå¤±æ•ˆçš„åœºæ™¯</strong></p>
<ol>
<li>@Transactionalæ³¨è§£åº”ç”¨åˆ°épublicæ–¹æ³•ï¼ˆé™¤éç‰¹æ®Šé…ç½®ï¼Œä¾‹å¦‚ä½¿ç”¨AspectJ é™æ€ç»‡å…¥å®ç° AOPï¼‰</li>
<li>è‡ªè°ƒç”¨ï¼Œå› ä¸º@Transactionalæ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ï¼Œè‡ªè°ƒç”¨æ—¶ï¼Œæ–¹æ³•æ‰§è¡Œä¸ä¼šç»è¿‡ä»£ç†å¯¹è±¡</li>
<li>å¼‚å¸¸åœ¨ä»£ç ä¸­è¢«ä½ è‡ªå·±try catchäº†ï¼Œä¸æŠ›å¼‚å¸¸è¿›å…¥ä¸äº†å›æ»šçš„é€»è¾‘</li>
<li>å¼‚å¸¸ç±»å‹ä¸æ­£ç¡®ï¼Œé»˜è®¤åªæ”¯æŒRuntimeExceptionå’ŒErrorï¼Œä¸æ”¯æŒæ£€æŸ¥å¼‚å¸¸ï¼Œå¦‚æœæŠ›å‡ºä»»ä½•å¼‚å¸¸éƒ½å›æ»šï¼Œå¯ä»¥é…ç½®rollbackForä¸ºException</li>
<li>äº‹åŠ¡ä¼ æ’­é…ç½®ä¸ç¬¦åˆä¸šåŠ¡é€»è¾‘</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆåªæœ‰publicæ–¹æ³•ä¸Šçš„@Transactionalæ³¨è§£æ‰ä¼šç”Ÿæ•ˆï¼Ÿ</strong></p>
<p>é¦–å…ˆJDKåŠ¨æ€ä»£ç†è‚¯å®šåªèƒ½æ˜¯publicï¼Œå› ä¸ºæ¥å£çš„æƒé™ä¿®é¥°ç¬¦åªèƒ½æ˜¯publicã€‚cglibä»£ç†çš„æ–¹å¼æ˜¯å¯ä»¥ä»£ç†protectedæ–¹æ³•çš„ï¼ˆprivateä¸è¡Œï¼Œå­ç±»è®¿é—®ä¸äº†çˆ¶ç±»çš„privateæ–¹æ³•ï¼‰å¦‚æœæ”¯æŒprotectedï¼Œå¯èƒ½ä¼šé€ æˆå½“åˆ‡æ¢ä»£ç†çš„å®ç°æ–¹å¼æ—¶è¡¨ç°ä¸åŒï¼Œå¢å¤§å‡ºç°bugçš„å¯èƒ½æ€§ï¼Œæ‰€ä»¥ç»Ÿä¸€ä¸€ä¸‹ã€‚</p>
<p>Transactionalçš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºé»˜è®¤ä¸ºPropagation.REQUIREDã€‚<strong>ã€Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€</strong></p>
<p>Propagation.REQUIRES_NEW**ã€Œåˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€**</p>
<h2 id="HashMapå’ŒHashTableçš„åŒºåˆ«"><a href="#HashMapå’ŒHashTableçš„åŒºåˆ«" class="headerlink" title="HashMapå’ŒHashTableçš„åŒºåˆ«"></a>HashMapå’ŒHashTableçš„åŒºåˆ«</h2><ul>
<li><p><strong>ç»§æ‰¿ç±»ä¸åŒ</strong>ï¼šHashTableç»§æ‰¿Dictionaryç±»ï¼ŒHashMapç»§æ‰¿AbstractMapç±»</p>
</li>
<li><p><strong>çº¿ç¨‹å®‰å…¨çº§åˆ«ä¸åŒ</strong>ï¼šHashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œæ¯ä¸ªpublicæ–¹æ³•éƒ½æœ‰Synchronizedä¿®é¥°ï¼ŒHashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
</li>
<li><p><strong>æ˜¯å¦å…è®¸nullçš„è¦æ±‚ä¸åŒ</strong>ï¼šHashTableï¼škeyä¸å…è®¸ä¸ºnullï¼Œvalueä¸å…è®¸ä¸ºnullã€‚HashMapï¼škeyå…è®¸ä¸ºnullï¼Œvalueå…è®¸ä¸ºnullã€‚</p>
</li>
<li><p><strong>åº•å±‚æ•°æ®ç»“æ„ä¸åŒ</strong>ï¼šåœ¨JDK1.8ä»¥åï¼ŒHashMapçš„åº•å±‚æ•°æ®ç»“æ„æ”¹æˆäº†æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„å®ç°ï¼Œåœ¨é“¾è¡¨çš„èŠ‚ç‚¹å¤§äºTREEIFY_THRESHOLD&#x3D;8æ—¶ï¼Œé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨æ ‘èŠ‚ç‚¹å°äºUNTREEIFY_THRESHOLD&#x3D;6æ—¶ï¼Œçº¢é»‘æ ‘è½¬å˜ä¸ºé“¾è¡¨ã€‚ï¼ˆä¹‹æ‰€ä»¥æœ‰8å’Œ6ä¸¤ä¸ªé˜ˆå€¼æ˜¯ä¸ºäº†é¿å…æŸä¸ªé“¾è¡¨åœ¨ä¸´ç•Œç‚¹é¢‘ç¹æ’å…¥åˆ é™¤ï¼Œå¯¼è‡´è½¬æ¢é¢‘ç¹é™ä½æ€§èƒ½ï¼‰ã€‚è€ŒHashtableçš„åº•å±‚å®ç°å°±æ˜¯æ•°ç»„+é“¾è¡¨ï¼Œè€Œæ²¡æœ‰çº¢é»‘æ ‘ï¼Œå› æ­¤å„ç§æ“ä½œéƒ½è¦ç®€å•å¾ˆå¤šã€‚</p>
</li>
<li><p><strong>å®¹é‡å’Œæ‰©å®¹ä¸åŒ</strong>ï¼šHashtableçš„å®¹é‡æ˜¯ç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„å®¹é‡initialCapacityã€‚HashMapåœ¨ç”¨æˆ·è¾“å…¥çš„åŸºç¡€ä¸Šï¼Œå¼ºåˆ¶å°†å®¹é‡è½¬æ¢ä¸ºå¤§äºè¾“å…¥å®¹é‡çš„æœ€å°2çš„å¹‚æ¬¡æ–¹æ•°å€¼ã€‚æ‰©å®¹æ–¹é¢ï¼Œ<code>HashMap</code> è‡ªåŠ¨æ‰©å®¹ä¸º 2 çš„å¹‚ï¼Œåˆ©äºä½è¿ç®—æå‡æ€§èƒ½ï¼Œè€Œ <code>Hashtable</code> æ‰©å®¹ä¸ºåŸå®¹é‡çš„ 2 å€åŠ  1ã€‚</p>
</li>
<li><p><strong>ç´¢å¼•è®¡ç®—ä¸Š</strong>ï¼Œ<code>HashMap</code> ä½¿ç”¨ <code>hash &amp; (length - 1)</code>ï¼Œæ¯” <code>Hashtable</code> çš„å–æ¨¡è¿ç®—æ›´é«˜æ•ˆã€‚</p>
</li>
<li><p><code>HashMap</code> çš„è¿­ä»£å™¨ä¸º fail-fast ç±»å‹ï¼Œå½“æœ‰å…¶å®ƒçº¿ç¨‹æ”¹å˜äº†HashMapçš„ç»“æ„ï¼ˆå¢åŠ æˆ–è€…ç§»é™¤å…ƒç´ ï¼‰ï¼Œå°†ä¼šæŠ›å‡ºå¹¶è¡Œä¿®æ”¹å¼‚å¸¸ï¼Œä½†è¿­ä»£å™¨æœ¬èº«çš„remove()æ–¹æ³•ç§»é™¤å…ƒç´ åˆ™ä¸ä¼šæŠ›å‡ºã€‚è€Œ <code>Hashtable</code> çš„ <code>Enumerator</code> ä¸æ˜¯ã€‚</p>
</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯é›¶æ‹·è´"><a href="#ä»€ä¹ˆæ˜¯é›¶æ‹·è´" class="headerlink" title="ä»€ä¹ˆæ˜¯é›¶æ‹·è´"></a>ä»€ä¹ˆæ˜¯é›¶æ‹·è´</h2><p>é›¶æ‹·è´ï¼ˆZero-Copyï¼‰æ˜¯ä¸€ç§é«˜æ•ˆçš„I&#x2F;Oæ“ä½œæŠ€æœ¯ï¼Œæ—¨åœ¨<strong>å‡å°‘æ•°æ®åœ¨å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´ä¸å¿…è¦çš„å¤åˆ¶</strong>ï¼Œä»è€Œæå‡æ•°æ®ä¼ è¾“æ€§èƒ½ã€‚ä¼ ç»ŸI&#x2F;Oæ“ä½œä¸­ï¼Œæ•°æ®é€šå¸¸éœ€ä»ç£ç›˜è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œå†å¤åˆ¶åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œå¤„ç†åå†å†™å›å†…æ ¸ç¼“å†²åŒºå¹¶å‘é€åˆ°ç½‘ç»œï¼Œæ¶‰åŠå¤šæ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´ã€‚é›¶æ‹·è´é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚Linuxçš„<code>sendfile</code>ã€<code>splice</code>æˆ–<code>mmap</code>ï¼‰ï¼Œè®©<strong>æ•°æ®ç›´æ¥åœ¨å†…æ ¸å†…éƒ¨ä»æ–‡ä»¶ç³»ç»Ÿç¼“å†²åŒºä¼ è¾“åˆ°ç½‘ç»œåè®®æ ˆ</strong>ï¼Œé¿å…äº†ç”¨æˆ·ç©ºé—´çš„ä¸­è½¬ã€‚è¿™ä¸ä»…<strong>å‡å°‘äº†CPUçš„æ‹·è´å¼€é”€ï¼Œä¹Ÿé™ä½äº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°</strong>ï¼Œæ˜¾è‘—æé«˜äº†å¤§æ–‡ä»¶ä¼ è¾“ã€ç½‘ç»œæœåŠ¡ç­‰åœºæ™¯çš„æ•ˆç‡ï¼Œæ˜¯é«˜æ€§èƒ½ç³»ç»Ÿè®¾è®¡ä¸­çš„å…³é”®æŠ€æœ¯ã€‚</p>
<p>ä¾‹å¦‚Nettyï¼šä½¿ç”¨å †å¤–ç›´æ¥å†…å­˜è¿›è¡ŒSocketè¯»å†™ï¼Œä¸éœ€è¦è¿›è¡Œå­—èŠ‚ç¼“å†²åŒºçš„äºŒæ¬¡æ‹·è´ï¼Œé¿å…äº† JVM å †å†…å­˜ä¸ç³»ç»Ÿå†…å­˜ä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚Nettyçš„Zero-copyå®Œå…¨æ˜¯åœ¨ç”¨æˆ·æ€ï¼ˆJavaåº”ç”¨å±‚ï¼‰çš„ï¼Œåå‘äºä¼˜åŒ–æ•°æ®æ“ä½œã€‚OSå±‚é¢çš„Zero-copyé€šå¸¸æ˜¯é¿å…åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ‹·è´æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚RocketMQï¼šåœ¨æ¶ˆæ¯å­˜å‚¨ä¸ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒRocketMQ åˆ©ç”¨é›¶æ‹·è´æŠ€æœ¯ä¼˜åŒ–æ¶ˆæ¯çš„å‘é€æ€§èƒ½ã€‚å½“æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯æ—¶ï¼Œé€šè¿‡ <code>mmap</code> å°†æ¶ˆæ¯æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ï¼Œæˆ–ä½¿ç”¨ <code>transferTo</code> è°ƒç”¨å®ç°æ•°æ®ä»æ–‡ä»¶é€šé“ç›´æ¥ä¼ è¾“åˆ°ç½‘ç»œé€šé“ï¼Œé¿å…å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´çš„å¤šæ¬¡æ‹·è´ã€‚è¿™ä¸ä»…å‡å°‘äº†å†…å­˜å ç”¨ï¼Œä¹ŸåŠ å¿«äº†æ¶ˆæ¯ä¼ è¾“é€Ÿåº¦ï¼Œæ”¯æŒé«˜ååé‡çš„æ¶ˆæ¯å¤„ç†ã€‚</p>
<h2 id="Rediså­—å…¸çš„å®ç°æ–¹å¼å’Œå†²çªå¤„ç†"><a href="#Rediså­—å…¸çš„å®ç°æ–¹å¼å’Œå†²çªå¤„ç†" class="headerlink" title="Rediså­—å…¸çš„å®ç°æ–¹å¼å’Œå†²çªå¤„ç†"></a>Rediså­—å…¸çš„å®ç°æ–¹å¼å’Œå†²çªå¤„ç†</h2><p>Rediså­—å…¸åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œå…¶æ ¸å¿ƒç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯æŒ‡å‘<code>dictEntry</code>é“¾è¡¨çš„æŒ‡é’ˆã€‚æ¯ä¸ª<code>dictEntry</code>å­˜å‚¨é”®å€¼å¯¹åŠä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œé€šè¿‡**é“¾åœ°å€æ³•ï¼ˆæ‹‰é“¾æ³•ï¼‰**å¤„ç†å“ˆå¸Œå†²çªï¼šå½“å¤šä¸ªé”®æ˜ å°„åˆ°åŒä¸€æ§½ä½æ—¶ï¼Œå®ƒä»¬è¢«é“¾æ¥åœ¨åŒä¸€é“¾è¡¨ä¸­ã€‚</p>
<p>Redisä½¿ç”¨MurmurHash2ç®—æ³•è®¡ç®—é”®çš„å“ˆå¸Œå€¼ï¼Œå†é€šè¿‡<code>hash &amp; (size-1)</code>ç¡®å®šç´¢å¼•ä½ç½®ï¼Œç¡®ä¿åˆ†å¸ƒå‡åŒ€ã€‚</p>
<p>ä¸ºåº”å¯¹æ•°æ®å¢é•¿ï¼ŒRedisæ”¯æŒåŠ¨æ€æ‰©å®¹ä¸ç¼©å®¹ã€‚å½“è´Ÿè½½å› å­è¿‡é«˜ï¼ˆå¦‚è¶…è¿‡1ï¼‰æˆ–è¿‡ä½æ—¶ï¼Œä¼šè§¦å‘rehashã€‚Redisé‡‡ç”¨<strong>æ¸è¿›å¼rehash</strong>æœºåˆ¶ï¼šåˆ†é…æ–°å“ˆå¸Œè¡¨ï¼Œæ¯æ¬¡è®¿é—®å­—å…¸æ—¶é¡ºå¸¦è¿ç§»éƒ¨åˆ†æ•°æ®ï¼Œç›´è‡³å…¨éƒ¨å®Œæˆã€‚è¿™é¿å…äº†é›†ä¸­è¿ç§»å¸¦æ¥çš„æ€§èƒ½é˜»å¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒRediså­—å…¸å†…éƒ¨ç»´æŠ¤ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼ˆht[0]å’Œht[1]ï¼‰ï¼Œåœ¨rehashæœŸé—´ä¸¤è€…å¹¶å­˜ï¼ŒæŸ¥æ‰¾ã€åˆ é™¤æ“ä½œä¼šå…¼é¡¾è®¿é—®ä¸¤ä¸ªè¡¨ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚æ’å…¥æ“ä½œä»…ä½œç”¨äºht[1]ã€‚rehashå®Œæˆåï¼Œht[1]æˆä¸ºä¸»è¡¨ï¼Œht[0]è¢«æ¸…ç©ºã€‚ </p>
<p>æ­¤å¤–ï¼ŒRedisåœ¨å“ˆå¸Œè¡¨æ‰©å®¹æ—¶ï¼Œæ–°è¡¨å¤§å°ä¸ºå¤§äºå½“å‰å®¹é‡çš„æœ€å°2çš„å¹‚ï¼Œç¡®ä¿ä½è¿ç®—é«˜æ•ˆå®šä½ã€‚</p>
<h2 id="ä»‹ç»MVCæœºåˆ¶"><a href="#ä»‹ç»MVCæœºåˆ¶" class="headerlink" title="ä»‹ç»MVCæœºåˆ¶"></a>ä»‹ç»MVCæœºåˆ¶</h2><p>MVCï¼ˆModel-View-Controllerï¼Œæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼‰æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼ï¼Œç”¨äºåˆ†ç¦»åº”ç”¨ç¨‹åºçš„é€»è¾‘ä¸ç•Œé¢ã€‚</p>
<p>æ¨¡å‹ï¼ˆModelï¼‰ä»£è¡¨æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†æ ¸å¿ƒçš„æ•°æ®ç®¡ç†å’Œè§„åˆ™å®šä¹‰ï¼Œå¹¶åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥è§†å›¾ï¼ˆViewï¼‰ã€‚</p>
<p>è§†å›¾ï¼ˆViewï¼‰è´Ÿè´£å±•ç¤ºä¿¡æ¯ç»™ç”¨æˆ·ï¼Œå®ƒä»æ¨¡å‹è·å–æ•°æ®æ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œä½†ä¸ç›´æ¥ä¸æ¨¡å‹äº¤äº’ï¼Œè€Œæ˜¯é€šè¿‡æ§åˆ¶å™¨ï¼ˆControllerï¼‰ã€‚</p>
<p>æ§åˆ¶å™¨æ¥æ”¶ç”¨æˆ·çš„è¾“å…¥ï¼Œè§£é‡Šè¿™äº›è¾“å…¥å¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºå¯¹æ¨¡å‹æˆ–è§†å›¾çš„æ“ä½œå‘½ä»¤ï¼Œå¦‚æ›´æ–°æ•°æ®æˆ–è¯·æ±‚è§†å›¾åˆ·æ–°ã€‚</p>
<p>è¿™ç§åˆ†ç¦»ä½¿å¾—ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•ï¼Œç‰¹åˆ«é€‚åˆäºå¼€å‘å¤æ‚ç”¨æˆ·ç•Œé¢çš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶æé«˜äº†çµæ´»æ€§å’Œå¯é‡ç”¨æ€§ã€‚MVCå¹¿æ³›åº”ç”¨äºWebåº”ç”¨æ¡†æ¶ä¸­ï¼Œå¦‚Djangoï¼ˆ<strong>ä¸€ä¸ªé«˜çº§çš„Python Webæ¡†æ¶ï¼Œéµå¾ªæ¨¡å‹-æ¨¡æ¿-è§†å›¾ï¼ˆModel-Template-View, MTVï¼‰æ¶æ„æ¨¡å¼ï¼Œæ¨¡å‹ï¼ˆModelï¼‰å®šä¹‰æ•°æ®ç»“æ„ï¼›æ¨¡æ¿ï¼ˆTemplateï¼‰æ§åˆ¶é¡µé¢å±•ç¤ºé€»è¾‘ï¼›è§†å›¾ï¼ˆViewï¼‰åˆ™æ˜¯ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå†³å®šäº†å“ªäº›æ•°æ®è¢«å‘ˆç°ã€‚</strong>ï¼‰ã€Ruby on Railsç­‰ã€‚</p>
<h2 id="Flinkå’ŒSparkçš„åŒºåˆ«"><a href="#Flinkå’ŒSparkçš„åŒºåˆ«" class="headerlink" title="Flinkå’ŒSparkçš„åŒºåˆ«"></a>Flinkå’ŒSparkçš„åŒºåˆ«</h2><p>Apache Flink å’Œ Apache Spark éƒ½æ˜¯åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼ŒFlinkæµå¤„ç†ï¼ŒSparkæ‰¹å¤„ç†ã€‚</p>
<p>å¤„ç†æ¨¡å‹</p>
<ul>
<li><strong>Flink</strong> ä¸»è¦æ”¯æŒæµå¤„ç†ï¼Œå¹¶ä»¥æµå¤„ç†ä¸ºåŸºç¡€æ‰©å±•åˆ°æ‰¹å¤„ç†ã€‚è¿™æ„å‘³ç€å®ƒé¦–å…ˆè¢«è®¾è®¡ç”¨äºå®æ—¶æ•°æ®å¤„ç†ï¼Œèƒ½å¤Ÿæä¾›ä½å»¶è¿Ÿçš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œé€‚ç”¨äºéœ€è¦å³æ—¶å“åº”çš„åº”ç”¨åœºæ™¯ã€‚</li>
<li><strong>Spark</strong> æœ€åˆæ˜¯ä½œä¸ºä¸€ä¸ªæ‰¹å¤„ç†æ¡†æ¶è€Œè®¾è®¡çš„ï¼Œåæ¥é€šè¿‡Spark Streamingå¢åŠ äº†å¯¹æµå¤„ç†çš„æ”¯æŒã€‚Spark Streamingé‡‡ç”¨å¾®æ‰¹å¤„ç†çš„æ–¹å¼ï¼ˆmini-batchï¼‰ï¼Œå³æŠŠæµæ•°æ®æŒ‰æ—¶é—´çª—å£åˆ†å‰²æˆä¸€ç³»åˆ—å°æ‰¹æ¬¡æ¥å¤„ç†ï¼Œè¿™ä½¿å¾—å®ƒçš„å»¶è¿Ÿæ¯”Flinkç¨é«˜ä¸€äº›ã€‚</li>
</ul>
<p>ååé‡</p>
<p>å…³äºååé‡ï¼Œä¸¤è€…éƒ½æœ‰å¾ˆé«˜çš„å¤„ç†æ•ˆç‡ï¼Œä½†åœ¨ä¸åŒåœºæ™¯ä¸‹è¡¨ç°å„å¼‚ï¼š</p>
<ul>
<li><strong>Flink</strong> ç”±äºå…¶åŸç”Ÿçš„æµå¤„ç†æ¶æ„ï¼Œåœ¨å¤„ç†æŒç»­ä¸æ–­çš„æ•°æ®æµæ—¶å…·æœ‰æ›´é«˜çš„ååé‡å’Œæ›´ä½çš„å»¶è¿Ÿã€‚å¯¹äºè¦æ±‚ä¸¥æ ¼å®æ—¶æ€§çš„åº”ç”¨ï¼Œæ¯”å¦‚æ¬ºè¯ˆæ£€æµ‹ã€åœ¨çº¿æ¨èç³»ç»Ÿç­‰ï¼ŒFlinké€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</li>
<li><strong>Spark</strong> åœ¨æ‰¹å¤„ç†ä»»åŠ¡ä¸Šè¡¨ç°å‡ºè‰²ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§è§„æ¨¡é™æ€æ•°æ®é›†æ—¶ã€‚å°½ç®¡Spark Streamingå¯ä»¥é€šè¿‡å¢åŠ æ‰¹æ¬¡å¤§å°æ¥æé«˜ååé‡ï¼Œä½†è¿™æ ·åšä¼šå¢åŠ å¤„ç†å»¶è¿Ÿã€‚å› æ­¤ï¼Œå¯¹äºé‚£äº›å¯ä»¥å®¹å¿ä¸€å®šå»¶è¿Ÿçš„å¤§è§„æ¨¡æ•°æ®åˆ†æä»»åŠ¡ï¼ŒSparkå¯èƒ½æ›´ä¸ºåˆé€‚ã€‚</li>
</ul>
<h2 id="ä»‹ç»JVM"><a href="#ä»‹ç»JVM" class="headerlink" title="ä»‹ç»JVM"></a>ä»‹ç»JVM</h2><p>JVMï¼ˆJavaè™šæ‹Ÿæœºï¼‰æ˜¯è¿è¡ŒJavaåº”ç”¨ç¨‹åºçš„è™šæ‹Ÿæœºï¼Œå®ƒä½¿å¾—Javaç¨‹åºå…·æœ‰â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€çš„èƒ½åŠ›ã€‚JVMçš„ä¸»è¦ä»»åŠ¡æ˜¯å°†ç¼–å†™çš„Javaå­—èŠ‚ç ï¼ˆ.classæ–‡ä»¶ï¼‰è½¬æ¢æˆæœ¬åœ°è®¡ç®—æœºçš„æœºå™¨ç å¹¶æ‰§è¡Œã€‚é€šè¿‡æä¾›ä¸€ä¸ªè·¨å¹³å°çš„è¿è¡Œç¯å¢ƒï¼ŒJVMéšè—äº†åº•å±‚æ“ä½œç³»ç»Ÿçš„å·®å¼‚ï¼Œç¡®ä¿äº†Javaç¨‹åºå¯ä»¥åœ¨ä»»ä½•å®‰è£…æœ‰ç›¸åº”JVMçš„è®¾å¤‡ä¸Šè¿è¡Œã€‚</p>
<p>JVMåŒ…å«ç±»åŠ è½½å™¨ã€è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆåŒ…æ‹¬æ–¹æ³•åŒºã€å †ã€æ ˆç­‰ï¼‰ã€æ‰§è¡Œå¼•æ“ç­‰å…³é”®ç»„ä»¶ã€‚ç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½ç¨‹åºæ‰€éœ€çš„ç±»æ–‡ä»¶ï¼›è¿è¡Œæ—¶æ•°æ®åŒºä¸ºç¨‹åºæ‰§è¡Œæä¾›å†…å­˜ç©ºé—´ï¼›æ‰§è¡Œå¼•æ“åˆ™è´Ÿè´£è§£é‡Šæˆ–å³æ—¶ç¼–è¯‘å­—èŠ‚ç ä¸ºæœºå™¨ç æ‰§è¡Œã€‚æ­¤å¤–ï¼ŒJVMè¿˜åŒ…å«äº†åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œé‡Šæ”¾ä¸å†ä½¿ç”¨çš„å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´ã€‚JVMä¸ä»…æ”¯æŒJavaè¯­è¨€ï¼Œè¿˜æ”¯æŒå…¶ä»–å¯ä»¥ç¼–è¯‘æˆJavaå­—èŠ‚ç çš„è¯­è¨€ï¼Œå¦‚Kotlinå’ŒScalaã€‚</p>
<h2 id="JVMè°ƒä¼˜ç»éªŒ"><a href="#JVMè°ƒä¼˜ç»éªŒ" class="headerlink" title="JVMè°ƒä¼˜ç»éªŒ"></a>JVMè°ƒä¼˜ç»éªŒ</h2><p>ä¸»è¦ç›®æ ‡æ˜¯ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€å‡å°‘GCåœé¡¿æ—¶é—´ä»¥åŠæé«˜ç³»ç»Ÿååé‡ã€‚</p>
<ol>
<li><strong>åˆç†è®¾ç½®å †å¤§å°</strong>ï¼šæ ¹æ®åº”ç”¨çš„å®é™…éœ€æ±‚å’ŒæœåŠ¡å™¨èµ„æºï¼Œåˆç†é…ç½®<code>-Xms</code>ï¼ˆåˆå§‹å †å¤§å°ï¼‰å’Œ<code>-Xmx</code>ï¼ˆæœ€å¤§å †å¤§å°ï¼‰ï¼Œé¿å…é¢‘ç¹çš„GCã€‚é€šå¸¸å»ºè®®å°†åˆå§‹å †å’Œæœ€å¤§å †è®¾ç½®ä¸ºç›¸åŒå€¼ï¼Œä»¥å‡å°‘åŠ¨æ€æ‰©å±•å¸¦æ¥çš„å¼€é”€ã€‚16Gæœºå™¨è®¾ç½®12Gã€‚</li>
<li><strong>é€‰æ‹©åˆé€‚çš„åƒåœ¾å›æ”¶å™¨</strong>ï¼š<ul>
<li>å¯¹äºä½å»¶è¿Ÿè¦æ±‚çš„åº”ç”¨ï¼Œå¯ä»¥é€‰æ‹©G1æˆ–ZGCç­‰ä½å»¶è¿Ÿå›æ”¶å™¨ã€‚</li>
<li>å¯¹äºé«˜ååé‡è¦æ±‚çš„æ‰¹å¤„ç†ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨CMSå¹¶å‘æ¸…é™¤ã€‚</li>
</ul>
</li>
<li><strong>ç›‘æ§ä¸åˆ†æGCæ—¥å¿—</strong>ï¼šé€šè¿‡å¯ç”¨GCæ—¥å¿—ï¼Œç»“åˆå·¥å…·å¦‚<code>GCViewer</code>æˆ–<code>GCEasy</code>åˆ†æGCè¡Œä¸ºï¼Œè¯†åˆ«æ˜¯å¦å­˜åœ¨é¢‘ç¹çš„Full GCæˆ–é•¿æ—¶é—´çš„åœé¡¿ã€‚jstatç›‘æ§GCã€‚</li>
<li><strong>ä¼˜åŒ–æ–°ç”Ÿä»£æ¯”ä¾‹</strong>ï¼šé€šè¿‡<code>-XX:NewRatio</code>å’Œ<code>-XX:SurvivorRatio</code>è°ƒæ•´æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹ï¼Œç¡®ä¿å¤§å¤šæ•°å¯¹è±¡åœ¨Minor GCä¸­è¢«å›æ”¶ï¼Œå‡å°‘æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡æ•°é‡ã€‚</li>
<li><strong>åˆç†ä½¿ç”¨å…ƒç©ºé—´</strong>ï¼šJDK 8ä»¥åï¼Œæ°¸ä¹…ä»£è¢«å…ƒç©ºé—´å–ä»£ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜å­˜å‚¨ç±»ä¿¡æ¯ã€‚å¯é€šè¿‡<code>-XX:MetaspaceSize</code>å’Œ<code>-XX:MaxMetaspaceSize</code>æ§åˆ¶å…¶å¤§å°ï¼Œé˜²æ­¢å› åŠ è½½è¿‡å¤šç±»å¯¼è‡´å†…å­˜æº¢å‡ºã€‚</li>
<li><strong>çº¿ç¨‹æ ˆå¤§å°è°ƒæ•´</strong>ï¼šå¯¹äºçº¿ç¨‹æ•°è¾ƒå¤šçš„åº”ç”¨ï¼Œé€‚å½“å‡å°<code>-Xss</code>ï¼ˆçº¿ç¨‹æ ˆå¤§å°ï¼‰å¯èŠ‚çœå†…å­˜ï¼Œä½†éœ€ç¡®ä¿ä¸ä¼šå¯¼è‡´æ ˆæº¢å‡ºã€‚</li>
</ol>
<h2 id="JVMçš„å †åˆ†ä¸ºå“ªå‡ éƒ¨åˆ†"><a href="#JVMçš„å †åˆ†ä¸ºå“ªå‡ éƒ¨åˆ†" class="headerlink" title="JVMçš„å †åˆ†ä¸ºå“ªå‡ éƒ¨åˆ†"></a>JVMçš„å †åˆ†ä¸ºå“ªå‡ éƒ¨åˆ†</h2><p>JVMçš„å †æ˜¯å†…å­˜ç®¡ç†çš„æ ¸å¿ƒåŒºåŸŸï¼Œç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>
<ol>
<li><strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</strong>ï¼šæ–°åˆ›å»ºçš„å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨æ­¤ã€‚å®ƒåˆåˆ†ä¸ºEdenåŒºã€From SurvivoråŒºå’ŒTo SurvivoråŒºã€‚å¤§å¤šæ•°å¯¹è±¡åœ¨EdenåŒºåˆ†é…ï¼Œç»è¿‡å‡ æ¬¡åƒåœ¾å›æ”¶åä»å­˜æ´»çš„å¯¹è±¡å°†è¢«ç§»åˆ°SurvivoråŒºã€‚</li>
<li><strong>è€å¹´ä»£ï¼ˆOld Generationï¼‰</strong>ï¼šå­˜æ”¾ä»æ–°ç”Ÿä»£æ™‹å‡è¿‡æ¥çš„é•¿æœŸå­˜æ´»å¯¹è±¡ã€‚å½“å¯¹è±¡ç»å†å¤šæ¬¡GCæœªè¢«å›æ”¶ï¼Œæˆ–å ç”¨ç©ºé—´è¾ƒå¤§æ—¶ï¼Œä¼šè¢«ç§»å…¥è€å¹´ä»£ã€‚</li>
<li><strong>æ°¸ä¹…ä»£&#x2F;å…ƒç©ºé—´ï¼ˆPermGen&#x2F;Metaspaceï¼‰</strong>ï¼šæ–¹æ³•åŒºï¼ŒJDK 8ä¹‹å‰ä¸ºæ°¸ä¹…ä»£ï¼Œç”¨äºå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰ï¼›JDK 8åŠä»¥åæ”¹ä¸ºå…ƒç©ºé—´ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜ç®¡ç†ï¼Œé¿å…äº†æ°¸ä¹…ä»£çš„å†…å­˜æº¢å‡ºé—®é¢˜ã€‚</li>
</ol>
<p>å †ç”±åƒåœ¾å›æ”¶å™¨ç»Ÿä¸€ç®¡ç†ï¼Œæ˜¯GCçš„ä¸»è¦åŒºåŸŸã€‚</p>
<h2 id="æ•°æ®ä»“åº“å’Œä¼ ç»Ÿæ•°æ®åº“æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#æ•°æ®ä»“åº“å’Œä¼ ç»Ÿæ•°æ®åº“æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="æ•°æ®ä»“åº“å’Œä¼ ç»Ÿæ•°æ®åº“æœ‰ä»€ä¹ˆåŒºåˆ«"></a>æ•°æ®ä»“åº“å’Œä¼ ç»Ÿæ•°æ®åº“æœ‰ä»€ä¹ˆåŒºåˆ«</h2><p>ç”¨é€”ï¼šä¼ ç»Ÿæ•°æ®åº“ä¸»è¦ç”¨äºOLTPï¼ˆon-line transaction processingï¼‰ç¿»è¯‘ä¸ºè”æœºäº‹åŠ¡å¤„ç†ï¼Œå³å³æ—¶çš„ç³»ç»Ÿäº¤äº’ï¼Œæ•°æ®ä»“åº“ä¸»è¦ç”¨äºOLAPï¼ˆOn-Line Analytical Processingï¼‰ç¿»è¯‘ä¸ºè”æœºåˆ†æå¤„ç†ï¼Œä»å­—é¢ä¸Šæ¥çœ‹OLTPæ˜¯åšäº‹åŠ¡å¤„ç†ï¼ŒOLAPæ˜¯åšåˆ†æå¤„ç†ã€‚ä»å¯¹æ•°æ®åº“æ“ä½œæ¥çœ‹ï¼ŒOLTPä¸»è¦æ˜¯å¯¹æ•°æ®çš„å¢åˆ æ”¹ï¼ŒOLAPæ˜¯å¯¹æ•°æ®çš„æŸ¥è¯¢ã€‚</p>
<p>å»ºæ¨¡ï¼šä¼ ç»Ÿæ•°æ®åº“ä¸»è¦ä½¿ç”¨èŒƒå¼å»ºæ¨¡ï¼Œæ•°æ®ä»“åº“å¯ä»¥æ ¹æ®éœ€è¦é‡‡ç”¨èŒƒå¼å»ºæ¨¡æˆ–è€…ç°åœ¨äº’è”ç½‘æ™®éä½¿ç”¨çš„æ˜Ÿå½¢æ¨¡å‹ç­‰ã€‚</p>
<p>ä½¿ç”¨æŠ€æœ¯ï¼šä¼ ç»Ÿæ•°æ®åº“ä¸€èˆ¬ä½¿ç”¨mysqlç­‰å…³ç³»å‹æ•°æ®åº“ï¼Œæ•°æ®ä»“åº“ç›®å‰äº’è”ç½‘è¡Œä¸šæ›´å¤šçš„æ˜¯ä½¿ç”¨hadoopç­‰å¤§æ•°æ®æŠ€æœ¯ï¼Œä¹Ÿæœ‰ä½¿ç”¨mysqlç­‰ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ­å»ºã€‚ </p>
<p>å­˜å‚¨çš„æ•°æ®ï¼šä¼ ç»Ÿæ•°æ®åº“åªå­˜å‚¨å½“å‰çŠ¶æ€çš„æ•°æ®ï¼Œæ•°æ®ä»“åº“éœ€è¦å­˜å‚¨å†å²çŠ¶æ€çš„æ•°æ®ï¼Œç”¨æˆ·å¯¹å†å²æ•°æ®çš„å›æº¯åˆ†æã€‚  </p>
<p>ODPSè®¾è®¡ç”¨äºå¤§è§„æ¨¡æ•°æ®å­˜å‚¨ã€å¤„ç†å’Œåˆ†æï¼Œæ”¯æŒåŒ…æ‹¬æ‰¹å¤„ç†ã€æµè®¡ç®—ã€äº¤äº’å¼æŸ¥è¯¢åœ¨å†…çš„å¤šç§è®¡ç®—æ¨¡å¼ï¼Œæ›´æ¥è¿‘äºæ•°ä»“ã€‚</p>
<h2 id="IOå¤šè·¯å¤ç”¨"><a href="#IOå¤šè·¯å¤ç”¨" class="headerlink" title="IOå¤šè·¯å¤ç”¨"></a>IOå¤šè·¯å¤ç”¨</h2><p>IOå¤šè·¯å¤ç”¨æ˜¯ä¸€ç§å…è®¸å•ä¸ªè¿›ç¨‹ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„æŠ€æœ¯ï¼Œä½¿å¾—ç³»ç»Ÿåœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚ä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆé€šå¸¸æ˜¯è¯»å°±ç»ªæˆ–å†™å°±ç»ªï¼‰ï¼Œå°±èƒ½è¿›è¡Œç›¸åº”çš„IOç³»ç»Ÿè°ƒç”¨ã€‚å…¶æ ¸å¿ƒæœºåˆ¶ä¾èµ–äºæ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚selectã€pollå’Œepollï¼ˆLinuxï¼‰ã€‚é€šè¿‡è¿™äº›è°ƒç”¨ï¼Œç¨‹åºå¯ä»¥ä¸€æ¬¡æ€§ç›‘å¬å¤šä¸ªsocketæˆ–å…¶ä»–IOèµ„æºçš„çŠ¶æ€ï¼Œé¿å…äº†ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºç‹¬ç«‹çº¿ç¨‹æˆ–è¿›ç¨‹çš„å¼€é”€ã€‚</p>
<p>epollç›¸å¯¹äºselectçš„æ”¹è¿›ï¼š</p>
<p>1.selectå•è¿›ç¨‹æ‰“å¼€çš„æœ€å¤§çš„fdæ˜¯æœ‰é™åˆ¶çš„ï¼Œé»˜è®¤æ˜¯1024ä¸ªï¼Œå¯¹äºéœ€è¦æ”¯æŒä¸Šä¸‡TCPè¿æ¥çš„æœåŠ¡å™¨æ¥è¯´å¤ªå°‘ã€‚epollæ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œæ”¯æŒçš„æœ€å¤§fdä¸Šé™æ˜¯æ“ä½œç³»ç»Ÿæœ€å¤§æ–‡ä»¶å¥æŸ„æ•°ã€‚1Gå†…å­˜çš„æœºå™¨å¤§çº¦æ˜¯10ä¸‡ä¸ªå¥æŸ„ã€‚</p>
<p>2.IOæ•ˆç‡ä¸ä¼šéšç€FDå¢åŠ è€Œçº¿æ€§ä¸‹é™ã€‚selectå’Œpollç¼ºç‚¹æ˜¯å½“æœ‰å¾ˆå¤§çš„socketé›†åˆæ—¶ï¼Œä»»æ„æ—¶åˆ»åªæœ‰å°‘éƒ¨åˆ†çš„socketæ˜¯æ´»è·ƒçš„ï¼Œselectå’Œpollæ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ‰«æå…¨éƒ¨é›†åˆï¼Œå¯¼è‡´æ•ˆç‡ä¸‹é™ã€‚epollä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œæ›´é«˜æ•ˆçš„äº‹ä»¶é€šçŸ¥æœºåˆ¶ã€‚</p>
<p>3.epollé€šè¿‡mmapï¼ˆå†…å­˜æ˜ å°„ï¼‰æŠ€æœ¯å°†å†…æ ¸ç©ºé—´ä¸­çš„äº‹ä»¶å°±ç»ªåˆ—è¡¨æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œä»è€Œè®©åº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®è¿™ä¸ªåˆ—è¡¨ï¼Œå‡å°‘äº†å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´çš„æ•°æ®å¤åˆ¶å’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼ŒåŠ é€Ÿäº†æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ã€‚è¿™ç§æ–¹å¼æé«˜äº†å¤„ç†å¤§é‡å¹¶å‘è¿æ¥æ—¶çš„æ•ˆç‡å’Œæ€§èƒ½ã€‚</p>
<h2 id="Javaå’ŒPythonçš„åŒºåˆ«"><a href="#Javaå’ŒPythonçš„åŒºåˆ«" class="headerlink" title="Javaå’ŒPythonçš„åŒºåˆ«"></a>Javaå’ŒPythonçš„åŒºåˆ«</h2><p><strong>è¯­æ³•ä¸å¼€å‘æ•ˆç‡</strong>ï¼šPython è¯­æ³•ç®€æ´ç›´è§‚ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘ï¼›Java è¯­æ³•è¾ƒä¸¥è°¨ï¼Œä»£ç é‡é€šå¸¸æ›´å¤šã€‚</p>
<p><strong>ç±»å‹ç³»ç»Ÿ</strong>ï¼šPython æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå˜é‡ç±»å‹åœ¨è¿è¡Œæ—¶ç¡®å®šï¼›Java æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œéœ€åœ¨ç¼–è¯‘æ—¶å£°æ˜ç±»å‹ï¼Œç±»å‹å®‰å…¨æ›´å¼ºã€‚</p>
<p><strong>æ‰§è¡Œæ–¹å¼</strong>ï¼šPython æ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œé€šè¿‡è§£é‡Šå™¨æ‰§è¡Œï¼›Java æ˜¯ç¼–è¯‘å‹è¯­è¨€ï¼Œå…ˆç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå†ç”± JVM è§£é‡Šæˆ– JIT ç¼–è¯‘æ‰§è¡Œã€‚</p>
<p><strong>æ€§èƒ½</strong>ï¼šJava é€šå¸¸æ€§èƒ½æ›´é«˜ï¼Œå¾—ç›Šäº JVM çš„ä¼˜åŒ–ï¼›Python åœ¨è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¸­ç›¸å¯¹è¾ƒæ…¢ã€‚</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šJava å¸¸ç”¨äºå¤§å‹ä¼ä¸šçº§åº”ç”¨ã€Android å¼€å‘ï¼›Python å¹¿æ³›åº”ç”¨äºæ•°æ®ç§‘å­¦ã€AIã€è„šæœ¬å’ŒWebå¼€å‘ã€‚</p>
<h2 id="Seataåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"><a href="#Seataåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Seataåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"></a>Seataåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</h2><p>Seataæ˜¯èš‚èšé‡‘æœå’Œé˜¿é‡Œå·´å·´å…±åŒå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚è‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼šæ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€æ¬¡æ“ä½œéœ€è¦è·¨å¤šä¸ªèŠ‚ç‚¹ã€æœåŠ¡æˆ–æ•°æ®åº“åè°ƒå®Œæˆï¼Œè¦æ±‚è¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<p>å…¶ä¸­ä¸‰ä¸ªé‡è¦è§’è‰²ï¼š <strong>TC</strong> **äº‹åŠ¡åè°ƒè€…ï¼š**ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚  **TM ** **äº‹åŠ¡ç®¡ç†å™¨ï¼š**å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ã€å¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚  **RM ** **èµ„æºç®¡ç†å™¨ï¼š**ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p>
<p>å››ç§ä¸åŒçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>XAæ¨¡å¼ï¼šå¼ºä¸€è‡´æ€§åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œç‰ºç‰²äº†ä¸€å®šçš„å¯ç”¨æ€§ï¼Œæ— ä¸šåŠ¡ä¾µå…¥ </li>
<li>TCCæ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œé€šè¿‡ä¸šåŠ¡å±‚é¢å®šä¹‰å°è¯•ã€ç¡®è®¤å’Œå–æ¶ˆæ“ä½œï¼Œå®ç°çµæ´»çš„è¡¥å¿å‹äº‹åŠ¡ã€‚ï¼ˆæŸ”æ€§äº‹åŠ¡ï¼‰</li>
<li>ATæ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæ— ä¸šåŠ¡ä¾µå…¥ï¼Œä¹Ÿæ˜¯Seataçš„é»˜è®¤æ¨¡å¼ </li>
<li>SAGAæ¨¡å¼ï¼šå°†é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œæ¯ä¸ªæ­¥éª¤æ‰§è¡Œåè®°å½•çŠ¶æ€ï¼Œå‡ºé”™æ—¶é€šè¿‡è¡¥å¿æ“ä½œå›æ»šå‰é¢å·²å®Œæˆçš„æ­¥éª¤ã€‚ï¼ˆæŸ”æ€§äº‹åŠ¡ï¼‰</li>
</ul>
<h2 id="Rediså®ç°é˜²è¶…å–"><a href="#Rediså®ç°é˜²è¶…å–" class="headerlink" title="Rediså®ç°é˜²è¶…å–"></a>Rediså®ç°é˜²è¶…å–</h2><p>ä½¿ç”¨Rediså¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†åº“å­˜å¹¶ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p>ä¸€ç§å¸¸è§çš„åšæ³•æ˜¯åˆ©ç”¨Redisçš„<code>WATCH</code>æœºåˆ¶ç»“åˆäº‹åŠ¡æ¥ç¡®ä¿åº“å­˜æ‰£å‡æ“ä½œçš„åŸå­æ€§å’Œä¸€è‡´æ€§ã€‚é¦–å…ˆï¼Œå°†å•†å“åº“å­˜å­˜å‚¨åœ¨Redisä¸­ã€‚å½“æœ‰è´­ä¹°è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯å…ˆé€šè¿‡<code>WATCH</code>å‘½ä»¤ç›‘æ§åº“å­˜é”®çš„çŠ¶æ€ã€‚ç„¶åï¼Œåœ¨äº‹åŠ¡ä¸­å°è¯•æ‰§è¡Œåº“å­˜æ£€æŸ¥å’Œæ‰£å‡æ“ä½œï¼ˆå¦‚<code>DECR</code>ï¼‰ã€‚å¦‚æœåœ¨è¿™æœŸé—´æ²¡æœ‰å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹è¯¥åº“å­˜é”®ï¼Œåˆ™<code>EXEC</code>å‘½ä»¤ä¼šæˆåŠŸæ‰§è¡Œäº‹åŠ¡ï¼›å¦‚æœæœ‰å…¶ä»–å®¢æˆ·ç«¯åœ¨æ­¤æœŸé—´ä¿®æ”¹äº†åº“å­˜å€¼ï¼Œåˆ™å½“å‰äº‹åŠ¡ä¼šè¢«æ”¾å¼ƒï¼Œéœ€è¦é‡æ–°å°è¯•æ•´ä¸ªè¿‡ç¨‹ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆåªç”¨INCR&#x2F;DECRä¸è¡Œ</strong>ï¼šè™½ç„¶Redisçš„<code>INCR</code>å’Œ<code>DECR</code>å‘½ä»¤æœ¬èº«æ˜¯åŸå­æ€§çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨äºå¢åŠ æˆ–å‡å°‘æ•°å€¼ï¼Œä½†åœ¨å¹¶å‘ç¯å¢ƒä¸‹ä»…ä¾èµ–è¿™äº›å‘½ä»¤æ— æ³•å®Œå…¨é¿å…è¶…å–é—®é¢˜ã€‚è¿™æ˜¯å› ä¸ºï¼š</p>
<ul>
<li><strong>ç¼ºä¹å‰ç½®æ¡ä»¶åˆ¤æ–­</strong>ï¼šç›´æ¥ä½¿ç”¨<code>DECR</code>å¯èƒ½ä¼šå¯¼è‡´åº“å­˜å˜ä¸ºè´Ÿæ•°ï¼Œå³è¶…è¿‡å®é™…åº“å­˜æ•°é‡çš„å•†å“è¢«å–å‡ºã€‚</li>
<li><strong>æ— å›æ»šæœºåˆ¶</strong>ï¼šä¸€æ—¦åç»­ä¸šåŠ¡é€»è¾‘å¤±è´¥ï¼ˆä¾‹å¦‚è®¢å•åˆ›å»ºå¤±è´¥ï¼‰ï¼Œæ— æ³•è‡ªåŠ¨æ¢å¤å·²æ‰£å‡çš„åº“å­˜ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨WATCHå’Œäº‹åŠ¡ï¼š</strong></p>
<ul>
<li><strong>ç¡®ä¿æ•°æ®ä¸€è‡´æ€§</strong>ï¼šé€šè¿‡<code>WATCH</code>ç›‘æ§å…³é”®èµ„æºï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹åªæœ‰åœ¨èµ„æºæœªè¢«å…¶ä»–è¿›ç¨‹ä¿®æ”¹çš„å‰æä¸‹æ‰æ‰§è¡Œäº‹åŠ¡ï¼Œä¿è¯äº†å¤šä¸ªæ­¥éª¤ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œé¿å…äº†ç«æ€æ¡ä»¶ã€‚</li>
<li><strong>æä¾›ä¹è§‚é”åŠŸèƒ½</strong>ï¼š<code>WATCH</code>æœºåˆ¶æ˜¯ä¸€ç§å®ç°ä¹è§‚é”çš„æ–¹å¼ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯åœ¨æ‰§è¡Œäº‹åŠ¡å‰ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œå‰è¿™äº›é”®è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹è¿‡ï¼Œåˆ™äº‹åŠ¡å°†å¤±è´¥ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚è¿™ç§æœºåˆ¶éå¸¸é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚ä¸€ç§æ— é”æœºåˆ¶æ¥è§£å†³å¹¶å‘é—®é¢˜ã€‚</li>
</ul>
<h2 id="é«˜å¹¶å‘é¡¹ç›®ä¸­çš„é™æµå’Œç†”æ–­"><a href="#é«˜å¹¶å‘é¡¹ç›®ä¸­çš„é™æµå’Œç†”æ–­" class="headerlink" title="é«˜å¹¶å‘é¡¹ç›®ä¸­çš„é™æµå’Œç†”æ–­"></a>é«˜å¹¶å‘é¡¹ç›®ä¸­çš„é™æµå’Œç†”æ–­</h2><p><strong>é™æµ</strong>ï¼šç›®çš„æ˜¯æ§åˆ¶è¯·æ±‚é‡ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚å¸¸ç”¨ç®—æ³•åŒ…æ‹¬ä»¤ç‰Œæ¡¶å’Œæ¼æ¡¶ç®—æ³•ã€‚é€šè¿‡è®¾å®šé€Ÿç‡é˜ˆå€¼ï¼Œå¦‚æ¯ç§’å¤„ç†è¯·æ±‚æ•°ï¼ˆRPSï¼‰ï¼Œè¶…è¿‡é™åˆ¶çš„è¯·æ±‚å°†è¢«æ‹’ç»æˆ–æ’é˜Ÿã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨Guavaçš„RateLimiterç±»å®ç°å¹³æ»‘é™æµã€‚é˜¿é‡Œå·´å·´çš„Sentinelï¼Œå®ç°å¯¹ç‰¹å®šèµ„æºçš„ç²¾å‡†é™æµï¼Œç¡®ä¿ç³»ç»Ÿåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p>
<p><strong>ç†”æ–­</strong>ï¼šç”¨äºé¿å…æ•…éšœæ‰©æ•£ã€‚å½“æœåŠ¡è°ƒç”¨å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼ˆå¦‚50%è¯·æ±‚å¤±è´¥ï¼‰ï¼Œå¯åŠ¨ç†”æ–­å™¨ï¼Œå¿«é€Ÿå¤±è´¥è€Œä¸æ˜¯å°è¯•æ‰§è¡Œå¯èƒ½è€—æ—¶çš„æ“ä½œã€‚ä¸€æ®µæ—¶é—´åï¼Œå…è®¸éƒ¨åˆ†è¯·æ±‚é€šè¿‡è¿›è¡Œè¯•æ¢æ€§æ¢å¤ã€‚Hystrixæ˜¯ä¸€ä¸ªæµè¡Œçš„ç†”æ–­åº“ï¼Œå®ƒæä¾›äº†å¼€ç®±å³ç”¨çš„ç†”æ–­ã€é™çº§ç­‰åŠŸèƒ½ã€‚</p>
<h2 id="ä¼˜åŒ–å¤šèŠ‚ç‚¹æµç¨‹ç¼–æ’ï¼Œä¼˜åŒ–å·¥ä½œæµå¼•æ“æ€§èƒ½"><a href="#ä¼˜åŒ–å¤šèŠ‚ç‚¹æµç¨‹ç¼–æ’ï¼Œä¼˜åŒ–å·¥ä½œæµå¼•æ“æ€§èƒ½" class="headerlink" title="ä¼˜åŒ–å¤šèŠ‚ç‚¹æµç¨‹ç¼–æ’ï¼Œä¼˜åŒ–å·¥ä½œæµå¼•æ“æ€§èƒ½"></a>ä¼˜åŒ–å¤šèŠ‚ç‚¹æµç¨‹ç¼–æ’ï¼Œä¼˜åŒ–å·¥ä½œæµå¼•æ“æ€§èƒ½</h2><p><strong>å¤šèŠ‚ç‚¹æµç¨‹ç¼–æ’ä¼˜åŒ–ï¼š</strong></p>
<ol>
<li><strong>å¹¶è¡Œæ‰§è¡Œ</strong>ï¼šè¯†åˆ«å¯ä»¥å¹¶è¡Œå¤„ç†çš„ä»»åŠ¡ï¼Œé€šè¿‡åˆç†çš„ä»»åŠ¡è°ƒåº¦æœºåˆ¶ï¼ˆå¦‚DAGè°ƒåº¦ï¼‰æœ€å¤§åŒ–å¹¶å‘åº¦ï¼Œå‡å°‘æ•´ä½“æ‰§è¡Œæ—¶é—´ã€‚</li>
<li><strong>å‡å°‘èŠ‚ç‚¹é—´é€šä¿¡å¼€é”€</strong>ï¼šå°½é‡å‡å°‘è·¨èŠ‚ç‚¹çš„æ•°æ®ä¼ è¾“é‡ï¼Œä½¿ç”¨é«˜æ•ˆçš„åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–æ ¼å¼ï¼ˆå¦‚Protocol Buffersæˆ–Avroï¼‰ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ã€‚</li>
<li><strong>æ™ºèƒ½è·¯ç”±ä¸è´Ÿè½½å‡è¡¡</strong>ï¼šæ ¹æ®å„èŠ‚ç‚¹å½“å‰çš„è´Ÿè½½æƒ…å†µåŠ¨æ€åˆ†é…ä»»åŠ¡ï¼Œé¿å…æŸäº›èŠ‚ç‚¹è¿‡è½½è€Œå…¶ä»–èŠ‚ç‚¹é—²ç½®ã€‚</li>
<li><strong>ç¼“å­˜ä¸­é—´ç»“æœ</strong>ï¼šå¯¹äºé‡å¤è®¡ç®—çš„éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨é€‚å½“çš„ä½ç½®å¢åŠ ç¼“å­˜æœºåˆ¶ï¼Œå­˜å‚¨ä¸­é—´ç»“æœä»¥ä¾›åç»­æ­¥éª¤ç›´æ¥ä½¿ç”¨ã€‚</li>
<li><strong>é‡è¯•æœºåˆ¶</strong>ï¼šä¸ºå¯èƒ½å¤±è´¥çš„æ“ä½œè®¾ç½®åˆç†çš„é‡è¯•ç­–ç•¥ï¼ŒåŒ…æ‹¬æŒ‡æ•°é€€é¿ç®—æ³•ç­‰ï¼Œä»¥æé«˜ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›ã€‚</li>
</ol>
<p><strong>å·¥ä½œæµå¼•æ“æ€§èƒ½ä¼˜åŒ–ï¼š</strong></p>
<ol>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šå°½å¯èƒ½é‡‡ç”¨å¼‚æ­¥è°ƒç”¨ä»£æ›¿åŒæ­¥ç­‰å¾…ï¼Œé™ä½è¯·æ±‚é—´çš„è€¦åˆåº¦ï¼ŒåŠ å¿«å“åº”é€Ÿåº¦ã€‚</li>
<li><strong>æ•°æ®åº“ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢ã€‚å¯¹äºé¢‘ç¹è¯»å†™çš„è¡¨ï¼Œè€ƒè™‘åˆ†åº“åˆ†è¡¨ç­–ç•¥ã€‚</li>
<li><strong>æ‰¹å¤„ç†</strong>ï¼šå¯¹äºå¤§æ‰¹é‡çš„æ•°æ®æ“ä½œï¼Œåº”é‡‡ç”¨æ‰¹é‡æäº¤è€Œéé€æ¡å¤„ç†çš„æ–¹å¼ï¼Œå‡å°‘IOæ¬¡æ•°ã€‚</li>
<li><strong>èµ„æºæ± ç®¡ç†</strong>ï¼šæœ‰æ•ˆç®¡ç†è¿æ¥æ± ã€çº¿ç¨‹æ± ç­‰èµ„æºï¼Œé˜²æ­¢å› èµ„æºè€—å°½å¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨ã€‚</li>
</ol>
<h2 id="åŒå†™ä¸€è‡´æ€§é—®é¢˜"><a href="#åŒå†™ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="åŒå†™ä¸€è‡´æ€§é—®é¢˜"></a>åŒå†™ä¸€è‡´æ€§é—®é¢˜</h2><p>åŒå†™ä¸€è‡´æ€§é—®é¢˜ä¸»è¦å‡ºç°åœ¨ä½¿ç”¨ç¼“å­˜ä¸æ•°æ®åº“å…±åŒå­˜å‚¨æ•°æ®çš„åœºæ™¯ä¸­ï¼Œä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œåœ¨å¹¶å‘æ›´æ–°æ—¶éš¾ä»¥ä¿è¯æ“ä½œçš„åŸå­æ€§å’Œé¡ºåºæ€§ã€‚å½“åº”ç”¨åŒæ—¶å†™å…¥ç¼“å­˜å’Œæ•°æ®åº“æ—¶ï¼Œç”±äºç½‘ç»œå»¶è¿Ÿã€ç³»ç»Ÿæ•…éšœæˆ–å¹¶å‘è¯»å†™ï¼Œå¯èƒ½å¯¼è‡´ä¸¤è€…æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœ<strong>å…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜</strong>ï¼Œåœ¨è¿™æœŸé—´è‹¥æœ‰å…¶ä»–è¯·æ±‚è¯»å–äº†æ—§çš„ç¼“å­˜æ•°æ®ï¼Œåˆ™ä¼šå¯¼è‡´çŸ­æš‚çš„æ•°æ®ä¸ä¸€è‡´ã€‚ç¼“å­˜æ›´æ–°å¤±è´¥ä¹Ÿä¼šå¯¼è‡´ä¸ä¸€è‡´ã€‚åŒæ ·ï¼Œè‹¥<strong>å…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“</strong>ï¼Œè€Œæ­¤æ—¶æ•°æ®åº“æ›´æ–°å¤±è´¥æˆ–å‡ºç°ç½‘ç»œé—®é¢˜ï¼Œä¹Ÿä¼šé€ æˆç¼“å­˜ä¸æ•°æ®åº“æ•°æ®çš„å·®å¼‚ã€‚æ­¤å¤–ï¼Œå¹¶å‘æ“ä½œåŠ å‰§äº†è¿™ä¸€é—®é¢˜ï¼Œå¤šä¸ªå®¢æˆ·ç«¯å¯èƒ½åŒæ—¶å¯¹åŒä¸€æ•°æ®è¿›è¡Œè¯»å†™æ“ä½œï¼Œå¦‚æœæ²¡æœ‰é€‚å½“çš„åŒæ­¥æœºåˆ¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´éƒ¨åˆ†å®¢æˆ·ç«¯è¯»å–åˆ°æœªæ›´æ–°æˆ–é”™è¯¯çš„æ•°æ®ç‰ˆæœ¬ã€‚<strong>å…ˆåˆ ç¼“å­˜å†æ›´æ–°æ•°æ®åº“</strong>å­˜åœ¨å¹¶å‘çª—å£æœŸï¼Œå¯èƒ½ä½¿æ—§æ•°æ®é‡æ–°åŠ è½½è¿›ç¼“å­˜ã€‚</p>
<p><strong>å¦‚ä½•è§£å†³</strong>ï¼š</p>
<p><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</strong>ï¼Œç»“åˆå»¶è¿ŸåŒåˆ æˆ–æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥è¡¥å¿ï¼Œç¡®ä¿æœ€ç»ˆä¸€è‡´ã€‚</p>
<ol>
<li><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜</strong>ï¼šæœ€å¸¸ç”¨ã€‚å½“éœ€è¦æ›´æ–°æ•°æ®æ—¶ï¼Œé¦–å…ˆæ›´æ–°æ•°æ®åº“ï¼Œç„¶åç«‹å³åˆ é™¤å¯¹åº”çš„ç¼“å­˜é¡¹ã€‚ä¸‹æ¬¡æŸ¥è¯¢æ—¶ä¼šä»æ•°æ®åº“åŠ è½½æœ€æ–°æ•°æ®åˆ°ç¼“å­˜ä¸­ã€‚åœ¨æ›´æ–°æ•°æ®åº“ä¹‹åå’Œåˆ é™¤ç¼“å­˜ä¹‹å‰ï¼Œæœ‰çŸ­æš‚çš„ä¸ä¸€è‡´çª—å£ã€‚ä½†æ˜¯é™ä½äº†å› å¹¶å‘å¼•èµ·çš„å¤æ‚æ€§å’Œæ½œåœ¨çš„æ•°æ®ä¸ä¸€è‡´é£é™©ã€‚</li>
<li><strong>å»¶è¿ŸåŒåˆ ç­–ç•¥</strong>ï¼šåœ¨æ›´æ–°æ•°æ®åº“ä¹‹åï¼Œä¸ä»…ç«‹å³åˆ é™¤ç¼“å­˜ï¼Œè¿˜ä¼šè®¾ç½®ä¸€ä¸ªå°å»¶è¿Ÿï¼ˆå¦‚50msï¼‰ï¼Œå†æ¬¡åˆ é™¤åŒä¸€ç¼“å­˜é¡¹ã€‚å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ›´æ–°æ•°æ®åº“å¹¶åˆ é™¤ç¼“å­˜æ—¶ï¼Œå¦ä¸€ä¸ªå¹¶å‘çº¿ç¨‹å¯èƒ½å·²ç»ä»æ—§ç¼“å­˜ä¸­è¯»å–äº†æ•°æ®ï¼Œå¹¶åœ¨æ›´æ–°æ“ä½œå®Œæˆä¹‹å‰å°†å…¶é‡æ–°å†™å…¥ç¼“å­˜ï¼Œå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®æ¯”æ•°æ®åº“è¿˜æ—§ï¼Œè¿™æ˜¯ç¼“å­˜é‡å»ºè¡Œä¸ºã€‚</li>
<li><strong>æ¶ˆæ¯é˜Ÿåˆ—åŒæ­¥</strong>ï¼šåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—ç¡®ä¿æ“ä½œé¡ºåºæ‰§è¡Œã€‚å°†æ‰€æœ‰å¯¹æ•°æ®åº“çš„ä¿®æ”¹é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå¼‚æ­¥å¤„ç†ï¼Œç¡®ä¿æ¯ä¸ªæ“ä½œæŒ‰åºåˆ°è¾¾å¹¶æ›´æ–°ç¼“å­˜å’Œæ•°æ®åº“ï¼Œé€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚</li>
<li><strong>ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æˆ–Sagaæ¨¡å¼</strong>ï¼šå¯¹äºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯ä»¥é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æˆ–è€…Sagaæ¨¡å¼æ¥ç®¡ç†è·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä½†è¿™é€šå¸¸å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</li>
</ol>
<h2 id="CAPç†è®º"><a href="#CAPç†è®º" class="headerlink" title="CAPç†è®º"></a>CAPç†è®º</h2><p>CAPç†è®ºå¸®åŠ©å¼€å‘è€…ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„å–èˆã€‚CAPç†è®ºæŒ‡å‡ºï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ<strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ã€<strong>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰</strong> å’Œ <strong>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰</strong> ä¸‰è€…ä¸å¯å…¼å¾—ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚</p>
<ul>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯ç›¸åŒçš„ã€‚</li>
<li><strong>å¯ç”¨æ€§</strong>ï¼šæ¯ä¸ªè¯·æ±‚éƒ½èƒ½åœ¨åˆç†æ—¶é—´å†…æ”¶åˆ°æˆåŠŸæˆ–å¤±è´¥çš„å“åº”ï¼Œä¸ä¿è¯æ•°æ®æœ€æ–°ã€‚</li>
<li><strong>åˆ†åŒºå®¹é”™æ€§</strong>ï¼šç³»ç»Ÿåœ¨éƒ¨åˆ†èŠ‚ç‚¹é—´é€šä¿¡ä¸­æ–­ï¼ˆç½‘ç»œåˆ†åŒºï¼‰æ—¶ä»èƒ½ç»§ç»­è¿è¡Œã€‚</li>
</ul>
<p>ç”±äºç½‘ç»œæ•…éšœéš¾ä»¥é¿å…ï¼Œåˆ†åŒºå®¹é”™æ€§é€šå¸¸æ˜¯å¿…é¡»ä¿è¯çš„ã€‚å› æ­¤ï¼Œç³»ç»Ÿè®¾è®¡é€šå¸¸åœ¨ <strong>CPï¼ˆå¦‚ZooKeeperï¼‰</strong> å’Œ <strong>APï¼ˆç¼“å­˜ç³»ç»Ÿï¼Œä¸€èˆ¬ä¼šè¿½æ±‚APå¯ç”¨ï¼Œå¹¶é€šè¿‡ä¸€äº›æ‰‹æ®µå°½å¯èƒ½ä¿è¯å¼±ä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼‰</strong> ä¹‹é—´æƒè¡¡ï¼šCPç³»ç»Ÿåœ¨åˆ†åŒºå‘ç”Ÿæ—¶ä¿è¯æ•°æ®ä¸€è‡´ä½†å¯èƒ½æ‹’ç»æœåŠ¡ï¼›APç³»ç»Ÿä¿æŒå¯ç”¨ï¼Œä½†å…è®¸æ•°æ®æš‚æ—¶ä¸ä¸€è‡´ã€‚</p>
<h2 id="RocketMQäº‹åŠ¡æ¶ˆæ¯"><a href="#RocketMQäº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="RocketMQäº‹åŠ¡æ¶ˆæ¯"></a>RocketMQäº‹åŠ¡æ¶ˆæ¯</h2><p>å¯ä»¥åˆ©ç”¨äº‹åŠ¡æ¶ˆæ¯è½»æ¾åœ°å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‡‡ç”¨2PCçš„æ€æƒ³æ¥å®ç°æäº¤äº‹åŠ¡æ¶ˆæ¯ï¼ŒåŒæ—¶å¢åŠ ä¸€ä¸ªè¡¥å¿é€»è¾‘æ¥å¤„ç†äºŒé˜¶æ®µè¶…æ—¶æˆ–è€…å¤±è´¥çš„æ¶ˆæ¯ã€‚</p>
<p>RocketMQå®ç°äº‹åŠ¡æ¶ˆæ¯ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ­£å¸¸äº‹åŠ¡çš„å‘é€åŠæäº¤ã€äº‹åŠ¡ä¿¡æ¯çš„è¡¥å¿æµç¨‹ æ•´ä½“æµç¨‹ä¸ºï¼š</p>
<ul>
<li>æ­£å¸¸äº‹åŠ¡å‘é€ä¸æäº¤é˜¶æ®µï¼š1ã€ç”Ÿäº§è€…å‘é€ä¸€ä¸ªåŠæ¶ˆæ¯ç»™MQServerï¼ˆåŠæ¶ˆæ¯æ˜¯æŒ‡æ¶ˆè´¹è€…æš‚æ—¶ä¸èƒ½æ¶ˆè´¹çš„æ¶ˆæ¯ï¼‰ 2ã€æœåŠ¡ç«¯å“åº”æ¶ˆæ¯å†™å…¥ç»“æœï¼ŒåŠæ¶ˆæ¯å‘é€æˆåŠŸ 3ã€ç”Ÿäº§è€…å¼€å§‹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ 4ã€æ‰§è¡Œå®Œæœ¬åœ°äº‹åŠ¡åå†å‘Šè¯‰MQServeræœ¬åœ°äº‹åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œç¡®è®¤æ¶ˆæ¯ç©¶ç«Ÿæ˜¯Commitè¿˜æ˜¯Rollback</li>
<li>äº‹åŠ¡ä¿¡æ¯çš„è¡¥å¿æµç¨‹ 1ã€å¦‚æœMQServeré•¿æ—¶é—´æ²¡æ”¶åˆ°æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œä¼šå‘ç”Ÿäº§è€…å‘èµ·ä¸€ä¸ªç¡®è®¤å›æŸ¥çš„æ“ä½œè¯·æ±‚ 2ã€ç”Ÿäº§è€…æ”¶åˆ°ç¡®è®¤å›æŸ¥è¯·æ±‚åï¼Œæ£€æŸ¥æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ 3ã€MQServeræ ¹æ®æ£€æŸ¥åçš„ç»“æœæ‰§è¡ŒCommitæˆ–è€…Rollbackæ“ä½œã€‚è¡¥å¿é˜¶æ®µä¸»è¦æ˜¯ç”¨äºè§£å†³ç”Ÿäº§è€…åœ¨å‘é€Commitæˆ–è€…Rollbackæ“ä½œæ—¶å‘ç”Ÿè¶…æ—¶æˆ–å¤±è´¥çš„æƒ…å†µã€‚</li>
</ul>
<p>ä¾‹å¦‚åœºæ™¯ï¼šç”¨æˆ·è¯·æ±‚è®¢å•å¾®æœåŠ¡ <code>order-service</code> æ¥å£åˆ é™¤è®¢å•ï¼ˆé€€è´§ï¼‰ï¼Œåˆ é™¤è®¢å•åéœ€è¦å‘é€æ¶ˆæ¯ç»™ç”¨æˆ·æœåŠ¡<code>account-service</code>ï¼Œç”¨æˆ·å¾®æœåŠ¡æ”¶åˆ°æ¶ˆæ¯åä¼šç»™ç”¨æˆ·è´¦æˆ·å¢åŠ ä½™é¢ã€‚è¿™ä¸ªéœ€æ±‚è·Ÿé’±ç›¸å…³ï¼Œè‚¯å®šè¦ä¿è¯æ¶ˆæ¯çš„äº‹åŠ¡æ€§ã€‚</p>
<p>äº‹åŠ¡æ¶ˆæ¯ç›¸å¯¹æ™®é€šæ¶ˆæ¯æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ä¸€é˜¶æ®µå‘é€çš„æ¶ˆæ¯å¯¹ç”¨æˆ·æ˜¯ä¸å¯è§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¶ˆè´¹è€…ä¸èƒ½ç›´æ¥æ¶ˆè´¹ã€‚å®ç°æ–¹æ³•æ˜¯æ”¹å˜ä¸»é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜ä¹‹åœºæ™¯é¢˜</title>
    <url>/2025/08/10/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E8%83%8C%E8%BF%87%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B%E5%9C%BA%E6%99%AF%E9%A2%98/</url>
    <content><![CDATA[<h2 id="è®¾è®¡ä¸€ä¸ªå¤šäººåœ¨çº¿ååŒæ–‡æœ¬ç¼–è¾‘ç³»ç»Ÿ"><a href="#è®¾è®¡ä¸€ä¸ªå¤šäººåœ¨çº¿ååŒæ–‡æœ¬ç¼–è¾‘ç³»ç»Ÿ" class="headerlink" title="è®¾è®¡ä¸€ä¸ªå¤šäººåœ¨çº¿ååŒæ–‡æœ¬ç¼–è¾‘ç³»ç»Ÿ"></a>è®¾è®¡ä¸€ä¸ªå¤šäººåœ¨çº¿ååŒæ–‡æœ¬ç¼–è¾‘ç³»ç»Ÿ</h2>]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜ä¹‹ä¸­é—´ä»¶</title>
    <url>/2025/07/24/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E8%83%8C%E8%BF%87%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h2><ul>
<li><p>å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼šæ¶æ„é£æ ¼ï¼Œå¤§å‹æœåŠ¡-å¤šä¸ªå°æœåŠ¡ï¼Œè½»é‡çº§é€šä¿¡æœºåˆ¶åä½œã€‚æ¨¡å—å„¿åŒ–ï¼Œç‹¬ç«‹éƒ¨ç½²æ‰©å±•ç»´æŠ¤ã€å¯é ã€æŠ€æœ¯å¼‚æ„ã€‚</p>
</li>
<li><p>å¾®æœåŠ¡ç»„ä»¶ï¼šæœåŠ¡ã€é€šä¿¡æœºåˆ¶ã€æœåŠ¡å‘ç°ä¸æ³¨å†Œã€è´Ÿè½½å‡è¡¡ã€APIç½‘å…³</p>
</li>
<li><p>å¾®æœåŠ¡é—´å¦‚ä½•é€šä¿¡ï¼šhttpã€æ¶ˆæ¯é˜Ÿåˆ—ã€rpc</p>
</li>
</ul>
<h2 id="rpcã€HSF"><a href="#rpcã€HSF" class="headerlink" title="rpcã€HSF"></a>rpcã€HSF</h2><ul>
<li><p>rpcï¼šè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œé€šä¿¡åè®®ã€åºåˆ—åŒ–åè®®ï¼Œhttpã€è‡ªå®šä¹‰æŠ¥æ–‡tcpï¼Œæ–‡æœ¬xml json äºŒè¿›åˆ¶protobuf hessianã€‚</p>
</li>
<li><p>è‡ªå®šä¹‰æŠ¥æ–‡ï¼Ÿhttpæ¶ˆæ¯å¤´å¤æ‚ï¼ŒçŸ­é“¾æ¥</p>
</li>
<li><p>HSFï¼šé«˜é€ŸæœåŠ¡æ¡†æ¶ï¼Œåˆ†å¸ƒå¼rpcæœåŠ¡æ¡†æ¶ã€‚ç»Ÿä¸€æœåŠ¡çš„å‘å¸ƒ&#x2F;è®¢é˜…&#x2F;è°ƒç”¨æ–¹å¼ï¼Œè§£å†³æœåŠ¡é—´çš„é«˜æ•ˆè°ƒç”¨ã€‚</p>
</li>
<li><p>HSFæ¶æ„ï¼šæœåŠ¡æä¾›è€…ã€æœåŠ¡æ¶ˆè´¹è€…ã€åœ°å€æ³¨å†Œä¸­å¿ƒconfigServerï¼ˆæ³¨å†ŒæœåŠ¡ã€è®¢é˜…æœåŠ¡ã€å‘æ¶ˆè´¹è€…æ¨é€æœåŠ¡æä¾›è€…åœ°å€ï¼‰ã€æŒä¹…åŒ–é…ç½®ä¸­å¿ƒdiamondï¼ˆconfigServerçš„ç±»å‹å’Œåœ°å€ã€è®¢é˜…è·¯ç”±è§„åˆ™ç­‰ï¼‰ã€å…ƒæ•°æ®å­˜å‚¨ä¸­å¿ƒredisï¼ˆæœåŠ¡ä¸ŠæŠ¥å…ƒæ•°æ®ï¼šæ–¹æ³•åˆ—è¡¨å‚æ•°ç»“æ„ï¼‰ã€æ§åˆ¶å°ï¼ˆæœåŠ¡æŸ¥è¯¢æ²»ç†æµ‹è¯•è¿ç»´ï¼‰</p>
</li>
<li><p>HSFæœåŠ¡å‘å¸ƒæºç ï¼šæ ¸å¿ƒæ˜¯HSFSpringProviderBeanï¼Œé€šè¿‡@Importæ³¨è§£å¼•å…¥é…ç½®ç±»ï¼Œé…ç½®ç±»å®ç°ImportBeanDefinationRegistraræ¥åˆ›å»ºå¤æ‚çš„beanå¹¶æ³¨å†Œåˆ°springå®¹å™¨ä¸­ã€‚HSFSpringProviderBeançš„afterPropertiesSet()æ–¹æ³•ä¸­è¿›è¡ŒæœåŠ¡åˆå§‹åŒ–ï¼ˆåˆå§‹åŒ–è°ƒç”¨é“¾ï¼Œä¸¤æ¡é“¾ï¼Œä¸€æ˜¯protocolFilterChain: Protocolï¼Œå®ƒä¸“æ³¨äºæµç¨‹ç¼–æ’ï¼Œåœ¨publish()æµç¨‹é¡ºåºæ‰§è¡Œï¼›ä¸€æ˜¯invocationHandleré“¾ï¼Œç”¨äºåç»­å¤„ç†hsfè¯·æ±‚è°ƒç”¨ï¼‰ã€æœåŠ¡å‘å¸ƒï¼ˆä½¿ç”¨çº¿ç¨‹æ± ï¼ŒFutureé˜»å¡ç­‰å¾…æœåŠ¡å‘å¸ƒæˆåŠŸã€‚ä½¿ç”¨è°ƒç”¨é“¾è¿›è¡Œï¼Œä¸ŠæŠ¥å…ƒæ•°æ®åˆ°Redisï¼Œå¯åŠ¨å¹¶ç›‘å¬tcp&#x2F;httpç«¯å£ã€åˆ†é…æœåŠ¡çº¿ç¨‹æ± ã€æœåŠ¡æ³¨å†Œã€‚ä½¿ç”¨Protocolè¿›è¡Œæµç¨‹ç¼–æ’ï¼Œåˆå§‹åŒ–æ—¶ç¼–æ’æµç¨‹é¡ºåºã€‚æ³¨å†Œä¿¡æ¯ï¼šip&#x2F;port&#x2F;åºåˆ—åŒ–æ–¹å¼&#x2F;è·¯ç”±è§„åˆ™&#x2F;åº”ç”¨åç§°&#x2F;è¶…æ—¶æ—¶é—´ã€‚HSFProtocolä¸­å¼€å¯nettyæœåŠ¡ï¼Œè®¾ç½®tcpç›¸å…³åè®®ï¼‰ã€‚</p>
</li>
<li><p>HSFæ¶ˆè´¹æºç ï¼š1.æœåŠ¡åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–è°ƒç”¨é“¾ï¼Œåˆå§‹åŒ–HSFä»£ç†å¯¹è±¡jdkã€‚2.æœåŠ¡è°ƒç”¨ï¼ŒåŒæ ·ä½¿ç”¨è°ƒç”¨é“¾ï¼Œåœ¨IOä¼ è¾“å±‚ä½¿ç”¨nettyé•¿è¿æ¥ï¼Œä½¿ç”¨hessianåºåˆ—åŒ–ï¼Œåœ¨æœåŠ¡æä¾›æ–¹ä½¿ç”¨åå°„è°ƒç”¨ï¼ˆè¿è¡Œæ—¶åŠ¨æ€è·å–ç±»çš„ä¿¡æ¯ï¼‰ã€‚</p>
</li>
<li><p>HSFç›¸æ¯”SpringCloudä¼˜åŠ¿ï¼š1.HSFä½¿ç”¨é«˜æ€§èƒ½çš„å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„NIOæ¡†æ¶Nettyã€‚2.åºåˆ—åŒ–åè®®hessionç›¸æ¯”jsonã€‚3.HSFåªéœ€å°†äºŒæ–¹åŒ…æš´éœ²ç»™ç”¨æˆ· 4.HSFä½¿ç”¨ä»£ç†æœºåˆ¶ï¼Œå°†åè®®å°è£…ã€é€‰å€ã€è¿œç¨‹è°ƒç”¨å°è£…ï¼Œç”¨æˆ·åªéœ€Springé…ç½®ã€‚</p>
</li>
<li><p>HSFæºç å¿ƒå¾—ï¼šä»æœåŠ¡ç«¯åˆå§‹åŒ–ã€æœåŠ¡æ³¨å†Œã€å®¢æˆ·ç«¯åˆå§‹åŒ–ã€è°ƒç”¨æœåŠ¡ï¼Œä½¿ç”¨Nettyã€Hessionã€ProtocolFilterã€InvocationHandleré“¾å¼è°ƒç”¨è¿‡ç¨‹è¿›è¡Œæµç¨‹ç¼–æ’ã€çµæ´»é…ç½®çš„æ³¨å†Œä¸­å¿ƒã€äº‹ä»¶ç›‘å¬æœºåˆ¶ã€é€šè¿‡éšæœºæ•°çš„æ–¹å¼å®ç°éšæœºè´Ÿè½½å‡è¡¡ã€‚é«˜å†…èšä½è€¦åˆçš„è®¾è®¡æ–¹æ³•ã€‚</p>
</li>
<li><p>ä¸€æ¬¡å®Œæ•´çš„HSFè°ƒç”¨ï¼šæœåŠ¡å¯»å€ã€ç½‘ç»œè¿æ¥ã€åºåˆ—åŒ–ä¼ è¾“ã€åå°„è°ƒç”¨</p>
</li>
<li><p>ä¸€ä¸ªrpcæ¡†æ¶æœ€é‡è¦çš„æ˜¯ä»€ä¹ˆéƒ¨åˆ†ï¼šé€šä¿¡æœºåˆ¶ï¼ˆä¼ è¾“åè®®è‡ªå®šä¹‰tcpæŠ¥æ–‡è¿˜æ˜¯httpã€è´Ÿè½½å‡è¡¡ã€å®¹é”™æœºåˆ¶ï¼‰ã€åºåˆ—åŒ–ååºåˆ—åŒ–åè®®ï¼ˆç½‘ç»œåªèƒ½ä¼ è¾“å­—èŠ‚æµï¼Œéœ€è¦å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼‰ï¼Œè¿˜éœ€è¦æœåŠ¡å‘ç°ä¸æ³¨å†Œæœºåˆ¶ã€æœåŠ¡æ²»ç†æœºåˆ¶ã€‚</p>
</li>
<li><p>shellè„šæœ¬æŸ¥è¯¢å¯¹åº”é”™è¯¯å‡ºç°æ¬¡æ•°ï¼šgrep â€œ2024-01-01*errorâ€ error.log ï½œ wc -l</p>
</li>
</ul>
<h2 id="dubbo"><a href="#dubbo" class="headerlink" title="dubbo"></a>dubbo</h2><ul>
<li><p>dubboï¼šé«˜æ€§èƒ½RPCæ¡†æ¶ï¼Œé˜¿é‡Œå¼€æºï¼Œnettyç½‘ç»œæ¡†æ¶ï¼Œå¼‚æ­¥IOï¼Œçº¿ç¨‹æ± </p>
</li>
<li><p>dubboæ¡†æ¶ï¼šæœåŠ¡æä¾›è€…å¯åŠ¨æ—¶å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨æ—¶è®¢é˜…æœåŠ¡ï¼Œæ³¨å†Œä¸­å¿ƒRegistryå‘æ¶ˆè´¹è€…æ¨é€æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–é€šè¿‡é•¿é“¾æ¥æ¨é€å˜æ›´ï¼Œæ¶ˆè´¹è€…ç”¨è´Ÿè½½å‡è¡¡é€‰æ‹©åœ°å€ï¼Œç›‘æ§ä¸­å¿ƒMonitorï¼Œæ¶ˆè´¹è€…å’Œæä¾›è€…å®šæ—¶å‘é€ç»Ÿè®¡æ•°æ®ï¼ˆè°ƒç”¨æ¬¡æ•°è°ƒç”¨æ—¶é—´ï¼‰</p>
</li>
<li><p>dubboè´Ÿè½½å‡è¡¡ï¼šéšæœºã€è½®è¯¢ã€æœ€å°‘æ´»è·ƒè°ƒç”¨ã€ä¸€è‡´æ€§å“ˆå¸Œã€æƒé‡</p>
</li>
<li><p>dubboä¸­çš„Filterï¼šè´£ä»»é“¾æ¨¡å¼çš„å®ç°ï¼Œæ ¹æ®é…ç½®ç”ŸæˆFilteré“¾ï¼Œå®ç°å¯¹Dobboä»£ç çš„æ‹¦æˆªå’Œæ‰©å±•ï¼Œç±»ä¼¼äºAOPï¼Œä¼˜é›…çš„ä»£ç å¢å¼ºæ‰‹æ®µï¼Œé€»è¾‘åˆ†å±‚ï¼Œä»£ç è§£è€¦ã€‚åº”ç”¨ï¼šæ—¥å¿—ã€é‰´æƒã€é™æµã€è´Ÿè½½å‡è¡¡ã€‚</p>
</li>
<li><p>dubboä¸­çš„spiæ‰©å±•ï¼šæœåŠ¡æ‰©å±•æœºåˆ¶ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½å®ç°ç±»ã€‚æä¾›ä¸°å¯Œçš„SPIæ‰©å±•ç‚¹ï¼Œç±»ä¼¼java SPIï¼Œå¯ä»¥è‡ªå®šä¹‰æ‰©å±•å®ç°ï¼Œé…ç½®æ–¹å¼æ›¿æ¢æ¡†æ¶ä¸­çš„ç»„ä»¶ã€‚ä½¿ç”¨äº†urlæ€»çº¿è®¾è®¡ï¼Œurlå‚æ•°è¯†åˆ«ç”¨å“ªä¸ªæ¥å£å®ç°ã€‚ä½¿ç”¨@SPIæ³¨è§£æŒ‡å®šæ‰©å±•ç‚¹åã€‚é¢å‘æ¥å£ç¼–ç¨‹ã€‚</p>
</li>
<li><p>dubboçš„SPIå®ç°ï¼š1.ExtensionLoaderå•ä¾‹å·¥å‚ç±»ï¼Œè´Ÿè´£åŠ è½½å’Œç®¡ç†æ‰©å±•ç‚¹å®ç°ç±»ã€‚2.ä¸ä»…é€šè¿‡æ¥å£åè·å–ï¼Œè¿˜æœ‰ä¸€ä¸ªkeyã€‚3.Adaptiveè‡ªé€‚åº”æ‰©å±•ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ä¼ å…¥å‚æ•°åŠ¨æ€é€‰æ‹©åˆé€‚çš„æ‰©å±•å®ç°ã€‚</p>
</li>
<li><p>dubboçš„SPIåº”ç”¨ï¼šProtocolåè®®ã€Clusteré›†ç¾¤å®¹é”™ç­–ç•¥ã€LoadBalanceè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚éƒ½æ˜¯æ ¹æ®é…ç½®åŠ¨æ€åˆ‡æ¢ã€‚</p>
</li>
<li><p>dubboä¸­çš„urlæ€»çº¿è®¾è®¡ï¼šä¸ºäº†å„å±‚è§£è€¦ï¼Œäº¤æ¢å‚æ•°ä¸ç”¨Modelï¼Œç”¨urlå‚æ•°ï¼Œæ–¹ä¾¿æ‰©å±•ã€‚åº•å±‚nettyã€‚</p>
</li>
<li><p>dubboå¯åŠ¨è¿‡ç¨‹ï¼šæ³¨å†Œä¸­å¿ƒï¼ˆåŠ è½½é…ç½®ã€å¯åŠ¨å®šæ—¶ã€NettyServerå¯åŠ¨nettyï¼‰æä¾›è€…ï¼ˆDubboProtocolæä¾›è¿œç¨‹æœåŠ¡ï¼ŒRemoteRegistryå»ºç«‹ä¸æ³¨å†Œä¸­å¿ƒè¿æ¥ï¼‰æ¶ˆè´¹è€…ï¼ˆRemoteRegistryï¼ŒRegistryDirectoryè®¢é˜…æœåŠ¡ï¼Œåˆ›å»ºä»£ç†ï¼Œå®é™…è°ƒç”¨InvokerInvocationHandlerï¼‰</p>
</li>
<li><p>dubboæœåŠ¡æ²»ç†ï¼šè´Ÿè½½å‡è¡¡ï¼ˆè¯·æ±‚å‡åŒ€åˆ†é…ï¼‰ã€é›†ç¾¤å®¹é”™ï¼ˆè°ƒç”¨å¤±è´¥æ—¶åˆ‡æ¢æœºå™¨é‡è¯•ï¼‰ã€æœåŠ¡é™çº§ï¼ˆè´Ÿè½½è¿‡é«˜æ—¶å±è”½éƒ¨åˆ†æœåŠ¡ä¿éšœæ ¸å¿ƒï¼‰ã€è·¯ç”±ç­–ç•¥ï¼ˆé€‰æ‹©æœ€ä¼˜æœåŠ¡æä¾›è€…ï¼‰ã€ç›‘æ§ç®¡ç†ï¼ˆç›‘æ§æŠ¥è­¦ï¼‰</p>
</li>
<li><p>dubboä¸­çš„è®¾è®¡æ¨¡å¼ï¼šExtensionLoader.getExtensionLoader(Protocol.class).getAdaptiveExtension();æ˜¯å·¥å‚æ¨¡å¼ï¼ŒAdaptiveè¿è¡Œæ—¶åŠ¨æ€å†³å®šè°ƒç”¨å“ªä¸ªå®ç°ï¼Œä»£ç†æ¨¡å¼ã€‚ä½¿ç”¨è°ƒç”¨é“¾Filterè´£ä»»é“¾æ¨¡å¼ã€‚ClassLoaderFilteråœ¨ä¸»åŠŸèƒ½ä¸Šæ·»åŠ åŠŸèƒ½è£…é¥°å™¨æ¨¡å¼ã€‚æ³¨å†Œä¸­å¿ƒå‘æ¶ˆè´¹è€…å‘é€notifyæ¶ˆæ¯è¡¨ç¤ºæœåŠ¡æ›´æ–°ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ã€‚</p>
</li>
<li><p>dubboæ€»ç»“ï¼šDubboè€ƒè™‘äº†æ¡†æ¶å¯æ‰©å±•æ€§ï¼Œurlæ€»çº¿è®¾è®¡ï¼Œå±‚æ¬¡åˆ’åˆ†ã€‚ä¸€ä¸ªè°ƒç”¨é“¾è·¯ä¸­å­˜åœ¨å¾ˆå¤šFilteræ‹¦æˆªï¼Œç›¸å¯¹HSFæ€§èƒ½å·®ï¼Œä½†æ˜¯å¯ä»¥å°†è‡ªå·±é€»è¾‘æ•´åˆåˆ°è°ƒç”¨é“¾ä¸­ã€‚</p>
</li>
<li><p>dubboé™æµï¼šæœåŠ¡æ²»ç†çš„ä¸€ç§ï¼Œç¡®ä¿æœåŠ¡æä¾›è€…ä¸ä¼šå› ä¸ºè¿‡é«˜è¯·æ±‚è´Ÿè½½è€Œå´©æºƒã€‚åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œä»¥æ’å®šé€Ÿç‡å‘æ¡¶ä¸­æ·»åŠ ä»¤ç‰Œï¼Œæ¯ä¸ªè¯·æ±‚éœ€è¦ä»æ¡¶ä¸­æ¶ˆè€—ä»¤ç‰Œï¼ŒGuavaä¸­RateLimiterå®ç°ä»¤ç‰Œæ¡¶ã€‚åŸºäºä¿¡å·é‡Semaphoreï¼Œæ§åˆ¶åŒæ—¶æ‰§è¡ŒæœåŠ¡çš„çº¿ç¨‹æ•°ã€‚</p>
</li>
<li><p>dubboåºåˆ—åŒ–æœ‰å“ªäº›ï¼šHessian2åºåˆ—åŒ–ï¼Œç´§å‡‘ä¸”æ•ˆç‡é«˜ï¼ŒäºŒè¿›åˆ¶åºåˆ—åŒ–åè®®ï¼Œè·¨è¯­è¨€ï¼Œdubboä¸­é»˜è®¤çš„ã€‚javaå†…ç½®åºåˆ—åŒ–ã€‚Fastjsonåºåˆ—åŒ–ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå­—ç¬¦ä¸²ï¼Œé€‚åˆwebé€šä¿¡åœºæ™¯ã€‚Protobufåºåˆ—åŒ–ï¼Œä½¿ç”¨.protoæ–‡ä»¶å®šä¹‰æ•°æ®ç»“æ„ï¼Œç”ŸæˆäºŒè¿›åˆ¶æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œè·¨è¯­è¨€ã€‚</p>
</li>
<li><p>dubboæ¯”spring cloudä¼˜åŠ¿ï¼š1.è½»é‡çº§å’Œé«˜æ€§èƒ½ï¼šåŸºäºRPCå’ŒNettyæ¡†æ¶ã€‚å¼ºè°ƒæ€§èƒ½ã€‚2.çµæ´»çš„æœåŠ¡æ²»ç†ï¼šè·¯ç”±è§„åˆ™ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœè½¬ç§»ã€é›†ç¾¤æ”¯æŒã€‚3.ç‹¬ç«‹çš„æ³¨å†Œä¸­å¿ƒï¼šzookeeperç­‰å¯é€‰ï¼Œæä¾›åˆ†ç¦»çš„æœåŠ¡å‘ç°è®¾è®¡ã€‚4.æ”¯æŒè·¨è¯­è¨€çš„æœåŠ¡è°ƒç”¨ï¼ŒgRpcã€Hessiané›†æˆã€‚5.ç®€å•æ˜“ç”¨ï¼ŒäºŒæ–¹åŒ…çš„å½¢å¼</p>
</li>
<li><p>Spring Cloudï¼šåŸºäºSpring Bootï¼Œä¸€æ•´å¥—å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œæä¾›ä¸€ç³»åˆ—ç”¨äºæ„å»ºå¾®æœåŠ¡åº”ç”¨çš„å·¥å…·å’Œæ¡†æ¶ã€‚ç›¸å¯¹æ›´é‡ã€‚åŸºäºRESTåŸåˆ™ï¼ŒåŸºäºHTTP&#x2F;RESTçš„æœåŠ¡é€šä¿¡ã€‚</p>
</li>
</ul>
<h2 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h2><ul>
<li>åˆ†å¸ƒå¼ï¼šå¤šå°è®¡ç®—æœºä½äºä¸åŒåœ°ç†ä½ç½®ï¼Œåˆ†å¸ƒå¼å­˜å‚¨å¤„ç†æ•°æ®å’Œåº”ç”¨ç¨‹åºã€‚ç»„ä»¶ä¹‹é—´é€šè¿‡ç½‘ç»œè¿æ¥ã€‚</li>
<li>åˆ†å¸ƒå¼ä¼˜ç‚¹ï¼šå¯æ‰©å±•æ€§ã€å®¹é”™æ€§ã€åœ°ç†åˆ†æ•£é™ä½å»¶æ—¶ã€‚</li>
<li>åˆ†å¸ƒå¼éš¾ç‚¹ï¼šæ•°æ®ä¸€è‡´æ€§ã€ç³»ç»Ÿç®¡ç†ï¼ˆéƒ¨ç½²ã€ç®¡ç†ã€å®¹ç¾ã€å¤„ç†èŠ‚ç‚¹æ•…éšœï¼‰ã€è·¨èŠ‚ç‚¹äº‹åŠ¡</li>
<li>åˆ†å¸ƒå¼äº‹åŠ¡ï¼šäº‹åŠ¡çš„æ“ä½œåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ï¼Œè·¨åº“äº‹åŠ¡ï¼Œéœ€è¦ç¡®ä¿äº‹åŠ¡ACIDï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰</li>
<li>åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ³•ï¼šä¸¤é˜¶æ®µæäº¤2PCï¼ˆå‡†å¤‡é˜¶æ®µè¯¢é—®æ‰€æœ‰å‚ä¸è€…æ˜¯å¦å¯æäº¤ï¼Œæ ¹æ®ç­”å¤æŒ‡ç¤ºæ‰€æœ‰å‚ä¸è€…æäº¤&#x2F;å›æ»šï¼Œæ‰€æœ‰okæ‰æäº¤ï¼‰ã€ä¸‰é˜¶æ®µæäº¤3PCï¼ˆå¢åŠ é¢„æäº¤ï¼Œå‚ä¸è€…å°†äº‹åŠ¡æ“ä½œè®°å½•å†™å…¥æ—¥å¿—ï¼Œå³ä½¿åè°ƒè€…å¤±å»å“åº”ï¼Œå‚ä¸è€…ä¹Ÿæœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥å®Œæˆæˆ–å›æ»šäº‹åŠ¡ã€‚å‡å°‘å› åè°ƒè€…æ•…éšœå¯¼è‡´çš„é˜»å¡ï¼Œæé«˜å®¹é”™ï¼‰ã€åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ï¼ˆXAäº‹åŠ¡åè®®ï¼‰ã€äº‹åŠ¡è¡¥å¿ã€BASEç†è®ºï¼ˆå®½æ¾ï¼ŒåŸºæœ¬å¯ç”¨ï¼Œè½¯çŠ¶æ€ï¼Œæœ€ç»ˆä¸€è‡´æ€§ï¼‰</li>
<li>åˆ†å¸ƒå¼é”ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­åŒæ­¥è®¿é—®å…±äº«èµ„æºçš„æœºåˆ¶ï¼Œé¿å…å¤šèŠ‚ç‚¹åŒæ—¶ä¿®æ”¹åŒä¸€æ•°æ®çš„å†²çªã€‚1âƒ£ï¸åŸºäºæ•°æ®åº“é”ï¼Œselect for updateå¯¹ç‰¹å®šè¡Œä¸Šè¡Œçº§é”ã€‚2âƒ£ï¸åŸºäºredisï¼ŒSETNXå‘½ä»¤ï¼Œexpireè¿‡æœŸæ—¶é—´ã€‚3âƒ£ï¸åŸºäºzookeeperï¼Œåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªç‹¬ç‰¹çš„èŠ‚ç‚¹è¡¨ç¤ºè·é”ã€‚ä¿éšœåŸå­æ€§å’Œå”¯ä¸€æ€§ã€‚</li>
</ul>
<h2 id="metaq"><a href="#metaq" class="headerlink" title="metaq"></a>metaq</h2><ul>
<li>metaqï¼šåˆ†å¸ƒå¼çš„ï¼ŒåŸºäºé˜Ÿåˆ—æ¨¡å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼ŒåŸºäºå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œæœ‰push&#x2F;pullä¸¤ç§æ¶ˆè´¹æ¨¡å¼ã€‚æ”¯æŒä¸¥æ ¼çš„æ¶ˆæ¯é¡ºåºï¼Œäº¿çº§åˆ«å †ç§¯èƒ½åŠ›ï¼Œæ”¯æŒæ¶ˆæ¯å›æº¯ã€‚å»¶æ—¶æ¶ˆæ¯ã€‚</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ä¸‰å¤§åœºæ™¯ï¼šå¼‚æ­¥ã€è§£è€¦ã€å‰Šå³°ã€‚</li>
<li>metaqæ¶æ„ï¼šNameServerï¼ˆè·¯ç”±æ³¨å†Œä¸­å¿ƒï¼Œå®ä¾‹å½¼æ­¤ç‹¬ç«‹ï¼Œç”¨äºæœåŠ¡å‘ç°å’ŒTopicçš„æ³¨å†Œä¸­å¿ƒï¼Œæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤topicå’Œbrokerçš„æ˜ å°„å…³ç³»ï¼‰ã€Brokerï¼ˆå®é™…æ¶ˆæ¯å­˜å‚¨çš„æœåŠ¡å™¨ï¼Œåˆ†masterå’Œslaveï¼Œæ¯ä¸ªBrokerä¸æ‰€æœ‰çš„NameServerå»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶æ³¨å†ŒTopicä¿¡æ¯åˆ°NameServerã€‚ä¸»èŠ‚ç‚¹è¯»å†™ï¼Œä»èŠ‚ç‚¹æä¾›å†—ä½™å’Œæ•…éšœè½¬ç§»ã€‚ï¼‰ã€Producerï¼ˆæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œä¸NameServerå…¶ä¸­ä¸€ä¸ªå»ºç«‹é•¿è¿æ¥ï¼Œè¯»å–Topicè·¯ç”±ä¿¡æ¯ã€‚ä¸æä¾›TopicæœåŠ¡çš„Master Brokerå»ºç«‹é•¿è¿æ¥ï¼Œå¹¶å®šæ—¶å‘å…¶å‘é€å¿ƒè·³ï¼‰ã€Consumerï¼ˆæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œä¸NameServerå…¶ä¸­ä¸€ä¸ªå»ºç«‹é•¿è¿æ¥ï¼Œè¯»å–Topicè·¯ç”±ä¿¡æ¯ã€‚ä»Master Broker&#x2F;Slave Brokerè®¢é˜…æ¶ˆæ¯ï¼Œä¸Brokerå»ºç«‹å¿ƒè·³ã€‚å¯pullå¯pushï¼Œå¯é›†ç¾¤å¯å¹¿æ’­ï¼‰ã€‚</li>
<li>metaqçš„å­˜å‚¨æ¨¡å‹ï¼š1âƒ£ï¸CommitLogæ˜¯ç‰©ç†å­˜å‚¨æ–‡ä»¶ï¼Œå­˜å‚¨æ‰€æœ‰Topicçš„æ¶ˆæ¯å…ƒæ•°æ®ï¼Œæ˜¯å…¨å±€çš„é¡ºåºå†™å…¥çš„æ—¥å¿—æ–‡ä»¶ã€‚2âƒ£ï¸ConsumerQueueé€»è¾‘é˜Ÿåˆ—æ˜¯æ¯ä¸ªMessage Queueçš„ç´¢å¼•æ–‡ä»¶åŠå­˜å‚¨ä¸Šçš„ä½“ç°ï¼Œè®°å½•CommitLogä¸­çš„æ¶ˆæ¯åœ°å€ï¼ˆåç§»é‡ã€å¤§å°ã€æ¶ˆæ¯tagçš„hashcodeï¼‰ï¼Œæ¯ä¸ªæ¡ç›®20å­—èŠ‚ï¼Œæä¾›å¿«é€Ÿè®¿é—®ã€‚ç±»ä¼¼B+æ ‘ï¼ŒCommitLogæ˜¯å¶å­ç»“ç‚¹å­˜å‚¨å®é™…æ•°æ®ï¼ŒConsumerQueueæ˜¯ä¸­é—´èŠ‚ç‚¹è´Ÿè´£ç´¢å¼•æ•°æ®ã€‚3âƒ£ï¸Message Queueæ˜¯é€»è¾‘ä¸Šçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ˜¯Topicçš„åˆ†åŒºï¼Œåˆ†æ•£åœ¨ä¸åŒBrokerã€‚ç”¨äºå¹¶è¡Œå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚4âƒ£ï¸IndexFileç”¨äºå¿«é€Ÿæ£€ç´¢æ¶ˆæ¯ï¼Œç»´æŠ¤æ¶ˆæ¯é”®ï¼ˆæ¶ˆæ¯IDã€Keyï¼‰åˆ°ç‰©ç†ä½ç½®çš„æ˜ å°„ã€‚</li>
<li>metaqå¦‚ä½•ä¿è¯æ¶ˆæ¯é«˜å¯ç”¨ï¼š1âƒ£ï¸Producerï¼šæ”¯æŒåŒæ­¥å¼‚æ­¥å‘é€æ–¹å¼ï¼ŒåŒæ­¥æ¶ˆæ¯å‘é€ç¡®è®¤ã€æ¶ˆæ¯é‡è¯•ã€‚ä½¿ç”¨è´Ÿè½½å‡è¡¡é€‰æ‹©Brokerè¿›è¡Œæ¶ˆæ¯æŠ•é€’ã€‚å¿«é€Ÿå¤±è´¥ï¼šè°ƒåº¦çº¿ç¨‹å®šæ—¶æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ’é˜Ÿæ—¶é—´ï¼Œè¶…è¿‡å°±ç«‹å³è¿”å›å¤±è´¥ï¼Œä»¥å°½å¿«é‡è¯•ã€‚æ•…éšœè§„é¿æœºåˆ¶é¿å¼€ä¸Šæ¬¡å¤±è´¥çš„Brokerã€‚2âƒ£ï¸Consumerï¼šæ¶ˆæ¯æ‹‰å–ç¡®è®¤ã€æ¶ˆè´¹å¤±è´¥é‡è¯•é˜Ÿåˆ—ã€æ¶ˆè´¹è¿›åº¦å­˜å‚¨ï¼ˆå®šæœŸå­˜å‚¨æ¶ˆè´¹è¿›åº¦offsetï¼Œé‡å¯æˆ–æ•…éšœåä»è¿›åº¦ç»§ç»­æ¶ˆè´¹ï¼‰ã€ä¸šåŠ¡å±‚å®ç°å¹‚ç­‰æ¶ˆè´¹ï¼ˆé‡å¤æ¶ˆè´¹ä¹Ÿä¸å½±å“ï¼‰ã€‚3âƒ£ï¸Brokerï¼šæŒä¹…åŒ–å­˜å‚¨æœºåˆ¶ï¼ˆå­˜å‚¨åˆ°CommitLogï¼Œé¡ºåºå†™å…¥ç£ç›˜ï¼‰ã€ä¸»ä»éƒ¨ç½²ï¼ˆä¸»ä»åŒæ­¥ã€ä¸»ä»åˆ‡æ¢ï¼ŒMasterå’ŒSlaveæ•…éšœè½¬ç§»ï¼‰ã€æ­»ä¿¡é˜Ÿåˆ—ï¼ˆæ— æ³•æˆåŠŸæ¶ˆè´¹çš„æ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼‰ã€ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶MappedFileï¼ˆå°†ç£ç›˜æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œä»¥æ“ä½œå†…å­˜æ–¹å¼æ“ä½œç£ç›˜ï¼Œå‡å°‘CPUæ‹·è´ï¼‰</li>
<li>åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ï¼šå°†å†…å­˜ä¸­æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼ŒåŒæ­¥åˆ·ç›˜æ˜¯å°†æ¶ˆæ¯æˆåŠŸå†™å…¥commitLogä¸­ä¹‹åå†è¿”å›ç»™ç”Ÿäº§è€…æˆåŠŸï¼Œæ›´å¯é ã€‚å¼‚æ­¥åˆ·ç›˜æ˜¯å†™åˆ°å†…å­˜åç›´æ¥è¿”å›ï¼Œç„¶åé€šè¿‡å¦ä¸€ä¸ªåå°çº¿ç¨‹æ¥åˆ·ç›˜ï¼Œååé‡æ›´é«˜ã€‚</li>
<li>Brokerä¸»ä»åŒæ­¥ï¼šä»èŠ‚ç‚¹å®šæ—¶å‘ä¸»èŠ‚ç‚¹å‘é€åŒæ­¥è¯·æ±‚ï¼Œä¸»èŠ‚ç‚¹æ ¹æ®ä»èŠ‚ç‚¹CommitLogæœ€å¤§åç§»é‡è¿”å›æ¶ˆæ¯ã€‚</li>
<li>NameServerä½œç”¨ï¼šBrokerçš„åŠ¨æ€æ³¨å†Œä¸å‘ç°ï¼ˆå¿ƒè·³æ£€æµ‹æ˜¯å¦å­˜æ´»ï¼‰ã€è·¯ç”±ä¿¡æ¯ç®¡ç†ï¼ˆä¿å­˜æ•´ä¸ªBrokeré›†ç¾¤çš„è·¯ç”±ä¿¡æ¯ï¼Œtopicå’ŒBrokerçš„æ˜ å°„å…³ç³»ï¼‰ã€‚æ¯ä¸ªNameServeræœ‰ä¸€ä»½å®Œæ•´æ•°æ®ã€‚</li>
<li>Raftåè®®å’ŒPaxosï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç”¨äºè§£å†³ä¸€è‡´æ€§é—®é¢˜çš„å…±è¯†ç®—æ³•ã€‚ä¾‹å¦‚Zookeeperä¸­çš„Leaderé€‰ä¸¾ã€‚</li>
<li>RocketMqé›†ç¾¤æ¨¡å¼ï¼š1âƒ£ï¸å•masteræ¨¡å¼ï¼šä¸èƒ½æ•…éšœè½¬ç§»å’Œé«˜å¯ç”¨ã€‚2âƒ£ï¸å¤šmasteræ¨¡å¼ï¼šä¸èƒ½æ•…éšœè½¬ç§»ã€‚3âƒ£ï¸å¤šmasteå¤šslaveå¼‚æ­¥æ¨¡å¼ï¼šå¼‚æ­¥å¤åˆ¶ï¼Œå®æ—¶æ€§é«˜ï¼ŒMasterå®•æœºç£ç›˜æŸåæƒ…å†µä¸‹ä¼šä¸¢å¤±å°‘é‡æ¶ˆæ¯ã€‚4âƒ£ï¸å¤šmasterå¤šslaveåŒæ­¥æ¨¡å¼ï¼šåŒæ­¥åŒå†™ï¼Œå†™æˆåŠŸæ‰è¿”å›ç»™åº”ç”¨ï¼Œæ— å•ç‚¹æ•…éšœã€‚</li>
<li>RocketMqé¡ºåºæ¶ˆæ¯å¦‚ä½•ä¿è¯ï¼šCommitLogçš„å†™å…¥æ˜¯é¡ºåºçš„ï¼Œæ¶ˆæ¯é˜Ÿåˆ—FIFOï¼Œå¯¹äºå•ä¸ªMessage Queueè€Œè¨€ï¼Œæ˜¯æŒ‰å­˜å‚¨é¡ºåºé¡ºåºæ¶ˆè´¹çš„ã€‚å¤šä¸ªMessage Queueæ˜¯ä¸ä¿è¯å…¨å±€é¡ºåºçš„ã€‚éœ€è¦ç¡®ä¿æ¶ˆæ¯åªåˆ†é…ç»™ä¸€ä¸ªMessage Queueã€‚</li>
<li>RocketMqè´Ÿè½½å‡è¡¡ï¼šProducerè´Ÿè½½å‡è¡¡ï¼Œè½®è¯¢æ–¹å¼å‘é€åˆ°Message Queueã€‚Consumerè´Ÿè½½å‡è¡¡ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹queueå‡åŒ€åˆ†é…ç»™å®ä¾‹ï¼Œæ¯ä¸ªqueueåªåˆ†ç»™ä¸€ä¸ªConsumerå®ä¾‹ã€‚å¹¿æ’­æ¨¡å¼ä¸‹æ‰€æœ‰consumeråˆ†åˆ°æ‰€æœ‰queueã€‚</li>
<li>æ­»ä¿¡é˜Ÿåˆ—ï¼šæ¶ˆæ¯é‡å¤æ¶ˆè´¹å¤±è´¥ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚ä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªGroupIdï¼Œä¸åˆ†Topicã€‚</li>
<li>æ¶ˆæ¯å¹‚ç­‰ï¼šæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œæ ¹æ®ä¸šåŠ¡å”¯ä¸€Keyï¼ˆå¦‚Message keyï¼‰åšå¹‚ç­‰ï¼Œå³ä½¿é‡å¤æ¶ˆè´¹ä¹Ÿæ²¡äº‹ã€‚</li>
<li>æ¨æ‹‰æ¶ˆæ¯æ¨¡å¼ï¼šPullï¼šæ‹‰å–å‹ï¼Œæ¶ˆè´¹è€…ä¸»åŠ¨å®šæœŸè½®è¯¢Brokerï¼Œè¯·æ±‚æ–°æ¶ˆæ¯ã€‚Pushï¼šæ¶ˆè´¹è€…æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨æ¥æ¥æ”¶Brokerçš„æ¶ˆæ¯æ¨é€ï¼Œè¢«åŠ¨æ¶ˆè´¹ã€‚ä½†å®ç°ä¸Šï¼Œéƒ½æ˜¯æ¶ˆè´¹ç«¯ä¸»åŠ¨æ‹‰å–çš„æ–¹å¼ï¼ŒRocketMqçš„æœåŠ¡ç«¯ä¸ä¼šä¸»åŠ¨æ¨é€ï¼Œpushæ¨¡å¼ä¸‹è¿˜æ˜¯æ¶ˆè´¹ç«¯æ‹‰å–æ¶ˆæ¯ï¼Œæ‹‰å–åè°ƒç”¨å›è°ƒæ¥å£ï¼Œæ¨¡æ‹Ÿæ¨é€ã€‚</li>
<li>ä»»ä½•ä¸€å°Brokerå®•æœºæ€ä¹ˆåŠï¼šBrokeré‡‡ç”¨ä¸»ä»æ¶æ„ï¼Œå¤šå‰¯æœ¬ç­–ç•¥ã€‚Brokerå®•æœºåä¸»ä»åˆ‡æ¢ï¼Œé«˜å¯ç”¨ã€‚4.5å¼€å§‹æ”¯æŒDlegderæ¨¡å¼ï¼ŒåŸºäºraftåˆ†å¸ƒå¼ä¸€è‡´ç®—æ³•ã€‚</li>
<li>æ¶ˆæ¯è¢«æ¶ˆè´¹åä¼šç«‹å³åˆ é™¤å—ï¼šä¸ä¼šï¼Œæ¶ˆè´¹ååªæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è¿›åº¦ï¼ˆoffsetï¼‰æ›´æ–°ï¼Œæ¶ˆæ¯çš„åˆ é™¤æ˜¯é€šè¿‡å®šæœŸæ¸…ç†è¿‡æœŸæ–‡ä»¶æ¥å®ç°çš„ã€‚</li>
<li>å»¶æ—¶æ¶ˆæ¯å®ç°ï¼šæ˜¯åœ¨æŠ•é€’åˆ°Topicè¿™ä¸€é˜¶æ®µå»¶æ—¶çš„ã€‚1âƒ£ï¸æ¶ˆæ¯æŠ•é€’ï¼šæä¾›è‹¥å¹²ä¸ªå»¶æ—¶ç­‰çº§ã€‚æœ‰ä¸€ä¸ªä¸“é—¨çš„å»¶æ—¶Topicï¼Œå­˜å…¥å¯¹åº”å»¶æ—¶ç­‰çº§çš„é˜Ÿåˆ—ä¸­ã€‚2âƒ£ï¸æ¶ˆæ¯è°ƒåº¦ï¼šBrokerå¯åŠ¨æ—¶ï¼Œåˆ›å»ºScheduledThreadPoolExecutorçº¿ç¨‹æ± ï¼Œæ¯ä¸ªå»¶è¿Ÿé˜Ÿåˆ—ä¸€ä¸ªçº¿ç¨‹æ‰«æï¼Œå®šæœŸæ£€æŸ¥å»¶æ—¶é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ˜¯å¦åˆ°æœŸã€‚3âƒ£ï¸è½¬ç§»æ¶ˆæ¯ï¼šå–å‡ºæ¶ˆæ¯é‡æ–°è¿›è¡ŒCommitLogå†™å…¥ï¼Œå†™å…¥å¯¹åº”Consumer Queueã€‚ç„¶åæ­£å¸¸æ¶ˆè´¹ã€‚</li>
<li>metaqæ€»ç»“ï¼šé«˜æ€§èƒ½ï¼ˆååé‡é«˜å¹¶å‘é‡é«˜ï¼Œé˜Ÿåˆ—æ¨¡å‹ã€å¹¶è¡Œæ¶ˆè´¹ã€åŸºäºNettyï¼‰ã€é«˜å¯é æ€§ï¼ˆæ¶ˆæ¯ä¸¢å¤±å¯èƒ½å°ï¼Œé‡è¯•æœºåˆ¶ã€æ•…éšœè§„é¿æœºåˆ¶ã€é‡è¯•ã€æ­»ä¿¡é˜Ÿåˆ—ï¼‰ã€é«˜å®æ—¶æ€§ï¼ˆä½å»¶è¿Ÿï¼Œå¿«é€Ÿå¤±è´¥ã€å¼‚æ­¥åˆ·ç›˜ã€é›¶æ‹·è´ï¼‰</li>
</ul>
<h2 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h2><ul>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ä¸ªç”¨äºæ¥æ”¶æ¶ˆæ¯ã€å­˜å‚¨æ¶ˆæ¯å¹¶ä¸”è½¬å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼Œå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦ã€‚</li>
<li>metaqä¸­çš„nameserverï¼šç±»ä¼¼kafkaä¸­zookeeperçš„è§’è‰²ï¼Œä¸ç›´æ¥é‡‡ç”¨ZooKeeperæ˜¯å› ä¸ºZooKeeperæœ‰è‡ªåŠ¨é€‰ä¸¾Masterçš„åŠŸèƒ½ï¼ŒMetaQçš„æ¶æ„è®¾è®¡ä¸Šå†³å®šäº†å®ƒä¸éœ€è¦è¿›è¡ŒMasteré€‰ä¸¾ï¼Œè€Œåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªè½»é‡çº§çš„å…ƒæ•°æ®æœåŠ¡å™¨å°±å¯ä»¥äº†ã€‚</li>
<li>kafkaï¼šä¸€ä¸ªå¤šåˆ†åŒºã€å¤šå‰¯æœ¬ä¸”åŸºäº ZooKeeperåè°ƒçš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿã€‚å®šä½ä¸ºä¸€ä¸ªåˆ†å¸ƒå¼æµå¼å¤„ç†å¹³å°ï¼Œé«˜ååã€å¯æŒä¹…åŒ–ã€å¯æ°´å¹³æ‰©å±•ã€æ”¯æŒæµæ•°æ®å¤„ç†ã€‚</li>
<li>kafkaçš„æ¶æ„ï¼šzookeeperä¿å­˜brokeré›†ç¾¤å…ƒæ•°æ®ï¼Œå¯¹æ§åˆ¶å™¨è¿›è¡Œé€‰ä¸¾æ“ä½œã€‚Producerç”Ÿäº§æ¶ˆæ¯å¹¶å‘é€åˆ°Brokerã€‚Consumerä»Brokerè®¢é˜…å¹¶æ¶ˆè´¹æ¶ˆæ¯ã€‚Brokeræ¥æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå­˜å‚¨æ¶ˆæ¯ï¼Œä¸ºæ¶ˆæ¯è®¾ç½®åç§»é‡ã€‚Topicæ¶ˆæ¯çš„ä¸»é¢˜ã€‚ä¸€ä¸ªTopicç»†åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œåœ¨å­˜å‚¨ä¸Šçœ‹ä½œä¸€ä¸ªå¯è¿½åŠ çš„Logæ–‡ä»¶ã€‚offsetæ˜¯æ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„å”¯ä¸€æ ‡è¯†ï¼Œä¿è¯æ¶ˆæ¯åœ¨åˆ†åŒºçš„é¡ºåºæ€§ï¼Œä¸è·¨åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯kafkaåªä¿è¯åˆ†åŒºæœ‰åºæ€§ã€‚Replicationå‰¯æœ¬ï¼Œä¿è¯é«˜å¯ç”¨ï¼ŒåŒä¸€Partionåœ¨å¤šä¸ªBrokerä¸Šå­˜å¤šä¸ªå‰¯æœ¬ï¼Œä¸»æä¾›è¯»å†™ï¼Œä¸»å¤±æ•ˆçš„è¯ï¼Œzookeeperé€‰ä¸¾controllerï¼Œcontrolleré€‰æ‹©ä¸»ã€‚</li>
<li>kafkaé«˜å¯ç”¨ï¼šå¤šåˆ†åŒºï¼Œä¸€ä¸ªTopicä¸»é¢˜åˆ†åŒºæ•°æ®è·¨è¶Šå¤šä¸ªbrokeråˆ†å¸ƒå¼å­˜å‚¨ï¼Œæ¯ä¸ªåˆ†åŒºæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œä¸»å‡ºç°æ•…éšœï¼Œå¯ä»¥æ•…éšœè½¬ç§»ã€‚</li>
<li>kafkaä¸€å®šä¸ä¼šä¸¢å¤±æ¶ˆæ¯å—ï¼šåªæœ‰ä¸€ä¸ªå‰¯æœ¬æƒ…å†µä¸‹ä¼šä¸¢å¤±ï¼Œç”Ÿäº§è€…ç¡®è®¤ç­–ç•¥æ˜¯å¼‚æ­¥çš„è¿˜æ˜¯åŒæ­¥çš„ï¼Œå¼‚æ­¥çš„å¯èƒ½åœ¨æ¶ˆæ¯åˆ°è¾¾æœåŠ¡å™¨ä¹‹å‰ä¸¢å¤±ã€‚çŸ­æš‚ç½‘ç»œæ•…éšœã€ç£ç›˜æŸåã€‚</li>
<li>nettyçš„ä¼˜ç‚¹ï¼š1âƒ£ï¸Reactoræ¨¡å‹å¤„ç†å¹¶å‘ç½‘ç»œäº‹ä»¶ï¼šä¸»Reactorçº¿ç¨‹è´Ÿè´£æ¥æ”¶æ–°çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå°†è¿æ¥åˆ†é…ç»™ä»Reactorï¼Œè´Ÿè´£ç›‘æ§å’Œå¤„ç†IOäº‹ä»¶ã€‚2âƒ£ï¸å†…å­˜ç®¡ç†ï¼šæ± åŒ–çš„å†…å­˜åˆ†é…æ–¹å¼ï¼Œå‡å°‘å†…å­˜åˆ†é…å’Œå›æ”¶æˆæœ¬ã€‚å­—èŠ‚ç¼“å†²åŒºByteBufæä¾›å†…å­˜è¯»å†™ï¼Œè¾ƒJDKè‡ªå¸¦çš„ByteBufferå…·æœ‰æ›´é«˜çš„æ€§èƒ½ï¼Œå¼•ç”¨è®¡æ•°ã€‚3âƒ£ï¸è¿æ¥ç®¡ç†ï¼šåŸºäºäº‹ä»¶å¾ªç¯(EventLoop)çš„æ¨¡å‹æ¥ç®¡ç†ç½‘ç»œè¿æ¥ã€‚æ¯ä¸ªEventLoopéƒ½ç»´æŠ¤äº†å®ƒè‡ªå·±çš„é€‰æ‹©å™¨(Selector)å’Œä»»åŠ¡é˜Ÿåˆ—ï¼Œèƒ½å¤Ÿå¤„ç†æˆç™¾ä¸Šåƒçš„è¿æ¥è€Œä¸ä¼šåˆ›å»ºä¸ä¹‹å¯¹ç­‰çš„çº¿ç¨‹ï¼Œé™ä½èµ„æºæ¶ˆè€—ã€‚é“¾å¼çš„å¤„ç†å™¨ChannelHandleræ¥å¤„ç†ç½‘ç»œäº‹ä»¶ã€‚</li>
<li>tcpå’Œudpï¼štcpé¢å‘è¿æ¥ï¼Œudpæ— è¿æ¥ã€‚tcpæä¾›å¯é ä¼ è¾“ï¼Œæµé‡æ§åˆ¶ï¼Œæ‹¥å¡æ§åˆ¶ï¼Œudpå°½åŠ›è€Œä¸ºï¼Œä¸ä¿è¯æ•°æ®åŒ…é¡ºåºã€å®Œæ•´æ€§ã€æ­£ç¡®æ€§ï¼Œä¸ä¼šè‡ªåŠ¨é‡ä¼ ã€‚tcpç‚¹åˆ°ç‚¹çš„ï¼Œé¢å‘å­—èŠ‚æµï¼Œä¼ è¾“æ…¢ï¼Œé¦–éƒ¨å¼€é”€å¤§20-60å­—èŠ‚ï¼Œé€‚åˆæ–‡ä»¶ä¼ è¾“ã€ç½‘é¡µã€‚udpä¸€å¯¹ä¸€å¤šå¯¹ä¸€å¤šå¯¹å¤šä¸€å¯¹å¤šï¼Œé¢å‘æŠ¥æ–‡ï¼Œä¼ è¾“æ•ˆç‡å¿«ï¼Œä¸å¯é ï¼Œé¦–éƒ¨å¼€é”€å°8å­—èŠ‚ï¼Œé€‚åˆè§†é¢‘é€šè¯ã€‚</li>
</ul>
<h2 id="netty"><a href="#netty" class="headerlink" title="netty"></a>netty</h2><ul>
<li>Nettyæ˜¯ä»€ä¹ˆï¼šæä¾›å¼‚æ­¥çš„åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶ã€‚ç”¨æ¥å¿«é€Ÿå¼€å‘é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„ç½‘ç»œIOç¨‹åºï¼Œæœ€æµè¡Œçš„NIOæ¡†æ¶ã€‚Elasticsearchã€Dubboã€gRpcã€Zookeeperã€Rocketmqéƒ½ç”¨Nettyã€‚NIOã€Seletoré€‰æ‹©å™¨ã€äº‹ä»¶é©±åŠ¨ã€å›è°ƒå¼‚æ­¥ã€‚</li>
<li>Nettyçš„äº‹ä»¶é©±åŠ¨ï¼šäº‹ä»¶å¦‚è¿æ¥æ‰“å¼€ã€æ•°æ®åˆ°è¾¾ã€è¿æ¥å…³é—­å‡ä»¥å¼‚æ­¥æ–¹å¼å¤„ç†ã€‚æä¾›EventLoopå¤„ç†IOäº‹ä»¶ï¼Œå…¶ä¸­ChannelHandlerså“åº”äº‹ä»¶ã€‚å‘èµ·IOåï¼Œç«‹å³è¿”å›ChannelFutureå¯¹è±¡ï¼Œå¼€å‘è€…åœ¨ä¸Šé¢å¢åŠ ç›‘å¬å™¨ChannelFutureListenerï¼Œåœ¨IOå®Œæˆæ—¶æ”¶åˆ°é€šçŸ¥ã€‚å›è°ƒæœºåˆ¶å’ŒFutureçš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ã€‚</li>
<li>Reactoræ¨¡å‹ï¼šäº‹ä»¶é©±åŠ¨æ¶æ„çš„ä¸€ç§å®ç°æ–¹å¼ã€‚ä¸€ä¸ªå•çº¿ç¨‹ç›‘å¬å°±ç»ªIOäº‹ä»¶ï¼Œå¹¶å°†IOäº‹ä»¶åˆ†å‘ç»™å›è°ƒå‡½æ•°ã€‚Acceptorå¤„ç†æ–°è¿æ¥ï¼ŒReactoråˆ†æ´¾äº‹ä»¶åˆ†æ´¾ç»™Handlerï¼ŒHandleräº‹ä»¶å¤„ç†ã€‚NIOå°±æ˜¯ã€‚</li>
<li>Nettyä¼˜ç‚¹ï¼šé«˜å¹¶å‘åŸºäºNIOã€ä¼ è¾“å¿«é›¶æ‹·è´ã€å°è£…å¥½ã€å†…å­˜æ± è®¾è®¡ä½¿ç”¨ç›´æ¥å†…å­˜ã€é«˜æ€§èƒ½åºåˆ—åŒ–åè®®Protobuf</li>
<li>Nettyåº”ç”¨åœºæ™¯ï¼šRPCæ¡†æ¶çš„ç½‘ç»œé€šä¿¡å·¥å…·ã€å®ç°HTTPæœåŠ¡å™¨ã€å®ç°å³æ—¶é€šè®¯ç³»ç»Ÿã€æ¶ˆæ¯æ¨é€ç³»ç»Ÿ</li>
<li>Nettyç›¸æ¯”åŸç”ŸNIOä¼˜åŠ¿ï¼šæ˜“ç”¨æ€§ï¼ˆå°è£…APIï¼‰ã€ç¨³å®šæ€§ï¼ˆä¿®å¤äº†selectç©ºè½¬å¯¼è‡´CPU100%é—®é¢˜ï¼‰ã€é«˜æ€§èƒ½ï¼ˆå¯¹è±¡æ± å¤ç”¨å’Œé›¶æ‹·è´æŠ€æœ¯ï¼‰ã€Nettyå¼‚æ­¥åŸºäºäº‹ä»¶é©±åŠ¨</li>
<li>Nettyå’ŒTomcatåŒºåˆ«ï¼šTomcatæ˜¯ç”¨ä½œServletå®¹å™¨çš„WebæœåŠ¡å™¨ï¼ŒNettyæ˜¯å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ã€‚é€šä¿¡åè®®ä¸Šï¼ŒTomcatåŸºäºhttpï¼ŒNettyä¸ä»…æ”¯æŒhttpï¼Œå¯ä»¥é€šè¿‡ç¼–ç¨‹è‡ªå®šä¹‰å„ç§åè®®ã€‚Tomcatéœ€è¦éµå¾ªServletè§„èŒƒè¯·æ±‚ä¸å“åº”æ¨¡å‹ï¼ŒNettyä¸éœ€è¦ã€‚</li>
<li>Nettyä½“ç³»ç»“æ„ï¼š1âƒ£ï¸Channelï¼šSocketçš„è¿æ¥ä¾æ®ï¼Œåˆ›å»ºã€æ³¨å†Œåˆ°EventLoopã€è¿æ¥åˆ°è¿œç¨‹èŠ‚ç‚¹ã€‚2âƒ£ï¸EventLoopï¼šExecutoråœ¨Nettyçš„çº¿ç¨‹æ¨¡å‹æŠ½è±¡ï¼Œç”±EventLoopGroupåˆ†é…ç®¡ç†ã€‚ä¸€ä¸ªEventLoopå¯ä»¥è¢«åˆ†é…ç»™å¤šä¸ªChannelï¼Œä¸€ä¸ªChannelçš„IOæ“ä½œç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ä½œç”¨æ˜¯è´Ÿè½½ç›‘å¬ç½‘ç»œäº‹ä»¶å¹¶è°ƒç”¨äº‹ä»¶å¤„ç†å™¨è¿›è¡ŒIOæ“ä½œã€‚3âƒ£ï¸EventLoopGroupï¼šçº¿ç¨‹æ± ï¼Œé€šå¸¸ä¸¤ä¸ªï¼Œä¸€ä¸ªç”¨äºæ¥å—æ–°è¿æ¥ï¼Œå¦ä¸€ä¸ªç”¨äºå¤„ç†å·²æ¥å—è¿æ¥çš„æ•°æ®ä¼ è¾“IOæ“ä½œã€‚4âƒ£ï¸ChannelHandlerï¼šå¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç”¨æˆ·è‡ªå®šä¹‰äº‹ä»¶å¤„ç†é€»è¾‘ï¼Œå¦‚è¿æ¥æ‰“å¼€å…³é—­ã€æ•°æ®è¯»å–å†™å…¥ã€‚5âƒ£ï¸ChannelPipelineï¼šChannelHandlerå®ä¾‹é“¾ï¼Œç¼–æ’Handleräº‹ä»¶å¤„ç†å™¨é“¾å¼æ‰§è¡Œã€‚6âƒ£ï¸Bootstrapï¼šå¯åŠ¨ç±»ï¼Œç”¨äºé…ç½®æ•´ä¸ªNettyç¨‹åºï¼Œè¿›ç¨‹ç»‘å®šåˆ°ç«¯å£ã€è®¾ç½®çº¿ç¨‹æ¨¡å‹ã€äº‹ä»¶å¤„ç†æµã€‚åˆ†ä¸ºæœåŠ¡ç«¯ServerBootstrapå’Œå®¢æˆ·ç«¯Bootstrap</li>
<li>Nettyè¿è¡Œæ€»ç»“ï¼šNettyçš„æœåŠ¡ç«¯é€šè¿‡Channelå¤„ç†æ¯æ¬¡çš„è¿æ¥è¯·æ±‚ï¼ŒChanneléƒ½ä¼šæ³¨å†Œåˆ°EventLoopçº¿ç¨‹æ¨¡å‹ä¸­ç­‰å¾…æ’é˜Ÿæˆ–ç«‹å³æ‰§è¡Œã€‚EventLoopç”±EventLoopGroupç®¡ç†å’Œåˆ†é…ã€‚Channelæœ‰å››ç§ç”Ÿå‘½çŠ¶æ€ï¼ŒChannaelHandlerå¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼ŒChannelPipelineç¼–æ’æ‰€æœ‰çš„Handleré¡ºåºæ‰§è¡Œã€‚Bootstrapç”¨äºå°†è¿™äº›é€»è¾‘æˆä¸ºä¸€ä¸ªå¯è¿è¡Œçš„ç¨‹åºï¼Œæä¾›ä¸€ä¸ªè¿è¡Œå…¥å£ã€‚</li>
<li>ç½‘å…³ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ä¹‹é—´çš„ä¸­ä»‹ï¼Œç®€åŒ–ç½‘ç»œç»“æ„ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„è®¿é—®æ¥å£ã€‚åŠŸèƒ½ï¼šè·¯ç”±è½¬å‘ã€è´Ÿè½½å‡è¡¡ã€é‰´æƒã€é™æµã€ç›‘æ§ã€‚Nettyå¯å®ç°ç½‘å…³ï¼Œå®ç°WebSocketHandlerï¼Œä¸¤ä¸ªEventLoopGroupï¼Œé€šè¿‡ServerBootstrapå¼•å¯¼ï¼Œå¼‚æ­¥è°ƒç”¨çš„Channelæ–¹å¼ï¼Œæ‰§è¡ŒChannelPipelineä¸­çš„ChannelHandlerã€‚</li>
<li>Nettyçº¿ç¨‹æ¨¡å‹ï¼šä½¿ç”¨äº‹ä»¶å¾ªç¯EventLoopå¤„ç†IOæ“ä½œï¼Œæ¯ä¸ªEventLoopç»‘å®šåˆ°ä¸€ä¸ªçº¿ç¨‹ï¼ŒæœåŠ¡å¤šä¸ªChannelï¼Œè´Ÿè´£è°ƒåº¦å’Œæ‰§è¡ŒChannelPipelineä¸­çš„ChannelHandlerã€‚EventLoopGroupä¸€ä¸ªæ¥æ”¶æ–°è¿æ¥çš„bosså’Œè´Ÿè´£å·²è¿æ¥çš„workerã€‚å®ç°Reactoræ¨¡å¼ï¼Œæ¯ä¸ªEventLoopåŒ…å«ä¸€ä¸ªSelectoré€‰æ‹©å™¨æ¥ç›‘å¬æ³¨å†Œåœ¨å…¶ä¸Šçš„channeläº‹ä»¶ã€‚</li>
<li>NettyæœåŠ¡ç«¯å¯åŠ¨è¿‡ç¨‹ï¼š1.åˆ›å»ºä¸»ä»EventLoopGroupå®ä¾‹ 2.åˆå§‹åŒ–æœåŠ¡ç«¯å¯åŠ¨å¼•å¯¼ServerBootstrapå®ä¾‹ï¼Œé…ç½®å¯åŠ¨å‚æ•°  3.è®¾ç½®ChannelPipelineï¼Œæ·»åŠ è‡ªå®šä¹‰ChannelHandleræ¥å¤„ç†äº‹ä»¶å’Œæ•°æ®äº¤äº’ 4.ServerBootstrapçš„bindæ–¹æ³•ç»‘å®šæœåŠ¡å™¨ç›‘å¬çš„ç«¯å£ï¼Œå¯åŠ¨æœåŠ¡å™¨æ¥æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ 5.syncæ–¹æ³•é˜»å¡ç­‰å¾…ç›´åˆ°æœåŠ¡å™¨ç»‘å®šæ“ä½œå®Œæˆï¼Œéšåè¿›å…¥æœåŠ¡æ¨¡å¼</li>
<li>Nettyçš„æ— é”åŒ–ä½“ç°åœ¨å“ªï¼šä¸²è¡Œæ— é”åŒ–è®¾è®¡ï¼Œåœ¨IOçº¿ç¨‹å†…éƒ¨è¿›è¡Œå¤šä¸ªHandlerä¸²è¡Œæ“ä½œï¼ŒæœŸé—´ä¸è¿›è¡Œçº¿ç¨‹åˆ‡æ¢ï¼Œé¿å…å¤šçº¿ç¨‹å¯¼è‡´çš„é”ç«äº‰ã€‚</li>
<li>Nettyå¦‚ä½•è§£å†³epollç©ºè½®è¯¢çš„ï¼šä½¿ç”¨NIOçš„epollé€‰æ‹©å™¨æ—¶é‡åˆ°æ— æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦è€Œæ— é™å¾ªç¯ã€‚Nettyç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ç›‘æ§epoll_waitè¿”å›æ¬¡æ•°ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•IOäº‹ä»¶æƒ…å†µä¸‹è¿ç»­å¤šæ¬¡è¿”å›ï¼Œè®¤ä¸ºç©ºè½®è¯¢ï¼ŒNettyä¼šé‡å»ºSelectorï¼Œå°†åŸæ¥çš„Channelé‡æ–°æ³¨å†Œåˆ°æ–°çš„Selectorä¸Šã€‚</li>
<li>æ‹†åŒ…å’Œç²˜åŒ…ï¼šTCPé¢å‘æµï¼Œæ²¡æœ‰ç•Œé™çš„ä¸€ä¸²æ•°æ®ï¼Œä¼šæ ¹æ®TCPç¼“å†²åŒºçš„å®é™…æƒ…å†µè¿›è¡ŒåŒ…çš„åˆ’åˆ†ã€‚é€šè¿‡ä¸Šå±‚åº”ç”¨åè®®è®¾è®¡æ¥è§£å†³ï¼š1.æ¶ˆæ¯é•¿åº¦å›ºå®š 2.ç‰¹æ®Šåˆ†éš”ç¬¦ä½œä¸ºç»“æŸæ ‡å¿— 3.æ¶ˆæ¯å¤´å®šä¹‰æ¶ˆæ¯é•¿åº¦</li>
<li>Nettyè§£å†³æ‹†åŒ…å’Œç²˜åŒ…ï¼šä¾é æä¾›çš„ä¸€ç³»åˆ—è§£ç å™¨ï¼ˆDecoderï¼‰ï¼Œèƒ½å¤Ÿæ ¹æ®åº”ç”¨å±‚åè®®å°†æ¥æ”¶åˆ°çš„å­—èŠ‚æµé‡æ–°ç»„åˆæˆæœ‰æ„ä¹‰çš„æ•°æ®å•å…ƒï¼ˆæ¶ˆæ¯æˆ–å¸§ï¼‰ã€‚</li>
<li>Nettyé›¶æ‹·è´ï¼šä½¿ç”¨å †å¤–ç›´æ¥å†…å­˜è¿›è¡ŒSocketè¯»å†™ï¼Œä¸éœ€è¦è¿›è¡Œå­—èŠ‚ç¼“å†²åŒºçš„äºŒæ¬¡æ‹·è´ã€‚Nettyçš„Zero-copyå®Œå…¨æ˜¯åœ¨ç”¨æˆ·æ€ï¼ˆJavaåº”ç”¨å±‚ï¼‰çš„ï¼Œåå‘äºä¼˜åŒ–æ•°æ®æ“ä½œã€‚OSå±‚é¢çš„Zero-copyé€šå¸¸æ˜¯é¿å…åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ‹·è´æ•°æ®ã€‚</li>
<li>TCPé•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼šTCPçš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ç”±åº”ç”¨å±‚é¢å†³å®šã€‚çŸ­è¿æ¥æ˜¯å»ºç«‹è¿æ¥è¯»å†™å®Œæˆåå…³é—­è¿æ¥ï¼Œæ¯æ¬¡å»ºç«‹è¿æ¥æ¶ˆè€—èµ„æºã€‚é•¿è¿æ¥æ˜¯è¯»å†™åä¸å…³é—­è¿æ¥ï¼Œåç»­ç»§ç»­ä½¿ç”¨ã€‚</li>
<li>Nettyé•¿è¿æ¥å’Œå¿ƒè·³æœºåˆ¶ï¼šTCPé•¿è¿æ¥ä¸­å¯èƒ½å‡ºç°æ–­ç½‘å¼‚å¸¸ï¼Œå› æ­¤å¼•å…¥å¿ƒè·³æœºåˆ¶ï¼Œåœ¨clientå’Œserverä¹‹é—´æ²¡æœ‰æ•°æ®äº¤äº’æ—¶ç»™å¯¹æ–¹å‘é€ç‰¹æ®Šæ•°æ®åŒ…ï¼Œå¯¹æ–¹æ”¶åˆ°åå›åº”ä¸€ä¸ªï¼ˆPING-PONGäº¤äº’ï¼‰ï¼Œè¡¨ç¤ºä»ç„¶åœ¨çº¿ã€‚</li>
<li>Nettyå¯¹è±¡æ± æŠ€æœ¯ï¼šå¯¹è±¡æ± ç¼“å­˜åˆ›å»ºå¥½çš„å¯¹è±¡ï¼Œé¿å…éœ€è¦æ—¶æ‰åˆ›å»ºã€‚Nettyä¸­bufferæ˜¯å¯¹æ•°æ®çš„æŠ½è±¡ï¼Œæ•°æ®æ‹·è´æ—¶ç”¨åˆ°ï¼Œä»£è¡¨å¯è¯»å†™çš„å†…å­˜åŒºåŸŸï¼Œé€šè¿‡ByteBufç±»å®ç°ï¼ŒNettyä¼šå¯¹å…¶è¿›è¡Œæ± åŒ–ï¼Œå‡å°‘å†…å­˜åˆ†é…å’Œåƒåœ¾å›æ”¶å¼€é”€ã€‚</li>
<li>Nettyåºåˆ—åŒ–åè®®ï¼šä¸å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„åºåˆ—åŒ–åè®®ã€‚å®ƒæä¾›äº†çµæ´»çš„ç¼–è§£ç å™¨æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…æ ¹æ®éœ€è¦ä½¿ç”¨ä¸åŒçš„åºåˆ—åŒ–åè®®ï¼šjson&#x2F;pbã€‚</li>
</ul>
<h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><ul>
<li>è®¾è®¡æ¨¡å¼ï¼š23ç§ï¼Œä¸ºå¤æ‚è§£è€¦ï¼Œå°†ä¸€å¤§å¨ä»£ç æ‹†åˆ†æˆèŒè´£å•ä¸€çš„æ¨¡å—ï¼Œæ»¡è¶³é«˜å†…èšä½è€¦åˆã€å¼€é—­åŸåˆ™ï¼ˆä¸æ”¹å˜ç°æœ‰ä»£ç çš„åŸºç¡€ä¸Šæ‰©å±•åŠŸèƒ½ï¼‰ã€‚åˆ›å»ºå‹ï¼šåˆ›å»ºå’Œä½¿ç”¨è§£è€¦ã€‚ç»“æ„å‹ï¼šä¸åŒçš„åŠŸèƒ½ä»£ç è§£è€¦ã€‚è¡Œä¸ºå‹ï¼šä¸åŒçš„è¡Œä¸ºä»£ç è§£è€¦ã€‚</li>
<li>é¢å‘å¯¹è±¡çš„å››å¤§ç‰¹å¾ï¼šå°è£…ï¼ˆå°è£…æˆå¯¹è±¡ï¼Œéšè—å®ç°ç»†èŠ‚ï¼Œprivate publicæ§åˆ¶è®¿é—®æƒé™ï¼‰ã€æŠ½è±¡ï¼ˆå¿½ç•¥ä¸åŒï¼ŒæŠ½è±¡ç›¸åŒç‚¹ï¼Œç»§æ‰¿æŠ½è±¡ç±»is aå’Œå®ç°æ¥å£has aï¼‰ã€ç»§æ‰¿ï¼ˆç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œå…è®¸é‡ç”¨å’Œæ‰©å±•ï¼‰ã€å¤šæ€ï¼ˆé‡è½½æ˜¯é™æ€ï¼Œé‡å†™Overrideæ˜¯åŠ¨æ€ï¼‰</li>
<li>åˆ›å»ºå‹æ¨¡å¼ï¼šå°è£…å¤æ‚çš„åˆ›å»ºè¿‡ç¨‹ï¼Œè§£è€¦å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨ã€‚å•ä¾‹æ¨¡å¼ï¼šåˆ›å»ºå…¨å±€å”¯ä¸€å¯¹è±¡ã€‚å·¥å‚æ¨¡å¼ï¼šåˆ›å»ºä¸åŒä½†ç›¸å…³ç±»å‹çš„å¯¹è±¡ï¼ˆåŒä¸€çˆ¶ç±»&#x2F;æ¥å£ï¼‰ï¼Œç»™å®šå‚æ•°å†³å®šå¯¹è±¡ç±»å‹ã€‚å»ºé€ è€…æ¨¡å¼ï¼šåˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œè®¾ç½®ä¸åŒå¯é€‰å‚æ•°å®šåˆ¶åŒ–å¯¹è±¡Builderã€‚åŸå‹æ¨¡å¼ï¼šåˆ›å»ºæˆæœ¬å¤§ï¼Œå¤åˆ¶å·²æœ‰å¯¹è±¡è¿›è¡Œåˆ›å»ºã€‚</li>
<li>å•ä¾‹æ¨¡å¼ï¼šä¸€ä¸ªç±»åˆ›å»ºå…¨å±€å”¯ä¸€å®ä¾‹ï¼Œæä¾›å…¨å±€è®¿é—®ç‚¹ã€‚springå®¹å™¨ä¸€çº§ç¼“å­˜å³å•ä¾‹æ± ï¼ŒApplicationContext.getBeanè·å–beanã€‚å”¯ä¸€è®¿é—®æ€§èƒ½é«˜ï¼Œä¸é€‚åˆæœ‰çŠ¶æ€çš„ã€‚</li>
<li>å•ä¾‹æ¨¡å¼å®ç°ï¼š1âƒ£ï¸é¥¿æ±‰å¼ï¼šç±»åŠ è½½æ—¶å°±åˆ›å»ºï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä½†æ— æ³•å»¶è¿ŸåŠ è½½ã€‚2âƒ£ï¸æ‡’æ±‰å¼ï¼šç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åˆ›å»ºï¼Œå»¶è¿ŸåŠ è½½ï¼Œä½†å¤šçº¿ç¨‹ä¸‹éœ€è¦åŠ é”ä¿è¯çº¿ç¨‹å®‰å…¨é¿å…åˆ›å»ºå¤šå®ä¾‹ã€‚3âƒ£ï¸é™æ€å†…éƒ¨ç±»ï¼šåœ¨å¤–éƒ¨ç±»åŠ è½½æ—¶ä¸ä¼šè¢«åŠ è½½ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨æ‰åŠ è½½å¹¶åˆ›å»ºå®ä¾‹ï¼ŒJVMä¿è¯çº¿ç¨‹å®‰å…¨ã€‚4âƒ£ï¸æšä¸¾ç±»ï¼šå¤©ç”Ÿå•ä¾‹ã€‚5âƒ£ï¸åŒé‡æ£€æŸ¥é”å®šï¼šæ—¢å»¶è¿ŸåŠ è½½åˆçº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥å¤–æ£€æŸ¥ä¸€æ¬¡ï¼ŒåŒæ­¥å—å†…æ£€æŸ¥ä¸€æ¬¡ï¼Œvolatile+synchronizedã€‚</li>
<li>çº¿ç¨‹å”¯ä¸€å•ä¾‹æ€ä¹ˆå®ç°ï¼šConcurrentHashMapã€æˆ–ThreadLocalçº¿ç¨‹å±€éƒ¨å˜é‡ã€‚</li>
<li>å·¥å‚æ¨¡å¼ï¼šæä¾›å·¥å‚ç±»æ¥ä»£æ›¿newæ“ä½œã€‚Executorsæ–¹æ³•æ—¶é™æ€å·¥å‚æ¨¡å¼ã€‚1âƒ£ï¸ç®€å•å·¥å‚æ¨¡å¼ï¼šå·¥å‚ç±»æ–¹æ³•æ ¹æ®ä¼ å…¥å‚æ•°ä¸åŒå†³å®šç”Ÿæˆä¸åŒå¯¹è±¡ã€‚2âƒ£ï¸å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šå·¥å‚æ¥å£ï¼Œä¸åŒäº§å“åˆ›å»ºå®ç°ç±»ï¼Œå¼€é—­åŸåˆ™ã€‚3âƒ£ï¸æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šæ¥å£ä»£è¡¨ä¸€ä¸ªäº§å“æ—ã€‚ä¸åŒæ–¹æ³•åˆ›å»ºä¸åŒäº§å“ã€‚</li>
<li>å»ºé€ è€…æ¨¡å¼ï¼šåˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œ@Builderä¼ å…¥å‚æ•°å®šåˆ¶åŒ–ã€‚</li>
<li>åŸå‹æ¨¡å¼ï¼šåˆ›å»ºå¯¹è±¡æˆæœ¬å¤§ï¼Œç›´æ¥å¤åˆ¶å·²æœ‰å¯¹è±¡æ–¹å¼åˆ›å»ºã€‚æµ…æ‹·è´ï¼šåªå¯¹åŸºæœ¬æ•°æ®ç±»å‹å¤åˆ¶ï¼Œå¼•ç”¨æ•°æ®ç±»å‹è¿›è¡Œå¼•ç”¨ä¼ é€’ã€‚æ·±æ‹·è´ï¼šå¼•ç”¨æ•°æ®ç±»å‹åˆ›å»ºæ–°å¯¹è±¡å¹¶å¤åˆ¶å†…å®¹ã€‚å®ç°ï¼šå®ç°Cloneableæ¥å£ï¼Œé‡å†™Objectçš„cloneæ–¹æ³•ã€‚æˆ–åºåˆ—åŒ–å®ç°ã€‚</li>
<li>ä»£ç†æ¨¡å¼ï¼šç»“æ„å‹æ¨¡å¼ï¼Œç»™æŸå¯¹è±¡æä¾›ä»£ç†ï¼Œç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ï¼Œç›´æ¥è°ƒç”¨å˜é—´æ¥è°ƒç”¨ï¼Œä¸æ”¹å˜åŸä»£ç å‰æä¸‹å¢åŠ åŠŸèƒ½ï¼šé‰´æƒã€ç»Ÿè®¡ã€ç›‘æ§ã€é™æµã€‚1âƒ£ï¸é™æ€ä»£ç†ï¼šåœ¨è¿è¡Œå‰å°±åˆ›å»ºä»£ç†ç±»ï¼Œå®ç°ç›¸åŒæ¥å£&#x2F;ç»§æ‰¿å®ç°ç±»ã€‚2âƒ£ï¸åŠ¨æ€ä»£ç†ï¼šè¿è¡ŒæœŸé—´é€šè¿‡åå°„åŠ¨æ€åˆ›å»ºä»£ç†ç±»ï¼Œè¿è¡Œå‰ä¸å­˜åœ¨ä»£ç†ç±»å­—èŠ‚ç æ–‡ä»¶ã€‚ä¸éœ€è¦ä¸ºæ¯ä¸ªä»£ç†ç±»åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</li>
<li>é€‚é…å™¨æ¨¡å¼ï¼šå…è®¸ä¸å…¼å®¹çš„æ¥å£ä¹‹é—´äº¤äº’ï¼Œåˆ›å»ºä¸€ä¸ªä¸­é—´å±‚ï¼Œå°†ä¸€ä¸ªæ¥å£è½¬æ¢ä¸ºé€‚é…çš„æ¥å£ã€‚ç±»é€‚é…å™¨ï¼šç»§æ‰¿å®ç°ã€‚å¯¹è±¡é€‚é…å™¨ï¼šç»„åˆå®ç°ã€‚ä¾‹å¦‚Spring MVCä¸­æä¾›ä¸åŒçš„HandlerAdapteré€‚é…ä¸åŒçš„å¤„ç†å™¨ï¼Œä¾›DispatchServletå¤„ç†HTTPè¯·æ±‚ã€‚Spring AOPä¸­æä¾›ä¸åŒçš„é€‚é…å™¨AdvisorAdapteræ¥å°è£…ä¸åŒç±»å‹çš„é€šçŸ¥ã€‚</li>
<li>è§‚å¯Ÿè€…æ¨¡å¼ï¼šè¡Œä¸ºå‹æ¨¡å¼ï¼ŒåŸºäºå‘å¸ƒè®¢é˜…ï¼Œå¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œé€šçŸ¥ã€‚åŒæ­¥é˜»å¡ï¼šé˜»å¡æ¶ˆæ¯å‘å¸ƒè€…ã€‚å¼‚æ­¥éé˜»å¡ï¼šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéé˜»å¡åœ°é€šçŸ¥è§‚å¯Ÿè€…ã€‚</li>
<li>æ¨¡ç‰ˆæ¨¡å¼ï¼šé€šè¿‡å®šä¹‰ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œå¹¶å°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ã€‚ç®—æ³•ç»“æ„ä¸å˜ï¼Œå­ç±»é‡æ–°å®šä¹‰ç®—æ³•ã€‚ä¾‹å¦‚JdbcTemplateã€‚</li>
<li>ç­–ç•¥æ¨¡å¼ï¼šè¡Œä¸ºå‹æ¨¡å¼ï¼Œå®šä¹‰ä¸€ä¸ªç®—æ³•æ¥å£ï¼Œä¸åŒç®—æ³•å®ç°è¯¥æ¥å£ï¼Œä¸Šä¸‹æ–‡ç±»è¡¨ç¤ºä½¿ç”¨ç­–ç•¥çš„ç±»ï¼Œç»´æŠ¤ä¸€ä¸ªæŒ‡å‘ç­–ç•¥æ¥å£çš„å¼•ç”¨ã€‚å¯ä»¥è½»æ¾å¢åŠ ã€æ›¿æ¢ç®—æ³•ã€‚</li>
<li>è´£ä»»é“¾æ¨¡å¼ï¼šå¤šä¸ªä¸åŒçš„å¤„ç†ç±»å¯¹è±¡Handlerç»„æˆä¸€æ¡é“¾ï¼Œè¯·æ±‚åœ¨é“¾ä¸Šä¼ é€’ï¼Œé“¾ä¸Šæ¯ä¸ªå¯¹è±¡å¤„ç†ï¼Œè¿”å›&#x2F;ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li>Springä¸­çš„è®¾è®¡æ¨¡å¼ï¼š1âƒ£ï¸å•ä¾‹æ¨¡å¼ï¼šSpringå®¹å™¨å•ä¾‹æ± ï¼Œbeanéƒ½æ˜¯å•ä¾‹çš„ã€‚2âƒ£ï¸å·¥å‚æ¨¡å¼ï¼šBeanFactoryå’ŒApplicationContextåˆ›å»ºBeanã€‚3âƒ£ï¸ä»£ç†æ¨¡å¼ï¼šAopåŠŸèƒ½ä½¿ç”¨JDKåŠ¨æ€ä»£ç†å’ŒCglibåŠ¨æ€ä»£ç†ã€‚4âƒ£ï¸æ¨¡ç‰ˆæ¨¡å¼ï¼šJdbcTemplateæä¾›ä¸€å¥—æ¨¡æ¿æ–¹æ³•æ¥å¤„ç†æ•°æ®åº“çš„è¿æ¥ã€æ‰§è¡Œ SQL è¯­å¥ã€å¤„ç†ç»“æœé›†ã€‚5âƒ£ï¸è§‚å¯Ÿè€…æ¨¡å¼ï¼šSpringäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼ŒApplicationEventäº‹ä»¶ã€å‘å¸ƒè€…ã€ç›‘å¬å™¨ã€‚6âƒ£ï¸é€‚é…å™¨æ¨¡å¼ï¼šSpring MVCä¸­é€‚é…ä¸åŒçš„å¤„ç†å™¨Controllerã€‚AOPä¸­é€‚é…ä¸åŒçš„é€šçŸ¥Adviceã€‚</li>
<li>å·¥ä½œä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ï¼š1âƒ£ï¸å•ä¾‹æ¨¡å¼ï¼šæ•°æ®åº“è¿æ¥æ± ã€XStreamç”¨æ¥è¿›è¡Œxmlåºåˆ—åŒ–ååºåˆ—åŒ–ï¼Œåå¤åˆ›å»ºå›é€ æˆygcï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚2âƒ£ï¸å·¥å‚æ¨¡å¼ï¼šæ ¹æ®ä¸åŒä¸šåŠ¡ç±»å‹è¿”å›å¯¹åº”çš„ä¸šåŠ¡å¤„ç†ç±»ã€‚å®ç°InitializingBeanæ¥å£ï¼Œé‡å†™afterPropertiesSetæ–¹æ³•ï¼Œç”¨Mapç»´æŠ¤ä¸åŒä¸šåŠ¡ç±»çš„å¼•ç”¨ã€‚3âƒ£ï¸è§‚å¯Ÿè€…æ¨¡å¼ï¼šæŠ¥è­¦ç³»ç»Ÿï¼Œå®šä¹‰äº‹ä»¶ç±»ç»§æ‰¿ApplicationEventï¼Œä¸šåŠ¡ç±»ä¸­ä½¿ç”¨applicationContext.publishEvent(ApplicationEvent)æ¥å‘é€äº‹ä»¶ï¼Œå®šä¹‰ç›‘å¬å™¨EventListenerï¼Œç›‘å¬æ¶ˆæ¯å‘é€æŠ¥è­¦ã€‚4âƒ£ï¸è´£ä»»é“¾æ¨¡å¼ï¼šè½¨è¿¹å¤„ç†æµç¨‹ï¼šè§£æã€åˆ‡åˆ†ã€æŠ½ç¨€ã€åŒ¹é…ã€å…¥åº“ï¼Œå®šä¹‰è´£ä»»é“¾HandlerChainï¼ŒæŒ‰ç…§æµç¨‹å¤„ç†ã€‚</li>
</ul>
<h2 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h2><ul>
<li>zookeeperï¼šåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œç”¨æ¥ç®¡ç†hadoopç”Ÿæ€åœˆçš„ã€‚ä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼ŒåŠŸèƒ½ï¼šé…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€é¢†å¯¼è€…é€‰ä¸¾ã€é›†ç¾¤ç®¡ç†ã€‚</li>
<li>zookeeperä¸ºä»€ä¹ˆä½¿ç”¨é›†ç¾¤ï¼š1.é«˜å¯ç”¨æ€§ï¼Œå•èŠ‚ç‚¹å¤±è´¥ä»å¯è¿è¡Œã€‚2.æ•°æ®ä¸€è‡´æ€§ï¼ŒZABåè®®å®ç°æ‰€æœ‰èŠ‚ç‚¹æ•°æ®ä¸€è‡´æ€§ã€‚3.è´Ÿè½½å‡è¡¡ï¼Œåˆ†æ•£è´Ÿè½½ã€‚4.å¯ä¼¸ç¼©æ€§ã€‚</li>
<li>zooleeperæ¶æ„ï¼š1.Clientè¿æ¥åˆ°ä¸€å°Serverï¼Œå‘serverè·å–ä¿¡æ¯ï¼Œå‘¨æœŸæ€§å‘é€å¿ƒè·³ç»™serverï¼Œserverå›å¤ackï¼Œæ²¡å›å¤åˆ™é‡å®šå‘ä¸€å°serverã€‚2.ServeråŒ…æ‹¬ä¸€å°Leaderå’Œå¤šå°Followerã€‚3.ensembleè¡¨ç¤ºä¸€ç»„æœåŠ¡å™¨ï¼Œè‡³å°‘3å°ã€‚4.Leaderï¼ŒæœåŠ¡å¯åŠ¨æ—¶è¿›è¡ŒLeaderé€‰ä¸¾ï¼Œè´Ÿè´£å¤„ç†å†™æ“ä½œï¼Œåœ¨é›†ç¾¤ä¸­åŒæ­¥æ•°æ®ã€‚5.Followerè·Ÿéšè€…ï¼Œå¤„ç†è¯»æ“ä½œï¼Œæ•°æ®å†—ä½™ï¼Œè½¬å‘å†™è¯·æ±‚ï¼Œå‚ä¸æŠ•ç¥¨ã€‚</li>
<li>zookeeperä¸­æ•°æ®ç»“æ„ï¼šå’ŒUnixæ–‡ä»¶ç³»ç»Ÿç±»ä¼¼ï¼Œçœ‹ä½œä¸€æ£µæ ‘ï¼ŒèŠ‚ç‚¹ç§°ä¸ºZnodeï¼Œå­˜å‚¨1MBæ•°æ®ï¼Œé€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ã€‚ä¸èƒ½å­˜å¤§æ•°æ®ã€‚createå‘½ä»¤åˆ›å»ºæ•°æ®ï¼Œgetå‘½ä»¤è·å–ç›®å½•çš„å€¼ï¼Œç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æ¥è§£å†³å¹¶å‘ï¼Œsetä¿®æ”¹ã€‚</li>
<li>zookeeperä¸‰ç§ç›®å½•èŠ‚ç‚¹znodeç±»å‹ï¼š1.æŒä¹…ç›®å½•ï¼šåˆ›å»ºä¹‹åä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ˜¾å¼åˆ é™¤ï¼Œå­˜å‚¨é•¿æœŸæœ‰æ•ˆçš„é…ç½®ä¿¡æ¯å’Œç³»ç»ŸçŠ¶æ€ä¿¡æ¯ã€‚2.ä¸´æ—¶ç›®å½•ï¼šåœ¨clientæ´»åŠ¨æœŸé—´æœ‰æ•ˆï¼Œæ–­å¼€è‡ªåŠ¨åˆ é™¤ï¼Œä¸èƒ½æœ‰å­ç›®å½•ã€‚å¸¸ç”¨äºé”å’ŒæœåŠ¡å‘ç°æœºåˆ¶ï¼Œä¾‹å¦‚æ ‡è®°æŸä¸ªèµ„æºæ­£åœ¨è¢«ä½¿ç”¨ï¼Œæˆ–ä¸€ä¸ªå®ä¾‹çš„æ³¨å†Œä¿¡æ¯ã€‚3.é¡ºåºç›®å½•ï¼šåœ¨æŒ‡å®šè·¯å¾„åå¢åŠ ä¸€ä¸ªå•è°ƒé€’å¢çš„è®¡æ•°å™¨ä½œä¸ºåç¼€ï¼Œç”Ÿæˆå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºåˆ†å¸ƒå¼é”ä¸­çš„å®ç°é˜Ÿåˆ—é¡ºåºã€‚</li>
<li>zookeeperåˆ†å¸ƒå¼é”ï¼šé¡ºåºä¸´æ—¶èŠ‚ç‚¹+watchç›‘å¬å™¨ã€‚åˆ›å»ºä¸€ä¸ªé”èŠ‚ç‚¹&#x2F;locksï¼Œè¯·æ±‚è·é”ï¼Œéœ€è¦åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªé¡ºåºä¸´æ—¶èŠ‚ç‚¹ï¼Œç„¶ååˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œæ˜¯åˆ™è·å–åˆ°é”ï¼Œä¸æ˜¯åˆ™åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ç›‘å¬æ¯”è‡ªå·±å°ä¸€çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸Šä¸€ä¸ªèŠ‚ç‚¹åˆ é™¤ï¼ˆæ‰‹åŠ¨åˆ æˆ–æ–­å¼€è¿æ¥è‡ªåŠ¨åˆ é™¤ï¼‰åˆ™è¯¥èŠ‚ç‚¹è·å–åˆ°é”ã€‚</li>
<li>zookeeperçš„è§‚å¯Ÿè€…æ¨¡å¼ï¼šzookeeper&#x3D;æ–‡ä»¶ç³»ç»Ÿ+é€šçŸ¥æœºåˆ¶ã€‚zookeeperå…è®¸å®¢æˆ·ç«¯è®¾ç½®å¯¹znodeçš„ç›‘è§†ï¼ˆwatchï¼‰ï¼Œå…¸å‹çš„å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼ŒèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè¢«é€šçŸ¥ã€‚ç‰¹ç‚¹ï¼šä¸€æ¬¡æ€§ï¼ˆç›‘è§†è¢«è§¦å‘åä¼šè¢«ç§»é™¤ï¼‰ï¼Œå¯ä»¥å¯¹åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„çŠ¶æ€å˜åŒ–å¿«é€Ÿåšå‡ºååº”ã€‚</li>
<li>zookeeperçš„leaderé€‰ä¸¾ï¼šæœ€å°å·é€‰ä¸¾æ³•ï¼šæ¯ä¸ªèŠ‚ç‚¹æŠ•ç¥¨ç»™è‡ªå·±ï¼ŒèŠ‚ç‚¹ä¹‹é—´äº’ç›¸å‘é€è‡ªå·±çš„æŠ•ç¥¨ï¼ŒèŠ‚ç‚¹æ”¶åˆ°æŠ•ç¥¨åè¯„ä¼°é€‰æ‹©æœ€å°idçš„èŠ‚ç‚¹æˆä¸ºé¢†å¯¼è€…ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹æ”¯æŒåŒä¸€idçš„æŠ•ç¥¨æ—¶ï¼ŒèŠ‚ç‚¹è®¤ä¸ºé¢†å¯¼è€…å·²é€‰å¥½ã€‚è€ƒè™‘èŠ‚ç‚¹idå’Œæœ€å¤§çš„äº‹åŠ¡idï¼ˆzxidï¼‰ï¼Œç¡®ä¿é¢†å¯¼è€…æ˜¯æ•°æ®æœ€æ–°çš„èŠ‚ç‚¹ã€‚</li>
<li>zookeeperçš„ZABåè®®ï¼šåŸå­å¹¿æ’­åè®®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚è´Ÿè´£æœåŠ¡ä¹‹é—´çš„æ•°æ®å¤åˆ¶ï¼ˆé¡ºåºä¸€è‡´æ€§çš„ï¼‰å’Œé¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹ä¸­çš„çŠ¶æ€åŒæ­¥ã€‚1âƒ£ï¸æ¶ˆæ¯å¹¿æ’­ï¼šç±»ä¼¼ä¸¤é˜¶æ®µæäº¤ï¼ŒLeaderæ¥æ”¶å†™è¯·æ±‚ï¼Œè¯·æ±‚å°è£…æˆäº‹åŠ¡ï¼Œäº‹åŠ¡zxidä¿è¯é¡ºåºï¼Œå‘é€ç»™æ‰€æœ‰Followerï¼Œè¶…è¿‡åŠæ•°æˆåŠŸå“åº”åˆ™æ‰§è¡Œcommitã€‚æœªå“åº”çš„éšååŒæ­¥ã€‚2âƒ£ï¸å´©æºƒæ¢å¤ï¼šé€‰ä¸¾æ•°æ®æœ€æ–°çš„èŠ‚ç‚¹ä½œä¸ºLeaderï¼Œä¸é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹åŒæ­¥çŠ¶æ€ã€‚</li>
<li>zookeeperé›†ç¾¤æ­å»ºï¼šå‡†å¤‡è‡³å°‘ä¸‰å°æœåŠ¡å™¨ï¼Œå®‰è£…zookeeperï¼Œzoo.cfgé…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ•°æ®ç›®å½•ï¼Œè®¾ç½®è¿æ¥ç«¯å£ï¼Œé…ç½®æœåŠ¡å™¨åˆ—è¡¨ã€‚å¯åŠ¨zookeeperæœåŠ¡ã€‚</li>
<li>zookeeperå¦‚ä½•ä¿è¯hadoopé«˜å¯ç”¨çš„ï¼š1âƒ£ï¸æ•…éšœåˆ‡æ¢å’ŒLeaderé€‰ä¸¾ï¼šZookeeperæ•…éšœè½¬ç§»æ§åˆ¶å™¨ZKFCç›‘æ§å’Œå¤„ç†NameNodeçš„æ•…éšœåˆ‡æ¢ï¼ŒååŠ©å¤‡ç”¨NameNodeæˆä¸ºä¸»èŠ‚ç‚¹ä¿éšœHDFSé«˜å¯ç”¨ã€‚ResourceManagerä¹Ÿæ˜¯ã€‚2âƒ£ï¸é›†ç¾¤å…ƒä¿¡æ¯åŒæ­¥ï¼šzookeeperæä¾›ä¸€è‡´æ€§çš„åˆ†å¸ƒå¼æ•°æ®ç®¡ç†ï¼ŒHadoopçš„ç»„ä»¶å¯ä»¥åˆ©ç”¨zookeeperç»´æŠ¤å’ŒåŒæ­¥ç³»ç»Ÿä¿¡æ¯å¦‚é…ç½®ä¿¡æ¯ã€é›†ç¾¤çŠ¶æ€ã€‚3âƒ£ï¸æœåŠ¡å‘ç°ï¼šzooKeeper å¯ä»¥ä½œä¸ºä¸€ä¸ªæœåŠ¡æ³¨å†Œè¡¨ï¼Œå¸®åŠ©å®¢æˆ·ç«¯å‘ç°å½“å‰å¯ç”¨çš„æœåŠ¡åœ°å€ã€‚</li>
<li>zookeeperçš„åº”ç”¨ï¼šKafkaä¸­zookeeperç”¨äºé›†ç¾¤ç®¡ç†å’Œåè°ƒï¼ŒåŒ…æ‹¬ Broker çš„æ³¨å†Œã€é¢†å¯¼è€…é€‰ä¸¾ã€é›†ç¾¤é…ç½®ç®¡ç†ç­‰ã€‚è¿˜æ˜¯Kafka é›†ç¾¤å…ƒæ•°æ®çš„å­˜å‚¨ä¸­å¿ƒã€‚HBaseä¸­zookeeperç”¨äºé¢†å¯¼è€…é€‰ä¸¾ã€å­˜å‚¨é›†ç¾¤å…ƒæ•°æ®ã€‚</li>
</ul>
<h2 id="hadoop"><a href="#hadoop" class="headerlink" title="hadoop"></a>hadoop</h2><ul>
<li>hadoopï¼šåˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼æœåŠ¡å™¨é›†ç¾¤ä¸Šå­˜å‚¨å’Œå¤„ç†å¤§æ•°æ®é›†çš„æ¡†æ¶ï¼ŒåŒ…æ‹¬åº•å±‚å­˜å‚¨æ¡†æ¶HDFSã€åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶MapReduceã€èµ„æºè°ƒåº¦ç³»ç»ŸYARNã€‚å¯ä»¥åˆ†å¸ƒå¼è¿è¡ŒPBçº§åˆ«æ•°æ®ã€‚Zookeeperæä¾›åè°ƒæœåŠ¡ï¼Œä¾‹å¦‚HBaseä¸­é›†ç¾¤åè°ƒé¢†å¯¼è€…é€‰ä¸¾ã€‚</li>
<li>HDFSï¼šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå°†æ–‡ä»¶æ•°æ®å­˜å‚¨åœ¨å¤šå°æœºå™¨ç»„æˆçš„é›†ç¾¤ä¸Šï¼Œæ¯ä»½æ•°æ®å…·æœ‰å¤šä¸ªå¤‡ä»½ï¼Œæ›´å¯é ã€‚</li>
<li>HDFSæ¶æ„ï¼šä¸»ä»ç»“æ„ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹namenodeï¼Œå¤šä¸ªä»èŠ‚ç‚¹datanodeã€‚1âƒ£ï¸namenodeè´Ÿè´£æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œç»´æŠ¤æ–‡ä»¶ç›®å½•ç»“æ„ã€ç®¡ç†æ–‡ä»¶å’Œblock(æ–‡ä»¶è¢«åˆ†ä¸ºå—)çš„å…³ç³»ä»¥åŠblockå’Œdatanodeçš„å…³ç³»ã€‚2âƒ£ï¸datanodeè´Ÿè´£å­˜å‚¨æ–‡ä»¶ï¼Œæ–‡ä»¶è¢«åˆ†æˆblockå­˜å‚¨ï¼ˆ128M&#x2F;256Mï¼‰ï¼Œåœ¨ä¸åŒdatanodeä¸Šæœ‰å¤šä¸ªå‰¯æœ¬ã€‚æ–‡ä»¶ç´¢å¼•ä¸å®é™…æ•°æ®åˆ†ç¦»ã€‚å¯¹ç¡¬ä»¶è¦æ±‚ä¸é«˜ï¼Œå¯å­˜å‚¨è¶…å¤§æ–‡ä»¶ï¼Œç›®æ ‡æ˜¯é«˜æ•°æ®ååé‡ã€‚</li>
<li>mapreduceï¼šåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œç”¨äºå¤§æ•°æ®é›†çš„å¹¶è¡Œè¿ç®—ï¼Œæµ·é‡è®¡ç®—ä»»åŠ¡åˆ†è€Œæ²»ä¹‹ã€‚è®¡ç®—ä»»åŠ¡åˆ†æ‘Šåˆ°å„ä¸ªè®¡ç®—èŠ‚ç‚¹å¹¶è¡Œè®¡ç®—ï¼Œæ±‡æ€»å¾—åˆ°æœ€ç»ˆç»“æœã€‚åˆ†å¸ƒå¼çš„ï¼ŒæŠ½è±¡äº†å¹¶è¡Œå¤„ç†çš„å¤æ‚åº¦ï¼Œå¼€å‘è€…åªéœ€è¦å®ç°Mapperå’ŒReducerã€‚</li>
<li>mapreduceæ ¸å¿ƒæ­¥éª¤ï¼šmapæ‹†è§£ï¼ˆå¤„ç†è¾“å…¥çš„é”®å€¼å¯¹ï¼Œæ‰§è¡Œå®šä¹‰çš„Mapå‡½æ•°ï¼Œç”Ÿæˆä¸­é—´é”®å€¼å¯¹ï¼‰ã€reduceç»„åˆï¼ˆæ±‡æ€»æ¯ä¸ªé”®çš„å€¼ï¼Œç”Ÿæˆæœ€ç»ˆç»“æœï¼‰ã€‚å…·ä½“å¯åˆ†ä¸ºï¼šSplitã€Mapã€Combinerã€Shuffleã€Reduceã€‚</li>
<li>splitï¼šå°†è¾“å…¥æ–‡ä»¶åˆ‡å‰²ä¸ºè‹¥å¹²å—ï¼Œæ¯ä¸€å—ç”±ä¸åŒèŠ‚ç‚¹å¤„ç†ã€‚å°†æ–‡ç« åˆ†ä¸ºä¸åŒå¥ã€‚</li>
<li>mapï¼šå°†æ¯ä¸ªèŠ‚ç‚¹çš„åŸå§‹æ•°æ®å¤„ç†ä¸ºä¸­é—´æ•°æ®ï¼Œè¾“å…¥è¾“å‡ºéƒ½æ˜¯kvã€‚</li>
<li>shuffleï¼šæ´—ç‰Œï¼Œå› ä¸ºsplitæ˜¯éšæœºçš„ï¼Œå¯¼è‡´ç›¸åŒkeyæ•°æ®å¤„ç†åœ¨ä¸åŒèŠ‚ç‚¹ã€‚shuffleå°†mapåçš„ç»“æœé‡æ–°åˆ†ç»„ï¼Œç›¸åŒkeyç»™åˆ°åŒä¸€reduceèŠ‚ç‚¹ã€‚</li>
<li>combinerï¼šå‡å°‘shuffleéœ€è¦çš„ç½‘ç»œIOæ“ä½œï¼Œå¯¹Mapåçš„ç»“æœæå‰åšä¸€æ¬¡å½’çº¦ï¼Œç›¸åŒkeyç»„æˆä¸€æ¡ã€‚</li>
<li>mapreduceçš„æ¶æ„ï¼šè®¡ç®—å‘æ•°æ®é æ‹¢ï¼Œä½¿ç”¨ä¸»ä»æ¶æ„ï¼Œä¸€ä¸ªJobTrackeræ¥æ”¶å®¢æˆ·ç«¯æäº¤çš„è®¡ç®—ä»»åŠ¡ï¼ŒæŠŠè®¡ç®—ä»»åŠ¡åˆ†ç»™TaskTrackeræ‰§è¡Œï¼Œè¿›è¡Œè°ƒåº¦ã€ç›‘æ§ã€‚å¤šä¸ªTaskTrackeræ‰§è¡Œåˆ†é…çš„è®¡ç®—ä»»åŠ¡ã€‚</li>
<li>JobTrackerï¼šè·Ÿè¸ªä»»åŠ¡çš„æ‰§è¡Œè¿›åº¦ã€èµ„æºä½¿ç”¨é‡ç­‰ä¿¡æ¯ï¼Œå°†è¿™äº›ä¿¡æ¯å‘Šè¯‰ä»»åŠ¡è°ƒåº¦å™¨TaskSchedulerã€‚</li>
<li>TaskTrackerï¼šä½¿ç”¨slotåˆ’åˆ†èŠ‚ç‚¹èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰ï¼Œå°†slotåˆ†é…ç»™MapTaskå’ŒReduceTaskã€‚2.0ç”¨YARNæ¥è¿›è¡Œèµ„æºè°ƒåº¦ã€‚</li>
<li>YARNï¼šè´Ÿè´£èµ„æºç®¡ç†ã€ä»»åŠ¡è°ƒåº¦çš„æ¡†æ¶ã€‚åŸºäºä¸»ä»æ¨¡å¼çš„åˆ†å¸ƒå¼æ¶æ„ã€‚ä¸€ä¸ªResourceManagerï¼Œå¤šä¸ªNodeManagerå…¶ä¸­åŒ…å«ApplicationMasterå’ŒContainerã€‚1âƒ£ï¸ResourceManageræ˜¯ä¸­æ§æ¨¡å—ï¼Œè´Ÿè´£æ•´ä¸ªé›†ç¾¤èµ„æºçš„ç®¡ç†å’Œåˆ†é…ã€‚2âƒ£ï¸NodeManageræ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºå’Œä»»åŠ¡ç®¡ç†å™¨ï¼Œå¯åŠ¨ç®¡ç†containerã€‚3âƒ£ï¸ApplicationMasteræ¯ä¸ªåº”ç”¨çš„è°ƒåº¦å’Œåè°ƒï¼Œå‘RMç”³è¯·èµ„æºï¼Œå‘Šè¯‰containeråšä»€ä¹ˆã€‚4âƒ£ï¸Containerèµ„æºå®¹å™¨ï¼Œç¨‹åºæ‰§è¡Œç¯å¢ƒï¼Œå°è£…ä»»åŠ¡æ‰€éœ€çš„èµ„æºï¼šcpuã€å†…å­˜ã€‚</li>
<li>è‡ªå·±ä½¿ç”¨mapreduceï¼šåœ¨odpså¤„ç†å¤§è§„æ¨¡æ•°æ®æ—¶ï¼Œmapä»»åŠ¡ç»„ç»‡æ•°æ®é”®å€¼å¯¹ï¼Œå®šä¹‰keyå’Œvalueï¼Œkeyä½åˆ†ç»„ä¾æ®adcodeï¼Œvalueä¸ºæ•°æ®ã€‚reduceä¸­æ•°æ®å·²ç»æŒ‰ç…§adcodeè¿›è¡Œäº†åˆ†ç»„ï¼Œåœ¨åˆ†ç»„ä¸­åšæ•°æ®å¤„ç†è®¡ç®—ã€‚</li>
<li>MaxComputeï¼šodpsï¼Œå¤§è§„æ¨¡æ•°æ®è®¡ç®—æœåŠ¡ï¼Œè´Ÿè´£å­˜å‚¨å’Œå¤„ç†å¤§é‡æ•°æ®ã€‚</li>
<li>DataWorksï¼šæ•°æ®å¼€å‘ä¸ç®¡ç†å¹³å°ï¼Œè´Ÿè´£æµç¨‹è®¾è®¡ã€è°ƒåº¦ã€ç®¡ç†ï¼Œæäº¤åˆ° MaxComputeä¸­æ‰§è¡Œè®¡ç®—ä»»åŠ¡ã€‚</li>
</ul>
<h2 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h2><ul>
<li>10Gæ–‡ä»¶1Gå†…å­˜æ€ä¹ˆæ’åºï¼šå¤–éƒ¨æ’åºï¼Œåˆ†éš”ä¸ºå°çš„æ–‡ä»¶å—ï¼Œå¯¹æ¯ä¸ªå°æ–‡ä»¶æ”¾å…¥å†…å­˜è¿›è¡Œæ’åºï¼Œæ’åºç»“æœå†™å›ç£ç›˜ã€‚å¯¹å¤šä¸ªæ’åºç»“æœè¿›è¡Œå½’å¹¶æ’åºï¼Œä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼‰ï¼Œå½’å¹¶è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡ä»å †ä¸­å–å‡ºçš„æœ€å°å…ƒç´ è¢«æŒ¨ä¸ªå†™å…¥æœ€ç»ˆçš„è¾“å‡ºæ–‡ä»¶ä¸­ã€‚</li>
<li>ç›´æ¥é€‰æ‹©æ’åºï¼šç¬¬ä¸€æ¬¡ä»arr[0åˆ°]arr[n-1]ä¸­é€‰å–æœ€å°å€¼ï¼Œä¸arr[0]äº¤æ¢ï¼Œç¬¬äºŒæ¬¡ä»arr[1]åˆ°arr[n-1]ä¸­é€‰å–æœ€å°å€¼ï¼Œä¸arr[1]äº¤æ¢ã€‚æ€»å…±n-1æ¬¡ã€‚</li>
<li>æ’å…¥æ’åºï¼šé€æ¸æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚</li>
<li>å †æ’åºï¼šé€šè¿‡æ„å»ºäºŒå‰å †ï¼Œä¸æ–­ç§»é™¤å †é¡¶å…ƒç´ å¹¶é‡å»ºå †ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—ã€‚</li>
<li>å½’å¹¶æ’åºï¼šå½’å¹¶ï¼ˆMergeï¼‰æ’åºæ³•æ˜¯å°†ä¸¤ä¸ªï¼ˆæˆ–ä¸¤ä¸ªä»¥ä¸Šï¼‰æœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæ–°çš„æœ‰åºè¡¨</li>
<li>å¸Œå°”æ’åºï¼šå¸Œå°”æ’åºåˆå«ç¼©å°å¢é‡æ’åºï¼ŒæŠŠæ‰€æœ‰çš„æ•°æ®æŒ‰ç…§ä¸‹æ ‡é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œåœ¨æ¯ä¸ªç»„å†…è¿›è¡Œæ’å…¥æ’åºã€‚æ’å®Œä¹‹åç¼©å°åˆ†ç»„æ•°ï¼Œå†æ’å…¥æ’åºã€‚ä¸æ–­ç¼©å°ç»„çš„é—´è·ã€‚ç›´åˆ°åªåˆ†ä¸€ä¸ºç»„ã€‚</li>
<li>æ’åºå¤æ‚åº¦ï¼šå¿«æ’æ—¶é—´Onlognç©ºé—´Olognä¸ç¨³å®šã€‚å†’æ³¡æ—¶é—´Onç©ºé—´O1ç¨³å®šã€‚</li>
</ul>
<h2 id="è®¡ç®—æœºåŸç†"><a href="#è®¡ç®—æœºåŸç†" class="headerlink" title="è®¡ç®—æœºåŸç†"></a>è®¡ç®—æœºåŸç†</h2><ul>
<li><p>ç½‘ç»œåˆ†å±‚ï¼šç‰©ç†å±‚ï¼ˆæ¯”ç‰¹æµçš„é€æ˜ä¼ è¾“ï¼Œä¸­ç»§å™¨ã€é›†çº¿å™¨ï¼‰ã€æ•°æ®é“¾è·¯å±‚ï¼ˆä¼ é€å¸§MACã€ç½‘å¡ã€ç½‘æ¡¥ã€äº¤æ¢æœºï¼‰ã€ç½‘ç»œå±‚ï¼ˆé€‰æ‹©åˆé€‚çš„è·¯ç”±ï¼ŒIPã€ICMPã€è·¯ç”±å™¨ã€é˜²ç«å¢™ï¼‰ã€ä¼ è¾“å±‚ï¼ˆTCPã€UDPï¼‰ã€åº”ç”¨å±‚ï¼ˆDNSã€HTTPã€SMTPã€FTPï¼‰</p>
</li>
<li><p>TCPçš„å®‰å…¨æ€§ï¼šä¸‰æ¬¡æ¡æ‰‹ï¼ˆå®¢æˆ·ç«¯SYNï¼ŒæœåŠ¡ç«¯ACKSYNï¼Œå®¢æˆ·ç«¯ACKï¼‰ã€å››æ¬¡æŒ¥æ‰‹ï¼ˆå®¢æˆ·ç«¯FINã€æœåŠ¡ç«¯ACKã€æœåŠ¡ç«¯ä¼ è¾“å®ŒFINã€å®¢æˆ·ç«¯ACKï¼‰</p>
</li>
<li><p>tcpæµé‡æ§åˆ¶ï¼šé¿å…å‘é€æ–¹å‘é€å¾—å¤ªå¿«æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†ï¼Œæ»‘åŠ¨çª—å£çš„æ–¹å¼ï¼Œæ¥æ”¶ç«¯å‘Šè¯‰å®¢æˆ·ç«¯ç¡®è®¤åºåˆ—å·å’Œè¿˜èƒ½æ¥å—å¤šå°‘æ•°æ®ã€‚å‘é€ç«¯è°ƒæ•´æ»‘åŠ¨çª—å£ï¼ˆå·²å‘é€æœªç¡®è®¤ã€ä¸ºå‘é€å¯æ¥å—ï¼‰ã€‚æ›´æ–°çª—å£ä¿¡æ¯å¯èƒ½ä¸¢å¤±ï¼Œè®¾ç½®0çª—å£æ¢æµ‹æŠ¥æ–‡ã€‚</p>
</li>
<li><p>tcpæ‹¥å¡æ§åˆ¶ï¼šé˜²æ­¢è¿‡å¤šæ•°æ®æ³¨å…¥ç½‘ç»œã€‚æ…¢å¼€å§‹ï¼ˆåŠ å€è¾¾åˆ°æ…¢å¼€å§‹é—¨é™ï¼‰ã€‚æ‹¥å¡é¿å…ï¼ˆæ‹¥å¡çª—å£+1ï¼‰ï¼Œå¦‚æœæ‹¥å¡ï¼Œé—¨é™å‡åŠï¼Œçª—å£å˜1ï¼Œæ‰§è¡Œæ…¢å¼€å§‹ã€‚å¿«é‡ä¼ ï¼šæ¥æ”¶æ–¹æ”¶åˆ°å¤±åºæŠ¥æ–‡å‘å‡ºé‡å¤ACKï¼Œå‘é€æ–¹æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤ï¼Œå°±é‡ä¼ ã€‚å¿«æ¢å¤ï¼šå¤±åºæŠ¥æ–‡åï¼Œæ…¢å¼€å§‹é—¨é™å‡åŠï¼Œæ‹¥å¡çª—å£è®¾ä¸ºå‡åŠåçš„é—¨é™ï¼Œæ‰§è¡Œæ‹¥å¡é¿å…ã€‚</p>
</li>
<li><p>tcpä¸æä¾›åŠ å¯†åŠŸèƒ½ï¼Œéœ€è¦åº”ç”¨å±‚çš„TSL&#x2F;SSLã€‚ä¸¤å°æœåŠ¡å™¨é—´å¯ä»¥å»ºç«‹å¤šä¸ªtcpè¿æ¥ï¼ˆsocket&#x3D;ip+ç«¯å£å·ä¸åŒå³å¯ï¼‰</p>
</li>
<li><p>è¾“å…¥urlå‘ç”Ÿä»€ä¹ˆï¼š1.DNSè§£æè·å–ipï¼Œæµè§ˆå™¨ç¼“å­˜-è·¯ç”±å™¨ç¼“å­˜-DNSç¼“å­˜ã€‚2.æ ¹æ®ipå»ºç«‹TCPè¿æ¥ã€‚3.æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€httpè¯·æ±‚ã€‚4.æœåŠ¡å™¨å“åº”httpè¯·æ±‚ã€‚5.æµè§ˆå™¨è¿›è¡Œæ¸²æŸ“ã€‚</p>
</li>
<li><p>tcp&#x2F;ipç†è§£ï¼šIPåè®®æ˜¯ç½‘ç»œå±‚çš„åè®®ï¼Œä½¿ç”¨åˆ†ç»„äº¤æ¢æŠ€æœ¯æ¥ä¼ è¾“æ•°æ®ï¼Œé€šè¿‡è·¯ç”±å™¨è¿›è¡Œè½¬å‘ï¼Œæœ€ç»ˆåˆ°è¾¾ç›®çš„åœ°ã€‚æ— è¿æ¥æ€§ã€æ— çŠ¶æ€æ€§ã€ä¸ä¿è¯å¯é ä¼ è¾“ã€‚TCPæ˜¯ä¼ è¾“å±‚åè®®ï¼Œä¸»è¦è´Ÿè´£åœ¨IPåè®®æä¾›çš„åŸºç¡€ä¸Šå®ç°å¯é çš„ã€æœ‰åºçš„ã€æœ‰è¿æ¥çš„å’Œæ— å·®é”™çš„æ•°æ®ä¼ è¾“ã€‚</p>
</li>
<li><p>cookieã€sessionã€tokenï¼š1âƒ£ï¸cookieç”¨æ¥ä¿å­˜ä¸€äº›ä¿¡æ¯åœ¨å®¢æˆ·ç«¯æ¯”å¦‚è®°ä½å¯†ç å’Œæ¨èæ˜¾ç¤ºã€‚2âƒ£ï¸sessionç”¨æ¥æ ‡è¯†ä¸€æ¬¡ä¼šè¯ï¼Œè®°å½•ç”¨æˆ·çŠ¶æ€ï¼Œåœ¨ä¸€æ¬¡ä¼šè¯æœŸé—´å…±äº«æ•°æ®ã€‚ç”¨æˆ·é¦–æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶åˆ›å»ºä¸€ä¸ªsessionï¼Œsession idè®¾ç½®ä¸ºcookieä¿å­˜åœ¨æµè§ˆå™¨ã€‚3âƒ£ï¸tokenç”¨æ¥åšå¯†é’¥å¿«æ·ç™»å½•çš„ã€‚</p>
</li>
<li><p>cookieã€sessionã€tokenï¼šç”Ÿæˆä½ç½®éƒ½åœ¨æœåŠ¡å™¨ï¼Œcookieå’Œtokenä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œsessionä¿å­˜åœ¨æœåŠ¡å™¨ã€‚é‰´æƒè¿‡ç¨‹ï¼šè¯·æ±‚æºå¸¦cookieä¸æœåŠ¡å™¨è®°å½•cookieå¯¹æ¯”ç¡®è®¤ç”¨æˆ·çŠ¶æ€ã€‚sessionç”¨è¯·æ±‚ä¸­session idæå–ï¼Œæ¢å¤ç”¨æˆ·çŠ¶æ€ã€‚è¯·æ±‚æºå¸¦tokenä¸æœåŠ¡å™¨é€šè¿‡è¯·æ±‚ä¿¡æ¯ç”Ÿæˆtokenå¯¹æ¯”ã€‚</p>
</li>
<li><p>httpçŠ¶æ€ç ï¼š301æ°¸ä¹…é‡å®šå‘ã€‚302ä¸´æ—¶é‡å®šå‘ã€‚400æœåŠ¡ç«¯æ— æ³•ç†è§£å®¢æˆ·ç«¯è¯·æ±‚ã€‚401æœªæˆæƒï¼Œéœ€è¦ç”¨æˆ·èº«ä»½è®¤è¯ã€‚403ç¦æ­¢è®¿é—®ï¼ŒæœåŠ¡ç«¯æ‹’ç»ã€‚404æœªæ‰¾åˆ°è¯·æ±‚çš„èµ„æºã€‚500æœåŠ¡ç«¯å†…éƒ¨é”™è¯¯ã€‚</p>
</li>
<li><p>DNSåŸºäºä»€ä¹ˆåè®®ï¼šDNSåŸŸåè§£æç³»ç»Ÿï¼Œåº”ç”¨å±‚ï¼Œç”¨äºå°†äººç±»å¯è¯»çš„ä¸»æœºåè½¬æ¢ä¸ºæœºå™¨å¯è¯»çš„IPåœ°å€ã€‚ä¸»è¦åŸºäºUDPè¿›è¡Œå·¥ä½œï¼Œä½†å½“å“åº”æ•°æ®å¤§å°è¶…è¿‡æŠ¥æ–‡é™åˆ¶ï¼Œæˆ–è€…éœ€è¦æ›´å¯é ä¼ è¾“æ—¶ï¼Œç”¨TCPã€‚</p>
</li>
<li><p>DNSè¿‡ç¨‹ï¼šè§£æåŸŸåæ—¶ï¼Œé¦–å…ˆæ£€æŸ¥æœ¬åœ°DNSç¼“å­˜ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œè¯·æ±‚å°†å‘é€è‡³é…ç½®çš„é€’å½’DNSæœåŠ¡å™¨ï¼Œé€’å½’DNSæœåŠ¡å™¨ä¼šè¿›è¡Œä¸€ç³»åˆ—è¿­ä»£æŸ¥è¯¢ï¼Œä»æ ¹æœåŠ¡å™¨å¼€å§‹ï¼Œé€çº§å‘ä¸‹è¯¢é—®ç›´åˆ°æ‰¾åˆ°è¯¥åŸŸåçš„æƒå¨DNSæœåŠ¡å™¨ï¼Œè·å–å¯¹åº”IPåœ°å€ã€‚æ²¿ç€æŸ¥è¯¢é“¾è·¯è¿”å›ç»™ç”¨æˆ·çš„è®¾å¤‡ã€‚</p>
</li>
</ul>
<h2 id="è¾¹ç¼˜è®¡ç®—"><a href="#è¾¹ç¼˜è®¡ç®—" class="headerlink" title="è¾¹ç¼˜è®¡ç®—"></a>è¾¹ç¼˜è®¡ç®—</h2><ul>
<li>è¾¹ç¼˜è®¡ç®—ï¼šä¸€ç§åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼Œåœ¨é è¿‘æ•°æ®ç”Ÿæˆçš„ä½ç½®ï¼ˆè¾¹ç¼˜ï¼‰å¤„ç†æ•°æ®çš„æ–¹æ³•ã€‚å°†è®¡ç®—èƒ½åŠ›ä¸‹æ”¾åˆ°ç½‘ç»œçš„è¾¹ç¼˜ï¼Œè¾¹ç¼˜ç½‘ç»œåŸºæœ¬ä¸Šç”±ç»ˆç«¯è®¾å¤‡ã€è¾¹ç¼˜è®¾å¤‡ã€è¾¹ç¼˜æœåŠ¡å™¨ç­‰æ„æˆã€‚ç‰¹ç‚¹ï¼šä½å»¶è¿Ÿã€èŠ‚çœå¸¦å®½ã€æé«˜éšç§å’Œå®‰å…¨æ€§ã€å®æ—¶æ•°æ®å¤„ç†ã€‚åº”ç”¨åœºæ™¯ï¼šç‰©è”ç½‘ï¼ˆIoTï¼‰ã€æ™ºæ…§åŸå¸‚ã€æ— äººè¶…å¸‚ã€‚</li>
<li>è¾¹ç¼˜è®¡ç®—å’Œäº‘è®¡ç®—ï¼šè¾¹ç¼˜è®¡ç®—é‡‡ç”¨åˆ†å¸ƒå¼è®¡ç®—æ¶æ„ï¼Œå°†è¿ç®—åˆ†æ•£åœ¨é è¿‘æ•°æ®æºçš„è¿‘ç«¯è®¾å¤‡å¤„ç†ï¼Œåˆ†æ‹…äº‘å¹³å°çš„å·¥ä½œé‡ï¼Œä¸éœ€è¦æŠŠæ•°æ®å›ä¼ äº‘ç«¯å¤„ç†ï¼Œå®æ—¶æ€§æ›´å¥½ã€æ•ˆç‡æ›´é«˜ã€å»¶è¿Ÿæœ€çŸ­ï¼Œæ²¡æœ‰ç½‘ç»œä¹Ÿä¸å¦¨ç¢ã€‚</li>
<li>k8sï¼šKubernetesæ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’ç³»ç»Ÿï¼Œç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚ç”±googleè®¾è®¡ã€‚</li>
<li>dockerï¼šå®¹å™¨åŒ–æŠ€æœ¯å…è®¸å°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹æ‰“åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨ä»»ä½•ç¯å¢ƒä¸­ä¸€è‡´åœ°è¿è¡Œã€‚</li>
</ul>
]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜ä¹‹å¤§æ•°æ®</title>
    <url>/2025/07/24/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E8%83%8C%E8%BF%87%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B%E5%A4%A7%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<ul>
<li>è°·æ­Œçš„â€œä¸‰æ¶é©¬è½¦â€ï¼šè°·æ­Œæ–‡ä»¶ç³»ç»ŸGFSï¼ˆ2003ï¼‰ï¼ŒMapReduceï¼ˆ2004ï¼‰å’ŒBig Tableï¼ˆ2006ï¼‰ï¼Œå¥ å®šäº†å¤§æ•°æ®æ—¶ä»£çš„åŸºç¡€ã€‚</li>
<li>ç¦»çº¿è®¡ç®—ï¼šHadoopï¼ˆMapreduceï¼‰ã€Hiveã€Spark</li>
<li>2006å¹´å®ç°äº†ç”±HDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå’ŒMapReduceè®¡ç®—æ¡†æ¶ç»„æˆçš„Hadoopï¼Œæˆä¸ºäº†ç¦»çº¿æ•°æ®å¤„ç†çš„æ ¸å¿ƒã€‚</li>
<li>HDFSï¼šHadoopçš„å­˜å‚¨éƒ¨åˆ†ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå°†æ•°æ®æ–‡ä»¶åˆ†å—å­˜å‚¨åœ¨é›†ç¾¤çš„èŠ‚ç‚¹ä¸Šã€‚HDFSå¯ä»¥å®ç°åœ¨æ•´ä¸ªé›†ç¾¤ä¸Šé«˜æ•ˆåœ°å­˜å‚¨å’Œè®¿é—®æ•°æ®ã€‚</li>
<li>MapReduceï¼šå¤§æ•°æ®å¤„ç†æŠ€æœ¯ï¼Œå±äºç¦»çº¿è®¡ç®—çš„ä¸€ç§ã€‚å°†æ•°æ®å¤„ç†ä»»åŠ¡åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼šMapé˜¶æ®µï¼Œæ•°æ®è¢«åˆ‡åˆ†æˆå°å—ï¼Œå¹¶åœ¨è®¡ç®—æœºé›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå¹¶è¡Œå¤„ç†ã€‚Reduceé˜¶æ®µï¼Œå°†Mapé˜¶æ®µçš„ç»“æœè¿›è¡Œåˆå¹¶å’Œæ±‡æ€»ï¼Œç”Ÿæˆæœ€ç»ˆçš„è¾“å‡ºç»“æœã€‚</li>
<li>2007å¹´Hiveï¼šèµ·æºäºFaceBookï¼Œæ˜¯åŸºäºHadoopçš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œç”¨æ¥è¿›è¡Œæ•°æ®æå–ã€è½¬åŒ–ã€åŠ è½½ETLï¼Œä¸€ç§å¯ä»¥å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†æå­˜å‚¨åœ¨Hadoopä¸­çš„å¤§è§„æ¨¡æ•°æ®çš„æœºåˆ¶ã€‚èƒ½å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›SQLæŸ¥è¯¢åŠŸèƒ½ï¼Œèƒ½å°†SQLè¯­å¥è½¬å˜æˆMapReduceä»»åŠ¡æ¥æ‰§è¡Œã€‚</li>
<li>2010å¹´Sparkï¼šHadoopç¼ºç‚¹ï¼šMapReduceæ¡†æ¶åœ¨æ¯ä¸ªè®¡ç®—é˜¶æ®µéƒ½éœ€è¿›è¡Œç£ç›˜è¯»å†™å¯¼è‡´è¾ƒé«˜çš„ç£ç›˜IOå¼€é”€ã€å¯¹äºè¿­ä»£è®¡ç®—æ•ˆç‡ä½ä¸‹ã€‚Sparkæ˜¯åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡å¼€æºçš„ç±»Hadoop MapReduceçš„é€šç”¨å¹¶è¡Œæ¡†æ¶ï¼Œä¸MapReduceä¸åŒï¼šä¸­é—´è¾“å‡ºç»“æœå¯ä»¥ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€Œä¸å†éœ€è¦è¯»å†™HDFSï¼Œé¿å…å¤§éƒ¨åˆ†ç£ç›˜IOå¼€é”€ï¼Œæé«˜è®¡ç®—æ€§èƒ½ã€‚åŒæ—¶Sparkèƒ½æ›´å¥½çš„é€‚ç”¨äºæ•°æ®æŒ–æ˜ä¸æœºå™¨å­¦ä¹ ç­‰éœ€è¦è¿­ä»£çš„MapReduceçš„ç®—æ³•ã€‚Sparké€šè¿‡ä½¿ç”¨RDDï¼ˆå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼‰ã€DAGåˆ‡åˆ†çš„å¤šé˜¶æ®µè®¡ç®—è¿‡ç¨‹æ¥å®ç°é«˜æ•ˆçš„æ•°æ®å¹¶è¡Œå¤„ç†ï¼Œæ”¯æŒå¤§è§„æ¨¡æ•°æ®é›†çš„åˆ†å¸ƒå¼è®¡ç®—å’Œåˆ†æä»»åŠ¡ï¼Œæ˜¯ç¦»çº¿è®¡ç®—ï¼ˆæ‰¹å¤„ç†ï¼‰é¢†åŸŸçš„ä¸»æµæŠ€æœ¯æ ˆã€‚</li>
<li>Sparkæ‹¥æœ‰ä¸€ä¸ªä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿï¼šSpark SQLï¼ˆç”¨äºSQLæŸ¥è¯¢ï¼‰ã€Spark Streamingï¼ˆç”¨äºå®æ—¶æµå¤„ç†ï¼‰ã€MLlibï¼ˆç”¨äºæœºå™¨å­¦ä¹ ï¼‰ã€GraphXï¼ˆç”¨äºå›¾è®¡ç®—ï¼‰ç­‰ã€‚æ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”çµæ´»çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼Œå®ƒé€šè¿‡å†…å­˜è®¡ç®—å’Œç»Ÿä¸€çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä¸ºå¤§è§„æ¨¡æ•°æ®å¤„ç†æä¾›äº†é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œé€‚ç”¨äºå„ç§æ•°æ®å¤„ç†ä»»åŠ¡å’Œåº”ç”¨åœºæ™¯ã€‚</li>
<li>å®æ—¶è®¡ç®—ï¼šStormã€Spark Streamingã€Flink</li>
<li>å®æ—¶è®¡ç®—ï¼šåœ¨æ—©æœŸï¼ŒåŸºäºHadoopçš„æ•°æ®å¤„ç†ä¸»è¦é‡‡ç”¨æ‰¹å¤„ç†æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç¦»çº¿è®¡ç®—çš„æ–¹å¼ï¼šæ•°æ®ä¼šå…ˆå­˜å‚¨åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç„¶åé€šè¿‡æ‰¹å¤„ç†ä½œä¸šè¿›è¡Œå¤„ç†å’Œåˆ†æï¼Œæ•°æ®å¤„ç†çš„å»¶è¿Ÿè¾ƒé«˜ï¼Œéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½è·å–ç»“æœã€‚</li>
<li>ç¦»çº¿&#x3D;æ‰¹å¤„ç†ï¼Œå®æ—¶&#x3D;æµå¼å¤„ç†ã€‚æµå¼å¤„ç†æŠ€æœ¯å°†æ•°æ®åˆ†æˆå°çš„æ‰¹æ¬¡è¿›è¡Œå¤„ç†ï¼Œåœ¨æ•°æ®åˆ°è¾¾æ—¶ç«‹å³è¿›è¡Œå¤„ç†å’Œåˆ†æï¼Œæµå¼å¤„ç†æŠ€æœ¯åˆåˆ†ä¸ºä¸¤ç§ï¼šåŸç”Ÿæµã€å¾®æ‰¹æ‹Ÿæµï¼ˆSpark Streamingï¼‰</li>
<li>Stormæ˜¯ä¸€ä¸ªå…è´¹å¼€æºã€åˆ†å¸ƒå¼ã€é«˜å®¹é”™çš„å®æ—¶è®¡ç®—ç³»ç»Ÿã€‚Stormæœ€æ—©äº2011å¹´è¯ç”ŸäºTwitterã€‚æ—©æœŸStormç”¨äºå®æ—¶è®¡ç®—ï¼ŒHadoopç”¨äºç¦»çº¿è®¡ç®—ã€‚å·²ä¸æ¨èä½¿ç”¨ã€‚åœ¨Stormä¸­ï¼Œå…ˆè¦è®¾è®¡ä¸€ä¸ªç”¨äºå®æ—¶è®¡ç®—çš„å›¾çŠ¶æ‹“æ‰‘ï¼ˆTopologyï¼‰ï¼Œä¸€ä¸ªTopologyæ˜¯ç”±å¤šä¸ªSpoutï¼ˆæ•°æ®è¾“å…¥å¤„ç†æ¨¡å—ï¼‰å’ŒBoltï¼ˆè¾“å‡ºå¤„ç†æ¨¡å—ï¼‰é€šè¿‡Streamè¿æ¥èµ·æ¥çš„æœ‰å‘æ— ç¯å›¾ã€‚</li>
<li>Spark Streamingï¼š2013å¹´Spark 2.0æ¨å‡ºäº†Spark Streamingã€‚ä½†ç”±äºä¸æ˜¯åŸç”Ÿæµå¤„ç†æŠ€æœ¯æ ˆï¼Œè®¤ä¸ºæµæ˜¯æ‰¹çš„ç‰¹ä¾‹ï¼Œå°†è¾“å…¥æ•°æ®åˆ‡åˆ†æˆä¸€ä¸ªä¸ªå°çš„åˆ‡ç‰‡ï¼Œå­˜åœ¨æ—¶å»¶ï¼Œä¸”é«˜çº§åŠŸèƒ½ä¸å¦‚Flinkï¼Œå·²ä¸æ˜¯ä¸»æµæŠ€æœ¯æ ˆï¼Œä¸æ¨èä½¿ç”¨ã€‚</li>
<li>Flinkæœ€åˆæ˜¯ç”±å¾·å›½æŸæ—å·¥ä¸šå¤§å­¦å¼€å‘ã€‚Apache Flinkæ˜¯åˆ†å¸ƒå¼æµå¼å¤„ç†å¼•æ“ï¼Œç”¨äºæ— ç•Œå’Œæœ‰ç•Œæ•°æ®æµçš„æœ‰çŠ¶æ€è®¡ç®—ã€‚Flinkåˆ›é€ æ€§åœ°ç»Ÿä¸€äº†æµå¤„ç†å’Œæ‰¹å¤„ç†ï¼Œä½œä¸ºæµå¤„ç†çœ‹å¾…æ—¶è¾“å…¥æ•°æ®æµæ˜¯æ— ç•Œçš„ï¼Œè€Œæ‰¹å¤„ç†è¢«ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„æµå¤„ç†ï¼Œåªæ˜¯å®ƒçš„è¾“å…¥æ•°æ®æµè¢«å®šä¹‰ä¸ºæœ‰ç•Œçš„ã€‚</li>
<li>åˆ†å¸ƒå¼å­˜å‚¨HBaseï¼šä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€é¢å‘åˆ—çš„å¼€æºæ•°æ®åº“ï¼Œå»ºç«‹åœ¨ HDFS ä¹‹ä¸Šã€‚HBase çš„è®¡ç®—å’Œå­˜å‚¨èƒ½åŠ›å–å†³äº Hadoop é›†ç¾¤ã€‚å®ƒä»‹äºNoSqlå’ŒRDBMSä¹‹é—´ï¼Œä»…èƒ½é€šè¿‡ä¸»é”®(row key)å’Œä¸»é”®çš„rangeæ¥æ£€ç´¢æ•°æ®ï¼Œä»…æ”¯æŒå•è¡Œäº‹åŠ¡ã€‚</li>
<li>OLAP å’Œ OLTPï¼šOLTPï¼ˆè”æœºäº‹åŠ¡å¤„ç†ï¼‰å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹ã€‚OLAPï¼ˆè”æœºåˆ†æå¤„ç†ï¼‰å¯¹æ•°æ®çš„æŸ¥è¯¢ã€‚</li>
<li>OLAPçš„åˆ†ç±»ï¼šROLAPï¼ˆå…³ç³»å‹è”æœºåˆ†æå¤„ç†ï¼‰ã€MOLAPï¼ˆå¤šç»´è”æœºåˆ†æå¤„ç†ï¼‰ã€HOLAPï¼ˆæ··åˆå‹OLAPï¼‰ã€‚ROLAPï¼šä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ã€MPPåˆ†å¸ƒå¼æ•°æ®åº“ä»¥åŠHadoopçš„Sparkã€‚å®æ—¶æ ¹æ®ç”¨æˆ·æå‡ºçš„éœ€æ±‚å¯¹æ•°æ®è¿›è¡Œè®¡ç®—åè¿”å›ç»™ç”¨æˆ·ã€‚ä½¿ç”¨çµæ´»ï¼Œå¯ä»¥éšæ„é€‰æ‹©ç»´åº¦ç»„åˆè¿›è¡Œå®æ—¶è®¡ç®—ã€‚æœ‰æ€§èƒ½é—®é¢˜ã€‚MOLAPï¼šå°†å®¢æˆ·çš„éœ€æ±‚è®¡ç®—å¥½ä»¥ç»“æœçš„å½¢å¼å­˜ä¸‹æ¥ï¼Œæå‡ºéœ€æ±‚åï¼Œæ‰¾åˆ°å¯¹åº”çš„ç»“æœè¿”å›å³å¯ã€‚éœ€è¦çš„ç£ç›˜å­˜å‚¨ç©ºé—´å¤§ã€‚</li>
<li>MPPï¼ˆMassive Parallel Processing,æµ·é‡å¹¶è¡Œå¤„ç†ï¼‰ï¼šæ˜¯ä¸€ç§åŸºäºå…±äº«ç£ç›˜çš„å¹¶è¡Œæ•°æ®åº“å¤„ç†æ¶æ„ï¼Œé€šè¿‡å°†æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œä»è€Œå®ç°å¯¹å¤§è§„æ¨¡æ•°æ®çš„å¿«é€Ÿåˆ†æå’ŒæŸ¥è¯¢ã€‚åªè´Ÿè´£è®¡ç®—ï¼Œä¸è´Ÿè´£å­˜å‚¨ã€‚</li>
<li>MapReduceå’ŒMPPæ¶æ„ï¼šéƒ½æ˜¯åˆ†å¸ƒå¼å¹¶è¡Œå¤„ç†ï¼Œå°†ä»»åŠ¡å¹¶è¡Œçš„åˆ†æ•£åˆ°å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè®¡ç®—å®Œæˆåï¼Œå°†å„è‡ªéƒ¨åˆ†çš„ç»“æœæ±‡æ€»åˆ°ä¸€èµ·ã€‚ä¸åŒçš„æ˜¯ï¼ŒMapReduceä»»åŠ¡çš„tasksä¼šåŠ¨æ€çš„åˆ†é…åœ¨ç©ºé—²çš„Executorä¸Šï¼Œæ‰§è¡Œæ…¢çš„Executorä¼šåˆ†é…åˆ°æ›´å°‘çš„taskã€‚ç¼ºç‚¹æ˜¯MapReduceå°†ä¸€ä¸ªä»»åŠ¡åˆ†è§£æˆæœ‰ä¾èµ–å…³ç³»çš„tasksï¼ˆDAGï¼‰ï¼Œtaskæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå› æ­¤å¿…é¡»é€šè¿‡å†™å…¥ä¸­é—´æ•°æ®å…±äº«å†…å­˜æ¥è§£å†³æ•°æ®çš„ä¾èµ–ï¼Œæ€§èƒ½æœ‰æ‰€æŸè€—ã€‚MPPæ¯ä¸ªå¤„ç†æ•°æ®çš„taskè¢«ç»‘å®šåœ¨æŒæœ‰è¯¥æ•°æ®åˆ‡ç‰‡çš„æŒ‡å®šExecutorä¸Šï¼Œå•ä¸€çš„Executoråªå¤„ç†å•ä¸€çš„taskï¼Œä¸éœ€è¦å°†ä¸­é—´æ•°æ®å†™å…¥ç£ç›˜ï¼Œç›´æ¥å°†æ•°æ®Streamåˆ°ä¸‹ä¸€ä¸ªæ‰§è¡Œé˜¶æ®µï¼Œæ€§èƒ½å¥½ã€‚ç¼ºç‚¹æ˜¯å¦‚æœæŸä¸ªExecutoræ‰§è¡Œè¿‡æ…¢æˆ–è€…æ•…éšœï¼Œæ•´ä¸ªé›†ç¾¤çš„æ€§èƒ½å°±ä¼šå—é™äºè¿™ä¸ªå¼‚å¸¸èŠ‚ç‚¹ï¼Œæ‰€ä»¥MPPæ¶æ„çš„é›†ç¾¤èŠ‚ç‚¹ä¸å®œè¿‡å¤šã€‚</li>
<li>Lambdaæ¶æ„ï¼šä¸€ç§ç”¨äºæ•°æ®å¤„ç†çš„æ¶æ„è®¾è®¡æ¨¡å¼ï¼Œç»“åˆäº†å®æ—¶è®¡ç®—å’Œæ‰¹å¤„ç†ä¸¤ç§æ–¹æ³•ï¼Œä»¥æ»¡è¶³ä¸åŒçš„æ•°æ®åˆ†æéœ€æ±‚ã€‚Lç”±ä¸‰ä¸ªå±‚çº§ç»„æˆï¼šæ‰¹å¤„ç†å±‚ã€é€Ÿåº¦å±‚å’ŒæœåŠ¡å±‚ã€‚æ‰¹å¤„ç†å±‚è´Ÿè´£ç¦»çº¿å¤„ç†å¤§é‡æ•°æ®ï¼Œé€šå¸¸é€šè¿‡æ‰¹å¤„ç†ç³»ç»Ÿï¼ˆå¦‚Hadoopã€Sparkç­‰ï¼‰å¤„ç†æ•°æ®ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨æ•°æ®ä»“åº“ä¸­ã€‚é€Ÿåº¦å±‚ç”¨äºå¤„ç†å®æ—¶æ•°æ®æµï¼Œé€šå¸¸é‡‡ç”¨æµå¼å¤„ç†æŠ€æœ¯ï¼ˆå¦‚Stormã€Spark Streamingç­‰ï¼‰ï¼Œä»¥å¿«é€Ÿå¤„ç†æ•°æ®å¹¶äº§ç”Ÿå®æ—¶ç»“æœã€‚æœåŠ¡å±‚è´Ÿè´£å°†æ‰¹å¤„ç†å±‚å’Œé€Ÿåº¦å±‚çš„ç»“æœæ•´åˆï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›ç»Ÿä¸€çš„æ•°æ®æŸ¥è¯¢å’Œåˆ†ææ¥å£ã€‚ä¼˜ç‚¹ï¼šå¯æ‰©å±•æ€§å¼ºã€èƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡æ•°æ®ã€æ»¡è¶³å®æ—¶å’Œç¦»çº¿æ•°æ®å¤„ç†éœ€æ±‚ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜ä¹‹ç®—æ³•</title>
    <url>/2025/08/10/myblog/%E6%89%BE%E5%B7%A5%E4%BD%9C/%E9%82%A3%E4%BA%9B%E5%B9%B4%E8%83%8C%E8%BF%87%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="MinHashä¸MinHashLSH"><a href="#MinHashä¸MinHashLSH" class="headerlink" title="MinHashä¸MinHashLSH"></a>MinHashä¸MinHashLSH</h2><p>MinHash æ˜¯ä¸€ç§ç”¨äºå¿«é€Ÿä¼°è®¡ä¸¤ä¸ªé›†åˆï¼ˆå¦‚æ–‡æ¡£ã€ç½‘é¡µç­‰ï¼‰ä¹‹é—´ç›¸ä¼¼åº¦çš„ç®—æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é«˜ç»´æ•°æ®æˆ–æµ·é‡æ•°æ®æ—¶éå¸¸é«˜æ•ˆã€‚ä¸»è¦ç”¨äºè®¡ç®— Jaccard ç›¸ä¼¼åº¦ï¼ˆé›†åˆäº¤é›†ä¸å¹¶é›†çš„æ¯”å€¼ï¼‰ã€‚Jaccard ç›¸ä¼¼åº¦éœ€è¦éå†æ•´ä¸ªé›†åˆï¼Œè€—è´¹æ—¶é—´å’Œå†…å­˜ã€‚</p>
<p>MinHash æä¾›äº†ä¸€ç§è¿‘ä¼¼è®¡ç®—çš„æ–¹æ³•ï¼Œé€šè¿‡æ„é€  â€œç®€åŒ–ç­¾åâ€ æ¥é«˜æ•ˆä¼°ç®—é›†åˆä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œè€Œæ— éœ€ç›´æ¥æ“ä½œæ•´ä¸ªé›†åˆã€‚ </p>
<p>è®¡ç®—æ­¥éª¤ï¼šè¾“å…¥åˆ†è¯é›†åˆï¼Œå®šä¹‰nä¸ªå“ˆå¸Œå‡½æ•°ï¼Œé›†åˆä¸­æ¯ä¸ªå…ƒç´ ä½¿ç”¨å“ˆå¸Œå‡½æ•°è®¡ç®—ï¼Œå¾—åˆ°å¯¹åº”æœ€å°å€¼ï¼Œç”Ÿæˆnå¤§å°çš„ç­¾åçŸ©é˜µï¼Œæ¯”è¾ƒç­¾åä¸­ç›¸åŒå€¼çš„å æ¯”ï¼Œå¾—åˆ°è¿‘ä¼¼çš„Jaccardç›¸ä¼¼åº¦ã€‚ ç‰¹ç‚¹ï¼šminhashç­¾åå›ºå®šå¤§å°ï¼Œé™ä½è®¡ç®—å¤æ‚åº¦ï¼›è¿‘ä¼¼æ–¹æ³•å…è®¸è¯¯å·®ï¼›é€‚ç”¨äºå¤§è§„æ¨¡æ–‡æ¡£å»é‡ã€ç›¸ä¼¼æ€§æŸ¥æ‰¾ç­‰ã€‚ </p>
<p>MinhashLSHï¼šå±€éƒ¨æ•æ„Ÿå“ˆå¸Œï¼Œåœ¨MinHashçš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œé€šè¿‡åˆ†æ¡¶çš„æ–¹å¼å°†é«˜ç›¸ä¼¼åº¦çš„æ•°æ®å¿«é€Ÿå½’ç±»åˆ°ç›¸åŒçš„æ¡¶ä¸­ï¼Œå‡å°‘ä¸å¿…è¦çš„ç›¸ä¼¼æ€§è®¡ç®—ã€‚ </p>
<p><strong>å®æˆ˜æ“ä½œ</strong>ï¼šé¦–å…ˆå°†æ–‡æœ¬ä½¿ç”¨é›†åˆæˆ–è€…å‘é‡æ¥è¡¨ç¤ºï¼Œå°†æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œä½†æ˜¯å•çº¯åˆ†è¯å˜ä¸ºé›†åˆæ²¡æœ‰è€ƒè™‘è¯é—´é¡ºåºé—®é¢˜ï¼Œæ‰€ä»¥åˆ†è¯ä¹‹åå†ç”¨ngramæ¥è€ƒè™‘é¡ºåºã€‚ç„¶åä½¿ç”¨jaccardç³»æ•°è¡¨ç¤ºä¸¤ä¸ªé›†åˆçš„ç›¸ä¼¼æ€§ï¼Œäº¤é›†&#x2F;å¹¶é›†ã€‚ è¿™æ ·æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šæ–‡æœ¬æ•°é‡éå¸¸å¤§ã€æ–‡æœ¬æœ¬èº«ç¯‡å¹…éå¸¸é•¿ã€‚æ‰€ä»¥æœ‰ä¸¤ä¸ªä¼˜åŒ–æ–¹å‘ï¼šå‡å°‘é›†åˆçš„é•¿åº¦ã€å‡å°‘è®¡ç®—ç›¸ä¼¼åº¦çš„æ¬¡æ•°ã€‚ </p>
<p>ä½¿ç”¨minhashï¼šæ ¹æ®åˆ†è¯ç»„æˆçš„é›†åˆäº§ç”Ÿç»è¿‡æŸç§å¤„ç†åçš„ä¸€ç»„å“ˆå¸Œå€¼ï¼Œç›¸è¿‘çš„æ–‡æœ¬ç”Ÿæˆçš„å“ˆå¸Œå€¼ç›¸ä¼¼åº¦æ¯”è¾ƒé«˜ã€‚å¸¸ç”¨ä¸¤ç§æ–¹æ³•ç”Ÿæˆå“ˆå¸Œå€¼ï¼š1ï¼‰ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°è¿›è¡Œå“ˆå¸Œåå†è¿›è¡Œå¤šæ¬¡é‡æ’ã€‚2ï¼‰ä½¿ç”¨ä¸åŒçš„å“ˆå¸Œå‡½æ•°è¿›è¡Œå¤šæ¬¡å“ˆå¸Œã€‚ </p>
<p>1ï¼‰ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°è¿›è¡Œå“ˆå¸Œåå†è¿›è¡Œå¤šæ¬¡é‡æ’ï¼šç”¨ä¸€ä¸ªåŸºç¡€å“ˆå¸Œå‡½æ•°å¯¹é›†åˆä¸­å…ƒç´ æ±‚hashï¼Œç„¶åä½¿ç”¨å¤šä¸ªç®€å•çš„æ•°å­¦å˜æ¢æ¨¡æ‹Ÿé‡æ’ï¼Œç„¶åæ¯æ¬¡æ’åˆ—ä¸­å–æœ€å°å€¼ä½œä¸ºæ¯æ¬¡æ‰“ä¹±çš„ä»£è¡¨ã€‚næ¬¡æ’åˆ—ç”Ÿæˆnåºåˆ—å“ˆå¸Œå€¼ã€‚ </p>
<p>2ï¼‰ä½¿ç”¨ä¸åŒçš„å“ˆå¸Œå‡½æ•°è¿›è¡Œå¤šæ¬¡å“ˆå¸Œï¼ˆå¸¸ç”¨ï¼‰ï¼šé€‰å–ä¸€æ‰¹ç›¸äº’ç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°å¯¹é›†åˆä¸­å…ƒç´ æ±‚hashï¼Œé€‰å–è¯¥æ¬¡å“ˆå¸Œå˜æ¢åé›†åˆä¸­æ•°å€¼çš„æœ€å°å€¼ã€‚ä¸åŒçš„å“ˆå¸Œå‡½æ•°ç›¸å½“äºä¸åŒçš„æŠ•å½±è§„åˆ™ã€‚nä¸ªå“ˆå¸Œå‡½æ•°ç”Ÿæˆnåºåˆ—å“ˆå¸Œå€¼ã€‚ </p>
<p>minhashè§£å†³äº†æ–‡æœ¬å‘é‡è¡¨ç¤ºç»´åº¦çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸¤ä¸¤æ¯”è¾ƒæ¬¡æ•°å¤ªå¤šçš„é—®é¢˜è¿˜åœ¨ã€‚å¦‚æœèƒ½è¯†åˆ«å‡ºç›¸è¿‘çš„å’Œä¸ç›¸è¿‘çš„ï¼Œå¯ä»¥å¤§å¤§å‡å°‘è®¡ç®—é‡ã€‚åšæ³•ï¼šå€ŸåŠ©å±€éƒ¨æ•æ„Ÿå“ˆå¸Œ( (Locality Sensitive Hashingï¼ŒLSH) æ¥å…ˆè¿›è¡Œä¸€æ¬¡åˆ†ç»„æˆ–è€…èšç±»ï¼Œè®©ç›¸è¿‘çš„æ–‡æœ¬åˆ†åˆ°ä¸€ç»„å»ã€‚ </p>
<p>LSHåšæ³•ï¼šé€šè¿‡minhashç”Ÿæˆå›ºå®šé•¿åº¦çš„ç­¾åï¼Œå¯¹ç­¾ååˆ†ç»„ï¼Œæ¯ç»„åŒ…å«å¤šä¸ªè¿ç»­çš„å“ˆå¸Œå€¼ï¼Œè¡¨ç¤ºä¸€ä¸ªå¸¦bandï¼Œå¯¹æ¯ä¸ªbandåº”ç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ¡¶ä¸­ï¼Œä¸€ä¸ªæ–‡æ¡£ä¼šè½å…¥å¤šä¸ªæ¡¶ã€‚æ¥ä¸‹æ¥åªéœ€è¦åœ¨åŒä¸€åˆ†æ¡¶ä¸­çš„æ•°æ®ä¹‹é—´è®¡ç®—ç›¸ä¼¼æ€§ã€‚ pythonä¸­å®ç°ï¼šç”¨datasketchåŒ…ä¸­çš„MinHash, MinHashLSHã€‚.updateå“ˆå¸ŒåŒ–ã€‚insertï¼ˆHashåç§°ï¼ŒminHashå€¼ï¼‰è½½å…¥LSHç³»ç»Ÿã€‚</p>
<p>pythonå®ç°MinHashå’ŒMinHashLSHï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datasketch <span class="keyword">import</span> MinHash, MinHashLSH</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- å®šä¹‰æ–‡æ¡£ ---</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬åˆ›å»ºä¸€äº›æ˜æ˜¾ç›¸ä¼¼çš„æ–‡æ¡£</span></span><br><span class="line">documents = &#123;</span><br><span class="line">    <span class="string">&quot;doc1&quot;</span>: <span class="string">&quot;The quick brown fox jumps over the lazy dog near the river.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc2&quot;</span>: <span class="string">&quot;A quick brown fox leaps over a lazy dog by the riverside.&quot;</span>,  <span class="comment"># ä¸ doc1 é«˜åº¦ç›¸ä¼¼</span></span><br><span class="line">    <span class="string">&quot;doc3&quot;</span>: <span class="string">&quot;The swift brown fox jumps over the sleepy dog close to the stream.&quot;</span>, <span class="comment"># ä¸ doc1 é«˜åº¦ç›¸ä¼¼</span></span><br><span class="line">    <span class="string">&quot;doc4&quot;</span>: <span class="string">&quot;A fast brown fox jumps over a lazy hound near the water.&quot;</span>,   <span class="comment"># ä¸ doc1 è¾ƒç›¸ä¼¼</span></span><br><span class="line">    <span class="string">&quot;doc5&quot;</span>: <span class="string">&quot;The cat sat on the mat and looked at the sun.&quot;</span>,             <span class="comment"># ä¸ doc1 ä¸ç›¸ä¼¼</span></span><br><span class="line">    <span class="string">&quot;doc6&quot;</span>: <span class="string">&quot;Dogs are loyal animals that make great companions.&quot;</span>,        <span class="comment"># ä¸ doc1 ä¸ç›¸ä¼¼</span></span><br><span class="line">    <span class="string">&quot;doc7&quot;</span>: <span class="string">&quot;Programming in Python is both powerful and enjoyable.&quot;</span>,     <span class="comment"># ä¸ doc1 ä¸ç›¸ä¼¼</span></span><br><span class="line">    <span class="string">&quot;doc8&quot;</span>: <span class="string">&quot;Data science involves statistics, programming, and domain expertise.&quot;</span>, <span class="comment"># ä¸ç›¸ä¼¼</span></span><br><span class="line">    <span class="comment"># æ·»åŠ å¤§é‡ä¸ç›¸å…³çš„æ–‡æ¡£æ¥æ¨¡æ‹Ÿâ€œæµ·é‡æ•°æ®â€åœºæ™¯</span></span><br><span class="line">    <span class="string">&quot;doc9&quot;</span>:  <span class="string">&quot;Machine learning models require large amounts of labeled data for training.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc10&quot;</span>: <span class="string">&quot;Cloud computing provides scalable resources over the internet.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc11&quot;</span>: <span class="string">&quot;Cybersecurity is essential for protecting digital information.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc12&quot;</span>: <span class="string">&quot;The solar system consists of the sun and the celestial bodies that orbit it.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc13&quot;</span>: <span class="string">&quot;Photosynthesis is the process by which green plants use sunlight to synthesize nutrients.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc14&quot;</span>: <span class="string">&quot;The human brain is a complex organ responsible for cognition and emotion.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc15&quot;</span>: <span class="string">&quot;Renewable energy sources include solar, wind, and hydroelectric power.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc16&quot;</span>: <span class="string">&quot;The internet has revolutionized communication and access to information.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc17&quot;</span>: <span class="string">&quot;Artificial intelligence aims to create machines that can perform tasks requiring human intelligence.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc18&quot;</span>: <span class="string">&quot;The history of the internet began with the development of ARPANET in the 1960s.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc19&quot;</span>: <span class="string">&quot;Quantum mechanics describes the behavior of matter and energy at atomic and subatomic scales.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;doc20&quot;</span>: <span class="string">&quot;The theory of evolution by natural selection was proposed by Charles Darwin.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- é¢„å¤„ç†å’Œåˆ›å»º MinHash ç­¾å ---</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess_text</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç®€å•çš„æ–‡æœ¬é¢„å¤„ç†ï¼šè½¬å°å†™ï¼Œåˆ†å‰²æˆè¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> text.lower().split()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_minhash</span>(<span class="params">text, num_perm=<span class="number">128</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸ºæ–‡æœ¬åˆ›å»º MinHash ç­¾å&quot;&quot;&quot;</span></span><br><span class="line">    m = MinHash(num_perm=num_perm)</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> preprocess_text(text):</span><br><span class="line">        m.update(word.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨ä¸ºæ‰€æœ‰æ–‡æ¡£åˆ›å»º MinHash ç­¾å...&quot;</span>)</span><br><span class="line">minhashes = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> doc_id, text <span class="keyword">in</span> documents.items():</span><br><span class="line">    minhashes[doc_id] = create_minhash(text)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;MinHash ç­¾ååˆ›å»ºå®Œæˆã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- æ–¹æ³• 1: MinHash LSH (è¿‘ä¼¼æœç´¢) ---</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== æ–¹æ³• 1: ä½¿ç”¨ MinHash LSH æŸ¥æ‰¾ç›¸ä¼¼æ–‡æ¡£ ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º LSH ç´¢å¼•ï¼Œè®¾ç½®ç›¸ä¼¼åº¦é˜ˆå€¼</span></span><br><span class="line"><span class="comment"># threshold=0.5 è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ° Jaccard ç›¸ä¼¼åº¦ &gt;= 0.5 çš„æ–‡æ¡£</span></span><br><span class="line">lsh = MinHashLSH(threshold=<span class="number">0.5</span>, num_perm=<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ‰€æœ‰æ–‡æ¡£çš„ MinHash ç­¾åæ’å…¥ LSH ç´¢å¼•</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨æ„å»º LSH ç´¢å¼•...&quot;</span>)</span><br><span class="line">start_time = time.time()</span><br><span class="line"><span class="keyword">for</span> doc_id, minhash <span class="keyword">in</span> minhashes.items():</span><br><span class="line">    lsh.insert(doc_id, minhash)</span><br><span class="line">lsh_build_time = time.time() - start_time</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;LSH ç´¢å¼•æ„å»ºè€—æ—¶: <span class="subst">&#123;lsh_build_time:<span class="number">.4</span>f&#125;</span> ç§’&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰æ‹© doc1 ä½œä¸ºæŸ¥è¯¢æ–‡æ¡£</span></span><br><span class="line">query_doc_id = <span class="string">&quot;doc1&quot;</span></span><br><span class="line">query_text = documents[query_doc_id]</span><br><span class="line">query_minhash = minhashes[query_doc_id]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\næŸ¥è¯¢æ–‡æ¡£ (<span class="subst">&#123;query_doc_id&#125;</span>): &#x27;<span class="subst">&#123;query_text&#125;</span>&#x27;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨ä½¿ç”¨ LSH æŸ¥æ‰¾ç›¸ä¼¼æ–‡æ¡£...&quot;</span>)</span><br><span class="line">start_time = time.time()</span><br><span class="line">similar_docs_lsh = lsh.query(query_minhash)</span><br><span class="line">lsh_query_time = time.time() - start_time</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;LSH æŸ¥è¯¢è€—æ—¶: <span class="subst">&#123;lsh_query_time:<span class="number">.6</span>f&#125;</span> ç§’&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;LSH æ‰¾åˆ° <span class="subst">&#123;<span class="built_in">len</span>(similar_docs_lsh)&#125;</span> ä¸ªå€™é€‰ç›¸ä¼¼æ–‡æ¡£: <span class="subst">&#123;similar_docs_lsh&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- æ–¹æ³• 2: ç²¾ç¡®è®¡ç®—æ‰€æœ‰ç›¸ä¼¼åº¦ (å…¨é‡æ¯”è¾ƒ) ---</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== æ–¹æ³• 2: ç²¾ç¡®è®¡ç®—æ‰€æœ‰æ–‡æ¡£çš„ç›¸ä¼¼åº¦ (å…¨é‡æ¯”è¾ƒ) ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨è®¡ç®—æŸ¥è¯¢æ–‡æ¡£ &#x27;<span class="subst">&#123;query_doc_id&#125;</span>&#x27; ä¸å…¶ä½™ <span class="subst">&#123;<span class="built_in">len</span>(documents)-<span class="number">1</span>&#125;</span> ä¸ªæ–‡æ¡£çš„ç²¾ç¡®ç›¸ä¼¼åº¦...&quot;</span>)</span><br><span class="line">start_time = time.time()</span><br><span class="line">exact_similar_docs = []</span><br><span class="line">exact_similarities = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> doc_id, minhash <span class="keyword">in</span> minhashes.items():</span><br><span class="line">    <span class="keyword">if</span> doc_id == query_doc_id:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨ MinHash ç­¾åä¼°ç®— Jaccard ç›¸ä¼¼åº¦</span></span><br><span class="line">    similarity = query_minhash.jaccard(minhash)</span><br><span class="line">    exact_similarities[doc_id] = similarity</span><br><span class="line">    <span class="keyword">if</span> similarity &gt;= <span class="number">0.5</span>: <span class="comment"># ä½¿ç”¨ç›¸åŒçš„é˜ˆå€¼</span></span><br><span class="line">        exact_similar_docs.append(doc_id)</span><br><span class="line">exact_calc_time = time.time() - start_time</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç²¾ç¡®è®¡ç®—è€—æ—¶: <span class="subst">&#123;exact_calc_time:<span class="number">.4</span>f&#125;</span> ç§’&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç²¾ç¡®æ–¹æ³•æ‰¾åˆ° <span class="subst">&#123;<span class="built_in">len</span>(exact_similar_docs)&#125;</span> ä¸ªç›¸ä¼¼æ–‡æ¡£: <span class="subst">&#123;exact_similar_docs&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- è¾“å‡ºè¯¦ç»†ç»“æœ ---</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== è¯¦ç»†ç»“æœ ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;LSH æ‰¾åˆ°çš„æ–‡æ¡£å†…å®¹:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> doc_id <span class="keyword">in</span> similar_docs_lsh:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;doc_id&#125;</span>: &#x27;<span class="subst">&#123;documents[doc_id]&#125;</span>&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nç²¾ç¡®æ–¹æ³•æ‰¾åˆ°çš„æ–‡æ¡£å†…å®¹:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> doc_id <span class="keyword">in</span> exact_similar_docs:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;doc_id&#125;</span>: &#x27;<span class="subst">&#123;documents[doc_id]&#125;</span>&#x27; (ç›¸ä¼¼åº¦: <span class="subst">&#123;exact_similarities[doc_id]:<span class="number">.3</span>f&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- æ€§èƒ½ä¸å‡†ç¡®æ€§æ¯”è¾ƒ ---</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== æ€§èƒ½ä¸å‡†ç¡®æ€§æ¯”è¾ƒ ===&quot;</span>)</span><br><span class="line">lsh_set = <span class="built_in">set</span>(similar_docs_lsh)</span><br><span class="line">exact_set = <span class="built_in">set</span>(exact_similar_docs)</span><br><span class="line">true_positives = lsh_set &amp; exact_set</span><br><span class="line">false_positives = lsh_set - exact_set</span><br><span class="line">false_negatives = exact_set - lsh_set</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å¬å›ç‡ (Recall): <span class="subst">&#123;<span class="built_in">len</span>(true_positives)&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(exact_set)&#125;</span> = <span class="subst">&#123;<span class="built_in">len</span>(true_positives)/<span class="built_in">len</span>(exact_set) <span class="keyword">if</span> exact_set <span class="keyword">else</span> <span class="number">1.0</span>:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å‡é˜³æ€§ (False Positives): <span class="subst">&#123;false_positives&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å‡é˜´æ€§ (False Negatives): <span class="subst">&#123;false_negatives&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== æ‰§è¡Œæ—¶é—´æ€»ç»“ ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;LSH æ€»è€—æ—¶ (æ„å»º + æŸ¥è¯¢): <span class="subst">&#123;lsh_build_time + lsh_query_time:<span class="number">.4</span>f&#125;</span> ç§’&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç²¾ç¡®è®¡ç®—è€—æ—¶:            <span class="subst">&#123;exact_calc_time:<span class="number">.4</span>f&#125;</span> ç§’&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;LSH ç›¸å¯¹äºç²¾ç¡®è®¡ç®—çš„æŸ¥è¯¢åŠ é€Ÿæ¯”: <span class="subst">&#123;exact_calc_time / lsh_query_time:<span class="number">.0</span>f&#125;</span>x&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ³¨æ„: LSH çš„ä¼˜åŠ¿åœ¨äºç´¢å¼•å¯é‡ç”¨ã€‚å¦‚æœè¿›è¡Œ10æ¬¡æŸ¥è¯¢ï¼Œ&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;     LSH æ€»æ—¶é—´çº¦ä¸º: <span class="subst">&#123;lsh_build_time + <span class="number">10</span> * lsh_query_time:<span class="number">.4</span>f&#125;</span> ç§’&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;     ç²¾ç¡®æ–¹æ³•æ€»æ—¶é—´:    <span class="subst">&#123;<span class="number">10</span> * exact_calc_time:<span class="number">.4</span>f&#125;</span> ç§’&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- å…³é”®è§‚å¯Ÿ ---</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== å…³é”®è§‚å¯Ÿ ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;1. LSH çš„æŸ¥è¯¢æ—¶é—´ (å¾®ç§’çº§) è¿œå¿«äºç²¾ç¡®è®¡ç®— (æ¯«ç§’çº§)ï¼Œå³ä½¿åœ¨å°æ•°æ®é›†ä¸Šã€‚&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;2. LSH æ˜¯è¿‘ä¼¼ç®—æ³•ï¼Œå¯èƒ½æ¼æ‰ä¸€äº›ç›¸ä¼¼æ–‡æ¡£ (å‡é˜´æ€§) æˆ–åŒ…å«ä¸ç›¸ä¼¼æ–‡æ¡£ (å‡é˜³æ€§)ã€‚&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;3. ä¸€æ—¦ LSH ç´¢å¼•æ„å»ºå®Œæˆï¼Œåç»­æ‰€æœ‰æŸ¥è¯¢éƒ½æå¿«ï¼Œè€Œç²¾ç¡®æ–¹æ³•æ¯æ¬¡æŸ¥è¯¢éƒ½éœ€å…¨é‡è®¡ç®—ã€‚&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;4. åœ¨éœ€è¦é¢‘ç¹æŸ¥è¯¢çš„æµ·é‡æ•°æ®åœºæ™¯ä¸‹ï¼ŒLSH çš„ä¼˜åŠ¿å°†å‘ˆæ•°é‡çº§æ”¾å¤§ã€‚&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="Transform-çš„æ¶æ„ï¼ŒEncoder-å’Œ-Decoder"><a href="#Transform-çš„æ¶æ„ï¼ŒEncoder-å’Œ-Decoder" class="headerlink" title="Transform çš„æ¶æ„ï¼ŒEncoder å’Œ Decoder"></a>Transform çš„æ¶æ„ï¼ŒEncoder å’Œ Decoder</h2><p>Transformeræ¶æ„æ˜¯ä¸€ç§ç”¨äºåºåˆ—æ•°æ®å¤„ç†çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œç‰¹åˆ«é€‚ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ã€‚å®ƒæ‘’å¼ƒäº†ä¼ ç»Ÿçš„å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰å’Œå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ï¼Œå®Œå…¨åŸºäºæ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttention Mechanismï¼‰æ„å»ºã€‚</p>
<p><strong>Encoderï¼ˆç¼–ç å™¨ï¼‰</strong>ï¼šç”±å¤šä¸ªç›¸åŒçš„å±‚å †å è€Œæˆï¼Œæ¯å±‚åŒ…æ‹¬ä¸€ä¸ªå¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆMulti-Head Self-Attentionï¼‰å’Œä¸€ä¸ªä½ç½®å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆPosition-wise Feed-Forward Networkï¼‰ã€‚ç¼–ç å™¨è´Ÿè´£å°†è¾“å…¥åºåˆ—è½¬æ¢ä¸ºéšè—è¡¨ç¤ºï¼Œè¿™äº›è¡¨ç¤ºæ•æ‰äº†åºåˆ—ä¸­å…ƒç´ ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”æ¯ä¸ªä½ç½®çš„ä¿¡æ¯éƒ½èƒ½è¢«ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå±‚æ¬¡ã€‚</p>
<p><strong>Decoderï¼ˆè§£ç å™¨ï¼‰</strong>ï¼šåŒæ ·ç”±å¤šä¸ªç›¸åŒå±‚ç»„æˆï¼Œé™¤äº†åŒ…å«ä¸ç¼–ç å™¨ç±»ä¼¼çš„ç»„ä»¶å¤–ï¼Œè¿˜å¢åŠ äº†ä¸€ä¸ªé¢å¤–çš„å¤šå¤´æ³¨æ„åŠ›å±‚ï¼Œç§°ä¸ºâ€œç¼–ç å™¨-è§£ç å™¨æ³¨æ„åŠ›â€å±‚ã€‚è¿™ä¸ªå±‚å…è®¸è§£ç å™¨å…³æ³¨åˆ°ç¼–ç å™¨çš„æ‰€æœ‰è¾“å‡ºï¼Œå¸®åŠ©ç”Ÿæˆç›®æ ‡åºåˆ—ã€‚æ­¤å¤–ï¼Œè§£ç å™¨åœ¨æ¯ä¸ªæ—¶é—´æ­¥åªèƒ½è®¿é—®åˆ°å½“å‰åŠä¹‹å‰çš„æ—¶é—´æ­¥ä¿¡æ¯ï¼Œä»¥ä¿è¯é¢„æµ‹çš„æ­£ç¡®é¡ºåºã€‚</p>
<p>é€šè¿‡è¿™ç§ç»“æ„ï¼ŒTransformerèƒ½å¤Ÿé«˜æ•ˆåœ°å¹¶è¡Œè®­ç»ƒï¼Œå¹¶æ˜¾è‘—æå‡å¤„ç†é•¿è·ç¦»ä¾èµ–é—®é¢˜çš„èƒ½åŠ›ã€‚</p>
<h2 id="FastTextåŸç†åŠå®è·µ"><a href="#FastTextåŸç†åŠå®è·µ" class="headerlink" title="FastTextåŸç†åŠå®è·µ"></a>FastTextåŸç†åŠå®è·µ</h2>]]></content>
      <categories>
        <category>é‚£äº›å¹´èƒŒè¿‡çš„é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>å…«è‚¡</tag>
      </tags>
  </entry>
  <entry>
    <title>BeanFactoryã€ApplicationContext</title>
    <url>/2022/04/26/myblog/spring/BeanFactory%E5%92%8CApplicationContext/</url>
    <content><![CDATA[<h3 id="BeanFactoryä¸ApplicationContext"><a href="#BeanFactoryä¸ApplicationContext" class="headerlink" title="BeanFactoryä¸ApplicationContext"></a>BeanFactoryä¸ApplicationContext</h3><p>BeanFactoryä½¿ç®¡ç†ä¸åŒç±»å‹çš„javaå¯¹è±¡æˆä¸ºå¯èƒ½ï¼Œåº”ç”¨ä¸Šä¸‹æ–‡ApplacationContextå»ºç«‹åœ¨BeanFactoråŸºç¡€ä¹‹ä¸Šï¼Œæä¾›äº†æ›´å¤šé¢å‘åº”ç”¨çš„åŠŸèƒ½ï¼Œå®ƒæä¾›äº†å›½é™…åŒ–æ”¯æŒå’Œæ¡†æ¶äº‹ä»¶ä½“ç³»ï¼Œæ›´æ˜“äºåˆ›å»ºå®é™…åº”ç”¨ã€‚æˆ‘ä»¬ä¸€èˆ¬ç§°BeanFactoryä¸ºIOCå®¹å™¨ï¼Œè€Œç§°ApplicationContextä¸ºåº”ç”¨ä¸Šä¸‹æ–‡ã€‚ä½†æœ‰æ—¶ä¸ºäº†è¡Œæ–‡æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¹Ÿç§°ApplicationContextä¸ºSpringå®¹å™¨ã€‚</p>
<p>å¯¹äºäºŒè€…çš„ç”¨é€”ï¼Œå¯ä»¥è¿›è¡Œç®€å•çš„åˆ’åˆ†ï¼šBeanFactoræ˜¯Springæ¡†æ¶çš„åŸºç¡€è®¾æ–½ï¼Œé¢å‘Springæœ¬èº«ï¼›ApplicationContexté¢å‘ä½¿ç”¨Springæ¡†æ¶çš„å¼€å‘è€…ï¼Œå‡ ä¹æ‰€æœ‰çš„åº”ç”¨åœºåˆéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ApplicationContextè€Œéåº•å±‚çš„BeanFactoryã€‚</p>
<p>ï¼ˆ1ï¼‰BeanFactoryï¼šæ˜¯Springé‡Œé¢æœ€åº•å±‚çš„æ¥å£ï¼ŒåŒ…å«äº†å„ç§Beançš„å®šä¹‰ï¼Œè¯»å–beané…ç½®æ–‡æ¡£ï¼Œç®¡ç†beançš„åŠ è½½ã€å®ä¾‹åŒ–ï¼Œæ§åˆ¶beançš„ç”Ÿå‘½å‘¨æœŸï¼Œç»´æŠ¤beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ApplicationContextæ¥å£ä½œä¸ºBeanFactoryçš„æ´¾ç”Ÿï¼Œé™¤äº†æä¾›BeanFactoryæ‰€å…·æœ‰çš„åŠŸèƒ½å¤–ï¼Œè¿˜æä¾›äº†æ›´å®Œæ•´çš„æ¡†æ¶åŠŸèƒ½ï¼š<br>â‘ ç»§æ‰¿MessageSourceï¼Œå› æ­¤æ”¯æŒå›½é™…åŒ–ã€‚<br>â‘¡ç»Ÿä¸€çš„èµ„æºæ–‡ä»¶è®¿é—®æ–¹å¼ã€‚<br>â‘¢æä¾›åœ¨ç›‘å¬å™¨ä¸­æ³¨å†Œbeançš„äº‹ä»¶ã€‚<br>â‘£åŒæ—¶åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶ã€‚<br>â‘¤è½½å…¥å¤šä¸ªï¼ˆæœ‰ç»§æ‰¿å…³ç³»ï¼‰ä¸Šä¸‹æ–‡ ï¼Œä½¿å¾—æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡éƒ½ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šçš„å±‚æ¬¡ï¼Œæ¯”å¦‚åº”ç”¨çš„webå±‚ã€‚</p>
<p>ï¼ˆ2ï¼‰BeanFactoryé€šå¸¸æ˜¯ä½¿ç”¨ç¼–ç¨‹æ–¹å¼è¢«åˆ›å»ºçš„ï¼Œè€ŒApplicationContextå¯ä»¥ç”¨å£°æ˜ï¼ˆå°±æ˜¯ç”¨é…ç½®çš„æ–¹å¼ï¼‰çš„æ–¹å¼åˆ›å»ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ApplicationContextçš„å®ç°ç±»ä¹‹ä¸€ç”¨ç¼–ç æ–¹å¼æ¥åˆ›å»ºApplicationContextçš„å®ä¾‹.</p>
<p>ï¼ˆ3ï¼‰BeanFactoryé‡‡ç”¨çš„æ˜¯å»¶è¿ŸåŠ è½½å½¢å¼æ¥æ³¨å…¥beançš„ï¼Œåªæœ‰åœ¨ä½¿ç”¨åˆ°getBean() æ—¶ï¼Œæ‰å¯¹è¯¥beanè¿›è¡ŒåŠ è½½å®ä¾‹åŒ–ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸èƒ½å‘ç°ä¸€äº›beançš„é…ç½®é—®é¢˜ã€‚è€ŒApplicationContextåˆ™ç›¸åï¼Œå®ƒæ˜¯åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰çš„beanï¼Œè¿™æ ·åœ¨å®¹å™¨å¯åŠ¨æ—¶å°±èƒ½å‘ç°spring ä¸­å­˜åœ¨çš„é…ç½®é”™è¯¯ã€‚è¿™æ ·æœ‰åˆ©äºæ£€æŸ¥æ‰€ä¾èµ–å±æ€§æ˜¯å¦æ³¨å…¥ã€‚ ApplicationContextå¯åŠ¨åé¢„è½½å…¥æ‰€æœ‰çš„å•å®ä¾‹Beanï¼Œé€šè¿‡é¢„è½½å…¥å•å®ä¾‹bean ,ç¡®ä¿å½“ä½ éœ€è¦çš„æ—¶å€™ï¼Œä½ å°±ä¸ç”¨ç­‰å¾…ï¼Œå› ä¸ºå®ƒä»¬å·²ç»åˆ›å»ºå¥½äº†ã€‚ç›¸å¯¹äºåŸºæœ¬çš„BeanFactoryï¼ŒApplicationContext å”¯ä¸€çš„ä¸è¶³æ˜¯å ç”¨å†…å­˜ç©ºé—´ã€‚å½“åº”ç”¨ç¨‹åºé…ç½®Beanè¾ƒå¤šæ—¶ï¼Œç¨‹åºå¯åŠ¨è¾ƒæ…¢ã€‚</p>
<p>ï¼ˆ4ï¼‰BeanFactoryå’ŒApplicationContextéƒ½æ”¯æŒBeanPostProcesserã€BeanFactoryPostProcessorçš„ä½¿ç”¨ï¼Œä½†ä¸¤è€…çš„åŒºåˆ«æ˜¯ï¼šBeanFactoryæ˜¯æ‰‹åŠ¨æ³¨å†Œçš„ï¼ŒApplicationContextæ˜¯è‡ªåŠ¨æ³¨å†Œçš„.</p>
<h3 id="ApplicationContextçš„åˆ›å»ºæ–¹å¼"><a href="#ApplicationContextçš„åˆ›å»ºæ–¹å¼" class="headerlink" title="ApplicationContextçš„åˆ›å»ºæ–¹å¼"></a>ApplicationContextçš„åˆ›å»ºæ–¹å¼</h3><h4 id="ä½¿ç”¨ä»£ç æ–¹å¼"><a href="#ä½¿ç”¨ä»£ç æ–¹å¼" class="headerlink" title="ä½¿ç”¨ä»£ç æ–¹å¼"></a>ä½¿ç”¨ä»£ç æ–¹å¼</h4><p>ApplicationContextæ¥å£å¸¸ç”¨å®ç°ç±»ï¼š</p>
<p>1.ClassPathXmlApplicationContext</p>
<p>a.åŠ è½½å•ä¸ªé…ç½®æ–‡ä»¶æ–¹å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ApplicationContext cxt = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br></pre></td></tr></table></figure>

<p>b.åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶æ–¹å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String[] configs = &#123;&quot;bean1.xml&quot;,&quot;bean2.xml&quot;,&quot;bean3.xml&quot;&#125;;</span><br><span class="line">ApplicationContext cxt = new ClassPathXmlApplicationContext(configs);</span><br></pre></td></tr></table></figure>

<p>2.ConfigurableApplicationContextæ¥å£</p>
<p>StartApplicationä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å¯åŠ¨springbootåº”ç”¨ï¼Œè·å–springçš„iocå®¹å™¨</span><br><span class="line">ConfigurableApplicationContext context = SpringApplication.run(StartApplication.class, args);</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨é…ç½®-å£°æ˜"><a href="#ä½¿ç”¨é…ç½®-å£°æ˜" class="headerlink" title="ä½¿ç”¨é…ç½®(å£°æ˜)"></a>ä½¿ç”¨é…ç½®(å£°æ˜)</h4><p>åœ¨javaeeåº”ç”¨ä¸­å‘Servletå®¹å™¨ä¸­æ³¨å…¥Springå®¹å™¨çš„æ–¹æ³•</p>
<p>ContextLoader æ¥å£ï¼Œå®ƒæœ‰ä¸¤ä¸ªå®ç° :ContextLoaderListener å’Œ ContextLoaderServlet. å…¶ä¸­å¸¸ç”¨çš„æ˜¯ ContextLoaderListener. ä» spring æ–‡æ¡£ä¸Šå¯ä»¥æŸ¥åˆ°ï¼Œä»–ä»¬äºŒè€…å®ç°çš„åŠŸèƒ½åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯ ContextLoaderListener ä¸èƒ½åœ¨ä¸ Servlet2.2 å…¼å®¹çš„ web å®¹å™¨ä¸­ä½¿ç”¨ã€‚å¦å¤–ï¼Œå› ä¸º ContextLoaderLitener æ˜¯ä¸€ä¸ª servlet Listener ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯åœ¨ servlet context å»ºç«‹åç«‹å³æ‰§è¡Œï¼Œä¹Ÿå°±ä»¥ä¸ºè¿™ servlet å·²å»ºç«‹ï¼Œ spring çš„ ApplicationContext å°±å¾—åˆ°äº†åˆå§‹åŒ–ï¼Œå¹¶ä¸”èƒ½å¤Ÿç›¸åº”ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥é¦–é€‰ ContextLoaderListener.</p>
<p>åœ¨web.xmlä¸­æ·»åŠ å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;? xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt; </span><br><span class="line"> &lt;! DOCTYPE web-app</span><br><span class="line">      PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span><br><span class="line">      &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt; </span><br><span class="line"> </span><br><span class="line"> &lt; web-app &gt; </span><br><span class="line">     &lt; display-name &gt; Baselib Application &lt;/ display-name &gt; </span><br><span class="line">    </span><br><span class="line">     &lt; context-param &gt; </span><br><span class="line">        &lt; param-name &gt; contextConfigLocation &lt;/ param-name &gt; </span><br><span class="line">        &lt; param-value &gt; </span><br><span class="line">        /WEB-INF/classes/spring-sup-middelbeans.xml</span><br><span class="line">        /WEB-INF/classes/spring-ueaac-action.xml</span><br><span class="line">        /WEB-INF/classes/spring-ueaac-beans.xml</span><br><span class="line">        /WEB-INF/classes/spring-ueaac-cm.xml</span><br><span class="line">        /WEB-INF/classes/spring-ueaac-hibernate.xml</span><br><span class="line">        /WEB-INF/classes/spring-ueaac-resource.xml</span><br><span class="line">        /WEB-INF/classes/spring-ueaac-sso.xml</span><br><span class="line">        /WEB-INF/classes/com/javaeye/jert/application_context.xml</span><br><span class="line">        &lt;/ param-value &gt; </span><br><span class="line">    &lt;/ context-param &gt; </span><br><span class="line"></span><br><span class="line">    &lt; listener &gt; </span><br><span class="line">        &lt; listener-class &gt; org.springframework.web.context.ContextLoaderListener &lt;/ listener-class &gt; </span><br><span class="line">    &lt;/ listener &gt; </span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt; param-value &gt; /WEB-INF/classes/spring-*.xml &lt;/ context-param &gt; </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸»è¦æ˜¯é…ç½®äº† spring çš„ç›‘å¬å™¨ ContextLoaderListener ï¼Œå®ƒæ£€æŸ¥ contextConfigLocation è¿™ä¸ªå‚æ•°ã€‚å¦‚æœå®ƒä¸å­˜åœ¨çš„è¯ï¼Œå®ƒå°†ç”¨ &#x2F;WEB-INF&#x2F;applicationContext.xml ä½œä¸ºé»˜è®¤çš„é…ç½®æ–‡ä»¶ã€‚å¦‚æœ contextConfigLocation å­˜åœ¨çš„è¯ï¼Œå®ƒå°†æ ¹æ®è¯¥å‚æ•°çš„å€¼æŸ¥æ‰¾é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œæ¥ä¸€ä¸€è¯»å– spring å‚æ•°ã€‚</p>
<p>contextConfigLocation æ˜¯è¢« spring å›ºå®šçš„ï¼Œä¸“é—¨ç”¨æ¥æŸ¥  æ‰¾é…ç½®æ–‡ä»¶ä½ç½®çš„.</p>
<p>å‚è€ƒï¼š<br><a href="https://blog.csdn.net/sole_ghost/article/details/1389664">https://blog.csdn.net/sole_ghost/article/details/1389664</a></p>
<h3 id="ApplicationContext-getBean"><a href="#ApplicationContext-getBean" class="headerlink" title="ApplicationContext.getBean"></a>ApplicationContext.getBean</h3><p>ç›®çš„ï¼šè·å–Springå®¹å™¨ä¸­å·²åˆå§‹åŒ–çš„bean</p>
<p>ç¬¬ä¸€ç§ï¼šgetBean(String name)<br>å‚æ•°nameè¡¨ç¤ºIOCå®¹å™¨ä¸­å·²ç»å®ä¾‹åŒ–çš„beançš„idæˆ–è€…name,<br>åœ¨IOCå®¹å™¨ä¸­æ˜¯å”¯ä¸€çš„ä¸èƒ½é‡åã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br><span class="line">Person p = (Person) ctx.getBean(&quot;p&quot;);</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ï¼šgetBean(Class<T> type)<br>typeè¡¨ç¤ºè¦åŠ è½½çš„Beançš„ç±»å‹ã€‚<br>å¦‚æœè¯¥ç±»å‹æ²¡æœ‰ç»§æ‰¿ä»»ä½•çˆ¶ç±»(Objectç±»é™¤å¤–)å’Œå®ç°æ¥å£çš„è¯ï¼Œé‚£ä¹ˆè¦æ±‚è¯¥ç±»å‹çš„beanåœ¨IOCå®¹å™¨ä¸­ä¹Ÿå¿…é¡»æ˜¯å”¯ä¸€çš„.(æ¯”å¦‚å®šä¹‰åŒä¸€ç±»çš„ä¸¤ä¸ªbeanï¼Œä½†æ˜¯propertyæ³¨å…¥çš„å±æ€§ä¸ä¸€æ ·)<br>ä¸éœ€è¦ç±»å‹è½¬æ¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span><br><span class="line">Person p = ctx.getBean(Person.class);</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ç§ï¼šgetBean(String name,Class<T> type)<br>è¿™ç§æ–¹å¼æ¯”è¾ƒé€‚åˆæ¥å£&#x2F;æŠ½è±¡ç±»ï¼Œæœ‰ä¸åŒå®ç°ç±»æˆ–å­ç±»æ—¶ï¼Œtypeå†™æ¥å£æˆ–çˆ¶ç±»ï¼Œnameå†™bean nameã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Person p = ctx.getBean(&quot;person&quot;,BasePerson.class);</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››ç§ï¼š getBean(String name,Object[] args)<br>ç¬¬äºŒä¸ªå‚æ•°Object[] argså¯ä»¥ç»™beançš„å±æ€§èµ‹å€¼ï¼Œèµ‹å€¼çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šæ„é€ æ–¹æ³•å’Œå·¥å‚æ–¹æ³•ã€‚ä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è·å–çš„beanå¿…é¡»æŠŠscopeå±æ€§è®¾ç½®ä¸ºprototypeï¼Œä¹Ÿå°±æ˜¯éå•ä¾‹æ¨¡å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.æ„é€ æ–¹æ³•æ–¹å¼ï¼š</span><br><span class="line">&lt;bean name=&quot;p3&quot; class=&quot;com.bean.Person&quot; scope=&quot;prototype&quot;/&gt;</span><br><span class="line"></span><br><span class="line">Person p = (Person) ctx.getBean(&quot;p3&quot;,new Object[]&#123;&quot;ç‹äº”&quot;,35&#125;);</span><br><span class="line"></span><br><span class="line">2.å·¥å‚æ³¨å…¥æ–¹å¼ï¼š</span><br><span class="line">å·¥å‚ç±»ï¼š</span><br><span class="line">public class PersonFactory &#123;</span><br><span class="line">//é™æ€å·¥å‚æ³¨å…¥</span><br><span class="line">public static Person getPersonInstance(String name,int age)throws Exception</span><br><span class="line">&#123;</span><br><span class="line">  Person p = (Person)Class.forName(&quot;com.bean.Person&quot;).newInstance();</span><br><span class="line">   Method m = p.getClass().getMethod(&quot;setName&quot;, java.lang.String.class);</span><br><span class="line">   m.invoke(p, name);</span><br><span class="line">   m = p.getClass().getMethod(&quot;setAge&quot;, int.class);</span><br><span class="line">   m.invoke(p, age);</span><br><span class="line">   return p;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">é…ç½®beanï¼š</span><br><span class="line">&lt;bean name=&quot;p3&quot; class=&quot;com.factory.PersonFactory&quot; factory-method=&quot;getPersonInstance&quot; scope=&quot;prototype&quot;&gt;</span><br><span class="line">&lt;constructor-arg name=&quot;name&quot;&gt;</span><br><span class="line">&lt;null/&gt;</span><br><span class="line">&lt;/constructor-arg&gt;</span><br><span class="line">&lt;constructor-arg name=&quot;age&quot; value=&quot;0&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">Person p = (Person) ctx.getBean(&quot;p3&quot;,new Object[]&#123;&quot;ç‹äº”&quot;,35&#125;);</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_23927391/article/details/80625578">https://blog.csdn.net/qq_23927391/article/details/80625578</a></p>
<h3 id="ApplicationContext-getBeanWithAnnotation"><a href="#ApplicationContext-getBeanWithAnnotation" class="headerlink" title="ApplicationContext.getBeanWithAnnotation"></a>ApplicationContext.getBeanWithAnnotation</h3><p>springä¸­å¯ä»¥é€šè¿‡getBeansWithAnnotationæ¥è·å–iocå®¹å™¨ä¸­ä½¿ç”¨äº†æŸä¸ªæ³¨è§£çš„æ‰€æœ‰bean,è¿™ä¸ªæ–¹æ³•åº•å±‚åŸç†ï¼šæˆ‘ä»¬çŸ¥é“å¯ä»¥é€šè¿‡åå°„æ¥è·å–ä¸€ä¸ªç±»ä¸­æ‰€æœ‰çš„æ³¨è§£ï¼Œç„¶åé€šè¿‡éå†springå®¹å™¨ä¸­æ‰€æœ‰beanå°±èƒ½è·å–éœ€è¦çš„ç»“æœã€‚è¿”å›Map&lt;String, Object&gt;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//è‡ªå®šä¹‰@Auditableæ³¨è§£</span><br><span class="line">package com.yk.annotation;</span><br><span class="line"></span><br><span class="line">import java.lang.annotation.ElementType;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.RetentionPolicy;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(&#123;ElementType.METHOD,ElementType.TYPE&#125;)</span><br><span class="line">public @interface Auditable &#123;</span><br><span class="line">    String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//åœ¨personç±»ä¸­æˆ‘ä»¬å¼•å…¥@Auditableï¼Œå¹¶é€šè¿‡@Componentå°†å…¶æ³¨å…¥springå®¹å™¨</span><br><span class="line">package com.yk.annotation;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Auditable(&quot;person.sleep&quot;)</span><br><span class="line">public class Person &#123;</span><br><span class="line"></span><br><span class="line">    void sleep()&#123;</span><br><span class="line">        System.out.println(&quot;ç¡è§‰äº†&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class TestApplicationContext implements ApplicationContextAware &#123;</span><br><span class="line"> </span><br><span class="line">    protected ApplicationContext applicationContext;</span><br><span class="line">	</span><br><span class="line">    @Override</span><br><span class="line">    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123;</span><br><span class="line">        this.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @PostConstruct</span><br><span class="line">    public void init() throws Exception &#123;</span><br><span class="line">        Class aClass = Class.forName(&quot;com.yk.annotation.Auditable&quot;);</span><br><span class="line">        //boolean b = aClass.isAnnotation();</span><br><span class="line">        //System.out.println(b);</span><br><span class="line">        //Person person = applicationContext.getBean(Person.class);</span><br><span class="line">        Map beansWithAnnotation = applicationContext.getBeansWithAnnotation(aClass);</span><br><span class="line"></span><br><span class="line">        Iterator entries = beansWithAnnotation.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">        while (entries.hasNext()) &#123;</span><br><span class="line"></span><br><span class="line">            Map.Entry entry = (Map.Entry) entries.next();</span><br><span class="line">            System.out.println(&quot;Key = &quot; + entry.getKey() + &quot;, Value = &quot; + entry.getValue());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/weixin_42374693/article/details/115374179">https://blog.csdn.net/weixin_42374693/article/details/115374179</a></p>
<h3 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h3><p>ä¸€ä¸ªä½¿ç”¨å·¥å‚æ¨¡å¼ç®¡ç†å¤šä¸ªç±»å®ç°åŒä¸€ä¸ªæ¥å£çš„ä¾‹å­ï¼š<br><a href="https://blog.csdn.net/weixin_33898233/article/details/91414228">https://blog.csdn.net/weixin_33898233/article/details/91414228</a></p>
<p><code>applicationContext.getBeansOfType(Sort.class);</code></p>
]]></content>
      <categories>
        <category>springç†è§£</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>springå…¥é—¨æ¡ˆä¾‹</title>
    <url>/2021/08/25/myblog/spring/Spring%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B/</url>
    <content><![CDATA[<h1 id="Springå…¥é—¨æ¡ˆä¾‹"><a href="#Springå…¥é—¨æ¡ˆä¾‹" class="headerlink" title="Springå…¥é—¨æ¡ˆä¾‹"></a>Springå…¥é—¨æ¡ˆä¾‹</h1><h2 id="0-javaåŸºç¡€"><a href="#0-javaåŸºç¡€" class="headerlink" title="0.javaåŸºç¡€"></a>0.javaåŸºç¡€</h2><h3 id="a-javaç‰ˆæœ¬"><a href="#a-javaç‰ˆæœ¬" class="headerlink" title="a.javaç‰ˆæœ¬"></a>a.javaç‰ˆæœ¬</h3><p>Javaæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è®¡ç®—æœºç¼–ç¨‹è¯­è¨€ï¼Œæ‹¥æœ‰è·¨å¹³å°ã€é¢å‘å¯¹è±¡ã€æ³›å‹ç¼–ç¨‹çš„ç‰¹æ€§ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçº§Webåº”ç”¨å¼€å‘å’Œç§»åŠ¨åº”ç”¨å¼€å‘ã€‚</p>
<p>Javaç¼–ç¨‹è¯­è¨€çš„é£æ ¼ååˆ†æ¥è¿‘C++è¯­è¨€ã€‚ç»§æ‰¿äº†C++è¯­è¨€é¢å‘å¯¹è±¡æŠ€æœ¯çš„æ ¸å¿ƒï¼Œèˆå¼ƒäº†å®¹æ˜“å¼•èµ·é”™è¯¯çš„æŒ‡é’ˆï¼Œä»¥å¼•ç”¨å–ä»£ï¼›ç§»é™¤äº†C++ä¸­çš„è¿ç®—ç¬¦é‡è½½å’Œå¤šé‡ç»§æ‰¿ç‰¹æ€§ï¼Œç”¨æ¥å£å–ä»£ï¼›å¢åŠ åƒåœ¾å›æ”¶å™¨åŠŸèƒ½ã€‚åœ¨Java SE 1.5ç‰ˆæœ¬ä¸­å¼•å…¥äº†æ³›å‹ç¼–ç¨‹ã€ç±»å‹å®‰å…¨çš„æšä¸¾ã€ä¸å®šé•¿å‚æ•°å’Œè‡ªåŠ¨è£…&#x2F;æ‹†ç®±ç‰¹æ€§ã€‚</p>
<blockquote>
<p>Javaçš„ä¸‰ä¸ªç‰ˆæœ¬ : JAVASE(æ ‡å‡†ç‰ˆ),JAVAEE(ä¼ä¸šç‰ˆ),JAVAME(å¾®å‹ç‰ˆ).</p>
<p>javaæ˜¯ä¸€ä¸ªå¹³å°ã€‚ä»–åŒ…æ‹¬äº†ï¼Œjavaè¯­è¨€ï¼Œjavaå¼€å‘ç¯å¢ƒ(jdk)ã€‚javaæœ‰ä¸‰ä¸ªç‰ˆæœ¬<br>j2se(æ ‡å‡†ç‰ˆ),j2ee(ä¼ä¸šç‰ˆ),j2me(å¾®å‹ç‰ˆ)<br>ä¸ç®¡å“ªä¸ªç‰ˆæœ¬ï¼Œéƒ½æ˜¯javaè¯­è¨€å®ç°çš„ä¸€ä¸ªæ¡†æ¶ã€‚ä¹‹æ‰€ä»¥è¦åˆ†ç‰ˆæœ¬ï¼Œæ˜¯å› ä¸º3ä¸ªç‰ˆæœ¬æ˜¯é’ˆå¯¹ä¸åŒé—®é¢˜ï¼Œè®¾è®¡çš„è§£å†³æ–¹æ¡ˆã€‚<br>j2EEæ˜¯javaçš„ä¼ä¸šçº§å¼€å‘ç‰ˆæœ¬ï¼Œå…¶å®æ¢å¥è¯è¯´å°±æ˜¯ç”¨æ¥åšwebå¼€å‘çš„javaæ¡†æ¶ã€‚javaEEé€šè¿‡è®¾å®šç»Ÿä¸€çš„æ ‡å‡†æ¥è§£å†³webå¼€å‘çš„é—®é¢˜ï¼ŒjavaEEçš„æ¥å£ï¼ŒæŠ½è±¡ç±»ï¼Œè§„å®šäº†webå¼€å‘æ‰€éœ€è¦å®ç°çš„æµç¨‹ã€‚æ•´ä¸ªwebçš„å¼€å‘ï¼Œæœ‰2å±‚ï¼Œç¬¬1å±‚æ˜¯æœåŠ¡å™¨å®¹å™¨ï¼Œæ¯”å¦‚tomcatï¼Œweblogicã€‚ä»–ä»¬åœ¨javaEEçš„è§„èŒƒä¸‹ï¼Œå®ç°å¥—æ¥å­—çš„è¿æ¥ï¼Œå°è£…æ¶ˆæ¯ç­‰ç­‰ï¼Œç¬¬2å±‚æ˜¯ä¸šåŠ¡ï¼Œè€Œè¿™ä¸€å±‚æ˜¯ä½ è¦åšçš„ï¼Œé€šè¿‡tomcatå°è£…çš„æ¶ˆæ¯ï¼Œè¿›è¡Œç›¸åº”çš„ä¸šåŠ¡å¤„ç†ã€‚æœåŠ¡å™¨å®¹å™¨çš„å¼€å‘ç”±å¤§å‹çš„äº§å•†å¼€å‘ï¼Œè€Œæˆ‘ä»¬é€šå¸¸åšçš„å¼€å‘æ˜¯åœ¨æœåŠ¡å™¨å®¹å™¨ä¸Šçš„ä¸šåŠ¡å¼€å‘ï¼Œæ­£æ˜¯sunçš„javaEEç»Ÿä¸€äº†è§„èŒƒ(æ¯”å¦‚ç”¨servlet)æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç ï¼Œèƒ½å’Œcomcatè¿›è¡Œå¾ˆå¥½çš„é€šè®¯ã€‚</p>
</blockquote>
<p>J2SEæ˜¯æ ‡å‡†ç‰ˆæœ¬ï¼ŒJ2MEæ˜¯æ‰‹æœºæ–¹å‘çš„ï¼ŒJ2EEæ˜¯ç½‘ç«™å¼€å‘æ–¹å‘çš„ã€‚</p>
<blockquote>
<p>ä»JDK 5.0å¼€å§‹ J2EE æ”¹åä¸º java EEï¼ŒJ2SE æ”¹åä¸º java SEï¼ŒJ2ME æ”¹åæˆ java ME.java EE æ˜¯javaçš„ä¼ä¸šç‰ˆï¼Œä¸»è¦é¢å‘webåº”ç”¨ï¼Œå°¤å…¶æ˜¯ä¼ä¸šçº§å¼€å‘</p>
</blockquote>
<h3 id="b-jdkç‰ˆæœ¬"><a href="#b-jdkç‰ˆæœ¬" class="headerlink" title="b.jdkç‰ˆæœ¬"></a>b.jdkç‰ˆæœ¬</h3><p>Java Development Kitï¼ˆJDKï¼‰æ˜¯å¤ªé˜³å¾®ç³»ç»Ÿé’ˆå¯¹Javaå¼€å‘äººå‘˜å‘å¸ƒçš„å…è´¹è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼ˆSDKï¼ŒSoftware development kitï¼‰ã€‚è‡ªä»Javaæ¨å‡ºä»¥æ¥ï¼ŒJDKå·²ç»æˆä¸ºä½¿ç”¨æœ€å¹¿æ³›çš„Java SDKã€‚</p>
<p>ä½œä¸ºJavaè¯­è¨€çš„SDKï¼Œæ™®é€šç”¨æˆ·å¹¶ä¸éœ€è¦å®‰è£…JDKæ¥è¿è¡ŒJavaç¨‹åºï¼Œè€Œåªéœ€è¦å®‰è£…JREï¼ˆJava Runtime Environmentï¼‰ã€‚è€Œç¨‹åºå¼€å‘è€…å¿…é¡»å®‰è£…JDKæ¥ç¼–è¯‘ã€è°ƒè¯•ç¨‹åºã€‚</p>
<p>JDKæ˜¯ä¸ªJavaå¼€å‘çš„å·¥å…·åŒ…ï¼ŒJavaæ˜¯é—¨ç¼–ç¨‹è¯­è¨€ã€‚</p>
<p>JDK8æˆ–è€…JDK1.8æ˜¯ç”±äºè‡ªä»JDK1.5&#x2F;JDK5å‘½åæ–¹å¼æ”¹å˜åé—ç•™çš„æ–°æ—§å‘½ä»¤æ–¹å¼é—®é¢˜ã€‚æ‰€ä»¥JDK8æˆ–è€…JDK1.8ä¹Ÿæ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚</p>
<blockquote>
<p>JDK1.4 æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¼‚å¸¸é“¾ï¼ŒNIOï¼Œæ—¥å¿—ç±»ï¼ŒXMLè§£æå™¨ï¼ŒXLSTè½¬æ¢å™¨<br>JDK1.5 è‡ªåŠ¨è£…ç®±ã€æ³›å‹ã€åŠ¨æ€æ³¨è§£ã€æšä¸¾ã€å¯å˜é•¿å‚æ•°ã€éå†å¾ªç¯<br>JDK1.6 æä¾›åŠ¨æ€è¯­è¨€æ”¯æŒã€æä¾›ç¼–è¯‘APIå’Œå«æ˜ŸHTTPæœåŠ¡å™¨APIï¼Œæ”¹è¿›JVMçš„é”ï¼ŒåŒæ­¥åƒåœ¾å›æ”¶ï¼Œç±»åŠ è½½<br>JDK1.7 æä¾›GIæ”¶é›†å™¨ã€åŠ å¼ºå¯¹éJavaè¯­è¨€çš„è°ƒç”¨æ”¯æŒï¼ˆJSR-292,å‡çº§ç±»åŠ è½½æ¶æ„<br>JDK8 Lambda è¡¨è¾¾å¼ã€æ–¹æ³•å¼•ç”¨ã€é»˜è®¤æ–¹æ³•ã€æ–°å·¥å…·ã€Stream APIã€Date Time API ã€Optional ç±»ã€Nashorn, JavaScript å¼•æ“<br>JDK9 1ã€é›†åˆåŠ å¼ºï¼›2ã€ç§æœ‰æ¥å£æ–¹æ³•ï¼›3ã€åƒåœ¾æ”¶é›†æœºåˆ¶ï¼›4ã€I&#x2F;OæµåŠ å¼ºï¼›5ã€JShellå·¥å…·<br>JDK10 1ã€å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­ï¼›2ã€çº¿ç¨‹æœ¬åœ°æ¡æ‰‹ï¼›3ã€GCæ”¹è¿›å’Œå†…å­˜ç®¡ç†ï¼›<br>JDK11 1ã€å­—ç¬¦ä¸²åŠ å¼ºï¼›2ã€HttClient Apiï¼›3ã€ç”¨äº Lambda å‚æ•°çš„å±€éƒ¨å˜é‡è¯­æ³•ï¼›4ã€ZGC<br>JDK12 1ã€Switch Expressionsï¼›2ã€Shenandoah GCï¼›<br>JDK13 1ã€switchä¼˜åŒ–æ›´æ–°ï¼›2ã€æ–‡æœ¬å—å‡çº§ï¼›3ã€é‡æ–°å®ç°æ—§ç‰ˆå¥—æ¥å­—APIï¼›4ã€æ ¸å¿ƒåº“&#x2F;java.utilä¸­ï¼šI18Nï¼›5ã€å–æ¶ˆä½¿ç”¨æœªä½¿ç”¨çš„å†…å­˜<br>JDK14 1ã€switchä¼˜åŒ–å˜æ›´ä¸ºæœ€ç»ˆç‰ˆï¼›2ã€åƒåœ¾å›æ”¶ç›¸å…³ï¼›3ã€instanceofçš„æ¨¡å¼åŒ¹é…ï¼ˆé¢„è§ˆç‰ˆï¼‰ï¼›4ã€åˆ é™¤äº†å®‰å…¨åº“java.security.acl APIï¼›5ã€è´§å¸æ ¼å¼ï¼ˆä¼˜åŒ–ï¼‰<br>JDK15</p>
</blockquote>
<h2 id="1-Springç®€ä»‹"><a href="#1-Springç®€ä»‹" class="headerlink" title="1.Springç®€ä»‹"></a>1.Springç®€ä»‹</h2><p>Springæ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼ŒSpringæ˜¯2003å¹´å…´èµ·çš„è½»é‡çº§javaå¼€å‘æ¡†æ¶ï¼Œå®ƒæ˜¯ä¸ºäº†è§£å†³ä¼ä¸šçº§å¼€å‘çš„å¤æ‚æ€§è€Œåˆ›å»ºçš„ã€‚Springçš„ç”¨é€”ä¸ä»…é™äºæœåŠ¡å™¨ç«¯çš„å¼€å‘ï¼Œä»ç®€å•æ€§ã€å¯æµ‹è¯•æ€§ã€ä½è€¦åˆçš„è§’åº¦è€Œè¨€ä»»ä½•javaåº”ç”¨éƒ½å¯ä»¥åœ¨springä¸­å—ç›Šã€‚</p>
<p>ç®€å•çš„æ¥è¯´Springå°±æ˜¯è½»é‡çº§çš„æ§åˆ¶åè½¬ï¼ˆIOCï¼‰å’Œé¢å‘åˆ‡é¢ï¼ˆAOPï¼‰çš„å®¹å™¨æ¡†æ¶ã€‚</p>
<blockquote>
<p>javaBeanï¼š<br>ç¬¦åˆä¸€å®šè§„èŒƒç¼–å†™çš„Javaç±»ï¼Œä¸æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§è§„èŒƒã€‚é’ˆå¯¹è¿™ç§è§„èŒƒï¼Œæ€»ç»“äº†å¾ˆå¤šå¼€å‘æŠ€å·§ã€å·¥å…·å‡½æ•°ã€‚ç¬¦åˆè¿™ç§è§„èŒƒçš„ç±»ï¼Œå¯ä»¥è¢«å…¶ä»–çš„ç¨‹åºå‘˜æˆ–è€…æ¡†æ¶ä½¿ç”¨ã€‚è¿™äº›çº¦å®šåŒ…æ‹¬ï¼šgetXXXï¼ŒsetXXXï¼ŒisXXXï¼ŒaddXXXã€‚</p>
</blockquote>
<h3 id="Springè§£å†³ä»€ä¹ˆï¼š"><a href="#Springè§£å†³ä»€ä¹ˆï¼š" class="headerlink" title="Springè§£å†³ä»€ä¹ˆï¼š"></a>Springè§£å†³ä»€ä¹ˆï¼š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨æŠŠå¾—åˆ°çš„è¯·æ±‚å‘é€ç»™æ§åˆ¶å™¨Servletï¼Œè€Œåœ¨Servletä¸­éœ€è¦åˆ›å»ºServiceå¯¹è±¡æ¥è°ƒç”¨ä¸šåŠ¡å±‚ç›¸å…³åŠŸèƒ½(æ•…è¯´æ§åˆ¶å™¨å±‚Servletä¾èµ–äºä¸šåŠ¡å±‚Service),è€Œåœ¨Serviceä¸­åˆéœ€è¦åˆ›å»ºæ•°æ®åº“å±‚DAOå¯¹è±¡æ¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ(æ•…è¯´ä¸šåŠ¡å±‚Serviceä¾èµ–äºæ•°æ®åº“å±‚DAO)ã€‚</span><br><span class="line"></span><br><span class="line">é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œéœ€è¦è€ƒè™‘ï¼š1.Servletã€Serviceä»¥åŠDaoå¯¹è±¡çš„åˆ›å»ºæ—¶é—´ã€åˆ›å»ºæ•°é‡ã€‚2.Servletã€Serviceä»¥åŠDaoä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</span><br><span class="line"></span><br><span class="line">springï¼š</span><br><span class="line">ç”¨æ¥å¤„ç†å¯¹è±¡çš„åˆ›å»ºã€ä»¥åŠå¯¹è±¡ä¹‹é—´ä¾èµ–å…³ç³»çš„ä¸€ä¸ªå¼€å‘æ¡†æ¶ã€‚å®ƒæ‰“ç ´äº†æˆ‘ä»¬ä¼ ç»Ÿå¼€å‘çš„è§‚å¿µï¼Œæˆ‘ä»¬ä¸å†éœ€è¦åƒä»¥å‰é‚£æ ·åœ¨å…·ä½“çš„ç±»ä¸­åˆ›å»ºå…·ä½“çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†å¯¹è±¡çš„åˆ›å»ºäº¤ç»™å®ƒå»å®Œæˆã€‚</span><br></pre></td></tr></table></figure>

<p>éä¾µå…¥å¼è®¾è®¡ï¼šå¼•å…¥äº†æ¡†æ¶ï¼Œå¯¹ç°æœ‰çš„ç±»ç»“æ„æ²¡æœ‰å½±å“ã€‚</p>
<h3 id="IOCæ§åˆ¶åè½¬"><a href="#IOCæ§åˆ¶åè½¬" class="headerlink" title="IOCæ§åˆ¶åè½¬"></a>IOCæ§åˆ¶åè½¬</h3><p>Inversion On Controlï¼Œç®€ç§°IOCã€‚å¯¹è±¡çš„åˆ›å»ºäº¤ç»™å¤–éƒ¨å®¹å™¨è‡ªåŠ¨å®Œæˆï¼Œè¿™ä¸ªå°±å«åšæ§åˆ¶åè½¬ã€‚(æœ‰æ§åˆ¶åè½¬å°±æœ‰æ§åˆ¶æ­£è½¬ï¼Œæ§åˆ¶æ­£è½¬:å¯¹è±¡çš„åˆ›å»ºç”±æˆ‘ä»¬è‡ªå·±åˆ›å»º)</p>
<p>ä¾èµ–æ³¨å…¥dependency injection,ç®€ç§°DIï¼Œç”¨äºå¤„ç†å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»ã€‚</p>
<p><strong>äºŒè€…åŒºåˆ«:</strong><br>æ§åˆ¶åè½¬(IOC):è§£å†³å¯¹è±¡åˆ›å»ºçš„é—®é¢˜ï¼Œ(å¯¹è±¡çš„åˆ›å»ºäº¤ç»™åˆ«äºº)ã€‚<br>ä¾èµ–æ³¨å…¥(DI):åœ¨åˆ›å»ºå®Œå¯¹è±¡åï¼Œå¯¹è±¡å…³ç³»çš„å¤„ç†å°±æ˜¯ä¾èµ–æ³¨å…¥ï¼Œ(é€šè¿‡setæ–¹æ³•ä¾èµ–æ³¨å…¥ã€‚)</p>
<h3 id="AOPé¢å‘åˆ‡é¢"><a href="#AOPé¢å‘åˆ‡é¢" class="headerlink" title="AOPé¢å‘åˆ‡é¢"></a>AOPé¢å‘åˆ‡é¢</h3><p>é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚åˆ‡é¢ï¼Œç®€å•æ¥è¯´å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç±»ï¼Œç”±å¾ˆå¤šé‡å¤ä»£ç å½¢æˆçš„ç±»ã€‚åˆ‡é¢ä¸¾ä¾‹:äº‹åŠ¡ã€æ—¥å¿—ã€æƒé™ã€‚</p>
<h2 id="2-Macä¸‹springé…ç½®"><a href="#2-Macä¸‹springé…ç½®" class="headerlink" title="2.Macä¸‹springé…ç½®"></a>2.Macä¸‹springé…ç½®</h2><p>é…ç½®Springä¸ç®¡åœ¨å“ªä¸ªç¯å¢ƒä¸‹éƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œä¸‹è½½Spring-frameworkï¼Œè§£å‹ç¼©ï¼Œç„¶åå¯¼å…¥ä½¿ç”¨çš„é¡¹ç›®å³å¯ã€‚</p>
<p>spring3.xä¸jdk1.7å…¼å®¹ï¼Œspring4.xä¸jdk1.8æ‰å…¼å®¹ï¼ŒIDEAé»˜è®¤ä¸‹çš„JDKä½¿ç”¨1.8ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>ç›´æ¥é€šè¿‡IDEAåˆ›å»ºé¡¹ç›®é€‰æ‹©springæ¨¡ç‰ˆ<br>å‘ç°ï¼šæ²¡æœ‰springæ¨¡æ¿ï¼Œæ‰“å¼€è®¾ç½®-&gt;plugins-&gt;æœç´¢spring assistant-&gt;å®‰è£…åé‡å¯</p>
<p>ä¾ç„¶æ²¡æœ‰ï¼Œæ²¡æ³•äº†</p>
</blockquote>
<p>![image-20210825183129555](&#x2F;Users&#x2F;liuxuan14&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20210825183129555.png)</p>
<h2 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h2><p>Spring Boot æ˜¯ Pivotal å›¢é˜Ÿåœ¨ Spring çš„åŸºç¡€ä¸Šæä¾›çš„ä¸€å¥—å…¨æ–°çš„å¼€æºæ¡†æ¶ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ– Spring åº”ç”¨çš„æ­å»ºå’Œå¼€å‘è¿‡ç¨‹ã€‚Spring Boot å»é™¤äº†å¤§é‡çš„ XML é…ç½®æ–‡ä»¶ï¼Œç®€åŒ–äº†å¤æ‚çš„ä¾èµ–ç®¡ç†ã€‚</p>
<p>Spring Boot å…·æœ‰ Spring ä¸€åˆ‡ä¼˜ç§€ç‰¹æ€§ï¼ŒSpring èƒ½åšçš„äº‹ï¼ŒSpring Boot éƒ½å¯ä»¥åšï¼Œè€Œä¸”ä½¿ç”¨æ›´åŠ ç®€å•ï¼ŒåŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œæ€§èƒ½æ›´åŠ ç¨³å®šè€Œå¥å£®ã€‚éšç€è¿‘äº›å¹´æ¥å¾®æœåŠ¡æŠ€æœ¯çš„æµè¡Œï¼ŒSpring Boot ä¹Ÿæˆäº†æ—¶ä¸‹ç‚™æ‰‹å¯çƒ­çš„æŠ€æœ¯ã€‚</p>
<h2 id="æ–°å»ºspringå·¥ç¨‹"><a href="#æ–°å»ºspringå·¥ç¨‹" class="headerlink" title="æ–°å»ºspringå·¥ç¨‹"></a>æ–°å»ºspringå·¥ç¨‹</h2><p>ideaæ–°å»ºmavenå·¥ç¨‹ï¼Œé€‰æ‹©æ¨¡ç‰ˆmaven-archetype-quikstartï¼Œä¾èµ–ï¼šspring-coreã€spring-beansã€spring-contextã€‚</p>
<p>archetypeçš„æ„æ€å°±æ˜¯æ¨¡æ¿åŸå‹çš„æ„æ€ï¼ŒåŸå‹æ˜¯ä¸€ä¸ªMavené¡¹ç›®æ¨¡æ¿å·¥å…·åŒ…ã€‚</p>
<p>maven-archetype-quickstartï¼šåœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œé™¤äº†pom.xmlå¤–ï¼Œæ²¡æœ‰å…¶ä»–çš„xmläº†ï¼Œä½†æ˜¯æœ‰mainã€testä¸¤ä¸ªåŒ…ï¼ŒåŒ…é‡Œæ”¾äº†ä¸€ä¸ªAppã€AppTestç±»ã€‚</p>
<p>maven-archetype-webappï¼šåœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œæœ‰WEB-INFç›®å½•ï¼Œå¹¶ä¸”æœ‰web.xmlå’Œä¸€ä¸ªindex.jspã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>spring Bç«™å­¦ä¹ ç¬”è®°</title>
    <url>/2022/01/12/myblog/spring/Spring%20b%E7%AB%99%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="Day-1"><a href="#Day-1" class="headerlink" title="Day 1"></a>Day 1</h2><h3 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h3><p>ç†å¿µï¼šIOCï¼ˆinversion of controlï¼‰AOPï¼ˆaspect oriented programmingï¼‰æ§åˆ¶åè½¬ã€é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p>
<p>1 ã€JavaBeanï¼šä¸€ç§javaè¯­è¨€å†™æˆçš„å¯é‡ç”¨ç»„ä»¶ï¼Œæ›´å¤šæ˜¯ä¸€ç§è§„èŒƒï¼Œå¯ä»¥è¢«å…¶å®ƒçš„ç¨‹åºå‘˜æˆ–è€…æ¡†æ¶ä½¿ç”¨ï¼ŒåŒ…å«ä¸€ç»„setå’Œgetæ–¹æ³•çš„javaå¯¹è±¡ï¼Œå¯ä»¥ä½¿åº”ç”¨ç¨‹åºæ›´åŠ é¢å‘å¯¹è±¡ï¼ŒæŠŠæ•°æ®å°è£…èµ·æ¥ï¼ŒæŠŠåº”ç”¨çš„ä¸šåŠ¡é€»è¾‘å’Œæ˜¾ç¤ºé€»è¾‘åˆ†å¼€ï¼Œé™ä½äº†å¼€å‘çš„å¤æ‚æ€§å’Œç»´æŠ¤æˆæœ¬ã€‚</p>
<p>2.pojoï¼šplain ordinary java objectï¼Œç®€å•çš„javaå¯¹è±¡ï¼Œé‚£äº›æ²¡æœ‰ç»§æ‰¿ä»»ä½•ç±»ã€ä¹Ÿæ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œæ›´æ²¡æœ‰è¢«å…¶å®ƒæ¡†æ¶ä¾µå…¥çš„javaå¯¹è±¡ã€‚ä¸å…è®¸æœ‰ä¸šåŠ¡æ–¹æ³•ï¼Œä¹Ÿä¸èƒ½æºå¸¦connectionä¹‹ç±»çš„æ–¹æ³•ï¼Œå®é™…å°±æ˜¯æ™®é€šJavaBeansã€‚</p>
<p>pojoç±»å’ŒBeanå‡ç”¨äºå®šä¹‰Javaå¯¹è±¡ï¼Œä»¥æé«˜å…¶å¯è¯»æ€§å’Œå¯é‡ç”¨æ€§ã€‚pojoæ²¡æœ‰å…¶ä»–é™åˆ¶ï¼Œè€Œbeanæ˜¯å…·æœ‰æŸäº›é™åˆ¶çš„ç‰¹æ®Špojoã€‚</p>
<p>SpringBeanæ˜¯å—Springç®¡ç†çš„å¯¹è±¡ï¼Œæ‰€æœ‰èƒ½å—Springå®¹å™¨ç®¡ç†çš„å¯¹è±¡éƒ½å¯ä»¥æˆä¸ºSpringBeanã€‚Springä¸­çš„beanï¼Œæ˜¯é€šè¿‡é…ç½®æ–‡ä»¶ã€javaconfigç­‰çš„è®¾ç½®ï¼Œç”±Springè‡ªåŠ¨å®ä¾‹åŒ–ï¼Œç”¨å®Œåè‡ªåŠ¨é”€æ¯çš„å¯¹è±¡ã€‚</p>
<p>3.entityï¼š Entity Beanæ˜¯åŸŸæ¨¡å‹å¯¹è±¡ï¼Œç”¨äºå®ç°O&#x2F;Ræ˜ å°„ï¼Œè´Ÿè´£å°†æ•°æ®åº“ä¸­çš„è¡¨è®°å½•æ˜ å°„ä¸ºå†…å­˜ä¸­çš„Entityå¯¹è±¡ï¼Œäº‹å®ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªEntity Beanå¯¹è±¡ç›¸å½“äºæ–°å»ºä¸€æ¡è®°å½•ï¼Œåˆ é™¤ä¸€ä¸ª Entity Beanä¼šåŒæ—¶ä»æ•°æ®åº“ä¸­åˆ é™¤å¯¹åº”è®°å½•ï¼Œä¿®æ”¹ä¸€ä¸ªEntity Beanæ—¶ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å°†Entity Beançš„çŠ¶æ€å’Œæ•°æ®åº“åŒæ­¥ã€‚</p>
<h3 id="IOCå®¹å™¨"><a href="#IOCå®¹å™¨" class="headerlink" title="IOCå®¹å™¨"></a>IOCå®¹å™¨</h3><p>é‡Œé¢è£…çš„æ˜¯javaå¯¹è±¡ï¼Œåƒä¸€ä¸ªå†œè´¸å¸‚åœºã€‚</p>
<p>ä¸æ˜¯ä»€ä¹ˆæŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå°±æ˜¯å°†åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒï¼Œäº¤ç»™springæ¡†æ¶æ¥ç®¡ç†ã€‚</p>
<p>ä»¥å¾€çš„æ€æƒ³æ˜¯ï¼šè‹¥è¦ä½¿ç”¨æŸä¸ªå¯¹è±¡ï¼Œè‡ªå·±å»è´Ÿè´£å¯¹è±¡çš„åˆ›å»ºã€‚</p>
<p>åè½¬çš„æ€æƒ³ï¼šè‹¥è¦ä½¿ç”¨æŸä¸ªå¯¹è±¡ï¼Œåªéœ€è¦ä»springå®¹å™¨ä¸­è·å–éœ€è¦ä½¿ç”¨çš„å¯¹è±¡ï¼Œä¸å…³å¿ƒå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯æŠŠåˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒåè½¬ç»™äº†springæ¡†æ¶ã€‚</p>
<p>å…·ä½“ä¾‹å­ï¼šè¦åšä¸€ä¸ªé’æ¤’è‚‰ä¸ï¼ŒåŸæœ¬æ˜¯éœ€è¦ç§é’æ¤’å’Œå…»çŒªçš„ï¼Œè€Œæœ‰äº†springï¼Œåªéœ€è¦å»å†œè´¸å¸‚åœºä¹°é’æ¤’å’ŒçŒªè‚‰ï¼Œå°±å¯ä»¥ã€‚</p>
<p>springå®˜ç½‘ï¼š<a href="https://spring.io/">https://spring.io</a></p>
<h2 id="Day-2"><a href="#Day-2" class="headerlink" title="Day 2"></a>Day 2</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>mavenä»“åº“ï¼š<a href="https://mvnrepository.com/">https://mvnrepository.com</a></p>
<p>releaseç¨³å®šç‰ˆæœ¬ã€‚ </p>
<h3 id="springæ¡†æ¶æ¦‚å¿µ"><a href="#springæ¡†æ¶æ¦‚å¿µ" class="headerlink" title="springæ¡†æ¶æ¦‚å¿µ"></a>springæ¡†æ¶æ¦‚å¿µ</h3><p>springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¼€æºçš„JavaEEæ¡†æ¶ã€‚</p>
<p>è½»é‡çº§ï¼šä½“ç§¯æ¯”è¾ƒå°ï¼Œé‡Œé¢çš„jaråŒ…æ¯”è¾ƒå°‘ã€‚è§£å†³ä¼ä¸šåº”ç”¨å¼€å‘çš„å¤æ‚æ€§ã€‚</p>
<p>springæœ‰ä¸¤ä¸ªæ ¸å¿ƒå†…å®¹ï¼šIOCæ§åˆ¶åè½¬ï¼ŒåŸå§‹éœ€è¦newä¸ªç±»æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œiocå°†åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹äº¤ç»™springã€‚AOPé¢å‘åˆ‡é¢ï¼Œç¨‹åºä¸­æ‰©å±•ä¸ªåŠŸèƒ½ï¼ŒåŸå§‹éœ€è¦ä¿®æ”¹æºä»£ç æ¥å®ç°ï¼Œè€Œspringä¸éœ€è¦ä¿®æ”¹ä»£ç è¿›è¡ŒåŠŸèƒ½å¢å¼ºã€‚å½“ç„¶è¿˜æœ‰äº‹åŠ¡ã€mvcç­‰æ“ä½œã€‚</p>
<p>springæ¡†æ¶çš„ç›¸å…³ç‰¹ç‚¹ï¼š1.æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘ï¼Œiocåˆ›å»ºå¯¹è±¡åŒ…æ‹¬è°ƒç”¨é€šè¿‡springå®ç°ï¼Œä½¿å¾—è€¦åˆåº¦é™ä½ã€‚2.Aopç¼–ç¨‹æ”¯æŒã€‚3.æ–¹ä¾¿ç¨‹åºæµ‹è¯•ã€‚4.æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶ï¼šhibernateã€strutsã€mybatisã€‚5.é™ä½javaEE APIçš„ä½¿ç”¨ï¼šjdbcç­‰ã€‚6.æ–¹ä¾¿è¿›è¡Œäº‹åŠ¡æ“ä½œã€‚</p>
<p>ä¸‹è½½å®˜ç½‘ï¼šspring.ioï¼Œåè·ŸGAçš„æ˜¯ç¨³å®šç‰ˆæœ¬ã€‚</p>
<p><a href="https://repo.spring.io/ui/native/release/org/springframework/spring/">https://repo.spring.io/ui/native/release/org/springframework/spring/</a> 5.2.6ç‰ˆæœ¬ã€‚ä¸‹è½½spring-5.2.6.RELEASE-dist.zipã€‚docsæ–‡ä»¶å¤¹ä¸‹æ˜¯ä¸€äº›æ–‡æ¡£ã€libsæ˜¯ä¸€äº›jaråŒ…ã€schemaæ˜¯ä¸€äº›é…ç½®æ–‡ä»¶ã€‚jaråŒ…ä¸­æ¯ä¸€ç§éƒ½æœ‰ä¸‰ä¸ªï¼šjaråŒ…ã€æ–‡æ¡£ã€æºä»£ç ã€‚</p>
<h3 id="spring5æ¨¡å—"><a href="#spring5æ¨¡å—" class="headerlink" title="spring5æ¨¡å—"></a>spring5æ¨¡å—</h3><p>ä»ä¸‹å¾€ä¸Š</p>
<p>testç›¸å…³æµ‹è¯•</p>
<p>Core Containerï¼šåŒ…å«beansã€coreï¼ˆå‰ä¸¤ä¸ªå¯¹åº”IOCï¼‰ã€contextã€expressionã€‚åŸºæœ¬åŠŸèƒ½è‡³å°‘è¦æœ‰è¿™å››ä¸ªjaråŒ…ã€‚commons-loggingåŒ…æ—¥å¿—ç›¸å…³çš„jaråŒ…ã€‚</p>
<p>å†å¾€ä¸Šæ˜¯Aopï¼Œå†å¾€ä¸Šæ˜¯æ•°æ®è®¿é—®éƒ¨åˆ†å’Œç½‘ç»œéƒ¨åˆ†ã€‚</p>
<h3 id="å¯¼å…¥jaråŒ…ï¼Œioc-xmlæ¡ˆä¾‹"><a href="#å¯¼å…¥jaråŒ…ï¼Œioc-xmlæ¡ˆä¾‹" class="headerlink" title="å¯¼å…¥jaråŒ…ï¼Œioc+xmlæ¡ˆä¾‹"></a>å¯¼å…¥jaråŒ…ï¼Œioc+xmlæ¡ˆä¾‹</h3><p>ä¸ç”¨mavençš„æƒ…å†µä¸‹ï¼Œå·¥ç¨‹ä¸‹æ–°å»ºlibæ–‡ä»¶å¤¹ï¼Œå°†è¦ç”¨çš„jaråŒ…ï¼ˆåªè¦jaråŒ…ï¼‰å¤åˆ¶åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œå†åœ¨file-project structureä¸­ï¼Œé€‰æ‹©moduleï¼ŒåŠ +å·å¯¼å…¥ç›¸å…³çš„jaråŒ…ã€‚</p>
<p>æ¢ç©¶iocï¼Œåˆ›å»ºä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œç±»å†…åˆ›å»ºä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">    	System.out.println(<span class="string">&quot;add&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ™®é€šçš„åˆ›å»ºå¯¹è±¡æ˜¯é€šè¿‡newæ¥å®ç°ï¼Œç”¨springåˆ›å»ºå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶åšåˆ°ï¼Œå¯ä»¥é€šè¿‡æ³¨è§£åšåˆ°ã€‚</p>
<p>å› æ­¤ï¼Œåˆ›å»ºspringé…ç½®æ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®åˆ›å»ºçš„å¯¹è±¡ã€‚<br>ï¼ˆ1ï¼‰springé…ç½®æ–‡ä»¶ä½¿ç”¨xmlæ ¼å¼ï¼Œbean1.xmlï¼Œç”¨beanæ ‡ç­¾è¿›è¡Œé…ç½®ï¼Œidæ˜¯åˆ«åï¼Œclassæ˜¯ç±»è·¯å¾„+åå­—ã€‚ï¼ˆå¯¼äº†åŒ…æ‰å¯ä»¥æ–°å»ºxmlæ—¶å‡ºç°spring configï¼‰</p>
<blockquote>
<p>Create project from template æ˜¯æ˜¯å¦åˆ›å»ºæ¨¡æ¿çš„æ„æ€ï¼Œä¼šå¤šä¸€äº›å†…å®¹ã€‚</p>
<p>æ‰“åŒ…jaråŒ…ï¼š<a href="https://blog.csdn.net/weixin_45760579/article/details/114777280">https://blog.csdn.net/weixin_45760579/article/details/114777280</a></p>
<p>å¦‚ä½•è·å–jaråŒ…ï¼Œ<a href="https://mvnrepository.com/">https://mvnrepository.com</a> æœç´¢å³å¯</p>
</blockquote>
<p>åœ¨srcæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºxmlæ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-é…ç½®Userå¯¹è±¡åˆ›å»º--&gt;</span><br><span class="line">&lt;bean id=&quot;user&quot; class=&quot;com.company.User&quot;&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰è¿›è¡Œæµ‹è¯•ä»£ç ç¼–å†™ï¼ŒåŠ è½½springé…ç½®æ–‡ä»¶ï¼Œè·å–é…ç½®åˆ›å»ºçš„å¯¹è±¡ã€‚</p>
<p>com.companyä¸‹åˆ›å»ºtestdemoåŒ…ï¼ŒåŒ…ä¸‹æ–°å»ºTestXMLç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestXML</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span>   <span class="comment">//å•å…ƒæµ‹è¯•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.åŠ è½½springé…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸åœ¨srcä¸‹ï¼Œéœ€è¦è·¯å¾„+åç§°</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean1.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//2.è·å–é…ç½®åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        user.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Day-3"><a href="#Day-3" class="headerlink" title="Day 3"></a>Day 3</h2><h3 id="IOCå®¹å™¨-1"><a href="#IOCå®¹å™¨-1" class="headerlink" title="IOCå®¹å™¨"></a>IOCå®¹å™¨</h3><p>æ§åˆ¶åè½¬ï¼Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œé™ä½ä»£ç è€¦åˆåº¦ã€‚é€šè¿‡æ§åˆ¶åè½¬ï¼Œå¯¹è±¡åœ¨è¢«åˆ›å»ºæ—¶ï¼Œç”±ä¸€ä¸ªè°ƒæ§ç³»ç»Ÿå†…æ‰€æœ‰å¯¹è±¡çš„å¤–ç•Œå®ä½“å°†å…¶æ‰€ä¾èµ–çš„å¯¹è±¡çš„å¼•ç”¨ä¼ é€’ç»™å®ƒï¼Œä¹Ÿå«ä¾èµ–æ³¨å…¥DIã€‚</p>
<p>é€šä¿—ï¼šåˆ›å»ºå¯¹è±¡ï¼ŒåŸå§‹æ–¹æ³•newå¯¹è±¡ï¼ŒIOCæŠŠå¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡ä¹‹é—´çš„è°ƒç”¨è¿‡ç¨‹éƒ½äº¤ç»™Springè¿›è¡Œç®¡ç†ã€‚ä½¿ç”¨IOCæ¥ä½¿å¾—è€¦åˆåº¦é™ä½ã€‚</p>
<p>ä¸¤ç§æ–¹å¼è¿›è¡ŒBeanç®¡ç†ï¼š1.åŸºäºxmlé…ç½®æ–‡ä»¶  2.åŸºäºæ³¨è§£æ–¹å¼</p>
<h3 id="IOCåº•å±‚åŸç†"><a href="#IOCåº•å±‚åŸç†" class="headerlink" title="IOCåº•å±‚åŸç†"></a>IOCåº•å±‚åŸç†</h3><p>ï¼ˆ1ï¼‰xmlè§£æã€å·¥å‚æ¨¡å¼ã€åå°„</p>
<p>åŸå§‹æ–¹å¼ï¼šä¸€ä¸ªç±»å†…è°ƒç”¨å¦ä¸€ä¸ªç±»çš„æ–¹æ³•ï¼Œéœ€è¦åœ¨ç±»Aä¸­åˆ›å»ºä¸€ä¸ªç±»Bçš„å¯¹è±¡ï¼Œå†é€šè¿‡ç±»Bçš„å¯¹è±¡è°ƒç”¨ç±»Bçš„æ–¹æ³•ã€‚è¿™æ ·åšçš„ç¼ºç‚¹ï¼šè€¦åˆåº¦å¤ªé«˜ï¼Œç±»Bçš„è·¯å¾„å’Œæ–¹æ³•å¦‚æœæ”¹å˜çš„è¯ï¼Œç±»Aä¹Ÿè¦è·Ÿç€è¯¥ï¼Œä¸åˆ©äºç¨‹åºæ‰©å±•ã€‚</p>
<p>å·¥å‚æ¨¡å¼è¿›è¡Œè§£è€¦åˆï¼šé™¤äº†ç±»Aå’Œç±»Bï¼Œè¿˜æ–°å»ºä¸€ä¸ªå·¥å‚ç±»ï¼Œé‡Œé¢public staticæ–¹æ³•ä¸­ï¼šreturn new B()ï¼› è¿”å›ç±»Bçš„å¯¹è±¡ï¼Œå› æ­¤åœ¨ç±»Aä¸­è°ƒç”¨ç±»Bçš„æ–¹æ³•æ—¶ï¼Œè°ƒç”¨å·¥å‚ç±»çš„æ–¹æ³•æ¥åˆ›å»ºç±»Bçš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ç±»Bçš„æ–¹æ³•ã€‚é™ä½ç±»Aå’Œç±»Bä¹‹é—´çš„è€¦åˆåº¦ã€‚æ€»ç»“æ¥è¯´ï¼Œé€šè¿‡å·¥å‚ç±»æ¥åˆ›å»ºå¯¹è±¡ï¼Œå®ç°è§£è€¦ã€‚</p>
<p>ï¼ˆ2ï¼‰IOCè¿‡ç¨‹ï¼šxmlè§£æã€å·¥å‚æ¨¡å¼ã€åå°„</p>
<p>ç¬¬ä¸€æ­¥ï¼šxmlé…ç½®æ–‡ä»¶ï¼Œé…ç½®åˆ›å»ºçš„å¯¹è±¡</p>
<p><code>&lt;bean id=&quot;dao&quot; class=&quot;UserDao&quot;&gt;&lt;/bean&gt; </code></p>
<p>ç¬¬äºŒæ­¥ï¼šæœ‰serviceç±»ï¼ˆAç±»ï¼‰å’Œdaoç±»ï¼ˆBç±»ï¼‰ï¼Œåˆ›å»ºå·¥å‚ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserFactory</span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> UserDao <span class="title function_">getDao</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">classValue</span> <span class="operator">=</span> classå±æ€§å€¼; <span class="comment">//1.xmlè§£æï¼Œå¤šç§æ–¹å¼ï¼Œå¯ä»¥ç”¨dom4jå®ç°</span></span><br><span class="line">      	<span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(classValue); <span class="comment">//2.ç”¨åå°„æŠ€æœ¯åˆ›å»ºå¯¹è±¡ï¼Œå¾—åˆ°ç±»çš„å­—èŠ‚ç æ–‡ä»¶</span></span><br><span class="line">      	<span class="keyword">return</span> (UserDao)clazz.newInstance();  <span class="comment">//3.å¾—åˆ°å¯¹è±¡ï¼Œå¼ºè½¬ä¸€ä¸‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›ä¸€æ­¥è§£è€¦ï¼Œä¾‹å¦‚å½“daoç±»è·¯å¾„æ”¹äº†ï¼Œè¿™é‡Œä¸éœ€è¦ä¿®æ”¹serviceç±»ï¼Œåªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶é‡Œçš„ç±»è·¯å¾„ã€‚</p>
<h3 id="IOCæ¥å£ï¼ˆBeanFactoryï¼‰"><a href="#IOCæ¥å£ï¼ˆBeanFactoryï¼‰" class="headerlink" title="IOCæ¥å£ï¼ˆBeanFactoryï¼‰"></a>IOCæ¥å£ï¼ˆBeanFactoryï¼‰</h3><p>IOCæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæ€æƒ³ä¸­åŸºäºå®¹å™¨æ¥å®Œæˆï¼Œå®¹å™¨æœ¬è´¨ä¸Šå°±æ˜¯<strong>å¯¹è±¡å·¥å‚</strong>ï¼Œåœ¨é‡Œé¢å¯ä»¥è¯»å–é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡åå°„åˆ›å»ºå¯¹è±¡ã€‚å› æ­¤ï¼ŒIOCæ€æƒ³åŸºäºIOCå®¹å™¨ï¼ŒIOCå®¹å™¨ï¼Œåº•å±‚æœ¬è´¨æ˜¯å¯¹è±¡å·¥å‚ã€‚</p>
<p>å·¥å‚éœ€è¦å®ä¾‹åŒ–ï¼ŒSpringæä¾›IOCå®¹å™¨å®ç°çš„ä¸¤ç§æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªé‡è¦çš„æ¥å£ï¼šéƒ½èƒ½å®ç°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡å·¥å‚åˆ›å»ºå¯¹è±¡ã€‚</p>
<p>ï¼ˆ1ï¼‰BeanFactoryï¼šIOCå®¹å™¨åŸºæœ¬å®ç°ï¼ŒSpringé‡Œé¢å†…éƒ¨çš„ä½¿ç”¨æ¥å£ï¼Œä¸€èˆ¬å¼€å‘äººå‘˜ä¸ä½¿ç”¨ã€‚<br>*åŠ è½½é…ç½®æ–‡ä»¶æ—¶ä¸ä¼šåˆ›å»ºå¯¹è±¡ï¼Œåœ¨è·å–å¯¹è±¡ï¼ˆä½¿ç”¨ï¼‰æ—¶æ‰å»åˆ›å»ºå¯¹è±¡ã€‚</p>
<p>ï¼ˆ2ï¼‰ApplicationContextï¼šBeanFactoryæ¥å£çš„å­æ¥å£ï¼Œæä¾›æ›´å¤šæ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ç”±å¼€å‘äººå‘˜ä½¿ç”¨ã€‚<br>*åŠ è½½é…ç½®æ–‡ä»¶æ—¶å°±ä¼šæŠŠé…ç½®æ–‡ä»¶å¯¹è±¡è¿›è¡Œåˆ›å»º</p>
<p>è¿™ä¸¤ç§ï¼Œå“ªç§æ›´å¥½ï¼Œè™½ç„¶ç¬¬ä¸€ç§èŠ‚çº¦èµ„æºï¼Œä½†æ˜¯ä¸€èˆ¬springæ¡†æ¶ç»“åˆwebé¡¹ç›®ï¼Œç”¨tomcatè¿›è¡Œå¯åŠ¨ï¼Œå› æ­¤è€—æ—¶å¥½èµ„æºçš„å·¥ä½œéƒ½åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è¿›è¡Œæ“ä½œã€‚</p>
<hr>
<p>ApplicationContextæ¥å£æœ‰ä¸åŒçš„å®ç°ç±»ï¼ˆcontrol+hæ‰“å¼€ï¼Œï¼‰</p>
<p>ä¾‹å¦‚ï¼šä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œä¸€ä¸ªç±»è·¯å¾„ã€‚</p>
<p><img src="/images/applicationContext.png"></p>
<h3 id="IOCæ“ä½œBeanç®¡ç†ï¼ˆåŸºäºXMLï¼‰"><a href="#IOCæ“ä½œBeanç®¡ç†ï¼ˆåŸºäºXMLï¼‰" class="headerlink" title="IOCæ“ä½œBeanç®¡ç†ï¼ˆåŸºäºXMLï¼‰"></a>IOCæ“ä½œBeanç®¡ç†ï¼ˆåŸºäºXMLï¼‰</h3><p> ä»€ä¹ˆæ˜¯Beanç®¡ç†ï¼Ÿï¼š1.Springåˆ›å»ºå¯¹è±¡ï¼Œ2.ç”¨Springæ³¨å…¥å±æ€§ï¼ˆåˆ›å»ºå¯¹è±¡æ—¶å‘å˜é‡è®¾ç½®å€¼ï¼Œæœ€æ™®é€šçš„è¯ç”¨setæ–¹æ³•è®¾ç½®å€¼ï¼Œä½†æ˜¯ç°åœ¨ç”¨springåšåˆ°ï¼‰</p>
<p>ï¼ˆ1ï¼‰åŸºäºxmlæ–¹å¼åˆ›å»ºå¯¹è±¡</p>
<p>åšæ³•ï¼šåœ¨springé…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨beanæ ‡ç­¾ï¼Œæ ‡ç­¾é‡Œé¢æ·»åŠ å¯¹åº”å±æ€§ï¼Œå°±å¯ä»¥å®ç°å¯¹è±¡åˆ›å»ºã€‚<code>&lt;bean id=&quot;dao&quot; class=&quot;UserDao&quot;&gt;&lt;/bean&gt;</code></p>
<p>åœ¨beanæ ‡ç­¾ä¸­æœ‰å¾ˆå¤šå±æ€§ï¼š<br>*idå±æ€§ï¼šç»™å¯¹è±¡å–ä¸€ä¸ªåˆ«åï¼Œå”¯ä¸€æ ‡è¯†<br>*classå±æ€§ï¼šç±»å…¨è·¯å¾„ï¼ˆåŒ…å«è·¯å¾„ï¼‰<br>*nameå±æ€§ï¼šå’Œidä¸€æ ·ä½œç”¨ï¼Œidå±æ€§ä¸­ä¸èƒ½åŠ ç‰¹æ®Šç¬¦å·ï¼Œnameå±æ€§ä¸­å¯ä»¥åŠ ç‰¹æ®Šç¬¦å·ï¼Œnameå±æ€§æ¯”è¾ƒæ—©æœŸï¼Œç”¨å¾—å°‘ã€‚</p>
<p>Xmlåˆ›å»ºå¯¹è±¡æ—¶ï¼Œé»˜è®¤æ‰§è¡Œæ— å‚æ•°çš„æ„é€ æ–¹æ³•å®Œæˆå¯¹è±¡åˆ›å»ºã€‚å› æ­¤ï¼Œå¦‚æœç±»é‡Œåˆ›å»ºäº†æœ‰å‚æ„é€ ä½†æ˜¯æ²¡æœ‰å£°æ˜æ— å‚æ„é€ ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
<blockquote>
<p>IDEAä¸ºä¸€ä¸ªç±»åˆ›å»ºæ„é€ æ–¹æ³•ã€setæ–¹æ³•ã€getæ–¹æ³•å¿«æ·é”®ï¼šalt+insertï¼ˆWindowsï¼‰command+nï¼ˆMacï¼‰</p>
</blockquote>
<p>ï¼ˆ2ï¼‰åŸºäºxmlæ–¹å¼æ³¨å…¥å±æ€§</p>
<p>DIï¼šä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯æ³¨å…¥å±æ€§ã€‚</p>
<p>&lt;1&gt;ç¬¬ä¸€ç§æ³¨å…¥å±æ€§æ–¹å¼ï¼šä½¿ç”¨setæ–¹æ³•è¿›è¡Œæ³¨å…¥ã€‚</p>
<p>é¦–å…ˆåœ¨ç±»ä¸­å®šä¹‰å±æ€§ï¼Œå¹¶å®šä¹‰å¯¹åº”çš„setæ–¹æ³•ï¼Œä¸€ä¸ªå±æ€§å¯¹åº”ä¸€ä¸ªsetæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String bname;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBname</span><span class="params">(String bname)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.bname = bname;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDemo</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(bname);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶æ¬¡åœ¨springé…ç½®æ–‡ä»¶ä¸­é…ç½®å¯¹è±¡åˆ›å»ºï¼Œé…ç½®å±æ€§æ³¨å…¥ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.Book&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä½¿ç”¨propertyå®Œæˆå±æ€§æ³¨å…¥</span></span><br><span class="line"><span class="comment">    	nameï¼šç±»é‡Œå±æ€§åç§°</span></span><br><span class="line"><span class="comment">    	valueï¼šå‘å±æ€§æ³¨å…¥çš„å€¼</span></span><br><span class="line"><span class="comment">    	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;è¥¿æ¸¸è®°&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€åå†™ä¸€ä¸ªæµ‹è¯•ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestXML</span> &#123;</span><br><span class="line">  <span class="comment">//ä¸€ä¸ªç±»ä¸‹å°±è¡Œ</span></span><br><span class="line">    <span class="meta">@Test</span>   <span class="comment">//å•å…ƒæµ‹è¯•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBook</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.åŠ è½½springé…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸åœ¨srcä¸‹ï¼Œéœ€è¦è·¯å¾„+åç§°</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean1.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//ApplicationContextä¹Ÿå¯ä»¥æ¢ä¸ºBeanFactory</span></span><br><span class="line">        <span class="comment">//2.è·å–é…ç½®åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;book&quot;</span>, Book.class);</span><br><span class="line">        System.out.println(book);</span><br><span class="line">        book.testDemo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&lt;2&gt;ç¬¬äºŒç§æ³¨å…¥å±æ€§æ–¹å¼ï¼šæœ‰å‚æ„é€ è¿›è¡Œæ³¨å…¥</p>
<p>é¦–å…ˆåœ¨ç±»ä¸­å®šä¹‰å±æ€§ï¼Œå¹¶å®šä¹‰æœ‰å‚æ„é€ å‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Music</span>&#123;</span><br><span class="line">		<span class="keyword">private</span> String mname;</span><br><span class="line">		<span class="keyword">private</span> String mauthor;</span><br><span class="line">		<span class="comment">//æœ‰å‚æ„é€ </span></span><br><span class="line">		<span class="keyword">public</span> <span class="title function_">Music</span><span class="params">(String mname, String mauthor)</span>&#123;</span><br><span class="line">				<span class="built_in">this</span>.mname = mname;</span><br><span class="line">				<span class="built_in">this</span>.mauthor = mauthor;</span><br><span class="line">		&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDemo</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(mname+<span class="string">&quot;::&quot;</span>+mauthor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶æ¬¡ï¼Œåœ¨Springé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œä½¿ç”¨æœ‰å‚æ„é€ åˆ›å»ºå¯¹è±¡</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;music&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.Music&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä½¿ç”¨æœ‰å‚æ„é€ è¿›è¡Œæ³¨å…¥</span></span><br><span class="line"><span class="comment">    	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;mname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å€¾åŸ&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;mauthor&quot;</span> <span class="attr">value</span>=<span class="string">&quot;é™ˆå¥•è¿…&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--nameæ˜¯ä½¿ç”¨åç§°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç´¢å¼•å€¼indexï¼Œindex=&quot;0&quot; è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œå†™ä¸€ä¸ªæµ‹è¯•ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span>   <span class="comment">//å•å…ƒæµ‹è¯•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMusic</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.åŠ è½½springé…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸åœ¨srcä¸‹ï¼Œéœ€è¦è·¯å¾„+åç§°</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean1.xml&quot;</span>);</span><br><span class="line">    <span class="comment">//ApplicationContextä¹Ÿå¯ä»¥æ¢ä¸ºBeanFactory</span></span><br><span class="line">    <span class="comment">//2.è·å–é…ç½®åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line">    <span class="type">Music</span> <span class="variable">music</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;music&quot;</span>, Music.class);</span><br><span class="line">    System.out.println(music);</span><br><span class="line">    music.testDemo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Day-4"><a href="#Day-4" class="headerlink" title="Day 4"></a>Day 4</h2><h3 id="ä½¿ç”¨Påç§°ç©ºé—´æ³¨å…¥"><a href="#ä½¿ç”¨Påç§°ç©ºé—´æ³¨å…¥" class="headerlink" title="ä½¿ç”¨Påç§°ç©ºé—´æ³¨å…¥"></a>ä½¿ç”¨Påç§°ç©ºé—´æ³¨å…¥</h3><p>é’ˆå¯¹setæ–¹æ³•è¿›è¡Œå±æ€§æ³¨å…¥ï¼Œå¯ä»¥ä½¿ç”¨påç§°ç©ºé—´æ³¨å…¥ï¼Œæ¥ç®€åŒ–xmlé…ç½®æ–¹å¼ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šæ·»åŠ påç§°ç©ºé—´åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚</p>
<p><code>xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</code></p>
<p>ç¬¬äºŒæ­¥ï¼šè¿›è¡Œå±æ€§æ³¨å…¥ï¼Œåœ¨beanæ ‡ç­¾é‡Œè¿›è¡Œæ“ä½œ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.Book&quot;</span> <span class="attr">p:bname</span>=<span class="string">&quot;çº¢æ¥¼æ¢¦&quot;</span> <span class="attr">p:bauthor</span>=<span class="string">&quot;æ›¹é›ªèŠ¹&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlæ³¨å…¥å…¶ä»–ç±»å‹å±æ€§ï¼‰"><a href="#IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlæ³¨å…¥å…¶ä»–ç±»å‹å±æ€§ï¼‰" class="headerlink" title="IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlæ³¨å…¥å…¶ä»–ç±»å‹å±æ€§ï¼‰"></a>IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlæ³¨å…¥å…¶ä»–ç±»å‹å±æ€§ï¼‰</h3><p>1.å­—é¢é‡ï¼šä¸ç‰¹æ®Šçš„å±æ€§</p>
<p>ï¼ˆ1ï¼‰nullå€¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;property name=&quot;bname&quot;&gt;</span><br><span class="line">   &lt;null/&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å±æ€§å€¼åŒ…å«ç‰¹æ®Šç¬¦å·</p>
<p>å¯ä»¥å°†ç‰¹æ®Šç¬¦å·è¿›è¡Œè½¬ä¹‰</p>
<p><code>&lt;property name=&quot;bname&quot; value=&quot;&amp;lt;&amp;gt;ã€Šè¥¿æ¸¸è®°ã€‹&quot;&gt;&lt;/property&gt;</code></p>
<p>ä¹Ÿå¯ä»¥æŠŠå¸¦æœ‰ç‰¹æ®Šç¬¦å·å†…å®¹å†™åˆ°CDATA</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;property name=&quot;bname&quot;&gt; </span><br><span class="line">  &lt;value&gt;&lt;![CDATA[ã€Šå—äº¬ã€‹]]&gt;&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<p>2.æ³¨å…¥å±æ€§-å¤–éƒ¨bean</p>
<p>webå±‚è°ƒç”¨serviceå±‚ï¼Œserviceè°ƒç”¨daoå±‚</p>
<p>ï¼ˆ1ï¼‰åˆ›å»ºä¸¤ä¸ªç±»serviceç±»å’Œdaoç±»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class UserService&#123;</span><br><span class="line">	public void add()&#123;</span><br><span class="line">		System.out.println(&quot;service add.....&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface UserDao&#123;</span><br><span class="line">	public void update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰åœ¨serviceè°ƒç”¨daoé‡Œé¢çš„æ–¹æ³•</p>
<p>åŸå§‹æ–¹å¼ï¼šserviceä¸­åˆ›å»ºUserDaoå¯¹è±¡ï¼Œå†è°ƒç”¨ç±»ä¸­æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">userDao.update();</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼šç”¨springçš„xmlé…ç½®æ–¹æ³•è¿›è¡Œè°ƒç”¨</p>
<p>é¦–å…ˆé…ç½®æ–‡ä»¶ä¸­åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œç„¶åå°†Daoå¯¹è±¡æ³¨å…¥åˆ°Serviceå¯¹è±¡ä¸­ã€‚setæ³¨å…¥æˆ–æœ‰å‚æ³¨å…¥éƒ½è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//UserServiceç±»ä¸­åˆ›å»ºUserDaoç±»å‹å±æ€§ï¼Œç”Ÿæˆsetæ–¹æ³•</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.service.UserService&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.dao.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>refå±æ€§ï¼šåˆ›å»ºuserDaoå¯¹è±¡beanæ ‡ç­¾idå€¼ï¼Œå®Œæˆå¤–éƒ¨beanæ³¨å…¥</p>
<p>å†™æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBean</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span>   <span class="comment">//å•å…ƒæµ‹è¯•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.åŠ è½½springé…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸åœ¨srcä¸‹ï¼Œéœ€è¦è·¯å¾„+åç§°</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean2.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//ApplicationContextä¹Ÿå¯ä»¥æ¢ä¸ºBeanFactory</span></span><br><span class="line">        <span class="comment">//2.è·å–é…ç½®åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">        System.out.println(userService);</span><br><span class="line">        userService.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.æ³¨å…¥å±æ€§-å†…éƒ¨beanå’Œçº§è”èµ‹å€¼</p>
<p>ï¼ˆ1ï¼‰ä¸€å¯¹å¤šå…³ç³»ï¼šéƒ¨é—¨å’Œå‘˜å·¥</p>
<p>ï¼ˆ2ï¼‰åœ¨å®ä½“ä¹‹é—´è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼Œå†™éƒ¨é—¨ç±»å’Œå‘˜å·¥ç±»ï¼Œå‘˜å·¥è¡¨ç¤ºæ‰€å±éƒ¨é—¨ï¼Œä½¿ç”¨å¯¹è±¡ç±»å‹å±æ€§è¿›è¡Œè¡¨ç¤ºã€‚</p>
<p>ï¼ˆ3ï¼‰åœ¨springé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®</p>
<p>åœ¨empå¯¹è±¡åˆ›å»ºæ—¶ï¼Œæœ‰ä¸€ä¸ªå±æ€§æ˜¯deptï¼Œå¯ä»¥ç”¨refå¤–éƒ¨beançš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ç”¨å†…éƒ¨beançš„æ–¹å¼ã€‚ç›¸å½“äºæ˜¯åµŒå¥—beanäº†ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å†…éƒ¨bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.bean.Emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¼ ä¸‰&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç”·&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.bean.Dept&quot;</span>&gt;</span></span><br><span class="line">	            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç ”å‘éƒ¨&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰æµ‹è¯•æ–¹æ³•</p>
<p>4.æ³¨å…¥å±æ€§â€“çº§è”èµ‹å€¼</p>
<p>çº§è”èµ‹å€¼æŒ‡çš„æ˜¯ä¸€ä¸ªç±»å†…æœ‰å…¶ä»–ç±»çš„å¯¹è±¡ä½œä¸ºå±æ€§ï¼Œå¯ä»¥ç”¨å¤–éƒ¨beançš„æ–¹æ³•refï¼Œä¹Ÿå¯ä»¥å†…éƒ¨beançš„æ–¹æ³•ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.bean.Emp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æå››&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dept&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept.dname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æµ‹è¯•éƒ¨é—¨&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.bean.Dept&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept.dname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;è´¢åŠ¡éƒ¨&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºæµ‹è¯•éƒ¨é—¨ï¼Œè€Œä¸æ˜¯è´¢åŠ¡éƒ¨ã€‚</p>
<h3 id="IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlæ³¨å…¥é›†åˆå±æ€§ï¼‰"><a href="#IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlæ³¨å…¥é›†åˆå±æ€§ï¼‰" class="headerlink" title="IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlæ³¨å…¥é›†åˆå±æ€§ï¼‰"></a>IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlæ³¨å…¥é›†åˆå±æ€§ï¼‰</h3><p>1.æ³¨å…¥æ•°ç»„ç±»å‹å±æ€§ï¼Œæ³¨å…¥Listé›†åˆç±»å‹å±æ€§ï¼Œæ³¨å…¥Mapé›†åˆç±»å‹å±æ€§</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Stu</span>&#123;</span><br><span class="line">    <span class="comment">//1 æ•°ç»„ç±»å‹å±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> String[] course;</span><br><span class="line">    <span class="comment">//2 listé›†åˆç±»å‹å±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; lists;</span><br><span class="line">    <span class="comment">//3 mapé›†åˆç±»å‹å±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt;maps;</span><br><span class="line">    <span class="comment">//4 seté›†åˆ</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt;sets;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCourse</span><span class="params">(String[] course)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.course = course;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSets</span><span class="params">(Set&lt;String&gt; sets)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sets = sets;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setList</span><span class="params">(List&lt;String&gt; lists)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lists = lists;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMaps</span><span class="params">(Map&lt;String, String&gt; maps)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.maps = maps;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.åœ¨springé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é›†åˆç±»å‹å±æ€§æ³¨å…¥ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;stu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.collectiontype.Stu&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;course&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>æ•°æ®åº“<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>java<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lists&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>æ•°æ®åº“<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>java<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maps&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;JAVA&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;PHP&quot;</span> <span class="attr">value</span>=<span class="string">&quot;php&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sets&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>redis<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ•°ç»„å¦‚æœç›´æ¥è¾“å‡ºï¼Œä¸æ˜¯å€¼ï¼Œè€Œæ˜¯åœ°å€å€¼ï¼Œéœ€è¦Arrays.toString()</p>
</blockquote>
<p>3.é›†åˆä¸­è®¾ç½®å¯¹è±¡ç±»å‹å€¼</p>
<p> beané…ç½®ä¸­ï¼Œåˆ›å»ºå¤šä¸ªcourseå¯¹è±¡ï¼Œç„¶åç”¨refæ³¨å…¥åˆ°stuå¯¹è±¡çš„é›†åˆå±æ€§ä¸­ã€‚</p>
<p>æ³¨æ„ï¼šè¿™é‡ŒCourseç±»ä¸­æ²¡æœ‰é‡å†™toStringç±»çš„è¯ï¼Œè¾“å‡ºclistä¸­çš„å€¼æ˜¯å¯¹è±¡åœ°å€ï¼Œåªæœ‰é‡å†™Courseç±»ä¸­çš„toStringæ–¹æ³•ï¼Œè¾“å‡ºæ‰èƒ½æ˜¯å¯¹è±¡ä¸­çš„å„ç§å±æ€§å€¼ã€‚</p>
<p>4.æŠŠé›†åˆæ³¨å…¥éƒ¨åˆ†æå–å‡ºæ¥ä½œä¸ºå…¬å…±éƒ¨åˆ†</p>
<p>ï¼ˆ1ï¼‰åœ¨Springé…ç½®æ–‡ä»¶ä¸­å¼•å…¥åç§°ç©ºé—´util</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æå–listé›†åˆå±æ€§æ³¨å…¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æå–listé›†åˆå±æ€§æ³¨å…¥,å¤šä¸ªbeanéƒ½å¯ä½¿ç”¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;stulist&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>è¯¾ç¨‹1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>è¯¾ç¨‹2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨å…¬å…±listé›†åˆ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;stu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.collectiontype.Stu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lists&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;stulist&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="IOCæ“ä½œBeanç®¡ç†ï¼ˆFactoryBeanï¼‰"><a href="#IOCæ“ä½œBeanç®¡ç†ï¼ˆFactoryBeanï¼‰" class="headerlink" title="IOCæ“ä½œBeanç®¡ç†ï¼ˆFactoryBeanï¼‰"></a>IOCæ“ä½œBeanç®¡ç†ï¼ˆFactoryBeanï¼‰</h3><p>1.Springä¸­æœ‰ä¸¤ç§ç±»å‹beanï¼Œä¸€ç§æ™®é€šbeanï¼Œå¦å¤–ä¸€ç§FactoryBeanã€‚</p>
<p>2.æ™®é€šbeanï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰beanç±»å‹å°±æ˜¯è¿”å›ç±»å‹ã€‚</p>
<p>3.å·¥å‚beanï¼šåœ¨é…ç½®æ–‡ä»¶å®šä¹‰beanç±»å‹å¯ä»¥å’Œè¿”å›ç±»å‹ä¸ä¸€æ ·ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç±»ï¼Œè®©è¿™ä¸ªç±»ä½œä¸ºå·¥å‚beanï¼Œå®ç°æ¥å£FactoryBean</p>
<p>ç¬¬äºŒæ­¥ï¼šå®ç°æ¥å£é‡Œé¢çš„æ–¹æ³•ï¼Œåœ¨å®ç°çš„æ–¹æ³•ä¸­å®šä¹‰è¿”å›çš„beanç±»å‹ã€‚</p>
<h3 id="IOCæ“ä½œBeanç®¡ç†ï¼ˆBeançš„ä½œç”¨åŸŸï¼‰"><a href="#IOCæ“ä½œBeanç®¡ç†ï¼ˆBeançš„ä½œç”¨åŸŸï¼‰" class="headerlink" title="IOCæ“ä½œBeanç®¡ç†ï¼ˆBeançš„ä½œç”¨åŸŸï¼‰"></a>IOCæ“ä½œBeanç®¡ç†ï¼ˆBeançš„ä½œç”¨åŸŸï¼‰</h3><p>1.åœ¨Springä¸­ï¼Œå¯ä»¥è®¾ç½®åˆ›å»ºbeanå®ä¾‹æ˜¯å•å®ä¾‹è¿˜æ˜¯å¤šå®ä¾‹ã€‚</p>
<blockquote>
<p>æ‰€è°“å•ä¾‹å°±æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ç”¨ä¸€ä¸ªå¯¹è±¡æ¥å¤„ç†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„serviceå’Œdaoå±‚çš„å¯¹è±¡é€šå¸¸éƒ½æ˜¯å•ä¾‹çš„ï¼Œè€Œå¤šä¾‹åˆ™æŒ‡æ¯ä¸ªè¯·æ±‚ç”¨ä¸€ä¸ªæ–°çš„å¯¹è±¡æ¥å¤„ç†ï¼Œæ¯”å¦‚action;</p>
</blockquote>
<p>2.åœ¨Springä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºçš„beanæ˜¯å•å®ä¾‹å¯¹è±¡ã€‚</p>
<p>æµ‹è¯•ç±»ä¸­åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œè¾“å‡ºåœ°å€ï¼Œå¯ä»¥å‘ç°å¤šä¸ªå¯¹è±¡çš„åœ°å€ç›¸åŒã€‚ä¹Ÿå°±æ˜¯å¤šä¸ªè¯·æ±‚ç”¨ä¸€ä¸ªå¯¹è±¡å¤„ç†ã€‚</p>
<p>3.å¦‚ä½•è®¾ç½®å•å®ä¾‹è¿˜æ˜¯å¤šå®ä¾‹</p>
<p>ï¼ˆ1ï¼‰åœ¨springé…ç½®æ–‡ä»¶beanæ ‡ç­¾é‡Œé¢æœ‰å±æ€§ï¼ˆscopeï¼‰ç”¨äºè®¾ç½®å•å®ä¾‹è¿˜æ˜¯å¤šå®ä¾‹</p>
<p>ï¼ˆ2ï¼‰scopeå±æ€§å€¼ï¼šé»˜è®¤å€¼singletonï¼Œè¡¨ç¤ºå•å®ä¾‹å¯¹è±¡ã€‚prototypeï¼Œè¡¨ç¤ºå¤šå®ä¾‹å¯¹è±¡ã€‚</p>
<p>å…¶ä»–ä¸å¸¸ç”¨çš„ï¼š<br>requestè¡¨ç¤ºä¸€æ¬¡è¯·æ±‚<br>sessionè¡¨ç¤ºä¸€æ¬¡ä¼šè¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;bean id=&quot;emp&quot; class=&quot;com.company.bean.Emp&quot; scope=&quot;prototype&quot;&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>å†çœ‹å¤šä¸ªå¯¹è±¡çš„åœ°å€ï¼Œä¸ä¸€æ ·ï¼Œå¤šå®ä¾‹å¯¹è±¡ã€‚</p>
<p>ï¼ˆ3ï¼‰singletonå’ŒprototypeåŒºåˆ«</p>
<p>ç¬¬ä¸€ singletonå•å®ä¾‹  prototypeå¤šå®ä¾‹</p>
<p>ç¬¬äºŒ singletonåœ¨åŠ è½½springé…ç½®æ–‡ä»¶æ—¶å°±ä¼šåˆ›å»ºå•å®ä¾‹å¯¹è±¡ï¼Œprototypeä¸æ˜¯åœ¨åŠ è½½springé…ç½®æ–‡ä»¶æ—¶åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨getBeanæ–¹æ³•æ—¶åˆ›å»ºå¤šå®ä¾‹å¯¹è±¡ã€‚</p>
<h3 id="IOCæ“ä½œBeanç®¡ç†ï¼ˆbeanç”Ÿå‘½å‘¨æœŸï¼‰"><a href="#IOCæ“ä½œBeanç®¡ç†ï¼ˆbeanç”Ÿå‘½å‘¨æœŸï¼‰" class="headerlink" title="IOCæ“ä½œBeanç®¡ç†ï¼ˆbeanç”Ÿå‘½å‘¨æœŸï¼‰"></a>IOCæ“ä½œBeanç®¡ç†ï¼ˆbeanç”Ÿå‘½å‘¨æœŸï¼‰</h3><p>1.ç”Ÿå‘½å‘¨æœŸï¼šä»å¯¹è±¡åˆ›å»ºåˆ°å¯¹è±¡é”€æ¯çš„è¿‡ç¨‹</p>
<p>2.beanç”Ÿå‘½å‘¨æœŸ</p>
<p>ï¼ˆ1ï¼‰é€šè¿‡æ„é€ å™¨åˆ›å»ºbeanå®ä¾‹ï¼ˆxmlè°ƒç”¨æ— å‚æ„é€ ï¼‰<br>ï¼ˆ2ï¼‰ä¸ºbeanä¸­çš„å±æ€§è®¾ç½®å€¼å’Œå¯¹å…¶ä»–beanå¼•ç”¨ï¼ˆè°ƒç”¨setæ–¹æ³•ï¼‰<br>ï¼ˆ3ï¼‰è°ƒç”¨beançš„åˆå§‹åŒ–æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®ï¼‰<br>ï¼ˆ4ï¼‰beanå¯ä»¥ä½¿ç”¨ï¼ˆå¯¹è±¡è·å–åˆ°ï¼‰<br>ï¼ˆ5ï¼‰å½“å®¹å™¨å…³é—­æ—¶ï¼Œè°ƒç”¨beançš„é”€æ¯æ–¹æ³•ï¼ˆéœ€è¦è¿›è¡Œé…ç½®ï¼‰</p>
<p>3.æ¼”ç¤ºbeanç”Ÿå‘½å‘¨æœŸï¼šè§ç¨‹åºorderç›¸å…³</p>
<p>4.åŠ ä¸Šbeançš„åç½®å¤„ç†å™¨ï¼šbeançš„ç”Ÿå‘½å‘¨æœŸæœ‰ä¸ƒæ­¥ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ä¹‹å‰ï¼šæŠŠbeanå®ä¾‹ä¼ é€’beanåç½®å¤„ç†å™¨çš„æ–¹æ³•before</p>
<p>ç¬¬ä¸‰æ­¥ä¹‹åï¼šæŠŠbeanå®ä¾‹ä¼ é€’beanåç½®å¤„ç†å™¨çš„æ–¹æ³•after</p>
<p>åˆ›å»ºç±»å®ç°BeanPostProcessoræ¥å£ï¼Œåˆ›å»ºåç½®å¤„ç†å™¨ã€‚é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚</p>
<h2 id="Day-5"><a href="#Day-5" class="headerlink" title="Day 5"></a>Day 5</h2><h3 id="IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlè‡ªåŠ¨è£…é…ï¼‰"><a href="#IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlè‡ªåŠ¨è£…é…ï¼‰" class="headerlink" title="IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlè‡ªåŠ¨è£…é…ï¼‰"></a>IOCæ“ä½œBeanç®¡ç†ï¼ˆxmlè‡ªåŠ¨è£…é…ï¼‰</h3><p>1.ä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…é…ï¼Ÿ<br>propertyæ³¨å…¥å±æ€§ï¼Œname-valueå€¼ï¼Œè¿™æ˜¯æ‰‹åŠ¨è£…é…ã€‚æ ¹æ®æŒ‡å®šè£…é…è§„åˆ™ï¼ˆå±æ€§åç§°æˆ–è€…å±æ€§ç±»å‹ï¼‰ï¼Œspringè‡ªåŠ¨å°†åŒ¹é…çš„å±æ€§å€¼è¿›è¡Œæ³¨å…¥ã€‚</p>
<p>2.æ¼”ç¤ºè‡ªåŠ¨è£…é…<br>å¤–éƒ¨beanæ‰‹åŠ¨è£…é…ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.autowire.Employee&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;deport&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;deport&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.autowire.Deport&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è‡ªåŠ¨è£…é…ï¼šbeanæ ‡ç­¾å±æ€§autowireï¼Œé…ç½®è‡ªåŠ¨è£…é…ï¼Œautowireå±æ€§å¸¸ç”¨ä¸¤ä¸ªå€¼ï¼šbyNameæ ¹æ®å±æ€§åç§°æ³¨å…¥ï¼ˆæ³¨å…¥å€¼beançš„idå€¼å’Œç±»å±æ€§åå­—ä¸€æ ·ï¼‰ï¼ŒbyTypeæ ¹æ®å±æ€§ç±»å‹æ³¨å…¥ï¼ˆç›¸åŒç±»å‹çš„beanä¸èƒ½å®šä¹‰å¤šä¸ªï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼‰ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.autowire.Employee&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.company.autowire.Deport&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="IOCæ“ä½œBeanç®¡ç†ï¼ˆå¤–éƒ¨å±æ€§æ–‡ä»¶ï¼‰"><a href="#IOCæ“ä½œBeanç®¡ç†ï¼ˆå¤–éƒ¨å±æ€§æ–‡ä»¶ï¼‰" class="headerlink" title="IOCæ“ä½œBeanç®¡ç†ï¼ˆå¤–éƒ¨å±æ€§æ–‡ä»¶ï¼‰"></a>IOCæ“ä½œBeanç®¡ç†ï¼ˆå¤–éƒ¨å±æ€§æ–‡ä»¶ï¼‰</h3><p>å¦‚æœä¸€ä¸ªç±»çš„å±æ€§å¾ˆå¤šï¼Œéœ€è¦å¾ˆå¤špropertyï¼Œå¹¶ä¸”ç±»å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦ä¿®æ”¹xmlé…ç½®æ–‡ä»¶ï¼Œæ”¹èµ·æ¥éº»çƒ¦ã€‚å°†å›ºå®šçš„å€¼æ”¾åœ¨å¤–éƒ¨æ–‡ä»¶ä¸­ã€‚åœºæ™¯åº”ç”¨åœ¨æ“ä½œæ•°æ®åº“ä¸­ï¼Œæ•°æ®åº“çš„å€¼æ”¾åœ¨propertyæ–‡ä»¶ä¸­ï¼Œå¼•ç”¨è¿›æ¥ï¼Œè¿›è¡Œè¯»å–ã€‚</p>
<p>1.ç›´æ¥é…ç½®æ•°æ®åº“ä¿¡æ¯</p>
<p>ï¼ˆ1ï¼‰é…ç½®å¾·é²ä¼Šdruidè¿æ¥æ± </p>
<p>ï¼ˆ2ï¼‰å¼•å…¥å¾·é²ä¼Šè¿æ¥æ± ä¾èµ–jaråŒ…</p>
<p><a href="https://mvnrepository.com/artifact/com.alibaba/druid/1.1.9%EF%BC%88%E6%89%BE%E5%88%B0durid1.9%E4%B8%8B%E8%BD%BD%EF%BC%8C%E5%AF%BC%E5%85%A5lib%EF%BC%89">https://mvnrepository.com/artifact/com.alibaba/druid/1.1.9ï¼ˆæ‰¾åˆ°durid1.9ä¸‹è½½ï¼Œå¯¼å…¥libï¼‰</a></p>
<p>ï¼ˆ3ï¼‰é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼ˆbean10ï¼‰ï¼Œå‡ ä¸ªå±æ€§ï¼šé©±åŠ¨åç§°ã€æ•°æ®åº“åœ°å€ã€ç”¨æˆ·ã€å¯†ç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç›´æ¥é…ç½®è¿æ¥æ±  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/userDb&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>2.å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶é…ç½®æ•°æ®åº“è¿æ¥æ± </p>
<p>ï¼ˆ1ï¼‰åˆ›å»ºå¤–éƒ¨å±æ€§æ–‡ä»¶ï¼Œpropertiesæ ¼å¼æ–‡ä»¶ï¼Œå†™æ•°æ®åº“ä¿¡æ¯ã€‚ç­‰å·å·¦è¾¹çš„åå­—å¯ä»¥éšä¾¿å†™ã€‚</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">prop.driverClass</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">prop.url</span>=<span class="string">jdbc:mysql://localhost:3306/userDb</span></span><br><span class="line"><span class="attr">prop.userName</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">prop.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æŠŠå¤–éƒ¨propertieså±æ€§æ–‡ä»¶å¼•å…¥åˆ°springé…ç½®æ–‡ä»¶ä¸­ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šå¼•å…¥contextåç§°ç©ºé—´</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">                   http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šåœ¨springé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æ ‡ç­¾å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span>   <span class="comment">&lt;!--æ–‡ä»¶åœ¨æœ¬åœ°å†™æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.driverClass&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.userName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä»¥ä¸Šæ˜¯åŸºäºxmlæ–¹å¼è¿›è¡Œbeanç®¡ç†ï¼Œæœ€é‡è¦çš„ï¼šåˆ›å»ºå¯¹è±¡ã€æ³¨å…¥å±æ€§</p>
</blockquote>
<h3 id="IOCæ“ä½œBeanç®¡ç†ï¼ˆåŸºäºæ³¨è§£æ–¹å¼ï¼‰"><a href="#IOCæ“ä½œBeanç®¡ç†ï¼ˆåŸºäºæ³¨è§£æ–¹å¼ï¼‰" class="headerlink" title="IOCæ“ä½œBeanç®¡ç†ï¼ˆåŸºäºæ³¨è§£æ–¹å¼ï¼‰"></a>IOCæ“ä½œBeanç®¡ç†ï¼ˆåŸºäºæ³¨è§£æ–¹å¼ï¼‰</h3><p>1.ä»€ä¹ˆæ˜¯æ³¨è§£ï¼Ÿ<br>æ³¨è§£æ˜¯ä»£ç ä¸­ç‰¹æ®Šçš„æ ‡è®°ï¼Œæ ¼å¼ï¼š@æ³¨è§£åç§°(å±æ€§åç§°&#x3D;å±æ€§å€¼, å±æ€§åç§°&#x3D;å±æ€§å€¼â€¦)<br>æ³¨è§£å¯ä»¥ä½œç”¨åœ¨ç±»ä¸Šé¢ï¼Œæ–¹æ³•ä¸Šé¢ï¼Œå±æ€§ä¸Šé¢ã€‚<br>ä½¿ç”¨æ³¨è§£çš„åŸå› ï¼šä¸ºäº†ç®€åŒ–xmlé…ç½®</p>
<p>2.Springé’ˆå¯¹Beanç®¡ç†ä¸­åˆ›å»ºå¯¹è±¡æä¾›æ³¨è§£</p>
<p>ï¼ˆ1ï¼‰@Component</p>
<p>ï¼ˆ2ï¼‰@Serviceï¼šä¸šåŠ¡é€»è¾‘å±‚serviceå±‚</p>
<p>ï¼ˆ3ï¼‰@Controllerï¼šwebå±‚</p>
<p>ï¼ˆ4ï¼‰@Repositoryï¼šdaoæŒä¹…å±‚</p>
<p>*ä¸Šé¢çš„å››ä¸ªæ³¨è§£åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¯ä»¥ç”¨æ¥åˆ›å»ºbeanå®ä¾‹ï¼Œå¯ä»¥ä¸åŒå±‚æ··ç”¨çš„ã€‚</p>
<p>3.åŸºäºæ³¨è§£æ–¹å¼å®ç°å¯¹è±¡åˆ›å»º</p>
<p>é‡æ–°æä¸€ä¸ªå·¥ç¨‹ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ä¾èµ–ï¼Œaopã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šå¼€å¯ç»„ä»¶æ‰«æï¼Œçœ‹æœ‰æ²¡æœ‰æ³¨è§£ï¼Œæ‰«æå“ªä¸ªåŒ…ä¸­çš„å“ªä¸ªç±»ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                   http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼€å¯ç»„ä»¶æ‰«æ,æ‰«æå¤šä¸ªåŒ…ç”¨,éš”å¼€--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.company.dao,com.company.service&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºç±»ï¼Œåœ¨ç±»ä¸Šæ·»åŠ åˆ›å»ºå¯¹è±¡çš„æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component(value = &quot;userService&quot;)</span>  <span class="comment">//ç±»ä¼¼äº&lt;bean id=&quot;&quot; class=&quot;&quot;/&gt;, valueå±æ€§å¯ä»¥çœç•¥ï¼Œé»˜è®¤ä¸ºç±»åé¦–å­—æ¯å°å†™ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service add ......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestZhujie</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZhujie</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">con</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean1.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> con.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class); <span class="comment">//æ‰“åé¢çš„ï¼Œç„¶å.varä¼šå‡ºç°å‰é¢çš„åŒ¹é…ç±»å‹</span></span><br><span class="line">        System.out.println(userService);</span><br><span class="line">        userService.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.ä¸Šé¢æ˜¯æ‰«æä¸€ä¸ªåŒ…ä¸‹çš„æ‰€æœ‰ç±»ï¼Œä¹Ÿå¯ä»¥ä¸æ‰«ææ‰€æœ‰ç±»</p>
<p>ç¤ºä¾‹1 ï¼š<br><code>user-default-filters=&quot;false&quot; </code>è¡¨ç¤ºç°åœ¨ä¸ä½¿ç”¨é»˜è®¤filterï¼Œè‡ªå·±é…ç½®filterã€‚<br><code>context:include-filter</code>ï¼Œè®¾ç½®æ‰«æå“ªäº›å†…å®¹ï¼Œ<code>type=&quot;annotation&quot;</code>æ ¹æ®æ³¨è§£æ¥æ‰«æã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç¤ºä¾‹1 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.company.dao,com.company.service&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Component&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åªæ‰«æ<code>@component</code>æ³¨è§£çš„ç±»ã€‚</p>
<p>ç¤ºä¾‹2ï¼š<br><code>contextï¼šexclude-filter</code> è®¾ç½®å“ªäº›å†…å®¹ä¸æ‰«æã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç¤ºä¾‹2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.company.dao,com.company.service&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Component&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>5.åŸºäºæ³¨è§£æ–¹å¼å®ç°å±æ€§æ³¨å…¥</p>
<p>ï¼ˆ1ï¼‰@Autowiredï¼šæ ¹æ®å±æ€§ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…</p>
<p>ç¬¬ä¸€æ­¥ï¼šæŠŠserviceå’Œdaoå¯¹è±¡éƒ½åˆ›å»ºï¼Œä¹Ÿå°±æ˜¯åœ¨ç±»ä¸Šéƒ½æ·»åŠ æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDapImpt</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;dao add ......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šåœ¨serviceä¸­æ³¨å…¥daoå¯¹è±¡ï¼Œåœ¨serviceå†…çš„daoå¯¹è±¡å±æ€§ä¸Šæ·»åŠ æ³¨å…¥å±æ€§æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component(value = &quot;userService&quot;)</span>  <span class="comment">//ç±»ä¼¼äº&lt;bean id=&quot;&quot; class=&quot;&quot;/, valueå±æ€§å¯ä»¥çœç•¥ï¼Œé»˜è®¤ä¸ºç±»åé¦–å­—æ¯å°å†™ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userdao;  <span class="comment">//UserDaoæ˜¯æ¥å£ä¹Ÿå¯ä»¥å•Š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service add ......&quot;</span>);</span><br><span class="line">        userdao.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>*Autowiredæ ‡æ³¨äº†UserDaoç±»å‹çš„ï¼Œæ ¹æ®ç±»å‹è‡ªåŠ¨æ‰¾åˆ°å®ƒçš„å®ç°ç±»</p>
<p>ï¼ˆ2ï¼‰@Qualifierï¼šæ ¹æ®å±æ€§åç§°è¿›è¡Œæ³¨å…¥</p>
<p>éœ€è¦ä¸ªä¸Šé¢çš„@Autowiredä¸€èµ·è¿›è¡Œä½¿ç”¨ã€‚å’Œä¸Šé¢çš„bytypeè‡ªåŠ¨æ³¨å…¥ç±»ä¼¼ï¼Œå¦‚æœä¸€ä¸ªæ¥å£æœ‰ä¸åŒå®ç°ç±»ï¼Œå°±ä¼šæœ‰å¤šä¸ªå¯åŒ¹é…çš„ï¼Œè¿™æ—¶éœ€è¦æ ¹æ®åç§°ï¼ˆ@componentæ‹¬å·é‡Œçš„valueï¼‰è¿›è¡Œè£…é…ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component(value = &quot;userService&quot;)</span>  <span class="comment">//ç±»ä¼¼äº&lt;bean id=&quot;&quot; class=&quot;&quot;/, valueå±æ€§å¯ä»¥çœç•¥ï¼Œé»˜è®¤ä¸ºç±»åé¦–å­—æ¯å°å†™ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(value = &quot;hh&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userdao;  <span class="comment">//UserDaoæ˜¯æ¥å£ä¹Ÿå¯ä»¥å•Š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service add ......&quot;</span>);</span><br><span class="line">        userdao.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰@Resourceï¼šå¯ä»¥æ ¹æ®ç±»å‹æ³¨å…¥ï¼Œä¹Ÿå¯ä»¥æ ¹æ®åç§°æ³¨å…¥</p>
<p>ç›´æ¥@Resourceæ˜¯æ ¹æ®ç±»å‹ï¼Œ@Resource(name&#x3D;â€hhâ€)æ ¹æ®åç§°ã€‚</p>
<p>Resourceæ˜¯javaæ‰©å±•åŒ…javaxä¸­çš„ï¼Œä¸Šé¢ä¸¤ä¸ªæ˜¯springä¸­çš„ã€‚</p>
<p>ï¼ˆ4ï¼‰@Valueï¼šæ³¨å…¥æ™®é€šç±»å‹å±æ€§</p>
<p>ä¸Šé¢ä¸‰ä¸ªéƒ½æ˜¯æ³¨å…¥å¯¹è±¡ç±»å‹æ•°æ®ï¼Œè¿™ä¸ªæ³¨å…¥æ™®é€šç±»å‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value(value = &quot;liu&quot;)</span>  <span class="comment">//liuæ³¨å…¥åˆ°snameä¸­ï¼Œç›¸å½“äºxmlçš„property</span></span><br><span class="line"><span class="keyword">private</span> String sname;</span><br></pre></td></tr></table></figure>

<p>6.å®Œå…¨æ³¨è§£å¼€å‘</p>
<p>ä½¿ç”¨æ³¨è§£æ–¹å¼ç®¡ç†Beançš„ç›®çš„æ˜¯ï¼Œç®€åŒ–xmlé…ç½®ï¼Œç›®å‰åªæœ‰ä¸€è¡Œå¼€å¯ç»„ä»¶æ‰«æï¼Œå…¶ä»–çš„éƒ½ç”¨æ³¨è§£æ¥æ›¿ä»£ã€‚</p>
<p>ï¼ˆ1ï¼‰åˆ›å»ºé…ç½®ç±»ï¼Œæ›¿ä»£xmlé…ç½®æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//ä½œä¸ºé…ç½®ç±»ï¼Œæ›¿ä»£xmlé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.company&quot;&#125;)</span>  <span class="comment">//å¼€å¯ç»„ä»¶æ‰«æ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œé™¤äº†ç¬¬ä¸€æ­¥åŠ è½½é…ç½®ç±»ä¸åŒï¼Œå…¶ä»–éƒ½ä¸€æ ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZhujie2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">con</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);  <span class="comment">//åŠ è½½é…ç½®ç±»</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> con.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class); <span class="comment">//æ‰“åé¢çš„ï¼Œç„¶å.varä¼šå‡ºç°å‰é¢çš„åŒ¹é…ç±»å‹</span></span><br><span class="line">    System.out.println(userService);</span><br><span class="line">    userService.add();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å¼€å‘ï¼Œåœ¨å®é™…å¼€å‘ä¸­ç”¨springbootï¼Œspringbootæœ¬è´¨ä¸Šè¿˜æ˜¯springï¼Œå¯¹springåšäº†ç®€åŒ–å¼€å‘ã€‚</p>
<h2 id="Day-6"><a href="#Day-6" class="headerlink" title="Day 6"></a>Day 6</h2><h3 id="AOP-åŸºæœ¬æ¦‚å¿µ"><a href="#AOP-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="AOP åŸºæœ¬æ¦‚å¿µ"></a>AOP åŸºæœ¬æ¦‚å¿µ</h3><p>ä»€ä¹ˆæ˜¯AOPï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯OOPå»¶ç»­ï¼Œå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜å¼€å‘çš„æ•ˆç‡ã€‚</p>
<p>ä¾‹å¦‚ï¼šåœ¨ç”¨æˆ·ç™»å½•åŠŸèƒ½åŸºç¡€ä¸Šæ·»åŠ åŠŸèƒ½â€“æƒé™åˆ¤æ–­</p>
<p>åŸå§‹æ–¹å¼ï¼šä¿®æ”¹æºä»£ç å®ç° if else</p>
<p>AOPï¼šä¸é€šè¿‡ä¿®æ”¹æºä»£ç æ–¹å¼åœ¨ä¸»å¹²åŠŸèƒ½é‡Œæ·»åŠ æ–°åŠŸèƒ½ï¼Œå°†æƒé™åˆ¤æ–­æ¨¡å—é€šè¿‡é…ç½®æ–¹å¼æ·»åŠ ã€‚</p>
<h3 id="AOPåº•å±‚åŸç†"><a href="#AOPåº•å±‚åŸç†" class="headerlink" title="AOPåº•å±‚åŸç†"></a>AOPåº•å±‚åŸç†</h3><p>AOPåº•å±‚ä½¿ç”¨åŠ¨æ€ä»£ç†</p>
<p>æœ‰ä¸¤ç§æƒ…å†µçš„åŠ¨æ€ä»£ç†ï¼š</p>
<p>ç¬¬ä¸€ç§ï¼šæœ‰æ¥å£æƒ…å†µï¼Œä½¿ç”¨JDKåŠ¨æ€ä»£ç†</p>
<p>å®šä¹‰UserDaoæ¥å£ï¼Œå®šä¹‰ä¸€ä¸ªUserDaoImplå®ç°ç±»ï¼Œç±»å†…é‡å†™ç™»å½•å‡½æ•°å®ç°ç™»å½•åŠŸèƒ½ã€‚ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºUserDaoæ¥å£å®ç°ç±»ä»£ç†å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡å¢å¼ºç±»çš„æ–¹æ³•ã€‚</p>
<p>ç¬¬äºŒç§ï¼šæ²¡æœ‰æ¥å£æƒ…å†µï¼Œä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†</p>
<p>æœ‰ä¸€ä¸ªUserç±»ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå­ç±»æ¥ç»§æ‰¿Userç±»ï¼Œé‡å†™æ–¹æ³•æ‰©å±•åŠŸèƒ½å¢å¼ºé€»è¾‘ã€‚CGLIBåŠ¨æ€ä»£ç†ï¼šåˆ›å»ºä¸€ä¸ªå½“å‰ç±»ä¹‹ç±»çš„ä»£ç†å¯¹è±¡ï¼Œå¢å¼ºç±»çš„æ–¹æ³•ã€‚</p>
<h3 id="AOPï¼ˆæœ‰æ¥å£æƒ…å†µJDKåŠ¨æ€ä»£ç†å®ç°ï¼‰"><a href="#AOPï¼ˆæœ‰æ¥å£æƒ…å†µJDKåŠ¨æ€ä»£ç†å®ç°ï¼‰" class="headerlink" title="AOPï¼ˆæœ‰æ¥å£æƒ…å†µJDKåŠ¨æ€ä»£ç†å®ç°ï¼‰"></a>AOPï¼ˆæœ‰æ¥å£æƒ…å†µJDKåŠ¨æ€ä»£ç†å®ç°ï¼‰</h3><p>1.æ¦‚å¿µï¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼Œä½¿ç”¨Proxyç±»é‡Œé¢çš„æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</p>
<p>APIæ–‡æ¡£ï¼š<a href="https://www.matools.com/api/java8%EF%BC%88java.lang.reflect.Proxy%EF%BC%89">https://www.matools.com/api/java8ï¼ˆjava.lang.reflect.Proxyï¼‰</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">newProxyInstance(ClassLoader loader, ç±»&lt;?&gt;[] interfaces, InvocationHandler h)    //é™æ€æ–¹æ³•</span><br></pre></td></tr></table></figure>

<p>è¿”å›æŒ‡å®šæ¥å£çš„ä»£ç†ç±»çš„å®ä¾‹ï¼Œè¯¥æ¥å£å°†æ–¹æ³•è°ƒç”¨åˆ†æ´¾ç»™æŒ‡å®šçš„è°ƒç”¨å¤„ç†ç¨‹åºã€‚</p>
<p>newProxyInstanceæ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°ï¼šç±»åŠ è½½å™¨ï¼›å¢å¼ºæ–¹æ³•è¦å¢å¼ºçš„æ¥å£å®ç°ç±»ï¼Œæ”¯æŒå¤šä¸ªæ¥å£ï¼›å†™ä¸ªç±»å®ç°InvocationHandleræ¥å£ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œé‡Œé¢å†™å¢å¼ºçš„æ–¹æ³•ï¼ˆå¯ä»¥å†™åŒ¿åå†…éƒ¨ç±»ï¼Œä¹Ÿå¯ä»¥å†™ä¸ªç±»å®ç°è¿™ä¸ªæ¥å£ï¼‰ã€‚ </p>
<p>2.ç¼–å†™JDKåŠ¨æ€ä»£ç†ä»£ç </p>
<p>ï¼ˆ1ï¼‰åˆ›å»ºæ¥å£ï¼Œå®šä¹‰æ–¹æ³•</p>
<p>ä»£ç ä¸­çš„UserDaoæ¥å£</p>
<p>ï¼ˆ2ï¼‰åˆ›å»ºæ¥å£å®ç°ç±»ï¼Œå®ç°æ–¹æ³•</p>
<p>ä»£ç ä¸­çš„UserDaoImplç±»</p>
<p>ï¼ˆ3ï¼‰ä½¿ç”¨Proxyç±»åˆ›å»ºæ¥å£ä»£ç†å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">package</span> com.company;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: SpringAop</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-01-27 21:08</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDKProxy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºæ¥å£å®ç°ç±»ä»£ç†å¯¹è±¡</span></span><br><span class="line">        Class[] interfaces = &#123;UserDao.class&#125;;</span><br><span class="line">        <span class="comment">//1.å‡½æ•°å¼æ¥å£æ–¹æ³•</span></span><br><span class="line"><span class="comment">//        Proxy.newProxyInstance(JDKProxy.class.getClassLoader(), interfaces, new InvocationHandler() &#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">//                return null;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line">        <span class="comment">//2.å¤–é¢å†™ä¸ªç±»æ–¹æ³•</span></span><br><span class="line">        <span class="type">UserDaoImpl</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">        <span class="comment">//åšä¸€ä¸ªå¼ºè½¬ï¼Œåˆ›å»ºæ¥å£å®ç°ç±»çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">dao</span> <span class="operator">=</span> (UserDao) Proxy.newProxyInstance(JDKProxy.class.getClassLoader(), interfaces, <span class="keyword">new</span> <span class="title class_">UserDaoProxy</span>(userDao));</span><br><span class="line">        <span class="comment">//int res = dao.add(1,2);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> dao.update(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;result:&quot;</span>+res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserDaoProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>&#123;</span><br><span class="line">    <span class="comment">//æŠŠåˆ›å»ºçš„æ˜¯è°çš„ä»£ç†å¯¹è±¡ï¼ŒæŠŠè°ä¼ é€’è¿‡æ¥</span></span><br><span class="line">    <span class="comment">//æœ‰å‚æ„é€ ä¼ é€’</span></span><br><span class="line">    <span class="keyword">private</span> Object obj;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDaoProxy</span><span class="params">(Object obj)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¢å¼ºçš„é€»è¾‘</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//å¯ä»¥å¯¹è¦å¢å¼ºçš„æ–¹æ³•ä½œå‡ºåˆ¤æ–­ï¼Œå¢å¼ºå“ªä¸ªï¼Œç”¨getName()æ–¹æ³•</span></span><br><span class="line">        <span class="comment">//æ–¹æ³•ä¹‹å‰</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å“ªä¸ªæ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼š&quot;</span>+method.getName()+<span class="string">&quot;ï¼›ä¼ é€’çš„å‚æ•°ï¼š&quot;</span>+ Arrays.toString(args));</span><br><span class="line">        <span class="comment">//è¢«å¢å¼ºçš„æ–¹æ³•</span></span><br><span class="line">        Object res= method.invoke(obj, args);</span><br><span class="line">        <span class="comment">//æ–¹æ³•ä¹‹å</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å“ªä¸ªæ–¹æ³•ä¹‹åæ‰§è¡Œï¼š&quot;</span>+method.getName()+<span class="string">&quot;ï¼›ä¼ é€’çš„å‚æ•°ï¼š&quot;</span>+ Arrays.toString(args));</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AOP-æ“ä½œæœ¯è¯­"><a href="#AOP-æ“ä½œæœ¯è¯­" class="headerlink" title="AOP-æ“ä½œæœ¯è¯­"></a>AOP-æ“ä½œæœ¯è¯­</h3><p>1.è¿æ¥ç‚¹</p>
<p>ç±»ä¸­æœ‰è‹¥å¹²æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½å¯ä»¥è¢«å¢å¼ºï¼Œåœ¨ä¸€ä¸ªç±»ä¸­å“ªäº›æ–¹æ³•å¯ä»¥è¢«å¢å¼ºï¼Œè¿™äº›æ–¹æ³•å°±å«åšè¿æ¥ç‚¹ã€‚</p>
<p>2.åˆ‡å…¥ç‚¹</p>
<p>å®é™…è¢«çœŸæ­£å¢å¼ºçš„æ–¹æ³•ï¼Œå«åšåˆ‡å…¥ç‚¹ã€‚</p>
<p>3.é€šçŸ¥ï¼ˆå¢å¼ºï¼‰</p>
<p>ï¼ˆ1ï¼‰å®é™…å¢å¼ºçš„é€»è¾‘éƒ¨åˆ†ç§°ä¸ºé€šçŸ¥æˆ–æ˜¯å¢å¼ºã€‚</p>
<p>ï¼ˆ2ï¼‰é€šçŸ¥æœ‰å¤šç§ç±»å‹<br>*å‰ç½®é€šçŸ¥ï¼šæ–¹æ³•ä¹‹å‰ä¼šæ‰§è¡Œ<br>*åç½®é€šçŸ¥ï¼šæ–¹æ³•ä¹‹åä¼šæ‰§è¡Œ<br>*ç¯ç»•é€šçŸ¥ï¼šæ–¹æ³•çš„å‰åéƒ½æ‰§è¡Œ<br>*å¼‚å¸¸é€šçŸ¥ï¼šæ–¹æ³•å‡ºç°å¼‚å¸¸æ‰§è¡Œ<br>*æœ€ç»ˆé€šçŸ¥ï¼šç±»ä¼¼try-catch-finallyï¼Œä¸ç®¡æœ‰æ²¡æœ‰å¼‚å¸¸éƒ½æ‰§è¡Œ</p>
<p>4.åˆ‡é¢</p>
<p>æ˜¯åŠ¨ä½œï¼ŒæŠŠé€šçŸ¥åº”ç”¨åˆ°åˆ‡å…¥ç‚¹çš„è¿‡ç¨‹å«åšåˆ‡é¢ã€‚</p>
<h3 id="AOPæ“ä½œ-å‡†å¤‡å·¥ä½œ"><a href="#AOPæ“ä½œ-å‡†å¤‡å·¥ä½œ" class="headerlink" title="AOPæ“ä½œ-å‡†å¤‡å·¥ä½œ"></a>AOPæ“ä½œ-å‡†å¤‡å·¥ä½œ</h3><p>1.Springæ¡†æ¶ä¸­ä¸€èˆ¬åŸºäºAspectJå®ç°AOPæ“ä½œã€‚</p>
<p>ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯AspectJï¼Ÿ</p>
<p>*AspectJæ˜¯ç‹¬ç«‹çš„æ¡†æ¶ï¼Œä¸æ˜¯Springç»„æˆéƒ¨åˆ†ï¼Œç‹¬ç«‹AOPæ¡†æ¶ï¼Œä¸€èˆ¬æŠŠAspectJå’ŒSpringæ¡†æ¶ä¸€èµ·ä½¿ç”¨ï¼Œè¿›è¡ŒAOPæ“ä½œã€‚</p>
<p>2.åŸºäºAspectJå®ç°AOPæ“ä½œ</p>
<p>ï¼ˆ1ï¼‰åŸºäºxmlé…ç½®æ–‡ä»¶å®ç°</p>
<p>ï¼ˆ2ï¼‰åŸºäºæ³¨è§£æ–¹å¼å®ç°ï¼ˆä¸€èˆ¬ç”¨è¿™ä¸ªï¼‰</p>
<p>3.åœ¨é¡¹ç›®å·¥ç¨‹ä¸­å¼•å…¥AOPç›¸å…³ä¾èµ–ã€‚</p>
<p>éœ€è¦æ·»åŠ ä¸€ä¸ªaspectçš„ä¾èµ–åŒ…ã€‚åœ¨<a href="https://mvnrepository.comä¸­æœç´¢aspectjã€cglibã€aopallianceä¾èµ–åŒ…./">https://mvnrepository.comä¸­æœç´¢aspectjã€cglibã€aopallianceä¾èµ–åŒ…ã€‚</a></p>
<p>4.åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</p>
<p>ï¼ˆ1ï¼‰åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„ä½œç”¨ï¼šçŸ¥é“å¯¹å“ªä¸ªç±»é‡Œé¢çš„å“ªä¸ªæ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
<p>ï¼ˆ2ï¼‰è¯­æ³•ç»“æ„ï¼š<code>execution([æƒé™ä¿®é¥°ç¬¦][è¿”å›ç±»å‹][ç±»å…¨è·¯å¾„][æ–¹æ³•åç§°][å‚æ•°åˆ—è¡¨])</code></p>
<p>ä¸¾ä¾‹1ï¼šå¯¹com.company.dao.BookDaoç±»é‡Œé¢çš„addè¿›è¡Œå¢å¼º<br><code>execution(* com.company.dao.BookDao.add(...))</code></p>
<p>ä¸¾ä¾‹2ï¼šå¯¹com.company.dao.BookDaoç±»é‡Œé¢çš„æ‰€æœ‰è¿›è¡Œå¢å¼º<br><code>execution(* com.company.dao.BookDao.*(...))</code></p>
<p>ä¸¾ä¾‹3ï¼šå¯¹com.company.daoåŒ…é‡Œé¢æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•è¿›è¡Œå¢å¼º<br><code>execution(* com.company.dao.*.*(...))</code></p>
<h3 id="AOP-AspectJæ³¨è§£æ“ä½œ"><a href="#AOP-AspectJæ³¨è§£æ“ä½œ" class="headerlink" title="AOP-AspectJæ³¨è§£æ“ä½œ"></a>AOP-AspectJæ³¨è§£æ“ä½œ</h3><p>1.åˆ›å»ºç±»ï¼Œåœ¨ç±»ä¸­å®šä¹‰æ–¹æ³•</p>
<p>åˆ›å»ºUserç±»</p>
<p>2.åˆ›å»ºå¢å¼ºç±»ï¼ˆç¼–å†™å¢å¼ºé€»è¾‘ï¼‰</p>
<p>åœ¨å¢å¼ºç±»UserProxyä¸­ï¼Œåˆ›å»ºæ–¹æ³•ï¼Œè®©ä¸åŒæ–¹æ³•ä»£è¡¨ä¸åŒé€šçŸ¥ç±»å‹ã€‚</p>
<p>3.è¿›è¡Œé€šçŸ¥çš„é…ç½®</p>
<p>ï¼ˆ1ï¼‰åœ¨springé…ç½®æ–‡ä»¶ä¸­ï¼Œå¼€å¯æ³¨è§£æ‰«æï¼ˆå¯ä»¥å†™é…ç½®ç±»ï¼Œä¹Ÿå¯ä»¥å†™é…ç½®æ–‡ä»¶ï¼‰é¦–å…ˆæ˜¯åç§°ç©ºé—´ï¼Œå†å¼€å¯ç»„ä»¶æ‰«æ</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨æ³¨è§£åˆ›å»ºUserå’ŒUserProxyå¯¹è±¡ï¼Œç”¨@Component</p>
<p>ï¼ˆ3ï¼‰åœ¨å¢å¼ºç±»ä¸Šé¢æ·»åŠ æ³¨è§£@Aspect</p>
<p>ï¼ˆ4ï¼‰åœ¨springé…ç½®æ–‡ä»¶ä¸­å¼€å¯ç”Ÿæˆä»£ç†å¯¹è±¡</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                   http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼€å¯ç»„ä»¶æ‰«æ,æ‰«æå¤šä¸ªåŒ…ç”¨,éš”å¼€--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.company.aopdemo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯Aspectç”Ÿæˆä»£ç†å¯¹è±¡ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.é…ç½®ä¸åŒç±»å‹çš„é€šçŸ¥</p>
<p>åœ¨å¢å¼ºç±»çš„é‡Œé¢ï¼Œåœ¨ä½œä¸ºé€šçŸ¥æ–¹æ³•ä¸Šé¢æ·»åŠ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.aopdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: SpringAop</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-01-29 21:48</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProxy</span> &#123;</span><br><span class="line">    <span class="comment">//Beforeæ³¨è§£è¡¨ç¤ºä½œä¸ºå‰ç½®é€šçŸ¥ï¼Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¡¨ç¤ºå¢å¼ºå“ªä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Before(value=&quot;execution(* com.company.aopdemo.User.add(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After(value=&quot;execution(* com.company.aopdemo.User.add(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;after......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterReturning(value=&quot;execution(* com.company.aopdemo.User.add(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterReturning......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing(value=&quot;execution(* com.company.aopdemo.User.add(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterThrowing......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç¯ç»•é€šçŸ¥ï¼Œæ–¹æ³•ä¹‹å‰å’Œæ–¹æ³•ä¹‹åéƒ½æ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Around(value=&quot;execution(* com.company.aopdemo.User.add(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before around......&quot;</span>);</span><br><span class="line">        proceedingJoinPoint.proceed();  <span class="comment">//è¡¨ç¤ºæ‰§è¡Œè¢«å¢å¼ºçš„æ–¹æ³•ï¼Œæœ‰å¼‚å¸¸å¤„ç†</span></span><br><span class="line">        System.out.println(<span class="string">&quot;after around......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>&#x2F;&#x2F;afterè¡¨ç¤ºæ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œ</strong>ï¼Œæœ€ç»ˆé€šçŸ¥ï¼Œä¸ç®¡æœ‰æ²¡æœ‰å¼‚å¸¸</p>
<p><strong>&#x2F;&#x2F;afterreturningè¡¨ç¤ºåœ¨æ–¹æ³•è¿”å›å€¼ä¹‹åæ‰§è¡Œ</strong>ï¼Œåç½®é€šçŸ¥ï¼Œè¿”å›é€šçŸ¥ï¼Œæœ‰å¼‚å¸¸ä¸æ‰§è¡Œ</p>
<p><strong>&#x2F;&#x2F;å¦‚æœå¼‚å¸¸äº†ï¼ŒafterReturningå’Œç¯ç»•ä¹‹åä¸æ‰§è¡Œ</strong></p>
<p>5.ç›¸åŒåˆ‡å…¥ç‚¹æŠ½å–ï¼Œ@Pointcutæ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç›¸åŒåˆ‡å…¥ç‚¹æŠ½å–</span></span><br><span class="line"><span class="meta">@Pointcut(value=&quot;execution(* com.company.aopdemo.User.add(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointdemo</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Beforeæ³¨è§£è¡¨ç¤ºä½œä¸ºå‰ç½®é€šçŸ¥ï¼Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¡¨ç¤ºå¢å¼ºå“ªä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">//@Before(value=&quot;execution(* com.company.aopdemo.User.add(..))&quot;)</span></span><br><span class="line"><span class="meta">@Before(value = &quot;pointdemo()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;before......&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.æœ‰å¤šä¸ªå¢å¼ºç±»å¯¹åŒä¸€ä¸ªæ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œå¯ä»¥è®¾ç½®å¢å¼ºç±»ä¼˜å…ˆçº§</p>
<p>åœ¨å¢å¼ºç±»ä¸Šé¢æ·»åŠ æ³¨è§£@Order(æ•°å­—ç±»å‹å€¼)ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç›¸åŒåˆ‡å…¥ç‚¹æŠ½å–</span></span><br><span class="line">    <span class="meta">@Pointcut(value = &quot;execution(* com.company.aopdemo.User.add(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointdemo</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Beforeæ³¨è§£è¡¨ç¤ºä½œä¸ºå‰ç½®é€šçŸ¥ï¼Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¡¨ç¤ºå¢å¼ºå“ªä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="comment">//@Before(value=&quot;execution(* com.company.aopdemo.User.add(..))&quot;)</span></span><br><span class="line">    <span class="meta">@Before(value = &quot;pointdemo()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;person before,order1,é«˜ä¼˜å…ˆçº§......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Day-7"><a href="#Day-7" class="headerlink" title="Day 7"></a>Day 7</h2><h3 id="AOPæ“ä½œ-åŸºäºAspectJé…ç½®æ–‡ä»¶"><a href="#AOPæ“ä½œ-åŸºäºAspectJé…ç½®æ–‡ä»¶" class="headerlink" title="AOPæ“ä½œ-åŸºäºAspectJé…ç½®æ–‡ä»¶"></a>AOPæ“ä½œ-åŸºäºAspectJé…ç½®æ–‡ä»¶</h3><p>åˆ›å»ºä¸€ä¸ªåŸºæœ¬ç±»ï¼Œå†åˆ›å»ºä¸€ä¸ªå¢å¼ºç±»ï¼Œç„¶åé…ç½®æ–‡ä»¶ä¸­ç”¨<code>&lt;bean&gt;</code>åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œå†åœ¨springé…ç½®æ–‡ä»¶ä¸­é…ç½®åˆ‡å…¥ç‚¹ï¼Œä½¿ç”¨<code>&lt;aop:config&gt;</code>æ³¨è§£ï¼Œä½¿ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼<code>&lt;aop:pointcut ...</code>ï¼Œå†é…ç½®åˆ‡é¢ï¼Œé…ç½®å¢å¼ºä½œç”¨åœ¨å“ªä¸ªåœ°æ–¹ã€‚</p>
<p><img src="/images/%E5%88%87%E9%9D%A2%E6%B3%A8%E8%A7%A3.png"></p>
<h3 id="å®Œå…¨æ³¨è§£å¼€å‘"><a href="#å®Œå…¨æ³¨è§£å¼€å‘" class="headerlink" title="å®Œå…¨æ³¨è§£å¼€å‘"></a>å®Œå…¨æ³¨è§£å¼€å‘</h3><p>åˆ›å»ºé…ç½®ç±»ï¼Œä¸éœ€è¦å†™xmlé…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//ä½œä¸ºé…ç½®ç±»ï¼Œæ›¿ä»£xmlé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.company&quot;&#125;)</span>  <span class="comment">//å¼€å¯ç»„ä»¶æ‰«æ</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass=true)</span>  <span class="comment">//ä»£æ›¿é…ç½®åˆ‡å…¥ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JDBCTemplate-æ¦‚è¿°å’Œå‡†å¤‡å·¥ä½œ"><a href="#JDBCTemplate-æ¦‚è¿°å’Œå‡†å¤‡å·¥ä½œ" class="headerlink" title="JDBCTemplate-æ¦‚è¿°å’Œå‡†å¤‡å·¥ä½œ"></a>JDBCTemplate-æ¦‚è¿°å’Œå‡†å¤‡å·¥ä½œ</h3><p>1.ä»€ä¹ˆæ˜¯JDBCTemplateï¼Ÿ</p>
<p>Springæ¡†æ¶å¯¹JDBCè¿›è¡Œå°è£…ï¼Œä½¿ç”¨JDBCTemplateå¯ä»¥æ–¹ä¾¿å®ç°å¯¹æ•°æ®åº“çš„æ“ä½œã€‚</p>
<p>2.å‡†å¤‡å·¥ä½œ</p>
<p>ï¼ˆ1ï¼‰å¼•å…¥ç›¸å…³çš„jaråŒ…</p>
<p>éœ€è¦mysqlåŒ…ã€druidå¾·é²ä¼ŠåŒ…ã€springä¸­çš„jdbcåŒ…ã€springä¸­çš„txçš„äº‹åŠ¡ç›¸å…³ã€springä¸­çš„ormåŒ…ç”¨æ¥æ•´åˆå…¶ä»–æ¡†æ¶ã€‚</p>
<p>ï¼ˆ2ï¼‰åœ¨springé…ç½®æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“çš„è¿æ¥æ± </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç›´æ¥é…ç½®è¿æ¥æ±  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/userDb&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰é…ç½®JDBCTemplateå¯¹è±¡ï¼Œæ³¨å…¥DataSourceï¼Œç”¨çš„setæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;jdbcTemplate&quot;</span> class=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span><br><span class="line">    &lt;!-- æ³¨å…¥DataSource --&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰åˆ›å»ºserviceç±»ï¼Œåˆ›å»ºdaoç±»ï¼Œå®Œæˆæ³¨å…¥ï¼Œåœ¨daoæ³¨å…¥jdbcTemplateå¯¹è±¡ã€‚</p>
<p>å¼€å¯ç»„ä»¶æ‰«æï¼Œç”¨æ³¨è§£åˆ›å»ºå¯¹è±¡ï¼Œserviceä¸­æ³¨å…¥daoï¼Œdaoä¸­æ³¨å…¥jdbcTemplateå¯¹è±¡ã€‚</p>
<h3 id="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ·»åŠ ï¼‰"><a href="#JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ·»åŠ ï¼‰" class="headerlink" title="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ·»åŠ ï¼‰"></a>JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ·»åŠ ï¼‰</h3><p>1.macå®‰è£…æ•°æ®åº“å¯è§†åŒ–å·¥å…·ï¼Œæœ€ç»ˆè£…äº†DataGripï¼Œè§å¸–å­ã€ŠMacå®‰è£…mysqlã€‹</p>
<p>2.å»ºåº“å»ºè¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql -uliuxuan -p</span><br><span class="line">create database b_jdbc;</span><br><span class="line">show databases;</span><br><span class="line">use b_jdbc;</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS `user_db`(</span><br><span class="line">   `user_id` bigint unsigned NOT NULL,</span><br><span class="line">   `username` varchar(100) NOT NULL,</span><br><span class="line">   `ustate` varchar(50) NOT NULL,</span><br><span class="line">   PRIMARY KEY(`user_id`)</span><br><span class="line">)ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;biao&#x27;;</span><br><span class="line"></span><br><span class="line"> CREATE TABLE `kiss_share_idproducer` (</span><br><span class="line">  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT &#x27;è‡ªå¢&#x27;,</span><br><span class="line">  `app_id` bigint NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;äº§å“çº¿id&#x27;,</span><br><span class="line">  `init_id` bigint NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;åˆå§‹åŒ–id&#x27;,</span><br><span class="line">  `max_id` bigint NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;å½“å‰id&#x27;,</span><br><span class="line">  `setp` bigint NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;æ¯æ¬¡åˆ†é…æ•°&#x27;,</span><br><span class="line">  `mix_id` smallint NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;å¯ç”¨ä¸ªä½æ··æ·†å› å­&#x27;,</span><br><span class="line">  `desc` varchar(16) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;desc&#x27;,</span><br><span class="line">  `mtime` int NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `idx_app` (`app_id`) USING BTREE</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;å‘å·å™¨&#x27;;</span><br></pre></td></tr></table></figure>

<p>3.entityåŒ…é‡Œå¯¹åº”æ•°æ®åº“åˆ›å»ºå®ä½“ç±»</p>
<p>4.ç¼–å†™serveicå’Œdao</p>
<p>ï¼ˆ1ï¼‰åœ¨daoä¸­æ“ä½œæ•°æ®åº“æ·»åŠ æ–¹æ³•</p>
<p>ï¼ˆ2ï¼‰è°ƒç”¨JdbcTemplateå¯¹è±¡é‡Œé¢updateæ–¹æ³•å®ç°æ·»åŠ æ“ä½œï¼šä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯sqlè¯­å¥ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯å˜å‚æ•°ï¼Œè®¾ç½®sqlè¯­å¥å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span>  <span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="comment">//æ³¨å…¥Dao</span></span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//ä½¿ç”¨æ³¨è§£æ–¹å¼å®ç°æ³¨å…¥</span></span><br><span class="line">    <span class="keyword">private</span> BookDao userDao;  <span class="comment">//ä½¿ç”¨daoä¸­çš„æ–¹æ³•å¾—åˆ›å»ºBookDaoï¼ˆæ¥å£ï¼Ÿï¼‰çš„å¯¹è±¡ï¼Œç–‘æƒ‘ï¼šä¸ºä»€ä¹ˆæ˜¯æ¥å£ï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        userDao.add(user);  <span class="comment">//ç”¨daoé‡Œçš„æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span>  <span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="comment">//æ³¨å…¥JDBCTemplate</span></span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„JdbcTemplate</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ•°æ®åº“æ·»åŠ æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºsqlè¯­å¥</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into user_db values(?,?,?)&quot;</span>;</span><br><span class="line">        <span class="comment">//2.è°ƒç”¨æ–¹æ³•å®ç°</span></span><br><span class="line">        <span class="comment">//å¯å˜å‚æ•°å°±æ˜¯ä¸€ä¸ªæ•°ç»„å‹ï¼Œå¯ä»¥ç”¨Object</span></span><br><span class="line">        Object[] args = &#123;user.getUserId(), user.getUserName(), user.getUstate()&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> jdbcTemplate.update(sql, args);  <span class="comment">//updateè¡¨ç¤ºå½±å“è¡Œæ•°</span></span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.ç¼–å†™æµ‹è¯•æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJDBC</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJDBC</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.åŠ è½½springé…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean1.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//2.è·å–é…ç½®åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">BookService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;bookService&quot;</span>, BookService.class);</span><br><span class="line">        <span class="comment">//getBeançš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºbeançš„åç§°ï¼Œxmlé…ç½®æ–‡ä»¶ä¸­çš„idï¼Œå¦‚æœæ˜¯æ³¨è§£åˆ›å»ºï¼Œåˆ™å°å†™ç¬¬ä¸€ä½</span></span><br><span class="line">        <span class="comment">//æ–°å»ºä¸€ä¸ªUserå¯¹è±¡</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        u.setUserId(<span class="number">2</span>);</span><br><span class="line">        u.setUserName(<span class="string">&quot;lucky&quot;</span>);</span><br><span class="line">        u.setUstate(<span class="string">&quot;online&quot;</span>);</span><br><span class="line">        <span class="comment">//è°ƒç”¨serviceä¸­çš„æ–¹æ³•</span></span><br><span class="line">        service.addUser(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.å‘ç”Ÿé”™è¯¯ï¼š</p>
<p><code>ä¸¥é‡: create connection SQLException, url: jdbc:mysql://localhost:3306/b_jdbc, errorCode 1251, state 08004</code></p>
<p>mysql-connectorçš„jaråŒ…ç‰ˆæœ¬å¤ªä½ï¼ŒåŸæ¥æ˜¯5.å‡ ï¼Œæ”¹ä¸º8.å‡ ï¼Œæ”¹è¿‡ä¹‹åï¼Œéœ€è¦åŠ jcï¼Œ<code>value=&quot;com.mysql.cj.jdbc.Driver</code>ï¼Œä»¥åŠï¼Œurlåé¢è¦åŠ æ—¶åŒºï¼Œ<code>value=&quot;jdbc:mysql://localhost:3306/b_jdbc?serverTimezone=UTC&quot;</code></p>
<p>åæ¥åˆå‘ç”Ÿé”™è¯¯ï¼š<code> create connection SQLException, url: jdbc:mysql://localhost:3306/b_jdbc?serverTimezone=UTC, errorCode 1045, state 28000</code> è¿™ä¸ªæ˜¯å› ä¸ºç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯rootï¼Œè¿æ¥ä¸ä¸Šã€‚rootçš„å¯†ç ä¸ºç©ºï¼Œæ˜¯å¯ä»¥çš„è¿æ¥æˆåŠŸçš„ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç›´æ¥é…ç½®è¿æ¥æ±  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/b_jdbc?serverTimezone=UTC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™ä¸ªjdbcè¿æ¥æ•°æ®åº“çš„æ–¹æ³•ï¼ˆé€šè¿‡é…ç½®æ–‡ä»¶ï¼‰ï¼Œå’Œã€Šjavaå¼€å‘å…¥é—¨jdbcã€‹é‡Œé¢çš„è¿æ¥æ•°æ®åº“æ–¹æ³•ä¸åŒã€‚</p>
</blockquote>
<h2 id="Day-8"><a href="#Day-8" class="headerlink" title="Day 8"></a>Day 8</h2><h3 id="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆä¿®æ”¹ã€åˆ é™¤ï¼‰"><a href="#JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆä¿®æ”¹ã€åˆ é™¤ï¼‰" class="headerlink" title="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆä¿®æ”¹ã€åˆ é™¤ï¼‰"></a>JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆä¿®æ”¹ã€åˆ é™¤ï¼‰</h3><p>1.é¦–å…ˆdaoæ¥å£åˆ›å»ºä¸¤ä¸ªæ–¹æ³•ï¼Œdaoå®ç°ç±»é‡Œé‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<p>2.serviceå±‚é‡Œåˆ›å»ºdaoå®ç°ç±»å¯¹è±¡ï¼Œåˆ›å»ºæ–¹æ³•ï¼Œé‡Œé¢è°ƒç”¨å¯¹è±¡çš„daoå±‚æ–¹æ³•ã€‚serviceå’Œdaoçš„æ–¹æ³•ä¼ å…¥å¿…è¦å‚æ•°ï¼Œuserå¯¹è±¡æˆ–æ˜¯idä¹‹ç±»çš„ã€‚</p>
<p>3.é‡ç‚¹å†™daoå±‚å†…æ“ä½œæ•°æ®åº“çš„æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update user_db set username=?, ustate=? where user_id=?&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> jdbcTemplate.update(sql, user.getUserName(), user.getUstate(), user.getUserId());</span><br><span class="line">    System.out.println(update);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from user_db where user_id=?&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> jdbcTemplate.update(sql, id);</span><br><span class="line">    System.out.println(update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.æµ‹è¯•æ–¹æ³•</p>
<h3 id="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›æŸä¸ªå€¼ï¼‰"><a href="#JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›æŸä¸ªå€¼ï¼‰" class="headerlink" title="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›æŸä¸ªå€¼ï¼‰"></a>JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›æŸä¸ªå€¼ï¼‰</h3><p>ä¾‹å¦‚è¿”å›å¤šå°‘è¡Œæ•°æ®ã€‚<code>select count(*) from user_db;</code></p>
<p>ä¾‹å¦‚ï¼šæŸ¥è¯¢è¡¨é‡Œæœ‰å¤šå°‘æ¡è®°å½•ã€‚</p>
<p>é¦–å…ˆå†™ä¸€ä¸ªserviceæ–¹æ³•findCountï¼Œè°ƒç”¨daoé‡Œçš„æ–¹æ³•ï¼Œå†™daoæ–¹æ³•ã€‚daoæ–¹æ³•é‡Œå†™selectè¯­å¥ï¼Œå¹¶è¿”å›ã€‚ä½¿ç”¨jdbcæ–¹æ³•queryForObject(sqlè¯­å¥, è¿”å›ç±»å‹çš„classä¾‹å¦‚Integer.class)ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select count(*) from user_db&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">nums</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, Integer.class);</span><br><span class="line">    <span class="keyword">return</span> nums;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›å¯¹è±¡ï¼‰"><a href="#JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›å¯¹è±¡ï¼‰" class="headerlink" title="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›å¯¹è±¡ï¼‰"></a>JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›å¯¹è±¡ï¼‰</h3><p>ä¾‹å¦‚ï¼šæŸ¥è¯¢ç”¨æˆ·çš„è¯¦æƒ…é¡µé¢ã€‚</p>
<p>æ ¹æ®idè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œserviceå†™ä¸€ä¸ªfindUseræ–¹æ³•ï¼Œdaoå†™ä¸€ä¸ªfindæ–¹æ³•ã€‚daoå†…é‡‡ç”¨jdbcæ¨¡ç‰ˆä¸­çš„queryForObjectæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼šsqlè¯­å¥ï¼›ç¬¬äºŒä¸ªå‚æ•°ï¼šRowMapperæ¥å£ï¼Œspringæä¾›ï¼Œåšåˆ°ä¸€äº›å°è£…ï¼Œä½¿ç”¨è¿™ä¸ªæ¥å£é‡Œé¢çš„å®ç°ç±»å¯ä»¥å®Œæˆæ•°æ®çš„å°è£…ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šsqlè¯­å¥?å€¼ã€‚</p>
<p>ç¬¬äºŒä¸ªå‚æ•°ï¼š<code>new BeanPropertyRowMapper&lt;è¿”å›ç±»å‹çš„åå­—&gt;(è¿”å›ç±»å‹çš„class)</code> ã€‚æä¾›å¥½çš„å®ç°ç±»ï¼Œç›´æ¥ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">    String sql= <span class="string">&quot;select * from user_db where user_id=?&quot;</span>;</span><br><span class="line">    <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;User&gt;(User.class), id);</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†æ˜¾ç¤ºUserå¯¹è±¡ï¼Œé‡å†™é‡Œé¢çš„tostringæ–¹æ³•ã€‚</p>
<h3 id="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›é›†åˆï¼‰"><a href="#JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›é›†åˆï¼‰" class="headerlink" title="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›é›†åˆï¼‰"></a>JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›é›†åˆï¼‰</h3><p>åœºæ™¯ï¼šæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼Œè¿”å›ä¸€ä¸ªé›†åˆã€‚è¿”å›<code>List&lt;User&gt;</code></p>
<p> é¦–å…ˆserviceè°ƒç”¨daoçš„æ–¹æ³•ï¼Œç¼–å†™daoæ–¹æ³•ã€‚daoå†…ç”¨queryæ–¹æ³•æ“ä½œæ•°æ®åº“ã€‚queryä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°sqlè¯­å¥ï¼›ç¬¬äºŒä¸ªå‚æ•°å’Œä¸Šé¢ä¸€æ ·ï¼›ç¬¬ä¸‰ä¸ªå¯æœ‰å¯æ— ï¼Ÿå‚æ•°å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user_db&quot;</span>;</span><br><span class="line">    List&lt;User&gt;res = jdbcTemplate.query(sql, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;User&gt;(User.class));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡æ·»åŠ æ“ä½œï¼‰"><a href="#JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡æ·»åŠ æ“ä½œï¼‰" class="headerlink" title="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡æ·»åŠ æ“ä½œï¼‰"></a>JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡æ·»åŠ æ“ä½œï¼‰</h3><p>æ‰¹é‡æ“ä½œæŒ‡æ“ä½œè¡¨é‡Œçš„å¤šæ¡è®°å½•</p>
<p>æ‰¹é‡æ·»åŠ ï¼Œä½¿ç”¨ jdbcçš„<code>batchUpdate(sqlè¯­å¥, List&lt;Object[]&gt;batchArgs)</code>æ–¹æ³•ã€‚è¿”å›çš„æ˜¯int[]ç±»å‹ã€‚åº•å±‚æ˜¯å¯¹é›†åˆè¿›è¡Œéå†ï¼ŒæŒ¨ä¸ªæ·»åŠ ã€‚æ•°ç»„è¾“å‡ºè¦ç”¨Arrays.toString(æ•°ç»„å)ã€‚</p>
<p>serviceå±‚å»ºä¸€ä¸ªbatchAddæ–¹æ³•ï¼Œä¼ å…¥List&lt;Object[]&gt;batchArgsã€‚daoä¸­åˆ›å»ºæ–¹æ³•ï¼Œå®ç°æ“ä½œæ•°æ®åº“ï¼Œ<code>insert into user_db values(?,?,?)</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchAdd</span><span class="params">(List&lt;Object[]&gt; batchArgs)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into user_db values(?,?,?)&quot;</span>;</span><br><span class="line">    <span class="type">int</span>[] update = jdbcTemplate.batchUpdate(sql, batchArgs);</span><br><span class="line">    System.out.println(<span class="string">&quot;å½±å“è¡Œæ•°ï¼š&quot;</span>+ Arrays.toString(update));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡ä¿®æ”¹æ“ä½œï¼‰"><a href="#JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡ä¿®æ”¹æ“ä½œï¼‰" class="headerlink" title="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡ä¿®æ”¹æ“ä½œï¼‰"></a>JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡ä¿®æ”¹æ“ä½œï¼‰</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchUpdate</span><span class="params">(List&lt;Object[]&gt; batchArgs)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update user_db set username=?,ustate=? where user_id=?&quot;</span>;</span><br><span class="line">    <span class="type">int</span>[] update = jdbcTemplate.batchUpdate(sql, batchArgs);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰¹é‡æ›´æ–°å½±å“è¡Œæ•°ï¼š&quot;</span>+ Arrays.toString(update));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå»ºList</span></span><br><span class="line">List&lt;Object[]&gt; batchArgs2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Object[] o3 = &#123;<span class="string">&quot;java&quot;</span>, <span class="string">&quot;on&quot;</span>, <span class="number">1</span>&#125;;</span><br><span class="line">Object[] o4 = &#123;<span class="string">&quot;c++&quot;</span>, <span class="string">&quot;off&quot;</span>, <span class="number">2</span>&#125;;</span><br><span class="line">batchArgs2.add(o3);</span><br><span class="line">batchArgs2.add(o4);</span><br><span class="line">service.batchUpdate(batchArgs2);</span><br></pre></td></tr></table></figure>

<h3 id="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡åˆ é™¤æ“ä½œï¼‰"><a href="#JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡åˆ é™¤æ“ä½œï¼‰" class="headerlink" title="JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡åˆ é™¤æ“ä½œï¼‰"></a>JDBCTemplateæ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡åˆ é™¤æ“ä½œï¼‰</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchDelete</span><span class="params">(List&lt;Object[]&gt; batchArgs)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from user_db where user_id=?&quot;</span>;</span><br><span class="line">    <span class="type">int</span>[] update = jdbcTemplate.batchUpdate(sql, batchArgs);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰¹é‡åˆ é™¤å½±å“è¡Œæ•°ï¼š&quot;</span>+ Arrays.toString(update));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå»ºList</span></span><br><span class="line">List&lt;Object[]&gt; batchArgs3 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Object[] o5= &#123;<span class="number">17</span>&#125;;</span><br><span class="line">Object[] o6 = &#123;<span class="number">18</span>&#125;;</span><br><span class="line">batchArgs3.add(o5);</span><br><span class="line">batchArgs3.add(o6);</span><br><span class="line">service.batchDelete(batchArgs3);</span><br></pre></td></tr></table></figure>

<h2 id="Day-9"><a href="#Day-9" class="headerlink" title="Day 9"></a>Day 9</h2><h3 id="äº‹åŠ¡æ“ä½œ-äº‹åŠ¡æ¦‚å¿µ"><a href="#äº‹åŠ¡æ“ä½œ-äº‹åŠ¡æ¦‚å¿µ" class="headerlink" title="äº‹åŠ¡æ“ä½œ-äº‹åŠ¡æ¦‚å¿µ"></a>äº‹åŠ¡æ“ä½œ-äº‹åŠ¡æ¦‚å¿µ</h3><p>1ã€ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ</p>
<p>äº‹åŠ¡æ˜¯æ•°æ®åº“æ“ä½œçš„æœ€åŸºæœ¬å•å…ƒï¼Œé€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚</p>
<p>2ã€äº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼šACIDï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚</p>
<h3 id="äº‹åŠ¡æ“ä½œ-æ­å»ºäº‹åŠ¡æ“ä½œç¯å¢ƒ"><a href="#äº‹åŠ¡æ“ä½œ-æ­å»ºäº‹åŠ¡æ“ä½œç¯å¢ƒ" class="headerlink" title="äº‹åŠ¡æ“ä½œ-æ­å»ºäº‹åŠ¡æ“ä½œç¯å¢ƒ"></a>äº‹åŠ¡æ“ä½œ-æ­å»ºäº‹åŠ¡æ“ä½œç¯å¢ƒ</h3><p>åœºæ™¯ï¼šè½¬è´¦ç¯å¢ƒ</p>
<p>javaeeæœ‰ä¸‰å±‚ï¼šwebå±‚ã€serviceä¸šåŠ¡é€»è¾‘å±‚ã€daoå¯¹æ•°æ®åº“æ“ä½œå±‚ä¸å†™ä¸šåŠ¡æ“ä½œã€‚</p>
<p>daoå±‚åˆ›å»ºä¸¤ä¸ªæ–¹æ³•ï¼šï¼ˆ1ï¼‰å°‘é’±çš„æ–¹æ³•ï¼ˆ2ï¼‰å¤šé’±çš„æ–¹æ³•ã€‚</p>
<p>serviceå±‚åˆ›å»ºæ–¹æ³•ï¼šè½¬è´¦æ–¹æ³•ä¸­è°ƒç”¨daoçš„ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<p>1.åˆ›å»ºæ•°æ®åº“è¡¨ï¼Œæ·»åŠ è®°å½•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS `acount`(</span><br><span class="line">   `id` int unsigned NOT NULL,</span><br><span class="line">   `username` varchar(100) NOT NULL,</span><br><span class="line">   `money` bigint NOT NULL,</span><br><span class="line">   PRIMARY KEY(`id`)</span><br><span class="line">)ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;acount&#x27;;</span><br><span class="line"></span><br><span class="line">insert into acount values(1, &quot;liu&quot;, 1000);</span><br><span class="line">insert into acount values(2, &quot;hao&quot;, 1000);</span><br></pre></td></tr></table></figure>

<p>2.åˆ›å»ºserviceï¼Œæ­å»ºdaoï¼Œå®Œæˆå¯¹è±¡åˆ›å»ºå’Œæ³¨å…¥å…³ç³»ã€‚</p>
<p>serviceæ³¨å…¥daoï¼Œåœ¨daoæ³¨å…¥JdbcTemplateï¼Œåœ¨JdbcTemplateæ³¨å…¥DataSourceã€‚</p>
<p>serviceç±»ï¼Œä½¿ç”¨æ³¨è§£@Serviceæ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œ@Autowiredæ³¨å…¥daoã€‚åŒæ ·åœ¨daoç”¨@Autowiredæ³¨å…¥jdbcã€‚</p>
<p>3.åœ¨daoä¸­åˆ›å»ºä¸¤ä¸ªæ–¹æ³•ï¼Œå¤šé’±addMoneyå’Œå°‘é’±reduceMoneyçš„æ–¹æ³•ï¼Œåœ¨serviceä¸­åˆ›å»ºæ–¹æ³•ï¼Œè½¬è´¦çš„æ–¹æ³•ã€‚daoä¸­ç”¨updateæ–¹æ³•ã€‚</p>
<p>4.æµ‹è¯•</p>
<p>5.å‘ç°é—®é¢˜ï¼Œå¦‚æœå…ˆæ‰§è¡Œå®Œdaoä¸­çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œå‘ç”Ÿå¼‚å¸¸ï¼Œç¬¬äºŒä¸ªæ–¹æ³•å°†ä¸æ‰§è¡Œï¼Œäº§ç”Ÿæ•°æ®å¼‚å¸¸ã€‚å¦‚ä½•è§£å†³ï¼Ÿä½¿ç”¨äº‹åŠ¡ã€‚</p>
<p>åœ¨serviceçš„æ–¹æ³•ä¸­ï¼Œtry catchæ•è·å¼‚å¸¸ã€‚é¦–å…ˆå¼€å¯äº‹åŠ¡ï¼Œç„¶åè¿›è¡Œäº‹åŠ¡æ“ä½œï¼Œæ²¡æœ‰å‘ç°å¼‚å¸¸åˆ™æäº¤äº‹åŠ¡ï¼Œå‡ºç°å¼‚å¸¸åˆ™äº‹åŠ¡å›æ»šã€‚</p>
<h3 id="äº‹åŠ¡æ“ä½œ-Springäº‹åŠ¡ç®¡ç†ä»‹ç»"><a href="#äº‹åŠ¡æ“ä½œ-Springäº‹åŠ¡ç®¡ç†ä»‹ç»" class="headerlink" title="äº‹åŠ¡æ“ä½œ-Springäº‹åŠ¡ç®¡ç†ä»‹ç»"></a>äº‹åŠ¡æ“ä½œ-Springäº‹åŠ¡ç®¡ç†ä»‹ç»</h3><p>1.äº‹åŠ¡ç®¡ç†åŠ åˆ°å“ªä¸ªå±‚ï¼Ÿå»ºè®®åŠ åˆ°ä¸šåŠ¡é€»è¾‘å±‚serviceã€‚</p>
<p>2.åœ¨Springè¿›è¡Œäº‹åŠ¡ç®¡ç†æ“ä½œ</p>
<p>ï¼ˆ1ï¼‰æœ‰ä¸¤ç§æ–¹å¼ï¼šç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†å’Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼ˆä¸€èˆ¬ä½¿ç”¨å£°æ˜å¼ï¼‰</p>
<p>ç¼–ç¨‹å¼æŒ‡çš„æ˜¯ç”¨ä»£ç å®ç°ç¬¬ä¸€æ­¥ç¬¬äºŒæ­¥ç¬¬ä¸‰æ­¥ã€‚ã€‚ã€‚try catchæ•è·å¼‚å¸¸ä¹‹ç±»çš„ã€‚</p>
<p>3.å£°æ˜å¼äº‹åŠ¡ç®¡ç†ä¸¤ç§æ–¹å¼</p>
<p>ï¼ˆ1ï¼‰åŸºäºæ³¨è§£æ–¹å¼ï¼ˆä½¿ç”¨ï¼‰</p>
<p>ï¼ˆ2ï¼‰åŸºäºxmlé…ç½®æ–‡ä»¶æ–¹å¼</p>
<p>4.åœ¨Springè¿›è¡Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œåº•å±‚ä½¿ç”¨AOPã€‚</p>
<p>5.Springäº‹åŠ¡ç®¡ç†API</p>
<p>æä¾›ä¸€ä¸ªæ¥å£ï¼Œä»£è¡¨äº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™ä¸ªæ¥å£é’ˆå¯¹ä¸åŒçš„æ¡†æ¶æä¾›ä¸åŒçš„å®ç°ç±»ã€‚</p>
<p>PlatformTransactionManageræ¥å£ã€‚DatasourceTransactionManagerå®ç°ç±»é’ˆå¯¹jdbcã€‚</p>
<h3 id="äº‹åŠ¡æ“ä½œ-æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†"><a href="#äº‹åŠ¡æ“ä½œ-æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†" class="headerlink" title="äº‹åŠ¡æ“ä½œ-æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†"></a>äº‹åŠ¡æ“ä½œ-æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h3><p>1.åœ¨springé…ç½®æ–‡ä»¶ä¸­é…ç½®äº‹åŠ¡ç®¡ç†å™¨ã€‚æœ¬è´¨ä¸Šå°±æ˜¯åˆ›å»ºPlatformTransactionManageræ¥å£å®ç°ç±»çš„å¯¹è±¡ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ³¨å…¥DataSourceæ•°æ®æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.åœ¨springé…ç½®æ–‡ä»¶ä¸­ï¼Œå¼€å¯äº‹åŠ¡æ³¨è§£</p>
<p>ï¼ˆ1ï¼‰åœ¨Springé…ç½®æ–‡ä»¶ä¸­å¼•å…¥åç§°ç©ºé—´tx. <code>xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</code></p>
<p>ï¼ˆ2ï¼‰å¼€å¯äº‹åŠ¡æ³¨è§£</p>
<p><code>&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;</code></p>
<p>3.åœ¨serviceç±»ä¸Šé¢ï¼ˆæˆ–è€…serviceç±»é‡Œé¢çš„æ–¹æ³•ä¸Šé¢ï¼‰æ·»åŠ æ³¨è§£ @Transactional</p>
<p>å¦‚æœæ·»åŠ åˆ°ç±»ä¸Šé¢ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»é‡Œçš„æ‰€æœ‰æ–¹æ³•éƒ½æ·»åŠ äº‹åŠ¡ã€‚</p>
<h3 id="äº‹åŠ¡æ“ä½œ-å£°æ˜å¼äº‹åŠ¡ç®¡ç†å‚æ•°é…ç½®"><a href="#äº‹åŠ¡æ“ä½œ-å£°æ˜å¼äº‹åŠ¡ç®¡ç†å‚æ•°é…ç½®" class="headerlink" title="äº‹åŠ¡æ“ä½œ-å£°æ˜å¼äº‹åŠ¡ç®¡ç†å‚æ•°é…ç½®-"></a>äº‹åŠ¡æ“ä½œ-å£°æ˜å¼äº‹åŠ¡ç®¡ç†å‚æ•°é…ç½®-</h3><p>1.åœ¨serviceç±»ä¸Šé¢æ·»åŠ æ³¨è§£@Transactionalï¼Œåœ¨è¿™ä¸ªæ³¨è§£é‡Œé¢å¯ä»¥é…ç½®äº‹åŠ¡ç›¸å…³å‚æ•°ã€‚</p>
<p><strong>ç¬¬ä¸€ä¸ªå‚æ•°</strong>ï¼špropagation è¡¨ç¤ºäº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œå¤šäº‹åŠ¡æ–¹æ³•ç›´æ¥è¿›è¡Œè°ƒç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­äº‹åŠ¡æ˜¯å¦‚ä½•è¿›è¡Œç®¡ç†çš„ã€‚</p>
<p>äº‹åŠ¡æ–¹æ³•ï¼šå¯¹æ•°æ®åº“è¡¨æ•°æ®è¿›è¡Œå˜åŒ–çš„æ“ä½œã€‚</p>
<p>Springæ¡†æ¶äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæœ‰ä¸ƒç§ï¼Œåˆ—å‡ºæœ€å¸¸è§çš„ä¸¤ç§ï¼š<br>ï¼ˆ1ï¼‰requiredï¼šaddæ–¹æ³•ä¸­æœ‰äº‹åŠ¡ï¼Œupdateæ²¡æœ‰ï¼Œaddæ–¹æ³•å†…è°ƒç”¨updateæ–¹æ³•ï¼Œåˆ™updateæ–¹æ³•ä½¿ç”¨addæ–¹æ³•å†…çš„äº‹åŠ¡ã€‚å¦‚æœaddæ–¹æ³•æ²¡æœ‰äº‹åŠ¡ï¼Œè°ƒç”¨updateæ–¹æ³•ä¹‹åï¼Œaddåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¹¶åœ¨äº‹åŠ¡å†…è¿è¡Œã€‚ä¹Ÿæ˜¯é»˜è®¤çš„ä¼ æ’­è¡Œä¸ºã€‚</p>
<p>ï¼ˆ2ï¼‰required_newï¼šä½¿ç”¨addæ–¹æ³•è°ƒç”¨updateæ–¹æ³•ï¼Œæ— è®ºaddæ–¹æ³•æ˜¯å¦æœ‰äº‹åŠ¡ï¼Œaddæ–¹æ³•éƒ½ä¼šæ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚</p>
<p><strong>ç¬¬äºŒä¸ªå‚æ•°</strong>ï¼šioslation è¡¨ç¤ºäº‹åŠ¡éš”ç¦»çº§åˆ«</p>
<p>äº‹åŠ¡çš„éš”ç¦»æ€§ï¼šå¤šäº‹åŠ¡æ“ä½œä¹‹é—´ä¸ä¼šäº§ç”Ÿå½±å“ã€‚æœ‰ä¸‰ä¸ªè¯»çš„é—®é¢˜ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€è™šï¼ˆå¹»ï¼‰è¯»ã€‚</p>
<p>è„è¯»ï¼šå¤šä¸ªäº‹ç‰©ä¹‹é—´ï¼Œä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡è¯»å–åˆ°å¦ä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡ã€‚ä¾‹å¦‚ä¸¤ä¸ªäººéƒ½è¦æ“ä½œä¸€æ¡è®°å½•ï¼ŒåŸæ¥1000ï¼Œäº‹åŠ¡aæ”¹äº†è¿™æ¡è®°å½•ï¼Œå˜ä¸º2000ï¼Œäº‹åŠ¡bè¯»å–åˆ°äº‹åŠ¡aä¿®æ”¹çš„2000ï¼Œä½†æ˜¯äº‹åŠ¡aå›æ»šäº†ã€‚ç®—æ˜¯ä¸€ä¸ªè‡´å‘½é—®é¢˜ï¼Œä¸èƒ½å‡ºç°ã€‚</p>
<p>ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡è¯»å–åˆ°å¦ä¸€ä¸ªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œäº‹åŠ¡aè¯»å–åˆ°åŸæ•°æ®100ï¼Œäº‹åŠ¡bè¯»å–åˆ°åŸæ•°æ®100ï¼Œå¹¶å°†å…¶ä¿®æ”¹ä¸º200ï¼Œäº‹åŠ¡bæäº¤ï¼Œäº‹åŠ¡aè¯»å–åˆ°æ•°æ®200ï¼Œè¿™æ ·äº‹åŠ¡bå¯¹äº‹åŠ¡aäº§ç”Ÿäº†å½±å“ã€‚æ˜¯ä¸€ç§ç°è±¡ï¼Œä¸èƒ½ç®—ä½œé—®é¢˜ã€‚</p>
<p>å¹»è¯»ï¼šä¸€ä¸ªæœªæäº¤äº‹åŠ¡è¯»å–åˆ°å¦ä¸€ä¸ªæäº¤äº‹åŠ¡æ·»åŠ æ•°æ®ã€‚</p>
<p>é€šè¿‡è®¾ç½®éš”ç¦»çº§åˆ«å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚read uncommitted è¯»æœªæäº¤ï¼›read committed è¯»å·²æäº¤ï¼›repeatable read å¯é‡å¤è¯»ï¼ˆé»˜è®¤çš„ï¼‰ï¼›serializable ä¸²è¡ŒåŒ–ã€‚</p>
<p><strong>ç¬¬ä¸‰ä¸ªå‚æ•°</strong>ï¼štimeout è¡¨ç¤ºäº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼Œäº‹åŠ¡éœ€è¦åœ¨ä¸€å®šæ—¶é—´å†…æäº¤ï¼Œè¶…æ—¶ä¸æäº¤åˆ™è¿›è¡Œå›æ»šã€‚é»˜è®¤å€¼æ˜¯ -1ï¼Œä¸è¶…æ—¶ã€‚è®¾ç½®æ—¶é—´æ˜¯ä»¥ç§’ä¸ºå•ä½ã€‚</p>
<p><strong>ç¬¬å››ä¸ªå‚æ•°</strong>ï¼šreadOnly æ˜¯å¦åªè¯»ï¼Œè¯»æ˜¯æŸ¥è¯¢æ“ä½œï¼ŒreadOnlyé»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºå¯ä»¥æŸ¥è¯¢å¯ä»¥æ·»åŠ ä¿®æ”¹åˆ é™¤ï¼Œè®¾ç½®ä¸ºtrueï¼Œåˆ™åªèƒ½æŸ¥è¯¢ã€‚</p>
<p><strong>ç¬¬äº”ä¸ªå‚æ•°</strong>ï¼šrollbackFor å›æ»šï¼Œè®¾ç½®å‡ºç°å“ªäº›å¼‚å¸¸è¿›è¡Œäº‹åŠ¡å›æ»šã€‚</p>
<p><strong>ç¬¬å…­ä¸ªå‚æ•°</strong>ï¼šnoRollbackFor ä¸å›æ»šï¼Œè®¾ç½®å‡ºç°å“ªäº›å¼‚å¸¸ä¸è¿›è¡Œäº‹åŠ¡å›æ»šã€‚</p>
<h3 id="äº‹åŠ¡æ“ä½œ-xmlå£°æ˜å¼äº‹åŠ¡ç®¡ç†"><a href="#äº‹åŠ¡æ“ä½œ-xmlå£°æ˜å¼äº‹åŠ¡ç®¡ç†" class="headerlink" title="äº‹åŠ¡æ“ä½œ-xmlå£°æ˜å¼äº‹åŠ¡ç®¡ç†"></a>äº‹åŠ¡æ“ä½œ-xmlå£°æ˜å¼äº‹åŠ¡ç®¡ç†</h3><p>1.åœ¨Springé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚</p>
<p>ç¬¬ä¸€æ­¥ é…ç½®äº‹åŠ¡ç®¡ç†å™¨</p>
<p>ç¬¬äºŒæ­¥ é…ç½®é€šçŸ¥ï¼Œaopä¸­å¢å¼ºçš„é‚£éƒ¨åˆ†ï¼Œè¿™é‡Œå°±æ˜¯äº‹åŠ¡ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ é…ç½®åˆ‡å…¥ç‚¹å’Œåˆ‡é¢ï¼Œè¦å°†äº‹åŠ¡åŠ åˆ°å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•ä¸­ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ³¨å…¥DataSourceæ•°æ®æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¼€å¯äº‹åŠ¡æ³¨è§£ï¼Œ xmlæ–¹å¼ä¸­ ä¸éœ€è¦äº†</span></span><br><span class="line"><span class="comment">&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;  --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2.é…ç½®é€šçŸ¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txadvice&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®äº‹åŠ¡çš„ä¸€äº›ç›¸å…³å‚æ•° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šå“ªç§è§„åˆ™çš„æ–¹æ³•ä¸Šé¢æ·»åŠ äº‹åŠ¡ï¼Œä¾‹å¦‚ add* è¡¨ç¤ºaddå¼€å¤´çš„æ·»åŠ äº‹åŠ¡ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;jiaoyi&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">isolation</span>=<span class="string">&quot;REPEATABLE_READ&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3.é…ç½®åˆ‡å…¥ç‚¹å’Œåˆ‡é¢ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®åˆ‡å…¥ç‚¹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;qierudiansname&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.company.service.UserService.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®åˆ‡å…¥ç‚¹, å°†äº‹åŠ¡çš„é€šçŸ¥è®¾ç½®åˆ°ä¸Šé¢çš„åˆ‡å…¥ç‚¹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txadvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;qierudiansname&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œäº‹åŠ¡çš„åº•å±‚ä½¿ç”¨aopå®ç°ã€‚</p>
<p>æµ‹è¯•æ—¶ï¼ŒæŠŠæ³¨è§£æ³¨é‡Šæ‰ã€‚</p>
<h3 id="äº‹åŠ¡æ“ä½œ-å®Œå…¨æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†"><a href="#äº‹åŠ¡æ“ä½œ-å®Œå…¨æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†" class="headerlink" title="äº‹åŠ¡æ“ä½œ-å®Œå…¨æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†"></a>äº‹åŠ¡æ“ä½œ-å®Œå…¨æ³¨è§£å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h3><p>1.åˆ›å»ºé…ç½®ç±»ï¼Œä½¿ç”¨é…ç½®ç±»æ›¿ä»£xmlé…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.company&quot;)</span>  <span class="comment">//å¼€å¯ç»„ä»¶æ‰«æ</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>  <span class="comment">//å¼€å¯äº‹åŠ¡æ³¨è§£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TxConfig</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºæ•°æ®åº“è¿æ¥æ± </span></span><br><span class="line">    <span class="meta">@Bean</span>  <span class="comment">//é…ç½®æ–‡ä»¶ä¸­å°±æ˜¯åœ¨iocå®¹å™¨ä¸­åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹ å†™æ–¹æ³•è¿”å›ä¸€ä¸ªDataSourceå¾·é²ä¼Šè¿æ¥æ± å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">getDuridDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setDriverClassName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/b_jdbc?serverTimezone=UTC&quot;</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºjdbcæ¨¡ç‰ˆå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> JdbcTemplate <span class="title function_">getJdbcTemplate</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>();</span><br><span class="line">        <span class="comment">//éœ€è¦æ³¨å…¥datasSurce, xmlä¸­æ˜¯ä½¿ç”¨setæ–¹æ³•è¿›è¡Œé…ç½®æ³¨å…¥çš„</span></span><br><span class="line">        <span class="comment">//setæ–¹æ³•é‡Œé¢å¦‚æœç”¨ä¸Šé¢çš„getDuridDataSourceæ–¹æ³•ï¼Œå°±ä¼šåˆ›å»ºä¸¤ä¸ªå¯¹è±¡</span></span><br><span class="line">        <span class="comment">//ä½¿ç”¨å‚æ•°æ–¹æ³•ï¼Œå¯ä»¥åœ¨iocå®¹å™¨ä¸­æ ¹æ®ç±»å‹æ‰¾åˆ°å¯¹è±¡è¿›è¡Œæ³¨å…¥ï¼Œå°±åƒ@autowiredæ ¹æ®ç±»å‹è‡ªåŠ¨è£…é…</span></span><br><span class="line">        jdbcTemplate.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceTransactionManager <span class="title function_">getDataSourceTransactionManager</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">DataSourceTransactionManager</span> <span class="variable">dataSourceTransactionManager</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">        dataSourceTransactionManager.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> dataSourceTransactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.æµ‹è¯•æ—¶ï¼Œå¼€å¯æ³¨è§£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">wanquanzhujietrans</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.åŠ è½½é…ç½®ç±»</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(TxConfig.class);</span><br><span class="line">    <span class="comment">//2.è·å–é…ç½®åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line">    <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userService&quot;</span>, UserService.class);</span><br><span class="line">    <span class="comment">//getBeançš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºbeançš„åç§°ï¼Œxmlé…ç½®æ–‡ä»¶ä¸­çš„idï¼Œå¦‚æœæ˜¯æ³¨è§£åˆ›å»ºï¼Œåˆ™å°å†™ç¬¬ä¸€ä½</span></span><br><span class="line">    service.jiaoyi();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”¨springbootè¿›è¡Œå¼€å‘ï¼Œæ›¿ä»£springåŸºç¡€ä¸Šçš„å®Œå…¨æ³¨è§£å¼€å‘ï¼Œspringbootæ˜¯å¯¹springåšçš„å°è£…ã€‚</p>
<h2 id="æ€»ç»“-æœªå®Œ"><a href="#æ€»ç»“-æœªå®Œ" class="headerlink" title="æ€»ç»“&amp;&amp;æœªå®Œ"></a>æ€»ç»“&amp;&amp;æœªå®Œ</h2><p>1.Springæ¡†æ¶æ¦‚è¿°</p>
<p>ï¼ˆ1ï¼‰è½»é‡çº§å¼€æºJavaEEæ¡†æ¶ï¼Œä¸ºäº†è§£å†³ä¼ä¸šå¤æ‚æ€§ã€‚ä¸¤ä¸ªæ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼šiocã€aopã€‚</p>
<p>ï¼ˆ2ï¼‰Spring5.2.6ç‰ˆæœ¬</p>
<p>2.IOCå®¹å™¨</p>
<p>ï¼ˆ1ï¼‰IOCåº•å±‚åŸç†ï¼šxmlé…ç½®æ–‡ä»¶ã€å·¥å‚ã€åå°„ç­‰</p>
<p>ï¼ˆ2ï¼‰IOCæ¥å£ï¼ˆBeanFactoryï¼‰</p>
<p>ï¼ˆ3ï¼‰beanç®¡ç†æ“ä½œï¼šåŸºäºxmlè¿›è¡Œå¯¹è±¡åˆ›å»ºæ³¨å…¥å±æ€§ï¼›åŸºäºæ³¨è§£è¿›è¡Œå¯¹è±¡åˆ›å»ºæ³¨å…¥å±æ€§</p>
<p>3.AOP</p>
<p>ï¼ˆ1ï¼‰AOPåº•å±‚åŸç†ï¼šåŠ¨æ€ä»£ç†ï¼Œæœ‰æ¥å£ï¼ˆJDKåŠ¨æ€ä»£ç†ï¼‰ï¼Œæ²¡æœ‰æ¥å£ï¼ˆCGLIBåŠ¨æ€ä»£ç†ï¼‰</p>
<p>ï¼ˆ2ï¼‰æœ¯è¯­ï¼šåˆ‡å…¥ç‚¹ã€å¢å¼ºï¼ˆé€šçŸ¥ï¼‰ã€åˆ‡é¢</p>
<p>ï¼ˆ3ï¼‰åŸºäºAspectJå®ç°AOPæ“ä½œï¼šåŸºäºæ³¨è§£æ–¹å¼ï¼›åŸºäºé…ç½®æ–‡ä»¶</p>
<p>4.JdbcTemplate</p>
<p>ï¼ˆ1ï¼‰ä½¿ç”¨JdbcTemplateå¯¹æ•°æ®åº“çš„curdæ“ä½œ</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨JdbcTemplateå®ç°æ•°æ®åº“æ‰¹é‡æ“ä½œ</p>
<p>5.äº‹åŠ¡æ“ä½œ</p>
<p>ï¼ˆ1ï¼‰äº‹åŠ¡æ¦‚å¿µ</p>
<p>ï¼ˆ2ï¼‰é‡è¦æ¦‚å¿µï¼ˆä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«ï¼‰</p>
<p>ï¼ˆ3ï¼‰åŸºäºæ³¨è§£å®ç°å£°æ˜å¼äº‹åŠ¡ç®¡ç†</p>
<p>ï¼ˆ4ï¼‰åŸºäºxmlé…ç½®æ–‡ä»¶å®ç°äº‹åŠ¡ç®¡ç†</p>
<p>ï¼ˆ5ï¼‰å®Œå…¨æ³¨è§£æ–¹å¼å®ç°äº‹åŠ¡ç®¡ç†</p>
<p>6.Spring5æ–°ç‰¹æ€§ï¼š</p>
<p>ï¼ˆ1ï¼‰æ•´åˆæ—¥å¿—æ¡†æ¶</p>
<p>ï¼ˆ2ï¼‰@Nullableæ³¨è§£</p>
<p>ï¼ˆ3ï¼‰å‡½æ•°å¼æ³¨å†Œå¯¹è±¡</p>
<p>ï¼ˆ4ï¼‰æ•´åˆJUnit5å•å…ƒæµ‹è¯•æ¡†æ¶</p>
<p>ï¼ˆ5ï¼‰SpringWebfluxä½¿ç”¨</p>
<p><a href="https://www.bilibili.com/video/BV1Vf4y127N5?p=49&spm_id_from=pageDriver">https://www.bilibili.com/video/BV1Vf4y127N5?p=49&amp;spm_id_from=pageDriver</a></p>
<h2 id="æ–‡ä»¶è¯´æ˜"><a href="#æ–‡ä»¶è¯´æ˜" class="headerlink" title="æ–‡ä»¶è¯´æ˜"></a>æ–‡ä»¶è¯´æ˜</h2><p>b_studyä¸­ã€‚</p>
<p>xmlï¼šåŸºäºxmlé…ç½®æ–‡ä»¶å®ç°æ§åˆ¶åè½¬ï¼Œç®¡ç†beanå¯¹è±¡ï¼Œåˆ›å»ºå¯¹è±¡ï¼Œä¾èµ–æ³¨å…¥ï¼ˆæ³¨å…¥å±æ€§ï¼‰ã€‚</p>
<p>zhujieï¼šåŸºäºæ³¨è§£çš„beanç®¡ç†ã€‚</p>
<p>aopï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹</p>
<p>jdbcï¼šæ“ä½œæ•°æ®åº“</p>
<p>transactionï¼šäº‹åŠ¡ç›¸å…³</p>
<hr>
<p><em><strong>å­¦ä¹ ç¬”è®°ï¼Œä¾µæƒè¯·è”ç³»ï¼Œä¸€å®šç«‹åˆ»åˆ é™¤ã€‚</strong></em></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>spring aopæ€»ç»“</title>
    <url>/2022/04/09/myblog/spring/spring-aop/</url>
    <content><![CDATA[<p>å·¥ä½œä¸­é‡åˆ°ä¸ªaopçš„é—®é¢˜ï¼Œjdkä»£ç†æ¢cglibä»£ç†è¿˜ä¸è¿‡æ¥ï¼Œä»¥åŠjdkä»£ç†å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜ã€‚æ€»ç»“å¹¶å®æˆ˜ä¸€ä¸‹ã€‚</p>
<h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><h4 id="aopç›¸å…³æœ¯è¯­"><a href="#aopç›¸å…³æœ¯è¯­" class="headerlink" title="aopç›¸å…³æœ¯è¯­"></a>aopç›¸å…³æœ¯è¯­</h4><ul>
<li>Targetï¼šä»£ç†çš„ç›®æ ‡å¯¹è±¡</li>
<li>Proxyï¼šä»£ç†å¯¹è±¡</li>
<li>Joinpointï¼šè¿æ¥ç‚¹ï¼ŒæŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ã€‚åœ¨Springä¸­ï¼Œè¿™äº›ç‚¹æŒ‡æ–¹æ³•ï¼Œå› ä¸ºSpringåªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ï¼ˆå¯ä»¥è¢«å¢å¼ºçš„æ–¹æ³•ï¼‰</li>
<li>Pointcutï¼šåˆ‡å…¥ç‚¹æ˜¯æŒ‡æˆ‘ä»¬è¦å¯¹å“ªäº›Joinpointè¿›è¡Œæ‹¦æˆªçš„å®šä¹‰</li>
<li>Adviceï¼šï¼ˆé€šçŸ¥&#x2F;å¢å¼ºï¼‰æ˜¯æŒ‡æ‹¦æˆªåˆ°Joinpointä¹‹åè¦åšçš„äº‹æƒ…å°±æ˜¯é€šçŸ¥</li>
<li>Aspectï¼šåˆ‡é¢æ˜¯åˆ‡å…¥ç‚¹å’Œé€šçŸ¥ï¼ˆå¢å¼ºï¼‰çš„ç»“åˆ</li>
<li>Weavingï¼šç»‡å…¥å®è´¨æŠŠå°†åˆ‡ç‚¹å’Œå¢å¼ºç»“åˆçš„è¿‡ç¨‹æ˜¯ç»‡å…¥è¿‡ç¨‹ï¼ŒSpringæ˜¯åŠ¨æ€ä»£ç†ç»‡å…¥ï¼ŒAspectJæ˜¯é‡‡ç”¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»è£…è½½æœŸç»‡å…¥</li>
</ul>
<p>*è¿æ¥ç‚¹æ˜¯å¯ä»¥è¢«å¢å¼ºçš„æ–¹æ³•ï¼Œåˆ‡ç‚¹æ˜¯å®é™…ä¸Šè¢«å¢å¼ºè¿‡çš„æ–¹æ³•ï¼Œè¿æ¥ç‚¹èŒƒå›´æ›´å¤§</p>
<h4 id="aopå¼€å‘è¿‡ç¨‹"><a href="#aopå¼€å‘è¿‡ç¨‹" class="headerlink" title="aopå¼€å‘è¿‡ç¨‹"></a>aopå¼€å‘è¿‡ç¨‹</h4><ol>
<li><p>ç¼–å†™æ ¸å¿ƒä¸šåŠ¡ä»£ç ï¼ˆTargetçš„ç›®æ ‡æ–¹æ³•-åˆ‡ç‚¹ï¼‰</p>
</li>
<li><p>ç¼–å†™åˆ‡é¢ç±»ï¼Œåˆ‡é¢ç±»ä¸­æœ‰é€šçŸ¥ï¼ˆå¢å¼ºåŠŸèƒ½æ–¹æ³•ï¼‰</p>
</li>
<li><p>åœ¨é…ç½®æ–‡ä»¶&#x2F;æ³¨è§£å½“ä¸­ï¼Œé…ç½®ç»‡å…¥å…³ç³»ï¼Œå³å°†é‚£äº›é€šçŸ¥ä¸å“ªäº›è¿æ¥ç‚¹è¿›è¡Œç»“åˆ</p>
</li>
</ol>
<p>AOPæŠ€æœ¯å®ç°çš„å†…å®¹ï¼š<br>Springæ¡†æ¶ä¼šç›‘æ§åˆ‡å…¥ç‚¹æ–¹æ³•çš„æ‰§è¡Œâ€“é€šè¿‡é…ç½®æ–‡ä»¶å†³å®šå“ªäº›æ–¹æ³•æ˜¯åˆ‡ç‚¹ï¼›ä¸€æ—¦ç›‘æ§åˆ°åˆ‡å…¥ç‚¹æ–¹æ³•è¢«è¿è¡Œï¼Œå³ä½¿ç”¨ä»£ç†æœºåˆ¶ï¼ŒåŠ¨æ€åˆ›å»ºç›®æ ‡å¯¹è±¡ï¼ˆåˆ‡ç‚¹ï¼‰çš„ä»£ç†å¯¹è±¡ã€‚ç„¶åæ ¹æ®é…ç½®æ–‡ä»¶é…ç½®çš„å¢å¼ºç±»å‹ï¼ˆé€šçŸ¥ï¼‰ï¼Œåœ¨ä»£ç†å¯¹è±¡ï¼ˆåˆ‡ç‚¹ï¼‰å¯¹åº”çš„ä½ç½®ï¼Œå°†é€šçŸ¥å¯¹åº”çš„åŠŸèƒ½ç»‡å…¥ï¼Œå®Œæˆå®Œæ•´çš„ä»£ç é€»è¾‘è¿è¡Œã€‚<br>é…ç½®æ–‡ä»¶-æ‰§è¡Œåˆ‡ç‚¹æ–¹æ³•-ç›‘æ§åˆ°å¹¶åŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨ä»£ç†å¯¹è±¡åŒåæ–¹æ³•-å†…éƒ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œè¿›è¡Œå¢å¼ºæ–¹æ³•çš„ä»‹å…¥ã€‚</p>
<p>AOPåº•å±‚ä½¿ç”¨å“ªç§ä»£ç†æ–¹å¼ï¼š<br>Springä¼šæ ¹æ®ç›®æ ‡ç±»æ˜¯å¦å®ç°äº†æ¥å£æ¥å†³å®šé‡‡ç”¨å“ªç§åŠ¨æ€ä»£ç†ã€‚</p>
<h3 id="å®è·µ-é…ç½®æ–‡ä»¶"><a href="#å®è·µ-é…ç½®æ–‡ä»¶" class="headerlink" title="å®è·µ-é…ç½®æ–‡ä»¶"></a>å®è·µ-é…ç½®æ–‡ä»¶</h3><p>æ–°å»ºä¸ªspringé¡¹ç›®</p>
<ol>
<li><p>å¯¼å…¥ç›¸å…³ä¾èµ–ï¼šspring-contextã€spring-coreã€spring-beansï¼Œè¿˜æœ‰åˆ‡é¢çš„åŒ… Aspectjweaver</p>
</li>
<li><p>æ–°å»ºserviceæ¥å£ï¼Œæ–°å»ºå®ç°ç±»Impl</p>
</li>
<li><p>æ–°å»ºåˆ‡é¢ç±»ï¼Œå®šä¹‰åˆ‡é¢æ–¹æ³•</p>
</li>
<li><p>ç¼–å†™é…ç½®æ–‡ä»¶</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- å¼€å¯æ³¨è§£æ‰«æ  --&gt;</span><br><span class="line">&lt;context:component-scan base-package=&quot;com.aop.demo&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;aop:config proxy-target-class=&quot;false&quot;&gt;</span><br><span class="line">    &lt;aop:pointcut id=&quot;userServiceImplPointcut&quot; expression=&quot;execution(* com.aop.demo.UserServiceImpl.addUser(..))&quot; /&gt;</span><br><span class="line">    &lt;aop:aspect id=&quot;aopClass&quot; ref=&quot;aopMethods&quot;&gt;</span><br><span class="line">        &lt;aop:before method=&quot;before&quot; pointcut-ref=&quot;userServiceImplPointcut&quot; /&gt;</span><br><span class="line">        &lt;aop:after method=&quot;after&quot; pointcut-ref=&quot;userServiceImplPointcut&quot; /&gt;</span><br><span class="line">    &lt;/aop:aspect&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>æµ‹è¯•æ–¹æ³•</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class AopTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void testUserServiceAop()&#123;</span><br><span class="line">        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;spring-aop.xml&quot;);</span><br><span class="line">        // proxy-target-class=&quot;false&quot; æ—¶ï¼Œä½¿ç”¨jdkä»£ç†</span><br><span class="line">        // å¼ºåˆ¶è½¬æ¢å¿…é¡»ç”¨çˆ¶ç±»æ¥å£æ¥å®šä¹‰</span><br><span class="line">        UserService userService = (UserService)context.getBean(&quot;userServiceImpl&quot;);</span><br><span class="line">        userService.addUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âš ï¸ proxy-target-class&#x3D;â€falseâ€ æˆ–é»˜è®¤è¡¨ç¤ºä½¿ç”¨jdkä»£ç†ï¼Œè·å–å¯¹è±¡éœ€è¦ç”¨çˆ¶ç±»æ¥å£ï¼Œç”¨å®ç°ç±»ä¼šæŠ¥<code>java.lang.ClassCastException: com.sun.proxy.$Proxy* cannot be cast to***</code> çš„é”™è¯¯ã€‚</p>
<p>âš ï¸ proxy-target-class&#x3D;â€trueâ€æ—¶ï¼Œä½¿ç”¨cglibä»£ç†ï¼Œä½¿ç”¨çˆ¶ç±»æ¥å£ä¹Ÿå¯ä»¥ï¼Œä½¿ç”¨å®ç°ç±»å®šä¹‰å¯¹è±¡ä¹Ÿå¯ä»¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//UserService userService = (UserService)context.getBean(&quot;userServiceImpl&quot;);</span><br><span class="line">UserServiceImpl userService = (UserServiceImpl)context.getBean(&quot;userServiceImpl&quot;);</span><br><span class="line">userService.addUser();</span><br></pre></td></tr></table></figure>

<p>âš ï¸ å¦å¤–ï¼Œè¿˜æœ‰ä¸ªç°è±¡æ˜¯åœ¨jdkä»£ç†æ—¶å­˜åœ¨çš„bugï¼š<br>åŸæœ¬çš„ï¼š <code>UserService userService = (UserService)context.getBean(&quot;userServiceImpl&quot;);</code> å¯ä»¥è·å¾—beanï¼Œæ²¡é—®é¢˜ã€‚<br>ä½†æ˜¯ï¼š <code>UserService userService = (UserService)context.getBean(UserServiceImpl.class);</code>  é€šè¿‡ç±»çš„å…¨è·¯å¾„è·å¾—beanå°±ä¼šå‡ºç°<code>No qualifying bean of type</code> çš„é—®é¢˜ã€‚<br>æ€»ç»“ï¼šjdkä»£ç†æ–¹å¼ä¸ç”¨å®ç°ç±»ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šç”¨å®ç°ç±»çš„beanï¼Œå³ä½¿é…äº†å®ç°ç±»çš„beanï¼Œä¹Ÿä¸è¡Œã€‚</p>
<p>åŸå› ï¼šspring aopé»˜è®¤æ˜¯ä½¿ç”¨jdkåŠ¨æ€ä»£ç†çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘é€šè¿‡getBean(ServiceImpl.class)ï¼Œè¡¨è¾¾å‡ºçš„æ„æ€æ˜¯å¸Œæœ›ç¨‹åºé€šè¿‡jdkåŠ¨æ€ä»£ç†ç»™æˆ‘ä¸€ä¸ªServiceImplç±»ã€‚è€Œjdkçš„åŠ¨æ€ä»£ç†æ˜¯åŸºäºæ¥å£å®ç°çš„ï¼Œå› ä¸ºå®ƒæœ¬èº«è¦ç»§æ‰¿ä¸€ä¸ªProxyç±»ï¼Œè€Œjavaæ˜¯å•ç»§æ‰¿ï¼ˆæ¥å£å¯ä»¥å¤šç»§æ‰¿ï¼‰ï¼Œæ‰€ä»¥å®ƒé€šè¿‡å®ç°æ¥å£è¿›è¡Œä»£ç†ã€‚å®ƒé€šè¿‡å®ç°æˆ‘ä»¬ç»™å®ƒçš„æ¥å£å’Œç»§æ‰¿Proxyç±»å®ç°jdkåŠ¨æ€ä»£ç†ã€‚è€Œæˆ‘ä»¬ç»™å®ƒçš„æ˜¯ä¸€ä¸ªServiceImplç±»ï¼Œè¿™ä¸ªæ—¶å€™jdkåŠ¨æ€ä»£ç†å°±æ²¡æœ‰åŠæ³•äº†ã€‚<br>jdkåŠ¨æ€ä»£ç†äº§ç”Ÿçš„å¯¹è±¡å±äºProxyç±»å‹ï¼Œå±äºç»™å®šçš„æ¥å£ï¼ˆServiceï¼‰ç±»å‹ï¼Œä½†ä¸å±äºæˆ‘ä»¬è¦ä»£ç†çš„é‚£ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æœ¬ä»£ç ä¸­ServiceImplç±»å‹<br>å› æ­¤ï¼Œä½¿ç”¨æ¥å£çš„ç±»è·¯å¾„ï¼š<code>UserService userService = (UserService)context.getBean(UserService.class);</code> ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™ä¹Ÿè§£é‡Šäº†å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜ã€‚<br>ä½†æ˜¯ï¼Œæ¢æˆcglibï¼Œå®ç°ç±»&#x2F;çˆ¶ç±»æ¥å£ï¼Œè·å–beançš„æ–¹å¼ï¼šid&#x2F;ç±»è·¯å¾„ï¼Œéƒ½å¯ä»¥ï¼Œæ²¡è§£é‡Šå·¥ä½œä¸­ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ¢æˆcglibçš„é—®é¢˜ã€‚</p>
<p>æ€»ç»“ï¼š<br>jdkä»£ç†ï¼šå¿…é¡»çˆ¶ç±»æ¥å£è·å¾—beanï¼Œæ‹¬å·å†…å¯ä»¥æ˜¯å®ç°ç±»çš„bean idï¼Œä¹Ÿå¯ä»¥æ˜¯çˆ¶ç±»æ¥å£çš„å…¨è·¯å¾„ã€‚<br>cglibä»£ç†ï¼šæ€ä¹ˆéƒ½è¡Œã€‚</p>
<h3 id="å®è·µ-æ³¨è§£"><a href="#å®è·µ-æ³¨è§£" class="headerlink" title="å®è·µ-æ³¨è§£"></a>å®è·µ-æ³¨è§£</h3><ol>
<li><p>ä½¿ç”¨@Aspectæ³¨è§£ï¼Œå‡ºäº†aspectweaveråŒ…ä¹‹å¤–ï¼Œè¿˜éœ€è¦aspectjrtåŒ…</p>
</li>
<li><p>æ–°å»ºserviceæ¥å£ï¼Œæ–°å»ºå®ç°ç±»Impl</p>
</li>
<li><p>æ–°å»ºåˆ‡é¢ç±»ï¼Œå®šä¹‰åˆ‡é¢æ–¹æ³•</p>
</li>
<li><p>ç¼–å†™é…ç½®ç±»</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@ComponentScan(basePackages = &#123;&quot;com.aop.demo.zhujie&quot;&#125;)</span><br><span class="line">@EnableAspectJAutoProxy(proxyTargetClass = false)</span><br><span class="line">public class SpringCfg &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>æµ‹è¯•</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ApplicationContext context = new AnnotationConfigApplicationContext(SpringCfg.class);  //åŠ è½½é…ç½®ç±»</span><br></pre></td></tr></table></figure>

<p>æ•ˆæœå’Œé…ç½®æ–‡ä»¶ä¸€æ ·ã€‚</p>
<h3 id="githubåœ°å€"><a href="#githubåœ°å€" class="headerlink" title="githubåœ°å€"></a>githubåœ°å€</h3><p><a href="https://github.com/jadeliuliu/aop-demo">https://github.com/jadeliuliu/aop-demo</a></p>
<p>å‚è€ƒï¼š<br>çŸ¥è¯†ç‚¹ï¼š<br><a href="https://www.cnblogs.com/Zhang-DevelopingPlatform/p/14723490.html">https://www.cnblogs.com/Zhang-DevelopingPlatform/p/14723490.html</a></p>
<p>jdkä»£ç†æ‰¾ä¸åˆ°beanï¼š<a href="https://blog.csdn.net/qq_32080243/article/details/90261768">https://blog.csdn.net/qq_32080243/article/details/90261768</a></p>
<p>cglibå®ç°ï¼š<a href="https://blog.csdn.net/shaoweijava/article/details/76474652">https://blog.csdn.net/shaoweijava/article/details/76474652</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>springbootå­¦ä¹ </title>
    <url>/2022/12/22/myblog/spring/springboot%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="springbootåˆ›å»ºå·¥ç¨‹"><a href="#springbootåˆ›å»ºå·¥ç¨‹" class="headerlink" title="springbootåˆ›å»ºå·¥ç¨‹"></a>springbootåˆ›å»ºå·¥ç¨‹</h2><p>å¾®æœåŠ¡ä½“ç³»ä¸‹ä¸å¯æˆ–ç¼ºã€‚<br>ssm(spring+springMvc+mybatis) -&gt; springboot -&gt; springcloud</p>
<p>springbootï¼šçº¦å®šä¼˜äºé…ç½®ï¼Œä¸ç”¨ä¸“æ³¨äºé…ç½®ã€‚2014å¹´å‘å¸ƒã€‚</p>
<p>springbootçš„ä½ç½®ï¼šæ˜¯springçš„é¡¶çº§é¡¹ç›®ï¼Œå’ŒspringFramework(iocã€aop)æ˜¯åŒç­‰çº§çš„ã€‚</p>
<p>springbootä½¿ç”¨æœ€å°é…ç½®å¿«é€Ÿæ„å»ºspringé¡¹ç›®ã€‚springbootä¸æ˜¯springåŠŸèƒ½ä¸Šçš„å¢å¼ºï¼Œè€Œæ˜¯æä¾›ä¸€ç§å¿«é€Ÿå¼€å‘springé¡¹ç›®çš„æ–¹å¼ã€‚</p>
<p>springç¼ºç‚¹ï¼š<br>&lt;1&gt; å†™é…ç½®æ–‡ä»¶ï¼Œç¹ç<br>&lt;2&gt; ä¾èµ–ç¹çï¼Œmavenåæ ‡ç‰ˆæœ¬é—®é¢˜</p>
<p>springbootæä¾›çš„ä¼˜ç‚¹ï¼š<br>&lt;1&gt; è‡ªåŠ¨é…ç½®ï¼Œåº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„è¿‡ç¨‹<br>&lt;2&gt; èµ·æ­¥ä¾èµ–ï¼Œåæ ‡pomæ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå¯¹å…¶ä»–åº“çš„ä¾èµ–ä¼ é€’<br>&lt;3&gt; å…¶ä»–ï¼šåµŒå…¥å¼æœåŠ¡å™¨ï¼Œå®‰å…¨ï¼Œå¥åº·æ£€æµ‹</p>
<hr>
<p>âœ… ç”¨springbootæ­å»ºä¸€ä¸ªwebé¡¹ç›®ï¼š<br>&lt;1&gt; åˆ›å»ºmavené¡¹ç›®<br>&lt;2&gt; å¼•å…¥èµ·æ­¥ä¾èµ–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--springbootå·¥ç¨‹éœ€è¦ç»§æ‰¿çš„çˆ¶å·¥ç¨‹   --&gt;</span><br><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.6.1&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!--  webå¼€å‘çš„èµ·æ­¥ä¾èµ–  --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>&lt;3&gt; å†™ä¸€ä¸ªcontroller</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.liuxuan.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-12-22 23:28</span><br><span class="line"> **/</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/h&quot;)</span><br><span class="line">public class HelloController &#123;</span><br><span class="line">    @RequestMapping(&quot;/hello&quot;)</span><br><span class="line">    public String hello() &#123;</span><br><span class="line">        return &quot;hello!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&lt;4&gt; å†™å¼•å¯¼ç±»ï¼Œspringbooté¡¹ç›®å…¥å£ï¼Œç„¶åè¿è¡Œmainæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.liuxuan;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-12-22 23:38</span><br><span class="line"> **/</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class StartApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(StartApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>âœ… å¿«é€Ÿæ„å»º</p>
<p>ç”¨ideaï¼Œé€‰Spring Initializrï¼Œé€‰maven projectï¼Œé€‰jaræ‰“åŒ…æ–¹å¼ï¼Œå‹¾é€‰ä¾èµ–ã€‚</p>
<h2 id="springbootèµ·æ­¥ä¾èµ–"><a href="#springbootèµ·æ­¥ä¾èµ–" class="headerlink" title="springbootèµ·æ­¥ä¾èµ–"></a>springbootèµ·æ­¥ä¾èµ–</h2><p>spring-boot-starter-parentï¼Œå¾€é‡Œçœ‹æºç ï¼Œæœ€ç»ˆæ˜¯spring-boot-dependencyåŒ…ï¼Œå…¶ä¸­pomæ–‡ä»¶ä¸­<code>&lt;dependencyManagement&gt;</code> æ˜¯ç‰ˆæœ¬é”å®šï¼Œçˆ¶å·¥ç¨‹ä¸­å®šä¹‰çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè‡ªå·±å·¥ç¨‹ä¸­å°±å¯ä»¥ä¸å†™ç‰ˆæœ¬å·ã€‚</p>
<p>spring-boot-starter-webï¼Œå¾€é‡Œçœ‹ï¼Œå‘ç°å¼•å…¥äº†spring-webã€spring-webmvcã€‚</p>
<p>æ€»ç»“ï¼š<br>1.åœ¨spring-boot-starter-parentä¸­å®šä¹‰äº†å„ç§æŠ€æœ¯çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œç»„åˆäº†ä¸€å¥—æœ€ä¼˜æ­é…çš„æŠ€æœ¯ç‰ˆæœ¬ã€‚<br>2.åœ¨å„ç§starterä¸­ï¼Œå®šä¹‰äº†å®Œæˆè¯¥åŠŸèƒ½çš„åæ ‡åˆé›†ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†ç‰ˆæœ¬ä¿¡æ¯æ¥è‡ªäºçˆ¶å·¥ç¨‹ã€‚<br>3.æˆ‘ä»¬å·¥ç¨‹ç»§æ‰¿è‡ªparentï¼Œå¼•å…¥starterï¼Œé€šè¿‡ä¾èµ–ä¼ é€’ï¼Œå°±å¯ä»¥ç®€å•æ–¹ä¾¿è·å–éœ€è¦çš„jaråŒ…ï¼Œå¹¶ä¸”ä¸ä¼šå­˜åœ¨ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚</p>
<h2 id="springbooté…ç½®"><a href="#springbooté…ç½®" class="headerlink" title="springbooté…ç½®"></a>springbooté…ç½®</h2><p>é…ç½®æ–‡ä»¶åˆ†ç±»ï¼špropertiesæ–‡ä»¶ã€yaml&#x2F;ymlæ–‡ä»¶ã€‚<br>profileæ–‡ä»¶ï¼Œä¸‰ç§ç¯å¢ƒåŠ¨æ€åˆ‡æ¢ã€‚</p>
<p>springbootåŸºäºçº¦å®šï¼Œé…ç½®æœ‰é»˜è®¤å€¼ï¼Œæ›¿æ¢çš„è¯ï¼Œç”¨application.properties&#x2F;application.ymlæ–‡ä»¶æ¥é…ç½®ã€‚resourceæ ¹ç›®å½•ä¸‹ï¼Œapplication.properties&#x2F;yml&#x2F;yaml æ–‡ä»¶é‡Œé¢æ”¾ç¨‹åºè‡ªåŠ¨è¯†åˆ«çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥å†™è‡ªå·±å®šä¹‰çš„å†…å®¹ã€‚</p>
<p>åŒä¸€çº§ç›®å½•ä¸‹ï¼Œé…ç½®æ–‡ä»¶çš„åŠ è½½é¡ºåºï¼šproperties &gt; yml &gt; yaml</p>
<p>yamlï¼šä¸æ˜¯ä¸€ä¸ªæ ‡è®°è¯­è¨€ï¼Œæ˜¯ç›´è§‚çš„èƒ½è¢«ç”µè„‘è¯†åˆ«çš„æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œä»¥æ•°æ®ä¸ºæ ¸å¿ƒï¼Œæ¯”xmlæ›´åŠ ç®€æ´ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xml:</span><br><span class="line">&lt;server&gt;</span><br><span class="line">    &lt;port&gt;8080&lt;/port&gt;</span><br><span class="line">&lt;/server&gt;</span><br><span class="line"></span><br><span class="line">yml:</span><br><span class="line">server:</span><br><span class="line">    port: 8080</span><br><span class="line"></span><br><span class="line">properties:</span><br><span class="line">server.port=8080</span><br></pre></td></tr></table></figure>

<p>yamlè¯­æ³•ï¼šå¤§å°å†™æ•æ„Ÿã€æ•°æ®å€¼å‰å¿…é¡»æœ‰ç©ºæ ¼ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰ã€ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œç¼©è¿›ç©ºæ ¼ä¸ªæ•°ä¸é‡è¦ï¼Œä½†è¦å·¦å¯¹é½ã€#æ³¨é‡Š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8082</span><br><span class="line"></span><br><span class="line">person:</span><br><span class="line">  name: liu</span><br><span class="line">  address: [beijing, shanghai]</span><br><span class="line"></span><br><span class="line">msg1: &quot;hello \n world&quot;  #åŒå¼•å·è¯†åˆ«è½¬ä¹‰å­—ç¬¦</span><br><span class="line">msg2: &#x27;hello \n world&#x27;  #å•å¼•å·åŸæ ·è¾“å‡º</span><br><span class="line"></span><br><span class="line">å‚æ•°å¼•ç”¨ï¼š$&#123;name&#125;</span><br></pre></td></tr></table></figure>


<p>è¯»å–é…ç½®æ–‡ä»¶å†…å®¹ï¼š</p>
<p>1.@Valueæ–¹æ³•ï¼Œå•ä¸ªå±æ€§æ³¨å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Value(&quot;$&#123;person.name&#125;&quot;)</span><br><span class="line">private String name;</span><br><span class="line"></span><br><span class="line">@Value(&quot;$&#123;person.address[0]&#125;&quot;)</span><br><span class="line">private String address;</span><br></pre></td></tr></table></figure>

<p>2.Environment</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private Environment env;    </span><br><span class="line"></span><br><span class="line">env.getProperty(&quot;person.name&quot;)</span><br></pre></td></tr></table></figure>

<p>3.@ConfigurationPropertiesï¼Œå¯¹è±¡å’Œé…ç½®çš„ç»‘å®š</p>
<p>åœ¨å®ä½“ç±»Personä¸ŠåŠ æ³¨è§£ <code>@ConfigurationProperties(prefix=&quot;person&quot;)</code></p>
<hr>
<p>profileï¼šä¸€å¥—ç¨‹åºé€šå¸¸éœ€è¦éƒ¨ç½²åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ï¼Œå¼€å‘æµ‹è¯•ç”Ÿäº§ï¼Œå¦‚æœæ¯æ¬¡æ‰“åŒ…éƒ½è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œéº»çƒ¦ï¼Œprofileæä¾›è¿›è¡ŒåŠ¨æ€é…ç½®åˆ‡æ¢çš„æ–¹å¼ã€‚</p>
<p>é…ç½®æ–¹å¼ï¼š<br>1.å¤šprofileæ–‡ä»¶æ–¹å¼ï¼šæä¾›å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªä»£è¡¨ä¸€ä¸ªç¯å¢ƒ<br>application-dev.properties&#x2F;yml<br>application-test.properties&#x2F;yml<br>application-pro.properties&#x2F;yml</p>
<p>2.ymlå•æ–‡ä»¶æ–¹å¼<br>ç”¨â€”åˆ†å‰²ä¸åŒç¯å¢ƒé…ç½®</p>
<p>æ¿€æ´»æ–¹å¼ï¼š<br>1.é…ç½®æ–¹å¼ï¼š<br><code>spring.profiles.active=dev</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">    profiles:</span><br><span class="line">        active: dev</span><br></pre></td></tr></table></figure>

<p>2.è™šæ‹Ÿæœºå‚æ•°<br>åœ¨VM optionä¸­è¾“å…¥ï¼š<code>-Dspring.profiles.active=test</code></p>
<p>3.å‘½ä»¤è¡Œå‚æ•°<br>å…ˆpackageæ‰“åŒ…<br><code>java -jar ...jar --spring.profiles.active=test</code></p>
<hr>
<p>æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ï¼šjarä¸­æ²¡æœ‰ä¸»æ¸…å•å±æ€§</p>
<p>åŸå› ï¼šæ‰“åŒ…åçš„jaræ–‡ä»¶ä¸­çš„MANIFEST.MFç¼ºå°‘é¡¹ç›®å¯åŠ¨é¡¹ï¼Œå³æ²¡æœ‰Main-Class</p>
<p>è§£å†³æ–¹æ¡ˆï¼š<br>1ã€æŒ‡å®šMANIFEST.MFè·¯å¾„<br>é¡¹ç›®æ‰“åŒ…å‰ï¼š<br>ç¬¬ä¸€æ­¥ fileâ€“&gt;project structure å¼¹æ¡†åé€‰ä¸­Atifactsâ€”&gt; + â€”-&gt;jarâ€”-&gt;from module with dependenceis<br>ç¬¬äºŒæ­¥ é€‰æ‹©ä¸€ä¸ªMain Classï¼Œé€‰çš„StartApplicationæ–‡ä»¶</p>
<p>2ã€é¡¹ç›®pom.xmlæ–‡ä»¶ä¸­æ·»åŠ æ’ä»¶spring-boot-maven-plugin</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>

<hr>
<p>å†…éƒ¨é…ç½®åŠ è½½é¡ºåºï¼š</p>
<p>1.é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„configæ–‡ä»¶å¤¹ä¸‹<br>2.é¡¹ç›®æ ¹ç›®å½•ï¼ˆideaç‚¹project filesçš„æ ¹ç›®å½•ï¼‰ä¸‹<br>3.classPathï¼ˆresourceç›®å½•ä¸‹ï¼‰çš„configæ–‡ä»¶å¤¹ä¸‹<br>4.classPathï¼ˆresourceç›®å½•ä¸‹ï¼‰ä¸‹</p>
<p>å‰ä¸¤ä¸ªä¸ä¼šæ‰“è¿›jaråŒ…é‡Œ</p>
<hr>
<p>å¤–éƒ¨é…ç½®åŠ è½½é¡ºåºï¼š</p>
<p>1.å‘½ä»¤è¡ŒæŒ‡å®šç«¯å£å·ï¼š<code>java -jar spring-boot-study-api-1.0-SNAPSHOT.jar --server.port=8086</code><br>æŒ‡å®šé»˜è®¤å‰ç¼€è·¯å¾„ï¼š<code>--server.servlet.context-path=/default</code><br>2.æŒ‡å®šå¤–éƒ¨é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>--spring.config.location=è·¯å¾„</code><br>3.åœ¨jaråŒ…åŒç›®å½•ä¸‹ï¼ˆtargetæ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼ŒåŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶<code>application.properties</code>ï¼ŒåŒæ ·ç”Ÿæ•ˆï¼Œå¤–éƒ¨é…ç½®ä¼˜å…ˆç”Ÿæ•ˆ</p>
<h2 id="springbootæ•´åˆå…¶ä»–æ¡†æ¶"><a href="#springbootæ•´åˆå…¶ä»–æ¡†æ¶" class="headerlink" title="springbootæ•´åˆå…¶ä»–æ¡†æ¶"></a>springbootæ•´åˆå…¶ä»–æ¡†æ¶</h2><h3 id="springbootæ•´åˆJunit"><a href="#springbootæ•´åˆJunit" class="headerlink" title="springbootæ•´åˆJunit"></a>springbootæ•´åˆJunit</h3><p>1.å¼•å…¥spring-boot-starter-test èµ·æ­¥ä¾èµ–<br>2.åœ¨æµ‹è¯•ç±»ä¸ŠåŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RunWith(SpringRunner.class) //springboot2ä¸ç”¨åŠ </span><br><span class="line">@SpringBootTest(classes = StartApplication.class) //å¦‚æœä¸StartApplicationåœ¨ä¸€ä¸ªåŒ…ä¸‹ï¼Œå¯ä»¥ä¸åŠ æ‹¬å·é‡Œçš„</span><br></pre></td></tr></table></figure>


<h3 id="springbootæ•´åˆredis"><a href="#springbootæ•´åˆredis" class="headerlink" title="springbootæ•´åˆredis"></a>springbootæ•´åˆredis</h3><p>1.å¼•å…¥spring-boot-starter-data-redisä¾èµ–<br>2.è¿æ¥æœ¬åœ°çš„redisï¼Œä¸éœ€è¦ä»»ä½•é…ç½®<br>3.ç›´æ¥ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">redisTemplate.boundValueOps(&quot;name&quot;).set(&quot;liu&quot;);</span><br><span class="line">Object o = redisTemplate.boundValueOps(&quot;name&quot;).get();</span><br></pre></td></tr></table></figure>
<p>4.å…¶ä»–ipçš„ï¼Œéœ€è¦é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">    host: 127.0.0.1</span><br><span class="line">    port: 6379</span><br></pre></td></tr></table></figure>


<h3 id="springæ•´åˆmybatis"><a href="#springæ•´åˆmybatis" class="headerlink" title="springæ•´åˆmybatis"></a>springæ•´åˆmybatis</h3><p>1.å¼•å…¥mybatisèµ·æ­¥ä¾èµ– <code>mybatis-spring-boot-starter</code> ï¼ˆä¸åŒäºå…¶ä»–ï¼Œè¿™ä¸ªæ˜¯mybatisæä¾›çš„ï¼Œç”¨3.0.1çš„æœ‰ç‚¹é—®é¢˜ï¼Œæ”¹ç”¨2.1.0ï¼‰ï¼Œæ·»åŠ mysqlé©±åŠ¨ <code>mysql-connector-java</code><br>2.é…ç½®datasourceå’Œmybatis</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql:///test?serverTimezone=UTC</span><br><span class="line">    #db.url=jdbc:mysql://localhost:3306/test?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span><br><span class="line">    username: liuxuan</span><br><span class="line">    password: jade</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br></pre></td></tr></table></figure>
<p>3.åˆ›å»ºè¡¨ï¼Œå¹¶ç¼–å†™å®ä½“ç±»<br>4.çº¯æ³¨è§£å¼€å‘</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">@Repository</span><br><span class="line">public interface StudentMapper &#123;</span><br><span class="line"></span><br><span class="line">    @Select(&quot;select * from student&quot;)</span><br><span class="line">    public List&lt;Student&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5 .xmlæ˜ å°„æ–‡ä»¶å½¢å¼å¼€å‘<br>Mapperæ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">@Repository</span><br><span class="line">public interface StudentXmlMapper &#123;</span><br><span class="line"></span><br><span class="line">    public List&lt;Student&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xmlé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.liuxuan.repository.mapper.StudentXmlMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.liuxuan.repository.domain.Student&quot;</span>&gt;</span></span><br><span class="line">        select * from student</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¢åŠ mybatisé…ç½®(ä¸åœ¨springä¸‹)ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mybatis:</span><br><span class="line">  # Mapperæ˜ å°„æ–‡ä»¶è·¯å¾„</span><br><span class="line">  mapper-locations: classpath:mapper/*Mapper.xml</span><br><span class="line">  # åŒ…æ‰«æ</span><br><span class="line">  type-aliases-package: com.liuxuan.repository.domain</span><br></pre></td></tr></table></figure>


<h2 id="springbootåŸç†åˆ†æ"><a href="#springbootåŸç†åˆ†æ" class="headerlink" title="springbootåŸç†åˆ†æ"></a>springbootåŸç†åˆ†æ</h2><h3 id="springbootè‡ªåŠ¨é…ç½®"><a href="#springbootè‡ªåŠ¨é…ç½®" class="headerlink" title="springbootè‡ªåŠ¨é…ç½®"></a>springbootè‡ªåŠ¨é…ç½®</h3><p>Conditionæ˜¯spring4.0å¢åŠ çš„æ¡ä»¶åˆ¤æ–­åŠŸèƒ½ï¼Œå¯ä»¥å®ç°é€‰æ‹©æ€§åœ°åˆ›å»ºBeanæ“ä½œã€‚</p>
<h4 id="âœ…éœ€æ±‚1-åˆ›å»ºbeanå¢åŠ æ¡ä»¶"><a href="#âœ…éœ€æ±‚1-åˆ›å»ºbeanå¢åŠ æ¡ä»¶" class="headerlink" title="âœ…éœ€æ±‚1:åˆ›å»ºbeanå¢åŠ æ¡ä»¶"></a>âœ…éœ€æ±‚1:åˆ›å»ºbeanå¢åŠ æ¡ä»¶</h4><p>1.è‡ªå®šä¹‰æ¡ä»¶ç±»ï¼Œç»§æ‰¿Conditionæ¥å£ï¼Œå®ç°matchesæ–¹æ³•ï¼Œæ–¹æ³•ä¸­è¿›è¡Œé€»è¾‘åˆ¤æ–­ï¼Œå‚æ•°contextå¯ä»¥è·å–ä¸Šä¸‹æ–‡å®¹å™¨ç­‰ï¼Œmetadataå¯ä»¥è·å–æ³¨è§£å±æ€§ã€‚<br>2.åˆ¤æ–­æ¡ä»¶ï¼Œåˆå§‹åŒ–beanæ—¶ä½¿ç”¨@Conditional(æ¡ä»¶ç±».class)æ³¨è§£</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">éœ€è¦åŠ æ³¨è§£@Conditionalï¼š</span><br><span class="line">@Configuration</span><br><span class="line">public class UserConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    @Conditional(ClassCondition.class)</span><br><span class="line">    public User user() &#123;</span><br><span class="line">        return new User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è‡ªå·±å®šä¹‰ä¸€ä¸ªå®ç°äº†Conditionæ¥å£çš„ç±»ï¼Œé‡Œé¢å®ç°æ¡ä»¶åˆ¤æ–­matchesæ–¹æ³•ï¼š</span><br><span class="line">public class ClassCondition implements Condition &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) &#123;</span><br><span class="line">        // å†™åˆ›å»ºbeançš„æ¡ä»¶ï¼šå¯¼å…¥jedisåæ ‡ååˆ›å»ºbean</span><br><span class="line">        try &#123;</span><br><span class="line">            Class cls = Class.forName(&quot;redis.clients.jedis.Jedis&quot;);</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è·å–beanï¼š</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class StartApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // å¯åŠ¨springbootåº”ç”¨ï¼Œè·å–springçš„iocå®¹å™¨</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(StartApplication.class, args);</span><br><span class="line"></span><br><span class="line">        // è·å–bean</span><br><span class="line">        Object user = context.getBean(&quot;user&quot;);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="âœ…éœ€æ±‚2-ç”¨è‡ªå®šä¹‰æ³¨è§£å®ç°åŠ¨æ€Condition"><a href="#âœ…éœ€æ±‚2-ç”¨è‡ªå®šä¹‰æ³¨è§£å®ç°åŠ¨æ€Condition" class="headerlink" title="âœ…éœ€æ±‚2:ç”¨è‡ªå®šä¹‰æ³¨è§£å®ç°åŠ¨æ€Condition"></a>âœ…éœ€æ±‚2:ç”¨è‡ªå®šä¹‰æ³¨è§£å®ç°åŠ¨æ€Condition</h4><p>å®šä¹‰è‡ªå®šä¹‰æ³¨è§£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Conditional(ClassCondition.class)</span><br><span class="line">public @interface ConditionOnClass &#123;</span><br><span class="line">    String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Configä¸­åŠ æ³¨è§£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class UserConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">//    @Conditional(ClassCondition.class)</span><br><span class="line">    @ConditionOnClass(&quot;redis.clients.jedis.Jedis&quot;)</span><br><span class="line">    public User user() &#123;</span><br><span class="line">        return new User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»§æ‰¿Conditionæ¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ClassCondition implements Condition &#123;</span><br><span class="line">    /**</span><br><span class="line">     * @param context  ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚ç”¨äºè·å–ç¯å¢ƒã€Iocå®¹å™¨ã€classLoaderå¯¹è±¡</span><br><span class="line">     * @param metadata æ³¨è§£å…ƒå¯¹è±¡ï¼Œå¯ä»¥ç”¨äºè·å–æ³¨è§£å®šä¹‰çš„å±æ€§å€¼</span><br><span class="line">     * @return boolean</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) &#123;</span><br><span class="line">        // éœ€æ±‚1ï¼šå†™åˆ›å»ºbeançš„æ¡ä»¶ï¼šå¯¼å…¥jedisåæ ‡ååˆ›å»ºbean</span><br><span class="line">//        try &#123;</span><br><span class="line">//            Class cls = Class.forName(&quot;redis.clients.jedis.Jedis&quot;);</span><br><span class="line">//        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">//            e.printStackTrace();</span><br><span class="line">//            return false;</span><br><span class="line">//        &#125;</span><br><span class="line">//        return true;</span><br><span class="line"></span><br><span class="line">        // éœ€æ±‚2ï¼šé€šè¿‡æ³¨è§£å±æ€§å€¼valueæŒ‡å®šåæ ‡ååˆ›å»ºbean</span><br><span class="line">        Map&lt;String, Object&gt; map = metadata.getAnnotationAttributes(ConditionOnClass.class.getName());</span><br><span class="line">        String[] value = (String[])map.get(&quot;value&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            for (String className : value) &#123;</span><br><span class="line">                Class&lt;?&gt; cls = Class.forName(className);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åŒ…spring-boot-anto-configurationä¸­ï¼Œspringbootå·²ç»å®šä¹‰å¥½äº†å¾ˆå¤šconditionæ³¨è§£ï¼Œä¾‹å¦‚ï¼š@ConditionalOnClassã€‚</p>
<hr>
<h4 id="âœ…åˆ‡æ¢å†…ç½®æœåŠ¡å™¨"><a href="#âœ…åˆ‡æ¢å†…ç½®æœåŠ¡å™¨" class="headerlink" title="âœ…åˆ‡æ¢å†…ç½®æœåŠ¡å™¨"></a>âœ…åˆ‡æ¢å†…ç½®æœåŠ¡å™¨</h4><p>spring-boot-starter-web</p>
<p>spring-boot-autoconfiguration åŒ…çš„webçš„embeddedä¸­å†…ç½®äº†å››ç§æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬jettyã€nettyã€tomcatã€undertomã€‚</p>
<p>é‡Œé¢è¿˜æœ‰ä¸ªç±»è´Ÿè´£é€‰æ‹©webæœåŠ¡å™¨ï¼ŒåŸç†ä¹Ÿæ˜¯ç”¨äº†@ConditionalOnClassæ³¨è§£ï¼Œçœ‹å¯¼å…¥äº†ä»€ä¹ˆåæ ‡æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚</p>
<p>ç”¨<exclusions> æŠŠspring-boot-starter-web ä¸­çš„ spring-boot-starter-tomcat æ’é™¤æ‰ã€‚å†å¼•å…¥jettyçš„ä¾èµ–ï¼Œå°±ä¼šåˆ‡æ¢ä¸ºjettyæœåŠ¡å™¨ã€‚</p>
<hr>
<h4 id="âœ…-Enable-æ³¨è§£"><a href="#âœ…-Enable-æ³¨è§£" class="headerlink" title="âœ… @Enable*æ³¨è§£"></a>âœ… @Enable*æ³¨è§£</h4><p>SpringBootæä¾›äº†å¾ˆå¤š@Enableå¼€å¤´çš„æ³¨è§£ï¼Œç”¨äºåŠ¨æ€å¯åŠ¨æŸäº›åŠŸèƒ½(è·å–ä¸€äº›bean)ï¼Œå…¶åº•å±‚åŸç†æ˜¯ä½¿ç”¨@Importæ³¨è§£å¯¼å…¥ä¸€äº›é…ç½®ç±»ï¼Œå®ç°Beançš„åŠ¨æ€åŠ è½½ã€‚</p>
<p>çœ‹æ³¨è§£ @SpringBootApplication</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Target(&#123;ElementType.TYPE&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Inherited</span><br><span class="line">@SpringBootConfiguration --å†…éƒ¨@Configurationå¯é…ç½®bean</span><br><span class="line">@EnableAutoConfiguration --é‡ç‚¹</span><br><span class="line">@ComponentScan(   --åŒ…æ‰«æ</span><br><span class="line">    excludeFilters = &#123;@Filter(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;TypeExcludeFilter.class&#125;</span><br><span class="line">), @Filter(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span><br><span class="line">)&#125;</span><br><span class="line">)</span><br><span class="line">public @interface SpringBootApplication</span><br><span class="line"></span><br><span class="line">å…¶ä¸­Enableæ³¨è§£ä¸‹ï¼š</span><br><span class="line">@Target(&#123;ElementType.TYPE&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Inherited</span><br><span class="line">@AutoConfigurationPackage</span><br><span class="line">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span><br><span class="line">public @interface EnableAutoConfiguration &#123;</span><br><span class="line"></span><br><span class="line">é‡è¦çš„æ˜¯Importæ³¨è§£</span><br></pre></td></tr></table></figure>

<p>âš ï¸å¯åŠ¨å­æ¨¡å—çš„å¯åŠ¨ç±»ï¼Œæ— æ³•å¯åŠ¨çˆ¶å·¥ç¨‹çš„controllerã€‚</p>
<p>springbootå·¥ç¨‹ä¸å¯ä»¥ç›´æ¥è·å–å…¶ä»–jaråŒ…ä¸­å®šä¹‰çš„beanï¼Œæ¯”å¦‚redisTemplateã€‚</p>
<p>åŸå› ï¼š@ComponentScan åŒ…æ‰«æçš„èŒƒå›´æ˜¯ï¼šå½“å‰å¼•å¯¼ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ï¼Œå…¶ä»–é¡¹ç›®é…ç½®Beançš„åŒ…ä¸åœ¨è¯¥èŒƒå›´å†…ã€‚</p>
<p>å°è¯•ï¼šå¦å¤–åˆ›å»ºä¸€ä¸ªå­æ¨¡å—ï¼Œå­æ¨¡å—å¼•å…¥å¦ä¸€ä¸ªå­æ¨¡å—çš„pomï¼Œç„¶åå°è¯•è·å–å¦ä¸€ä¸ªå­æ¨¡å—çš„beanã€‚<br>æŠ¥é”™ï¼šNoSuchBeanDefinitionExceptionã€‚</p>
<p>å¦‚ä½•è·å–Beanï¼š<br>1.åœ¨å¯åŠ¨ç±»ä¸ŠåŠ @ComponentScanæ³¨è§£ï¼Œæ‰«æè¦å¼•å…¥Beançš„åŒ…ã€‚<br>ç¼ºç‚¹ï¼šè¦å†™åŒ…å¤ªç´¯èµ˜<br>2.ä½¿ç”¨@Importæ³¨è§£åŠ è½½è¦å¯¼å…¥beançš„é…ç½®ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Target(&#123;ElementType.TYPE&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">public @interface Import &#123;</span><br><span class="line">    Class&lt;?&gt;[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>valueä¸­çš„è¿™äº›ç±»ä¼šè¢«springåˆ›å»ºå¹¶æ”¾å…¥IOCå®¹å™¨ä¸­ã€‚<br>ç¼ºç‚¹ï¼šè¦è®°ç±»çš„åå­—<br>3.å¯¹Importæ³¨è§£è¿›è¡Œå°è£…<br>è‡ªå®šä¹‰ä¸€ä¸ªEnableæ³¨è§£ï¼ŒæŠŠImportæ³¨è§£å°è£…è¿›å»ï¼Œè¦æƒ³ç”¨è¿™ä¸ªbeançš„æ—¶å€™ï¼Œç›´æ¥ç”¨Enableæ³¨è§£å°±å¯ä»¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Import(UserConfig.class)</span><br><span class="line">public @interface EnableUser &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class) //æ’é™¤æ­¤ç±»çš„AutoConfig</span><br><span class="line">//@ComponentScan(&quot;com.liuxuan.condition&quot;)</span><br><span class="line">//@Import(UserConfig.class)</span><br><span class="line">@EnableUser</span><br><span class="line">public class StartApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // å¯åŠ¨springbootåº”ç”¨ï¼Œè·å–springçš„iocå®¹å™¨</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(StartApplication.class, args);</span><br><span class="line"></span><br><span class="line">        // è·å–bean</span><br><span class="line">        Object user = context.getBean(&quot;user&quot;);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ğŸ˜Š<code>@SpringBootApplication(exclude=&#123;DataSourceAutoConfiguration.class&#125;)</code></p>
<p>excludeï¼Œæ’é™¤æ­¤ç±»çš„AutoConfigï¼Œå³ç¦æ­¢ SpringBoot è‡ªåŠ¨æ³¨å…¥æ•°æ®æºé…ç½®ã€‚</p>
<p>DataSourceAutoConfiguration.class ä¼šè‡ªåŠ¨æŸ¥æ‰¾ application.yml æˆ–è€… properties æ–‡ä»¶é‡Œçš„ spring.datasource.* ç›¸å…³å±æ€§å¹¶è‡ªåŠ¨é…ç½®å•æ•°æ®æºã€Œæ³¨æ„è¿™é‡Œæåˆ°çš„å•æ•°æ®æºã€ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ’é™¤äº†è‡ªåŠ¨é…ç½®ï¼ŒSpringè¿˜æ€ä¹ˆè¯†åˆ«åˆ°æ•°æ®åº“é…ç½®å‘¢ï¼Ÿ</p>
<p>ç­”ï¼šæ˜¾ç„¶æ¥ä¸‹æ¥å°±éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œå¦‚æœä½ å‘ç°é¡¹ç›®ä¸­å­˜åœ¨è¿™ä¸ªæ’é™¤çš„æ“ä½œï¼Œå¯ä»¥åœ¨é¡¹ç›®ä¸­æœä¸€ä¸‹Javaå…³é”®å­—@ConfigurationProperties(â€œspring.datasource)ï¼Œä½ å¯èƒ½ä¼šå‘ç°æ‰‹åŠ¨é…ç½®æ•°æ®æºçš„ç±»ã€‚</p>
<p>å†æ¥å›ç­”ä¸ºä½•è¦æ‰‹åŠ¨é…ç½®æ•°æ®æºï¼Œå› ä¸ºè¦é…ç½®å¤šæ•°æ®æºï¼Œä¸Šè¾¹æœ‰æåˆ°DataSourceAutoConfiguration.classé»˜è®¤ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨é…ç½®å•æ•°æ®æºï¼Œæ‰€ä»¥ï¼Œå¦‚æœæƒ³åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¤šæ•°æ®æºå°±éœ€è¦æ’é™¤å®ƒï¼Œæ‰‹åŠ¨æŒ‡å®šå¤šæ•°æ®æºã€‚</p>
<p>@SpringBootApplicationæ³¨è§£ä¸­excludeå‚æ•°ä½¿ç”¨åŠåŸç†:<br><a href="https://blog.csdn.net/csdn_20150804/article/details/116104742">https://blog.csdn.net/csdn_20150804/article/details/116104742</a></p>
<h4 id="âœ…-Importæ³¨è§£"><a href="#âœ…-Importæ³¨è§£" class="headerlink" title="âœ… @Importæ³¨è§£"></a>âœ… @Importæ³¨è§£</h4><p>@Enable*åº•å±‚ä¾èµ–@Importæ³¨è§£å¯¼å…¥ä¸€äº›ç±»ï¼Œä½¿ç”¨@Importå¯¼å…¥çš„ç±»ä¼šè¢«SpringåŠ è½½åˆ°IOCå®¹å™¨ä¸­ï¼Œ@Importæä¾›å››ç§ç”¨æ³•ï¼š</p>
<p>1.å¯¼å…¥Bean</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">StartApplicationä¸Šï¼š</span><br><span class="line">@Import(User.class)</span><br><span class="line"></span><br><span class="line">StartApplicationä¸­ï¼š</span><br><span class="line">// æ ¹æ®ç±»å‹è·å–bean</span><br><span class="line">Object user = context.getBean(User.class);</span><br><span class="line">System.out.println(user);</span><br><span class="line">// è·å–beanåç§°</span><br><span class="line">Map&lt;String, User&gt; map = context.getBeansOfType(User.class);</span><br><span class="line">System.out.println(map);</span><br></pre></td></tr></table></figure>

<p>2.å¯¼å…¥é…ç½®ç±»<br>è¿™ç§æ–¹å¼ï¼Œé…ç½®ç±»ä¸Šçš„@Configurationæ³¨è§£å¯ä»¥ä¸åŠ </p>
<p>3.å¯¼å…¥ImportSelectå®ç°ç±»ã€‚ä¸€èˆ¬ç”¨äºåŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„ç±»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Import(MyImportSelector.class)</span><br><span class="line"></span><br><span class="line">å®ç°ç±»ï¼š</span><br><span class="line">public class MyImportSelector implements ImportSelector &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">        return new String[]&#123;&quot;com.liuxuan.condition.User&quot;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.å¯¼å…¥ImportBeanDefinitionRegistrarå®ç°ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Import(MyImportBeanDefinitionRegistrar.class)</span><br><span class="line"></span><br><span class="line">å®ç°ç±»ï¼š</span><br><span class="line">public class MyImportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123;</span><br><span class="line">        AbstractBeanDefinition beanDefinition = BeanDefinitionBuilder.rootBeanDefinition(User.class).getBeanDefinition();</span><br><span class="line">        registry.registerBeanDefinition(&quot;beanName&quot;, beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="âœ…-EnableAutoConfigurationæ³¨è§£"><a href="#âœ…-EnableAutoConfigurationæ³¨è§£" class="headerlink" title="âœ…@EnableAutoConfigurationæ³¨è§£"></a>âœ…@EnableAutoConfigurationæ³¨è§£</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@EnableAutoConfiguration</span><br><span class="line"></span><br><span class="line">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span><br><span class="line"></span><br><span class="line">AutoConfigurationImportSelectorä¸­ï¼š</span><br><span class="line">public String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">    if (!this.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        return NO_IMPORTS;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        AutoConfigurationImportSelector.AutoConfigurationEntry autoConfigurationEntry = this.getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">        return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ ¸å¿ƒä»£ç ï¼šgetAutoConfigurationEntry</span><br><span class="line">List&lt;String&gt; configurations = this.getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line"></span><br><span class="line">protected List&lt;String&gt; getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) &#123;</span><br><span class="line">    List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());</span><br><span class="line">    Assert.notEmpty(configurations, &quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;);</span><br><span class="line">    return configurations;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ„æ€æ˜¯ï¼šä»spring-boot-autoconfigurationçš„jaråŒ…ä¸‹é¢çš„META-INF/spring.factoriesæ–‡ä»¶ä¸­åŠ è½½ã€‚</span><br><span class="line">çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°ï¼š</span><br><span class="line"> # Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">æœ‰å¾ˆå¤šé…ç½®æ–‡ä»¶ç±»</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼š<br>@EnableAutoConfiguration å¦‚ä½•å®ç°è‡ªåŠ¨é…ç½®<br>1.@EnableAutoConfigurationæ³¨è§£å†…éƒ¨ä½¿ç”¨@Import({AutoConfigurationImportSelector.class}) æ¥åŠ è½½é…ç½®ç±»<br>2.é…ç½®æ–‡ä»¶ä½ç½®ï¼šMETA-INF&#x2F;spring.factoriesï¼Œè¯¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†å¤§é‡çš„é…ç½®ç±»ï¼Œå½“springbootåº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½è¿™äº›é…ç½®ç±»ï¼Œåˆå§‹åŒ–bean<br>3.å¹¶ä¸æ˜¯æ‰€æœ‰çš„beanéƒ½ä¼šè¢«åˆå§‹åŒ–ï¼Œåœ¨é…ç½®ç±»ä¸­ä½¿ç”¨Conditionæ¥åŠ è½½æ»¡è¶³æ¡ä»¶çš„bean</p>
<h4 id="âœ…è‡ªå®šä¹‰starterå®ç°"><a href="#âœ…è‡ªå®šä¹‰starterå®ç°" class="headerlink" title="âœ…è‡ªå®šä¹‰starterå®ç°"></a>âœ…è‡ªå®šä¹‰starterå®ç°</h4><p>çœ‹mybatis-spring-boot-starterå¦‚ä½•å®ç°ï¼š<br>1.çœ‹åˆ°mybatis-spring-boot-starteråŒ…ä¸‹æ²¡ä»€ä¹ˆï¼Œåªæœ‰ä¸€ä¸ªpomæ–‡ä»¶ï¼Œé‡Œé¢å¼•å…¥mybatis-spring-boot-autoconfigureåŒ…<br>2.mybatis-spring-boot-autoconfigureåŒ…çš„META-INF&#x2F;spring.factoriesæ–‡ä»¶ä¸­å®šä¹‰äº†MybatisAutoConfiguration<br>3.@EnableAutoConfigurationä¼šè‡ªåŠ¨è¯†åˆ«åˆ°META-INF&#x2F;spring.factoriesæ–‡ä»¶ï¼Œä»è€Œè¯†åˆ«åˆ°MybatisAutoConfigurationï¼Œæ¨¡å—ä¸­åˆå§‹åŒ–çš„beanå°±åˆ›å»ºå‡ºæ¥</p>
<p>éœ€æ±‚ï¼šè‡ªå®šä¹‰redis-starterï¼Œå½“å¯¼å…¥redis-starteråæ ‡æ—¶ï¼Œspringbootè‡ªåŠ¨åˆ›å»ºjedisçš„beanã€‚</p>
<p>1.åˆ›å»ºä¸€ä¸ªredis-autoconfigurationæ¨¡å—ï¼Œåœ¨é‡Œé¢æä¾›jedisçš„beanï¼Œå¹¶å®ç°è‡ªåŠ¨é…ç½®ã€‚</p>
<p>âš ï¸äº²æµ‹ï¼Œä¸€ä¸ªæ¨¡å—çš„é…ç½®äº†8082ç«¯å£ï¼Œå¦ä¸€ä¸ªæ¨¡å—æ²¡é…ç½®ç«¯å£ï¼Œä½†æ˜¯è¿è¡Œè¯¥æ¨¡å—çš„StartApplicationï¼Œè¦ç”¨çš„æ˜¯8082ç«¯å£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">RedisAutoConfiguration.class:</span><br><span class="line">@Configuration</span><br><span class="line">@EnableConfigurationProperties(RedisProperties.class) //RedisPropertiesè¢«springè¯†åˆ«ï¼Œåˆ›å»ºbean</span><br><span class="line">@ConditionalOnClass(Jedis.class)  //ç–‘é—®ï¼šæ²¡æœ‰Jedisåæ ‡åˆ™ä¸é…ç½®ï¼Œåˆ›å»ºä¹‹å‰ä¸æ˜¯æ²¡è¿™ä¸ªBeanå—ï¼Ÿå¯¼å…¥åæ ‡å’Œæœ‰beançš„å…³ç³»ï¼Ÿ</span><br><span class="line">public class RedisAutoConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean(name = &quot;jedis&quot;)  //å·²ç»å®šä¹‰äº†å°±ä¸å®šä¹‰</span><br><span class="line">    public Jedis getJedisBean(RedisProperties redisProperties) &#123;</span><br><span class="line">        System.out.println(&quot;RedisAutoConfiguration...&quot;);</span><br><span class="line">        return new Jedis(redisProperties.getIp(), redisProperties.getPort());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RedisProperties.class:</span><br><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">@ConfigurationProperties(prefix = &quot;redis&quot;) //ä¸é…ç½®æ–‡ä»¶ä¸­å¯¹åº”</span><br><span class="line">public class RedisProperties &#123;</span><br><span class="line">    private String ip = &quot;localhost&quot;; //æ²¡æä¾›æ—¶ç»™é»˜è®¤å€¼</span><br><span class="line">    private Integer port = 6379;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.åˆ›å»ºMETA-INF&#x2F;spring.factoriesæ–‡ä»¶ï¼Œå…¶ä¸­é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">    com.liuxuan.redis.configuration.RedisAutoConfiguration</span><br></pre></td></tr></table></figure>

<p>3.åˆ›å»ºredis-starteræ¨¡å—ï¼Œpomæ–‡ä»¶ä¸­å¼•å…¥redis-configurationä¾èµ–ã€‚</p>
<p>4.åœ¨å¦ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œpomæ–‡ä»¶ä¸­å¼•å…¥redis-starterä¾èµ–ã€‚åœ¨StartApplicationä¸­å°è¯•è·å–beanã€‚è¿™ä¸ªæ¨¡å—ä¸­å¯¼å…¥äº†Jedisä¾èµ–ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰Jedisçš„beançš„é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ConfigurableApplicationContext context = SpringApplication.run(StartApplication.class, args);</span><br><span class="line">Jedis jedis = context.getBean(Jedis.class);</span><br><span class="line">System.out.println(jedis);</span><br><span class="line"></span><br><span class="line">jedis.set(&quot;hello&quot;, &quot;hi&quot;);</span><br><span class="line">System.out.println(jedis.get(&quot;hello&quot;));</span><br></pre></td></tr></table></figure>

<p>5.å¯ä»¥åœ¨ä½¿ç”¨çš„æ¨¡å—ä¸­è¿›è¡Œé…ç½®redisçš„ipå’Œhost</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">redis.port=6379</span><br><span class="line">redis.ip=localhost</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼šStartApplicationä¸Šçš„@SpringBootApplicationæ³¨è§£ä¸­çš„@EnableAutoConfigurationä¸­çš„@Import({AutoConfigurationImportSelector.class})ä¸­ä¼šè‡ªåŠ¨å»æ‰¾jaråŒ…ä¸­çš„META-INF&#x2F;spring.factoriesæ–‡ä»¶ï¼Œè¯†åˆ«åˆ°éœ€è¦åŠ è½½çš„é…ç½®ç±»ï¼Œå†è·å–é…ç½®ç±»åˆ›å»ºçš„beanï¼Œä»è€Œå®ç°è‡ªåŠ¨é…ç½®beanã€‚</p>
<p>çœ‹spring-boot-autoconfigurationåŒ…ä¸‹çš„dataä¸‹çš„redisä¸‹çš„æ–‡ä»¶ä¸­ï¼Œå°±å®šä¹‰äº†RedisAutoConfigurationï¼Œå’Œä¸Šé¢å®ç°ç±»ä¼¼ã€‚</p>
<h3 id="springbootç›‘å¬æœºåˆ¶"><a href="#springbootç›‘å¬æœºåˆ¶" class="headerlink" title="springbootç›‘å¬æœºåˆ¶"></a>springbootç›‘å¬æœºåˆ¶</h3><p>springbootçš„ç›‘å¬æœºåˆ¶ï¼Œå…¶å®æ˜¯å¯¹javaæä¾›çš„äº‹ä»¶ç›‘å¬æœºåˆ¶çš„å°è£…ã€‚</p>
<p>javaä¸­çš„äº‹ä»¶ç›‘å¬æœºåˆ¶å®šä¹‰äº†ä»¥ä¸‹å‡ ä¸ªè§’è‰²ï¼š<br>1.äº‹ä»¶ï¼šEventï¼Œç»§æ‰¿java.util.EventObjectç±»çš„å¯¹è±¡<br>2.äº‹ä»¶æºï¼šSourceï¼Œä»»æ„å¯¹è±¡Object<br>3.ç›‘å¬å™¨ï¼šListenerï¼Œå®ç°java.util.EventListeneræ¥å£çš„å¯¹è±¡</p>
<p>springbootä¸éœ€è¦è¿™ä¹ˆéº»çƒ¦ï¼Œspringbootåœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œä¼šå¯¹å‡ ä¸ªç›‘å¬å™¨è¿›è¡Œå›è°ƒï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è¿™äº›ç›‘å¬å™¨æ¥å£ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å®Œæˆä¸€äº›æ“ä½œã€‚</p>
<p>ApplicationContextInitializerã€SpringApplicationRunListenerã€CommandLineRunnerã€ApplicationRunner</p>
<p>1 .ç»§æ‰¿è¿™äº›æ¥å£ï¼Œé‡å†™æ–¹æ³•ï¼Œå¹¶æ‰“å°å¯¹åº”æ“ä½œï¼Œ@Componentæ³¨å†Œbeanã€‚</p>
<p>2 .å¯åŠ¨å‘ç°åªæœ‰åä¸¤ä¸ªæœ‰æ‰“å°ã€‚<br>CommandLineRunnerã€ApplicationRunneråœ¨é¡¹ç›®å¯åŠ¨åæ‰§è¡Œrunæ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚ï¼šç¼“å­˜é¢„çƒ­(æå‰æŠŠæ•°æ®åº“çš„æ•°æ®åŠ åˆ°ç¼“å­˜)<br>æ‰“å°è¿™ä¸¤ä¸ªæ–¹æ³•çš„argsï¼Œå‘ç°æ˜¯ç©ºæ•°ç»„ï¼Œåœ¨é…ç½®ä¸­çš„environmentä¸­çš„program argumentsä¸­æ·»åŠ hello worldï¼Œå°±ä¼šè¿”å›[hello, world]</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyCommandLineRunner implements CommandLineRunner &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run(String... args) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyCommandLineRunner run...&quot;);</span><br><span class="line">        System.out.println(&quot;MyCommandLineRunner args:&quot; + Arrays.asList(args));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyApplicationRunner implements ApplicationRunner &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run(ApplicationArguments args) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;MyApplicationRunner run...&quot;);</span><br><span class="line">        System.out.println(&quot;MyApplicationRunner args:&quot; + Arrays.asList(args.getSourceArgs()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3 .å…¶ä»–ä¸¤ä¸ªç›‘å¬å™¨æ€ä¹ˆç”¨ï¼šåœ¨META-INF&#x2F;spring.factoriesï¼ˆå›ºå®šçš„å†™æ³•ï¼Œå·¥ç¨‹å¯åŠ¨æ—¶ä¼šè¢«è‡ªåŠ¨æ‰«æåˆ°ï¼‰ä¸­é…ç½®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.context.ApplicationContextInitializer=\</span><br><span class="line">  com.liuxuan.listener.MyApplicationContextInitializer</span><br><span class="line">org.springframework.boot.SpringApplicationRunListener=\</span><br><span class="line">  com.liuxuan.listener.MySpringApplicationRunListener</span><br></pre></td></tr></table></figure>

<p>MyApplicationContextInitializerçš„initializeæ–¹æ³•ï¼šé¡¹ç›®è¿˜æ²¡æœ‰å‡†å¤‡iocå®¹å™¨ä¹‹å‰ï¼Œå¯ä»¥æ£€æµ‹ä¸€äº›èµ„æºæ˜¯å¦å­˜åœ¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyApplicationContextInitializer implements ApplicationContextInitializer &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void initialize(ConfigurableApplicationContext applicationContext) &#123;</span><br><span class="line">        System.out.println(&quot;MyApplicationContextInitializer project start..&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>MySpringApplicationRunListener æŠ¥é”™ï¼š<code>java.lang.NoSuchMethodException: com.liuxuan.listener.MySpringApplicationRunListener.&lt;init&gt;(org.springframework.boot.SpringApplication, [Ljava.lang.String;)</code><br>è¡¨ç¤ºéœ€è¦ä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚<br>çœ‹ä¸€ä¸‹ä»£ç ä¸­æä¾›çš„ä¸€ä¸ªå®ç°ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å…¥å‚SpringApplicationè¡¨ç¤ºé¡¹ç›®å¯åŠ¨æ—¶çš„äº‹ä»¶æº</span><br><span class="line">public class EventPublishingRunListener implements SpringApplicationRunListener, Ordered &#123;</span><br><span class="line">    private final SpringApplication application;</span><br><span class="line">    private final String[] args;</span><br><span class="line">    private final SimpleApplicationEventMulticaster initialMulticaster;</span><br><span class="line"></span><br><span class="line">    public EventPublishingRunListener(SpringApplication application, String[] args) &#123;</span><br><span class="line">        this.application = application;</span><br><span class="line">        this.args = args;</span><br><span class="line">        this.initialMulticaster = new SimpleApplicationEventMulticaster();</span><br><span class="line">        Iterator var3 = application.getListeners().iterator();</span><br><span class="line"></span><br><span class="line">        while(var3.hasNext()) &#123;</span><br><span class="line">            ApplicationListener&lt;?&gt; listener = (ApplicationListener)var3.next();</span><br><span class="line">            this.initialMulticaster.addApplicationListener(listener);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› æ­¤ï¼ŒåŠ ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå¹¶æŠŠ@Componentå»æ‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class MySpringApplicationRunListener implements SpringApplicationRunListener &#123;</span><br><span class="line"></span><br><span class="line">    public MySpringApplicationRunListener(SpringApplication application, String[] args) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void starting(ConfigurableBootstrapContext bootstrapContext) &#123;</span><br><span class="line">        System.out.println(&quot;MySpringApplicationRunListener é¡¹ç›®å¯åŠ¨ä¸­...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void environmentPrepared(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment) &#123;</span><br><span class="line">        System.out.println(&quot;MySpringApplicationRunListener ç¯å¢ƒå¯¹è±¡å¼€å§‹å‡†å¤‡ä¸­(è¿˜ä¸èƒ½è·å–é…ç½®ä¿¡æ¯)...&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void contextPrepared(ConfigurableApplicationContext context) &#123;</span><br><span class="line">        System.out.println(&quot;MySpringApplicationRunListener ä¸Šä¸‹æ–‡å¯¹è±¡å¼€å§‹å‡†å¤‡(è¿˜æ²¡åŠ è½½iocå®¹å™¨)...&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void contextLoaded(ConfigurableApplicationContext context) &#123;</span><br><span class="line">        System.out.println(&quot;MySpringApplicationRunListener ä¸Šä¸‹æ–‡å¯¹è±¡å¼€å§‹åŠ è½½(åˆ›å»ºspringbootå¯åŠ¨çš„bean)...&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void started(ConfigurableApplicationContext context, Duration timeTaken) &#123;</span><br><span class="line">        System.out.println(&quot;MySpringApplicationRunListener åŠ è½½å®Œæˆ...&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void started(ConfigurableApplicationContext context) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void ready(ConfigurableApplicationContext context, Duration timeTaken) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void running(ConfigurableApplicationContext context) &#123;</span><br><span class="line">        System.out.println(&quot;MySpringApplicationRunListener é¡¹ç›®å¯åŠ¨å®Œæˆå¼€å§‹è¿è¡Œ...&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void failed(ConfigurableApplicationContext context, Throwable exception) &#123;</span><br><span class="line">        System.out.println(&quot;MySpringApplicationRunListener é¡¹ç›®å¯åŠ¨å¤±è´¥...&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹spring-bootåŒ…ä¸‹çš„contextä¸‹çš„eventåŒ…ä¸‹çš„ä¸€äº›å®šä¹‰å¥½çš„äº‹ä»¶Eventï¼Œå¾€é‡Œçœ‹éƒ½æ˜¯ç»§æ‰¿è‡ªjavaçš„utilåŒ…ä¸‹çš„EventObjectçš„ã€‚æ‰€ä»¥è¯´springbootçš„äº‹ä»¶ç›‘å¬æ˜¯å¯¹javaäº‹ä»¶ç›‘å¬çš„å°è£…ã€‚</p>
<h3 id="springbootå¯åŠ¨æµç¨‹"><a href="#springbootå¯åŠ¨æµç¨‹" class="headerlink" title="springbootå¯åŠ¨æµç¨‹"></a>springbootå¯åŠ¨æµç¨‹</h3><p>è§‚å¯Ÿè€…æ¨¡å¼ï¼šè§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ï¼Œè¢«è§‚å¯Ÿè€…ï¼šäº‹ä»¶å’Œäº‹ä»¶æºï¼Œè§‚å¯Ÿè€…ï¼šç›‘å¬å™¨ã€‚</p>
<h4 id="âœ…åˆå§‹åŒ–"><a href="#âœ…åˆå§‹åŒ–" class="headerlink" title="âœ…åˆå§‹åŒ–"></a>âœ…åˆå§‹åŒ–</h4><p>debugä¸€ä¸‹å¯åŠ¨ç±»StartApplicationä¸­çš„<code>SpringApplication.run</code>æ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public static ConfigurableApplicationContext run(Class&lt;?&gt;[] primarySources, String[] args) &#123;</span><br><span class="line">    return (new SpringApplication(primarySources)).run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºäº†ä¸€ä¸ªSpringApplicationå¯¹è±¡ï¼ˆäº‹ä»¶æºå¯¹è±¡ï¼‰ã€‚</p>
<p>SpringApplicationæ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public SpringApplication(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) &#123;</span><br><span class="line">    this.sources = new LinkedHashSet();</span><br><span class="line">    this.bannerMode = Mode.CONSOLE;</span><br><span class="line">    this.logStartupInfo = true;</span><br><span class="line">    this.addCommandLineProperties = true;</span><br><span class="line">    this.addConversionService = true;</span><br><span class="line">    this.headless = true;</span><br><span class="line">    this.registerShutdownHook = true;</span><br><span class="line">    this.additionalProfiles = Collections.emptySet();</span><br><span class="line">    this.isCustomEnvironment = false;</span><br><span class="line">    this.lazyInitialization = false;</span><br><span class="line">    this.applicationContextFactory = ApplicationContextFactory.DEFAULT;</span><br><span class="line">    this.applicationStartup = ApplicationStartup.DEFAULT;</span><br><span class="line">    this.resourceLoader = resourceLoader;</span><br><span class="line">    Assert.notNull(primarySources, &quot;PrimarySources must not be null&quot;);</span><br><span class="line">    this.primarySources = new LinkedHashSet(Arrays.asList(primarySources));  //æœ‰æ²¡æœ‰ä¸»ç±»</span><br><span class="line">    this.webApplicationType = WebApplicationType.deduceFromClasspath();   //æ˜¯å¦æ˜¯webç¯å¢ƒ</span><br><span class="line">    this.bootstrapRegistryInitializers = new ArrayList(this.getSpringFactoriesInstances(BootstrapRegistryInitializer.class));</span><br><span class="line">    this.setInitializers(this.getSpringFactoriesInstances(ApplicationContextInitializer.class));  //ä»springfactoryæ–‡ä»¶ä¸­åŠ è½½initializers</span><br><span class="line">    this.setListeners(this.getSpringFactoriesInstances(ApplicationListener.class));  //ä»springfactoryé…ç½®æ–‡ä»¶ä¸­åŠ è½½listenerï¼ˆæ”¾åˆ°seté›†åˆä¸­ï¼‰</span><br><span class="line">    this.mainApplicationClass = this.deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/springboot%E5%90%AF%E5%8A%A8.png"></p>
<h4 id="âœ…runæ–¹æ³•"><a href="#âœ…runæ–¹æ³•" class="headerlink" title="âœ…runæ–¹æ³•"></a>âœ…runæ–¹æ³•</h4><p>StartApplicationçš„runæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public ConfigurableApplicationContext run(String... args) &#123;</span><br><span class="line">    long startTime = System.nanoTime();  //ç›‘æ§è€—æ—¶ï¼Œä¹Ÿå¯ä»¥ç”¨StopWatch</span><br><span class="line">    DefaultBootstrapContext bootstrapContext = this.createBootstrapContext();</span><br><span class="line">    ConfigurableApplicationContext context = null;  //å®šä¸€ä¸ªå®¹å™¨</span><br><span class="line">    this.configureHeadlessProperty();  //åŠ è½½ä¸œè¥¿</span><br><span class="line">    SpringApplicationRunListeners listeners = this.getRunListeners(args);  //è·å–RunListener</span><br><span class="line">    listeners.starting(bootstrapContext, this.mainApplicationClass);  //è°ƒç”¨runListenerçš„startingæ–¹æ³•</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);</span><br><span class="line">        ConfigurableEnvironment environment = this.prepareEnvironment(listeners, bootstrapContext, applicationArguments);  //å‡†å¤‡ç¯å¢ƒï¼Œå›è°ƒrunListenerçš„prepareEnvironmentæ–¹æ³•ï¼Œç¯å¢ƒå¯¹è±¡Environmentå°±æœ‰ä¿¡æ¯äº†</span><br><span class="line">        this.configureIgnoreBeanInfo(environment);</span><br><span class="line">        Banner printedBanner = this.printBanner(environment);  //æ‰“å°springå›¾æ ‡ï¼Œå¯ä»¥æ›¿æ¢banner.txt</span><br><span class="line">        context = this.createApplicationContext();  //åˆ›å»ºiocå®¹å™¨</span><br><span class="line">        context.setApplicationStartup(this.applicationStartup);</span><br><span class="line">        this.prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);  //åŠ è½½iocå®¹å™¨</span><br><span class="line">        // å¯ä»¥çœ‹contexté‡Œçš„beanFactoryé‡Œçš„beanDefinitionMapï¼Œé‡Œé¢æ˜¯çœŸæ­£çš„beanï¼Œè¿™æ—¶è¿˜æ²¡åŠ è½½bean</span><br><span class="line">        this.refreshContext(context);  //è¿™é‡Œä»é…ç½®æ–‡ä»¶é‡Œæ‰¾ï¼Œåˆ›å»ºbeanï¼ˆè€—æ—¶æ“ä½œï¼‰</span><br><span class="line">        this.afterRefresh(context, applicationArguments);</span><br><span class="line">        Duration timeTakenToStartup = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">        if (this.logStartupInfo) &#123;</span><br><span class="line">            (new StartupInfoLogger(this.mainApplicationClass)).logStarted(this.getApplicationLog(), timeTakenToStartup);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        listeners.started(context, timeTakenToStartup);  //é¡¹ç›®å¯åŠ¨æˆåŠŸï¼ŒåŠ è½½æˆåŠŸ</span><br><span class="line">        this.callRunners(context, applicationArguments);  //commandLineRunnerå’ŒapplicationRunner å›è°ƒæ‰§è¡Œ</span><br><span class="line">    &#125; catch (Throwable var12) &#123;</span><br><span class="line">        this.handleRunFailure(context, var12, listeners);</span><br><span class="line">        throw new IllegalStateException(var12);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        Duration timeTakenToReady = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">        listeners.ready(context, timeTakenToReady);</span><br><span class="line">        return context;</span><br><span class="line">    &#125; catch (Throwable var11) &#123;</span><br><span class="line">        this.handleRunFailure(context, var11, (SpringApplicationRunListeners)null);</span><br><span class="line">        throw new IllegalStateException(var11);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šï¼Œé€šè¿‡debugæºç çš„æ–¹å¼ï¼Œæ¢ç´¢äº†springbootå¯åŠ¨æµç¨‹ï¼Œçœ‹äº†ç›‘å¬å™¨æ–¹æ³•åœ¨å“ªé‡Œæ‰§è¡Œå›è°ƒã€‚</p>
<h2 id="springbootç›‘æ§"><a href="#springbootç›‘æ§" class="headerlink" title="springbootç›‘æ§"></a>springbootç›‘æ§</h2><h3 id="urlæ–¹å¼"><a href="#urlæ–¹å¼" class="headerlink" title="urlæ–¹å¼"></a>urlæ–¹å¼</h3><p>SpringBootè‡ªå¸¦ç›‘æ§åŠŸèƒ½Actuatorï¼Œå¯ä»¥å¸®åŠ©å®ç°å¯¹ç¨‹åºå†…éƒ¨è¿è¡Œæƒ…å†µç›‘æ§ï¼Œæ¯”å¦‚ç›‘æ§çŠ¶å†µã€BeanåŠ è½½æƒ…å†µã€é…ç½®å±æ€§ ã€æ—¥å¿—ä¿¡æ¯ç­‰ã€‚</p>
<p>ä½¿ç”¨æ­¥éª¤</p>
<p>â‘  å¯¼å…¥ä¾èµ–åæ ‡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>â‘¡ è®¿é—®<a href="http://localhost:8080/actuator">http://localhost:8080/actuator</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;_links&quot;:&#123;</span><br><span class="line">        &quot;self&quot;:&#123;</span><br><span class="line">            &quot;href&quot;:&quot;http://localhost:8082/actuator&quot;,</span><br><span class="line">            &quot;templated&quot;:false</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;health-path&quot;:&#123;</span><br><span class="line">            &quot;href&quot;:&quot;http://localhost:8082/actuator/health/&#123;*path&#125;&quot;,</span><br><span class="line">            &quot;templated&quot;:true</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;health&quot;:&#123;</span><br><span class="line">            &quot;href&quot;:&quot;http://localhost:8082/actuator/health&quot;,</span><br><span class="line">            &quot;templated&quot;:false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è·¯å¾„	æè¿°</span><br><span class="line">/beans	æè¿°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡é‡Œå…¨éƒ¨çš„Beanï¼Œä»¥åŠå®ƒä»¬çš„å…³ç³»</span><br><span class="line">/env	è·å–å…¨éƒ¨ç¯å¢ƒå±æ€§</span><br><span class="line">/env/&#123;name&#125;	æ ¹æ®åç§°è·å–ç‰¹å®šçš„ç¯å¢ƒå±æ€§å€¼</span><br><span class="line">/health	æŠ¥å‘Šåº”ç”¨ç¨‹åºçš„å¥åº·æŒ‡æ ‡ï¼Œè¿™äº›å€¼ç”±HealthIndicatorçš„å®ç°ç±»æä¾›</span><br><span class="line">/info	è·å–åº”ç”¨ç¨‹åºçš„å®šåˆ¶ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ç”±infoæ‰“å¤´çš„å±æ€§æä¾›</span><br><span class="line">/mappings	æè¿°å…¨éƒ¨çš„URIè·¯å¾„ï¼Œä»¥åŠå®ƒä»¬å’Œæ§åˆ¶å™¨(åŒ…å«Actuatorç«¯ç‚¹)çš„æ˜ å°„å…³ç³»</span><br><span class="line">/metrics	æŠ¥å‘Šå„ç§åº”ç”¨ç¨‹åºåº¦é‡ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å­˜ç”¨é‡å’ŒHTTPè¯·æ±‚è®¡æ•°</span><br><span class="line">/metrics/&#123;name&#125;	æŠ¥å‘ŠæŒ‡å®šåç§°çš„åº”ç”¨ç¨‹åºåº¦é‡å€¼</span><br><span class="line">/trace	æä¾›åŸºæœ¬çš„HTTPè¯·æ±‚è·Ÿè¸ªä¿¡æ¯(æ—¶é—´æˆ³ã€HTTPå¤´ç­‰)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">info:</span><br><span class="line">  name: hello</span><br><span class="line">  age: 23</span><br><span class="line"></span><br><span class="line">management:</span><br><span class="line">  #å¼€å¯å¥åº·æ£€æŸ¥çš„å®Œæ•´ä¿¡æ¯</span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      show-details: always</span><br><span class="line">  #å°†æ‰€æœ‰çš„ç›‘æ§endPointsæš´æ¼å‡ºæ¥</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: *</span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot-Admin"><a href="#Spring-Boot-Admin" class="headerlink" title="Spring Boot Admin"></a>Spring Boot Admin</h3><p>ç›‘æ§çš„å¯è§†åŒ–ç•Œé¢ï¼Œåªä¸è¿‡éœ€è¦è‡ªå·±å†èµ·ä¸ªç›‘æ§æœåŠ¡ã€‚</p>
<p>Spring Boot Adminæ˜¯ä¸€ä¸ªå¼€æºç¤¾åŒºé¡¹ç›®ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§SpringBootåº”ç”¨ç¨‹åºã€‚</p>
<p>Spring Boot Admin æœ‰ä¸¤ä¸ªè§’è‰²ï¼Œå®¢æˆ·ç«¯(Client)å’ŒæœåŠ¡ç«¯(Server)ã€‚</p>
<p>åº”ç”¨ç¨‹åºä½œä¸ºSpring Boot Admin Clientå‘ä¸ºSpring Boot Admin Serveræ³¨å†Œ</p>
<p>Spring Boot Admin Server çš„UIç•Œé¢å°†Spring Boot Admin Clientçš„Actuator Endpointä¸Šçš„ä¸€äº›ç›‘æ§ä¿¡æ¯.</p>
<p>ä½¿ç”¨æ­¥éª¤ï¼š</p>
<p>admin-serverï¼ˆç›‘æ§æœåŠ¡ï¼‰</p>
<p>â‘  åˆ›å»º admin-server æ¨¡å—</p>
<p>â‘¡ å¯¼å…¥ä¾èµ–åæ ‡ admin-starter-server</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;de.codecentric&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-admin-starter-server&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>â‘¢ åœ¨å¼•å¯¼ç±»ä¸Šå¯ç”¨ç›‘æ§åŠŸèƒ½@EnableAdminServer</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableAdminServer</span><br><span class="line">public class SpringbootAdminServerApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(SpringbootAdminServerApplication.class, args);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p>admin-clientï¼ˆè¢«ç›‘æ§æœåŠ¡ï¼‰</p>
<p>â‘  åˆ›å»º admin-client æ¨¡å—</p>
<p>â‘¡ å¯¼å…¥ä¾èµ–åæ ‡ admin-starter-client</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;de.codecentric&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-admin-starter-client&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>â‘¢ é…ç½®ç›¸å…³ä¿¡æ¯ï¼šserveråœ°å€ç­‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŒ‡å®šadmin.serveråœ°å€ï¼Œserveråœ¨9000ç«¯å£å·ï¼Œç›¸å½“äºå‘serveræ³¨å†Œ</span><br><span class="line">spring.boot.admin.client.url=http://localhost:9000</span><br><span class="line">å±•ç¤ºå¥åº·æ£€æŸ¥è¯¦ç»†è¯¦ç»†å±•ç¤ºå‡ºæ¥</span><br><span class="line">management.endpoint.health.show-details=always</span><br><span class="line">å¼€å¯æ‰€æœ‰é…ç½®</span><br><span class="line">management.endpoints.web.exposure.include=*</span><br></pre></td></tr></table></figure>

<p>â‘£ å¯åŠ¨serverå’ŒclientæœåŠ¡ï¼Œè®¿é—®server<br><a href="http://localhost:9000/applications">http://localhost:9000/applications</a></p>
<hr>
<p>å‡ºç°é—®é¢˜ï¼š<br>Failed to configure a DataSource: â€˜urlâ€™ attribute is not specified and no embedded datasource could be configured.</p>
<p>åŸå› ï¼šå½“å‰é¡¹ç›®æ²¡æœ‰é…ç½®DataSourceç›¸å…³é…ç½®ã€‚springbootè‡ªåŠ¨é…ç½®æ—¶ï¼Œæ£€æµ‹åˆ°æ·»åŠ äº†mysqlçš„ä¾èµ–åŒ…ï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶ä¸­å´æ²¡æ·»åŠ æ•°æ®åº“çš„ç›¸å…³é…ç½®ã€‚<br>è¯¥æ¡ˆä¾‹ä¸­ï¼šmysqlä¾èµ–åœ¨çˆ¶pomä¸­å¼•å…¥ï¼Œè¯¥å­å·¥ç¨‹ä¸ç”¨mysqlã€‚</p>
<p>è§£å†³åŠæ³•ï¼š@SpringBootApplication(exclude &#x3D; DataSourceAutoConfiguration.class) æ’é™¤è‡ªåŠ¨æ³¨å…¥æ•°æ®åº“é…ç½®</p>
<hr>
<p>ä¸çŸ¥é“æ˜¯ä¸æ˜¯åŒ…çš„ç‰ˆæœ¬ä¸å¯¹ï¼Œæœ‰çš„ç‰ˆæœ¬æŠ¥é”™ï¼Œæœ‰çš„ç‰ˆæœ¬è¿è¡Œäº†å´æ²¡æ˜¾ç¤ºã€‚<br>ideaä¸­ç‚¹EndPoinså°±å¯ä»¥å›¾å½¢åŒ–ç•Œé¢çš„æ–¹å¼æ¥ç›‘æ§ï¼Œä¸ç”¨é‚£ä¹ˆéº»çƒ¦ï¼Œ</p>
<h2 id="springbooté¡¹ç›®éƒ¨ç½²"><a href="#springbooté¡¹ç›®éƒ¨ç½²" class="headerlink" title="springbooté¡¹ç›®éƒ¨ç½²"></a>springbooté¡¹ç›®éƒ¨ç½²</h2><p>SpringBoot é¡¹ç›®å¼€å‘å®Œæ¯•åï¼Œæ”¯æŒä¸¤ç§æ–¹å¼éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼š</p>
<p>â‘  jaråŒ…(å®˜æ–¹æ¨è) ç”¨å†…ç½®çš„tomcatå¯åŠ¨</p>
<p>â‘¡ waråŒ…</p>
<h3 id="jaræ‰“åŒ…æ–¹å¼"><a href="#jaræ‰“åŒ…æ–¹å¼" class="headerlink" title="jaræ‰“åŒ…æ–¹å¼"></a>jaræ‰“åŒ…æ–¹å¼</h3><p>å°†å½“å‰æ¨¡å—æ‰“åŒ…ï¼šideaå³è¾¹mavenä¸­é€‰æ‹©è¦æ‰“åŒ…çš„æ¨¡å—ï¼Œç‚¹lifecycleï¼Œç‚¹packageã€‚</p>
<p>æ‰“å¥½çš„jaråŒ…åœ¨é¡¹ç›®çš„targetç›®å½•ä¸‹ã€‚ç›´æ¥<code>java -jar .\jaråŒ…åç§°</code>ï¼Œå¯åŠ¨æˆåŠŸã€‚</p>
<h3 id="waræ‰“åŒ…æ–¹å¼"><a href="#waræ‰“åŒ…æ–¹å¼" class="headerlink" title="waræ‰“åŒ…æ–¹å¼"></a>waræ‰“åŒ…æ–¹å¼</h3><p>pom.xmlé‡Œæ›´æ”¹æ‰“åŒ…æ–¹å¼ï¼š<code>&lt;packaging&gt;war&lt;/packaging&gt;</code><br>å¦‚æœæƒ³æ”¹waråŒ…çš„åå­—ï¼š<code>&lt;finalName&gt;</code>æ ‡ç­¾</p>
<p>åœ¨å¼•å¯¼ç±»ç»§æ‰¿SpringBootServletInitializerç±»ï¼Œå¹¶é‡å†™configureæ–¹æ³•:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringBootDeployApplication extends SpringBootServletInitializer &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(SpringBootDeployApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) &#123;</span><br><span class="line">        return builder.sources(SpringBootDeployApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œï¼Œæ‰“å¥½çš„waråŒ…å¯ä»¥è¢«å¤–éƒ¨tomcatè¯†åˆ«ï¼Œå°†å…¶æ”¾åœ¨tomcatç›®å½•ä¸‹çš„webappsç›®å½•ä¸‹ï¼Œå¯åŠ¨tomcatå³å¯ï¼ˆstartup.batï¼‰ï¼Œæµè§ˆå™¨è®¿é—®éœ€è¦åŠ é¡¹ç›®çš„åŒ…åç§°ï¼Œå› ä¸ºWEB-INFæ–‡ä»¶åœ¨å…¶ä¹‹ä¸‹ã€‚å¹¶ä¸”ï¼Œå†…ç½®é¡¹ç›®çš„ç«¯å£å·é…ç½®å°±ä¸ç”Ÿæ•ˆäº†ã€‚</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠSpringå®æˆ˜ã€‹</title>
    <url>/2021/12/15/myblog/spring/%E3%80%8ASpring%E5%AE%9E%E6%88%98%E3%80%8B/</url>
    <content><![CDATA[<p>æœ¬ä¹¦ä»‹ç»å¦‚ä½•ä½¿ç”¨Springå’ŒSpring Bootå¼€å‘åŸºäºWebã€æ•°æ®åº“ä½œä¸ºåç«¯çš„Javaåº”ç”¨ã€‚å¦‚ä½•ä¸å…¶ä»–åº”ç”¨è¿›è¡Œé›†æˆï¼Œä½¿ç”¨ååº”å¼ç±»å‹è¿›è¡Œç¼–ç¨‹ï¼Œä»¥åŠå°†åº”ç”¨æ‹†åˆ†æˆç¦»æ•£çš„å¾®æœåŠ¡ã€‚æœ€åå¦‚ä½•å‡†å¤‡åº”ç”¨çš„éƒ¨ç½²ã€‚</p>
<p>Spring5.0å’ŒSpring Boot2.0</p>
<h1 id="ç¬¬ä¸€ç« -Springèµ·æ­¥"><a href="#ç¬¬ä¸€ç« -Springèµ·æ­¥" class="headerlink" title="ç¬¬ä¸€ç«  Springèµ·æ­¥"></a>ç¬¬ä¸€ç«  Springèµ·æ­¥</h1><h2 id="ä»€ä¹ˆæ˜¯spring"><a href="#ä»€ä¹ˆæ˜¯spring" class="headerlink" title="ä»€ä¹ˆæ˜¯spring"></a>ä»€ä¹ˆæ˜¯spring</h2><p>springæ”¯æŒï¼šé¢å‘äº‘çš„ç”±å¾®æœåŠ¡ç»„æˆçš„åº”ç”¨ï¼Œååº”å¼ç¼–ç¨‹ï¼Œè‡´åŠ›äºé€šè¿‡éé˜»å¡æ“ä½œæä¾›æ›´å¥½çš„æ‰©å±•æ€§å¹¶æå‡æ€§èƒ½ã€‚é€šè¿‡spring bootç®€åŒ–è‡ªå·±çš„å¼€å‘æ¨¡å‹ã€‚</p>
<p>Spring çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª <em>å®¹å™¨ï¼ˆcontainerï¼‰</em>ï¼Œé€šå¸¸ç§°ä¸º <em>Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡</em>ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†åº”ç”¨ç¨‹åºç»„ä»¶ã€‚è¿™äº›ç»„ä»¶ï¼ˆæˆ– beanï¼‰åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿æ¥åœ¨ä¸€èµ·ä»¥æ„æˆä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºï¼Œå°±åƒå°†ç –ã€ç°æµ†ã€æœ¨æã€é’‰å­ã€ç®¡é“å’Œç”µçº¿ç»‘åœ¨ä¸€èµ·ä»¥ç»„æˆæˆ¿å±‹ã€‚</p>
<p>å°† bean è¿æ¥åœ¨ä¸€èµ·çš„è¡Œä¸ºæ˜¯åŸºäºä¸€ç§ç§°ä¸º <em>ä¾èµ–æ³¨å…¥</em>ï¼ˆdependency injectionï¼ŒDIï¼‰çš„æ¨¡å¼ã€‚ç»„ä»¶ä¸ä¼šå†å»åˆ›å»ºå®ƒæ‰€ä¾èµ–çš„ç»„ä»¶å¹¶ç®¡ç†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ç”¨ä¾èµ–æ³¨å…¥çš„åº”ç”¨ä¾èµ–äºå•ç‹¬çš„å®ä½“ï¼ˆå®¹å™¨ï¼‰æ¥åˆ›å»ºå’Œç»´æŠ¤æ‰€æœ‰çš„ç»„ä»¶ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°éœ€è¦å®ƒä»¬çš„beanä¸­ã€‚é€šå¸¸é€šè¿‡æ„é€ å‡½æ•°å‚æ•°æˆ–å±æ€§è®¿é—®å™¨æ–¹æ³•å®Œæˆæ­¤æ“ä½œã€‚æ€»ç»“ï¼šåº”ç”¨ç»„ä»¶é€šè¿‡Springçš„åº”ç”¨ä¸Šä¸‹æ–‡æ¥è¿›è¡Œç®¡ç†å¹¶å®ç°äº’ç›¸æ³¨å…¥ã€‚</p>
<p>è·ç¦»ï¼šå•†å“æœåŠ¡éœ€è¦ä¾èµ–äºåº“å­˜æœåŠ¡ï¼Œåº“å­˜æœåŠ¡éœ€è¦æ³¨å…¥åˆ°å•†å“æœåŠ¡ã€‚</p>
<p>â‘ ä»å†å²ä¸Šçœ‹ï¼Œå¼•å¯¼ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å°† bean è¿æ¥åœ¨ä¸€èµ·çš„æ–¹å¼æ˜¯ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª XML æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æè¿°äº†ç»„ä»¶åŠå…¶ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ XML å£°æ˜ä¸¤ä¸ª beanï¼Œä¸€ä¸ª <code>InventoryService bean</code> å’Œä¸€ä¸ª <code>ProductService bean</code>ï¼Œç„¶åé€šè¿‡æ„é€ å‡½æ•°å‚æ•°å°† <code>InventoryService</code> æ³¨å…¥åˆ° <code>ProductService</code> ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;inventoryService&quot;</span> class=<span class="string">&quot;com.example.InventoryService&quot;</span> /&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;productService&quot;</span> class=<span class="string">&quot;com.example.ProductService&quot;</span> &gt;</span><br><span class="line">    &lt;constructor-arg ref=<span class="string">&quot;inventoryService&quot;</span> /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>â‘¡ä½†æ˜¯ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„ Spring ä¸­ï¼ŒåŸºäº Java çš„é…ç½®æ›´ä¸ºå¸¸è§ã€‚ä»¥ä¸‹åŸºäº Java çš„é…ç½®ç±»ç­‰æ•ˆäº XML é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> InventoryService <span class="title function_">inventoryService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InventoryService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ProductService <span class="title function_">productService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProductService</span>(inventoryService());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Configuration</code> æ³¨é‡Šå‘ Spring è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå®ƒå°†ä¸º Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æä¾› beansã€‚ é…ç½®çš„ç±»æ–¹æ³•å¸¦æœ‰ <code>@Bean</code> æ³¨é‡Šï¼ŒæŒ‡ç¤ºå®ƒä»¬è¿”å›çš„å¯¹è±¡åº”ä½œä¸º beans æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬å„è‡ªçš„ bean IDs å°†ä¸å®šä¹‰å®ƒä»¬çš„æ–¹æ³•çš„åç§°ç›¸åŒï¼‰ã€‚</p>
<p>ä¸åŸºäº XML çš„é…ç½®ç›¸æ¯”ï¼ŒåŸºäº Java çš„é…ç½®å…·æœ‰å¤šä¸ªä¼˜ç‚¹ï¼ŒåŒ…æ‹¬æ›´é«˜çš„ç±»å‹å®‰å…¨æ€§å’Œæ”¹è¿›çš„å¯é‡æ„æ€§ã€‚å³ä½¿è¿™æ ·ï¼Œä»…å½“ Spring æ— æ³•è‡ªåŠ¨é…ç½®ç»„ä»¶æ—¶ï¼Œæ‰éœ€è¦ä½¿ç”¨ Java æˆ– XML è¿›è¡Œæ˜¾å¼é…ç½®ã€‚</p>
<p>â‘¢è‡ªåŠ¨é…ç½®èµ·æºäº Spring æŠ€æœ¯ï¼Œå³ <em>è‡ªåŠ¨è£…é…</em> å’Œ <em>ç»„ä»¶æ‰«æ</em>ã€‚å€ŸåŠ©ç»„ä»¶æ‰«æï¼ŒSpring å¯ä»¥è‡ªåŠ¨ä»åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸­å‘ç°ç»„ä»¶ï¼Œå¹¶å°†å…¶åˆ›å»ºä¸º Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„ beanã€‚é€šè¿‡è‡ªåŠ¨è£…é…ï¼ŒSpring èƒ½å¤Ÿè‡ªåŠ¨ä¸ºç»„ä»¶æ³¨å…¥å®ƒä»¬æ‰€ä¾èµ–çš„å…¶ä»–beanã€‚</p>
<p>æœ€è¿‘ï¼Œéšç€ Spring Boot çš„æ¨å‡ºï¼Œè‡ªåŠ¨é…ç½®çš„ä¼˜åŠ¿å·²ç»è¿œè¿œè¶…å‡ºäº†ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…ã€‚Spring Boot æ˜¯ Spring æ¡†æ¶çš„æ‰©å±•ï¼Œå®ƒæä¾›äº†å¤šé¡¹ç”Ÿäº§åŠ›å¢å¼ºåŠŸèƒ½ã€‚è¿™äº›å¢å¼ºåŠŸèƒ½ä¸­æœ€è‘—åçš„å°±æ˜¯ <em>è‡ªåŠ¨é…ç½®</em>ï¼Œåœ¨è¿™ç§é…ç½®ä¸­ï¼ŒSpring Boot å¯ä»¥æ ¹æ®ç±»è·¯å¾„ä¸­çš„æ¡ç›®ã€ç¯å¢ƒå˜é‡å’Œå…¶ä»–å› ç´ ï¼Œåˆç†åœ°çŒœæµ‹éœ€è¦é…ç½®å“ªäº›ç»„ä»¶ï¼Œå¹¶å°†å®ƒä»¬è£…é…åœ¨ä¸€èµ·ã€‚</p>
<p>Spring Boot è‡ªåŠ¨é…ç½®å¤§å¤§å‡å°‘äº†æ„å»ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ˜¾å¼é…ç½®ï¼ˆæ— è®ºæ˜¯ XML è¿˜æ˜¯ Javaï¼‰çš„æ•°é‡ã€‚</p>
<h2 id="åˆå§‹åŒ–Springåº”ç”¨ç¨‹åº"><a href="#åˆå§‹åŒ–Springåº”ç”¨ç¨‹åº" class="headerlink" title="åˆå§‹åŒ–Springåº”ç”¨ç¨‹åº"></a>åˆå§‹åŒ–Springåº”ç”¨ç¨‹åº</h2><p>ä½¿ç”¨ Springã€Spring Boot ä»¥åŠå„ç§ç›¸å…³çš„åº“å’Œæ¡†æ¶ï¼Œåˆ›å»ºä¸€ä¸ªåœ¨çº¿åº”ç”¨ç¨‹åºã€‚</p>
<p>ä¾é  Spring Initializr æ¥å¼•å¯¼åº”ç”¨ç¨‹åºçš„åˆ›å»ºã€‚Spring Initializr æ—¢æ˜¯ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„ Web åº”ç”¨ç¨‹åºï¼Œåˆæ˜¯ä¸€ä¸ª REST APIï¼Œå®ƒä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªåŸºæœ¬çš„ Spring é¡¹ç›®ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨æ‰€éœ€çš„ä»»ä½•åŠŸèƒ½å……å®è‡ªå·±ã€‚ ä½¿ç”¨ Spring Initializr çš„å‡ ç§æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p>1.ä» Web åº”ç”¨ç¨‹åº <a href="http://start.spring.io/">http://start.spring.io</a> åˆ›å»º<br>2.ä½¿ç”¨ curl å‘½ä»¤ä»å‘½ä»¤è¡Œåˆ›å»º<br>3.ä½¿ç”¨ Spring Boot å‘½ä»¤è¡Œæ¥å£ä»å‘½ä»¤è¡Œåˆ›å»º<br>4.ä½¿ç”¨ Spring Tool Suite åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®çš„æ—¶å€™<br>5.ä½¿ç”¨ IntelliJ IDEA åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®çš„æ—¶å€™<br>6.ä½¿ç”¨ NetBeans åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®çš„æ—¶å€™</p>
<h3 id="ä½¿ç”¨Intellij-IDEAåˆå§‹åŒ–é¡¹ç›®"><a href="#ä½¿ç”¨Intellij-IDEAåˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="ä½¿ç”¨Intellij IDEAåˆå§‹åŒ–é¡¹ç›®"></a>ä½¿ç”¨Intellij IDEAåˆå§‹åŒ–é¡¹ç›®</h3><p>File -&gt; new -&gt; Project -&gt; Spring Initializr -&gt; nextã€‚</p>
<p>typeé€‰Maven Project -&gt; nextã€‚ï¼ˆå’Œmavençš„æ„å»ºè§„èŒƒæœ‰å…³ï¼ŒMaven pom.xmlï¼‰</p>
<p>å±•ç¤ºé¡¹ç›®ä¾èµ–é¡µï¼Œä¾èµ–æ˜¯æŒ‰ç…§åˆ†ç±»æ¥ç»„ç»‡çš„ï¼Œå·²ç»é€‰ä¸­çš„ä¾èµ–å°†ä¼šåœ¨æœ€å³ä¾§ã€‚é€‰æ‹©ä¾èµ–ï¼šdevtoolsã€lombokã€webã€thymeleaf -&gt; nextã€‚</p>
<p>è¾“å…¥é¡¹ç›®åç§°å’Œå­˜æ”¾ä½ç½®ã€‚finish</p>
<p>é¡¹ç›®ä»Initializrä¸‹è½½å¹¶åŠ è½½åˆ°å·¥ä½œç©ºé—´ä¸­ã€‚åŠ è½½å’Œæ„å»ºå®Œæˆï¼Œå°±å¯ä»¥å¼€å‘åº”ç”¨åŠŸèƒ½äº†ã€‚</p>
<h3 id="Springé¡¹ç›®ç›®å½•"><a href="#Springé¡¹ç›®ç›®å½•" class="headerlink" title="Springé¡¹ç›®ç›®å½•"></a>Springé¡¹ç›®ç›®å½•</h3><p>å…¸å‹çš„Mavenæˆ–Gradleé¡¹ç›®ç»“æ„ï¼Œåº”ç”¨æºç åœ¨src&#x2F;main&#x2F;javaä¸­ï¼Œæµ‹è¯•ä»£ç åœ¨src&#x2F;test&#x2F;javaä¸­ï¼Œéjavaèµ„æºåœ¨src&#x2F;main&#x2F;resourcesã€‚</p>
<p><code>mvnw</code> å’Œ <code>mvnw.cmd</code> â€”â€” è¿™äº›æ˜¯ Maven åŒ…è£…å™¨è„šæœ¬ã€‚å³ä½¿ä½ çš„è®¡ç®—æœºä¸Šæ²¡æœ‰å®‰è£… Mavenï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›è„šæœ¬æ„å»ºé¡¹ç›®ã€‚</p>
<p><code>pom.xml</code> â€”â€” è¿™æ˜¯ Maven æ„å»ºè§„èŒƒã€‚</p>
<p><code>TacoCloudApplication.java</code> â€”â€” è¿™æ˜¯å¼•å¯¼é¡¹ç›®çš„ Spring Boot ä¸»ç±»ã€‚ç¨åï¼Œæˆ‘ä»¬å°†åœ¨è¿™èŠ‚è¯¦ç»†ä»‹ç»ã€‚</p>
<p><code>application.properties</code> â€”â€” è¯¥æ–‡ä»¶æœ€åˆä¸ºç©ºï¼Œä½†æä¾›äº†ä¸€ä¸ªå¯ä»¥æŒ‡å®šé…ç½®å±æ€§çš„åœ°æ–¹ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« ä¸­å¯¹æ­¤æ–‡ä»¶è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œä½†åœ¨ç¬¬ 5 ç« ä¸­å°†è¯¦ç»†ä»‹ç»é…ç½®å±æ€§ã€‚</p>
<p><code>static</code> â€”â€” åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ï¼Œå¯ä»¥æ”¾ç½®è¦æä¾›ç»™æµè§ˆå™¨çš„ä»»ä½•é™æ€å†…å®¹ï¼ˆå›¾åƒã€æ ·å¼è¡¨ã€JavaScript ç­‰ï¼‰ï¼Œæœ€åˆä¸ºç©ºã€‚</p>
<p><code>templates</code> â€”â€” åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ï¼Œæ”¾ç½®ç”¨äºå‘æµè§ˆå™¨å‘ˆç°å†…å®¹çš„æ¨¡æ¿æ–‡ä»¶ã€‚æœ€åˆä¸ºç©ºï¼Œä½†å¾ˆå¿«ä¼šæ·»åŠ  Thymeleaf æ¨¡æ¿ã€‚</p>
<p><code>TacoCloudApplicationTests.java</code> â€”â€” è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç±»ï¼Œå¯ç¡®ä¿æˆåŠŸåŠ è½½ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œå°†æ·»åŠ æ›´å¤šçš„æµ‹è¯•ã€‚</p>
<h4 id="æ„å»ºè§„èŒƒpom-xml"><a href="#æ„å»ºè§„èŒƒpom-xml" class="headerlink" title="æ„å»ºè§„èŒƒpom.xml"></a>æ„å»ºè§„èŒƒpom.xml</h4><p>å¡«å†™ Initializr è¡¨å•æ—¶ï¼ŒæŒ‡å®šä½¿ç”¨ Maven æ„å»ºé¡¹ç›®ã€‚å› æ­¤ï¼ŒSpring Initializr ç»™äº†ä¸€ä¸ª pom.xml æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å·²ç»å¡«å……äº†æ‰€åšçš„é€‰æ‹©ã€‚</p>
<p>ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Spring bootæ’ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;excludes&gt;</span><br><span class="line">                    &lt;exclude&gt;</span><br><span class="line">                        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">                        &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">                    &lt;/exclude&gt;</span><br><span class="line">                &lt;/excludes&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;packaging&gt;</code>é€‰æ‹©å°†åº”ç”¨ç¨‹åºæ„å»ºä¸ºå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ WAR æ–‡ä»¶ã€‚æ¯•ç«Ÿï¼Œä¼ ç»Ÿçš„ Java web åº”ç”¨ç¨‹åºè¢«æ‰“åŒ…ä¸º WAR æ–‡ä»¶ï¼Œè€Œ JAR æ–‡ä»¶æ˜¯åº“å’Œå¶å°”ä½¿ç”¨çš„æ¡Œé¢ UI åº”ç”¨ç¨‹åºçš„é¦–é€‰æ‰“åŒ…æ–¹å¼ã€‚è™½ç„¶ WAR æ–‡ä»¶éå¸¸é€‚åˆéƒ¨ç½²åˆ°ä¼ ç»Ÿçš„ Java åº”ç”¨æœåŠ¡å™¨ï¼Œä½†æ˜¯å®ƒä»¬å¹¶ä¸é€‚åˆå¤§å¤šæ•°äº‘å¹³å°ã€‚å°½ç®¡ä¸€äº›äº‘å¹³å°ï¼ˆå¦‚ Cloud Foundryï¼‰èƒ½å¤Ÿéƒ¨ç½²å’Œè¿è¡Œ WAR æ–‡ä»¶ï¼Œä½†æ˜¯æ‰€æœ‰çš„ Java äº‘å¹³å°éƒ½èƒ½å¤Ÿè¿è¡Œå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ã€‚å› æ­¤ï¼ŒSpring Initializr é»˜è®¤ä¸º JAR æ‰“åŒ…ã€‚</p>
<p><code>&lt;parent&gt;</code> å…ƒç´ ï¼ŒæŒ‡å®šé¡¹ç›®å°† <code>spring-boot-starter-parent</code> ä½œä¸ºå®ƒçš„çˆ¶ POMã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ä¸ªçˆ¶ POM è¿˜ä¸º Spring é¡¹ç›®ä¸­å¸¸ç”¨çš„å‡ ä¸ªåº“æä¾›ä¾èµ–é¡¹ç®¡ç†ã€‚å¯¹äºçˆ¶ POM è¦†ç›–çš„é‚£äº›åº“ï¼Œä¸å¿…æŒ‡å®šç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒæ˜¯ä»çˆ¶ POM ç»§æ‰¿çš„ã€‚</p>
<p><code>&lt;dependencies&gt;</code> å…ƒç´ ä¸‹å£°æ˜äº†ä¸‰ä¸ªä¾èµ–é¡¹ã€‚å‰ä¸¤ä¸ªçœ‹èµ·æ¥åº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰ã€‚å®ƒä»¬ç›´æ¥å¯¹åº”äºåœ¨å•å‡» Spring Tool Suite æ–°å»ºé¡¹ç›®å‘å¯¼ä¸­çš„ Finish æŒ‰é’®ä¹‹å‰é€‰æ‹©çš„ Web å’Œ Thymeleaf ä¾èµ–é¡¹ã€‚ç¬¬ä¸‰ä¸ªä¾èµ–é¡¹æä¾›äº†è®¸å¤šæœ‰ç”¨çš„æµ‹è¯•åŠŸèƒ½ï¼Œä½ ä¸å¿…é€‰ä¸­åŒ…å«å®ƒçš„æ–¹æ¡†ï¼Œå› ä¸º Spring Initializr å‡å®šä½ å°†ç¼–å†™æµ‹è¯•ã€‚</p>
<p>Spring Boot starter ä¾èµ–é¡¹çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œå®ƒä»¬æœ¬èº«é€šå¸¸æ²¡æœ‰ä»»ä½•åº“ä»£ç ï¼Œè€Œæ˜¯é—´æ¥åœ°å¼•å…¥å…¶ä»–åº“ã€‚è¿™äº› starter ä¾èµ–æä¾›äº†ä¸‰ä¸ªä¸»è¦çš„å¥½å¤„ï¼š</p>
<ul>
<li>æ„å»ºçš„æ–‡ä»¶å°†ä¼šå°å¾—å¤šï¼Œä¹Ÿæ›´å®¹æ˜“ç®¡ç†ï¼Œå› ä¸ºä¸éœ€è¦å¯¹æ¯ä¸€ä¸ªå¯èƒ½éœ€è¦çš„åº“éƒ½å£°æ˜ä¸€ä¸ªä¾èµ–é¡¹ã€‚</li>
<li>å¯ä»¥æ ¹æ®å®ƒä»¬æä¾›çš„åŠŸèƒ½æ¥è€ƒè™‘éœ€è¦çš„ä¾èµ–å…³ç³»ï¼Œè€Œä¸æ˜¯æ ¹æ®åº“åæ¥è€ƒè™‘ã€‚å¦‚æœæ­£åœ¨å¼€å‘ä¸€ä¸ª web åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆå°†æ·»åŠ  web starter ä¾èµ–é¡¹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç¼–å†™ web åº”ç”¨ç¨‹åºçš„å„ä¸ªåº“çš„æ¸…å•ã€‚</li>
<li>ä¸ç”¨æ‹…å¿ƒ library ç‰ˆæœ¬é—®é¢˜ã€‚å¯ä»¥ç›¸ä¿¡çš„æ˜¯ï¼Œå¯¹äºç»™å®šç‰ˆæœ¬çš„ Spring Bootï¼Œå¯é—´æ¥åœ°å¼•å…¥çš„åº“çš„ç‰ˆæœ¬å°†æ˜¯å…¼å®¹çš„ï¼Œåªéœ€è¦è€ƒè™‘ä½¿ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„ Spring Bootã€‚</li>
</ul>
<p>æœ€åï¼Œæ„å»ºè§„èŒƒä»¥ Spring Boot æ’ä»¶ç»“æŸã€‚è¿™ä¸ªæ’ä»¶æ‰§è¡Œä¸€äº›é‡è¦çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>æä¾›äº†ä¸€ä¸ª Maven ç¼–è¯‘ç›®æ ‡ï¼Œè®©ä½ èƒ½å¤Ÿä½¿ç”¨ Maven è¿è¡Œåº”ç”¨ç¨‹åºã€‚</li>
<li>ç¡®ä¿æ‰€æœ‰çš„ä¾èµ–åº“éƒ½åŒ…å«åœ¨å¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶ç±»è·¯å¾„ä¸­å¯ç”¨ã€‚</li>
<li>åœ¨ JAR æ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ª manifest æ–‡ä»¶ï¼Œå°†å¼•å¯¼ç±»ï¼ˆåœ¨æœ¬ä¹¦ä¾‹å­ä¸­æ˜¯ <code>TacoCloudApplication</code>ï¼‰å£°æ˜ä¸ºå¯æ‰§è¡Œ JAR çš„ä¸»ç±»ã€‚</li>
</ul>
<h4 id="å¼•å¯¼åº”ç”¨TacoCloudApplication"><a href="#å¼•å¯¼åº”ç”¨TacoCloudApplication" class="headerlink" title="å¼•å¯¼åº”ç”¨TacoCloudApplication"></a>å¼•å¯¼åº”ç”¨TacoCloudApplication</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacoCloudApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(TacoCloudApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@SpringBootApplication</code> æ³¨é‡Šæ¸…æ¥šåœ°è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª Spring å¼•å¯¼åº”ç”¨ç¨‹åºã€‚<code>@SpringBootApplication</code> æ˜¯ä¸€ä¸ªç»„åˆäº†å…¶ä»–ä¸‰ä¸ªæ³¨é‡Šçš„å¤åˆåº”ç”¨ç¨‹åºï¼š</p>
<p>ï¼ˆ1ï¼‰<code>@SpringBootConfiguration</code> â€”â€” æŒ‡å®šè¿™ä¸ªç±»ä¸ºé…ç½®ç±»ã€‚å°½ç®¡è¿™ä¸ªç±»ä¸­è¿˜æ²¡æœ‰å¤ªå¤šé…ç½®ï¼Œä½†æ˜¯å¦‚æœéœ€è¦ï¼Œå¯ä»¥å°† Javabased Spring Framework é…ç½®æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªæ³¨é‡Šæ˜¯<code>@Configuration</code> æ³¨é‡Šçš„ä¸€ç§ç‰¹æ®Šå½¢å¼ã€‚</p>
<p>ï¼ˆ2ï¼‰<code>@EnableAutoConfiguration</code> â€”â€” å¯ç”¨ Spring è‡ªåŠ¨é…ç½®ã€‚ç¨åæˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºè‡ªåŠ¨é…ç½®ã€‚ç°åœ¨ï¼Œè¦çŸ¥é“è¿™ä¸ªæ³¨é‡Šå‘Šè¯‰ Spring Boot è‡ªåŠ¨é…ç½®å®ƒè®¤ä¸ºéœ€è¦çš„ä»»ä½•ç»„ä»¶ã€‚</p>
<p>ï¼ˆ3ï¼‰<code>@ComponentScan</code> â€”â€” å¯ç”¨ç»„ä»¶æ‰«æã€‚è¿™å…è®¸ä½ å£°æ˜å…¶ä»–å¸¦æœ‰ <code>@Component</code>ã€<code>@Controller</code>ã€<code>@Service</code> ç­‰æ³¨é‡Šçš„ç±»ï¼Œä»¥ä¾¿è®© Spring è‡ªåŠ¨å‘ç°å®ƒä»¬å¹¶å°†å®ƒä»¬æ³¨å†Œä¸º Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„ç»„ä»¶ã€‚</p>
<p><code>TacoCloudApplication</code> çš„å¦ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯ <code>main()</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°†åœ¨æ‰§è¡Œ JAR æ–‡ä»¶æ—¶è¿è¡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•æ˜¯æ ·æ¿ä»£ç ï¼›ç¼–å†™çš„æ¯ä¸ª Spring å¼•å¯¼åº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªç±»ä¼¼æˆ–ç›¸åŒçš„æ–¹æ³•ï¼ˆå°½ç®¡ç±»åä¸åŒï¼‰ã€‚</p>
<p><code>main()</code> æ–¹æ³•è°ƒç”¨ SpringApplication ç±»ä¸Šçš„é™æ€ <code>run()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ‰§è¡Œåº”ç”¨ç¨‹åºçš„å®é™…å¼•å¯¼ï¼Œåˆ›å»º<code>Spring</code> åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚ä¼ é€’ç»™ <code>run()</code> æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé…ç½®ç±»å’Œå‘½ä»¤è¡Œå‚æ•°ã€‚è™½ç„¶ä¼ é€’ç»™ <code>run()</code> çš„é…ç½®ç±»ä¸å¿…ä¸å¼•å¯¼ç±»ç›¸åŒï¼Œä½†è¿™æ˜¯æœ€æ–¹ä¾¿ã€æœ€å…¸å‹çš„é€‰æ‹©ã€‚</p>
<p>ä½ å¯èƒ½ä¸éœ€è¦æ›´æ”¹å¼•å¯¼ç±»ä¸­çš„ä»»ä½•å†…å®¹ã€‚å¯¹äºç®€å•çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½ä¼šå‘ç°åœ¨å¼•å¯¼ç±»ä¸­é…ç½®ä¸€ä¸¤ä¸ªå…¶ä»–ç»„ä»¶å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºï¼Œæœ€å¥½ä¸ºä»»ä½•æ²¡æœ‰è‡ªåŠ¨é…ç½®çš„ä¸œè¥¿åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é…ç½®ç±»ã€‚</p>
<h4 id="æµ‹è¯•åº”ç”¨TacoCloudApplicationTests"><a href="#æµ‹è¯•åº”ç”¨TacoCloudApplicationTests" class="headerlink" title="æµ‹è¯•åº”ç”¨TacoCloudApplicationTests"></a>æµ‹è¯•åº”ç”¨TacoCloudApplicationTests</h4><p>æµ‹è¯•æ˜¯è½¯ä»¶å¼€å‘çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚è®¤è¯†åˆ°è¿™ä¸€ç‚¹åï¼ŒSpring Initializr æä¾›äº†ä¸€ä¸ªæµ‹è¯•ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacoCloudApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¸­çš„ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ˜¯ç©ºçš„ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™ä¸ªæµ‹è¯•ç±»ç¡®å®æ‰§è¡Œäº†å¿…è¦çš„æ£€æŸ¥ï¼Œä»¥ç¡®ä¿ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡èƒ½å¤ŸæˆåŠŸåŠ è½½ã€‚å¦‚æœåšäº†ä»»ä½•é˜»æ­¢åˆ›å»º Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„æ›´æ”¹ï¼Œåˆ™æ­¤æµ‹è¯•å°†å¤±è´¥ï¼Œè¿™æ ·ä½ å°±å¯ä»¥é€šè¿‡è§£å†³é—®é¢˜æ¥åº”å¯¹ã€‚</p>
<p>è¿˜è¦æ³¨æ„ç”¨ <code>@RunWith(SpringRunner.class)</code> æ³¨é‡Šçš„ç±»ã€‚<code>@RunWith</code> æ˜¯ä¸€ä¸ª JUnit æ³¨é‡Šï¼Œæä¾›äº†ä¸€ä¸ªæµ‹è¯•è¿è¡Œå™¨æ¥å¼•å¯¼ JUnit è¿è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚è¯·å°†æ¸…å• 1.3 çœ‹ä½œæ˜¯å¯¹å®ƒçš„åŸºå‡†åº”ç”¨ç¨‹åºæµ‹è¯•ï¼Œå³å°†æ’ä»¶åº”ç”¨åˆ° JUnit ä»¥æä¾›è‡ªå®šä¹‰æµ‹è¯•è¡Œä¸ºã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒJUnit è¢«èµ‹äºˆäº† SpringRunnerï¼Œè¿™æ˜¯ä¸€ä¸ªç”± Spring æä¾›çš„æµ‹è¯•è¿è¡Œç¨‹åºï¼Œå®ƒæä¾›äº†åˆ›å»ºä¸€ä¸ª Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„åŠŸèƒ½ï¼Œä»¥ä¾›æµ‹è¯•è¿è¡Œã€‚</p>
<p>å°½ç®¡ <code>@RunWith(SpringRunner.class)</code> å’Œ <code>@SpringBootTest</code> çš„ä»»åŠ¡æ˜¯åŠ è½½ç”¨äºæµ‹è¯•çš„ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰ä»»ä½•æµ‹è¯•æ–¹æ³•ï¼Œå®ƒä»¬å°†æ²¡æœ‰ä»»ä½•äº‹æƒ…è¦åšã€‚å³ä½¿æ²¡æœ‰ä»»ä½•æ–­è¨€æˆ–ä»»ä½•ç±»å‹çš„ä»£ç ï¼Œè¿™ä¸ªç©ºçš„æµ‹è¯•æ–¹æ³•ä¹Ÿä¼šè°ƒç”¨ä¸¤ä¸ªæ³¨é‡Šå®Œæˆå®ƒä»¬çš„å·¥ä½œï¼Œå¹¶åŠ è½½ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚å¦‚æœè¿è¡Œè¿‡ç¨‹ä¸­æœ‰ä»»ä½•é—®é¢˜ï¼Œæµ‹è¯•å°±ä¼šå¤±è´¥ã€‚</p>
<h2 id="ç¼–å†™Springåº”ç”¨ç¨‹åº"><a href="#ç¼–å†™Springåº”ç”¨ç¨‹åº" class="headerlink" title="ç¼–å†™Springåº”ç”¨ç¨‹åº"></a>ç¼–å†™Springåº”ç”¨ç¨‹åº</h2><p>æ·»åŠ åˆ° Taco Cloud åº”ç”¨ç¨‹åºçš„ç¬¬ä¸€ä¸ªåŠŸèƒ½æ˜¯ä¸»é¡µï¼Œå½“æ·»åŠ ä¸»é¡µï¼Œå°†åˆ›å»ºä¸¤ä¸ªä»£ç æ„ä»¶ï¼š</p>
<ul>
<li>ä¸€ä¸ªå¤„ç†ä¸»é¡µè¯·æ±‚çš„æ§åˆ¶å™¨ç±»</li>
<li>ä¸€ä¸ªè§†å›¾æ¨¡æ¿ï¼Œå®šä¹‰äº†ä¸»é¡µçš„å¤–è§‚</li>
</ul>
<p>å› ä¸ºæµ‹è¯•å¾ˆé‡è¦ï¼Œæ‰€ä»¥è¿˜å°†ç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç±»æ¥æµ‹è¯•ä¸»é¡µã€‚ä½†é¦–å…ˆâ€¦æ¥å†™è¿™ä¸ªæ§åˆ¶å™¨ã€‚</p>
<h3 id="å¤„ç†webè¯·æ±‚"><a href="#å¤„ç†webè¯·æ±‚" class="headerlink" title="å¤„ç†webè¯·æ±‚"></a>å¤„ç†webè¯·æ±‚</h3><p>Spring é™„å¸¦äº†ä¸€ä¸ªå¼ºå¤§çš„ web æ¡†æ¶ï¼Œç§°ä¸º Spring MVCã€‚Spring MVC çš„æ ¸å¿ƒæ˜¯æ§åˆ¶å™¨çš„æ¦‚å¿µï¼Œè¿™æ˜¯ä¸€ä¸ªå¤„ç†è¯·æ±‚å¹¶ä½¿ç”¨æŸç§ä¿¡æ¯è¿›è¡Œå“åº”çš„ç±»ã€‚å¯¹äºé¢å‘æµè§ˆå™¨çš„åº”ç”¨ç¨‹åºï¼Œæ§åˆ¶å™¨çš„å“åº”æ–¹å¼æ˜¯å¯é€‰åœ°å¡«å……æ¨¡å‹æ•°æ®å¹¶å°†è¯·æ±‚ä¼ é€’ç»™è§†å›¾ï¼Œä»¥ç”Ÿæˆè¿”å›ç»™æµè§ˆå™¨çš„ HTMLã€‚</p>
<p>ç°åœ¨ï¼Œå°†ç¼–å†™ä¸€ä¸ªç®€å•çš„æ§åˆ¶å™¨ç±»æ¥å¤„ç†æ ¹è·¯å¾„çš„è¯·æ±‚ï¼ˆä¾‹å¦‚ <code>/</code>ï¼‰ï¼Œå¹¶å°†è¿™äº›è¯·æ±‚è½¬å‘åˆ°ä¸»é¡µè§†å›¾ï¼Œè€Œä¸å¡«å……ä»»ä½•æ¨¡å‹æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HomeController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">home</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Controller</code> æ³¨é‡Šçš„ä¸»è¦ç›®çš„æ˜¯å°†è¯¥ç±»è¯†åˆ«ä¸ºç»„ä»¶æ‰«æçš„ç»„ä»¶ã€‚ç”±äº <code>HomeController</code> æ˜¯ç”¨ <code>@Controller</code> æ³¨é‡Šçš„ï¼Œå› æ­¤ Spring çš„ç»„ä»¶æ‰«æä¼šè‡ªåŠ¨å‘ç°å®ƒï¼Œå¹¶åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­åˆ›å»ºä¸€ä¸ª <code>HomeController</code> å®ä¾‹ä½œä¸º beanã€‚</p>
<p>å®é™…ä¸Šï¼Œå…¶ä»–ä¸€äº›æ³¨é‡Šï¼ˆåŒ…æ‹¬ <code>@Component</code>ã€<code>@Service</code> å’Œ <code>@Repository</code>ï¼‰çš„ç”¨é€”ä¸ <code>@Controller</code> ç±»ä¼¼ã€‚ä½ å¯ä»¥ç”¨ä»»ä½•å…¶ä»–çš„æ³¨è§£æ¥æœ‰æ•ˆåœ°æ³¨é‡Š <code>HomeController</code>ï¼Œå®ƒä»ç„¶å¯ä»¥å·¥ä½œã€‚ä½†æ˜¯ï¼Œé€‰æ‹© <code>@Controller</code> æ›´èƒ½æè¿°è¯¥ç»„ä»¶åœ¨åº”ç”¨ç¨‹åºä¸­çš„è§’è‰²ã€‚</p>
<p><code>home()</code> æ–¹æ³•ä¸æ§åˆ¶å™¨æ–¹æ³•ä¸€æ ·ç®€å•ã€‚å®ƒä½¿ç”¨ <code>@GetMapping</code> è¿›è¡Œæ³¨é‡Šï¼Œä»¥æŒ‡ç¤ºå¦‚æœæ¥æ”¶åˆ°æ ¹è·¯å¾„ <code>/</code> çš„ HTTP GET è¯·æ±‚ï¼Œåˆ™æ­¤æ–¹æ³•åº”è¯¥å¤„ç†è¯¥è¯·æ±‚ã€‚é™¤äº†è¿”å› <code>home</code> çš„ <code>String</code> å€¼å¤–ï¼Œå®ƒä»€ä¹ˆä¹Ÿä¸åšã€‚æ­¤å€¼è¢«è§£é‡Šä¸ºè§†å›¾çš„é€»è¾‘åç§°ã€‚å¦‚ä½•å®ç°è¯¥è§†å›¾å–å†³äºå‡ ä¸ªå› ç´ ï¼Œä½†æ˜¯å› ä¸º Thymeleaf åœ¨ç±»è·¯å¾„ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Thymeleaf å®šä¹‰è¯¥æ¨¡æ¿ã€‚</p>
<h3 id="Thymeleafæ¨¡æ¿å¼•æ“"><a href="#Thymeleafæ¨¡æ¿å¼•æ“" class="headerlink" title="Thymeleafæ¨¡æ¿å¼•æ“"></a>Thymeleafæ¨¡æ¿å¼•æ“</h3><p>ä¸ºä»€ä¹ˆä¸æ˜¯ JSPï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ FreeMarkerï¼Ÿ</p>
<p>æ¨¡æ¿åç§°ç”±é€»è¾‘è§†å›¾åç§°æ´¾ç”Ÿè€Œæ¥ï¼Œå®ƒçš„å‰ç¼€æ˜¯ &#x2F;templates&#x2F;ï¼Œåç¼€æ˜¯ .htmlã€‚æ¨¡æ¿çš„ç»“æœè·¯å¾„æ˜¯ &#x2F;templates&#x2F;home.htmlã€‚å› æ­¤ï¼Œéœ€è¦å°†æ¨¡æ¿æ”¾åœ¨é¡¹ç›®çš„ &#x2F;src&#x2F;main&#x2F;resources&#x2F;templates&#x2F;home.html ä¸­ã€‚</p>
<p>ä¸ºäº†ä¿æŒä¸»é¡µç®€æ´ï¼Œå®ƒåšçš„åªæ˜¯æ¬¢è¿ç”¨æˆ·è®¿é—®ç½‘ç«™ã€‚ç¨‹åºæ˜¾ç¤ºäº†å®šä¹‰ Taco Cloud ä¸»é¡µçš„åŸºæœ¬ Thymeleaf æ¨¡æ¿ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span><br><span class="line">      xmlns:th=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Taco Cloud&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Welcome to...&lt;/h1&gt;</span><br><span class="line">        &lt;img th:src=<span class="string">&quot;@&#123;/images/TacoCloud.png&#125;&quot;</span>/&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;img&gt;</code> æ ‡è®°ä½¿ç”¨ä¸€ä¸ª Thymeleaf çš„ th:src å±æ€§å’Œä¸€ä¸ª @{â€¦} è¡¨è¾¾å¼å¼•ç”¨å…·æœ‰ä¸Šä¸‹æ–‡ç›¸å¯¹è·¯å¾„çš„å›¾ç‰‡ã€‚è¿™æ„å‘³ç€ Taco Cloud æ ‡å¿—å›¾ç‰‡ä¹Ÿå¿…é¡»é©»ç•™åœ¨é¡¹ç›®çš„ &#x2F;src&#x2F;main&#x2F;resources&#x2F;static&#x2F;images&#x2F;TacoCloud.png ä¸­ã€‚</p>
<h3 id="æµ‹è¯•æ§åˆ¶å™¨"><a href="#æµ‹è¯•æ§åˆ¶å™¨" class="headerlink" title="æµ‹è¯•æ§åˆ¶å™¨"></a>æµ‹è¯•æ§åˆ¶å™¨</h3><p>åœ¨å¯¹ HTML é¡µé¢çš„å†…å®¹è¿›è¡Œæ–­è¨€æ—¶ï¼Œæµ‹è¯• web åº”ç”¨ç¨‹åºå¯èƒ½æ¯”è¾ƒæ£˜æ‰‹ã€‚å¹¸è¿çš„æ˜¯ï¼ŒSpring æä¾›äº†ä¸€äº›å¼ºå¤§çš„æµ‹è¯•æ”¯æŒï¼Œä½¿æµ‹è¯• web åº”ç”¨ç¨‹åºå˜å¾—å¾ˆå®¹æ˜“ã€‚å°±ä¸»é¡µè€Œè¨€ï¼Œå°†ç¼–å†™ä¸€ä¸ªä¸ä¸»é¡µæœ¬èº«å¤æ‚åº¦ç›¸å½“çš„æµ‹è¯•ã€‚ä½ çš„æµ‹è¯•å°†å¯¹æ ¹è·¯å¾„ <code>/</code> æ‰§è¡Œä¸€ä¸ª HTTP GET è¯·æ±‚å¹¶æœŸæœ›å¾—åˆ°ä¸€ä¸ªæˆåŠŸçš„ç»“æœï¼Œå…¶ä¸­è§†å›¾åç§°ä¸º homeï¼Œç»“æœå†…å®¹åŒ…å«çŸ­è¯­ â€œWelcome toâ€¦â€ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.containsString;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.view;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@WebMvcTest(HomeController.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HomeControllerTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHomePage</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">            .andExpect(status().isOk())</span><br><span class="line">            .andExpect(view().name(<span class="string">&quot;home&quot;</span>))</span><br><span class="line">            .andExpect(content().string(containsString(<span class="string">&quot;Welcome to...&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>HomeControllerTest</code> ä½¿ç”¨ <code>@WebMvcTest</code> æ³¨é‡Šï¼Œè€Œä¸æ˜¯ <code>@SpringBootTest</code> æ ‡è®°ã€‚è¿™æ˜¯ Spring Boot æä¾›çš„ä¸€ä¸ªç‰¹æ®Šæµ‹è¯•æ³¨é‡Šï¼Œå®ƒå®‰æ’æµ‹è¯•åœ¨ Spring MVC åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚æ›´å…·ä½“åœ°è¯´ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒå®‰æ’ <code>HomeController</code> åœ¨ Spring MVC ä¸­æ³¨å†Œï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¯¹å®ƒè¿›è¡Œè¯·æ±‚ã€‚</p>
<p><code>@WebMvcTest</code> è¿˜ä¸ºæµ‹è¯• Spring MVC æä¾›äº† Spring æ”¯æŒã€‚è™½ç„¶å¯ä»¥è®©å®ƒå¯åŠ¨æœåŠ¡å™¨ï¼Œä½†æ¨¡æ‹Ÿ Spring MVC çš„æœºåˆ¶å°±è¶³ä»¥æ»¡è¶³ä½ çš„ç›®çš„äº†ã€‚æµ‹è¯•ç±»è¢«æ³¨å…¥äº†ä¸€ä¸ª <code>MockMvc</code> å¯¹è±¡ä¸­ï¼Œä»¥æ­¤ç”¨æ¥æµ‹è¯•æ¥é©±åŠ¨æ¨¡å‹ã€‚</p>
<p><code>testHomePage()</code> æ–¹æ³•å®šä¹‰äº†è¦å¯¹ä¸»é¡µæ‰§è¡Œçš„æµ‹è¯•ã€‚å®ƒä» <code>MockMvc</code> å¯¹è±¡å¼€å§‹ï¼Œæ‰§è¡Œé’ˆå¯¹ <code>/</code>ï¼ˆæ ¹è·¯å¾„ï¼‰çš„ HTTP GET è¯·æ±‚ã€‚è¯¥è¯·æ±‚è§„å®šäº†ä¸‹åˆ—æœŸæœ›å€¼ï¼š</p>
<ul>
<li>å“åº”åº”è¯¥æœ‰ä¸€ä¸ªHTTP 200ï¼ˆOKï¼‰çŠ¶æ€ã€‚</li>
<li>è§†å›¾åº”è¯¥æœ‰ä¸€ä¸ªåˆç†çš„ä¸»é¡µåç§°ã€‚</li>
<li>å‘ˆç°çš„è§†å›¾åº”è¯¥åŒ…å« â€œWelcome toâ€¦â€</li>
</ul>
<p>å¦‚æœåœ¨ <code>MockMvc</code> å¯¹è±¡æ‰§è¡Œè¯·æ±‚ä¹‹åï¼Œè¿™äº›æœŸæœ›ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½æ²¡æœ‰æ»¡è¶³ï¼Œé‚£ä¹ˆæµ‹è¯•å°±ä¼šå¤±è´¥ã€‚ä½†æ˜¯æ§åˆ¶å™¨å’Œè§†å›¾æ¨¡æ¿æ˜¯ä¸ºäº†æ»¡è¶³è¿™äº›æœŸæœ›è€Œç¼–å†™çš„ï¼Œæ‰€ä»¥æµ‹è¯•åº”è¯¥èƒ½å¤Ÿé€šè¿‡ï¼Œæˆ–è€…è‡³å°‘èƒ½å¤Ÿé€šè¿‡ä¸€äº›è¡¨ç¤ºæµ‹è¯•é€šè¿‡çš„ç»¿è‰²æç¤ºã€‚</p>
<p>æ§åˆ¶å™¨å†™å¥½äº†ï¼Œè§†å›¾æ¨¡æ¿åˆ›å»ºå¥½äº†ï¼Œæµ‹è¯•é€šè¿‡äº†ã€‚çœ‹æ¥ä½ å·²ç»æˆåŠŸåœ°å®ç°äº†ä¸»é¡µã€‚</p>
<h3 id="æ„å»ºå¹¶è¿è¡Œåº”ç”¨"><a href="#æ„å»ºå¹¶è¿è¡Œåº”ç”¨" class="headerlink" title="æ„å»ºå¹¶è¿è¡Œåº”ç”¨"></a>æ„å»ºå¹¶è¿è¡Œåº”ç”¨</h3><p>Spring Boot Dashboard çš„ä¾¿åˆ©åŠŸèƒ½å¯ä»¥å¸®åŠ©ä½ åœ¨ IDE ä¸­è¿è¡Œåº”ç”¨ç¨‹åºã€‚<strong>Spring Boot Dashboard</strong> ï¼ˆæŒ‡ç¤ºæ¿ï¼Œä»ªè¡¨ç›˜ï¼‰æ˜¾ç¤ºä¸ºä¸€ä¸ªé€‰é¡¹å¡ï¼Œé€šå¸¸ä½äº IDE çª—å£çš„å·¦ä¸‹æ–¹ã€‚</p>
<blockquote>
<p>å¦‚ä½•åœ¨ideaä¸­å¯åŠ¨Spring Boot Dashboardï¼š<a href="https://jingyan.baidu.com/article/ce4366495a1df73773afd3d3.html">https://jingyan.baidu.com/article/ce4366495a1df73773afd3d3.html</a></p>
</blockquote>
<p>å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œå°†åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä¸€äº› Spring ASCII å›¾é£è¿‡ï¼Œç„¶åçœ‹åˆ°ä¸€äº›æ—¥å¿—æ¡ç›®æè¿°åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„æ­¥éª¤ã€‚åœ¨åœæ­¢æ—¥å¿—è®°å½•ä¹‹å‰ï¼Œå°†çœ‹åˆ°ä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼Œå…¶ä¸­è¯´ Tomcat åœ¨ port(s): 8080 (http) ä¸Šå¯åŠ¨ï¼Œè¿™æ„å‘³ç€å·²ç»å‡†å¤‡å¥½å°† web æµè§ˆå™¨æŒ‡å‘ä¸»é¡µï¼Œä»¥æŸ¥çœ‹ç»“æœã€‚</p>
<p>ç­‰ä¸€ä¸‹ï¼ŒTomcat å¯åŠ¨ï¼Ÿä½•æ—¶å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Tomcatï¼Ÿ</p>
<p>Spring Boot åº”ç”¨ç¨‹åºå€¾å‘äºè£¹æŒŸæ‰€æœ‰éœ€è¦çš„ä¸œè¥¿ï¼Œè€Œä¸éœ€è¦éƒ¨ç½²åˆ°æŸä¸ªåº”ç”¨æœåŠ¡å™¨ã€‚ä½ ä»æœªå°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Tomcatâ€¦ å…¶å® Tomcat æ˜¯åº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼(å°†åœ¨ 1.3.6 å°èŠ‚ä¸­è¯¦ç»†æè¿° Tomcat å¦‚ä½•æˆä¸ºåº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†çš„ã€‚)</p>
<p>ç°åœ¨åº”ç”¨ç¨‹åºå·²ç»å¯åŠ¨ï¼Œå°† web æµè§ˆå™¨æŒ‡å‘ <a href="http://localhost:8080/">http://localhost:8080</a>ï¼ˆæˆ–å•å‡» Spring Boot Dashboard ä¸­åœ°çƒä»ªæ ·å­çš„æŒ‰é’®)ã€‚</p>
<p>åŒä¸€å…±æœ‰ç½‘ä¸‹ï¼Œå¯ä»¥é€šè¿‡ipè®¿é—®åˆ°ã€‚<code>ifconfig en0</code></p>
<h3 id="Spring-Boot-DevTools"><a href="#Spring-Boot-DevTools" class="headerlink" title="Spring Boot DevTools"></a>Spring Boot DevTools</h3><p>åœ¨åˆå§‹åŒ–é¡¹ç›®æ—¶å°†å…¶ä½œä¸ºä¾èµ–é¡¹è¿›è¡Œé€‰æ‹©ã€‚Spring Boot DevToolsä½œä¸ºä¸€ä¸ªä¾èµ–é¡¹å‡ºç°åœ¨ç”Ÿæˆçš„ pom.xml æ–‡ä»¶ä¸­ã€‚Spring Boot Dashboard ç”šè‡³æ˜¾ç¤ºé¡¹ç›®å·²ç»å¯ç”¨äº† DevToolsã€‚ä½†æ˜¯ä»€ä¹ˆæ˜¯ DevToolsï¼Œå®ƒèƒ½ä¸ºæ‚¨åšä»€ä¹ˆï¼Ÿ</p>
<p>DevTools ä¸º Spring å¼€å‘äººå‘˜æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„å¼€å‘åŒæ­¥å·¥å…·ã€‚è¿™äº›æ˜¯ï¼š</p>
<ul>
<li>å½“ä»£ç æ›´æ”¹æ—¶è‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åº</li>
<li>å½“ä»¥æµè§ˆå™¨ä¸ºç›®æ ‡çš„èµ„æºï¼ˆå¦‚æ¨¡æ¿ã€JavaScriptã€æ ·å¼è¡¨ç­‰ï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ·æ–°</li>
<li>è‡ªåŠ¨ç¦ç”¨æ¨¡æ¿ç¼“å­˜</li>
<li>å¦‚æœ H2 æ•°æ®åº“æ­£åœ¨ä½¿ç”¨ï¼Œåˆ™åœ¨ H2 æ§åˆ¶å°ä¸­æ„å»º</li>
</ul>
<p>ï¼ˆ1ï¼‰è‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åº</p>
<p>ï¼ˆ2ï¼‰è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨å’Œç¦ç”¨æ¨¡æ¿ç¼“å­˜</p>
<p>ï¼ˆ3ï¼‰å†…ç½®çš„H2æ§åˆ¶å°</p>
<h3 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h3><p>ä»¥ä¸‹æ˜¯æ„å»ºåŸºäº Spring çš„ Taco Cloud åº”ç”¨ç¨‹åºçš„æ­¥éª¤ï¼š</p>
<ol>
<li>ä½¿ç”¨ Spring Initializr åˆ›å»ºäº†ä¸€ä¸ªåˆå§‹é¡¹ç›®ç»“æ„ã€‚</li>
<li>å†™äº†ä¸€ä¸ªæ§åˆ¶å™¨ç±»æ¥å¤„ç†ä¸»é¡µè¯·æ±‚ã€‚</li>
<li>å®šä¹‰äº†ä¸€ä¸ªè§†å›¾æ¨¡æ¿æ¥å‘ˆç°ä¸»é¡µã€‚</li>
<li>å†™äº†ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç±»æ¥æ£€éªŒä¸Šè¯‰å·¥ä½œã€‚</li>
</ol>
<p>æ§åˆ¶å™¨ç±»ä¸­çš„ä¸¤è¡Œä»£ç ï¼Œè€Œè§†å›¾æ¨¡æ¿ä¸­æ²¡æœ‰ Spring çš„ç‰¹å®šä»£ç ã€‚å°½ç®¡æµ‹è¯•ç±»çš„å¤§éƒ¨åˆ†éƒ½ä½¿ç”¨äº† Spring çš„æµ‹è¯•æ”¯æŒï¼Œä½†æ˜¯åœ¨æµ‹è¯•ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒçš„ä¾µå…¥æ€§ä¼¼ä¹è¦å°ä¸€äº›ã€‚</p>
<p>è¿™æ˜¯ä½¿ç”¨ Spring å¼€å‘çš„ä¸€ä¸ªé‡è¦å¥½å¤„ã€‚å¯ä»¥å…³æ³¨äºæ»¡è¶³åº”ç”¨ç¨‹åºéœ€æ±‚çš„ä»£ç ï¼Œè€Œä¸æ˜¯æ»¡è¶³æ¡†æ¶çš„éœ€æ±‚ã€‚å°½ç®¡ç¡®å®éœ€è¦ä¸æ—¶åœ°ç¼–å†™ä¸€äº›ç‰¹å®šäºæ¡†æ¶çš„ä»£ç ï¼Œä½†è¿™é€šå¸¸åªæ˜¯ä»£ç åº“çš„ä¸€å°éƒ¨åˆ†ã€‚å¦‚å‰æ‰€è¿°ï¼ŒSpring ï¼ˆä»¥åŠ Spring Bootï¼‰å¯ä»¥è¢«è®¤ä¸ºæ˜¯ <em>æ— æ¡†æ¶çš„æ¡†æ¶</em>ã€‚</p>
<p>è¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ï¼ŸSpring åœ¨å¹•ååšäº†ä»€ä¹ˆæ¥ç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºéœ€æ±‚å¾—åˆ°æ»¡è¶³ï¼Ÿä¸ºäº†ç†è§£ Spring åœ¨åšä»€ä¹ˆï¼Œè®©æˆ‘ä»¬ä»æ„å»ºè§„èŒƒå¼€å§‹ã€‚</p>
<p>åœ¨ pom.xml æ–‡ä»¶ä¸­ï¼Œå£°æ˜äº†å¯¹ Web å’Œ Thymeleaf å¯åŠ¨å™¨çš„ä¾èµ–ã€‚è¿™ä¸¤ä¸ªä¾èµ–å…³ç³»å¸¦æ¥äº†ä¸€äº›å…¶ä»–çš„ä¾èµ–å…³ç³»ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>Spring MVC æ¡†æ¶</li>
<li>åµŒå…¥å¼ Tomcat</li>
<li>Thymeleaf å’Œ Thymeleaf å¸ƒå±€æ–¹è¨€</li>
</ul>
<p>å®ƒè¿˜å¸¦æ¥äº† Spring Boot çš„è‡ªåŠ¨é…ç½®åº“ã€‚å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring Boot è‡ªåŠ¨é…ç½®è‡ªåŠ¨æ£€æµ‹è¿™äº›åº“å¹¶è‡ªåŠ¨æ‰§è¡Œï¼š</p>
<ul>
<li>åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­é…ç½® bean ä»¥å¯ç”¨ Spring MVC</li>
<li>å°†åµŒå…¥å¼ Tomcat æœåŠ¡å™¨é…ç½®åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­</li>
<li>ä¸ºä½¿ç”¨ Thymeleaf æ¨¡æ¿å‘ˆç° Spring MV Cè§†å›¾ï¼Œé…ç½®äº†ä¸€ä¸ª Thymeleaf è§†å›¾è§£æå™¨</li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼Œè‡ªåŠ¨é…ç½®å®Œæˆäº†æ‰€æœ‰ç¹é‡çš„å·¥ä½œï¼Œè®©ä½ ä¸“æ³¨äºç¼–å†™å®ç°åº”ç”¨ç¨‹åºåŠŸèƒ½çš„ä»£ç ã€‚</p>
<h2 id="ä¿¯ç°Springé£æ™¯çº¿"><a href="#ä¿¯ç°Springé£æ™¯çº¿" class="headerlink" title="ä¿¯ç°Springé£æ™¯çº¿"></a>ä¿¯ç°Springé£æ™¯çº¿</h2><p>Spring Initializr Webè¡¨å•é‡Œæä¾›äº†100å¤šä¸ªå¯é€‰çš„ä¾èµ–é¡¹ã€‚</p>
<h3 id="Springæ ¸å¿ƒæ¡†æ¶"><a href="#Springæ ¸å¿ƒæ¡†æ¶" class="headerlink" title="Springæ ¸å¿ƒæ¡†æ¶"></a>Springæ ¸å¿ƒæ¡†æ¶</h3><p>Spring æ ¸å¿ƒæ¡†æ¶æ˜¯ Spring é¢†åŸŸä¸­å…¶ä»–ä¸€åˆ‡çš„åŸºç¡€ã€‚å®ƒæä¾›äº†æ ¸å¿ƒå®¹å™¨å’Œä¾èµ–æ³¨å…¥æ¡†æ¶ã€‚ä½†å®ƒä¹Ÿæä¾›äº†ä¸€äº›å…¶ä»–çš„åŸºæœ¬ç‰¹æ€§ã€‚</p>
<p>å…¶ä¸­åŒ…æ‹¬ Spring MVC å’Œ Spring web æ¡†æ¶ã€‚å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨ Spring MVC ç¼–å†™æ§åˆ¶å™¨ç±»æ¥å¤„ç† web è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œè¿˜æ²¡æœ‰çœ‹åˆ°çš„æ˜¯ï¼ŒSpring MVC ä¹Ÿå¯ä»¥ç”¨äºåˆ›å»ºäº§ç”Ÿé HTML è¾“å‡ºçš„ REST APIã€‚å°†åœ¨ç¬¬ 2 ç« æ·±å…¥ç ”ç©¶ Spring MVCï¼Œç„¶ååœ¨ç¬¬ 6 ç« ä¸­è®¨è®ºå¦‚ä½•ä½¿ç”¨å®ƒæ¥åˆ›å»º REST APIã€‚</p>
<p>Spring æ ¸å¿ƒæ¡†æ¶è¿˜æä¾›äº†ä¸€äº›åŸºæœ¬æ•°æ®æŒä¹…æ€§æ”¯æŒï¼Œç‰¹åˆ«æ˜¯åŸºäºæ¨¡æ¿çš„ JDBC æ”¯æŒã€‚å°†åœ¨ç¬¬ 3 ç« ä¸­çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ JdbcTemplateã€‚</p>
<p>åœ¨ Spring çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆ5.0.8ï¼‰ä¸­ï¼Œæ·»åŠ äº†å¯¹å“åº”å¼ç¼–ç¨‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬ä¸€ä¸ªæ–°çš„å“åº”å¼ web æ¡†æ¶ â€”â€” Spring WebFluxï¼Œå®ƒå¤§é‡å€Ÿé‰´äº† Spring MVCã€‚å°†åœ¨ç¬¬ 3 éƒ¨åˆ†ä¸­çœ‹åˆ° Spring çš„å“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œå¹¶åœ¨ç¬¬ 10 ç« ä¸­çœ‹åˆ° Spring WebFluxã€‚</p>
<h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><p>å·²ç»çœ‹åˆ°äº† Spring Boot çš„è®¸å¤šå¥½å¤„ï¼ŒåŒ…æ‹¬å¯åŠ¨ä¾èµ–é¡¹å’Œè‡ªåŠ¨é…ç½®ã€‚åœ¨æœ¬ä¹¦ä¸­æˆ‘ä»¬ç¡®å®ä¼šå°½å¯èƒ½å¤šåœ°ä½¿ç”¨ Spring Bootï¼Œå¹¶é¿å…ä»»ä½•å½¢å¼çš„æ˜¾å¼é…ç½®ï¼Œé™¤éç»å¯¹å¿…è¦ã€‚ä½†é™¤äº†å¯åŠ¨ä¾èµ–å’Œè‡ªåŠ¨é…ç½®ï¼ŒSpring Boot è¿˜æä¾›äº†ä¸€äº›å…¶ä»–æœ‰ç”¨çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>Actuator æä¾›äº†å¯¹åº”ç”¨ç¨‹åºå†…éƒ¨å·¥ä½œæ–¹å¼çš„è¿è¡Œæ—¶ç›‘æ§ï¼ŒåŒ…æ‹¬ç«¯ç‚¹ã€çº¿ç¨‹ dump ä¿¡æ¯ã€åº”ç”¨ç¨‹åºå¥åº·çŠ¶å†µå’Œåº”ç”¨ç¨‹åºå¯ç”¨çš„ç¯å¢ƒå±æ€§ã€‚</li>
<li>çµæ´»çš„ç¯å¢ƒå±æ€§è§„èŒƒã€‚</li>
<li>åœ¨æ ¸å¿ƒæ¡†æ¶çš„æµ‹è¯•è¾…åŠ©ä¹‹å¤–ï¼Œè¿˜æœ‰é¢å¤–çš„æµ‹è¯•æ”¯æŒã€‚</li>
</ul>
<p>æ­¤å¤–ï¼ŒSpring Boot æä¾›äº†ä¸€ç§åŸºäº Groovy è„šæœ¬çš„æ›¿ä»£ç¼–ç¨‹æ¨¡å‹ï¼Œç§°ä¸º Spring Boot CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰ã€‚ä½¿ç”¨ Spring Boot CLIï¼Œå¯ä»¥å°†æ•´ä¸ªåº”ç”¨ç¨‹åºç¼–å†™ä¸º Groovy è„šæœ¬çš„é›†åˆï¼Œå¹¶ä»å‘½ä»¤è¡Œè¿è¡Œå®ƒä»¬ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨ Spring Boot CLI ä¸ŠèŠ±å¤ªå¤šæ—¶é—´ï¼Œä½†æ˜¯å½“å®ƒé€‚åˆæˆ‘ä»¬çš„éœ€è¦æ—¶ï¼Œæˆ‘ä»¬ä¼šæ¥è§¦å®ƒã€‚</p>
<p>Spring Boot å·²ç»æˆä¸º Spring å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼›æˆ‘æ— æ³•æƒ³è±¡å¼€å‘ä¸€ä¸ªæ²¡æœ‰å®ƒçš„ Spring åº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œæœ¬ä¹¦é‡‡ç”¨äº†ä»¥ Spring Boot ä¸ºä¸­å¿ƒçš„è§‚ç‚¹ï¼Œå½“æˆ‘æåˆ° Spring Boot æ­£åœ¨åšçš„äº‹æƒ…æ—¶ï¼Œä½ å¯èƒ½ä¼šå‘ç°æˆ‘åœ¨ä½¿ç”¨ Spring è¿™ä¸ªè¯ã€‚</p>
<h3 id="Spring-Data"><a href="#Spring-Data" class="headerlink" title="Spring Data"></a>Spring Data</h3><p>å°½ç®¡ Spring æ ¸å¿ƒæ¡†æ¶æä¾›äº†åŸºæœ¬çš„æ•°æ®æŒä¹…æ€§æ”¯æŒï¼Œä½† Spring Data æä¾›äº†ä¸€äº›éå¸¸æƒŠäººçš„åŠŸèƒ½ï¼šå°†åº”ç”¨ç¨‹åºçš„æ•°æ®å­˜å‚¨åº“æŠ½è±¡ä¸ºç®€å•çš„ Java æ¥å£ï¼ŒåŒæ—¶å½“å®šä¹‰æ–¹æ³•ç”¨äºå¦‚ä½•é©±åŠ¨æ•°æ®è¿›è¡Œå­˜å‚¨å’Œæ£€ç´¢çš„é—®é¢˜æ—¶ï¼Œå¯¹æ–¹æ³•ä½¿ç”¨äº†å‘½åçº¦å®šã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼ŒSpring Data èƒ½å¤Ÿå¤„ç†å‡ ç§ä¸åŒç±»å‹çš„æ•°æ®åº“ï¼ŒåŒ…æ‹¬å…³ç³»å‹ï¼ˆJPAï¼‰ã€æ–‡æ¡£å‹ï¼ˆMongoï¼‰ã€å›¾å‹ï¼ˆNeo4jï¼‰ç­‰ã€‚åœ¨ç¬¬ 3 ç« ä¸­ï¼Œå°†ä½¿ç”¨ Spring Data æ¥å¸®åŠ©åˆ›å»º Taco Cloud åº”ç”¨ç¨‹åºçš„å­˜å‚¨åº“ã€‚</p>
<h3 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h3><p>åº”ç”¨ç¨‹åºå®‰å…¨æ€§ä¸€ç›´æ˜¯ä¸€ä¸ªé‡è¦çš„ä¸»é¢˜ï¼Œè€Œä¸”ä¼¼ä¹ä¸€å¤©æ¯”ä¸€å¤©é‡è¦ã€‚å¹¸è¿çš„æ˜¯ï¼ŒSpring åœ¨ Spring security ä¸­æœ‰ä¸€ä¸ªå¥å£®çš„å®‰å…¨æ¡†æ¶ã€‚</p>
<p>Spring Security è§£å†³äº†å¹¿æ³›çš„åº”ç”¨ç¨‹åºå®‰å…¨æ€§éœ€æ±‚ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯ã€æˆæƒå’Œ API å®‰å…¨æ€§ã€‚å°½ç®¡ Spring Security çš„èŒƒå›´å¤ªå¤§ï¼Œæœ¬ä¹¦æ— æ³•æ°å½“åœ°æ¶µç›–ï¼Œä½†æˆ‘ä»¬å°†åœ¨ç¬¬ 4 ç« å’Œç¬¬ 12 ç« ä¸­è®¨è®ºä¸€äº›æœ€å¸¸è§çš„ç”¨ä¾‹ã€‚</p>
<h3 id="Spring-Integration-å’Œ-Spring-Batch"><a href="#Spring-Integration-å’Œ-Spring-Batch" class="headerlink" title="Spring Integration å’Œ Spring Batch"></a>Spring Integration å’Œ Spring Batch</h3><p>åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºå°†éœ€è¦ä¸å…¶ä»–åº”ç”¨ç¨‹åºé›†æˆï¼Œç”šè‡³éœ€è¦ä¸åŒä¸€åº”ç”¨ç¨‹åºçš„å…¶ä»–ç»„ä»¶é›†æˆã€‚ä¸ºäº†æ»¡è¶³è¿™äº›éœ€æ±‚ï¼Œå‡ºç°äº†å‡ ç§åº”ç”¨ç¨‹åºé›†æˆæ¨¡å¼ã€‚Spring Integration å’Œ Spring Batch ä¸ºåŸºäº Spring çš„åº”ç”¨ç¨‹åºæä¾›äº†è¿™äº›æ¨¡å¼çš„å®ç°ã€‚</p>
<p>Spring Integration è§£å†³äº†å®æ—¶é›†æˆï¼Œå³æ•°æ®åœ¨å¯ç”¨æ—¶è¿›è¡Œå¤„ç†ã€‚ç›¸åï¼ŒSpring Batch è§£å†³äº†æ‰¹é‡é›†æˆçš„é—®é¢˜ï¼Œå…è®¸åœ¨ä¸€æ®µæ—¶é—´å†…æ”¶é›†æ•°æ®ï¼Œç›´åˆ°æŸä¸ªè§¦å‘å™¨ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªæ—¶é—´è§¦å‘å™¨ï¼‰å‘å‡ºä¿¡å·ï¼Œè¡¨ç¤ºè¯¥å¤„ç†ä¸€æ‰¹æ•°æ®äº†ã€‚å°†åœ¨ç¬¬ 9 ç« ä¸­ç ”ç©¶ Spring Batch å’Œ Spring Integrationã€‚</p>
<h3 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h3><p>åœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºå¼€å‘é¢†åŸŸæ­£åœ¨è¿›å…¥ä¸€ä¸ªæ–°æ—¶ä»£ï¼Œåœ¨è¿™ä¸ªæ—¶ä»£ä¸­ï¼Œæˆ‘ä»¬ä¸å†å°†åº”ç”¨ç¨‹åºä½œä¸ºå•ä¸ªéƒ¨ç½²å•å…ƒæ¥å¼€å‘ï¼Œè€Œæ˜¯å°†ç”±å‡ ä¸ªç§°ä¸º <em>å¾®æœåŠ¡</em> çš„å•ä¸ªéƒ¨ç½²å•å…ƒç»„æˆåº”ç”¨ç¨‹åºã€‚</p>
<p>å¾®æœåŠ¡æ˜¯ä¸€ä¸ªçƒ­é—¨è¯é¢˜ï¼Œè§£å†³äº†å‡ ä¸ªå®é™…çš„å¼€å‘å’Œè¿è¡Œæ—¶é—®é¢˜ã€‚ç„¶è€Œï¼Œåœ¨è¿™æ ·åšçš„åŒæ—¶ï¼Œä»–ä»¬ä¹Ÿå¸¦æ¥äº†è‡ªå·±çš„æŒ‘æˆ˜ã€‚è¿™äº›æŒ‘æˆ˜éƒ½å°†ç”± Spring Cloud ç›´æ¥é¢å¯¹ï¼ŒSpring Cloud æ˜¯ä¸€ç»„ç”¨ Spring å¼€å‘äº‘æœ¬åœ°åº”ç”¨ç¨‹åºçš„é¡¹ç›®ã€‚</p>
<p>Spring Cloud è¦†ç›–äº†å¾ˆå¤šåœ°æ–¹ï¼Œè¿™æœ¬ä¹¦ä¸å¯èƒ½æ¶µç›–æ‰€æœ‰çš„åœ°æ–¹ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬ 13ã€14 å’Œ 15 ç« ä¸­æŸ¥çœ‹ Spring Cloud çš„ä¸€äº›æœ€å¸¸è§çš„ç»„ä»¶ã€‚å…³äº Spring Cloud çš„æ›´å®Œæ•´çš„è®¨è®ºï¼Œæˆ‘å»ºè®®çœ‹çœ‹ John Carnell çš„ Spring Microservices in Actionï¼ˆManning, 2017, <a href="http://www.manning.com/books/spring-microservices-in-action%EF%BC%89%E3%80%82">www.manning.com/books/spring-microservices-in-actionï¼‰ã€‚</a></p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ul>
<li><p>Spring çš„ç›®æ ‡æ˜¯è®©å¼€å‘äººå‘˜è½»æ¾åº”å¯¹æŒ‘æˆ˜ï¼Œæ¯”å¦‚åˆ›å»º web åº”ç”¨ç¨‹åºã€ä½¿ç”¨æ•°æ®åº“ã€ä¿æŠ¤åº”ç”¨ç¨‹åºå’Œä½¿ç”¨å¾®æœåŠ¡ã€‚</p>
</li>
<li><p>Spring Boot æ„å»ºåœ¨ Spring ä¹‹ä¸Šï¼Œç®€åŒ–äº†ä¾èµ–ç®¡ç†ã€è‡ªåŠ¨é…ç½®å’Œè¿è¡Œæ—¶ç›‘æ§ï¼Œè®© Spring å˜å¾—æ›´åŠ ç®€å•ã€‚</p>
</li>
<li><p>Spring åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ Spring Initializr è¿›è¡Œåˆå§‹åŒ–ï¼Œå®ƒæ˜¯åŸºäº web çš„ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•° Java å¼€å‘ç¯å¢ƒä¸­éƒ½æ”¯æŒå®ƒã€‚</p>
</li>
<li><p>åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ï¼Œç»„ä»¶ï¼ˆé€šå¸¸ç§°ä¸º beanï¼‰å¯ä»¥ç”¨ Java æˆ– XML æ˜¾å¼åœ°å£°æ˜ï¼Œå¯ä»¥é€šè¿‡ç»„ä»¶æ‰«æè¿›è¡Œå‘ç°ï¼Œä¹Ÿå¯ä»¥ç”¨ Spring Boot è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚</p>
</li>
</ul>
<h1 id="ç¬¬äºŒç« -å¼€å‘Webåº”ç”¨"><a href="#ç¬¬äºŒç« -å¼€å‘Webåº”ç”¨" class="headerlink" title="ç¬¬äºŒç«  å¼€å‘Webåº”ç”¨"></a>ç¬¬äºŒç«  å¼€å‘Webåº”ç”¨</h1><p>ä½¿ç”¨ Spring æ„å»ºçš„åº”ç”¨ç¨‹åºå°†æ‰§è¡Œå„ç§æ“ä½œï¼ŒåŒ…æ‹¬å¤„ç†æ•°æ®ã€ä»æ•°æ®åº“ä¸­è¯»å–ä¿¡æ¯ä»¥åŠä¸å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚ä½†æ˜¯åº”ç”¨ç¨‹åºç”¨æˆ·å¾—åˆ°çš„ç¬¬ä¸€å°è±¡æ¥è‡ªäºç”¨æˆ·ç•Œé¢ã€‚åœ¨è®¸å¤šåº”ç”¨ç¨‹åºä¸­ï¼ŒUI ç•Œé¢æ˜¯åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºçš„ web åº”ç”¨ç¨‹åºã€‚</p>
<p>åœ¨ç¬¬ 1 ç« ä¸­ï¼Œåˆ›å»ºäº†ç¬¬ä¸€ä¸ª Spring MVC æ§åˆ¶å™¨æ¥æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸»é¡µã€‚ä½†æ˜¯ Spring MVC èƒ½åšçš„è¿œä¸æ­¢ç®€å•åœ°æ˜¾ç¤ºé™æ€å†…å®¹ã€‚åœ¨æœ¬ç« ä¸­ï¼Œå°†å¼€å‘ Taco Cloud åº”ç”¨ç¨‹åºçš„ç¬¬ä¸€ä¸ªä¸»è¦åŠŸèƒ½ â€”â€” è®¾è®¡è‡ªå®šä¹‰ Taco çš„èƒ½åŠ›ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå°†æ·±å…¥ç ”ç©¶ Spring MVCï¼Œå¹¶äº†è§£å¦‚ä½•æ˜¾ç¤ºæ¨¡å‹æ•°æ®å’Œå¤„ç†è¡¨å•è¾“å…¥ã€‚</p>
<h2 id="å±•ç¤ºä¿¡æ¯"><a href="#å±•ç¤ºä¿¡æ¯" class="headerlink" title="å±•ç¤ºä¿¡æ¯"></a>å±•ç¤ºä¿¡æ¯</h2><p>åœ¨ Spring web åº”ç”¨ç¨‹åºä¸­ï¼Œè·å–å’Œå¤„ç†æ•°æ®æ˜¯æ§åˆ¶å™¨çš„å·¥ä½œã€‚è§†å›¾çš„å·¥ä½œæ˜¯å°†æ•°æ®æ¸²æŸ“æˆ HTML å¹¶æ˜¾ç¤ºåœ¨æµè§ˆå™¨ä¸­ã€‚å°†åˆ›å»ºä»¥ä¸‹ç»„ä»¶æ¥æ”¯æŒ Taco åˆ›å»ºé¡µé¢ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥è‡ªé€‰é…æ–™ï¼š</p>
<ul>
<li>ä¸€ä¸ªå®šä¹‰ç‰ç±³å·æˆåˆ†ç‰¹æ€§çš„é¢†åŸŸç±»</li>
<li>ä¸€ä¸ª Spring MVC æ§åˆ¶å™¨ç±»ï¼Œå®ƒè·å–æˆåˆ†ä¿¡æ¯å¹¶å°†å…¶ä¼ é€’ç»™è§†å›¾</li>
<li>ä¸€ä¸ªè§†å›¾æ¨¡æ¿ï¼Œåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­å‘ˆç°ä¸€ä¸ªæˆåˆ†åˆ—è¡¨</li>
</ul>
<h3 id="æ„å»ºé¢†åŸŸç±»"><a href="#æ„å»ºé¢†åŸŸç±»" class="headerlink" title="æ„å»ºé¢†åŸŸç±»"></a>æ„å»ºé¢†åŸŸç±»</h3><p>åœ¨ç¼–å†™æ§åˆ¶å™¨å’Œè§†å›¾ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç¡®å®šè¡¨ç¤ºé…æ–™çš„åŸŸç±»å‹ã€‚è¿™å°†ä¸ºå¼€å‘ web ç»„ä»¶å¥ å®šåŸºç¡€ã€‚</p>
<p>åº”ç”¨ç¨‹åºçš„åŸŸæ˜¯å®ƒæ‰€å¤„ç†çš„ä¸»é¢˜é¢†åŸŸ â€”â€” å½±å“åº”ç”¨ç¨‹åºç†è§£çš„æ€æƒ³å’Œæ¦‚å¿µã€‚åœ¨ Taco Cloud åº”ç”¨ç¨‹åºä¸­ï¼Œé¢†åŸŸåŒ…æ‹¬ Taco è®¾è®¡ã€ç»„æˆè¿™äº›è®¾è®¡çš„æˆåˆ†ã€å®¢æˆ·å’Œå®¢æˆ·ä¸‹çš„ Taco è®¢å•ç­‰å¯¹è±¡ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†å…³æ³¨ç‰ç±³é¥¼é…æ–™ã€‚</p>
<p>åœ¨é¢†åŸŸä¸­ï¼Œç‰ç±³é¥¼é…æ–™æ˜¯ç›¸å½“ç®€å•çš„å¯¹è±¡ã€‚æ¯ä¸€ç§éƒ½æœ‰ä¸€ä¸ªåç§°å’Œä¸€ä¸ªç±»å‹ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è§†è§‰ä¸Šå¯¹å…¶è¿›è¡Œåˆ†ç±»ï¼ˆè›‹ç™½è´¨ã€å¥¶é…ªã€é…±æ±ç­‰ï¼‰ã€‚æ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ª IDï¼Œé€šè¿‡è¿™ä¸ª ID å¯ä»¥è½»æ¾ã€æ˜ç¡®åœ°å¼•ç”¨å®ƒã€‚ä¸‹é¢çš„æˆåˆ†ç±»å®šä¹‰äº†éœ€è¦çš„åŸŸå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ingredient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">        WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„ Java åŸŸç±»ï¼Œå®šä¹‰äº†æè¿°ä¸€ä¸ªæˆåˆ†æ‰€éœ€çš„ä¸‰ä¸ªå±æ€§ã€‚å¯¹äºç¨‹åº ä¸­å®šä¹‰çš„ <code>Ingredient</code> ç±»ï¼Œæœ€ä¸å¯»å¸¸çš„äº‹æƒ…å¯èƒ½æ˜¯å®ƒä¼¼ä¹ç¼ºå°‘ä¸€ç»„å¸¸ç”¨çš„ getter å’Œ setter æ–¹æ³•ï¼Œæ›´ä¸ç”¨è¯´åƒ <code>equals()</code>ã€<code>hashCode()</code>ã€<code>toString()</code> ç­‰æœ‰ç”¨çš„æ–¹æ³•ã€‚</p>
<p>åœ¨æ¸…å•ä¸­çœ‹ä¸åˆ°å®ƒä»¬ï¼Œéƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œä½†ä¹Ÿå› ä¸ºä½¿ç”¨äº†ä¸€ä¸ªåä¸º Lombok çš„å‡ºè‰²åº“ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆè¿™äº›æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œç±»çº§åˆ«çš„ <code>@Data</code> æ³¨é‡Šæ˜¯ç”± Lombok æä¾›çš„ï¼Œå®ƒå‘Šè¯‰ Lombok ç”Ÿæˆæ‰€æœ‰ç¼ºå°‘çš„æ–¹æ³•ï¼Œä»¥åŠæ¥å—æ‰€æœ‰<code>final</code>å±æ€§ä½œä¸ºå‚æ•°çš„æ„é€ å‡½æ•°ã€‚é€šè¿‡ä½¿ç”¨ Lombokï¼Œå¯ä»¥è®© <code>Ingredient</code> çš„ä»£ç ä¿æŒæ•´æ´ã€‚</p>
<p>Lombok ä¸æ˜¯ä¸€ä¸ª Spring åº“ï¼Œä½†æ˜¯å®ƒéå¸¸æœ‰ç”¨ï¼Œæ²¡æœ‰å®ƒæˆ‘å¾ˆéš¾å¼€å‘ã€‚å½“æˆ‘éœ€è¦åœ¨ä¸€æœ¬ä¹¦ä¸­ä¿æŒä»£ç ç¤ºä¾‹ç®€çŸ­æ˜äº†æ—¶ï¼Œå®ƒå°±æˆäº†æˆ‘çš„æ•‘æ˜Ÿã€‚</p>
<p>è¦ä½¿ç”¨ Lombokï¼Œéœ€è¦<strong>å°†å…¶ä½œä¸ºä¾èµ–é¡¹æ·»åŠ åˆ°é¡¹ç›®</strong>ä¸­ã€‚å¦‚æœæ­£åœ¨ä½¿ç”¨ Spring Tool Suiteï¼Œåªéœ€å³é”®å•å‡» pom.xml æ–‡ä»¶å¹¶ä» Spring ä¸Šä¸‹æ–‡èœå•é€‰é¡¹ä¸­é€‰æ‹© Edit Starters å³å¯ã€‚åœ¨ç¬¬ 1 ç« ï¼ˆå›¾ 1.4ï¼‰ä¸­ç»™å‡ºçš„ä¾èµ–é¡¹çš„ç›¸åŒé€‰æ‹©å°†å‡ºç°ï¼Œè¿™æ ·å°±æœ‰æœºä¼šæ·»åŠ æˆ–æ›´æ”¹æ‰€é€‰çš„ä¾èµ–é¡¹ã€‚æ‰¾åˆ° Lombok é€‰é¡¹ï¼Œç¡®ä¿é€‰ä¸­ï¼Œç„¶åå•å‡» OKï¼›Spring Tool Suite å°†è‡ªåŠ¨å°†å…¶æ·»åŠ åˆ°æ„å»ºè§„èŒƒä¸­ã€‚</p>
<p>æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ pom.xml ä¸­çš„ä»¥ä¸‹æ¡ç›®æ‰‹åŠ¨æ·»åŠ å®ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">    &lt;optional&gt;<span class="literal">true</span>&lt;/optional&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>æ­¤ä¾èµ–é¡¹å°†åœ¨å¼€å‘æ—¶æä¾› Lombok æ³¨é‡Šï¼ˆå¦‚ <code>@Data</code>ï¼‰ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æä¾›è‡ªåŠ¨æ–¹æ³•ç”Ÿæˆã€‚ä½†æ˜¯è¿˜éœ€è¦<strong>åœ¨ IDE ä¸­æ·»åŠ  Lombok ä½œä¸ºæ‰©å±•</strong>ï¼Œå¦åˆ™ IDE å°†ä¼šæŠ¥é”™ç¼ºå°‘æ–¹æ³•å’Œæ²¡æœ‰è®¾ç½®çš„æœ€ç»ˆå±æ€§ã€‚è¯·è®¿é—® <a href="https://projectlombok.org/%EF%BC%8C%E4%BB%A5%E4%BA%86%E8%A7%A3%E5%A6%82%E4%BD%95%E5%9C%A8">https://projectlombok.org/ï¼Œä»¥äº†è§£å¦‚ä½•åœ¨</a> IDE ä¸­å®‰è£… Lombokã€‚</p>
<p>ä½ ä¼šå‘ç° Lombok éå¸¸æœ‰ç”¨ï¼Œä½†å®ƒæ˜¯å¯é€‰çš„ã€‚å¦‚æœä¸å¸Œæœ›ä½¿ç”¨å®ƒï¼Œæˆ–æ˜¯ä¸éœ€è¦å®ƒæ¥å¼€å‘ Spring åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆè¯·éšæ„æ‰‹åŠ¨ç¼–å†™é‚£äº›ç¼ºå°‘çš„æ–¹æ³•ã€‚ç»§ç»­â€¦â€¦æˆ‘å°†ç­‰å¾…ã€‚å®Œæˆåï¼Œå°†æ·»åŠ ä¸€äº›æ§åˆ¶å™¨æ¥å¤„ç†åº”ç”¨ç¨‹åºä¸­çš„ web è¯·æ±‚ã€‚</p>
<blockquote>
<p>ç¬”è®°ï¼šIDEAå¦‚ä½•ä¸ºpom.xmlå¯¼å…¥ä¾èµ–ï¼Ÿ</p>
<p><a href="https://www.jb51.net/article/193912.htm">https://www.jb51.net/article/193912.htm</a></p>
<p>è™½ç„¶é¡¹ç›®é‡Œæœ¬èº«å°±æœ‰ï¼Œä¸çŸ¥é“reimportæ˜¯ä¸æ˜¯çœŸçš„æœ‰æ•ˆæœï¼Œæ²¡æœ‰æ‰¾åˆ°é‡æ–°é€‰æ‹©ä¾èµ–çš„æ–¹æ³•ã€‚</p>
</blockquote>
<blockquote>
<p>ç¬”è®°ï¼šåœ¨ IDE ä¸­æ·»åŠ  Lombok ä½œä¸ºæ‰©å±•ï¼Ÿ</p>
<p>Lombokæ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡ç®€å•çš„æ³¨è§£å½¢å¼æ¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–æ¶ˆé™¤ä¸€äº›å¿…é¡»æœ‰ä½†æ˜¾å¾—å¾ˆè‡ƒè‚¿çš„Javaä»£ç çš„å·¥å…·ï¼Œé€šè¿‡ä½¿ç”¨å¯¹åº”çš„æ³¨è§£ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æºç çš„æ—¶å€™ç”Ÿæˆå¯¹åº”çš„æ–¹æ³•ã€‚</p>
<p>1.pluginä¸­ä¸‹è½½lombokæ’ä»¶  <a href="https://www.jb51.net/article/214041.htm">https://www.jb51.net/article/214041.htm</a></p>
<p>2.é…ç½®ä¸€ä¸‹ï¼Œenable annotation processing å¯ç”¨æ³¨é‡Šå¤„ç†  <a href="https://blog.csdn.net/xiaoxiamimm/article/details/113882655">https://blog.csdn.net/xiaoxiamimm/article/details/113882655</a></p>
<p>3.pom.xmlä¸­æ·»åŠ lombokä¾èµ–</p>
</blockquote>
<h3 id="åˆ›å»ºæ§åˆ¶å™¨ç±»"><a href="#åˆ›å»ºæ§åˆ¶å™¨ç±»" class="headerlink" title="åˆ›å»ºæ§åˆ¶å™¨ç±»"></a>åˆ›å»ºæ§åˆ¶å™¨ç±»</h3><p>æ§åˆ¶å™¨æ˜¯ Spring MVC æ¡†æ¶çš„ä¸»è¦å‚ä¸è€…ã€‚å®ƒä»¬çš„ä¸»è¦å·¥ä½œæ˜¯å¤„ç† HTTP è¯·æ±‚ï¼Œæˆ–è€…å°†è¯·æ±‚ä¼ é€’ç»™è§†å›¾ä»¥å‘ˆç° HTMLï¼ˆæµè§ˆå™¨æ˜¾ç¤ºï¼‰ï¼Œæˆ–è€…ç›´æ¥å°†æ•°æ®å†™å…¥å“åº”ä½“ï¼ˆRESTfulï¼‰ã€‚åœ¨æœ¬ç« ä¸­ï¼Œå°†é‡ç‚¹è®¨è®ºä½¿ç”¨è§†å›¾ä¸º web æµè§ˆå™¨ç”Ÿæˆå†…å®¹çš„æ§åˆ¶å™¨çš„ç±»å‹ã€‚åœ¨ç¬¬ 6 ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨ REST API ä¸­ç¼–å†™å¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨ã€‚</p>
<p>å¯¹äº Taco Cloud åº”ç”¨ç¨‹åºï¼Œéœ€è¦ä¸€ä¸ªç®€å•çš„æ§åˆ¶å™¨æ¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œä¸€ä¸ªæ˜¾ç¤ºé…æ–™çš„æ§åˆ¶å™¨ï¼š</p>
<ul>
<li>å¤„ç†è¯·æ±‚è·¯å¾„ä¸º <code>/design</code> çš„ HTTP GET è¯·æ±‚</li>
<li>æ„å»ºæˆåˆ†åˆ—è¡¨</li>
<li>å°†è¯·æ±‚å’Œæˆåˆ†æ•°æ®æäº¤ç»™è§†å›¾æ¨¡æ¿ï¼Œä»¥ HTML çš„å½¢å¼å‘ˆç°å¹¶å‘é€ç»™è¯·æ±‚çš„ web æµè§ˆå™¨</li>
</ul>
<p>ä¸‹é¢çš„ DesignTacoController ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Errors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient.Type;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/design&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DesignTacoController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">showDesignForm</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">        List&lt;Ingredient&gt; ingredients = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;FLTO&quot;</span>, <span class="string">&quot;Flour Tortilla&quot;</span>, Type.WRAP),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;COTO&quot;</span>, <span class="string">&quot;Corn Tortilla&quot;</span>, Type.WRAP),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;GRBF&quot;</span>, <span class="string">&quot;Ground Beef&quot;</span>, Type.PROTEIN),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;CARN&quot;</span>, <span class="string">&quot;Carnitas&quot;</span>, Type.PROTEIN),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;TMTO&quot;</span>, <span class="string">&quot;Diced Tomatoes&quot;</span>, Type.VEGGIES),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;LETC&quot;</span>, <span class="string">&quot;Lettuce&quot;</span>, Type.VEGGIES),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;CHED&quot;</span>, <span class="string">&quot;Cheddar&quot;</span>, Type.CHEESE),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;JACK&quot;</span>, <span class="string">&quot;Monterrey Jack&quot;</span>, Type.CHEESE),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;SLSA&quot;</span>, <span class="string">&quot;Salsa&quot;</span>, Type.SAUCE),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Ingredient</span>(<span class="string">&quot;SRCR&quot;</span>, <span class="string">&quot;Sour Cream&quot;</span>, Type.SAUCE)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        Type[] types = Ingredient.Type.values();</span><br><span class="line">        <span class="keyword">for</span> (Type type : types) &#123;</span><br><span class="line">            model.addAttribute(type.toString().toLowerCase(),</span><br><span class="line">                filterByType(ingredients, type));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;design&quot;</span>, <span class="keyword">new</span> <span class="title class_">Taco</span>());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// provided by &#x27;aexiaosong&#x27;</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Ingredient&gt; <span class="title function_">filterByType</span><span class="params">(List&lt;Ingredient&gt; ingredients, Type type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ingredients.stream().filter(x -&gt; x.getType().equals(type)).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Slf4jï¼Œå®ƒæ˜¯ Lombok æä¾›çš„æ³¨é‡Šï¼Œåœ¨è¿è¡Œæ—¶å°†è‡ªåŠ¨ç”Ÿæˆç±»ä¸­çš„ SLF4Jï¼ˆJava çš„ç®€å•æ—¥å¿—é—¨é¢ï¼Œ<a href="https://www.slf4j.org/%EF%BC%89%E8%AE%B0%E5%BD%95%E5%99%A8%E3%80%82%E8%BF%99%E4%B8%AA%E9%80%82%E5%BD%93%E7%9A%84%E6%B3%A8%E9%87%8A%E5%85%B7%E6%9C%89%E4%B8%8E%E6%98%BE%E5%BC%8F%E5%9C%B0%E5%9C%A8%E7%B1%BB%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%BB%A5%E4%B8%8B%E8%A1%8C%E7%9B%B8%E5%90%8C%E7%9A%84%E6%95%88%E6%9E%9C%EF%BC%9A">https://www.slf4j.org/ï¼‰è®°å½•å™¨ã€‚è¿™ä¸ªé€‚å½“çš„æ³¨é‡Šå…·æœ‰ä¸æ˜¾å¼åœ°åœ¨ç±»ä¸­æ·»åŠ ä»¥ä¸‹è¡Œç›¸åŒçš„æ•ˆæœï¼š</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.slf4j.<span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> </span><br><span class="line">       org.slf4j.LoggerFactory.getLogger(DesignTacoController.class);</span><br></pre></td></tr></table></figure>

<p>@Controllerã€‚æ­¤æ³¨é‡Šç”¨äºå°†è¯¥ç±»æ ‡è¯†ä¸ºæ§åˆ¶å™¨å¹¶å°†å…¶æ ‡è®°ä¸ºç»„ä»¶æ‰«æçš„å€™é€‰å¯¹è±¡ï¼Œä»¥ä¾¿ Spring å°†å‘ç°è¯¥ç±»å¹¶åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è‡ªåŠ¨åˆ›å»º DesignTacoController å®ä¾‹ä½œä¸º beanã€‚</p>
<p>@RequestMapping æ³¨é‡Šåœ¨ç±»çº§åº”ç”¨æ—¶ï¼ŒæŒ‡å®šè¯¥æ§åˆ¶å™¨å¤„ç†çš„è¯·æ±‚çš„ç±»å‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒæŒ‡å®š DesignTacoController å°†å¤„ç†è·¯å¾„ä»¥ <code>/design</code> å¼€å¤´çš„è¯·æ±‚ã€‚</p>
<p>@GetMapping ä¸ç±»çº§åˆ«çš„ @RequestMapping é…å¯¹ä½¿ç”¨ï¼ŒæŒ‡å®šä½•æ—¶æ¥æ”¶ <code>/design</code> çš„ HTTP GET è¯·æ±‚ï¼ŒshowDesignForm() å°†ç”¨æ¥å¤„ç†è¯·æ±‚ã€‚@GetMapping æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„æ³¨é‡Šï¼Œæ˜¯åœ¨ Spring 4.3 ä¸­å¼•å…¥çš„ã€‚åœ¨ Spring 4.3 ä¹‹å‰ï¼Œå¯èƒ½ä½¿ç”¨äº†ä¸€ä¸ªæ–¹æ³•çº§åˆ«çš„ @RequestMapping æ³¨é‡Šä½œä¸ºæ›¿ä»£<code>@RequestMapping(method=RequestMethod.GET) </code>ã€‚</p>
<p>showDesignForm() æ–¹æ³•å°†å¤„ç†è¯·æ±‚ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ–¹æ³•ä½“ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è¯¥æ–¹æ³•çš„å¤§éƒ¨åˆ†æ„é€ äº†ä¸€ä¸ªæˆä»½å¯¹è±¡åˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨ç°åœ¨æ˜¯ç¡¬ç¼–ç çš„ã€‚å½“æˆ‘ä»¬è®²åˆ°ç¬¬ 3 ç« çš„æ—¶å€™ï¼Œä½ ä¼šä»æ•°æ®åº“ä¸­æ‰¾åˆ°ç‰ç±³é¥¼çš„åŸæ–™åˆ—è¡¨ã€‚ä¸€æ—¦å‡†å¤‡å¥½äº†åŸæ–™åˆ—è¡¨ï¼Œæ¥ä¸‹æ¥çš„å‡ è¡Œ showDesignForm() å°†æ ¹æ®åŸæ–™ç±»å‹è¿‡æ»¤è¯¥åˆ—è¡¨ã€‚ç„¶åå°†æˆåˆ†ç±»å‹åˆ—è¡¨ä½œä¸ºå±æ€§æ·»åŠ Modelå¯¹è±¡ä¸Šï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä»¥å‚æ•°çš„å½¢å¼ä¼ é€’ç»™ showDesignForm() æ–¹æ³•çš„ã€‚Model æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåœ¨æ§åˆ¶å™¨å’Œè´Ÿè´£å‘ˆç°æ•°æ®çš„è§†å›¾ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚æœ€åï¼Œæ”¾ç½®åœ¨ Model ç±»å±æ€§ä¸­çš„æ•°æ®è¢«å¤åˆ¶åˆ° servlet å“åº”å±æ€§ä¸­ï¼Œè§†å›¾å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚showDesignForm() æ–¹æ³•æœ€åè¿”å› â€œdesignâ€ï¼Œè¿™æ˜¯å°†ç”¨äºå‘æµè§ˆå™¨å‘ˆç° Model çš„è§†å›¾çš„é€»è¾‘åç§°ã€‚</p>
<p>DesignTacoController çœŸçš„å¼€å§‹æˆå½¢äº†ã€‚å¦‚æœæ‚¨ç°åœ¨è¿è¡Œåº”ç”¨ç¨‹åºå¹¶å°†æ‚¨çš„æµè§ˆå™¨æŒ‡å‘ <code>/design</code> è·¯å¾„ï¼ŒDesignTacoController çš„ showDesignForm() å°†è¢«å ç”¨ï¼Œå®ƒä»å­˜å‚¨åº“ä¸­è·å–æ•°æ®å¹¶å°†å…¶æ”¾åœ¨ Model ä¸­ï¼Œç„¶åå°†è¯·æ±‚ä¼ é€’ç»™è§†å›¾ã€‚ä½†æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å®šä¹‰è§†å›¾ï¼Œæ‰€ä»¥è¯·æ±‚ä¼šå‘ç”Ÿå¯æ€•çš„è½¬å˜ï¼Œå¯¼è‡´ HTTP 404ï¼ˆNot Foundï¼‰é”™è¯¯ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©æˆ‘ä»¬å°†æ³¨æ„åŠ›è½¬ç§»åˆ°è§†å›¾ä¸Šï¼Œå…¶ä¸­çš„æ•°æ®å°†ç”¨ HTML è¿›è¡Œä¿®é¥°ï¼Œå¹¶åœ¨ç”¨æˆ·çš„ web æµè§ˆå™¨ä¸­æ˜¾ç¤ºã€‚</p>
<h3 id="è®¾è®¡è§†å›¾"><a href="#è®¾è®¡è§†å›¾" class="headerlink" title="è®¾è®¡è§†å›¾"></a>è®¾è®¡è§†å›¾</h3><p>æ§åˆ¶å™¨åˆ›å»ºå®Œæˆåï¼Œå°±è¯¥å¼€å§‹è®¾è®¡è§†å›¾äº†ã€‚Spring ä¸ºå®šä¹‰è§†å›¾æä¾›äº†å‡ ä¸ªå¾ˆå¥½çš„é€‰é¡¹ï¼ŒåŒ…æ‹¬ JavaServer Pagesï¼ˆJSPï¼‰ã€Thymeleafã€FreeMarkerã€Mustache å’ŒåŸºäº Groovy çš„æ¨¡æ¿ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Thymeleafï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ç¬¬ 1 ç« å¼€å§‹é¡¹ç›®æ—¶æ‰€åšçš„é€‰æ‹©ã€‚</p>
<p>åƒ Thymeleaf è¿™æ ·çš„è§†å›¾åº“è¢«è®¾è®¡æˆä¸ä»»ä½•ç‰¹å®šçš„ web æ¡†æ¶è§£è€¦ã€‚å› æ­¤ï¼Œä»–ä»¬ä¸çŸ¥é“ Spring çš„æ¨¡å‹æŠ½è±¡ï¼Œå¹¶ä¸”æ— æ³•å¤„ç†æ§åˆ¶å™¨æ”¾ç½®åœ¨æ¨¡å‹ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯å®ƒä»¬å¯ä»¥å¤„ç† servlet è¯·æ±‚å±æ€§ã€‚å› æ­¤ï¼Œåœ¨ Spring å°†è¯·æ±‚æäº¤ç»™è§†å›¾ä¹‹å‰ï¼Œå®ƒå°†æ¨¡å‹æ•°æ®å¤åˆ¶åˆ°è¯·æ±‚å±æ€§ä¸­ï¼Œè€Œ Thymeleaf å’Œå…¶ä»–è§†å›¾æ¨¡æ¿é€‰é¡¹å¯ä»¥éšæ—¶è®¿é—®è¿™äº›å±æ€§ã€‚</p>
<p>Thymeleaf æ¨¡æ¿åªæ˜¯ HTML ä¸ä¸€äº›é¢å¤–çš„å…ƒç´ å±æ€§ï¼ŒæŒ‡å¯¼æ¨¡æ¿åœ¨æ¸²æŸ“è¯·æ±‚æ•°æ®ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/styles.css&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Design your taco!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/images/TacoCloud.png&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;design&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grid&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;wraps&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Designate your wrap:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;wrap&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;proteins&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Pick your protein:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;protein&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cheeses&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Choose your cheese:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;cheese&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;veggies&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Determine your veggies:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;veggies&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ingredient-group&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sauces&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Select your sauce:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;ingredient : $&#123;sauce&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;ingredients&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;ingredient.id&#125;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ingredient.name&#125;&quot;</span>&gt;</span>INGREDIENT<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Name your taco creation:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span>&gt;</span>Submit your taco<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæ¯ç§ç±»å‹çš„é…æ–™ï¼Œéƒ½è¦é‡å¤ <code>&lt;div&gt;</code> ç‰‡æ®µã€‚è¿˜åŒ…æ‹¬ä¸€ä¸ªæäº¤æŒ‰é’®å’Œä¸€ä¸ªå­—æ®µï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å‘½åä»–ä»¬çš„åˆ›å»ºã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®Œæ•´çš„æ¨¡æ¿åŒ…æ‹¬ Taco Cloud å›¾æ ‡å›¾ç‰‡å’Œä¸€ä¸ªæŒ‡å‘æ ·å¼è¡¨çš„ <code>&lt;link&gt;</code> å¼•ç”¨ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒThymeleaf çš„ <code>@&#123;&#125;</code> æ“ä½œç¬¦è¢«ç”¨æ¥äº§ç”Ÿä¸€ä¸ªä¸Šä¸‹æ–‡ç›¸å…³è·¯å¾„çš„é™æ€å·¥ä»¶ï¼Œå®ƒä»¬æ­£åœ¨å¼•ç”¨ã€‚æ­£å¦‚åœ¨ç¬¬ 1 ç« ä¸­äº†è§£åˆ°çš„ï¼ŒSpring å¯åŠ¨åº”ç”¨ç¨‹åºä¸­çš„é™æ€å†…å®¹æ˜¯ä»ç±»è·¯å¾„æ ¹ç›®å½•çš„ &#x2F;static ç›®å½•æä¾›çš„ã€‚</p>
<p>ç°åœ¨æ§åˆ¶å™¨å’Œè§†å›¾å·²ç»å®Œæˆï¼Œå¯ä»¥å¯åŠ¨åº”ç”¨ç¨‹åºäº†ã€‚è¿è¡Œ Spring Boot åº”ç”¨ç¨‹åºæœ‰è®¸å¤šæ–¹æ³•ã€‚åœ¨ç¬¬ 1 ç« ä¸­ï¼Œå±•ç¤ºäº†å¦‚ä½•è¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œé¦–å…ˆå°†å®ƒæ„å»ºåˆ°ä¸€ä¸ªå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨ <code>java -jar</code> è¿è¡Œè¿™ä¸ª JARã€‚å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>mvn spring-boot:run</code> ä»æ„å»ºä¸­ç›´æ¥è¿è¡Œåº”ç”¨ç¨‹åºã€‚</p>
<p>æ— è®ºå¦‚ä½•å¯åŠ¨ Taco Cloud åº”ç”¨ç¨‹åºï¼Œä¸€æ—¦å¯åŠ¨ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—® <a href="http://localhost:8080/design%E3%80%82%E5%BA%94%E8%AF%A5%E7%9C%8B%E5%88%B0%E7%B1%BB%E4%BC%BC%E5%9B%BE">http://localhost:8080/designã€‚åº”è¯¥çœ‹åˆ°ç±»ä¼¼å›¾</a> 2.2 çš„é¡µé¢ã€‚</p>
<h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><blockquote>
<p>ç¬”è®°ï¼šIDEAè‡ªåŠ¨importï¼Ÿ</p>
<p>æ‰“å¼€ IDEA çš„é¦–é€‰é¡¹ï¼Œæ‰¾åˆ° Editor | General | Auto Importã€‚å‹¾é€‰ä¸Š <code>Add unambiguous imports on the fly</code> å’Œ <code>Optimize imports on the fly (for current project)</code>ã€‚</p>
</blockquote>
<p>å‡ºç°é—®é¢˜ï¼šSpringbooté¡¹ç›®javax.validationæ‰¾ä¸åˆ°ï¼š</p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š<a href="https://www.jb51.net/article/185660.htm">https://www.jb51.net/article/185660.htm</a></p>
<p>æ‰¾ä¸åˆ°åŒ…ï¼š<a href="https://www.cnblogs.com/keadd/p/13652629.html">https://www.cnblogs.com/keadd/p/13652629.html</a></p>
<p>æœªè§£å†³ï¼Œæ³¨é‡ŠTacoç±»éƒ¨åˆ†è¡Œã€‚</p>
<p>è¿è¡Œä¸æ­£ç¡®ï¼Œåº”è¯¥æ˜¯design.htmlä¸­ä»£ç çš„é—®é¢˜ï¼Œæ— æ³•æ˜¾ç¤ºç½‘é¡µã€‚</p>
<p>æ·»åŠ äº†ä¸€ä¸ªwebconfig.javaæ–‡ä»¶ï¼Œä¾ç„¶ä¸è¡Œã€‚</p>
<p>è¿è¡Œç½‘ä¸Šä»£ç ï¼Œæ˜¯å¯ä»¥çš„ã€‚</p>
<h2 id="å¤„ç†è¡¨å•æäº¤"><a href="#å¤„ç†è¡¨å•æäº¤" class="headerlink" title="å¤„ç†è¡¨å•æäº¤"></a>å¤„ç†è¡¨å•æäº¤</h2><p>ç¬¬ä¸€ç« æ˜¾ç¤ºtacoé¦–é¡µï¼Œç¬¬äºŒç« æ˜¾ç¤ºé…æ–™é€‰å–é¡µ&#x2F;designï¼ŒæœåŠ¡ç«¯æŒ‡å®šå¯é€‰çš„é…æ–™ï¼Œä¼ é€’ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è®¿é—®designé¡µé¢é€šè¿‡getè¯·æ±‚ã€‚å®¢æˆ·ç«¯é€‰æ‹©ä¹‹åï¼Œéœ€è¦è¿›è¡Œè¡¨å•æäº¤ï¼Œpostè¯·æ±‚ï¼Œä¼ é€’å›æœåŠ¡ç«¯ï¼Œè·¯å¾„ç›¸åŒï¼Œéƒ½æ˜¯designã€‚</p>
<p>éœ€è¦åœ¨è¯¥ POST è¯·æ±‚çš„æ¥æ”¶ç«¯ä¸Šæœ‰ä¸€ä¸ªæ§åˆ¶å™¨å¤„ç†ç¨‹åºæ–¹æ³•ã€‚éœ€è¦åœ¨ DesignTacoController ä¸­ç¼–å†™ä¸€ä¸ªæ–°çš„å¤„ç†ç¨‹åºæ–¹æ³•æ¥å¤„ç† <code>/design</code> æ¥å£çš„ POST è¯·æ±‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">processDesign</span><span class="params">(Taco design)</span> &#123;</span><br><span class="line">    <span class="comment">// Save the taco design...</span></span><br><span class="line">    <span class="comment">// We&#x27;ll do this in chapter 3</span></span><br><span class="line">    log.info(<span class="string">&quot;Processing design: &quot;</span> + design);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/orders/current&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“åº”ç”¨åˆ° processDesign() æ–¹æ³•æ—¶ï¼Œ@PostMapping ä¸ç±»çº§åˆ« @RequestMapping ç›¸åè°ƒï¼Œä»¥è¡¨æ˜ processDesign() åº”è¯¥å¤„ç† <code>/design</code> æ¥å£çš„ POST è¯·æ±‚ã€‚è¿™æ­£æ˜¯éœ€è¦å¤„ç†çš„ä¸€ä¸ªç‰ç±³é¥¼è‰ºæœ¯å®¶æäº¤çš„ä½œå“ã€‚</p>
<p>è¯¥æ–¹æ³•éœ€è¦ä¼ é€’ä¸€ä¸ªTacoå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº†é…æ–™å’Œåå­—ç­‰ï¼Œæ–¹æ³•ä¸­å¯¹tacoå¯¹è±¡è¿›è¡Œå¤„ç†ã€‚åœ¨ç¬¬ 3 ç« ä¸­ï¼Œå°†æ·»åŠ ä¸€äº›æŒä¹…æ€§é€»è¾‘ï¼Œå°†æäº¤çš„ Taco ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Taco</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; ingredients;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Taco æ˜¯ä¸€ä¸ªç®€å•çš„ Java åŸŸå¯¹è±¡ï¼Œå…·æœ‰ä¸¤ä¸ªå±æ€§ã€‚ä¸ Ingredient ç±»ä¼¼ï¼ŒTaco ç±»ä¹Ÿä½¿ç”¨ @Data è¿›è¡Œæ³¨é‡Šï¼Œä»¥ä¾¿åœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”ŸæˆåŸºæœ¬çš„ JavaBean æ–¹æ³•ã€‚</p>
<p>ä¸ showDesignForm() æ–¹æ³•ä¸€æ ·ï¼ŒprocessDesign() é€šè¿‡è¿”å›ä¸€ä¸ª String ç»“æŸã€‚ä¸ showDesignForm() ç±»ä¼¼ï¼Œè¿”å›çš„å€¼æŒ‡ç¤ºå°†æ˜¾ç¤ºç»™ç”¨æˆ·çš„è§†å›¾ã€‚ä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œä» processDesign() è¿”å›çš„å€¼çš„å‰ç¼€æ˜¯ â€œredirect:â€ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé‡å®šå‘è§†å›¾ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå®ƒè¡¨æ˜åœ¨ processDesign() å®Œæˆä¹‹åï¼Œç”¨æˆ·çš„æµè§ˆå™¨åº”è¯¥è¢«é‡å®šå‘åˆ°ç›¸å¯¹è·¯å¾„ &#x2F;order&#x2F;currentã€‚</p>
<p>æ„æ€æ˜¯é‡å®šå‘åˆ°å¦ä¸€ä¸ªè·¯å¾„ï¼Ÿ &#x2F;order&#x2F;current ç›¸å½“äºæ˜¯&#x2F;designä¸€æ ·çš„è·¯å¾„ï¼Œå› æ­¤éœ€è¦ç”¨ @Controllerã€@RequestMapping å’Œ @GetMappingåˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨ã€‚</p>
<p>å±•ç°è®¢å•è¡¨å•çš„æ§åˆ¶å™¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package tacos.web;</span><br><span class="line">â€‹</span><br><span class="line">import javax.validation.Valid;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.validation.Errors;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import tacos.Order;</span><br><span class="line">â€‹</span><br><span class="line">@Slf4j</span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/orders&quot;)</span><br><span class="line">public class OrderController &#123;</span><br><span class="line">    @GetMapping(&quot;/current&quot;)</span><br><span class="line">    public String orderForm(Model model) &#123;</span><br><span class="line">        model.addAttribute(&quot;order&quot;, new Order());</span><br><span class="line">        return &quot;orderForm&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ Lombok çš„ @Slf4j æ³¨é‡Šåœ¨è¿è¡Œæ—¶åˆ›å»ºä¸€ä¸ª SLF4J Logger å¯¹è±¡ã€‚ç¨åï¼Œå°†ä½¿ç”¨è¿™ä¸ª Logger æ¥è®°å½•æäº¤çš„è®¢å•çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>ç±»çº§åˆ«çš„ @RequestMapping æŒ‡å®šè¯¥æ§åˆ¶å™¨ä¸­çš„ä»»ä½•è¯·æ±‚å¤„ç†æ–¹æ³•éƒ½å°†å¤„ç†è·¯å¾„ä»¥ &#x2F;orders å¼€å¤´çš„è¯·æ±‚ã€‚å½“ä¸æ–¹æ³•çº§ @GetMapping ç»“åˆä½¿ç”¨æ—¶ï¼Œå®ƒæŒ‡å®š orderForm() æ–¹æ³•å°†å¤„ç† &#x2F;orders&#x2F;current çš„ HTTP GET è¯·æ±‚ã€‚</p>
<p>è‡³äº orderForm() æ–¹æ³•æœ¬èº«ï¼Œå®ƒéå¸¸ç®€å•ï¼Œåªè¿”å› orderForm çš„é€»è¾‘è§†å›¾åã€‚åœ¨ç¬¬ 3 ç« ä¸­ï¼Œä¸€æ—¦æœ‰äº†æŠŠåˆ›å»ºçš„ taco æŒä¹…åŒ–åˆ°æ•°æ®åº“çš„æ–¹æ³•ï¼Œå°†é‡æ–°è®¿é—®è¯¥æ–¹æ³•å¹¶ä¿®æ”¹å®ƒï¼Œä»¥ä½¿ç”¨ taco å¯¹è±¡çš„åˆ—è¡¨å¡«å……æ¨¡å‹ï¼Œè¿™äº›å¯¹è±¡å°†æŒ‰é¡ºåºæ”¾ç½®ã€‚</p>
<p>orderForm è§†å›¾ç”±ä¸€ä¸ªåä¸º orderForm.html çš„ Thymeleaf æ¨¡æ¿æä¾›ï¼Œå¦‚ä¸‹é¢æ˜¾ç¤ºçš„ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/styles.css&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/orders&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;order&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Order your taco creations!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/images/TacoCloud.png&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/design&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;another&quot;</span>&gt;</span>Design another taco<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#fields.hasErrors()&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;validationError&quot;</span>&gt;</span></span><br><span class="line">                    Please correct the problems below and resubmit.</span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Deliver my taco masterpieces to...<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Name: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;street&quot;</span>&gt;</span>Street address: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;street&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;city&quot;</span>&gt;</span>City: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;city&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;state&quot;</span>&gt;</span>State: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;state&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;zip&quot;</span>&gt;</span>Zip code: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;zip&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Here&#x27;s how I&#x27;ll pay...<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;ccNumber&quot;</span>&gt;</span>Credit Card #: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;ccNumber&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;ccExpiration&quot;</span>&gt;</span>Expiration: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;ccExpiration&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;ccCVV&quot;</span>&gt;</span>CVV: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;*&#123;ccCVV&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit order&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <code>&lt;form&gt; </code>æ ‡è®°ä¸design ä¸­ä½¿ç”¨çš„ <code>&lt;form&gt; </code>æ ‡è®°ä¸åŒï¼Œå› ä¸ºå®ƒè¿˜æŒ‡å®šäº†ä¸€ä¸ªè¡¨å•æ“ä½œã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šæ“ä½œï¼Œè¡¨å•å°†å‘å‘ˆç°è¡¨å•çš„ç›¸åŒ URL æäº¤ HTTP POST è¯·æ±‚ã€‚ä½†æ˜¯åœ¨è¿™é‡Œï¼ŒæŒ‡å®šè¡¨å•åº”è¯¥æäº¤åˆ° &#x2F;ordersï¼ˆä½¿ç”¨ Thymeleaf çš„ <code>@&#123;â€¦&#125;</code> æ“ä½œç¬¦ä½œä¸ºä¸Šä¸‹æ–‡ç›¸å…³è·¯å¾„ï¼‰ã€‚</p>
<blockquote>
<p>ä¸designæäº¤çš„postä¸åŒï¼Œé‚£ä¸ªurlä¸€æ ·ï¼Œè€Œè¿™ä¸ªurlæœ¬æ¥æ˜¯order&#x2F;currentï¼Œåº”è¯¥å˜ä¸ºorderã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œéœ€è¦æ·»åŠ å¦å¤–ä¸€ä¸ªæ–¹æ³•åˆ° OrderController ç±»ä¸­ï¼Œå»å¤„ç† &#x2F;orders æ¥å£çš„ POST è¯·æ±‚ã€‚åœ¨è¿›è¡Œåˆ°ä¸‹ä¸€ç« ä¹‹å‰ï¼Œè¿˜æ²¡æœ‰åŠæ³•å°†è®¢å•æŒä¹…åŒ–ï¼Œå› æ­¤åœ¨è¿™é‡Œç®€åŒ–å®ƒ â€”â€” ç±»ä¼¼äºåœ¨ä¸‹ä¸€ä¸ªç¨‹åºæ¸…å•ä¸­çœ‹åˆ°çš„å†…å®¹ã€‚</p>
<blockquote>
<p>é‡å®šå‘åˆ°è®¢å•ï¼Œæ˜¾ç¤ºè®¢å•é¡µï¼Œè®¢å•è¡¨å•ä¸­ï¼Œæœ‰è®¢å•æäº¤ï¼Œpostè¯·æ±‚ï¼Œéœ€è¦ä¸€ä¸ªæ§åˆ¶å™¨ã€‚è¿”å›é¦–é¡µã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@PostMapping</span><br><span class="line">public String processOrder(Order order) &#123;</span><br><span class="line">    log.info(&quot;Order submitted: &quot; + order);</span><br><span class="line">    return &quot;redirect:/&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“è°ƒç”¨ processOrder() æ–¹æ³•æ¥å¤„ç†æäº¤çš„è®¢å•æ—¶ï¼Œå®ƒå°†è·å¾—ä¸€ä¸ª order å¯¹è±¡ï¼Œå…¶å±æ€§ç»‘å®šåˆ°æäº¤çš„è¡¨å•å­—æ®µã€‚Order éå¸¸åƒ Tacoï¼Œæ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„ç±»ï¼Œå®ƒæºå¸¦è®¢å•ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Digits;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.CreditCardNumber;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    <span class="keyword">private</span> String zip;</span><br><span class="line">    <span class="keyword">private</span> String ccNumber;</span><br><span class="line">    <span class="keyword">private</span> String ccExpiration;</span><br><span class="line">    <span class="keyword">private</span> String ccCVV;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ ¡éªŒè¡¨å•è¾“å…¥"><a href="#æ ¡éªŒè¡¨å•è¾“å…¥" class="headerlink" title="æ ¡éªŒè¡¨å•è¾“å…¥"></a>æ ¡éªŒè¡¨å•è¾“å…¥</h2><p>æ‰§è¡Œè¡¨å•éªŒè¯çš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨ processDesign() å’Œ processOrder() æ–¹æ³•ä¸­åŠ å…¥ä¸€å † if&#x2F;then å—ï¼Œæ£€æŸ¥æ¯ä¸ªå­—æ®µä»¥ç¡®ä¿å®ƒæ»¡è¶³é€‚å½“çš„éªŒè¯è§„åˆ™ã€‚ä½†æ˜¯è¿™æ ·åšä¼šå¾ˆéº»çƒ¦ï¼Œå¹¶ä¸”éš¾äºé˜…è¯»å’Œè°ƒè¯•ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒSpring æ”¯æŒ Javaâ€™s Bean Validation APIï¼ˆä¹Ÿç§°ä¸º JSR-303ï¼›<a href="https://jcp.org/en/jsr/detail?id=303%EF%BC%89%E3%80%82%E8%BF%99%E4%BD%BF%E5%BE%97%E5%A3%B0%E6%98%8E%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99%E6%AF%94%E5%9C%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%98%BE%E5%BC%8F%E5%9C%B0%E7%BC%96%E5%86%99%E5%A3%B0%E6%98%8E%E9%80%BB%E8%BE%91%E6%9B%B4%E5%AE%B9%E6%98%93%E3%80%82%E4%BD%BF%E7%94%A8">https://jcp.org/en/jsr/detail?id=303ï¼‰ã€‚è¿™ä½¿å¾—å£°æ˜éªŒè¯è§„åˆ™æ¯”åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­æ˜¾å¼åœ°ç¼–å†™å£°æ˜é€»è¾‘æ›´å®¹æ˜“ã€‚ä½¿ç”¨</a> Spring Bootï¼Œä¸éœ€è¦åšä»»ä½•ç‰¹æ®Šçš„äº‹æƒ…æ¥å°†éªŒè¯åº“æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œå› ä¸º Validation API å’Œ Validation API çš„ Hibernate å®ç°ä½œä¸ºSpring Boot web å¯åŠ¨ç¨‹åºçš„ä¸´æ—¶ä¾èµ–é¡¹è‡ªåŠ¨æ·»åŠ åˆ°äº†é¡¹ç›®ä¸­ã€‚</p>
<p>è¦åœ¨ Spring MVC ä¸­åº”ç”¨éªŒè¯ï¼Œéœ€è¦è¿™æ ·åšï¼š</p>
<ul>
<li>å¯¹è¦éªŒè¯çš„ç±»å£°æ˜éªŒè¯è§„åˆ™ï¼šç‰¹åˆ«æ˜¯ Taco ç±»ã€‚</li>
<li>æŒ‡å®šéªŒè¯åº”è¯¥åœ¨éœ€è¦éªŒè¯çš„æ§åˆ¶å™¨æ–¹æ³•ä¸­æ‰§è¡Œï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ï¼šDesignTacoController çš„ processDesign() æ–¹æ³•å’Œ OrderController çš„ processOrder() æ–¹æ³•ã€‚</li>
<li>ä¿®æ”¹è¡¨å•è§†å›¾ä»¥æ˜¾ç¤ºéªŒè¯é”™è¯¯ã€‚</li>
</ul>
<h3 id="å£°æ˜éªŒè¯è§„åˆ™"><a href="#å£°æ˜éªŒè¯è§„åˆ™" class="headerlink" title="å£°æ˜éªŒè¯è§„åˆ™"></a>å£°æ˜éªŒè¯è§„åˆ™</h3><p>å¯¹äº Taco ç±»ï¼Œå¸Œæœ›ç¡®ä¿ name å±æ€§ä¸æ˜¯ç©ºçš„æˆ– null çš„ï¼Œå¹¶ä¸”æ‰€é€‰é…æ–™åˆ—è¡¨ä¸­è‡³å°‘æœ‰ä¸€é¡¹ã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº†ä¸€ä¸ªæ›´æ–°åçš„ Taco ç±»ï¼Œå®ƒä½¿ç”¨ @NotNull å’Œ @Size æ¥å£°æ˜è¿™äº›éªŒè¯è§„åˆ™ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Taco</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min=5, message=&quot;Name must be at least 5 characters long&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Size(min=1, message=&quot;You must choose at least 1 ingredient&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; ingredients;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æ¶‰åŠåˆ°å¯¹æäº¤ç‰ç±³é¥¼è®¢å•è¿›è¡ŒéªŒè¯å£°æ˜æ—¶ï¼Œå¿…é¡»å¯¹ Order ç±»åº”ç”¨æ³¨è§£ã€‚å¯¹äºåœ°å€çš„å±æ€§ï¼Œåªéœ€è¦ç¡®ä¿ç”¨æˆ·æ²¡æœ‰ç•™ä¸‹ä»»ä½•ç©ºç™½å­—æ®µã€‚å¯¹äºè¿™ä¸€ç‚¹ï¼Œå°†ä½¿ç”¨ Hibernate Validator çš„ @NotBlank æ³¨è§£ã€‚</p>
<p>æ”¯ä»˜é¢†åŸŸçš„éªŒè¯æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥‡ç‰¹çš„å­˜åœ¨ã€‚ä½ ä¸ä»…éœ€è¦ç¡®ä¿ ccNumber å±æ€§ä¸ä¸ºç©ºï¼Œè¿˜è¦ç¡®ä¿å®ƒåŒ…å«çš„æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ä¿¡ç”¨å¡å·ç çš„å€¼ã€‚è¯¥ ccExpiration å±æ€§å¿…é¡»ç¬¦åˆ MM&#x2F;YYï¼ˆä¸¤ä½æ•°çš„å¹´&#x2F;æœˆï¼‰æ ¼å¼ã€‚è€Œ ccCVV å±æ€§å¿…é¡»æ˜¯ä¸€ä¸ªä¸‰ä½çš„æ•°å­—ã€‚ä¸ºäº†å®ç°è¿™ç§éªŒè¯ï¼Œéœ€è¦ä½¿ç”¨ä¸€äº›å…¶ä»–çš„ Java Bean Validation API æ³¨é‡Šï¼ŒåŒæ—¶éœ€è¦ä» Hibernate Validator é›†åˆä¸­å€Ÿç”¨ä¸€äº›éªŒè¯æ³¨è§£ã€‚ä¸‹é¢ç¨‹åºæ¸…å•åˆ—å‡ºäº†éªŒè¯ Order ç±»æ‰€éœ€è¦çš„æ”¹å˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Digits;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.CreditCardNumber;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;Name is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;Street is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;City is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;State is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message=&quot;Zip code is required&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String zip;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CreditCardNumber(message=&quot;Not a valid credit card number&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ccNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pattern(regexp=&quot;^(0[1-9]|1[0-2])([\\/])([1-9][0-9])$&quot;,</span></span><br><span class="line"><span class="meta">             message=&quot;Must be formatted MM/YY&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ccExpiration;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Digits(integer=3, fraction=0, message=&quot;Invalid CVV&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ccCVV;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒccNumber å±æ€§ç”¨ @CreditCardNumber è¿›è¡Œäº†æ³¨é‡Šã€‚è¯¥æ³¨é‡Šå£°æ˜å±æ€§çš„å€¼å¿…é¡»æ˜¯é€šè¿‡ Luhn ç®—æ³•ï¼ˆ<a href="https://en.wikipedia.org/wiki/Luhn_algorithm%EF%BC%89%E6%A3%80%E6%9F%A5%E8%BF%87%E7%9A%84%E6%9C%89%E6%95%88%E4%BF%A1%E7%94%A8%E5%8D%A1%E5%8F%B7%E3%80%82%E8%BF%99%E5%8F%AF%E4%BB%A5%E9%98%B2%E6%AD%A2%E7%94%A8%E6%88%B7%E5%87%BA%E9%94%99%E7%9A%84%E6%95%B0%E6%8D%AE%E5%92%8C%E6%95%85%E6%84%8F%E9%94%99%E8%AF%AF%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BD%86%E4%B8%8D%E8%83%BD%E4%BF%9D%E8%AF%81%E4%BF%A1%E7%94%A8%E5%8D%A1%E5%8F%B7%E7%A0%81%E5%AE%9E%E9%99%85%E4%B8%8A%E8%A2%AB%E5%88%86%E9%85%8D%E5%88%B0%E4%B8%80%E4%B8%AA%E5%B8%90%E6%88%B7%EF%BC%8C%E6%88%96%E8%AF%A5%E5%B8%90%E6%88%B7%E5%8F%AF%E4%BB%A5%E7%94%A8%E4%BA%8E%E4%BA%A4%E6%98%93%E3%80%82">https://en.wikipedia.org/wiki/Luhn_algorithmï¼‰æ£€æŸ¥è¿‡çš„æœ‰æ•ˆä¿¡ç”¨å¡å·ã€‚è¿™å¯ä»¥é˜²æ­¢ç”¨æˆ·å‡ºé”™çš„æ•°æ®å’Œæ•…æ„é”™è¯¯çš„æ•°æ®ï¼Œä½†ä¸èƒ½ä¿è¯ä¿¡ç”¨å¡å·ç å®é™…ä¸Šè¢«åˆ†é…åˆ°ä¸€ä¸ªå¸æˆ·ï¼Œæˆ–è¯¥å¸æˆ·å¯ä»¥ç”¨äºäº¤æ˜“ã€‚</a></p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œæ²¡æœ‰ç°æˆçš„æ³¨é‡Šæ¥éªŒè¯ ccExpiration å±æ€§çš„ MM&#x2F;YY æ ¼å¼ã€‚æˆ‘å·²ç»åº”ç”¨äº† @Pattern æ³¨é‡Šï¼Œä¸ºå®ƒæä¾›äº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥ç¡®ä¿å±æ€§å€¼ç¬¦åˆæ‰€éœ€çš„æ ¼å¼ã€‚</p>
<p>æœ€åï¼Œç”¨ @Digits æ³¨é‡Š ccCVV å±æ€§ï¼Œä»¥ç¡®ä¿å€¼æ°å¥½åŒ…å«ä¸‰ä¸ªæ•°å­—ã€‚</p>
<p>æ‰€æœ‰çš„éªŒè¯æ³¨é‡Šéƒ½åŒ…å«ä¸€ä¸ªæ¶ˆæ¯å±æ€§ï¼Œè¯¥å±æ€§å®šä¹‰äº†å¦‚æœç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ä¸ç¬¦åˆå£°æ˜çš„éªŒè¯è§„åˆ™çš„è¦æ±‚æ—¶å°†æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ¶ˆæ¯ã€‚</p>
<h3 id="è¡¨å•ç»‘å®šæ—¶æ‰§è¡Œæ ¡éªŒ"><a href="#è¡¨å•ç»‘å®šæ—¶æ‰§è¡Œæ ¡éªŒ" class="headerlink" title="è¡¨å•ç»‘å®šæ—¶æ‰§è¡Œæ ¡éªŒ"></a>è¡¨å•ç»‘å®šæ—¶æ‰§è¡Œæ ¡éªŒ</h3><p>ä¸Šä¸€èŠ‚åœ¨é¢†åŸŸç±»ä¸­åˆ¶å®šäº†éªŒè¯è§„åˆ™ï¼Œç°åœ¨éœ€è¦é‡æ–°ä¿®æ”¹æ¯ä¸ªæ§åˆ¶å™¨ï¼Œè®©è¡¨å•åœ¨POSTæäº¤è‡³å¯¹åº”çš„æ§åˆ¶å™¨æ–¹æ³•æ—¶æ‰§è¡Œå¯¹åº”çš„æ ¡éªŒã€‚</p>
<p>è¦éªŒè¯æäº¤çš„ Tacoï¼Œéœ€è¦å°† Java Bean Validation API çš„ @Valid æ³¨é‡Šæ·»åŠ åˆ° DesignTacoController çš„ processDesign() æ–¹æ³•çš„ Taco å‚æ•°ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">processDesign</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@ModelAttribute(&quot;design&quot;)</span> Taco design, Errors errors)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Save the taco design...</span></span><br><span class="line">    <span class="comment">// We&#x27;ll do this in chapter 3</span></span><br><span class="line">    log.info(<span class="string">&quot;Processing design: &quot;</span> + design);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/orders/current&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Valid æ³¨é‡Šå‘Šè¯‰ Spring MVC åœ¨æäº¤çš„ Taco å¯¹è±¡ç»‘å®šåˆ°æäº¤çš„è¡¨å•æ•°æ®ä¹‹åï¼Œä»¥åŠè°ƒç”¨ processDesign() æ–¹æ³•ä¹‹å‰ï¼Œå¯¹æäº¤çš„ Taco å¯¹è±¡æ‰§è¡ŒéªŒè¯ã€‚å¦‚æœå­˜åœ¨ä»»ä½•éªŒè¯é”™è¯¯ï¼Œè¿™äº›é”™è¯¯çš„è¯¦ç»†ä¿¡æ¯å°†åœ¨ä¼ é€’åˆ° processDesign() çš„é”™è¯¯å¯¹è±¡ä¸­æ•è·ã€‚processDesign() çš„å‰å‡ è¡ŒæŸ¥è¯¢ Errors å¯¹è±¡ï¼Œè¯¢é—®å®ƒçš„ hasErrors() æ–¹æ³•æ˜¯å¦å­˜åœ¨ä»»ä½•éªŒè¯é”™è¯¯ã€‚å¦‚æœæœ‰ï¼Œè¯¥æ–¹æ³•ç»“æŸæ—¶ä¸å¤„ç† Tacoï¼Œå¹¶è¿”å› â€œdesignâ€ è§†å›¾åï¼Œä»¥ä¾¿é‡æ–°æ˜¾ç¤ºè¡¨å•ã€‚</p>
<p>è¦å¯¹æäº¤çš„ Order å¯¹è±¡æ‰§è¡ŒéªŒè¯ï¼Œè¿˜éœ€è¦å¯¹ OrderController çš„ processOrder() æ–¹æ³•è¿›è¡Œç±»ä¼¼çš„æ›´æ”¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;orderForm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    log.info(<span class="string">&quot;Order submitted: &quot;</span> + order);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰éªŒè¯é”™è¯¯ï¼Œåˆ™å…è®¸è¯¥æ–¹æ³•å¤„ç†æäº¤çš„æ•°æ®ã€‚å¦‚æœå­˜åœ¨éªŒè¯é”™è¯¯ï¼Œåˆ™è¯·æ±‚å°†è¢«è½¬å‘åˆ°è¡¨å•è§†å›¾ï¼Œä»¥ä¾¿ç”¨æˆ·æœ‰æœºä¼šçº æ­£å…¶é”™è¯¯ã€‚</p>
<h3 id="æ˜¾ç¤ºéªŒè¯é”™è¯¯"><a href="#æ˜¾ç¤ºéªŒè¯é”™è¯¯" class="headerlink" title="æ˜¾ç¤ºéªŒè¯é”™è¯¯"></a>æ˜¾ç¤ºéªŒè¯é”™è¯¯</h3><p>å‰é¢ä¼šåœ¨ä¼ å…¥æ§åˆ¶å™¨ä¹‹å‰è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æœ‰è¯¯ï¼Œåˆ™è¿”å›ä¹‹å‰é¡µé¢ã€‚</p>
<p>ä½†æ˜¯ç”¨æˆ·å¦‚ä½•çŸ¥é“å“ªäº›é”™è¯¯éœ€è¦æ”¹æ­£å‘¢ï¼Ÿé™¤éè°ƒå‡ºè¡¨å•ä¸Šçš„é”™è¯¯ï¼Œå¦åˆ™ç”¨æˆ·å°†åªèƒ½çŒœæµ‹å¦‚ä½•æˆåŠŸæäº¤è¡¨å•ã€‚</p>
<p>Thymeleaf é€šè¿‡ fields å±æ€§åŠå…¶ <code>th:errors</code> å±æ€§æä¾›äº†å¯¹ Errors å¯¹è±¡çš„ä¾¿æ·è®¿é—®ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨ä¿¡ç”¨å¡å·å­—æ®µä¸Šæ˜¾ç¤ºéªŒè¯é”™è¯¯ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ª <code>&lt;span&gt; </code>å…ƒç´ ï¼Œè¯¥å…ƒç´ å°†è¿™äº›é”™è¯¯å¼•ç”¨ç”¨äºè®¢å•æ¨¡æ¿ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;label <span class="keyword">for</span>=<span class="string">&quot;ccNumber&quot;</span>&gt;Credit Card #: &lt;/label&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> th:field=<span class="string">&quot;*&#123;ccNumber&#125;&quot;</span>/&gt;</span><br><span class="line">&lt;span class=<span class="string">&quot;validationError&quot;</span></span><br><span class="line">      th:<span class="keyword">if</span>=<span class="string">&quot;$&#123;#fields.hasErrors(&#x27;ccNumber&#x27;)&#125;&quot;</span></span><br><span class="line">      th:errors=<span class="string">&quot;*&#123;ccNumber&#125;&quot;</span>&gt;CC Num Error&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†å¯ä»¥ç”¨æ¥è®¾ç½®é”™è¯¯æ ·å¼ä»¥å¼•èµ·ç”¨æˆ·æ³¨æ„çš„ class å±æ€§å¤–ï¼Œ<span> å…ƒç´ è¿˜ä½¿ç”¨ <code>th:if</code> å±æ€§æ¥å†³å®šæ˜¯å¦æ˜¾ç¤º <span>ã€‚fields å±æ€§çš„ hasErrors() æ–¹æ³•æ£€æŸ¥ ccNumber å­—æ®µä¸­æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯ã€‚å¦‚æœæœ‰é”™è¯¯ï¼Œ<span> å°†è¢«æ¸²æŸ“ã€‚</p>
<p><code>th:errors</code> å±æ€§å¼•ç”¨ ccNumber å­—æ®µï¼Œå¹¶ä¸”å‡è®¾è¯¥å­—æ®µå­˜åœ¨é”™è¯¯ï¼Œå®ƒå°†ç”¨éªŒè¯æ¶ˆæ¯æ›¿æ¢ <span> å…ƒç´ çš„å ä½ç¬¦å†…å®¹ã€‚</p>
<h2 id="ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨"><a href="#ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨" class="headerlink" title="ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨"></a>ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»ä¸º Taco Cloud åº”ç”¨ç¨‹åºç¼–å†™äº†ä¸‰ä¸ªæ§åˆ¶å™¨ã€‚å°½ç®¡æ¯ä¸ªæ§åˆ¶å™¨åœ¨åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ä¸Šéƒ½æœ‰ä¸åŒçš„ç”¨é€”ï¼Œä½†å®ƒä»¬å‡ ä¹éƒ½éµå¾ªç›¸åŒçš„ç¼–ç¨‹æ¨¡å‹ï¼š</p>
<ul>
<li>å®ƒä»¬éƒ½ç”¨ @Controller è¿›è¡Œäº†æ³¨é‡Šï¼Œä»¥è¡¨æ˜å®ƒä»¬æ˜¯æ§åˆ¶å™¨ç±»ï¼Œåº”è¯¥ç”± Spring ç»„ä»¶æ‰«æè‡ªåŠ¨å‘ç°ï¼Œå¹¶åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä½œä¸º bean è¿›è¡Œå®ä¾‹åŒ–ã€‚</li>
<li>é™¤äº† HomeController ä¹‹å¤–ï¼Œæ‰€æœ‰çš„æ§åˆ¶å™¨éƒ½åœ¨ç±»çº§åˆ«ä¸Šä½¿ç”¨ @RequestMapping è¿›è¡Œæ³¨é‡Šï¼Œä»¥å®šä¹‰æ§åˆ¶å™¨å°†å¤„ç†çš„åŸºæœ¬è¯·æ±‚æ¨¡å¼ã€‚</li>
<li>å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½ç”¨ @GetMapping æˆ– @PostMapping è¿›è¡Œäº†æ³¨é‡Šï¼Œä»¥æä¾›å…³äºå“ªäº›æ–¹æ³•åº”è¯¥å¤„ç†å“ªäº›è¯·æ±‚çš„ç»†èŠ‚ã€‚</li>
</ul>
<p>å³å°†ç¼–å†™çš„å¤§å¤šæ•°æ§åˆ¶å™¨éƒ½å°†éµå¾ªè¿™ç§æ¨¡å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ§åˆ¶å™¨è¶³å¤Ÿç®€å•ï¼Œä¸å¡«å……æ¨¡å‹æˆ–æµç¨‹è¾“å…¥ï¼ˆå°±åƒ HomeController ä¸€æ ·ï¼‰ï¼Œé‚£ä¹ˆè¿˜æœ‰å¦ä¸€ç§å®šä¹‰æ§åˆ¶å™¨çš„æ–¹æ³•ã€‚è¯·æŸ¥çœ‹ä¸‹ä¸€ä¸ªç¨‹åºæ¸…å•ï¼Œäº†è§£å¦‚ä½•å£°æ˜è§†å›¾æ§åˆ¶å™¨ â€”â€” ä¸€ä¸ªåªå°†è¯·æ±‚è½¬å‘ç»™è§†å›¾çš„æ§åˆ¶å™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;home&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³äº @WebConfig æœ€å€¼å¾—æ³¨æ„çš„æ˜¯å®ƒå®ç°äº† WebMvcConfigurer æ¥å£ã€‚WebMvcConfigurer å®šä¹‰äº†å‡ ä¸ªé…ç½® Spring MVC çš„æ–¹æ³•ã€‚å°½ç®¡å®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä½†å®ƒæä¾›äº†æ‰€æœ‰æ–¹æ³•çš„é»˜è®¤å®ç°ï¼Œå› æ­¤åªéœ€è¦†ç›–æ‰€éœ€çš„æ–¹æ³•ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¦†ç›–äº† addViewControllers() æ–¹æ³•ã€‚</p>
<p>addViewControllers() æ–¹æ³•æä¾›äº†ä¸€ä¸ª ViewControllerRegistryï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥æ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªè§†å›¾æ§åˆ¶å™¨ã€‚åœ¨è¿™é‡Œï¼Œåœ¨æ³¨å†Œè¡¨ä¸Šè°ƒç”¨ addViewController()ï¼Œä¼ å…¥ â€œ&#x2F;â€ï¼Œè¿™æ˜¯è§†å›¾æ§åˆ¶å™¨å¤„ç† GET è¯·æ±‚çš„è·¯å¾„ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª ViewControllerRegistration å¯¹è±¡ï¼Œåœ¨è¯¥å¯¹è±¡ä¸Šç«‹å³è°ƒç”¨ setViewName() æ¥æŒ‡å®š home ä½œä¸ºåº”è¯¥è½¬å‘ â€œ&#x2F;â€ è¯·æ±‚çš„è§†å›¾ã€‚</p>
<p>å°±åƒè¿™æ ·ï¼Œå·²ç»èƒ½å¤Ÿç”¨é…ç½®ç±»ä¸­çš„å‡ è¡Œä»£ç æ›¿æ¢ HomeControllerã€‚ç°åœ¨å¯ä»¥åˆ é™¤ HomeControllerï¼Œåº”ç”¨ç¨‹åºçš„è¡Œä¸ºåº”è¯¥ä¸ä»¥å‰ä¸€æ ·ã€‚æƒŸä¸€éœ€è¦åšçš„å…¶ä»–æ›´æ”¹æ˜¯é‡æ–°è®¿é—®ç¬¬ 1 ç« ä¸­çš„ HomeControllerTestï¼Œä» @WebMvcTest æ³¨é‡Šä¸­åˆ é™¤å¯¹ HomeController çš„å¼•ç”¨ï¼Œè¿™æ ·æµ‹è¯•ç±»å°±å¯ä»¥æ— é”™è¯¯åœ°ç¼–è¯‘äº†ã€‚</p>
<p>è¿™é‡Œï¼Œå·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ WebConfig é…ç½®ç±»æ¥å­˜æ”¾è§†å›¾æ§åˆ¶å™¨å£°æ˜ã€‚ä½†æ˜¯ä»»ä½•é…ç½®ç±»éƒ½å¯ä»¥å®ç° WebMvcConfigurer å¹¶è¦†ç›– addViewController() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†ç›¸åŒçš„è§†å›¾æ§åˆ¶å™¨å£°æ˜æ·»åŠ åˆ°å¼•å¯¼ TacoCloudApplication ç±»ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TacoCloudApplication</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(TacoCloudApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;home&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ‰©å±•ç°æœ‰çš„é…ç½®ç±»ï¼Œå¯ä»¥é¿å…åˆ›å»ºæ–°çš„é…ç½®ç±»ï¼Œä»è€Œé™ä½é¡¹ç›®å·¥ä»¶æ•°é‡ã€‚ä½†æ˜¯æˆ‘å€¾å‘äºä¸ºæ¯ç§é…ç½®ï¼ˆwebã€æ•°æ®ã€å®‰å…¨æ€§ç­‰ç­‰ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®ç±»ï¼Œä¿æŒåº”ç”¨ç¨‹åºå¼•å¯¼é…ç½®çš„ç®€æ´ã€‚</p>
<p>è¯´åˆ°è§†å›¾æ§åˆ¶å™¨ï¼Œæ›´ä¸€èˆ¬åœ°è¯´ï¼Œæ˜¯æ§åˆ¶å™¨å°†è¯·æ±‚è½¬å‘ç»™çš„è§†å›¾ã€‚</p>
<h2 id="è§†å›¾æ¨¡æ¿åº“"><a href="#è§†å›¾æ¨¡æ¿åº“" class="headerlink" title="è§†å›¾æ¨¡æ¿åº“"></a>è§†å›¾æ¨¡æ¿åº“</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥é€‰æ‹©æƒ³è¦çš„è§†å›¾æ¨¡æ¿åº“ï¼Œå°†å…¶ä½œä¸ºä¾èµ–é¡¹æ·»åŠ åˆ°æ„å»ºä¸­ï¼Œç„¶åå¼€å§‹åœ¨ &#x2F;templates ç›®å½•ä¸­ï¼ˆåœ¨ Maven æˆ– Gradl æ„å»ºé¡¹ç›®çš„ src&#x2F;main&#x2F;resources ç›®å½•ä¸‹ï¼‰ç¼–å†™æ¨¡æ¿ã€‚Spring Boot å°†æ£€æµ‹é€‰æ‹©çš„æ¨¡æ¿åº“ï¼Œå¹¶è‡ªåŠ¨é…ç½®æ‰€éœ€çš„ç»„ä»¶æ¥ä¸º Spring MVC æ§åˆ¶å™¨æä¾›è§†å›¾ã€‚</p>
<p>å·²ç»åœ¨ Taco Cloud åº”ç”¨ç¨‹åºä¸­ç”¨ Thymeleaf å®ç°äº†è¿™ä¸€ç‚¹ã€‚åœ¨ç¬¬ 1 ç« ä¸­ï¼Œåœ¨åˆå§‹åŒ–é¡¹ç›®æ—¶é€‰æ‹©äº† Thymeleaf å¤é€‰æ¡†ã€‚è¿™å¯¼è‡´ Spring Boot çš„ Thymeleaf starter è¢«åŒ…å«åœ¨ pom.xml æ–‡ä»¶ä¸­ã€‚å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring Boot è‡ªåŠ¨é…ç½®ä¼šæ£€æµ‹åˆ° Thymeleaf çš„å­˜åœ¨ï¼Œå¹¶è‡ªåŠ¨é…ç½® Thymeleaf beanã€‚ç°åœ¨è¦åšçš„å°±æ˜¯å¼€å§‹åœ¨ &#x2F;templates ä¸­ç¼–å†™æ¨¡æ¿ã€‚</p>
<p>å¦‚æœå¸Œæœ›ä½¿ç”¨ä¸åŒçš„æ¨¡æ¿åº“ï¼Œåªéœ€åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶é€‰æ‹©å®ƒï¼Œæˆ–è€…ç¼–è¾‘ç°æœ‰çš„é¡¹ç›®æ„å»ºä»¥åŒ…å«æ–°é€‰æ‹©çš„æ¨¡æ¿åº“ã€‚</p>
<h2 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ul>
<li>Spring æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„ web æ¡†æ¶ï¼Œç§°ä¸º Spring MVCï¼Œå¯ä»¥ç”¨äºå¼€å‘ Spring åº”ç”¨ç¨‹åºçš„ web å‰ç«¯ã€‚</li>
<li>Spring MVC æ˜¯åŸºäºæ³¨è§£çš„ï¼Œå¯ä»¥ä½¿ç”¨ @RequestMappingã€@GetMapping å’Œ @PostMapping ç­‰æ³¨è§£æ¥å£°æ˜è¯·æ±‚å¤„ç†æ–¹æ³•ã€‚</li>
<li>å¤§å¤šæ•°è¯·æ±‚å¤„ç†æ–¹æ³•é€šè¿‡è¿”å›è§†å›¾çš„é€»è¾‘åç§°æ¥ç»“æŸï¼Œä¾‹å¦‚ä¸€ä¸ª Thymeleaf æ¨¡æ¿ï¼Œè¯·æ±‚ï¼ˆä»¥åŠä»»ä½•æ¨¡å‹æ•°æ®ï¼‰è¢«è½¬å‘åˆ°è¯¥æ¨¡æ¿ã€‚</li>
<li>Spring MVC é€šè¿‡ Java Bean Validation API å’Œ Hibernate Validator ç­‰éªŒè¯ API çš„å®ç°æ¥æ”¯æŒéªŒè¯ã€‚</li>
<li>è§†å›¾æ§åˆ¶å™¨å¯ä»¥ç”¨æ¥å¤„ç†ä¸éœ€è¦æ¨¡å‹æ•°æ®æˆ–å¤„ç†çš„ HTTP GET è¯·æ±‚ã€‚</li>
<li>é™¤äº† Thymeleafï¼ŒSpring è¿˜æ”¯æŒå¤šç§è§†å›¾é€‰é¡¹ï¼ŒåŒ…æ‹¬ FreeMarkerã€Groovy Templates å’Œ Mustacheã€‚</li>
</ul>
<h1 id="ç¬¬ä¸‰ç« -ä½¿ç”¨æ•°æ®"><a href="#ç¬¬ä¸‰ç« -ä½¿ç”¨æ•°æ®" class="headerlink" title="ç¬¬ä¸‰ç«  ä½¿ç”¨æ•°æ®"></a>ç¬¬ä¸‰ç«  ä½¿ç”¨æ•°æ®</h1><p>æœ¬ç« å†…å®¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ Spring JdbcTemplate</li>
<li>ä½¿ç”¨ SimpleJdbcInsert æ’å…¥æ•°æ®</li>
<li>ä½¿ç”¨ Spring Data å£°æ˜ JPA repositories</li>
</ul>
<p>åœ¨ Taco Cloud åº”ç”¨ç¨‹åºä¸­ï¼Œéœ€è¦èƒ½å¤Ÿç»´æŠ¤å…³äº ingredientsã€tacos å’Œ orders çš„ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªæ•°æ®åº“æ¥å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼Œåº”ç”¨ç¨‹åºå°†æ— æ³•æ¯”åœ¨ç¬¬ 2 ç« ä¸­å¼€å‘çš„åº”ç”¨ç¨‹åºå–å¾—æ›´å¤§çš„è¿›å±•ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œå°†å‘ Taco Cloud åº”ç”¨ç¨‹åºæ·»åŠ æ•°æ®æŒä¹…åŒ–æ“ä½œã€‚é¦–å…ˆä½¿ç”¨ Spring å¯¹ JDBCï¼ˆJava Database Connectivityï¼‰çš„æ”¯æŒæ¥æ¶ˆé™¤æ ·æ¿ä»£ç ã€‚ç„¶åï¼Œå°†é‡æ–°ä½¿ç”¨ JPAï¼ˆJava Persistence APIï¼‰å¤„ç†æ•°æ®å­˜å‚¨åº“ï¼Œä»è€Œæ¶ˆé™¤æ›´å¤šä»£ç ã€‚</p>
<p>åœ¨å¤„ç†å…³ç³»æ•°æ®æ—¶ï¼ŒJava å¼€å‘äººå‘˜æœ‰å¤šä¸ªé€‰æ‹©ã€‚ä¸¤ä¸ªæœ€å¸¸è§çš„é€‰æ‹©æ˜¯ JDBC å’Œ JPAã€‚Spring é€šè¿‡æŠ½è±¡æ”¯æŒè¿™ä¸¤ç§æ–¹å¼ï¼Œè¿™ä½¿å¾—ä½¿ç”¨ JDBC æˆ– JPA æ¯”ä¸ä½¿ç”¨ Spring æ›´å®¹æ˜“ã€‚</p>
<h2 id="ä½¿ç”¨-JDBC-è¯»å†™æ•°æ®"><a href="#ä½¿ç”¨-JDBC-è¯»å†™æ•°æ®" class="headerlink" title="ä½¿ç”¨ JDBC è¯»å†™æ•°æ®"></a>ä½¿ç”¨ JDBC è¯»å†™æ•°æ®</h2><p>Spring JDBC æ”¯æŒèµ·æºäº JdbcTemplate ç±»ã€‚JdbcTemplate æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå¼€å‘äººå‘˜å¯ä»¥å¯¹å…³ç³»æ•°æ®åº“æ‰§è¡Œ SQL æ“ä½œï¼Œä¸é€šå¸¸ä½¿ç”¨ JDBC ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œä¸éœ€è¦æ»¡è¶³æ‰€æœ‰çš„æ¡ä»¶å’Œæ ·æ¿ä»£ç ã€‚</p>
<p>åœ¨æ²¡æœ‰ JdbcTemplate çš„æƒ…å†µä¸‹ç”¨ Java æ‰§è¡Œä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Ingredient <span class="title function_">findOne</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        connection = dataSource.getConnection();</span><br><span class="line">        statement = connection.prepareStatement(</span><br><span class="line">            <span class="string">&quot;select id, name, type from Ingredient&quot;</span>);</span><br><span class="line">        statement.setString(<span class="number">1</span>, id);</span><br><span class="line">        resultSet = statement.executeQuery();</span><br><span class="line">        <span class="type">Ingredient</span> <span class="variable">ingredient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(resultSet.next()) &#123;</span><br><span class="line">            ingredient = <span class="keyword">new</span> <span class="title class_">Ingredient</span>(</span><br><span class="line">                resultSet.getString(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">                resultSet.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">                Ingredient.Type.valueOf(resultSet.getString(<span class="string">&quot;type&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ingredient;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        <span class="comment">// ??? What should be done here ???</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (resultSet != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (statement != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢è¯­å¥è¢«åˆ›å»ºè¿æ¥ã€åˆ›å»ºè¯­å¥å’Œé€šè¿‡å…³é—­è¿æ¥ã€è¯­å¥å’Œç»“æœé›†æ¥æ¸…ç†çš„ä»£ç æ‰€åŒ…å›´ã€‚</p>
<p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œåœ¨åˆ›å»ºè¿æ¥æˆ–è¯­å¥æˆ–æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è®¸å¤šé—®é¢˜ã€‚è¿™è¦æ±‚æ•è·ä¸€ä¸ª SQLExceptionï¼Œè¿™å¯èƒ½æœ‰åŠ©äºï¼ˆä¹Ÿå¯èƒ½æ— åŠ©äºï¼‰æ‰¾å‡ºé—®é¢˜å‡ºåœ¨å“ªé‡Œæˆ–å¦‚ä½•è§£å†³é—®é¢˜ã€‚</p>
<p>SQLException æ˜¯ä¸€ä¸ªè¢«æ£€æŸ¥çš„å¼‚å¸¸ï¼Œå®ƒéœ€è¦åœ¨ catch å—ä¸­è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯æœ€å¸¸è§çš„é—®é¢˜ï¼Œå¦‚æœªèƒ½åˆ›å»ºåˆ°æ•°æ®åº“çš„è¿æ¥æˆ–è¾“å…¥é”™è¯¯çš„æŸ¥è¯¢ï¼Œä¸å¯èƒ½åœ¨ catch å—ä¸­å¾—åˆ°è§£å†³ï¼Œå¯èƒ½ä¼šé‡æ–°å‘ä¸ŠæŠ›å‡ºä»¥æ±‚å¤„ç†ã€‚ç›¸åï¼Œè¦æ˜¯è€ƒè™‘ä½¿ç”¨ JdbcTemplate çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Ingredient <span class="title function_">findOne</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.queryForObject(</span><br><span class="line">        <span class="string">&quot;select id, name, type from Ingredient where id=?&quot;</span>,</span><br><span class="line">        <span class="built_in">this</span>::mapRowToIngredient, id);</span><br><span class="line">&#125;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">private</span> Ingredient <span class="title function_">mapRowToIngredient</span><span class="params">(ResultSet rs, <span class="type">int</span> rowNum)</span></span><br><span class="line">    <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ingredient</span>(</span><br><span class="line">        rs.getString(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">        rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">        Ingredient.Type.valueOf(rs.getString(<span class="string">&quot;type&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰åˆ›å»ºä»»ä½•è¯­å¥æˆ–è¿æ¥ã€‚è€Œä¸”ï¼Œåœ¨æ–¹æ³•å®Œæˆä¹‹åï¼Œä¸ä¼šå¯¹é‚£äº›å¯¹è±¡è¿›è¡Œä»»ä½•æ¸…ç†ã€‚æœ€åï¼Œè¿™æ ·åšä¸ä¼šå­˜åœ¨ä»»ä½•åœ¨ catch å—ä¸­ä¸èƒ½å¤„ç†çš„å¼‚å¸¸ã€‚å‰©ä¸‹çš„ä»£ç åªä¸“æ³¨äºæ‰§è¡ŒæŸ¥è¯¢ï¼ˆè°ƒç”¨ JdbcTemplate çš„ queryForObject() æ–¹æ³•ï¼‰å¹¶å°†ç»“æœæ˜ å°„åˆ° Ingredient å¯¹è±¡ï¼ˆåœ¨ mapRowToIngredient() æ–¹æ³•ä¸­ï¼‰ã€‚</p>
<h3 id="ä¸ºåŸŸé€‚é…æŒä¹…åŒ–"><a href="#ä¸ºåŸŸé€‚é…æŒä¹…åŒ–" class="headerlink" title="ä¸ºåŸŸé€‚é…æŒä¹…åŒ–"></a>ä¸ºåŸŸé€‚é…æŒä¹…åŒ–</h3><p>åœ¨å°†å¯¹è±¡æŒä¹…åŒ–åˆ°æ•°æ®åº“æ—¶ï¼Œé€šå¸¸æœ€å¥½æœ‰ä¸€ä¸ªæƒŸä¸€æ ‡è¯†å¯¹è±¡çš„å­—æ®µã€‚Ingredient ç±»å·²ç»æœ‰ä¸€ä¸ª id å­—æ®µï¼Œä½†æ˜¯éœ€è¦å‘ Taco å’Œ Order æ·»åŠ  id å­—æ®µã€‚è¿˜éœ€è¦å‘æ¯ä¸ªå¯¹è±¡æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œä»¥æ•è·ä¿å­˜å¯¹è±¡çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</p>
<p>æ–°çš„tacoï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Taco</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Date createdAt;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–°çš„orderï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Date placedAt;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºä½¿ç”¨ Lombok åœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆè®¿é—®å™¨æ–¹æ³•ï¼Œæ‰€ä»¥é™¤äº†å£°æ˜ id å’Œ createdAt å±æ€§å¤–ï¼Œä¸éœ€è¦åšä»»ä½•äº‹æƒ…ã€‚å®ƒä»¬å°†åœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦ç”Ÿæˆé€‚å½“çš„ getter å’Œ setter æ–¹æ³•ã€‚</p>
<h3 id="ä½¿ç”¨-JdbcTemplate"><a href="#ä½¿ç”¨-JdbcTemplate" class="headerlink" title="ä½¿ç”¨ JdbcTemplate"></a><strong>ä½¿ç”¨ JdbcTemplate</strong></h3><p>åœ¨å¼€å§‹ä½¿ç”¨ JdbcTemplate ä¹‹å‰ï¼Œéœ€è¦å°†å®ƒæ·»åŠ åˆ°é¡¹ç›®ç±»è·¯å¾„ä¸­ã€‚è¿™å¾ˆå®¹æ˜“é€šè¿‡æ·»åŠ  Spring Boot çš„ JDBC starter ä¾èµ–æ¥å®ç°ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿˜éœ€è¦ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„æ•°æ®åº“ã€‚å‡ºäºå¼€å‘ç›®çš„ï¼ŒåµŒå…¥å¼æ•°æ®åº“è¶³çŸ£ã€‚æˆ‘å–œæ¬¢ H2 åµŒå…¥å¼æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘æ·»åŠ äº†ä»¥ä¸‹ä¾èµ–è¿›è¡Œæ„å»ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><em><strong>å†™ä¸€ä¸ªè·å–å’Œä¿å­˜ Ingredient æ•°æ®çš„å­˜å‚¨åº“ï¼š</strong></em></p>
<h4 id="ï¼ˆ1ï¼‰å®šä¹‰-JDBC-æ•°æ®åº“æ¥å£"><a href="#ï¼ˆ1ï¼‰å®šä¹‰-JDBC-æ•°æ®åº“æ¥å£" class="headerlink" title="ï¼ˆ1ï¼‰å®šä¹‰ JDBC æ•°æ®åº“æ¥å£"></a>ï¼ˆ1ï¼‰å®šä¹‰ JDBC æ•°æ®åº“æ¥å£</h4><p>Ingredient repository éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>æŸ¥è¯¢æ‰€æœ‰çš„ Ingredient ä½¿ä¹‹å˜æˆä¸€ä¸ª Ingredient çš„é›†åˆå¯¹è±¡</li>
<li>é€šè¿‡å®ƒçš„ id æŸ¥è¯¢å•ä¸ª Ingredient</li>
<li>ä¿å­˜ä¸€ä¸ª Ingredient å¯¹è±¡</li>
</ul>
<p>ä»¥ä¸‹ IngredientRepository æ¥å£ä»¥æ–¹æ³•å£°æ˜çš„æ–¹å¼å®šä¹‰äº†è¿™ä¸‰ç§æ“ä½œï¼š<strong>æ¯ä¸€ä¸ªåº“ä¸€ä¸ªå•ç‹¬æ¥å£æ–‡ä»¶</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IngredientRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">    Iterable&lt;Ingredient&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    Ingredient <span class="title function_">findOne</span><span class="params">(String id)</span>;</span><br><span class="line">    </span><br><span class="line">    Ingredient <span class="title function_">save</span><span class="params">(Ingredient ingredient)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ï¼ˆ2ï¼‰ä½¿ç”¨-JdbcTemplate-ç¼–å†™å…·ä½“æ“ä½œï¼Œè¯»å–"><a href="#ï¼ˆ2ï¼‰ä½¿ç”¨-JdbcTemplate-ç¼–å†™å…·ä½“æ“ä½œï¼Œè¯»å–" class="headerlink" title="ï¼ˆ2ï¼‰ä½¿ç”¨ JdbcTemplate ç¼–å†™å…·ä½“æ“ä½œï¼Œè¯»å–"></a>ï¼ˆ2ï¼‰ä½¿ç”¨ JdbcTemplate ç¼–å†™å…·ä½“æ“ä½œï¼Œè¯»å–</h4><p>ç¼–å†™ä¸€ä¸ªä½¿ç”¨ JdbcTemplate æ¥æŸ¥è¯¢æ•°æ®åº“çš„ IngredientRepository çš„å®ç°ã€‚<strong>æ¯ä¸€ä¸ªåº“ä¸€ä¸ªå…·ä½“æ“ä½œç±»æ–‡ä»¶ï¼Œæ–¹æ³•ä»£è¡¨æŸ¥è¯¢æ’å…¥ç­‰ã€‚</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcIngredientRepository</span> <span class="keyword">implements</span> <span class="title class_">IngredientRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JdbcIngredientRepository</span><span class="params">(JdbcTemplate jdbc)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jdbc = jdbc;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">â€‹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JdbcIngredientRepository ä½¿ç”¨ @Repository è¿›è¡Œäº†æ³¨è§£ã€‚è¿™ä¸ªæ³¨è§£æ˜¯ Spring å®šä¹‰çš„å°‘æ•°å‡ ä¸ªåŸå‹æ³¨è§£ä¹‹ä¸€ï¼ŒåŒ…æ‹¬ @Controller å’Œ @Componentã€‚é€šè¿‡ä½¿ç”¨ @Repository å¯¹ JdbcIngredientRepository è¿›è¡Œæ³¨è§£ï¼Œè¿™æ ·å®ƒå°±ä¼šç”± Spring ç»„ä»¶åœ¨æ‰«ææ—¶è‡ªåŠ¨å‘ç°ï¼Œå¹¶åœ¨ Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ç”Ÿæˆ bean å®ä¾‹ã€‚</p>
<p>å½“ Spring åˆ›å»º JdbcIngredientRepository bean æ—¶ï¼Œé€šè¿‡ @Autowired æ³¨è§£å°† JdbcTemplate æ³¨å…¥åˆ° bean ä¸­ã€‚æ„é€ å‡½æ•°å°† JdbcTemplate åˆ†é…ç»™ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œè¯¥å˜é‡å°†åœ¨å…¶ä»–æ–¹æ³•ä¸­ç”¨äºæŸ¥è¯¢å’Œæ’å…¥æ•°æ®åº“ã€‚è°ˆåˆ°é‚£äº›å…¶ä»–æ–¹æ³•ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ findAll() å’Œ findOne() çš„å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Iterable&lt;Ingredient&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.query(<span class="string">&quot;select id, name, type from Ingredient&quot;</span>,</span><br><span class="line">              <span class="built_in">this</span>::mapRowToIngredient);</span><br><span class="line">&#125;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Ingredient <span class="title function_">findOne</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.queryForObject(</span><br><span class="line">        <span class="string">&quot;select id, name, type from Ingredient where id=?&quot;</span>,</span><br><span class="line">        <span class="built_in">this</span>::mapRowToIngredient, id);</span><br><span class="line">&#125;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">private</span> Ingredient <span class="title function_">mapRowToIngredient</span><span class="params">(ResultSet rs, <span class="type">int</span> rowNum)</span></span><br><span class="line">    <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ingredient</span>(</span><br><span class="line">        rs.getString(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">        rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">        Ingredient.Type.valueOf(rs.getString(<span class="string">&quot;type&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>findAll() å’Œ findOne() éƒ½ä»¥ç±»ä¼¼çš„æ–¹å¼ä½¿ç”¨ JdbcTemplateã€‚æœŸæœ›è¿”å›å¯¹è±¡é›†åˆçš„ findAll() æ–¹æ³•ä½¿ç”¨äº† JdbcTemplate çš„ query() æ–¹æ³•ã€‚query() æ–¹æ³•æ¥å—æŸ¥è¯¢çš„ SQL ä»¥åŠ Spring çš„ RowMapper å®ç°ï¼Œä»¥ä¾¿å°†ç»“æœé›†ä¸­çš„æ¯ä¸€è¡Œæ˜ å°„åˆ°ä¸€ä¸ªå¯¹è±¡ã€‚findAll() è¿˜æ¥å—æŸ¥è¯¢ä¸­æ‰€éœ€çš„æ‰€æœ‰å‚æ•°çš„åˆ—è¡¨ä½œä¸ºå®ƒçš„æœ€åä¸€ä¸ªå‚æ•°ã€‚ä½†æ˜¯ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæ²¡æœ‰ä»»ä½•å¿…éœ€çš„å‚æ•°ã€‚</p>
<p>findOne() æ–¹æ³•åªæœŸæœ›è¿”å›å•ä¸ªæˆåˆ†å¯¹è±¡ï¼Œå› æ­¤å®ƒä½¿ç”¨ JdbcTemplate çš„ queryForObject() æ–¹æ³•è€Œä¸æ˜¯ query()ã€‚queryForObject() çš„å·¥ä½œåŸç†ä¸ query() éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å®ƒè¿”å›çš„æ˜¯å•ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯å¯¹è±¡åˆ—è¡¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒç»™å‡ºäº†è¦æ‰§è¡Œçš„æŸ¥è¯¢ã€ä¸€ä¸ª RowMapper å’Œè¦è·å–çš„ Ingredient çš„ idï¼Œåè€…ç”¨äºä»£æ›¿æŸ¥è¯¢ SQL ä¸­ çš„ <code>?</code>ã€‚</p>
<p>findAll() å’Œ findOne() çš„ RowMapper å‚æ•°ä½œä¸º mapRowToIngredient() æ–¹æ³•çš„æ–¹æ³•å¼•ç”¨ã€‚å½“ä½¿ç”¨ JdbcTemplate ä½œä¸ºæ˜¾å¼ RowMapper å®ç°çš„æ›¿ä»£æ–¹æ¡ˆæ—¶ï¼Œä½¿ç”¨ Java 8 çš„æ–¹æ³•å¼•ç”¨å’Œ lambda éå¸¸æ–¹ä¾¿ã€‚ä½†æ˜¯ï¼Œå¦‚æœå‡ºäºæŸç§åŸå› ï¼Œæƒ³è¦æˆ–æ˜¯éœ€è¦ä¸€ä¸ªæ˜¾å¼çš„ RowMapperï¼Œé‚£ä¹ˆ findOne() çš„ä»¥ä¸‹å®ç°å°†å±•ç¤ºå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Ingredient <span class="title function_">findOne</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> jdbc.queryForObject(</span><br><span class="line">        <span class="string">&quot;select id, name, type from Ingredient where id=?&quot;</span>,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">RowMapper</span>&lt;Ingredient&gt;() &#123;</span><br><span class="line">            <span class="keyword">public</span> Ingredient <span class="title function_">mapRow</span><span class="params">(ResultSet rs, <span class="type">int</span> rowNum)</span></span><br><span class="line">                <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ingredient</span>(</span><br><span class="line">                    rs.getString(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">                    rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">                    Ingredient.Type.valueOf(rs.getString(<span class="string">&quot;type&quot;</span>)));</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;, id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ï¼ˆ3ï¼‰æ’å…¥ä¸€è¡Œæ•°æ®"><a href="#ï¼ˆ3ï¼‰æ’å…¥ä¸€è¡Œæ•°æ®" class="headerlink" title="ï¼ˆ3ï¼‰æ’å…¥ä¸€è¡Œæ•°æ®"></a>ï¼ˆ3ï¼‰æ’å…¥ä¸€è¡Œæ•°æ®</h4><p>JdbcTemplate çš„ update() æ–¹æ³•å¯ç”¨äºåœ¨æ•°æ®åº“ä¸­å†™å…¥æˆ–æ›´æ–°æ•°æ®çš„ä»»ä½•æŸ¥è¯¢ã€‚</p>
<p>ä½¿ç”¨JdbcTemplateæ’å…¥æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Ingredient <span class="title function_">save</span><span class="params">(Ingredient ingredient)</span> &#123;</span><br><span class="line">    jdbc.update(</span><br><span class="line">        <span class="string">&quot;insert into Ingredient (id, name, type) values (?, ?, ?)&quot;</span>,</span><br><span class="line">        ingredient.getId(),</span><br><span class="line">        ingredient.getName(),</span><br><span class="line">        ingredient.getType().toString());</span><br><span class="line">    <span class="keyword">return</span> ingredient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ²¡æœ‰å¿…è¦å°† ResultSet æ•°æ®æ˜ å°„åˆ°å¯¹è±¡ï¼Œæ‰€ä»¥ update() æ–¹æ³•è¦æ¯” query() æˆ– queryForObject() ç®€å•å¾—å¤šã€‚å®ƒåªéœ€è¦ä¸€ä¸ªåŒ…å« SQL çš„å­—ç¬¦ä¸²æ¥æ‰§è¡Œï¼Œä»¥åŠä¸ºä»»ä½•æŸ¥è¯¢å‚æ•°èµ‹å€¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒæŸ¥è¯¢æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå®ƒä»¬å¯¹åº”äº save() æ–¹æ³•çš„æœ€åä¸‰ä¸ªå‚æ•°ï¼Œæä¾›äº† Ingredient çš„ idã€name å’Œ typeã€‚</p>
<p>å®Œæˆäº† JdbcIngredientRepositoryåï¼Œç°åœ¨å¯ä»¥å°†å…¶æ³¨å…¥åˆ° DesignTacoController ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æä¾›ä¸€ä¸ª Ingredient å¯¹è±¡åˆ—è¡¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¡¬ç¼–ç çš„å€¼ï¼ˆæ­£å¦‚ç¬¬ 2 ç« ä¸­æ‰€åšçš„é‚£æ ·ï¼‰ã€‚DesignTacoController çš„å˜åŒ–å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/design&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DesignTacoController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IngredientRepository ingredientRepo;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DesignTacoController</span><span class="params">(IngredientRepository ingredientRepo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ingredientRepo = ingredientRepo;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">showDesignForm</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">        List&lt;Ingredient&gt; ingredients = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        ingredientRepo.findAll().forEach(i -&gt; ingredients.add(i));</span><br><span class="line">        Type[] types = Ingredient.Type.values();</span><br><span class="line">        <span class="keyword">for</span> (Type type : types) &#123;</span><br><span class="line">            model.addAttribute(type.toString().toLowerCase(),</span><br><span class="line">                               filterByType(ingredients, type));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>showDesignForm() æ–¹æ³•çš„ç¬¬ 2 è¡Œç°åœ¨è°ƒç”¨äº†æ³¨å…¥çš„ IngredientRepository çš„ findAll() æ–¹æ³•ã€‚findAll() æ–¹æ³•ä»æ•°æ®åº“ä¸­æå–æ‰€æœ‰ Ingredientï¼Œç„¶åå°†å®ƒä»¬å¯¹åº”åˆ°åˆ°æ¨¡å‹çš„ä¸åŒç±»å‹ä¸­ã€‚</p>
<h3 id="å†™è¡¨å¹¶é¢„åŠ è½½æ•°æ®"><a href="#å†™è¡¨å¹¶é¢„åŠ è½½æ•°æ®" class="headerlink" title="å†™è¡¨å¹¶é¢„åŠ è½½æ•°æ®"></a>å†™è¡¨å¹¶é¢„åŠ è½½æ•°æ®</h3><p>åœ¨å¼€å§‹ä»æŸ¥è¯¢ä¸­å¼•ç”¨çš„ Ingredient è¡¨è¯»å–æ•°æ®ä¹‹å‰ï¼Œåº”è¯¥åˆ›å»ºè¿™ä¸ªè¡¨å¹¶å†™ä¸€äº› Ingredient æ•°æ®è¿›å»ã€‚</p>
<p>é™¤äº† Ingredient è¡¨ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä¸€äº›ä¿å­˜è®¢å•å’Œè®¾è®¡ä¿¡æ¯çš„è¡¨ã€‚ä¹Ÿå°±æ˜¯è¦å®šä¹‰æ•°æ®åº“æ•°æ®è§„åˆ™ã€‚createè¯­å¥ã€‚</p>
<ul>
<li>Ingredient - ä¿å­˜ç€åŸæ–™ä¿¡æ¯</li>
<li>Taco - ä¿å­˜ç€å…³äº taco è®¾è®¡çš„é‡è¦ä¿¡æ¯</li>
<li>Taco_Ingredient - åŒ…å« Taco è¡¨ä¸­æ¯ä¸€è¡Œçš„ä¸€ä¸ªæˆ–å¤šè¡Œæ•°æ®ï¼Œå°† Taco æ˜ å°„åˆ°è¯¥ Taco çš„ Ingredientï¼ˆå¦‚æœä¸€ä¸ªtacoæœ‰å¤šä¸ªé…æ–™ï¼Œå°±æ’å…¥å¤šè¡Œï¼‰</li>
<li>Taco_Order - ä¿å­˜ç€é‡è¦çš„è®¢å•ç»†èŠ‚</li>
<li>Taco_Order_Tacos - åŒ…å« Taco_Order è¡¨ä¸­çš„æ¯ä¸€è¡Œçš„ä¸€ä¸ªæˆ–å¤šè¡Œæ•°æ®ï¼Œå°† Order æ˜ å°„åˆ° Order ä¸­çš„Tacos</li>
</ul>
<p>åˆ›å»ºè¡¨çš„sqlè¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Ingredient (</span><br><span class="line">    id <span class="type">varchar</span>(<span class="number">4</span>) <span class="keyword">not null</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">25</span>) <span class="keyword">not null</span>,</span><br><span class="line">    type <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not null</span></span><br><span class="line">);</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Taco (</span><br><span class="line">    id <span class="keyword">identity</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span>,</span><br><span class="line">    createdAt <span class="type">timestamp</span> <span class="keyword">not null</span></span><br><span class="line">);</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Taco_Ingredients (</span><br><span class="line">    taco <span class="type">bigint</span> <span class="keyword">not null</span>,</span><br><span class="line">    ingredient <span class="type">varchar</span>(<span class="number">4</span>) <span class="keyword">not null</span></span><br><span class="line">);</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">alter table</span> Taco_Ingredients <span class="keyword">add</span> <span class="keyword">foreign key</span> (taco) <span class="keyword">references</span> Taco(id);</span><br><span class="line"><span class="keyword">alter table</span> Taco_Ingredients <span class="keyword">add</span> <span class="keyword">foreign key</span> (ingredient) <span class="keyword">references</span> Ingredient(id);</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Taco_Order (</span><br><span class="line">    id <span class="keyword">identity</span>,</span><br><span class="line">    deliveryName <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span>,</span><br><span class="line">    deliveryStreet <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span>,</span><br><span class="line">    deliveryCity <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span>,</span><br><span class="line">    deliveryState <span class="type">varchar</span>(<span class="number">2</span>) <span class="keyword">not null</span>,</span><br><span class="line">    deliveryZip <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not null</span>,</span><br><span class="line">    ccNumber <span class="type">varchar</span>(<span class="number">16</span>) <span class="keyword">not null</span>,</span><br><span class="line">    ccExpiration <span class="type">varchar</span>(<span class="number">5</span>) <span class="keyword">not null</span>,</span><br><span class="line">    ccCVV <span class="type">varchar</span>(<span class="number">3</span>) <span class="keyword">not null</span>,</span><br><span class="line">    placedAt <span class="type">timestamp</span> <span class="keyword">not null</span></span><br><span class="line">);</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> Taco_Order_Tacos (</span><br><span class="line">    tacoOrder <span class="type">bigint</span> <span class="keyword">not null</span>,</span><br><span class="line">    taco <span class="type">bigint</span> <span class="keyword">not null</span></span><br><span class="line">);</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">alter table</span> Taco_Order_Tacos <span class="keyword">add</span> <span class="keyword">foreign key</span> (tacoOrder) <span class="keyword">references</span> Taco_Order(id);</span><br><span class="line"><span class="keyword">alter table</span> Taco_Order_Tacos <span class="keyword">add</span> <span class="keyword">foreign key</span> (taco) <span class="keyword">references</span> Taco(id);</span><br></pre></td></tr></table></figure>

<p>æœ€å¤§çš„é—®é¢˜æ˜¯æŠŠè¿™ä¸ªæ¨¡å¼å®šä¹‰æ”¾åœ¨å“ªé‡Œã€‚äº‹å®è¯æ˜ï¼ŒSpring Boot å›ç­”äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å¦‚æœæœ‰ä¸€ä¸ªåä¸º schema.sql çš„æ–‡ä»¶ã€‚åœ¨åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ sqlï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶å¯¹æ•°æ®åº“æ‰§è¡Œè¯¥æ–‡ä»¶ä¸­çš„ SQLã€‚å› æ­¤ï¼Œåº”è¯¥å°†å®šä¹‰æ•°æ®åº“ çš„å†…å®¹å†™å…¥ä¸€ä¸ªåä¸º schema.sql çš„æ–‡ä»¶ä¸­ï¼Œç„¶åæ”¾åœ¨é¡¹ç›®çš„ src&#x2F;main&#x2F;resources æ–‡ä»¶å¤¹ä¸‹ã€‚</p>
<p>è¿˜éœ€è¦ç”¨ä¸€äº› Ingredient æ•°æ®æ¥é¢„åŠ è½½æ•°æ®åº“ã€‚å¹¸è¿çš„æ˜¯ï¼ŒSpring Boot è¿˜å°†æ‰§è¡Œä¸€ä¸ªåä¸º data.sql çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä½äºæ ¹è·¯å¾„ä¸‹ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ src&#x2F;main&#x2F;resources&#x2F;data.sql ä¸­çš„é¢„åŠ è½½æ•°æ®åº“ç¨‹åºä¸­çš„ insert è¯­å¥æ¥åŠ è½½åŒ…å« Ingredient æ•°æ®çš„æ•°æ®åº“ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Taco_Order_Tacos;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Taco_Ingredients;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Taco;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Taco_Order;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Ingredient;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;FLTO&#x27;</span>, <span class="string">&#x27;Flour Tortilla&#x27;</span>, <span class="string">&#x27;WRAP&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;COTO&#x27;</span>, <span class="string">&#x27;Corn Tortilla&#x27;</span>, <span class="string">&#x27;WRAP&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;GRBF&#x27;</span>, <span class="string">&#x27;Ground Beef&#x27;</span>, <span class="string">&#x27;PROTEIN&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;CARN&#x27;</span>, <span class="string">&#x27;Carnitas&#x27;</span>, <span class="string">&#x27;PROTEIN&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;TMTO&#x27;</span>, <span class="string">&#x27;Diced Tomatoes&#x27;</span>, <span class="string">&#x27;VEGGIES&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;LETC&#x27;</span>, <span class="string">&#x27;Lettuce&#x27;</span>, <span class="string">&#x27;VEGGIES&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;CHED&#x27;</span>, <span class="string">&#x27;Cheddar&#x27;</span>, <span class="string">&#x27;CHEESE&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;JACK&#x27;</span>, <span class="string">&#x27;Monterrey Jack&#x27;</span>, <span class="string">&#x27;CHEESE&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;SLSA&#x27;</span>, <span class="string">&#x27;Salsa&#x27;</span>, <span class="string">&#x27;SAUCE&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> Ingredient (id, name, type) <span class="keyword">values</span> (<span class="string">&#x27;SRCR&#x27;</span>, <span class="string">&#x27;Sour Cream&#x27;</span>, <span class="string">&#x27;SAUCE&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šåªå¼€å‘äº† Ingredient æ•°æ®çš„å­˜å‚¨åº“ï¼Œè¿˜éœ€è¦ç»§ç»­ç¼–å†™ç”¨äºæŒä¹…åŒ– Tacoã€Order çš„å­˜å‚¨åº“å’Œç›¸åº”çš„æ•°æ®ã€‚</p>
<h3 id="å…·ä½“æŒä¹…åŒ–æ–¹æ³•"><a href="#å…·ä½“æŒä¹…åŒ–æ–¹æ³•" class="headerlink" title="å…·ä½“æŒä¹…åŒ–æ–¹æ³•"></a>å…·ä½“æŒä¹…åŒ–æ–¹æ³•</h3><p>åˆ°æ­¤ï¼Œå·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨ JdbcTemplate å‘æ•°æ®åº“å†™å…¥æ•°æ®ã€‚JdbcIngredientRepository ä¸­çš„ save() æ–¹æ³•ä½¿ç”¨ JdbcTemplate çš„ update() æ–¹æ³•å°† Ingredient å¯¹è±¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<p>è™½ç„¶è¿™æ˜¯ç¬¬ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œä½†æ˜¯å®ƒå¯èƒ½æœ‰ç‚¹å¤ªç®€å•äº†ã€‚ä¿å­˜æ•°æ®å¯èƒ½æ¯” JdbcIngredientRepository æ‰€éœ€è¦çš„æ›´å¤æ‚ã€‚ä½¿ç”¨ JdbcTemplate ä¿å­˜æ•°æ®çš„ä¸¤ç§æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç›´æ¥ä½¿ç”¨ update() æ–¹æ³•</li>
<li>ä½¿ç”¨ SimpleJdbcInsert åŒ…è£…ç±»</li>
</ul>
<p>è®©æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹ï¼Œå½“æŒä¹…è¯éœ€æ±‚æ¯”ä¿å­˜ä¸€ä¸ª Ingredient æ‰€éœ€è¦çš„æ›´å¤æ‚æ—¶ï¼Œå¦‚ä½•ä½¿ç”¨ update() æ–¹æ³•ã€‚</p>
<h4 id="ä½¿ç”¨-JdbcTemplate-ä¿å­˜æ•°æ®"><a href="#ä½¿ç”¨-JdbcTemplate-ä¿å­˜æ•°æ®" class="headerlink" title="ä½¿ç”¨ JdbcTemplate ä¿å­˜æ•°æ®"></a>ä½¿ç”¨ JdbcTemplate ä¿å­˜æ•°æ®</h4><p>ç›®å‰ï¼ŒTaco å’Œ Order å­˜å‚¨åº“éœ€è¦åšçš„æƒŸä¸€ä¸€ä»¶äº‹æ˜¯ä¿å­˜å®ƒä»¬å„è‡ªçš„å¯¹è±¡ã€‚ä¸ºäº†ä¿å­˜ Taco å¯¹è±¡ï¼ŒTacoRepository å£°æ˜äº†ä¸€ä¸ª save() æ–¹æ³•ï¼Œæ¥å£å¦‚ä¸‹æ‰€ç¤ºï¼šOrderRepositoryæ¥å£ ä¹Ÿå£°æ˜äº†ä¸€ä¸ª save() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TacoRepository</span> &#123;</span><br><span class="line">    Taco <span class="title function_">save</span><span class="params">(Taco design)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderRepository</span> &#123;</span><br><span class="line">    Order <span class="title function_">save</span><span class="params">(Order order)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜ä¸€ä¸ª Taco è®¾è®¡éœ€è¦å°†ä¸è¯¥ Taco å…³è”çš„ Ingredient ä¿å­˜åˆ° Taco_Ingredient è¡¨ä¸­ã€‚åŒæ ·ï¼Œä¿å­˜ Order ä¹Ÿéœ€è¦å°†ä¸ Order å…³è”çš„ Taco ä¿å­˜åˆ° Taco_Order_Tacos è¡¨ä¸­ã€‚è¿™ä½¿å¾—ä¿å­˜ Taco å’Œ Order æ¯” ä¿å­˜ Ingredient æ›´æœ‰æŒ‘æˆ˜æ€§ã€‚</p>
<p>è¦å®ç° TacoRepositoryï¼Œéœ€è¦ä¸€ä¸ª save() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä¿å­˜åŸºæœ¬çš„ Taco è®¾è®¡ç»†èŠ‚ï¼ˆä¾‹å¦‚ï¼Œåç§°å’Œåˆ›å»ºæ—¶é—´ï¼‰ï¼Œç„¶åä¸º Taco å¯¹è±¡ä¸­çš„æ¯ä¸ª Ingredient åœ¨ Taco_Ingredients ä¸­æ’å…¥ä¸€è¡Œã€‚ä¸‹é¢çš„ç¨‹åºæ˜¾ç¤ºäº†å®Œæ•´çš„ JdbcTacoRepository ç±»ã€‚</p>
<p>ä½¿ç”¨ JdbcTemplate å®ç° TacoRepositoryï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.sql.Types;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.PreparedStatementCreator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.PreparedStatementCreatorFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.support.GeneratedKeyHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.support.KeyHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTacoRepository</span> <span class="keyword">implements</span> <span class="title class_">TacoRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JdbcTacoRepository</span><span class="params">(JdbcTemplate jdbc)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jdbc = jdbc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Taco <span class="title function_">save</span><span class="params">(Taco taco)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">tacoId</span> <span class="operator">=</span> saveTacoInfo(taco);</span><br><span class="line">        taco.setId(tacoId);</span><br><span class="line">        <span class="keyword">for</span> (Ingredient ingredient : taco.getIngredients()) &#123;</span><br><span class="line">            saveIngredientToTaco(ingredient, tacoId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> taco;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">saveTacoInfo</span><span class="params">(Taco taco)</span> &#123;</span><br><span class="line">        taco.setCreatedAt(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">PreparedStatementCreator</span> <span class="variable">psc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PreparedStatementCreatorFactory</span>(</span><br><span class="line">            <span class="string">&quot;insert into Taco (name, createdAt) values (?, ?)&quot;</span>,</span><br><span class="line">            Types.VARCHAR, Types.TIMESTAMP</span><br><span class="line">        ).newPreparedStatementCreator(</span><br><span class="line">            Arrays.asList(</span><br><span class="line">                taco.getName(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Timestamp</span>(taco.getCreatedAt().getTime())));</span><br><span class="line"></span><br><span class="line">        <span class="type">KeyHolder</span> <span class="variable">keyHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GeneratedKeyHolder</span>();</span><br><span class="line">        jdbc.update(psc, keyHolder);</span><br><span class="line">        <span class="keyword">return</span> keyHolder.getKey().longValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveIngredientToTaco</span><span class="params">(Ingredient ingredient, <span class="type">long</span> tacoId)</span> &#123;</span><br><span class="line">        jdbc.update(</span><br><span class="line">            <span class="string">&quot;insert into Taco_Ingredients (taco, ingredient) &quot;</span> +<span class="string">&quot;values (?, ?)&quot;</span>,</span><br><span class="line">            tacoId, ingredient.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>save() æ–¹æ³•é¦–å…ˆè°ƒç”¨ç§æœ‰çš„ saveTacoInfo() æ–¹æ³•ï¼Œç„¶åä½¿ç”¨è¯¥æ–¹æ³•è¿”å›çš„ Taco id è°ƒç”¨ saveIngredientToTaco()ï¼Œå®ƒä¿å­˜æ¯ä¸ªé…æ–™ã€‚åœ¨ Taco ä¸­æ’å…¥ä¸€è¡Œæ—¶ï¼Œéœ€è¦çŸ¥é“æ•°æ®åº“ç”Ÿæˆçš„ idï¼Œä»¥ä¾¿åœ¨æ¯ä¸ª Ingredient ä¸­å¼•ç”¨å®ƒã€‚ä¿å­˜ Ingredient æ•°æ®æ—¶ä½¿ç”¨çš„ update() æ–¹æ³•ä¸èƒ½è·å¾—ç”Ÿæˆçš„ idï¼Œå› æ­¤è¿™é‡Œéœ€è¦ä¸€ä¸ªä¸åŒçš„ update() æ–¹æ³•ã€‚</p>
<p>éœ€è¦çš„ update() æ–¹æ³•æ¥å— PreparedStatementCreator å’Œ KeyHolderã€‚KeyHolder å°†æä¾›ç”Ÿæˆçš„ Taco idï¼Œä½†æ˜¯ä¸ºäº†ä½¿ç”¨å®ƒï¼Œè¿˜å¿…é¡»åˆ›å»ºä¸€ä¸ª PreparedStatementCreatorã€‚åˆ›å»º PreparedStatementCreator éå¸¸é‡è¦ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ª PreparedStatementCreatorFactoryï¼Œä¸ºå®ƒæä¾›æƒ³è¦æ‰§è¡Œçš„ SQLï¼Œä»¥åŠæ¯ä¸ªæŸ¥è¯¢å‚æ•°çš„ç±»å‹ã€‚ç„¶ååœ¨è¯¥å·¥å‚ä¸Šè°ƒç”¨ newPreparedStatementCreator()ï¼Œåœ¨æŸ¥è¯¢å‚æ•°ä¸­ä¼ é€’æ‰€éœ€çš„å€¼ä»¥ç”Ÿæˆ PreparedStatementCreatorã€‚é€šè¿‡ä½¿ç”¨ PreparedStatementCreatorï¼Œå¯ä»¥è°ƒç”¨ update()ï¼Œä¼ å…¥ PreparedStatementCreator å’Œ KeyHolderï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ GeneratedKeyHolder å®ä¾‹ï¼‰ã€‚update() å®Œæˆåï¼Œå¯ä»¥é€šè¿‡è¿”å› keyHolder.getKey().longValue() æ¥è¿”å› Taco idã€‚</p>
<p>å›åˆ° save() æ–¹æ³•ï¼Œå¾ªç¯éå† Taco ä¸­çš„æ¯ä¸ªæˆåˆ†ï¼Œè°ƒç”¨ saveIngredientToTaco() æ–¹æ³•ã€‚saveIngredientToTaco() æ–¹æ³•ä½¿ç”¨æ›´ç®€å•çš„ update() å½¢å¼æ¥ä¿å­˜å¯¹åˆ°Taco_Ingredient è¡¨ä¸­ã€‚</p>
<p>TacoRepository å‰©ä¸‹æ‰€è¦åšçš„å°±æ˜¯åœ¨ DesignTacoController ä¸­è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼Œå°†è®¢å•ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/design&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DesignTacoController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IngredientRepository ingredientRepo;</span><br><span class="line">    <span class="keyword">private</span> TacoRepository designRepo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DesignTacoController</span><span class="params">(</span></span><br><span class="line"><span class="params">        IngredientRepository ingredientRepo,</span></span><br><span class="line"><span class="params">        TacoRepository designRepo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ingredientRepo = ingredientRepo;</span><br><span class="line">        <span class="built_in">this</span>.designRepo = designRepo;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„é€ å‡½æ•°åŒ…å«ä¸€ä¸ª IngredientRepository å’Œä¸€ä¸ªTacoRepositoryã€‚å®ƒå°†è¿™ä¸¤ä¸ªå˜é‡éƒ½èµ‹å€¼ç»™å®ä¾‹å˜é‡ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ showDesignForm() å’Œ processDesign() æ–¹æ³•ä¸­ä½¿ç”¨ã€‚</p>
<p>æ–°çš„ processDesign() æ–¹æ³•ï¼Œä¿å­˜ Taco è®¾è®¡å¹¶é“¾æ¥åˆ° Orderï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/design&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DesignTacoController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ModelAttribute(name = &quot;order&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">order</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ModelAttribute(name = &quot;taco&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Taco <span class="title function_">taco</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Taco</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">processDesign</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Valid</span> Taco design, Errors errors,</span></span><br><span class="line"><span class="params">        <span class="meta">@ModelAttribute</span> Order order)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Taco</span> <span class="variable">saved</span> <span class="operator">=</span> designRepo.save(design);</span><br><span class="line">        order.addDesign(saved);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/orders/current&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> DesignTacoController ä½¿ç”¨ @SessionAttributes(â€œorderâ€) è¿›è¡Œäº†æ³¨è§£ï¼Œå¹¶ä¸”åœ¨ order() æ–¹æ³•ä¸Šæœ‰ä¸€ä¸ªæ–°çš„æ³¨è§£ @ModelAttributeã€‚ä¸ taco() æ–¹æ³•ä¸€æ ·ï¼Œorder() æ–¹æ³•ä¸Šçš„ @ModelAttribute æ³¨è§£ç¡®ä¿åœ¨æ¨¡å‹ä¸­èƒ½å¤Ÿåˆ›å»º Order å¯¹è±¡ã€‚ä½†æ˜¯ä¸ <strong>session</strong> ä¸­çš„ Taco å¯¹è±¡ä¸åŒï¼Œè¿™é‡Œ<strong>éœ€è¦åœ¨å¤šä¸ªè¯·æ±‚é—´æ˜¾ç¤ºè®¢å•ï¼Œå› æ­¤å¯ä»¥åˆ›å»ºå¤šä¸ª Taco å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°è®¢å•ä¸­</strong>ã€‚ç±»çº§åˆ«çš„ @SessionAttributes æ³¨è§£æŒ‡å®šäº†ä»»ä½•æ¨¡å‹å¯¹è±¡ï¼Œæ¯”å¦‚åº”è¯¥ä¿å­˜åœ¨ä¼šè¯ä¸­çš„ order å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥<strong>è·¨å¤šä¸ªè¯·æ±‚ä½¿ç”¨</strong>ã€‚</p>
<p>taco è®¾è®¡çš„å®é™…å¤„ç†å‘ç”Ÿåœ¨ processDesign() æ–¹æ³•ä¸­ï¼Œé™¤äº† Taco å’Œ Errors å¯¹è±¡å¤–ï¼Œè¯¥æ–¹æ³•ç°åœ¨è¿˜æ¥å— Order å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚Order å‚æ•°ä½¿ç”¨ @ModelAttribute è¿›è¡Œæ³¨è§£ï¼Œä»¥æŒ‡ç¤ºå…¶å€¼åº”è¯¥æ¥è‡ªæ¨¡å‹ï¼Œè€Œ Spring MVC ä¸åº”è¯¥å°è¯•ç»™å®ƒç»‘å®šè¯·æ±‚å‚æ•°ã€‚</p>
<p>åœ¨æ£€æŸ¥éªŒè¯é”™è¯¯ä¹‹åï¼ŒprocessDesign() ä½¿ç”¨æ³¨å…¥çš„ TacoRepository æ¥ä¿å­˜ Tacoã€‚ç„¶åï¼Œ<strong>å®ƒå°† Taco å¯¹è±¡æ·»åŠ åˆ°ä¿å­˜äº session ä¸­ Order å¯¹è±¡ä¸­</strong>ã€‚å®é™…ä¸Šï¼ŒOrder å¯¹è±¡ä»ç„¶ä¿ç•™åœ¨ session ä¸­ï¼Œç›´åˆ°ç”¨æˆ·å®Œæˆå¹¶æäº¤ Order è¡¨å•æ‰ä¼šä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚æ­¤æ—¶ï¼ŒOrderController éœ€è¦è°ƒç”¨ OrderRepository çš„å®ç°æ¥ä¿å­˜è®¢å•ã€‚ä¸‹é¢æ¥å†™ä¸€ä¸‹è¿™ä¸ªå®ç°ã€‚</p>
<h4 id="ä½¿ç”¨-SimpleJdbcInsert-ä¿å­˜æ•°æ®"><a href="#ä½¿ç”¨-SimpleJdbcInsert-ä¿å­˜æ•°æ®" class="headerlink" title="ä½¿ç”¨ SimpleJdbcInsert ä¿å­˜æ•°æ®"></a>ä½¿ç”¨ SimpleJdbcInsert ä¿å­˜æ•°æ®</h4><p>åœ¨ä¿å­˜è®¢å•æ–¹é¢ï¼Œä¹Ÿå­˜åœ¨ç±»ä¼¼çš„æƒ…å†µã€‚ä¸ä»…å¿…é¡»å°†è®¢å•æ•°æ®ä¿å­˜åˆ° Taco_Order è¡¨ä¸­ï¼Œè¿˜å¿…é¡»å¼•ç”¨ Taco_Order_Tacos è¡¨ä¸­çš„æ¯ä¸ª tacoã€‚ä½†æ˜¯ä¸æ˜¯ä½¿ç”¨ç¹ççš„ PreparedStatementCreator, è€Œæ˜¯ä½¿ç”¨SimpleJdbcInsertï¼Œ SimpleJdbcInsert æ˜¯ä¸€ä¸ªåŒ…è£…äº† JdbcTemplate çš„å¯¹è±¡ï¼Œå®ƒè®©å‘è¡¨æ’å…¥æ•°æ®çš„æ“ä½œå˜å¾—æ›´å®¹æ˜“ã€‚</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª JdbcOrderRepositoryï¼Œå®ƒæ˜¯ OrderRepository çš„ä¸€ä¸ªå®ç°ã€‚ä½†æ˜¯åœ¨ç¼–å†™ save() æ–¹æ³•å®ç°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå…³æ³¨æ„é€ å‡½æ•°ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œå°†åˆ›å»ºä¸¤ä¸ª SimpleJdbcInsert å®ä¾‹ï¼Œç”¨äºå°†å€¼æ’å…¥ Taco_Order å’Œ Taco_Order_Tacos è¡¨ä¸­ã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº† JdbcOrderRepositoryï¼ˆæ²¡æœ‰ save() æ–¹æ³•ï¼‰ã€‚ä» JdbcTemplate åˆ›å»ºä¸€ä¸ª SimpleJdbcTemplateï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.simple.SimpleJdbcInsert;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcOrderRepository</span> <span class="keyword">implements</span> <span class="title class_">OrderRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SimpleJdbcInsert orderInserter;</span><br><span class="line">    <span class="keyword">private</span> SimpleJdbcInsert orderTacoInserter;</span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JdbcOrderRepository</span><span class="params">(JdbcTemplate jdbc)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderInserter = <span class="keyword">new</span> <span class="title class_">SimpleJdbcInsert</span>(jdbc)</span><br><span class="line">            .withTableName(<span class="string">&quot;Taco_Order&quot;</span>)</span><br><span class="line">            .usingGeneratedKeyColumns(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.orderTacoInserter = <span class="keyword">new</span> <span class="title class_">SimpleJdbcInsert</span>(jdbc)</span><br><span class="line">            .withTableName(<span class="string">&quot;Taco_Order_Tacos&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.objectMapper = <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ JdbcTacoRepository ä¸€æ ·ï¼ŒJdbcOrderRepository ä¹Ÿé€šè¿‡å…¶æ„é€ å‡½æ•°æ³¨å…¥äº† JdbcTemplateã€‚ä½†æ˜¯ï¼Œæ„é€ å‡½æ•°å¹¶æ²¡æœ‰å°† JdbcTemplate ç›´æ¥åˆ†é…ç»™ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œè€Œæ˜¯ä½¿ç”¨å®ƒæ¥æ„é€ ä¸¤ä¸ª SimpleJdbcInsert å®ä¾‹ã€‚</p>
<p>ç¬¬ä¸€ä¸ªå®ä¾‹è¢«åˆ†é…ç»™ orderInserter å®ä¾‹å˜é‡ï¼Œå®ƒè¢«é…ç½®ä¸ºä½¿ç”¨ Taco_Order è¡¨ï¼Œå¹¶å‡å®š id å±æ€§å°†ç”±æ•°æ®åº“æä¾›æˆ–ç”Ÿæˆã€‚åˆ†é…ç»™ orderTacoInserter çš„ç¬¬äºŒä¸ªå®ä¾‹è¢«é…ç½®ä¸ºä½¿ç”¨ Taco_Order_Tacos è¡¨ï¼Œä½†æ˜¯æ²¡æœ‰å£°æ˜å¦‚ä½•åœ¨è¯¥è¡¨ä¸­ç”Ÿæˆä»»ä½• idã€‚</p>
<p>æ„é€ å‡½æ•°è¿˜åˆ›å»º ObjectMapper å®ä¾‹ï¼Œå¹¶å°†å…¶åˆ†é…ç»™å®ä¾‹å˜é‡ã€‚å°½ç®¡ Jackson ç”¨äº JSON å¤„ç†ï¼Œä½†ç¨åå°†çœ‹åˆ°å¦‚ä½•é‡æ–°ä½¿ç”¨å®ƒæ¥å¸®åŠ©ä¿å­˜è®¢å•åŠå…¶å…³è”çš„ tacosã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ save() æ–¹æ³•å¦‚ä½•ä½¿ç”¨ SimpleJdbcInsert å®ä¾‹ã€‚ä¸‹ä¸€ä¸ªç¨‹åºæ¸…å•æ˜¾ç¤ºäº† save() æ–¹æ³•ï¼Œä»¥åŠå‡ ä¸ªç”¨äºå®é™…å·¥ä½œçš„ save() å§”æ‰˜çš„ç§æœ‰æ–¹æ³•ã€‚</p>
<p>ä½¿ç”¨ SimpleJdbcInsert æ’å…¥æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Order <span class="title function_">save</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    order.setPlacedAt(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> saveOrderDetails(order);</span><br><span class="line">    order.setId(orderId);</span><br><span class="line"></span><br><span class="line">    List&lt;Taco&gt; tacos = order.getTacos();</span><br><span class="line">    <span class="keyword">for</span> (Taco taco : tacos) &#123;</span><br><span class="line">        saveTacoToOrder(taco, orderId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="title function_">saveOrderDetails</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    Map&lt;String, Object&gt; values = objectMapper.convertValue(order, Map.class);</span><br><span class="line">    values.put(<span class="string">&quot;placedAt&quot;</span>, order.getPlacedAt());</span><br><span class="line">â€‹</span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> orderInserter.executeAndReturnKey(values).longValue();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> orderId;</span><br><span class="line">&#125;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveTacoToOrder</span><span class="params">(Taco taco, <span class="type">long</span> orderId)</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; values = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    values.put(<span class="string">&quot;tacoOrder&quot;</span>, orderId);</span><br><span class="line">    values.put(<span class="string">&quot;taco&quot;</span>, taco.getId());</span><br><span class="line"></span><br><span class="line">    orderTacoInserter.execute(values);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>save() æ–¹æ³•å®é™…ä¸Šå¹¶ä¸ä¿å­˜ä»»ä½•ä¸œè¥¿ã€‚å®ƒå®šä¹‰äº†ä¿å­˜è®¢å•åŠå…¶å…³è” Taco å¯¹è±¡çš„æµï¼Œå¹¶å°†æŒä¹…æ€§å·¥ä½œå§”æ‰˜ç»™ saveOrderDetails() å’Œ saveTacoToOrder()ã€‚</p>
<p>SimpleJdbcInsert æœ‰ä¸¤ä¸ªæ‰§è¡Œæ’å…¥çš„æœ‰ç”¨æ–¹æ³•ï¼šexecute() å’Œ executeAndReturnKey()ã€‚ä¸¤è€…éƒ½æ¥å— Map&lt;String, Object&gt;ï¼Œå…¶ä¸­ Map é”®å¯¹åº”äºæ•°æ®æ’å…¥çš„è¡¨ä¸­çš„åˆ—åï¼Œæ˜ å°„çš„å€¼è¢«æ’å…¥åˆ°è¿™äº›åˆ—ä¸­ã€‚</p>
<p>é€šè¿‡å°† Order ä¸­çš„å€¼å¤åˆ¶åˆ° Map çš„æ¡ç›®ä¸­ï¼Œå¾ˆå®¹æ˜“åˆ›å»ºè¿™æ ·çš„ Mapã€‚ä½†æ˜¯ Order æœ‰å‡ ä¸ªå±æ€§ï¼Œè¿™äº›å±æ€§å’Œå®ƒä»¬è¦è¿›å…¥çš„åˆ—æœ‰ç›¸åŒçš„åå­—ã€‚å› æ­¤ï¼Œåœ¨ saveOrderDetails() ä¸­ï¼Œæˆ‘å†³å®šä½¿ç”¨ Jackson çš„ ObjectMapper åŠå…¶ convertValue() æ–¹æ³•å°† Order è½¬æ¢ä¸º Mapã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå¦åˆ™ ObjectMapper ä¼šå°† Date å±æ€§è½¬æ¢ä¸º longï¼Œè¿™ä¸ Taco_Order è¡¨ä¸­çš„ placedAt å­—æ®µä¸å…¼å®¹ã€‚</p>
<p>éšç€ Map ä¸­å¡«å……å®Œæˆè®¢å•æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ orderInserter ä¸Šè°ƒç”¨ executeAndReturnKey() æ–¹æ³•äº†ã€‚è¿™ä¼šå°†è®¢å•ä¿¡æ¯ä¿å­˜åˆ° Taco_Order è¡¨ä¸­ï¼Œå¹¶å°†æ•°æ®åº“ç”Ÿæˆçš„ id ä½œä¸ºä¸€ä¸ª Number å¯¹è±¡è¿”å›ï¼Œè°ƒç”¨ longValue() æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºä»æ–¹æ³•è¿”å›çš„ long å€¼ã€‚</p>
<p>saveTacoToOrder() æ–¹æ³•è¦ç®€å•å¾—å¤šã€‚ä¸æ˜¯ä½¿ç”¨ ObjectMapper å°†å¯¹è±¡è½¬æ¢ä¸º Mapï¼Œè€Œæ˜¯åˆ›å»º Map å¹¶è®¾ç½®é€‚å½“çš„å€¼ã€‚åŒæ ·ï¼Œæ˜ å°„é”®å¯¹åº”äºè¡¨ä¸­çš„åˆ—åã€‚å¯¹ orderTacoInserter çš„ execute() æ–¹æ³•çš„ç®€å•è°ƒç”¨å°±èƒ½æ‰§è¡Œæ’å…¥æ“ä½œã€‚</p>
<p>ç°åœ¨å¯ä»¥å°† OrderRepository æ³¨å…¥åˆ° OrderController ä¸­å¹¶å¼€å§‹ä½¿ç”¨å®ƒã€‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ˜¾ç¤ºäº†å®Œæ•´çš„ OrderControllerï¼ŒåŒ…æ‹¬å› ä½¿ç”¨æ³¨å…¥çš„ OrderRepository è€Œåšçš„æ›´æ”¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.web;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Errors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.SessionAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.support.SessionStatus;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line"><span class="keyword">import</span> tacos.data.OrderRepository;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OrderRepository orderRepo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderController</span><span class="params">(OrderRepository orderRepo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderRepo = orderRepo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/current&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">orderForm</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;orderForm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">processOrder</span><span class="params">(<span class="meta">@Valid</span> Order order, Errors errors,</span></span><br><span class="line"><span class="params">                               SessionStatus sessionStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;orderForm&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        orderRepo.save(order);</span><br><span class="line">        sessionStatus.setComplete();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†å°† OrderRepository æ³¨å…¥æ§åˆ¶å™¨ä¹‹å¤–ï¼ŒOrderController ä¸­æƒŸä¸€é‡è¦çš„æ›´æ”¹æ˜¯ processOrder() æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œè¡¨å•ä¸­æäº¤çš„ Order å¯¹è±¡ï¼ˆæ°å¥½ä¹Ÿæ˜¯åœ¨ session ä¸­ç»´æŠ¤çš„ Order å¯¹è±¡ï¼‰é€šè¿‡æ³¨å…¥çš„ OrderRepository ä¸Šçš„ save() æ–¹æ³•ä¿å­˜ã€‚</p>
<p>ä¸€æ—¦è®¢å•è¢«ä¿å­˜ï¼Œå°±ä¸å†éœ€è¦å®ƒå­˜åœ¨äº session ä¸­äº†ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä¸æ¸…é™¤å®ƒï¼Œè®¢å•å°†ä¿æŒåœ¨ session ä¸­ï¼ŒåŒ…æ‹¬å…¶å…³è”çš„ tacosï¼Œä¸‹ä¸€ä¸ªè®¢å•å°†ä»æ—§è®¢å•ä¸­åŒ…å«çš„ä»»ä½• tacos å¼€å§‹ã€‚å› æ­¤éœ€è¦ processOrder() æ–¹æ³•è¯·æ±‚ SessionStatus å‚æ•°å¹¶è°ƒç”¨å…¶ setComplete() æ–¹æ³•æ¥é‡ç½®ä¼šè¯ã€‚</p>
<p>æ‰€æœ‰çš„ JDBC æŒä¹…åŒ–ä»£ç éƒ½å‡†å¤‡å¥½äº†ã€‚ç°åœ¨ï¼Œå¯ä»¥å¯åŠ¨ Taco Cloud åº”ç”¨ç¨‹åºå¹¶è¿›è¡Œæµ‹è¯•ã€‚ä½ æƒ³è¦å¤šå°‘ tacos å’Œå¤šå°‘ orders éƒ½å¯ä»¥ã€‚</p>
<p>å¯èƒ½è¿˜ä¼šå‘ç°åœ¨æ•°æ®åº“ä¸­è¿›è¡ŒæŒ–æ˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚å› ä¸ºä½¿ç”¨ H2 ä½œä¸ºåµŒå…¥å¼æ•°æ®åº“ï¼Œè€Œä¸” Spring Boot DevTools å·²ç»å°±ä½ï¼Œæ‰€ä»¥åº”è¯¥èƒ½å¤Ÿç”¨æµè§ˆå™¨è®¿é—® <a href="http://localhost:8080/h2-console">http://localhost:8080/h2-console</a> æ¥æŸ¥çœ‹ H2 æ§åˆ¶å°ã€‚è™½ç„¶éœ€è¦ç¡®ä¿ JDBC URL å­—æ®µè¢«è®¾ç½®ä¸º JDBC:h2:mem:testdbï¼Œä½†æ˜¯é»˜è®¤çš„å‡­è¯åº”è¯¥å¯ä»¥è®©ä½ è¿›å…¥ã€‚ç™»å½•åï¼Œåº”è¯¥èƒ½å¤Ÿå¯¹ Taco Cloud æ¨¡å¼ä¸­çš„è¡¨å‘èµ·æŸ¥è¯¢ã€‚</p>
<p>Spring çš„ JdbcTemplate å’Œ SimpleJdbcInsert ä½¿å¾—ä½¿ç”¨å…³ç³»æ•°æ®åº“æ¯”æ™®é€š JDBC ç®€å•å¾—å¤šã€‚ä½†æ˜¯å¯èƒ½ä¼šå‘ç° JPA ä½¿å®ƒæ›´åŠ ç®€å•ã€‚3.2å°†å±•ç¤ºJPAå¦‚ä½•ä½¿ç”¨ Spring æ•°æ®ä½¿æ•°æ®æŒä¹…åŒ–æ›´åŠ å®¹æ˜“ã€‚</p>
<h2 id="ä½¿ç”¨-Spring-Data-JPA-è¯»å†™æ•°æ®"><a href="#ä½¿ç”¨-Spring-Data-JPA-è¯»å†™æ•°æ®" class="headerlink" title="ä½¿ç”¨ Spring Data JPA è¯»å†™æ•°æ®"></a>ä½¿ç”¨ Spring Data JPA è¯»å†™æ•°æ®</h2><p>Spring Data é¡¹ç›®æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„ä¼å½¢é¡¹ç›®ï¼Œå‡ ä¸ªå­é¡¹ç›®ç»„æˆï¼Œå…¶ä¸­å¤§å¤šæ•°å­é¡¹ç›®å…³æ³¨äºå…·æœ‰å„ç§ä¸åŒæ•°æ®åº“ç±»å‹çš„æ•°æ®æŒä¹…åŒ–ã€‚ä¸€äº›æœ€æµè¡Œçš„ Spring æ•°æ®é¡¹ç›®åŒ…æ‹¬ï¼š</p>
<ul>
<li>Spring Data JPA* - é’ˆå¯¹å…³ç³»æ•°æ®åº“çš„æŒä¹…åŒ–</li>
<li><em>Spring Data Mongo</em> - é’ˆå¯¹ Mongo æ–‡æ¡£æ•°æ®åº“çš„æŒä¹…åŒ–</li>
<li><em>Spring Data Neo4j</em> - é’ˆå¯¹ Neo4j å›¾å½¢æ•°æ®åº“çš„æŒä¹…åŒ–</li>
<li><em>Spring Data Redis</em> - é’ˆå¯¹ Redis é”®å€¼å­˜å‚¨çš„æŒä¹…åŒ–</li>
<li><em>Spring Data Cassandra</em> - é’ˆå¯¹ Cassandra æ•°æ®åº“çš„æŒä¹…åŒ–</li>
</ul>
<p>Spring Data ä¸ºæ‰€æœ‰è¿™äº›é¡¹ç›®æä¾›çš„æœ€æœ‰æ„æ€å’Œæœ€æœ‰ç”¨çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯èƒ½å¤Ÿ<strong>åŸºäºå­˜å‚¨åº“è§„èŒƒæ¥å£è‡ªåŠ¨åˆ›å»ºå­˜å‚¨åº“</strong>ã€‚</p>
<p>ä¸ºäº†äº†è§£ Spring Data æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œéœ€è¦å°†æœ¬ç« å‰é¢ä»‹ç»çš„åŸºäº jdbc çš„å­˜å‚¨åº“æ›¿æ¢ä¸º Spring Data JPA åˆ›å»ºçš„å­˜å‚¨åº“ã€‚ä½†æ˜¯é¦–å…ˆï¼Œéœ€è¦å°† Spring Data JPA æ·»åŠ åˆ°é¡¹ç›®æ„å»ºä¸­ã€‚</p>
<h3 id="æ·»åŠ Spring-Data-JPAä¾èµ–"><a href="#æ·»åŠ Spring-Data-JPAä¾èµ–" class="headerlink" title="æ·»åŠ Spring Data JPAä¾èµ–"></a>æ·»åŠ <strong>Spring Data JPA</strong>ä¾èµ–</h3><p>Spring Data JPA å¯ç”¨äºå…·æœ‰ JPA starter çš„ Spring Boot åº”ç”¨ç¨‹åºã€‚è¿™ä¸ª starter ä¾èµ–ä¸ä»…å¸¦æ¥äº† Spring Data JPAï¼Œè¿˜åŒ…æ‹¬ Hibernate ä½œä¸º JPA çš„å®ç°ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="å¯¹é¢†åŸŸç±»æ·»åŠ æ³¨è§£æˆä¸ºå®ä½“"><a href="#å¯¹é¢†åŸŸç±»æ·»åŠ æ³¨è§£æˆä¸ºå®ä½“" class="headerlink" title="å¯¹é¢†åŸŸç±»æ·»åŠ æ³¨è§£æˆä¸ºå®ä½“"></a>å¯¹é¢†åŸŸç±»æ·»åŠ æ³¨è§£æˆä¸ºå®ä½“</h3><p>åœ¨åˆ›å»ºå­˜å‚¨åº“æ–¹é¢ï¼ŒSpring Data åšäº†ä¸€äº›æƒŠäººçš„äº‹æƒ…ã€‚ä½†ä¸å¹¸çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ JPA æ˜ å°„æ³¨è§£åŸŸå¯¹è±¡æ—¶ï¼Œå®ƒå¹¶æ²¡æœ‰å¤ªå¤§çš„å¸®åŠ©ã€‚éœ€è¦æ‰“å¼€ Ingredientã€Taco å’Œ Order ç±»ï¼Œå¹¶æ·»åŠ ä¸€äº›æ³¨è§£ã€‚é¦–å…ˆæ˜¯ Ingredient ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ingredient</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">        WRAP, PROTEIN, VEGGIES, CHEESE, SAUCE</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å°†å…¶å£°æ˜ä¸º JPA å®ä½“ï¼Œå¿…é¡»ä½¿ç”¨ @Entity æ³¨è§£ã€‚å®ƒçš„ id å±æ€§å¿…é¡»ä½¿ç”¨ @Id è¿›è¡Œæ³¨è§£ï¼Œä»¥ä¾¿å°†å…¶æŒ‡å®šä¸ºæƒŸä¸€æ ‡è¯†æ•°æ®åº“ä¸­å®ä½“çš„å±æ€§ã€‚</p>
<p>é™¤äº†ç‰¹å®šäº JPA çš„æ³¨è§£ä¹‹å¤–ï¼Œè¿˜åœ¨ç±»çº§åˆ«ä¸Šæ·»åŠ äº† @NoArgsConstructor æ³¨è§£ã€‚JPA è¦æ±‚å®ä½“æœ‰ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥ Lombok çš„ @NoArgsConstructor å®ç°äº†è¿™ä¸€ç‚¹ã€‚ä½†æ˜¯è¦æ˜¯ä¸å¸Œæœ›ä½¿ç”¨å®ƒï¼Œå¯ä»¥é€šè¿‡å°† access å±æ€§è®¾ç½®ä¸º AccessLevel.PRIVATE æ¥å°†å…¶è®¾ç½®ä¸ºç§æœ‰ã€‚å› ä¸ºå¿…é¡»è®¾ç½® final å±æ€§ï¼Œæ‰€ä»¥è¿˜è¦å°† force å±æ€§è®¾ç½®ä¸º trueï¼Œè¿™å°†å¯¼è‡´ Lombok ç”Ÿæˆçš„æ„é€ å‡½æ•°å°†å®ƒä»¬è®¾ç½®ä¸º nullã€‚</p>
<p>è¿˜æ·»åŠ äº†ä¸€ä¸ª @RequiredArgsConstructorã€‚@Data éšå¼åœ°æ·»åŠ äº†ä¸€ä¸ªå¿…éœ€çš„æœ‰å‚æ„é€ å‡½æ•°ï¼Œä½†æ˜¯å½“ä½¿ç”¨ @NoArgsConstructor æ—¶ï¼Œè¯¥æ„é€ å‡½æ•°å°†è¢«åˆ é™¤ã€‚æ˜¾å¼çš„ @RequiredArgsConstructor ç¡®ä¿é™¤äº†ç§æœ‰æ— å‚æ•°æ„é€ å‡½æ•°å¤–ï¼Œä»ç„¶æœ‰ä¸€ä¸ªå¿…éœ€æœ‰å‚æ„é€ å‡½æ•°ã€‚</p>
<p>Tacoç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToMany;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.OneToMany;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PrePersist;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Taco</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy=GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min=5, message=&quot;Name must be at least 5 characters long&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToMany(targetEntity=Ingredient.class)</span></span><br><span class="line">    <span class="meta">@Size(min=1, message=&quot;You must choose at least 1 ingredient&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Ingredient&gt; ingredients;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">createdAt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.createdAt = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ Ingredient ä¸€æ ·ï¼ŒTaco ç±»ç°åœ¨ä½¿ç”¨ @Entity æ³¨è§£ï¼Œå…¶ id å±æ€§ä½¿ç”¨ @Id æ³¨è§£ã€‚å› ä¸ºä¾èµ–äºæ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆ id å€¼ï¼Œæ‰€ä»¥è¿˜ä½¿ç”¨ @GeneratedValue æ³¨è§£ id å±æ€§ï¼ŒæŒ‡å®šè‡ªåŠ¨ç­–ç•¥ã€‚</p>
<p>è¦å£°æ˜ Taco åŠå…¶ç›¸å…³ Ingredient åˆ—è¡¨ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨ @ManyToMany æ³¨è§£ ingredient å±æ€§ã€‚ä¸€ä¸ª Taco å¯ä»¥æœ‰å¾ˆå¤š Ingredientï¼Œä¸€ä¸ª Ingredient å¯ä»¥æ˜¯å¾ˆå¤š Taco çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªæ–°æ–¹æ³• createdAt()ï¼Œå®ƒç”¨ @PrePersist æ³¨è§£ã€‚å°†ä½¿ç”¨å®ƒå°† createdAt å±æ€§è®¾ç½®ä¸ºä¿å­˜ Taco ä¹‹å‰çš„å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚</p>
<p>Orderç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.ManyToMany;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.OneToMany;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PrePersist;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Digits;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.CreditCardNumber;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name=&quot;Taco_Order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy=GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Date placedAt;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToMany(targetEntity=Taco.class)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Taco&gt; tacos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addDesign</span><span class="params">(Taco design)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tacos.add(design);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">placedAt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.placedAt = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹ Order çš„æ›´æ”¹ä¸å¯¹ Taco çš„æ›´æ”¹éå¸¸ç›¸ä¼¼ã€‚ä½†æ˜¯åœ¨ç±»çº§åˆ«æœ‰ä¸€ä¸ªæ–°çš„æ³¨è§£ï¼š@Tableã€‚è¿™æŒ‡å®šè®¢å•å®ä½“åº”è¯¥æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­åä¸º Taco_Order çš„è¡¨ä¸­ã€‚</p>
<p>å°½ç®¡å¯ä»¥åœ¨ä»»ä½•å®ä½“ä¸Šä½¿ç”¨è¿™ä¸ªæ³¨è§£ï¼Œä½†å®ƒå¯¹äº Order æ˜¯å¿…éœ€çš„ã€‚æ²¡æœ‰å®ƒï¼ŒJPA å°†é»˜è®¤å°†å®ä½“æŒä¹…åŒ–åˆ°ä¸€ä¸ªåä¸º Order çš„è¡¨ä¸­ï¼Œä½†æ˜¯ Order åœ¨ SQL ä¸­æ˜¯ä¸€ä¸ªä¿ç•™å­—ï¼Œä¼šå¯¼è‡´é—®é¢˜ã€‚</p>
<h3 id="å£°æ˜-JPA-repositoryæ¥å£"><a href="#å£°æ˜-JPA-repositoryæ¥å£" class="headerlink" title="å£°æ˜ JPA repositoryæ¥å£"></a>å£°æ˜ JPA repositoryæ¥å£</h3><p>åœ¨å­˜å‚¨åº“çš„ JDBC ç‰ˆæœ¬ä¸­ï¼Œæ˜¾å¼åœ°å£°æ˜äº†å¸Œæœ› repository æä¾›çš„æ–¹æ³•ã€‚ä½†æ˜¯ä½¿ç”¨ Spring Dataï¼Œæ‰©å±• CrudRepository æ¥å£ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°çš„ IngredientRepository æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"><span class="keyword">import</span> tacos.Ingredient;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IngredientRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;Ingredient, String&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CrudRepository ä¸º CRUDï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰æ“ä½œå£°æ˜äº†åå‡ ä¸ªæ–¹æ³•ã€‚æ³¨æ„ï¼Œå®ƒæ˜¯å‚æ•°åŒ–çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­˜å‚¨åº“è¦æŒä¹…åŒ–çš„å®ä½“ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å®ä½“ id å±æ€§çš„ç±»å‹ã€‚å¯¹äº IngredientRepositoryï¼Œå‚æ•°åº”è¯¥æ˜¯ Ingredient å’Œ String ç±»å‹ã€‚</p>
<p>å®šä¹‰ TacoRepositoryï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"><span class="keyword">import</span> tacos.Taco;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TacoRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;Taco, Long&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IngredientRepository å’Œ TacoRepository ä¹‹é—´å”¯ä¸€æ˜¾è‘—çš„åŒºåˆ«æ˜¯å¯¹äº CrudRepository çš„å‚æ•°ä¸åŒã€‚åœ¨è¿™é‡Œï¼Œå®ƒä»¬è¢«è®¾ç½®ä¸º Taco å’Œ Long å»æŒ‡å®š Taco å®ä½“ï¼ˆåŠå…¶ id ç±»å‹ï¼‰ä½œä¸ºè¿™ä¸ª respository æ¥å£çš„æŒä¹…åŒ–å•å…ƒã€‚æœ€åï¼ŒåŒæ ·çš„æ›´æ”¹å¯ä»¥åº”ç”¨åˆ° OrderRepositoryï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos.data;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.CrudRepository;</span><br><span class="line"><span class="keyword">import</span> tacos.Order;</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;Order, Long&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æœ‰äº†è¿™ä¸‰ä¸ª repositoryï¼Œå¯èƒ½è®¤ä¸ºéœ€è¦ä¸ºè¿™ä¸‰ä¸ª repository ç¼–å†™å®ç°ï¼Œè¿˜åŒ…æ‹¬æ¯ç§å®ç°çš„åå‡ ä¸ªæ–¹æ³•ã€‚ä½†è¿™å°±æ˜¯ Spring Data JPA ä¼˜ç§€çš„åœ°æ–¹ â€”â€” ä¸éœ€è¦ç¼–å†™å®ç°ï¼å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring Data JPA ä¼šåŠ¨æ€åœ°è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå®ç°ã€‚è¿™æ„å‘³ç€ repository å¯ä»¥ä»ä¸€å¼€å§‹å°±ä½¿ç”¨ã€‚åªéœ€å°†å®ƒä»¬æ³¨å…¥åˆ°æ§åˆ¶å™¨ä¸­ï¼Œå°±åƒåœ¨åŸºäº JDBC çš„å®ç°ä¸­æ‰€åšçš„é‚£æ ·ã€‚</p>
<p>CrudRepository æä¾›çš„æ–¹æ³•éå¸¸é€‚åˆç”¨äºå®ä½“çš„é€šç”¨æŒä¹…åŒ–ã€‚ä½†æ˜¯å¦‚æœæœ‰ä¸€äº›åŸºæœ¬æŒä¹…åŒ–ä¹‹å¤–çš„éœ€æ±‚å‘¢ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è‡ªå®šä¹‰ repository æ¥æ‰§è¡ŒåŸŸç‰¹æœ‰çš„æŸ¥è¯¢ã€‚</p>
<h3 id="è‡ªå®šä¹‰-JPA-repositoryå®ç°"><a href="#è‡ªå®šä¹‰-JPA-repositoryå®ç°" class="headerlink" title="è‡ªå®šä¹‰ JPA repositoryå®ç°"></a>è‡ªå®šä¹‰ JPA repositoryå®ç°</h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œé™¤äº† CrudRepository æä¾›çš„åŸºæœ¬ CRUD æ“ä½œä¹‹å¤–ï¼Œè¿˜éœ€è¦è·å–æŠ•é€’ç»™æŒ‡å®šé‚®æ”¿ç¼–ç çš„æ‰€æœ‰è®¢å•ã€‚äº‹å®è¯æ˜ï¼Œé€šè¿‡åœ¨ OrderRepository ä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•å£°æ˜å¯ä»¥å¾ˆå®¹æ˜“åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<p><code>List&lt;Order&gt; findByDeliveryZip(String deliveryZip);</code></p>
<p>åœ¨ç”Ÿæˆ repository å®ç°æ—¶ï¼ŒSpring Data æ£€æŸ¥å­˜å‚¨åº“æ¥å£ä¸­çš„ä»»ä½•æ–¹æ³•ï¼Œè§£ææ–¹æ³•åç§°ï¼Œå¹¶<strong>å°è¯•åœ¨æŒä¹…åŒ–å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­ç†è§£æ–¹æ³•çš„ç”¨é€”</strong>ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ Orderï¼‰ã€‚æœ¬è´¨ä¸Šï¼ŒSpring Data å®šä¹‰äº†ä¸€ç§å°å‹çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰ï¼Œå…¶ä¸­æŒä¹…åŒ–ç»†èŠ‚ç”¨ repository ä¸­çš„æ–¹æ³•ç­¾åè¡¨ç¤ºã€‚</p>
<p>è®©æˆ‘ä»¬è€ƒè™‘å¦ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ã€‚å‡è®¾éœ€è¦æŸ¥è¯¢åœ¨ç»™å®šæ—¥æœŸèŒƒå›´å†…æŠ•é€’ç»™æŒ‡å®šé‚®æ”¿ç¼–ç çš„æ‰€æœ‰è®¢å•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æ·»åŠ åˆ° OrderRepository æ—¶ï¼Œä¸‹é¢çš„æ–¹æ³•å¯èƒ½ä¼šè¢«è¯æ˜æ˜¯æœ‰ç”¨çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Order&gt; <span class="title function_">readOrdersByDeliveryZipAndPlacedAtBetween</span><span class="params">(</span></span><br><span class="line"><span class="params">    String deliveryZip, Date startDate, Date endDate)</span>;</span><br></pre></td></tr></table></figure>

<p><em><strong><u>è‡ªåŠ¨è¯†åˆ«æ–¹æ³•åçŒœæµ‹åŠŸèƒ½ï¼Œæ–¹æ³•å‘½åçº¦å®š</u></strong></em></p>
<p>è™½ç„¶å‘½åçº¦å®šå¯¹äºç›¸å¯¹ç®€å•çš„æŸ¥è¯¢å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å¯¹äºæ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œä¸éœ€è¦å¤ªå¤šçš„æƒ³è±¡å°±å¯ä»¥çœ‹å‡ºæ–¹æ³•åç§°å¯èƒ½ä¼šå¤±æ§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥éšæ„å°†æ–¹æ³•å‘½åä¸ºä»»ä½•æƒ³è¦çš„åç§°ï¼Œå¹¶ä½¿ç”¨ @Query å¯¹å…¶è¿›è¡Œæ³¨è§£ï¼Œä»¥æ˜¾å¼åœ°æŒ‡å®šè°ƒç”¨æ–¹æ³•æ—¶è¦æ‰§è¡Œçš„æŸ¥è¯¢ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;Order o where o.deliveryCity=&#x27;Seattle&#x27;&quot;)</span></span><br><span class="line">List&lt;Order&gt; <span class="title function_">readOrdersDeliveredInSeattle</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<h2 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ul>
<li>JdbcTemplate å¤§å¤§ç®€åŒ–äº† JDBC çš„å·¥ä½œã€‚</li>
<li>å½“éœ€è¦çŸ¥é“æ•°æ®åº“ç”Ÿæˆçš„ id æ—¶ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ PreparedStatementCreator å’Œ KeyHolderã€‚</li>
<li>ä¸ºäº†æ–¹ä¾¿æ‰§è¡Œæ•°æ®æ’å…¥ï¼Œä½¿ç”¨ SimpleJdbcInsertã€‚</li>
<li>Spring Data JPA ä½¿å¾— JPA æŒä¹…åŒ–å°±åƒç¼–å†™å­˜å‚¨åº“æ¥å£ä¸€æ ·ç®€å•ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>springæ¡†æ¶@Beanæ³¨è§£ã€æ‹¦æˆªå™¨ã€ç›‘å¬å™¨</title>
    <url>/2022/04/22/myblog/spring/spring%E6%A1%86%E6%9E%B6%E4%B9%8Bbean%E6%B3%A8%E8%A7%A3/</url>
    <content><![CDATA[<h3 id="Beanæ³¨è§£"><a href="#Beanæ³¨è§£" class="headerlink" title="@Beanæ³¨è§£"></a>@Beanæ³¨è§£</h3><p>ä½œç”¨åœ¨æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼ŒSpringçš„@Beanæ³¨è§£ç”¨äºå‘Šè¯‰æ–¹æ³•ï¼Œäº§ç”Ÿä¸€ä¸ªBeanå¯¹è±¡ï¼Œç„¶åè¿™ä¸ªBeanå¯¹è±¡äº¤ç»™Springç®¡ç†ã€‚äº§ç”Ÿè¿™ä¸ªBeanå¯¹è±¡çš„æ–¹æ³•Springåªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œéšåè¿™ä¸ªSpringå°†ä¼šå°†è¿™ä¸ªBeanå¯¹è±¡æ”¾åœ¨è‡ªå·±çš„IOCå®¹å™¨ä¸­ã€‚(å’Œxmlé…ç½®ä¸­çš„beanæ ‡ç­¾çš„ä½œç”¨æ˜¯ä¸€æ ·çš„)</p>
<p>@Beanä¸»è¦ç”¨åœ¨@Configurationæ³¨è§£çš„ç±»ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨@Componentæ³¨è§£çš„ç±»ä¸­ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class AppConfig &#123;</span><br><span class="line"> </span><br><span class="line">    // ä½¿ç”¨@Bean æ³¨è§£è¡¨æ˜myBeanéœ€è¦äº¤ç»™Springè¿›è¡Œç®¡ç†</span><br><span class="line">    // æœªæŒ‡å®šbean çš„åç§°ï¼Œé»˜è®¤é‡‡ç”¨çš„æ˜¯æ–¹æ³•åçš„é…ç½®æ–¹å¼</span><br><span class="line">    @Bean</span><br><span class="line">    public MyBean buildMyBean()&#123;</span><br><span class="line">        return new MyBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">public class MyBean &#123;</span><br><span class="line"> </span><br><span class="line">    public MyBean()&#123;</span><br><span class="line">        System.out.println(&quot;MyBean Initializing&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»SpringBeanApplicationTestsï¼Œæµ‹è¯•ä¸Šè¿°ä»£ç çš„æ­£ç¡®æ€§</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SpringBeanApplicationTests &#123;</span><br><span class="line"> </span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);</span><br><span class="line">        context.getBean(&quot;buildMyBean&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Beançš„å±æ€§ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">valueï¼šbeanåˆ«åå’Œnameæ˜¯ç›¸äº’ä¾èµ–å…³è”çš„ï¼Œvalue,nameå¦‚æœéƒ½ä½¿ç”¨çš„è¯å€¼å¿…é¡»è¦ä¸€è‡´ï¼›</span><br><span class="line"></span><br><span class="line">nameï¼šbeanåç§°ï¼Œå¦‚æœä¸å†™ä¼šé»˜è®¤ä¸ºæ³¨è§£çš„æ–¹æ³•åç§°ï¼›</span><br><span class="line"></span><br><span class="line">autowireï¼šè‡ªå®šè£…é…é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œå»ºè®®å°½é‡ä¸è¦å¼€å¯ï¼Œå› ä¸ºè‡ªåŠ¨è£…é…ä¸èƒ½è£…é…åŸºæœ¬æ•°æ®ç±»å‹ã€å­—ç¬¦ä¸²ã€æ•°ç»„ç­‰ï¼Œè¿™æ˜¯è‡ªåŠ¨è£…é…è®¾è®¡çš„å±€é™æ€§ï¼Œå¹¶ä¸”è‡ªåŠ¨è£…é…ä¸å¦‚ä¾èµ–æ³¨å…¥ç²¾ç¡®ï¼›</span><br><span class="line"></span><br><span class="line">initMethodï¼šbeançš„åˆå§‹åŒ–ä¹‹å‰çš„æ‰§è¡Œæ–¹æ³•ï¼Œè¯¥å‚æ•°ä¸€èˆ¬ä¸æ€ä¹ˆç”¨ï¼Œå› ä¸ºå®Œå…¨å¯ä»¥åœ¨ä»£ç ä¸­å®ç°ï¼›</span><br><span class="line"></span><br><span class="line">destroyMethodï¼šé»˜è®¤ä½¿ç”¨javaConfigé…ç½®çš„beanï¼Œå¦‚æœå­˜åœ¨closeæˆ–è€…shutdownæ–¹æ³•ï¼Œåˆ™åœ¨beané”€æ¯æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¦‚æœä½ ä¸æƒ³æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œåˆ™æ·»åŠ @Bean(destroyMethod=&quot;&quot;)æ¥é˜²æ­¢å‡ºå‘é”€æ¯æ–¹æ³•ï¼›</span><br></pre></td></tr></table></figure>

<p>Springä¸­çš„@Beanæ³¨è§£ï¼š<a href="https://blog.csdn.net/weixin_36380516/article/details/119194065">https://blog.csdn.net/weixin_36380516/article/details/119194065</a></p>
<h3 id="Beanå’Œ-Component"><a href="#Beanå’Œ-Component" class="headerlink" title="@Beanå’Œ@Component"></a>@Beanå’Œ@Component</h3><ul>
<li>@Componentæ³¨è§£è¡¨æ˜ä¸€ä¸ªç±»ä¼šä½œä¸ºç»„ä»¶ç±»ï¼Œå¹¶å‘ŠçŸ¥Springè¦ä¸ºè¿™ä¸ªç±»åˆ›å»ºbeanã€‚</li>
<li>@Beanæ³¨è§£å‘Šè¯‰Springè¿™ä¸ªæ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è¦æ³¨å†Œä¸ºSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„beanã€‚é€šå¸¸æ–¹æ³•ä½“ä¸­åŒ…å«äº†æœ€ç»ˆäº§ç”Ÿbeanå®ä¾‹çš„é€»è¾‘ã€‚</li>
</ul>
<p>ç›¸åŒç‚¹ï¼šä¸¤è€…çš„ç»“æœéƒ½æ˜¯ä¸ºspringå®¹å™¨æ³¨å†ŒBean.<br>ä¸åŒç‚¹ï¼š@Component é€šå¸¸æ˜¯é€šè¿‡ç±»è·¯å¾„æ‰«ææ¥è‡ªåŠ¨ä¾¦æµ‹ä»¥åŠè‡ªåŠ¨è£…é…åˆ°Springå®¹å™¨ä¸­ã€‚<br>ã€€ã€€ã€€ã€€@Bean æ³¨è§£é€šå¸¸æ˜¯æˆ‘ä»¬åœ¨æ ‡æœ‰è¯¥æ³¨è§£çš„æ–¹æ³•ä¸­å®šä¹‰äº§ç”Ÿè¿™ä¸ªbeançš„é€»è¾‘ã€‚</p>
<blockquote>
<p>@Component ï¼ˆ@Controller @Service @Respositoryï¼‰ä½œç”¨äºç±»ä¸Šï¼Œåªæœ‰åœ¨æˆ‘ä»¬çš„SpringBootåº”ç”¨ç¨‹åºå¯ç”¨äº†ç»„ä»¶æ‰«æå¹¶ä¸”åŒ…å«äº†è¢«æ³¨è§£çš„ç±»æ—¶æ‰æœ‰æ•ˆã€‚é€šè¿‡ç»„ä»¶æ‰«æï¼ŒSpringå°†æ‰«ææ•´ä¸ªç±»è·¯å¾„ï¼Œå¹¶å°†æ‰€æœ‰@Componentæ³¨é‡Šç±»æ·»åŠ åˆ°Spring Contextï¼Œè¿™é‡Œæœ‰çš„ä¸è¶³å°±æ˜¯ä¼šæŠŠæ•´ä¸ªç±»å½“æˆbeanæ³¨å†Œåˆ°spring å®¹å™¨ä¸Šï¼Œå¦‚æœè¿™ä¸ªç±»ä¸­å¹¶ä¸æ˜¯æ‰€æœ‰æ–¹æ³•éƒ½éœ€è¦æ³¨å†Œä¸ºbeançš„è¯ï¼Œä¼šå‡ºç°ä¸éœ€è¦çš„æ–¹æ³•éƒ½æ³¨å†Œæˆä¸ºbeanï¼Œè¿™æ—¶å€™å¿…é¡»ç¡®ä¿è¿™äº›ä¸éœ€è¦çš„æ–¹æ³•ä¹Ÿèƒ½æ³¨å†Œä¸ºbeanæˆ–è€…åœ¨æ‰«æä¸­åŠ filter è¿‡æ»¤è¿™äº›ä¸éœ€è¦çš„bean,å¦è€…springå°†æ— æ³•æˆåŠŸå¯åŠ¨ã€‚</p>
</blockquote>
<blockquote>
<p>@Beanç›¸å¯¹æ¥è¯´å°±æ›´åŠ çµæ´»äº†ï¼Œå®ƒå¯ä»¥ç‹¬ç«‹åŠ åœ¨æ–¹æ³•ä¸Šï¼ŒæŒ‰éœ€æ³¨å†Œåˆ°springå®¹å™¨ï¼Œè€Œä¸”å¦‚æœä½ è¦ç”¨åˆ°ç¬¬ä¸‰æ–¹ç±»åº“é‡Œé¢æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼ˆæˆ–è€…ç±»ï¼Ÿï¼‰ï¼Œä½ å°±åªèƒ½ç”¨@BeanæŠŠè¿™ä¸ªæ–¹æ³•æ³¨å†Œåˆ°springå®¹å™¨ï¼Œå› ä¸ºç”¨@Componentä½ éœ€è¦é…ç½®ç»„ä»¶æ‰«æåˆ°è¿™ä¸ªç¬¬ä¸‰æ–¹ç±»è·¯å¾„è€Œä¸”è¿˜è¦åœ¨åˆ«äººæºä»£ç åŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸ç°å®çš„ã€‚</p>
</blockquote>
<p>â¤ï¸å½“æˆ‘ä»¬å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»éœ€è¦è£…é…åˆ°Springå®¹å™¨æ—¶ï¼Œåˆ™åªèƒ½é€šè¿‡@Beanæ¥å®ç°<br>æ€»ç»“ï¼š@Componentå’Œ@Beanéƒ½æ˜¯ç”¨æ¥æ³¨å†ŒBeanå¹¶è£…é…åˆ°Springå®¹å™¨ä¸­ï¼Œä½†æ˜¯Beanæ¯”Componentçš„è‡ªå®šä¹‰æ€§æ›´å¼ºã€‚å¯ä»¥å®ç°ä¸€äº›Componentå®ç°ä¸äº†çš„è‡ªå®šä¹‰åŠ è½½ç±»ã€‚ç‰¹åˆ«æ˜¯äºŒæ–¹åº“æˆ–ä¸‰æ–¹åº“çš„ç±»è£…é…ä¸ºbeanï¼Œåªèƒ½ç”¨@Beanã€‚</p>
<h3 id="å®ç°FactoryBeanæ¥å£"><a href="#å®ç°FactoryBeanæ¥å£" class="headerlink" title="å®ç°FactoryBeanæ¥å£"></a>å®ç°FactoryBeanæ¥å£</h3><p>org.springframework.beans.factoryä¸­</p>
<p>FactoryBeanæ˜¯ä¸€ä¸ªå·¥å‚Beanï¼Œå¯ä»¥ç”ŸæˆæŸä¸€ä¸ªç±»å‹Beanå®ä¾‹ï¼Œå®ƒæœ€å¤§çš„ä¸€ä¸ªä½œç”¨æ˜¯ï¼šå¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰Beançš„åˆ›å»ºè¿‡ç¨‹ã€‚BeanFactoryæ˜¯Springå®¹å™¨ä¸­çš„ä¸€ä¸ªåŸºæœ¬ç±»ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªç±»ï¼Œåœ¨BeanFactoryä¸­å¯ä»¥åˆ›å»ºå’Œç®¡ç†Springå®¹å™¨ä¸­çš„Beanï¼Œå®ƒå¯¹äºBeançš„åˆ›å»ºæœ‰ä¸€ä¸ªç»Ÿä¸€çš„æµç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface FactoryBean&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    //è¿”å›çš„å¯¹è±¡å®ä¾‹</span><br><span class="line">    T getObject() throws Exception;</span><br><span class="line">    //Beançš„ç±»å‹</span><br><span class="line">    Class&lt;?&gt; getObjectType();</span><br><span class="line">    //trueæ˜¯å•ä¾‹ï¼Œfalseæ˜¯éå•ä¾‹  åœ¨Spring5.0ä¸­æ­¤æ–¹æ³•åˆ©ç”¨äº†JDK1.8çš„æ–°ç‰¹æ€§å˜æˆäº†defaultæ–¹æ³•ï¼Œè¿”å›true</span><br><span class="line">    boolean isSingleton();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>FactoryBeanä¸­å®šä¹‰äº†ä¸€ä¸ªSpring Beançš„å¾ˆé‡è¦çš„ä¸‰ä¸ªç‰¹æ€§ï¼šæ˜¯å¦å•ä¾‹ã€Beanç±»å‹ã€Beanå®ä¾‹ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//FactoryBeanæ¥å£çš„å®ç°ç±»</span><br><span class="line">@Component</span><br><span class="line">public class FactoryBeanLearn implements FactoryBean &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object getObject() throws Exception &#123;</span><br><span class="line">        //è¿™ä¸ªBeanæ˜¯æˆ‘ä»¬è‡ªå·±newçš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶Beançš„åˆ›å»ºè¿‡ç¨‹äº†</span><br><span class="line">        return new FactoryBeanServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        return FactoryBeanService.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isSingleton() &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//æ¥å£</span><br><span class="line">public interface FactoryBeanService &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æµ‹è¯•FactoryBean</span><br><span class="line">     */</span><br><span class="line">    void testFactoryBean();</span><br><span class="line">&#125;</span><br><span class="line">//å®ç°ç±»</span><br><span class="line">public class FactoryBeanServiceImpl implements FactoryBeanService &#123;</span><br><span class="line">    /**</span><br><span class="line">     * æµ‹è¯•FactoryBean</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void testFactoryBean() &#123;</span><br><span class="line">        System.out.println(&quot;æˆ‘æ˜¯FactoryBeançš„ä¸€ä¸ªæµ‹è¯•ç±»ã€‚ã€‚ã€‚ã€‚&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//å•æµ‹</span><br><span class="line">@Test</span><br><span class="line">public void test() &#123;</span><br><span class="line">        ClassPathXmlApplicationContext cac = new ClassPathXmlApplicationContext(&quot;classpath:com/zkn/spring/learn/base/applicationContext.xml&quot;);</span><br><span class="line">        FactoryBeanService beanService = cac.getBean(FactoryBeanService.class);</span><br><span class="line">        beanService.testFactoryBean();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>â¤ï¸FactoryBeanæ˜¯è‡ªå®šä¹‰äº†ä¸€ç§æ³¨å…¥Beançš„æ–¹æ³•ï¼Œåœ¨ç±»ä¸­æ²¡æœ‰åŠ æ³¨è§£ï¼Œä¹Ÿæ²¡æœ‰xmlä¸­é…ç½®ï¼Œä½†æ˜¯å®ç°FactoryBeanæ¥å£ï¼Œé‡å†™getObjectæ–¹æ³•æ¥è¿”å›å¯¹è±¡ï¼Œè¡¨ç¤ºæ³¨å…¥äº†beanï¼Œé‡å†™getObjectTypeè¡¨ç¤ºè·å–beanæ—¶beançš„ç±»å‹ã€‚ç„¶åå°±å¯ä»¥é€šè¿‡getBean(ç±»å‹.class)è·å–beanå®ä¾‹äº†ã€‚<br>è‡³äºï¼Œå¦‚ä½•é€šè¿‡ApplicationContext.getBean()ï¼Œè§ï¼š<a href="https://blog.csdn.net/zknxx/article/details/79572387">https://blog.csdn.net/zknxx/article/details/79572387</a></p>
<h3 id="ApplicationContextAwareæ¥å£"><a href="#ApplicationContextAwareæ¥å£" class="headerlink" title="ApplicationContextAwareæ¥å£"></a>ApplicationContextAwareæ¥å£</h3><p>org.springframework.contextä¸­</p>
<p>å½“ä¸€ä¸ªç±»å®ç°äº†è¿™ä¸ªæ¥å£ä¹‹åï¼Œè¿™ä¸ªç±»å°±å¯ä»¥æ–¹ä¾¿çš„è·å¾—ApplicationContextå¯¹è±¡ï¼ˆspringä¸Šä¸‹æ–‡ï¼‰ï¼ŒSpringå‘ç°æŸä¸ªBeanå®ç°äº†ApplicationContextAwareæ¥å£ï¼ŒSpringå®¹å™¨ä¼šåœ¨åˆ›å»ºè¯¥Beanä¹‹åï¼Œè‡ªåŠ¨è°ƒç”¨è¯¥Beançš„setApplicationContextï¼ˆå‚æ•°ï¼‰æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œä¼šå°†å®¹å™¨æœ¬èº«ApplicationContextå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥æ–¹æ³•ã€‚</p>
<p>â¤ï¸ä¹‹å‰è·å–ApplicationContextéœ€è¦åŠ è½½é…ç½®æ–‡ä»¶ä»è€Œåˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä½†æ˜¯å®ç°äº†ApplicationContextAwareæ¥å£ï¼Œspringè‡ªåŠ¨å°†å®¹å™¨æœ¬èº«ApplicationContextå¯¹è±¡ä¼ é€’ç»™å…¶ä¸­çš„æ–¹æ³•setApplicationContextã€‚å®ç°å®ƒçš„ç±»ï¼Œå¯ä»¥åœ¨ç±»ä¸­åˆ›å»ºç§æœ‰çš„ApplicationContextå˜é‡ï¼Œåœ¨setApplicationContextä¸­this. &#x3D; è¿›è¡Œä¼ é€’ã€‚</p>
<p>å®ç°ApplicationContextAwareæ¥å£å¯ä»¥æ–¹ä¾¿è·å–ApplicationContextï¼Œå³springå®¹å™¨ï¼Œè·å–å®¹å™¨ä¹‹åå°±å¯ä»¥æ–¹ä¾¿è·å–beanã€‚</p>
<p>ä¾‹å­ï¼š<br>è·å–ä¸€ä¸ªæ’åºå·¥å‚ï¼š</p>
<p>æ’åºæ¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface Sort &#123;</span><br><span class="line">    SortType getSortType();</span><br><span class="line">    int[] sorting(int[] sourceArray);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ’åºç®—æ³•å®ç°æ¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class SelectionSort implements Sort &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public SortType getSortType() &#123;</span><br><span class="line">        return SortType.SELECTION;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public int[] sorting(int[] sourceArray) &#123;</span><br><span class="line">        int[] arr = Arrays.copyOf(sourceArray, sourceArray.length);</span><br><span class="line"> </span><br><span class="line">        // æ€»å…±è¦ç»è¿‡ N-1 è½®æ¯”è¾ƒ</span><br><span class="line">        for (int i = 0; i &lt; arr.length - 1; i++) &#123;</span><br><span class="line">            int min = i;</span><br><span class="line"> </span><br><span class="line">            // æ¯è½®éœ€è¦æ¯”è¾ƒçš„æ¬¡æ•° N-i</span><br><span class="line">            for (int j = i + 1; j &lt; arr.length; j++) &#123;</span><br><span class="line">                if (arr[j] &lt; arr[min]) &#123;</span><br><span class="line">                    // è®°å½•ç›®å‰èƒ½æ‰¾åˆ°çš„æœ€å°å€¼å…ƒç´ çš„ä¸‹æ ‡</span><br><span class="line">                    min = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            // å°†æ‰¾åˆ°çš„æœ€å°å€¼å’Œiä½ç½®æ‰€åœ¨çš„å€¼è¿›è¡Œäº¤æ¢</span><br><span class="line">            if (i != min) &#123;</span><br><span class="line">                int temp = arr[i];</span><br><span class="line">                arr[i] = arr[min];</span><br><span class="line">                arr[min] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        return arr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æšä¸¾æ’åºç±»å‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public enum SortType &#123;</span><br><span class="line">    SELECTION,</span><br><span class="line">    BUBBLE,</span><br><span class="line">    INSERT,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ’åºå·¥å‚ï¼Œå®ç° ApplicationContextAware æ¥å£:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class SortFactory implements ApplicationContextAware &#123;</span><br><span class="line">    private static Map&lt;SortType, Sort&gt; sortBeanMap = new ConcurrentHashMap&lt;&gt;(16);</span><br><span class="line">    @Override</span><br><span class="line">    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123;</span><br><span class="line">        Map&lt;String, Sort&gt; map = applicationContext.getBeansOfType(Sort.class);</span><br><span class="line">        map.forEach((key, value) -&gt; sortBeanMap.put(value.getSortType(), value));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public int[] sorting(SortType sortType, int[] sourceArray) &#123;</span><br><span class="line">        Sort sort = sortBeanMap.get(sortType);</span><br><span class="line">        return sort.sorting(sourceArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class SortController &#123;</span><br><span class="line"> </span><br><span class="line">    private final SortFactory sortFactory;</span><br><span class="line"> </span><br><span class="line">    public SortController(SortFactory sortFactory) &#123;</span><br><span class="line">        this.sortFactory = sortFactory;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @PostMapping(value = &quot;factory/sort&quot;)</span><br><span class="line">    public Object sortFactory(SortType sortType, int[] sourceArr) &#123;</span><br><span class="line">        return sortFactory.sorting(sortType, sourceArr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒè‡ªï¼š<a href="https://blog.csdn.net/weixin_33898233/article/details/91414228">https://blog.csdn.net/weixin_33898233/article/details/91414228</a></p>
<h3 id="InitialzingBeanæ¥å£"><a href="#InitialzingBeanæ¥å£" class="headerlink" title="InitialzingBeanæ¥å£"></a>InitialzingBeanæ¥å£</h3><p>å½“ä¸€ä¸ªç±»å®ç°è¿™ä¸ªæ¥å£ä¹‹åï¼ŒSpringå¯åŠ¨åï¼Œåˆå§‹åŒ–Beanæ—¶ï¼Œè‹¥è¯¥Beanå®ç°InitialzingBeanæ¥å£ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨afterPropertiesSet()æ–¹æ³•ï¼Œå®Œæˆä¸€äº›ç”¨æˆ·è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ“ä½œã€‚</p>
<p>åŒæ ·é…ç½®Beançš„æ—¶å€™ä½¿ç”¨init-methodä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼çš„æ“ä½œã€‚ï¼ˆä¸éœ€è¦å®ç°InitialzingBeanæ¥å£ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void afterPropertiesSet() throws Exception &#123;&#125;</span><br><span class="line"></span><br><span class="line">&lt;bean id = &quot;springBeanInit02&quot; class = &quot;com.lyj.studySpringBoot.init.SpringBeanInit&quot; init-method=&quot;testInit&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;id&quot; value=&quot;#&#123;1111111&#125;&quot; /&gt;</span><br><span class="line">	&lt;property name=&quot;name&quot; value=&quot;$&#123;test.springEL&#125;&quot; /&gt;</span><br><span class="line">	&lt;property name=&quot;age&quot; value=&quot;#&#123;10+8&#125;&quot; /&gt; // SpringELè¡¨è¾¾å¼</span><br><span class="line">	&lt;property name=&quot;sex&quot; value=&quot;false&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">ç³»ç»Ÿæ˜¯å…ˆè°ƒç”¨afterPropertiesSetæ–¹æ³•ï¼Œç„¶ååœ¨è°ƒç”¨init-methodä¸­æŒ‡å®šçš„æ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure>

<p>Springæ˜¯é€šè¿‡åå°„æ¥è°ƒç”¨init-methodæŒ‡å®šæ–¹æ³•ï¼Œè€Œå®ç°InitializingBeanæ¥å£æ˜¯ç›´æ¥è°ƒç”¨afterPropertiesSetæ–¹æ³•ï¼Œæ‰€ä»¥åè€…æ•ˆç‡é«˜ï¼Œä½†ä½¿ç”¨init-methodæ–¹å¼å‡å°‘äº†å¯¹Springçš„ä¾èµ–ã€‚</p>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_40093255/article/details/117318760">https://blog.csdn.net/qq_40093255/article/details/117318760</a></p>
<h3 id="MethodInterceptoræ¥å£-æ‹¦æˆªå™¨"><a href="#MethodInterceptoræ¥å£-æ‹¦æˆªå™¨" class="headerlink" title="MethodInterceptoræ¥å£-æ‹¦æˆªå™¨"></a>MethodInterceptoræ¥å£-æ‹¦æˆªå™¨</h3><p>org.aopalliance.interceptä¸­<br>MethodInterceptoræ¥å£ç»§æ‰¿äº†Interceptoræ¥å£ï¼ŒInterceptoæ¥å£åˆç»§æ‰¿äº†Adviceæ¥å£ï¼Œå› æ­¤æˆ‘ä¸ªå°†è¿™æ‹¦æˆªå™¨ç§°ä¸ºä¸€ä¸ªé€šçŸ¥ã€‚</p>
<p>å®ç°MethodInterceptor æ¥å£ï¼Œåœ¨è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå°±å¯ä»¥å®ç°åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰ã€è°ƒç”¨æ–¹æ³•è¿‡ç¨‹ä¸­ã€è°ƒç”¨æ–¹æ³•ä¹‹åå¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚</p>
<p>æ‹¦æˆªå™¨å°±åƒæ˜¯å»ºç«‹äº†ä¸€ä¸ªé€šçŸ¥ã€‚ç”¨åˆ‡é¢åšå¢å¼ºä¸€æ ·ã€‚</p>
<p>ç®€å•çš„ä¾‹å­ï¼š<a href="https://blog.csdn.net/u012834750/article/details/71773887">https://blog.csdn.net/u012834750/article/details/71773887</a><br>1.å®ç°æ¥å£é‡å†™invokeæ–¹æ³•ï¼Œåšå¢å¼º<br>2.å†™ä¸€ä¸ªç®€å•æ–¹æ³•<br>3.æµ‹è¯•ä¸­ï¼Œç”¨ä»£ç†å·¥å‚è®¾ç½®ä»£ç†å¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class TestMethodInterceptor  &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // åˆå§‹åŒ–ä¸€ä¸ªä»£ç†å·¥å‚</span><br><span class="line">        ProxyFactory proxyFactory=new ProxyFactory();</span><br><span class="line"></span><br><span class="line">        // è®¾ç½®ç›®æ ‡ç±»ï¼Œä»¥ä¾¿äºCglibå·¥å…·åŒ…åŠ¨æ€ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œå³æˆ‘ä»¬æ‰€éœ€çš„ä»£ç†ç±»</span><br><span class="line">        // æœ€å¥½æŠŠå®ç°ç±»å•ç‹¬å†™ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯å®ç°ç±»ï¼ˆä¸šåŠ¡ï¼‰</span><br><span class="line">        proxyFactory.setTarget(new TestMethodInterceptor());</span><br><span class="line"></span><br><span class="line">        // è®¾ç½®æ‹¦æˆªå™¨ï¼Œè€Œæ‹¦æˆªå™¨çš„&quot;public Object invoke(MethodInvocation mi)&quot;å®šä¹‰äº†ä»£ç†ç±»ï¼ˆå®é™…æ˜¯UserDaoImplçš„å­ç±»ï¼‰çš„æ–¹æ³•ç”Ÿæˆç­–ç•¥ã€‚</span><br><span class="line">        proxyFactory.addAdvice(new adviseMethodInterceptor());</span><br><span class="line"></span><br><span class="line">        // è·å–ä»£ç†ç±»</span><br><span class="line">        Object proxy = proxyFactory.getProxy();</span><br><span class="line">         // å‘ä¸Šè½¬å‹ï¼Œè½¬å‹ä¸ºçˆ¶ç±»ç±»å‹</span><br><span class="line">        TestMethodInterceptor methodInterceptor = (TestMethodInterceptor) proxy;</span><br><span class="line"></span><br><span class="line">        methodInterceptor.doSomeThing(&quot;é€šè¿‡ä»£ç†å·¥å‚è®¾ç½®ä»£ç†å¯¹è±¡ï¼Œæ‹¦æˆªä»£ç†æ–¹æ³•&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class adviseMethodInterceptor implements MethodInterceptor&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Object invoke(MethodInvocation methodInvocation) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">            Object result=null;</span><br><span class="line">            try&#123;</span><br><span class="line">                System.out.println(&quot;æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼š&quot;+methodInvocation.getMethod().toString());</span><br><span class="line"></span><br><span class="line">                result= methodInvocation.proceed();</span><br><span class="line"></span><br><span class="line">                System.out.println(&quot;æ–¹æ³•æ‰§è¡Œä¹‹åï¼š&quot;+methodInvocation.getMethod().toString());</span><br><span class="line">                System.out.println(&quot;æ–¹æ³•æ­£å¸¸è¿è¡Œç»“æœï¼š&quot;+result);</span><br><span class="line"></span><br><span class="line">                return result;</span><br><span class="line"></span><br><span class="line">            &#125;catch (Exception e)&#123;</span><br><span class="line">                System.out.println(&quot;æ–¹æ³•å‡ºç°å¼‚å¸¸:&quot;+e.toString());</span><br><span class="line">                System.out.println(&quot;æ–¹æ³•è¿è¡ŒExceptionç»“æœï¼š&quot;+result);</span><br><span class="line">                return result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String doSomeThing(String someThing)&#123;</span><br><span class="line"></span><br><span class="line">        //int i=5/0;</span><br><span class="line">        return &quot;æ‰§è¡Œè¢«æ‹¦æˆªçš„æ–¹æ³•ï¼š&quot;+someThing;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AOPéƒ½æ˜¯åŸºäºï¼ˆCglibï¼‰ä»£ç†æ¨¡å¼å®ç°çš„ï¼Œå…¶ä¸­çš„å…³é”®ç‚¹åœ¨äºå®ç°MethodInterceptoræ¥å£ï¼Œåœ¨å…¶â€œpublic Object invoke(MethodInvocation mi)â€æ–¹æ³•ä¸­åˆ¶å®šä»£ç†æ–¹æ³•çš„ç”Ÿæˆç­–ç•¥ï¼Œè€Œä»æ­¤æ–¹æ³•çš„MethodInvocationç±»å‹å‚æ•°miä¸­å¯ä»¥è·å¾—ç›®æ ‡å¯¹è±¡ã€ç›®æ ‡æ–¹æ³•ã€æ–¹æ³•çš„å‚æ•°ç­‰ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›ä¿¡æ¯å¯ä»¥ç²¾ç¡®åœ°æ§åˆ¶å¢å¼ºæ•ˆæœã€‚</p>
<p>invokeæ–¹æ³•çš„ä¼ å‚æ˜¯MethodInvocationï¼Œè¡¨ç¤ºæ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// è·å–æ–¹æ³•å</span><br><span class="line">String methodName = mi.getMethod().getName();</span><br><span class="line">if (methodName.startsWith(&quot;add&quot;))</span><br><span class="line"></span><br><span class="line">// æ‰§è¡Œç›®æ ‡æ–¹æ³•</span><br><span class="line">result= methodInvocation.proceed();</span><br><span class="line"></span><br><span class="line">// è·å–æ–¹æ³•å‚æ•°</span><br><span class="line">Object[] args = methodInvocation.getArguments();</span><br></pre></td></tr></table></figure>

<p>å¦ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ä¾‹å­ï¼š<br><a href="https://www.cnblogs.com/gocode/p/aop-in-spring.html">https://www.cnblogs.com/gocode/p/aop-in-spring.html</a></p>
<p>â¤ï¸æ€»ç»“ï¼šæ‹¦æˆªå™¨ï¼Œå¯ä»¥ä»¥åŠ¨æ€ä»£ç†çš„æ–¹å¼æ‰§è¡Œæ–¹æ³•ï¼Œå¦ä¸€ä¸ªä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªåˆ‡é¢ï¼Œå…·ä½“çš„é€šçŸ¥åœ¨invokeä¸­åŠ ï¼Œä¼ å…¥å‚æ•°å¯ä»¥è·å–ç›®æ ‡å¯¹è±¡ã€æ–¹æ³•ã€æ–¹æ³•å‚æ•°ï¼Œä»è€Œé€‰æ‹©å¯¹ä¸åŒåˆ‡å…¥ç‚¹è¿›è¡Œä¸åŒçš„é€šçŸ¥&#x2F;å¢å¼ºã€‚ä¹Ÿå¯ä»¥ä¸åŠ é€šçŸ¥ï¼Œåªæ˜¯proceedæ‰§è¡Œæœ¬æ–¹æ³•ã€‚</p>
<p>âœ…æ‹¦æˆªå™¨ä¸ºä»€ä¹ˆä¸€å®šè¦åŠ @Componentï¼Ÿ</p>
<p>åœ¨Spring æ¡†æ¶ä¸­ï¼Œä½¿ç”¨ @Componentæ³¨è§£å°†ä¸€ä¸ªç±»æ ‡è®°ä¸ºç»„ä»¶ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»å¯ä»¥è¢« Spring å®¹å™¨æ‰«æå¹¶åˆ›å»ºå®ä¾‹ã€‚<br>åœ¨AOPä¸­ï¼Œåˆ‡é¢ç±»éœ€è¦è¢« Spring å®¹å™¨ç®¡ç†ï¼Œæ‰€ä»¥éœ€è¦å°†è¿™ä¸ªç±»åŠ ä¸Š@Componentæ³¨è§£ï¼Œä»¥ä¾¿è¢«Spring å®¹å™¨æ‰«æå¹¶åˆ›å»ºå®ä¾‹ã€‚å¦‚æœä¸åŠ @Componentæ³¨è§£ï¼Œè¿™ä¸ªåˆ‡é¢ç±»å°±ä¸ä¼šè¢«Spring å®¹å™¨ç®¡ç†ï¼Œä¹Ÿå°±æ— æ³•æ‰§è¡Œæ‹¦æˆªçš„é€»è¾‘ã€‚<br>å¦å¤–ï¼Œå¦‚æœè¿™ä¸ªåˆ‡é¢ç±»éœ€è¦æ³¨å…¥å…¶ä»–ä¾èµ–ï¼Œæ¯”å¦‚æ•°æ®æºã€ç¼“å­˜ç­‰ï¼Œä¹Ÿéœ€è¦åŠ ä¸Š @Componentæ³¨è§£ï¼Œä»¥ä¾¿è¢« Springå®¹å™¨ç®¡ç†ã€‚å¦‚æœä¸åŠ  @Component æ³¨è§£ï¼Œè¿™äº›ä¾èµ–ä¹Ÿæ— æ³•è¢«æ³¨å…¥ï¼Œä¼šå¯¼è‡´ä»£ç å‡ºç°é”™è¯¯ã€‚<br>æ€»ä¹‹ï¼ŒåŠ ä¸Š@Componentæ³¨è§£å¯ä»¥è®©è¿™ä¸ªåˆ‡é¢ç±»è¢« Spring å®¹å™¨ç®¡ç†ï¼Œä»¥ä¾¿æ‰§è¡Œæ‹¦æˆªçš„é€»è¾‘ï¼Œå¹¶æ³¨å…¥å…¶ä»–ä¾èµ–ï¼Œç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<h3 id="ApplicationListeneræ¥å£-ç›‘å¬å™¨"><a href="#ApplicationListeneræ¥å£-ç›‘å¬å™¨" class="headerlink" title="ApplicationListeneræ¥å£-ç›‘å¬å™¨"></a>ApplicationListeneræ¥å£-ç›‘å¬å™¨</h3><p>ApplicationContextäº‹ä»¶æœºåˆ¶æ˜¯è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„å®ç°ï¼Œé€šè¿‡ApplicationEventç±»å’ŒApplicationListeneræ¥å£ï¼Œå¯ä»¥å®ç°ApplicationContextäº‹ä»¶å¤„ç†ã€‚</p>
<p>å¦‚æœå®¹å™¨ä¸­æœ‰ä¸€ä¸ªApplicationListener Beanï¼Œæ¯å½“ApplicationContextå‘å¸ƒApplicationEventæ—¶ï¼ŒApplicationListener Beanå°†è‡ªåŠ¨è¢«è§¦å‘ã€‚è¿™ç§äº‹ä»¶æœºåˆ¶éƒ½å¿…é¡»éœ€è¦ç¨‹åºæ˜¾ç¤ºpublishçš„è§¦å‘ã€‚</p>
<p>äº‹ä»¶å¯ä»¥è‡ªå®šä¹‰ã€ç›‘å¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œå®Œå…¨æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ¥å¤„ç†ã€‚</p>
<p>1.å®šä¹‰äº‹ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class EmailEvent extends ApplicationEvent&#123;</span><br><span class="line">ã€€ã€€ private String address;</span><br><span class="line">ã€€ã€€ private String text;</span><br><span class="line">ã€€ã€€ public EmailEvent(Object source, String address, String text)&#123;</span><br><span class="line">ã€€ã€€ super(source);</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ this.address = address;</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ this.text = text;</span><br><span class="line">ã€€ã€€ &#125;</span><br><span class="line">ã€€ã€€ public EmailEvent(Object source) &#123;</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€super(source);</span><br><span class="line">ã€€ã€€ &#125;</span><br><span class="line">ã€€ã€€ //......addresså’Œtextçš„setterã€getter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.ç›‘å¬äº‹ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class EmailNotifier implements ApplicationListener&#123;</span><br><span class="line">    // ç›‘å¬åäº‹ä»¶å¤„ç†çš„æ–¹æ³•ï¼Œå¯ä»¥å¯¹äº‹ä»¶åšä¸€äº›åˆ¤æ–­</span><br><span class="line">ã€€ã€€ public void onApplicationEvent(ApplicationEvent event) &#123;</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€if (event instanceof EmailEvent) &#123;</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€ã€€ EmailEvent emailEvent = (EmailEvent)event;</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€ã€€ System.out.println(&quot;é‚®ä»¶åœ°å€ï¼š&quot; + emailEvent.getAddress());</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€ã€€ System.our.println(&quot;é‚®ä»¶å†…å®¹ï¼š&quot; + emailEvent.getText());</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€&#125; else &#123;</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€ã€€ System.our.println(&quot;å®¹å™¨æœ¬èº«äº‹ä»¶ï¼š&quot; + event);</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€&#125;</span><br><span class="line">ã€€ã€€ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.è§¦å‘äº‹ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SpringTest &#123;</span><br><span class="line">ã€€ã€€ public static void main(String args[])&#123;</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ApplicationContext context = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€//åˆ›å»ºä¸€ä¸ªApplicationEventå¯¹è±¡</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€EmailEvent event = new EmailEvent(&quot;hello&quot;,&quot;abc@163.com&quot;,&quot;This is a test&quot;);</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€//ä¸»åŠ¨è§¦å‘è¯¥äº‹ä»¶</span><br><span class="line">ã€€ã€€ã€€ã€€ã€€context.publishEvent(event);</span><br><span class="line">ã€€ã€€ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥åœ¨æ‹¦æˆªå™¨ä¸­åšå¢å¼ºè§¦å‘ã€‚</p>
<p>ä¸ç®¡æ˜¯å†…ç½®ç›‘å¬è¿˜æ˜¯å¤–éƒ¨è‡ªå®šä¹‰ç›‘å¬ä¸€å®šè¦æŠŠå®ç°ApplicationListenerçš„ç±»å®šä¹‰æˆä¸€ä¸ªbeanæ‰è¡Œï¼Œå¯ä»¥æ˜¯é€šè¿‡æ³¨è§£@Componentç­‰ä¹Ÿå¯ä»¥é€šè¿‡xmlçš„æ–¹å¼å»æ‰§è¡Œã€‚</p>
<p>ç›‘å¬å™¨å®ç°ç±»å®ç°çš„ApplicationListeneræ¥å£ä¸­ï¼Œå¯ä»¥åŠ èŒƒå‹ï¼Œäº‹ä»¶ç±»å‹ã€‚</p>
<h3 id="æ¥å£é˜²åˆ·"><a href="#æ¥å£é˜²åˆ·" class="headerlink" title="æ¥å£é˜²åˆ·"></a>æ¥å£é˜²åˆ·</h3><p>å†™ä¸€ä¸ªé€šç”¨ç±»ç”¨redisé”æ¥å®ç°ï¼Œéœ€è¦å‰æ®µä¼ ä¸€ä¸ªä¸œè¥¿æ¥è¡¨ç¤ºredisçš„keyï¼š<br><a href="https://blog.csdn.net/qq_32871365/article/details/122113652">https://blog.csdn.net/qq_32871365/article/details/122113652</a></p>
<p>åœ¨å‰æ®µè®¿é—®å‰ï¼Œå…ˆä»åç«¯ç”³è¯·ä¸€ä¸ªtokenï¼Œç„¶åæ‹¿è¿™tockenè®¿é—®ï¼Œåç«¯æ ¡éªŒtockenï¼š<br><a href="https://blog.csdn.net/weixin_42071874/article/details/90402099">https://blog.csdn.net/weixin_42071874/article/details/90402099</a></p>
<p>è‡ªå®šä¹‰æ³¨è§£+redis+æ‹¦æˆªå™¨çš„æ–¹æ³•ï¼š<br><a href="https://blog.csdn.net/weixin_40918145/article/details/108734614">https://blog.csdn.net/weixin_40918145/article/details/108734614</a><br><a href="https://blog.csdn.net/qq_45637260/article/details/127692497">https://blog.csdn.net/qq_45637260/article/details/127692497</a><br>1.å†™ä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£ä¼ å¯è®¿é—®æ¬¡æ•°<br>2.å†™ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œè·å–è‡ªå®šä¹‰æ³¨è§£ï¼Œå¹¶ä¸”è·å–HttpServletRequestï¼Œä»ä¸­è·å–ipï¼Œç„¶åredisè®°å½•è®¿é—®æ¬¡æ•°<br>3.é…ç½®æ‹¦æˆªå™¨WebMvcConfigurerAdapter<br>4.controlleræ¥å£æ–¹æ³•ä¸ŠåŠ è‡ªå®šä¹‰æ³¨è§£</p>
<p>åŒæ ·æ˜¯ä»¥ipä¸ºç»´åº¦ï¼Œæ‹¦æˆªå™¨&#x2F;aopï¼š<br><a href="https://www.jb51.net/article/205093.htm">https://www.jb51.net/article/205093.htm</a></p>
<p>è‡ªå®šä¹‰æ³¨è§£ï¼šåˆ‡é¢aopï¼š<br><a href="https://blog.csdn.net/qq_34033209/article/details/118601590">https://blog.csdn.net/qq_34033209/article/details/118601590</a></p>
<p>tockenï¼š<a href="https://www.cnblogs.com/LilLazy/p/14708539.html">https://www.cnblogs.com/LilLazy/p/14708539.html</a></p>
]]></content>
      <categories>
        <category>springç†è§£</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠSpringå®æˆ˜ã€‹ç¬”è®°</title>
    <url>/2021/12/23/myblog/spring/%E3%80%8ASpring%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h3 id="springbootåœ¨ideaçš„RunDashboardå¦‚ä½•æ˜¾ç¤ºå‡ºæ¥"><a href="#springbootåœ¨ideaçš„RunDashboardå¦‚ä½•æ˜¾ç¤ºå‡ºæ¥" class="headerlink" title="springbootåœ¨ideaçš„RunDashboardå¦‚ä½•æ˜¾ç¤ºå‡ºæ¥"></a>springbootåœ¨ideaçš„RunDashboardå¦‚ä½•æ˜¾ç¤ºå‡ºæ¥</h3><p>è¿ç”¨spring cloudæ¡†æ¶åŸºäºspring bootæ„å»ºå¾®æœåŠ¡ï¼Œä¸€èˆ¬éœ€è¦å¯åŠ¨å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œåœ¨ideaå¼€å‘å·¥å…·ä¸­ï¼Œå¤šä¸ªåŒæ—¶å¯åŠ¨çš„åº”ç”¨éœ€è¦åœ¨RunDashboardè¿è¡Œä»ªè¡¨ç›˜ä¸­å¯ä»¥æ›´å¥½çš„ç®¡ç†ï¼Œä½†æœ‰æ—¶å€™ideaä¸­çš„RunDashboardçª—å£æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œä¹Ÿæ‰¾ä¸åˆ°ç›´æ¥çš„å¼€å¯æŒ‰é’®ã€‚</p>
<p>é€‰æ‹©Edit Configurationsï¼Œåœ¨è¿è¡Œé…ç½®çª—å£ï¼Œé€‰æ‹©ä¸€æ¡springbootçš„è¿è¡Œé…ç½®ï¼Œç„¶åç‚¹å‡»ä¸Šæ–¹çš„å¤åˆ¶æŒ‰é’®è¿›è¡Œå¤åˆ¶å‰¯æœ¬ï¼Œå¤åˆ¶å®Œæˆä¹‹åï¼Œç‚¹å‡»OKç¡®å®šæŒ‰é’®ï¼Œç„¶ååœ¨å±å¹•å³ä¸‹è§’å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¼¹æ¡†æç¤ºï¼Œç‚¹å‡»å¼¹æ¡†å³ä¸‹è§’çš„å‘ä¸‹çš„å°ç®­å¤´ï¼Œå±•å¼€å¼¹æ¡†è¯¦æƒ…ä¿¡æ¯ï¼Œç„¶åç‚¹å‡»Show run configurations in Run Dashboardï¼Œåœ¨Run Dashboardä¸­å¯ä»¥çœ‹åˆ°å½“å‰æ‰€æœ‰çš„å¯åŠ¨é…ç½®ï¼Œç›´æ¥ç‚¹å‡»å¯ä»¥æ–¹ä¾¿çš„å¯åŠ¨å’Œåœæ­¢ã€‚</p>
<p>ä»¥ä¸Šæ–¹æ³•è¿˜æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥çš„è¯ï¼Œåˆ™å¯ä»¥é€šè¿‡ä¿®æ”¹ideaçš„workspace.xmlçš„æ–¹å¼æ¥å¿«é€Ÿæ‰“å¼€Run Dashboardçª—å£ã€‚</p>
<p>æ‰“å¼€workspace.xmlæ–‡ä»¶ä¹‹åï¼Œæ‰¾åˆ°componentä¸ºRunDashboardçš„èŠ‚ç‚¹å¤„ï¼Œç„¶ååœ¨componentæ ‡ç­¾é‡Œæ·»åŠ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;option name=&quot;configurationTypes&quot;&gt;</span><br><span class="line">   &lt;set&gt;</span><br><span class="line">â€‹    &lt;option value=&quot;SpringBootApplicationConfigurationType&quot; /&gt;</span><br><span class="line">   &lt;/set&gt;</span><br><span class="line">  &lt;/option&gt;</span><br></pre></td></tr></table></figure>

<p>æœ€åä¿å­˜å³å¯ï¼Œä¿å­˜å®Œæˆä¹‹åç«‹å³è‡ªåŠ¨å¼¹å‡ºRun Dashboardçª—å£äº†ã€‚</p>
<h3 id="Tacoå•†åº—"><a href="#Tacoå•†åº—" class="headerlink" title="Tacoå•†åº—"></a>Tacoå•†åº—</h3><p>è·¯å¾„ã€é¢†åŸŸç±»ã€æ§åˆ¶å™¨ã€æ§åˆ¶å™¨è¿”å›çš„æ˜¯è¡¨å•ã€‚æ§åˆ¶å™¨ä¹Ÿå¯é‡å®šå‘åˆ°å¦ä¸€ä¸ªè·¯å¾„ã€‚æ¯ä¸ªæ§åˆ¶å™¨ç±»å¤„ç†ä¸€ä¸ªè·¯å¾„ï¼Œä¸€ä¸ªè·¯å¾„å¯ä»¥å¤„ç†getã€postï¼Œä¸€æ¬¡å¯ä»¥æœ‰ä¸åŒçš„æ–¹æ³•ã€‚è¡¨å•postè¯·æ±‚åˆ°æ§åˆ¶å™¨ã€‚</p>
<p>ç›®å‰çš„é¢†åŸŸç±»ï¼štacoã€orderã€ingredient</p>
<p>æ§åˆ¶ç±»ï¼šdesigncontrolã€ordercontrol</p>
<p>è¡¨å•ï¼šhomeã€designã€order</p>
<h3 id="ç¬¬äºŒç« è°ƒè¯•"><a href="#ç¬¬äºŒç« è°ƒè¯•" class="headerlink" title="ç¬¬äºŒç« è°ƒè¯•"></a>ç¬¬äºŒç« è°ƒè¯•</h3><p>1.åªæœ‰homeï¼Œåªæ˜¾ç¤ºä¸»é¡µã€‚</p>
<p>2.æœ‰designï¼Œæ˜¾ç¤ºdesigné¡µé¢ï¼Œæ²¡æœ‰è¡¨å•éªŒè¯ï¼Œé…æ–™æ˜¯è‡ªå·±å†™çš„ï¼Œç‚¹äº†submité”™è¯¯äº†ï¼Œ405 Request method â€˜POSTâ€™ not supportedã€‚</p>
<p>3.åŠ postæ–¹æ³•ï¼Œé‡å®šå‘ï¼ˆè·³è½¬ï¼‰åˆ°è®¢å•å¤„ç†æ§åˆ¶å™¨ï¼Œæ˜¾ç¤ºorderé¡µé¢ï¼Œæ³¨æ„ordercontrolé‡Œä¹Ÿæ˜¯ä¸€ä¸ªgetä¸€ä¸ªpostã€‚</p>
<p>4.æ·»åŠ è¡¨å•éªŒè¯ï¼Œä¸¤ä¸ªé¢†åŸŸç±»æ·»åŠ è§„åˆ™ï¼Œä¸¤ä¸ªæ§åˆ¶ç±»çš„postæäº¤è¡¨å•æ–¹æ³•è¿›è¡ŒéªŒè¯ï¼Œä¸¤ä¸ªè¡¨å•ä¹Ÿè¦åšç›¸åº”å˜åŒ–ï¼ŒåŠ spanã€‚ï¼ˆä¸åŠ @ModelAttribute(â€œdesignâ€) æ˜¯é”™çš„ï¼Œåªæ˜¯designcontrolï¼Œå¦å¤–ï¼Œç©ºç™½æ¡†æ—çš„true&#x2F;falseä¸çŸ¥é“å“ªæ¥çš„ï¼Œï¼‰ã€‚</p>
<p>5.ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨ï¼Œåˆ é™¤homecontrolï¼Œä¿®æ”¹homecontroltestã€‚</p>
<h3 id="ç¬¬ä¸‰ç« ä¸­"><a href="#ç¬¬ä¸‰ç« ä¸­" class="headerlink" title="ç¬¬ä¸‰ç« ä¸­"></a>ç¬¬ä¸‰ç« ä¸­</h3><p>ä¸¤ä¸ªæ–¹æ³•3.1å’Œ3.2æ˜¯å¹¶åˆ—çš„ï¼Œå¯ä»¥ç”¨è¿™ä¸ªä¸¤ç§æ–¹æ³•ï¼ŒJDBCå’ŒJPAï¼ŒJPAæ¯”JDBCç®€å•ã€‚</p>
<p>3.1ä¸­ï¼Œingredientåº“æ’å…¥æ•°æ®æ¯”è¾ƒç®€å•ï¼Œåªæ’å…¥ä¸€ä¸ªåº“ï¼Œä½†æ˜¯tacoå’Œorderæ¯”è¾ƒéš¾ï¼Œéƒ½æœ‰ä¸¤ä¸ªåº“è¦æ’å…¥ï¼Œæ’å…¥ä¸€ä¸ªåº“ä¹‹åéœ€è¦è·å¾—ä¸€ä¸ªidæ‰èƒ½æ’å…¥ç¬¬äºŒä¸ªåº“ï¼Œ3.1.4å…·ä½“æŒä¹…åŒ–æ–¹æ³•ä¸­æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼Œç¬¬äºŒç§æ¯”ç¬¬ä¸€ç§ç®€å•ã€‚</p>
<p>å¯¹äºingredientï¼Œéœ€è¦é¢„æ’å…¥æ•°æ®ã€‚</p>
<p>å¯¹designcontrolã€ordercontrolçš„ä¿®æ”¹ï¼Œç¬¬ä¸€åœ¨äºæ„é€ æ–¹æ³•å°†æ•°æ®åº“æ³¨å…¥åˆ°æ§åˆ¶å™¨ä¸­ï¼Œç¬¬äºŒåœ¨äºpostæ–¹æ³•æäº¤è¡¨å•éœ€è¦å°†æ•°æ®å­˜å…¥æ•°æ®åº“ã€‚</p>
<p>å…¶ä¸­æ¶‰åŠåˆ°sessionï¼Œç”¨äºä¿å­˜åœ¨ä¼šè¯ä¸­çš„ order å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥<strong>è·¨å¤šä¸ªè¯·æ±‚ä½¿ç”¨</strong>ã€‚å› ä¸ºå­˜å…¥orderæ•°æ®åº“çš„æ•°æ®é‡Œæœ‰tacoç›¸å…³çš„æ•°æ®ï¼Œéœ€è¦sessionæš‚å­˜ä¸€ä¸‹ã€‚</p>
<h3 id="ç¬¬ä¸‰ç« ç¬¬ä¸€èŠ‚JDBCè°ƒè¯•"><a href="#ç¬¬ä¸‰ç« ç¬¬ä¸€èŠ‚JDBCè°ƒè¯•" class="headerlink" title="ç¬¬ä¸‰ç« ç¬¬ä¸€èŠ‚JDBCè°ƒè¯•"></a>ç¬¬ä¸‰ç« ç¬¬ä¸€èŠ‚JDBCè°ƒè¯•</h3><p><code>lsof -i:8080</code>æŸ¥çœ‹ç«¯å£å ç”¨   å…³é—­è¿›ç¨‹ <code>kill pid</code></p>
<p>1.ä¸ºé¢†åŸŸç±»tacoã€orderæ·»åŠ idå’Œæ—¥æœŸã€‚</p>
<p>2.pom.xmlé‡Œæ·»åŠ jdbcã€h2ä¾èµ–</p>
<p>3.å…³äºingredientçš„æ”¹å˜ï¼šdataæ–‡ä»¶å¤¹ä¸‹ingredientrepoæ¥å£å’Œjdbcingredientrepoç±»ï¼Œç±»ä¸‹findæ–¹æ³•å’Œsaveæ–¹æ³•ã€‚æ”¹é€ DesignTacoControllerçš„æ„é€ æ–¹æ³•å’ŒshowDesignFormï¼Œå°†å›ºå®šé…æ–™æ”¹ä¸ºä»æ•°æ®åº“ä¸­è¯»å–é…æ–™ã€‚</p>
<p>4.å†™è¡¨ï¼Œé¢„åŠ è½½æ•°æ®ï¼Œschema.sql  data.sql</p>
<p>5.è®¾ç½®TacoRepositoryã€OrderRepositoryæ¥å£</p>
<p>6.å…³äºtacoï¼Œjdbcå®ç°çš„JdbcTacoRepositoryç±»ã€‚designtacocontrolä¸­æŒä¹…åŒ–çš„è¿‡ç¨‹ï¼Œæ„é€ å‡½æ•°ä¸ºpostæ–¹æ³•æ·»åŠ ä¸€ä¸ªå‚æ•°ã€‚æ”¹é€ postå‡½æ•°ï¼Œæ·»åŠ æŒä¹…åŒ–åˆ°æ•°æ®åº“çš„è¿‡ç¨‹ã€‚è¿˜è¦ä¸€ä¸ªtacoå’Œorderæ–¹æ³•ã€‚orderé¢†åŸŸç±»å†…æ·»åŠ ä¸€ä¸ªadddesignæ–¹æ³•ã€‚</p>
<p>7.å…³äºorderçš„æ”¹å˜ï¼Œä½¿ç”¨SimpleJdbcInsertæ–¹æ³•ï¼Œå®ç°JdbcOrderRepositoryç±»ï¼Œordercontrolä¸­çš„æŒä¹…åŒ–è¿‡ç¨‹ï¼Œæ„é€ å‡½æ•°å’Œpostå‡½æ•°åšæ”¹å˜ã€‚</p>
<h3 id="é”™è¯¯è®°å½•1"><a href="#é”™è¯¯è®°å½•1" class="headerlink" title="é”™è¯¯è®°å½•1"></a>é”™è¯¯è®°å½•1</h3><p>é”™è¯¯è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Error starting ApplicationContext. To display the conditions report re-run your application with <span class="string">&#x27;debug&#x27;</span> enabled.</span><br><span class="line"><span class="number">2021</span>-<span class="number">12</span>-<span class="number">27</span> <span class="number">13</span>:<span class="number">46</span>:<span class="number">56.526</span> ERROR <span class="number">1306</span> --- [  restartedMain] o.s.boot.SpringApplication               : Application run failed</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºåœ¨pomæ–‡ä»¶é‡Œé¢åŠ å…¥äº†mybatisï¼ˆæŸï¼‰æ¨¡å— å´æ²¡æœ‰åœ¨configé…ç½®é‡Œé¢å¢åŠ mybatisï¼ˆå®ƒï¼‰çš„ä¸Šä¸‹æ–‡å¯¼è‡´å¯åŠ¨æŠ¥é”™çš„<br>starting ApplicationContext. To display the conditions report re-run your application with â€˜debugâ€™ enabledï¼ˆè¿™å¥è¯å…¶å®å·²ç»è¯´å¾—å¾ˆæ˜ç™½äº† åœ¨å¯åŠ¨çš„æ—¶å€™ ä¸Šä¸‹æ–‡é”™è¯¯ å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼‰<br>åœ¨é…ç½®æ–‡ä»¶é‡Œé¢åŠ ä¸Šmybatisçš„é…ç½®å°±è¡Œäº†</p>
<p>ä½†æ˜¯ä¸çŸ¥é“è¯´çš„é…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Œå°è¯•æ³¨é‡Šæ‰ä¸ç”¨çš„ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jetbrains<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ²¡ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;jdbcIngredientRepository&#x27;</span><br></pre></td></tr></table></figure>

<p> è¿™ä¸ªé—®é¢˜ä¸€èˆ¬æ˜¯mapperé‡Œé¢çš„SQLè¯­å¥å†™é”™äº†ã€‚å¯èƒ½æ˜¯æœ¬æ¥selectï¼Œå´å†™æˆäº†insert</p>
<p>æ‰¾äº†åŠå¤©ï¼ŒåŸæ¥æ˜¯schema.sqlæ–‡ä»¶ä¸­è¯­å¥çš„é”™è¯¯ã€‚</p>
<p>å¹²ï¼ï¼ï¼æ˜¯å› ä¸ºå¤åˆ¶è¿‡æ¥æœ‰æ— æ•ˆç©ºæ ¼ï¼Œæ²¡æ˜¾ç¤ºé”™è¯¯ã€‚</p>
<h3 id="é”™è¯¯è®°å½•2"><a href="#é”™è¯¯è®°å½•2" class="headerlink" title="é”™è¯¯è®°å½•2"></a>é”™è¯¯è®°å½•2</h3><p>ä¹Ÿä¸çŸ¥å“ªä¸€æ­¥æœ‰é—®é¢˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">2021</span>-<span class="number">12</span>-<span class="number">27</span> <span class="number">19</span>:<span class="number">40</span>:<span class="number">36.800</span> ERROR <span class="number">1822</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">6</span>] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() <span class="keyword">for</span> servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.NullPointerException] with root cause</span><br><span class="line"></span><br><span class="line">java.lang.NullPointerException: <span class="literal">null</span></span><br><span class="line">	at tacos.data.JdbcTacoRepository.saveTacoInfo(JdbcTacoRepository.java:<span class="number">51</span>) ~[classes/:na]</span><br><span class="line">	at tacos.data.JdbcTacoRepository.save(JdbcTacoRepository.java:<span class="number">28</span>) ~[classes/:na]</span><br></pre></td></tr></table></figure>

<p>åœ¨æäº¤tacoçš„æ—¶å€™ï¼Œå°±ä¼šæœ‰500é”™è¯¯ã€‚</p>
<p>è¡¨å•htmlæ–‡ä»¶å°±éœ€è¦ä¿®æ”¹çš„ï¼Œtomorrowçœ‹ä¸‹è¡¨å•åšå•¥å˜åŒ–äº†ã€‚å†æ¢ä¸€ä¸‹å¤–é¢çš„æ–‡ä»¶ï¼Œçœ‹æ˜¯ä¸æ˜¯å°±èƒ½æ­£å¸¸ã€‚</p>
<p>åªæ˜¯æœ‰ä¸€ä¸ªdesignå˜æˆäº†tacoï¼Œä»æ•°æ®åº“ä¸­æ‹¿é…æ–™ç§ç±»ï¼Œéš¾é“è¡¨å•ä¸éœ€è¦è¿æ¥æ•°æ®åº“æˆ–è€…æ˜¯æ§åˆ¶å™¨å—ï¼Ÿï¼Ÿï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Failed to convert property value of type java.lang.String to required type java.util.List for property ingredients; nested exception is java.lang.IllegalStateException: Cannot convert value of type java.lang.String to required type tacos.Ingredient for property ingredients[0]: no matching editors or conversion strategy found</span><br><span class="line"></span><br><span class="line">å°†java.lang.Stringç±»å‹çš„å±æ€§å€¼è½¬æ¢ä¸ºæ‰€éœ€ç±»å‹java.util.Listå±æ€§æˆåˆ†å¤±è´¥;java.lang.IllegalStateException:ä¸èƒ½è½¬æ¢java.lang.Stringç±»å‹çš„å€¼åˆ°æ‰€éœ€ç±»å‹tacosã€‚å±æ€§æˆåˆ†[0]çš„æˆåˆ†:æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç¼–è¾‘å™¨æˆ–è½¬æ¢ç­–ç•¥</span><br></pre></td></tr></table></figure>

<p>1.designcontrolå’Œordercontrolä¸¤ä¸ªæ§åˆ¶å™¨ï¼Œéœ€è¦åŠ sessionï¼Œ<code>@SessionAttributes(&quot;order&quot;)</code></p>
<p>2.åŸæ¥çš„pom.xmlï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Taco Cloud Example<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jetbrains<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>xml-apis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xml-apis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.04<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.bytebuddy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>byte-buddy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ›¿æ¢äº†è§†å›¾æ§åˆ¶å™¨ã€è¡¨å•ã€pomæ–‡ä»¶ï¼Œæ‰å˜å¯¹çš„ã€‚</p>
<h3 id="ç¬¬ä¸‰ç« ç¬¬äºŒèŠ‚JPAè°ƒè¯•"><a href="#ç¬¬ä¸‰ç« ç¬¬äºŒèŠ‚JPAè°ƒè¯•" class="headerlink" title="ç¬¬ä¸‰ç« ç¬¬äºŒèŠ‚JPAè°ƒè¯•"></a>ç¬¬ä¸‰ç« ç¬¬äºŒèŠ‚JPAè°ƒè¯•</h3><p>1.åœ¨pom.xmlä¸­æ·»åŠ ä¾èµ–starter<br>ç–‘é—®ï¼šadd â€¦ to classpath æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå¾€pomé‡Œæ·»åŠ ä¾èµ–å—ï¼Ÿ</p>
<p>é—®é¢˜ï¼š</p>
<p><code>Dependency &#39;org.springframework.boot:spring-boot-starter-data-jpa:2.6.1&#39; not found </code></p>
<p>æ¡ˆä¾‹ä¸­çš„ä»£ç æ— configurationã€‚<code>é”™è¯¯: æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» tacos.TacoCloudApplication</code></p>
<p>2.åº“æ¥å£å®šä¹‰</p>
<p>3.å¯è‡ªåŠ¨å®ç°ï¼Œå¯è‡ªå®šä¹‰å®ç°</p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>tomcatå…¥é—¨æ•™ç¨‹</title>
    <url>/2022/03/12/myblog/java/Tomcat%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h3 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a><strong>tomcat</strong></h3><p>ä¸ºä»€ä¹ˆæœ‰tomcatï¼Ÿ</p>
<p>ä¸€ä¸ªé¡¹ç›®ï¼šå®¢æˆ·ç«¯+åç«¯+æ•°æ®åº“ã€‚</p>
<p>å¦‚ä½•è®¿é—®åˆ°æœåŠ¡ï¼Ÿéœ€è¦åœ¨webåº”ç”¨æœåŠ¡å™¨é‡Œè¿›è¡Œéƒ¨ç½²ã€‚</p>
<p>tomcatå°±æ˜¯ä¸€ä¸ªwebåº”ç”¨æœåŠ¡å™¨ï¼Œå°±æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œé‡Œé¢æ”¾javaç¨‹åºã€‚</p>
<p>webåº”ç”¨æœåŠ¡å™¨ï¼štomcatã€Jboosã€Weblogicã€Jettyã€‚</p>
<p>æœ‰äº†tomcatå¯ä»¥å®ç°ä¸¤ä¸ªç”µè„‘ä¹‹é—´çš„äº’ç›¸è®¿é—®ï¼Œå‰ææ˜¯åœ¨ä¸€ä¸ªå±€åŸŸç½‘é‡Œã€‚</p>
<h3 id="1âƒ£ï¸å®‰è£…tomcatã€‚"><a href="#1âƒ£ï¸å®‰è£…tomcatã€‚" class="headerlink" title="1âƒ£ï¸å®‰è£…tomcatã€‚"></a>1âƒ£ï¸å®‰è£…tomcatã€‚</h3><p>apacheå‡ºçš„ï¼Œè¿›å…¥å®˜ç½‘ï¼Œé€‰æ‹©tomcat9ï¼Œä¸‹è½½å‹ç¼©æ–‡ä»¶tar.gz</p>
<p>è§£å‹ç¼©ï¼Œæ”¾libraryé‡Œã€‚</p>
<p>binï¼šå­˜æ”¾å„ä¸ªå¹³å°ä¸‹å¯åŠ¨å’Œåœæ­¢tomcatæœåŠ¡çš„è„šæœ¬æ–‡ä»¶ã€‚batæ˜¯windowsç³»ç»Ÿä¸‹çš„è„šæœ¬æ–‡ä»¶ï¼Œshæ˜¯macå’Œlinuxçš„ã€‚</p>
<p>confï¼šå­˜æ”¾å„ç§tomcatæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é…ç½®ç«¯å£ï¼Œserver.xmlã€‚</p>
<p>libï¼šå­˜æ”¾tomcatæœåŠ¡å™¨éœ€è¦çš„jaråŒ…ã€‚</p>
<p>logsï¼šå­˜æ”¾tomcatæœåŠ¡è¿è¡Œçš„æ—¥å¿—ã€‚</p>
<p>tempï¼štomcatè¿è¡Œæ—¶çš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸Šä¼ ä¸‹è½½ioæµçš„æ—¶å€™ç”¨ï¼Œå¤§æ–‡ä»¶æ”¾åœ¨javaè™šæ‹Ÿæœºå†…å­˜é‡Œå ç”¨èµ„æºå¤§ï¼Œå…ˆæ”¾åœ¨tempæ–‡ä»¶å¤¹é‡Œã€‚</p>
<p>webappsï¼šå­˜æ”¾å…è®¸å®¢æˆ·ç«¯è®¿é—®çš„èµ„æºï¼ˆjavaç¨‹åºï¼‰ã€‚</p>
<p>workï¼šå­˜æ”¾tomcatå°†jspè½¬æ¢ä¹‹åçš„servletæ–‡ä»¶ã€‚</p>
<h3 id="2âƒ£ï¸ideaé›†æˆtomcat"><a href="#2âƒ£ï¸ideaé›†æˆtomcat" class="headerlink" title="2âƒ£ï¸ideaé›†æˆtomcat"></a>2âƒ£ï¸ideaé›†æˆtomcat</h3><p>create new project â€“&gt; java enterprise â€“&gt; web application â€“&gt; å®Œæˆ</p>
<p>index.jspï¼šå†™htmlçš„</p>
<p>web.xmlï¼šé…ç½®åº”ç”¨çš„</p>
<p>æ·»åŠ tomcaté…ç½®ï¼šå³ä¸Šè§’add configurationï¼Œç‚¹åŠ å·ï¼Œtomcalï¼Œé€‰localï¼Œé…ä¸€ä¸ªæœ¬åœ°çš„tomcatï¼Œè®¾ç½®ï¼Œå†™åå­—ï¼Œé€‰tomcatè·¯å¾„ï¼ˆä¸»è¦å°±ç”¨tomcatçš„ä¸¤ä¸ªjaråŒ…ï¼šjspã€servletï¼‰ã€‚ç›¸å½“äºæ˜¯æŠŠideaå’Œtomcatæ˜ å°„èµ·æ¥äº†ã€‚è®¾ç½®urlï¼šé»˜è®¤æµè§ˆå™¨ï¼Œafter launchæ˜¯å¯åŠ¨åè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œurlæ˜¯è®¿é—®è·¯å¾„ï¼Œè®¿é—®åˆ°tomcatæœåŠ¡ã€‚ç„¶åé€‰deploymentæ·»åŠ javaå·¥ç¨‹ï¼Œç‚¹åŠ å·ï¼Œé€‰artifactï¼Œè‡ªåŠ¨åŠ è¿›æ¥äº†ã€‚ç›¸å½“äºæ˜¯æŠŠjavaå·¥ç¨‹æ”¾åœ¨testé‡Œäº†ã€‚ç„¶åapplyï¼Œokã€‚</p>
<p>ç‚¹å³ä¸Šè§’è™«å­å›¾æ ‡ã€‚è‡ªåŠ¨è·³å‡ºæ¥é¡µé¢ã€‚å…³æ‰ideaï¼Œå°±æ²¡äº†ã€‚</p>
<p>urlç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šip:port&#x2F;application name</p>
<p>å¯ä»¥æ”¹åº”ç”¨çš„åå­—ï¼Œåœ¨å³ä¸Šè§’edit applicationï¼Œé€‰deploymentï¼Œä¸‹é¢contextæ”¹åå­—ã€‚é‡å¯å°±å¯ä»¥äº†ã€‚</p>
<p>ä¹Ÿå¯ä»¥æ²¡æœ‰åå­—ï¼Œåªæ˜¯ä¸€ä¸ª&#x2F;ã€‚</p>
<h3 id="3âƒ£ï¸æ‰“åŒ…åœ¨tomcatè¿è¡Œ"><a href="#3âƒ£ï¸æ‰“åŒ…åœ¨tomcatè¿è¡Œ" class="headerlink" title="3âƒ£ï¸æ‰“åŒ…åœ¨tomcatè¿è¡Œ"></a>3âƒ£ï¸æ‰“åŒ…åœ¨tomcatè¿è¡Œ</h3><p>1.é¦–å…ˆåŸºäºmavenè¿›è¡Œæ‰“åŒ…ï¼Œå°†waråŒ…å¤åˆ¶åˆ°æŸä¸ªè·¯å¾„ï¼ˆä¸æ”¹é…ç½®çš„è¯æ”¾åœ¨webappsæ–‡ä»¶å¤¹ä¸‹ï¼‰<br>2.å¯¹äºæ”¾åœ¨å…¶ä»–æ–‡ä»¶å¤¹çš„waråŒ…ï¼Œåœ¨tomcatåŒ…ä¸‹çš„confæ–‡ä»¶å¤¹ä¸‹çš„server.xmlæ–‡ä»¶å¢åŠ é…ç½®ï¼ˆwaråŒ…è·¯å¾„å¯åŠ¨ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Host&gt; æ ‡ç­¾ä¸‹</span><br><span class="line">&lt;Context docBase=&quot;/Users/liuxuan/MyProject/java/log-maven-package.war&quot; </span><br><span class="line">        path=&quot;/log&quot; </span><br><span class="line">        reloadable=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>path:æŒ‡å®šè®¿é—®è¯¥Webåº”ç”¨çš„URLå…¥å£<br>docBase:æŒ‡å®šWebåº”ç”¨çš„æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥ç»™å®šç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ç»™å®šç›¸å¯¹äº<code>&lt;Host&gt;</code>çš„appBaseå±æ€§çš„ç›¸å¯¹è·¯å¾„ï¼Œå¦‚æœWebåº”ç”¨é‡‡ç”¨å¼€æ”¾ç›®å½•ç»“æ„ï¼Œåˆ™æŒ‡å®šWebåº”ç”¨çš„ æ ¹ç›®å½•ï¼Œå¦‚æœWebåº”ç”¨æ˜¯ä¸ªwaræ–‡ä»¶ï¼Œåˆ™æŒ‡å®šwaræ–‡ä»¶çš„è·¯å¾„ã€‚<br>reloadable:å¦‚æœè¿™ä¸ªå±æ€§è®¾ä¸ºtrueï¼ŒtomcatæœåŠ¡å™¨åœ¨è¿è¡ŒçŠ¶æ€ä¸‹ä¼šç›‘è§†åœ¨WEB-INF&#x2F;classeså’ŒWEB-INF&#x2F;libç›®å½•ä¸‹classæ–‡ä»¶çš„æ”¹åŠ¨ï¼Œå¦‚æœç›‘æµ‹åˆ°æœ‰classæ–‡ä»¶è¢«æ›´æ–°çš„ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½Webåº”ç”¨ã€‚<br>Tomcatæœ¬èº«è®¾ç½®äº†Reloadableçš„å±æ€§ï¼Œæ•…Tomcatåœ¨æ£€æµ‹åˆ°classæ–‡ä»¶å‘ç”Ÿå˜åŒ–ä¹‹åï¼Œå¯¹WebAppçš„åº”ç”¨è¿›è¡Œäº†é‡æ–°åŠ è½½ï¼šå…ˆå¸è½½ï¼Œå†é‡æ–°åŠ è½½ã€‚<br>åœ¨å¼€å‘é˜¶æ®µå°†reloadableå±æ€§è®¾ä¸ºtrueï¼Œæœ‰åŠ©äºè°ƒè¯•servletå’Œå…¶å®ƒçš„classæ–‡ä»¶ï¼Œä½†è¿™æ ·ç”¨åŠ é‡æœåŠ¡å™¨è¿è¡Œè´Ÿè·ï¼Œå»ºè®®åœ¨Webåº”ç”¨çš„å‘å­˜é˜¶æ®µå°†reloadableè®¾ä¸ºfalseã€‚</p>
</blockquote>
<p>3.å¯åŠ¨tomcatï¼Œä¹‹å‰é…ç½®è¿‡ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥ä¸ç”¨åŒºtomcatçš„binç›®å½•ä¸‹å¯åŠ¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯åŠ¨ï¼šstartup.sh</span><br><span class="line">å…³é—­ï¼šshutdown.sh</span><br><span class="line">æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼šps -ef|grep tomcat</span><br><span class="line">æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼š</span><br><span class="line">cd /usr/local/tomcat/apache-tomcat-8.5.51/logs/</span><br><span class="line">tail -200f catalina.out</span><br></pre></td></tr></table></figure>
<p>4.è®¿é—®ï¼š<a href="http://localhost:8080/log/">http://localhost:8080/log/</a><br>5.å¤–ç½‘å¦‚ä½•è®¿é—®ï¼š<a href="https://blog.csdn.net/weixin_30596023/article/details/98539676">https://blog.csdn.net/weixin_30596023/article/details/98539676</a><br>6.å¦‚ä½•åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼š<a href="https://blog.csdn.net/qq_53324833/article/details/123802881">https://blog.csdn.net/qq_53324833/article/details/123802881</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>Geometryå’ŒCoordinate</title>
    <url>/2022/05/21/myblog/java/Geometry%E5%92%8CCoordinate/</url>
    <content><![CDATA[<h3 id="LineStringä¸Coordinate"><a href="#LineStringä¸Coordinate" class="headerlink" title="LineStringä¸Coordinate"></a>LineStringä¸Coordinate</h3><p>Geometryå¯¹è±¡è½¬æ¢ä¸ºLineStringå¯¹è±¡ï¼Œå‰é¢åŠ (LineString)å¼ºè½¬ã€‚</p>
<p><code>Coordinate coor = new Coordinate(lng, lat);</code><br>&#x2F;&#x2F;lngã€latæ˜¯Doubleç±»å‹ç»åº¦çº¬åº¦</p>
<p>LineStringè½¬æ¢ä¸ºCoordinateæ•°ç»„ï¼š<br><code>Coordinate[] coor = road.getCoordinates();</code></p>
<h3 id="Geometry"><a href="#Geometry" class="headerlink" title="Geometry"></a>Geometry</h3><p>com.vividsolutions.jts.geomä¸‹<br>Geometryå¯ä»¥æ˜¯ä¸€ç³»åˆ—çš„ç‚¹ç»„æˆçš„çº¿ã€‚<br>æ•°æ®åº“ä¸­æŸ¥çœ‹éœ€è¦åŠ ï¼šselect st_astext(geo) from table;</p>
<p>Geometryé‡Œçš„ç‚¹ï¼š<br><code>Coordinate[] coordinates = geo.getCoordinates();</code></p>
<h3 id="GeometryUtilså·¥å…·ç±»"><a href="#GeometryUtilså·¥å…·ç±»" class="headerlink" title="GeometryUtilså·¥å…·ç±»"></a>GeometryUtilså·¥å…·ç±»</h3><p>GeometryUtilsç±»å±äºmil.nga.giat.geowave.core.geotimeåŒ…ã€‚</p>
<p><a href="https://vimsky.com/examples/detail/java-class-mil.nga.giat.geowave.core.geotime.GeometryUtils.html">https://vimsky.com/examples/detail/java-class-mil.nga.giat.geowave.core.geotime.GeometryUtils.html</a></p>
<h3 id="redisTemplateçš„GEO-APIï¼š"><a href="#redisTemplateçš„GEO-APIï¼š" class="headerlink" title="redisTemplateçš„GEO APIï¼š"></a>redisTemplateçš„GEO APIï¼š</h3><p><a href="https://blog.csdn.net/weixin_39274753/article/details/107783674">https://blog.csdn.net/weixin_39274753/article/details/107783674</a></p>
<h3 id="stringå’Œgeometryçš„è½¬æ¢"><a href="#stringå’Œgeometryçš„è½¬æ¢" class="headerlink" title="stringå’Œgeometryçš„è½¬æ¢"></a>stringå’Œgeometryçš„è½¬æ¢</h3><p>éœ€è¦å¯¼å…¥jtsåŒ…ã€‚ï¼ˆvividsolutionï¼‰</p>
<p>WKTï¼Œæ˜¯ä¸€ç§æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œç”¨äºè¡¨ç¤ºçŸ¢é‡å‡ ä½•å¯¹è±¡ã€ç©ºé—´å‚ç…§ç³»ç»ŸåŠç©ºé—´å‚ç…§ç³»ç»Ÿä¹‹é—´çš„è½¬æ¢ã€‚å®ƒçš„äºŒè¿›åˆ¶è¡¨ç¤ºæ–¹å¼ï¼Œäº¦å³WKB(well-known binary)åˆ™èƒœäºåœ¨ä¼ è¾“å’Œåœ¨æ•°æ®åº“ä¸­å­˜å‚¨ç›¸åŒçš„ä¿¡æ¯ã€‚è¯¥æ ¼å¼ç”±å¼€æ”¾åœ°ç†ç©ºé—´è”ç›Ÿ(OGC)åˆ¶å®šã€‚</p>
<p>WKTå¯ä»¥è¡¨ç¤ºçš„å‡ ä½•å¯¹è±¡åŒ…æ‹¬ï¼šç‚¹ï¼Œçº¿ï¼Œå¤šè¾¹å½¢ï¼ŒTINï¼ˆä¸è§„åˆ™ä¸‰è§’ç½‘ï¼‰åŠå¤šé¢ä½“ã€‚å¯ä»¥é€šè¿‡å‡ ä½•é›†åˆçš„æ–¹å¼æ¥è¡¨ç¤ºä¸åŒç»´åº¦çš„å‡ ä½•å¯¹è±¡ã€‚<br>å‡ ä½•ç‰©ä½“çš„åæ ‡å¯ä»¥æ˜¯2D(x,y),3D(x,y,z),4D(x,y,z,m),åŠ ä¸Šä¸€ä¸ªå±äºçº¿æ€§å‚ç…§ç³»ç»Ÿçš„må€¼ã€‚<br>ä»¥ä¸‹ä¸ºå‡ ä½•WKTå­—ä¸²æ ·ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POINT(6 10)</span><br><span class="line">LINESTRING(3 4,10 50,20 25)</span><br><span class="line">POLYGON((1 1,5 1,5 5,1 5,1 1),(2 2,2 3,3 3,3 2,2 2))</span><br><span class="line">MULTIPOINT(3.5 5.6, 4.8 10.5)</span><br><span class="line">MULTILINESTRING((3 4,10 50,20 25),(-5 -8,-10 -8,-15 -4))</span><br><span class="line">MULTIPOLYGON(((1 1,5 1,5 5,1 5,1 1),(2 2,2 3,3 3,3 2,2 2)),((6 3,9 2,9 4,6 3)))</span><br><span class="line">GEOMETRYCOLLECTION(POINT(4 6),LINESTRING(4 6,7 10))</span><br><span class="line">POINT ZM (1 1 5 60)</span><br><span class="line">POINT M (1 1 80)</span><br><span class="line">POINT EMPTY</span><br><span class="line">MULTIPOLYGON EMPTY</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void geoTest() throws ParseException, com.vividsolutions.jts.io.ParseException &#123;</span><br><span class="line">    //1.stringç±»å‹è½¬ä¸ºgeometry</span><br><span class="line">    //GeometryFactoryå·¥å‚ï¼Œå‚æ•°ä¸€ï¼šæ•°æ®ç²¾åº¦ å‚æ•°äºŒç©ºé—´å‚è€ƒç³»SRID</span><br><span class="line">    GeometryFactory geometryFactory = new GeometryFactory(new PrecisionModel(PrecisionModel.FLOATING), 4326);</span><br><span class="line"></span><br><span class="line">    //ç†ŸçŸ¥æ–‡æœ¬WKTé˜…è¯»å™¨ï¼Œå¯ä»¥å°†WKTæ–‡æœ¬è½¬æ¢ä¸ºGeometryå¯¹è±¡</span><br><span class="line">    WKTReader wktReader = new WKTReader(geometryFactory);</span><br><span class="line"></span><br><span class="line">    //Geometryå¯¹è±¡ï¼ŒåŒ…å«Pointã€LineStringã€Polygonç­‰å­ç±»</span><br><span class="line">    Geometry geometry = wktReader.read(&quot;POINT (113.53896635 22.36429837)&quot;);</span><br><span class="line">    System.out.println(&quot;geometry:&quot; + geometry);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //2.geometryå¯¹è±¡è½¬ä¸ºstring</span><br><span class="line">    //å•çº¯çš„ä¸€ä¸ªåæ ‡ç‚¹ï¼Œå•ç‚¹å¯ä»¥åˆ›å»ºPointï¼Œå¤šç‚¹å¯ä»¥åˆ›å»ºLineStringã€Polygonç­‰</span><br><span class="line">    Coordinate coordinate = new Coordinate(113.53896635, 22.36429837);</span><br><span class="line">    Point point = geometryFactory.createPoint(coordinate);</span><br><span class="line"></span><br><span class="line">    Polygon polygon = geometryFactory.createPolygon(new Coordinate[]&#123;</span><br><span class="line">            new Coordinate(1, 2),</span><br><span class="line">            new Coordinate(1, 2),</span><br><span class="line">            new Coordinate(1, 2),</span><br><span class="line">            new Coordinate(1, 2),</span><br><span class="line">            new Coordinate(1, 2),</span><br><span class="line">    &#125;);</span><br><span class="line">    Geometry geometry1 = point;</span><br><span class="line">    Geometry geometry2 = polygon;</span><br><span class="line"></span><br><span class="line">    //WKTè¾“å‡ºå™¨ï¼Œå°†Geometryå¯¹è±¡å†™å‡ºä¸ºWKTæ–‡æœ¬</span><br><span class="line">    WKTWriter wktWriter = new WKTWriter();</span><br><span class="line">    String pointString = wktWriter.write(point);</span><br><span class="line">    System.out.println(&quot;point string: &quot; + pointString);</span><br><span class="line">    String geoString = wktWriter.write(geometry1);</span><br><span class="line">    System.out.println(&quot;geo string: &quot; + geoString);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š<br>Java Geometryç©ºé—´å‡ ä½•æ•°æ®çš„å¤„ç†åº”ç”¨ï¼š<a href="https://blog.csdn.net/An1090239782/article/details/123509504">https://blog.csdn.net/An1090239782/article/details/123509504</a></p>
<p>Geometryåœ¨æ•°æ®åº“å’ŒJavaä¸­çš„åº”ç”¨ï¼š<a href="https://www.jianshu.com/p/76343e71d6f1">https://www.jianshu.com/p/76343e71d6f1</a></p>
<h3 id="ä¸¤ä¸ªgeometryæ‹¼æ¥"><a href="#ä¸¤ä¸ªgeometryæ‹¼æ¥" class="headerlink" title="ä¸¤ä¸ªgeometryæ‹¼æ¥"></a>ä¸¤ä¸ªgeometryæ‹¼æ¥</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2() throws com.vividsolutions.jts.io.ParseException &#123;</span><br><span class="line">    WKTReader wktReader = new WKTReader();</span><br><span class="line">    Geometry geometry1 = wktReader.read(&quot;LineString(113.53896635 22.36429837, 113.53896645 22.36429847)&quot;);</span><br><span class="line">    Geometry geometry2 = wktReader.read(&quot;LineString(113.53896645 22.36429847, 113.53896655 22.36429857)&quot;);</span><br><span class="line">    Geometry geometry3 = geometry1.union(geometry2);</span><br><span class="line">    System.out.println(geometry3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼šMULTILINESTRING ((113.53896635 22.36429837, 113.53896645 22.36429847), (113.53896645 22.36429847, 113.53896655 22.36429857))</p>
<h3 id="jtsé‡Œçš„geometryçš„ä¸€äº›æ“ä½œ"><a href="#jtsé‡Œçš„geometryçš„ä¸€äº›æ“ä½œ" class="headerlink" title="jtsé‡Œçš„geometryçš„ä¸€äº›æ“ä½œ"></a>jtsé‡Œçš„geometryçš„ä¸€äº›æ“ä½œ</h3><p>âœ…<code>org.locationtech.jts.geom.Geometry.isValid()</code></p>
<p>éªŒè¯æ­¤Geometryæ˜¯å¦åœ¨æ‹“æ‰‘ä¸Šæœ‰æ•ˆã€‚</p>
<p>âœ…<code>geo.buffer(distance)</code></p>
<p>buffer(double distance): åŠ bufferç¼“å†²åŒº<br>buffer(double distance, int quadrantSegments): åŠ buffer,è¾¹ç•Œæ ·å¼</p>
<p>âœ…<code>geometry1.equals(geometry2)</code> æ˜¯å¦å®Œå…¨é‡å </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void equalsGeometry() throws com.vividsolutions.jts.io.ParseException &#123;</span><br><span class="line">    GeometryFactory geometryFactory = new GeometryFactory(new PrecisionModel(PrecisionModel.FLOATING), 4326);</span><br><span class="line">    WKTReader reader = new WKTReader( geometryFactory );</span><br><span class="line">    String wkt1 = &quot;LINESTRING(0 0, 3 0, 10 0)&quot;;</span><br><span class="line">    String wkt2 = &quot;LINESTRING(3 0, 1 0)&quot;;</span><br><span class="line">    LineString geometry1 = (LineString) reader.read(wkt1);</span><br><span class="line">    LineString geometry2 = (LineString) reader.read(wkt2);</span><br><span class="line">    boolean b1 = geometry1.equals(geometry2);//false</span><br><span class="line">    System.out.println(b1);</span><br><span class="line"></span><br><span class="line">    wkt1 = &quot;LINESTRING(0 0, 3 0, 10 0)&quot;;</span><br><span class="line">    wkt2 = &quot;LINESTRING(10 0, 0 0)&quot;;</span><br><span class="line">    geometry1 = (LineString) reader.read(wkt1);</span><br><span class="line">    geometry2 = (LineString) reader.read(wkt2);</span><br><span class="line">    boolean b2 = geometry1.equals(geometry2);//true</span><br><span class="line">    System.out.println(b2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…geometry1.crosses(geometry2) æ˜¯å¦äº¤å‰</p>
<p>å¾—æœ‰äº¤ç‚¹ã€‚ä½†äº¤ç‚¹ä¸èƒ½æ˜¯çº¿çš„èµ·ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void crossGeometry() throws com.vividsolutions.jts.io.ParseException &#123;</span><br><span class="line">    GeometryFactory geometryFactory = new GeometryFactory();</span><br><span class="line">    //æƒ…æ™¯1</span><br><span class="line">    WKTReader reader = new WKTReader(geometryFactory);</span><br><span class="line">    String wkt1 = &quot;LINESTRING(0 0, 3 0, 10 0)&quot;;</span><br><span class="line">    String wkt2 = &quot;LINESTRING(3 0, 1 0)&quot;;</span><br><span class="line">    LineString geometry1 = (LineString) reader.read(wkt1);</span><br><span class="line">    LineString geometry2 = (LineString) reader.read(wkt2);</span><br><span class="line">    boolean b1 = geometry1.crosses(geometry2);//false</span><br><span class="line">    System.out.println(b1);</span><br><span class="line">    //æƒ…æ™¯2</span><br><span class="line">    wkt1 = &quot;LINESTRING(0 0, 3 0, 10 0)&quot;;</span><br><span class="line">    wkt2 = &quot;LINESTRING(3 0, 1 1)&quot;;</span><br><span class="line">    geometry1 = (LineString) reader.read(wkt1);</span><br><span class="line">    geometry2 = (LineString) reader.read(wkt2);</span><br><span class="line">    boolean b2 = geometry1.crosses(geometry2);//false</span><br><span class="line">    System.out.println(b2);</span><br><span class="line">    //æƒ…æ™¯3</span><br><span class="line">    wkt1 = &quot;LINESTRING(0 0, 3 0, 10 0)&quot;;</span><br><span class="line">    wkt2 = &quot;LINESTRING(4 0, -1 -1)&quot;;</span><br><span class="line">    geometry1 = (LineString) reader.read(wkt1);</span><br><span class="line">    geometry2 = (LineString) reader.read(wkt2);</span><br><span class="line">    boolean b3 = geometry1.crosses(geometry2);//false</span><br><span class="line">    System.out.println(b3);</span><br><span class="line">    //æƒ…æ™¯4</span><br><span class="line">    wkt1 = &quot;LINESTRING(0 0, 3 0, 10 0)&quot;;</span><br><span class="line">    wkt2 = &quot;LINESTRING(0 4, 3 0, -1 -1)&quot;;</span><br><span class="line">    geometry1 = (LineString) reader.read(wkt1);</span><br><span class="line">    geometry2 = (LineString) reader.read(wkt2);</span><br><span class="line">    boolean b4 = geometry1.crosses(geometry2);//true</span><br><span class="line">    System.out.println(b4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âœ…intersects ï¼šä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç©ºé—´ç›¸äº¤ï¼ˆè‡³å°‘æœ‰ä¸€ä¸ªç‚¹ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wkt1 = &quot;LINESTRING(0 0, 3 0, 10 0)&quot;;</span><br><span class="line">wkt2 = &quot;LINESTRING(3 0, 1 1)&quot;;</span><br><span class="line">geometry1 = (LineString) reader.read(wkt1);</span><br><span class="line">geometry2 = (LineString) reader.read(wkt2);</span><br><span class="line">boolean b2 = geometry1.intersects(geometry2);//true</span><br></pre></td></tr></table></figure>

<p>geometryçš„æ›´å¤šç”¨æ³•ï¼š<a href="https://blog.csdn.net/qiaobing1226/article/details/124467098">https://blog.csdn.net/qiaobing1226/article/details/124467098</a></p>
<p>å¸¸ç”¨çš„Geometryæ•°æ®ç»“æ„å’ŒGeometryFactoryï¼š<a href="https://www.jianshu.com/p/3add14bdee7b">https://www.jianshu.com/p/3add14bdee7b</a></p>
<p>jtsä½¿ç”¨ï¼š<a href="https://blog.csdn.net/weixin_40294332/article/details/124124361">https://blog.csdn.net/weixin_40294332/article/details/124124361</a><br><a href="https://blog.csdn.net/qiaobing1226/article/details/127204644">https://blog.csdn.net/qiaobing1226/article/details/127204644</a></p>
<h3 id="æ•°æ®åº“ç›¸å…³çš„geoæ“ä½œ"><a href="#æ•°æ®åº“ç›¸å…³çš„geoæ“ä½œ" class="headerlink" title="æ•°æ®åº“ç›¸å…³çš„geoæ“ä½œ"></a>æ•°æ®åº“ç›¸å…³çš„geoæ“ä½œ</h3><p>âœ…mysqlç©ºé—´æ•°æ®æœ‰å“ªäº›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Geometry  ç©ºé—´æ•°æ®	ä»»æ„ä¸€ç§ç©ºé—´ç±»å‹	</span><br><span class="line">Point	ç‚¹	åæ ‡å€¼	POINT(104.00924 30.46872)</span><br><span class="line">LineString	çº¿	çº¿ï¼Œç”±ä¸€ç³»åˆ—ç‚¹è¿æ¥è€Œæˆ	LINESTRING(1 1,  1 1, 1 1)</span><br><span class="line">Polygon	å¤šè¾¹å½¢	ç”±å¤šæ¡çº¿ç»„æˆ	POLYGON((1 1, 2 2, 3 3,  4 4, 5 5))</span><br><span class="line">MultiPoint	ç‚¹é›†åˆ	é›†åˆç±»ï¼ŒåŒ…å«å¤šä¸ªç‚¹	MULTIPOINT(1 1, 2 2, 1 1)</span><br><span class="line">MultiLineString	çº¿é›†åˆ	é›†åˆç±»ï¼ŒåŒ…å«å¤šæ¡çº¿	MULTILINESTRING((1 1, 2 2), (1 1, 1 1))</span><br><span class="line">MultiPolygon	å¤šè¾¹å½¢é›†åˆ	é›†åˆç±»ï¼ŒåŒ…å«å¤šä¸ªå¤šè¾¹å½¢	MULTIPOLYGON(((0 0, 1 0, 1 1, 0 1, 0 0)), ((1 1, 1 1, 1 1, 1 1, 1 1)))</span><br><span class="line">GeometryCollection	ç©ºé—´æ•°æ®é›†åˆ	é›†åˆç±»ï¼Œå¯ä»¥åŒ…æ‹¬å¤šä¸ªç‚¹ã€çº¿ã€å¤šè¾¹å½¢	GEOMETRYCOLLECTION(POINT(1 1), POINT(3 3), LINESTRING(1 1, 2 2))</span><br></pre></td></tr></table></figure>

<p>mysqlä¸­å‡ ä½•å¯¹è±¡çš„è¡¨è¾¾æ ¼å¼ï¼š<br>WKTï¼šï¼ˆWell-known Textï¼‰å¯ä»¥é€šè¿‡æ–‡æœ¬æ¥æè¿°å‡ ä½•å¯¹è±¡ã€‚<br>WKBï¼ˆWell-known Binaryï¼‰é€šè¿‡åºåˆ—åŒ–çš„å­—èŠ‚å¯¹è±¡æ¥æè¿°å‡ ä½•å¯¹è±¡ï¼ˆä¸€èˆ¬åœ¨æ•°æ®åº“ä¸­ä½¿ç”¨ï¼‰ã€‚</p>
<p>å¸¸ç”¨å‡½æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ST_GEOMFROMTEXT</span><br><span class="line">ç”¨äºå°†å‡ ä½•æ•°æ®ä»å¯è¯»çš„æ–‡æœ¬ç±»å‹è½¬æ¢æˆå†…éƒ¨å­˜å‚¨çš„äºŒè¿›åˆ¶ç±»å‹ã€‚</span><br><span class="line">ST_ASTEXT</span><br><span class="line">å°†å‡ ä½•æ•°æ®è½¬æ¢æˆå¯è¯»çš„æ–‡æœ¬ç±»å‹ã€‚</span><br><span class="line"></span><br><span class="line">st_union(g1, g2) å°†g1å’Œg2åˆå¹¶ä¸ºä¸€ä¸ªé›†åˆç±»å¯¹è±¡</span><br><span class="line">st_difference(g1, g2)  è¿”å›å‡ ä½•å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºäº†å‡ ä½•å€¼g1ä¸g2çš„ç‚¹é›†åˆå·®å¼‚</span><br><span class="line">st_intersection(g1,g2)  è¿”å›å‡ ä½•å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºäº†å‡ ä½•å€¼g1ä¸g2çš„ç‚¹é›†åˆäº¤é›†</span><br><span class="line"></span><br><span class="line">st_contains(g1, g2)</span><br><span class="line">g1å®Œå…¨åŒ…å«g2ï¼›è¿”å›0: g1æœªåŒ…å«g2</span><br><span class="line"></span><br><span class="line">st_crosses(g1, g2), st_intersects(g1, g2)</span><br><span class="line">è¿”å›1: g1ä¸g2ç›¸äº¤ï¼›è¿”å›0:g1ä¸g2æœªç›¸äº¤</span><br><span class="line"></span><br><span class="line">st_disjoint(g1, g2)</span><br><span class="line">æ˜¯st_crossesçš„åå‡½æ•°</span><br><span class="line"></span><br><span class="line">st_within(g1, g2)</span><br><span class="line">g1åœ¨g2å†…åˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºç´¢å¼•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯¹è¡¨ä¸­çš„geometryç±»å‹çš„å­—æ®µè¿›è¡Œç´¢å¼•å¯ä»¥ä¼˜åŒ–æœç´¢ï¼Œmysqlä¸­é€šè¿‡å¯¹geometryå¯¹è±¡çš„mbråˆ›å»ºç´¢å¼•</span><br><span class="line">åˆ›å»ºï¼š</span><br><span class="line">create spatial index i_shape on `t_geo_test`(shape);</span><br><span class="line">åˆ é™¤ï¼š</span><br><span class="line">drop index i_shape on `t_geo_test`;</span><br><span class="line"></span><br><span class="line">ç›®å‰mysqlä¸­æ”¯æŒçš„ç©ºé—´åæ ‡ç³»ç»Ÿæ²¡æœ‰gcj02,bd09ç­‰å›½å†…åæ ‡ç³»ï¼Œ</span><br><span class="line">é»˜è®¤ä½¿ç”¨wgs84åœ°çƒåæ ‡ç³»ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºå‡ ä½•å¯¹è±¡æ—¶è¾“å…¥çš„åæ ‡å€¼å°½é‡ä½¿ç”¨wgs84åæ ‡ï¼Œä»¥é¿å…è¯¯å·®ã€‚</span><br><span class="line"></span><br><span class="line">mysqlä¸­çš„è®¡ç®—è·ç¦»ï¼Œé•¿åº¦ï¼Œé¢ç§¯ç­‰ç»å¯¹æ•°å€¼çš„ç©ºé—´è®¡ç®—å‡½æ•°ï¼ˆarea(), glength(), st_distance()ï¼‰å­˜åœ¨ä¸€å®šçš„è¯¯å·®ï¼Œå°½é‡ä¸è¦ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure>

<p>mysqlçš„geometryç›¸å…³çš„å‡½æ•°ï¼š<a href="https://jiuaidu.com/jianzhan/906169/">https://jiuaidu.com/jianzhan/906169/</a></p>
<p>âœ…åˆ›å»ºè¡¨æ—¶å¸¦geometryå­—æ®µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">`geo` geometry default null comment &#x27;åæ ‡ç‚¹&#x27;,</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table if not exists `geo_table`(</span><br><span class="line">    `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT &#x27;è‡ªå¢&#x27;,</span><br><span class="line">    `geo` geometry default null comment &#x27;åæ ‡ç‚¹&#x27;,</span><br><span class="line">    PRIMARY KEY ( `id` )</span><br><span class="line">)ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8mb4 COMMENT=&quot;geo&quot;;</span><br><span class="line"></span><br><span class="line">set @geo = st_geomfromtext(&quot;LineString(104.009241 30.468972,104.009229 30.468961)&quot;);</span><br><span class="line">insert into geo_table values(0, @geo);</span><br><span class="line">select st_astext(geo) from geo_table;</span><br></pre></td></tr></table></figure>

<p>âœ…Intersectsç›¸äº¤</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from table where Intersects(geome1, geo2);</span><br></pre></td></tr></table></figure>

<p>âœ…mysqlæ ¹æ®ç»çº¬åº¦è®¡ç®—è·ç¦»</p>
<p>st_distance_sphereå‡½æ•°è¿”å›ä»¥ç±³ä¸ºå•ä½.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select st_distance_sphere(point(113.264435, 23.129163), point(113.274436, 23.129164));</span><br></pre></td></tr></table></figure>

<p>st_distanceè¿”å›çš„åº¦<br>st_distance è®¡ç®—çš„ç»“æœå•ä½æ˜¯åº¦ï¼Œéœ€è¦ä¹˜111195ï¼ˆåœ°çƒåŠå¾„6371000*PI&#x2F;180ï¼‰æ˜¯å°†å€¼è½¬åŒ–ä¸ºç±³ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select st_distance(point(113.264435, 23.129163), point(113.274436, 23.129164));</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è®¡ç®—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT</span><br><span class="line">*,ROUND(</span><br><span class="line">6378.138 * 2 * ASIN(</span><br><span class="line">SQRT(</span><br><span class="line">POW( SIN(( 23.129163 * PI()/ 180-latitudes * PI()/ 180 )/ 2 ), 2 )+ COS( 23.129163 * PI()/ 180 )* COS( latitudes * PI()/ 180 )* POW( SIN(( 113.264435 * PI()/ 180-longitudes * PI()/ 180 )/ 2 ), 2 )))* 1000 </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="å‡ ä¸ªåæ ‡ç³»"><a href="#å‡ ä¸ªåæ ‡ç³»" class="headerlink" title="å‡ ä¸ªåæ ‡ç³»"></a>å‡ ä¸ªåæ ‡ç³»</h3><p>æ€»çš„æ¥è¯´ï¼Œåæ ‡ç³»å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šåœ°ç†åæ ‡ç³»ï¼ˆGeographic Coordinate System, GCSï¼‰å’ŒæŠ•å½±åæ ‡ç³»ï¼ˆProjected Coordinate System, PCSï¼‰ï¼Œåœ°ç†åæ ‡ç³»è¿›è¡Œåœ°å›¾æŠ•å½±åå°±å˜æˆäº†æŠ•å½±åæ ‡ç³»ã€‚ä¾‹å¦‚æˆ‘ä»¬å¸¸è§çš„ä¸–ç•Œåœ°å›¾ï¼Œä½¿ç”¨çš„å°±æ˜¯ä¸€ç§ å¢¨å¡æ‰˜æŠ•å½±ã€‚</p>
<p>å…¶ä¸­åœ°ç†åæ ‡ç³»åˆå¯åˆ†ä¸º å‚å¿ƒåæ ‡ç³» å’Œ åœ°å¿ƒåæ ‡ç³»ï¼Œå¸¸è§çš„åœ°å¿ƒåæ ‡ç³»æœ‰WGS84ã€GCJ-02ã€BD-09ã€GCS2000ã€‚</p>
<p>âœ…WGS84ï¼ˆWorld Geodetic System 1984ï¼‰</p>
<p>WGS84æ˜¯ä¸º GPS å…¨çƒå®šä½ç³»ç»Ÿå»ºç«‹çš„åæ ‡ç³»ç»Ÿï¼Œæ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªç»Ÿä¸€çš„åœ°å¿ƒåæ ‡ç³»ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºå¤§åœ°åæ ‡ç³»ã€åŸå§‹åæ ‡ç³»ã€‚ä¸€èˆ¬é€šè¿‡GPSè®°å½•ä»ªè®°å½•ä¸‹æ¥çš„ç»çº¬åº¦ï¼Œå°±æ˜¯åŸºäºWGS84åæ ‡ç³»çš„æ•°æ®ã€‚</p>
<p>âœ…GCJ-02ï¼ˆå›½å®¶æµ‹é‡å±€02å·æ ‡å‡†ï¼‰</p>
<p>GCJ-02 æ˜¯ç”±ä¸­å›½å›½å®¶æµ‹ç»˜å±€ï¼ˆGè¡¨ç¤ºGuojiaå›½å®¶ï¼ŒCè¡¨ç¤ºCehuiæµ‹ç»˜ï¼ŒJè¡¨ç¤ºJuå±€ï¼‰åˆ¶è®¢çš„åœ°ç†ä¿¡æ¯ç³»ç»Ÿçš„åæ ‡ç³»ç»Ÿï¼Œæ˜¯åœ¨WGS84ç»çº¬åº¦çš„åŸºç¡€ä¸Šæ‰§è¡ŒåŠ å¯†ç®—æ³•è€Œæˆï¼ˆä¸ºäº†æ•°æ®å®‰å…¨å’Œä¿å¯†ï¼Œé€šè¿‡åœ°å½¢å›¾éçº¿æ€§ä¿å¯†å¤„ç†ç®—æ³•ï¼ˆä¿—ç§°ç«æ˜ŸåŠ å¯†ï¼‰åŠ å¯†ï¼‰ã€‚å› ä¸ºGPSå¾—åˆ°çš„ç»çº¬åº¦ç›´æ¥åœ¨ GCJ-02 åæ ‡ç³»ä¸‹ä¼šå®šä½åˆ°é”™è¯¯çš„åœ°ç‚¹ï¼Œæœ‰ç§åˆ°äº†ç«æ˜Ÿçš„æ„Ÿè§‰ï¼Œå› æ­¤åœ¨åŠé—´ä¹Ÿå°† GCJ-02 æˆç§°ä¸ºç«æ˜Ÿåæ ‡ç³»ã€‚</p>
<p>å›½æµ‹å±€è§„å®šï¼Œå›½å†…å‡ºç‰ˆçš„å„ç§åœ°å›¾ç³»ç»Ÿï¼ˆåŒ…æ‹¬ç”µå­å½¢å¼ï¼‰ï¼Œå¿…é¡»è‡³å°‘é‡‡ç”¨ GCJ-02 å¯¹åœ°ç†ä½ç½®è¿›è¡Œé¦–æ¬¡åŠ å¯†çš„åæ ‡ç³»ï¼Œé«˜å¾·å’ŒGoogleåœ¨å›½å†…éƒ½æ˜¯ä½¿ç”¨ GCJï¼02 åæ ‡ç³»ï¼Œè€Œç™¾åº¦ä½¿ç”¨çš„æ˜¯åœ¨ GCJ-02 åŸºç¡€ä¸Šå†ä¸€æ¬¡åŠ å¯†çš„ BD-09 åæ ‡ç³»ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼ŒåŒ—äº¬å¤©å®‰é—¨ä¸­å¿ƒçš„GPSç»çº¬åº¦æ˜¯39Â°54â€™26.2â€Nï¼Œ116Â°23â€™28.4â€Eï¼Œè½¬åŒ–ä¸ºåº¦çš„å•ä½å°±æ˜¯39.907270, 116.391213ï¼ˆæç¤ºï¼šå°æ•°éƒ¨åˆ† &#x3D; åˆ† &#x2F; 60 + ç§’ &#x2F; 3600ï¼‰<br>å°† GPS åæ ‡è½¬æ¢ä¸º GCJ-02 åæ ‡ï¼š116.397454,39.908671ï¼Œæ‰èƒ½åœ¨é«˜å¾·åœ°å›¾ä¸Šæ‰¾åˆ°æ­£ç¡®çš„ä½ç½®ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåˆ‡æ¢åˆ°è°·æ­Œåœ°å›¾çš„å«æ˜Ÿåœ°å›¾æ¨¡å¼ï¼Œå®ƒä½¿ç”¨çš„æ˜¯WGS84åæ ‡ç³»ã€‚</p>
<p>å‚è€ƒï¼š<br>å‡ ç§åæ ‡ç³»ï¼š<a href="https://www.jianshu.com/p/559029832a67">https://www.jianshu.com/p/559029832a67</a><br>åœ°å¿ƒåæ ‡ç³»å’ŒæŠ•å½±åæ ‡ç³»ï¼š<a href="https://zhuanlan.zhihu.com/p/62864791">https://zhuanlan.zhihu.com/p/62864791</a></p>
<p>ä¸‰ä¸ªåæ ‡æ€»ç»“ï¼šWGS84æ˜¯å¤§åœ°åæ ‡ç³»ï¼Œè¿™æ˜¯ä¸€ç§å›½é™…é€šç”¨çš„åæ ‡ï¼Œä¸€èˆ¬çš„ç»ˆç«¯è®¾å¤‡ï¼Œå¦‚æœè‡ªå·±æœ‰å®šä½åŠŸèƒ½ï¼Œæ¯”å¦‚è½¦è½½ç³»ç»Ÿï¼Œä»–ä»¬å‘å‡ºçš„gpsåæ ‡å°±æ˜¯åŸå§‹åæ ‡ã€‚æˆ‘ä»¬åœ¨ä¸€äº›åœ°å›¾åº”ç”¨ä¸­ä½¿ç”¨çš„å®šä½ï¼Œæ¯”å¦‚æ‰“è½¦è½¯ä»¶ï¼Œå…¶ä»–è‡ªå¸¦åœ°å›¾çš„è½¯ä»¶ï¼Œä»–ä»¬ä¸€èˆ¬éƒ½æ˜¯ç«æ˜Ÿåæ ‡ç³»GCJ02ï¼Œéœ€è¦è¿›è¡Œä¸€ä¸ªåæ ‡è½¬æ¢ã€‚è€Œç™¾åº¦åœ°å›¾ç›¸å…³çš„åº”ç”¨ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨çš„ç™¾åº¦åæ ‡ï¼Œè¿™ä¸ªæ˜¯åœ¨ç«æ˜Ÿåæ ‡åŸºç¡€ä¸Šè¿›è¡Œçš„å†æ¬¡åŠ å¯†ï¼Œæ‰€ä»¥å®ƒè¿˜æ˜¯ä¸ç«æ˜Ÿåæ ‡æœ‰å…³ç³»ã€‚</p>
<p>âœ…åæ ‡è½¬æ¢</p>
<p>ä»WGS84åæ ‡ç³»ä¸èƒ½ç›´æ¥è½¬BD09ï¼Œä¸­é—´éœ€è¦è·¨è¶Šä¸€ä¸ªGCJ02ï¼Œåè¿‡æ¥ï¼Œéœ€è¦å°†GCJ02æˆ–è€…BD09è½¬ä¸ºWGS84å°±æ˜¯çº åç®—æ³•ï¼Œç›¸å½“äºé€†å‘è§£å¯†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å…‹æ‹‰ç´¢ç´¢å¤«æ–¯åŸºæ¤­çƒç³»æ•°:</span><br><span class="line">public static double pi = 3.1415926535897932384626;</span><br><span class="line">public static double a = 6378245.0;</span><br><span class="line">public static double ee = 0.00669342162296594323;</span><br><span class="line">ç»çº¬åº¦åç§»å€¼ï¼š&#123;105,35&#125;ã€‚è¿™ä¸ªå…¶å®æ˜¯ä¸­åäººæ°‘å…±å’Œå›½å¤§åœ°åŸç‚¹åæ ‡ã€‚ä½ç½®åœ¨ä¸­å›½é™•è¥¿çœå’¸é˜³å¸‚ä¸‹çš„æ³¾é˜³å¿ã€‚</span><br></pre></td></tr></table></figure>

<p>è½¬æ¢ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package org.example.geometry;</span><br><span class="line"></span><br><span class="line">/***</span><br><span class="line"> * wgs84 84å¹´æå‡ºï¼Œå¤§åœ°åæ ‡ï¼Œä¹Ÿæ˜¯åŸå§‹åæ ‡ã€‚</span><br><span class="line"> * gcj02 02å¹´æå‡ºï¼Œç«æ˜Ÿåæ ‡ï¼Œç»è¿‡åŠ å¯†ç®—æ³•ã€‚å¤§å¤šæ•°éç™¾åº¦ä¸­å›½åœ°å›¾å‚å•†åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨çš„ç«æ˜Ÿåæ ‡ï¼šé«˜å¾·ï¼Œè…¾è®¯ï¼Œè°·æ­Œä¸­å›½cn</span><br><span class="line"> * bd09  09å¹´æå‡ºï¼Œç™¾åº¦åæ ‡ï¼Œç»è¿‡ç«æ˜Ÿåæ ‡å†æ¬¡åŠ å¯†ï¼Œç›¸å½“äºå¯¹å¤§åœ°åæ ‡ç»è¿‡äº†äºŒæ¬¡åŠ å¯†ã€‚ç™¾åº¦è‡ªå·±ä½¿ç”¨</span><br><span class="line"> * ä¸€èˆ¬çš„ç®—æ³•ï¼Œæ²¡æœ‰ç›´æ¥bd09-&gt;wgs84æˆ–è€…wgs84-&gt;bd09ï¼Œéƒ½éœ€è¦å€ŸåŠ©wgs84-&gt;gcj02æˆ–è€…gcj02-&gt;wgs84ç®—æ³•æ¨å¯¼ã€‚</span><br><span class="line"> */</span><br><span class="line">public class GpsTransfer &#123;</span><br><span class="line">    //Ï€çš„å®šä¹‰</span><br><span class="line">    public static double pi = 3.1415926535897932384626;</span><br><span class="line">    //æ¤­çƒé•¿åŠå¾„ï¼Œä¾æ®å…‹æ‹‰ç´¢ç´¢å¤«æ–¯åŸºæ¤­çƒç³»æ•°è®¡ç®—</span><br><span class="line">    public static double a = 6378245.0;</span><br><span class="line">    //ç¬¬ä¸€åå¿ƒç‡çš„å¹³æ–¹</span><br><span class="line">    public static double ee = 0.00669342162296594323;</span><br><span class="line"></span><br><span class="line">    public static double transformLat(double x, double y) &#123;</span><br><span class="line">        double ret = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y</span><br><span class="line">                + 0.2 * Math.sqrt(Math.abs(x));</span><br><span class="line">        ret += (20.0 * Math.sin(6.0 * x * pi) + 20.0 * Math.sin(2.0 * x * pi)) * 2.0 / 3.0;</span><br><span class="line">        ret += (20.0 * Math.sin(y * pi) + 40.0 * Math.sin(y / 3.0 * pi)) * 2.0 / 3.0;</span><br><span class="line">        ret += (160.0 * Math.sin(y / 12.0 * pi) + 320 * Math.sin(y * pi / 30.0)) * 2.0 / 3.0;</span><br><span class="line">        return ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static double transformLon(double x, double y) &#123;</span><br><span class="line">        double ret = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1</span><br><span class="line">                * Math.sqrt(Math.abs(x));</span><br><span class="line">        ret += (20.0 * Math.sin(6.0 * x * pi) + 20.0 * Math.sin(2.0 * x * pi)) * 2.0 / 3.0;</span><br><span class="line">        ret += (20.0 * Math.sin(x * pi) + 40.0 * Math.sin(x / 3.0 * pi)) * 2.0 / 3.0;</span><br><span class="line">        ret += (150.0 * Math.sin(x / 12.0 * pi) + 300.0 * Math.sin(x / 30.0</span><br><span class="line">                * pi)) * 2.0 / 3.0;</span><br><span class="line">        return ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /***</span><br><span class="line">     * åˆ¤æ–­æ˜¯å¦åœ¨ä¸­å›½èŒƒå›´ä¹‹å†…</span><br><span class="line">     * @param lat</span><br><span class="line">     * @param lon</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static boolean outOfChina(double lat, double lon) &#123;</span><br><span class="line">        if (lon &lt; 72.004 || lon &gt; 137.8347)</span><br><span class="line">            return true;</span><br><span class="line">        if (lat &lt; 0.8293 || lat &gt; 55.8271)</span><br><span class="line">            return true;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /***</span><br><span class="line">     * æŠŠå…¬å¼éƒ¨åˆ†æŠ½å–å‡ºæ¥</span><br><span class="line">     * @param lat</span><br><span class="line">     * @param lon</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static Gps transform(double lat, double lon) &#123;</span><br><span class="line">        if (outOfChina(lat, lon)) &#123;</span><br><span class="line">            return new Gps(lat, lon);</span><br><span class="line">        &#125;</span><br><span class="line">        double dLat = transformLat(lon - 105.0, lat - 35.0);</span><br><span class="line">        double dLon = transformLon(lon - 105.0, lat - 35.0);</span><br><span class="line">        double radLat = lat / 180.0 * pi;</span><br><span class="line">        double magic = Math.sin(radLat);</span><br><span class="line">        magic = 1 - ee * magic * magic;</span><br><span class="line">        double sqrtMagic = Math.sqrt(magic);</span><br><span class="line">        dLat = (dLat * 180.0) / ((a * (1 - ee)) / (magic * sqrtMagic) * pi);</span><br><span class="line">        dLon = (dLon * 180.0) / (a / sqrtMagic * Math.cos(radLat) * pi);</span><br><span class="line">        double mgLat = lat + dLat;</span><br><span class="line">        double mgLon = lon + dLon;</span><br><span class="line">        return new Gps(mgLat, mgLon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /***</span><br><span class="line">     * wgs84åˆ°gcj02è½¬æ¢</span><br><span class="line">     * @param lat</span><br><span class="line">     * @param lon</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static Gps wgs84_To_Gcj02(double lat, double lon) &#123;</span><br><span class="line">        return transform(lat, lon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /***</span><br><span class="line">     * ç®€å•çš„gcj02åˆ°wgs84åæ ‡ç±»å‹è½¬æ¢ï¼Œåªåšäº†ä¸€æ¬¡è¿­ä»£</span><br><span class="line">     */</span><br><span class="line">    public static Gps gcj02_To_Wgs84(double lat, double lon) &#123;</span><br><span class="line">        Gps gps = transform(lat, lon);</span><br><span class="line">        double lontitude = lon * 2 - gps.lon;</span><br><span class="line">        double latitude = lat * 2 - gps.lat;</span><br><span class="line">        return new Gps(latitude, lontitude);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /***</span><br><span class="line">     * ç¨å¾®ç²¾ç¡®ä¸€ç‚¹çš„gcj02åˆ°wgs84è½¬æ¢</span><br><span class="line">     * @param lat</span><br><span class="line">     * @param lon</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static Gps gcj02_To_Wgs84_exact(double lat,double lon) &#123;</span><br><span class="line">        if (outOfChina(lat, lon)) &#123;</span><br><span class="line">            return gcj02_To_Wgs84(lat, lon);</span><br><span class="line">        &#125;</span><br><span class="line">        double initDelta = 0.01;</span><br><span class="line">        double threshold = 0.000001;</span><br><span class="line">        double dLat = initDelta;</span><br><span class="line">        double dLon = initDelta;</span><br><span class="line">        double mLat = lat - dLat;</span><br><span class="line">        double mLon = lon - dLon;</span><br><span class="line">        double pLat = lat + dLat;</span><br><span class="line">        double pLon = lon + dLon;</span><br><span class="line">        double wgsLat = 0;</span><br><span class="line">        double wgsLon = 0;</span><br><span class="line">        int i = 0;</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            wgsLat = (mLat + pLat) / 2;</span><br><span class="line">            wgsLon = (mLon + pLon) / 2;</span><br><span class="line">            Gps tmp = wgs84_To_Gcj02(wgsLat, wgsLon);</span><br><span class="line">            dLat = tmp.lat - lat;</span><br><span class="line">            dLon = tmp.lon - lon;</span><br><span class="line">            if ((Math.abs(dLat) &lt; threshold) &amp;&amp; (Math.abs(dLon) &lt; threshold)) &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            if (dLat &gt; 0) &#123; pLat = wgsLat; &#125; else &#123; mLat = wgsLat;&#125;</span><br><span class="line">            if (dLon &gt; 0) &#123; pLon = wgsLon; &#125; else &#123; mLon = wgsLon;&#125;</span><br><span class="line"></span><br><span class="line">            if (++i &gt; 1000) break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return new Gps(wgsLat, wgsLon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /***</span><br><span class="line">     * ç™¾åº¦åæ ‡æ˜¯åœ¨ç«æ˜Ÿåæ ‡åŸºç¡€ä¸Šåšçš„äºŒæ¬¡åŠ å¯†</span><br><span class="line">     * @param gg_lat</span><br><span class="line">     * @param gg_lon</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static Gps gcj02_To_Bd09(double gg_lat, double gg_lon) &#123;</span><br><span class="line">        double x = gg_lon, y = gg_lat;</span><br><span class="line">        double z = Math.sqrt(x * x + y * y) + 0.00002 * Math.sin(y * pi);</span><br><span class="line">        double theta = Math.atan2(y, x) + 0.000003 * Math.cos(x * pi);</span><br><span class="line">        double bd_lon = z * Math.cos(theta) + 0.0065;</span><br><span class="line">        double bd_lat = z * Math.sin(theta) + 0.006;</span><br><span class="line">        return new Gps(bd_lat, bd_lon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /***</span><br><span class="line">     * ç™¾åº¦åæ ‡ä¸ç«æ˜Ÿåæ ‡é€†å‘è½¬æ¢</span><br><span class="line">     * @param bd_lat</span><br><span class="line">     * @param bd_lon</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static Gps bd09_To_Gcj02(double bd_lat, double bd_lon) &#123;</span><br><span class="line">        double x = bd_lon - 0.0065, y = bd_lat - 0.006;</span><br><span class="line">        double z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * pi);</span><br><span class="line">        double theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * pi);</span><br><span class="line">        double gg_lon = z * Math.cos(theta);</span><br><span class="line">        double gg_lat = z * Math.sin(theta);</span><br><span class="line">        return new Gps(gg_lat, gg_lon);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Gps gps = new Gps(39.907270, 116.391213);</span><br><span class="line">        System.out.println(gps);//&#123;39.90727,116.391213&#125;</span><br><span class="line">        Gps gps2 = wgs84_To_Gcj02(gps.lat, gps.lon);</span><br><span class="line">        System.out.println(gps2);//&#123;39.90867122432153,116.39745410656687&#125;</span><br><span class="line">        Gps gps3 = gcj02_To_Wgs84(gps2.lat, gps2.lon);</span><br><span class="line">        System.out.println(gps3);//&#123;39.907267736339556,116.3912105466475&#125;</span><br><span class="line">        Gps gps4 = gcj02_To_Wgs84_exact(gps2.lat, gps2.lon);</span><br><span class="line">        System.out.println(gps4);//&#123;39.90727046748559,116.39121326184032&#125; ç›¸å¯¹ä¸€æ¬¡è¿­ä»£æ˜¯ç²¾ç¡®äº†ï¼Œä½†æ˜¯å¥½åƒä¹Ÿä¸æ˜¯å®Œå…¨è¿˜åŸ</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Gps&#123;</span><br><span class="line">    double lat,lon;</span><br><span class="line">    public Gps() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    public Gps(double lat,double lon)&#123;</span><br><span class="line">        this.lat = lat;</span><br><span class="line">        this.lon = lon;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;&#123;&quot;+lat+&quot;,&quot;+lon+&quot;&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/feinifi/article/details/120547127">https://blog.csdn.net/feinifi/article/details/120547127</a></p>
<h3 id="mysql-java-redisä¸‰ç§åœ°ç†ä½ç½®ç®—æ³•"><a href="#mysql-java-redisä¸‰ç§åœ°ç†ä½ç½®ç®—æ³•" class="headerlink" title="mysql,java,redisä¸‰ç§åœ°ç†ä½ç½®ç®—æ³•"></a>mysql,java,redisä¸‰ç§åœ°ç†ä½ç½®ç®—æ³•</h3><p>è·å–é™„è¿‘ä¿¡æ¯ï¼Œä»¥ç”¨æˆ·å½“å‰ä½ç½®ä¸ºä¸­å¿ƒç‚¹ï¼ŒæŒ‡å®šèŒƒå›´ä¸ºåŠå¾„ï¼ŒæŸ¥è¯¢å‡ºåœ¨è¯¥åœ†åœˆå†…çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<h4 id="MySQL-åŸºäºst-distanceå‡½æ•°"><a href="#MySQL-åŸºäºst-distanceå‡½æ•°" class="headerlink" title="MySQL åŸºäºst_distanceå‡½æ•°"></a>MySQL åŸºäºst_distanceå‡½æ•°</h4><p>mysql 5.6.1 åŠ å…¥äº†ç©ºé—´æ•°æ®æ”¯æŒåŠŸèƒ½ï¼Œæ–°å¢äº†st_*ç›¸å…³å‡½æ•°ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„è®¡ç®—ä¸¤ä¸ªåœ°ç†åæ ‡ç‚¹çš„è·ç¦»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	p.* </span><br><span class="line">FROM</span><br><span class="line">	(</span><br><span class="line">	SELECT</span><br><span class="line">		park_info.*,</span><br><span class="line">		st_distance (</span><br><span class="line">			point ( park_info.lng, park_info.lat ),</span><br><span class="line">		point ( 116.403694, 39.913828 ))* 111195 AS distance </span><br><span class="line">	FROM</span><br><span class="line">		park_info park_info </span><br><span class="line">	) p </span><br><span class="line">WHERE</span><br><span class="line">	p.distance &lt; 10000</span><br></pre></td></tr></table></figure>


<h4 id="javaå®ç°"><a href="#javaå®ç°" class="headerlink" title="javaå®ç°"></a>javaå®ç°</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">public class DistanceUtils &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * åœ°çƒåŠå¾„,å•ä½ km</span><br><span class="line">     */</span><br><span class="line">    private static final double EARTH_RADIUS = 6378137;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ ¹æ®ç»çº¬åº¦ï¼Œè®¡ç®—ä¸¤ç‚¹é—´çš„è·ç¦»</span><br><span class="line">     *</span><br><span class="line">     * @param longitude1 ç¬¬ä¸€ä¸ªç‚¹çš„ç»åº¦</span><br><span class="line">     * @param latitude1  ç¬¬ä¸€ä¸ªç‚¹çš„çº¬åº¦</span><br><span class="line">     * @param longitude2 ç¬¬äºŒä¸ªç‚¹çš„ç»åº¦</span><br><span class="line">     * @param latitude2  ç¬¬äºŒä¸ªç‚¹çš„çº¬åº¦</span><br><span class="line">     * @return è¿”å›è·ç¦» å•ä½ç±³</span><br><span class="line">     */</span><br><span class="line">    public static double getDistance(double longitude1, double latitude1, double longitude2, double latitude2) &#123;</span><br><span class="line">        // çº¬åº¦</span><br><span class="line">        double lat1 = Math.toRadians(latitude1);</span><br><span class="line">        double lat2 = Math.toRadians(latitude2);</span><br><span class="line">        // ç»åº¦</span><br><span class="line">        double lng1 = Math.toRadians(longitude1);</span><br><span class="line">        double lng2 = Math.toRadians(longitude2);</span><br><span class="line">        // çº¬åº¦ä¹‹å·®</span><br><span class="line">        double a = lat1 - lat2;</span><br><span class="line">        // ç»åº¦ä¹‹å·®</span><br><span class="line">        double b = lng1 - lng2;</span><br><span class="line">        // è®¡ç®—ä¸¤ç‚¹è·ç¦»çš„å…¬å¼</span><br><span class="line">        double s = 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(a / 2), 2) +</span><br><span class="line">                Math.cos(lat1) * Math.cos(lat2) * Math.pow(Math.sin(b / 2), 2)));</span><br><span class="line">        // å¼§é•¿ä¹˜åœ°çƒåŠå¾„, è¿”å›å•ä½: ç±³</span><br><span class="line">        s =  s * EARTH_RADIUS;</span><br><span class="line">        return Math.round(s * 10000) / 10000;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        double distance = DistanceUtils.getDistance(109.49081, 36.596537, 111.128971, 37.524041);</span><br><span class="line">        log.info(&quot;distance=&#123;&#125;&quot;, distance);</span><br><span class="line">        double distance1 = DistanceUtils.getDistance(109.500603,36.594125, 111.151761,37.52671);</span><br><span class="line">        log.info(&quot;distance=&#123;&#125;&quot;, distance1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="rediså®ç°"><a href="#rediså®ç°" class="headerlink" title="rediså®ç°"></a>rediså®ç°</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æ·»åŠ ç»çº¬åº¦</span><br><span class="line"> *</span><br><span class="line"> * @param key åœè½¦åœºåœ°ç†ä½ç½®é”®</span><br><span class="line"> * @param lng åæ ‡</span><br><span class="line"> * @param lat åæ ‡</span><br><span class="line"> * @param t åœè½¦åœºæ ‡ç¤º</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public Long addGeo(String key, Double lng, Double lat, T t) &#123;</span><br><span class="line">    RedisGeoCommands.GeoLocation&lt;T&gt; geoLocation = new RedisGeoCommands.GeoLocation&lt;&gt;(t, new Point(lng, lat));</span><br><span class="line">    return redisTemplate.opsForGeo().add(key, geoLocation);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ‰¹é‡æ·»åŠ </span><br><span class="line"> * @param key</span><br><span class="line"> * @param list</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public Long batchAddGeo(String key, List&lt;RedisGeoCommands.GeoLocation&lt;T&gt;&gt; list) &#123;</span><br><span class="line">    return redisTemplate.opsForGeo().add(key, list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * åˆ é™¤ç»çº¬åº¦</span><br><span class="line"> *</span><br><span class="line"> * @param key</span><br><span class="line"> */</span><br><span class="line">public void removeGeo(String key, T... t) &#123;</span><br><span class="line">    redisTemplate.opsForGeo().remove(key, t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è·å–ç»çº¬åº¦æŒ‡å®šè·ç¦»å†…çš„æ•°æ®</span><br><span class="line"> *</span><br><span class="line"> * @param lng</span><br><span class="line"> * @param lat</span><br><span class="line"> * @param distance</span><br><span class="line"> * @param key</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public List&lt;GeoResult&lt;RedisGeoCommands.GeoLocation&lt;T&gt;&gt;&gt;</span><br><span class="line">getCacheListByPointAndDistance(Double lng, Double lat, Double distance, String key) &#123;</span><br><span class="line">    Circle circle = new Circle(new Point(lng, lat), new Distance(distance, Metrics.KILOMETERS));</span><br><span class="line">    RedisGeoCommands.GeoRadiusCommandArgs args =</span><br><span class="line">            // includeCoordinatesï¼šè¿”å›ç»“æœåŒ…å«åæ ‡ä¿¡æ¯</span><br><span class="line">            // includeDistanceï¼šè¿”å›ç»“æœåŒ…å«å…·ä¸­å¿ƒåæ ‡è·ç¦»ä¿¡æ¯</span><br><span class="line">            // sortAscendingï¼šæŒ‰ç…§è·ç¦»å‡åºæ’åº</span><br><span class="line">            // sortDescendingï¼šæŒ‰ç…§è·ç¦»é™åºæ’åº</span><br><span class="line">            // limitï¼šè¿”å›ç»“æœæ•°é‡é™åˆ¶</span><br><span class="line">            RedisGeoCommands.GeoRadiusCommandArgs.newGeoRadiusArgs().includeDistance().includeCoordinates()</span><br><span class="line">                    .sortAscending();</span><br><span class="line">    List&lt;GeoResult&lt;RedisGeoCommands.GeoLocation&lt;T&gt;&gt;&gt; content =</span><br><span class="line">            redisTemplate.opsForGeo().radius(key, circle, args).getContent();</span><br><span class="line">    return content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="Elasticsearch-Geo"><a href="#Elasticsearch-Geo" class="headerlink" title="Elasticsearch Geo"></a>Elasticsearch Geo</h4><p>ã€toStudyã€‘</p>
<p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/m0_37923316/article/details/108978101">https://blog.csdn.net/m0_37923316/article/details/108978101</a></p>
<h3 id="ç‚¹åˆ°çº¿çš„æœ€è¿‘çº¿æ®µ"><a href="#ç‚¹åˆ°çº¿çš„æœ€è¿‘çº¿æ®µ" class="headerlink" title="ç‚¹åˆ°çº¿çš„æœ€è¿‘çº¿æ®µ"></a>ç‚¹åˆ°çº¿çš„æœ€è¿‘çº¿æ®µ</h3><p>ä½¿ç”¨JTSFactoryFinder åˆ›å»ºGeometryFactoryï¼Œæ˜¯åœ¨org.geotools.geometry.jtsä¸‹çš„ã€‚</p>
<p>éœ€è¦å¯¼å…¥çš„åŒ…ï¼šgt-mainã€gt-metadata</p>
<p><code>GeometryFactory geometryFactory = JTSFactoryFinder.getGeometryFactory(null);</code></p>
<p>è¿”å›ç‚¹åˆ°çº¿æ®µçš„æœ€è¿‘çº¿æ®µï¼Œå¯èƒ½æ˜¯å‚çº¿ï¼Œä¸èƒ½å‚ç›´çš„è¯ï¼Œæ˜¯ç‚¹åˆ°çº¿æ®µä¸¤ç«¯ç‚¹çš„è¿çº¿ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testNearest() throws ParseException &#123;</span><br><span class="line">    GeometryFactory geometryFactory = new GeometryFactory();</span><br><span class="line">    Coordinate coordinate = new Coordinate(1, 1);</span><br><span class="line">    WKTReader reader = new WKTReader(geometryFactory);</span><br><span class="line">    String wkt = &quot;LINESTRING(0 0, 1 0, 2 0)&quot;;</span><br><span class="line">    LineString road = (LineString) reader.read(wkt);</span><br><span class="line">    Coordinate[] shadow = com.vividsolutions.jts.operation.distance.DistanceOp.nearestPoints(road,</span><br><span class="line">            geometryFactory.createPoint(coordinate));</span><br><span class="line">    System.out.println(Arrays.toString(shadow)); //[(1.0, 0.0, NaN), (1.0, 1.0, NaN)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="é“æ ¼æ‹‰æ–¯æŠ½ç¨€"><a href="#é“æ ¼æ‹‰æ–¯æŠ½ç¨€" class="headerlink" title="é“æ ¼æ‹‰æ–¯æŠ½ç¨€"></a>é“æ ¼æ‹‰æ–¯æŠ½ç¨€</h3><p>é“æ ¼æ‹‰æ–¯-æ™®å…‹ç®—æ³•ï¼ˆDouglas-Peukerç®—æ³•ï¼‰æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ç§è½¨è¿¹ç‚¹çš„æŠ½ç¨€ç®—æ³•ï¼ŒæŠ½ç¨€å‡ºæ¥çš„ç‚¹å¯ä»¥å°½å¯èƒ½çš„ç»´æŒåŸå…ˆè½¨è¿¹ç‚¹çš„å¤§ä½“è½®å»“ï¼Œå‰”é™¤ä¸€äº›éå¿…è¦çš„ç‚¹ã€‚</p>
<p>é“æ ¼æ‹‰æ–¯-æ™®å…‹åŸç†ï¼š<br>ï¼ˆ1ï¼‰åœ¨æ›²çº¿é¦–å°¾ä¸¤ç‚¹Aï¼ŒBä¹‹é—´è¿æ¥ä¸€æ¡ç›´çº¿ABï¼Œè¯¥ç›´çº¿ä¸ºæ›²çº¿çš„å¼¦ï¼›<br>ï¼ˆ2ï¼‰å¾—åˆ°æ›²çº¿ä¸Šç¦»è¯¥ç›´çº¿æ®µè·ç¦»æœ€å¤§çš„ç‚¹Cï¼Œè®¡ç®—å…¶ä¸ABçš„è·ç¦»dï¼›<br>ï¼ˆ3ï¼‰æ¯”è¾ƒè¯¥è·ç¦»ä¸é¢„å…ˆç»™å®šçš„é˜ˆå€¼thresholdçš„å¤§å°ï¼Œå¦‚æœå°äºthresholdï¼Œåˆ™è¯¥ç›´çº¿æ®µä½œä¸ºæ›²çº¿çš„è¿‘ä¼¼ï¼Œè¯¥æ®µæ›²çº¿å¤„ç†å®Œæ¯•ã€‚<br>ï¼ˆ4ï¼‰å¦‚æœè·ç¦»å¤§äºé˜ˆå€¼ï¼Œåˆ™ç”¨Cå°†æ›²çº¿åˆ†ä¸ºä¸¤æ®µACå’ŒBCï¼Œå¹¶åˆ†åˆ«å¯¹ä¸¤æ®µå–ä¿¡è¿›è¡Œ1~3çš„å¤„ç†ã€‚<br>ï¼ˆ5ï¼‰å½“æ‰€æœ‰æ›²çº¿éƒ½å¤„ç†å®Œæ¯•æ—¶ï¼Œä¾æ¬¡è¿æ¥å„ä¸ªåˆ†å‰²ç‚¹å½¢æˆçš„æŠ˜çº¿ï¼Œå³å¯ä»¥ä½œä¸ºæ›²çº¿çš„è¿‘ä¼¼ã€‚</p>
<p>javaä½¿ç”¨æ–¹æ³•ï¼šjtsæ˜¯ä¸€å¥—ç”¨äºå¤„ç†å‡ ä½•è¦ç´ æ‹“æ‰‘å…³ç³»çš„å‡½æ•°åº“ï¼Œæä¾›äº†åŸºæœ¬äºŒä½å¹³é¢çº¿å½¢å›¾å½¢è¿ç®—ç®—æ³•å®ç°ã€‚</p>
<p>mvnä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.vividsolutions&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jts&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.13&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GeometryFactory geometryFactory = new GeometryFactory(new PrecisionModel(PrecisionModel.FLOATING), 4326);</span><br><span class="line">WKTReader wktReader = new WKTReader(geometryFactory);</span><br><span class="line">Geometry geometry1 = wktReader.read(&quot;lineString(0 0, 1 1, 2 0)&quot;);</span><br><span class="line">Geometry geometry2 = DouglasPeuckerSimplifier.simplify(geometry1, 0.9);</span><br><span class="line">WKTWriter wktWriter = new WKTWriter();</span><br><span class="line">String res = wktWriter.write(geometry2);</span><br><span class="line">System.out.println(res);  //LINESTRING (0 0, 1 1, 2 0)</span><br></pre></td></tr></table></figure>

<p><code>Geometry simplify(Geometry geom, double distanceTolerance)</code>ä¸­çš„å‚æ•°distanceToleranceæ˜¯è·Ÿé¦–å°¾ç‚¹è·ç¦»æ¯”(å•çº¯å¹³æ–¹é—´çš„è·ç¦»ï¼Œä¸æ˜¯å®é™…mçš„è·ç¦»)ã€‚</p>
<p>è‡ªå·±å®ç°é“æ ¼æ‹‰æ–¯æŠ½ç¨€(python)ï¼š<br><a href="https://www.jianshu.com/p/046bcaeb2cb6">https://www.jianshu.com/p/046bcaeb2cb6</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>spring bootå…¥é—¨æ•™ç¨‹</title>
    <url>/2022/03/07/myblog/spring/springboot%20b%E7%AB%99/</url>
    <content><![CDATA[<h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><p>spring bootæ˜¯ä¸€ä¸ªå¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œå¯ä»¥è¿…é€Ÿæ­å»ºä¸€å¥—åŸºäºspringæ¡†æ¶ä½“ç³»çš„åº”ç”¨ï¼Œæ˜¯spring cloudçš„åŸºç¡€ã€‚</p>
<p>springMVCè™½ç„¶ç®€åŒ–äº†é…ç½®ï¼Œå‡å°‘äº†å¾ˆå¤šç±»çš„æ•°é‡ï¼Œä¸€ä¸ªæ§åˆ¶å™¨å½“ä¸­å¤šä¸ªæ–¹æ³•å¯ä»¥å¯¹åº”ä¸åŒçš„ä¸šåŠ¡ï¼Œä½†æ˜¯SpringMVCçš„é…ç½®è¿˜æ˜¯æ¯”è¾ƒå¤šï¼Œæ­å»ºå·¥ç¨‹æœ‰å¾ˆå¤šé‡å¤æ­¥éª¤ï¼Œå¼€å‘é€Ÿåº¦ä¸å¤Ÿå¿«ã€‚</p>
<p>spring bootå¼€å¯äº†å„ç§è‡ªåŠ¨è£…é…ï¼Œä»è€Œç®€åŒ–ä»£ç çš„å¼€å‘ï¼Œä¸éœ€è¦ç¼–å†™å„ç§é…ç½®æ–‡ä»¶ï¼Œåªéœ€è¦å¼•å…¥ç›¸å…³ä¾èµ–å°±å¯ä»¥è¿…é€Ÿæ­å»ºä¸€ä¸ªåº”ç”¨ã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><p>ä¸éœ€è¦web.xml</p>
</li>
<li><p>ä¸éœ€è¦springmvc.xml</p>
</li>
<li><p>ä¸éœ€è¦tomcatï¼ŒSpring Bootå†…åµŒäº†tomcat</p>
</li>
<li><p>ä¸éœ€è¦é…ç½®jsonè§£æï¼ˆfastjsonï¼‰ï¼Œæ”¯æŒRESTæ¶æ„</p>
</li>
<li><p>ä¸ªæ€§åŒ–é…ç½®éå¸¸ç®€å•ï¼Œè‡³å°‘éœ€è¦ç«¯å£å•¥çš„</p>
</li>
</ul>
<p>å®ƒæ˜¯ä¸€ä¸ªå¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œä¸åƒmybatisæ˜¯ä¸€ä¸ªormæ˜ å°„çš„åº”ç”¨ã€‚ç›¸å½“äºä¸€ä¸ªè„šæ‰‹æ¶ï¼Œä½¿å¾—å…¶ä»–å·¥ç§å¿«é€Ÿè¿›è¡Œå·¥ä½œï¼Œæ­å»ºä¸€ä¸ªæ•´ä½“çš„ç¯å¢ƒã€‚</p>
<h3 id="springbootæ¦‚å¿µ"><a href="#springbootæ¦‚å¿µ" class="headerlink" title="springbootæ¦‚å¿µ"></a>springbootæ¦‚å¿µ</h3><p>spring bootçš„è®¾è®¡ç›®çš„æ˜¯ç”¨æ¥ç®€åŒ–springåº”ç”¨çš„åˆå§‹æ­å»ºä»¥åŠå¼€å‘è¿‡ç¨‹ï¼Œè¯¥æ¡†æ¶ä½¿ç”¨äº†ç‰¹å®šçš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä»è€Œä½¿å¼€å‘äººå‘˜ä¸å†éœ€è¦å®šä¹‰æ ·æ¿åŒ–çš„é…ç½®ï¼Œ</p>
<p>spring booté»˜è®¤é…ç½®äº†å¾ˆå¤šæ¡†æ¶çš„ä½¿ç”¨æ–¹å¼ï¼Œå°±åƒMavenæ•´åˆäº†æ‰€æœ‰çš„JaråŒ…ï¼Œspring bootæ•´åˆäº†æ‰€æœ‰çš„æ¡†æ¶ï¼Œé€šè¿‡å°‘é‡çš„ä»£ç å°±èƒ½åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ã€äº§å“çº§åˆ«çš„springåº”ç”¨ã€‚</p>
<p>ç®€è€Œè¨€ä¹‹ï¼Œspring bootæ˜¯ä¸€ä¸ªé›†æˆäº†springå„ç§ç»„ä»¶çš„å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œä½œä¸ºä¸€ä¸ªç”¨æˆ·å’Œspringä¹‹é—´çš„è¿æ¥è€…ã€‚</p>
<p>spring bootæ˜¯åŸºç¡€ï¼Œspring cloudæ˜¯åŸºäºspring bootçš„ï¼Œç”¨æ¥åšåˆ†å¸ƒå¼å¾®æœåŠ¡çš„ã€‚</p>
<h4 id="spring-bootç‰¹ç‚¹"><a href="#spring-bootç‰¹ç‚¹" class="headerlink" title="spring bootç‰¹ç‚¹"></a>spring bootç‰¹ç‚¹</h4><ul>
<li>ä½¿ç”¨springé¡¹ç›®å¼•å¯¼é¡µé¢å¯ä»¥åœ¨å‡ ç§’æ„å»ºä¸€ä¸ªé¡¹ç›®ã€‚</li>
<li>æ–¹ä¾¿å¯¹å¤–è¾“å‡ºå„ç§å½¢å¼çš„æœåŠ¡ï¼Œå¦‚REST APIã€WebSocketã€Webã€Streamingã€Tasks</li>
<li>éå¸¸ç®€æ´çš„å®‰å…¨ç­–ç•¥é›†æˆ</li>
<li>æ”¯æŒå…³ç³»æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“</li>
<li>æ”¯æŒè¿è¡ŒæœŸå†…åµŒå®¹å™¨ï¼Œå¦‚tomcatã€jetty</li>
<li>è‡ªåŠ¨ç®¡ç†ä¾èµ–</li>
</ul>
<h4 id="spring-bootä¸å¾®æœåŠ¡"><a href="#spring-bootä¸å¾®æœåŠ¡" class="headerlink" title="spring bootä¸å¾®æœåŠ¡"></a>spring bootä¸å¾®æœåŠ¡</h4><ul>
<li>spring bootçš„ä¸€ç³»åˆ—ç‰¹æ€§æœ‰åŠ©äºå®ç°å¾®æœåŠ¡æ¶æ„çš„è½åœ°ï¼Œä»ç›®å‰ä¼—å¤šçš„æŠ€æœ¯æ ˆå¯¹æ¯”æ¥çœ‹å®ƒæ˜¯javaé¢†åŸŸå¾®æœåŠ¡æ¶æ„æœ€ä¼˜è½åœ°æŠ€æœ¯ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚</li>
<li>spring cloudä¾èµ–äºspring bootã€‚</li>
<li>spring bootä¸“æ³¨äºå¿«é€Ÿå¼€å‘ä¸ªä½“å¾®æœåŠ¡ï¼Œspring cloudæ˜¯å…³æ³¨å…¨å±€çš„å¾®æœåŠ¡åè°ƒæ²»ç†æ¡†æ¶ã€‚spring bootæä¾›ç»„å»ºï¼Œspring cloudæ¥ç®¡ç†ç»„ä»¶ã€‚</li>
</ul>
<h3 id="åˆ›å»ºç¬¬ä¸€ä¸ªå·¥ç¨‹"><a href="#åˆ›å»ºç¬¬ä¸€ä¸ªå·¥ç¨‹" class="headerlink" title="åˆ›å»ºç¬¬ä¸€ä¸ªå·¥ç¨‹"></a>åˆ›å»ºç¬¬ä¸€ä¸ªå·¥ç¨‹</h3><h4 id="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmavenå·¥ç¨‹ï¼Œå¯¼å…¥ç›¸å…³çš„ä¾èµ–"><a href="#ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmavenå·¥ç¨‹ï¼Œå¯¼å…¥ç›¸å…³çš„ä¾èµ–" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmavenå·¥ç¨‹ï¼Œå¯¼å…¥ç›¸å…³çš„ä¾èµ–"></a>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºmavenå·¥ç¨‹ï¼Œå¯¼å…¥ç›¸å…³çš„ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç»§æ‰¿çˆ¶åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- dependenciesä¸‹é¢å†å¼•ç›¸å…³çš„å­åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- webå¯åŠ¨çš„jaråŒ… --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå®ä½“ç±»ï¼ŒåŠ lombok"><a href="#ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå®ä½“ç±»ï¼ŒåŠ lombok" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå®ä½“ç±»ï¼ŒåŠ lombok"></a>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå®ä½“ç±»ï¼ŒåŠ lombok</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.demo.springboot.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-12 10:42</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºStudentRepository"><a href="#ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºStudentRepository" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºStudentRepository"></a>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºStudentRepository</h4><p>ä¹‹å‰ï¼Œéœ€è¦é…ç½®æ–‡ä»¶å»æ‰«daoå®ç°ç±»çš„åŒ…ï¼Œä½†æ˜¯springbootç¯å¢ƒå¯åŠ¨ä¹‹åï¼Œä¼šè‡ªåŠ¨è¿›è¡Œæ‰«æã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.demo.springboot.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.liuxuan.demo.springboot.entity.Student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-12 10:45</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Student&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">findById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveOrUpdate</span><span class="params">(Student stu)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.demo.springboot.repository.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.liuxuan.demo.springboot.entity.Student;</span><br><span class="line"><span class="keyword">import</span> com.liuxuan.demo.springboot.repository.StudentDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-12 10:49</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">StudentDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨é™æ€mapä»£æ›¿æ•°æ®åº“</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Long, Student&gt; studentMap;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        studentMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        studentMap.put(<span class="number">1L</span>, <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">1L</span>, <span class="string">&quot;lili&quot;</span>, <span class="number">22</span>));</span><br><span class="line">        studentMap.put(<span class="number">2L</span>, <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">1L</span>, <span class="string">&quot;mary&quot;</span>, <span class="number">12</span>));</span><br><span class="line">        studentMap.put(<span class="number">3L</span>, <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">1L</span>, <span class="string">&quot;jade&quot;</span>, <span class="number">24</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Student&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> studentMap.values();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">findById</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> studentMap.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveOrUpdate</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">        studentMap.put(student.getId(), student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        studentMap.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬å››æ­¥ï¼šåˆ›å»ºcontrolå±‚ï¼ˆè·³è¿‡äº†serviceå±‚ï¼‰"><a href="#ç¬¬å››æ­¥ï¼šåˆ›å»ºcontrolå±‚ï¼ˆè·³è¿‡äº†serviceå±‚ï¼‰" class="headerlink" title="ç¬¬å››æ­¥ï¼šåˆ›å»ºcontrolå±‚ï¼ˆè·³è¿‡äº†serviceå±‚ï¼‰"></a>ç¬¬å››æ­¥ï¼šåˆ›å»ºcontrolå±‚ï¼ˆè·³è¿‡äº†serviceå±‚ï¼‰</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.demo.springboot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.liuxuan.demo.springboot.entity.Student;</span><br><span class="line"><span class="keyword">import</span> com.liuxuan.demo.springboot.repository.StudentDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-12 11:00</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">// è‡ªåŠ¨æ³¨å…¥ï¼Œdaoå®ç°ç±»è¦åŠ @Repositoryæ³¨è§£</span></span><br><span class="line">    <span class="keyword">private</span> StudentDao studentDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/findAll&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Student&gt; <span class="title function_">findAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentDao.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/findById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">long</span> id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentDao.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// postè¯·æ±‚ï¼Œå‰ç«¯è¿”å›çš„æ˜¯jsonæ ¼å¼çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œéœ€è¦æ˜ å°„æˆå¯¹è±¡</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sav&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Student student)</span>&#123;</span><br><span class="line">        studentDao.saveOrUpdate(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–°ç”¨putæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Student student)</span>&#123;</span><br><span class="line">        studentDao.saveOrUpdate(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/delete/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">long</span> id)</span>&#123;</span><br><span class="line">        studentDao.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬äº”æ­¥ï¼šåˆ›å»ºå¯åŠ¨ç±»"><a href="#ç¬¬äº”æ­¥ï¼šåˆ›å»ºå¯åŠ¨ç±»" class="headerlink" title="ç¬¬äº”æ­¥ï¼šåˆ›å»ºå¯åŠ¨ç±»"></a>ç¬¬äº”æ­¥ï¼šåˆ›å»ºå¯åŠ¨ç±»</h4><p>å¹³å¸¸çš„webå·¥ç¨‹éœ€è¦åœ¨tomcatéƒ¨ç½²ã€‚springbootæœ‰è‡ªå·±å†…ç½®çš„tomcatï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªå¯åŠ¨ç±»ï¼Œä½œä¸ºæ•´ä¸ªspringbootçš„å…¥å£.</p>
<p>application.javaéœ€è¦åœ¨å…¶ä»–ç»„ä»¶åŒ…çš„çˆ¶åŒ…ä¸‹ï¼Œè¦ä¸ç„¶æ‰«æä¸åˆ°ã€‚åå­—å«ä»€ä¹ˆæ— æ‰€è°“ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.liuxuan.demo.springboot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: liuxuan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2022-03-12 11:17</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å‚æ•°æ˜¯å¯åŠ¨ç±»çš„è¿è¡Œæ—¶ç±»ï¼Œè¿˜æœ‰mainæ–¹æ³•é‡Œçš„args</span></span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<p> Tomcat started on port(s): 8080 (http) with context path â€˜â€™</p>
<p>Started Application in 2.772 seconds (JVM running for 3.857)</p>
<p>è¡¨ç¤ºéƒ¨ç½²æˆåŠŸï¼Œå¯ä»¥ç›´æ¥è®¿é—®äº†ã€‚<a href="http://localhost:8080/student/findAll">http://localhost:8080/student/findAll</a></p>
<p>å› ä¸ºæ˜¯åŸºäºrestçš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨postmanå·¥å…·æ¥æµ‹è¯•ã€‚ï¼ˆpostè¯·æ±‚å‘jsonï¼Œé€‰bodyâ€“rawâ€“jsonï¼‰</p>
<h4 id="ç¬¬å…­æ­¥ï¼šå¦‚æœæƒ³è¦æ›´æ”¹ç«¯å£å·ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ›´æ”¹ã€‚"><a href="#ç¬¬å…­æ­¥ï¼šå¦‚æœæƒ³è¦æ›´æ”¹ç«¯å£å·ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ›´æ”¹ã€‚" class="headerlink" title="ç¬¬å…­æ­¥ï¼šå¦‚æœæƒ³è¦æ›´æ”¹ç«¯å£å·ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ›´æ”¹ã€‚"></a>ç¬¬å…­æ­¥ï¼šå¦‚æœæƒ³è¦æ›´æ”¹ç«¯å£å·ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ›´æ”¹ã€‚</h4><p>resourceé‡Œæ–°å»ºä¸€ä¸ªapplication.ymlæ–‡ä»¶ã€‚æ–‡ä»¶åä¸èƒ½å˜ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9090</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„9090å‰æœ‰ä¸ªç©ºæ ¼ã€‚</p>
<h3 id="springbootæ•´åˆJSP"><a href="#springbootæ•´åˆJSP" class="headerlink" title="springbootæ•´åˆJSP"></a>springbootæ•´åˆJSP</h3><p>æ–°å»ºmavenå·¥ç¨‹ï¼Œé€‰æ‹©archetypeï¼Œé€‰æ‹©webappï¼ˆwebæ¨¡ç‰ˆï¼Œç”¨æ¥è®¿é—®JSP.ï¼‰</p>
<p>ä¸Šä¸€ä¸ªå·¥ç¨‹åªå±•ç¤ºäº†æ•°æ®ï¼Œä½†æ˜¯æ²¡æœ‰è§†å›¾viewã€‚</p>
<p>JSPï¼ˆå…¨ç§°JavaServer Pagesï¼‰æ˜¯ç”±Sun Microsystemså…¬å¸ä¸»å¯¼åˆ›å»ºçš„ä¸€ç§åŠ¨æ€ç½‘é¡µæŠ€æœ¯æ ‡å‡†ã€‚JSPéƒ¨ç½²äºç½‘ç»œæœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥å“åº”å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®è¯·æ±‚å†…å®¹åŠ¨æ€åœ°ç”ŸæˆHTMLã€XMLæˆ–å…¶ä»–æ ¼å¼æ–‡æ¡£çš„Webç½‘é¡µï¼Œç„¶åè¿”å›ç»™è¯·æ±‚è€…ã€‚JSPæŠ€æœ¯ä»¥Javaè¯­è¨€ä½œä¸ºè„šæœ¬è¯­è¨€ï¼Œä¸ºç”¨æˆ·çš„HTTPè¯·æ±‚æä¾›æœåŠ¡ï¼Œå¹¶èƒ½ä¸æœåŠ¡å™¨ä¸Šçš„å…¶å®ƒJavaç¨‹åºå…±åŒå¤„ç†å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ã€‚</p>
<p>å‰åç«¯åˆ†ç¦»ï¼Œjspæ›´åƒå‰ç«¯çš„ç»„ä»¶ï¼Œç•¥ã€‚</p>
<p>javaç¨‹åºçš„å¯¹è±¡ï¼Œåºåˆ—åŒ–ä¸ºjsonå­—ç¬¦ä¸²ï¼Œä¼ é€’ç»™htmlè¿›è¡Œæ˜¾ç¤ºã€‚jspå°±æ˜¯æä¾›è§†å›¾çš„ã€‚controllerç”¨ModeAndViewã€‚</p>
<h3 id="spring-boot-html"><a href="#spring-boot-html" class="headerlink" title="spring boot html"></a>spring boot html</h3><p>spring mvcé‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼å±•ç¤ºjavaå¯¹è±¡ï¼Œéœ€è¦é€šè¿‡jsonå­—ç¬¦ä¸²è¿›è¡Œè¯»å–ï¼Œä½†æ˜¯spring bootå¯ä»¥åœ¨htmlä¸­è¯»å–javaå¯¹è±¡ã€‚</p>
<p>spring bootå¯ä»¥ç»“åˆthymeleafæ¨¡ç‰ˆæ¥æ•´åˆhtmlï¼Œä½¿ç”¨åŸç”Ÿçš„htmlä½œä¸ºè§†å›¾ã€‚</p>
<p>Thymeleafæ¨¡ç‰ˆæ˜¯é¢å‘Webå’Œç‹¬ç«‹ç¯å¢ƒçš„javaæ¨¡ç‰ˆå¼•æ“ï¼Œèƒ½å¤Ÿå¤„ç†htmlã€xmlã€javascriptã€cssç­‰ã€‚</p>
<p>å‰ç«¯ï¼Œç•¥ã€‚</p>
<h3 id="spring-bootæ•°æ®æ ¡éªŒ"><a href="#spring-bootæ•°æ®æ ¡éªŒ" class="headerlink" title="spring bootæ•°æ®æ ¡éªŒ"></a>spring bootæ•°æ®æ ¡éªŒ</h3><p>ç”¨æ¥ç¡®ä¿å®¢æˆ·ç«¯è¾“å…¥çš„æ•°æ®æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ç”¨åŒ…è£…ç±»ç±»å‹ï¼Ÿå› ä¸ºå‰å°æœ‰å¯èƒ½æ²¡ç©¿å€¼ï¼Œå°±ä¼šæ˜¯nullå€¼ï¼Œéœ€è¦åŒ…è£…ç±»ç±»å‹æ¥æ¥æ”¶ã€‚</p>
<p>notnullæ˜¯å‹æ ¹æ²¡ç©¿å€¼ï¼Œnotemptyæ˜¯ä¼ çš„ç©ºã€‚</p>
<p>è¿™äº›æ ¡éªŒå¯ä»¥äº¤ç»™å‰ç«¯ï¼Œä½†æ˜¯åç«¯æœ‰çš„åŸå› æ˜¯é˜²æ­¢æ”»å‡»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotEmpty;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;idä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;å§“åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Length(min = 2,message = &quot;å§“åé•¿åº¦ä¸èƒ½å°äº2ä½&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Min(value = 16,message = &quot;å¹´é¾„å¿…é¡»å¤§äº16å²&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/validator&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validatorUser</span><span class="params">(<span class="meta">@Valid</span> User user,BindingResult bindingResult)</span>&#123;</span><br><span class="line">  System.out.println(user);</span><br><span class="line">  <span class="keyword">if</span>(bindingResult.hasErrors())&#123;</span><br><span class="line">    List&lt;ObjectError&gt; list = bindingResult.getAllErrors();</span><br><span class="line">    <span class="keyword">for</span>(ObjectError objectError:list)&#123;</span><br><span class="line">      System.out.println(objectError.getCode()+<span class="string">&quot;-&quot;</span>+objectError.getDefaultMessage());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨@Validè¡¨ç¤ºè‡ªåŠ¨å»æ ¡éªŒï¼Œå°†é”™è¯¯ä¼ ç»™BindingResultã€‚getCodeæ˜¯æ³¨è§£åç§°ã€‚</p>
<h3 id="spring-bootæ•´åˆjdbc"><a href="#spring-bootæ•´åˆjdbc" class="headerlink" title="spring bootæ•´åˆjdbc"></a>spring bootæ•´åˆjdbc</h3><ul>
<li>pom.xmlï¼š</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>application.yml</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">classpath:/templates/</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">.html</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">HTML5</span></span><br><span class="line">    <span class="attr">encoding:</span> <span class="string">UTF-8</span></span><br><span class="line">  <span class="attr">datasource:</span> <span class="string">//è¿æ¥æ•°æ®åº“ç›¸å…³</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span> </span><br></pre></td></tr></table></figure>

<ul>
<li>User</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotEmpty;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;idä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;å§“åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Length(min = 2,message = &quot;å§“åé•¿åº¦ä¸èƒ½å°äº2ä½&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Min(value = 60,message = &quot;æˆç»©å¿…é¡»å¤§äº60åˆ†&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>UserRepository</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.southwind.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>UserRepositoryImplï¼ŒjdbcTemplateä¸¤ç§æ–¹æ³•ï¼šqueryã€updateã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.repository.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.southwind.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.southwind.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepositoryImpl</span> <span class="keyword">implements</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(<span class="string">&quot;select * from user&quot;</span>,<span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(User.class));</span><br><span class="line">    &#125;       <span class="comment">// è§£æå®ä½“ç±»ï¼Œæ‹¬å·å†…ä¼ å…¥è¦è§£ææˆä¸ºçš„å®ä½“ç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(<span class="string">&quot;select * from user where id = ?&quot;</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;id&#125;,<span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(User.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">&quot;insert into user(name,score) values(?,?)&quot;</span>,user.getName(),user.getScore());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">&quot;update user set name = ?,score = ? where id = ?&quot;</span>,user.getName(),user.getScore(),user.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">&quot;delete from user where id = ?&quot;</span>,id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Handler</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.southwind.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.southwind.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/findAll&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/findById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">long</span> id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        userRepository.update(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/deleteById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">long</span> id)</span>&#123;</span><br><span class="line">        userRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="spring-bootæ•´åˆmybatis"><a href="#spring-bootæ•´åˆmybatis" class="headerlink" title="spring bootæ•´åˆmybatis"></a>spring bootæ•´åˆmybatis</h3><p>mybatisæ˜¯åŠè‡ªåŠ¨åŒ–çš„ï¼Œæ„æ€æ˜¯å¾—è‡ªå·±å†™sqlè¯­å¥ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦mapper.xml</p>
<h4 id="ç¬¬ä¸€æ­¥ï¼šæ–°å»ºmavenå·¥ç¨‹"><a href="#ç¬¬ä¸€æ­¥ï¼šæ–°å»ºmavenå·¥ç¨‹" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šæ–°å»ºmavenå·¥ç¨‹"></a>ç¬¬ä¸€æ­¥ï¼šæ–°å»ºmavenå·¥ç¨‹</h4><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç»§æ‰¿çˆ¶åŒ… --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- dependenciesä¸‹é¢å†å¼•ç›¸å…³çš„å­åŒ… --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- webå¯åŠ¨çš„jaråŒ…ï¼Œä¸ç”¨å†™ç‰ˆæœ¬ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- mybatisè·Ÿspringbootæ•´åˆçš„ï¼Œmybatisè‡ªå·±å‡ºçš„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mysqlçš„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- lombok --&gt;</span></span><br><span class="line">			 <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®è¡¨"><a href="#ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®è¡¨" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®è¡¨"></a>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®è¡¨</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create table</span> student&#123;</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">11</span>),</span><br><span class="line">	score <span class="keyword">double</span>,</span><br><span class="line">	birthday <span class="type">date</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå®ä½“ç±»"><a href="#ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå®ä½“ç±»" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå®ä½“ç±»"></a>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå®ä½“ç±»</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotEmpty;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;idä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;å§“åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="meta">@Length(min = 2,message = &quot;å§“åé•¿åº¦ä¸èƒ½å°äº2ä½&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Min(value = 60,message = &quot;æˆç»©å¿…é¡»å¤§äº60åˆ†&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬å››æ­¥ï¼šåˆ›å»ºrepositoryæ¥å£"><a href="#ç¬¬å››æ­¥ï¼šåˆ›å»ºrepositoryæ¥å£" class="headerlink" title="ç¬¬å››æ­¥ï¼šåˆ›å»ºrepositoryæ¥å£"></a>ç¬¬å››æ­¥ï¼šåˆ›å»ºrepositoryæ¥å£</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.southwind.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">(<span class="type">int</span> index,<span class="type">int</span> limit)</span>;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬äº”æ­¥ï¼šåˆ›å»ºæ¥å£å¯¹åº”çš„mapper-xml"><a href="#ç¬¬äº”æ­¥ï¼šåˆ›å»ºæ¥å£å¯¹åº”çš„mapper-xml" class="headerlink" title="ç¬¬äº”æ­¥ï¼šåˆ›å»ºæ¥å£å¯¹åº”çš„mapper.xml"></a>ç¬¬äº”æ­¥ï¼šåˆ›å»ºæ¥å£å¯¹åº”çš„mapper.xml</h4><p>æ”¾åœ¨resourceæ–‡ä»¶å¤¹ä¸‹çš„mappingæ–‡ä»¶å¤¹ä¸‹ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line">        <span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.southwind.mapper.UserRepository&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from user limit #&#123;param1&#125;,#&#123;param2&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select count(id) from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;long&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;save&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        insert into user(name,score) values(#&#123;name&#125;,#&#123;score&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        update user set name = #&#123;name&#125;,score = #&#123;score&#125; where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;long&quot;</span>&gt;</span>   //å¦‚æœæ˜¯åŒ…è£…ç±»ç±»å‹ï¼Œâ€œjava.lang.Longâ€</span><br><span class="line">        delete from user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬å…­æ­¥ï¼šåˆ›å»ºcontrollerå±‚"><a href="#ç¬¬å…­æ­¥ï¼šåˆ›å»ºcontrollerå±‚" class="headerlink" title="ç¬¬å…­æ­¥ï¼šåˆ›å»ºcontrollerå±‚"></a>ç¬¬å…­æ­¥ï¼šåˆ›å»ºcontrollerå±‚</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.southwind.controller;</span><br><span class="line"><span class="keyword">import</span> com.southwind.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.southwind.mapper.UserRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>   <span class="comment">//è§†é¢‘ä¸­æ˜¯ @RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapperHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">limit</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/findAll/&#123;page&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">findAll</span><span class="params">(<span class="meta">@PathVariable(&quot;page&quot;)</span> <span class="type">int</span> page)</span>&#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (page-<span class="number">1</span>)*limit;</span><br><span class="line">        modelAndView.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;list&quot;</span>,userRepository.findAll(index,limit));</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;page&quot;</span>,page);</span><br><span class="line">        <span class="comment">//è®¡ç®—æ€»é¡µæ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> userRepository.count();</span><br><span class="line">        <span class="type">int</span> <span class="variable">pages</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(count%limit == <span class="number">0</span>)&#123;</span><br><span class="line">            pages = count/limit;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            pages = count/limit+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;pages&quot;</span>,pages);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/deleteById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">long</span> id)</span>&#123;</span><br><span class="line">        userRepository.deleteById(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/mapper/findAll/1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/findById&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">findById</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> <span class="type">long</span> id)</span>&#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;user&quot;</span>,userRepository.findById(id));</span><br><span class="line">        modelAndView.setViewName(<span class="string">&quot;update&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">update</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        userRepository.update(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/mapper/findAll/1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/mapper/findAll/1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/redirect/&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">redirect</span><span class="params">(<span class="meta">@PathVariable(&quot;name&quot;)</span> String name)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>@RequestBodyæ˜¯æŠŠè¯·æ±‚é‡Œçš„jsonè½¬æ¢æˆjavaå¯¹è±¡</p>
<p>@RequestBodyæ˜¯æŠŠjavaå¯¹è±¡è½¬æˆjson</p>
<p>@PathVariableç›´æ¥ä»å¯¹è±¡ä¸­ä¼ æ•°æ®çš„</p>
<p>@RequestParamä¹Ÿæ˜¯ä»å¯¹è±¡ä¸­å–æ•°æ®ï¼Ÿ</p>
</blockquote>
<h4 id="ç¬¬ä¸ƒæ­¥ï¼šé…ç½®yml"><a href="#ç¬¬ä¸ƒæ­¥ï¼šé…ç½®yml" class="headerlink" title="ç¬¬ä¸ƒæ­¥ï¼šé…ç½®yml"></a>ç¬¬ä¸ƒæ­¥ï¼šé…ç½®yml</h4><p>resourceæ–‡ä»¶å¤¹ä¸‹application.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">classpath:/templates/</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">.html</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">HTML5</span></span><br><span class="line">    <span class="attr">encoding:</span> <span class="string">UTF-8</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapping/*.xml</span>   <span class="string">//æ³¨å…¥mapper</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.southwind.entity</span>    <span class="string">//è‡ªåŠ¨å°†åŒ…åæå‡ºæ¥ï¼Œæ‰€ä»¥mapperé‡Œä¸ç”¨å†™åŒ…åäº†ã€‚</span></span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬å…«æ­¥ï¼šåˆ›å»ºå¯åŠ¨ç±»"><a href="#ç¬¬å…«æ­¥ï¼šåˆ›å»ºå¯åŠ¨ç±»" class="headerlink" title="ç¬¬å…«æ­¥ï¼šåˆ›å»ºå¯åŠ¨ç±»"></a>ç¬¬å…«æ­¥ï¼šåˆ›å»ºå¯åŠ¨ç±»</h4><p>åœ¨controllerã€entityçš„å¤–éƒ¨æ–‡ä»¶å¤¹ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.liuxuan.demo.springboot;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: liuxuan</span><br><span class="line"> * @date: 2022-03-12 11:17</span><br><span class="line"> **/</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@MapperScan(com.liuxuan.repository)  //å› ä¸ºmapperæ¥å£æ˜¯mybatisçš„ï¼Œæ‰€ä»¥åŠ è¿™ä¸ªæ³¨è§£ç”¨æ¥æ‰«æï¼ŒæŠŠå®ƒçš„å®ä¾‹åŒ–å¯¹è±¡åŠ åˆ°iocå®¹å™¨ä¸­ã€‚</span><br><span class="line">public class Application &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // å‚æ•°æ˜¯å¯åŠ¨ç±»çš„è¿è¡Œæ—¶ç±»ï¼Œè¿˜æœ‰mainæ–¹æ³•é‡Œçš„args</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬ä¹æ­¥ï¼šHTML"><a href="#ç¬¬ä¹æ­¥ï¼šHTML" class="headerlink" title="ç¬¬ä¹æ­¥ï¼šHTML"></a>ç¬¬ä¹æ­¥ï¼šHTML</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/mapper/save&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        ç”¨æˆ·å§“åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        ç”¨æˆ·æˆç»©ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;score&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/mapper/update&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        ç”¨æˆ·IDï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span> <span class="attr">readonly</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        ç”¨æˆ·å§“åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;user.name&#125;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        ç”¨æˆ·æˆç»©ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;score&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;user.score&#125;&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/jquery-3.3.1.min.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;#first&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> page = $(<span class="string">&quot;#page&quot;</span>).<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">                page = <span class="built_in">parseInt</span>(page);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(page == <span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;/mapper/findAll/1&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;#previous&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> page = $(<span class="string">&quot;#page&quot;</span>).<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">                page = <span class="built_in">parseInt</span>(page);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(page == <span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                page = page-<span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;/mapper/findAll/&quot;</span>+page;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;#next&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> page = $(<span class="string">&quot;#page&quot;</span>).<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> pages = $(<span class="string">&quot;#pages&quot;</span>).<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(page == pages)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                page = <span class="built_in">parseInt</span>(page);</span></span><br><span class="line"><span class="language-javascript">                page = page+<span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;/mapper/findAll/&quot;</span>+page;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;#last&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> page = $(<span class="string">&quot;#page&quot;</span>).<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> pages = $(<span class="string">&quot;#pages&quot;</span>).<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(page == pages)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;/mapper/findAll/&quot;</span>+pages;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ç”¨æˆ·ä¿¡æ¯<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ç”¨æˆ·ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ç”¨æˆ·å<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>æˆç»©<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>æ“ä½œ<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user:$&#123;list&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.score&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/mapper/deleteById/&#123;id&#125;(id=$&#123;user.id&#125;)&#125;&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/mapper/findById(id=$&#123;user.id&#125;)&#125;&quot;</span>&gt;</span>ä¿®æ”¹<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;first&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;previous&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span>&gt;</span>ä¸Šä¸€é¡µ<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;page&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;page&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>/<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;pages&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;pages&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;next&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span>&gt;</span>ä¸‹ä¸€é¡µ<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;last&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span>&gt;</span>å°¾é¡µ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/mapper/redirect/save&quot;</span>&gt;</span>æ·»åŠ ç”¨æˆ·<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="spring-bootæ•´åˆspring-data-jpa"><a href="#spring-bootæ•´åˆspring-data-jpa" class="headerlink" title="spring bootæ•´åˆspring data jpa"></a>spring bootæ•´åˆspring data jpa</h3><p>JPAæ˜¯ä¸€å¥—æŒä¹…å±‚è§„èŒƒï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—ormæ¥å£ï¼Œéœ€è¦å®ç°æ‰èƒ½ä½¿ç”¨ã€‚</p>
<p>Hibernateæ¡†æ¶å°±æ˜¯ä¸€ä¸ªjpaå®ç°ã€‚</p>
<p>spring data jpaä¸æ˜¯å¯¹jpaè§„èŒƒçš„å…·ä½“å®ç°ï¼Œæœ¬èº«æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œåº•å±‚é€šè¿‡Hibernateå®ç°ã€‚</p>
<h3 id="spring-bootæ•´åˆspring-data-mongoDB"><a href="#spring-bootæ•´åˆspring-data-mongoDB" class="headerlink" title="spring bootæ•´åˆspring data mongoDB"></a>spring bootæ•´åˆspring data mongoDB</h3><h3 id="spring-bootæ•´åˆspring-data-redis"><a href="#spring-bootæ•´åˆspring-data-redis" class="headerlink" title="spring bootæ•´åˆspring data redis"></a>spring bootæ•´åˆspring data redis</h3><h3 id="spring-bootæ•´åˆspring-security"><a href="#spring-bootæ•´åˆspring-security" class="headerlink" title="spring bootæ•´åˆspring security"></a>spring bootæ•´åˆspring security</h3><p>æ¥æºï¼š<a href="https://www.bilibili.com/video/BV1v4411G72q?spm_id_from=333.999.0.0">https://www.bilibili.com/video/BV1v4411G72q?spm_id_from=333.999.0.0</a></p>
]]></content>
      <categories>
        <category>javaå¼€å‘</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºtensorflowçš„æ·±åº¦å­¦ä¹ </title>
    <url>/2023/08/20/myblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%9F%BA%E4%BA%8Etensorflow%E7%9A%84%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="ç¬¬ä¸€ç« -Numpyå¸¸ç”¨æ“ä½œ"><a href="#ç¬¬ä¸€ç« -Numpyå¸¸ç”¨æ“ä½œ" class="headerlink" title="ç¬¬ä¸€ç«  Numpyå¸¸ç”¨æ“ä½œ"></a>ç¬¬ä¸€ç«  Numpyå¸¸ç”¨æ“ä½œ</h2><p>tensorflowï¼šæ·±åº¦å­¦ä¹ æ¡†æ¶<br>pythonæœ¬èº«å«æœ‰åˆ—è¡¨listå’Œæ•°ç»„arrayã€‚<br>liståˆ—è¡¨çš„å…ƒç´ å¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡ï¼Œå› æ­¤åˆ—è¡¨ä¸­ä¿å­˜çš„æ˜¯å¯¹è±¡çš„æŒ‡é’ˆï¼Œæµªè´¹å†…å­˜å’ŒCPUè®¡ç®—æ—¶é—´ã€‚<br>arrayä¸æ”¯æŒå¤šç»´ï¼Œæ²¡æœ‰å„ç§è¿ç®—å‡½æ•°ã€‚</p>
<p>numpyæä¾›ndarrayï¼ˆå­˜å‚¨å•ä¸€æ•°æ®ç±»å‹çš„å¤šç»´æ•°ç»„ï¼‰å’Œufuncï¼ˆå¯¹æ•°ç»„è¿›è¡Œå¤„ç†çš„å‡½æ•°ï¼‰</p>
<p>1.å°†åˆ—è¡¨è½¬æ¢ä¸ºndarrayã€‚<br>2.npå‡½æ•°ï¼Œæˆªå–ndarray<br>3.numpyä¸­çš„randomå‡½æ•°<br>4.numpyä¸­çš„çŸ©é˜µæ“ä½œ<br>5.ndarrayçš„åˆå¹¶å’Œå±•å¹³<br>6.ä½¿ç”¨numpyå’Œmathçš„æ¯”è¾ƒï¼Œä½¿ç”¨å‘é‡åŒ–çŸ©é˜µè¿ç®—å¯ä»¥é¿å…å¾ªç¯è¯­å¥<br>7.numpyçš„å¹¿æ’­æœºåˆ¶ï¼šæ–¹ä¾¿ä¸åŒshapeçš„æ•°ç»„è¿›è¡Œæ•°å­¦è¿ç®—ã€‚åŸåˆ™æ˜¯å¯¹é½ç»´åº¦ï¼Œå¯¹æ•°ç»„è¿›è¡Œæ‰©å……åˆ°å¯ä»¥è¿›è¡Œè¿ç®—ï¼Œåˆ©ç”¨è‡ªåŠ¨å¤åˆ¶ç­‰æ–¹æ³•æŠŠä½ç»´æ•°æ®è¡¥é½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">print(np.arange(10))</span><br><span class="line">print(np.arange(0, 10))</span><br><span class="line">print(np.arange(1, 4, 0.5))</span><br><span class="line">print(np.arange(9, -1, -1))</span><br><span class="line"></span><br><span class="line">nd1 = np.arange(10)</span><br><span class="line">print(nd1)</span><br><span class="line">print(nd1[3:6])</span><br><span class="line">print(nd1[1:6:2])</span><br><span class="line">print(nd1[::-2])</span><br><span class="line"></span><br><span class="line">np2 = np.arange(25).reshape([5,5])</span><br><span class="line">print(np2)</span><br><span class="line">print(np2[[1,2]]) #1ã€2è¡Œ</span><br><span class="line">print(np2[1:3, :])</span><br><span class="line">print(np2[:, 1:3])</span><br><span class="line">import numpy as np</span><br><span class="line">from numpy import random</span><br><span class="line"></span><br><span class="line">a = np.arange(1, 25, dtype=float)</span><br><span class="line">print(a)</span><br><span class="line">c1 = random.choice(a, size=(3,4))</span><br><span class="line">print(c1)</span><br><span class="line">print(np.sum(a))</span><br><span class="line">print(a / np.sum(a))</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">nd3 = np.arange(9).reshape([3,3])</span><br><span class="line">print(np.transpose(nd3))</span><br><span class="line">print(nd3.trace)</span><br><span class="line">print(np.linalg.det(nd3))</span><br><span class="line">print(np.linalg.solve(nd3, np.eye(3)))</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">print(time.process_time())</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬äºŒç« -TheanoåŸºç¡€"><a href="#ç¬¬äºŒç« -TheanoåŸºç¡€" class="headerlink" title="ç¬¬äºŒç«  TheanoåŸºç¡€"></a>ç¬¬äºŒç«  TheanoåŸºç¡€</h2><p>Theanoæ˜¯pythonçš„ä¸€ä¸ªåº“ï¼Œå¯¹äºè§£å†³å¤§é‡æ•°æ®çš„é—®é¢˜ï¼Œä½¿ç”¨Theanoå¯ä»¥è·å–ä¸æ‰‹å·¥ç”¨Cå®ç°å·®ä¸å¤šçš„æ€§èƒ½ã€‚ç¬¦å·è®¡ç®—å›¾ã€‚<br>conda install theano<br>ç¬¦å·å˜é‡&#x3D;å¼ é‡Tensorã€‚<br>å¼ é‡æ˜¯æ ‡é‡ã€å‘é‡ã€çŸ©é˜µçš„ç»Ÿç§°ã€‚<br>Theanoæ˜¯ä¸€ä¸ªé€šç”¨çš„ç¬¦å·è®¡ç®—æ¡†æ¶ï¼Œå°†å¤æ‚çš„ç¬¦å·è¡¨è¾¾å¼ç¼–è¯‘æˆå‡½æ•°æ¨¡å‹ã€‚<br>1.å®šä¹‰ç¬¦å·å˜é‡<br>import theano<br>from theano import tensor<br>2.ç¬¦å·è®¡ç®—å›¾æ¨¡å‹æ¥æè¿°å˜é‡é—´çš„è¿ç®—å…³ç³»ï¼ŒæŠŠç¬¦å·è¡¨è¾¾å¼è½¬æ¢ä¸ºä¸€ä¸ªè®¡ç®—å›¾æ¥å¤„ç†ã€‚<br>3.å‡½æ•°ï¼šæä¾›ä¸€ä¸ªæ¥å£ï¼ŒæŠŠå‡½æ•°è®¡ç®—å›¾ç¼–è¯‘ä¸ºå¯è°ƒç”¨çš„å‡½æ•°å¯¹è±¡ã€‚Theanoè¿›è¡Œäº†ç¼–è¯‘ä¼˜åŒ–ï¼Œæ‰§è¡Œçš„æ˜¯ä¼˜åŒ–åä¿å­˜åœ¨å›¾ç»“æ„ä¸­çš„æ¨¡å‹ï¼Œæå‡é€Ÿåº¦ï¼Œä¸å¥½è°ƒè¯•ã€‚<br>è‡ªåŠ¨æ±‚å¯¼ï¼šå¯¹äºæ¯ä¸ªopéƒ½å®šä¹‰äº†æ ¹æ®è¾“å…¥è®¡ç®—å‡ºåå¯¼æ•°ï¼Œä½¿ç”¨é“¾å¼æ³•åˆ™ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºæ¢¯åº¦äº†ã€‚<br>æ›´æ–°å…±äº«å˜é‡å‚æ•°ï¼šæ·±åº¦å­¦ä¹ ä¸­é€šå¸¸éœ€è¦è¿­ä»£å¤šæ¬¡ï¼Œæ¯æ¬¡è¿­ä»£éƒ½éœ€è¦æ›´æ–°å‚æ•°ã€‚theano.functionä¸­çš„updateså‚æ•°å°±æ˜¯åŒ…å«ä¸¤ä¸ªå…ƒç´ çš„åˆ—è¡¨æˆ–tupleã€‚<br>æ¡ä»¶ï¼šifelseã€switch<br>å¾ªç¯ï¼šscanç”¨æ¥æ„å»ºå¾ªç¯Graphçš„æ–¹æ³•<br>4.å…±äº«å˜é‡ï¼šæ˜¯å®ç°æœºå™¨å­¦ä¹ ç®—æ³•å‚æ•°æ›´æ–°çš„é‡è¦æœºåˆ¶ã€‚sharedå‡½æ•°ä¼šè¿”å›å…±äº«å˜é‡ï¼Œè¿™ç§å˜é‡çš„å€¼å¯ä»¥åœ¨å¤šä¸ªå‡½æ•°ä¸­ç›´æ¥ä½¿ç”¨ã€‚ç”¨functionä¸­çš„updateså‚æ•°è¿›è¡Œæ›´æ–°ã€‚</p>
<h2 id="ç¬¬ä¸‰ç« -çº¿æ€§ä»£æ•°"><a href="#ç¬¬ä¸‰ç« -çº¿æ€§ä»£æ•°" class="headerlink" title="ç¬¬ä¸‰ç«  çº¿æ€§ä»£æ•°"></a>ç¬¬ä¸‰ç«  çº¿æ€§ä»£æ•°</h2><p>1.æ ‡é‡ã€å‘é‡ã€çŸ©é˜µã€å¼ é‡<br>2.å¯é€†çŸ©é˜µã€å¯¹è§’çŸ©é˜µã€å¯¹ç§°çŸ©é˜µã€å•ä½å‘é‡ã€æ­£äº¤å‘é‡ã€æ­£äº¤çŸ©é˜µ<br>0èŒƒæ•°(L0èŒƒæ•°)-å‘é‡ä¸­é0å…ƒç´ çš„ä¸ªæ•°ã€‚<br>1èŒƒæ•°(L1èŒƒæ•°)-å‘é‡ä¸­å„ä¸ªå…ƒç´ ç»å¯¹å€¼ä¹‹å’Œã€‚<br>2èŒƒæ•°(L2èŒƒæ•°)-å‘é‡çš„æ¨¡é•¿ã€‚<br>æ— ç©·èŒƒæ•°(æœ€å¤§èŒƒæ•°)-å‘é‡ä¸­å„ä¸ªå…ƒç´ ç»å¯¹å€¼çš„æœ€å¤§å€¼ã€‚</p>
<p>3.å‘é‡ç»„ã€çº¿æ€§ç»„åˆã€å‘é‡ç©ºé—´ã€‚å‘é‡ç»„çº¿æ€§ç›¸å…³ã€‚æœ€å¤§çº¿æ€§æ— å…³ç»„ã€å‘é‡ç»„çš„ç§©ã€‚çŸ©é˜µçš„è¡Œç§©å’Œåˆ—ç§©ç›¸ç­‰ã€‚<br>4.å‘é‡çš„å¤§å°ç”¨èŒƒæ•°æ¥è¡¨ç¤ºã€‚<br>5.ç‰¹å¾å€¼åˆ†è§£ï¼Œç‰¹å¾å€¼ï¼Œç‰¹å¾å‘é‡ã€‚<br>6.å¥‡å¼‚å€¼åˆ†è§£ï¼šåˆ†è§£æˆä¸‰ä¸ªçŸ©é˜µçš„ä¹˜ç§¯ã€‚å¯ä»¥æ‹“å±•çŸ©é˜µæ±‚é€†åˆ°éæ–¹çŸ©é˜µä¸Šã€‚SVD<br>7.è¿¹è¿ç®—ï¼šçŸ©é˜µå¯¹è§’å…ƒç´ çš„å’Œ Tr<br>8.ä¸»æˆåˆ†åˆ†æï¼šPCAï¼šé€šè¿‡æ­£äº¤å˜æ¢å°†ä¸€ç»„å¯èƒ½å­˜åœ¨ç›¸å…³æ€§çš„å˜é‡è½¬æ¢ä¸ºä¸€ç»„çº¿æ€§ä¸ç›¸å…³çš„å˜é‡ï¼Œè½¬æ¢åçš„è¿™ç»„å˜é‡å«åšä¸»æˆåˆ†ã€‚å±äºç‰¹å¾é™ç»´ã€‚<br>åœ¨å‡å°‘éœ€è¦åˆ†æçš„æŒ‡æ ‡æˆ–ç»´åº¦çš„åŒæ—¶ï¼Œå°½é‡å‡å°‘åŸæŒ‡æ ‡æ‰€å«ä¿¡æ¯çš„æŸå¤±ï¼Œä»¥è¾¾åˆ°å¯¹æ‰€æ”¶é›†æ•°æ®è¿›è¡Œå…¨é¢åˆ†æçš„ç›®çš„ã€‚<br>for i in range(10):<br>    print(i)</p>
<h2 id="ç¬¬å››ç« -æ¦‚ç‡ä¸ä¿¡æ¯è®º"><a href="#ç¬¬å››ç« -æ¦‚ç‡ä¸ä¿¡æ¯è®º" class="headerlink" title="ç¬¬å››ç«  æ¦‚ç‡ä¸ä¿¡æ¯è®º"></a>ç¬¬å››ç«  æ¦‚ç‡ä¸ä¿¡æ¯è®º</h2><p>æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ çš„ä¸‰å¤§åŸºçŸ³ï¼šçº¿æ€§ä»£æ•°ã€æ¦‚ç‡ä¸ä¿¡æ¯è®ºã€æ•°å€¼åˆ†æã€‚<br>æœºå™¨å­¦ä¹ å¤§éƒ¨åˆ†æ—¶å€™å¤„ç†çš„éƒ½æ˜¯ä¸ç¡®å®šé‡æˆ–éšæœºé‡ã€‚</p>
<p>1.ä¿¡æ¯è®ºä¸»è¦ç ”ç©¶å¯¹ä¸€ä¸ªä¿¡å·åŒ…å«ä¿¡æ¯çš„å¤šå°‘è¿›è¡Œé‡åŒ–ã€‚<br>æ ·æœ¬ç©ºé—´ï¼šä¸€ä¸ªå®éªŒæˆ–éšæœºè¯•éªŒæ‰€æœ‰å¯èƒ½ç»“æœçš„é›†åˆï¼Œæ¯ä¸ªå¯èƒ½ç»“æœä¸ºä¸€ä¸ªæ ·æœ¬ç‚¹ã€‚<br>éšæœºå˜é‡ï¼šéšæœºäº‹ä»¶çš„ç»“æœï¼šç¦»æ•£éšæœºå˜é‡ã€è¿ç»­éšæœºå˜é‡ã€‚nç»´éšæœºå˜é‡&#x2F;éšæœºå‘é‡ã€‚</p>
<p>2.æ¦‚ç‡åˆ†å¸ƒ<br>é€šå¸¸å…³å¿ƒéšæœºå˜é‡è½åœ¨æŸä¸€åŒºé—´çš„æ¦‚ç‡ï¼šåˆ†å¸ƒå‡½æ•°F<br>ç¦»æ•£å‹éšæœºå˜é‡ï¼šä¸¤ç‚¹åˆ†å¸ƒã€äºŒé¡¹åˆ†å¸ƒã€poissonåˆ†å¸ƒ<br>è¿ç»­å‹éšæœºå˜é‡ï¼šç”¨æ¦‚ç‡å¯†åº¦å‡½æ•°æ¥æè¿°å˜é‡çš„æ¦‚ç‡åˆ†å¸ƒfxã€‚æ­£æ€åˆ†å¸ƒ&#x3D;é«˜æ–¯åˆ†å¸ƒï¼Œé’Ÿå½¢æ›²çº¿ï¼Œå¹³å‡å€¼å’Œæ ‡å‡†å·®ï¼Œæ ‡å‡†å·®å¤§çš„æ›´åˆ†æ•£ã€‚æ­£æ€åˆ†å¸ƒæ˜¯ä¸€ç§ç†æƒ³åˆ†å¸ƒã€‚<br>scipyåº“è¿›è¡Œç»Ÿè®¡</p>
<p>3.è¾¹ç¼˜æ¦‚ç‡ï¼šå®šä¹‰åœ¨å¤šç»´éšæœºå˜é‡çš„å­é›†ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒç§°ä¸ºè¾¹ç¼˜æ¦‚ç‡åˆ†å¸ƒã€‚å¯¹äºè¿ç»­å‹éšæœºå˜é‡ï¼Œå¯ä»¥é€šè¿‡è”åˆå¯†åº¦å‡½æ•°æ¥å¾—åˆ°è¾¹ç¼˜å¯†åº¦å‡½æ•°ã€‚<br>4.æ¡ä»¶æ¦‚ç‡ï¼Œæ¡ä»¶æ¦‚ç‡çš„é“¾å¼æ³•åˆ™<br>5.ç‹¬ç«‹æ€§ä¸æ¡ä»¶ç‹¬ç«‹æ€§<br>6.æœŸæœ›ã€æ–¹å·®ã€åæ–¹å·®ã€‚<br>æœŸæœ›æè¿°æ•°æ®çš„å¤§å°ï¼Œä½†æ— æ³•æè¿°æ•°æ®çš„ç¦»æ•£ç¨‹åº¦ã€‚<br>æ–¹å·®å¯ä»¥ç”¨æ¥è¡¡é‡éšæœºå˜é‡å–å€¼çš„ç¦»æ•£ç¨‹åº¦ã€‚<br>åæ–¹å·®å¯ä»¥è¡¡é‡éšæœºå˜é‡é—´çš„ç›¸å…³æ€§å¼ºåº¦ã€‚å¦‚æœXå’ŒYç‹¬ç«‹ï¼Œé‚£ä¹ˆå®ƒä»¬çš„åæ–¹å·®ä¸º0.åä¹‹ä¸ä¸€å®šæˆç«‹ï¼Œç‹¬ç«‹æ€§æ¯”åæ–¹å·®ä¸º0çš„æ¡ä»¶æ›´å¼ºã€‚å¦‚æœXå’ŒYéƒ½æ˜¯æ­£æ€åˆ†å¸ƒï¼Œæ­¤æ—¶ç‹¬ç«‹å’Œåæ–¹å·®ä¸º0æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚<br>ç›¸å…³ç³»æ•°å°†æ¯ä¸ªå˜é‡çš„è´¡çŒ®è¿›è¡Œå½’ä¸€åŒ–ï¼Œåœ¨åæ–¹å·®çš„åŸºç¡€ä¸Šè¿›è¡Œæ­£åˆ™åŒ–ï¼ŒæŠŠç›¸å…³ç³»æ•°é™åˆ¶åœ¨-1åˆ°1ä¹‹é—´ã€‚å¦‚æœç­‰äº1ï¼Œè¡¨ç¤ºçº¿æ€§æ­£ç›¸å…³ã€‚<br>åæ–¹å·®æ¨å¹¿åˆ°nä¸ªéšæœºæˆ–nç»´éšæœºå˜é‡çš„æƒ…å†µï¼Œå¯¹äºnç»´ï¼Œå°±æ˜¯n*nçš„åæ–¹å·®çŸ©é˜µã€‚åæ–¹å·®çŸ©é˜µæ˜¯å¯¹ç§°çŸ©é˜µï¼Œåæ–¹å·®çŸ©é˜µçš„å¯¹è§’å…ƒç´ ä¸ºæ–¹å·®ã€‚<br>ç”¨numpyçš„ç›¸å…³å‡½æ•°ã€æ•°æ®åˆ†æåº“pandasã€ç”»å›¾åº“matplotlibã€snsã€‚<br>7.è´å¶æ–¯å®šç†<br>ä¸æ¡ä»¶æ¦‚ç‡å’Œè¾¹ç¼˜æ¦‚ç‡æœ‰å…³ï¼Œé€šè¿‡å·²çŸ¥çš„ä¸‰ä¸ªæ¦‚ç‡å‡½æ•°æ¨å‡ºç¬¬å››ä¸ªã€‚<br>åˆ†ç±»å™¨ï¼šè¿‘é‚»åˆ†ç±»å™¨ã€çº¿æ€§åˆ†ç±»å™¨ã€æ”¯æ’‘å‘é‡æœºåˆ†ç±»å™¨ã€ç¥ç»ç½‘ç»œåˆ†ç±»å™¨ã€éšæœºæ£®æ—åˆ†ç±»å™¨<br>æŸå¤±å‡½æ•°ï¼šå¤šç±»æ”¯æ’‘å‘é‡æœºæŸå¤±ã€äº¤å‰ç†µæŸå¤±ã€L1æŸå¤±ã€L2æŸå¤±<br>çº¿æ€§åˆ†ç±»å™¨ï¼Œå±‚çº§ç»“æ„å½¢æˆç¥ç»ç½‘ç»œï¼Œé«˜çº¬æ˜ å°„å½¢æˆæ”¯æ’‘å‘é‡æœº - éçº¿æ€§æ¨¡å‹<br>çº¿æ€§åˆ†ç±»å™¨çš„æƒå€¼ï¼šå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§æ¨¡ç‰ˆï¼Œåˆ†ç•Œé¢ï¼ˆå†³ç­–è¾¹ç•Œï¼‰<br>åˆ†ç±»å™¨çš„æŸå¤±å‡½æ•°ï¼šæ­å»ºäº†æ¨¡å‹æ€§èƒ½ä¸æ¨¡å‹å‚æ•°ä¹‹é—´çš„æ¡¥æ¢ã€‚<br>å¤šç±»æ”¯æ’‘å‘é‡æœºæŸå¤±ï¼šæ­£ç¡®ç±»åˆ«çš„å¾—åˆ†æ¯”ä¸æ­£ç¡®ç±»åˆ«çš„å¾—åˆ†é«˜å‡º1åˆ†ï¼Œå°±æ— æŸå¤±ï¼Œå¦åˆ™äº§ç”ŸæŸå¤±ã€‚</p>
<h2 id="ç¬¬äº”ç« -æ¦‚ç‡å›¾æ¨¡å‹"><a href="#ç¬¬äº”ç« -æ¦‚ç‡å›¾æ¨¡å‹" class="headerlink" title="ç¬¬äº”ç«  æ¦‚ç‡å›¾æ¨¡å‹"></a>ç¬¬äº”ç«  æ¦‚ç‡å›¾æ¨¡å‹</h2><p>1.æ¦‚ç‡å›¾æ¨¡å‹æ˜¯ä¸€ç§ç”¨å›¾çš„å½¢å¼è¡¨ç¤ºéšæœºå˜é‡ä¹‹é—´æ¡ä»¶ä¾èµ–å…³ç³»çš„æ¦‚ç‡æ¨¡å‹ï¼Œæ˜¯æ¦‚ç‡è®ºä¸å›¾è®ºçš„ç»“åˆã€‚<br>æœ‰å‘æ¦‚ç‡å›¾æ¨¡å‹ï¼šè´å¶æ–¯ç½‘ç»œï¼šè¡¨è¾¾éšæœºå˜é‡é—´çš„ä¾èµ–å…³ç³»å’Œç›¸äº’å…³ç³»<br>æ— å‘æ¦‚ç‡å›¾æ¨¡å‹ï¼šé©¬å°”å¯å¤«ç½‘ç»œï¼šè¡¨è¾¾éšæœºå˜é‡é—´çš„ç›¸äº’å…³ç³»</p>
<p>2.è´å¶æ–¯ç½‘ç»œåˆ†ä¸ºé™æ€è´å¶æ–¯ç½‘ç»œå’ŒåŠ¨æ€è´å¶æ–¯ç½‘ç»œ<br>åŠ¨æ€è´å¶æ–¯ç½‘ç»œå¯ç”¨äºå¤„ç†éšæ—¶é—´å˜åŒ–çš„åŠ¨æ€ç³»ç»Ÿä¸­çš„æ¨æ–­å’Œé¢„æµ‹ç­‰é—®é¢˜ã€‚å…¶ä¸­éšé©¬å°”å¯å¤«æ¨¡å‹HMMï¼Œè¢«å¹¿æ³›ç”¨äºè¯­éŸ³è¯†åˆ«ã€è‡ªåŠ¨åˆ†è¯ä¸è¯æ€§æ ‡æ³¨å’Œç»Ÿè®¡æœºå™¨ç¿»è¯‘ç­‰é¢†åŸŸã€‚</p>
<p>3.éšé©¬å°”å¯å¤«æ¨¡å‹<br>åˆå§‹çŠ¶æ€é¡¹é“¾ã€çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µã€è§‚æµ‹æ¦‚ç‡çŸ©é˜µ<br>çŠ¶æ€åºåˆ—ï¼ˆæ ‡è®°åºåˆ—ï¼‰å’Œè§‚æµ‹åºåˆ—ã€‚<br>éšé©¬å°”å¯å¤«æ¨¡å‹å¯è§£å†³ä¸‰ä¸ªåŸºæœ¬é—®é¢˜ï¼šè¯„ä¼°é—®é¢˜ã€è§£ç é—®é¢˜ã€å­¦ä¹ é—®é¢˜<br>å®ä¾‹ï¼šæ·éª°å­ï¼Œå¤šç§éª°å­<br>è§£ç é—®é¢˜ï¼šçŸ¥é“éª°å­æœ‰å‡ ç§ï¼ˆéšå«çŠ¶æ€æ•°é‡ï¼‰ï¼Œæ¯ç§éª°å­æ˜¯ä»€ä¹ˆï¼ˆè½¬æ¢æ¦‚ç‡ï¼‰ï¼Œæ ¹æ®æ·éª°å­çš„ç»“æœï¼ˆå¯è§çŠ¶æ€é“¾ï¼‰ï¼Œæƒ³çŸ¥é“æ¯æ¬¡æ·å‡ºæ¥çš„éƒ½æ˜¯å“ªç§éª°å­ï¼ˆéšå«çŠ¶æ€é“¾ï¼‰ã€‚</p>
<p>4.é©¬å°”å¯å¤«ç½‘ç»œ<br>æ— å‘æ¦‚ç‡å›¾æ¨¡å‹ï¼Œå…³äºä¸€ç»„æœ‰é©¬å°”å¯å¤«æ€§è´¨éšæœºå˜é‡Xçš„å…¨è”åˆæ¦‚ç‡åˆ†å¸ƒæ¨¡å‹ã€‚<br>é‡ç‚¹æ˜¯å…¶ä¸­çš„ä¸€ç§ï¼šé©¬å°”å¯å¤«éšæœºåœºMRFã€‚<br>é©¬å°”å¯å¤«éšæœºåœºæœ‰ä¸€ç»„åŠ¿å‡½æ•°ï¼Œä¹Ÿç§°å› å­ï¼Œæ˜¯å®šä¹‰åœ¨å˜é‡å­é›†ä¸Šçš„éè´Ÿå‡½æ•°ã€‚<br>æ¡ä»¶éšæœºåœºã€‚</p>
<h2 id="ç¬¬å…­ç« -æœºå™¨å­¦ä¹ åŸºç¡€"><a href="#ç¬¬å…­ç« -æœºå™¨å­¦ä¹ åŸºç¡€" class="headerlink" title="ç¬¬å…­ç«  æœºå™¨å­¦ä¹ åŸºç¡€"></a>ç¬¬å…­ç«  æœºå™¨å­¦ä¹ åŸºç¡€</h2><p>æœºå™¨å­¦ä¹ åˆ†ä¸ºç›‘ç£å­¦ä¹ ã€æ— ç›‘ç£å­¦ä¹ ã€åŠç›‘ç£å­¦ä¹ ï¼ˆå¼ºåŒ–å­¦ä¹ ï¼‰ã€‚</p>
<h3 id="çº¿æ€§æ¨¡å‹"><a href="#çº¿æ€§æ¨¡å‹" class="headerlink" title="çº¿æ€§æ¨¡å‹"></a>çº¿æ€§æ¨¡å‹</h3>]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>MachineLearning</tag>
      </tags>
  </entry>
  <entry>
    <title>æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ å…¥é—¨</title>
    <url>/2022/01/09/myblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„åŒºåˆ«"><a href="#æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„åŒºåˆ«" class="headerlink" title="æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„åŒºåˆ«"></a>æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„åŒºåˆ«</h2><p>æœºå™¨å­¦ä¹ â€”æ‹¥æœ‰æ‰¾ä¸€ä¸ªå‡½æ•°çš„èƒ½åŠ›ï¼Œæ ¹æ®è¾“å‡ºçš„ä¸åŒï¼Œåˆ†ä¸ºregressionå›å½’ã€åˆ†ç±»classificationï¼Œä»¥åŠå¾ˆå°‘æåŠçš„ç»“æ„åŒ–å­¦ä¹ structured learningï¼ˆè¾“å‡ºå›¾åƒï¼Œæ–‡æœ¬ï¼‰ã€‚</p>
<p>1.æ‰¾ä¸€ä¸ªå¸¦æœ‰æœªçŸ¥å‚æ•°çš„å‡½æ•°ï¼šy&#x3D;b+wxï¼Œbåç½®ï¼Œwæƒé‡ï¼Œæœºå™¨å­¦ä¹ ä¸­ï¼ŒæœªçŸ¥çš„å‚æ•°æ˜¯é€šè¿‡æ•°æ®æ¥å­¦ä¹ çš„ã€‚å¸¦æœ‰æœªçŸ¥å‚æ•°çš„å‡½æ•°ç§°ä¸ºmodelæ¨¡å‹ã€‚</p>
<p>2.ä»è®­ç»ƒæ•°æ®ä¸­å®šä¹‰Lossï¼ˆæŸå¤±ï¼‰ï¼ŒLossæ˜¯å…³äºå‚æ•°bã€wçš„å‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­ä¸€ç»„å‚æ•°å€¼å¥½è¿˜æ˜¯ä¸å¥½ã€‚<br>ç”¨è®­ç»ƒé›†è®¡ç®—è¯¯å·®ï¼Œå¯ä»¥æ˜¯ç»å¯¹å€¼è¯¯å·®MAEï¼Œä¹Ÿå¯ä»¥æ˜¯å‡æ–¹è¯¯å·®MSEã€‚<br>å¦‚æœyå€¼æ˜¯åŸºäºæ¦‚ç‡åˆ†å¸ƒçš„ï¼Œä¸€èˆ¬é‡‡å–cross-entropyäº¤å‰ç†µï¼Œå¯ä»¥ç»˜åˆ¶è¯¯å·®ç­‰é«˜çº¿å›¾error surfaceã€‚</p>
<p>3.ä¼˜åŒ–ï¼Œæ‰¾ä¸€ç»„æœ€å¥½çš„å‚æ•°wï¼Œbä½¿å¾—è¯¯å·®æœ€å°ã€‚<br>Gradient Descent æ¢¯åº¦ä¸‹é™ã€‚ä¸¾ä¾‹å…ˆåªæœ‰ä¸€ä¸ªå‚æ•°wï¼Œç»˜åˆ¶æ¨ªåæ ‡ä¸ºwå¯¹åº”çš„æŸå¤±å‡½æ•°æ›²çº¿ï¼Œåˆå§‹æ—¶å–ä¸€ä¸ªç‚¹ï¼Œéšæœºå–çš„ï¼Œä¹Ÿå¯ä»¥ç”¨é—ä¼ ç®—æ³•ç»™å‡ºä¸€ä¸ªè¾ƒä¼˜çš„æ¨¡å‹åˆå§‹å‚æ•°ã€‚é€‰å®šä¸€ä¸ªéšæœºåˆå§‹å€¼ï¼Œæ±‚è¯¥ç‚¹çš„åå¯¼å€¼ï¼Œå³è¯¥ç‚¹æ›²çº¿åˆ‡çº¿çš„æ–œç‡ã€‚ç„¶åè¿›è¡Œç§»åŠ¨ç‚¹ï¼Œè·¨åº¦å¤šå°‘å–å†³äºæ–œç‡å¤§å°ï¼Œæ–œç‡è¶Šå¤§ï¼Œè·¨åº¦è¶Šå¤§ï¼Œæ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªÎ·ï¼Œç§°ä¸ºlearning rate å­¦ä¹ ç‡ï¼Œè‡ªå·±è®¾å®šï¼ŒÎ·è¶Šå¤§è·¨åº¦è¶Šå¤§ï¼Œè®­ç»ƒè¶Šå¿«ã€‚æœºå™¨å­¦ä¹ ä¸­éœ€è¦è‡ªå·±è®¾å®šçš„å€¼ç§°ä¸ºè¶…å‚æ•°hyperparametersã€‚ä»¥æ­¤ç±»æ¨ï¼Œæ±‚ä¸‹ä¸€ä¸ªç‚¹ä¸‹ä¸‹ä¸ªç‚¹ã€‚åœæ­¢çš„æ—¶æœºï¼šçœ‹é¢„è®¾çš„è¿­ä»£æ¬¡æ•°ï¼Œæˆ–è€…æŸä¸€ç»„å‚æ•°è®¡ç®—å‡ºçš„å¾®åˆ†å€¼åˆšå¥½æ˜¯0ï¼Œåˆ™åœæ­¢è®­ç»ƒï¼Œæ˜¯ä¸ªå±€éƒ¨æœ€ä¼˜ï¼Œä¸ä¿è¯å…¨éƒ¨æœ€ä¼˜è§£ã€‚</p>
<p>å¯¹æ¨¡å‹çš„ä¿®æ”¹éœ€è¦å¯¹é—®é¢˜çš„å…·ä½“ç†è§£ï¼Œè€ƒè™‘å‰ä¸ƒå¤©æ¯”åªè€ƒè™‘å‰ä¸€å¤©çš„è¯¯å·®è¦å°ã€‚xæ˜¯å‰ä¸€å¤©çš„ï¼Œyæ˜¯é¢„æµ‹çš„åä¸€å¤©çš„ã€‚è€ƒè™‘å‰ä¸ƒå¤©çš„è¯ï¼Œå°±æœ‰ä¸ƒä¸ªwã€‚è®­ç»ƒæ•°æ®é›†æ˜¯å·²çŸ¥çš„ï¼Œæµ‹è¯•æ•°æ®é›†æ˜¯æœ¬æ¥å‡è£…ä¸çŸ¥é“çš„ï¼Œä¹Ÿå°±æ˜¯è¦é¢„æµ‹çš„yã€‚</p>
<p>è¾“å…¥xä¹˜æƒé‡ï¼Œå†åŠ ä¸Šä¸€ä¸ªåç½®çš„æ¨¡å‹ï¼Œç§°ä¸ºçº¿æ€§æ¨¡å‹ã€‚</p>
<p>çº¿æ€§æ¨¡å‹å…·æœ‰å±€é™æ€§ï¼Œæ¨¡å‹åå·®ã€‚</p>
<p>æœ‰æ—¶æ˜¯åˆ†æ®µçº¿æ€§æŠ˜çº¿å‡½æ•°&#x3D;å¸¸æ•°+ä¸€äº›åˆ—çš„åˆ†æ®µæ–œçº¿ã€‚</p>
<p>æœ‰æ—¶æ˜¯æ›²çº¿ï¼šå¯ä»¥ç”¨åˆ†æ®µçº¿æ€§æŠ˜çº¿é€¼è¿‘è¿ç»­æ›²çº¿ï¼Œéœ€è¦è¶³å¤Ÿçš„åˆ‡åˆ†ã€‚ï¼ˆä¹Ÿå¯ä»¥ç”¨max(0,æ–œçº¿)å åŠ è¡¨ç¤ºï¼‰</p>
<p>åˆ†æ®µæ–œçº¿å¯ä»¥ç”¨sigmoidå‡½æ•°æ¥é€¼è¿‘ã€‚</p>
<p><img src="/images/sigmoid.png"></p>
<p>æ”¹å˜wï¼Œå¯ä»¥æ”¹å˜å¡åº¦ã€‚æ”¹å˜bå¯ä»¥å·¦å³ç§»åŠ¨ã€‚æ”¹å˜cå¯ä»¥æ”¹å˜é«˜åº¦ã€‚</p>
<p><img src="/images/sigmoid2.png"></p>
<p>æ¥æºï¼š<a href="https://www.bilibili.com/video/BV1qP4y147PJ/?spm_id_from=333.788.recommend_more_video.-1">https://www.bilibili.com/video/BV1qP4y147PJ/?spm_id_from=333.788.recommend_more_video.-1</a></p>
<p>æ€»ç»“æ¥è®²ï¼šé¦–å…ˆé€‰æ‹©æ¨¡å‹ï¼Œçº¿æ€§æ¨¡å‹æˆ–è€…å¤æ‚é€¼è¿‘æ›²çº¿ï¼Œæœ€å°åŒ–æŸå¤±å‡½æ•°ï¼Œç”¨æ¢¯åº¦ä¸‹é™æ³•ï¼Œé€‰æ‹©åˆå§‹å€¼è¿­ä»£è®¡ç®—è¿›è¡Œé€¼è¿‘ã€‚</p>
<p>Sigmoldå‡½æ•°å’ŒReLUåœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œç§°ä¸ºæ¿€æ´»å‡½æ•°ã€‚å¯ä»¥å°†æ¿€æ´»å‡½æ•°è¿‡ç¨‹é‡å¤å‡ æ¬¡ï¼Œæ¥ä¼˜åŒ–æ¨¡å‹ã€‚æ¿€æ´»å‡½æ•°çš„éƒ¨åˆ†å«åšç¥ç»å…ƒï¼Œå¾ˆå¤šç¥ç»å…ƒç»„æˆç¥ç»ç½‘ç»œã€‚æ¯ä¸€åˆ—ç¥ç»å…ƒç§°ä¸ºéšè—å±‚ï¼Œå¾ˆå¤šå±‚å½±è—å±‚å½¢æˆæ·±åº¦å­¦ä¹ ã€‚</p>
<p>AlexNet16å±‚ã€‚VGG19å±‚ã€‚GoogleNet22å±‚ã€‚ResidualNet152å±‚ã€‚å¹¶ä¸æ˜¯å±‚æ•°è¶Šå¤šç½‘ç»œè¶Šæ·±é¢„æµ‹çš„æ•ˆæœå°±æ›´å¥½ï¼Œä¼šå‘ç”Ÿè¿‡æ‹ŸåˆOverfittingã€‚</p>
<h2 id="æœºå™¨å­¦ä¹ å…¥é—¨"><a href="#æœºå™¨å­¦ä¹ å…¥é—¨" class="headerlink" title="æœºå™¨å­¦ä¹ å…¥é—¨"></a>æœºå™¨å­¦ä¹ å…¥é—¨</h2><h3 id="1-æœºå™¨å­¦ä¹ æ¦‚è¿°"><a href="#1-æœºå™¨å­¦ä¹ æ¦‚è¿°" class="headerlink" title="1.æœºå™¨å­¦ä¹ æ¦‚è¿°"></a>1.æœºå™¨å­¦ä¹ æ¦‚è¿°</h3><h4 id="1-1-äººå·¥æ™ºèƒ½æ¦‚è¿°"><a href="#1-1-äººå·¥æ™ºèƒ½æ¦‚è¿°" class="headerlink" title="1.1.äººå·¥æ™ºèƒ½æ¦‚è¿°"></a>1.1.äººå·¥æ™ºèƒ½æ¦‚è¿°</h4><p>1956å¹´è¾¾ç‰¹èŒ…æ–¯ä¼šè®®ï¼Œäººå·¥æ™ºèƒ½å…ƒå¹´ã€‚æœ€åˆæ˜¯ç”¨æ¥æç»Ÿè®¡çš„ã€‚</p>
<p>äººå·¥æ™ºèƒ½åŒ…æ‹¬æœºå™¨å­¦ä¹ ï¼Œæœºå™¨å­¦ä¹ åŒ…æ‹¬æ·±åº¦å­¦ä¹ ã€‚<br>æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„å®ç°é€”å¾„ï¼ˆ1980så¼€å§‹ï¼‰<br>æ·±åº¦å­¦ä¹ ï¼ˆäººå·¥ç¥ç»ç½‘ç»œï¼‰æ˜¯æœºå™¨å­¦ä¹ çš„æ–¹æ³•ï¼ˆ2020å¼€å§‹ï¼‰</p>
<h4 id="1-2-äººå·¥æ™ºèƒ½çš„å‡ ä¸ªæ–¹å‘ï¼š"><a href="#1-2-äººå·¥æ™ºèƒ½çš„å‡ ä¸ªæ–¹å‘ï¼š" class="headerlink" title="1.2.äººå·¥æ™ºèƒ½çš„å‡ ä¸ªæ–¹å‘ï¼š"></a>1.2.äººå·¥æ™ºèƒ½çš„å‡ ä¸ªæ–¹å‘ï¼š</h4><p>ä¼ ç»Ÿé¢„æµ‹ï¼ˆé‡åŒ–æŠ•èµ„ã€å¹¿å‘Šæ¨èç­‰ï¼‰<br>å›¾åƒcvï¼ˆäººè„¸è¯†åˆ«ã€å›¾åƒæ£€æµ‹ï¼‰<br>è‡ªç„¶è¯­è¨€å¤„ç†nlpï¼ˆç¿»è¯‘ã€æ™ºèƒ½å®¢æœï¼‰</p>
<h4 id="1-3-æœºå™¨å­¦ä¹ æ¦‚è¿°"><a href="#1-3-æœºå™¨å­¦ä¹ æ¦‚è¿°" class="headerlink" title="1.3.æœºå™¨å­¦ä¹ æ¦‚è¿°"></a>1.3.æœºå™¨å­¦ä¹ æ¦‚è¿°</h4><p>æœºå™¨å­¦ä¹ æ˜¯ä»æ•°æ®ä¸­è‡ªåŠ¨åˆ†æè·å¾—æ¨¡å‹ï¼Œå¹¶åˆ©ç”¨æ¨¡å‹å¯¹æœªçŸ¥æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚</p>
<p>æœºå™¨å­¦ä¹ ï¼šæ•°æ® -ï¼ˆè®­ç»ƒï¼‰- æ¨¡å‹ - é¢„æµ‹<br>äººï¼šç»éªŒ - ï¼ˆå½’çº³ï¼‰- è§„å¾‹ - é¢„æµ‹</p>
<h4 id="1-4-æ•°æ®é›†æ„æˆ"><a href="#1-4-æ•°æ®é›†æ„æˆ" class="headerlink" title="1.4.æ•°æ®é›†æ„æˆ"></a>1.4.æ•°æ®é›†æ„æˆ</h4><p>ç‰¹å¾å€¼ï¼ˆæˆ¿å­é¢ç§¯ã€ä½ç½®ã€æ¥¼å±‚ï¼‰ + ç›®æ ‡å€¼ï¼ˆæˆ¿ä»·ï¼‰</p>
<p>æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªæ ·æœ¬ã€‚<br>æ•°æ®é›†å¯ä»¥æ²¡æœ‰ç›®æ ‡å€¼ã€‚</p>
<h4 id="1-5-æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»"><a href="#1-5-æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»" class="headerlink" title="1.5.æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»"></a>1.5.æœºå™¨å­¦ä¹ ç®—æ³•åˆ†ç±»</h4><p>ç›®æ ‡å€¼ï¼šç±»åˆ« - åˆ†ç±»é—®é¢˜ï¼ˆäººè„¸è¯†åˆ«ï¼‰<br>ç›®æ ‡å€¼ï¼šè¿ç»­å‹æ•°æ® - å›å½’é—®é¢˜<br>ç›®æ ‡å€¼ï¼šæ—  - æ— ç›‘ç£å­¦ä¹ </p>
<ul>
<li>ç›‘ç£å­¦ä¹ (supervised learning)ï¼ˆé¢„æµ‹ï¼‰<br>å®šä¹‰ï¼šè¾“å…¥æ•°æ®æ˜¯ç”±è¾“å…¥ç‰¹å¾å€¼å’Œç›®æ ‡å€¼æ‰€ç»„æˆã€‚å‡½æ•°çš„è¾“å‡ºå¯ä»¥æ˜¯ä¸€ä¸ªè¿ç»­çš„å€¼(ç§°ä¸ºå›å½’ï¼‰ï¼Œæˆ–æ˜¯è¾“å‡ºæ˜¯æœ‰é™ä¸ªç¦»æ•£å€¼ï¼ˆç§°ä½œåˆ†ç±»ï¼‰ã€‚<br>åˆ†ç±»ï¼š k-è¿‘é‚»ç®—æ³•ã€è´å¶æ–¯åˆ†ç±»ã€å†³ç­–æ ‘ä¸éšæœºæ£®æ—ã€é€»è¾‘å›å½’ã€ç¥ç»ç½‘ç»œ<br>å›å½’ï¼š çº¿æ€§å›å½’ã€å²­å›å½’</li>
<li>æ— ç›‘ç£å­¦ä¹ (unsupervised learning)<br>å®šä¹‰ï¼šè¾“å…¥æ•°æ®æ˜¯ç”±è¾“å…¥ç‰¹å¾å€¼æ‰€ç»„æˆã€‚<br>èšç±»ï¼š k-means</li>
</ul>
<p>è¿˜æœ‰åŠç›‘ç£å­¦ä¹ ï¼Œå¼ºåŒ–å­¦ä¹ ã€‚</p>
<h4 id="1-6-æœºå™¨å­¦ä¹ å¼€å‘æµç¨‹"><a href="#1-6-æœºå™¨å­¦ä¹ å¼€å‘æµç¨‹" class="headerlink" title="1.6.æœºå™¨å­¦ä¹ å¼€å‘æµç¨‹"></a>1.6.æœºå™¨å­¦ä¹ å¼€å‘æµç¨‹</h4><p>è·å–æ•°æ® -&gt; æ•°æ®é¢„å¤„ç† -&gt; ç‰¹å¾å·¥ç¨‹ -&gt; æœºå™¨å­¦ä¹ ç®—æ³•ä¸è®­ç»ƒ -&gt; æ¨¡å‹è¯„ä¼° -&gt; åº”ç”¨</p>
<p>ç®—æ³•æ˜¯æ ¸å¿ƒï¼Œæ•°æ®ã€è®¡ç®—æ˜¯åŸºç¡€ã€‚</p>
<p>ä»å…¥é—¨åˆ°å®é™…ï¼Œå†åˆ°ç†è®ºã€‚</p>
<p>åº“å’Œæ¡†æ¶ï¼šScikit-learnã€Tensflowï¼ˆæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼‰</p>
<h3 id="2-ç‰¹å¾å·¥ç¨‹"><a href="#2-ç‰¹å¾å·¥ç¨‹" class="headerlink" title="2.ç‰¹å¾å·¥ç¨‹"></a>2.ç‰¹å¾å·¥ç¨‹</h3><h4 id="2-1-æ•°æ®é›†"><a href="#2-1-æ•°æ®é›†" class="headerlink" title="2.1.æ•°æ®é›†"></a>2.1.æ•°æ®é›†</h4><p>âœ…å¯ç”¨æ•°æ®é›†ï¼š<br>scikitlearnç‰¹ç‚¹ï¼š1ã€æ•°æ®é‡è¾ƒå°  2ã€æ–¹ä¾¿å­¦ä¹ <br>scikit-learnç½‘å€ï¼š<a href="http://scikit-learn.org/stable/datasets/index.html#datasets">http://scikit-learn.org/stable/datasets/index.html#datasets</a></p>
<p>Kaggleç‰¹ç‚¹ï¼š1ã€å¤§æ•°æ®ç«èµ›å¹³åˆ   2ã€80ä¸‡ç§‘å­¦å®¶   3ã€çœŸå®æ•°æ®     4ã€æ•°æ®é‡å·¨å¤§<br>Kaggleç½‘å€ï¼š<a href="https://www.kaggle.com/datasets">https://www.kaggle.com/datasets</a></p>
<p>Ucç‰¹ç‚¹ï¼š1ã€æ”¶å½•äº†360ä¸ªæ•°æ®é›†    2ã€è¦†ç›–ç§‘å­¦ã€ç”Ÿæ´»ã€ç»æµç­‰é¢†åŸŸ   3ã€æ•°æ®é‡å‡ åä¸‡<br>UCIæ•°æ®é›†ç½‘å€ï¼š <a href="http://archive.ics.uci.edu/ml/">http://archive.ics.uci.edu/ml/</a></p>
<p>âœ…Scikit-learnï¼š<br>Pythonè¯­è¨€çš„æœºå™¨å­¦ä¹ å·¥å…·<br>Scikit-learnåŒ…æ‹¬è®¸å¤šçŸ¥åçš„æœºå™¨å­¦ä¹ ç®—æ³•çš„å®ç°<br>Scikit-learnæ–‡æ¡£å®Œå–„ï¼Œå®¹æ˜“ä¸Šæ‰‹ï¼Œä¸°å¯Œçš„API</p>
<p>âœ…å®‰è£…ï¼š<br><code>pip3 install sklearn</code>  å®‰è£…<br><code>pip3 list</code>   æŸ¥çœ‹ä¸€ä¸‹<br><code>python3</code>  è¿›å…¥python<br><code>import sklearn</code>  éªŒè¯ä¸€ä¸‹</p>
<p>âœ…è·å–æ•°æ®é›†apiï¼š<br>sklearn.datasets åŠ è½½è·å–æµè¡Œæ•°æ®é›†<br>1ã€datasets.load_*()<br>è·å–å°è§„æ¨¡æ•°æ®é›†ï¼Œæ•°æ®åŒ…å«åœ¨datasetsé‡Œ<br>2ã€datasets.fetch_*(data_home&#x3D;None)<br>è·å–å¤§è§„æ¨¡æ•°æ®é›†ï¼Œéœ€è¦ä»ç½‘ç»œä¸Šä¸‹è½½ï¼Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯data_homeï¼Œè¡¨ç¤ºæ•°æ®é›†ä¸‹è½½çš„ç›®å½•,é»˜è®¤æ˜¯ ~&#x2F;scikit_learn_data&#x2F;<br>datasets.fetch_20newsgroups(data_home&#x3D;None,subset&#x3D;â€˜trainâ€™)<br>subsetï¼šâ€™trainâ€™æˆ–è€…â€™testâ€™ï¼Œâ€™allâ€™ï¼Œå¯é€‰ï¼Œé€‰æ‹©è¦åŠ è½½çš„æ•°æ®é›†ã€‚<br>è®­ç»ƒé›†çš„â€œè®­ç»ƒâ€ï¼Œæµ‹è¯•é›†çš„â€œæµ‹è¯•â€ï¼Œä¸¤è€…çš„â€œå…¨éƒ¨â€</p>
<blockquote>
<p>loadå’Œfetchè¿”å›çš„æ•°æ®ç±»å‹datasets.base.Bunch(å­—å…¸æ ¼å¼)<br>dataï¼šç‰¹å¾æ•°æ®æ•°ç»„ï¼Œæ˜¯ [n_samples * n_features] çš„äºŒç»´ numpy.ndarray æ•°ç»„<br>targetï¼šæ ‡ç­¾æ•°ç»„ï¼Œæ˜¯ n_samples çš„ä¸€ç»´ numpy.ndarray æ•°ç»„<br>DESCRï¼šæ•°æ®æè¿°<br>feature_namesï¼šç‰¹å¾å,æ–°é—»æ•°æ®ï¼Œæ‰‹å†™æ•°å­—ã€å›å½’æ•°æ®é›†æ²¡æœ‰<br>target_namesï¼šæ ‡ç­¾å</p>
</blockquote>
<p><strong>Bunch(å­—å…¸æ ¼å¼)</strong>ï¼Œç»§æ‰¿è‡ªå­—å…¸çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é”®å€¼å¯¹ï¼Œä¹Ÿå¯ä»¥ç‚¹å±æ€§ã€‚</p>
<p>âœ…æ•°æ®é›†çš„åˆ’åˆ†apiï¼šåˆ’åˆ†ä¸ºè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®</p>
<p>è®­ç»ƒæ•°æ®ï¼šç”¨äºè®­ç»ƒï¼Œæ„å»ºæ¨¡å‹    70% 80% 75%<br>æµ‹è¯•æ•°æ®ï¼šåœ¨æ¨¡å‹æ£€éªŒæ—¶ä½¿ç”¨ï¼Œç”¨äºè¯„ä¼°æ¨¡å‹æ˜¯å¦æœ‰æ•ˆ    30% 20% 30%</p>
<p>sklearn.model_selection.train_test_split(arrays, *options)</p>
<blockquote>
<p>x æ•°æ®é›†çš„ç‰¹å¾å€¼<br>y æ•°æ®é›†çš„æ ‡ç­¾å€¼<br>test_size æµ‹è¯•é›†çš„å¤§å°ï¼Œä¸€èˆ¬ä¸ºfloat<br>random_state éšæœºæ•°ç§å­,ä¸åŒçš„ç§å­ä¼šé€ æˆä¸åŒçš„éšæœºé‡‡æ ·ç»“æœã€‚ç›¸åŒçš„ç§å­é‡‡æ ·ç»“æœç›¸åŒã€‚<br>return æµ‹è¯•é›†ç‰¹å¾è®­ç»ƒé›†ç‰¹å¾å€¼å€¼ï¼Œè®­ç»ƒæ ‡ç­¾ï¼Œæµ‹è¯•æ ‡ç­¾(é»˜è®¤éšæœºå–)</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from sklearn .datasets import load_iris</span><br><span class="line">from sklearn.model_selection import train_test_split</span><br><span class="line"></span><br><span class="line">def datasets_demo():</span><br><span class="line">    # è·å–æ•°æ®é›†</span><br><span class="line">    iris = load_iris()</span><br><span class="line">    print(&quot;é¸¢å°¾èŠ±æ•°æ®é›†ï¼š\n&quot;, iris)</span><br><span class="line">    print(&quot;æŸ¥çœ‹æ•°æ®é›†æè¿°ï¼š\n&quot;, iris[&quot;DESCR&quot;])</span><br><span class="line">    print(&quot;æŸ¥çœ‹ç‰¹å¾å€¼åå­—ï¼š\n&quot;, iris.feature_names)</span><br><span class="line">    print(&quot;æŸ¥çœ‹æ ·æœ¬æ•°ï¼š\n&quot;, iris.data.shape)</span><br><span class="line"></span><br><span class="line">    # æ•°æ®é›†åˆ’åˆ†</span><br><span class="line">    # è®­ç»ƒé›†çš„ç‰¹å¾å€¼x_train æµ‹è¯•é›†çš„ç‰¹å¾å€¼x_test è®­ç»ƒé›†çš„ç›®æ ‡å€¼y_train æµ‹è¯•é›†çš„ç›®æ ‡å€¼y_test</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, test_size=0.2, random_state=22)</span><br><span class="line">    print(&quot;x_train:\n&quot;, x_train.shape)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # sklearnæ•°æ®é›†ä½¿ç”¨</span><br><span class="line">    datasets_demo()</span><br></pre></td></tr></table></figure>

<h4 id="2-2-ç‰¹å¾å·¥ç¨‹"><a href="#2-2-ç‰¹å¾å·¥ç¨‹" class="headerlink" title="2.2.ç‰¹å¾å·¥ç¨‹"></a>2.2.ç‰¹å¾å·¥ç¨‹</h4><p>ä»€ä¹ˆæ˜¯ç‰¹å¾å·¥ç¨‹ï¼š<br>ç‰¹å¾å·¥ç¨‹æ˜¯ä½¿ç”¨ä¸“ä¸šèƒŒæ™¯çŸ¥è¯†å’ŒæŠ€å·§å¤„ç†æ•°æ®ï¼Œä½¿å¾—ç‰¹å¾èƒ½åœ¨æœºå™¨å­¦ä¹ ç®—æ³•ä¸Šå‘æŒ¥æ›´å¥½çš„ä½œç”¨çš„è¿‡ç¨‹ã€‚<br>æ„ä¹‰ï¼šä¼šç›´æ¥å½±å“æœºå™¨å­¦ä¹ çš„æ•ˆæœ</p>
<p>é‡è¦æ€§ï¼š<br>æ•°æ®å’Œç‰¹å¾å†³å®šäº†æœºå™¨å­¦ä¹ çš„ä¸Šé™ï¼Œè€Œæ¨¡å‹å’Œç®—æ³•åªæ˜¯é€¼è¿‘è¿™ä¸ªä¸Šé™è€Œå·²ã€‚</p>
<p>pandas:ä¸€ä¸ªæ•°æ®è¯»å–éå¸¸æ–¹ä¾¿ä»¥åŠåŸºæœ¬çš„å¤„ç†æ ¼å¼çš„å·¥å…·ï¼ˆæ•°æ®æ¸…æ´—ã€æ•°æ®å¤„ç†ï¼‰<br>sklearn:å¯¹äºç‰¹å¾çš„å¤„ç†æä¾›äº†å¼ºå¤§çš„æ¥å£</p>
<p>ç‰¹å¾å·¥ç¨‹åŒ…æ‹¬ï¼š<br>ç‰¹å¾æŠ½å–ã€ç‰¹å¾é¢„å¤„ç†ã€ç‰¹å¾é™ç»´</p>
<h5 id="âœ…ç‰¹å¾æŠ½å–"><a href="#âœ…ç‰¹å¾æŠ½å–" class="headerlink" title="âœ…ç‰¹å¾æŠ½å–"></a>âœ…ç‰¹å¾æŠ½å–</h5><p>å°†ä»»æ„æ•°æ®ï¼ˆå¦‚æ–‡æœ¬æˆ–å›¾åƒï¼‰è½¬æ¢ä¸ºå¯ç”¨äºæœºå™¨å­¦ä¹ çš„æ•°å­—ç‰¹å¾<br>ä¹Ÿå«ç‰¹å¾å€¼åŒ–ï¼Œæ˜¯ä¸ºäº†è®¡ç®—æœºæ›´å¥½çš„å»ç†è§£æ•°æ®<br>åˆ†ä¸ºï¼š<br>1.å­—å…¸ç‰¹å¾æå–(ç‰¹å¾ç¦»æ•£åŒ–)<br>2.æ–‡æœ¬ç‰¹å¾æå–<br>3.å›¾åƒç‰¹å¾æå–ï¼ˆæ·±åº¦å­¦ä¹ å°†ä»‹ç»ï¼‰</p>
<p>ç‰¹å¾æå–çš„APIï¼š<br><code>sklearn.feature_extraction</code></p>
<p><strong>å­—å…¸ç‰¹å¾æå–</strong>ï¼šå¯¹å­—å…¸æ•°æ®è¿›è¡Œç‰¹å¾å€¼åŒ–<br><code>sklearn.feature_extraction.DictVectorizer(sparse=True,â€¦)</code><br><code>DictVectorizer.fit_transform(X)</code> X:å­—å…¸æˆ–è€…åŒ…å«å­—å…¸çš„è¿­ä»£å™¨è¿”å›å€¼ï¼šè¿”å›sparseçŸ©é˜µ<br><code>CountVectorizer.get_feature_names()</code> è¿”å›å€¼:å•è¯åˆ—è¡¨<br>å­—å…¸ -&gt; çŸ©é˜µï¼ˆäºŒç»´æ•°ç»„ï¼‰ï¼ˆå…¶ä¸­å­—å…¸æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªçŸ¢é‡ï¼Œä¹Ÿå°±æ˜¯ä¸€ç»´æ•°ç»„ï¼‰<br>å…¶ä¸­å±äºç±»åˆ«çš„ï¼Œä¼šç”¨onehotç¼–ç ï¼Œæ¯”å¦‚æœ‰ä¸‰ç±»ï¼Œä¼šå˜æˆä¸‰åˆ—ã€‚<br>å¯¹äºç‰¹å¾å½“ä¸­å­˜åœ¨ç±»åˆ«ä¿¡æ¯çš„æˆ‘ä»¬éƒ½ä¼šåšone-hotç¼–ç å¤„ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from sklearn.feature_extraction import DictVectorizer</span><br><span class="line"></span><br><span class="line">def dict_demo():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å¯¹å­—å…¸ç±»å‹çš„æ•°æ®è¿›è¡Œç‰¹å¾æŠ½å–</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = [&#123;&#x27;city&#x27;: &#x27;åŒ—äº¬&#x27;,&#x27;temperature&#x27;:100&#125;, &#123;&#x27;city&#x27;: &#x27;ä¸Šæµ·&#x27;,&#x27;temperature&#x27;:60&#125;, &#123;&#x27;city&#x27;: &#x27;æ·±åœ³&#x27;,&#x27;temperature&#x27;:30&#125;]</span><br><span class="line">    # 1ã€å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»</span><br><span class="line">    transfer = DictVectorizer(sparse=False)</span><br><span class="line">    # 2ã€è°ƒç”¨fit_transform</span><br><span class="line">    data = transfer.fit_transform(data)</span><br><span class="line">    print(&quot;è¿”å›çš„ç»“æœ:\n&quot;, data)</span><br><span class="line">    # æ‰“å°ç‰¹å¾åå­—</span><br><span class="line">    print(&quot;ç‰¹å¾åå­—ï¼š\n&quot;, transfer.get_feature_names())</span><br><span class="line"></span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">è¿”å›çš„ç»“æœ:</span><br><span class="line"> [[  0.   1.   0. 100.]</span><br><span class="line"> [  1.   0.   0.  60.]</span><br><span class="line"> [  0.   0.   1.  30.]]</span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰åŠ ä¸Šsparse&#x3D;Falseå‚æ•°çš„ç»“æœæ˜¯çŸ©é˜µ1çš„ä½ç½®ï¼Œ<strong>ç¨€ç–çŸ©é˜µ</strong>ï¼Œä¼˜ç‚¹ï¼šèŠ‚çœå†…å­˜ï¼Œæé«˜åŠ è½½é€Ÿåº¦ã€‚</p>
<p>å­—å…¸ç‰¹å¾æå–çš„ä½¿ç”¨åœºæ™¯ï¼š<br>1ã€æ•°æ®é›†ä¸­ç±»åˆ«ç‰¹å¾æ¯”è¾ƒå¤š<br>2ã€æœ¬èº«æ‹¿åˆ°çš„å°±æ˜¯å­—å…¸ç±»å‹</p>
<p><strong>æ–‡æœ¬ç‰¹å¾æå–</strong>ï¼šå¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œç‰¹å¾å€¼åŒ–<br>å•è¯ä½œä¸ºç‰¹å¾æœ€åˆé€‚ã€‚</p>
<p><strong>1.countVectorizeræ–‡æœ¬ç‰¹å¾æå– - å‡ºç°ä¸ªæ•°</strong></p>
<p>apiï¼š<br><code>sklearn.feature_extraction.text.CountVectorizer(stop_words=[])</code>      è¿”å›è¯é¢‘çŸ©é˜µï¼ˆç»Ÿè®¡æ¯ä¸ªæ ·æœ¬ç‰¹å¾è¯å‡ºç°çš„ä¸ªæ•°ï¼‰ï¼Œstop_wordsæ˜¯åœç”¨è¯ï¼Œæ²¡æœ‰ç”¨çš„è¯ï¼Œæ¯”å¦‚toï¼Œä»¥åˆ—è¡¨å½¢å¼ä¼ å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CountVectorizer.fit_transform(X)    X:æ–‡æœ¬æˆ–è€…åŒ…å«æ–‡æœ¬å­—ç¬¦ä¸²çš„å¯è¿­ä»£å¯¹è±¡ è¿”å›å€¼ï¼šè¿”å›sparseçŸ©é˜µ</span><br><span class="line">CountVectorizer.inverse_transform(X)    X:arrayæ•°ç»„æˆ–è€…sparseçŸ©é˜µ è¿”å›å€¼:è½¬æ¢ä¹‹å‰æ•°æ®æ ¼</span><br><span class="line">CountVectorizer.get_feature_names()     è¿”å›å€¼:å•è¯åˆ—è¡¨</span><br></pre></td></tr></table></figure>
<p>æ ‡ç‚¹å’Œå­—æ¯ä¸ä½œä¸ºç‰¹å¾è¯åˆ—è¡¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def text_count_demo():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å¯¹æ–‡æœ¬è¿›è¡Œç‰¹å¾æŠ½å–ï¼Œcountvetorizer</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = [&quot;life is short,i like like python&quot;, &quot;life is too long,i dislike python&quot;]</span><br><span class="line">    # 1ã€å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»</span><br><span class="line">    # transfer = CountVectorizer(sparse=False)</span><br><span class="line">    transfer = CountVectorizer()</span><br><span class="line">    # 2ã€è°ƒç”¨fit_transform ï¼ˆï¼ˆæ³¨æ„è¿”å›æ ¼å¼ï¼Œåˆ©ç”¨toarray()æ–¹æ³•è¿›è¡ŒsparseçŸ©é˜µè½¬æ¢arrayæ•°ç»„ï¼‰ï¼‰</span><br><span class="line">    data = transfer.fit_transform(data)</span><br><span class="line">    print(&quot;æ–‡æœ¬ç‰¹å¾æŠ½å–çš„ç»“æœï¼š\n&quot;, data.toarray())</span><br><span class="line">    print(&quot;è¿”å›ç‰¹å¾åå­—ï¼š\n&quot;, transfer.get_feature_names())</span><br><span class="line"></span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # 3ã€æ–‡æœ¬ç‰¹å¾æå–</span><br><span class="line">    text_count_demo()</span><br></pre></td></tr></table></figure>

<p>[â€œlife is short,i like like pythonâ€, â€œlife is too long,i dislike pythonâ€]<br>ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿”å›ç‰¹å¾åå­—ï¼š</span><br><span class="line"> [&#x27;dislike&#x27;, &#x27;is&#x27;, &#x27;life&#x27;, &#x27;like&#x27;, &#x27;long&#x27;, &#x27;python&#x27;, &#x27;short&#x27;, &#x27;too&#x27;]</span><br><span class="line">æ–‡æœ¬ç‰¹å¾æŠ½å–çš„ç»“æœï¼š</span><br><span class="line"> [[0 1 1 2 0 1 1 0]</span><br><span class="line"> [1 1 1 0 1 1 0 1]]</span><br></pre></td></tr></table></figure>

<p><strong>jiebaåˆ†è¯</strong><br>å¦‚æœæ ·æœ¬æ˜¯ä¸­æ–‡ï¼Œæ•´ä¸ªçŸ­è¯­å˜æˆç‰¹å¾è¯äº†ï¼Œå¾—ç”¨ç©ºæ ¼éš”å¼€ã€‚ç”¨jiebaåˆ†è¯å¯ä»¥åˆ†å¼€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from sklearn.feature_extraction.text import CountVectorizer</span><br><span class="line">import jieba</span><br><span class="line"></span><br><span class="line">def cut_word(text):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å¯¹ä¸­æ–‡è¿›è¡Œåˆ†è¯</span><br><span class="line">    &quot;æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨&quot;â€”â€”â€”â€”&gt;&quot;æˆ‘ çˆ± åŒ—äº¬ å¤©å®‰é—¨&quot;</span><br><span class="line">    :param text:</span><br><span class="line">    :return: text</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # ç”¨ç»“å·´å¯¹ä¸­æ–‡å­—ç¬¦ä¸²è¿›è¡Œåˆ†è¯ï¼Œæƒ³è¦å­—ç¬¦ä¸²</span><br><span class="line">    text = &quot; &quot;.join(list(jieba.cut(text)))</span><br><span class="line"></span><br><span class="line">    return text</span><br><span class="line"></span><br><span class="line">def text_chinese_count_demo2():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å¯¹ä¸­æ–‡è¿›è¡Œç‰¹å¾æŠ½å–</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = [&quot;ä»Šå¤©å¾ˆæ®‹é…·ï¼Œæ˜å¤©æ›´æ®‹é…·ï¼Œåå¤©å¾ˆç¾å¥½ï¼Œä½†ç»å¯¹å¤§éƒ¨åˆ†æ˜¯æ­»åœ¨æ˜å¤©æ™šä¸Šï¼Œæ‰€ä»¥æ¯ä¸ªäººä¸è¦æ”¾å¼ƒä»Šå¤©ã€‚&quot;,</span><br><span class="line">            &quot;æˆ‘ä»¬çœ‹åˆ°çš„ä»å¾ˆè¿œæ˜Ÿç³»æ¥çš„å…‰æ˜¯åœ¨å‡ ç™¾ä¸‡å¹´ä¹‹å‰å‘å‡ºçš„ï¼Œè¿™æ ·å½“æˆ‘ä»¬çœ‹åˆ°å®‡å®™æ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨çœ‹å®ƒçš„è¿‡å»ã€‚&quot;,</span><br><span class="line">            &quot;å¦‚æœåªç”¨ä¸€ç§æ–¹å¼äº†è§£æŸæ ·äº‹ç‰©ï¼Œä½ å°±ä¸ä¼šçœŸæ­£äº†è§£å®ƒã€‚äº†è§£äº‹ç‰©çœŸæ­£å«ä¹‰çš„ç§˜å¯†å–å†³äºå¦‚ä½•å°†å…¶ä¸æˆ‘ä»¬æ‰€äº†è§£çš„äº‹ç‰©ç›¸è”ç³»ã€‚&quot;]</span><br><span class="line">    # å°†åŸå§‹æ•°æ®è½¬æ¢æˆåˆ†å¥½è¯çš„å½¢å¼</span><br><span class="line">    text_list = []</span><br><span class="line">    for sent in data:</span><br><span class="line">        text_list.append(cut_word(sent))</span><br><span class="line">    print(text_list)</span><br><span class="line"></span><br><span class="line">    # 1ã€å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»</span><br><span class="line">    # transfer = CountVectorizer(sparse=False)</span><br><span class="line">    transfer = CountVectorizer(stop_words=[&quot;ä¸€ç§&quot;])</span><br><span class="line">    # 2ã€è°ƒç”¨fit_transform</span><br><span class="line">    data = transfer.fit_transform(text_list)</span><br><span class="line">    print(&quot;æ–‡æœ¬ç‰¹å¾æŠ½å–çš„ç»“æœï¼š\n&quot;, data.toarray())</span><br><span class="line">    print(&quot;è¿”å›ç‰¹å¾åå­—ï¼š\n&quot;, transfer.get_feature_names())</span><br><span class="line"></span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # 4ã€ä¸­æ–‡æ–‡æœ¬ç‰¹å¾æå–</span><br><span class="line">    text_chinese_count_demo2()</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼šæƒ³æ‰¾çš„å…³é”®è¯å…¶å®æ˜¯åœ¨æŸä¸€ä¸ªç±»åˆ«çš„æ–‡ç« ä¸­å‡ºç°çš„æ¬¡æ•°å¾ˆå¤šï¼Œä½†æ˜¯åœ¨å…¶ä»–ç±»åˆ«çš„æ–‡ç« ä¸­å‡ºç°æ¬¡æ•°å¾ˆå°‘ï¼Œä¸è¦æˆ‘ä»¬è¿™äº›è¯ã€‚</p>
<p><strong>2.Tf-idfæ–‡æœ¬ç‰¹å¾æå– - é‡è¦ç¨‹åº¦</strong></p>
<p>TF-IDFçš„ä¸»è¦æ€æƒ³æ˜¯ï¼šå¦‚æœæŸä¸ªè¯æˆ–çŸ­è¯­åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å‡ºç°çš„æ¦‚ç‡é«˜ï¼Œå¹¶ä¸”åœ¨å…¶ä»–æ–‡ç« ä¸­å¾ˆå°‘å‡ºç°ï¼Œåˆ™è®¤ä¸ºæ­¤è¯æˆ–è€…çŸ­è¯­å…·æœ‰å¾ˆå¥½çš„ç±»åˆ«åŒºåˆ†èƒ½åŠ›ï¼Œé€‚åˆç”¨æ¥åˆ†ç±»ã€‚<br>TF-IDFä½œç”¨ï¼šç”¨ä»¥è¯„ä¼°ä¸€å­—è¯å¯¹äºä¸€ä¸ªæ–‡ä»¶é›†æˆ–ä¸€ä¸ªè¯­æ–™åº“ä¸­çš„å…¶ä¸­ä¸€ä»½æ–‡ä»¶çš„é‡è¦ç¨‹åº¦ã€‚<br>åˆ†ç±»æœºå™¨å­¦ä¹ ç®—æ³•è¿›è¡Œæ–‡ç« åˆ†ç±»ä¸­å‰æœŸæ•°æ®å¤„ç†æ–¹å¼</p>
<p>å…¬å¼ï¼š<br>è¯é¢‘ï¼ˆterm frequencyï¼Œtfï¼‰æŒ‡çš„æ˜¯æŸä¸€ä¸ªç»™å®šçš„è¯è¯­åœ¨è¯¥æ–‡ä»¶ä¸­å‡ºç°çš„é¢‘ç‡<br>é€†å‘æ–‡æ¡£é¢‘ç‡ï¼ˆinverse document frequencyï¼Œidfï¼‰æ˜¯ä¸€ä¸ªè¯è¯­æ™®éé‡è¦æ€§çš„åº¦é‡ã€‚æŸä¸€ç‰¹å®šè¯è¯­çš„idfï¼Œå¯ä»¥ç”±æ€»æ–‡ä»¶æ•°ç›®é™¤ä»¥åŒ…å«è¯¥è¯è¯­ä¹‹æ–‡ä»¶çš„æ•°ç›®ï¼Œå†å°†å¾—åˆ°çš„å•†å–ä»¥10ä¸ºåº•çš„å¯¹æ•°å¾—åˆ°</p>
<p>ä¾‹å­ï¼š<br>æ³¨ï¼šå‡å¦‚ä¸€ç¯‡æ–‡ä»¶çš„æ€»è¯è¯­æ•°æ˜¯100ä¸ªï¼Œè€Œè¯è¯­â€éå¸¸â€å‡ºç°äº†5æ¬¡ï¼Œé‚£ä¹ˆâ€éå¸¸â€ä¸€è¯åœ¨è¯¥æ–‡ä»¶ä¸­çš„è¯é¢‘å°±æ˜¯5&#x2F;100&#x3D;0.05ã€‚è€Œè®¡ç®—æ–‡ä»¶é¢‘ç‡ï¼ˆIDFï¼‰çš„æ–¹æ³•æ˜¯ä»¥æ–‡ä»¶é›†çš„æ–‡ä»¶æ€»æ•°ï¼Œé™¤ä»¥å‡ºç°â€éå¸¸â€ä¸€è¯çš„æ–‡ä»¶æ•°ã€‚æ‰€ä»¥ï¼Œå¦‚æœâ€éå¸¸â€ä¸€è¯åœ¨1,000ä»½æ–‡ä»¶å‡ºç°è¿‡ï¼Œè€Œæ–‡ä»¶æ€»æ•°æ˜¯10,000,000ä»½çš„è¯ï¼Œå…¶é€†å‘æ–‡ä»¶é¢‘ç‡å°±æ˜¯lgï¼ˆ10,000,000 &#x2F; 1,0000ï¼‰&#x3D;3ã€‚æœ€åâ€éå¸¸â€å¯¹äºè¿™ç¯‡æ–‡æ¡£çš„tf-idfçš„åˆ†æ•°ä¸º0.05 * 3&#x3D;0.15ã€‚</p>
<p>APIï¼š<br><code>transfer = TfidfVectorizer(stop_words=[&#39;ä¸€ç§&#39;, &#39;ä¸ä¼š&#39;, &#39;ä¸è¦&#39;])</code><br><code>data = transfer.fit_transform(text_list)</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def text_chinese_tfidf_demo():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å¯¹ä¸­æ–‡è¿›è¡Œç‰¹å¾æŠ½å–</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = [&quot;ä¸€ç§è¿˜æ˜¯ä¸€ç§ä»Šå¤©å¾ˆæ®‹é…·ï¼Œæ˜å¤©æ›´æ®‹é…·ï¼Œåå¤©å¾ˆç¾å¥½ï¼Œä½†ç»å¯¹å¤§éƒ¨åˆ†æ˜¯æ­»åœ¨æ˜å¤©æ™šä¸Šï¼Œæ‰€ä»¥æ¯ä¸ªäººä¸è¦æ”¾å¼ƒä»Šå¤©ã€‚&quot;,</span><br><span class="line">            &quot;æˆ‘ä»¬çœ‹åˆ°çš„ä»å¾ˆè¿œæ˜Ÿç³»æ¥çš„å…‰æ˜¯åœ¨å‡ ç™¾ä¸‡å¹´ä¹‹å‰å‘å‡ºçš„ï¼Œè¿™æ ·å½“æˆ‘ä»¬çœ‹åˆ°å®‡å®™æ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨çœ‹å®ƒçš„è¿‡å»ã€‚&quot;,</span><br><span class="line">            &quot;å¦‚æœåªç”¨ä¸€ç§æ–¹å¼äº†è§£æŸæ ·äº‹ç‰©ï¼Œä½ å°±ä¸ä¼šçœŸæ­£äº†è§£å®ƒã€‚äº†è§£äº‹ç‰©çœŸæ­£å«ä¹‰çš„ç§˜å¯†å–å†³äºå¦‚ä½•å°†å…¶ä¸æˆ‘ä»¬æ‰€äº†è§£çš„äº‹ç‰©ç›¸è”ç³»ã€‚&quot;]</span><br><span class="line">    # å°†åŸå§‹æ•°æ®è½¬æ¢æˆåˆ†å¥½è¯çš„å½¢å¼</span><br><span class="line">    text_list = []</span><br><span class="line">    for sent in data:</span><br><span class="line">        text_list.append(cut_word(sent))</span><br><span class="line">    print(text_list)</span><br><span class="line"></span><br><span class="line">    # 1ã€å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»</span><br><span class="line">    # transfer = CountVectorizer(sparse=False)</span><br><span class="line">    transfer = TfidfVectorizer(stop_words=[&#x27;ä¸€ç§&#x27;, &#x27;ä¸ä¼š&#x27;, &#x27;ä¸è¦&#x27;])</span><br><span class="line">    # 2ã€è°ƒç”¨fit_transform</span><br><span class="line">    data = transfer.fit_transform(text_list)</span><br><span class="line">    print(&quot;æ–‡æœ¬ç‰¹å¾æŠ½å–çš„ç»“æœï¼š\n&quot;, data.toarray())</span><br><span class="line">    print(&quot;è¿”å›ç‰¹å¾åå­—ï¼š\n&quot;, transfer.get_feature_names())</span><br><span class="line"></span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # 5ã€tfidfæ–‡æœ¬æå–</span><br><span class="line">    text_chinese_tfidf_demo()</span><br></pre></td></tr></table></figure>


<h5 id="âœ…ç‰¹å¾é¢„å¤„ç†"><a href="#âœ…ç‰¹å¾é¢„å¤„ç†" class="headerlink" title="âœ…ç‰¹å¾é¢„å¤„ç†"></a>âœ…ç‰¹å¾é¢„å¤„ç†</h5><p>scikit-learnçš„è§£é‡Šï¼š<br><code>provides several common utility functions and transformer classes to change raw feature vectors into a representation that is more suitable for the downstream estimators.</code><br>ç¿»è¯‘è¿‡æ¥ï¼šé€šè¿‡ä¸€äº›è½¬æ¢å‡½æ•°å°†ç‰¹å¾æ•°æ®è½¬æ¢æˆæ›´åŠ é€‚åˆç®—æ³•æ¨¡å‹çš„ç‰¹å¾æ•°æ®çš„è¿‡ç¨‹</p>
<p>æ•°å€¼å‹æ•°æ®çš„<strong>æ— é‡çº²åŒ–</strong>ï¼š<br>å½’ä¸€åŒ–<br>æ ‡å‡†åŒ–</p>
<p>apiï¼š<br><code>sklearn.preprocessing</code></p>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è¿›è¡Œå½’ä¸€åŒ–&#x2F;æ ‡å‡†åŒ–(æ— é‡çº²åŒ–)ï¼Ÿ<br>ç‰¹å¾çš„å•ä½æˆ–è€…å¤§å°ç›¸å·®è¾ƒå¤§ï¼Œæˆ–è€…æŸç‰¹å¾çš„æ–¹å·®ç›¸æ¯”å…¶ä»–çš„ç‰¹å¾è¦å¤§å‡ºå‡ ä¸ªæ•°é‡çº§ï¼Œå®¹æ˜“å½±å“ï¼ˆæ”¯é…ï¼‰ç›®æ ‡ç»“æœï¼Œä½¿å¾—ä¸€äº›ç®—æ³•æ— æ³•å­¦ä¹ åˆ°å…¶å®ƒçš„ç‰¹å¾ã€‚<br>é‡çº²ä¸ç»Ÿä¸€<br>æ‰€ä»¥ï¼Œéœ€è¦ç”¨åˆ°ä¸€äº›æ–¹æ³•è¿›è¡Œæ— é‡çº²åŒ–ï¼Œä½¿ä¸åŒè§„æ ¼çš„æ•°æ®è½¬æ¢åˆ°åŒä¸€è§„æ ¼ã€‚</p>
<p><strong>å½’ä¸€åŒ–</strong><br>é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œå˜æ¢æŠŠæ•°æ®æ˜ å°„åˆ°(é»˜è®¤ä¸º[0,1])ä¹‹é—´<br>apiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.preprocessing.MinMaxScaler (feature_range=(0,1)â€¦ )</span><br><span class="line">MinMaxScalar.fit_transform(X)</span><br><span class="line">X:numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features]</span><br><span class="line">è¿”å›å€¼ï¼šè½¬æ¢åçš„å½¢çŠ¶ç›¸åŒçš„array</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">from sklearn.preprocessing import MinMaxScaler</span><br><span class="line"></span><br><span class="line">def minmax_demo():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å½’ä¸€åŒ–æ¼”ç¤º</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 0ã€pandasè¯»å–æ–‡æœ¬</span><br><span class="line">    data = pd.read_csv(&quot;dating.txt&quot;)</span><br><span class="line">    # ä¸è¦ç›®æ ‡å€¼æ¯ä¸€è¡Œéƒ½è¦ï¼Œè¦å‰ä¸‰åˆ—</span><br><span class="line">    data = data.iloc[:, :3]</span><br><span class="line">    print(data)</span><br><span class="line">    # 1ã€å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»</span><br><span class="line">    transfer = MinMaxScaler(feature_range=(2, 3))</span><br><span class="line">    # 2ã€è°ƒç”¨fit_transform</span><br><span class="line">    data = transfer.fit_transform(data[[&#x27;milage&#x27;,&#x27;Liters&#x27;,&#x27;Consumtime&#x27;]])</span><br><span class="line">    print(&quot;æœ€å°å€¼æœ€å¤§å€¼å½’ä¸€åŒ–å¤„ç†çš„ç»“æœï¼š\n&quot;, data)</span><br><span class="line"></span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # 6ã€ç‰¹å¾é¢„å¤„ç†-å½’ä¸€åŒ–</span><br><span class="line">    minmax_demo()</span><br></pre></td></tr></table></figure>

<p>å½’ä¸€åŒ–ç¼ºç‚¹ï¼šæœ€å¤§å€¼æœ€å°å€¼æ˜¯å˜åŒ–çš„ï¼Œå¦å¤–ï¼Œæœ€å¤§å€¼ä¸æœ€å°å€¼ï¼ˆå¯èƒ½æ˜¯å¼‚å¸¸å€¼ï¼‰éå¸¸å®¹æ˜“å—å¼‚å¸¸ç‚¹å½±å“ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•é²æ£’æ€§è¾ƒå·®ï¼Œåªé€‚åˆä¼ ç»Ÿç²¾ç¡®å°æ•°æ®åœºæ™¯ã€‚</p>
<p><strong>æ ‡å‡†åŒ–</strong><br>é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œå˜æ¢æŠŠæ•°æ®å˜æ¢åˆ°å‡å€¼ä¸º0,æ ‡å‡†å·®ä¸º1èŒƒå›´å†…<br>å…¬å¼ï¼š<br>(åŸå€¼ - å¹³å‡å€¼) &#x2F; æ ‡å‡†å·®<br>ä¼˜ç‚¹ï¼š<br>å¯¹äºå½’ä¸€åŒ–æ¥è¯´ï¼šå¦‚æœå‡ºç°å¼‚å¸¸ç‚¹ï¼Œå½±å“äº†æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œé‚£ä¹ˆç»“æœæ˜¾ç„¶ä¼šå‘ç”Ÿæ”¹å˜<br>å¯¹äºæ ‡å‡†åŒ–æ¥è¯´ï¼šå¦‚æœå‡ºç°å¼‚å¸¸ç‚¹ï¼Œç”±äºå…·æœ‰ä¸€å®šæ•°æ®é‡ï¼Œå°‘é‡çš„å¼‚å¸¸ç‚¹å¯¹äºå¹³å‡å€¼çš„å½±å“å¹¶ä¸å¤§ï¼Œä»è€Œæ–¹å·®æ”¹å˜è¾ƒå°ã€‚<br>apiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.preprocessing.StandardScaler( )</span><br><span class="line">å¤„ç†ä¹‹åæ¯åˆ—æ¥è¯´æ‰€æœ‰æ•°æ®éƒ½èšé›†åœ¨å‡å€¼0é™„è¿‘æ ‡å‡†å·®å·®ä¸º1</span><br><span class="line">StandardScaler.fit_transform(X)</span><br><span class="line">X:numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features]</span><br><span class="line">è¿”å›å€¼ï¼šè½¬æ¢åçš„å½¢çŠ¶ç›¸åŒçš„array</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">from sklearn.preprocessing import StandardScaler</span><br><span class="line"></span><br><span class="line">def stand_demo():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ ‡å‡†åŒ–æ¼”ç¤º</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = pd.read_csv(&quot;dating.txt&quot;)</span><br><span class="line">    print(data)</span><br><span class="line">    # 1ã€å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»</span><br><span class="line">    transfer = StandardScaler()</span><br><span class="line">    # 2ã€è°ƒç”¨fit_transform</span><br><span class="line">    data = transfer.fit_transform(data[[&#x27;milage&#x27;,&#x27;Liters&#x27;,&#x27;Consumtime&#x27;]])</span><br><span class="line">    print(&quot;æ ‡å‡†åŒ–çš„ç»“æœ:\n&quot;, data)</span><br><span class="line">    print(&quot;æ¯ä¸€åˆ—ç‰¹å¾çš„å¹³å‡å€¼ï¼š\n&quot;, transfer.mean_)</span><br><span class="line">    print(&quot;æ¯ä¸€åˆ—ç‰¹å¾çš„æ–¹å·®ï¼š\n&quot;, transfer.var_)</span><br><span class="line"></span><br><span class="line">    return None</span><br></pre></td></tr></table></figure>
<p>åœ¨å·²æœ‰æ ·æœ¬è¶³å¤Ÿå¤šçš„æƒ…å†µä¸‹æ¯”è¾ƒç¨³å®šï¼Œé€‚åˆç°ä»£å˜ˆæ‚å¤§æ•°æ®åœºæ™¯ã€‚</p>
<h5 id="âœ…ç‰¹å¾é™ç»´"><a href="#âœ…ç‰¹å¾é™ç»´" class="headerlink" title="âœ…ç‰¹å¾é™ç»´"></a>âœ…ç‰¹å¾é™ç»´</h5><p>ndarray<br>ç»´æ•°ï¼šåµŒå¥—çš„å±‚æ•°<br>0ç»´ï¼šæ ‡é‡<br>1ç»´ï¼šå‘é‡<br>2ç»´ï¼šçŸ©é˜µ<br>3ç»´ï¼š</p>
<p>æ­¤å¤„çš„é™ç»´çš„å¯¹è±¡æ˜¯äºŒç»´æ•°ç»„ï¼ˆå‡ è¡Œè¡¨ç¤ºå‡ ä¸ªæ ·æœ¬ï¼Œå‡ åˆ—è¡¨ç¤ºå‡ ä¸ªç‰¹å¾ï¼‰ï¼Œç›®æ ‡æ˜¯<strong>é™ä½ç‰¹å¾çš„ä¸ªæ•°</strong>ã€‚</p>
<p>é™ç»´æ˜¯æŒ‡åœ¨æŸäº›é™å®šæ¡ä»¶ä¸‹ï¼Œé™ä½éšæœºå˜é‡(ç‰¹å¾)ä¸ªæ•°ï¼Œå¾—åˆ°ä¸€ç»„â€œä¸ç›¸å…³â€ä¸»å˜é‡çš„è¿‡ç¨‹ã€‚</p>
<p>ç›¸å…³çš„ç‰¹å¾ï¼šæ¯”å¦‚æ¹¿åº¦ä¸é™é›¨é‡</p>
<p>ä¸ºä»€ä¹ˆè¦ç‰¹å¾é™ç»´ï¼Ÿ<br>æ­£æ˜¯å› ä¸ºåœ¨è¿›è¡Œè®­ç»ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ç‰¹å¾è¿›è¡Œå­¦ä¹ ã€‚å¦‚æœç‰¹å¾æœ¬èº«å­˜åœ¨é—®é¢˜æˆ–è€…ç‰¹å¾ä¹‹é—´ç›¸å…³æ€§è¾ƒå¼ºï¼Œå¯¹äºç®—æ³•å­¦ä¹ é¢„æµ‹ä¼šå½±å“è¾ƒå¤§ã€‚</p>
<p><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼šç‰¹å¾é€‰æ‹©</strong><br>æ•°æ®ä¸­åŒ…å«å†—ä½™æˆ–æ— å…³å˜é‡ï¼ˆæˆ–ç§°ç‰¹å¾ã€å±æ€§ã€æŒ‡æ ‡ç­‰ï¼‰ï¼Œæ—¨åœ¨ä»åŸæœ‰ç‰¹å¾ä¸­æ‰¾å‡ºä¸»è¦ç‰¹å¾ã€‚ï¼ˆä¾‹å¦‚é¸Ÿæ˜¯å¦æœ‰çˆªå­å°±æ˜¯å†—ä½™ç‰¹å¾ï¼‰<br><strong>Filter(è¿‡æ»¤å¼)</strong>ï¼šä¸»è¦æ¢ç©¶ç‰¹å¾æœ¬èº«ç‰¹ç‚¹ã€ç‰¹å¾ä¸ç‰¹å¾å’Œç›®æ ‡å€¼ä¹‹é—´å…³è”<br>æ–¹å·®é€‰æ‹©æ³•ï¼šä½æ–¹å·®ç‰¹å¾è¿‡æ»¤<br>ç›¸å…³ç³»æ•°ï¼šè¡¡é‡æŸä¸¤ä¸ªç‰¹å¾ä¹‹é—´çš„ç›¸å…³ç¨‹åº¦<br><strong>Embedded (åµŒå…¥å¼)</strong>ï¼šç®—æ³•è‡ªåŠ¨é€‰æ‹©ç‰¹å¾ï¼ˆç‰¹å¾ä¸ç›®æ ‡å€¼ä¹‹é—´çš„å…³è”ï¼‰<br>å†³ç­–æ ‘:ä¿¡æ¯ç†µã€ä¿¡æ¯å¢ç›Š<br>æ­£åˆ™åŒ–ï¼šL1ã€L2<br>æ·±åº¦å­¦ä¹ ï¼šå·ç§¯ç­‰</p>
<p>æ¨¡å—ï¼š<br><code>sklearn.feature_selection</code></p>
<p>è¿‡æ»¤å¼ï¼š<br><strong>ä½æ–¹å·®ç‰¹å¾è¿‡æ»¤</strong>ï¼šåˆ é™¤ä½æ–¹å·®çš„ä¸€äº›ç‰¹å¾<br>ç‰¹å¾æ–¹å·®å°ï¼šæŸä¸ªç‰¹å¾å¤§å¤šæ ·æœ¬çš„å€¼æ¯”è¾ƒç›¸è¿‘ï¼Œæ¯”å¦‚éƒ½æ˜¯æœ‰çˆªå­ï¼Œå°±æ˜¯0<br>ç‰¹å¾æ–¹å·®å¤§ï¼šæŸä¸ªç‰¹å¾å¾ˆå¤šæ ·æœ¬çš„å€¼éƒ½æœ‰å·®åˆ«<br>apiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.feature_selection.VarianceThreshold(threshold = 0.0)</span><br><span class="line">åˆ é™¤æ‰€æœ‰ä½æ–¹å·®ç‰¹å¾</span><br><span class="line">Variance.fit_transform(X)</span><br><span class="line">X:numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features]</span><br><span class="line">è¿”å›å€¼ï¼šè®­ç»ƒé›†å·®å¼‚ä½äºthresholdçš„ç‰¹å¾å°†è¢«åˆ é™¤ã€‚é»˜è®¤å€¼æ˜¯ä¿ç•™æ‰€æœ‰éé›¶æ–¹å·®ç‰¹å¾ï¼Œå³åˆ é™¤æ‰€æœ‰æ ·æœ¬ä¸­å…·æœ‰ç›¸åŒå€¼çš„ç‰¹å¾ã€‚</span><br></pre></td></tr></table></figure>

<p>ä½æ–¹å·®ç‰¹å¾è¿‡æ»¤ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def variance_demo():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    åˆ é™¤ä½æ–¹å·®ç‰¹å¾â€”â€”ç‰¹å¾é€‰æ‹©</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = pd.read_csv(&quot;factor_returns.csv&quot;)</span><br><span class="line">    print(data)</span><br><span class="line">    # 1ã€å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»</span><br><span class="line">    transfer = VarianceThreshold(threshold=1)</span><br><span class="line">    # 2ã€è°ƒç”¨fit_transformï¼Œilocå»æ‰ä¸€äº›æ— ç”¨çš„åˆ—</span><br><span class="line">    data = transfer.fit_transform(data.iloc[:, 1:10])</span><br><span class="line">    print(&quot;åˆ é™¤ä½æ–¹å·®ç‰¹å¾çš„ç»“æœï¼š\n&quot;, data)</span><br><span class="line">    print(&quot;å½¢çŠ¶ï¼š\n&quot;, data.shape)</span><br><span class="line"></span><br><span class="line">    return None</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœï¼šå»æ‰äº†ä¸€äº›æ²¡ç”¨çš„å†—ä½™çš„ç‰¹å¾</p>
<p><strong>ç›¸å…³ç³»æ•°</strong>ï¼š<br>çš®å°”é€Šç›¸å…³ç³»æ•°(Pearson Correlation Coefficient)<br>åæ˜ å˜é‡ä¹‹é—´ç›¸å…³å…³ç³»å¯†åˆ‡ç¨‹åº¦çš„ç»Ÿè®¡æŒ‡æ ‡ï¼Œå…¬å¼ç•¥ã€‚<br>ç›¸å…³ç³»æ•°è§£è¯»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç›¸å…³ç³»æ•°çš„å€¼ä»‹äºâ€“1ä¸+1ä¹‹é—´ï¼Œå³â€“1â‰¤ r â‰¤+1ã€‚å…¶æ€§è´¨å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">å½“r&gt;0æ—¶ï¼Œè¡¨ç¤ºä¸¤å˜é‡æ­£ç›¸å…³ï¼Œr&lt;0æ—¶ï¼Œä¸¤å˜é‡ä¸ºè´Ÿç›¸å…³</span><br><span class="line">å½“|r|=1æ—¶ï¼Œè¡¨ç¤ºä¸¤å˜é‡ä¸ºå®Œå…¨ç›¸å…³ï¼Œå½“r=0æ—¶ï¼Œè¡¨ç¤ºä¸¤å˜é‡é—´æ— ç›¸å…³å…³ç³»</span><br><span class="line">å½“0&lt;|r|&lt;1æ—¶ï¼Œè¡¨ç¤ºä¸¤å˜é‡å­˜åœ¨ä¸€å®šç¨‹åº¦çš„ç›¸å…³ã€‚ä¸”|r|è¶Šæ¥è¿‘1ï¼Œä¸¤å˜é‡é—´çº¿æ€§å…³ç³»è¶Šå¯†åˆ‡ï¼›|r|è¶Šæ¥è¿‘äº0ï¼Œè¡¨ç¤ºä¸¤å˜é‡çš„çº¿æ€§ç›¸å…³è¶Šå¼±</span><br><span class="line">ä¸€èˆ¬å¯æŒ‰ä¸‰çº§åˆ’åˆ†ï¼š|r|&lt;0.4ä¸ºä½åº¦ç›¸å…³ï¼›0.4â‰¤|r|&lt;0.7ä¸ºæ˜¾è‘—æ€§ç›¸å…³ï¼›0.7â‰¤|r|&lt;1ä¸ºé«˜åº¦çº¿æ€§ç›¸å…³</span><br></pre></td></tr></table></figure>
<p>api:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from scipy.stats import pearsonr</span><br><span class="line">x : (N,) array_like</span><br><span class="line">y : (N,) array_like Returns: (Pearsonâ€™s correlation coefficient, p-value)</span><br></pre></td></tr></table></figure>

<p>ç›¸å…³ç³»æ•°çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">from scipy.stats import pearsonr</span><br><span class="line"></span><br><span class="line">def pearsonr_demo():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç›¸å…³ç³»æ•°è®¡ç®—</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = pd.read_csv(&quot;factor_returns.csv&quot;)</span><br><span class="line"></span><br><span class="line">    factor = [&#x27;pe_ratio&#x27;, &#x27;pb_ratio&#x27;, &#x27;market_cap&#x27;, &#x27;return_on_asset_net_profit&#x27;, &#x27;du_return_on_equity&#x27;, &#x27;ev&#x27;,</span><br><span class="line">              &#x27;earnings_per_share&#x27;, &#x27;revenue&#x27;, &#x27;total_expense&#x27;]</span><br><span class="line"></span><br><span class="line">    for i in range(len(factor)):</span><br><span class="line">        for j in range(i, len(factor) - 1):</span><br><span class="line">            print(</span><br><span class="line">                &quot;æŒ‡æ ‡%sä¸æŒ‡æ ‡%sä¹‹é—´çš„ç›¸å…³æ€§å¤§å°ä¸º%f&quot; % (factor[i], factor[j + 1], pearsonr(data[factor[i]], data[factor[j + 1]])[0]))</span><br><span class="line"></span><br><span class="line">    return None</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥é€šè¿‡ç”»å›¾æ¥è§‚å¯Ÿç»“æœï¼Œæ•£ç‚¹å›¾ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">plt.figure(figsize=(20, 8), dpi=100)</span><br><span class="line">plt.scatter(data[&#x27;revenue&#x27;], data[&#x27;total_expense&#x27;])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸¤ä¸ªç‰¹å¾ç›¸å…³æ€§å¾ˆé«˜ï¼š<br>1.å¯ä»¥é€‰å–å…¶ä¸­ä¸€ä¸ª<br>2.å¯ä»¥æŒ‰ä¸€å®šæƒé‡åŠ æƒä¸¤ä¸ªç‰¹å¾<br>3.ä¸»æˆåˆ†åˆ†æï¼Œè‡ªåŠ¨å°†ç›¸å…³æ€§å¾ˆå¼ºçš„ç‰¹å¾åˆæˆ</p>
<p><strong>ç¬¬äºŒéƒ¨åˆ†ï¼šä¸»æˆåˆ†åˆ†æ</strong><br>å®šä¹‰ï¼šé«˜ç»´æ•°æ®è½¬åŒ–ä¸ºä½ç»´æ•°æ®çš„è¿‡ç¨‹ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­å¯èƒ½ä¼šèˆå¼ƒåŸæœ‰æ•°æ®ã€åˆ›é€ æ–°çš„å˜é‡ã€‚PCAï¼šä¸»æˆåˆ†åˆ†æ<br>ä½œç”¨ï¼šæ˜¯æ•°æ®ç»´æ•°å‹ç¼©ï¼Œå°½å¯èƒ½é™ä½åŸæ•°æ®çš„ç»´æ•°ï¼ˆå¤æ‚åº¦ï¼‰ï¼ŒæŸå¤±å°‘é‡ä¿¡æ¯ã€‚<br>åº”ç”¨ï¼šå›å½’åˆ†ææˆ–è€…èšç±»åˆ†æå½“ä¸­<br>æŠ½è±¡ç†è§£ï¼šå°†ä¸€ä¸ªä¸‰ç»´çš„ä¸œè¥¿æ‹æˆä¸€ä¸ªäºŒç»´çš„ç…§ç‰‡ï¼Œå°½å¯èƒ½ä¿ç•™æ›´å¤šçš„ä¿¡æ¯ï¼Œä¿æŒåŸæœ‰çš„ç‰¹å¾ã€‚<br>å†æ¯”å¦‚ï¼šäºŒç»´çš„å‡ ä¸ªç‚¹é™åˆ°ä¸€ç»´ï¼ˆä¸€æ¡çº¿ï¼‰ï¼Œæƒ³æŠ•å½±åˆ°ä¸€æ¡çº¿ä¹‹åï¼Œäº”ä¸ªç‚¹ä¹Ÿè¿˜åœ¨ï¼Œä¸”è·ç¦»ç›´æ¥ä¹‹å’Œæ›´å°‘ã€‚æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ç›´çº¿ï¼Œé€šè¿‡ä¸€ä¸ªçŸ©é˜µè¿ç®—å¾—å‡ºä¸»æˆåˆ†åˆ†æçš„ç»“æœã€‚</p>
<p>apiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.decomposition.PCA(n_components=None)</span><br><span class="line">å°†æ•°æ®åˆ†è§£ä¸ºè¾ƒä½ç»´æ•°ç©ºé—´</span><br><span class="line">n_components:</span><br><span class="line">å°æ•°ï¼šè¡¨ç¤ºä¿ç•™ç™¾åˆ†ä¹‹å¤šå°‘çš„ä¿¡æ¯</span><br><span class="line">æ•´æ•°ï¼šå‡å°‘åˆ°å¤šå°‘ç‰¹å¾</span><br><span class="line">PCA.fit_transform(X) X:numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features]</span><br><span class="line">è¿”å›å€¼ï¼šè½¬æ¢åæŒ‡å®šç»´åº¦çš„array</span><br></pre></td></tr></table></figure>

<p>ä¸‰ä¸ªç‰¹å¾é™ç»´çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from sklearn.decomposition import PCA</span><br><span class="line"></span><br><span class="line">def pca_demo():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å¯¹æ•°æ®è¿›è¡ŒPCAé™ç»´</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = [[2,8,4,5], [6,3,0,8], [5,4,9,1]]</span><br><span class="line"></span><br><span class="line">    # 1ã€å®ä¾‹åŒ–PCA, å°æ•°â€”â€”ä¿ç•™å¤šå°‘ä¿¡æ¯</span><br><span class="line">    transfer = PCA(n_components=0.9)</span><br><span class="line">    # 2ã€è°ƒç”¨fit_transform</span><br><span class="line">    data1 = transfer.fit_transform(data)</span><br><span class="line"></span><br><span class="line">    print(&quot;ä¿ç•™90%çš„ä¿¡æ¯ï¼Œé™ç»´ç»“æœä¸ºï¼š\n&quot;, data1)</span><br><span class="line"></span><br><span class="line">    # 1ã€å®ä¾‹åŒ–PCA, æ•´æ•°â€”â€”æŒ‡å®šé™ç»´åˆ°çš„ç»´æ•°</span><br><span class="line">    transfer2 = PCA(n_components=3)</span><br><span class="line">    # 2ã€è°ƒç”¨fit_transform</span><br><span class="line">    data2 = transfer2.fit_transform(data)</span><br><span class="line">    print(&quot;é™ç»´åˆ°3ç»´çš„ç»“æœï¼š\n&quot;, data2)</span><br><span class="line"></span><br><span class="line">    return None</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿ç•™90%çš„ä¿¡æ¯ï¼Œé™ç»´ç»“æœä¸ºï¼š</span><br><span class="line"> [[ -3.13587302e-16   3.82970843e+00]</span><br><span class="line"> [ -5.74456265e+00  -1.91485422e+00]</span><br><span class="line"> [  5.74456265e+00  -1.91485422e+00]]</span><br><span class="line">é™ç»´åˆ°3ç»´çš„ç»“æœï¼š</span><br><span class="line"> [[ -3.13587302e-16   3.82970843e+00   4.59544715e-16]</span><br><span class="line"> [ -5.74456265e+00  -1.91485422e+00   4.59544715e-16]</span><br><span class="line"> [  5.74456265e+00  -1.91485422e+00   4.59544715e-16]]</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ¡ˆä¾‹ï¼šæ¢ç©¶ç”¨æˆ·å¯¹ç‰©å“ç±»åˆ«çš„å–œå¥½ç»†åˆ†é™ç»´</strong></p>
<p>1ï¼‰åˆå¹¶è¡¨ï¼Œä½¿å¾—user_idä¸aisleåœ¨ä¸€å¼ è¡¨å½“ä¸­<br>2ï¼‰è¿›è¡Œäº¤å‰è¡¨å˜æ¢-äº¤å‰è¡¨é€è§†è¡¨<br>3ï¼‰ç‰¹å¾å†—ä½™è¿‡å¤š-PCAé™ç»´</p>
<p>pandaså¯ä»¥è¯»å–csvæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">data = pd.read_csv(â€œ./routeâ€)</span><br><span class="line">table3 = pd.merge(table1, table2, on=[â€œuidâ€, â€œuidâ€]) //ç”¨æ¥åˆå¹¶è¡¨ï¼Œé»˜è®¤å†…è¿æ¥</span><br><span class="line"></span><br><span class="line">3ã€äº¤å‰è¡¨å¤„ç†ï¼ŒæŠŠuser_idå’Œaisleè¿›è¡Œåˆ†ç»„</span><br><span class="line">table = pd.crosstab(tab3[&quot;user_id&quot;], tab3[&quot;aisle&quot;])</span><br><span class="line"></span><br><span class="line">4ã€ä¸»æˆåˆ†åˆ†æçš„æ–¹æ³•è¿›è¡Œé™ç»´</span><br><span class="line"> 1ï¼‰å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»PCA</span><br><span class="line">transfer = PCA(n_components=0.95)</span><br><span class="line"> 2ï¼‰fit_transform</span><br><span class="line">data = transfer.fit_transform(table)</span><br><span class="line"></span><br><span class="line">data.shape</span><br></pre></td></tr></table></figure>
<p>Jupiter å¤„ç†æ•°æ®çš„å·¥å…·ï¼Œå¯è§†åŒ–æ•°æ®ã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><img src="/images/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AD%A6%E4%B9%A0.png"></p>
<h3 id="3-åˆ†ç±»ç®—æ³•"><a href="#3-åˆ†ç±»ç®—æ³•" class="headerlink" title="3.åˆ†ç±»ç®—æ³•"></a>3.åˆ†ç±»ç®—æ³•</h3><p>ç›®æ ‡å€¼ï¼šç±»åˆ«</p>
<h4 id="3-1-sklearnè½¬æ¢å™¨å’Œé¢„ä¼°å™¨-estimator"><a href="#3-1-sklearnè½¬æ¢å™¨å’Œé¢„ä¼°å™¨-estimator" class="headerlink" title="3.1 sklearnè½¬æ¢å™¨å’Œé¢„ä¼°å™¨(estimator)"></a>3.1 sklearnè½¬æ¢å™¨å’Œé¢„ä¼°å™¨(estimator)</h4><p>  3.1.1 è½¬æ¢å™¨-ç‰¹å¾å·¥ç¨‹çš„çˆ¶ç±»<br>    1 å®ä¾‹åŒ–ï¼ˆå®ä¾‹åŒ–çš„æ˜¯ä¸€ä¸ªè½¬æ¢å™¨ç±»ï¼ˆTransformerï¼‰ï¼‰<br>    2 è°ƒç”¨fit_transform æ ‡å‡†åŒ–ï¼Œæ˜¯fitè®¡ç®—æ¯ä¸€åˆ—å¹³å‡å€¼å’Œæ ‡å‡†å·® transformè¿›è¡Œè®¡ç®—è½¬æ¢</p>
<p>  3.1.2 ä¼°è®¡å™¨-sklearnæœºå™¨å­¦ä¹ ç®—æ³•çš„å®ç°<br>    1 å®ä¾‹åŒ–ä¸€ä¸ªeatimator<br>    2 estimator.fit(x_train, y_train) è®¡ç®— â€” è°ƒç”¨å®Œæ¯•ï¼Œæ¨¡å‹ç”Ÿæˆ<br>    3 æ¨¡å‹è¯„ä¼°<br>      1ï¼‰ç›´æ¥å¯¹æ¯”çœŸå®å€¼å’Œé¢„æµ‹å€¼<br>        y_predict &#x3D; estimator.predictor(x_test)<br>        y_test &#x3D; y_predict<br>      2ï¼‰è®¡ç®—å‡†ç¡®ç‡<br>	  accuracy &#x3D; estimator.score(x_test, y_test)</p>
<h4 id="3-2-K-è¿‘é‚»ç®—æ³•-KNNç®—æ³•"><a href="#3-2-K-è¿‘é‚»ç®—æ³•-KNNç®—æ³•" class="headerlink" title="3.2 K-è¿‘é‚»ç®—æ³•(KNNç®—æ³•)"></a>3.2 K-è¿‘é‚»ç®—æ³•(KNNç®—æ³•)</h4><p>  æ ¸å¿ƒæ€æƒ³ï¼šæ ¹æ®é‚»å±…æ¥æ¨æ–­å‡ºç±»åˆ«<br>  3.2.1 KNNç®—æ³•åŸç†<br>     å¦‚æœä¸€ä¸ªæ ·æœ¬åœ¨ç‰¹å¾ç©ºé—´ä¸­çš„kä¸ªæœ€ç›¸ä¼¼(å³ç‰¹å¾ç©ºé—´ä¸­æœ€é‚»è¿‘)çš„æ ·æœ¬ä¸­çš„å¤§å¤šæ•°å±äºæŸä¸€ä¸ªç±»åˆ«ï¼Œåˆ™è¯¥æ ·æœ¬ä¹Ÿå±äºè¿™ä¸ªç±»åˆ«ã€‚<br>    k&#x3D;1 å®¹æ˜“æ”¶åˆ°å¼‚å¸¸ç‚¹çš„å½±å“<br>    å¦‚ä½•ç¡®å®šè°æ˜¯é‚»å±…ï¼Œè®¡ç®—è·ç¦» egï¼šæ¬§æ°è·ç¦»ï¼ˆé»˜è®¤ï¼‰ï¼Œæ›¼å“ˆé¡¿è·ç¦»ï¼ˆç»å¯¹å€¼è·ç¦»ï¼‰ï¼Œæ˜å¯å¤«æ–¯åŸºè·ç¦»<br>    ä¾‹å­ï¼šç”µå½±åˆ†ç±»ï¼šå…ˆæ±‚è·ç¦»ï¼Œå†å–kã€‚<br>    Kå€¼å–å¾—è¿‡å¤§ï¼šå®¹æ˜“æ”¶åˆ°æ ·æœ¬ä¸å‡è¡¡çš„å½±å“ã€‚</p>
<p>  3.2.2 k-è¿‘é‚»ç®—æ³•api</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.neighbors.KNeighborsClassifier(n_neighbors=5,algorithm=&#x27;auto&#x27;)</span><br><span class="line">	â—¦	n_neighborsï¼škå€¼ï¼Œint,å¯é€‰ï¼ˆé»˜è®¤= 5ï¼‰ï¼Œk_neighborsæŸ¥è¯¢é»˜è®¤ä½¿ç”¨çš„é‚»å±…æ•°</span><br><span class="line">	â—¦	algorithmï¼š&#123;â€˜autoâ€™ï¼Œâ€˜ball_treeâ€™ï¼Œâ€˜kd_treeâ€™ï¼Œâ€˜bruteâ€™&#125;ï¼Œå¯é€‰ç”¨äºè®¡ç®—æœ€è¿‘é‚»å±…çš„ç®—æ³•ï¼šâ€˜ball_treeâ€™å°†ä¼šä½¿ç”¨ BallTreeï¼Œâ€˜kd_treeâ€™å°†ä½¿ç”¨ KDTreeã€‚â€˜autoâ€™å°†å°è¯•æ ¹æ®ä¼ é€’ç»™fitæ–¹æ³•çš„å€¼æ¥å†³å®šæœ€åˆé€‚çš„ç®—æ³•ã€‚ (ä¸åŒå®ç°æ–¹å¼å½±å“æ•ˆç‡)</span><br></pre></td></tr></table></figure>

<p>  3.2.3 æ¡ˆä¾‹ï¼šé¸¢å°¾èŠ±ç§ç±»é¢„æµ‹<br>    1ï¼‰è·å–æ•°æ®ï¼Œå››ä¸ªç‰¹å¾<br>    2ï¼‰æ•°æ®é›†åˆ’åˆ†<br>    3ï¼‰ç‰¹å¾å·¥ç¨‹ï¼šæ ‡å‡†åŒ–<br>    4ï¼‰KNNé¢„ä¼°å™¨æµç¨‹<br>    5ï¼‰æ¨¡å‹è¯„ä¼°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from sklearn.datasets import load_iris</span><br><span class="line">from sklearn.model_selection import train_test_split</span><br><span class="line">from sklearn.preprocessing import StandardScaler</span><br><span class="line">from sklearn.neighbors import KNeighborsClassifier</span><br><span class="line"></span><br><span class="line">def knn_iris():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ¡ˆä¾‹ï¼šé¸¢å°¾èŠ±ç§ç±»é¢„æµ‹</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 1ï¼‰è·å–æ•°æ®ï¼Œå››ä¸ªç‰¹å¾</span><br><span class="line">    iris = load_iris()</span><br><span class="line">    # 2ï¼‰æ•°æ®é›†åˆ’åˆ†</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=6)</span><br><span class="line">    # 3ï¼‰ç‰¹å¾å·¥ç¨‹ï¼šæ ‡å‡†åŒ– 1.å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±» 2.å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ ‡å‡†åŒ–ï¼ˆæµ‹è¯•é›†ç”¨è®­ç»ƒé›†fitçš„ç»“æœï¼‰</span><br><span class="line">    transform = StandardScaler()</span><br><span class="line">    x_train = transform.fit_transform(x_train)</span><br><span class="line">    x_test = transform.transform(x_test)</span><br><span class="line">    # 4ï¼‰KNNé¢„ä¼°å™¨æµç¨‹ï¼š1.å®ä¾‹åŒ–ä¸€ä¸ªé¢„ä¼°å™¨å¯¹è±¡ 2.å°†è®­ç»ƒé›†çš„ç‰¹å¾å€¼å’Œç›®æ ‡å€¼ä¼ å…¥è¿›è¡Œè®­ç»ƒ</span><br><span class="line">    estimator = KNeighborsClassifier(n_neighbors=3)</span><br><span class="line">    estimator.fit(x_train, y_train)</span><br><span class="line">    # 5ï¼‰æ¨¡å‹è¯„ä¼°  1.ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„ä¼°å€¼ 2.è®¡ç®—å‡†ç¡®ç‡</span><br><span class="line">    y_predict = estimator.predict(x_test)</span><br><span class="line">    print(&quot;y_predict:\n&quot;, y_predict)</span><br><span class="line">    print(&quot;é¢„æµ‹å€¼å’ŒçœŸå®å€¼:\n&quot;, y_predict == y_test)</span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line">    print(&quot;score:\n&quot;, score)</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # ä»£ç 1.knnç®—æ³•å¯¹irisè¿›è¡Œåˆ†ç±»</span><br><span class="line">    knn_iris()</span><br></pre></td></tr></table></figure>

<p>  3.2.4 knnä¼˜ç¼ºç‚¹<br>	â€¢	ä¼˜ç‚¹ï¼š<br>	â—¦	ç®€å•ï¼Œæ˜“äºç†è§£ï¼Œæ˜“äºå®ç°ï¼Œæ— éœ€è®­ç»ƒ<br>	â€¢	ç¼ºç‚¹ï¼š<br>	â—¦	æ‡’æƒ°ç®—æ³•ï¼Œå¯¹æµ‹è¯•æ ·æœ¬åˆ†ç±»æ—¶çš„è®¡ç®—é‡å¤§ï¼Œå†…å­˜å¼€é”€å¤§<br>	â—¦	å¿…é¡»æŒ‡å®šKå€¼ï¼ŒKå€¼é€‰æ‹©ä¸å½“åˆ™åˆ†ç±»ç²¾åº¦ä¸èƒ½ä¿è¯<br>	â€¢	ä½¿ç”¨åœºæ™¯ï¼šå°æ•°æ®åœºæ™¯ï¼Œå‡ åƒï½å‡ ä¸‡æ ·æœ¬ï¼Œå…·ä½“åœºæ™¯å…·ä½“ä¸šåŠ¡å»æµ‹è¯•</p>
<h4 id="3-3-æ¨¡å‹é€‰æ‹©ä¸è°ƒä¼˜"><a href="#3-3-æ¨¡å‹é€‰æ‹©ä¸è°ƒä¼˜" class="headerlink" title="3.3 æ¨¡å‹é€‰æ‹©ä¸è°ƒä¼˜"></a>3.3 æ¨¡å‹é€‰æ‹©ä¸è°ƒä¼˜</h4><p>  3.3.1 ä»€ä¹ˆæ˜¯äº¤å‰éªŒè¯<br>äº¤å‰éªŒè¯ï¼šå°†æ‹¿åˆ°çš„è®­ç»ƒæ•°æ®ï¼Œåˆ†ä¸ºè®­ç»ƒå’ŒéªŒè¯é›†ã€‚ä¾‹å¦‚ï¼šå°†æ•°æ®åˆ†æˆ5ä»½ï¼Œå…¶ä¸­ä¸€ä»½ä½œä¸ºéªŒè¯é›†ã€‚ç„¶åç»è¿‡5æ¬¡(ç»„)çš„æµ‹è¯•ï¼Œæ¯æ¬¡éƒ½æ›´æ¢ä¸åŒçš„éªŒè¯é›†ã€‚å³å¾—åˆ°5ç»„æ¨¡å‹çš„ç»“æœï¼Œå–å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆç»“æœã€‚åˆç§°5æŠ˜äº¤å‰éªŒè¯ã€‚ç›®çš„ï¼šè®©è¢«è¯„ä¼°çš„æ¨¡å‹æ›´åŠ å‡†ç¡®å¯ä¿¡<br>  â€¢	è®­ç»ƒé›†ï¼šè®­ç»ƒé›†+éªŒè¯é›†<br>	â€¢	æµ‹è¯•é›†ï¼šæµ‹è¯•é›†</p>
<p>  3.3.2 è¶…å‚æ•°æœç´¢-ç½‘æ ¼æœç´¢<br>  é€šå¸¸æƒ…å†µä¸‹ï¼Œæœ‰å¾ˆå¤šå‚æ•°æ˜¯éœ€è¦æ‰‹åŠ¨æŒ‡å®šçš„ï¼ˆå¦‚k-è¿‘é‚»ç®—æ³•ä¸­çš„Kå€¼ï¼‰ï¼Œè¿™ç§å«è¶…å‚æ•°ã€‚ä½†æ˜¯æ‰‹åŠ¨è¿‡ç¨‹ç¹æ‚ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ¨¡å‹é¢„è®¾å‡ ç§è¶…å‚æ•°ç»„åˆã€‚æ¯ç»„è¶…å‚æ•°éƒ½é‡‡ç”¨äº¤å‰éªŒè¯æ¥è¿›è¡Œè¯„ä¼°ã€‚æœ€åé€‰å‡ºæœ€ä¼˜å‚æ•°ç»„åˆå»ºç«‹æ¨¡å‹</p>
<p>  3.3.3 æ¨¡å‹é€‰æ‹©ä¸è°ƒä¼˜api</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.model_selection.GridSearchCV(estimator, param_grid=None,cv=None)</span><br><span class="line">â—¦	å¯¹ä¼°è®¡å™¨çš„æŒ‡å®šå‚æ•°å€¼è¿›è¡Œè¯¦å°½æœç´¢</span><br><span class="line">â—¦	estimatorï¼šä¼°è®¡å™¨å¯¹è±¡</span><br><span class="line">â—¦	param_gridï¼šä¼°è®¡å™¨å‚æ•°(dict)&#123;â€œn_neighborsâ€:[1,3,5]&#125;ï¼Œå°†æƒ³è¦ç”¨çš„å‚æ•°å€¼ä»¥å­—å…¸æ ¼å¼ä¼ å…¥</span><br><span class="line">â—¦	cvï¼šæŒ‡å®šå‡ æŠ˜äº¤å‰éªŒè¯ï¼Œå¸¸ç”¨10æŠ˜</span><br><span class="line">â—¦	fitï¼šè¾“å…¥è®­ç»ƒæ•°æ®</span><br><span class="line">â—¦	scoreï¼šå‡†ç¡®ç‡</span><br><span class="line">â—¦	ç»“æœåˆ†æï¼š</span><br><span class="line">â–ª	best_paramï¼šæœ€ä½³å‚æ•°</span><br><span class="line">â–ª	bestscoreï¼šæœ€ä½³ç»“æœ</span><br><span class="line">â–ª	best_estimatorï¼šæœ€ä½³ä¼°è®¡å™¨</span><br><span class="line">â–ª	cv_resultsï¼šäº¤å‰éªŒè¯ç»“æœ-æ¯æ¬¡äº¤å‰éªŒè¯åçš„éªŒè¯é›†å‡†ç¡®ç‡ç»“æœå’Œè®­ç»ƒé›†å‡†ç¡®ç‡ç»“æœ</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def knn_iris_gscv():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ¡ˆä¾‹ï¼šé¸¢å°¾èŠ±ç§ç±»é¢„æµ‹knn,æ·»åŠ ç½‘æ ¼æœç´¢å’Œäº¤å‰éªŒè¯</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 1ï¼‰è·å–æ•°æ®ï¼Œå››ä¸ªç‰¹å¾</span><br><span class="line">    iris = load_iris()</span><br><span class="line">    # 2ï¼‰æ•°æ®é›†åˆ’åˆ†</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=6)</span><br><span class="line">    # 3ï¼‰ç‰¹å¾å·¥ç¨‹ï¼šæ ‡å‡†åŒ– 1.å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±» 2.å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ ‡å‡†åŒ–ï¼ˆæµ‹è¯•é›†ç”¨è®­ç»ƒé›†fitçš„ç»“æœï¼‰</span><br><span class="line">    transform = StandardScaler()</span><br><span class="line">    x_train = transform.fit_transform(x_train)</span><br><span class="line">    x_test = transform.transform(x_test)</span><br><span class="line">    # 4ï¼‰KNNé¢„ä¼°å™¨æµç¨‹ï¼š1.å®ä¾‹åŒ–ä¸€ä¸ªé¢„ä¼°å™¨å¯¹è±¡ 2.å°†è®­ç»ƒé›†çš„ç‰¹å¾å€¼å’Œç›®æ ‡å€¼ä¼ å…¥è¿›è¡Œè®­ç»ƒ</span><br><span class="line">    estimator = KNeighborsClassifier()</span><br><span class="line">    # åŠ å…¥ç½‘æ ¼æœç´¢å’Œäº¤å‰éªŒè¯</span><br><span class="line">    # å‚æ•°å‡†å¤‡</span><br><span class="line">    param_dict = &#123;&quot;n_neighbors&quot;: [3, 5, 10]&#125;</span><br><span class="line">    estimator = GridSearchCV(estimator, param_grid=param_dict, cv=10)</span><br><span class="line">    estimator.fit(x_train, y_train)</span><br><span class="line">    # 5ï¼‰æ¨¡å‹è¯„ä¼°  1.ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„ä¼°å€¼ 2.è®¡ç®—å‡†ç¡®ç‡</span><br><span class="line">    y_predict = estimator.predict(x_test)</span><br><span class="line">    print(&quot;y_predict:\n&quot;, y_predict)</span><br><span class="line">    print(&quot;é¢„æµ‹å€¼å’ŒçœŸå®å€¼:\n&quot;, y_predict == y_test)</span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line">    print(&quot;score:\n&quot;, score)  # æµ‹è¯•é›†çš„ç»“æœ</span><br><span class="line">    print(&quot;æœ€ä½³å‚æ•°:\n&quot;, estimator.best_params_)</span><br><span class="line">    print(&quot;æœ€ä½³ç»“æœ:\n&quot;, estimator.best_score_)  # éªŒè¯é›†çš„ç»“æœ</span><br><span class="line">    print(&quot;æœ€ä½³ä¼°è®¡å™¨:\n&quot;, estimator.best_estimator_)</span><br><span class="line">    print(&quot;äº¤å‰éªŒè¯ç»“æœ:\n&quot;, estimator.cv_results_)</span><br><span class="line">    return None</span><br></pre></td></tr></table></figure>


<p>  3.3.4 æ¡ˆä¾‹-Facebookç­¾åˆ°ä½ç½®é¢„æµ‹Kå€¼è°ƒä¼˜</p>
<pre><code>å¤„ç†æ•°æ®ï¼Œåå¤è°ƒè¯•ï¼Œå¦‚æœç”¨pycharmï¼Œæ¯æ¬¡è°ƒè¯•éƒ½è¦åŠ è½½ä¸€æ¬¡ã€‚æ‰€ä»¥ç”¨jupyterã€‚

æµç¨‹ï¼š
  1ï¼‰è·å–æ•°æ®
  2ï¼‰æ•°æ®å¤„ç†ï¼šè¿‡æ»¤æ— ç”¨æ•°æ®ï¼Œç­›é€‰ç‰¹å¾å€¼xå’Œç›®æ ‡å€¼yï¼Œæ•°æ®é›†åˆ’åˆ†
</code></pre>
<p><code>data.head() data=data.query(â€œx&lt;2 &amp; x&gt;1â€)</code><br><code>å¤„ç†æ—¶é—´æ•°æ®ï¼štime_value = pd.to_data_time(data[â€œtimeâ€], unit=â€œsâ€)  date = pd.DateTimeIndex(time_value)</code><br><code>å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼š data.groupby(â€œplaceâ€).count()</code><br>      3ï¼‰ç‰¹å¾å·¥ç¨‹ï¼šæ ‡å‡†åŒ–<br>      4ï¼‰KNNç®—æ³•é¢„ä¼°æµç¨‹<br>      5ï¼‰æ¨¡å‹é€‰æ‹©ä¸è°ƒä¼˜<br>      6ï¼‰æ¨¡å‹è¯„ä¼°</p>
<h4 id="3-4-æœ´ç´ è´å¶æ–¯ç®—æ³•"><a href="#3-4-æœ´ç´ è´å¶æ–¯ç®—æ³•" class="headerlink" title="3.4 æœ´ç´ è´å¶æ–¯ç®—æ³•"></a>3.4 æœ´ç´ è´å¶æ–¯ç®—æ³•</h4><p>3.4.1 ä»€ä¹ˆæ˜¯æœ´ç´ è´å¶æ–¯ç®—æ³•ï¼š<br>ç»™å‡ºåˆ†ç±»äº‹ä»¶æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚</p>
<p>â€¢	è”åˆæ¦‚ç‡ï¼šåŒ…å«å¤šä¸ªæ¡ä»¶ï¼Œä¸”æ‰€æœ‰æ¡ä»¶åŒæ—¶æˆç«‹çš„æ¦‚ç‡<br>â—¦	è®°ä½œï¼šP(A,B)<br>â—¦	ç‰¹æ€§ï¼šP(A, B) &#x3D; P(A)P(B) &lt;&#x3D;&gt; äº‹ä»¶ABç›¸äº’ç‹¬ç«‹<br>â€¢	æ¡ä»¶æ¦‚ç‡ï¼šå°±æ˜¯äº‹ä»¶Aåœ¨å¦å¤–ä¸€ä¸ªäº‹ä»¶Bå·²ç»å‘ç”Ÿæ¡ä»¶ä¸‹çš„å‘ç”Ÿæ¦‚ç‡<br>â—¦	è®°ä½œï¼šP(A|B)</p>
<p>è´å¶æ–¯å…¬å¼ï¼š<code>p(c|w) = [p(w|c)p(c)]/p(w)</code>ã€‚wä¸ºç‰¹å¾å€¼ï¼Œcä¸ºç›®æ ‡å€¼ã€‚</p>
<p>æœ´ç´ æ˜¯ä»€ä¹ˆï¼šå‡å®šç‰¹å¾ä¸ç‰¹å¾ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šæ–‡æœ¬åˆ†ç±»(å•è¯ä½œä¸ºç‰¹å¾ï¼Œå‡è®¾ç›¸äº’ç‹¬ç«‹) </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">P(C)ï¼šæ¯ä¸ªæ–‡æ¡£ç±»åˆ«çš„æ¦‚ç‡(æŸæ–‡æ¡£ç±»åˆ«æ•°ï¼æ€»æ–‡æ¡£æ•°é‡)</span><br><span class="line">P(Wâ”‚C)ï¼šç»™å®šç±»åˆ«ä¸‹ç‰¹å¾ï¼ˆè¢«é¢„æµ‹æ–‡æ¡£ä¸­å‡ºç°çš„è¯ï¼‰çš„æ¦‚ç‡ï¼ˆæŸç±»åˆ«è¯1æ•°é‡/æŸç±»åˆ«æ‰€æœ‰æ¬¡æ•°é‡ï¼‰</span><br><span class="line">è®¡ç®—æ–¹æ³•ï¼šP(F1â”‚C)=Ni/N ï¼ˆè®­ç»ƒæ–‡æ¡£ä¸­å»è®¡ç®—ï¼‰</span><br><span class="line">Niä¸ºè¯¥F1è¯åœ¨Cç±»åˆ«æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°</span><br><span class="line">Nä¸ºæ‰€å±ç±»åˆ«Cä¸‹çš„æ–‡æ¡£æ‰€æœ‰è¯å‡ºç°çš„æ¬¡æ•°å’Œ</span><br><span class="line">P(F1,F2,â€¦) é¢„æµ‹æ–‡æ¡£ä¸­æ¯ä¸ªè¯çš„æ¦‚ç‡</span><br></pre></td></tr></table></figure>

<p>è®¡ç®—å‡ºæ¥æŸä¸ªæ¦‚ç‡ä¸º0ï¼Œæ€ä¹ˆåŠï¼Ÿ<br>æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ç³»:  <code>p(w|c) = (ni+a)/(n+am)</code><br>ç›®çš„ï¼šé˜²æ­¢è®¡ç®—å‡ºçš„åˆ†ç±»æ¦‚ç‡ä¸º0<br>aä¸ºæŒ‡å®šçš„ç³»æ•°ä¸€èˆ¬ä¸º1ï¼Œmä¸ºè®­ç»ƒæ–‡æ¡£ä¸­ç»Ÿè®¡å‡ºçš„ç‰¹å¾è¯æœ‰å¤šå°‘ç§</p>
<p>3.4.2 æœ´ç´ è´å¶æ–¯api</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.naive_bayes.MultinomialNB(alpha = 1.0)</span><br><span class="line">æœ´ç´ è´å¶æ–¯åˆ†ç±»</span><br><span class="line">alphaï¼šæ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ç³»æ•°</span><br></pre></td></tr></table></figure>

<p>3.4.3 æ¡ˆä¾‹ï¼š20ç±»æ–°é—»åˆ†ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def nbcls():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æœ´ç´ è´å¶æ–¯å¯¹æ–°é—»æ•°æ®é›†è¿›è¡Œé¢„æµ‹</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # è·å–æ–°é—»çš„æ•°æ®ï¼Œ20ä¸ªç±»åˆ«</span><br><span class="line">    news = fetch_20newsgroups(data_home=&#x27;/Users/liuxuan/MyProject/pypro/python-learn&#x27;, subset=&#x27;all&#x27;)</span><br><span class="line">    # åˆ’åˆ†æ•°æ®é›†</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(news.data, news.target, test_size=0.3)</span><br><span class="line">    # å¯¹äºæ–‡æœ¬æ•°æ®ï¼Œè¿›è¡Œç‰¹å¾æŠ½å– 1.è·å–å®ä¾‹åŒ–å¯¹è±¡ 2.è½¬æ¢</span><br><span class="line">    tf = TfidfVectorizer()</span><br><span class="line">    x_train = tf.fit_transform(x_train)</span><br><span class="line">    # è¿™é‡Œæ‰“å°å‡ºæ¥çš„åˆ—è¡¨æ˜¯ï¼šè®­ç»ƒé›†å½“ä¸­çš„æ‰€æœ‰ä¸åŒè¯çš„ç»„æˆçš„ä¸€ä¸ªåˆ—è¡¨</span><br><span class="line">    print(tf.get_feature_names())</span><br><span class="line">    # print(x_train.toarray())</span><br><span class="line">    # ä¸èƒ½è°ƒç”¨fit_transform</span><br><span class="line">    x_test = tf.transform(x_test)</span><br><span class="line">    # estimatorä¼°è®¡å™¨æµç¨‹,å¹¶è®­ç»ƒ</span><br><span class="line">    mlb = MultinomialNB(alpha=1.0)</span><br><span class="line">    mlb.fit(x_train, y_train)</span><br><span class="line">    # è¿›è¡Œé¢„æµ‹ï¼ŒéªŒè¯</span><br><span class="line">    y_predict = mlb.predict(x_test)</span><br><span class="line">    print(&quot;é¢„æµ‹æ¯ç¯‡æ–‡ç« çš„ç±»åˆ«ï¼š&quot;, y_predict[:100])</span><br><span class="line">    print(&quot;çœŸå®ç±»åˆ«ä¸ºï¼š&quot;, y_test[:100])</span><br><span class="line">    print(&quot;é¢„æµ‹å‡†ç¡®ç‡ä¸ºï¼š&quot;, mlb.score(x_test, y_test))</span><br><span class="line">    return None</span><br></pre></td></tr></table></figure>

<p>3.4.4 ä¼˜ç¼ºç‚¹<br>ä¼˜ç‚¹ï¼š<br>æœ´ç´ è´å¶æ–¯æ¨¡å‹å‘æºäºå¤å…¸æ•°å­¦ç†è®ºï¼Œæœ‰ç¨³å®šçš„åˆ†ç±»æ•ˆç‡ã€‚<br>å¯¹ç¼ºå¤±æ•°æ®ä¸å¤ªæ•æ„Ÿï¼Œç®—æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¸¸ç”¨äºæ–‡æœ¬åˆ†ç±»ã€‚<br>åˆ†ç±»å‡†ç¡®åº¦é«˜ï¼Œé€Ÿåº¦å¿«<br>ç¼ºç‚¹ï¼š<br>ç”±äºä½¿ç”¨äº†æ ·æœ¬å±æ€§ç‹¬ç«‹æ€§çš„å‡è®¾ï¼Œæ‰€ä»¥å¦‚æœç‰¹å¾å±æ€§æœ‰å…³è”æ—¶å…¶æ•ˆæœä¸å¥½</p>
<h4 id="3-5-å†³ç­–æ ‘"><a href="#3-5-å†³ç­–æ ‘" class="headerlink" title="3.5 å†³ç­–æ ‘"></a>3.5 å†³ç­–æ ‘</h4><p>å†³ç­–æ ‘æ€æƒ³çš„æ¥æºéå¸¸æœ´ç´ ï¼Œç¨‹åºè®¾è®¡ä¸­çš„æ¡ä»¶åˆ†æ”¯ç»“æ„å°±æ˜¯if-thenç»“æ„ï¼Œæœ€æ—©çš„å†³ç­–æ ‘å°±æ˜¯åˆ©ç”¨è¿™ç±»ç»“æ„åˆ†å‰²æ•°æ®çš„ä¸€ç§åˆ†ç±»å­¦ä¹ æ–¹æ³•<br>æ€æƒ³ï¼šå¦‚ä½•é«˜æ•ˆåœ°è¿›è¡Œå†³ç­–ï¼Œå…ˆçœ‹å“ªä¸ªå†çœ‹å“ªä¸ªï¼Œå†³å®šç‰¹å¾çš„å…ˆåé¡ºåºã€‚</p>
<p>3.5.1 å†³ç­–æ ‘åˆ†ç±»åŸç†<br>ç”¨æ•°å­¦çš„æ–¹æ³•æ¥å¾—åˆ°ï¼Œåº”è¯¥å…ˆçœ‹å“ªä¸ªç‰¹å¾å†çœ‹å“ªä¸ªç‰¹å¾ã€‚<br>ä¿¡æ¯è®ºåŸºç¡€<br>ä¿¡æ¯ï¼šæ¶ˆé™¤éšæœºä¸å®šæ€§çš„ä¸œè¥¿<br>ä¿¡æ¯çš„è¡¡é‡ - ä¿¡æ¯é‡ - ä¿¡æ¯å¢’<br>pä¸ºæ¯ä¸ªçƒé˜Ÿè·èƒœçš„æ¦‚ç‡ï¼ˆå‡è®¾æ¦‚ç‡ç›¸ç­‰ï¼Œéƒ½ä¸º1&#x2F;32ï¼‰<br>ä¿¡æ¯å¢’ H &#x3D; -(p1logp1 + p2logp2 + â€¦ + p32logp32)&#x3D;5bit<br>å†³ç­–æ ‘çš„åˆ’åˆ†ä¾æ®ä¹‹ä¸€â€”â€”ä¿¡æ¯å¢ç›Š<br>ä¿¡æ¯å¢ç›Šï¼šç‰¹å¾Aå¯¹è®­ç»ƒæ•°æ®é›†Dçš„ä¿¡æ¯å¢ç›Šg(D,A),å®šä¹‰ä¸ºé›†åˆDçš„ä¿¡æ¯ç†µH(D)ä¸ç‰¹å¾Aç»™å®šæ¡ä»¶ä¸‹Dçš„ä¿¡æ¯æ¡ä»¶ç†µH(D|A)ä¹‹å·®<br>ï¼ˆçŸ¥é“å“ªä¸ªç‰¹å¾ä¹‹åï¼Œä¸ç¡®å®šæ€§å‡å°‘çš„é‡ï¼‰<br><code>g(D,A)= H(D) - æ¡ä»¶å¢’H(D|A)</code><br>æ¡ä»¶å¢’æ€ä¹ˆç®—ï¼šç‰¹å¾Aæœ‰å¤šå°‘ç§ï¼Œæ¯ç§åˆ†åˆ«è®¡ç®—ä¿¡æ¯å¢’ï¼Œç„¶åæ ¹æ®æ ·æœ¬ç‰¹å¾ç±»ç§ç±»æ¯”ä¾‹ç´¯åŠ ã€‚</p>
<p>3.5.2 å†³ç­–æ ‘api</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â€¢	class sklearn.tree.DecisionTreeClassifier(criterion=â€™giniâ€™, max_depth=None,random_state=None)</span><br><span class="line">â—¦	å†³ç­–æ ‘åˆ†ç±»å™¨</span><br><span class="line">â—¦	criterion:é»˜è®¤æ˜¯â€™giniâ€™ç³»æ•°ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¿¡æ¯å¢ç›Šçš„ç†µâ€™entropyâ€™</span><br><span class="line">â—¦	max_depth:æ ‘çš„æ·±åº¦å¤§å°ï¼Œå¤ªæ·±å®¹æ˜“è¿‡æ‹Ÿåˆ</span><br><span class="line">â—¦	random_state:éšæœºæ•°ç§å­</span><br><span class="line">â€¢	å…¶ä¸­ä¼šæœ‰äº›è¶…å‚æ•°ï¼šmax_depth:æ ‘çš„æ·±åº¦å¤§å°</span><br><span class="line">â—¦	å…¶å®ƒè¶…å‚æ•°æˆ‘ä»¬ä¼šç»“åˆéšæœºæ£®æ—è®²è§£</span><br></pre></td></tr></table></figure>
<p>æ­¥éª¤ï¼š<br>1ï¼‰è·å–æ•°æ®é›†<br>2ï¼‰åˆ’åˆ†æ•°æ®é›†ï¼Œå†³ç­–æ ‘ä¸ç”¨åšæ ‡å‡†åŒ–<br>3ï¼‰å†³ç­–æ ‘é¢„ä¼°å™¨è¿›è¡Œåˆ†ç±»<br>4ï¼‰æ¨¡å‹è¯„ä¼°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def decision_iris():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç”¨å†³ç­–æ ‘å¯¹é¸¢å°¾èŠ±è¿›è¡Œåˆ†ç±»</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 1ï¼‰è·å–æ•°æ®é›†</span><br><span class="line">    iris = load_iris()</span><br><span class="line">    # 2ï¼‰åˆ’åˆ†æ•°æ®é›†ï¼Œå†³ç­–æ ‘ä¸ç”¨åšæ ‡å‡†åŒ–</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=6)</span><br><span class="line">    # 3ï¼‰å†³ç­–æ ‘é¢„ä¼°å™¨è¿›è¡Œåˆ†ç±»</span><br><span class="line">    estimator = DecisionTreeClassifier(criterion=&#x27;entropy&#x27;)</span><br><span class="line">    estimator.fit(x_train,y_train)</span><br><span class="line">    # 4ï¼‰æ¨¡å‹è¯„ä¼°</span><br><span class="line">    y_predict = estimator.predict(x_test)</span><br><span class="line">    print(&quot;y_predict:\n&quot;, y_predict)</span><br><span class="line">    print(&quot;é¢„æµ‹å€¼å’ŒçœŸå®å€¼:\n&quot;, y_predict == y_test)</span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line">    print(&quot;score:\n&quot;, score)</span><br></pre></td></tr></table></figure>

<p>3.5.3 å†³ç­–æ ‘å¯è§†åŒ–</p>
<p>1.ä¿å­˜æ ‘çš„ç»“æ„åˆ°dotæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1ã€sklearn.tree.export_graphviz() è¯¥å‡½æ•°èƒ½å¤Ÿå¯¼å‡ºDOTæ ¼å¼</span><br><span class="line">	â—¦tree.export_graphviz(estimator,out_file=&#x27;tree.dotâ€™,feature_names=[â€˜â€™,â€™â€™])</span><br><span class="line">2ã€å¤åˆ¶æ–‡ä»¶å†…å®¹åˆ°ç½‘ç«™ï¼šhttp://www.webgraphviz.com</span><br><span class="line"></span><br><span class="line"> å¯è§†åŒ–å†³ç­–æ ‘</span><br><span class="line">export_graphviz(estimator, out_file=&#x27;iris_tree.dot&#x27;)</span><br></pre></td></tr></table></figure>

<p>3.5.4 å†³ç­–æ ‘ä¼˜ç¼ºç‚¹<br>	â€¢	ä¼˜ç‚¹ï¼š<br>	â—¦	ç®€å•çš„ç†è§£å’Œè§£é‡Šï¼Œæ ‘æœ¨å¯è§†åŒ–ã€‚å¯ç†è§£æ€§å¼ºï¼Œåè§‚ç¥ç»ç½‘ç»œæ˜¯ä¸ªé»‘ç›’ã€‚<br>	â€¢	ç¼ºç‚¹ï¼š<br>	â—¦	å®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆã€‚<br>	â€¢	æ”¹è¿›ï¼š<br>	â—¦	å‡æcartç®—æ³•(å†³ç­–æ ‘APIå½“ä¸­å·²ç»å®ç°ï¼Œéšæœºæ£®æ—å‚æ•°è°ƒä¼˜æœ‰ç›¸å…³ä»‹ç»)<br>	â—¦	éšæœºæ£®æ—<br>æ³¨ï¼šä¼ä¸šé‡è¦å†³ç­–ï¼Œç”±äºå†³ç­–æ ‘å¾ˆå¥½çš„åˆ†æèƒ½åŠ›ï¼Œåœ¨å†³ç­–è¿‡ç¨‹åº”ç”¨è¾ƒå¤šï¼Œ å¯ä»¥é€‰æ‹©ç‰¹å¾</p>
<p>âš ï¸ï¼šç‰¹å¾è½¬æ¢ä¸ºå­—å…¸ï¼Œè¿›è¡Œå­—å…¸ç‰¹å¾æŠ½å–ï¼Œå› ä¸ºone-hotç¼–ç ç‰¹å¾å˜å¤šï¼Œç”¨get_feature_namesï¼Œè·å–ç‰¹å¾ã€‚</p>
<h4 id="3-6-éšæœºæ£®æ—"><a href="#3-6-éšæœºæ£®æ—" class="headerlink" title="3.6 éšæœºæ£®æ—"></a>3.6 éšæœºæ£®æ—</h4><p>ä»€ä¹ˆæ˜¯é›†æˆå­¦ä¹ æ–¹æ³•ï¼š<br>é›†æˆå­¦ä¹ é€šè¿‡å»ºç«‹å‡ ä¸ªæ¨¡å‹ç»„åˆçš„æ¥è§£å†³å•ä¸€é¢„æµ‹é—®é¢˜ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯ç”Ÿæˆå¤šä¸ªåˆ†ç±»å™¨&#x2F;æ¨¡å‹ï¼Œå„è‡ªç‹¬ç«‹åœ°å­¦ä¹ å’Œä½œå‡ºé¢„æµ‹ã€‚è¿™äº›é¢„æµ‹æœ€åç»“åˆæˆç»„åˆé¢„æµ‹ï¼Œå› æ­¤ä¼˜äºä»»ä½•ä¸€ä¸ªå•åˆ†ç±»çš„åšå‡ºé¢„æµ‹ã€‚ä¸‰ä¸ªè‡­çš®åŒ ï¼Œé¡¶ä¸€ä¸ªè¯¸è‘›äº®ã€‚ç”±åˆ†ç±»ç»“æœçš„ä¼—æ•°æ¥å†³å®šç›®æ ‡å€¼ã€‚</p>
<p>ä»€ä¹ˆæ˜¯éšæœºæ£®æ—ï¼š<br>åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œéšæœºæ£®æ—æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå†³ç­–æ ‘çš„åˆ†ç±»å™¨ï¼Œå¹¶ä¸”å…¶è¾“å‡ºçš„ç±»åˆ«æ˜¯ç”±ä¸ªåˆ«æ ‘è¾“å‡ºçš„ç±»åˆ«çš„ä¼—æ•°è€Œå®šã€‚<br>3.6.1 éšæœºæ£®æ—åŸç†è¿‡ç¨‹<br>å¦‚ä½•å»ºé€ æ¯æ£µæ ‘ï¼šä¸¤ä¸ªéšæœºï¼š<br>Nä¸ªæ ·æœ¬ï¼ŒMä¸ªç‰¹å¾<br>1ï¼‰è®­ç»ƒé›†éšæœº<br>é‡‡å–bootstrapæŠ½æ ·ï¼ˆéšæœºæœ‰æ”¾å›æŠ½æ ·ï¼‰<br>ç”¨Næ¥è¡¨ç¤ºè®­ç»ƒç”¨ä¾‹ï¼ˆæ ·æœ¬ï¼‰çš„ä¸ªæ•°ï¼ŒMè¡¨ç¤ºç‰¹å¾æ•°ç›®ã€‚<br>	â—¦	1ã€ä¸€æ¬¡éšæœºé€‰å‡ºä¸€ä¸ªæ ·æœ¬ï¼Œé‡å¤Næ¬¡ï¼Œ ï¼ˆæœ‰å¯èƒ½å‡ºç°é‡å¤çš„æ ·æœ¬ï¼‰<br>	â—¦	2ã€éšæœºå»é€‰å‡ºmä¸ªç‰¹å¾, m &lt;&lt;Mï¼Œå»ºç«‹å†³ç­–æ ‘ï¼Œèµ·åˆ°é™ç»´çš„æ•ˆæœï¼Œè¿ç®—å¿«ã€‚å¯ä»¥è®©æ­£ç¡®çš„ç»“æœè„±é¢–è€Œå‡ºï¼ˆçœŸç†æŒæ¡åœ¨å°‘æ•°äººæ‰‹é‡Œï¼‰</p>
<p>2ï¼‰ç‰¹å¾éšæœºã€‚</p>
<p>ä¸ºä»€ä¹ˆé‡‡ç”¨BootStrapæŠ½æ ·<br>	â€¢	ä¸ºä»€ä¹ˆè¦éšæœºæŠ½æ ·è®­ç»ƒé›†ï¼Ÿã€€ã€€<br>	â—¦	å¦‚æœä¸è¿›è¡ŒéšæœºæŠ½æ ·ï¼Œæ¯æ£µæ ‘çš„è®­ç»ƒé›†éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆæœ€ç»ˆè®­ç»ƒå‡ºçš„æ ‘åˆ†ç±»ç»“æœä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„<br>	â€¢	ä¸ºä»€ä¹ˆè¦æœ‰æ”¾å›åœ°æŠ½æ ·ï¼Ÿ<br>	â—¦	å¦‚æœä¸æ˜¯æœ‰æ”¾å›çš„æŠ½æ ·ï¼Œé‚£ä¹ˆæ¯æ£µæ ‘çš„è®­ç»ƒæ ·æœ¬éƒ½æ˜¯ä¸åŒçš„ï¼Œéƒ½æ˜¯æ²¡æœ‰äº¤é›†çš„ï¼Œè¿™æ ·æ¯æ£µæ ‘éƒ½æ˜¯â€œæœ‰åçš„â€ï¼Œéƒ½æ˜¯ç»å¯¹â€œç‰‡é¢çš„â€ï¼ˆå½“ç„¶è¿™æ ·è¯´å¯èƒ½ä¸å¯¹ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ£µæ ‘è®­ç»ƒå‡ºæ¥éƒ½æ˜¯æœ‰å¾ˆå¤§çš„å·®å¼‚çš„ï¼›è€Œéšæœºæ£®æ—æœ€ååˆ†ç±»å–å†³äºå¤šæ£µæ ‘ï¼ˆå¼±åˆ†ç±»å™¨ï¼‰çš„æŠ•ç¥¨è¡¨å†³ã€‚</p>
<p>3.6.2 éšæœºæ£®æ—api</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â€¢	class sklearn.ensemble.RandomForestClassifier(n_estimators=10, criterion=â€™giniâ€™, max_depth=None, bootstrap=True, random_state=None, min_samples_split=2)</span><br><span class="line">â—¦	éšæœºæ£®æ—åˆ†ç±»å™¨</span><br><span class="line">â—¦	n_estimatorsï¼šintegerï¼Œoptionalï¼ˆdefault = 10ï¼‰æ£®æ—é‡Œçš„æ ‘æœ¨æ•°é‡</span><br><span class="line">â—¦	criterionï¼šstringï¼Œå¯é€‰ï¼ˆdefault =â€œginiâ€ï¼‰åˆ†å‰²ç‰¹å¾çš„æµ‹é‡æ–¹æ³•</span><br><span class="line">â—¦	max_depthï¼šintegeræˆ–Noneï¼Œå¯é€‰ï¼ˆé»˜è®¤=æ— ï¼‰æ ‘çš„æœ€å¤§æ·±åº¦ 5,8,15,25,30</span><br><span class="line">â—¦	max_features=&quot;autoâ€,æ¯ä¸ªå†³ç­–æ ‘çš„æœ€å¤§ç‰¹å¾æ•°é‡(mæ€ä¹ˆé€‰)</span><br><span class="line">â–ª	If &quot;auto&quot;, then max_features=sqrt(n_features).</span><br><span class="line">â–ª	If &quot;sqrt&quot;, then max_features=sqrt(n_features) (same as &quot;auto&quot;).</span><br><span class="line">â–ª	If &quot;log2&quot;, then max_features=log2(n_features).</span><br><span class="line">â–ª	If None, then max_features=n_features.</span><br><span class="line">â—¦	bootstrapï¼šbooleanï¼Œoptionalï¼ˆdefault = Trueï¼‰æ˜¯å¦åœ¨æ„å»ºæ ‘æ—¶ä½¿ç”¨æ”¾å›æŠ½æ ·</span><br><span class="line">â—¦	min_samples_split:èŠ‚ç‚¹åˆ’åˆ†æœ€å°‘æ ·æœ¬æ•°</span><br><span class="line">â—¦	min_samples_leaf:å¶å­èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•°</span><br><span class="line">â€¢	è¶…å‚æ•°ï¼šn_estimator, max_depth, min_samples_split,min_samples_leaf</span><br></pre></td></tr></table></figure>

<p>3.6.3 é¸¢å°¾èŠ±å®ä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def random_decision_iris():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç”¨å†³ç­–æ ‘å¯¹é¸¢å°¾èŠ±è¿›è¡Œåˆ†ç±»</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 1ï¼‰è·å–æ•°æ®é›†</span><br><span class="line">    iris = load_iris()</span><br><span class="line">    # 2ï¼‰åˆ’åˆ†æ•°æ®é›†ï¼Œå†³ç­–æ ‘ä¸ç”¨åšæ ‡å‡†åŒ–</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=6)</span><br><span class="line">    # 3ï¼‰éšæœºæ£®æ—é¢„ä¼°å™¨è¿›è¡Œåˆ†ç±»</span><br><span class="line">    estimator = RandomForestClassifier(criterion=&#x27;entropy&#x27;)</span><br><span class="line">    # åŠ å…¥ç½‘æ ¼æœç´¢å’Œäº¤å‰éªŒè¯</span><br><span class="line">    # å‚æ•°å‡†å¤‡</span><br><span class="line">    param_dict = &#123;&quot;n_estimators&quot;: [120, 200, 300, 500, 800, 1200], &quot;max_depth&quot;: [5, 8, 15, 25, 30]&#125;</span><br><span class="line">    # è¶…å‚æ•°è°ƒä¼˜</span><br><span class="line">    estimator = GridSearchCV(estimator, param_grid=param_dict, cv=2)</span><br><span class="line">    estimator.fit(x_train,y_train)</span><br><span class="line">    # 4ï¼‰æ¨¡å‹è¯„ä¼°</span><br><span class="line">    y_predict = estimator.predict(x_test)</span><br><span class="line">    print(&quot;y_predict:\n&quot;, y_predict)</span><br><span class="line">    print(&quot;é¢„æµ‹å€¼å’ŒçœŸå®å€¼:\n&quot;, y_predict == y_test)</span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line">    print(&quot;score:\n&quot;, score)</span><br><span class="line">    # å¯è§†åŒ–å†³ç­–æ ‘</span><br><span class="line">    # export_graphviz(estimator, out_file=&#x27;iris_tree.dot&#x27;)</span><br><span class="line">    print(&quot;score:\n&quot;, score)  # æµ‹è¯•é›†çš„ç»“æœ</span><br><span class="line">    print(&quot;æœ€ä½³å‚æ•°:\n&quot;, estimator.best_params_)</span><br><span class="line">    print(&quot;æœ€ä½³ç»“æœ:\n&quot;, estimator.best_score_)  # éªŒè¯é›†çš„ç»“æœ</span><br><span class="line">    print(&quot;æœ€ä½³ä¼°è®¡å™¨:\n&quot;, estimator.best_estimator_)</span><br><span class="line">    print(&quot;äº¤å‰éªŒè¯ç»“æœ:\n&quot;, estimator.cv_results_)</span><br><span class="line">    return None</span><br></pre></td></tr></table></figure>

<p>3.6.4 ä¼˜ç¼ºç‚¹<br>	â€¢	åœ¨å½“å‰æ‰€æœ‰ç®—æ³•ä¸­ï¼Œå…·æœ‰æå¥½çš„å‡†ç¡®ç‡ï¼ˆæ²¡æœ‰å…è´¹çš„åˆé¤ï¼‰<br>	â€¢	èƒ½å¤Ÿæœ‰æ•ˆåœ°è¿è¡Œåœ¨å¤§æ•°æ®é›†ä¸Šï¼Œå¤„ç†å…·æœ‰é«˜ç»´ç‰¹å¾çš„è¾“å…¥æ ·æœ¬ï¼Œè€Œä¸”ä¸éœ€è¦é™ç»´ï¼ˆM&gt;&gt;mç›¸å½“äºæ˜¯é™ç»´äº†ï¼‰<br>	â€¢	èƒ½å¤Ÿè¯„ä¼°å„ä¸ªç‰¹å¾åœ¨åˆ†ç±»é—®é¢˜ä¸Šçš„é‡è¦æ€§</p>
<h4 id="3-7-æ€»ç»“"><a href="#3-7-æ€»ç»“" class="headerlink" title="3.7 æ€»ç»“"></a>3.7 æ€»ç»“</h4><p>1.è½¬æ¢å™¨å’Œé¢„ä¼°å™¨ï¼šè½¬æ¢å™¨åœ¨ç‰¹å¾å·¥ç¨‹é‡Œç”¨ï¼Œé¢„ä¼°å™¨åœ¨æœºå™¨å­¦ä¹ ç®—æ³•è®­ç»ƒæ¨¡å‹é‡Œç”¨ã€‚å°è£…åœ¨åŒä¸€çˆ¶ç±»é‡Œé¢ï¼Œè°ƒåŒä¸€ä¸ªæ–¹æ³•ï¼ˆfit_transformã€fitï¼‰</p>
<p>2.KNNç®—æ³•ï¼šæ ¸å¿ƒæ€æƒ³æ˜¯æ ¹æ®é‚»å±…ç¡®å®šç±»åˆ«ï¼Œè°æ˜¯é‚»å±…ï¼šè·ç¦»å…¬å¼ï¼Œkçš„å–å€¼ï¼šæ‰¾å‡ ä¸ªé‚»å±…ï¼Œå¤ªå°å®¹æ˜“å—å¼‚å¸¸å€¼å½±å“ï¼Œè¿‡å¤§å®¹æ˜“å—æ ·æœ¬ä¸å‡è¡¡å½±å“ã€‚ç¼ºé™·æ˜¯æ—¶é—´å¤æ‚åº¦é«˜ï¼Œåº”ç”¨åœºæ™¯æ˜¯å°‘é‡æ•°æ®ã€‚</p>
<p>3.æœ´ç´ è´å¶æ–¯ç®—æ³•ï¼šæœ´ç´ ï¼šå‡å®šç‰¹å¾ä¸ç‰¹å¾ä¹‹é—´ç‹¬ç«‹ã€‚æ ·æœ¬é‡ä¸å¤Ÿå¯¼è‡´å‡ºç°0çš„æƒ…å†µï¼šå¼•å…¥æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ç³»æ•°ã€‚ä¼˜ç‚¹ï¼šå¯¹ç¼ºå¤±æ•°æ®ä¸æ•æ„Ÿï¼Œè®¡ç®—å¿«ã€‚ç¼ºç‚¹ï¼šç‰¹å¾ä¹‹é—´å…³è”å½±å“æ•ˆæœã€‚åº”ç”¨åœºæ™¯ï¼šæ–‡æœ¬åˆ†ç±»ã€‚</p>
<p>4.å†³ç­–æ ‘ï¼šä»¥ä½•ç§é¡ºåºå†³ç­–æ˜¯æœ€é«˜æ•ˆçš„ï¼Œç”¨ä¿¡æ¯å¢ç›Šæ¥å†³å®šå†³ç­–é¡ºåºã€‚ä¿¡æ¯å¢ç›Š&#x3D;ä¿¡æ¯å¢’-æ¡ä»¶å¢’ã€‚ä¼˜ç‚¹æ˜¯å¯ä»¥å¯è§†åŒ–ï¼Œå¯è§£é‡Šèƒ½åŠ›å¼ºã€‚ç¼ºç‚¹å®¹æ˜“è¿‡æ‹Ÿåˆã€‚</p>
<p>5.éšæœºæ£®æ—ï¼šéšæœºï¼šè®­ç»ƒé›†éšæœºå’Œç‰¹å¾éšæœºï¼Œæ£®æ—ï¼šå¤šä¸ªå†³ç­–æ ‘ã€‚ä¼˜ç‚¹å®¹æ˜“å–å¾—æ¯”è¾ƒå¥½çš„æ•ˆæœï¼Œæœ‰é™ç»´çš„æ•ˆæœï¼Œé™ä½æ¨¡å‹å¤æ‚åº¦ã€‚åº”ç”¨åœºæ™¯ï¼šé«˜ç»´åº¦ç‰¹å¾å¤§æ•°æ®åœºæ™¯ã€‚</p>
<h3 id="4-å›å½’ä¸èšç±»ç®—æ³•"><a href="#4-å›å½’ä¸èšç±»ç®—æ³•" class="headerlink" title="4.å›å½’ä¸èšç±»ç®—æ³•"></a>4.å›å½’ä¸èšç±»ç®—æ³•</h3><h4 id="4-1-çº¿æ€§å›å½’"><a href="#4-1-çº¿æ€§å›å½’" class="headerlink" title="4.1 çº¿æ€§å›å½’"></a>4.1 çº¿æ€§å›å½’</h4><p>4.1.1 çº¿æ€§å›å½’åŸç†<br>å›å½’é—®é¢˜ - ç›®æ ‡å€¼æ˜¯è¿ç»­æ€§çš„ã€‚<br>çº¿æ€§å›å½’(Linear regression)æ˜¯åˆ©ç”¨å›å½’æ–¹ç¨‹(å‡½æ•°)å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªè‡ªå˜é‡(ç‰¹å¾å€¼)å’Œå› å˜é‡(ç›®æ ‡å€¼)ä¹‹é—´å…³ç³»è¿›è¡Œå»ºæ¨¡çš„ä¸€ç§åˆ†ææ–¹å¼ã€‚<br>é€šä¿—ï¼šæ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„å‡½æ•°å…³ç³»ï¼Œæè¿°ç‰¹å¾å€¼å’Œç›®æ ‡å€¼çš„å…³ç³»ã€‚<br>æ»¡è¶³çº¿æ€§å…³ç³»çš„ï¼š<br>h(w) &#x3D; w1x1+w2x2+â€¦+b &#x3D; wTx+b<br>Wæ˜¯æƒé‡å€¼&#x2F;å›å½’ç³»æ•°ã€‚bæ˜¯åç½®ã€‚<br>è¿™ä¸ªå‡½æ•°å…³ç³»å°±å«åšçº¿æ€§æ¨¡å‹ã€‚<br>å¹¿ä¹‰çš„çº¿æ€§æ¨¡å‹ï¼Œå¯ä»¥æ˜¯éçº¿æ€§å…³ç³»ã€‚<br>çº¿æ€§æ¨¡å‹ï¼Œå½“å‡½æ•°å…³ç³»å½“ä¸­ï¼Œæ»¡è¶³è‡ªå˜é‡ä¸€æ¬¡&#x2F;å‚æ•°ä¸€æ¬¡çš„ï¼Œéƒ½å«çº¿æ€§æ¨¡å‹ã€‚<br>è‡ªå˜é‡ä¸€æ¬¡ï¼šh(w) &#x3D; w1x1+w2x2+â€¦+b &#x3D; wTx+b<br>å‚æ•°ä¸€æ¬¡ï¼šy&#x3D;w1x1 + w2x1^2 + w3x1^3 + w4x2^3 +â€¦+b ï¼ˆæ²¡æœ‰log&#x2F;eï¼‰<br>çº¿æ€§å…³ç³»ä¸€å®šæ˜¯çº¿æ€§æ¨¡å‹ï¼Œä½†æ˜¯çº¿æ€§æ¨¡å‹ä¸ä¸€å®šæ˜¯çº¿æ€§å…³ç³»ã€‚</p>
<p>4.1.2 çº¿æ€§å›å½’çš„æŸå¤±å’Œä¼˜åŒ–åŸç†<br>æƒé‡å’Œåç½®ï¼ˆæ¨¡å‹å‚æ•°ï¼‰æ˜¯æœªçŸ¥çš„ï¼Œæ±‚è§£ï¼Œä½¿å¾—é¢„æµ‹å‡†ç¡®ã€‚<br>é¦–å…ˆï¼Œéšæ„å‡å®šä¸€ç»„æ¨¡å‹å‚æ•°ï¼Œå¸¦å…¥ä¸€ç»„ç‰¹å¾å€¼ã€‚<br>é¢„æµ‹å€¼å’ŒçœŸå®å€¼çš„å·®å€¼åœ¨è¿­ä»£ä¸­ç¼©å°ã€‚<br>è¡¡é‡é¢„æµ‹å€¼å’ŒçœŸå®å€¼çš„è¯¯å·®ï¼šæŸå¤±å‡½æ•°&#x2F;cost&#x2F;æˆæœ¬å‡½æ•°&#x2F;ç›®æ ‡å‡½æ•°<br>æŸå¤±å‡½æ•°&#x3D;ç´¯åŠ (é¢„æµ‹å€¼-çœŸå®å€¼)^2<br>å‡å°‘è¿™ä¸ªæŸå¤±ï¼Œä½¿å¾—é¢„æµ‹æ›´å‡†ç¡®ï¼Œåˆç§°æœ€å°äºŒä¹˜æ³•ã€‚</p>
<p>ä¼˜åŒ–æŸå¤±çš„æ–¹æ³•ï¼š<br>1.æ­£è§„æ–¹ç¨‹ï¼ˆå¤©æ‰ï¼‰-ç”¨æ­£è§„æ–¹ç¨‹ç›´æ¥æ±‚è§£w<br>å½“ç‰¹å¾è¿‡å¤šè¿‡å¤æ‚æ—¶ï¼Œæ±‚è§£é€Ÿåº¦å¤ªæ…¢å¹¶ä¸”å¾—ä¸åˆ°ç»“æœï¼ˆç‰¹åˆ«æ˜¯æ±‚é€†ï¼‰ï¼Œåªèƒ½åœ¨çº¿æ€§å›å½’ä¸­ä½¿ç”¨ã€‚</p>
<p>2.æ¢¯åº¦ä¸‹é™ï¼ˆå‹¤å¥‹åŠªåŠ›çš„æ™®é€šäººï¼‰-ä¸æ–­åœ°è¯•é”™ã€æ”¹è¿›<br>æ•°æ®é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œæ¢¯åº¦ä¸‹é™å¯ä»¥å–å¾—æ›´å¥½çš„ç»“æœã€‚<br>å…ˆç»™åˆä½¿çš„æƒé‡ï¼Œè¿­ä»£æ¥è·å–æ–°çš„æƒé‡ï¼Œæ²¿ç€åˆ‡çº¿çš„æ–¹å‘ç§»åŠ¨<br>Î±ä¸ºå­¦ä¹ é€Ÿç‡ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼ˆè¶…å‚æ•°ï¼‰ï¼Œè¡¨ç¤ºæ­¥é•¿ï¼ŒÎ±æ—è¾¹çš„æ•´ä½“è¡¨ç¤ºæ–¹å‘<br>æ²¿ç€è¿™ä¸ªå‡½æ•°ä¸‹é™çš„æ–¹å‘æ‰¾ï¼Œæœ€åå°±èƒ½æ‰¾åˆ°å±±è°·çš„æœ€ä½ç‚¹ï¼Œç„¶åæ›´æ–°Wå€¼<br>ä½¿ç”¨ï¼šé¢å¯¹è®­ç»ƒæ•°æ®è§„æ¨¡ååˆ†åºå¤§çš„ä»»åŠ¡ ï¼Œèƒ½å¤Ÿæ‰¾åˆ°è¾ƒå¥½çš„ç»“æœã€‚<br>çº¿æ€§å›å½’çš„æŸå¤±å‡½æ•°å›¾åƒæœ‰ä¸€ä¸ªå”¯ä¸€çš„æœ€å°å€¼ç‚¹ã€‚<br>ä½†ä¸æ˜¯çº¿æ€§å›å½’çš„æŸå¤±å‡½æ•°ï¼Œå¯èƒ½åˆ°ä¸€ä¸ªå±€éƒ¨æœ€å°ç‚¹ã€‚<br>æœºå™¨å­¦ä¹ ä¸­çš„å­¦ä¹ è¿‡ç¨‹å°±å¯ä»¥ç†è§£ä¸ºæ¢¯åº¦ä¸‹é™çš„è¯•é”™æ”¹è¿›ã€‚</p>
<p>4.1.3 çº¿æ€§å›å½’API<br>sklearnæä¾›ç»™æˆ‘ä»¬ä¸¤ç§å®ç°çš„APIï¼Œ å¯ä»¥æ ¹æ®é€‰æ‹©ä½¿ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.linear_model.LinearRegression(fit_intercept=True)</span><br><span class="line">  é€šè¿‡æ­£è§„æ–¹ç¨‹ä¼˜åŒ–</span><br><span class="line">  fit_interceptï¼šæ˜¯å¦è®¡ç®—åç½®ï¼Œä¸€èˆ¬trueï¼Œä¸ç„¶åªèƒ½æ˜¯è¿‡åŸç‚¹çš„ï¼Œå±€é™æ€§</span><br><span class="line">  LinearRegression.coef_ï¼šçœ‹å›å½’ç³»æ•°</span><br><span class="line">  LinearRegression.intercept_ï¼šçœ‹åç½®</span><br><span class="line">sklearn.linear_model.SGDRegressor(loss=&quot;squared_loss&quot;, fit_intercept=True, learning_rate =&#x27;invscaling&#x27;, eta0=0.01)</span><br><span class="line">  SGDRegressorç±»å®ç°äº†éšæœºæ¢¯åº¦ä¸‹é™å­¦ä¹ ï¼Œå®ƒæ”¯æŒä¸åŒçš„losså‡½æ•°å’Œæ­£åˆ™åŒ–æƒ©ç½šé¡¹æ¥æ‹Ÿåˆçº¿æ€§å›å½’æ¨¡å‹ã€‚</span><br><span class="line">  loss:æŸå¤±å‡½æ•°ç±»å‹</span><br><span class="line">  loss=â€squared_lossâ€: æ™®é€šæœ€å°äºŒä¹˜æ³•</span><br><span class="line">  fit_interceptï¼šæ˜¯å¦è®¡ç®—åç½®</span><br><span class="line">  learning_rate : string, optional</span><br><span class="line">    å­¦ä¹ ç‡ç®—æ³•</span><br><span class="line">    &#x27;constant&#x27;: eta = eta0 ï¼ˆé»˜è®¤0.01ï¼‰</span><br><span class="line">    &#x27;optimal&#x27;: eta = 1.0 / (alpha * (t + t0)) [default]éšç€è¿­ä»£æ¬¡æ•°å˜å¤šå­¦ä¹ ç‡å˜å°</span><br><span class="line">    &#x27;invscaling&#x27;: eta = eta0 / pow(t, power_t)  power_t=0.25:å­˜åœ¨çˆ¶ç±»å½“ä¸­</span><br><span class="line">    å¯¹äºä¸€ä¸ªå¸¸æ•°å€¼çš„å­¦ä¹ ç‡æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨learning_rate=â€™constantâ€™ ï¼Œå¹¶ä½¿ç”¨eta0æ¥æŒ‡å®šå­¦ä¹ ç‡ã€‚</span><br><span class="line">  SGDRegressor.coef_ï¼šå›å½’ç³»æ•°</span><br><span class="line">  SGDRegressor.intercept_ï¼šåç½®</span><br></pre></td></tr></table></figure>


<p>4.1.4 æ³¢å£«é¡¿æˆ¿ä»·é¢„æµ‹<br>æµç¨‹ï¼š<br>1ï¼‰è·å–æ•°æ®é›†<br>2ï¼‰åˆ’åˆ†æ•°æ®é›†<br>3ï¼‰ç‰¹å¾å·¥ç¨‹ï¼šæ— é‡çº²åŒ–-æ ‡å‡†åŒ–<br>4ï¼‰é¢„ä¼°å™¨æµç¨‹ fit() -&gt; æ¨¡å‹ coef_ intercept_<br>5ï¼‰æ¨¡å‹è¯„ä¼° </p>
<p>å›å½’æ€§èƒ½è¯„ä¼°: å‡æ–¹è¯¯å·®MSEï¼ˆä¸Šé¢çš„æŸå¤±å‡½æ•°+å¹³å‡ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.metrics.mean_squared_error(y_true, y_pred)</span><br><span class="line">å‡æ–¹è¯¯å·®å›å½’æŸå¤±</span><br><span class="line">y_true:çœŸå®ç›®æ ‡å€¼</span><br><span class="line">y_pred:é¢„æµ‹ç›®æ ‡å€¼</span><br><span class="line">return:æµ®ç‚¹æ•°ç»“æœ</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from sklearn.datasets import load_boston</span><br><span class="line">from sklearn.model_selection import train_test_split</span><br><span class="line">from sklearn.preprocessing import StandardScaler</span><br><span class="line">from sklearn.linear_model import LinearRegression,SGDRegressor</span><br><span class="line">from sklearn.metrics import mean_squared_error</span><br><span class="line"></span><br><span class="line">def linear1():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    çº¿æ€§å›å½’æ­£è§„æ–¹ç¨‹ä¼˜åŒ–æ–¹æ³•é¢„æµ‹æˆ¿å­ä»·æ ¼</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 1ï¼‰è·å–æ•°æ®é›†</span><br><span class="line">    lb = load_boston()</span><br><span class="line">    # print(lb.data)</span><br><span class="line">    # print(lb.target)</span><br><span class="line">    print(&quot;ç‰¹å¾æ•°é‡&quot;, lb.data.shape)</span><br><span class="line"></span><br><span class="line">    # 2)å¯¹æ•°æ®é›†è¿›è¡Œåˆ’åˆ†</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(lb.data, lb.target, test_size=0.3, random_state=24)</span><br><span class="line"></span><br><span class="line">    # 3ï¼‰ç‰¹å¾å·¥ç¨‹ï¼šæ— é‡çº²åŒ– - æ ‡å‡†åŒ–</span><br><span class="line">    transfer = StandardScaler()</span><br><span class="line">    x_train = transfer.fit_transform(x_train)</span><br><span class="line">    x_test = transfer.fit_transform(x_test)</span><br><span class="line">    # print(x_train)</span><br><span class="line"></span><br><span class="line">    # 4ï¼‰é¢„ä¼°å™¨æµç¨‹ fit() -&gt; æ¨¡å‹</span><br><span class="line">    # ä½¿ç”¨æ­£è§„æ–¹ç¨‹æ±‚è§£</span><br><span class="line">    lr = LinearRegression()</span><br><span class="line">    lr.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">    # 5ï¼‰å¾—å‡ºæ¨¡å‹</span><br><span class="line">    print(&quot;æƒé‡ç³»æ•°ï¼š&quot;, lr.coef_)</span><br><span class="line">    print(&quot;åç½®ï¼š&quot;, lr.intercept_)</span><br><span class="line"></span><br><span class="line">    # 6ï¼‰æ¨¡å‹è¯„ä¼°</span><br><span class="line">    y_predict = lr.predict(x_test)</span><br><span class="line">    print(&quot;é¢„æµ‹æˆ¿ä»·ï¼š&quot;, y_predict)</span><br><span class="line">    print(&quot;æ­£è§„æ–¹ç¨‹çš„å‡æ–¹è¯¯å·®ä¸ºï¼š&quot;, mean_squared_error(y_test, y_predict))</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">def linear2():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    çº¿æ€§å›å½’æ¢¯åº¦ä¸‹é™ä¼˜åŒ–æ–¹æ³•é¢„æµ‹æˆ¿å­ä»·æ ¼</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 1ï¼‰è·å–æ•°æ®é›†</span><br><span class="line">    lb = load_boston()</span><br><span class="line">    # print(lb.data)</span><br><span class="line">    # print(lb.target)</span><br><span class="line"></span><br><span class="line">    # 2)å¯¹æ•°æ®é›†è¿›è¡Œåˆ’åˆ†</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(lb.data, lb.target, test_size=0.3, random_state=24)</span><br><span class="line"></span><br><span class="line">    # 3ï¼‰ç‰¹å¾å·¥ç¨‹ï¼šæ— é‡çº²åŒ– - æ ‡å‡†åŒ–</span><br><span class="line">    transfer = StandardScaler()</span><br><span class="line">    x_train = transfer.fit_transform(x_train)</span><br><span class="line">    x_test = transfer.fit_transform(x_test)</span><br><span class="line">    # print(x_train)</span><br><span class="line"></span><br><span class="line">    # 4ï¼‰æ¢¯åº¦ä¸‹é™è¿›è¡Œé¢„æµ‹ï¼Œè°ƒå‚</span><br><span class="line">    sgd = SGDRegressor(max_iter=10000, eta0=0.0001, learning_rate=&quot;constant&quot;)</span><br><span class="line">    sgd.fit(x_train, y_train)</span><br><span class="line">    print(&quot;SGDçš„æƒé‡å‚æ•°ä¸ºï¼š&quot;, sgd.coef_)</span><br><span class="line">    print(&quot;åç½®ï¼š&quot;, sgd.intercept_)</span><br><span class="line"></span><br><span class="line">    # 6ï¼‰æ¨¡å‹è¯„ä¼°</span><br><span class="line">    y_predict = sgd.predict(x_test)</span><br><span class="line">    print(&quot;é¢„æµ‹æˆ¿ä»·ï¼š&quot;, y_predict)</span><br><span class="line">    print(&quot;æ¢¯åº¦ä¸‹é™çš„å‡æ–¹è¯¯å·®ä¸ºï¼š&quot;, mean_squared_error(y_test, y_predict))</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    linear1()</span><br><span class="line">    linear2()</span><br></pre></td></tr></table></figure>

<p>4.1.5 æ­£è§„æ–¹ç¨‹å’Œæ¢¯åº¦ä¸‹é™çš„å¯¹æ¯”</p>
<p>æ¢¯åº¦ä¸‹é™	        æ­£è§„æ–¹ç¨‹<br>éœ€è¦é€‰æ‹©å­¦ä¹ ç‡	ä¸éœ€è¦<br>éœ€è¦è¿­ä»£æ±‚è§£	 ä¸€æ¬¡è¿ç®—å¾—å‡º<br>ç‰¹å¾æ•°é‡è¾ƒå¤§å¯ä»¥ä½¿ç”¨  éœ€è¦è®¡ç®—æ–¹ç¨‹ï¼Œæ—¶é—´å¤æ‚åº¦é«˜O(n3)</p>
<p>é€‰æ‹©ï¼š<br>å°è§„æ¨¡æ•°æ®ï¼šLinearRegression(ä¸èƒ½è§£å†³æ‹Ÿåˆé—®é¢˜)ã€å²­å›å½’<br>å¤§è§„æ¨¡æ•°æ®ï¼šSGDRegressor</p>
<p>4.1.6 æ¢¯åº¦ä¸‹é™ä¼˜åŒ–æ–¹æ³•GDã€SGDã€SAG</p>
<p>GD<br>æ¢¯åº¦ä¸‹é™(Gradient Descent)ï¼ŒåŸå§‹çš„æ¢¯åº¦ä¸‹é™æ³•éœ€è¦è®¡ç®—æ‰€æœ‰æ ·æœ¬çš„å€¼æ‰èƒ½å¤Ÿå¾—å‡ºæ¢¯åº¦ï¼Œè®¡ç®—é‡å¤§ï¼Œæ‰€ä»¥åé¢æ‰æœ‰ä¼šä¸€ç³»åˆ—çš„æ”¹è¿›ã€‚</p>
<p>SGD<br>éšæœºæ¢¯åº¦ä¸‹é™(Stochastic gradient descent)æ˜¯ä¸€ä¸ªä¼˜åŒ–æ–¹æ³•ã€‚å®ƒåœ¨ä¸€æ¬¡è¿­ä»£æ—¶åªè€ƒè™‘ä¸€ä¸ªè®­ç»ƒæ ·æœ¬ã€‚<br>SGDçš„ä¼˜ç‚¹æ˜¯ï¼šé«˜æ•ˆå®¹æ˜“å®ç°<br>SGDçš„ç¼ºç‚¹æ˜¯ï¼šSGDéœ€è¦è®¸å¤šè¶…å‚æ•°ï¼šæ¯”å¦‚æ­£åˆ™é¡¹å‚æ•°ã€è¿­ä»£æ•°ã€‚SGDå¯¹äºç‰¹å¾æ ‡å‡†åŒ–æ˜¯æ•æ„Ÿçš„ã€‚</p>
<p>SAG<br>éšæœºå¹³å‡æ¢¯åº¦æ³•(Stochasitc Average Gradient)ï¼Œç”±äºæ”¶æ•›çš„é€Ÿåº¦å¤ªæ…¢ï¼Œæœ‰äººæå‡ºSAGç­‰åŸºäºæ¢¯åº¦ä¸‹é™çš„ç®—æ³•<br>Scikit-learnï¼šSGDRegressorã€å²­å›å½’ã€é€»è¾‘å›å½’ç­‰å½“ä¸­éƒ½ä¼šæœ‰SAGä¼˜åŒ–</p>
<h4 id="4-2-è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"><a href="#4-2-è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ" class="headerlink" title="4.2 è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"></a>4.2 è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ</h4><p>è®­ç»ƒé›†ä¸Šè¡¨ç°å¾—å¥½ï¼Œæµ‹è¯•é›†ä¸Šè¡¨ç°ä¸å¥½ - è¿‡æ‹Ÿåˆã€‚<br>å­¦ä¹ åˆ°çš„ç‰¹å¾å¤ªå°ï¼Œå¯¼è‡´åŒºåˆ†æ ‡å‡†å¤ªç²—ç³™ï¼Œä¸èƒ½å‡†ç¡®è¯†åˆ«ã€‚-æ¬ æ‹Ÿåˆ<br>å­¦çš„ç‰¹å¾å¤ªå¤šäº† - è¿‡æ‹Ÿåˆã€‚</p>
<p>è¿‡æ‹Ÿåˆï¼šä¸€ä¸ªå‡è®¾åœ¨è®­ç»ƒæ•°æ®ä¸Šèƒ½å¤Ÿè·å¾—æ¯”å…¶ä»–å‡è®¾æ›´å¥½çš„æ‹Ÿåˆï¼Œ ä½†æ˜¯åœ¨æµ‹è¯•æ•°æ®é›†ä¸Šå´ä¸èƒ½å¾ˆå¥½åœ°æ‹Ÿåˆæ•°æ®ï¼Œæ­¤æ—¶è®¤ä¸ºè¿™ä¸ªå‡è®¾å‡ºç°äº†è¿‡æ‹Ÿåˆçš„ç°è±¡ã€‚(æ¨¡å‹è¿‡äºå¤æ‚)<br>æ¬ æ‹Ÿåˆï¼šä¸€ä¸ªå‡è®¾åœ¨è®­ç»ƒæ•°æ®ä¸Šä¸èƒ½è·å¾—æ›´å¥½çš„æ‹Ÿåˆï¼Œå¹¶ä¸”åœ¨æµ‹è¯•æ•°æ®é›†ä¸Šä¹Ÿä¸èƒ½å¾ˆå¥½åœ°æ‹Ÿåˆæ•°æ®ï¼Œæ­¤æ—¶è®¤ä¸ºè¿™ä¸ªå‡è®¾å‡ºç°äº†æ¬ æ‹Ÿåˆçš„ç°è±¡ã€‚(æ¨¡å‹è¿‡äºç®€å•)</p>
<p>ç”¨ä¸€ä¸ªæ›²çº¿æ¥è¡¨ç¤ºï¼šéšç€æ¨¡å‹å¤æ‚åº¦çš„å¢å¤§ï¼Œè®­ç»ƒé›†çš„æŸå¤±å€¼è¶Šæ¥è¶Šå°‘ï¼Œä½†æ˜¯æµ‹è¯•é›†çš„æŸå¤±å€¼å…ˆå˜å°å†å˜å¤§ã€‚ä¸´ç•Œå€¼å·¦è¾¹æ˜¯æ¬ æ‹Ÿåˆï¼Œå³è¾¹æ˜¯è¿‡æ‹Ÿåˆã€‚</p>
<p>æ¬ æ‹ŸåˆåŸå› ä»¥åŠè§£å†³åŠæ³•<br>åŸå› ï¼šå­¦ä¹ åˆ°æ•°æ®çš„ç‰¹å¾è¿‡å°‘<br>è§£å†³åŠæ³•ï¼šå¢åŠ æ•°æ®çš„ç‰¹å¾æ•°é‡</p>
<p>è¿‡æ‹ŸåˆåŸå› ä»¥åŠè§£å†³åŠæ³•<br>åŸå› ï¼šåŸå§‹ç‰¹å¾è¿‡å¤šï¼Œå­˜åœ¨ä¸€äº›å˜ˆæ‚ç‰¹å¾ï¼Œ æ¨¡å‹è¿‡äºå¤æ‚æ˜¯å› ä¸ºæ¨¡å‹å°è¯•å»å…¼é¡¾å„ä¸ªæµ‹è¯•æ•°æ®ç‚¹ï¼Œæ³›åŒ–èƒ½åŠ›æ¯”è¾ƒå·®ã€‚<br>è§£å†³åŠæ³•ï¼š<br>æ­£åˆ™åŒ–ï¼Œå°½é‡å‡å°é«˜æ¬¡é¡¹ç‰¹å¾çš„å½±å“<br>ï¼ˆè¿™é‡Œé’ˆå¯¹å›å½’ï¼Œæˆ‘ä»¬é€‰æ‹©äº†æ­£åˆ™åŒ–ã€‚ä½†æ˜¯å¯¹äºå…¶ä»–æœºå™¨å­¦ä¹ ç®—æ³•å¦‚åˆ†ç±»ç®—æ³•æ¥è¯´ä¹Ÿä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œé™¤äº†ä¸€äº›ç®—æ³•æœ¬èº«ä½œç”¨ä¹‹å¤–ï¼ˆå†³ç­–æ ‘ã€ç¥ç»ç½‘ç»œï¼‰ï¼Œæˆ‘ä»¬æ›´å¤šçš„ä¹Ÿæ˜¯å»è‡ªå·±åšç‰¹å¾é€‰æ‹©ï¼ŒåŒ…æ‹¬ä¹‹å‰è¯´çš„åˆ é™¤ã€åˆå¹¶ä¸€äº›ç‰¹å¾ï¼‰</p>
<p>åœ¨å­¦ä¹ çš„æ—¶å€™ï¼Œæ•°æ®æä¾›çš„ç‰¹å¾æœ‰äº›å½±å“æ¨¡å‹å¤æ‚åº¦æˆ–è€…è¿™ä¸ªç‰¹å¾çš„æ•°æ®ç‚¹å¼‚å¸¸è¾ƒå¤šï¼Œæ‰€ä»¥ç®—æ³•åœ¨å­¦ä¹ çš„æ—¶å€™å°½é‡å‡å°‘è¿™ä¸ªç‰¹å¾çš„å½±å“ï¼ˆç”šè‡³åˆ é™¤æŸä¸ªç‰¹å¾çš„å½±å“ï¼‰ï¼Œè¿™å°±æ˜¯æ­£åˆ™åŒ–</p>
<p>æ³¨ï¼šè°ƒæ•´æ—¶å€™ï¼Œç®—æ³•å¹¶ä¸çŸ¥é“æŸä¸ªç‰¹å¾å½±å“ï¼Œè€Œæ˜¯å»è°ƒæ•´å‚æ•°å¾—å‡ºä¼˜åŒ–çš„ç»“æœ</p>
<p>æ­£åˆ™åŒ–ç±»åˆ«ï¼š<br>L2æ­£åˆ™åŒ–<br>ä½œç”¨ï¼šå¯ä»¥ä½¿å¾—æ¨¡å‹å…¶ä¸­ä¸€äº›Wæƒé‡ç³»æ•°éƒ½å¾ˆå°ï¼Œéƒ½æ¥è¿‘äº0ï¼Œå‰Šå¼±æŸä¸ªç‰¹å¾çš„å½±å“<br>ä¼˜ç‚¹ï¼šè¶Šå°çš„å‚æ•°è¯´æ˜æ¨¡å‹è¶Šç®€å•ï¼Œè¶Šç®€å•çš„æ¨¡å‹åˆ™è¶Šä¸å®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆç°è±¡<br>Ridgeå›å½’ï¼ˆå²­å›å½’ï¼‰<br>åŠ å…¥L2æ­£åˆ™åŒ–åçš„æŸå¤±å‡½æ•°ï¼š<br>æŸå¤±å‡½æ•°&#x3D;(ç´¯åŠ (é¢„æµ‹å€¼-çœŸå®å€¼)^2)*(1&#x2F;2m) + æƒ©ç½šç³»æ•°(è¶…å‚ï¼Œæƒ©ç½šçš„è¡¥å¿) * æƒ©ç½šé¡¹(æƒé‡ç³»æ•°çš„å¹³æ–¹å’Œ)<br>ç›®çš„æ˜¯ï¼šä¸ä»…ä½¿å¾—æŸå¤±å˜å°ï¼Œè¿˜è®©æƒé‡ç³»æ•°å˜å°ã€‚è¾¾åˆ°ä¸ä»…è®©æ¨¡å‹æ›´åŠ å‡†ç¡®ï¼Œè¿˜æ¶ˆé™¤é«˜æ¬¡é¡¹çš„å½±å“ã€‚</p>
<p>L1æ­£åˆ™åŒ–<br>ä½œç”¨ï¼šå¯ä»¥ä½¿å¾—å…¶ä¸­ä¸€äº›Wçš„å€¼ç›´æ¥ä¸º0ï¼Œåˆ é™¤è¿™ä¸ªç‰¹å¾çš„å½±å“<br>LASSOå›å½’<br>æƒ©ç½šé¡¹æ˜¯wçš„ç»å¯¹å€¼ã€‚</p>
<p>çº¿æ€§å›å½’çš„æŸå¤±å‡½æ•°ç”¨æœ€å°äºŒä¹˜æ³•ï¼Œç­‰ä»·äºå½“é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„è¯¯å·®æ»¡è¶³æ­£æ€åˆ†å¸ƒæ—¶çš„æå¤§ä¼¼ç„¶ä¼°è®¡ï¼›å²­å›å½’çš„æŸå¤±å‡½æ•°ï¼Œæ˜¯æœ€å°äºŒä¹˜æ³•+L2èŒƒæ•°ï¼Œç­‰ä»·äºå½“é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„è¯¯å·®æ»¡è¶³æ­£æ€åˆ†å¸ƒï¼Œä¸”æƒé‡å€¼ä¹Ÿæ»¡è¶³æ­£æ€åˆ†å¸ƒï¼ˆå…ˆéªŒåˆ†å¸ƒï¼‰æ—¶çš„æœ€å¤§åéªŒä¼°è®¡ï¼›LASSOçš„æŸå¤±å‡½æ•°ï¼Œæ˜¯æœ€å°äºŒä¹˜æ³•+L1èŒƒæ•°ï¼Œç­‰ä»·äºç­‰ä»·äºå½“é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„è¯¯å·®æ»¡è¶³æ­£æ€åˆ†å¸ƒï¼Œä¸”ä¸”æƒé‡å€¼æ»¡è¶³æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒï¼ˆå…ˆéªŒåˆ†å¸ƒï¼‰æ—¶çš„æœ€å¤§åéªŒä¼°è®¡ã€‚</p>
<h4 id="4-3-çº¿æ€§å›å½’çš„æ”¹è¿›-å²­å›å½’"><a href="#4-3-çº¿æ€§å›å½’çš„æ”¹è¿›-å²­å›å½’" class="headerlink" title="4.3 çº¿æ€§å›å½’çš„æ”¹è¿› - å²­å›å½’"></a>4.3 çº¿æ€§å›å½’çš„æ”¹è¿› - å²­å›å½’</h4><p>å²­å›å½’ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ç§çº¿æ€§å›å½’ã€‚åªä¸è¿‡åœ¨ç®—æ³•å»ºç«‹å›å½’æ–¹ç¨‹æ—¶å€™ï¼ŒåŠ ä¸ŠL2æ­£åˆ™åŒ–çš„é™åˆ¶ï¼Œä»è€Œè¾¾åˆ°è§£å†³è¿‡æ‹Ÿåˆçš„æ•ˆæœ</p>
<p>apiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.linear_model.Ridge(alpha=1.0, fit_intercept=True,solver=&quot;auto&quot;, normalize=False)</span><br><span class="line">å…·æœ‰l2æ­£åˆ™åŒ–çš„çº¿æ€§å›å½’</span><br><span class="line">alpha:æ­£åˆ™åŒ–åŠ›åº¦=æƒ©ç½šé¡¹ç³»æ•°ï¼Œä¹Ÿå« Î»</span><br><span class="line">Î»å–å€¼ï¼š0~1 1~10</span><br><span class="line">-fit_interceptï¼šæ˜¯å¦æ·»åŠ åç½®</span><br><span class="line">solver:ä¼šæ ¹æ®æ•°æ®è‡ªåŠ¨é€‰æ‹©ä¼˜åŒ–æ–¹æ³•</span><br><span class="line">-sag:å¦‚æœæ•°æ®é›†ã€ç‰¹å¾éƒ½æ¯”è¾ƒå¤§ï¼Œé€‰æ‹©è¯¥éšæœºæ¢¯åº¦ä¸‹é™ä¼˜åŒ–</span><br><span class="line">normalize:æ•°æ®æ˜¯å¦è¿›è¡Œæ ‡å‡†åŒ–</span><br><span class="line">-normalize=False:å¯ä»¥åœ¨fitä¹‹å‰è°ƒç”¨preprocessing.StandardScaleræ ‡å‡†åŒ–æ•°æ®</span><br><span class="line"></span><br><span class="line">æ¨¡å‹å‚æ•°ï¼š</span><br><span class="line">Ridge.coef_:å›å½’æƒé‡</span><br><span class="line">Ridge.intercept_:å›å½’åç½®</span><br></pre></td></tr></table></figure>

<p>Ridgeæ–¹æ³•ç›¸å½“äºSGDRegressor(penalty&#x3D;â€™l2â€™, loss&#x3D;â€squared_lossâ€),é»˜è®¤l2,åªä¸è¿‡SGDRegressorå®ç°äº†ä¸€ä¸ªæ™®é€šçš„éšæœºæ¢¯åº¦ä¸‹é™å­¦ä¹ ï¼Œæ¨èä½¿ç”¨Ridge(å®ç°äº†SAG)</p>
<p>æ­£åˆ™åŒ–åŠ›åº¦è¶Šå¤§ï¼Œæƒé‡ç³»æ•°ä¼šè¶Šå°<br>æ­£åˆ™åŒ–åŠ›åº¦è¶Šå°ï¼Œæƒé‡ç³»æ•°ä¼šè¶Šå¤§</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rd = Ridge(alpha=1.0)</span><br><span class="line"></span><br><span class="line">rd.fit(x_train, y_train)</span><br><span class="line">print(&quot;å²­å›å½’çš„æƒé‡å‚æ•°ä¸ºï¼š&quot;, rd.coef_)</span><br><span class="line"></span><br><span class="line">y_rd_predict = std_y.inverse_transform(rd.predict(x_test))</span><br><span class="line"></span><br><span class="line">print(&quot;å²­å›å½’çš„é¢„æµ‹çš„ç»“æœä¸ºï¼š&quot;, y_rd_predict)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(&quot;å²­å›å½’çš„å‡æ–¹è¯¯å·®ä¸ºï¼š&quot;, mean_squared_error(y_test, y_rd_predict))</span><br></pre></td></tr></table></figure>

<h4 id="4-4-åˆ†ç±»ï¼›åˆ†ç±»ç®—æ³•-é€»è¾‘å›å½’ä¸äºŒåˆ†ç±»"><a href="#4-4-åˆ†ç±»ï¼›åˆ†ç±»ç®—æ³•-é€»è¾‘å›å½’ä¸äºŒåˆ†ç±»" class="headerlink" title="4.4 åˆ†ç±»ï¼›åˆ†ç±»ç®—æ³•-é€»è¾‘å›å½’ä¸äºŒåˆ†ç±»"></a>4.4 åˆ†ç±»ï¼›åˆ†ç±»ç®—æ³•-é€»è¾‘å›å½’ä¸äºŒåˆ†ç±»</h4><p>é€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ç§åˆ†ç±»æ¨¡å‹ï¼Œé€»è¾‘å›å½’æ˜¯ä¸€ç§åˆ†ç±»ç®—æ³•ï¼Œè™½ç„¶åå­—ä¸­å¸¦æœ‰å›å½’ï¼Œä½†æ˜¯å®ƒä¸å›å½’ä¹‹é—´æœ‰ä¸€å®šçš„è”ç³»ã€‚ç”±äºç®—æ³•çš„ç®€å•å’Œé«˜æ•ˆï¼Œåœ¨å®é™…ä¸­åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼š<br>å¹¿å‘Šç‚¹å‡»ç‡<br>æ˜¯å¦ä¸ºåƒåœ¾é‚®ä»¶<br>æ˜¯å¦æ‚£ç—…<br>é‡‘èè¯ˆéª—<br>è™šå‡è´¦å·<br>éƒ½å±äºä¸¤ä¸ªç±»åˆ«ä¹‹é—´çš„åˆ¤æ–­ã€‚é€»è¾‘å›å½’å°±æ˜¯è§£å†³äºŒåˆ†ç±»é—®é¢˜çš„åˆ©å™¨</p>
<p>çº¿æ€§å›å½’çš„è¾“å‡º å°±æ˜¯ é€»è¾‘å›å½’ï¼ˆæ¿€æ´»å‡½æ•°ï¼‰çš„è¾“å…¥ã€‚</p>
<p>æ¿€æ´»å‡½æ•°sigmoidå‡½æ•°ï¼š<code>1/(1 + e^(-x))</code><br>å°†æŸä¸ªå‡½æ•°æ˜ å°„åˆ°0-1åŒºé—´ã€‚<br>å›å½’çš„ç»“æœè¾“å…¥åˆ°sigmoidå‡½æ•°å½“ä¸­<br>è¾“å‡ºç»“æœï¼š[0, 1]åŒºé—´ä¸­çš„ä¸€ä¸ªæ¦‚ç‡å€¼ï¼Œé»˜è®¤ä¸º0.5ä¸ºé˜ˆå€¼.</p>
<p>é€»è¾‘å›å½’æœ€ç»ˆçš„åˆ†ç±»æ˜¯é€šè¿‡å±äºæŸä¸ªç±»åˆ«çš„æ¦‚ç‡å€¼æ¥åˆ¤æ–­æ˜¯å¦å±äºæŸä¸ªç±»åˆ«ï¼Œå¹¶ä¸”è¿™ä¸ªç±»åˆ«é»˜è®¤æ ‡è®°ä¸º1(æ­£ä¾‹),å¦å¤–çš„ä¸€ä¸ªç±»åˆ«ä¼šæ ‡è®°ä¸º0(åä¾‹)ã€‚</p>
<p>éœ€è¦æ„å»ºæŸå¤±å‡½æ•°ï¼šï¼ˆå…ˆçº¿æ€§å›å½’ï¼Œå†sigmiodæ˜ å°„ä¸ºé€»è¾‘å›å½’ç»“æœï¼Œå†è®¡ç®—æŸå¤±å‡½æ•°ï¼‰<br>çº¿æ€§å›å½’çš„æŸå¤±å‡½æ•°ï¼š (y_predict - y_true)å¹³æ–¹å’Œ&#x2F;æ€»æ•°<br>é€»è¾‘å›å½’çš„çœŸå®å€¼&#x2F;é¢„æµ‹å€¼ï¼šæ˜¯å¦å±äºæŸä¸ªç±»åˆ«<br>æ‰€ä»¥ç”¨ï¼š<strong>å¯¹æ•°ä¼¼ç„¶æŸå¤±</strong>ï¼Œå®šä¹‰ä¸ºä¸€ä¸ªåˆ†æ®µå‡½æ•°ï¼ˆæ ¹æ®çœŸå®å€¼ï¼‰ï¼ŒçœŸå®å€¼ä¸º1æ—¶ï¼Œé¢„æµ‹è¶Šæ¥è¿‘1æŸå¤±è¶Šå°ã€‚</p>
<p>ä¼˜åŒ–ï¼š<br>åŒæ ·ä½¿ç”¨æ¢¯åº¦ä¸‹é™ä¼˜åŒ–ç®—æ³•ï¼Œå»å‡å°‘æŸå¤±å‡½æ•°çš„å€¼ã€‚è¿™æ ·å»æ›´æ–°é€»è¾‘å›å½’å‰é¢å¯¹åº”ç®—æ³•çš„æƒé‡å‚æ•°ï¼Œæå‡åŸæœ¬å±äº1ç±»åˆ«çš„æ¦‚ç‡ï¼Œé™ä½åŸæœ¬æ˜¯0ç±»åˆ«çš„æ¦‚ç‡ã€‚</p>
<p>apiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.linear_model.LogisticRegression(solver=&#x27;liblinear&#x27;, penalty=â€˜l2â€™, C = 1.0)</span><br><span class="line">solver:ä¼˜åŒ–æ±‚è§£æ–¹å¼ï¼ˆé»˜è®¤å¼€æºçš„liblinearåº“å®ç°ï¼Œå†…éƒ¨ä½¿ç”¨äº†åæ ‡è½´ä¸‹é™æ³•æ¥è¿­ä»£ä¼˜åŒ–æŸå¤±å‡½æ•°ï¼‰</span><br><span class="line">-sagï¼šæ ¹æ®æ•°æ®é›†è‡ªåŠ¨é€‰æ‹©ï¼Œéšæœºå¹³å‡æ¢¯åº¦ä¸‹é™</span><br><span class="line">penaltyï¼šæ­£åˆ™åŒ–çš„ç§ç±»(l2)</span><br><span class="line">Cï¼šæ­£åˆ™åŒ–åŠ›åº¦</span><br></pre></td></tr></table></figure>

<p>LogisticRegressionæ–¹æ³•ç›¸å½“äº SGDClassifier(loss&#x3D;â€logâ€, penalty&#x3D;â€ â€œ),SGDClassifierå®ç°äº†ä¸€ä¸ªæ™®é€šçš„éšæœºæ¢¯åº¦ä¸‹é™å­¦ä¹ ï¼Œä¹Ÿæ”¯æŒå¹³å‡éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼ˆASGDï¼‰ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®average&#x3D;Trueã€‚è€Œä½¿ç”¨LogisticRegression(å®ç°äº†SAG)</p>
<p>æ¡ˆä¾‹ï¼š<br>æµç¨‹ï¼š<br>1ï¼‰è·å–æ•°æ®<br>2ï¼‰æ•°æ®å¤„ç†-å¤„ç†ç¼ºå¤±å€¼<br>3ï¼‰æ•°æ®é›†åˆ’åˆ†<br>4ï¼‰ç‰¹å¾å·¥ç¨‹ï¼šæ— é‡çº²åŒ–å¤„ç†-æ ‡å‡†åŒ–<br>5ï¼‰é€»è¾‘å›å½’é¢„ä¼°å™¨<br>6ï¼‰æ¨¡å‹è¯„ä¼°</p>
<p>ç”¨jupyterå¯è§†åŒ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def logisticregression():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    é€»è¾‘å›å½’è¿›è¡Œç™Œç—‡é¢„æµ‹</span><br><span class="line">    :return: None</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 1ã€è¯»å–æ•°æ®ï¼Œå¤„ç†ç¼ºå¤±å€¼ä»¥åŠæ ‡å‡†åŒ–</span><br><span class="line">    column_name = [&#x27;Sample code number&#x27;, &#x27;Clump Thickness&#x27;, &#x27;Uniformity of Cell Size&#x27;, &#x27;Uniformity of Cell Shape&#x27;,</span><br><span class="line">                   &#x27;Marginal Adhesion&#x27;, &#x27;Single Epithelial Cell Size&#x27;, &#x27;Bare Nuclei&#x27;, &#x27;Bland Chromatin&#x27;,</span><br><span class="line">                   &#x27;Normal Nucleoli&#x27;, &#x27;Mitoses&#x27;, &#x27;Class&#x27;]</span><br><span class="line"></span><br><span class="line">    data = pd.read_csv(&quot;https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data&quot;,</span><br><span class="line">                       names=column_name)</span><br><span class="line"></span><br><span class="line">    # åˆ é™¤ç¼ºå¤±å€¼</span><br><span class="line">    data = data.replace(to_replace=&#x27;?&#x27;, value=np.nan)</span><br><span class="line"></span><br><span class="line">    data = data.dropna()</span><br><span class="line"></span><br><span class="line">    # å–å‡ºç‰¹å¾å€¼</span><br><span class="line">    x = data[column_name[1:10]]</span><br><span class="line"></span><br><span class="line">    y = data[column_name[10]]</span><br><span class="line"></span><br><span class="line">    # åˆ†å‰²æ•°æ®é›†</span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3)</span><br><span class="line"></span><br><span class="line">    # è¿›è¡Œæ ‡å‡†åŒ–</span><br><span class="line">    std = StandardScaler()</span><br><span class="line"></span><br><span class="line">    x_train = std.fit_transform(x_train)</span><br><span class="line"></span><br><span class="line">    x_test = std.transform(x_test)</span><br><span class="line"></span><br><span class="line">    # ä½¿ç”¨é€»è¾‘å›å½’</span><br><span class="line">    lr = LogisticRegression()</span><br><span class="line"></span><br><span class="line">    lr.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">    print(&quot;å¾—å‡ºæ¥çš„æƒé‡,å‡ ä¸ªç‰¹å¾æœ‰å‡ ä¸ªï¼š&quot;, lr.coef_)</span><br><span class="line"></span><br><span class="line">    # é¢„æµ‹ç±»åˆ«</span><br><span class="line">    print(&quot;é¢„æµ‹çš„ç±»åˆ«ï¼š&quot;, lr.predict(x_test))</span><br><span class="line"></span><br><span class="line">    # å¾—å‡ºå‡†ç¡®ç‡</span><br><span class="line">    print(&quot;é¢„æµ‹çš„å‡†ç¡®ç‡:&quot;, lr.score(x_test, y_test))</span><br><span class="line">    return None</span><br></pre></td></tr></table></figure>

<p>åœ¨å¾ˆå¤šåˆ†ç±»åœºæ™¯å½“ä¸­æˆ‘ä»¬ä¸ä¸€å®šåªå…³æ³¨é¢„æµ‹çš„å‡†ç¡®ç‡ï¼Œæ¯”å¦‚ä»¥è¿™ä¸ªç™Œç—‡ä¸¾ä¾‹å­ï¼ï¼ï¼æˆ‘ä»¬å¹¶ä¸å…³æ³¨é¢„æµ‹çš„å‡†ç¡®ç‡ï¼Œè€Œæ˜¯å…³æ³¨åœ¨æ‰€æœ‰çš„æ ·æœ¬å½“ä¸­ï¼Œç™Œç—‡æ‚£è€…æœ‰æ²¡æœ‰è¢«å…¨éƒ¨é¢„æµ‹ï¼ˆæ£€æµ‹ï¼‰å‡ºæ¥ã€‚</p>
<p>æƒ³è¦å…³æ³¨çš„ï¼šçœŸçš„æ‚£ç™Œç—‡çš„ï¼Œèƒ½å¤Ÿè¢«æ£€æµ‹å‡ºæ¥ã€‚</p>
<p>âœ…ç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼š<br>æ··æ·†çŸ©é˜µï¼š<br>åœ¨åˆ†ç±»ä»»åŠ¡ä¸‹ï¼Œé¢„æµ‹ç»“æœ(Predicted Condition)ä¸æ­£ç¡®æ ‡è®°(True Condition)ä¹‹é—´å­˜åœ¨å››ç§ä¸åŒçš„ç»„åˆï¼Œæ„æˆæ··æ·†çŸ©é˜µ(é€‚ç”¨äºå¤šåˆ†ç±»)<br>çœŸå®ç»“æœæ˜¯æ­£ä¾‹ï¼Œé¢„æµ‹ç»“æœæ˜¯æ­£ä¾‹ï¼šçœŸæ­£ä¾‹TP<br>çœŸå®ç»“æœæ˜¯æ­£ä¾‹ï¼Œé¢„æµ‹ç»“æœæ˜¯å‡ä¾‹ï¼šä¼ªåä¾‹FN<br>çœŸå®ç»“æœæ˜¯å‡ä¾‹ï¼Œé¢„æµ‹ç»“æœæ˜¯æ­£ä¾‹ï¼šä¼ªæ­£ä¾‹FP<br>çœŸå®ç»“æœæ˜¯å‡ä¾‹ï¼Œé¢„æµ‹ç»“æœæ˜¯å‡ä¾‹ï¼šçœŸåä¾‹TN</p>
<p>ç²¾ç¡®ç‡ï¼šé¢„æµ‹ç»“æœä¸ºæ­£ä¾‹æ ·æœ¬ä¸­çœŸå®ä¸ºæ­£ä¾‹çš„æ¯”ä¾‹ ï¼ˆTP&#x2F;TP+FPï¼‰<br>å¬å›ç‡ï¼šçœŸå®ä¸ºæ­£ä¾‹çš„æ ·æœ¬ä¸­é¢„æµ‹ç»“æœä¸ºæ­£ä¾‹çš„æ¯”ä¾‹ï¼ˆæŸ¥çš„å…¨ï¼Œå¯¹æ­£æ ·æœ¬çš„åŒºåˆ†èƒ½åŠ›ï¼‰ï¼ˆTP&#x2F;TP+FNï¼‰</p>
<hr>
<p>æ€»ç»“ï¼š<br>1.å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ‰€æœ‰é¢„æµ‹æ­£ç¡®çš„ï¼ˆåŒ…æ‹¬æ­£ç±»å’Œè´Ÿç±»ï¼‰å æ€»çš„çš„æ¯”ä¾‹ã€‚</p>
<p>2.ç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰ï¼ŒæŸ¥å‡†ç‡ã€‚å³æ­£ç¡®é¢„æµ‹ä¸ºæ­£ç±»çš„å å…¨éƒ¨é¢„æµ‹ä¸ºæ­£ç±»çš„çš„æ¯”ä¾‹ã€‚ä¸ªäººç†è§£ï¼šåœ¨æ‰€æœ‰é¢„æµ‹ä¸ºæ­£ç±»ä¸­çœŸæ­£ä¸ºæ­£ç±»çš„å æ‰€æœ‰é¢„æµ‹ä¸ºæ­£ç±»çš„çš„æ¯”ä¾‹ã€‚</p>
<p>3.å¬å›ç‡ï¼ˆRecallï¼‰ï¼ŒæŸ¥å…¨ç‡ã€‚å³æ­£ç¡®é¢„æµ‹ä¸ºæ­£ç±»çš„å å…¨éƒ¨å®é™…ä¸ºæ­£ç±»çš„çš„æ¯”ä¾‹ã€‚ä¸ªäººç†è§£ï¼šåœ¨æ‰€æœ‰é¢„æµ‹ä¸ºæ­£ç±»ä¸­çœŸæ­£ä¸ºæ­£ç±»çš„å æ€»ä½“å®é™…ä¸ºæ­£ç±»çš„çš„æ¯”ä¾‹ã€‚</p>
<p>å¯¹äºç²¾ç¡®ç‡å’Œå¬å”¤ç‡ï¼Œå…¶å®å°±æ˜¯åˆ†æ¯ä¸åŒï¼Œä¸€ä¸ªåˆ†æ¯æ˜¯é¢„æµ‹ä¸ºæ­£ç±»çš„æ ·æœ¬æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯åŸå§‹æ ·æœ¬ä¸­æ‰€æœ‰çš„æ­£ç±»æ ·æœ¬æ•°ã€‚</p>
<p>å¬å›ç‡ (Recall)ï¼šè¯¥ç±»æ ·æœ¬æœ‰å¤šå°‘è¢«æ‰¾å‡ºæ¥äº†ï¼ˆå¬å›äº†å¤šå°‘ï¼‰ã€‚</p>
<p>ç²¾ç¡®ç‡ (Precision)ï¼šä½ è®¤ä¸ºçš„è¯¥ç±»æ ·æœ¬ï¼Œæœ‰å¤šå°‘çŒœå¯¹äº†ï¼ˆçŒœçš„ç²¾ç¡®æ€§å¦‚ä½•ï¼‰ã€‚</p>
<p>å¬å›ç‡ï¼š<a href="https://blog.csdn.net/PingBryant/article/details/115561777">https://blog.csdn.net/PingBryant/article/details/115561777</a></p>
<hr>
<p>è¿˜æœ‰å…¶ä»–çš„è¯„ä¼°æ ‡å‡†ï¼ŒF1-scoreï¼Œåæ˜ äº†æ¨¡å‹çš„ç¨³å¥å‹<br>F1 &#x3D; 2TP&#x2F;(2TP + FN + FP) &#x3D; ï¼ˆ2<em>å‡†ç¡®ç‡</em>å¬å›ç‡ï¼‰&#x2F;ï¼ˆå‡†ç¡®ç‡+å¬å›ç‡ï¼‰</p>
<p>åˆ†ç±»è¯„ä¼°æŠ¥å‘Šapiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.metrics.classification_report(y_true, y_pred, labels=[], target_names=None )</span><br><span class="line">y_trueï¼šçœŸå®ç›®æ ‡å€¼</span><br><span class="line">y_predï¼šä¼°è®¡å™¨é¢„æµ‹ç›®æ ‡å€¼</span><br><span class="line">labels:æŒ‡å®šç±»åˆ«å¯¹åº”çš„æ•°å­—</span><br><span class="line">target_namesï¼šç›®æ ‡ç±»åˆ«åç§°</span><br><span class="line">returnï¼šæ¯ä¸ªç±»åˆ«ç²¾ç¡®ç‡ä¸å¬å›ç‡</span><br><span class="line"></span><br><span class="line">print(&quot;æ¯ä¸ªç‰¹å¾çš„ç²¾ç¡®ç‡å’Œå¬å›ç‡ä¸ºï¼š&quot;, classification_report(y_test, lr.predict(x_test), labels=[2, 4], target_names=[&#x27;è‰¯æ€§&#x27;, &#x27;æ¶æ€§&#x27;]))</span><br></pre></td></tr></table></figure>

<p>å‡è®¾è¿™æ ·ä¸€ä¸ªæƒ…å†µï¼Œå¦‚æœ99ä¸ªæ ·æœ¬ç™Œç—‡ï¼Œ1ä¸ªæ ·æœ¬éç™Œç—‡ï¼Œä¸ç®¡æ€æ ·æˆ‘å…¨éƒ½é¢„æµ‹æ­£ä¾‹(é»˜è®¤ç™Œç—‡ä¸ºæ­£ä¾‹),å‡†ç¡®ç‡å°±ä¸º99%ï¼Œå¬å›ç‡100%ä½†æ˜¯è¿™æ ·æ•ˆæœå¹¶ä¸å¥½ï¼Œè¿™å°±æ˜¯æ ·æœ¬ä¸å‡è¡¡ä¸‹çš„è¯„ä¼°é—®é¢˜ã€‚</p>
<p>ROCæ›²çº¿ä¸AUCæŒ‡æ ‡ï¼š</p>
<p>TPR &#x3D; TP &#x2F; (TP + FN)<br>æ‰€æœ‰çœŸå®ç±»åˆ«ä¸º1çš„æ ·æœ¬ä¸­ï¼Œé¢„æµ‹ç±»åˆ«ä¸º1çš„æ¯”ä¾‹ - å¬å›ç‡<br>FPR &#x3D; FP &#x2F; (FP + FN)<br>æ‰€æœ‰çœŸå®ç±»åˆ«ä¸º0çš„æ ·æœ¬ä¸­ï¼Œé¢„æµ‹ç±»åˆ«ä¸º1çš„æ¯”ä¾‹</p>
<p>ROCæ›²çº¿çš„æ¨ªè½´å°±æ˜¯FPRateï¼Œçºµè½´å°±æ˜¯TPRateï¼Œå½“äºŒè€…ç›¸ç­‰æ—¶ï¼Œè¡¨ç¤ºçš„æ„ä¹‰åˆ™æ˜¯ï¼šå¯¹äºä¸è®ºçœŸå®ç±»åˆ«æ˜¯1è¿˜æ˜¯0çš„æ ·æœ¬ï¼Œåˆ†ç±»å™¨é¢„æµ‹ä¸º1çš„æ¦‚ç‡æ˜¯ç›¸ç­‰çš„ï¼Œæ­¤æ—¶AUCä¸º0.5ã€‚</p>
<p>AUCå¦‚ä½•è®¡ç®—ï¼šROCæ›²çº¿å’Œåæ ‡è½´åŒ…å›´çš„é¢ç§¯ï¼Œå¦‚æœæ˜¯0ï¼Œ1ï¼Œé‚£å°±æ˜¯1.</p>
<p>AUCçš„æ¦‚ç‡æ„ä¹‰æ˜¯éšæœºå–ä¸€å¯¹æ­£è´Ÿæ ·æœ¬ï¼Œæ­£æ ·æœ¬å¾—åˆ†å¤§äºè´Ÿæ ·æœ¬çš„æ¦‚ç‡<br>AUCçš„æœ€å°å€¼ä¸º0.5ï¼Œæœ€å¤§å€¼ä¸º1ï¼Œå–å€¼è¶Šé«˜è¶Šå¥½<br>AUC&#x3D;1ï¼Œå®Œç¾åˆ†ç±»å™¨ï¼Œé‡‡ç”¨è¿™ä¸ªé¢„æµ‹æ¨¡å‹æ—¶ï¼Œä¸ç®¡è®¾å®šä»€ä¹ˆé˜ˆå€¼éƒ½èƒ½å¾—å‡ºå®Œç¾é¢„æµ‹ã€‚ç»å¤§å¤šæ•°é¢„æµ‹çš„åœºåˆï¼Œä¸å­˜åœ¨å®Œç¾åˆ†ç±»å™¨ã€‚<br>0.5&lt;AUC&lt;1ï¼Œä¼˜äºéšæœºçŒœæµ‹ã€‚è¿™ä¸ªåˆ†ç±»å™¨ï¼ˆæ¨¡å‹ï¼‰å¦¥å–„è®¾å®šé˜ˆå€¼çš„è¯ï¼Œèƒ½æœ‰é¢„æµ‹ä»·å€¼ã€‚<br>æœ€ç»ˆAUCçš„èŒƒå›´åœ¨[0.5, 1]ä¹‹é—´ï¼Œå¹¶ä¸”è¶Šæ¥è¿‘1è¶Šå¥½</p>
<p>AUCè®¡ç®—apiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from sklearn.metrics import roc_auc_score</span><br><span class="line">sklearn.metrics.roc_auc_score(y_true, y_score)</span><br><span class="line">è®¡ç®—ROCæ›²çº¿é¢ç§¯ï¼Œå³AUCå€¼</span><br><span class="line">y_true:æ¯ä¸ªæ ·æœ¬çš„çœŸå®ç±»åˆ«ï¼Œå¿…é¡»ä¸º0(åä¾‹),1(æ­£ä¾‹)æ ‡è®°</span><br><span class="line">y_score:æ¯ä¸ªæ ·æœ¬é¢„æµ‹çš„æ¦‚ç‡å€¼</span><br><span class="line"></span><br><span class="line">0.5~1ä¹‹é—´ï¼Œè¶Šæ¥è¿‘äº1çº¦å¥½</span><br><span class="line">y_test = np.where(y_test &gt; 2.5, 1, 0)</span><br><span class="line"></span><br><span class="line">print(&quot;AUCæŒ‡æ ‡ï¼š&quot;, roc_auc_score(y_test, lr.predict(x_test)))</span><br></pre></td></tr></table></figure>

<p>AUCåªèƒ½ç”¨æ¥è¯„ä»·äºŒåˆ†ç±»<br>AUCéå¸¸é€‚åˆè¯„ä»·æ ·æœ¬ä¸å¹³è¡¡ä¸­çš„åˆ†ç±»å™¨æ€§èƒ½.</p>
<h4 id="4-5-æ¨¡å‹ä¿å­˜å’ŒåŠ è½½"><a href="#4-5-æ¨¡å‹ä¿å­˜å’ŒåŠ è½½" class="headerlink" title="4.5 æ¨¡å‹ä¿å­˜å’ŒåŠ è½½"></a>4.5 æ¨¡å‹ä¿å­˜å’ŒåŠ è½½</h4><p>å½“è®­ç»ƒæˆ–è€…è®¡ç®—å¥½ä¸€ä¸ªæ¨¡å‹ä¹‹åï¼Œé‚£ä¹ˆå¦‚æœåˆ«äººéœ€è¦æˆ‘ä»¬æä¾›ç»“æœé¢„æµ‹ï¼Œå°±éœ€è¦ä¿å­˜æ¨¡å‹ï¼ˆä¸»è¦æ˜¯ä¿å­˜ç®—æ³•çš„å‚æ•°ï¼‰</p>
<p>sklearnæ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½API:(æ¨¡å‹åºåˆ—åŒ–åˆ°æœ¬åœ°)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from sklearn.externals import joblib</span><br><span class="line">ä¿å­˜ï¼šjoblib.dump(rf, &#x27;test.pkl&#x27;)</span><br><span class="line">åŠ è½½ï¼šestimator = joblib.load(&#x27;test.pkl&#x27;)</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> ä½¿ç”¨çº¿æ€§æ¨¡å‹è¿›è¡Œé¢„æµ‹</span><br><span class="line"> ä½¿ç”¨æ­£è§„æ–¹ç¨‹æ±‚è§£</span><br><span class="line">lr = LinearRegression()</span><br><span class="line">lr.fit(x_train, y_train)</span><br><span class="line">ä¿å­˜è®­ç»ƒå®Œç»“æŸçš„æ¨¡å‹</span><br><span class="line">joblib.dump(lr, &quot;test.pkl&quot;)</span><br></pre></td></tr></table></figure>

<p>åŠ è½½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é€šè¿‡å·²æœ‰çš„æ¨¡å‹å»é¢„æµ‹æˆ¿ä»·</span><br><span class="line">model = joblib.load(&quot;test.pkl&quot;)</span><br><span class="line">print(&quot;ä»æ–‡ä»¶åŠ è½½è¿›æ¥çš„æ¨¡å‹é¢„æµ‹æˆ¿ä»·çš„ç»“æœï¼š&quot;, std_y.inverse_transform(model.predict(x_test)))</span><br></pre></td></tr></table></figure>


<h4 id="4-6-æ— ç›‘ç£å­¦ä¹ -K-means"><a href="#4-6-æ— ç›‘ç£å­¦ä¹ -K-means" class="headerlink" title="4.6 æ— ç›‘ç£å­¦ä¹  K-means"></a>4.6 æ— ç›‘ç£å­¦ä¹  K-means</h4><p>æ²¡æœ‰ç›®æ ‡å€¼ - æ— ç›‘ç£å­¦ä¹ </p>
<p>èšç±»ï¼šK-means(Kå‡å€¼èšç±»)<br>é™ç»´ï¼šPCA</p>
<p>K-meansèšç±»æ­¥éª¤ï¼š<br>1ã€éšæœºè®¾ç½®Kä¸ªç‰¹å¾ç©ºé—´å†…çš„ç‚¹ä½œä¸ºåˆå§‹çš„èšç±»ä¸­å¿ƒ<br>2ã€å¯¹äºå…¶ä»–æ¯ä¸ªç‚¹è®¡ç®—åˆ°Kä¸ªä¸­å¿ƒçš„è·ç¦»ï¼ŒæœªçŸ¥çš„ç‚¹é€‰æ‹©æœ€è¿‘çš„ä¸€ä¸ªèšç±»ä¸­å¿ƒç‚¹ä½œä¸ºæ ‡è®°ç±»åˆ«<br>3ã€æ¥ç€å¯¹ç€æ ‡è®°çš„èšç±»ä¸­å¿ƒä¹‹åï¼Œé‡æ–°è®¡ç®—å‡ºæ¯ä¸ªèšç±»çš„æ–°ä¸­å¿ƒç‚¹ï¼ˆå¹³å‡å€¼ï¼‰<br>4ã€å¦‚æœè®¡ç®—å¾—å‡ºçš„æ–°ä¸­å¿ƒç‚¹ä¸åŸä¸­å¿ƒç‚¹ä¸€æ ·ï¼Œé‚£ä¹ˆç»“æŸï¼Œå¦åˆ™é‡æ–°è¿›è¡Œç¬¬äºŒæ­¥è¿‡ç¨‹</p>
<p>K-è¶…å‚æ•°<br>1ï¼‰çœ‹éœ€æ±‚ï¼Œè¦åˆ†ä¸ºå¤šå°‘å †<br>2ï¼‰è°ƒèŠ‚è¶…å‚æ•°</p>
<p>apiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.cluster.KMeans(n_clusters=8,init=â€˜k-means++â€™)</span><br><span class="line">k-meansèšç±»</span><br><span class="line">n_clusters:å¼€å§‹çš„èšç±»ä¸­å¿ƒæ•°é‡ï¼Œkå€¼</span><br><span class="line">init:åˆå§‹åŒ–æ–¹æ³•ï¼Œé»˜è®¤ä¸º&#x27;k-means ++â€™</span><br><span class="line">labels_:é»˜è®¤æ ‡è®°çš„ç±»å‹ï¼Œå¯ä»¥å’ŒçœŸå®å€¼æ¯”è¾ƒï¼ˆä¸æ˜¯å€¼æ¯”è¾ƒï¼‰</span><br><span class="line"></span><br><span class="line">cust = data[:500]</span><br><span class="line">km = KMeans(n_clusters=4)</span><br><span class="line">km.fit(cust)</span><br><span class="line">pre = km.predict(cust)</span><br></pre></td></tr></table></figure>

<p>Kmeansæ€§èƒ½è¯„ä¼°æŒ‡æ ‡ï¼š<br>è½®å»“ç³»æ•°ï¼Œç±»ä¼¼è®¾è®¡æ¨¡å¼ä¸­çš„é«˜å†…èšä½è€¦åˆã€‚<br>å†…éƒ¨è·ç¦»æœ€å°åŒ–ï¼Œå¤–éƒ¨è·ç¦»æœ€å¤§åŒ–ã€‚<br><code>SCi = (bi - ai)/max(bi,ai)</code><br>å¯¹äºæ¯ä¸ªç‚¹i ä¸ºå·²èšç±»æ•°æ®ä¸­çš„æ ·æœ¬ ï¼Œb_i ä¸ºi åˆ°å…¶å®ƒæ—ç¾¤çš„æ‰€æœ‰æ ·æœ¬çš„è·ç¦»æœ€å°å€¼ï¼Œa_i ä¸ºi åˆ°æœ¬èº«ç°‡çš„è·ç¦»å¹³å‡å€¼ã€‚æœ€ç»ˆè®¡ç®—å‡ºæ‰€æœ‰çš„æ ·æœ¬ç‚¹çš„è½®å»“ç³»æ•°å¹³å‡å€¼</p>
<p>å¦‚æœb_i&gt;&gt;a_i:è¶‹è¿‘äº1æ•ˆæœè¶Šå¥½ï¼Œ b_i&lt;&lt;a_i:è¶‹è¿‘äº-1ï¼Œæ•ˆæœä¸å¥½ã€‚è½®å»“ç³»æ•°çš„å€¼æ˜¯ä»‹äº [-1,1] ï¼Œè¶Šè¶‹è¿‘äº1ä»£è¡¨å†…èšåº¦å’Œåˆ†ç¦»åº¦éƒ½ç›¸å¯¹è¾ƒä¼˜ã€‚</p>
<p>è½®å»“ç³»æ•°apiï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sklearn.metrics.silhouette_score(X, labels)</span><br><span class="line">è®¡ç®—æ‰€æœ‰æ ·æœ¬çš„å¹³å‡è½®å»“ç³»æ•°</span><br><span class="line">Xï¼šç‰¹å¾å€¼</span><br><span class="line">labelsï¼šè¢«èšç±»æ ‡è®°çš„ç›®æ ‡å€¼</span><br></pre></td></tr></table></figure>

<p>K-meansä¼˜ç¼ºç‚¹ï¼š<br>ç‰¹ç‚¹åˆ†æï¼šé‡‡ç”¨è¿­ä»£å¼ç®—æ³•ï¼Œç›´è§‚æ˜“æ‡‚å¹¶ä¸”éå¸¸å®ç”¨<br>ç¼ºç‚¹ï¼šå®¹æ˜“æ”¶æ•›åˆ°å±€éƒ¨æœ€ä¼˜è§£(å¤šæ¬¡èšç±»)<br>åº”ç”¨åœºæ™¯ï¼šæ²¡æœ‰ç›®æ ‡å€¼çš„åˆ†ç±»ï¼Œåšåœ¨åˆ†ç±»ä¹‹å‰ã€‚</p>
<h4 id="4-7-æ€»ç»“"><a href="#4-7-æ€»ç»“" class="headerlink" title="4.7 æ€»ç»“"></a>4.7 æ€»ç»“</h4><p>1.çº¿æ€§å›å½’ - çº¿æ€§æ¨¡å‹ - çº¿æ€§å…³ç³»ï¼šy&#x3D;w1x1+w2x2+â€¦+wnxn+bã€‚æ„å»ºæŸå¤±å‡½æ•°-æœ€å°äºŒä¹˜æ³•&#x2F;å‡æ–¹è¯¯å·®ã€‚ä¼˜åŒ–æŸå¤±ï¼šæ­£è§„æ–¹ç¨‹ï¼ˆçŸ©é˜µç›¸ä¹˜ç›´æ¥æ±‚è§£ï¼‰ï¼Œæ¢¯åº¦ä¸‹é™ï¼ˆä¸æ–­è¯•é”™ï¼Œä¸æ–­è¿­ä»£ï¼‰ã€‚æ¨¡å‹è¯„ä¼°ï¼šå‡æ–¹è¯¯å·®ã€‚<br>2.è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆï¼Œè¿‡æ‹Ÿåˆï¼šæ¨¡å‹è¿‡äºå¤æ‚ - æ­£åˆ™åŒ–ï¼ˆç”¨L2ï¼‰ã€‚æ¬ æ‹Ÿåˆï¼šæ¨¡å‹è¿‡äºç®€å• - å¢åŠ æ•°æ®ã€ç‰¹å¾ã€‚<br>3.å²­å›å½’ï¼Œæ­£åˆ™åŒ–åŠ›åº¦å¯¹æ¨¡å‹å‚æ•°çš„å½±å“ã€‚<br>4.é€»è¾‘å›å½’ï¼Œç”¨äºåˆ†ç±»ï¼Œè¾“å…¥æ˜¯çº¿æ€§å›å½’çš„è¾“å‡ºï¼Œæ”¾å…¥æ¿€æ´»å‡½æ•°sigmoidä¸­ã€‚æŸå¤±å‡½æ•°ï¼šå¯¹æ•°ä¼¼ç„¶å‡½æ•°ã€‚ä¼˜åŒ–æŸå¤±ï¼šæ¢¯åº¦ä¸‹é™ã€‚äºŒåˆ†ç±»çš„æ¨¡å‹è¯„ä¼°ï¼šå¬å›ç‡ï¼Œæ ·æœ¬ä¸å‡è¡¡æ—¶ä½¿ç”¨AUCæŒ‡æ ‡ï¼Œæ¥è¿‘0.5å°±ä¸å¥½ã€‚<br>5.ä¿å­˜å’ŒåŠ è½½æ¨¡å‹<br>6.K-Meansï¼Œèšç±»çš„æ­¥éª¤ï¼Œæ¨¡å‹è¯„ä¼°ï¼šç”¨è½®å»“ç³»æ•°[-1,1]</p>
<h2 id="çœ‹å›¾è¯´è¯"><a href="#çœ‹å›¾è¯´è¯" class="headerlink" title="çœ‹å›¾è¯´è¯"></a>çœ‹å›¾è¯´è¯</h2><p>ä»€ä¹ˆæ˜¯ç‰¹å¾ï¼šå›¾åƒçš„åƒç´ ã€åŒºåŸŸã€‚å•è¯çš„ç‰¹æ€§ï¼Œç­‰å¯ä»¥è¢«åŒºåˆ«äºå…¶ä»–å›¾åƒçš„åœ°æ–¹ï¼Œå¹¶ä¸”å¯ä»¥ç»è¿‡å‘é‡åŒ–çš„è®¡ç®—è¢«æ¨¡å‹æ‰€è·å–ã€‚</p>
<p>CNNæ ¸å‡½æ•° - å¾—åˆ°å‘é‡ä¸€ç‰‡åŒºåŸŸçš„ç›¸å…³ç‰¹æ€§<br>ç¼–ç å™¨ï¼šä¾‹å¦‚Faster-RCNNï¼Œyoloï¼ŒæŠŠæ–‡æœ¬æˆ–å›¾åƒçš„ç‰¹å¾åšå‘é‡åŒ–çš„å¤„ç†<br>è§£ç å™¨ï¼šCNN-LSTMã€‚Transformerï¼ŒæŠŠå‘é‡åŒ–å¤„ç†åçš„ç‰¹å¾åšè¯­ä¹‰è¯†åˆ«ã€åˆ†å‰²ç­‰æ“ä½œï¼Œå¹¶è¾“å‡ºã€‚</p>
<p>å›¾ç‰‡å‘é‡åŒ–ã€ç¼–ç å™¨ï¼ˆç”Ÿæˆè®¡ç®—æœºå¯ä»¥ç†è§£çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼‰ã€è§£ç å™¨ã€æ–‡æœ¬å‘é‡åŒ–</p>
<p>çœ‹å›¾è¯´è¯ï¼šç”¨ç¼–ç å™¨Faster-RCNNä»å›¾åƒä¸­æå–å¯¹è±¡ï¼Œç”¨è§£ç å™¨ç”Ÿæˆä¸€å¥è¯å›¾åƒè¡¨è¾¾</p>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>MachineLearning</tag>
      </tags>
  </entry>
  <entry>
    <title>è¥¿ç“œä¹¦</title>
    <url>/2025/02/12/myblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E8%A5%BF%E7%93%9C%E4%B9%A6/</url>
    <content><![CDATA[<h1 id="ç¬¬ä¸€ç« -ç»ªè®º"><a href="#ç¬¬ä¸€ç« -ç»ªè®º" class="headerlink" title="ç¬¬ä¸€ç«  ç»ªè®º"></a>ç¬¬ä¸€ç«  ç»ªè®º</h1><ul>
<li>ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼šåœ¨è®¡ç®—æœºä¸Šä»æ•°æ®ä¸­äº§ç”Ÿæ¨¡å‹çš„ç®—æ³•ï¼Œå³å­¦ä¹ ç®—æ³•ã€‚è®¡ç®—æœºç§‘å­¦æ˜¯ç ”ç©¶å…³äºç®—æ³•çš„å­¦é—®ï¼Œæœºå™¨å­¦ä¹ æ˜¯ç ”ç©¶å…³äºå­¦ä¹ ç®—æ³•çš„å­¦é—®ã€‚</li>
<li>åŸºæœ¬æœ¯è¯­ï¼šæ ·æœ¬çš„é›†åˆ-æ•°æ®é›†ï¼Œå±æ€§å¼ æˆçš„ç©ºé—´-å±æ€§ç©ºé—´&#x2F;æ ·æœ¬ç©ºé—´ï¼Œä¸€ä¸ªæ ·æœ¬åœ¨åæ ‡è½´ä¸Šè¡¨ç¤º-ç‰¹å¾å‘é‡ï¼Œä¸€ä¸ªæ ·æœ¬çš„ç‰¹å¾æ•°-ç»´æ•°ã€‚èšç±»ï¼šå°†æ ·æœ¬åˆ†ç°‡ï¼Œå­¦ä¹ è¿‡ç¨‹ä¸­ä½¿ç”¨çš„è®­ç»ƒæ ·æœ¬æ— æ ‡è®°ä¿¡æ¯ã€‚è®­ç»ƒæ•°æ®æ— æ ‡è®°ä¿¡æ¯-æ— ç›‘ç£å­¦ä¹ ï¼šèšç±»ä¸ºä»£è¡¨ã€‚ç›‘ç£å­¦ä¹ ï¼šå›å½’åˆ†ç±»ä¸ºä»£è¡¨ã€‚æ¨¡å‹é€‚ç”¨äºæ–°æ ·æœ¬çš„èƒ½åŠ›ï¼Œé€‚ç”¨äºæ•´ä¸ªæ ·æœ¬ç©ºé—´-æ³›åŒ–èƒ½åŠ›ã€‚</li>
<li>å½’çº³ï¼šä»ç‰¹æ®Šåˆ°ä¸€èˆ¬çš„æ³›åŒ–è¿‡ç¨‹ã€‚æ¼”ç»ï¼šä»ä¸€èˆ¬åˆ°ç‰¹æ®Šçš„ç‰¹åŒ–è¿‡ç¨‹ã€‚</li>
<li>å¹¿ä¹‰çš„å½’çº³å­¦ä¹ ç›¸å½“äºä»æ ·æœ¬ä¸­å­¦ä¹ ï¼Œç‹­ä¹‰çš„å½’çº³å­¦ä¹ è¦æ±‚ä»è®­ç»ƒæ•°æ®ä¸­å­¦å¾—æ¦‚å¿µï¼Œæ¦‚å¿µå­¦ä¹ ã€‚å­¦å¾—æ³›åŒ–æ€§èƒ½å¥½åˆè¯­ä¹‰æ˜ç¡®çš„æ¦‚å¿µå¤ªå›°éš¾ï¼Œå¸¸ç”¨çš„æŠ€æœ¯æ˜¯äº§ç”Ÿé»‘ç®±æ¨¡å‹ã€‚ä»æ ·ä¾‹ä¸­å­¦ä¹ å°±æ˜¯å¹¿ä¹‰çš„å½’çº³å­¦ä¹ ã€‚</li>
<li>å‡è®¾ç©ºé—´ï¼šæŒ‡æ¨¡å‹å¯èƒ½å­¦ä¹ åˆ°çš„æ‰€æœ‰å‡½æ•°æˆ–è§£çš„é›†åˆã€‚å­¦ä¹ è¿‡ç¨‹å¯ä»¥çœ‹ä½œåœ¨æ‰€æœ‰å‡è®¾ç»„æˆçš„ç©ºé—´ä¸­è¿›è¡Œæœç´¢çš„è¿‡ç¨‹ï¼Œå­¦ä¹ å¾—åˆ°çš„æ¨¡å‹å¯¹åº”äº†å‡è®¾ç©ºé—´ä¸­çš„ä¸€ä¸ªå‡è®¾ã€‚å­˜åœ¨ä¸è®­ç»ƒé›†ä¸€è‡´çš„å‡è®¾é›†åˆï¼Œç§°ä¸ºç‰ˆæœ¬ç©ºé—´ï¼Œå…¶ä¸­å¯èƒ½å¤šä¸ªå‡è®¾ç©ºé—´ã€‚</li>
<li>æœºå™¨å­¦ä¹ ç®—æ³•åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å¯¹æŸç§ç±»å‹å‡è®¾çš„åå¥½ï¼Œç§°ä¸ºå½’çº³åå¥½ã€‚ä»»ä½•æœ‰æ•ˆçš„æœºå™¨å­¦ä¹ ç®—æ³•éƒ½æœ‰å½’çº³åå¥½ï¼Œå¦åˆ™æ— æ³•äº§ç”Ÿç¡®å®šçš„å­¦ä¹ ç»“æœã€‚å¥¥å¡å§†å‰ƒåˆ€ï¼šé€‰æ‹©æœ€ç®€å•çš„ã€‚å®é™…ä¸Šï¼Œé€‰æ‹©ä¸é—®é¢˜ç›¸åŒ¹é…çš„å½’çº³åå¥½ï¼Œæ‰ä¼šèµ·å†³å®šæ€§ä½œç”¨ã€‚</li>
<li>äººå·¥æ™ºèƒ½å‘å±•å†ç¨‹ï¼šæ¨ç†æœŸï¼ˆé€»è¾‘æ¨ç†èƒ½åŠ›ï¼‰ - çŸ¥è¯†æœŸï¼ˆä¸“å®¶ç³»ç»Ÿï¼ŒäººæŠŠçŸ¥è¯†æ€»ç»“å†æ•™ç»™è®¡ç®—æœºï¼‰- æœºå™¨å­¦ä¹ ï¼ˆç ”ç©¶æœ€å¤šçš„æ˜¯ä»æ ·ä¾‹ä¸­å­¦ä¹ ï¼Œå¹¿ä¹‰çš„å½’çº³å­¦ä¹ ï¼‰ã€‚æœºå™¨å­¦ä¹ ï¼šç¬¦å·ä¸»ä¹‰å­¦ä¹ ï¼ˆå†³ç­–æ ‘å’ŒåŸºäºé€»è¾‘çš„å­¦ä¹ ï¼Œå†³ç­–æ ‘å­¦ä¹ ä»¥ä¿¡æ¯è®ºä¸ºåŸºç¡€ï¼Œä»¥ä¿¡æ¯ç†µæœ€å°åŒ–ä¸ºç›®æ ‡ï¼Œæ¨¡æ‹Ÿäº†äººç±»å¯¹æ¦‚å¿µè¿›è¡Œåˆ¤å®šçš„æ ‘å½¢æµç¨‹ï¼Œç®€å•æ˜“ç”¨ã€‚ä½†æ˜¯é€»è¾‘å­¦ä¹ è¡¨ç¤ºèƒ½åŠ›å¤ªå¼ºï¼Œå‡è®¾ç©ºé—´å¤ªå¤§ï¼Œå¤æ‚åº¦é«˜é—®é¢˜è§„æ¨¡å¤§ï¼‰- åŸºäºç¥ç»ç½‘ç»œçš„è¿æ¥ä¸»ä¹‰å­¦ä¹ ï¼ˆä¸ç¬¦å·ä¸»ä¹‰äº§ç”Ÿæ˜ç¡®æ¦‚å¿µä¸åŒï¼Œè¿æ¥ä¸»ä¹‰äº§ç”Ÿçš„æ˜¯é»‘ç®±æ¨¡å‹ï¼Œæœ€å¤§çš„å±€é™æ€§æ˜¯è¯•é”™æ€§ï¼Œå‚æ•°è°ƒèŠ‚å¯¹ç»“æœå½±å“å¾ˆå¤§ï¼‰- ç»Ÿè®¡å­¦ä¹ ï¼ˆæ”¯æŒå‘é‡æœºSVMå’Œæ ¸æ–¹æ³•ï¼‰ - è¿æ¥ä¸»ä¹‰å¸¦ç€æ·±åº¦å­¦ä¹ å·åœŸé‡æ¥ï¼ˆå¾ˆå¤šå±‚çš„ç¥ç»ç½‘ç»œï¼Œæ¨¡å‹å¤æ‚åº¦é«˜ï¼Œä½†æ˜¯ä¸‹åŠŸå¤«è°ƒå‚ï¼Œæ€§èƒ½å°±èƒ½å¥½ï¼‰</li>
<li>æ•°æ®æŒ–æ˜æ˜¯ä»æµ·é‡æ•°æ®ä¸­å‘æ˜çŸ¥è¯†ï¼Œæ•°æ®åº“é¢†åŸŸä¸ºæ•°æ®æŒ–æ˜æä¾›æ•°æ®ç®¡ç†æŠ€æœ¯ï¼Œæœºå™¨å­¦ä¹ å’Œç»Ÿè®¡å­¦çš„ç ”ç©¶ä¸ºæ•°æ®æŒ–æ˜æä¾›æ•°æ®åˆ†è®¸æŠ€æœ¯ã€‚</li>
<li>è¨ç¼ªå°”ï¼Œè·³æ£‹ç¨‹åºã€‚æå‡ºæœºå™¨å­¦ä¹ ï¼Œæ˜¯ä¸æ˜¾å¼ç¼–ç¨‹åœ°èµ‹äºˆè®¡ç®—æœºèƒ½åŠ›çš„ç ”ç©¶ã€‚</li>
</ul>
<h1 id="ç¬¬äºŒç« -æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹©"><a href="#ç¬¬äºŒç« -æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹©" class="headerlink" title="ç¬¬äºŒç«  æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹©"></a>ç¬¬äºŒç«  æ¨¡å‹è¯„ä¼°ä¸é€‰æ‹©</h1><ul>
<li>è¯¯å·®ï¼šè®­ç»ƒè¯¯å·®æˆ–ç»éªŒè¯¯å·®ï¼šå­¦ä¹ å™¨åœ¨è®­ç»ƒé›†ä¸Šçš„è¯¯å·®ï¼›æ³›åŒ–è¯¯å·®ï¼šå­¦ä¹ å™¨åœ¨æ–°æ ·æœ¬ä¸Šçš„è¯¯å·®ã€‚</li>
<li>è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆï¼šè¿‡æ‹Ÿåˆæ˜¯ç”±äºå­¦ä¹ èƒ½åŠ›è¿‡äºå¼ºå¤§,ä»¥è‡³äºæŠŠè®­ç»ƒæ ·æœ¬æ‰€åŒ…å«çš„ä¸å¤ªä¸€èˆ¬çš„ç‰¹æ€§éƒ½å­¦åˆ°äº†ï¼ˆæ— æ³•å®Œå…¨é¿å…ï¼‰ï¼›æ¬ æ‹Ÿåˆæ˜¯ç”±äºå­¦ä¹ èƒ½åŠ›ä½ä¸‹è€Œé€ æˆçš„ï¼ˆç¥ç»ç½‘ç»œä¸­å¢åŠ è®­ç»ƒè½®æ¬¡ï¼‰ã€‚</li>
<li>è¯„ä¼°æ–¹æ³•ï¼šæ³›åŒ–è¯¯å·®æ— æ³•ç›´æ¥è·å¾—ï¼Œæµ‹è¯•é›†ä¸Šçš„æµ‹è¯•è¯¯å·®ä½œä¸ºæ³›åŒ–è¯¯å·®çš„è¿‘ä¼¼ã€‚1ã€ç•™å‡ºæ³•ï¼š ç›´æ¥å°†æ•°æ®åˆ’åˆ†ä¸ºä¸¤ä¸ªäº’æ–¥é›†åˆï¼Œ<strong>ä¸€ä¸ªé›†åˆä½œä¸ºè®­ç»ƒé›†ï¼Œå¦ä¸€ä¸ªä½œä¸ºäº’æ–¥é›†</strong>ï¼Œè‹¥å¹²æ¬¡éšæœºåˆ’åˆ†ã€‚2ã€äº¤å‰éªŒè¯æ³•ï¼šå…ˆå°†æ•°æ®é›†åˆ’åˆ†ä¸º<strong>k</strong>ä¸ªå¤§å°ç›¸ä¼¼çš„äº’æ–¥å­é›†ï¼Œæ¯æ¬¡ç”¨<strong>k-1</strong>ä¸ªå­é›†çš„å¹¶é›†ä½œä¸ºè®­ç»ƒé›†ï¼Œä½™ä¸‹é‚£ä¸ªå­é›†ä½œä¸ºæµ‹è¯•é›†ã€‚kæŠ˜äº¤å‰éªŒè¯ï¼Œpæ¬¡éšæœºåˆ’åˆ†ï¼Œpæ¬¡kæŠ˜äº¤å‰éªŒè¯ã€‚3ã€è‡ªåŠ©æ³•ï¼šæ¯æ¬¡ä»æ•°æ®é›†Dä¸­æŒ‘é€‰ä¸€ä¸ªæ ·æœ¬ï¼Œå†å°†è¯¥æ ·æœ¬æ”¾å›åˆå§‹æ•°æ®é›†Dä¸­ï¼Œé‡å¤mæ¬¡ï¼Œå¾—åˆ°åŒ…å«mä¸ªæ ·æœ¬çš„æ•°æ®é›†Dâ€™ã€‚åˆå§‹æ•°æ®é›†Dä¸­çº¦æœ‰36.8%çš„æ ·æœ¬æœªå‡ºç°åœ¨Dâ€™ä¸­ã€‚å°æ•°æ®é›†ä¸­æœ‰ç”¨ï¼Œä½†æ˜¯è‡ªåŠ©æ³•äº§ç”Ÿçš„æ•°æ®é›†æ”¹å˜äº†åˆå§‹æ•°æ®é›†çš„åˆ†å¸ƒã€‚</li>
<li>æ€§èƒ½åº¦é‡ï¼šæŸ¥å‡†ç‡ï¼šæ‰€é¢„æµ‹çš„æ­£ä¾‹æœ‰å¤šå°‘æ˜¯æ­£ç¡®çš„æ¦‚ç‡ï¼›æŸ¥å…¨ç‡ï¼šåœ¨çœŸå®æ­£ä¾‹æ¡ä»¶ä¸‹ï¼Œæœ‰å¤šå°‘æ­£ä¾‹è¢«é¢„æµ‹å‡ºæ¥ã€‚</li>
<li>P-Ræ›²çº¿ï¼šä»¥æŸ¥å…¨ç‡ä¸ºæ¨ªåæ ‡ï¼ŒæŸ¥å‡†ç‡ä¸ºçºµåæ ‡ã€‚</li>
<li>å‡ºç°äº¤ç‚¹æ—¶ï¼Œå¼•å…¥å¹³è¡¡ç‚¹(Break-Event Point, BEP)æ¥åº¦é‡å­¦ä¹ å™¨çš„ä¼˜åŠ£ã€‚æ˜¯æŸ¥å‡†ç‡&#x3D;æŸ¥å…¨ç‡æ—¶çš„å–å€¼ã€‚Pæ˜¯æŸ¥å‡†ç‡ï¼ŒRæ˜¯æŸ¥å…¨ç‡ã€‚è°ƒæ•´é˜ˆå€¼å®ç°å˜åŒ–çš„ã€‚</li>
<li>F1åº¦é‡ï¼šè°ƒå’Œå¹³å‡ï¼ŒF1 &#x3D; 2<em>P</em>R&#x2F;(P+R)ã€‚ä¸ºè¡¨è¾¾å¯¹På’ŒRçš„åå¥½ï¼Œå¼•å…¥è´å¡”ï¼ŒF1åº¦é‡çš„ä¸€èˆ¬å½¢å¼ã€‚</li>
<li>ROCæ›²çº¿å’ŒAUCé¢ç§¯ï¼šROCæ›²çº¿çš„çºµè½´æ˜¯â€œçœŸæ­£ä¾‹ç‡â€(True Positive Rate, TPR)ï¼Œæ¨ªè½´æ˜¯â€œå‡æ­£ä¾‹ç‡â€(False Positive Rate, FPR)ã€‚AUCä¸ºæ›²çº¿ä¸‹çš„é¢ç§¯ã€‚</li>
<li>ä»£ä»·æ•æ„Ÿé”™è¯¯ç‡å’Œä»£ä»·æ›²çº¿ï¼šåˆ†ç±»ä»»åŠ¡ä¸­ï¼Œä¸åŒé”™è¯¯é€ æˆçš„æŸå¤±ä¸åŒï¼Œä¹Ÿå°±æ˜¯éå‡ç­‰ä»£ä»·ï¼Œæ‰€ä»¥å¼•å…¥ä»£ä»·çŸ©é˜µï¼Œæœ€å°åŒ–æ€»ä½“ä»£ä»·ã€‚</li>
<li>tåˆ†å¸ƒï¼šç»Ÿè®¡å­¦ä¸­çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæ˜¯ä¸€ç§å¯¹ç§°çš„ã€é’Ÿå½¢çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå…¶å½¢çŠ¶ä¸æ­£æ€åˆ†å¸ƒç±»ä¼¼ï¼Œä½†å°¾éƒ¨æ›´åšã€‚</li>
<li>åå·®ä¸æ–¹å·®ï¼šåå·®ã€æ–¹å·®ã€å™ªå£°ï¼Œæ˜¯å½±å“æ¨¡å‹æ€§èƒ½çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒä»¬å…±åŒå†³å®šäº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚1ã€åå·®æ˜¯æ¨¡å‹é¢„æµ‹å€¼çš„æœŸæœ›ï¼ˆå¤šä¸ªè®­ç»ƒé›†è®­ç»ƒçš„å¤šä¸ªæ¨¡å‹ï¼‰ä¸çœŸå®å€¼ä¹‹é—´çš„å·®å¼‚ï¼Œåæ˜ äº†æ¨¡å‹å¯¹æ•°æ®çš„æ‹Ÿåˆèƒ½åŠ›ï¼Œé«˜åå·®æ„å‘³ç€æ¬ æ‹Ÿåˆï¼Œéœ€è¦ä½¿ç”¨æ›´å¤æ‚çš„æ¨¡å‹å’Œå¢åŠ ç‰¹å¾æ•°é‡ã€‚2ã€æ–¹å·®æ˜¯æ¨¡å‹é¢„æµ‹å€¼çš„å˜åŒ–ç¨‹åº¦ï¼Œåæ˜ äº†æ¨¡å‹å¯¹è®­ç»ƒæ•°æ®çš„æ•æ„Ÿæ€§ã€‚ä¸åŒè®­ç»ƒé›†è®­ç»ƒæ¨¡å‹çš„é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„æ–¹å·®ã€‚é«˜æ–¹å·®æ„å‘³ç€æ¨¡å‹è¿‡äºå¤æ‚ï¼Œè¿‡åº¦æ‹Ÿåˆè®­ç»ƒæ•°æ®ä¸­çš„å™ªå£°ã€‚ä½æ–¹å·®æ„å‘³ç€æ¨¡å‹å¯¹è®­ç»ƒæ•°æ®çš„å˜åŒ–ä¸æ•æ„Ÿï¼Œæ³›åŒ–èƒ½åŠ›è¾ƒå¼ºã€‚é™ä½æ–¹å·®éœ€è¦ä½¿ç”¨æ­£åˆ™åŒ–ï¼Œå¢åŠ è®­ç»ƒæ•°æ®é‡ã€‚3ã€å™ªå£°æ˜¯æ•°æ®ä¸­æ— æ³•è¢«æ¨¡å‹æ•æ‰çš„éšæœºè¯¯å·®ï¼Œä¸å¯é¿å…çš„ï¼Œä¸æ¨¡å‹æ— å…³ã€‚ä¾‹å¦‚å›¾åƒå¯èƒ½åŒ…å«æ¨¡ç³Šæˆ–é®æŒ¡ã€‚</li>
<li>åå·®åº¦é‡äº†å­¦ä¹ ç®—æ³•çš„æœŸæœ›é¢„æµ‹ä¸çœŸå®ç»“æœçš„åç¦»ç¨‹åº¦ï¼Œå³åˆ»ç”»äº†å­¦ä¹ ç®—æ³•æœ¬èº«çš„æ‹Ÿåˆèƒ½åŠ›;æ–¹å·®åº¦é‡äº†åŒæ ·å¤§å°çš„è®­ç»ƒé›†çš„å˜åŠ¨æ‰€å¯¼è‡´çš„å­¦ä¹ æ€§èƒ½çš„å˜åŒ–ï¼Œå³åˆ»ç”»äº†æ•°æ®æ‰°åŠ¨æ‰€é€ æˆçš„å½±å“;å™ªå£°åˆ™è¡¨è¾¾äº†åœ¨å½“å‰ä»»åŠ¡ä¸Šä»»ä½•å­¦ä¹ ç®—æ³•æ‰€èƒ½è¾¾åˆ°çš„æœŸæœ›æ³›åŒ–è¯¯å·®çš„ä¸‹ç•Œï¼Œå³åˆ»ç”»äº†å­¦ä¹ é—®é¢˜æœ¬èº«çš„éš¾åº¦ã€‚</li>
<li>åå·®-æ–¹å·®åˆ†è§£è¯´æ˜ï¼Œæ³›åŒ–æ€§èƒ½æ˜¯ç”±å­¦ä¹ ç®—æ³•çš„èƒ½åŠ›ã€æ•°æ®çš„å……åˆ†æ€§ä»¥åŠå­¦ä¹ ä»»åŠ¡æœ¬èº«çš„éš¾åº¦æ‰€å…±åŒå†³å®šçš„ã€‚ç»™å®šå­¦ä¹ ä»»åŠ¡ï¼Œä¸ºäº†å–å¾—å¥½çš„æ³›åŒ–æ€§èƒ½ï¼Œåˆ™éœ€ä½¿åå·®è¾ƒå°ï¼Œå³èƒ½å¤Ÿå……åˆ†æ‹Ÿåˆæ•°æ®ï¼Œå¹¶ä¸”ä½¿æ–¹å·®è¾ƒå°ï¼Œå³ä½¿å¾—æ•°æ®æ‰°åŠ¨äº§ç”Ÿçš„å½±å“å°ã€‚</li>
<li>è®­ç»ƒä¸è¶³æ—¶ï¼Œå­¦ä¹ å™¨æ‹Ÿåˆèƒ½åŠ›ä¸è¶³ï¼Œåå·®ä¸»å¯¼äº†æ³›åŒ–è¯¯å·®ã€‚è®­ç»ƒç¨‹åº¦åŠ æ·±ï¼Œè®­ç»ƒæ•°æ®çš„æ‰°åŠ¨èƒ½å¤Ÿè¢«å­¦ä¹ å™¨å­¦ä¹ åˆ°ï¼Œæ–¹å·®ä¸»å¯¼äº†æ³›åŒ–è¯¯å·®ã€‚</li>
</ul>
<h1 id="ç¬¬ä¸‰ç« -çº¿æ€§æ¨¡å‹"><a href="#ç¬¬ä¸‰ç« -çº¿æ€§æ¨¡å‹" class="headerlink" title="ç¬¬ä¸‰ç«  çº¿æ€§æ¨¡å‹"></a>ç¬¬ä¸‰ç«  çº¿æ€§æ¨¡å‹</h1><ul>
<li>çº¿æ€§å›å½’ï¼šç”¨äºå»ºæ¨¡å› å˜é‡ä¸è‡ªå˜é‡ä¹‹é—´çš„çº¿æ€§å…³ç³»ã€‚éçº¿æ€§æ¨¡å‹å¯åœ¨çº¿æ€§æ¨¡å‹çš„åŸºç¡€ä¸Šå¼•å…¥å±‚æ¬¡ç»“æ„å’Œé«˜ç»´æ˜ å°„å¾—åˆ°ã€‚ç®€å•çº¿æ€§å›å½’åªæœ‰ä¸€ä¸ªå› å˜é‡å±æ€§ï¼Œå¤šå…ƒçº¿æ€§å›å½’æœ‰å¤šä¸ªã€‚ç›®æ ‡ï¼šä½¿å¾—æ¨¡å‹çš„é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´çš„è¯¯å·®æœ€å°ã€‚ å‡æ–¹è¯¯å·®ï¼šå·®å¹³æ–¹çš„å¹³å‡ï¼Œå¯¹åº”æ¬§å‡ é‡Œå¾—è·ç¦»ã€‚å‚æ•°ä¼°è®¡æ–¹æ³•ï¼šæœ€å°äºŒä¹˜æ³•ã€è§£ææ³•ã€‘ï¼ˆåŸºäºå‡æ–¹è¯¯å·®æœ€å°åŒ–æ¥æ±‚å¯¼è¿›è¡Œæ¨¡å‹æ±‚è§£ï¼Œå¯¹å¼‚å¸¸å€¼éå¸¸æ•æ„Ÿï¼‰ã€æ¢¯åº¦ä¸‹é™ã€è¿­ä»£æ³•ã€‘ï¼ˆé€šè¿‡è¿­ä»£ä¼˜åŒ–é€æ­¥è°ƒæ•´å›å½’ç³»æ•°ï¼Œä½¿æŸå¤±å‡½æ•°æœ€å°åŒ–ï¼‰çº¿æ€§å›å½’ä¼˜ç‚¹ï¼šç®€å•å¯è§£é‡Šæ€§å¼ºï¼›ç¼ºç‚¹ï¼šæ— æ³•æ•æ‰éçº¿æ€§å…³ç³»ï¼Œå¯¹å¼‚å¸¸å€¼æ•æ„Ÿã€‚</li>
<li>å¯¹æ•°çº¿æ€§å›å½’ï¼šé€šè¿‡å¯¹å› å˜é‡å–å¯¹æ•°ï¼Œå°†å…¶è½¬æ¢ä¸ºçº¿æ€§æ¨¡å‹çš„å½¢å¼ï¼Œä»è€Œåˆ©ç”¨çº¿æ€§å›å½’çš„æ–¹æ³•è¿›è¡Œå»ºæ¨¡å› å˜é‡ä¸è‡ªå˜é‡ä¹‹é—´çš„å¯¹æ•°çº¿æ€§å…³ç³»ã€‚é€šå¸¸ç”¨äºå¤„ç†å› å˜é‡æ˜¯è®¡æ•°æ•°æ®æˆ–é¢‘ç‡æ•°æ®çš„æƒ…å†µã€‚</li>
<li>å¯¹æ•°å‡ ç‡å›å½’ï¼šåˆ†ç±»ç®—æ³•ï¼Œé€šè¿‡å°†çº¿æ€§å›å½’çš„è¾“å‡ºæ˜ å°„åˆ°æ¦‚ç‡ç©ºé—´ï¼Œå¹¶ä½¿ç”¨å¯¹æ•°å‡ ç‡æ¥å»ºæ¨¡åˆ†ç±»é—®é¢˜ã€‚ç®€å•é«˜æ•ˆã€å¯è§£é‡Šæ€§å¼ºï¼Œåº”ç”¨äºäºŒåˆ†ç±»é—®é¢˜ï¼Œä½†åªèƒ½å»ºæ¨¡çº¿æ€§å†³ç­–è¾¹ç•Œã€‚å®é™…ä¸Šæ˜¯ç”¨çº¿æ€§å›å½’æ¨¡å‹çš„é¢„æµ‹ç»“æœå»é€¼è¿‘çœŸå®æ ‡è®°çš„å¯¹æ•°å‡ ç‡ï¼Œå¯¹æ•°å‡ ç‡æ˜¯ï¼šlog(p&#x2F;1-p)</li>
<li>sigmoidå‡½æ•°ï¼šå› å…¶å½¢çŠ¶ç±»ä¼¼äºå­—æ¯â€œSâ€è€Œå¾—åï¼Œæ ¸å¿ƒä½œç”¨æ˜¯å°†ä»»æ„å®æ•°æ˜ å°„åˆ° [0, 1] åŒºé—´ï¼Œå¸¸ç”¨äºè¡¨ç¤ºæ¦‚ç‡æˆ–ä½œä¸ºæ¿€æ´»å‡½æ•°ã€‚Ïƒ(z)&#x3D;1&#x2F;1+eâˆ’zã€‚è¾“å‡ºèŒƒå›´æ˜¯0-1ï¼Œå…·æœ‰å•è°ƒæ€§ã€éçº¿æ€§ã€å¹³æ»‘æ€§ã€‚åº”ç”¨ï¼šå¯¹æ•°å‡ ç‡å›å½’ä¸­ç”¨äºå°†çº¿æ€§å›å½’çš„è¾“å‡ºæ˜ å°„åˆ° [0, 1] åŒºé—´ï¼Œè¡¨ç¤ºæ¦‚ç‡ã€‚åœ¨ç¥ç»ç½‘ç»œä¸­ï¼ŒSigmoid å‡½æ•°å¸¸ç”¨äºéšè—å±‚æˆ–è¾“å‡ºå±‚çš„æ¿€æ´»å‡½æ•°ï¼Œå¼•å…¥éçº¿æ€§èƒ½åŠ›ã€‚ç¼ºç‚¹ï¼šå­˜åœ¨æ¢¯åº¦æ¶ˆå¤±å’Œè®¡ç®—å¤æ‚åº¦è¾ƒé«˜ã€‚</li>
<li>çº¿æ€§åˆ¤åˆ«åˆ†æLDAï¼šæ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å°†æ•°æ®æŠ•å½±åˆ°ä½ç»´ç©ºé—´ï¼Œä½¿å¾—åŒç±»æ ·æœ¬å°½å¯èƒ½æ¥è¿‘ï¼Œä¸åŒç±»æ ·æœ¬å°½å¯èƒ½è¿œç¦»ï¼Œä»è€Œå®ç°åˆ†ç±»æˆ–é™ç»´ã€‚ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªæŠ•å½±æ–¹å‘ï¼ˆæˆ–è¶…å¹³é¢ï¼‰ï¼Œä½¿å¾—åœ¨è¯¥æ–¹å‘ä¸Šï¼Œç±»å†…è·ç¦»æœ€å°åŒ–ï¼Œç±»é—´è·ç¦»æœ€å¤§åŒ–ã€‚</li>
<li>æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•ï¼šä¸€ç§ç”¨äºæ±‚è§£çº¦æŸä¼˜åŒ–é—®é¢˜çš„æ•°å­¦æ–¹æ³•ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å¼•å…¥æ‹‰æ ¼æœ—æ—¥ä¹˜å­ï¼Œå°†çº¦æŸæ¡ä»¶èå…¥ç›®æ ‡å‡½æ•°ï¼Œä»è€Œå°†çº¦æŸä¼˜åŒ–é—®é¢˜è½¬åŒ–ä¸ºæ— çº¦æŸä¼˜åŒ–é—®é¢˜ã€‚é€šè¿‡æ±‚è§£æ‹‰æ ¼æœ—æ—¥å‡½æ•°çš„æå€¼ï¼Œå¯ä»¥å¾—åˆ°åŸçº¦æŸä¼˜åŒ–é—®é¢˜çš„è§£ã€‚å¯¹å› å˜é‡å’Œæ‹‰æ ¼æœ—æ—¥ä¹˜å­æ±‚åå¯¼ä¹‹åè§£æ–¹ç¨‹ã€‚</li>
<li>å¤šåˆ†ç±»é—®é¢˜ï¼š1ã€ç›´æ¥å¤šåˆ†ç±»æ–¹æ³•ï¼šSoftmax å›å½’ï¼Œä½¿ç”¨ Softmax å‡½æ•°å°†çº¿æ€§æ¨¡å‹çš„è¾“å‡ºè½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒã€‚ç¥ç»ç½‘ç»œä¸­åœ¨è¾“å‡ºå±‚ä½¿ç”¨ Softmax æ¿€æ´»å‡½æ•°ï¼Œå°†è¾“å‡ºè½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒã€‚2ã€é—´æ¥å¤šåˆ†ç±»æ–¹æ³•ï¼šå°†å¤šåˆ†ç±»ä»»åŠ¡æ‹†ä¸ºè‹¥å¹²ä¸ªäºŒåˆ†ç±»ä»»åŠ¡æ±‚è§£ï¼Œä¸€å¯¹ä¸€ï¼ˆéœ€è®­ç»ƒN(N - 1)&#x2F;2ä¸ªåˆ†ç±»å™¨ï¼‰ã€ä¸€å¯¹å…¶ä½™ï¼ˆéœ€è®­ç»ƒN ä¸ªåˆ†ç±»å™¨ï¼‰ã€‚</li>
<li>ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ï¼šæŒ‡åœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œä¸åŒç±»åˆ«çš„æ ·æœ¬æ•°é‡åˆ†å¸ƒä¸å‡è¡¡ï¼Œå…¶ä¸­ä¸€ä¸ªæˆ–å°‘æ•°ç±»åˆ«çš„æ ·æœ¬æ•°é‡è¿œè¿œå°‘äºå…¶ä»–ç±»åˆ«ã€‚å½±å“ï¼šæ¨¡å‹åå‘å¤šæ•°ç±»ã€å‡†ç¡®ç‡è¯„ä»·æŒ‡æ ‡å¤±æ•ˆã€‚è§£å†³ï¼šæ•°æ®å±‚é¢ï¼Œè¿‡é‡‡æ ·éšæœºå¤åˆ¶å°‘æ•°ç±»æ ·æœ¬å¢åŠ å°‘æ•°ç±»æ ·æœ¬çš„æ•°é‡ï¼Œæ¬ é‡‡æ ·å‡å°‘å¤šæ•°ç±»æ ·æœ¬çš„æ•°é‡ï¼Œæ··åˆé‡‡æ ·ã€‚ç®—æ³•å±‚é¢ï¼Œä¸ºä¸åŒç±»åˆ«åˆ†é…ä¸åŒçš„è¯¯åˆ†ç±»ä»£ä»·ï¼Œä½¿æ¨¡å‹æ›´å…³æ³¨å°‘æ•°ç±»ã€‚</li>
</ul>
<h1 id="ç¬¬å››ç« -å†³ç­–æ ‘"><a href="#ç¬¬å››ç« -å†³ç­–æ ‘" class="headerlink" title="ç¬¬å››ç«  å†³ç­–æ ‘"></a>ç¬¬å››ç«  å†³ç­–æ ‘</h1><ul>
<li>å†³ç­–æ ‘ï¼šé€šè¿‡ä¸€ç³»åˆ—è§„åˆ™å¯¹æ•°æ®è¿›è¡Œåˆ’åˆ†ï¼Œä½¿å¾—æ¯ä¸ªå­é›†å°½å¯èƒ½çº¯å‡€ï¼ˆå³å±äºåŒä¸€ç±»åˆ«æˆ–å…·æœ‰ç›¸ä¼¼çš„å€¼ï¼‰ï¼Œæ„å»ºä¸€æ£µæ ‘å½¢ç»“æ„ã€‚æ„å»ºè¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªé€’å½’çš„â€œåˆ†è€Œæ²»ä¹‹â€è¿‡ç¨‹ã€‚</li>
<li>å†³ç­–æ ‘çš„æ„å»ºè¿‡ç¨‹ï¼š1ã€æ ¹æ®æŸç§å‡†åˆ™ï¼ˆå¦‚ä¿¡æ¯å¢ç›Šã€åŸºå°¼æŒ‡æ•°ç­‰ï¼‰ï¼Œé€‰æ‹©æœ€ä¼˜ç‰¹å¾è¿›è¡Œåˆ’åˆ†ã€‚2ã€æ ¹æ®æœ€ä¼˜ç‰¹å¾çš„å–å€¼ï¼Œå°†æ•°æ®é›†åˆ’åˆ†ä¸ºå¤šä¸ªå­é›†ã€‚3ã€å¯¹æ¯ä¸ªå­é›†é€’å½’åœ°é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ»¡è¶³åœæ­¢æ¡ä»¶ï¼ˆå¦‚å­é›†çº¯å‡€ã€è¾¾åˆ°æœ€å¤§æ·±åº¦ç­‰ï¼‰ã€‚4ã€å½“æ»¡è¶³åœæ­¢æ¡ä»¶æ—¶ï¼Œç”Ÿæˆå¶èŠ‚ç‚¹ï¼Œå¶èŠ‚ç‚¹çš„å€¼ä¸ºè¯¥å­é›†ä¸­å¤šæ•°ç±»åˆ«ï¼ˆåˆ†ç±»ä»»åŠ¡ï¼‰æˆ–å¹³å‡å€¼ï¼ˆå›å½’ä»»åŠ¡ï¼‰ã€‚</li>
<li>å†³ç­–æ ‘ç”¨äºé€‰æ‹©æœ€æœ‰åˆ’åˆ†ç‰¹å¾çš„å‡†åˆ™ï¼šåˆ†ç±»ä»»åŠ¡ï¼šä¿¡æ¯å¢ç›Šï¼ˆè¡¨ç¤ºåˆ’åˆ†å‰åä¿¡æ¯ç†µçš„å‡å°‘é‡ï¼Œä¿¡æ¯ç†µ&#x3D;plogpï¼Œä¿¡æ¯å¢ç›Šè¶Šå¤§ï¼Œå°±è®¤ä¸ºç”¨å±æ€§aæ¥è¿›è¡Œåˆ’åˆ†æ‰€è·å¾—çš„çº¯åº¦æå‡æœ€å¤§ï¼‰ã€å¢ç›Šç‡ï¼ˆé€šè¿‡å¼•å…¥å›ºæœ‰å€¼å¯¹ä¿¡æ¯å¢ç›Šè¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œå…‹æœäº†ä¿¡æ¯å¢ç›Šå¯¹å–å€¼æ•°ç›®è¾ƒå¤šçš„ç‰¹å¾çš„åå¥½é—®é¢˜ï¼‰ã€åŸºå°¼æŒ‡æ•°ï¼ˆè¡¨ç¤ºä»æ•°æ®é›†ä¸­éšæœºæŠ½å–ä¸¤ä¸ªæ ·æœ¬ï¼Œå…¶ç±»åˆ«æ ‡ç­¾ä¸ä¸€è‡´çš„æ¦‚ç‡ã€‚åŸºå°¼æŒ‡æ•°è¶Šå°ï¼Œæ•°æ®é›†çš„çº¯åº¦è¶Šé«˜ï¼‰ã€‚å›å½’ä»»åŠ¡ï¼šå‡æ–¹è¯¯å·®MSEï¼ˆé€‰æ‹©ä½¿å‡æ–¹è¯¯å·®æœ€å°çš„ç‰¹å¾è¿›è¡Œåˆ’åˆ†ï¼‰ã€‚</li>
<li>å†³ç­–æ ‘çš„å‰ªæï¼šå†³ç­–æ ‘å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œå› æ­¤éœ€è¦é€šè¿‡å‰ªæï¼ˆPruningï¼‰æ¥æé«˜æ³›åŒ–èƒ½åŠ›ã€‚é¢„å‰ªæï¼šèŠ‚ç‚¹åˆ’åˆ†å‰å…ˆè¿›è¡Œä¼°è®¡ï¼Œè®¡ç®—åˆ’åˆ†å‰å’Œåˆ’åˆ†åçš„éªŒè¯é›†ç²¾åº¦ï¼Œåªæœ‰åˆ’åˆ†åç²¾åº¦å˜å¤§äº†ï¼Œæ‰ä¼šåˆ’åˆ†ï¼Œå…¶ä»–çš„å°±ç›´æ¥ä¸€åˆ€åˆ‡ä¸å†åˆ’åˆ†ã€‚åå‰ªæï¼šå…ˆç”Ÿæˆä¸€é¢—å®Œæ•´çš„å†³ç­–æ ‘ï¼Œä»å¶èŠ‚ç‚¹å‘ä¸Šå‰ªæï¼Œé€šè¿‡éªŒè¯é›†è¯„ä¼°å‰ªæå‰åçš„æ€§èƒ½ï¼Œå†³å®šæ˜¯å¦ä¿ç•™ã€‚</li>
<li>å†³ç­–æ ‘çš„è¿ç»­ä¸ç¼ºå¤±å€¼å¤„ç†ï¼šå†³ç­–æ ‘é€šå¸¸ç”¨äºå¤„ç†ç¦»æ•£ç‰¹å¾ï¼Œå¦‚æœè¦å¤„ç†è¿ç»­å±æ€§ï¼šäºŒåˆ†æ³•å’Œå¤šåˆ†æ³•ã€‚éœ€è¦æ³¨æ„ï¼Œä¸è¿ç»­å±æ€§ä¸åŒï¼Œè‹¥å½“å‰ç»“ç‚¹åˆ’åˆ†å±æ€§ä¸ºè¿ç»­å±æ€§ï¼Œåˆ™è¯¥å±æ€§è¿˜å¯ä½œä¸ºå…¶åä»£èŠ‚ç‚¹çš„åˆ’åˆ†å±æ€§ã€‚å¯¹äºç¼ºå¤±å€¼ï¼ˆæ ·æœ¬çš„æŸäº›å±æ€§å€¼ç¼ºå¤±ï¼‰ï¼Œé€šè¿‡å¿½ç•¥ã€å¡«è¡¥æˆ–å•ç‹¬åˆ†æ”¯å¤„ç†ç¼ºå¤±å€¼ã€‚</li>
<li>å†³ç­–æ ‘çš„åˆ†ç±»è¾¹ç•Œï¼šå†³ç­–æ ‘çš„åˆ†ç±»è¾¹ç•Œæœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹ï¼šè½´å¹³è¡Œï¼Œå³å®ƒçš„åˆ†ç±»è¾¹ç•Œç”±è‹¥å¹²ä¸ªä¸åæ ‡è½´å¹³è¡Œçš„åˆ†æ®µç»„æˆã€‚æ¯ä¸€æ®µåˆ’åˆ†éƒ½ç›´æ¥å¯¹åº”äº†æŸä¸ªå±æ€§å–å€¼ã€‚</li>
<li>å¤šå˜é‡å†³ç­–æ ‘ï¼šéå¶èŠ‚ç‚¹ä¸å†ä»…å¯¹æŸä¸ªå±æ€§ï¼Œè€Œæ˜¯å¯¹å±æ€§çš„çº¿æ€§ç»„åˆè¿›è¡Œåˆ’åˆ†ï¼Œå®ç°æ–œåˆ’åˆ†ï¼Œä¸ä¼ ç»Ÿçš„å•å˜é‡å†³ç­–æ ‘ä¸åŒï¼Œå¤šå˜é‡å†³ç­–æ ‘ä¸æ˜¯ä¸ºæ¯ä¸ªéå¶ç»“ç‚¹å¯»æ‰¾ä¸€ä¸ªæœ€ä¼˜åˆ’åˆ†å±æ€§ï¼Œè€Œæ˜¯è¯•å›¾å»ºç«‹ä¸€ä¸ªåˆé€‚çš„çº¿æ€§åˆ†ç±»å™¨ã€‚</li>
</ul>
<h1 id="ç¬¬äº”ç« -ç¥ç»ç½‘ç»œ"><a href="#ç¬¬äº”ç« -ç¥ç»ç½‘ç»œ" class="headerlink" title="ç¬¬äº”ç«  ç¥ç»ç½‘ç»œ"></a>ç¬¬äº”ç«  ç¥ç»ç½‘ç»œ</h1><ul>
<li>ç¥ç»ç½‘ç»œï¼šä¸€ç§æ¨¡ä»¿ç”Ÿç‰©ç¥ç»ç³»ç»Ÿç»“æ„å’ŒåŠŸèƒ½çš„è®¡ç®—æ¨¡å‹ï¼Œé€šè¿‡å¤šå±‚ç¥ç»å…ƒçš„ç›¸äº’è¿æ¥å’Œæƒé‡è°ƒæ•´ï¼Œèƒ½å¤Ÿå­¦ä¹ å¤æ‚çš„éçº¿æ€§å…³ç³»ã€‚</li>
<li>ç¥ç»å…ƒï¼šé€šè¿‡åŠ æƒæ±‚å’Œå’Œæ¿€æ´»å‡½æ•°å¤„ç†åè¾“å‡º</li>
<li>æ¿€æ´»å‡½æ•°ï¼šå¼•å…¥éçº¿æ€§ï¼Œä½¿ç¥ç»ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ å¤æ‚æ¨¡å¼ï¼ŒSigmoidã€ReLUã€SoftMaxã€‚</li>
<li>ç¥ç»ç½‘ç»œçš„å­¦ä¹ è¿‡ç¨‹ï¼Œå°±æ˜¯æ ¹æ®è®­ç»ƒæ•°æ®æ¥è°ƒæ•´ç¥ç»å…ƒä¹‹é—´çš„â€è¿æ¥æƒâ€ä»¥åŠæ¯ä¸ªåŠŸèƒ½ç¥ç»å…ƒçš„é˜ˆå€¼ã€‚è¾“å…¥å±‚ç¥ç»å…ƒä»…ä»…æ˜¯æ¥å—è¾“å…¥ï¼Œè€Œéšå±‚ä¸è¾“å‡ºå±‚åˆ™éƒ½åŒ…å«åŠŸèƒ½ç¥ç»å…ƒï¼ˆæœ‰æ¿€æ´»å‡½æ•°ï¼‰ã€‚</li>
<li>æ„ŸçŸ¥å™¨ï¼šç”±ä¸¤å±‚ç¥ç»å…ƒç»„æˆï¼Œè¾“å…¥å±‚æ¥å—å¤–ç•Œè¾“å…¥ä¿¡å·åä¼ é€’ç»™è¾“å‡ºå±‚ï¼Œè¾“å‡ºå±‚æ˜¯ç¥ç»å…ƒï¼Œä¹Ÿå«åšâ€œé˜ˆå€¼é€»è¾‘å•å…ƒâ€ã€‚å±€é™æ€§ï¼šèƒ½å®ç°ä¸æˆ–éé€»è¾‘è¿ç®—ï¼Œåªèƒ½è§£å†³çº¿æ€§å¯åˆ†é—®é¢˜ï¼ˆå­˜åœ¨ä¸€ä¸ªçº¿æ€§è¶…å¹³é¢èƒ½å°†å®ƒä»¬åˆ†å¼€ï¼‰ï¼Œæ— æ³•å¤„ç†éçº¿æ€§åˆ†ç±»ä»»åŠ¡ï¼ˆå¦‚å¼‚æˆ–é—®é¢˜ï¼‰ã€‚</li>
<li>å¤šå±‚ç½‘ç»œï¼šé€šè¿‡å †å å¤šä¸ªæ„ŸçŸ¥å™¨å±‚ï¼Œèƒ½å¤Ÿå­¦ä¹ å¤æ‚çš„éçº¿æ€§å…³ç³»ã€‚åŒ…æ‹¬ï¼šè¾“å…¥å±‚ï¼ˆæ¥æ”¶è¾“å…¥æ•°æ®ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªç‰¹å¾ï¼‰ã€éšè—å±‚ï¼ˆé€šè¿‡éçº¿æ€§å˜æ¢æå–ç‰¹å¾ï¼Œå¯ä»¥æœ‰å¤šå±‚ï¼‰ã€è¾“å‡ºå±‚ï¼ˆè¾“å‡ºé¢„æµ‹ç»“æœï¼ŒèŠ‚ç‚¹æ•°å–å†³äºä»»åŠ¡ç±»å‹ï¼Œå¦‚åˆ†ç±»ä»»åŠ¡ä¸­èŠ‚ç‚¹æ•°ç­‰äºç±»åˆ«æ•°ï¼‰ã€‚ç¥ç»ç½‘ç»œçš„å‰ä¸€å±‚çš„æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½ä¸åä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒç›¸è¿â€“å…¨è¿æ¥ç¥ç»ç½‘ç»œã€‚</li>
<li>å¤šå±‚å‰é¦ˆç¥ç»ç½‘ç»œï¼šå…ˆå°†è¾“å…¥æä¾›ç»™è¾“å…¥å±‚ç¥ç»å…ƒï¼Œç„¶åé€å±‚å°†ä¿¡å·å‰ä¼ ï¼ˆå‰å‘ä¼ æ’­ï¼‰ï¼Œç›´åˆ°äº§ç”Ÿè¾“å‡ºå±‚çš„ç»“æœã€‚ç„¶åè®¡ç®—è¾“å‡ºå±‚çš„è¯¯å·®ï¼ˆæŸå¤±å‡½æ•°ï¼Œå¦‚å‡æ–¹è¯¯å·®ã€äº¤å‰ç†µï¼‰ï¼Œå†å°†è¯¯å·®é€†å‘ä¼ æ’­è‡³éšå±‚ç¥ç»å…ƒï¼ˆè¯¯å·®é€†ä¼ æ’­ç®—æ³•ï¼Œä½¿ç”¨é“¾å¼æ³•åˆ™é€å±‚ä¼ æ’­è¯¯å·®ï¼‰ï¼Œæœ€åæ ¹æ®éšå±‚ç¥ç»å…ƒçš„è¯¯å·®æ¥å¯¹æƒå€¼å’Œé˜ˆå€¼è¿›è¡Œè°ƒæ•´ï¼ˆåŸºäºæ¢¯åº¦ä¸‹é™ç­–ç•¥ï¼Œä»¥ç›®æ ‡çš„è´Ÿæ¢¯åº¦æ–¹å‘å¯¹å‚æ•°è¿›è¡Œè°ƒæ•´ï¼‰ã€‚è¯¥è¿­ä»£è¿‡ç¨‹å¾ªç¯è¿›è¡Œï¼Œç›´åˆ°è¾¾åˆ°æŸäº›åœæ­¢æ¡ä»¶ä¸ºæ­¢ï¼Œä¾‹å¦‚è®­ç»ƒè¯¯å·®å·±è¾¾åˆ°ä¸€ä¸ªå¾ˆå°çš„å€¼ã€‚</li>
<li>ç´¯ç§¯è¯¯å·®é€†å‘ä¼ æ’­ï¼šåŸºäºç´¯ç§¯è¯¯å·®æœ€å°åŒ–è¿›è¡Œæ›´æ–°</li>
<li>åªéœ€åŒ…å«è¶³å¤Ÿå¤šç¥ç»å…ƒçš„éšå±‚ï¼Œå¤šå±‚å‰é¦ˆç½‘ç»œå°±èƒ½ä»¥ä»»æ„ç²¾åº¦é€¼è¿‘ä»»æ„å¤æ‚åº¦çš„è¿ç»­å‡½æ•°ï¼Œé€šè¿‡è¯•é”™æ³•è°ƒæ•´éšå±‚ç¥ç»å…ƒçš„ä¸ªæ•°ã€‚</li>
<li>è§£å†³è¿‡æ‹Ÿåˆï¼šæ—©åœï¼šå°†æ•°æ®åˆ†æˆè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œè®­ç»ƒé›†ç”¨æ¥è®¡ç®—æ¢¯åº¦ã€æ›´æ–°è¿æ¥æƒå’Œé˜ˆå€¼ï¼ŒéªŒè¯é›†ç”¨æ¥ä¼°è®¡è¯¯å·®ï¼Œè‹¥è¿ç»­å¤šè½®è®­ç»ƒé›†è¯¯å·®é™ä½ä½†éªŒè¯é›†è¯¯å·®å‡é«˜ï¼Œåˆ™åœæ­¢è®­ç»ƒï¼ŒåŒæ—¶è¿”å›å…·æœ‰æœ€å°éªŒè¯é›†è¯¯å·®çš„è¿æ¥æƒå’Œé˜ˆå€¼ã€‚æ­£åˆ™åŒ–ï¼šåœ¨æŸå¤±å‡½æ•°ä¸­åŠ å…¥é¢å¤–çš„æƒ©ç½šé¡¹ï¼Œé™åˆ¶æ¨¡å‹å‚æ•°çš„å¤§å°æˆ–å¤æ‚åº¦ã€‚</li>
<li>ç¥ç»ç½‘ç»œç±»å‹ï¼šå‰é¦ˆç¥ç»ç½‘ç»œFNNï¼šæœ€ç®€å•çš„ç¥ç»ç½‘ç»œï¼Œä¿¡æ¯å•å‘ä¼ æ’­ã€‚å·ç§¯ç¥ç»ç½‘ç»œCNNï¼šç”¨äºå›¾åƒå¤„ç†ï¼Œé€šè¿‡å·ç§¯æ ¸æå–å±€éƒ¨ç‰¹å¾ã€‚å¾ªç¯ç¥ç»ç½‘ç»œRNNï¼šç”¨äºåºåˆ—æ•°æ®ï¼ˆå¦‚æ–‡æœ¬ã€æ—¶é—´åºåˆ—ï¼‰ï¼Œå…·æœ‰è®°å¿†èƒ½åŠ›ã€‚ç”Ÿæˆå¯¹æŠ—ç½‘ç»œGANï¼šç”±ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨ç»„æˆï¼Œç”¨äºç”Ÿæˆæ•°æ®ã€‚</li>
<li>å¦‚ä½•é¿å…é™·å…¥å±€éƒ¨æœ€å°ï¼šä»å¤šä¸ªä¸åŒçš„åˆå§‹ç‚¹å¼€å§‹æœç´¢ã€åŠ¨é‡æ³•é€šè¿‡å¼•å…¥å†å²æ¢¯åº¦ä¿¡æ¯ï¼ŒåŠ é€Ÿæ¢¯åº¦ä¸‹é™å¹¶å¸®åŠ©è·³å‡ºå±€éƒ¨æœ€å°å€¼ã€ä½¿ç”¨è‡ªé€‚åº”å­¦ä¹ ç‡æ–¹æ³•åŠ¨æ€è°ƒæ•´å­¦ä¹ ç‡ã€ä½¿ç”¨æ¨¡æ‹Ÿé€€ç«ï¼Œé€šè¿‡å¼•å…¥é€æ¸é™ä½çš„â€œæ¸©åº¦â€å‚æ•°ï¼Œæ§åˆ¶æœç´¢è¿‡ç¨‹ä¸­çš„éšæœºæ€§ï¼Œä»è€Œåœ¨æ—©æœŸæ¢ç´¢æ›´å¤šè§£ç©ºé—´ï¼ŒåæœŸé€æ¸æ”¶æ•›åˆ°å…¨å±€æœ€ä¼˜è§£ã€ä½¿ç”¨SGDéšæœºæ¢¯åº¦ï¼Œé€šè¿‡å¼•å…¥å™ªå£°å¸®åŠ©è·³å‡ºå±€éƒ¨æœ€å°å€¼ã€‚ï¼ˆéƒ½æ˜¯å¯å‘å¼çš„ï¼‰</li>
<li>æ¨¡æ‹Ÿé€€ç«ï¼šæ¯ä¸€æ­¥ä»¥ä¸€å®šæ¦‚ç‡æ¥å—æ¯”å½“å‰è§£æ›´å·®çš„ç»“æœï¼Œæ¥å—æ¬¡ä¼˜è§£çš„æ¦‚ç‡éšç€æ—¶é—´çš„æ¨ç§»é€æ¸é™ä½ï¼Œä»è€Œä¿è¯ç®—æ³•ç¨³å®šã€‚</li>
<li>RBFç½‘ç»œï¼šä¸€ç§å•éšå±‚å‰é¦ˆç¥ç»ç½‘ç»œï¼Œä½¿ç”¨å¾„å‘åŸºå‡½æ•°ä½œä¸ºéšå±‚ç¥ç»å…ƒæ¿€æ´»å‡½æ•°ï¼Œè¾“å‡ºå±‚åˆ™æ˜¯å¯¹éšå±‚ç¥ç»å…ƒè¾“å‡ºçš„çº¿æ€§ç»„åˆã€‚å¸¸ç”¨äºå‡½æ•°é€¼è¿‘ã€åˆ†ç±»å’Œå›å½’ä»»åŠ¡ï¼Œå…·æœ‰ç»“æ„ç®€å•ã€è®­ç»ƒé€Ÿåº¦å¿«çš„ç‰¹ç‚¹ã€‚RBF å¾„å‘åŸºå‡½æ•°çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡è·ç¦»åº¦é‡ï¼ˆé€šå¸¸æ˜¯æ¬§æ°è·ç¦»ï¼‰æ¥è®¡ç®—è¾“å…¥æ•°æ®ç‚¹ä¸æŸä¸ªä¸­å¿ƒç‚¹ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚å¸¸è§çš„RDFå‡½æ•°æœ‰é«˜æ–¯å‡½æ•°ï¼Œå…·æœ‰å¾„å‘å¯¹ç§°æ€§ã€å¹³æ»‘æ€§çš„ç‰¹ç‚¹ã€‚</li>
<li>ç«äº‰å‹å­¦ä¹ ï¼šç¥ç»ç½‘ç»œä¸­ä¸€ç§å¸¸ç”¨çš„æ— ç›‘ç£å­¦ä¹ ç­–ç•¥ï¼Œåœ¨ä½¿ç”¨è¯¥ç­–ç•¥æ—¶ï¼Œç½‘ç»œçš„è¾“å‡ºç¥ç»å…ƒç›¸äº’ç«äº‰ï¼Œæ¯ä¸€æ—¶åˆ»ä»…æœ‰ä¸€ä¸ªç«äº‰è·èƒœçš„ç¥ç»å…ƒè¢«æ¿€æ´»ï¼Œå…¶ä»–ç¥ç»å…ƒçš„çŠ¶æ€è¢«æŠ‘åˆ¶ã€‚è¿™ç§æœºåˆ¶äº¦ç§°â€èƒœè€…é€šåƒâ€ (winner-take-all) åŸåˆ™ã€‚</li>
<li>ARTï¼ˆè‡ªé€‚åº”å…±æŒ¯ç†è®ºç½‘ç»œï¼‰ç½‘ç»œï¼šç«äº‰å‹å­¦ä¹ çš„ä»£è¡¨ï¼Œè¯¥ç½‘ç»œç”±æ¯”è¾ƒå±‚ã€è¯†åˆ«å±‚ã€è¯†åˆ«é˜ˆå€¼å’Œé‡ç½®æ¨¡å—æ„æˆã€‚åœ¨æ¥æ”¶åˆ°æ¯”è¾ƒå±‚çš„è¾“å…¥ä¿¡å·åè¯†åˆ«å±‚ç¥ç»å…ƒä¹‹é—´ç›¸äº’ç«äº‰ä»¥äº§ç”Ÿè·èƒœç¥ç»å…ƒã€‚ç«äº‰çš„æœ€ç®€å•æ–¹å¼æ˜¯è®¡ç®—è¾“å…¥å‘é‡ä¸æ¯ä¸ªè¯†åˆ«å±‚ç¥ç»å…ƒæ‰€å¯¹åº”çš„æ¨¡å¼ç±»çš„ä»£è¡¨å‘é‡ä¹‹é—´çš„è·ç¦»ï¼Œè·ç¦»æœ€å°è€…èƒœã€‚è·èƒœç¥ç»å…ƒå°†å‘å…¶ä»–è¯†åˆ«å±‚ç¥ç»å…ƒå‘é€ä¿¡å·ï¼ŒæŠ‘åˆ¶å…¶æ¿€æ´»ã€‚è‹¥è¾“å…¥å‘é‡ä¸è·èƒœç¥ç»å…ƒæ‰€å¯¹åº”çš„ä»£è¡¨å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦å¤§äºè¯†åˆ«é˜ˆå€¼ï¼Œåˆ™å½“å‰è¾“å…¥æ ·æœ¬å°†è¢«å½’ä¸ºè¯¥ä»£è¡¨å‘é‡æ‰€å±ç±»åˆ«ï¼ŒåŒæ—¶ï¼Œç½‘ç»œè¿æ¥æƒå°†ä¼šæ›´æ–°ï¼Œä½¿å¾—ä»¥ååœ¨æ¥æ”¶åˆ°ç›¸ä¼¼è¾“å…¥æ ·æœ¬æ—¶è¯¥æ¨¡å¼ç±»ä¼šè®¡ç®—å‡ºæ›´å¤§çš„ç›¸ä¼¼åº¦ï¼Œä»è€Œä½¿è¯¥è·èƒœç¥ç»å…ƒæœ‰æ›´å¤§å¯èƒ½è·èƒœã€‚è‹¥ç›¸ä¼¼åº¦ä¸å¤§äºè¯†åˆ«é˜ˆå€¼ï¼Œåˆ™é‡ç½®æ¨¡å—å°†åœ¨è¯†åˆ«å±‚å¢è®¾ä¸€ä¸ªæ–°çš„ç¥ç»å…ƒï¼Œå…¶ä»£è¡¨å‘é‡å°±è®¾ç½®ä¸ºå½“å‰è¾“å…¥å‘é‡ã€‚</li>
<li>ARTç½‘ç»œæ˜¯ä¸€ç§åŸºäºè‡ªé€‚åº”å…±æŒ¯ç†è®ºçš„æ— ç›‘ç£å­¦ä¹ ç¥ç»ç½‘ç»œï¼Œèƒ½å¤ŸåŠ¨æ€åœ°å­¦ä¹ å’Œåˆ†ç±»è¾“å…¥æ•°æ®ï¼ŒåŒæ—¶ä¿æŒå¯¹ä¹‹å‰å­¦ä¹ æ¨¡å¼çš„ç¨³å®šæ€§ã€‚å¯ä»¥è¿›è¡Œå¢é‡å­¦ä¹ ã€‚å®ƒé€‚ç”¨äºæ¨¡å¼è¯†åˆ«ã€æ•°æ®èšç±»å’Œå¼‚å¸¸æ£€æµ‹ç­‰ä»»åŠ¡ï¼Œå°½ç®¡å‚æ•°æ•æ„Ÿå’Œè®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œä½†åœ¨åŠ¨æ€å­¦ä¹ ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>æ·±åº¦å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>MachineLearning</tag>
      </tags>
  </entry>
</search>
